     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Cheques to be paid maintenance level 1')      *
      *****************************************************************
      *                                                               *
      *  Midas - FUNDS TRANSFER MODULE                                *
      *                                                               *
      *  FT0080 - CHEQUES TO BE PAID MAINTENANCE LEVEL 1              *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD031725           Date 07Jan15               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR888911           Date 26Jan12               *
      *                 AR850937           Date 05Jan12               *
      *                 AR879983           Date 21Dec11               *
      *                 AR853257           Date 04Nov11               *
      *                 AR820566           Date 25Aug11               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG17124           Date 26Mar08               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12897           Date 18Dec06               *
      *                 CPK025             Date 29Aug06               *
      *                 BUG11856           Date 10Aug06               *
      *                 CSD031             Date 10Apr06               *
      *                 145043             Date 06Jun06               *
      *                 CSD027A            Date 10May06               *
      *                 239450             Date 10May06               *
      *                 237565             Date 29Apr06               *
      *                 237563             Date 05Apr06               *
      *                 CDL049             Date 03Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10652           Date 21Feb06               *
      *                 CER001             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3194            Date 21Jun04               *
      *                 BUG3281            Date 17Jun04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 212014             Date 20Nov02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 196947             Date 16Aug01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 30May00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179627             Date 14Aug00               *
      *                 179732             Date 26May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 148229             Date 13Dec98               *
      *                 143962             Date 29Oct98               *
      *                 140645             DATE 03SEP98               *
      *                 141333             DATE 03SEP98               *
      *                 140648             Date 18Aug98               *
      *                 CEU006             Date 03Apr98               *
      *                 125390             DATE 03Mar98               *
      *                 112287             DATE 19Feb98               *
      *                 120827             Date 06Jul97               *
      *                 096486             Date 03APR97               *
      *                 S01408             DATE 07OCT96               *
      *                 CAC001             DATE 01FEB96               *
      *                 101921             DATE 10JUL96               *
      *                 S01408             DATE 22FEB96               *
      *                 093958             DATE 17JAN96               *
      *                 094278             DATE 13OCT95               *
      *                 084663             DATE 15JUN95               *
      *                 084499             DATE 18APR95               *
      *                 074810             DATE 01AUG94               *
      *                 S01508             DATE 27JUN94               *
      *                 S01499             DATE 06JUN94               *
      *                 S01494             DATE 25MAY94               *
      *                 068347             DATE 18MAR94               *
      *                 063767             DATE 02DEC93               *
      *                 056031             DATE 28MAY93               *
      *                 049117             DATE 07MAY93               *
      *                 033361             DATE 07MAY93               *
      *                 047179             DATE 29APR93               *
      *                 S01414             DATE 29MAR93               *
      *                 042167             DATE 28AUG92               *
      *                 050924             DATE 08MAY92               *
      *                 004120             DATE 13AUG91               *
      *                 035399             DATE 16OCT91               *
      *                 035398             DATE 04SEP91               *
      *                 035397             DATE 16AUG91               *
      *                 035390             DATE 26APR91               *
      *                 E37264             DATE 19MAR92               *
      *                 E37171             DATE 18MAR92               *
      *                 E36921             DATE 10MAR92               *
      *                 E32481             DATE 17JUN91               *
      *                 E29994             DATE 01AUG91               *
      *                 E29970             DATE 26JUL91               *
      *                 E29979             DATE 17JUL91               *
      *                 E32880             DATE 04JUN91               *
      *                 E32859             DATE 07MAY91               *
      *                 E32529             DATE 19APR91               *
      *                 E32543             DATE 19APR91               *
      *                 E32776             DATE 19FEB91               *
      *                 E32536             DATE 18JAN91               *
      *                 E29832             DATE 02NOV90               *
      *                 E29828             DATE 02NOV90               *
      *                 E29826             DATE 02NOV90               *
      *                 E29829             DATE 02NOV90               *
      *                 E29531             DATE 29OCT90               *
      *                 S01195             DATE 20OCT90               *
      *                 S01194             DATE 20OCT90               *
      *                 S01117             DATE 20OCT90               *
      *                 E23057             DATE 09AUG90               *
      *                 E23146             DATE 02AUG90               *
      *                 E22871             DATE 01AUG90               *
      *                 E22952             DATE 31JUL90               *
      *                 S01251             DATE 03FEB90               *
      *                 S01252             DATE 03FEB90               *
      *                 E16366             DATE 30JAN90               *
      *                 S01241             DATE 08JAN90               *
      *                 S01199             DATE 17/08/89              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  MD031725 - Default profit center only on the first time or   *
      *             if the debit party was changed and the profit     *
      *             center was blank.                                 *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
      *             Movements Enquiry is not changing from N to Y     *
      *             (Recompile)                                       *
      *           - Applied for AR944923                              *
      *  AR850937 - FTC0610 00001 DBERR 050 in program FT0610         *
      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
      *  AR853257 - Account Keys for FT were not generated            *
      *             (Recompile)                                       *
      *  AR820566 - Compilation errors during LT build                *
      *  CER049 - Stamp Tax                                           *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  BUG17124 - First time you open the screen you get a warning  *
      *             message.                                          *
      *  BUG12897 - COB component FTC0550 failed due to unmatched     *
      *             trailer file                                      *
      *  CPK025 - MidasPlus 1.3 packaging.  Definition of W#AMT lost. *
      *  BUG11856 - Locked Job                                        *
      *  CSD031 - Enhanced Centralised Static Data                    *
      *  145043 - Exchange rate should allow 5 integers before decimal*
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  239450 - Allow Level 1 Screen 2 to be shown during amendment *
      *           even if no previous cheque sequence was entered.    *
      *           This will allow insertion of cheque sequence that   *
      *           may be used to complete transactions.               *
      *  237565 - On SR/WRITDA, move P#MDIN to MDIN when CEU006 is ON *
      *           Applied fix 225753                                  *
      *  237563 - Balance and projected account movements not updated *
      *           with the charges from a cheques to be paid.         *
      *           Set up the DR party account as the default charges  *
      *           account when field 'charges to the debit of' is     *
      *           left blank. Fix patterned on 205744.                *
      *  CDL049 - Addition of a Reference Rate field                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10652 - System failed to retrieve selected deal subtype.  *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3194 - Properly set-up parameters in calling AOSPOSU0 to  *
      *            update RSACTMTPD. (CRE020)                         *
      *  BUG3281 - Discrepancies on sources                           *
      *  CGL014 - Collaterals Processing                              *
      *  CLE025 - Credit Lines                                        *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  212014 - Debit Party set to 0000000000 when no RETAIL A/C    *
      *           Numbers used                                        *
      *  196947 - Database error in FT0080                            *
      *  CFT009 - Addition of fields for FT fees and charges          *
      *           Recompile                                           *
      *  179627 - Total remittance & Pay/Dlv amt on amend edited      *
      *           incorrectly                                         *
      *  179732 - Duplicate of 176510                                 *
      *           Incorporation of Profit Centre Default Matrix       *
      *           Improvements. Including fix 171061 - Pass Customer  *
      *           Account Officer To AOPRFMR0 and fix 171062 - Only   *
      *           Default from the matrix when remitting bank and     *
      *           rec. corr. has been validated.                      *
      *           Customer number has also been added to the matrix   *
      *           call.                                               *
      *           Use the Profit Centre defined for the accounts if   *
      *           a Nostro or Retail account                          *
      *  CGL007 - Account Postings Enquiry.                           *
      *  148229 - Changes to /COPY FT0010I001 (Recompile only)        *
      *  143962 - When CEU006 is on, total remittance must not be     *
      *           mandatory when pay delivery amount is inserted.     *
      *  140645 - Allow FX/change commission default to be            *
      *           overridden.                                         *
      *  141333 - Pay delivery currency not input capable in          *
      *         - amend mode.(Recompile only)                         *
      *  140648 - Default 'Commission tariff' on insert.              *
      *  CEU006 - EMU Funds Transfer Enhancements                     *
      *  125390 - Charges Currency was not formatted when ICD parameter
      *           BTCHCY='C'.                                         *
      *           Missing error                                       *
      *  112287 - If Rate calculed is LT 1 and rate entered is GT 1   *
      *           or vice versa, do not reverse Mult/Divide ind.      *
      *  120827 - Profit Centre Accounting defaulting                 *
      *  096486 - Previous Fix. 065890.                               *
      *           To enable user to enquire on FT payments for FT     *
      *           postings.                                           *
      *  S01408 - Addition of Core Hook FT0080CP24                    *
      *           Addition of Core Hook FT0080CP23                    *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           Enable F19 for Margin Information if Analytical     *
      *           Accounting is installed and debit/credit currencies *
      *           are different; change indicator 35 to be WIN35.     *
      *  101921 - On RISC system, the day number in the payment ref   *
      *           can contain leading blank instead of 0, e.g. P9604 9*
      *           instead of P960409, because alphanumeric char not   *
      *           converted to zoned numeric in I-specs.  Fix is to   *
      *           replace the blank with 0.                           *
      *  S01408 - Addition of core hook FT0080CCP1
      *           Addition of core hook FT0080CCP1
      *           Addition of core hook FT0080CCP2
      *           Addition of core hook FT0080CCP3
      *           Addition of core hook FT0080CCP4
      *           Addition of core hook FT0080CCP5
      *           Addition of core hook FT0080CCP6
      *           Addition of core hook FT0080CCP7
      *           Addition of core hook FT0080CCP8
      *           Addition of core hook FT0080CP10
      *           Addition of core hook FT0080CP11
      *           Addition of core hook FT0080CP12
      *           Addition of core hook FT0080CP13
      *           Addition of core hook FT0080CP14
      *           Addition of core hook FT0080CP15
      *           Addition of core hook FT0080CP16
      *           Addition of core hook FT0080CP17
      *           Addition of core hook FT0080CP18
      *           Addition of core hook FT0080CP19
      *           Addition of core hook FT0080CP20
      *           Addition of core hook FT0080CP21
      *           Addition of core hook FT0080CP22
      *  093958 - Payment input does not check against the payment    *
      *           type sub-type combination table                     *
      *  094278 - Allow SWIFT BIC in Remitting Bank field             *
      *  084663 - Complete the feature S01499 (move END condition)    *
      *  084499 - Access SDRETLPD only if RETAIL switched on.         *
      *  074810 - After chaining to MUSERDD, check if RECI = 'D'      *
      *  S01508 -  BLI Extended Payment Charges                       *
      *  S01499 -  BLI VAT Processing.                                *
      *         -  VAT flags should default to the value from FT0005  *
      *            if equal to blank.(TEMP19)                         *
      *         - Total charges plus V.A.T. amount should not exceed  *
      *           debit currency amount.(XEMP01)                      *
      *  S01494 -  BLI Funds Transfer Enhancements.                   *
      *         - If charge amount is equal to zero, display it       *
      *           as blank. (TEMP20)                                  *
      *         -  If the customer has changed, use default charges   *
      *            only if amount has not changed. (TEMP07)           *
      *         - Cheque amount must be converted to debit currency   *
      *           amount before passing to FT0320. (TEMP06)           *
      *  068347 -  Suppress Account movement duplicates.              *
      *  063767 - System will not allow amendment/deletion of an      *
      *           unauthorised cheque which was entered prior to      *
      *           today and will not allow COB to run until the       *
      *           unauthorised cheque has been amended/deleted.       *
      *           Apply 035406.                                       *
      *  056031 - Change processing for Shadow Post Update. Call new  *
      *           program AOSPOSU0. This now orders the updates in    *
      *           similar way to FX and MM.                           *
      *           Include primary transaction reference               *
      *           Call FT0005 to get FT Control Data                  *
      *           Fix covers errors 041693,045014,031876              *
      *  049117 - Amendment to charge fields not updating correctly.  *
      *  033361 - RACG field incorrectly output to CQPACDD record     *
      *           from prior read. Default to *BLANKS on write        *
      *  047179 - Allows input of a closed account in the charge      *
      *           account field when the value date is greater than   *
      *           the current processing date.                        *
      *  S01414 - Book Code and Profit Centre Incorporation.          *
      *  042167 - Include CL program to check for record locking      *
      *  050924 - Do not lock MMOD for update                         *
      *  004120 - Only update file (for amends) if any of the screen  *
      *           fields are changed. This is to prevent Last Change  *
      *           Type being 'A' for inserts when pgm returns from    *
      *           level 2 cheques maint in amend mode.                *
      *  035399 - If rate is invalid, previous rate is shown          *
      *  035398 - Right align central bank ref fields                 *
      *  035397 - UPDATE PRONO, MEMOS, OLPOS AND RSACMTPD WITH CHARGES*
      *           IF CDRO IS ENTERED.                                 *
      *  035390 - CNUMR FIELD NOT BEING RESET                         *
      *  E37264  -  CHARGES CALCULATION INCORRECT IF MAX = 0          *
      *  E37171  -  ADDRESS FIELD VALIDATION IS INCORRECT             *
      *  E36921  -  UPDATE USER FLAGS CORRECTLY ON FILES              *
      *  E32481  -  REMOVAL OF REDUNDANT FLAGS                        *
      *  E29994  -  COMMAND KEY FUNCTION ERRORS IN ENQUIRE MODE       *
      *  E29970  -  CMD 7 PROCESSING                                  *
      *  E29979  -  IF REMMITTING CHANGED AFTER ERROR ON SCR1 PROGRAM *
      *             COMPARES OLD RBK CNUM AGAINST SENDERS CORR CNUM   *
      *  E32880 - OUTPUT FULL REF TO RSACMTPD                         *
      *  E32859 - PAY VALUE DATE NOT BEING REJECTED FOR DATES         *
      *           LESS THAN CURRENT PROCESSING DATE                   *
      *  E32529 - Validation for settlement type 13 and remitting     *
      *           bank having to be a nostro is now redundant.        *
      *  E32543 - WARNING MESSAGE DISPLAYED IF DATE IS A HOLIDAY      *
      *           IN LOCAL CURRENCY                                   *
      *  E32776 - MOVE TEST OF CHEQUE AMOUNT = ZERO TO AFTER ZALIGN   *
      *  E32536 - IF UNALLOCATED NOSTRO NO 00 USED FOR PRONO UPDATE   *
      *           REINSTATE REAL NOSTRO NO FOR AMOVTS SR TO STOP      *
      *           DB ERROR IN NOSTRO FILE                             *
      *  E29832 - IF NO RBKT SET THEN ERROR AS FIELD IS NOW MANDATORY *
      *  E29828 - DEFAULT OF SRBK1 TO PCCY'01' NOSTRO IF SETTLEMENT   *
      *           TYPE 13 IS INCORRECT.                               *
      *  E29826 - INVALID CALCULATION OF CROSS CURRENCY RATES         *
      *  E29829 - PRONO UPDATE FOR HEADER USING SCREEN SENDERS        *
      *           CORRESPONDENT (SSNCO) - SHOULD BE USING NORMAL      *
      *           SENDERS CORRESPONDENT (SNCO) - FROM SAVHED DS       *
      *  E29531 - TEMPORARY CHANGE CONTROL FIX                        *
      *           FIELDS DRWDS DRW1-4 ARE IN THE INCORRECT            *
      *           DS AND THEREFORE DRW1 IS NOT UPDATED WHEN           *
      *           HEADER RECORD UPDATED                               *
      *  S01195 - NEW HOLIDAYS PROCESSING                             *
      *  S01194 - NEW STANDING DATA                                   *
      *  S01117 - MULTI-BRANCHING INCORPORATION                       *
      *  E23057 - VALIDATION ERROR - ERROR CODES 178, 250, 182        *
      *           ASSIGNED TO ERCD TWICE                              *
      *  E23146 - INSERTING CHEQUE AFTER EXITING CAUSES THE FIRST     *
      *           CHEQUE TO BE DISPLAYED WITH CHEQUE SEQUENCE 01      *
      *           WHILE SUBSEQUENT CHEQUES SHOW THE CORRECT VALUE.    *
      *  E22871 - CHEQUE AMOUNT OF ZERO IS BEING ALLOWED.             *
      *  E22952 - ON INPUT OF INDIVIDUAL CHEQUES THE SEQUENCE NO.     *
      *           IS NOT DISPLAYED.                                   *
      *  S01251 - SYNON FIELD/PROGRAM NAME CHANGES.                   *
      *  S01252 - ADDITIONAL SPARE WINDOW MANAGER PARAMETER.          *
      *           BLANK RETURN CODE                                   *
      *  E16366 - ENSURES CORRECT ERROR HELP TEXT IS PULLED UP WHEN   *
      *           ENTERING RATES.                                     *
      *  S01241 - WINDOW INCORPORATION                                *
      *  S01199 - HELP SYSTEM.                                        *
      *                                                               *
      *                                                               *
      *****************************************************************
     F/EJECT
      *****************************************************************
      *
      *     FUNCTION OF INDICATORS
      *     ----------------------
      *
      *   01     F3 WAS PRESSED
      *   04     F10 WAS PRESSED
      *   05     F12 WAS PRESSED
      *   07     F7 WAS PRESSED
      *   08     SWITCHABLE FEATURE S01499 IS SWITCHED ON                 S01499
      *   09     SWITCHABLE FEATURE S01494 IS SWITCHED ON                 S01494
      *   14     F10 IS ENABLED
      *   15     F12 IS ENABLED
      *   10     F7 IS ENABLED
      ****11*****ACTION CODE IS E                                   E29970S01494
      *   11     ACTION CODE IS E OR A                                    S01494
      *   16     ACTION CODE IS E                                         S01494
      *   17     CHEQUE DETAIL SCREEN                                     S01494
      *   18     USER NOT FOUND                                           S01494
      *   19     WARNING MESSAGE DATE IS A HOLIDAY                        E32543
      *   23     DEBIT VALUE DATE IS A HOLIDAY                            E32543
      *   20     CHANGE COMMISSION INVALID                                S01494
      *   21     F21 IS PRESSED FROM THE ENQUIRY SCREEN                   S01494
      *   22     FIRST TIME THROUGH FOR WARNING ERROR 19                  E32543
      ****24**** HELP IS ENABLED                                          S01199
      ****25     HELP WAS PRESSED                                         S01199
      *   26     PAY VALUE DATE IS A HOLIDAY                              E32543
      ****27*****WARNING MESSAGE DISPLAY INDICATOR                 E32543 S01499
      *   27     TOTAL VAT AMOUNT INDICATOR                               S01499
      *
      *   30     RETAIL ACCOUNT NUMBERS ARE SUPPORTED
      ****31**** ERRORS ON INITIAL SCREEN                                 S01414
      ****32**** ERRORS ON HEADER SCREEN                                  S01414
      ****33**** ERRORS ON DETAIL SCREEN                                  S01414
      *                                                                   S01414
      *      RELEASE 10 - BOOK CODES/PROFIT CENTRES                       S01414
      *                                                                   S01414
      *   25     Book Code field     - error/reverse image                S01414
      *   31     Profit Centre field - non display/protect                S01414
      *   32       "       "     "   - allow input                        S01414
      *   33       "       "     "   - error/reverse image                S01414
      *                                                                   S01414
      *      RELEASE 10 ADDITIONAL INDICATORS.                            S01117
      *                                                                   S01117
      *   34     PROTECT ORIGINATING BRANCH FIELD                         S01117
      ****35*****USED*FOR*LOAD*UP*OF*CCY*ARRAYS******************* S01194 CAC001
      *   35     ANALYTICAL ACCOUNTING MODULE IS SWITCHED ON              CAC001
      *   36     ORIGINATING BRANCH USED                                  S01117
      *   37     ORIGINATING BRANCH ERROR                                 S01117
      *   38     MULTIBRANCHING INDICATOR ON                              S01117
      *   39     BOOKING BRANCH ERROR                                     S01117
      *                                                                   S01117
      *      INITIAL SCREEN ERROR INDICATORS
      *
      *   40     ACTION CODE
      *   41     PAYMENT REFERENCE
      *   42     CHEQUE SEQUENCE
      *
      *      HEADER SCREEN ERROR INDICATORS
      *
      *   43     PAYMENT TYPE
      *   44     PAYMENT SUB-TYPE
      *   45     REMITTING BANK
      *   46     SENDER'S CORRESPONDENT
      *   47     PAY CURRENCY
      *   48     PAY VALUE DATE
      *   49     PROCEEDS REMITTED
      *   68     DIFFERENCE IS NON-ZERO
      *   69     WARNING ERROR FOR DESTINATION NOT SWIFT WITH SETT 08
      *   70     FIRST PASS OF WARNING ERROR 69
      *   50     TOTAL REMITTANCE
      *   51     CORRESPONDENT'S CHARGES
      *   52     DEDUCTIONS
      *   53     SETTLEMENT TYPE
      *   54     SWIFT PRIORITY CHARGE
      *   55     SEND MT202 INDICATOR
      *
      *      DETAIL SCREEN ERROR INDICATORS
      *
      *   56     DEBIT PARTY
      *   57     CHEQUE AMOUNT
      *   58     DEBIT CURRENCY
      *   59     DEBIT VALUE DATE
      *   60     RATE
      *   61     OVERRIDE
      *   62     TRANSFER COMMISSION TARIFF
      *   63     TRANSFER COMMISSION CHARGE
      *   64     COLLECTION CHARGE
      *   65     COSTS ABROAD CHARGE
      *   66     CHARGE TO DEBIT OF A/C
      *   67     CENTRAL BANK REFERENCE
      *
      *   68     SEE ABOVE
      *
      *   71     NON-DISPLAY FIELDS ON HEADER SCREEN
      *   72     PROTECT FIELDS ON INITIAL SCREEN
      *   73     PROTECT FIELDS ON HEADER SCREEN
      *   74     PROTECT FIELDS ON DETAIL SCREEN
      *   75     ERROR CODES 1
      *   76     ERROR CODES 2
      *   77     NON-DISPLAY PREVIOUS PAYMENT REFERENCE FIELDS
      *   79     PROTECT SETTLEMENT TYPE ON AMENDS
      *
      *   78     RECORD UPDATED BY ANOTHER WORKSTATION
      *
      *   80     LOOP CONTROL INDICATOR
      *   81     SUPRESS DETAIL SCREEN(S) IF F12 ON HEADER SCREEN
      *   82     LOOP CONTROL INDICATOR
      *
      *   83     WORK INDICATOR
      *   84     WORK INDICATOR
      ****85*****ACCOUNT NUMBER IS A NOSTRO                               056031
      *   86     LEVEL 2 ENTERED - PROTECT CURRENCY
      ****87*****RETAIL NOSTRO ON UPDATE OF RSACMTPD                      056031
      *   88     CHAIN FAIL TO TABLETJ(VALIDATION FOR RETAIL NOSTRO)
      *
      *   89     CHAIN FAIL
      *   99
      *
      *  U8 U7   DATABASE ERROR
      *   LR     END OF PROGRAM
      *
      ********************************************************************
     F/EJECT
     F********************************************************************
     FFT0080DFCF  E                    WORKSTN
     FCQPAC   UF  E           K        DISK                      A
     F                                              KCOMIT
     FCQPADZZ UF  E                    DISK
     F                                              KCOMIT
     FCQPACZZ UF  E                    DISK
     F                                              KCOMIT
     FFDDTSTL1IF  E           K        DISK                               093958
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*OLPOS***UF**E           K        DISK                              056031
     F************OLPOSHHF                          KIGNORE               056031
     F************OLPOSOBF                          KIGNORE               056031
     F************                                  KCOMIT                056031
     F*PRONO***UF**E           K        DISK                              056031
     F************PRONOHHF                          KIGNORE               056031
     F************                                  KCOMIT                056031
     F*MEMOS***UF**E                    DISK                              056031
     F************                                  KCOMIT                056031
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUMA  IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     F*CLINT**IF**E***********K********DISK                               S01194
     F************CLINTCAF*************             KIGNORE               S01194
     F************CLINTCCF*************             KIGNORE               S01194
     F************CLINTC1F*************             KIGNORE               S01194
     F*SNAME***IF**E***********K********DISK                              S01194
     F************CLINTCBF*************             KRENAMESNAMECBF       S01194
     F*TABFP***IF**E***********K********DISK                              S01194
     F************TABLETPF*************             KIGNORE               S01194
     F************TABLETRF*************             KIGNORE               S01194
     F************TABLETHF*************             KIGNORE               S01194
     F************TABTE10F*************             KIGNORE               S01194
     F*TABTB40*IF**E********************DISK                              S01194
     FSDMMODPDIF  E                    DISK                               S01241
     F*PYCHGDD*IF**E********************DISK                              S01194
     F*FPRTN***IF**E***********K********DISK                              S01194
     F************TABLETLF*************             KRENAMEFPRTNF         S01194
     FPYCHGDB IF  E           K        DISK                               S01117
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*RSACMTPDO***E                    DISK         KCOMIT               056031
     FMUSER   IF  E           K        DISK                               S01494
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
     FCQPADDL1IF  E           K        DISK                                                   CSD015
     F            CQPADDDF                          KRENAMECQPADWF                            CSD015
     FCQPACQL0UF  E           K        DISK                                                   CER049
      ** Stamp Tax Transaction Control Records                                                CER049
     F                                              KCOMIT                                    CER049
     FSDSTMDL0UF  E           K        DISK                      A                            CER049
      ** Stamp Tax Transaction History File                                                   CER049
     F                                              KCOMIT                                    CER049
     F/COPY WNCPYSRC,FT0080F001
      *                                                                                      CDL049
     FSDRRATPDIF  E                    DISK                                                  CDL049
      * Reference Rate Tolerance File                                                        CDL049
      *                                                                                      CDL049
     F/COPY FTCPYSRC,SFTSWFTF                                             094278
      *
     E                    CPY@    1   1 80
     E/EJECT
     E** ARRAY USED FOR ? PROCESSING                                      S01194
     E**********          FLDQ       10  1                                             S01194 CGL029
     E                    FLDQ       18  1                                                    CGL029
     E*                                                                   S01194
     E                    ZA1        16  1               ZALIGN SR. ARRAY
     E                    ZA2        16  1               ZALIGN SR. ARRAY
     E                    ERCD       38  4               ERROR CODE OUTPUT
     E                    DIG1       13  1               UNEDITED VALUE
     E                    DIG2       14  1               EDITED VALUE
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     E************        PDT         5  5 0A            PRONO DATES      056031
     E************        PNV         5 15 0A            PRONO BALANCES   056031
     E************        PNO         5 15 0A            PRONO BALS(OLD)  056031
     E************        OLD        16  5 0A            OLPOS DATES      056031
     E************        OIN        16 15 0A            OLPOS INCOMING   056031
     E************        OUT        16 15 0A            OLPOS OUTGOING   056031
      *
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    POWER   1   7  7 3             POWERS TABLE
     E                    FCTR    1   4  4 0             FACTORS TABLE
     E                    SWCH   47  47  1               SWFT SET
     E                    TST        35  1               WORK ARR
     E                    #FLD        1 35               WORK ARR
     E********************HCC        25  3               HOLIDAY ARRAY    S01195
     E                    CCYA      150  3  A            * CURRENCY CODES
     E                    CDPA      150  1 0             * CCY DEC. PLACES
     E                    SPTA      150 13 8             * SPOT RATE
     E                    MDA       150  1 0             * MUL/DIV IND.
     E                    C11        11  1                                035398
      *  Error texts                                                      056031
      *                                                                   056031
     E                    ERR@    1   1 80                                056031
      *                                                                   056031
      *  Subroutine stack                                                 056031
      *                                                                   056031
     E                    @STK       20 10                                056031
      *Error Indicators returned for FT0010                               CEU006
     E                    IND         5  1                                CEU006
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY FTCPYSRC,SFTSWFTE                                             094278
      *                                                                                       CSD015
      ** Array for XML tags                                                                   CSD015
     E                    XTAG    1  12 40                                                    CSD015
      ****************************************************************                        CSD015
      *                                                                                       CSD015
      ** Rename of CQPADDD Details to avoid overwriting                                       CSD015
      *                                                                                       CSD015
     ICQPADWF                                                                                 CSD015
     I              RECI                            WCRECI                                    CSD015
     I              PREF                            WCPREF                                    CSD015
     I              CQSQ                            WCCQSQ                                    CSD015
     I              DRPT                            WCDRPT                                    CSD015
     I              DRPY                            WCDRPY                                    CSD015
     I              CQAM                            WCCQAM                                    CSD015
     I              CQAMD                           WCCAMD                                    CSD015
     I              DRCY                            WCDRCY                                    CSD015
     I              RATE                            WCRATE                                    CSD015
     I              OVRD                            WCOVRD                                    CSD015
     I              DRVD                            WCDRVD                                    CSD015
     I              DRVDD1                          WCDDD1                                    CSD015
     I              DRVDD2                          WCDDD2                                    CSD015
     I              DRVDD3                          WCDDD3                                    CSD015
     I              DNBC                            WCDNBC                                    CSD015
     I              TRCT                            WCTRCT                                    CSD015
     I              TRCM                            WCTRCM                                    CSD015
     I              TRCMD                           WCTCMD                                    CSD015
     I              CSTA                            WCCSTA                                    CSD015
     I              CSTAD                           WCCTAD                                    CSD015
     I              COLL                            WCCOLL                                    CSD015
     I              COLLD                           WCCOLD                                    CSD015
     I              CDRT                            WCCDRT                                    CSD015
     I              CDRO                            WCCDRO                                    CSD015
     I              LCHT                            WCLCHT                                    CSD015
     I              LCD                             WCLCD                                     CSD015
     I              CHTP                            WCCHTP                                    CSD015
     I              OEDT                            WCOEDT                                    CSD015
     I              OEDTD1                          WCOED1                                    CSD015
     I              OEDTD2                          WCOED2                                    CSD015
     I              OEDTD3                          WCOED3                                    CSD015
     I              IACG                            WCIACG                                    CSD015
     I              PACG                            WCPACG                                    CSD015
     I              DRAG                            WCDRAG                                    CSD015
     I              DMSG                            WCDMSG                                    CSD015
     I              ADIN                            WCADIN                                    CSD015
     I              MDIN                            WCMDIN                                    CSD015
     I              SBCQ                            WCSBCQ                                    CSD015
     I              TRCH                            WCTRCH                                    CSD015
     I              COLH                            WCCOLH                                    CSD015
     I              CSTH                            WCCSTH                                    CSD015
     I              INUSR1                          WCIUS1                                    CSD015
     I              INUSR2                          WCIUS2                                    CSD015
     I              BRCA                            WCBRCA                                    CSD015
     I              ORBR                            WCORBR                                    CSD015
     I              DRBR                            WCDRBR                                    CSD015
     I              CDBR                            WCCDBR                                    CSD015
     I              BOKC                            WCBOKC                                    CSD015
     I              PRFC                            WCPRFC                                    CSD015
     I              PDDRAM                          WCPRAM                                    CSD015
     I              PDVAT1                          WCPVA1                                    CSD015
     I              PDVAT2                          WCPVA2                                    CSD015
     I              PDVAT3                          WCPVA3                                    CSD015
     I              PDVAT4                          WCPVA4                                    CSD015
     I              PDCHCM                          WCPCHM                                    CSD015
     I              PDVATT                          WCPVAT                                    CSD015
     I              PDCHCH                          WCPCHC                                    CSD015
     I              PDVATH                          WCPDVH                                    CSD015
     I              PDVATR                          WCPDVR                                    CSD015
     I              FXMP                            WCFXMP                                    CSD015
     I              FXMD                            WCFXMD                                    CSD015
     I              MBSI                            WCMBSI                                    CSD015
     I              MSIG                            WCMSIG                                    CSD015
     I              MAMT                            WCMAMT                                    CSD015
     I              NDCY                            WCNDCY                                    CSD015
     I              NDAM                            WCNDAM                                    CSD015
     I              TFCMCC                          WCCMCC                                    CSD015
     I              FCHCCC                          WCCHCC                                    CSD015
     I              CSTACD                          WCTACD                                    CSD015
     I              COLCGC                          WCLCGC                                    CSD015
     I              APVTCC                          WCVTCC                                    CSD015
     I              CPCHRT                          WCCHRT                                    CSD015
     I              CPCHGC                          WCCHGC                                    CSD015
      *                                                                   CEU006
      ** Message file name                                                CEU006
      *                                                                   CEU006
     I              'FTUSRMSG  '          C         MSGFIL                CEU006
      *                                                                   CEU006
     I** RENAME OF CQPACDD AND CQPADDD BOOKING BRANCH FIELD TO AVOID      S01117
     I** CORRUPTION FROM ACCNT ETC                                        S01117
     I*                                                                   S01117
     ICQPADDDF                                                            S01117
     I              BRCA                            BRCH                  S01117
     I*                                                                   S01414
     I* Rename of CqpaCdd (Header) Book Code & Profit Centre to avoid     S01414
     I* overwriting from CqpaDdd.                                         S01414
     I*                                                                   S01414
     ICQPACDDF                                                            S01117
     I              BRCA                            BRCH                  S01117
     I              BOKC                            HBOKC                 S01414
     I              PRFC                            HPRFC                 S01414
     I*                                                                   S01414
     I* Rename of ACCNT/ACNUMA Profit Centre to avoid overwriting         S01414
     I*                                                                   S01414
     IACCNTABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01414
     IACNUMABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01494
     I** RENAME FIELDS TO PREVENT OVERLAPPING                             S01494
     I*                                                                   S01494
     IMUSERDDF                                                            S01494
     I              RECI                            MRECI                 S01494
     I              DPPT                            MDPPT                 S01494
     I              LCD                             MLCD                  S01494
     I              CHTP                            MCHTP                 S01494
     I*                                                                   S01414
     I*                                                                   S01117
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/EJECT
     I***PRONOPNF
     IPSDS       SDS
     I                                        1  10 ##PGM                 CEU006
     I                                      244 253 WSID
     I                                      254 263 USRID
     I/COPY WNCPYSRC,FT0080I005
     I*
     IDLDA        DS                            256
     I************                          134 138 DBFILE                S01194
     I************                          139 167 DBKEY                 S01194
     I************                          168 175 DBPGM                 S01194
     I************                          176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*
     IMMOD        DS                            256
     I                                        2   2 DLIND
     I                                        3   3 RTIND
     I                                       16  16 REIND
     I*
     ICQPAYD      DS                              4
     I*        DS TO OBTAIN EXTERNAL SEQUENCE NUMBER
     I*
     I                                        1   40SEQNO
     I*                                                                   S01494
     I** DEFINE FIELDS FOR MESSAGE TRANSLATION                            S01494
     I*                                                                   S01494
     IDSMTR       DS                                                      S01494
     I                                        1 132 #MSDTA                S01494
     I                                       15  30 #MPREF                S01494
     I                                    P   1   20#MPART                S01494
     I                                      133 264 #MSTX1                S01494
     I#MSTX2      DS                                                      S01494
     I                                        1 256 #MSTXA                S01494
     I                                      257 512 #MSTXB                S01494
     I**
     I*    COMMITTMENT CONTROL TEXT - FOR HEADER
     I**
     ICMTXTH      DS
     I                                        1   50TIMEXH
     I                                        6   7 MDIDH
     I                                        8  15 PGMNH
     I                                       16  18 WSIDH
     I                                       19  240TIMEH
     I                                       25  25 ACTDH
     I                                       26  35 USRIDH
     I*
     I                                       51  51 SACTD
     I                                       52  66 SPREF
     I                                       67  68 SCQSQ
     I                                       69  70 SPYTP
     I                                       71  72 SPYST
     I                                       73 212 SRBANK
     I                                       73 107 SRBK1
     I                                      108 142 SRBK2
     I                                      143 177 SRBK3
     I                                      178 212 SRBK4
     I                                      213 222 SSNCO
     I                                      223 225 SPCCY
     I                                      226 231 SPYDT
     I                                      232 245 SPRRM
     I                                      246 259 STOTR
     I                                      260 271 SCOCH
     I                                      272 283 SDEDS
     I                                      284 285 SSTTP
     I**************************************286 287 SSWPC                 S01117
     I**************************************288 288 SSNMT                 S01117
     I                                      286 286 SSWPC                 S01117
     I                                      287 287 SSNMT                 S01117
     I                                      288 289 SHBOKC                S01414
     I                                      290 293 SHPRFC                S01414
     I                                      294 294 SCVAT1                S01499
     I                                      295 295 SCVAT2                S01499
     I                                      296 298 SPDCY                 CEU006
     I                                      299 312 SPDAM                 CEU006
     I***************************************51 287 SCRVAL          004120S01414
     I***************************************51 293 SCRVAL          S01414S01499
     I                                       51 295 SCRVAL                S01499
     I                                      296 312 SCRVA2                CEU006
     I**
     I*    COMMITTMENT CONTROL TEXT - FOR DETAIL
     I**
     ICMTXTD      DS
     I                                        1   50TIMEXD
     I                                        6   7 MDIDD
     I                                        8  15 PGMND
     I                                       16  18 WSIDD
     I                                       19  240TIMED
     I                                       25  25 ACTDD
     I                                       26  35 USRIDD
     I*
     I**********                             51  62 SDRPY                                     CGL029
     I                                       51  62 QQDRPY                                    CGL029
     I                                       63  76 SCQAM
     I                                       77  79 SDRCY
     I                                       80  85 SDRVD
     I                                       86  99 SRATE
     I                                      100 100 SOVRD
     I                                      101 101 STRCT
     I                                      102 113 STRCM
     I                                      114 125 SCLCH
     I                                      126 137 SCSTA
     I**********                            138 149 SCDRO                                     CGL029
     I                                      138 149 QQCDRO                                    CGL029
     I                                      150 160 SDNBC
     I                                      161 162 SBOKC                 S01414
     I                                      163 166 SPRFC                 S01414
     I                                      167 178 SCHCM                 S01494
     I                                      179 179 SVATI1                S01499
     I                                      180 180 SVATI2                S01499
     I                                      181 181 SVATI3                S01499
     I                                      182 182 SVATI4                S01499
     I                                      183 185 SNDCY                 CEU006
     I                                      186 199 SNDAM                 CEU006
     I                                      200 217 SDRPY                                     CGL029
     I                                      218 235 SCDRO                                     CGL029
     I            DS
     I* REMITTING BANK CAN BE A FULL NOSTRO OR A CUSTOMER NUMBER OR A
     I*   OR A SHORTNAME OR A RETAIL NUMBER OR A FULL ACCOUNT NUMBER
     I*   THIS DS IS TO SPLIT IT UP TO FACILITATE VALIDATION
     I*
     I                                        1  35 SRBK1X
     I                                        1   3 RCCYN
     I                                        1   5 RNOST
     I                                        4   5 RNOSN                 S01194
     I                                        5   5 RNOSTL
     I                                        6  35 RNOSTR
     I**********                              1   60RCUST                                    CSD027A
     I                                        1   6 RCUST                                    CSD027A
     I                                        1   6 RCUSTA
     I                                        6   6 RCUSTL
     I                                        7  35 RCUSTR
     I                                        1  10 RSNME
     I                                       11  35 RSNMER
     I                                        1  100RRETL
     I                                       10  10 RRETLL
     I************                            1  15 RACNT                 S01117
     I**********                              1  18 RACNT                              S01117 CGL029
     I                                        1  24 RACNT                                     CGL029
     I                                        7   9 RCCYG
     I**********                             15  15 RACNTL                                    CGL029
     I**********                             16  35 RACNTR                                    CGL029
     I**********                             19  35 RACNTM                             S01117 CGL029
     I                                       21  21 RACNTL                                    CGL029
     I                                       22  35 RACNTR                                    CGL029
     I                                       25  35 RACNTM                                    CGL029
     I            DS
     I* DS TO CHECK IF SENDER'S CORRESPONDENT IS A NOSTRO NUMBER
     I*
     I                                        1  10 SSNCOX
     I                                        1   2 SSNCO2
     I                                        3  10 SSNCO8
     I            DS
     I* DEBIT PARTY CAN BE A NOSTRO NUMBER OR A RETAIL NUMBER OR A
     I*   PARTIAL ACCOUNT NUMBER - DS TO SPLIT UP FOR VALIDATION
     I*
     I**********                              1  12 SDRPYX                                    CGL029
     I                                        1  18 SDRPYX                                    CGL029
     I                                        1   20DNOST
     I                                        1   2 DNOSTA
     I**********                              3  12 DNOSTR                                    CGL029
     I                                        3  18 DNOSTR                                    CGL029
     I                                        1  100DRETL
     I                                        1  10 DRETLA
     I**********                             11  12 DRETLR                                    CGL029
     I                                       11  18 DRETLR                                    CGL029
     I**********                              1   60DCUST                                    CSD027A
     I                                        1   6 DCUST                                    CSD027A
     I                                        7  160DACOD                                     CGL029
     I                                       17  180DACSQ                                     CGL029
     I                                       17  18 DACSQA                                    CGL029
     I**********                              7  100DACOD                                     CGL029
     I**********                             11  120DACSQ                                     CGL029
     I**********                             11  12 DACSQA                                    CGL029
     I            DS
     I* CHARGES TO THE DEBIT OF CAN BE A NOSTRO NUMBER OR A RETAIL NUMBER
     I*   OR A PARTIAL ACCOUNT NUMBER - DS TO SPLIT UP FOR VALIDATION
     I*
     I**********                              1  12 SCDROX                                    CGL029
     I                                        1  18 SCDROX                                    CGL029
     I                                        1   20CNOST
     I                                        1   2 CNOSTA
     I**********                              3  12 CNOSTR                                    CGL029
     I                                        3  18 CNOSTR                                    CGL029
     I                                        1  100CRETL
     I                                        1  10 CRETLA
     I**********                             11  12 CRETLR                                    CGL029
     I                                       11  18 CRETLR                                    CGL029
     I**********                              1   60CCUST                                    CSD027A
     I                                        1   6 CCUST                                    CSD027A
     I                                        7  160CACOD                                     CGL029
     I                                       17  180CACSQ                                     CGL029
     I                                       17  18 CACSQA                                    CGL029
     I**********                              7  100CACOD                                     CGL029
     I**********                             11  120CACSQ                                     CGL029
     I**********                             11  12 CACSQA                                    CGL029
     I*
     I            DS
     I*     DATA STRUCTURE REDEFINING ADDRESS  FIELDS
     I*
     I                                        1 175 ADDRSS
     I                                        1  35 ADCHK1
     I                                       36  70 ADCHK2
     I                                       71 105 ADCHK3
     I                                      106 140 ADCHK4
     I                                      141 175 ADCHK5
     I            DS
     I* DS TO OBTAIN SEPARATE CNUM/CCY/ACOD/ACSQ FROM SINGLE INPUT
     I*
     I****************                        1  15 ACNTKY                S01117
     I**********                              1  18 ACNTKY                             S01117 CGL029
     I                                        1  24 ACNTKY                                    CGL029
     I**********                              1   60ACNTCN                                    CSD027
     I                                        1   6 ACNTCN                                    CSD027
     I                                        1   6 ACNCNA                S01117
     I                                        7   9 ACNTCY
     I                                       10  190ACNTAC                                    CGL029
     I                                       10  19 ACNACA                                    CGL029
     I                                       20  21 ACNASA                                    CGL029
     I                                       20  210ACNTAS                                    CGL029
     I                                       22  24 ACNTBR                                    CGL029
     I**********                             10  130ACNTAC                                    CGL029
     I**********                             10  13 ACNACA                             S01117 CGL029
     I**********                             14  15 ACNASA                             S01117 CGL029
     I**********                             14  150ACNTAS                                    CGL029
     I**********                             16  18 ACNTBR                             S01117 CGL029
     ICQPKEY      DS
     I* DS TO SET UP LF/CQPAC KEY TO REPORT CHAIN FAIL
     I*
     I                                        1  15 PREFKY
     I                                       16  170CQSQKY
      *
     I*CLTKEY******DS
     I**DS*TO*SET*UP*LF/CLINT*KEY*TO*REPORT*CHAIN*FAIL***                 S01194
     I*************                                                       S01194
     I*************                           1   60CNUMKY                S01194
     I*************                           7   7 CLINTA                S01194
     I*                                                                   S01194
     I            DS                                                      S01194
     I** DS TO DEFINE ALPHA CUSTOMER NUMBER FIELD                         S01194
     I**********                              1   60CNUM                               S01194 CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        1   6 CNUMA                 S01194
     I            DS
     I* DS TO SET UP ERROR MESSAGE FOR CHAIN FAIL
     I*
     I                                        1  32 ERRMSG
     I                                        1   8 ERMSG1
     I                                        9  16 ERMSG2
     I                                       17  24 ERMSG3
     I                                       25  32 ERMSG4
     I            DS
     I* DS USED IN SETTING UP KEY FOR CHAIN TO LF/TABFP
     I*
     I                                        1  12 ZTABKY
     I                                        1   2 ZTAB01
     I                                        7  11 ZTAB07
     I                                        8  10 ZTAB08
     I                                        9  11 ZTAB09
     I                                       11  12 ZTAB11
     I                                       12  12 ZTAB12
      *
     IPREFPG      DS
     I* DS USED IN SETTING PAYMENT REFERENCE
     I*
     I                                        1   1 P
     I                                        2   30EDATYY
     I                                        4   50EDATMM
     I                                        6   70EDATDD
     I                                        8  110SEQNOX
     I                                       12  13 CP
     I                                       14  150STTPPG
     I***                                     3   40EDATMM
      *
     I************DS                                                      S01194
     I**DS*USED*TO*SPLIT*UP*RUNA*TO*GET*DATE*IN*YYMMDD*FORMAT****         S01194
     I************                                                        S01194
     I************                            1   7 RUNA                  S01194
     I************                            1   20RUNAD                 S01194
     I************                            3   5 RUNAM                 S01194
     I************                            6   70RUNAY                 S01194
     I            DS
     I* DS USED TO SPLIT UP DATE FOR REFORMATTING FOR DAF
     I*
     I                                        1   60DAFDIN
     I                                        1   2 DAFDI1
     I                                        3   4 DAFDI2
     I                                        5   6 DAFDI3
     I            DS
     I* DS USED FOR REFORMATTING DATE FOR DAF
     I*
     I                                        1   60DAFDOT
     I                                        1   2 DAFDO1
     I                                        3   4 DAFDO2
     I                                        5   6 DAFDO3
      *
      ** Define data structures to save contents of SAVHED.
     I*SAVEH1******DS                            304                      E29531
     I*SAVEH2******DS                            304                      E29531
     I*SAVEH1******DS                            445                E29531S01414
     I*SAVEH2******DS                            445                E29531S01414
     I***SAVEH1******DS                            451              S01414S01499
     I***SAVEH2******DS                            451              S01414S01499
     I***SAVEH1******DS                            477              S01499CEU006
     I***SAVEH2******DS                            477              S01499CEU006
     ISAVEH1      DS                            487                       CEU006
     ISAVEH2      DS                            487                       CEU006
      *
     ISAVHED      DS
     I*
     I*    SAVE HEADER DETAILS
     I                                        1   1 RECI
     I                                        2  16 PREF
     I                                       17  180CQSQ
     I                                       19  20 PYTP
     I                                       21  22 PYST
     I                                       23 163 RBKDS
     I                                       23  23 RBKT
     I                                       24  58 RBK1
     I                                       59  93 RBK2
     I                                       94 128 RBK3
     I                                      129 163 RBK4
     I                                      164 164 SNCT
     I**********                            165 1740SNCO                                      CSD027
     I                                      165 174 SNCO                                      CSD027
     I                                    P 175 1810TOTR
     I                                    P 182 1892TOTRD
     I                                    P 190 1960TOTD
     I                                    P 197 2042TOTDD
     I                                    P 205 2110DIFF
     I                                    P 212 2192DIFFD
     I                                      220 222 PCCY
     I                                    P 223 2250PVDT
     I                                      226 2310PVDTD1
     I                                      232 2330PVDTD2
     I                                      234 2390PVDTD3
     I                                      240 2410STMT
     I                                      242 242 SNMT
     I                                    P 243 2490PRRM
     I                                    P 250 2572PRRMD
     I                                      258 2590SWPC
     I                                    P 260 2650COCH
     I                                    P 266 2732COCHD
     I                                    P 274 2790DEDS
     I                                    P 280 2872DEDSD
     I                                    P 288 2900OEDT
     I                                      291 2960OEDTD1
     I                                      297 2980OEDTD2
     I                                      299 3040OEDTD3
     I                                      305 445 DRWDS                 E29531
     I                                      305 305 DRWT                  E29531
     I                                      306 340 DRW1                  E29531
     I                                      341 375 DRW2                  E29531
     I                                      376 410 DRW3                  E29531
     I                                      411 445 DRW4                  E29531
     I                                      446 447 HBOKC                 S01414
     I                                      448 451 HPRFC                 S01414
     I                                    P 452 4570PCVATC                S01499
     I                                    P 458 4630PCVATD                S01499
     I                                      464 464 PCVAT1                S01499
     I                                      465 465 PCVAT2                S01499
     I                                    P 466 4717PCVTRC                S01499
     I                                    P 472 4777PCVTRD                S01499
     I                                      478 480 PDCY                  CEU006
     I                                    P 481 4870PDAM                  CEU006
      *
      ** Define data structures to save contents of SAVHED.
     I*SAVDTA******DS***                         314                      S01117
     I*SAVDTB******DS***                         314                      S01117
     I*SAVDTA******DS***                         179                S01117S01414
     I*SAVDTB******DS***                         179                S01117S01414
     I*SAVDTA******DS***                         185                S01414049117
     I*SAVDTB******DS***                         185                S01414049117
     I***SAVDTA******DS                            206              049117S01499
     I***SAVDTB******DS                            206              049117S01499
     I***SAVDTA******DS                            242              S01499CEU006
     I***SAVDTB******DS                            242              S01499CEU006
     I***SAVDTA*     DS                            252                                 CEU006 CGL029
     I***SAVDTB*     DS                            252                                 CEU006 CGL029
     ISAVDTA      DS                            288                                           CGL029
     ISAVDTB      DS                            288                                           CGL029
     ISAVDET      DS
     I*
     I*    SAVE CHEQUE DETAILS
     I                                        1   1 RECID
     I                                    P 115 1200COLL
     I                                    P 121 1282COLLD
     I                                        2  16 PREFD
     I                                       17  180CQSQD
     I                                       19  19 DRPT
     I**********                             20  310DRPY                                      CGL029
     I                                       20  310DRPYQQ                                    CGL029
     I                                    P  32  380CQAM
     I                                    P  39  462CQAMD
     I                                       47  49 DRCY
     I                                    P  50  568RATE
     I                                       57  57 OVRD
     I                                    P  58  600DRVD
     I                                       61  660DRVDD1
     I                                       67  680DRVDD2
     I                                       69  740DRVDD3
     I/COPY WNCPYSRC,FT0080I006
     I                                       75  850DNBC
     I/COPY WNCPYSRC,FT0080I007
     I                                       86  86 TRCT
     I                                    P  87  920TRCM
     I                                    P  93 1002TRCMD
     I                                    P 101 1060CSTA
     I                                    P 107 1142CSTAD
     I                                      129 129 CDRT
     I**********                            130 1410CDRO                                      CGL029
     I                                      130 1410CDROQQ                                    CGL029
     I                                      142 1470LCHT
     I                                    P 148 1500LCD
     I                                      151 151 CHTP
     I                                      169 169 IACG
     I                                      170 170 PACG
     I                                      171 171 DRAG
     I                                      172 172 DMSG
     I                                      173 173 ADIN
     I************                          174 314 DRWDS                 E29531
     I************                          174 174 DRWT                  E29531
     I************                          175 209 DRW1                  E29531
     I************                          210 244 DRW2                  E29531
     I************                          245 279 DRW3                  E29531
     I************                          280 314 DRW4                  E29531
     I                                      174 176 CDBR                  S01117
     I                                      177 179 DRBR                  S01117
     I                                      180 181 BOKC                  S01414
     I                                      182 185 PRFC                  S01414
     I                                    P 186 1920TRCH                  049117
     I                                    P 193 1990COLH                  049117
     I                                    P 200 2060CSTH                  049117
     I                                    P 207 2120PDCHCM                S01494
     I                                    P 213 2190PDCHCH                S01494
     I                                    P 220 2250PDVATT                S01499
     I                                    P 226 2320PDVATH                S01499
     I                                      233 233 PDVAT1                S01499
     I                                      234 234 PDVAT2                S01499
     I                                      235 235 PDVAT3                S01499
     I                                      236 236 PDVAT4                S01499
     I                                    P 237 2427PDVATR                S01499
     I                                      243 245 NDCY                  CEU006
     I                                    P 246 2520NDAM                  CEU006
     I************                          253 2700DRPY                               CGL029 CSD027
     I************                          271 2880CDRO                               CGL029 CSD027
     I                                      253 270 DRPY                                      CSD027
     I                                      271 288 CDRO                                      CSD027
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     I*ZZ039*******DS                                                     056031
     I************    SHADOW BALANCES RECORD HOLDS ALL DATA AS ONE FIELD  056031
     I***AND*SO*NEED TO BE SPLIT UP TO ACCESS CLEARED AND LEDGER BALANCES 056031
     I************                                                        056031
     I************                            1  150LDBLN                 056031
     I************                           16  300CLBLN                 056031
     I*ODT*********DS                                                     056031
     I**DS*USED*TO SPLIT OLPOS DATE FIELD INTO ARRAY ELEMENTS             056031
     I************                                                        056031
     I************                        P   1  480OLD                   056031
     I*OFI*********DS                                                     056031
     I**DS*USED*TO SPLIT OLPOS INCOMING AMOUNT FIELD INTO ARRAY ELEMENTS  056031
     I************                                                        056031
     I************                        P   1 1280OIN                   056031
     I*OFO*********DS                                                     056031
     I**DS*USED*TO SPLIT OLPOS OUTGOING AMOUNT FIELD INTO ARRAY ELEMENTS  056031
     I************                                                        056031
     I************                        P   1 1280OUT                   056031
     I*PND*********DS                                                     056031
     I**DS*USED*TO SPLIT PRONO DATE FIELD INTO ARRAY ELEMENTS             056031
     I************                                                        056031
     I************                        P   1  150PDT                   056031
     I*PNB*********DS                                                     056031
     I**DS*USED*TO SPLIT OLPOS BALANCE FIELD INTO ARRAY ELEMENTS          056031
     I************                                                        056031
     I************                        P   1  400PNV                   056031
     I*
     I*     DATA AREA TO REDEFINE RETAIL NOSTRO FIELD
     I*
     IRTNO        DS
     I**********                              1   60CNUMN                                    CSD027A
     I                                        1   6 CNUMN                                    CSD027A
     I                                        7  160ACODNP                                    CGL029
     I                                       17  180ACSQNP                                    CGL029
     I                                       19  21 BRCANP                                    CGL029
     I                                        1  100ACNON
     I                                        7   9 CCYN
     I                                       10  190ACODN                                     CGL029
     I                                       20  210ACSQN                                     CGL029
     I                                       22  24 BRCAN                                     CGL029
     I**********                              7  100ACODNP                                    CGL029
     I**********                             11  120ACSQNP                                    CGL029
     I**********                             13  15 BRCANP                             S01117 CGL029
     I**********                             10  130ACODN                                     CGL029
     I**********                             14  150ACSQN                                     CGL029
     I**********                             16  18 BRCAN                              S01117 CGL029
     I*
      *
     I****Data*structure*to*redefine*allowed*%*discrepancy*as*rate.*      S01194
     I************DS                                                      S01194
     I************                        P   1   32PRTDIS                S01194
     I************                        P   1   34RATDIS                S01194
     I/COPY WNCPYSRC,FT0080I001
      *
      **  Data structure to rename Entry currency for multiple displays
      **      on same format .
     ICHCCY       DS
     I                                        1   3 CHCCY2
     I                                        1   3 CHCCY3
     I                                        1   3 CHCCY4
     I                                        1   3 CHCCY5                S01494
     I                                        1   3 CHCCY6                S01499
     ISCGCY       DS
     I                                        1   3 SCGCY2
     I                                        1   3 SCGCY3
     I                                        1   3 SCGCY4
     I                                        1   3 SCGCY5                S01494
     I                                        1   3 SCGCY6                S01499
     I************                                                        S01194
     I******DATA*STRUCTURE*TO*SUB*DIVIDE*TABLE*KEY*FIELD*-*TABTG20***     S01194
     I************                                                        S01194
     I************DS                                                      S01194
     I************                            1  12 KEY                   S01194
     I************                            1   2 RECTTB                S01194
     I************                            9  11 CCYTB                 S01194
     I************                           12  12 SRECTB                S01194
      *
     I*                                                                   S01194
     I** DATASTRUCTURE TO REDEFINE NOSTRO NO AS CHAR FOR NEW SD           S01194
     I            DS                                                      S01194
     I                                        1   20NOSN                  S01194
     I                                        1   2 NOSNA                 S01194
     I** HOLIDAY PROCESSING DS                                            S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01195
     I*                                                                   S01117
     I** DATASTRUCTURE TO DEFINE MB INDICATOR FROM DATAAREA RUNDAT        S01117
     I*                                                                   S01117
     IRUNDAT      DS                             13                       S01117
     I                                       13  13 @MBIN                 S01117
     I*                                                                   S01117
     I** DATASTRUCTURE TO DEFINE DEFAULT BRANCH FROM USER DATAAREA        S01117
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I                                       11  13 @DFBR                 S01117
     I                                       14  16 DPPT                  S01414
      *                                                                   056031
      *  Send message data structure                                      056031
      *                                                                   056031
     IDBDTA       DS                                                      056031
     I                                        1  10 @BPGM                 056031
     I                                       11  20 @BFILE                056031
     I                                       21  50 @BKEY                 056031
     I                                       51  550@BERNB                056031
     I                                       56 135 @BNARR                056031
     I                                      136 145 @BSTK                 056031
     I                                      146 175 @BPREF                056031
      *                                                                   056031
      *  Calling parameter data structure for AOSPOSU0                    056031
      *                                                                   056031
     IC#DTA       DS                            256                       056031
     I                                        1   1 C#ATYP                056031
     I**********                              2  19 C#ACCT                             056031 CGL029
     I                                        2  19 QQACCT                                    CGL029
     I**********                              2   70C#CNU1                            056031 CSD027A
     I                                        2   7 C#CNU1                                   CSD027A
     I                                        8  10 C#CCY1                056031
     I**********                             11  140C#ACO1                             056031 CGL029
     I                                       11  140QQACO1                                    CGL029
     I                                       15  160C#ACS1                056031
     I                                       17  19 C#BRC1                056031
     I                                        2   30C#NOSN                056031
     I                                        2   6 C#NOS                 056031
     I                                        2  110C#ACNO                056031
     I**********                              2   70C#CNUM                            056031 CSD027A
     I                                        2   7 C#CNUM                                   CSD027A
     I**********                              8  110C#ACOD                             056031 CGL029
     I                                        8  110QQACOD                                    CGL029
     I                                       12  130C#ACSQ                056031
     I                                       14  16 C#BRCA                056031
     I                                       24  24 C#IO                  056031
     I                                       25  27 C#CCY                 056031
     I                                       28  29 C#TRYP                056031
     I                                       30  59 C#NARR                056031
     I                                       60  670C#CHQN                056031
     I                                       68  82 C#PREF                056031
     I                                       83  88 C#TRN                 056031
     I                                    P  89  960C#AMT                 056031
     I                                       97  97 C#PRON                056031
     I                                       98  98 C#OLPS                056031
     I                                       99  99 C#MEMS                056031
     I                                      100 100 C#RSAC                056031
     I                                      101 102 C#MOD                 056031
     I                                      103 104 C#OLRC                056031
     I                                      105 105 C#FTOV                056031
     I                                    P 106 1080C#VDAT                056031
     I                                    P 109 1110C#PSTD                056031
     I                                      112 112 C#PSTO                056031
     I                                      113 113 C#RPST                068347
     I                                      114 1160C#RPNB                068347
     I                                      117 117 C#RTYP                068347
     I                                      121 1300C#ACO1                                    CGL029
     I                                      131 1400C#ACOD                                    CGL029
     I                                      141 160 C#OTR1                                    CAP204
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
      *                                                                                       CGL029
     I            DS                                                                          CGL029
     I                                        1  24 C#ACCT                                    CGL029
     I**********                              1   60W#CNU1                            CGL029 CSD027A
     I                                        1   6 W#CNU1                                   CSD027A
     I                                        7   9 W#CCY1                                    CGL029
     I                                       10  190W#ACO1                                    CGL029
     I                                       20  210W#ACS1                                    CGL029
     I                                       22  24 W#BRC1                                    CGL029
     I/COPY WNCPYSRC,FT0080I008
      *                                                                   056031
      *  Calling parameter data structure for AOCCYCV0                    056031
      *                                                                   056031
     ID#DTA       DS                            256                       056031
      *                                       From Currency & amount      056031
     I                                        1   3 D#FCCY                056031
     I                                    P   4  110D#FAMT                056031
      *                                       To Currency & amount        056031
     I                                       12  14 D#TCCY                056031
     I                                    P  15  220D#TAMT                056031
      *                                       Rate and multi/div ind.     056031
     I                                       23  23 I#MDIN                056031
     I                                    P  24  368I#RATE                056031
      *                            Output     Rate and multi/div ind.     056031
      *                                       If no in rate               056031
     I                                       37  37 O#MDIN                056031
     I                                    P  38  508O#RATE                056031
      *                                                                   056031
      *  Input parameters data structure from FT0005                      056031
      *                                                                   056031
     IC#CNTL      DS                            256                       056031
     I                                        1   1 C#PDTI                056031
     I                                        2   3 C#CCYI                056031
     I                                        4   4 C#GLUI                056031
     I                                        5   5 C#TPCI                056031
     I                                        6   6 C#VATT                S01499
     I*                                                                   S01499
     I** V.A.T. rate                                                      S01499
     I*                                                                   S01499
     IVATDS       DS                                                      S01499
     I                                        1   3 I#BRCA                S01499
     I                                        4   9 I#CUST                S01499
     I                                    P  10  124O#VATR                S01499
     I*                                                                   S01508
     IW0DTA       DS                            256                       S01508
     I*                                                                   S01508
     I**  Calling parameter data structure for FT0035                     S01508
     I*                                                                   S01508
     I                                        1   1 I#PT1                 S01508
     I                                        2  36 I#PTY1                S01508
     I                                       37  37 I#PT2                 S01508
     I                                       38  72 I#PTY2                S01508
     I                                       73  75 I#CCY                 S01508
     I                                       76  81 O#CUST                S01508
     I*                                                                   S01508
     I/COPY WNCPYSRC,FT0080I002
     I***W7DATA******DS                            310              S01508CEU006
     IW7DATA      DS                            321                       CEU006
     I/COPY WNCPYSRC,FT0080I003
     I*                                                                   S01508
     I**  Payment type and subtype                                        S01508
     I                                        1   2 W7PYTP                S01508
     I                                        3   4 W7PYST                S01508
     I*                                                                   S01508
     I**  Input currency and charge currency                              S01508
     I                                        5   7 W7ICCY                S01508
     I                                        8  10 W7CCCY                S01508
     I*                                                                   S01508
     I**  Settlement method                                               S01508
     I                                       11  12 W7STMT                S01508
     I*                                                                   S01508
     I**  Defaults required                                               S01508
     I                                       13  13 W7DFRQ                S01508
     I*                                                                   S01508
     I**  Charges branch                                                  S01508
     I                                       14  16 W7BRCA                S01508
     I*                                                                   S01508
     I**  Charge currency amount                                          S01508
     I                                       17  290W7CAMT                S01508
     I*                                                                   S01508
     I**  Transfer Commission type                                        S01508
     I                                       30  30 W7TRCT                S01508
     I*                                                                   S01508
     I**  SWIFT priority code                                             S01508
     I                                       31  31 W7SWPC                S01508
     I*                                                                   S01508
     I**  Transfer Commission amount                                      S01508
     I                                       32  420W7TRCD                S01508
     I                                       43  530W7TRCH                S01508
     I*                                                                   S01508
     I**  Telex charge                                                    S01508
     I                                       54  640W7TXCD                S01508
     I                                       65  750W7TXCH                S01508
     I*                                                                   S01508
     I**  Cheque Charge                                                   S01508
     I                                       76  860W7CQCD                S01508
     I                                       87  970W7CQCH                S01508
     I*                                                                   S01508
     I**  Costs Abroad                                                    S01508
     I                                       98 1080W7CSTD                S01508
     I                                      109 1190W7CSTA                S01508
     I*                                                                   S01508
     I**  SWIFT Priority Charge                                           S01508
     I                                      120 1300W7SPCD                S01508
     I                                      131 1410W7SPCH                S01508
     I*                                                                   S01508
     I**  Miscellaneous charge                                            S01508
     I                                      142 1520W7MSCD                S01508
     I                                      153 1630W7MSCH                S01508
     I*                                                                   S01508
     I**  Advice Charge                                                   S01508
     I                                      164 1740W7ADCD                S01508
     I                                      175 1850W7ADCH                S01508
     I*                                                                   S01508
     I**  Telephone Charge                                                S01508
     I                                      186 1960W7TLCD                S01508
     I                                      197 2070W7TLCH                S01508
     I*                                                                   S01508
     I**  Collection Charge                                               S01508
     I                                      208 2180W7COLD                S01508
     I                                      219 2290W7COLL                S01508
     I*                                                                   S01508
     I**  Payment amount currency                                         S01508
     I                                      230 232 W7PCCY                S01508
     I*                                                                   S01508
     I**  Other currency                                                  S01508
     I                                      233 235 W7OCCY                S01508
     I*                                                                   S01508
     I**  FX/Change commission (input ccy)                                S01508
     I                                      236 2460W7CHCD                S01508
     I*                                                                   S01508
     I**  FX/Change commission (charge ccy)                               S01508
     I                                      247 2570W7CHCM                S01508
     I*                                                                   S01508
     I**  Our deductions (input ccy)                                      S01508
     I                                      258 2680W7DEDD                S01508
     I*                                                                   S01508
     I**  Our deductions (charge ccy)                                     S01508
     I                                      269 2790W7DEDS                S01508
     I*                                                                   S01508
     I**  Correspondent charge (input ccy)                                S01508
     I                                      280 2900W7COCD                S01508
     I*                                                                   S01508
     I**  Correspondent charge (charge ccy)                               S01508
     I                                      291 3010W7COCH                S01508
     I*                                                                   S01508
     I**  Default type (HDR or DET or " ")                                S01508
     I                                      302 304 W7DFTT                S01508
     I*                                                                   S01508
     I**  Customer to be debited the charge                               S01508
     I                                      305 310 W7CUST                S01508
     I*                                                                   CEU006
     I**  Settle Date                                                     CEU006
     I                                      311 3150W7SLDT                CEU006
     I*                                                                   CEU006
     I**  Pay Date                                                        CEU006
     I                                      316 3200W7PVDT                CEU006
     I*                                                                   CEU006
     I**  Add/Deduct Charges                                              CEU006
     I                                      321 321 W7ADDC                CEU006
     I/COPY WNCPYSRC,FT0080I004
     I*                                                                   S01117
     I**DUMMY DATASTRUCTURES FOR NEW ACCESS PROGRAMS.                     S01117
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01117
     ISDDLST    E DSSDDLSTPD                                              S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I**                                Nostro location code              S01195
     I                                       29  31 NLOC                  S01195
     ISDBANK    E DSSDBANKPD                                              S01194
     I                                       43  43 RUNAD1                101921
     I                                       43  440RUNAD                 S01194
     I                                       45  47 RUNAM                 S01194
     I                                       48  490RUNAY                 S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     ISDFTFR    E DSSDFTFRPD                                              S01194
     I                                       44  484RATDIS                S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     ISDTRAD    E DSSDTRADPD                                              S01194
     I              QQACCD                          QQACC3                                    CGL029
     ISDCUST    E DSSDCUSTPD                                              S01194
      *                                                                                       CSD015
     ISDCUS2    E DSSDCUSTPD                                                                  CSD015
     I              BBCUST                          WLCUST                                    CSD015
     I              BBCSSN                          WLCSSN                                    CSD015
     I              BBCNA1                          WLCNA1                                    CSD015
     I              BBCNA2                          WLCNA2                                    CSD015
     I              BBCNA3                          WLCNA3                                    CSD015
     I              BBCNA4                          WLCNA4                                    CSD015
     I              BBCRTN                          WLCRTN                                    CSD015
     I              BBPAIN                          WLPAIN                                    CSD015
     I              BBCRNM                          WLCRNM                                    CSD015
     I              BBDRCS                          WLDRCS                                    CSD015
     I              BBLCCD                          WLLCCD                                    CSD015
     I              BBACOC                          WLACOC                                    CSD015
     I              BBCNCZ                          WLCNCZ                                    CSD015
     I              BBCOLC                          WLCOLC                                    CSD015
     I              BBSSDT                          WLSSDT                                    CSD015
     I              BBDOIC                          WLDOIC                                    CSD015
     I              BBPCNB                          WLPCNB                                    CSD015
     I              BBCASC                          WLCASC                                    CSD015
     I              BBBRCD                          WLBRCD                                    CSD015
     I              BBBNBI                          WLBNBI                                    CSD015
     I              BBLINC                          WLLINC                                    CSD015
     I              BBLICD                          WLLICD                                    CSD015
     I              BBCTNB                          WLCTNB                                    CSD015
     I              BBREID                          WLREID                                    CSD015
     I              BBBSIN                          WLBSIN                                    CSD015
     I              BBCSTY                          WLCSTY                                    CSD015
     I              BBTAIN                          WLTAIN                                    CSD015
     I              BBCSID                          WLCSID                                    CSD015
     I              BBSTAD                          WLSTAD                                    CSD015
     I              BBTXA1                          WLTXA1                                    CSD015
     I              BBTXA2                          WLTXA2                                    CSD015
     I              BBTXA3                          WLTXA3                                    CSD015
     I              BBTXA4                          WLTXA4                                    CSD015
     I              BBTXA5                          WLTXA5                                    CSD015
     I              BBCHID                          WLCHID                                    CSD015
     I              BBCHSC                          WLCHSC                                    CSD015
     I              BBCABA                          WLCABA                                    CSD015
     I              BBBFIC                          WLBFIC                                    CSD015
     I              BBBLCD                          WLBLCD                                    CSD015
     I              BBFWCD                          WLFWCD                                    CSD015
     I              BBLCD                           WLLCD                                     CSD015
     I              BBTYLC                          WLTYLC                                    CSD015
     I              BBLALD                          WLLALD                                    CSD015
     I              BBLDHD                          WLLDHD                                    CSD015
     I              BBLRLD                          WLLRLD                                    CSD015
     I              BBDTDL                          WLDTDL                                    CSD015
     I              BBLETI                          WLLETI                                    CSD015
     I              BBCMTI                          WLCMTI                                    CSD015
     I              BBGSFM                          WLGSFM                                    CSD015
     I              BBSTFG                          WLSTFG                                    CSD015
     I              BBRWCD                          WLRWCD                                    CSD015
     I              BBNG01                          WLNG01                                    CSD015
     I              BBNG02                          WLNG02                                    CSD015
     I              BBNG03                          WLNG03                                    CSD015
     I              BBNG04                          WLNG04                                    CSD015
     I              BBNG05                          WLNG05                                    CSD015
     I              BBNG06                          WLNG06                                    CSD015
     I              BBNG07                          WLNG07                                    CSD015
     I              BBNG08                          WLNG08                                    CSD015
     I              BBNG09                          WLNG09                                    CSD015
     I              BBNG10                          WLNG10                                    CSD015
     I              BBNG11                          WLNG11                                    CSD015
     I              BBNG12                          WLNG12                                    CSD015
     I              BBNG13                          WLNG13                                    CSD015
     I              BBNG14                          WLNG14                                    CSD015
     I              BBNG15                          WLNG15                                    CSD015
     I              BBDS01                          WLDS01                                    CSD015
     I              BBDS02                          WLDS02                                    CSD015
     I              BBDS03                          WLDS03                                    CSD015
     I              BBDS04                          WLDS04                                    CSD015
     I              BBDS05                          WLDS05                                    CSD015
     I              BBDS06                          WLDS06                                    CSD015
     I              BBDS07                          WLDS07                                    CSD015
     I              BBDS08                          WLDS08                                    CSD015
     I              BBDS09                          WLDS09                                    CSD015
     I              BBDS10                          WLDS10                                    CSD015
     I              BBDS11                          WLDS11                                    CSD015
     I              BBDS12                          WLDS12                                    CSD015
     I              BBDS13                          WLDS13                                    CSD015
     I              BBDS14                          WLDS14                                    CSD015
     I              BBDS15                          WLDS15                                    CSD015
     I              BBDNW1                          WLDNW1                                    CSD015
     I              BBDNW2                          WLDNW2                                    CSD015
     I              BBDNW3                          WLDNW3                                    CSD015
     I              BBDNW4                          WLDNW4                                    CSD015
     I              BBDNW5                          WLDNW5                                    CSD015
     I              BBDNW6                          WLDNW6                                    CSD015
     I              BBDNW7                          WLDNW7                                    CSD015
     I              BBDNW8                          WLDNW8                                    CSD015
     I              BBDNW9                          WLDNW9                                    CSD015
     I              BBCGRP                          WLCGRP                                    CSD015
     I              BBCDEL                          WLCDEL                                    CSD015
     I              BBABA2                          WLABA2                                    CSD015
     I              BBOGID                          WLOGID                                    CSD015
     I              BBSSDL                          WLSSDL                                    CSD015
     I              BBORED                          WLORED                                    CSD015
     I              BBMCAC                          WLMCAC                                    CSD015
     I              BBCRPC                          WLCRPC                                    CSD015
     I              BBPSWC                          WLPSWC                                    CSD015
     I              BBMGTP                          WLMGTP                                    CSD015
     I              BBNET                           WLNET                                     CSD015
     I              BBNTGP                          WLNTGP                                    CSD015
     I              BBNTCP                          WLNTCP                                    CSD015
     I              BBNTND                          WLNTND                                    CSD015
     I              BBNTMM                          WLNTMM                                    CSD015
     I              BBTICS                          WLTICS                                    CSD015
     I              BBSWFI                          WLSWFI                                    CSD015
     I              BBDINC                          WLDINC                                    CSD015
     I              BBCOMG                          WLCOMG                                    CSD015
     I              BBCHRG                          WLCHRG                                    CSD015
     I              BBAGNT                          WLAGNT                                    CSD015
     I              BBAGNP                          WLAGNP                                    CSD015
     I              BBTRAS                          WLTRAS                                    CSD015
     I              BBNAR1                          WLNAR1                                    CSD015
     I              BBNAR2                          WLNAR2                                    CSD015
     I              BBNAR3                          WLNAR3                                    CSD015
     I              BBNAR4                          WLNAR4                                    CSD015
     I              BBDFAC                          WLDFAC                                    CSD015
     I              BBDFAS                          WLDFAS                                    CSD015
     I              BBFRNT                          WLFRNT                                    CSD015
     I              BBAFRT                          WLAFRT                                    CSD015
     I              BBREPA                          WLREPA                                    CSD015
     I              BBTMST                          WLTMST                                    CSD015
     I              BBPRBA                          WLPRBA                                    CSD015
     I              BBCLSS                          WLCLSS                                    CSD015
     I              BBEFDT                          WLEFDT                                    CSD015
     I              BBCLST                          WLCLST                                    CSD015
     I              BBCLDT                          WLCLDT                                    CSD015
     I              BBCORP                          WLCORP                                    CSD015
     I              BBCBEI                          WLCBEI                                    CSD015
     I              BBRI01                          WLRI01                                    CSD015
     I              BBRI02                          WLRI02                                    CSD015
     I              BBRI03                          WLRI03                                    CSD015
     I              BBRI04                          WLRI04                                    CSD015
     I              BBRI05                          WLRI05                                    CSD015
     I              BBFUND                          WLFUND                                    CSD015
     I              QQDFAC                          QQDFA1                                    CGL029
     I              BBFCMF                          WLFCMF                                    CLE025
     I              BBINOF                          WLINOF                                    CLE025
     I              BBMSTF                          WLMSTF                                    CLE025
     I              BBIOPC                          WLIOPC                                    CLE025
     I              BBCSI2                          WLCSI2                CSW036
     I              BBFNAC                          WLFNAC                CSW037
     I              BBDEAC                          WLDEAC                                    CSD025
     I              BBDEDT                          WLDEDT                                    CSD025
     I              BBIUSR                          WLIUSR                                    CSD031
     I              BBAUSR                          WLAUSR                                    CSD031
     I              BBXUSR                          WLXUSR                                    CSD031
     I              BBAACC                          WLAACC                                    CSD031
     I              BBEACC                          WLEACC                                    CSD031
     I              BBGPDT                          WLGPDT                                    CSD031
      *                                                                                       CSD015
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I              QQDFAC                          QQDFA2                                    CGL029
     ISDBOOK    E DSSDBOOKPD                                              S01414
     ISDPRFC    E DSSDPRFCPD                                              S01414
     ISCSARD    E DSSCSARDPD                                              S01494
     I* SAR file details                                                  S01494
     I              LCD                             SCLCD                 S01494
     ISDCNST    E DSSDCNSTPD                                              094278
     IMEBICD    E DSMEBICDPD                                              094278
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      ** 24X7 status data area                                                                CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
     I              SETUP                           DSSETX                                    CSD015
      ** SD data area                                                                         CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** DS For Midas Functions for Watch List Checking Details File                          CSD015
      *                                                                                       CSD015
     ISDWLTD    E DSSDWLTOPD                                                                  CSD015
      ** DS For Watch List Transaction Details File                                           CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** DS For Watch List Configuration Data File                                            CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     I/COPY FTCPYSRC,SFTVALCS                                             094278
     ISPARE       DS                            256                       CAC001
      * Define the data structure to pass data to WN0010 and return pgm   CAC001
      *                                                                   CAC001
     I                                        1   1 WACTN                 CAC001
     I                                    P   2   88WRATE                 CAC001
     I                                        9   9 WPSIN                 CAC001
     I                                       10  12 WPUCY                 CAC001
     I                                       13  15 WSLCY                 CAC001
     I                                    P  16  220WPUAM                 CAC001
     I                                    P  23  290WSLAM                 CAC001
     I                                       30  300WMDIN                 CAC001
     I                                    P  31  342WFXMP                 CAC001
     I                                       35  35 WFXMD                 CAC001
     I                                       36  36 WMBSI                 CAC001
     I                                       37  37 WMSIG                 CAC001
     I                                    P  38  440WMAMT                 CAC001
     I                                       45  45 WFRCI                 CAC001
     I/COPY QWINDSRC,FT0080DTA                                            S01241
     I                                        1   2 DSCHGT                                  AR820566
     I                                        3   4 DSNTYP                                  AR820566
     I                                        5  19 DSREFE                                  AR820566
     I                                       20  220DSSEQN                                  AR820566
     I                                       23  52 DSNARR                                  AR820566
     I                                      201 210 U#ORGN                                  AR820566
     I**********                            211 2160U#LNRF                           AR820566 CLE148
     I                                      211 216 U#LNRF                                    CLE148
     I                                      217 222 U#FCNM                                  AR820566
     I                                      223 2250U#FACT                                  AR820566
     I                                      226 2270U#FCNO                                  AR820566
     I                                      228 2290U#FSEQ                                  AR820566
     I                                      230 2340U#ORED                                  AR820566
     I                                      235 2400U#DLNO                                  AR820566
     I                                      241 246 U#TDRF                                  AR820566
     I                                      247 249 U#BRCA                                  AR820566
     I                                      250 255 U#CNUM                                  AR820566
     I                                      256 258 U#CCY                                   AR820566
     I                                      259 2680U#ACOD                                  AR820566
     I                                      269 2700U#ACSQ                                  AR820566
     I                                      271 285 U#PREF                                  AR820566
     I                                      286 2870U#CQSQ                                  AR820566
     I                                      315 3190U#VDAT                                  AR820566
     I                                      322 336 U#AMNT                                  AR820566
     I                                      337 339 U#TCCY                                  AR820566
     I                                      340 340 U#STAX                                  AR820566
     I                                      356 358 @@CCY                                   AR820566
     I                                      359 359 @@TYP1                                  AR820566
     I                                      360 383 @@ACC1                                  AR820566
     I                                      384 384 @@TYP2                                  AR820566
     I                                      385 401 @@ACC2                                  AR820566
      /COPY FTCPYSRC,FT0010I001                                           CEU006
      **  Data Structure for input/output parameters for FT0010           CEU006
     IPDATA       DS                           1024                                           CER001
      *                                                                                       CER001
     I                                        1  15 PREF1                                     CER001
     I                                       16  170SQCQ                                      CER001
     I                                       18  18 ##DRPT                                    CER001
     I                                       19  300##DRPY                                    CER001
     I                                       31  430##CQAM                                    CER001
     I                                       44  46 ##DRCY                                    CER001
     I                                       47  49 ##DRBR                                    CER001
     I                                     10151024 #1PGM                                     CER001
     I                                       50  52 BRCH                                      CER001
     I********************************************************************
     I/EJECT
     C                     MOVEACPY@      BIS@   80
     C********************************************************************
     C*
     C*  KEY FOR CHAINING TO LF/CQPAC
     C           CQPACK    KLIST
     C                     KFLD           PREFKY
     C                     KFLD           CQSQKY  20
     C*
     C*  KEY FOR CHAINING TO LF/FDDTSTL1                                  093958
     C           @DTSTK    KLIST                                          093958
     C                     KFLD           SPYTP                           093958
     C                     KFLD           SPYST                           093958
     C*                                                                   093958
     C*  KEY FOR CHAINING TO LF/CLINT
     C           CLINTK    KLIST
     C**********           KFLD           CNUMKY  60                                          CSD027
     C                     KFLD           CNUMKY  6                                           CSD027
     C                     KFLD           CLINTA  1
     C*
     C*  KEY FOR CHAINING TO LF/ACCNT
     C           ACCNTK    KLIST
     C                     KFLD           ACNTCN
     C                     KFLD           ACNTCY
     C                     KFLD           ACNTAC
     C                     KFLD           ACNTAS
     C                     KFLD           ACNTBR                          S01117
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C***KEY*FOR*CHAINING TO LF/OLPOS                                     056031
     C***********OLPOSK    KLIST                                          056031
     C************         KFLD           OLPOSB  3                 S01117056031
     C************         KFLD           OLPOSC  3                       056031
     C************         KFLD           OLPOSN  20                      056031
     C************                                                        056031
     C***KEY*FOR*CHAINING TO LF/PRONO                                     056031
     C***********PRONOK    KLIST                                          056031
     C************         KFLD           PRONOC  3                       056031
     C************         KFLD           PRONON  20                      056031
     C*
     C           *LIKE     DEFN DRCY      BORDCY
     C           *LIKE     DEFN BJCYCD    SCGCYX                          S01194
     C           *LIKE     DEFN A6SPRT    BCCYSP                          S01194
     C           *LIKE     DEFN A6NBDP    BCCYDP                          S01194
     C           *LIKE     DEFN A6SPRT    PCCYSP                          S01194
     C           *LIKE     DEFN A6NBDP    PCCYDP                          S01194
     C           *LIKE     DEFN A6SPRT    DRCYSP                          S01194
     C           *LIKE     DEFN A6NBDP    DRCYDP                          S01194
     C************LIKE*****DEFN BCCY      SCGCYX                          S01194
     C************LIKE*****DEFN SPOT      BCCYSP                          S01194
     C           *LIKE     DEFN MDIN      BCCYMD
     C************LIKE*****DEFN CDP       BCCYDP                          S01194
     C*
     C************LIKE*****DEFN SPOT      PCCYSP                          S01194
     C           *LIKE     DEFN MDIN      PCCYMD
     C************LIKE*****DEFN CDP       PCCYDP                          S01194
     C************LIKE*****DEFN BSPR      BSPRRE                          E29826
     C************LIKE*****DEFN BSSG      BSSGRE                          E29826
     C************LIKE*****DEFN SSPR      SSPRRE                          E29826
     C************LIKE*****DEFN SSSG      SSSGRE                          E29826
     C*
     C************LIKE*****DEFN SPOT      DRCYSP                          S01194
     C           *LIKE     DEFN MDIN      DRCYMD
     C************LIKE*****DEFN CDP       DRCYDP                          S01194
     C************LIKE*****DEFN BSPR      BSPRDR                          E29826
     C************LIKE*****DEFN BSSG      BSSGDR                          E29826
     C************LIKE*****DEFN SSPR      SSPRDR                          E29826
     C************LIKE*****DEFN SSSG      SSSGDR                          E29826
     C*
     C           *LIKE     DEFN PRRM      PRRMNW
     C           *LIKE     DEFN PRRM      PRRMOL
     C           *LIKE     DEFN PRRM      AMOUNT
     C           *LIKE     DEFN DIFF      WDIFF
     C*
     C           *LIKE     DEFN DRCY      DRCYNW
     C           *LIKE     DEFN DRCY      DRCYOL
     C           *LIKE     DEFN RATE      RATENW
     C           *LIKE     DEFN RATE      RATEOL
     C           *LIKE     DEFN MDIN      MDINNW
     C           *LIKE     DEFN MDIN      MDINOL
     C*
     C           *LIKE     DEFN CQAM      CQAMNW
     C           *LIKE     DEFN CQAM      CQAMOL
     C           *LIKE     DEFN CQAM      CQAMEQ
     C           *LIKE     DEFN CQAM      CQOLEQ
     C*
     C           *NAMVAR   DEFN LDA       DLDA
     C           *NAMVAR   DEFN CQPAYDA   CQPAYD
     C           *NAMVAR   DEFN           MMOD
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C*
     C********************************************************************
     C**
     C*    PERFORM 'FIRST CYCLE' PROCESSING
     C**
     C                     EXSR SETUP
     C**
     C*    PERFORM MAIN PROCESSING UNTIL END REQUESTED OR DBERR
      ** Or Function 3 returned from FTC0085.
     C**
     C           *INLR     DOWNE'1'                        ** B01
     C**
     C*    PROCESS INITIAL SCREEN
     C**
      *
      ** If function 12 returned from FT0085 first screen not required.
     C           PCMD      IFEQ '2'
     C                     MOVE *BLANKS   PCMD
      *
     C                     ELSE
      *
     C                     EXSR FIRST
     C                     END
      *
      ** Allow Call to FT0085 once each 'cycle' .
     C                     MOVE 'Y'       FLAG85  1
      *
     C*
     C           *INLR     IFEQ '0'                        ** B02
     C*
     C**IF AMEND OR ENQUIRE SETON 11 FOR USE WITH CMD7 IN SFL ENQ PGMS
     C           ACTION    IFEQ 'E'                                       E29970
     C           ACTION    OREQ 'A'                                       E29970
     C                     SETON                     11                   E29970
     C                     END                                            E29970
     C*                                                                   S01494
     C** IF ENQUIRE SETON 16 TO ENABLE F21 FROM THE ENQUIRY SCREEN.       S01494
     C*                                                                   S01494
     C                     SETOF                     16                   S01494
     C           ACTION    IFEQ 'E'                                       S01494
     C                     SETON                     16                   S01494
     C                     END                                            S01494
     C**
     C**
     C*    PROCESS INSERT OF A HEADER
     C**
     C           ACTION    IFEQ 'I'                        ** B03
     C           HEADER    ANDEQ'NEW'
     C                     EXSR HEADI
      *
      ** If linked with FT0085 &  FK12 returned proceed as header amend.
     C           PCMD      IFEQ '2'
     C                     EXSR HEADA
     C                     MOVE *IN80     *IN81
     C                     END
      *
     C           *IN81     IFEQ '0'                        ** B04
     C                     EXSR DETLI
     C                     END                             ** E04
     C                     END                             ** E03
     C**
     C*    PROCESS INSERT OF DETAILS
     C**
     C           ACTION    IFEQ 'I'                        ** B03
     C           HEADER    ANDEQ'OLD'
     C                     EXSR DETLI
     C                     END                             ** E03
     C**
     C*    PROCESS AMEND OF A HEADER
     C**
     C           ACTION    IFEQ 'A'                        ** B03
     C           SEQ       ANDEQ*BLANKS
     C                     EXSR HEADA
     C                     EXSR DETLI                                                         239450
     C                     END                             ** E03
     C**
     C*    PROCESS AMEND OF DETAILS
     C**
     C           ACTION    IFEQ 'A'                        ** B03
     C           SEQ       ANDNE*BLANKS
     C           WPROC     DOWEQ'Y'                                                         AR850937
     C                     MOVE 'N'       WPROC                                             AR850937
     C                     EXSR DETLA
     C                     ENDDO                                                            AR850937
     C/COPY WNCPYSRC,FT0080C058
     C           *IN78     IFEQ '0'                        ** B04
     C                     EXSR HEADA
     C                     END                             ** E04
     C                     END                             ** E03
     C**
     C*    PROCESS DELETE OF A HEADER
     C**
     C           ACTION    IFEQ 'D'                        ** B03
     C           SEQ       ANDEQ*BLANKS
     C                     EXSR HEADD
     C                     END                             ** E03
     C**
     C*    PROCESS DELETE OF DETAILS
     C**
     C           ACTION    IFEQ 'D'                        ** B03
     C           SEQ       ANDNE*BLANKS
     C                     EXSR DETLD
     C           *IN78     IFEQ '0'                        ** B04
     C                     EXSR HEADA
     C                     END                             ** E04
     C                     END                             ** E03
     C**
     C*    PROCESS ENQUIRE ON A HEADER
     C**
     C           ACTION    IFEQ 'E'                        ** B03
     C           SEQ       ANDEQ*BLANKS
     C                     EXSR HEADE
     C                     END                             ** E03
     C*    PROCESS ENQUIRE ON DETAILS
     C**
     C           ACTION    IFEQ 'E'                        ** B03
     C           SEQ       ANDNE*BLANKS
     C                     EXSR DETLE
     C                     EXSR HEADE
     C                     END                             ** E03
     C*
     C           @PREF     IFNE *BLANK
     C/COPY WNCPYSRC,FT0080C066
     C                     SETON                     LR
     C                     END
     C*
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C                     MOVE ' '       @RETC
     C   01                MOVE '1'       @RETC
     C   05                MOVE '5'       @RETC
     C   07                MOVE '7'       @RETC                           E29994
     C/COPY WNCPYSRC,FT0080C050
     C*
     C********************************************************************S01194
     C/EJECT                                                              S01194
      ********************************************************************S01194
      *                                                                   S01194
      **   MVCURR - SR TO CONVERT NEW SD FIELDS TO OLD                    S01194
      *                                                                   S01194
     C           MVCURR    BEGSR                                          S01194
     C           A6MDIN    IFEQ 'M'                                       S01194
     C                     Z-ADD1         MDIN                            S01194
     C                     ELSE                                           S01194
     C                     Z-ADD0         MDIN                            S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C********************************************************************
     C/EJECT
      ********************************************************************
     C*                                                                   S01194
     C* MVNOST - SUB-ROUTINE TO UPDATE OLD SD FIELDS                      S01194
     C*                                                                   S01194
     C           MVNOST    BEGSR                                          S01194
     C                     MOVE A7CUST    CNUMA                           S01194
     C                     MOVE A7ACCD    ACOD                            S01194
     C                     Z-ADDA7ACSN    ACSQ                            S01194
     C                     MOVE A7BRCD    BRCA                            S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C/EJECT                                                              S01194
      ************                                                        056031
      ************  Remove PRONO, OLPOS and MEMOS                         056031
      ************                                                        056031
      **************************************************************S01194056031
     C************                                                  S01194056031
     C**MVFPRT*-*SUB-ROUTINE TO UPDATE OLD SD FIELDS WHEN FPRTN     S01194056031
     C***********ORIGINALLY ACCESSED                                S01194056031
     C************                                                  S01194056031
     C***********MVFPRT    BEGSR                                    S01194056031
     C************         MOVE A7ACCD    ACOD    40                S01194056031
     C************         MOVE A7ACSN    ACSQ    20                S01194056031
     C************         MOVE A7CYCD    CCY     3                 S01194056031
     C************         MOVE A7CUST    CNUM    60                S01194056031
     C************         MOVE A7NONB    NOSN    20                S01194056031
     C************         MOVE A7BRCD    BRCA    3                 S01194056031
     C************         ENDSR                                    S01194056031
     C************                                                  S01194056031
     C**************************************************************S01194056031
     C/EJECT
      ********************************************************************
      **
      *    CALL85 - SR to Call FT0085 for further processing.
      **
     C           CALL85    BEGSR
      *
      ** Check not to invoke FT0085 after detail.
     C           FLAG85    IFEQ 'Y'
      *
      ** set up parameters for FT0085 replacing initial screen...
     C           SACTD     IFEQ 'I'
     C                     MOVELPREF      SPREF
     C                     END
     C*                                                                   096486
     C**  Set action code to 'G' to tell in FT0085 that the enquiry is    096486
     C**  triggered from Account  Movements menu option (GL4442).         096486
     C*                                                                   096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'G'       SACTD                           096486
     C                     END                                            096486
     C*                                                                   096486
     C                     CALL 'FTC0085'
     C                     PARM           SACTD
     C                     PARM           SPREF
     C                     PARM           FLAG85
      *
      ** ... and receive back from FT0085 the last function key.
     C                     PARM           PCMD    1        Function
      *                                                                   096486
      ** Restore back action code passed if called from GL4442            096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'E'       SACTD                           096486
     C                     END                                            096486
      *
      ** Terminate if F3 entered in FT0085.
     C           PCMD      IFEQ '1'
     C                     SETON                         LR
     C                     MOVE '1'       @RETC
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END
     C           PCMD      IFEQ '5'
     C                     SETON                         05
     C                     END
      *
     C           PCMD      IFEQ '2'
     C           SACTD     ANDEQ'I'
     C                     MOVE 'A'       SACTD
     C                     MOVE 'A'       ACTION
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *
      /EJECT
     C********************************************************************
     C**
     C*    FIRST  - SR TO PROCESS INITIAL SCREEN
     C**
     C           FIRST     BEGSR
     C**
     C*    SET BLANK SCREEN
     C**
     C                     EXSR REINIT
     C**
     C*    PROCESS INITIAL SCREEN UNTIL F3 OR VALID ENTRY
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C*
     C* Loop control indicator
     C*
     C                     MOVE '1'       *IN80
     C*
     C* If record updated by another workstation - register error
     C*
     C           *IN78     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE '068'     ERCD,S                          S01117
     C                     MOVE '001'     ERCD,S                          S01117
     C                     MOVE '1'       *IN75
     C                     MOVE '0'       *IN78
     C                     END                             ** E02
     C*
     C                     MOVEAERCD,1    SERCD1
     C                     MOVEAERCD,20   SERCD2
     C*
     C* If passed action parameter is NOT an Enquiry OR error exists
     C*
     C           @SORT     IFNE 'E'
     C           *IN75     OREQ '1'
      *                                                                   042167
      * Call CL program to deallocate dataarea                            042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE *BLANKS   @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
     C/COPY WNCPYSRC,FT0080C067
      *                                                                   042167
     C                     WRITEFT0080F1
     C**
     C*    PROCESS HELP IF REQUESTED
     C**                                                                  S01199
     C**         *IN25     DOUEQ'0'                        ** B02         S01199
      *                                                                   042167
     C                     READ FT0080F1                 99
     C/COPY WNCPYSRC,FT0080C068
      *                                                                   042167
     C**         *IN25     IFEQ '1'                        ** B03         S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             ** E03         S01199
     C**                   END                             ** E02         S01199
      *                                                                   042167
     C                     END                             ** E02
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       @RETC
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             ** E02
     C*
     C           *IN05     IFEQ '1'                        ** B02
     C*
     C           @PREF     IFEQ *BLANK
     C                     EXSR REINIT
     C                     ELSE
     C                     MOVE '5'       @RETC
     C                     MOVE '1'       *INLR
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END
     C*
     C                     ELSE                            ** X02
     C*LUX46
     C           *IN07     IFEQ '1'
     C                     SETON                     LR
     C*********************MOVE ' '       @RETC                           E29970
     C                     MOVE '7'       @RETC                           E29970
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END
     C*LUX46
     C                     EXSR VALI
     C                     END                             ** E02
     C**
     C*    IF NOT F3 AND ERRORS IN VALIDATION LOOP AROUND
     C**   OR IF ? ENTERED IN SBRCA FIELD                                 S01194
     C**
     C           *IN01     IFEQ '0'                        ** B02
     C           *IN75     ANDEQ'1'
     C           *IN01     OREQ '0'                                       S01194
     C           *IN29     ANDEQ'1'                                       S01194
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C**
     C*    VALID INITIAL SCREEN ENTERED, SET VARIABLES USED LATER
     C**
     C                     MOVE SACTD     ACTION  1
     C                     MOVE SCQSQ     SEQ     2
     C**
     C*    SUPPRESS PREVIOUS PAYMENT REF. FIELDS ON NEXT INITIAL SCREEN
     C**
     C                     MOVE '1'       *IN77
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    HEADI  - SR TO PROCESS INSERTION OF A HEADER
     C**
     C           HEADI     BEGSR
     C**
     C*    SET BLANK SCREEN
     C**
     C                     EXSR REHEAD
     C**
     C*    PROCESS HEADER SCREEN UNTIL F3 OR VALID ENTRY
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C*
     C                     MOVE '1'       *IN80
     C*
     C                     MOVEAERCD,1    SERCD1
     C                     MOVEAERCD,20   SERCD2
     C*
     C** SET UP DEFAULTS FOR SCREEN 2
     C*
     C                     MOVE 'CP'      SPYTP
     C*
     C*********************MOVE '02'      S#WPC   2                       S01117
     C                     MOVE 'N'       S#WPC   1                       S01117
     C*
     C           SSWPC     IFEQ *BLANKS
     C                     MOVE S#WPC     SSWPC
     C                     END
     C*
     C                     MOVE *IN29     IN29    1                       CEU006
     C                     MOVE *IN30     IN30    1                       CEU006
     C                     MOVE *IN78     IN78    1                       CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN29                           CEU006
     C                     MOVE *OFF      *IN30                           CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C           PDCERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN29                           CEU006
     C                     ENDIF                                          CEU006
     C           PDAERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN30                           CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     WRITE#MSGCTL                                   CEU006
     C                     WRITEFT0080F2
     C**
     C*    PROCESS HELP IF REQUESTED
     C**                                                                  S01199
     C**         *IN25     DOUEQ'0'                        ** B02         S01199
      *
     C                     READ FT0080F2                 99
     C                     MOVE IN29      *IN29                           CEU006
     C                     MOVE IN30      *IN30                           CEU006
     C                     MOVE IN78      *IN78                           CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE 'N'       PDCERR                          CEU006
     C                     MOVE 'N'       PDAERR                          CEU006
     C                     ENDIF                                          CEU006
     C                     CALL 'ZA0250'                                  CEU006
     C*
     C**         *IN25     IFEQ '1'                        ** B03         S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             ** E03         S01199
     C**                   END                             ** E02         S01199
      *
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       @RETC
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             ** E02
     C*
      * IF Cmd12 pressed set screen control indicators
      * ELSE validate the header details
      *
     C           *IN05     IFEQ '1'                        ** B02
     C                     MOVEA'111'     *IN,80
     C                     ELSE                            ** X02
     C                     EXSR VALHED
     C                     END                             ** E02
     C*
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
     C*                                                                   E32543
     C           *IN19     IFEQ '1'                                       E32543
     C*                                                                   E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
     C*                                                                   E32543
     C           *IN22     IFEQ '1'                                       E32543
     C           SPYDT     ANDEQSLDTO                                     E32543
     C                     SETOF                     192226               E32543
     C                     SUB  1         S                               E32543
     C*                                                                   E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
     C*                                                                   E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SPYDT     SLDTO   6                       E32543
     C                     END                                            E32543
     C*                                                                   E32543
     C                     END                                            E32543
     C*
     C* CHECK IF WARNING ERROR
     C*
     C           *IN69     IFEQ '1'                        B002
     C*
     C* IF ENTERED PRESS AND FIELDS UNCHANGED ASSUME ACCEPTANCE
     C*
     C           *IN70     IFEQ '1'                        B003
     C           S         ANDLT2
     C           SRBANK    ANDEQRBANKO
     C                     SETOF                     456970
     C                     SUB  1         S                               E32543
     C*********************SETOF                     75                   E32543
     C*********************Z-ADD0         S                               E32543
     C*********************MOVEA*BLANK    ERCD                            E32543
     C*
     C* ASSUME FIRST DISPLAY OF WARNING ERROR
     C*
     C                     ELSE                            X003
     C                     SETON                     70
     C                     MOVE SRBANK    RBANKO140
     C                     END                             E003
     C*
     C                     END                             E002
      *                                                                   E32543
     C           S         IFEQ 0                                         E32543
     C                     SETOF                     75                   E32543
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C**
     C*    IF NOT F12 AND ERRORS IN VALIDATION LOOP AROUND
     C*    OR FIELD QUERY ENABLED LOOP AROUND.                            S01194
     C**
     C           *IN05     IFEQ '0'                        ** B02
     C           *IN75     ANDEQ'1'
     C********** *IN05     OREQ '0'                        ** B02   S01194E32543
     C********** *IN30     ANDEQ'1'                                 S01194E32543
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C**
     C*    IF F3 OR F12 NOT SELECTED PERFORM UPDATING
     C**
     C           *IN01     IFEQ '0'                        ** B01
     C           *IN05     ANDEQ'0'
     C                     EXSR WRITHI
     C**
     C*    IF RECORD UPDATED BY ANOTHER W/S WAS DETECTED PREVENT
     C*      CHEQUE INSERTION PROCESSING FROM TAKING PLACE
     C**
     C           *IN78     IFEQ '1'                        ** B02
     C                     MOVE '1'       *IN81
     C                     ELSE
      *                                                                   042167
      * Call CL program to allocate dataarea                              042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE PREF      @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
     C/COPY WNCPYSRC,FT0080C023
      *
      ** If program linked with FT0085.
      *
     C***********FTLJ******IFEQ 'Y'                                       S01194
     C           BTLVJN    IFEQ 'Y'                                       S01194
     C           SLINK     OREQ 'Y'
     C                     EXSR CALL85
      *
      ** If FK 12 returned handle same as if entered on this screen.
      *
     C           PCMD      IFEQ '5'
     C                     MOVEA'111'     *IN,80
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,FT0080C024
      *
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    DETLI  - SR TO PROCESS INSERTION OF DETAILS
     C**
     C           DETLI     BEGSR
      *
      ** Disallow Call to FT0085 after 'detail' phase .
      *
     C                     MOVE *BLANK    FLAG85  1
      *
     C**
     C*    SET BLANK SCREEN
     C**
     C                     EXSR REDETL
     C**
     C*    PROCESS DETAIL SCREENS UNTIL F3 OR 50TH SCREEN
     C**
     C           *IN82     DOWEQ'0'                        ** B01
     C**
     C*    PROCESS DETAIL SCREEN UNTIL F3 OR VALID ENTRY
     C**
     C           *IN80     DOWEQ'0'                        ** B02
     C*
     C                     MOVE '1'       *IN80
     C/COPY WNCPYSRC,FT0080C041
     C*
     C                     MOVEAERCD,1    SERCD1
     C                     MOVEAERCD,20   SERCD2
     C                     MOVE STRCM     STRCMW 12
     C                     MOVE SCHCM     SCHCMW 12                       S01494
     C                     MOVE SCQAM     SCQSV  14
     C*
     C* FOR INSERTED CHEQUES, BLANK OUT PREVIOUS CCY FROM SCREEN
     C* TO AVOID CONFUSION
     C* (NOTE: CCY WILL APPEAR ON AMENDMENTS, ENQUIRIES AND DELETIONS)
     C*
     C                     MOVE *BLANKS   SCGCY
     C                     MOVE *BLANKS   CHCCY
     C*
     C*
     C** SET UP DEFAULT VALUES
     C*
     C           BTCHCY    IFEQ 'L'                                       S01194
     C                     MOVE BJLCCY    SCGCY                           S01194
     C                     ELSE                                           S01194
     C           BTCHCY    IFEQ 'B'                                       S01194
     C                     MOVE BJCYCD    SCGCY                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C***********FTCC******IFEQ 'L'                                       S01194
     C*********************MOVE LOCY      SCGCY                           S01194
     C*********************ELSE                                           S01194
     C***********FTCC******IFEQ 'B'                                       S01194
     C*********************MOVE BCCY      SCGCY                           S01194
     C*********************END                                            S01194
     C*********************                                               S01194
     C*********************END                                            S01194
      *                                                                   CAC001
      **  If Analytical Accounting is switched on, setup screen           CAC001
      **  defaults only if F19 has not been pressed                       CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'N'                                       CAC001
     C           BGN0ST    OREQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*OFF                                      CAC001
      *
     C* SET UP SCREEN CCY(ONLY IF NOT REOUTPUT FOR ERROR)
      *
     C           *IN75     IFEQ '0'
     C                     MOVE PCCY      SDRCY
     C**                   END
     C**
     C*   SETUP DDMMYY EQUIVALENT OF RUND FOR DEFAULT DEBIT VALUE DATE
     C**
     C*********************Z-ADDRUND      ZDAYNO                          S01194
     C                     Z-ADDBJRDNB    ZDAYNO                          S01194
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDRVD
     C                     END
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   E22952
     C**  To display the cheque sequence number                           E22952
     C*                                                                   E22952
     C           RTNCDE    IFNE 'PREV   '                                                   AR850937
     C                     Z-ADDNCSQ      CQSQ                            E23146
     C           CQSQ      ADD  1         CQSQCS  20                      E22952
     C                     MOVE CQSQCS    SCQSQ                           E22952
     C                     ENDIF                                                            AR850937
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP1                                           S01408
     C*                                                                   S01408
      * Default Commission tariff as all other payment types              140648
     C           ORBR      CHAINPYCHGDB              99                   140648
     C           *IN99     IFEQ '1'                        ** B01         140648
     C                     MOVEL'PYCHG'   WDBFIL             ************ 140648
     C                     Z-ADD5         WDBASE             * DBERR 05 * 140648
     C                     MOVE *BLANKS   ERRMSG             ************ 140648
     C                     MOVE 'PAYMENT 'ERMSG1                          140648
     C                     MOVE 'CHARGES 'ERMSG2                          140648
     C                     MOVEL'RECORD M'ERMSG3                          140648
     C                     MOVEL'ISSING  'ERMSG4                          140648
     C                     MOVELERRMSG    WDBKEY                          140648
     C                     EXSR ENDPGM                                    140648
     C                     END                             ** E01         140648
     C                     MOVE DFTRCT    STRCT                           140648
     C*
     C                     MOVE *IN69     IN69    1                       CEU006
     C                     MOVE *IN70     IN70    1                       CEU006
     C                     MOVE *IN78     IN78    1                       CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN69                           CEU006
     C                     MOVE *OFF      *IN70                           CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C           NDCERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN69                           CEU006
     C                     ENDIF                                          CEU006
     C           NDAERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN70                           CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     WRITE#MSGCTL                                   CEU006
     C                     WRITEFT0080F3
     C**
     C*    PROCESS HELP IF REQUESTED
     C**                                                                  S01199
     C**         *IN25     DOUEQ'0'                        ** B03         S01199
      *
     C                     READ FT0080F3                 99
     C                     MOVE IN69      *IN69                           CEU006
     C                     MOVE IN70      *IN70                           CEU006
     C                     MOVE IN78      *IN78                           CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE 'N'       NDCERR                          CEU006
     C                     MOVE 'N'       NDAERR                          CEU006
     C                     ENDIF                                          CEU006
     C                     CALL 'ZA0250'                                  CEU006
      *
     C**         *IN25     IFEQ '1'                        ** B04         S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             ** E04         S01199
     C**                   END                             ** E03         S01199
     C**
      *
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B03
     C                     SETON                     8082
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP2                                           S01408
     C*                                                                   S01408
     C                     ELSE                            ** X03
     C                     EXSR VALDI
     C                     END                             ** E03
     C/COPY WNCPYSRC,FT0080C042
      *
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
      *                                                                   E32543
     C           *IN19     IFEQ '1'                                       E32543
      *                                                                   E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
      *                                                                   E32543
     C           *IN22     IFEQ '1'                                       E32543
     C           SDRVD     ANDEQSPYVO                                     E32543
     C                     SETOF                     192223               E32543
     C                     SUB  1         S                               E32543
      *                                                                   E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
      *                                                                   E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SDRVD     SPYVO   6                       E32543
     C                     END                                            E32543
      *                                                                   E32543
     C                     END                                            E32543
      *                                                                   CAC001
      **  Check if window processing required                             CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  If F19 for Margin Info is not pressed but Margin Info has       CAC001
      **  been defined and any of the relevant fields have changed,       CAC001
      **  set forced indicator to 'Y'.                                    CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*OFF                                      CAC001
     C           *IN01     ANDEQ*OFF                                      CAC001
      *                                                                   CAC001
     C           WOMBSI    IFNE *BLANK                                    CAC001
     C           WOMSIG    ORNE *BLANK                                    CAC001
      *                                                                   CAC001
     C           RATE      IFNE WSVRT                                     CAC001
     C           SDRCY     ORNE WSVCY                                     CAC001
     C           CQAM      ORNE WSVAM                                     CAC001
     C                     MOVE 'Y'       WFRCI                           CAC001
     C                     MOVE *ON       *INKT                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check if F19 for Margin Info is pressed and no errors           CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C           S         ANDEQ*ZERO                                     CAC001
      *                                                                   CAC001
      **  If debit and credit currencies are different; or forced         CAC001
      **  indicator is 'Y'; or debit/credit currencies are the same       CAC001
      **  and margin information entered, call margin info window         CAC001
      *                                                                   CAC001
     C           PCCY      IFNE SDRCY                                     CAC001
     C           WFRCI     OREQ 'Y'                                       CAC001
      *                                                                   CAC001
     C           PCCY      OREQ SDRCY                                     CAC001
     C           WOMBSI    ANDNE*BLANK                                    CAC001
      *                                                                   CAC001
     C           PCCY      OREQ SDRCY                                     CAC001
     C           WOMSIG    ANDNE*BLANK                                    CAC001
     C                     MOVE 'I'       WACTN                           CAC001
     C                     EXSR SRMGIN                                    CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Otherwise, send error message                                   CAC001
      *                                                                   CAC001
     C                     ADD  1         S                               CAC001
     C                     MOVE ' 620'    ERCD,S                          CAC001
     C                     MOVE *ON       *IN58                           CAC001
     C                     MOVE *ON       *IN75                           CAC001
     C                     MOVE *OFF      *IN80                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   E32543
     C           S         IFEQ 0                                         E32543
     C                     SETOF                     75                   E32543
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C**
     C*    IF NOT F3 AND ERRORS IN VALIDATION LOOP AROUND
     C**
     C           *IN01     IFEQ '0'                        ** B03
     C           *IN75     ANDEQ'1'
     C                     MOVE '0'       *IN80
     C                     END                             ** E03
     C*
     C/COPY WNCPYSRC,FT0080C001
     C**********           END                             ** E02                           AR850937
     C/COPY WNCPYSRC,FT0080C002
     C**
     C*    IF F3 NOT SELECTED PERFORM UPDATING
     C**
     C           *IN01     IFEQ '0'                        ** B02
     C           *IN75     ANDEQ'0'                                                         AR850937
     C                     EXSR WRITDI
     C           RTNCDE    IFNE 'PREV   '                                                   AR850937
     C                     EXSR REDETL                                                      AR850937
     C                     ENDIF                                                            AR850937
     C**
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP3                                           S01408
     C*                                                                   S01408
     C*    IF RECORD UPDATED BY ANOTHER W/S WAS DETECTED TERMINATE
     C*      OUTER LOOP
     C**
     C           *IN78     IFEQ '1'                        ** B03
     C                     MOVE '1'       *IN80                                             AR850937
     C                     MOVE '1'       *IN82
     C                     END                             ** E03
     C*
     C                     END                             ** E02
     C                     ENDDO                                                            AR850937
     C**
     C*    IF 50TH SCREEN HAS BEEN PROCESSED TERMINATE OUTER LOOP
     C**
     C           CQSQ      IFGE 50                         ** B02
     C                     MOVE '1'       *IN82
     C                     END                             ** E02
     C**
     C*    IF MORE SCREENS ARE NEEDED BLANKOUT FIELDS & RESET INNER LOOP
     C**
     C           *IN82     IFEQ '0'                        ** B02
     C                     EXSR BLKDET
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C           *IN78     IFNE '1'                        ** B01
     C                     EXSR HEADA
     C                     END                             ** E01
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    HEADA  - SR TO PROCESS AMENDMENT OF A HEADER
     C**
     C           HEADA     BEGSR
     C**
     C*    SETUP SCREEN
     C*      SAVE CURRENT ACTION TO BE RESTORED LATER AND FORCE ACTION
     C*      TO 'A' FOR CORRECT AMEND AFTER CHEQUE INSERT/DELETION
     C**
     C                     MOVE ACTION    OLDACT  1
     C                     MOVE SACTD     OLDSAC  1
     C                     MOVE 'A'       ACTION
     C                     MOVE 'A'       SACTD
      *
     C                     EXSR REHEAD
     C                     EXSR SETHED
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
      *                                                                   004120
     C           *LIKE     DEFN SCRVAL    SAVSCR                          004120
     C           *LIKE     DEFN SCRVA2    SAVSC2                          CEU006
     C                     MOVE SCRVAL    SAVSCR                          004120
     C                     MOVE SCRVA2    SAVSC2                          CEU006
      *
     C                     MOVE '1'       *IN79
      *
     C* IF LEVEL 2 ENTERED PROTECT CURRENCY                               E167
      *
     C           NCSQ      COMP 0                    8686                 E167
     C**
     C*    PROCESS HEADER SCREEN UNTIL F3 OR VALID ENTRY
      **           Or (if linked with FT0085) FK12 not returned.
      **
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C           PCMD      OREQ '2'
     C                     MOVE ' '       PCMD
     C*
     C                     MOVE '1'       *IN80
     C*
     C                     MOVEAERCD,1    SERCD1
     C                     MOVEAERCD,20   SERCD2
      *
     C                     MOVE *IN29     IN29                            CEU006
     C                     MOVE *IN30     IN30                            CEU006
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN29                           CEU006
     C                     MOVE *OFF      *IN30                           CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C           PDCERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN29                           CEU006
     C                     ENDIF                                          CEU006
     C           PDAERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN30                           CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     WRITE#MSGCTL                                   CEU006
     C                     WRITEFT0080F2
     C**
     C*    PROCESS HELP IF REQUESTED
     C**                                                                  S01199
     C**         *IN25     DOUEQ'0'                        ** B02         S01199
      *
     C                     READ FT0080F2                 99
     C                     MOVE IN29      *IN29                           CEU006
     C                     MOVE IN30      *IN30                           CEU006
     C                     MOVE IN78      *IN78                           CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE 'N'       PDCERR                          CEU006
     C                     MOVE 'N'       PDAERR                          CEU006
     C                     ENDIF                                          CEU006
     C                     CALL 'ZA0250'                                  CEU006
      *
     C**         *IN25     IFEQ '1'                        ** B03         S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             ** E03         S01199
     C**                   END                             ** E02         S01199
      *
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C*
     C* IF NO FIELDS ARE UPDATED, EXIT WITHOUT CHANGING RECORD            004120
     C* (SETON F12 INDICATOR)                                             004120
     C*                                                                   004120
     C/COPY WNCPYSRC,FT0080C025
     C           SAVSCR    IFEQ SCRVAL                                    004120
     C           SAVSC2    ANDEQSCRVA2                                    CEU006
     C                     SETON                     05                   004120
     C                     END                                            004120
     C/COPY WNCPYSRC,FT0080C026
     C*                                                                   004120
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *INLR
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
     C                     RETRN
     C                     END                             ** E02
     C**                                                                  E29970
     C           *IN07     IFEQ '1'                        ** B02         E29970
     C                     MOVE '7'       @RETC                           E29970
     C                     SETON                     LR                   E29970
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN                                          E29970
     C                     END                             ** E02         E29970
     C*
     C           *IN05     IFEQ '1'                        ** B02
     C                     MOVEA'111'     *IN,80
     C                     ELSE                            ** X02
     C                     EXSR VALHED
     C                     END                             ** E02
      *
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
      *                                                                   E32543
     C           *IN19     IFEQ '1'                                       E32543
      *                                                                   E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
      *                                                                   E32543
     C           *IN22     IFEQ '1'                                       E32543
     C           SPYDT     ANDEQSLDTO                                     E32543
     C                     SETOF                     192226               E32543
     C                     SUB  1         S                               E32543
      *                                                                   E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
      *                                                                   E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SPYDT     SLDTO   6                       E32543
     C                     END                                            E32543
      *                                                                   E32543
     C                     END                                            E32543
      *
     C* CHECK IF WARNING ERROR
      *
     C           *IN69     IFEQ '1'                        B002
      *
     C* IF ENTERED PRESS AND FIELDS UNCHANGED ASSUME ACCEPTANCE
      *
     C           *IN70     IFEQ '1'                        B003
     C           S         ANDLT2
     C           SRBANK    ANDEQRBANKO
     C                     SETOF                     456970
     C                     SUB  1         S                               E32543
     C*********************SETOF                     75                   E32543
     C*********************Z-ADD0         S                               E32543
     C*********************MOVEA*BLANK    ERCD                            E32543
      *
     C* ASSUME FIRST DISPLAY OF WARNING ERROR
      *
     C                     ELSE                            X003
     C                     SETON                     70
     C                     MOVE SRBANK    RBANKO140
     C                     END                             E003
      *
     C                     END                             E002
      *                                                                   E32543
     C           S         IFEQ 0                                         E32543
     C                     SETOF                     75                   E32543
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C**
     C*    IF NOT F12 AND ERRORS IN VALIDATION LOOP AROUND
     C**
     C           *IN05     IFEQ '0'                        ** B02
     C           *IN75     ANDEQ'1'
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C**
     C*    IF F3 OR F12 NOT SELECTED PERFORM UPDATING
     C**
     C           *IN01     IFEQ '0'                        ** B01
     C           *IN05     ANDEQ'0'
     C                     EXSR WRITHA
     C/COPY WNCPYSRC,FT0080C027
      *
      ** If program linked with FT0085 .
      *
     C***********FTLJ******IFEQ 'Y'                                       S01194
     C           BTLVJN    IFEQ 'Y'                                       S01194
     C           SLINK     OREQ 'Y'
     C                     EXSR CALL85
     C                     END
     C/COPY WNCPYSRC,FT0080C028
     C*
     C                     END                             ** E01
     C*
     C                     MOVE '0'       *IN79
     C**
     C*   RESTORE ACTION CODE TO PREVENT THIS SR. BEING RECALLED BY MAIN
     C**
     C                     MOVE OLDACT    ACTION
     C                     MOVE OLDSAC    SACTD
     C*
     C* SETOF CURRENCY PROTECT
     C*
     C                     SETOF                     86
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    DETLA  - SR TO PROCESS AMENDMENT OF DETAILS
     C**
     C           DETLA     BEGSR
      *
      ** Disallow Call to FT0085 after 'detail' phase .
     C                     MOVE *BLANK    FLAG85  1
      *
     C**
     C*    SET UP DETAIL SCREEN
     C**
     C                     EXSR REDETL
     C                     EXSR SETDET
     C**
     C*    PROCESS DETAIL SCREEN UNTIL F3 OR VALID ENTRY
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C*
     C                     MOVE '1'       *IN80
     C/COPY WNCPYSRC,FT0080C043
     C*
     C                     MOVEAERCD,1    SERCD1
     C                     MOVEAERCD,20   SERCD2
     C                     MOVE STRCM     STRCMW 12
     C                     MOVE SCHCM     SCHCMW                          S01494
     C                     MOVE SCQAM     SCQSV  14
     C                     MOVE *IN69     IN69                            CEU006
     C                     MOVE *IN70     IN70                            CEU006
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN69                           CEU006
     C                     MOVE *OFF      *IN70                           CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C           NDCERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN69                           CEU006
     C                     ENDIF                                          CEU006
     C           NDAERR    IFEQ 'Y'                                       CEU006
     C                     MOVE *ON       *IN70                           CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     WRITE#MSGCTL                                   CEU006
     C                     WRITEFT0080F3
     C**
     C*    PROCESS HELP IF REQUESTED
     C**                                                                  S01199
     C**         *IN25     DOUEQ'0'                        ** B02         S01199
     C                     READ FT0080F3                 99
     C                     MOVE IN69      *IN69                           CEU006
     C                     MOVE IN70      *IN70                           CEU006
     C                     MOVE IN78      *IN78                           CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE 'N'       NDCERR                          CEU006
     C                     MOVE 'N'       NDAERR                          CEU006
     C                     ENDIF                                          CEU006
     C                     CALL 'ZA0250'                                  CEU006
     C**         *IN25     IFEQ '1'                        ** B03         S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             ** E03         S01199
     C**                   END                             ** E02         S01199
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *IN80
     C/COPY WNCPYSRC,FT0080C044
     C                     ELSE                            ** X02
     C                     EXSR VALDI
     C                     END                             ** E02
     C/COPY WNCPYSRC,FT0080C045
     C* C                                                                 E32543
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
     C* C                                                                 E32543
     C           *IN19     IFEQ '1'                                       E32543
     C* C                                                                 E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
     C* C                                                                 E32543
     C           *IN22     IFEQ '1'                                       E32543
     C           SDRVD     ANDEQSPYVO                                     E32543
     C                     SETOF                     192223               E32543
     C                     SUB  1         S                               E32543
     C* C                                                                 E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
     C* C                                                                 E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SDRVD     SPYVO   6                       E32543
     C                     END                                            E32543
     C* C                                                                 E32543
     C                     END                                            E32543
      *                                                                   CAC001
      **  Check if window processing required                             CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  If F19 for Margin Info is not pressed but Margin Info has       CAC001
      **  been defined and any of the relevant fields have changed,       CAC001
      **  set forced indicator to 'Y'.                                    CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*OFF                                      CAC001
     C           *IN01     ANDEQ*OFF                                      CAC001
      *                                                                   CAC001
     C           WOMBSI    IFNE *BLANK                                    CAC001
     C           WOMSIG    ORNE *BLANK                                    CAC001
      *                                                                   CAC001
     C           RATE      IFNE WSVRT                                     CAC001
     C           SDRCY     ORNE WSVCY                                     CAC001
     C           CQAM      ORNE WSVAM                                     CAC001
     C                     MOVE 'Y'       WFRCI                           CAC001
     C                     MOVE *ON       *INKT                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check if F19 for Margin Info is pressed and no erros            CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ '1'                                       CAC001
     C           S         ANDEQ*ZEROS                                    CAC001
      *                                                                   CAC001
      **  If debit and credit currencies are different; or forced         CAC001
      **  indicator is 'Y'; or debit/credit currencies are the same       CAC001
      **  and margin information entered, call margin info window         CAC001
      *                                                                   CAC001
     C           PCCY      IFNE SDRCY                                     CAC001
     C           WFRCI     OREQ 'Y'                                       CAC001
      *                                                                   CAC001
     C           PCCY      OREQ SDRCY                                     CAC001
     C           WOMBSI    ANDNE*BLANK                                    CAC001
      *                                                                   CAC001
     C           PCCY      OREQ SDRCY                                     CAC001
     C           WOMSIG    ANDNE*BLANK                                    CAC001
     C                     MOVE 'A'       WACTN                           CAC001
     C                     EXSR SRMGIN                                    CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Otherwise, send error message                                   CAC001
      *                                                                   CAC001
     C                     ADD  1         S                               CAC001
     C                     MOVE ' 620'    ERCD,S                          CAC001
     C                     MOVE *ON       *IN58                           CAC001
     C                     MOVE *ON       *IN75                           CAC001
     C                     MOVE *OFF      *IN80                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   E32543
     C           S         IFEQ 0                                         E32543
     C                     SETOF                     75                   E32543
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C**
     C*    IF NOT F3 AND ERRORS IN VALIDATION LOOP AROUND
     C**
     C           *IN01     IFEQ '0'                        ** B02
     C           *IN75     ANDEQ'1'
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP4                                           S01408
     C*                                                                   S01408
     C                     END                             ** E01
     C**
     C*    IF F3 NOT SELECTED PERFORM UPDATING
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP5                                           S01408
     C*                                                                   S01408
     C**
     C           *IN01     IFEQ '0'                        ** B01
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP6                                           S01408
     C*                                                                   S01408
     C* CALL WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S           S01241
     C* FT0080DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF         S01241
     C* CORE PGM (FT0080) AND RETURN CODE (7A, BUT BLANK HERE).           S01241
     C********** BGL5ST    IFEQ 'Y'                                 S01241S01251
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE DRPT      ##DRPT                                              CER001
     C                     MOVELDRPY      ##DRPY                                              CER001
     C                     Z-ADDCQAM      ##CQAM                                              CER001
     C                     MOVELDRCY      ##DRCY                                              CER001
     C                     MOVELDRBR      ##DRBR                                              CER001
      *                                                                                       CER001
     C                     MOVELPREF      PREF1                                               CER001
     C                     MOVE SCQSQ     SQCQ                                                CER001
     C                     MOVE SPREF     PREF                                                CER001
     C                     MOVE 'FT0080'  #1PGM     P                                         CER001
      *                                                                                       CER001
     C                     CALL 'FT0080A'                                                     CER001
     C                     PARM SACTD     #ACTN   1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           RTNCDE  7                                           CER001
     C                     PARM           SPARE 256                                           CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      ** Allocate dataarea to blanks                                                          CER001
      *                                                                                       CER001
     C                     EXSR DALLOC                                                        CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** Otherwise, F12 has been pressed so redisplay screen                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'USR0790'                                                     CER001
     C                     MOVE *OFF      *IN80                                               CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           BGWDPR    IFEQ 'Y'                                       S01251
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,FT0080MOV1                                           S01241
      *                                                                   S01241
      ** Payment reference is passed into Data to be passed into                              CER049
      ** Stamp Tax screen.                                                                    CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN                                              CER049
     C**********           MOVE *ZEROS    U#LNRF                                       CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF                                              CLE148
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *ZEROS    U#FACT                                              CER049
     C                     MOVE *ZEROS    U#FCNO                                              CER049
     C                     MOVE *ZEROS    U#FSEQ                                              CER049
     C                     MOVE *ZEROS    U#ORED                                              CER049
     C                     MOVE *ZEROS    U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *ZEROS    U#ACOD                                              CER049
     C                     MOVE *ZEROS    U#ACSQ                                              CER049
     C                     MOVE SPREF     U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE TRCM      U#AMNT                                              CER049
     C                     MOVE PCCY      U#TCCY                                              CER049
     C                     MOVE PVDT      U#VDAT                                              CER049
      *                                                                                       CER049
      ** Initialise work fields for account determination                                     CER049
      *                                                                                       CER049
     C                     MOVEL*BLANKS   @@TYP1                                              CER049
     C                     MOVEL*BLANKS   @@ACC1                                              CER049
     C                     MOVEL*BLANKS   @@TYP2                                              CER049
     C                     MOVEL*BLANKS   @@ACC2                                              CER049
     C                     MOVEL*BLANKS   @@CCY                                               CER049
      *                                                                                       CER049
      ** If "charges to the debit of" is entered                                              CER049
      *                                                                                       CER049
     C           CDRT      IFNE *BLANK                                                        CER049
      *                                                                                       CER049
      ** Check customer no. of "charges to the debit of"                                      CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C                     MOVELCDRT      @@TYP1                                              CER049
     C                     MOVELCDRO      W0FLD                                               CER049
     C           W0FLD     CAT  CDBR      @@ACC1    P                                         CER049
     C                     MOVELBJCYCD    @@CCY                                               CER049
      *                                                                                       CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** Check customer no. of the "credit party"                                             CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C           DRPT      IFNE *BLANK                                                        CER049
     C                     MOVELDRPT      @@TYP1                                              CER049
     C                     MOVELDRPY      W0FLD                                               CER049
     C           W0FLD     CAT  DRBR      @@ACC1    P                                         CER049
     C                     MOVELDRCY      @@CCY                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If Stamp Tax is switched on, call the Stamp Tax details screen.                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'GL008102'                                                    CER049
     C                     PARM SACTD     #ACTN                                               CER049
     C                     PARM           DATA                                                CER049
     C                     PARM *BLANKS   RTNCDE                                              CER049
      *                                                                                       CER049
      ** Process return code.                                                                 CER049
      *                                                                                       CER049
     C                     SELEC                                                              CER049
      *                                                                                       CER049
      ** If error                                                                             CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'ERROR  '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
      *                                                                                       CER049
      ** If F3 pressed in window screen, exit                                                 CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'EXIT   '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'PREV   '                                                   AR850937
     C                     MOVEL'Y'       WPROC                                             AR850937
     C                     ENDSL                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           RTNCDE    IFNE 'PREV   '                                                   AR850937
     C                     MOVE SACTD     #ACTN   1                       S01241
     C                     MOVE *BLANKS   RTNCDE  7                       S01241
     C                     MOVE *BLANKS   ##CMD   2                       S01241
     C                     MOVEL'FT0080'  ##PGM  10                       S01241
     C                     CALL 'WN0010'                                  S01241
     C                     PARM           ##PGM                           S01241
     C                     PARM           ##CMD                           S01241
     C                     PARM           #ACTN                           S01241
     C                     PARM           DATA                            S01241
     C**********           PARM           RTNCDE                    S01241S01252
     C                     PARM *BLANKS   RTNCDE                          S01252
     C                     PARM           SPARE 256                       S01252
     C                     ENDIF                                                            AR850937
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP7                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP8                                           S01408
     C*                                                                   S01408
     C*                                                                   S01241
     C           RTNCDE    IFEQ *BLANKS                                   S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CCP9                                           S01408
     C*                                                                   S01408
     C********** BGL5ST    ORNE 'Y'                                 S01241S01251
     C           BGWDPR    ORNE 'Y'                                       S01251
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP10                                           S01408
     C*                                                                   S01408
     C                     EXSR WRITDA
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP11                                           S01408
     C*                                                                   S01408
     C                     END                             ** E01
     C                     END                                            S01241
     C*
     C                     ENDSR
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP12                                           S01408
     C*                                                                   S01408
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    HEADD  - SR TO PROCESS DELETION OF A HEADER
     C**
     C           HEADD     BEGSR
     C**
     C*    SET UP  SCREEN
     C**
     C                     EXSR REHEAD
     C                     EXSR SETHED
     C**
     C*    PROCESS HEADER SCREEN
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C*
     C                     MOVE '1'       *IN80
     C*
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     EXFMTFT0080F2
     C                     MOVE IN78      *IN78                           CEU006
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       @RETC
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             ** E02
     C*
     C           *IN05     IFEQ '1'                        ** B02
     C                     MOVEA'111'     *IN,80
     C                     ELSE                            ** X02
     C           *IN04     IFEQ '1'                        ** B03
     C                     EXSR WRITHD
     C/COPY WNCPYSRC,FT0080C029
     C                     END                             ** E03
     C                     END                             ** E02
     C*
     C           *IN05     IFNE '1'                        ** B02
     C           *IN04     ANDNE'1'
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    DETLD  - SR TO PROCESS DELETION OF DETAILS
     C**
     C           DETLD     BEGSR
      *
      ** Disallow Call to FT0085 after 'detail' phase .
     C                     MOVE *BLANK    FLAG85  1
      *
     C**
     C*    SET UP  SCREEN
     C**
     C                     EXSR REDETL
     C                     EXSR SETDET
     C**
     C*    PROCESS DETAIL SCREEN
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C*
     C                     MOVE '1'       *IN80
     C/COPY WNCPYSRC,FT0080C046
     C*
     C                     MOVE STRCM     STRCMW 12
     C                     MOVE SCHCM     SCHCMW                          S01494
     C                     MOVE SCQAM     SCQSV  14
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     EXFMTFT0080F3
     C                     MOVE IN78      *IN78                           CEU006
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     MOVE '1'       *IN80
     C                     END                             ** E02
      *                                                                   CAC001
      **  Check if window processing required                             CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  If F19 is pressed, display Margin Information window            CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ '1'                                       CAC001
     C                     MOVE 'D'       WACTN                           CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
     C                     EXSR SRMGIN                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,FT0080C051
     C*
     C           *IN04     IFEQ '1'                        ** B02
     C* CALL WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S           S01241
     C* FT0080DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF         S01241
     C* CORE PGM (FT0080) AND RETURN CODE (7A, BUT BLANK HERE).           S01241
     C********** BGL5ST    IFEQ 'Y'                                 S01241S01251
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE DRPT      ##DRPT                                              CER001
     C                     MOVELDRPY      ##DRPY                                              CER001
     C                     Z-ADDCQAM      ##CQAM                                              CER001
     C                     MOVELDRCY      ##DRCY                                              CER001
     C                     MOVELDRBR      ##DRBR                                              CER001
      *                                                                                       CER001
     C                     MOVELPREF      PREF1                                               CER001
     C                     MOVE SCQSQ     SQCQ                                                CER001
      *                                                                                       CER001
     C                     CALL 'FT0080A'                                                     CER001
     C                     PARM SACTD     #ACTN   1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           RTNCDE  7                                           CER001
     C                     PARM           SPARE 256                                           CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      ** Allocate dataarea to blanks                                                          CER001
      *                                                                                       CER001
     C                     EXSR DALLOC                                                        CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** Otherwise, F12 has been pressed so redisplay screen                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'USR0790'                                                     CER001
     C                     MOVE *OFF      *IN80                                               CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           BGWDPR    IFEQ 'Y'                                       S01251
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,FT0080MOV2                                           S01241
      *                                                                   S01241
     C                     MOVE SACTD     #ACTN                           S01241
     C                     MOVE *BLANKS   RTNCDE                          S01241
     C                     MOVE *BLANKS   ##CMD                           S01241
     C                     MOVEL'FT0080'  ##PGM                           S01241
     C                     CALL 'WN0010'                                  S01241
     C                     PARM           ##PGM                           S01241
     C                     PARM           ##CMD                           S01241
     C                     PARM           #ACTN                           S01241
     C                     PARM           DATA                            S01241
     C**********           PARM           RTNCDE                    S01241S01252
     C                     PARM *BLANKS   RTNCDE                          S01252
     C                     PARM           SPARE 256                       S01252
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP13                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP14                                           S01408
     C*                                                                   S01408
     C*                                                                   S01241
     C           RTNCDE    IFEQ *BLANKS                                   S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP15                                           S01408
     C*                                                                   S01408
     C********** BGL5ST    ORNE 'Y'                                 S01241S01251
     C           BGWDPR    ORNE 'Y'                                       S01251
     C                     EXSR WRITDD
     C                     END                             ** E02
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP16                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C*
     C           *IN01     IFNE '1'                        ** B02
     C           *IN04     ANDNE'1'
     C                     MOVE '0'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP17                                           S01408
     C*                                                                   S01408
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    HEADE  - SR TO PROCESS ENQUIRY ON A HEADER
     C**
     C           HEADE     BEGSR
     C*
     C                     MOVE '0'       *IN82
     C                     SETOF                     80                   E29994
     C*********************                                               E29994
     C*********************                                               E29994
     C*****SET*UP**SCREEN**                                               E29994
     C*********************                                               E29994
     C*********************EXSR REHEAD                                    E29994
     C*********************EXSR SETHED                                    E29994
     C**
     C*    PROCESS HEADER SCREEN
     C**
      **           Or (if linked with FT0085) CK2 not returned.
      **
     C           *IN80     DOWEQ'0'                        ** B02
     C           PCMD      OREQ '2'
     C                     MOVE ' '       PCMD
     C*
     C**                                                                  E29994
     C*    SET UP  SCREEN                                                 E29994
     C**                                                                  E29994
     C                     EXSR REHEAD                                    E29994
     C                     EXSR SETHED                                    E29994
     C                     MOVE '1'       *IN80
     C*
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     EXFMTFT0080F2
     C                     MOVE IN78      *IN78                           CEU006
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN21     DOWEQ'1'                                       S01494
     C                     SETOF                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN01     IFEQ '0'                                       S01494
     C                     EXFMTFT0080F2                                  S01494
     C                     ELSE                                           S01494
     C                     SETOF                     21                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B03
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       @RETC
      *  Allocate dataarea to blanks                                      042167
     C                     EXSR DALLOC                                    042167
     C                     RETRN
     C                     END                             ** E03
     C*                                                                   E29970
     C           *IN07     IFEQ '1'                        ** B03         E29970
     C                     SETON                     LR                   E29970
     C                     MOVE '7'       @RETC                           E29970
      *  Allocate dataarea to blanks                                      042167
     C                     EXSR DALLOC                                    042167
     C                     RETRN                                          E29970
     C                     END                             ** E03         E29970
     C/COPY WNCPYSRC,FT0080C030
     C*
      *
      ** If program linked with FT0085 & no FK call 85.
     C           *IN05     IFNE '1'
     C***********FTLJ******ANDEQ'Y'                                       S01194
     C           BTLVJN    ANDEQ'Y'                                       S01194
     C           *IN05     ORNE '1'
     C           SLINK     ANDEQ'Y'
     C                     EXSR CALL85
     C                     END
     C/COPY WNCPYSRC,FT0080C031
      *
     C           *IN05     IFEQ '1'                        ** B03
     C                     MOVEA'111'     *IN,80
     C*
     C                     END                             ** E02
     C*********************END                                            E29994
     C**
     C*****IF*F12*NOT*TAKEN*PROCESS*DETAIL*ENQUIRY*******                 E29994
     C*IF F12,NOT TAKEN ON HEADER OR ON DETAIL                            E29994
     C**
     C           *IN05     IFEQ '0'                        ** B02
     C           PCMD      ANDNE'2'                                       E29994
     C                     Z-ADD1         CQSQ
     C                     EXSR DETLE
     C*                                                                   E29994
     C                     SETOF                     80                   E29994
     C*
     C***********@SORT*****COMP 'A'                      80               E29994
     C*
     C                     END                             ** E02
     C                     END                                            E29994
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    DETLE  - SR TO PROCESS ENQUIRY ON DETAILS
     C**
     C           DETLE     BEGSR
      *
     C***Disallow*Call*to*FT0085*after*'detail'*phase*.**                 E29994
     C*********************MOVE *BLANK    FLAG85  1                       E29994
      *
     C**
     C*    SET UP  SCREEN
     C**
     C                     EXSR REDETL
     C**
     C*    REDETL WILL HAVE SET CQSQ TO 0, SO RESET FROM STORED VALUE
     C**
     C                     Z-ADDCQSQSV    CQSQ
     C**
     C*    PROCESS DETAIL SCREENS UNTIL F3 OR 50TH SCREEN
     C**
     C           *IN80     DOWEQ'0'                        ** B01
     C/COPY WNCPYSRC,FT0080C047
     C*
     C*
     C           *IN89     DOUEQ'0'                        ** B02
     C                     EXSR SETDET
     C**
     C*   IF LIVE RECORD WASN'T FOUND LOOK FOR NEXT RECORD IF NOT 50TH
     C**
     C           *IN89     IFEQ '1'                        ** B03
     C           CQSQ      IFGE 50                         ** B04
     C                     GOTO ENDDTE
     C                     ELSE                            ** X04
     C                     ADD  1         CQSQ
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C*
     C                     MOVE STRCM     STRCMW 12
     C                     MOVE SCHCM     SCHCMW                          S01494
     C                     MOVE SCQAM     SCQSV  14
     C                     MOVE *IN78     IN78                            CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *OFF      *IN78                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *ON       *IN78                           CEU006
     C                     ENDIF                                          CEU006
     C                     EXFMTFT0080F3
     C                     MOVE IN78      *IN78                           CEU006
     C/COPY WNCPYSRC,FT0080C052
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN21     DOWEQ'1'                                       S01494
     C                     SETON                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN01     IFEQ '0'                                       S01494
     C                     SETOF                     05
     C                     EXFMTFT0080F3                                  S01494
     C                     ELSE                                           S01494
     C                     SETOF                     21                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   CAC001
      **  Check if window processing required                             CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  If F19 is pressed, display Margin Information window            CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ '1'                                       CAC001
     C                     MOVE 'E'       WACTN                           CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
     C                     EXSR SRMGIN                                    CAC001
     C                     ITER                                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C**
     C*    PROCESS F KEYS OR VALIDATE SCREEN
     C**
     C           *IN01     IFEQ '1'                        ** B02
     C                     SETON                     80
     C/COPY WNCPYSRC,FT0080C048
     C                     ELSE                            ** X02
     C* CALL WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S           S01241
     C* FT0080DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF         S01241
     C* CORE PGM (FT0080) AND RETURN CODE (7A, BUT BLANK HERE).           S01241
     C********** BGL5ST    IFEQ 'Y'                                 S01241S01251
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE DRPT      ##DRPT                                              CER001
     C                     MOVELDRPY      ##DRPY                                              CER001
     C                     Z-ADDCQAM      ##CQAM                                              CER001
     C                     MOVELDRCY      ##DRCY                                              CER001
     C                     MOVELDRBR      ##DRBR                                              CER001
      *                                                                                       CER001
     C                     MOVELPREF      PREF1                                               CER001
     C                     MOVE SCQSQ     SQCQ                                                CER001
      *                                                                                       CER001
     C                     CALL 'FT0080A'                                                     CER001
     C                     PARM SACTD     #ACTN   1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           RTNCDE  7                                           CER001
     C                     PARM           SPARE 256                                           CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      ** Allocate dataarea to blanks                                                          CER001
      *                                                                                       CER001
     C                     EXSR DALLOC                                                        CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** Otherwise, F12 has been pressed so redisplay screen                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'USR0790'                                                     CER001
     C                     MOVE *OFF      *IN80                                               CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           BGWDPR    IFEQ 'Y'                                       S01251
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,FT0080MOV3                                           S01241
      *                                                                                       CER049
      ** Payment reference is passed into Data to be passed into                              CER049
      ** Stamp Tax screen.                                                                    CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN                                              CER049
     C**********           MOVE *ZEROS    U#LNRF                                       CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF                                              CLE148
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *ZEROS    U#FACT                                              CER049
     C                     MOVE *ZEROS    U#FCNO                                              CER049
     C                     MOVE *ZEROS    U#FSEQ                                              CER049
     C                     MOVE *ZEROS    U#ORED                                              CER049
     C                     MOVE *ZEROS    U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *ZEROS    U#ACOD                                              CER049
     C                     MOVE *ZEROS    U#ACSQ                                              CER049
     C                     MOVE SPREF     U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE TRCH      U#AMNT                                              CER049
     C                     MOVE PCCY      U#TCCY                                              CER049
     C                     MOVE PVDT      U#VDAT                                              CER049
      *                                                                                       CER049
      ** Initialise work fields  for account determination                                    CER049
      *                                                                                       CER049
     C                     MOVEL*BLANKS   @@TYP1                                              CER049
     C                     MOVEL*BLANKS   @@ACC1                                              CER049
     C                     MOVEL*BLANKS   @@TYP2                                              CER049
     C                     MOVEL*BLANKS   @@ACC2                                              CER049
     C                     MOVEL*BLANKS   @@CCY                                               CER049
      *                                                                                       CER049
      ** If "charges to the debit of" is entered                                              CER049
      *                                                                                       CER049
     C           CDRT      IFNE *BLANK                                                        CER049
      *                                                                                       CER049
      ** Check customer no. of "charges to the debit of"                                      CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C                     MOVELCDRT      @@TYP1                                              CER049
     C                     MOVELCDRO      W0FLD                                               CER049
     C           W0FLD     CAT  CDBR      @@ACC1    P                                         CER049
     C                     MOVELBJCYCD    @@CCY                                               CER049
      *                                                                                       CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** Check customer no. of the "credit party"                                             CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C           DRPT      IFNE *BLANK                                                        CER049
     C                     MOVELDRPT      @@TYP1                                              CER049
     C                     MOVELDRPY      W0FLD                                               CER049
     C           W0FLD     CAT  DRBR      @@ACC1    P                                         CER049
     C                     MOVELDRCY      @@CCY                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If Stamp Tax is switched on, call the Stamp Tax details screen.                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'GL008102'                                                    CER049
     C                     PARM SACTD     #ACTN                                               CER049
     C                     PARM           DATA                                                CER049
     C                     PARM *BLANKS   RTNCDE                                              CER049
      *                                                                                       CER049
      ** Process return code.                                                                 CER049
      *                                                                                       CER049
     C                     SELEC                                                              CER049
      *                                                                                       CER049
      ** If error                                                                             CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'ERROR  '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
      *                                                                                       CER049
      ** If F3 pressed in window screen, exit                                                 CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'EXIT   '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
      *                                                                                       CER049
     C                     ENDSL                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   S01241
     C                     MOVE SACTD     #ACTN                           S01241
     C                     MOVE *BLANKS   RTNCDE                          S01241
     C                     MOVE *BLANKS   ##CMD                           S01241
     C                     MOVEL'FT0080'  ##PGM                           S01241
     C                     CALL 'WN0010'                                  S01241
     C                     PARM           ##PGM                           S01241
     C                     PARM           ##CMD                           S01241
     C                     PARM           #ACTN                           S01241
     C                     PARM           DATA                            S01241
     C**********           PARM           RTNCDE                    S01241S01252
     C                     PARM *BLANKS   RTNCDE                          S01252
     C                     PARM           SPARE 256                       S01252
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP18                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C/COPY WNCPYSRC,FT0080C053
     C                     ADD  1         CQSQ
     C                     END                             ** E02
     C/COPY WNCPYSRC,FT0080C049
     C**
     C*    IF 50TH SCREEN HAS BEEN PROCESSED TERMINATE LOOP
     C**
     C           CQSQ      IFGT 50                         ** B02
     C                     MOVE '1'       *IN80
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*
     C           ENDDTE    ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    REINIT - SR TO PROCESS REQUEST FOR INITIAL SCREEN
     C**
     C           REINIT    BEGSR
     C**
     C*    ENABLE FIRST SCREEN ONLY, WITH F12 BUT NOT F10
     C*
     C                     MOVEA'101'     *IN,71
     C                     MOVEA'01'      *IN,14
     C                     MOVE '1'       *IN24
     C**
     C*    RESET LOOP CONTROL, FIELD ERROR & ERROR CODE ARRAY INDICATORS
     C*
     C                     MOVE '0'       *IN80
     C*********************MOVEA'000'     *IN,40                          S01117
     C                     MOVEA'0000'    *IN,39                          S01117
     C                     MOVEA'0'       *IN,29                          S01414
     C                     MOVEA'00'      *IN,75
     C**
     C*    BLANK SCREEN FIELD & ERROR ARRAY & RESET ERROR ARRAY POINTER
     C*
     C           @PREF     IFEQ *BLANK
     C                     MOVE *BLANKS   SACTD
     C                     MOVE *BLANKS   SPREF
     C                     MOVE *BLANKS   SBRCA                           S01117
     C                     END
     C*
     C                     MOVE *BLANKS   SCQSQ
     C                     MOVE *BLANKS   ERCD
     C                     MOVE *BLANKS   RTNCDE                                            AR850937
     C                     MOVE 'Y'       WPROC   1                                         AR850937
     C                     Z-ADD0         S       20
      *                                                                                     BUG17124
     C                     CALL 'ZA0250'                                                    BUG17124
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    REHEAD - SR TO PROCESS REQUEST FOR BLANK HEADER SCREEN
     C**
     C           REHEAD    BEGSR
     C**
     C*    ENABLE HEADER SCREEN ONLY WITH F12 AND F10 IF 'D'
     C*
     C                     MOVEA'010'     *IN,71
     C                     MOVEA'01'      *IN,14
     C                     MOVE '1'       *IN24
     C                     MOVE '0'       *IN34                           S01117
     C*
     C           ACTION    IFEQ 'D'                        ** B01
     C                     MOVE '1'       *IN14
     C                     END                             ** E01
     C*
     C           ACTION    IFEQ 'E'                        ** B01
     C           ACTION    OREQ 'D'                        ** B01
     C                     MOVEA'11'      *IN,72
     C                     MOVE '0'       *IN24
     C                     END                             ** E01
     C*                                                                   S01117
     C** PROTECT ORIGINATING BRANCH FIELD IF ACTION NOT INSERT            S01117
     C*                                                                   S01117
     C           ACTION    IFNE 'I'                                       S01117
     C                     MOVE '1'       *IN34                           S01117
     C                     END                                            S01117
     C**
     C*    RESET LOOP CONTROL, FIELD ERROR & ERROR CODE ARRAY INDICATORS
     C*                                                                   S01499
     C                     MOVEA'00'      *IN,80
     C                     MOVEA'00000000'*IN,43
     C                     MOVEA'00000'   *IN,51
     C                     MOVEA'000'     *IN,68
     C                     MOVEA'00'      *IN,75
     C                     MOVEA'00'      *IN,26                          E32543
     C                     MOVE '0'       *IN23                           E32543
     C                     MOVEA'0'       *IN,37                          S01117
     C                     MOVE '0'       *IN25                           S01414
     C                     MOVE '0'       *IN33                           S01414
     C                     MOVE '0'       *IN06                           S01499
     C                     MOVE '0'       *IN12                           S01499
     C**
     C*    BLANK SCREEN FIELD & ERROR ARRAY & RESET ERROR ARRAY POINTER
     C*
     C                     MOVE *BLANKS   STATUS
     C                     MOVE *BLANKS   SCQSQ
     C                     MOVE *BLANKS   SPYTP
     C                     MOVE *BLANKS   SPYST
     C                     MOVE *BLANKS   SRBK1
     C                     MOVE *BLANKS   SRBK2
     C                     MOVE *BLANKS   SRBK3
     C                     MOVE *BLANKS   SRBK4
     C                     MOVE *BLANKS   SSNCO
     C                     MOVE *BLANKS   SPCCY
     C                     MOVE *BLANKS   SPYDT
     C                     MOVE *BLANKS   SPRRM
     C                     MOVE *BLANKS   STOTR
     C                     MOVE *BLANKS   SCOCH
     C                     MOVE *BLANKS   SDEDS
     C                     MOVE *BLANKS   SSTTP
     C                     MOVE *BLANKS   SSWPC
     C                     MOVE *BLANKS   SSNMT
     C                     MOVE *BLANKS   SPDCY                           CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
     C*
     C                     MOVE *BLANKS   STOTD
     C                     MOVE *BLANKS   SDIFF
     C*                                                                   S01414
     C                     MOVEL*BLANKS   SHBOKC                          S01414
     C                     MOVEL*BLANKS   SHPRFC                          S01414
     C*                                                                   S01414
     C                     MOVE *BLANKS   SBCCY1
     C                     MOVE *BLANKS   SBCCY2
     C                     MOVE *BLANKS   SPCCY1
     C                     MOVE *BLANKS   SPCCY2
     C                     MOVE *BLANKS   SCOCHR
     C                     MOVE *BLANKS   SDEDSR
     C                     MOVE *BLANKS   SORBR                           S01117
     C*
     C                     MOVE *BLANKS   SVATCO
     C                     MOVE *BLANKS   SVATCR
     C                     MOVE *BLANKS   SVATDE
     C                     MOVE *BLANKS   SVATDR
     C*
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S       20
     C*                                                                   S01499
     C** DEFAULT VAT FLAG.                                                S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     MOVE C#VATT    SCVAT1                          S01499
     C                     MOVE C#VATT    SCVAT2                          S01499
     C                     END                                            S01499
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    SETHED - SR TO SETUP HEADER SCREEN FOR AMEND/DELETE/ENQUIRY
     C**
     C           SETHED    BEGSR
     C*
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
    C           CQPACK    CHAINCQPACDDF             99
     C*
     C           *IN99     IFEQ '1'                        ** B01
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'E'       @RETC                           096486
     C                     SETON                     LR                   096486
     C                     RETRN                                          096486
     C                     ELSE                                           096486
     C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD06        WDBASE             * DBERR 06 *
     C                     MOVELCQPKEY    WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                                            096486
     C                     ELSE                            ** X01
     C                     EXCPTCQCREL
     C                     END                             ** E01
     C**
     C*    SAVE LAST CHANGE 'STAMP' FOR LATER AMEND
     C**
     C                     Z-ADDLCHT      LCHTHD  60
     C                     Z-ADDLCD       LCDHD   50
     C                     MOVE CHTP      CHTPHD  1
     C**
     C*    STORE 'OLD' VALUE OF PROCEEDS REMITTED & AUTHORIZED IND.
     C**
     C                     Z-ADDPRRM      PRRMOL
     C                     MOVE AUIN      AUINHD  1
     C**
     C*    MOVE DB FIELDS TO SCREEN FIELDS
     C*
     C                     MOVE *BLANKS   STATUS
     C           RECI      IFEQ 'M'                        ** B01
     C                     MOVEL'MATURED' STATUS
     C                     ELSE                            ** X01
     C           RECI      IFEQ 'C'                        ** B02
     C                     MOVEL'DELETED' STATUS
     C                     ELSE                            ** X02
     C           AUIN      IFEQ 'Y'                        ** B03
     C                     MOVEL'AUTHORIS'STATUS
     C                     MOVE 'ED'      STATUS
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C                     MOVE PYTP      SPYTP
     C                     MOVE PYST      SPYST
     C*                                                                   S01117
     C** IF SINGLE BRANCHED AND REMITTING BANK ENETERED AS FULL           S01117
     C** ACCOUNT FORMAT DSPF FIELD TO REMOVE BRANCH.                      S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'N'                                       S01117
     C           RBKT      ANDEQ'G'                                       S01117
     C**********           MOVELRBK1      RBKW   15                                    S01117 CGL029
     C                     MOVELRBK1      RBKW   21                                           CGL029
     C                     MOVELRBKW      SRBK1                           S01117
     C                     ELSE                                           S01117
     C                     MOVE RBK1      SRBK1
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE RBK2      SRBK2
     C                     MOVE RBK3      SRBK3
     C                     MOVE RBK4      SRBK4
     C                     MOVE ORBR      SORBR                           S01117
     C                     MOVE BRCH      SBRCA                           S01117
     C*
     C********** SNCO      IFEQ 0                          ** B01                            CSD027
     C           SNCO      IFEQ *BLANKS                    ** B01                            CSD027
     C                     MOVE *BLANKS   SSNCO
     C                     ELSE                            ** X01
     C           SNCT      IFEQ 'N'                        ** B02
     C                     MOVELSNCO      FLD2    2
     C                     MOVELFLD2      SSNCO
     C                     ELSE                            ** X02
     C                     MOVELSNCO      SSNCO
     C                     END                             ** E02
     C                     END                             ** E01
      *                                                                                       CSD015
      ** Save Previous values for Watch list checking                                         CSD015
      *                                                                                       CSD015
     C                     MOVE RBK1      PRBK1  35                                           CSD015
     C                     MOVE RBK2      PRBK2  35                                           CSD015
     C                     MOVE RBK3      PRBK3  35                                           CSD015
     C                     MOVE RBK4      PRBK4  35                                           CSD015
     C**********           Z-ADDSNCO      PSNCO  100                                   CSD015 CSD027
     C                     MOVELSNCO      PSNCO  10                                           CSD027
     C*
     C                     MOVE PCCY      SPCCY
     C                     Z-ADDPVDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SPYDT
     C                     MOVE STMT      SSTTP
     C/COPY WNCPYSRC,FT0080C004
     C*********************MOVE SWPC      SSWPC                           S01117
     C           SWPC      IFEQ 1                                         S01117
     C                     MOVE 'U'       SSWPC                           S01117
     C                     ELSE                                           S01117
     C           SWPC      IFEQ 2                                         S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE SNMT      SSNMT
     C*
     C*********************MOVE BCCY      SBCCY1                          S01194
     C*********************MOVE BCCY      SBCCY2                          S01194
     C                     MOVE BJCYCD    SBCCY1                          S01194
     C                     MOVE BJCYCD    SBCCY2                          S01194
     C                     MOVE PCCY      SPCCY1
     C                     MOVE PCCY      SPCCY2
     C**
     C*    ACCESS PAY CCY D.P. AND REFORMAT AMOUNTS
     C**
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE PCCY      ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C                     MOVE *BLANKS   @CCY    3                       S01194
     C                     MOVE PCCY      @CCY                            S01194
     C                     EXSR CCYCHN
     C*
     C*********************Z-ADDSPOT      PCCYSP                          S01194
     C                     Z-ADDA6SPRT    PCCYSP                          S01194
     C                     Z-ADDMDIN      PCCYMD
     C                     Z-ADDA6NBDP    PCCYDP                          S01194
     C*********************Z-ADDCDP       PCCYDP                          S01194
     C*
     C*********************Z-ADDPCCYDP    CDP                             S01194
     C                     Z-ADDPCCYDP    A6NBDP                          S01194
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE PRRM      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      SPRRM
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE TOTR      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      STOTR
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE TOTD      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      STOTD
     C*
     C                     MOVE ' '       DIFFSN
     C                     Z-ADDDIFF      WDIFF
     C           WDIFF     IFLT 0                          ** B01
     C                     Z-SUBWDIFF     WDIFF
     C                     MOVE '-'       DIFFSN
     C                     END                             ** E01
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE WDIFF     EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      SDIFF
     C                     MOVE '0'       *IN68
     C           DIFF      IFNE 0                          ** B01
     C                     MOVE '1'       *IN68
     C                     END                             ** E01
     C*
     C*********************Z-ADDPCCYDP    CDP                             S01194
     C                     Z-ADDPCCYDP    A6NBDP                          S01194
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE COCH      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCOCH
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE DEDS      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SDEDS
     C*                                                                   S01499
     C** FORMAT SCREEN FIELDS IF VAT FEATURE IS ON.                       S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PCVATC    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATCO                          S01499
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PCVATD    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATDE                          S01499
     C*                                                                   S01499
     C                     MOVE PCVAT1    SCVAT1                          S01499
     C                     MOVE PCVAT2    SCVAT2                          S01499
     C                     END                                            S01499
     C*                                                                   S01414
     C                     MOVELHBOKC     SHBOKC                          S01414
     C                     MOVELHPRFC     SHPRFC                          S01414
     C*                                                                   S01414
     C**
     C*    CALCULATE BASE CCY EQUIVALENT OF COLLECTION CHARGE
     C*      AND DEDUCTIONS IF PAY CCY <> BASE CCY
     C**
     C***********PCCY******IFNE BCCY                       ** B01         S01194
     C           PCCY      IFNE BJCYCD                     ** B01         S01194
     C*
     C                     Z-ADDPCCYSP    XSPOT1
     C                     Z-ADDPCCYMD    XMDIN1
     C                     Z-ADDPCCYDP    XCDP1
     C                     Z-ADD1         XSPOT2
     C                     Z-ADDBCCYMD    XMDIN2
     C                     Z-ADDBCCYDP    XCDP2
     C*
     C                     Z-ADDCOCH      XAMNT1
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           COCH      ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE PCCY      P#DBCY                          CEU006
     C                     Z-ADDPVDT      P#DBDT                          CEU006
     C                     MOVE BJCYCD    P#CRCY                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT
     C                     ENDIF                                          CEU006
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE XAMNT2    EDITIN
     C*********************Z-ADDBCCYDP    CDP                             S01194
     C                     Z-ADDBCCYDP    A6NBDP                          S01194
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCOCHR
     C*
     C                     Z-ADDDEDS      XAMNT1
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           DEDS      ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE PCCY      P#DBCY                          CEU006
     C                     Z-ADDPVDT      P#DBDT                          CEU006
     C                     MOVE BJCYCD    P#CRCY                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT
     C                     ENDIF                                          CEU006
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE XAMNT2    EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SDEDSR
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     Z-ADDPCVATC    XAMNT1                          S01499
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           PCVATC    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE PCCY      P#DBCY                          CEU006
     C                     Z-ADDPVDT      P#DBDT                          CEU006
     C                     MOVE BJCYCD    P#CRCY                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT                                    S01499
     C                     ENDIF                                          CEU006
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE XAMNT2    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATCR                          S01499
     C*                                                                   S01499
     C                     Z-ADDPCVATD    XAMNT1                          S01499
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           PCVATD    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE PCCY      P#DBCY                          CEU006
     C                     Z-ADDPVDT      P#DBDT                          CEU006
     C                     MOVE BJCYCD    P#CRCY                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT                                    S01499
     C                     ENDIF                                          CEU006
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE XAMNT2    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATDR                          S01499
     C                     END                                            S01499
     C                     ELSE                            ** X01
     C*
     C                     MOVE SCOCH     SCOCHR
     C                     MOVE SDEDS     SDEDSR
     C                     MOVE SVATCO    SVATCR                          S01499
     C                     MOVE SVATDE    SVATDR                          S01499
     C                     END                             ** E01
     C*                                                                   CEU006
     C**  Access Pay Delivery Currency and reformat amounts.              CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           PDCY      ANDNE*BLANKS                                   CEU006
     C                     MOVE PDCY      SPDCY                           CEU006
     C                     MOVE *BLANKS   @CCY                            CEU006
     C                     MOVE PDCY      @CCY                            CEU006
     C                     EXSR CCYCHN                                    CEU006
     C*                                                                   CEU006
     C                     MOVE *BLANKS   EDITIN                          CEU006
     C                     MOVE PDAM      EDITIN                          CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SPDAM                           CEU006
     C                     ENDIF                                          CEU006
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT                                                              S01494
     C*****************************************************************   S01494
     C*                                                               *   S01494
     C*  S/R #LADDI - DISPLAY ADDITIONAL INFO FOR ENQUIRY             *   S01494
     C*                                                               *   S01494
     C*  CALLED FROM  HEADE, DETLE                                    *   S01494
     C*                                                               *   S01494
     C*****************************************************************   S01494
     C*                                                                   S01494
     C           #LADDI    BEGSR                                          S01494
     C*                                                                   S01494
     C** INITIALIZE SCREEN FIELDS                                         S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SUSRP1                          S01494
     C                     MOVE *BLANKS   SUSER1                          S01494
     C                     MOVE *BLANKS   SUSRP2                          S01494
     C                     MOVE *BLANKS   SUSER2                          S01494
     C                     MOVE *BLANKS   SAUP1                           S01494
     C                     MOVE *BLANKS   SAUT1                           S01494
     C                     MOVE *BLANKS   SAUP2                           S01494
     C                     MOVE *BLANKS   SAUT2                           S01494
     C*                                                                   S01494
     C** RETRIEVE USER PROFILE NAME OF INPUT USER 1.                      S01494
     C*                                                                   S01494
     C                     MOVELINUSR1    SUSRP1                          S01494
     C           INUSR1    IFNE *BLANKS                                   S01494
     C           INUSR1    CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SUSER1                          S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SUSER1                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** RETRIEVE USER PROFILE NAME OF INPUT USER 1 AND AUTHORISING       S01494
     C** USER 1 AND 2 FOR CHEQUE HEADER SCREEN.                           S01494
     C*                                                                   S01494
     C           *IN17     IFNE '1'                                       S01494
     C*                                                                   S01494
     C                     MOVELINUSR2    SUSRP2                          S01494
     C           INUSR2    IFNE *BLANKS                                   S01494
     C           INUSR2    CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SUSER2                          S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SUSER2                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVELAUP1      SAUP1                           S01494
     C           AUP1      IFNE *BLANKS                                   S01494
     C           AUP1      CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT1                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT1                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVELAUP2      SAUP2                           S01494
     C           AUP2      IFNE *BLANKS                                   S01494
     C           AUP2      CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT2                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT2                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** DISPLAY WINDOW.                                                  S01494
     C*                                                                   S01494
     C                     EXFMTFT0080F4                                  S01494
     C*                                                                   S01494
     C                     ENDSR                                          S01494
     C/EJECT
     C********************************************************************
     C**
     C*    REDETL - SR TO PROCESS REQUEST FOR BLANK DETAIL SCREEN
     C**
     C           REDETL    BEGSR
     C**
     C*    ENABLE DETAIL SCREEN WITH F10   IF 'D'
     C**
     C                     MOVE '0'       *IN74
     C                     MOVEA'00'      *IN,14
     C                     MOVE '1'       *IN24
     C*
     C           ACTION    IFEQ 'D'                        ** B01
     C                     MOVE '1'       *IN14
     C                     END                             ** E01
     C*
     C           ACTION    IFEQ 'E'                        ** B01
     C           ACTION    OREQ 'D'                        ** B01
     C                     MOVE '1'       *IN74
     C                     MOVE '0'       *IN24
     C                     END                             ** E01
     C**
     C*    RESET LOOP CONTROL INDICATOR
     C*
     C                     MOVEA'000'     *IN,80
     C                     MOVEA'00'      *IN,26                          E32543
     C**
     C*    SAVE CURRENT VALUE OF CHEQUE SEQUENCE
     C**
     C                     Z-ADDCQSQ      CQSQSV  20
     C**
     C*    ACCESS HEADER TO OBTAIN NEXT AUTHORIZED INDICATOR AND
     C*      PAY CURRENCY
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
     C*
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD07        WDBASE             * DBERR 07 *
     C                     MOVELCQPKEY    WDBKEY             ************
     C                     EXSR ENDPGM
     C                     ELSE                            ** X01
     C                     EXCPTCQCREL
     C                     END                             ** E01
     C**
     C*    RESTORE 'CURRENT' VALUE OF CHEQUE SEQUENCE
     C**
     C                     Z-ADDCQSQSV    CQSQ
     C**
     C*    ACCESS CURRENCY RECORD 1 FOR PAY CURRENCY DETAILS
     C**
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE PCCY      ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C                     MOVE *BLANKS   @CCY                            S01194
     C                     MOVE PCCY      @CCY                            S01194
     C                     EXSR CCYCHN
     C*
     C*********************Z-ADDSPOT      PCCYSP                          S01194
     C                     Z-ADDA6SPRT    PCCYSP                          S01194
     C                     Z-ADDMDIN      PCCYMD
     C                     Z-ADDA6NBDP    PCCYDP                          S01194
     C*********************Z-ADDCDP       PCCYDP                          S01194
     C**
     C*    BLANK OUTPUT ONLY SCREEN FIELDS
     C**
     C                     MOVE *BLANKS   STRCMD
     C                     MOVE *BLANKS   SCLCHD
     C                     MOVE *BLANKS   SCSTAD
     C                     MOVE *BLANKS   SCGCY   3
     C                     MOVE *BLANKS   CHCCY
     C                     MOVE *BLANKS   SCHCMD                          S01494
     C                     MOVE *BLANKS   SVATTD                          S01499
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVE *ON       *IN18                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVE *OFF      *IN18                                               CER049
     C                     ENDIF                                                              CER049
     C*
     C                     EXSR BLKDET
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    SETDET - SR TO SET UP DETAIL SCREEN FOR OUTPUT
     C**
     C           SETDET    BEGSR
     C**
     C/COPY WNCPYSRC,FT0080C073
     C*    ACCESS RECORD FOR DETAILS
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADDCQSQ      CQSQKY
     C           CQPACK    CHAINCQPADDDF             89
     C**
     C*    IF RECORD NOT FOUND/NOT LIVE EXIT SUBROUTINE
     C**
     C           *IN89     IFEQ '1'                        ** B01
     C                     GOTO ENDSDT
     C                     ELSE                            ** X01
     C                     EXCPTCQDREL
     C                     END                             ** E01
     C**
     C*    SAVE LAST CHANGE 'STAMP' FOR LATER AMEND
     C**
     C                     Z-ADDLCHT      LCHTDT  60
     C                     Z-ADDLCD       LCDDT   50
     C                     MOVE CHTP      CHTPDT  1
     C**
     C*    STORE 'OLD' VALUE OF CHEQUE AMOUNT
     C**
     C                     Z-ADDCQAM      CQAMOL
      *                                                                   CAC001
      **  Save transaction rate, debit currency, and cheque amount        CAC001
      *                                                                   CAC001
     C                     Z-ADDRATE      WSVRT  138                      CAC001
     C                     MOVE DRCY      WSVCY   3                       CAC001
     C                     Z-ADDCQAM      WSVAM  130                      CAC001
      *                                                                   CAC001
      **  Setup margin information details                                CAC001
      *                                                                   CAC001
     C                     Z-ADDFXMP      WOFXMP  72                      CAC001
     C                     MOVE FXMD      WOFXMD  10                      CAC001
     C                     MOVE MBSI      WOMBSI  1                       CAC001
     C                     MOVE MSIG      WOMSIG  1                       CAC001
     C                     Z-ADDMAMT      WOMAMT 130                      CAC001
     C**
     C*    MOVE DETAILS TO SCREEN FIELDS
     C**
     C                     MOVE PREF      SPREF
     C                     MOVE CQSQ      SCQSQ
     C*
     C                     MOVE *BLANKS   STATUS
     C           RECI      IFEQ 'M'                        ** B01
     C                     MOVEL'MATURED' STATUS
     C                     ELSE                            ** X01
     C           RECI      IFEQ 'C'                        ** B02
     C                     MOVEL'DELETED' STATUS
     C                     ELSE                            ** X02
     C           AUINHD    IFEQ 'Y'                        ** B03
     C                     MOVEL'AUTHORIS'STATUS
     C                     MOVE 'ED'      STATUS
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C                     MOVE *BLANKS   SDRPY
     C                     MOVE *BLANKS   SDRBR                           S01117
     C           DRPT      IFEQ 'N'                        ** B01
     C                     MOVELDRPY      FLD2    2
     C                     MOVELFLD2      SDRPY
     C                     ELSE                            ** X01
     C           DRPT      IFEQ 'R'                        ** B02
     C                     MOVELDRPY      FLD10  10
     C                     MOVELFLD10     SDRPY
     C                     ELSE                            ** X02
     C                     MOVELDRPY      SDRPY
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     MOVE DRBR      SDRBR                           S01117
     C                     END                                            S01117
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   S01508
     C**  Save previous file values of "debit party"                      S01508
     C*                                                                   S01508
     C/COPY WNCPYSRC,FT0080C032
     C                     MOVE DRPT      WFDRPT  1                       S01508
     C**********           MOVELDRPY      WFDRPY 12                                    S01508 CGL029
     C                     MOVELDRPY      WFDRPY 18                                           CGL029
     C                     MOVE DRBR      WFDRBR  3                       S01508
     C**********           Z-ADDDRPY      PDRPY  120                                   CSD015 CGL029
     C***********          Z-ADDDRPY      PDRPY  180                                   CGL029 CSD027
     C                     MOVE DRPY      PDRPY  18                                           CSD027
     C*
     C*********************Z-ADDPCCYDP    CDP                             S01194
     C                     Z-ADDPCCYDP    A6NBDP                          S01194
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE CQAM      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      SCQAM
     C*
     C                     MOVE DRCY      SDRCY
     C*                                                                   S01508
     C**  Store previous value of debit currency                          S01508
     C*                                                                   S01508
     C                     MOVE DRCY      WFDRCY  3                       S01508
     C*                                                                   S01508
     C                     Z-ADDDRVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDRVD
     C*
     C*********************Z-ADD8         CDP                             S01194
     C                     Z-ADD8         A6NBDP                          S01194
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE RATE      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2      SRATE
     C*
     C                     MOVE OVRD      SOVRD
     C*                                                                   S01414
     C                     MOVELBOKC      SBOKC                           S01414
     C                     MOVELPRFC      SPRFC                           S01414
     C*                                                                   S01414
     C                     MOVE TRCT      STRCT
     C*
     C                     MOVE *BLANKS   SCDRO
     C                     MOVE *BLANKS   SCDBR                           S01117
     C***********CDRO      IFNE 0                          ** B01                             CSD027
     C           CDRO      IFNE *BLANKS                    ** B01                             CSD027
     C           CDRT      IFEQ 'N'                        ** B02
     C                     MOVELCDRO      FLD2    2
     C                     MOVELFLD2      SCDRO
     C                     ELSE                            ** X02
     C           CDRT      IFEQ 'R'                        ** B03
     C                     MOVELCDRO      FLD10  10
     C                     MOVELFLD10     SCDRO
     C                     ELSE                            ** X03
     C                     MOVELCDRO      SCDRO
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     MOVE CDBR      SCDBR                           S01117
     C                     END
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C033
     C           CDL049    IFEQ 'Y'                                       CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   ZFIELD                          CDL049
     C                     MOVE CPRRAT    ZFIELD                          CDL049
      *                                                                   CDL049
     C                     CALL 'ZEDIT'                9090               CDL049
     C                     PARM           ZFIELD 16                       CDL049
     C                     PARM 8         ZADEC   10                      CDL049
      *                                                                   CDL049
     C                     MOVE ZFIELD    S#REFR                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C*                                                                   S01508
     C** Save previous file values of "charges to the debit of"           S01508
     C*                                                                   S01508
     C                     MOVE CDRT      WFCDRT  1                       S01508
     C**********           MOVELCDRO      WFCDRO 12                                    S01508 CGL029
     C                     MOVELCDRO      WFCDRO 18                                           CGL029
     C                     MOVE CDBR      WFCDBR  3                       S01508
     C**********           Z-ADDCDRO      PCDRO  120                                   CSD015 CGL029
     C***********          Z-ADDCDRO      PCDRO  180                                   CGL029 CSD027
     C                     MOVE CDRO      PCDRO  18                                           CSD027
     C/COPY WNCPYSRC,FT0080C062
     C*
     C           DNBC      IFNE 0
     C/COPY WNCPYSRC,FT0080C063
     C                     MOVE DNBC      SDNBC
     C                     EXSR #CBREF                                    035398
     C                     ELSE
     C                     MOVE *BLANKS   SDNBC
     C                     END
      *
     C*
     C*    CHARGE CCY FOR DISPLAY OF CHARGES IS BASE IF CHARGES TO THE
     C*      DEBIT OF ACCOUNT IS ENTERED ELSE IT IS DEBIT CCY
     C*
     C***********CDRO      IFEQ 0                                                             CSD027
     C           CDRO      IFEQ *BLANKS                                                       CSD027
     C                     MOVE DRCY      BORDCY
     C                     ELSE                            ** X01
     C*********************MOVE BCCY      BORDCY                          S01194
     C                     MOVE BJCYCD    BORDCY                          S01194
     C                     END                             ** E01
      *
      ** Get number of decimal places
      **   and currency code for Charges entry.
     C                     EXSR GETGCY
      *
     C**
     C*    ACCESS CURRENCY RECORD 1 FOR DEBIT CURRENCY DETAILS
     C**
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE DRCY      ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C                     MOVE *BLANKS   @CCY                            S01194
     C                     MOVE DRCY      @CCY                            S01194
     C                     EXSR CCYCHN
     C*
     C*********************Z-ADDSPOT      DRCYSP                          S01194
     C                     Z-ADDA6SPRT    DRCYSP                          S01194
     C                     Z-ADDMDIN      DRCYMD
     C                     Z-ADDA6NBDP    DRCYDP                          S01194
     C*********************Z-ADDCDP       DRCYDP                          S01194
     C**
     C***         EDIT CHARGES FOR CHARGE CCY (DEBIT OR BASE AS APPROPRIATE)
     C**
     C***********CDRO      IFEQ 0                          ** B01                             CSD027
     C           CDRO      IFEQ *BLANKS                    ** B01                             CSD027
     C*********************Z-ADDDRCYDP    CDP                             S01194
     C                     Z-ADDDRCYDP    A6NBDP                          S01194
     C                     ELSE                            ** X01
     C*********************Z-ADDBCCYDP    CDP                             S01194
     C                     Z-ADDBCCYDP    A6NBDP                          S01194
     C                     END                             ** E01
     C*                                                                   S01494
     C                     MOVE *BLANKS   STRCMD                          S01494
     C           TRCM      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE TRCM      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    STRCMD
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SCLCHD                          S01494
     C           COLL      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C***                  MOVE CLCH      EDITIN
     C***                  MOVE COLC      EDITIN
     C                     MOVE COLL      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCLCHD
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SCSTAD                          S01494
     C           CSTA      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE CSTA      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCSTAD
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SCHCMD                          S01494
     C           *IN09     IFEQ '1'                                       S01494
     C           PDCHCM    ANDNE0                                         S01494
     C                     MOVE *BLANKS   EDITIN                          S01494
     C                     MOVE PDCHCM    EDITIN                          S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVEADIG2,3    SCHCMD                          S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C                     MOVE *BLANKS   SVATTD                          S01494
     C           *IN08     IFEQ '1'                                       S01499
     C           PDVATT    ANDNE0                                         S01494
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PDVATT    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATTD                          S01499
     C                     END                                            S01499
     C**
     C***********CDRO      IFEQ 0                          ** B01                             CSD027
     C           CDRO      IFEQ *BLANKS                    ** B01                             CSD027
     C                     MOVE DRCY      CHCCY   3
     C                     ELSE                            ** X01
     C*********************MOVE BCCY      CHCCY                           S01194
     C                     MOVE BJCYCD    CHCCY                           S01194
     C                     END                             ** E01
     C*
      *
      ** Edit charge entry currency amounts.
     C           CHCCY     IFNE SCGCY
      *
     C           TRCH      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE TRCH      EDITIN
     C*********************Z-ADDECDP      CDP                             S01194
     C                     Z-ADDECDP      A6NBDP                          S01194
     C                     EXSR EDIT
     C                     MOVEADIG2,3    STRCM
     C                     END                                            S01494
     C*
     C           COLH      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE COLH      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCLCH
     C                     END                                            S01494
     C*
     C           CSTH      IFNE 0                                         S01494
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE CSTH      EDITIN
     C                     EXSR EDIT
     C                     MOVEADIG2,3    SCSTA
     C                     END                                            S01494
     C*
     C           *IN09     IFEQ '1'                                       S01494
     C           PDCHCH    ANDNE0                                         S01494
     C                     MOVE *BLANKS   EDITIN                          S01494
     C                     MOVE PDCHCH    EDITIN                          S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVEADIG2,3    SCHCM                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           PDVATH    ANDNE0                                         S01494
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PDVATH    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATT                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     ELSE                            ** X01
     C*
     C                     MOVE STRCMD    STRCM
     C                     MOVE SCLCHD    SCLCH
     C                     MOVE SCSTAD    SCSTA
     C                     MOVE SCHCMD    SCHCM                           S01494
     C                     MOVE SVATTD    SVATT                           S01499
     C*
     C                     END                             ** E01
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     MOVE PDVAT1    SVATI1                          S01499
     C                     MOVE PDVAT2    SVATI2                          S01499
     C                     MOVE PDVAT3    SVATI3                          S01499
     C                     MOVE PDVAT4    SVATI4                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C* STORE TRANSFER COMMISSION TO SEE IF HAS CHANGED FOR
     C* RECALCULATION TO DEFAULT IF HAS NOT BUT TARIFF HAS
     C*
     C                     MOVE STRCM     STRCMW 12
     C                     MOVE SCQAM     SCQSV  14
     C                     MOVE SCHCM     SCHCMW                          S01494
     C*
      *
      ** Store Charge Entry amounts - to check for amendment.
      ** (done to reduce rounding errors from conversion base to entry
      **             and back again).
     C           *LIKE     DEFN STRCM     STRCMX
     C           *LIKE     DEFN SCLCH     SCLCHX
     C           *LIKE     DEFN SCSTA     SCSTAX
     C                     MOVE STRCM     STRCMX
     C                     MOVE SCLCH     SCLCHX
     C                     MOVE SCSTA     SCSTAX
     C                     MOVE SCGCY     SCGCYX
     C*                                                                   CEU006
     C**  Access Notify Delivery Currency and reformat amounts.           CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           NDCY      ANDNE*BLANKS                                   CEU006
     C                     MOVE NDCY      SNDCY                           CEU006
     C                     MOVE *BLANKS   @CCY                            CEU006
     C                     MOVE NDCY      @CCY                            CEU006
     C                     EXSR CCYCHN                                    CEU006
     C*                                                                   CEU006
     C                     MOVE *BLANKS   EDITIN                          CEU006
     C                     MOVE NDAM      EDITIN                          CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SNDAM                           CEU006
     C*                                                                   CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     MOVE *BLANKS   SNDCY                           CEU006
     C                     ENDIF                                          CEU006
     C/COPY WNCPYSRC,FT0080C074
      *
     C           ENDSDT    ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    BLKDET - SR TO BLANK OUT DETAIL SCREEN
     C**
     C           BLKDET    BEGSR
     C**
     C*    RESET FIELD ERROR & ERROR CODE ARRAY INDICATORS
     C                     MOVEA'00000000'*IN,56
     C                     MOVEA'0000'    *IN,64
     C                     MOVEA'000'     *IN,83                          S01499
     C                     MOVEA'00'      *IN,75
     C                     MOVE '0'       *IN,25                          S01414
     C                     MOVE '0'       *IN,33                          S01414
     C                     MOVE '0'       *IN20                           S01494
     C                     MOVE '0'       *IN13                           S01499
     C                     MOVE '0'       *IN87                           S01499
     C**
     C*    BLANK SCREEN FIELDS & ERROR ARRAY & RESET ERROR ARRAY POINTER
     C**
     C                     MOVE PREF      SPREF
     C                     MOVE *BLANKS   SCQSQ
     C                     MOVE *BLANKS   STATUS
     C                     MOVE *BLANKS   SDRPY
     C                     MOVE *BLANKS   SDRBR                           S01117
     C                     MOVE *BLANKS   SCQAM
     C                     MOVE *BLANKS   SDRCY
     C                     MOVE *BLANKS   SDRVD
     C                     MOVE *BLANKS   SRATE
     C                     MOVE *BLANKS   SOVRD
     C                     MOVEL*BLANKS   SNDCY                           CEU006
     C                     MOVEL*BLANKS   SNDAM                           CEU006
     C*                                                                   S01414
     C                     MOVEL*BLANKS   SBOKC                           S01414
     C                     MOVEL*BLANKS   SPRFC                           S01414
     C*                                                                   S01414
     C/COPY WNCPYSRC,FT0080C016
     C           CDL049    IFEQ 'N'                                       CDL049
     C                     MOVE '1'       *IN40                           CDL049
     C                     ELSE                                           CDL049
     C                     MOVEA'00'      *IN,40                          CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   STRCT
     C/COPY WNCPYSRC,FT0080C018
     C                     MOVE *BLANKS   STRCM
     C                     MOVE *BLANKS   SCLCH
     C                     MOVE *BLANKS   SCSTA
     C                     MOVE *BLANKS   SCDRO
     C                     MOVE *BLANKS   SCDBR                           S01117
     C                     MOVE *BLANKS   SDNBC
     C*                                                                   S01494
     C                     MOVE *BLANKS   SCHCM                           S01494
     C                     MOVE *BLANKS   SVATT                           S01499
     C*                                                                   S01494
     C                     Z-ADD*ZEROS    PDCHCH                          S01494
     C                     Z-ADD*ZEROS    PDCHCM                          S01494
     C*                                                                   S01508
     C**  Blank out work fields                                           S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   WFDRPT                          S01508
     C                     MOVE *BLANKS   WFDRPY                          S01508
     C                     MOVE *BLANKS   WFDRBR                          S01508
     C                     MOVE *BLANKS   WFDRCY                          S01508
     C                     MOVE *BLANKS   WFCDRT                          S01508
     C                     MOVE *BLANKS   WFCDRO                          S01508
     C                     MOVE *BLANKS   WFCDBR                          S01508
     C*                                                                   S01499
     C** DEFAULT VAT FLAG                                                 S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     MOVE C#VATT    SVATI1                          S01499
     C                     MOVE C#VATT    SVATI2                          S01499
     C                     MOVE C#VATT    SVATI3                          S01499
     C           *IN09     IFEQ '1'                                       S01494
     C                     MOVE C#VATT    SVATI4                          S01499
     C                     END                                            S01494
     C                     END                                            S01499
     C*
     C**  Initialise margin information output fields                     CAC001
     C*                                                                   CAC001
     C                     Z-ADD*ZEROS    WOFXMP                          CAC001
     C                     Z-ADD*ZEROS    WOFXMD                          CAC001
     C                     MOVE *BLANKS   WOMBSI                          CAC001
     C                     MOVE *BLANKS   WOMSIG                          CAC001
     C                     Z-ADD*ZEROS    WOMAMT                          CAC001
     C*                                                                   CAC001
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S       20
     C/COPY WNCPYSRC,FT0080C054
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    VALI  - SR TO VALIDATE INITIAL SCREEN
     C**
     C           VALI      BEGSR
     C**
     C/COPY WNCPYSRC,FT0080C075
     C*  CLEAR ERROR CODES ARRAY, RESET POINTER, RESET FIELD ERROR
     C*    AND ERROR CODE ARRAY INDICATORS
     C**
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     MOVEA'000'     *IN,40
     C                     MOVEA'00'      *IN,75
     C** SETOFF BRANCH ERROR IND                                          S01117
     C*                                                                   S01117
     C                     SETOF                     39                   S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C** RESET ORIGINATING BRANCH FIELD FOR SPF AUTHORISATION             S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ORBR                            S01117
     C*                                                                   S01117
     C**
     C*  ACTION IS MANDATORY, MUST BE 'I','A','D' OR 'E'
     C**
     C           SACTD     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 083'    ERCD,S                          S01117
     C                     MOVE ' 002'    ERCD,S                          S01117
     C                     MOVE '1'       *IN40
     C                     ELSE                            ** X01
     C*
     C           SACTD     IFNE 'I'                        ** B02
     C           SACTD     ANDNE'A'
     C           SACTD     ANDNE'D'
     C           SACTD     ANDNE'E'
     C                     ADD  1         S
     C*********************MOVE ' 084'    ERCD,S                          S01117
     C                     MOVE ' 003'    ERCD,S                          S01117
     C                     MOVE '1'       *IN40
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   S01117
     C**  BOOKING BRANCH FIELD PROHIBITED IF A, E OR D OR IF CHEQUE       S01117
     C** SEQUENCE OR PAYMENT REFERENCE ARE ENTERED.                       S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'Y'                        ** B01         S01117
     C           SBRCA     ANDNE*BLANKS                                   S01117
     C           SACTD     IFEQ 'A'                        ** B02         S01117
     C           SACTD     OREQ 'E'                                       S01117
     C           SACTD     OREQ 'D'                                       S01117
     C                     SETON                       3940               S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 015'    ERCD,S                          S01117
     C                     END                             ** E02         S01117
     C*                                                                   S01117
     C           SPREF     IFNE *BLANKS                    ** B03         S01117
     C           SCQSQ     ORNE *BLANKS                                   S01117
     C           SACTD     IFEQ 'I'                        ** B04         S01117
     C                     SETON                       3940               S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 016'    ERCD,S                          S01117
     C                     END                             ** E04         S01117
     C                     END                             ** E03         S01117
     C                     END                             ** E01         S01117
     C**
     C*  PAYMENT REF. IS PERMITTED FOR ACTION 'I' ONLY IF THE HEADER
     C*    RECORD ON PF/CQPACDD ALREADY EXISTS
     C**
     C           SPREF     IFNE *BLANKS                    ** B01
     C           SACTD     ANDEQ'I'
     C*
     C                     MOVE SPREF     PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             41
     C***        CQPACK    CHAINCQPAC                41
     C*
     C           *IN41     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 318'    ERCD,S                          S01117
     C                     MOVE ' 009'    ERCD,S                          S01117
     C                     ELSE                            ** X02
     C                     EXCPTCQCREL
     C                     END                             ** E02
     C**
     C*  PAYMENT REF. IS PERMITTED ONLY IF THE HEADER RECORD ON
     C*    PF/CQPACDD IS LIVE, NON-AUTHORIZED AND ENTERED TODAY
     C**
     C           *IN41     IFEQ '0'                        ** B02
     C           RECI      IFNE 'D'                        ** B03
     C           AUIN      OREQ 'Y'
     C***********OEDT******ORNE RUND                                      S01194
     C***********OEDT      ORNE BJRDNB                              S01194063767
     C                     ADD  1         S
     C*********************MOVE ' 342'    ERCD,S                          S01117
     C                     MOVE ' 010'    ERCD,S                          S01117
     C                     MOVE '1'       *IN41
     C                     END                             ** E03
     C                     END                             ** E02
     C**
     C*  NEXT CHEQUE SEQUENCE NUMBER MUST BE < 50
     C**
     C           *IN41     IFEQ '0'                        ** B02
     C           NCSQ      IFGE 50                         ** B02
     C                     ADD  1         S
     C*********************MOVE ' 334'    ERCD,S                          S01117
     C                     MOVE ' 012'    ERCD,S                          S01117
     C                     MOVE '1'       *IN41
     C                     END                             ** E03
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C**
     C*  CHEQUE SEQ. IS PROHIBITED FOR ACTION 'I'
     C**
     C           SCQSQ     IFNE *BLANKS                    ** B01
     C           SACTD     ANDEQ'I'
     C                     ADD  1         S
     C*********************MOVE ' 216'    ERCD,S                          S01117
     C                     MOVE ' 011'    ERCD,S                          S01117
     C                     MOVE '1'       *IN42
     C                     END                             ** E01
     C**
     C*  IF CHEQUE SEQ. IS BLANK FOR 'A' OR 'D', RECORD MUST EXIST ON
     C****PF/CQPACDD*WITH*RECI=D,*ORED=RUND*AND*AUTHORISED*IND*NE*'Y'     S01194
     C*   PF/CQPACDD WITH RECI=D, ORED=BJRDNB AND AUTHORISED IND NE 'Y'   S01194
     C**
     C           SCQSQ     IFEQ *BLANKS                    ** B01
     C           SACTD     IFEQ 'A'                        ** B02
     C           SACTD     OREQ 'D'
     C*
     C                     MOVE SPREF     PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             42
     C***        CQPACK    CHAINCQPAC                42
     C*
     C           *IN42     IFEQ '0'                        ** B03
     C                     EXCPTCQCREL
     C           RECI      IFNE 'D'                        ** B04
     C***********OEDT******ORNE RUND                                      S01194
     C***********OEDT      ORNE BJRDNB                              S01194063767
     C           AUIN      OREQ 'Y'
     C                     MOVE '1'       *IN42
     C                     END                             ** E04
     C                     END                             ** E03
     C*
     C           *IN42     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 217'    ERCD,S                          S01117
     C                     MOVE ' 004'    ERCD,S                          S01117
     C*
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
      *
      **  Cheque sequence 00 - Error
     C           SCQSQ     IFEQ *ALL'0'
     C           SACTD     IFEQ 'A'
     C           SACTD     OREQ 'D'
     C           SACTD     OREQ 'E'
     C                     SETON                         42
     C                     ADD  1         S
     C*********************MOVE ' 391'    ERCD,S                          S01117
     C                     MOVE ' 013'    ERCD,S                          S01117
     C                     END
     C                     END
      *
     C**
     C*  IF CHEQUE SEQ. IS ENTERED FOR 'A' OR 'D', RECORD MUST EXIST ON
     C****PF/CQPADDD*WITH*RECI=D,*ORED=RUND*AND*AUTHORISED*IND*ON*THE**   S01194
     C*   PF/CQPADDD WITH RECI=D, ORED=BJRDNB AND AUTHORISED IND ON THE   S01194
     C*   ASSOCIATED PF/CQPACDD RECORD NE 'Y'
     C**
     C           SCQSQ     IFNE *BLANKS                    ** B01
     C           SCQSQ     ANDNE*ALL'0'
     C           SACTD     IFEQ 'A'                        ** B02
     C           SACTD     OREQ 'D'
     C*
     C                     MOVE SPREF     PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             42
     C*
     C           *IN42     IFEQ '0'                        ** B03
     C                     EXCPTCQCREL
     C*
     C                     MOVE SPREF     PREFKY
     C                     MOVE SCQSQ     CQSQKY
     C           CQPACK    CHAINCQPADDDF             42
     C*
     C           *IN42     IFEQ '0'                        ** B04
     C                     EXCPTCQDREL
     C           RECI      IFNE 'D'                        ** B05
     C***********OEDT******ORNE RUND                                      S01194
     C***********OEDT      ORNE BJRDNB                              S01194063767
     C           AUIN      OREQ 'Y'
     C                     MOVE '1'       *IN42
     C                     END                             ** E05
     C                     END                             ** E04
     C                     END                             ** E03
     C*
     C           *IN42     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 218'    ERCD,S                          S01117
     C                     MOVE ' 005'    ERCD,S                          S01117
     C                     END                             ** E03
     C*
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  IF CHEQUE SEQ. IS BLANK FOR 'E' RECORD MUST EXIST ON PF/CQPACDD
     C**
     C           SCQSQ     IFEQ *BLANKS                    ** B01
     C           SCQSQ     ANDNE*ALL'0'
     C           SACTD     ANDEQ'E'
     C*
     C                     MOVE SPREF     PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             42
     C*
     C           *IN42     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 219'    ERCD,S                          S01117
     C                     MOVE ' 006'    ERCD,S                          S01117
      *                                                                   CGL007
      ** If CGL007 is ON, and is called by GL0090, set return code to 'E'.CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           PRGL90    ANDEQ'Y'                                       CGL007
     C                     MOVE 'E'       @RETC                           CGL007
     C                     MOVE *ON       *INLR                           CGL007
     C                     RETRN                                          CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FT0080C010
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'E'       @RETC                           096486
     C                     SETON                     LR                   096486
     C                     RETRN                                          096486
     C                     END                                            096486
     C                     ELSE                            ** X02
     C                     EXCPTCQCREL
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  IF CHEQUE SEQ. IS ENTERED FOR 'E' RECORD MUST EXIST ON PF/CQPADDD
     C**
     C           SCQSQ     IFNE *BLANKS                    ** B01
     C           SACTD     ANDEQ'E'
     C*
     C                     MOVE SPREF     PREFKY
     C                     MOVE SCQSQ     CQSQKY
     C           CQPACK    CHAINCQPADDDF             42
     C*
     C           *IN42     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 220'    ERCD,S                          S01117
     C                     MOVE ' 007'    ERCD,S                          S01117
     C                     ELSE                            ** X02
     C                     EXCPTCQDREL
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  IF CHEQUE SEQ. IS BLANK FOR 'D' RECORD MUST EXIST ON PF/CQPACDD
     C*    WITH TOTAL DEBITS = 0
     C**
     C           SCQSQ     IFEQ *BLANKS                    ** B01
     C           SACTD     ANDEQ'D'
     C**
     C*  RECORD WILL ALREADY HAVE BEEN ACCESSED
     C**
     C           TOTD      IFNE 0                          ** B02
     C                     MOVE '1'       *IN42
     C                     ADD  1         S
     C*********************MOVE ' 221'    ERCD,S                          S01117
     C                     MOVE ' 008'    ERCD,S                          S01117
     C                     END                             ** E02
     C*
     C                     END                             ** E01
      *                                                                   042167
      * Call CL program to check for other users                          042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE  7                       042167
     C                     MOVE 'FT'      @MODLE  2                       042167
     C                     MOVE SPREF     @TREF  15                       042167
     C                     MOVE *BLANKS   @RTINF 80                       042167
     C           SACTD     IFNE 'E'                                       042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
     C                     END                                            042167
      *                                                                   042167
      *  If 'IN USE' then redisplay subfile with error message            042167
      *                                                                   042167
     C           @RTCDE    IFEQ '*IN USE'                                 042167
     C                     ADD  1         S                               042167
     C                     MOVE ' 600'    ERCD,S                          042167
     C                     MOVE '0'       *IN80                           042167
      *        Load error message for record lock                         042167
      *                                                                   042167
     C                     END                                            042167
     C*
     C** IF NO ERRORS SET UP BRANCH DEFAULTS AND PERFORM SPF PROCESSING   S01117
     C*                                                                   S01117
     C           S         IFLT 1                          ** B01         S01117
     C*                                                                   S01117
     C** IF MB,INSERT AND NO BRANCH ENTERED DEFAULT TO DEFAULT BRANCH.    S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'Y'                        ** B02         S01117
     C           SACTD     ANDEQ'I'                                       S01117
     C           SBRCA     ANDEQ*BLANKS                                   S01117
     C                     MOVE @DFBR     SBRCA                           S01117
     C                     END                             ** E02         S01117
     C*                                                                   S01117
     C** IF NON-MB DEFAULT SCREEN FIELD(NON-DISPLAY)TO SINGLE BRANCH.     S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'N'                        ** B03         S01117
     C           SACTD     ANDEQ'I'                                       S01117
     C                     MOVE BJSBRC    SBRCA                           S01117
     C                     END                             ** E03         S01117
     C*                                                                   S01117
     C** BRANCH AND AUTHORITY VALIDATION.                                 S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'N'                        ** B04         S01117
     C*                                                                   S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTD     @ZACTN  1                       S01117
     C                     PARM 0         @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFNE 0                          ** B05         S01117
     C                     SETON                     40                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 302'    ERCD,S                          S01117
     C                     END                             ** E05         S01117
     C                     END                                            096486
     C*                                                                   S01117
     C                     ELSE                            ** X04         S01117
     C** VALIDATE BRANCH ENTRY                                            S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C           SBRCA     IFNE *BLANKS                    ** B06         S01117
     C*                                                                   S01117
     C** ? PROCESSING                                                     S01117
     C                     MOVEA*BLANKS   FLDQ                            S01117
     C                     MOVEASBRCA     FLDQ                            S01117
     C           '?'       LOKUPFLDQ                     29               S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM SBRCA     @BRCD   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   SBRCA            ** B07         S01117
     C                     ELSE                            ** X07         S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8BRCD    SBRCA                           S01117
     C                     MOVE SBRCA     BRCH
     C                     ELSE                                           S01117
     C                     SETON                     39                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 014'    ERCD,S                          S01117
     C                     END                             ** E07         S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             ** E06         S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                    ** B08         S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTD     @ACTN   1                       S01117
     C                     PARM BRCH      @BRCD   3                       S01117
     C                     PARM 0         ERR     10                      S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          ** B09         S01117
     C                     SETON                     3940                 S01117
     C                     MOVE BRCH      SBRCA                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 303'    ERCD,S                          S01117
     C                     END                             ** E09         S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          ** B10         S01117
     C                     SETON                     3940                 S01117
     C                     MOVE BRCH      SBRCA                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 304'    ERCD,S                          S01117
     C                     END                             ** E10         S01117
     C                     END                                            096486
     C*                                                                   S01117
     C** IF REQUIRED VALIDATE AUTHORITY TO ORIGINATING BRANCH             S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                        **B11          S01117
     C           ORBR      ANDNE*BLANKS                                   S01117
     C*                                                                   S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      ZOBRX   3                       S01117
     C                     PARM 0         ERR                             S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          **B12          S01117
     C                     SETON                     41                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 305'    ERCD,S                          S01117
     C                     END                             **E12          S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          **B13          S01117
     C                     SETON                     41                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 306'    ERCD,S                          S01117
     C                     END                             **E13          S01117
     C*                                                                   S01117
     C                     END                             **E11          S01117
     C                     END                             **E08          S01117
     C                     END                             ** E04         S01117
     C                     END                             ** E01         S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C           S         IFGE 1                          ** B01
     C                     MOVE '1'       *IN75
     C           S         IFGT 19                         ** B02
     C                     MOVE '1'       *IN76
     C                     END                             ** E02
     C                     ELSE                            ** X01
     C**
     C*  IF NO ERRORS AND 'I' CHECK IF HEADER OR DETAIL IS REQUESTED
     C**
     C           SACTD     IFEQ 'I'                        ** B02
     C           SPREF     IFEQ *BLANKS                    ** B03
     C                     MOVE 'NEW'     HEADER  3
     C                     ELSE                            ** X03
     C                     MOVE 'OLD'     HEADER
     C                     END                             ** E03
     C                     END                             ** E02
     C*
     C                     MOVE SPREF     PREF
     C                     MOVE SCQSQ     CQSQ
     C                     MOVE SBRCA     BRCH                            S01117
     C*
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C076
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    VALHED - SR TO VALIDATE HEADER INSERT/AMEND
     C**
     C           VALHED    BEGSR
     C**
     C*  CLEAR ERROR CODES ARRAY, RESET POINTER, RESET FIELD ERROR
     C*    ERROR CODE ARRAY INDICATORS AND FLD ? INDICATOR.               S01117
     C**
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     MOVEA'00000000'*IN,43
     C                     MOVEA'00000'   *IN,51
     C                     MOVEA'0'       *IN,69
     C                     MOVEA'00'      *IN,75
     C                     MOVEA'0'       *IN,37                          S01117
     C                     MOVEA'0'       *IN,30                          S01117
     C                     MOVEA'0'       *IN,19                          E32543
     C                     MOVEA'00'      *IN,26                          E32543
     C                     MOVEA'0'       *IN,23                          E32543
     C                     MOVEA'0'       *IN,25                          S01414
     C                     MOVEA'0'       *IN,33                          S01414
     C                     MOVE '0'       *IN06                           S01499
     C                     MOVE '0'       *IN12                           S01499
     C*                                                                   S01117
     C** IF SCREEN ORIGINATING BRANCH IS BLANK MB OR NON-MB DEFAULT TO    S01117
     C** SCREEN BOOKING BRANCH.                                           S01117
     C*                                                                   S01117
     C           SORBR     IFEQ *BLANKS                                   S01117
     C                     MOVE SBRCA     SORBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IF MB AND ORIGINATING BRANCH USED VALIDATE ENTRY AND IF          S01117
     C** REQUIRED AUTHORITY.                                              S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'Y'                        ** B01         S01117
     C           *IN36     ANDEQ'1'                                       S01117
     C*                                                                   S01117
     C** CHECK FOR ENTRY OF '?' IN SORBR FIELD.                           S01117
     C*                                                                   S01117
     C                     MOVEA*BLANKS   FLDQ                            S01117
     C                     MOVEASORBR     FLDQ                            S01117
     C           '?'       LOKUPFLDQ                     29               S01117
     C           *IN29     IFEQ '1'                                       S01117
     C                     SETON                     30                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SORBR     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL '                  ** B02         S01117
     C                     MOVE *BLANKS   SORBR                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C*                                                                   S01117
     C           *IN29     IFEQ '1'                                       S01117
     C                     MOVE A8BRCD    SORBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If originating branch validation required and no                 S01117
     C** error on branch code input                                       S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                        ** B03         S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM SORBR     ZOBRX   3                       S01117
     C                     PARM 0         ERR                             S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          ** B04         S01117
     C                     SETON                     37                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVEA' 305'    ERCD,S                          S01117
     C                     END                             ** E04         S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          ** B05         S01117
     C                     SETON                     37                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVEA' 306'    ERCD,S                          S01117
     C                     END                             ** E05         S01117
     C                     END                             ** E03         S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     37                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVEA' 017'    ERCD,S                          S01117
     C                     END                             ** E02         S01117
     C                     END                             ** E01         S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IF AUTHORISED AND VALID STORE ORIGINATING BRANCH                 S01117
     C*                                                                   S01117
     C           *IN37     IFNE '1'                                       S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C                     MOVE SPYTP     PYTP
     C**
     C*  PAYMENT SUB-TYPE IS MANDATORY, MUST BE ON DEAL SUB-TYPES TABLE
     C**
     C           SPYST     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 224'    ERCD,S                          S01117
     C                     MOVE ' 018'    ERCD,S                          S01117
     C                     MOVE '1'       *IN44
     C                     ELSE                            ** X01
     C*
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '42'      ZTAB01                          S01194
     C*********************MOVE SPYST     ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*                                                                   S01194
     C** CHECK FOR ENTRY OF ? IN SPYST AND SET UP FIELD ACCORDINGLY.      S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASPYST     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C           *IN29     IFEQ '1'                                       S01194
     C                     SETON                     30                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM SPYST     @DSTC   2                       S01194
     C           SDDLST    PARM *BLANKS   DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              4444                 093958
     C*                                                                   093958
     C           *IN44     IFEQ '0'                                       093958
     C                     MOVE ASDSTC    SPYST                                             BUG10652
     C*                                                                   093958
     C** Check in Deal type/Sub type file if combination exists           093958
     C*                                                                   093958
     C           @DTSTK    CHAINFDDTSTL1             44                   093958
     C           *IN44     IFEQ '0'                                       093958
     C           RCID11    ANDEQ'*'                                       093958
     C                     SETON                     44                   093958
     C                     END                                            093958
     C                     END                                            093958
     C*                                                                   093958
     C           @RTCD     IFEQ '*NOSEL '                                 S01194
     C                     MOVE *BLANKS   SPYST                           S01194
     C                     ELSE                                           S01194
     C***********@RTCD     IFEQ *BLANKS                             S01194093958
     C           *IN44     IFEQ '0'                                       093958
     C                     MOVE ASDSTC    SPYST                           S01194
     C                     MOVE SPYST     PYST                            S01194
     C                     ELSE                                           S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 019'    ERCD,S                          S01194
     C*********************MOVE '1'       *IN44                     S01194093958
     C                     END                                            S01194
     C                     END                                            S01194
     C                     END                                            S01194
     C*
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B02         S01194
     C*********************ADD  1         S                               S01194
     C*********************MOVE ' 225'    ERCD,S                          S01194
     C*********************MOVE '1'       *IN44                           S01194
     C*********************ELSE                            ** X02         S01194
     C*********************                                               S01194
     C*********************MOVE SPYST     PYST                            S01194
     C*********************END                             ** E02         S01194
     C*********************END                             ** E01         S01194
     C*                                                                   CEU006
     C** Pay delivery currency is optional, if entered check that         CEU006
     C** it is a valid currency.                                          CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SPDCY     IFNE *BLANKS                                   CEU006
     C                     MOVE 'N'       P#INCY  1                       CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM SPDCY     @CYCD                           CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
     C*                                                                   CEU006
     C           @RTCD     IFEQ '*NOSEL '                                 CEU006
     C                     MOVE *BLANKS   SPDCY                           CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'FTM2564' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL  10                       CEU006
     C                     PARM           MSGID  10                       CEU006
     C                     MOVE 'Y'       PDCERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE A6CYCD    SPDCY                           CEU006
     C                     MOVE A6INCY    P#INCY                          CEU006
     C                     MOVE A6TPSD    P#TPSD  50                      CEU006
     C                     MOVE A6NBDP    P#NBDP  10                      CEU006
     C                     EXSR MVCURR                                    CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C**
     C*  PAY CURRENCY IS MANDATORY, MUST BE VALID CCY CODE & MUST BE
     C*    US DOLLARS CODE IF SETTLEMENT TYPE IS '13'
     C**
     C           SPCCY     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 258'    ERCD,S                          S01117
     C                     MOVE ' 042'    ERCD,S                          S01117
     C                     MOVE '1'       *IN47
     C                     ELSE                            ** X01
     C** CHECK FOR ENTRY OF ? IN SPCCY AND SET UP FIELD ACCORDINGLY.      S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASPCCY     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C           *IN29     IFEQ '1'                                       S01194
     C                     SETON                     30                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C*
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '20'      ZTAB01                          S01194
     C*********************MOVE SPCCY     ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C*********************EXSR TABCHN                                    S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SPCCY     @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B02         S01194
     C*********************ADD  1         S                               S01194
     C*********************MOVE ' 259'    ERCD,S                          S01194
     C*********************MOVE '1'       *IN47                           S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ '*NOSEL '                                 S01194
     C                     MOVE *BLANKS   SPCCY                           S01194
     C                     ELSE                                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 043'    ERCD,S                          S01117
     C                     MOVE '1'       *IN47                           S01194
     C                     ELSE                            ** X02
     C                     MOVE A6CYCD    SPCCY                           S01194
     C                     EXSR MVCURR                                    S01194
     C**
     C*   NOT A FUNDS TRANSFER VALIDATION
     C**
     C*          SSTTP     IFEQ '13'                       ** B03
     C                     END                             ** E02
     C**
     C*  IF PAY CCY IS VALID, STORE CCY D.P. FOR LATER USE
     C**
     C           *IN47     IFEQ '0'                        ** B02
     C*********************Z-ADDCDP       PCCYDP                          S01194
     C                     Z-ADDA6NBDP    PCCYDP                          S01194
     C                     MOVE SPCCY     PCCY
     C*********************Z-ADDSPOT      PCCYSP                          S01194
     C                     Z-ADDA6SPRT    PCCYSP                          S01194
     C                     Z-ADDMDIN      PCCYMD
     C*********************MOVE '4'       ZTAB12                          S01194
     C**READ*CURRENCY*RECORD*TO*FOR*SPREAD***                             S01194
     C*********************EXSR TABCHN                                    S01194
     C**CHANGE*SPOT*RATE*BY*SELL*SPREAD*****                              S01194
     C***********SSSG******IFEQ '+'                        B003           S01194
     C***********SPOT******ADD  SSPR      RSRAT  138                      S01194
     C*********************ELSE                            X003           S01194
     C***********SPOT******SUB  SSPR      RSRAT                           S01194
     C*********************END                             E003           S01194
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY SELL SPREAD                                   S01194
     C*                                                                   S01194
     C           A6SLSS    IFEQ '+'                        B003           S01194
     C           A6SPRT    ADD  A6SLSR    RSRAT  138                      S01194
     C                     ELSE                            X003           S01194
     C           A6SPRT    SUB  A6SLSR    RSRAT                           S01194
     C                     END                             E003           S01194
     C*                                                                   S01194
     C**CHANGE*SPOT*RATE*BY*BUY*SPREAD****                                S01194
     C***********BSSG******IFEQ '+'                        B003           S01194
     C***********SPOT******ADD  BSPR      RBRAT  138                      S01194
     C*********************ELSE                            X003           S01194
     C***********SPOT******SUB  BSPR      RBRAT                           S01194
     C*********************END                             E003           S01194
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY BUY SPREAD                                    S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B003           S01194
     C           A6SPRT    ADD  A6BYSR    RBRAT  138                      S01194
     C                     ELSE                            X003           S01194
     C           A6SPRT    SUB  A6BYSR    RBRAT                           S01194
     C                     END                             E003           S01194
     C*
     C* DEFAULT PAY CCY ONTO SCREEN FOR CHARGES
     C*
     C                     MOVE SPCCY     SPCCY1
     C                     MOVE SPCCY     SPCCY2
     C**
     C                     END                                            S01194
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   CEU006
     C** Check for 'IN' Euro or Euro 'IN' combination.                    CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE A6NBDP    P#NBD1  10                      CEU006
     C                     MOVE 'N'       P#INC1  1                       CEU006
     C           SPDCY     IFNE *BLANKS                                   CEU006
     C           SPDCY     IFEQ BKEURO                                    CEU006
     C           A6INCY    ANDEQ'Y'                                       CEU006
     C           SPCCY     OREQ BKEURO                                    CEU006
     C           P#INCY    ANDEQ'Y'                                       CEU006
     C           A6INCY    IFEQ 'Y'                                       CEU006
     C                     MOVE A6INCY    P#INC1                          CEU006
     C                     MOVE A6TPSD    P#TPS1  50                      CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C                     MOVEL'FTM2584' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       PDCERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C                     MOVE *ON       *IN47                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C           SPDCY     IFEQ *BLANKS                                   CEU006
     C           SPDAM     ANDNE*BLANKS                                   CEU006
     C                     MOVEL'FTM2569' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       PDCERR  1                       CEU006
     C                     MOVE 'Y'       PDAERR                          CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*                                                                   S01194
     C** CHECK TO SEE IF ? ENTERED IN SRBK1 THIS IS INVALID               S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASRBK1     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C           *IN29     IFEQ '0'                                       S01194
     C*                                                                   S01194
     C**
     C*  SET A FLAG TO INDICATE IF REMITTING BANK IS ACCOUNT/NOSTRO
     C*    SET REMITTING BANK TYPE TO BLANK
     C**
     C                     MOVE *BLANKS   SRBK1X
     C                     MOVE 'N'       RMBKAC  1
     C                     MOVE ' '       RBKT
     C**
     C*  REMITTING BANK ASSUMED TO BE A FULL NAME & ADDRESS IF MORE THAN
     C*    ONE LINE ENTERED OR ANY ENTRY ON LINES 2 - 4
     C**
     C                     Z-ADD0         LINES   10
     C           SRBK1     IFNE *BLANKS                    ** B01
     C                     ADD  1         LINES
     C                     END                             ** E01
     C           SRBK2     IFNE *BLANKS                    ** B01
     C                     ADD  1         LINES
     C                     END                             ** E01
     C           SRBK3     IFNE *BLANKS                    ** B01
     C                     ADD  1         LINES
     C                     END                             ** E01
     C           SRBK4     IFNE *BLANKS                    ** B01
     C                     ADD  1         LINES
     C                     END                             ** E01
     C           LINES     IFGT 1                          ** B01
     C                     MOVE 'A'       RBKT
     C                     END                             ** E01
     C           LINES     IFEQ 1                          ** B01
     C           SRBK1     ANDEQ*BLANK
     C                     MOVE 'A'       RBKT
     C                     END                             ** E01
     C**
     C*  MOVE FIRST REMITTING BANK FIELD TO DS FOR FURTHER VALIDATION
     C**
     C                     MOVE SRBK1     SRBK1X
     C                     Z-ADD0         RBOPN   50
     C                     MOVE *BLANK    ACST1   1                       047179
     C                     MOVE *BLANK    RAC#N
     C*                                                                   S01117
     C** IF MB AND REMITTING BANK ENTRY>18 OR NON-MB AND >15 CHAR         S01117
     C** THEN MUST BE AN ADDRESS.                                         S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C           RACNTM    ANDNE*BLANKS                                   S01117
     C                     MOVE 'A'       RBKT                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'N'                                       S01117
     C           RACNTR    ANDNE*BLANKS                                   S01117
     C                     MOVE 'A'       RBKT                            S01117
     C                     END                                            S01117
     C**
     C***REMITTING*BANK*DEFAULTS*TO*PCCY'01'*AND*MUST*BE*USD'01'*IF       E29828
     C*****THE*SETTLEMENT*TYPE*IS*'13',**                                 E29828
     C*********************                                               E29828
     C***********LINES*****IFEQ 0                          ** B01         E29828
     C************IN47*****IFEQ '0'                        ** B02         E29828
     C*********************MOVELPCCY      RNOST                           E29828
     C*********************MOVE '01'      RNOST                           E29828
     C*********************MOVE SRBK1X    SRBK1                           E29828
     C*********************MOVE 'F'       RBKT                            E29828
     C*********************END                             ** E02         E29828
     C*********************                                               E29828
     C*********************ELSE                            ** X01         E29828
     C*********************END                             ** E01         E29828
     C*
     C           RBKT      IFEQ 'A'                        ** B01
     C* VALIDATE AS AN ADDRESS
     C                     SETOF                     919293
     C                     SETOF                     9428
     C*
     C                     MOVE *BLANKS   ADDRSS
     C*
     C                     MOVELSRBK1     ADCHK1
     C                     MOVELSRBK2     ADCHK2
     C                     MOVELSRBK3     ADCHK3
     C                     MOVELSRBK4     ADCHK4
     C                     MOVE *BLANKS   ADCHK5
     C*
     C                     EXSR ADCHK
     C*
     C** DEPENDING ON THE INDICATORS, HIGHLIGHT THE FIELD IN ERROR
     C** AND PRODUCE THE ERROR MESSAGE
     C*
     C           *IN92     IFEQ '1'
     C                     SETON                     4528
     C                     ADD  1         S
     C*********************MOVE ' 490'    ERCD,S                          S01117
     C                     MOVE ' 027'    ERCD,S                          S01117
     C                     END
     C*
     C           *IN93     IFEQ '1'
     C                     SETON                     4528
     C                     END
     C*
     C** ZEROISE CNUMR FIELD FOR WHEN SENDER CNUM IS COMPARED TO
     C** REMITTING BANK CNUM
     C**********           Z-ADD0         CNUMR                                        E29979 CSD027
     C                     MOVE *BLANKS   CNUMR                                               CSD027
     C                     GOTO SENDCO
     C                     END                             ** E01
     C*
     C           *IN45     IFEQ '0'                        ** B01
     C**
     C*  IF REMITTING BANK ENTERED AS EXACTLY 5 CHARACTERS VALIDATE AS
     C*****A*FULL*NOSTRO*-*MUST*BE*ON*PF/TABLETL*********************     S01194
     C*    A FULL NOSTRO - MUST BE ON PF/SDNOSTPD                         S01194
     C**
     C           RNOST     IFNE *BLANKS                    ** B02
     C           RNOSTL    ANDNE*BLANKS
     C           RNOSTR    ANDEQ*BLANKS
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************MOVELRNOST     ZTAB08                          S01194
     C*********************MOVE RNOST     ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @CUST   6                       S01194
     C                     PARM RCCYN     @CYCD   3                       S01194
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM RNOSN     @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   @CSSN  10                       S01194
     C                     PARM *BLANKS   @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     CASEQ*BLANKS   MVNOST     8989                 S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN89     IFEQ '1'                        ** B04
     C                     MOVE '1'       *IN45
     C                     ELSE                            ** X04
     C                     MOVE 'F'       RBKT
     C                     MOVELRNOST     CCYWK   3
     C                     MOVE CNUM      ACNTCN
     C                     MOVELRNOST     ACNTCY
     C                     MOVE ACOD      ACNTAC
     C                     MOVE ACSQ      ACNTAS
     C                     MOVE A7BRCD    ACNTBR                          S01117
     C                     EXSR ACCCHN
     C                     MOVE ACST      ACST1                           047179
     C*
     C           ATYP      IFEQ 'R'                        ** B05
     C                     Z-ADDDACO      RBOPN
     C                     END                             ** E05
     C*
     C                     END                             ** E04
     C                     END                             ** E02
     C**
     C*  IF REMITTING BANK ENTERED AS EXACTLY 6 CHARACTERS VALIDATE AS A
     C*****CLIENT*NUMBER*-*MUST*BE*ON*LF/CLINT************                S01194
     C*    CLIENT NUMBER - MUST BE ON PF/SDCUSTPD AND BE TYPE *CNUM       S01194
     C**
     C           RCUSTA    IFNE *BLANKS                    ** B02
     C           RCUSTL    ANDNE*BLANKS
     C           RCUSTR    ANDEQ*BLANKS
     C*********************MOVE RCUST     CNUMKY                          S01194
     C***********CLINTK****CHAINCLINT                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C*                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM RCUSTA    @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              9999                 S01194
     C*                                                                   S01194
     C           @KYST     IFNE '*CNUM  '                                 S01194
     C           @KYST     ANDNE'*CSHT  '                                                     CSD027
     C                     SETON                     99                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN99     IFEQ '1'                        ** B03
     C                     MOVE '1'       *IN45
     C                     ELSE                            ** X03
     C                     MOVE BBCUST    CNUM                            S01194
     C                     MOVE 'C'       RBKT
     C                     END                             ** E03
     C                     END                             ** E02
     C**
     C*  IF REMITTING BANK ENTERED AS UP TO 10 LONG VALIDATE AS A
     C*****SHORTNAME*-*MUST*BE*ON*LF/SNAME....***************             S01194
     C*    SHORTNAME - MUST BE ON PF/SDCUSTPD + @KYST EQUAL TO *CSHT      S01194
     C**
     C           RSNME     IFNE *BLANKS                    ** B02
     C           RSNMER    ANDEQ*BLANKS
     C***********RSNME*****CHAINSNAME                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C*
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM RSNME     @KEY1                           S01194
     C                     PARM *BLANKS   @KYST                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              9999                 S01194
     C*                                                                   S01194
     C           @KYST     IFNE '*CSHT  '                                 S01194
     C                     SETON                     99                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN99     IFEQ '0'                        ** B03
     C                     MOVE BBCUST    CNUM                            S01194
     C                     MOVE CNUM      RCUST
     C                     MOVE *BLANKS   RCUSTR
     C                     MOVE SRBK1X    SRBK1
     C                     MOVE 'C'       RBKT
     C                     ELSE                            ** X03
      *                                                                   094278
      * Check that it is not a SWIFT address                              094278
      *                                                                   094278
     C**********           MOVELSRBK1     CLSWTK 12                                    094278 CGL029
     C                     MOVELSRBK1     CLSWTK 18                                           CGL029
     C                     MOVEA*IN,31    ##002   2                       094278
     C                     Z-ADDO         Q                               094278
      *                                                                   094278
     C                     EXSR SWIFT                                     094278
      *                                                                   094278
     C           ##CSID    IFEQ 'Y'                         ** B03a       094278
     C           *IN31     ANDEQ'0'                                       094278
     C           *IN32     ANDEQ'0'                                       094278
     C                     MOVE 'S'       RBKT                            094278
     C                     MOVEL'0'       *IN45                           094278
     C                     MOVEL'0'       *IN99                           094278
     C                     MOVEA##002     *IN,31                          094278
      *                                                                   094278
     C           W9CUST    IFEQ 'Y'                        ** B04         094278
     C                     MOVE BBCUST    CNUM                            094278
     C                     ELSE                            ** X04         094278
     C**********           Z-ADD0         CNUM                                         094278 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     END                             ** E04         094278
      *                                                                   094278
     C                     ELSE                            ** X03a        094278
     C                     MOVEA##002     *IN,31                          094278
     C**
     C* ...IF THAT FAILS VALIDATE AS A RETAIL ACCOUNT NUMBER IF REMITTING
     C*    BANK ENTERED AS EXACTLY 10 LONG - MUST BE ON LF/ACNUMA
     C**
     C           RRETLL    IFNE *BLANKS                    ** B04
     C           RRETL     CHAINACNUMA               99
     C  N99      RECI      COMP 'D'                  9999
     C           *IN99     IFEQ '1'                        ** B05
     C                     MOVE '1'       *IN45
     C                     ELSE                            ** X05
     C* STORE VALUE FOR USE WITH SENDER'S CORRESPONDENT CHECK
     C                     MOVE CCY       CCYSTO  3
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     45
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 026'    ERCD,S                          S01117
     C                     MOVE 'N'       RAC#N   1
     C*
     C                     ELSE
     C                     MOVE *BLANK    RAC#N
     C*
     C                     MOVE 'R'       RBKT
     C                     MOVE CCY       CCYWK
     C                     MOVE ACST      ACST1                           047179
     C*
     C           ATYP      IFEQ 'R'                        ** B06
     C                     Z-ADDDACO      RBOPN
     C                     END
     C*
     C                     END                             ** E06
     C                     END                             ** E05
     C                     END                             ** E04
     C                     END                             ** E03a        094278
     C                     END                             ** E03
     C                     END                             ** E02
     C**
     C*  IF REMIT. BK ENTERED IS LE 10 LONG AND NO TYPE SET - INVALID
     C**
     C           RSNME     IFNE *BLANKS                    ** B02
     C           RSNMER    ANDEQ*BLANKS
     C           RBKT      ANDEQ*BLANKS
     C                     MOVE '1'       *IN45
     C                     END                             ** E02
     C*                                                                   S01194
     C**
     C*  IF ANY ERROR O/P ERROR CODE
     C** (ONLY IF RETAIL ACCOUNT KEYS ARE ALLOWED)
     C**
     C           *IN45     IFEQ '1'                        ** B02
     C           RAC#N     ANDEQ*BLANK
     C                     ADD  1         S
     C*********************MOVE ' 253'    ERCD,S                          S01117
     C                     MOVE ' 021'    ERCD,S                          S01117
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*                                                                   S01194
     C                     ELSE                                           S01194
     C** INVALID ? ENTERED IN SRBK1 FIELD.                                S01194
     C*                                                                   S01194
     C                     SETON                     45                   S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 020'    ERCD,S                          S01194
     C                     END                                            S01194
     C**
     C*  NEXT VALIDATION ONLY IF REMITTING BANK IS NEITHER IDENTIFIED
     C*    NOR INVALID YET
     C**
     C           RBKT      IFEQ ' '                        ** B01
     C           *IN45     ANDEQ'0'
     C**
     C***IF*REMITTING*BANK*ENTERED*AS*15*LONG*VALIDATE*AS*A*FULL*CUSTOMER S01117
     C** IF REMITTING BANK ENETERED AS EITHER 15 OR 18 LONG(MB) VALIDAT   S01117
     C** AS A FULL ACCOUNT CODE                                           S01117
     C*    ACCOUNT NUMBER - MUST BE ON LF/ACCNT
     C*  N.B. REMITTING BANK MUST BE ENTERED AS 11+ LONG TO GET HERE.
     C**
     C** IF NON-MB SET BRANCH SECTION OF ACNTKY TO SINGLE BRANCH          S01117
     C** ELSE MOVE IN FULL FIELD                                          S01117
     C*                                                                   S01117
     C                     MOVE RACNT     ACNTKY
     C*                                                                   S01117
     C           @MBIN     IFNE 'Y'                                       S01117
     C                     MOVE BJSBRC    ACNTKY                          S01117
     C                     END                                            S01117
      *
     C           ACNTKY    IFNE *BLANKS
     C           ACCNTK    CHAINACCNT                99
     C                     END
      *
     C* N99      RECI      COMP 'D'                  9999
      *
     C           *IN99     IFEQ '1'                        ** B03
     C           RECI      ORNE 'D'
     C           ACNTKY    OREQ *BLANKS
     C                     ADD  1         S
     C*********************MOVE ' 254'    ERCD,S                          S01117
     C                     MOVE ' 022'    ERCD,S                          S01117
     C                     MOVE '1'       *IN45
     C                     ELSE                            ** X03
     C**********           MOVE 'G'       RBKT                            179732
     C                     MOVE CCY       CCYWK
     C                     MOVE ACST      ACST1                           047179
      *
     C           ATYP      IFEQ 'G'                        ** B04         179732
     C                     MOVE 'G'       RBKT                            179732
     C                     END                             ** E04         179732
      *
     C           ATYP      IFEQ 'R'                        ** B04
     C                     Z-ADDDACO      RBOPN
     C           BMRANR    IFEQ 'Y'                        ** B05                             212014
     C                     MOVE 'R'       RBKT                            179732
     C                     MOVEL*BLANKS   SRBK1                           179732
     C                     MOVELACNO      SRBK1                           179732
     C                     ELSE                            ** X05                             212014
     C                     MOVE 'G'       RBKT                                                212014
     C                     END                             ** E05                             212014
     C                     END                             ** E04
      *
     C           ATYP      IFEQ 'N'                                       179732
     C                     MOVE 'F'       RBKT                            179732
     C*                                                                   179732
     C                     CALL 'AONOSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM ACNCNA    @CUST   6                       179732
     C                     PARM ACNTCY    @CYCD   3                       179732
     C**********           PARM ACNACA    @ACCD   4                                    179732 CGL029
     C                     PARM ACNACA    @ACCD                                               CGL029
     C                     PARM ACNASA    @ACSN   2                       179732
     C                     PARM *BLANKS   @NONB   2                       179732
     C                     PARM ACNTBR    @BRCD   3                       179732
     C                     PARM *BLANKS   @CSSN  10                       179732
     C                     PARM *BLANKS   @PNOI   1                       179732
     C           SDNOST    PARM SDNOST    DSSDY                           179732
     C*                                                                   179732
     C           @RTCD     IFEQ *BLANKS                                   179732
     C                     MOVE *BLANKS   SRBK1                           179732
     C                     MOVELA7CYCD    NOSTAC  5                       179732
     C                     MOVE A7NONB    NOSTAC                          179732
     C                     MOVELNOSTAC    SRBK1                           179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
      *
     C                     END                             ** E03
     C**
     C***IF*REM.*BANK*TYPE*HASN'T*BEEN*SET*THEN*IT*MUST*BE*NAME*&*ADDRESS E29832
     C*  IF REM. BANK TYPE HASN'T BEEN SET THEN IT IS EITHER INVALID ORSS E29832
     C*  NO ENTRY HAS BEEN MADE.                                          E29832
     C**
     C           RBKT      IFEQ ' '                        ** B02
     C                     ADD  1         S                               E29832
     C*********************MOVE ' 253'    ERCD,S                    E29832S01117
     C                     MOVE ' 021'    ERCD,S                          S01117
     C                     SETON                     45                   E29832
     C*********************MOVE 'A'       RBKT                            E29832
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C**
     C*  IF REMITTING BANK IS NOSTRO OR ACCOUNT, MUST BE IN PAY
     C*    CURRENCY IF SENDERS CORRESPONDENT NOT ENTERED
     C**
     C           *IN45     IFEQ '0'                        ** B02
     C           SSNCO     ANDEQ*BLANK
     C*
     C           RBKT      IFEQ 'F'                        ** B03
     C           RBKT      OREQ 'R'
     C           RBKT      OREQ 'G'
     C           CCYWK     IFNE SPCCY                      ** B04
     C                     ADD  1         S
     C*********************MOVE ' 338'    ERCD,S                          S01117
     C                     MOVE ' 023'    ERCD,S                          S01117
     C                     MOVE '1'       *IN45
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C**
     C*  IF REM. BANK IS VALID HERE AND NOT A NAME AND ADDRESS OR
     C*    CUSTOMER NUMBER IT MUST BE AN ACCOUNT OR NOSTRO SO SET FLAG.
     C*    ALSO STORE CUSTOMER NUMBER.
     C**
     C           RBKT      IFNE 'A'                        ** B01
     C           RBKT      ANDNE'C'
     C           RBKT      ANDNE'S'                                       094278
     C           *IN45     ANDEQ'0'
     C           *IN47     ANDEQ'0'
     C                     MOVE 'Y'       RMBKAC
     C**********           Z-ADDCNUM      CNUMR   60                                          CSD027
     C                     MOVE CNUM      CNUMR   6                                           CSD027
     C                     ELSE                            ** X01
     C**********           Z-ADD0         CNUMR   60                                          CSD027
     C                     MOVE *BLANKS   CNUMR   6                                           CSD027
     C                     END                             ** E01
     C**
     C*  IF REM. BANK IS VALID HERE AND A CUSTOMER NUMBER STORE IT
     C**
     C           RBKT      IFEQ 'C'                        ** B01
     C           *IN45     ANDEQ'0'
     C           *IN47     ANDEQ'0'
     C**********           Z-ADDCNUM      CNUMR   60                                          CSD027
     C                     MOVE CNUM      CNUMR   6                                           CSD027
     C                     END                             ** E01
     C**                                                                  094278
     C*  IF REM. BANK IS VALID HERE AND A CUSTOMER NUMBER STORE IT        094278
     C**                                                                  094278
     C           RBKT      IFEQ 'S'                        ** B01         094278
     C           *IN45     ANDEQ'0'                                       094278
     C           *IN47     ANDEQ'0'                                       094278
     C**********           Z-ADDCNUM      CNUMR   60                                   094278 CSD027
     C                     MOVE CNUM      CNUMR   6                                           CSD027
     C                     END                             ** E01         094278
     C**                                                                  094278
      *   E32529   -  Validation for settlement type 13 and remitting     E32529
      *               bank having to be a nostro is now redundant.        E32529
      *                                                                   E32529
     C**IF*SETTLEMENT*TYPE*IS*13*MUST*BE*A*NOSTRO**********************   E32529
     C****       SSTTP     IFEQ '13'                       ** B02         E32529
     C****       RBKT      ANDNE'F'                                       E32529
     C****                 ADD  1         S                               E32529
     C****                 MOVE ' 252'    ERCD,S                          E32529
     C****                 MOVE '1'       *IN45                           E32529
     C****                 END                             ** E02         E32529
     C**                                                   **************
     C           SENDCO    TAG                             * SENDCO TAG *
     C**
     C                     Z-ADD0         SCOPN   50
     C                     MOVE *BLANK    ACST2   1                       047179
     C**                                                   **************
     C*  STORE REMITTING BANK IF IT AND PAY CURRENCY ARE VALID
     C**
     C           *IN47     IFEQ '0'                        ** B01
     C           *IN45     ANDEQ'0'
     C*                                                                   S01117
     C** IF SINGLE BRANCH AND RBKT IS FULL ACCOUNT ADD SINGLE BRANCH      S01117
     C** TO END OF RBK1 FILED.                                            S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'N'                                       S01117
     C           RBKT      ANDEQ'G'                                       S01117
     C**********           MOVELSRBK1     RBKW2  18                                    S01117 CGL029
     C                     MOVELSRBK1     RBKW2  24                                           CGL029
     C                     MOVE BJSBRC    RBKW2                           S01117
     C                     MOVELRBKW2     RBK1                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SRBK1     RBK1
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE SRBK2     RBK2
     C                     MOVE SRBK3     RBK3
     C                     MOVE SRBK4     RBK4
     C                     END                             ** E01
     C*                                                                   S01194
     C** CHECK FOR INVALID ? ENTERED IN SSNCO FIELD                       S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASSNCO     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C           *IN29     IFEQ '0'                                       S01194
     C*                                                                   S01194
     C**
     C*    SET SENDER'S CORRESPONDENT & TYPE TO ZER0/BLANK
     C**
     C**********           Z-ADD0         SNCO                                                CSD027
     C                     MOVE *BLANKS   SNCO                                                CSD027
     C                     MOVE ' '       SNCT
     C**
     C*  IF REMITTING BANK IS NOT AN A/C OR NOSTRO THEN SENDER'S
     C*    CORRESPONDENT IS MANDATORY
     C**
     C           RMBKAC    IFEQ 'N'                        ** B01
     C           SSNCO     ANDEQ*BLANKS
     C                     ADD  1         S
     C*********************MOVE ' 255'    ERCD,S                          S01117
     C                     MOVE ' 035'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C                     END                             ** E01
     C* NO ENTRY ALLOWED IF REMIT. BANK IS FULL ACCOUNT, NOSTRO, OR
     C* RETAIL ACCOUNT NUMBER, AND PAY CCY = DESTINATION A/C CCY
     C           RBKT      IFEQ 'F'
     C           SPCCY     ANDEQRCCYN
     C           RBKT      OREQ 'G'
     C           SPCCY     ANDEQRCCYG
     C           RBKT      OREQ 'R'
     C           SPCCY     ANDEQCCYSTO
     C           SSNCO     IFNE *BLANKS
     C                     ADD  1         S
     C*********************MOVE ' 517'    ERCD,S                          S01117
     C                     MOVE ' 040'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C                     GOTO SNDEND
     C                     END
     C                     END
     C**
     C*  MOVE SENDER'S CORRESPONDENT TO DS FOR FURTHER VALIDATION
     C**
     C                     MOVE SSNCO     SSNCOX
     C**
     C*  SENDER'S CORRESPONDENT ONLY FURTHER VALIDATED IF PCCY IS VALID.
     C*    IF ENTERED SENDER'S CORRESPONDENT MUST BE NUMBER OF A NOSTRO
     C*****IN*PAY*CCY*-*MUST*BE*ON*PF/TABLETL;*OR*IT*MUST*BE*A*RETAIL**   S01194
     C*    IN PAY CCY - MUST BE ON PF/SDNOSTPD; OR IT MUST BE A RETAIL    S01194
     C*    NUMBER OF AN ACCOUNT IN PCCY - MUST BE ON LF/ACNUMA.
     C**
     C           *IN47     IFEQ '0'                        ** B01
     C*
     C           SSNCO     IFNE *BLANKS                    ** B02
     C           SSNCO2    IFNE *BLANKS                    ** B03
     C           SSNCO8    ANDEQ*BLANKS
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************MOVELSPCCY     ZTAB08                          S01194
     C                     MOVELSSNCO     ZTAB11
     C*********************EXSR TABCHN                                    S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @CUST                           S01194
     C                     PARM SPCCY     @CYCD                           S01194
     C                     PARM *BLANKS   @ACCD                           S01194
     C                     PARM *BLANKS   @ACSN                           S01194
     C                     PARM ZTAB11    @NONB                           S01194
     C                     PARM *BLANKS   @BRCD                           S01194
     C                     PARM *BLANKS   @CSSN                           S01194
     C                     PARM *BLANKS   @PNOI                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     CASEQ*BLANKS   MVNOST     8989                 S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN89     IFEQ '1'                        ** B04
     C                     ADD  1         S
     C*********************MOVE ' 256'    ERCD,S                          S01117
     C                     MOVE ' 036'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C                     ELSE                            ** X04
     C                     MOVE 'N'       SNCT
     C                     MOVE CNUM      ACNTCN
     C                     MOVELSPCCY     ACNTCY
     C                     MOVE ACOD      ACNTAC
     C                     MOVE ACSQ      ACNTAS
     C                     MOVE A7BRCD    ACNTBR                          S01194
     C                     EXSR ACCCHN
     C                     MOVE ACST      ACST2                           047179
     C*
     C           ATYP      IFEQ 'R'                        ** B05
     C                     Z-ADDDACO      SCOPN
     C                     END                             ** E05
     C*
     C                     END                             ** E04
     C*
     C                     ELSE                            ** X03
     C                     MOVE SSNCO     SSNCON 100
     C           SSNCON    CHAINACNUMA               99
     C  N99      RECI      COMP 'D'                  9999
     C           *IN99     IFEQ '1'                        ** B04
     C                     ADD  1         S
     C*********************MOVE ' 034'    ERCD,S                          S01117
     C                     MOVE ' 033'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C                     ELSE                            ** X04
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     46
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 026'    ERCD,S                          S01117
     C*
     C                     ELSE
     C           CCY       IFNE PCCY                       ** B05
     C                     ADD  1         S
     C*********************MOVE ' 257'    ERCD,S                          S01117
     C                     MOVE ' 037'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C*********************ELSE                            ** X05         E32859
     C                     END                             ** E05         E32859
     C*
     C                     MOVE 'R'       SNCT
     C                     MOVE ACST      ACST2                           047179
     C*
     C           ATYP      IFEQ 'R'                        ** B06
     C                     Z-ADDDACO      SCOPN
     C                     END                             ** E06
     C*
     C*********************END                             ** E05         E32859
     C*
     C                     END                             ** E03
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  STORE SENDER'S CORRESPONDENT IF PAY CURRENCY IS VALID
     C*    ALSO STORE CUSTOMER NUMBER.
     C**
     C           *IN47     IFEQ '0'                        ** B01
     C           *IN46     ANDEQ'0'
     C                     MOVE SSNCO     SNCO
     C           SNCT      IFNE *BLANKS                    ** B02
     C**********           Z-ADDCNUM      CNUMS   60                                          CSD027
     C                     MOVE CNUM      CNUMS   6                                           CSD027
     C                     ELSE                            ** X02
     C**********           Z-ADD0         CNUMS                                               CSD027
     C                     MOVE *BLANKS   CNUMS                                               CSD027
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C** REMITTING BANK AND SENDERS CORRESPONDANT CANNOT BE THE SAME
     C*
     C*  If Remitting Bank is an alpha address, re-set customer no.       035390
     C*                                                                   035390
     C           RBKT      IFEQ 'A'                                       035390
     C**********           Z-ADD0         CNUMR                                        035390 CSD027
     C                     MOVE *BLANKS   CNUMR                                               CSD027
     C                     END                                            035390
     C*                                                                   035390
     C           *IN46     IFNE '1'
     C           CNUMS     ANDEQCNUMR
     C********** CNUMS     ANDNE*ZERO                                                         CSD027
     C           CNUMS     ANDNE*BLANKS                                                       CSD027
     C                     ADD  1         S
     C*********************MOVE ' 123'    ERCD,S                          S01117
     C                     MOVE ' 034'    ERCD,S                          S01117
     C                     MOVE '1'       *IN46
     C                     END
     C*                                                                   S01194
     C** INVALID ? ENTERED IN FIELD                                       S01194
     C*                                                                   S01194
     C                     ELSE                                           S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 041'    ERCD,S                          S01194
     C                     SETON                     46                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           SNDEND    TAG
     C**
     C*  PAY VALUE DATE IS MANDATORY & MUST BE VALID DATE
     C*  - AND MUST ALSO BE GREATER OR EQUAL TO CURRENT PROCESSING DATE   E32859
     C**
     C           SPYDT     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 260'    ERCD,S                          S01117
     C                     MOVE ' 044'    ERCD,S                          S01117
     C                     MOVE '1'       *IN48
     C                     ELSE                            ** X01
     C*
     C* CHECK IF DATE IS NUMERIC
     C                     MOVELSPYDT     DATEL   70
     C                     MOVELDATEL     DATES   6
     C           SPYDT     IFNE DATES                      B002
     C                     SETON                     99
     C                     ELSE                            X002
     C                     MOVE SPYDT     ZDATE
     C                     EXSR ZDATE1
      *                                                                   E32543
      ** THE PAY DATE MUST NOT BE A HOLIDAY IN LOCAL CURRENCY             E32543
      *                                                                   E32543
     C                     MOVE BJLCCY    ZCCY                            E32543
     C                     EXSR ZCHKH                                     E32543
      *                                                                   E32543
      ** if ZIND = 'H' then the date is a holiday                         E32543
      *                                                                   E32543
     C           ZIND      IFEQ 'H'                        ** B03         E32543
     C                     SETON                     1926                 E32543
     C                     ADD  1         S                               E32543
     C*********************MOVEA' W11'    ERCD,S                    E32543S01117
     C                     MOVEA' W02'    ERCD,S                          S01117
     C                     ELSE                            ** X03         E32543
     C                     SETOF                     26                   E32543
     C                     END                             ** E03         E32543
      *                                                                   E32543
     C                     END                             E002
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 261'    ERCD,S                          S01117
     C                     MOVE ' 045'    ERCD,S                          S01117
     C                     MOVE '1'       *IN48
     C                     ELSE                            ** X02
      *                                                                   047179
      *  Check if date is in the future and if the account is             047179
      *  closing today                                                    047179
      *                                                                   047179
     C           ZDAYNO    IFGT BJRDNB                                    047179
     C           ACST1     ANDEQ'C'                                       047179
     C                     SETON                     45                   047179
     C                     ADD  1         S                               047179
     C                     MOVEA' 601'    ERCD,S                          047179
     C                     END                                            047179
      *                                                                   047179
     C           ZDAYNO    IFGT BJRDNB                                    047179
     C           ACST2     ANDEQ'C'                                       047179
     C                     SETON                     46                   047179
     C                     ADD  1         S                               047179
     C                     MOVEA' 602'    ERCD,S                          047179
     C                     END                                            047179
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP23                                           S01408
     C*                                                                   S01408
     C*
     C           RBKT      IFNE 'R'                        ** B03         E32859
     C           SNCT      ANDNE'R'                                       E32859
     C           ZDAYNO    ANDLTBJRDNB                                    E32859
     C                     SETON                     48                   E32859
     C                     ADD  1         S                               E32859
     C*********************MOVEA' 262'    ERCD,S                    E32859S01117
     C                     MOVEA' 046'    ERCD,S                          S01117
     C                     END                             ** E03         E32859
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP24                                           S01408
     C*                                                                   S01408
     C*                                                                   E32859
     C* FOR BACK VALUE IF RETAIL OPEN DATE WILL BE NON-ZERO
     C*
     C           SCOPN     IFEQ 0                          B003
     C*
     C           RBOPN     IFNE 0                          B004
     C*
     C           ZDAYNO    IFLT RBOPN                      B005
     C*********************SETON                     45                   E32859
     C                     SETON                     4548                 E32859
     C                     ADD  1         S
     C*********************MOVEA' 356'    ERCD,S                          S01117
     C                     MOVEA' 024'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C           ZDAYNO    IFLT BVLD                       B005
     C*********************SETON                     45                   E32859
     C                     SETON                     4548                 E32859
     C                     ADD  1         S
     C*********************MOVEA' 371'    ERCD,S                          S01117
     C                     MOVEA' 025'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C                     ELSE                            X003
     C           ZDAYNO    IFLT SCOPN                      B004
     C*********************SETON                     46                   E32859
     C                     SETON                     4648                 E32859
     C                     ADD  1         S
     C*********************MOVEA' 373'    ERCD,S                          S01117
     C                     MOVEA' 038'    ERCD,S                          S01117
     C                     END                             E004
     C*
     C           ZDAYNO    IFLT BVLD                       B004
     C*********************SETON                     46                   E32859
     C                     SETON                     4648                 E32859
     C                     ADD  1         S
     C*********************MOVEA' 360'    ERCD,S                          S01117
     C                     MOVEA' 039'    ERCD,S                          S01117
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C                     Z-ADDZDAYNO    PVDT
     C                     END                             ** E02
     C*
     C                     END                             ** E01
     C*                                                                   CEU006
     C/COPY WNCPYSRC,FT0080C012
     C* Check that one of the currencies entered is 'IN' if               CEU006
     C* both Debit and Notify Delivery Currency has been entered.         CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SPDCY     IFNE *BLANKS                                   CEU006
     C                     SELEC                                          CEU006
     C           P#INCY    WHEQ 'Y'                                       CEU006
     C           P#INC1    ANDNE'Y'                                       CEU006
     C           P#TPSD    ANDLEPVDT                                      CEU006
     C*                                                                   CEU006
     C           P#INC1    WHEQ 'Y'                                       CEU006
     C           P#INCY    ANDNE'Y'                                       CEU006
     C           P#TPS1    ANDLEPVDT                                      CEU006
     C*                                                                   CEU006
     C                     OTHER                                          CEU006
     C                     MOVEL'FTM2571' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL  10                       CEU006
     C                     PARM           MSGID  10                       CEU006
     C                     MOVE 'Y'       PDCERR                          CEU006
     C                     MOVE *ON       *IN47                           CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDSL                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C**
     C*  TOTAL REMITTANCE IS MANDATORY & MUST BE NUMERIC WITH NO MORE
     C*    DECIMAL PLACES THAN PAY CURRENCY.
     C**
      ** If CEU006 is not set on, do previous processing.                 143962
      *                                                                   143962
     C           CEU006    IFNE 'Y'                                       143962
     C           STOTR     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 265'    ERCD,S                          S01117
     C                     MOVE ' 049'    ERCD,S                          S01117
     C                     MOVE '1'       *IN50
     C                     ELSE                            ** X01
     C                     Z-ADD0         TOTR                            143962
     C           *IN47     IFEQ '0'                        ** B02         143962
     C                     MOVE *BLANKS   ZFIELD                          143962
     C                     MOVE STOTR     ZFIELD                          143962
     C           13        SUB  PCCYDP    ZADIG                           143962
     C                     Z-ADDPCCYDP    ZADEC                           143962
     C                     EXSR ZALIGN                                    143962
     C           *IN99     IFEQ '1'                        ** B03         143962
     C                     ADD  1         S                               143962
     C                     MOVE ' 050'    ERCD,S                          143962
     C                     MOVE '1'       *IN50                           143962
     C                     ELSE                            ** X03         143962
     C                     MOVE ZFIELD    TOTR                            143962
     C                     END                             ** E03         143962
     C                     END                             ** E02         143962
     C                     END                             ** E01         143962
     C*                                                                   CEU006
     C***********CEU006    IFEQ 'Y'                                CEU006 143962
      ** CEU006 set on.                                                   143962
     C                     ELSE                                           143962
      *                                                                   143962
     C           SPDAM     IFEQ *BLANKS                                   143962
     C           STOTR     ANDEQ*BLANKS                                   143962
     C                     ADD  1         S                               143962
     C                     MOVE ' 049'    ERCD,S                          143962
     C                     MOVE '1'       *IN50                           143962
     C                     ELSE                            ** X01         143962
      *                                                                   143962
     C                     Z-ADD0         PDAM   130                      CEU006
     C           *IN47     IFEQ '0'                                       CEU006
     C           PDCERR    ANDNE'Y'                                       CEU006
     C                     MOVE *BLANKS   ZFIELD                          CEU006
     C                     MOVE SPDAM     ZFIELD                          CEU006
     C           13        SUB  P#NBDP    ZADIG                           CEU006
     C                     Z-ADDP#NBDP    ZADEC                           CEU006
     C                     EXSR ZALIGN                                    CEU006
     C           *IN99     IFEQ '1'                                       CEU006
     C                     MOVEL'FTM2570' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       PDAERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE ZFIELD    PDAM                            CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C***********          ENDIF                                   CEU006 143962
     C*
     C                     Z-ADD0         TOTR
     C           *IN47     IFEQ '0'                        ** B02
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE STOTR     ZFIELD
     C           13        SUB  PCCYDP    ZADIG
     C                     Z-ADDPCCYDP    ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 266'    ERCD,S                          S01117
     C                     MOVE ' 050'    ERCD,S                          S01117
     C                     MOVE '1'       *IN50
     C                     ELSE                            ** X03
     C                     MOVE ZFIELD    TOTR
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C                     END                             ** E01         143962
     C**
     C*  IF CORRESPONDENT'S CHARGES IS ENTERED IT MUST BE A NUMERIC WITH
     C*    NO MORE DECIMAL PLACES THAN PAY CURRENCY.
     C*     ONLY VALIDATED IF PAY CURRENCY IS VALID.
     C**
     C                     Z-ADD0         COCH
     C*
     C           *IN47     IFEQ '0'                        ** B01
     C*
     C           SCOCH     IFNE *BLANKS                    ** B02
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCOCH     ZFIELD
     C           11        SUB  PCCYDP    ZADIG
     C                     Z-ADDPCCYDP    ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 267'    ERCD,S                          S01117
     C                     MOVE ' 051'    ERCD,S                          S01117
     C                     MOVE '1'       *IN51
     C                     ELSE                            ** X03
     C                     MOVE ZFIELD    COCH
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF CORRESPONDENT IF VAT FEATURE IS ON.         S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SCVAT1    IFNE 'Y'                                       S01499
     C           SCVAT1    ANDNE'N'                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 092'    ERCD,S                          S01499
     C                     MOVE '1'       *IN06                           S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** COMPUTE VAT FOR CORRESPONDENT IF VAT FEATURE IS ON.              S01499
     C*                                                                   S01499
     C                     Z-ADD0         PCVATC                          S01499
     C                     Z-ADD0         PCVTRC                          S01499
     C                     MOVE SCVAT1    PCVAT1                          S01499
     C                     MOVE *BLANKS   SVATCO                          S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           *IN47     ANDEQ'0'                                       S01499
     C*                                                                   S01499
     C           *IN51     IFEQ '0'                                       S01499
     C           SCOCH     ANDNE*BLANKS                                   S01499
     C           SCVAT1    ANDEQ'Y'                                       S01499
     C           COCH      MULT O#VATR    PCVATC    H                     S01499
     C                     Z-ADDO#VATR    PCVTRC                          S01499
     C*                                                                   S01499
     C** FORMAT VAT CORRESPONDENT FIELD FOR REDISPLAY                     S01499
     C*                                                                   S01499
     C                     Z-ADDPCCYDP    A6NBDP                          S01499
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PCVATC    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATCO                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   CEU006
     C** Call FT0010 to calculate Credit or Pay Delivery Currencies.      CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           *LIKE     DEFN TOTR      STORE                           CEU006
     C           PDCERR    IFNE 'Y'                                       CEU006
     C           PDAERR    ANDNE'Y'                                       CEU006
     C           *IN48     ANDNE'1'                                       CEU006
     C           *IN49     ANDNE'1'                                       CEU006
     C           *IN50     ANDNE'1'                                       CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     MOVE SPCCY     P#CRCY                          CEU006
     C                     Z-ADD0         STORE                           CEU006
     C                     Z-ADDTOTR      STORE                           CEU006
     C                     Z-ADDTOTR      P#CRAM                          CEU006
      *                                                                   143962
      ** Only pass total remittance + correspondent charges +             143962
      ** VAT charges when total remittance is inserted.                   143962
      *                                                                   143962
     C           STORE     IFNE *ZERO                                     143962
     C                     ADD  COCH      P#CRAM                          CEU006
     C                     ADD  PCVATC    P#CRAM                          CEU006
     C                     END                                            143962
      *                                                                   143962
     C                     MOVE SPDCY     P#PDCY                          CEU006
     C                     Z-ADDPDAM      P#PDAM                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     MOVE 'Y'       P#SDIN                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C           STORE     IFNE *ZERO                                     CEU006
     C                     Z-ADDSTORE     TOTR                            CEU006
     C                     ELSE                                           CEU006
     C                     Z-ADDP#CRAM    TOTR                            CEU006
     C                     SUB  COCH      TOTR                            143962
     C                     SUB  PCVATC    TOTR                            143962
     C                     ENDIF                                          CEU006
     C           P#INDC    IFNE '00000'                                   CEU006
     C                     MOVE *ON       *IN50                           CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     MOVE 'Y'       PDAERR                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE TOTR      EDITIN                          CEU006
     C                     Z-ADDP#NBD1    A6NBDP                          CEU006
     C                     EXSR EDIT                                      CEU006
     C*********************MOVEADIG2,3    STOTR                     CEU006179627
     C                     MOVEADIG2      STOTR                           179627
     C                     Z-ADDP#PDAM    PDAM                            CEU006
     C                     MOVE P#PDAM    EDITIN                          CEU006
     C                     Z-ADDP#NBDP    A6NBDP                          CEU006
     C                     EXSR EDIT                                      CEU006
     C*********************MOVEADIG2,3    SPDAM                     CEU006179627
     C                     MOVEADIG2      SPDAM                           179627
     C                     MOVELSPDCY     PDCY                            CEU006
     C                     ENDIF                                          CEU006
     C           SPDCY     IFEQ *BLANKS                                   CEU006
     C           PDAM      ANDEQ*ZERO                                     CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     Z-ADD*ZERO     PDAM                            CEU006
     C                     Z-ADD*ZERO     NDAM                            CEU006
     C                     ENDIF                                          CEU006
     C**
     C*  IF DEDUCTIONS IS ENTERED IT MUST BE A NUMERIC WITH NO MORE
     C*    DECIMAL PLACES THAN PAY CURRENCY.
     C*     ONLY VALIDATED IF PAY CURRENCY IS VALID.
     C**
     C                     Z-ADD0         DEDS
     C*
     C           *IN47     IFEQ '0'                        ** B01
     C*
     C           SDEDS     IFNE *BLANKS                    ** B02
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDEDS     ZFIELD
     C           11        SUB  PCCYDP    ZADIG
     C                     Z-ADDPCCYDP    ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 268'    ERCD,S                          S01117
     C                     MOVE ' 052'    ERCD,S                          S01117
     C                     MOVE '1'       *IN52
     C                     ELSE                            ** X03
     C                     MOVE ZFIELD    DEDS
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF DEDUCTION IF VAT FEATURE IS ON.             S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SCVAT2    IFNE 'Y'                                       S01499
     C           SCVAT2    ANDNE'N'                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 093'    ERCD,S                          S01499
     C                     MOVE '1'       *IN12                           S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** COMPUTE VAT FOR DEDUCTION IF VAT FEATURE IS ON.                  S01499
     C*                                                                   S01499
     C                     Z-ADD0         PCVATD                          S01499
     C                     Z-ADD0         PCVTRD                          S01499
     C                     MOVE SCVAT2    PCVAT2                          S01499
     C                     MOVE *BLANKS   SVATDE                          S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           *IN47     ANDEQ'0'                                       S01499
     C*                                                                   S01499
     C           *IN52     IFEQ '0'                                       S01499
     C           SDEDS     ANDNE*BLANKS                                   S01499
     C           SCVAT2    ANDEQ'Y'                                       S01499
     C           DEDS      MULT O#VATR    PCVATD    H                     S01499
     C                     Z-ADDO#VATR    PCVTRD                          S01499
     C*                                                                   S01499
     C** FORMAT VAT CORRESPONDENT FIELD FOR REDISPLAY                     S01499
     C*                                                                   S01499
     C                     Z-ADDPCCYDP    A6NBDP                          S01499
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PCVATD    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATDE                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*  PROCEEDS REMITTED DEFAULTS TO TOTAL REMITTANCE, IF ENTERED MUST
     C*    BE NUMERIC WITH NO MORE DECIMAL PLACES THAN PAY CURRENCY
     C*    AND MUST BE LESS THAN OR EQUAL TO TOTAL REMITTANCE
     C**
     C           SPRRM     IFEQ *BLANKS                    ** B01
     C**         *IN47     IFEQ '0'                        ** B02
     C**         *IN50     ANDEQ'0'
     C  N47N50N51
     CANN52                DO                              ** B02
     C                     MOVE STOTR     SPRRM
     C                     Z-ADDTOTR      PRRM
     C           TOTR      ADD  COCH      PRRM
     C                     SUB  DEDS      PRRM
     C                     ADD  PCVATC    PRRM                            S01499
     C                     SUB  PCVATD    PRRM                            S01499
     C*
     C* ENSURE PROCEEDS CANNOT DEFAULT TO -VE AMOUNT
     C*
     C           PRRM      IFLT 0                          ** B03
     C                     ADD  1         S
     C*********************MOVE ' 506'    ERCD,S                          S01117
     C                     MOVE ' 053'    ERCD,S                          S01117
     C                     MOVE '1'       *IN52
     C                     Z-ADD0         PRRM
     C                     MOVE *BLANKS   SPRRM
     C                     ELSE                            ** X03
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE PRRM      EDITIN
     C                     Z-ADDPCCYDP    A6NBDP                          CEU006
     C                     EXSR EDIT
     C                     MOVEADIG2      SPRRM
     C                     END                             ** E03
     C                     END                             ** E02
     C                     ELSE                            ** X01
     C*
     C           *IN47     IFEQ '0'                        ** B02
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SPRRM     ZFIELD
     C           13        SUB  PCCYDP    ZADIG
     C                     Z-ADDPCCYDP    ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 264'    ERCD,S                          S01117
     C                     MOVE ' 048'    ERCD,S                          S01117
     C                     MOVE '1'       *IN49
     C                     ELSE                            ** X03
     C                     MOVE ZFIELD    PRRM
     C  N50N51N52          DO                              ** B04
     C           TOTR      ADD  COCH      WTOT   130
     C                     SUB  DEDS      WTOT
     C                     ADD  PCVATC    WTOT                            S01499
     C                     SUB  PCVATD    WTOT                            S01499
     C           PRRM      IFNE WTOT                       ** B05
     C                     ADD  1         S
     C*********************MOVE ' 263'    ERCD,S                          S01117
     C                     MOVE ' 047'    ERCD,S                          S01117
     C                     MOVE '1'       *IN49
     C                     END                             ** E05
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  SETTLEMENT TYPE MUST BE '01', '02', '08', '12' OR '13'
     C**
     C/COPY WNCPYSRC,FT0080C005
     C           SSTTP     IFNE '01'
     C           SSTTP     ANDNE'02'
     C           SSTTP     ANDNE'08'
     C           SSTTP     ANDNE'10'
     C           SSTTP     ANDNE'12'
     C           SSTTP     ANDNE'13'
     C/COPY WNCPYSRC,FT0080C006
     C                     ADD  1         S
     C*********************MOVE ' 064'    ERCD,S                          S01117
     C                     MOVE ' 054'    ERCD,S                          S01117
     C                     MOVE '1'       *IN53
     C                     ELSE                            ** X01
     C/COPY WNCPYSRC,FT0080C007
     C                     MOVE SSTTP     STMT
     C           SSTTP     IFEQ '08'                       B002
     C           *IN45     ANDEQ'0'
     C*
     C*  FOR SETTLEMENT '08' VALIDATE REMITTING BANK AS A SWIFT USER FOR
     C*    ALL CASES EXCEPT NAME AND ADDRESS
     C           RBKT      IFNE 'A'                        B003
     C           *IN47     ANDEQ'0'
     C*
     C*********************                                               S01194
     C*********************MOVE CNUMR     CNUMKY                          S01194
     C***********CLINTK****CHAINCLINT                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C*                                                                   S01194
     C                     MOVE CNUMR     CNUMA   6                       S01194
     C*                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM CNUMA     @KEY1                           S01194
     C                     PARM *BLANKS   @KYST                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              9999                 S01194
     C*                                                                   S01194
     C           @KYST     IFNE '*CNUM  '                                 S01194
     C                     SETON                     99                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN99     IFEQ '1'                        ** B004
     C*********************MOVE *BLANK    CSID                            S01194
     C                     MOVE *BLANK    BBCSID                          S01194
     C                     ELSE                                           S01194
     C                     MOVE BBCUST    CNUM                            S01194
     C                     END                             ** E004
     C                     ELSE                            X003
     C*********************MOVE *BLANK    CSID                            S01194
     C                     MOVE *BLANK    BBCSID                          S01194
     C                     END                             ** E03
     C***********CSID******IFEQ *BLANK                     B003
     C           BBCSID    IFEQ *BLANK                     B003
     C           RBKT      ANDNE'S'                        B003           094278
     C                     SETON                     4569
     C                     ADD  1         S
     C*********************MOVE ' W02'    ERCD,S                          S01117
     C                     MOVE ' W01'    ERCD,S                          S01117
     C                     END                             E003
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  SEND MT202 INDICATOR MAY ONLY BE 'Y' OR 'N'
     C**
     C           SSNMT     IFNE *BLANKS                    ** B01
     C           SSNMT     ANDNE'Y'
     C           SSNMT     ANDNE'N'
     C                     ADD  1         S
     C*********************MOVE ' 067'    ERCD,S                          S01117
     C                     MOVE ' 057'    ERCD,S                          S01117
     C                     MOVE '1'       *IN55
     C                     END                             ** E01
     C**
     C*  SEND MT202 INDICATOR DEFAULTS TO 'Y' IF SENDER'S CORRESPONDENT
     C*    IS ENTERED AND VALID
     C**
     C           SSNMT     IFEQ *BLANKS                    ** B01
     C           SSNCO     ANDNE*BLANKS
     C           *IN46     ANDEQ'0'
     C                     MOVE 'Y'       SSNMT
     C                     END                             ** E01
     C**
     C*  SEND MT202 INDICATOR DEFAULTS TO 'N' IF SENDER'S CORRESPONDENT
     C*    IS BLANK AND VALID
     C**
     C           SSNMT     IFEQ *BLANKS                    ** B01
     C           SSNCO     ANDEQ*BLANKS
     C           *IN46     ANDEQ'0'
     C                     MOVE 'N'       SSNMT
     C                     END                             ** E01
     C**
     C*  SEND MT202 IND. MUST BE 'N' IF SENDER'S CORRESPONDENT IS BLANK
     C**
     C           SSNCO     IFEQ *BLANKS                    ** B01
     C           SSNMT     ANDNE'N'
     C                     ADD  1         S
     C*********************MOVE ' 066'    ERCD,S                          S01117
     C                     MOVE ' 056'    ERCD,S                          S01117
     C                     MOVE '1'       *IN55
     C                     END                             ** E01
     C**
     C           *IN55     IFEQ '0'                        ** B01
     C           *IN45     ANDEQ'0'
     C**
     C*  IF REMITTING BANK IS AN ACCOUNT AND SENDER'S CORRESPONDENT IS
     C*    AN ACCOUNT, THEN THE SEND MT202 INDICATOR MAY ONLY BE 'N' IF
     C*    BANK CODE OF THE TWO ACCOUNTS' SWIFT ADDRESSES ARE EQUAL.
     C**
     C           RMBKAC    IFEQ 'Y'                        ** B02
     C           SSNCO     ANDNE*BLANKS
     C           *IN46     ANDEQ'0'
     C*
     C*********************MOVE CNUMR     CNUMKY                          S01194
     C***********CLINTK****CHAINCLINT                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C************IN99*****IFEQ '1'                        ** B04         S01194
    C*********************MOVEL'CLINT'   WDBFIL             ************ S01194
    C*********************Z-ADD08        WDBASE             * DBERR 08 * S01194
    C*********************MOVELCLTKEY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E04         S01194
     C*                                                                   S01194
     C                     MOVE CNUMR     CNUMA   6                       S01194
     C*                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM CNUMA     @KEY1                           S01194
     C                     PARM *BLANKS   @KYST                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C                     MOVE BBCUST    CNUM                            S01194
     C*                                                                   S01194
     C                     MOVE BBCSID    CODE1   4                       S01194
     C*********************MOVE CSID      CODE1   4                       S01194
     C*********************                                               S01194
     C*********************MOVE CNUMS     CNUMKY                          S01194
     C***********CLINTK****CHAINCLINT                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C************IN99*****IFEQ '1'                        ** B03         S01194
    C*********************MOVEL'CLINT'   WDBFIL             ************ S01194
    C*********************Z-ADD09        WDBASE             * DBERR 09 * S01194
    C*********************MOVELCLTKEY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E03         S01194
     C*                                                                   S01194
     C                     MOVE CNUMS     CNUMA                           S01194
     C*                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM CNUMA     @KEY1                           S01194
     C                     PARM *BLANKS   @KYST                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C                     MOVE BBCUST    CNUM                            S01194
     C                     MOVE BBCSID    CODE2   4                       S01194
     C*                                                                   S01194
     C*********************MOVE CSID      CODE2   4                       S01194
     C*
     C           SSNMT     IFEQ 'N'                        ** B03
     C           CODE1     ANDNECODE2
     C           SPCCY     ANDNEBJCYCD                                    S01194
     C***********SPCCY*****ANDNEBCCY                                      S01194
     C                     ADD  1         S
     C*********************MOVE ' 065'    ERCD,S                          S01117
     C                     MOVE ' 055'    ERCD,S                          S01117
     C                     MOVE '1'       *IN55
     C                     END                             ** E03
     C*
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C           *IN55     IFEQ '0'                        ** B01
     C                     MOVE SSNMT     SNMT
     C                     END                             ** E01
     C**
     C***SWIFT*PRIOITY*CODE*DEFAULTS*TO*'02'*                             S01117
     C*  SWIFT PRIOITY CODE DEFAULTS TO 'N'                               S01117
     C**
     C           SSWPC     IFEQ *BLANKS                    ** B01
     C*********************MOVE '02'      SSWPC                           S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     END                             ** E01
     C**
     C***SWIFT*PRIORITY*CODE*MUST*BE*'01','02','11',OR '12'.*             S01117
     C*  SWIFT PRIORITY CODE MUST BE 'U',OR 'N'.                          S01117
     C**
     C***********SSWPC*****IFNE '01'                       ** B01         S01117
     C***********SSWPC*****ANDNE'02'                                      S01117
     C***********SSWPC*****ANDNE'11'                                      S01117
     C***********SSWPC*****ANDNE'12'                                      S01117
      *
     C           SSWPC     IFNE 'U'                        ** B01         S01117
     C           SSWPC     ANDNE'N'                                       S01117
     C                     ADD  1         S
     C*********************MOVE ' 063'    ERCD,S                          S01117
     C                     MOVE ' 058'    ERCD,S                          S01117
     C                     MOVE '1'       *IN54
     C                     ELSE                            ** X01
     C*********************MOVE SSWPC     SWPC                            S01117
      *
     C           SSWPC     IFEQ 'U'                        ** B02         S01117
     C                     Z-ADD1         SWPC                            S01117
     C                     ELSE                            ** X02         S01117
      *
     C           SSWPC     IFEQ 'N'                        ** B03         S01117
     C                     Z-ADD2         SWPC                            S01117
     C                     END                             ** E03         S01117
      *
     C                     END                             ** E02         S01117
      *
     C                     END                             ** E01
      *                                                                   S01414
      ** Check Book Code field for entry of ?                             S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASHBOKC    FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     29               S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN30                           S01414
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     CALL 'AOBOOKR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDBOOK    SHBOKC                          S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SHBOKC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Book Code.                                          S01414
      *                                                                   S01414
     C                     MOVELSHBOKC    W#BOKC                          S01414
     C                     EXSR SRBOOK                                    S01414
     C                     MOVELW#BOKC    SHBOKC                          S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN25     IFEQ '0'                                       S01414
     C                     MOVELW#BOKC    HBOKC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Check Profit Centre field for entry of ?                         S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASHPRFC    FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     29               S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN30                           S01414
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     CALL 'AOPRFCR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDPRFC    SHPRFC                          S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SHPRFC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Profit Centre if Used.                              S01414
      *                                                                   S01414
     C                     MOVELSHPRFC    W#PRFC                          S01414
     C                     EXSR SRPRFC                                    S01414
     C                     MOVELW#PRFC    SHPRFC                          S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN33     IFEQ '0'                                       S01414
     C                     MOVELW#PRFC    HPRFC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *
      *  END of screen validation
     C/COPY WNCPYSRC,FT0080C013
      *
      *
      * Determine if errors exist
      *
     C           S         IFGE 1                          ** B01
     C                     MOVE '1'       *IN75
     C           S         IFGT 19                         ** B02
     C                     MOVE '1'       *IN76
     C                     END                             ** E02
     C                     END                             ** E01
      *
      ** Set Drawee  to Senders corresepondent type else Remitting Bank.
      *
     C           SNCT      IFNE *BLANKS
     C                     MOVE *BLANKS   DRWDS
     C                     MOVE SNCT      DRWT
     C                     MOVELSNCO      DRW1
     C                     ELSE
     C                     MOVE RBKDS     DRWDS
     C                     END
      *
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    VALDI - SR TO VALIDATE DETAIL INSERT
     C**
     C           VALDI     BEGSR
     C**
     C**                                                                  S01117
     C*  ACCESS LF/PYCHGDB TO GET VARIOUS DETAILS                         S01117
     C**                                                                  S01117
     C           ORBR      CHAINPYCHGDB              99                   S01117
     C           *IN99     IFEQ '1'                        ** B01         S01117
     C                     MOVEL'PYCHG'   WDBFIL             ************ S01117
     C                     Z-ADD5         WDBASE             * DBERR 05 * S01117
     C                     MOVE *BLANKS   ERRMSG             ************ S01117
     C                     MOVE 'PAYMENT 'ERMSG1                          S01117
     C                     MOVE 'CHARGES 'ERMSG2                          S01117
     C                     MOVEL'RECORD M'ERMSG3                          S01117
     C                     MOVEL'ISSING  'ERMSG4                          S01117
     C                     MOVELERRMSG    WDBKEY                          S01117
     C                     EXSR ENDPGM                                    S01117
     C                     END                             ** E01         S01117
      *                                                                   S01117
      ** Convert rate % discrepancy to higher & lower rate margins.       S01117
      *                                                                   S01117
     C           1         ADD  RATDIS    UPMARG  74                      S01117
     C           1         SUB  RATDIS    LWMARG  74                      S01117
     C**                                                                  S01117
     C*  CLEAR ERROR CODES ARRAY, RESET POINTER, RESET FIELD ERROR
     C*    AND ERROR CODE ARRAY INDICATORS
     C**
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     MOVEA'00000000'*IN,56
     C                     MOVEA'0000'    *IN,64
     C                     MOVEA'000'     *IN,83                          S01499
     C                     MOVEA'00'      *IN,75
     C*
     C                     MOVEA'00'      *IN,26                          E32543
     C                     MOVE '0'       *IN,19                          E32543
     C                     MOVE '0'       *IN,23                          E32543
     C*
     C                     MOVE '0'       *IN,25                          S01414
     C                     MOVE '0'       *IN,33                          S01414
     C                     MOVE '0'       *IN,20                          S01494
     C                     MOVE '0'       *IN13                           S01499
     C                     MOVE '0'       *IN87                           S01499
     C*                                                                   CEU006
     C/COPY WNCPYSRC,FT0080C017
     C** Notified delivery currency is optional, if entered check that    CEU006
     C** it is a valid currency.                                          CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SNDCY     IFNE *BLANKS                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM SNDCY     @CYCD                           CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
     C*                                                                   CEU006
     C           @RTCD     IFEQ '*NOSEL '                                 CEU006
     C                     MOVE *BLANKS   SNDCY                           CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'FTM2562' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL  10                       CEU006
     C                     PARM           MSGID  10                       CEU006
     C                     MOVE 'Y'       NDCERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE A6CYCD    SNDCY                           CEU006
     C                     MOVE A6CYCD    NDCY                            CEU006
     C                     MOVE A6INCY    N#INCY  1                       CEU006
     C                     MOVE A6TPSD    N#TPSD  50                      CEU006
     C                     MOVE A6NBDP    N#NBDP  10                      CEU006
     C                     EXSR MVCURR                                    CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*
     C* DEBIT CURRENCY IS MANDATORY,AND DEFAULTS ON SCREEN TO CREDIT CU
     C* CURRENCY.IF ENTERED,MUST BE VALID CCY CODE
     C**
     C           SDRCY     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 419'    ERCD,S                          S01117
     C                     MOVE ' 073'    ERCD,S                          S01117
     C                     MOVE '1'       *IN58
     C                     ELSE                            ** X01
     C*
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '20'      ZTAB01                          S01194
     C*********************MOVE SDRCY     ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*                                                                   S01194
     C** CHECK FOR ENTRY OF ? IN SDRCY                                    S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASDRCY     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SDRCY     @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ '*NOSEL '                                 S01194
     C                     MOVE *BLANKS   SDRCY                           S01194
     C                     ELSE                                           S01194
     C*
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 071'    ERCD,S                          S01117
     C                     MOVE '1'       *IN58                           S01194
     C                     ELSE                            ** X02         S01194
     C                     MOVE A6CYCD    SDRCY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*                                                                   S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B02         S01194
     C*********************ADD  1         S                               S01194
     C*********************MOVE ' 274'    ERCD,S                          S01194
     C*********************MOVE '1'       *IN58                           S01194
     C*********************ELSE                            ** X02         S01194
     C**
     C*  IF DEBIT CCY IS VALID, STORE CCY D.P. FOR LATER USE
     C**
     C*********************Z-ADDCDP       DRCYDP                          S01194
     C                     Z-ADDA6NBDP    DRCYDP                          S01194
     C                     MOVE SDRCY     DRCY
     C*********************Z-ADDSPOT      DRCYSP                          S01194
     C                     Z-ADDA6SPRT    DRCYSP                          S01194
     C                     Z-ADDMDIN      DRCYMD
     C*
     C*********************MOVE '4'       ZTAB12                          S01194
     C**READ*TABTG20*******                                               S01194
     C*********************EXSR TABCHN                                    S01194
     C* CHANGE SPOT RATE BY BUY SPREAD
     C***********BSSG******IFEQ '+'                        B003           S01194
     C***********SPOT******ADD  BSPR      PBRAT  138                      S01194
     C*********************ELSE                            X003           S01194
     C***********SPOT******SUB  BSPR      PBRAT                           S01194
     C*********************END                             E003           S01194
     C/COPY WNCPYSRC,FT0080C069
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY BUY SPREAD                                    S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B003           S01194
     C           A6SPRT    ADD  A6BYSR    PBRAT  138                      S01194
     C                     ELSE                            X003           S01194
     C           A6SPRT    SUB  A6BYSR    PBRAT                           S01194
     C                     END                             E003           S01194
     C*                                                                   S01194
     C**CHANGE*SPOT*RATE*BY*SELL*SPREAD***                                S01194
     C***********SSSG******IFEQ '+'                        B003           S01194
     C***********SPOT******ADD  SSPR      PSRAT  138                      S01194
     C*********************ELSE                            X003           S01194
     C***********SPOT******SUB  SSPR      PSRAT                           S01194
     C*********************END                             E003           S01194
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY SELL SPREAD                                   S01194
     C*                                                                   S01194
     C           A6SLSS    IFEQ '+'                        B003           S01194
     C           A6SPRT    ADD  A6SLSR    PSRAT  138                      S01194
     C                     ELSE                            X003           S01194
     C           A6SPRT    SUB  A6SLSR    PSRAT                           S01194
     C                     END                             E003           S01194
     C*
     C                     END                             ** E02
     C*
     C                     END                                            S01194
     C*
     C                     END                             ** E01
     C*                                                                   CEU006
     C** Check for 'IN' Euro or Euro 'IN' combination.                    CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE *BLANKS   N#INC1                          CEU006
     C                     Z-ADD0         N#TPS1                          CEU006
     C                     MOVE A6NBDP    N#NBD1  10                      CEU006
     C           SNDCY     IFNE *BLANKS                                   CEU006
     C           SNDCY     IFEQ BKEURO                                    CEU006
     C           A6INCY    ANDEQ'Y'                                       CEU006
     C           SDRCY     OREQ BKEURO                                    CEU006
     C           N#INCY    ANDEQ'Y'                                       CEU006
     C           A6INCY    IFEQ 'Y'                                       CEU006
     C                     MOVE A6INCY    N#INC1  1                       CEU006
     C                     MOVE A6TPSD    N#TPS1  50                      CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C                     MOVEL'FTM2588' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       NDCERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C                     MOVE *ON       *IN58                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C           SNDCY     IFEQ *BLANKS                                   CEU006
     C           SNDAM     ANDNE*BLANKS                                   CEU006
     C                     MOVEL'FTM2567' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       NDCERR  1                       CEU006
     C                     MOVE 'Y'       NDAERR                          CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*
     C* IF SETTLEMENT TYPE IS 10 MUST BE A NOSTRO
     C*
     C           STMT      IFEQ 10                         ** B02
     C***********DRCY******ANDNESTCY                                      S01194
     C           DRCY      ANDNEBLCYCD                                    S01194
     C                     ADD  1         S
     C*********************MOVE ' 396'    ERCD,S                          S01117
     C                     MOVE ' 072'    ERCD,S                          S01117
     C                     MOVE '1'       *IN58
     C                     END                             ** E02
     C*
     C*   FOR PAY CURRENCY
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '20'      ZTAB01                          S01194
     C*********************MOVE PCCY      ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
    C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
    C*********************Z-ADD28        WDBASE             * DBERR 28 * S01194
    C*********************MOVELZTABKY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM PCCY      @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C                     EXSR MVCURR                                    S01194
     C*                                                                   S01194
     C                     Z-ADDA6NBDP    PCCYDP                          S01194
     C                     Z-ADDA6SPRT    PCCYSP                          S01194
     C                     Z-ADDMDIN      PCCYMD                          S01194
     C*********************Z-ADDCDP       PCCYDP                          S01194
     C*********************Z-ADDSPOT      PCCYSP                          S01194
     C*********************Z-ADDMDIN      PCCYMD                          S01194
     C*********************MOVE '4'       ZTAB12                          S01194
     C**READ*CURRENCY*RECORD TO FOR SPREAD                                S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
    C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
    C*********************Z-ADD29        WDBASE             * DBERR 29 * S01194
    C*********************MOVELZTABKY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C**CHANGE*SPOT*RATE*BY*SELL*SPREAD****                               S01194
     C***********SSSG******IFEQ '+'                        B001           S01194
     C***********SPOT******ADD  SSPR      RSRAT  138                      S01194
     C*********************ELSE                            X001           S01194
     C***********SPOT******SUB  SSPR      RSRAT                           S01194
     C*********************END                             E001           S01194
     C/COPY WNCPYSRC,FT0080C070
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY SELL SPREAD                                   S01194
     C*                                                                   S01194
     C           A6SLSS    IFEQ '+'                        B001           S01194
     C           A6SPRT    ADD  A6SLSR    RSRAT  138                      S01194
     C                     ELSE                            X001           S01194
     C           A6SPRT    SUB  A6SLSR    RSRAT                           S01194
     C                     END                             E001           S01194
     C*
     C**CHANGE*SPOT*RATE*BY*BUY*SPREAD***                                 S01194
     C***********BSSG******IFEQ '+'                        B001           S01194
     C***********SPOT******ADD  BSPR      RBRAT  138                      S01194
     C*********************ELSE                            X001           S01194
     C***********SPOT******SUB  BSPR      RBRAT                           S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY BUY SPREAD                                    S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B001           S01194
     C           A6SPRT    ADD  A6BYSR    RBRAT  138                      S01194
     C                     ELSE                            X001           S01194
     C           A6SPRT    SUB  A6BYSR    RBRAT                           S01194
     C                     END                             E001           S01194
     C/COPY WNCPYSRC,FT0080C019
     C**
     C*  SET DEBIT PARTY TYPE TO BLANK
     C**
     C                     MOVE ' '       DRPT
     C**
     C*  DEBIT PARTY IS MANDATORY
     C**
     C                     MOVE *BLANKS   SLCTD   1                                         MD031725
     C           SDRPY     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 269'    ERCD,S                          S01117
     C                     MOVE ' 059'    ERCD,S                          S01117
     C                     MOVE '1'       *IN56
     C                     END                                            S01194
     C*********************ELSE                            ** X01         S01194
     C*                                                                   S01194
     C** CHECK FOR INVALID ? ENTRY                                        S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASDRPY     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     29               S01194
     C           *IN29     IFEQ '1'                                       S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 066'    ERCD,S                          S01194
     C                     SETON                         56               S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C** IF NO ERRORS CONTINUE                                            S01194
     C*                                                                   S01194
     C           *IN56     IFEQ '0'                                       S01194
     C*                                                                   S01194
     C**
     C*  MOVE DEBIT PARTY FIELD TO DS FOR FURTHER VALIDATION
     C**
     C/COPY WNCPYSRC,FT0080C034
     C                     MOVE SDRPY     SDRPYX
     C                     Z-ADD0         DPOPN   50
     C                     MOVE *BLANK    ACST3   1                       047179
     C**
     C*                                                                   S01117
     C*  IF MB AND DEBIT PARTY NOT ENTERED AS 12 LONG PARTIAL ACCOUNT     S01117
     C*  AND DEBIT PARTY BRANCH ENTERED THEN ERROR.                       S01117
     C*                                                                   S01117
     C           DACSQA    IFEQ *BLANKS                                   S01117
     C           @MBIN     ANDEQ'Y'                                       S01117
     C           SDRBR     ANDNE*BLANKS                                   S01117
     C                     ADD  1         S                               S01194
     C                     MOVE ' 067'    ERCD,S                          S01194
     C                     SETON                         56               S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C*  IF DEBIT PARTY ENTERED AS 2 CHARACTERS VALIDATE AS A FULL
     C*****NOSTRO*WITH*DEBIT*CURRENCY*-*MUST*BE*ON*PF/TABLETL**********   S01194
     C*    NOSTRO WITH DEBIT CURRENCY - MUST BE ON PF/SDNOSTPD            S01194
     C**
     C           DNOSTA    IFNE *BLANKS                    ** B02
     C           DNOSTR    ANDEQ*BLANKS
     C           SDRBR     ANDEQ*BLANKS                                   S01117
     C           *IN56     ANDEQ'0'                                       S01117
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @CUST                           S01194
     C                     PARM SDRCY     @CYCD                           S01194
     C                     PARM *BLANKS   @ACCD                           S01194
     C                     PARM *BLANKS   @ACSN                           S01194
     C                     PARM DNOSTA    @NONB                           S01194
     C                     PARM *BLANKS   @BRCD                           S01194
     C                     PARM *BLANKS   @CSSN                           S01194
     C                     PARM *BLANKS   @PNOI                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     CASEQ*BLANKS   MVNOST     8989                 S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************MOVELSDRCY     ZTAB08                          S01194
     C*********************MOVE DNOST     ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C           *IN89     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 270'    ERCD,S                          S01117
     C                     MOVE ' 060'    ERCD,S                          S01117
     C                     MOVE '1'       *IN56
     C                     ELSE                            ** X03
     C                     MOVE 'N'       DRPT
     C                     MOVE CNUM      ACNTCN
     C                     MOVELSDRCY     ACNTCY
     C                     MOVE ACOD      ACNTAC
     C                     MOVE ACSQ      ACNTAS
     C                     MOVE A7BRCD    ACNTBR                          S01194
     C                     EXSR ACCCHN
     C                     MOVE ACST      ACST3                           047179
     C*
     C           ATYP      IFEQ 'R'                        ** B04
     C                     Z-ADDDACO      DPOPN
     C                     END                             ** E04
     C                     END                             ** E03
     C*
     C                     END                             ** E02
     C**
     C*  IF DEBIT PARTY ENTERED AS 10 LONG VALIDATE AS A RETAIL
     C*    ACCOUNT NUMBER - MUST BE ON LF/ACNUMA. MUST BE IN DR CCY.
     C**
     C           *IN56     IFEQ '0'                        ** B02
     C           DRPT      IFEQ ' '                        ** B03
     C           DRETLA    ANDNE*BLANKS
     C           DRETLR    ANDEQ*BLANKS
     C           SDRBR     ANDEQ*BLANKS                                   S01117
     C*
     C           DRETL     CHAINACNUMA               99
     C  N99      RECI      COMP 'D'                  9999
     C           *IN99     IFEQ '1'                        ** B04
     C                     ADD  1         S
     C*********************MOVE ' 271'    ERCD,S                          S01117
     C                     MOVE ' 061'    ERCD,S                          S01117
     C                     MOVE '1'       *IN56
     C                     ELSE                            ** X04
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     56
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 026'    ERCD,S                          S01117
     C*
     C                     ELSE
     C*
     C           CCY       IFNE SDRCY                      ** B05
     C                     ADD  1         S
     C*********************MOVE ' 272'    ERCD,S                          S01117
     C                     MOVE ' 062'    ERCD,S                          S01117
     C                     MOVE '1'       *IN56
     C                     ELSE                            ** X05
     C*
     C                     MOVE 'R'       DRPT
     C           ATYP      IFEQ 'R'                        ** B06
     C                     MOVE ACST      ACST3                           047179
     C                     Z-ADDDACO      DPOPN
     C                     MOVE COLF      WCOLF   1                                           CGL014
     C                     Z-ADDACNO      WACNO  100                                          CGL014
     C                     END                             ** E06
     C*
     C                     END                             ** E06
     C                     END                             ** E05
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C*                                                                   S01117
     C** IF DEBIT, PARTY ENTERED AS 12 LONG AND MB SDRBR BLANK ERROR      S01117
     C*                                                                   S01117
     C           DACSQA    IFNE *BLANKS                                   S01117
     C           SDRBR     ANDEQ*BLANKS                                   S01117
     C           @MBIN     ANDEQ'Y'                                       S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 068'    ERCD,S                          S01117
     C                     SETON                     56                   S01117
     C                     END                                            S01117
     C*
     C*  IF DEBIT PARTY ENTERED AS 12 LONG VALIDATE AS A PARTIAL
     C*    CUSTOMER ACCOUNT NUMBER - MUST BE ON LF/ACCNT
     C**
     C           *IN56     IFEQ '0'                        ** B02
     C           DACSQA    IFNE *BLANKS                    ** B03
     C*                                                                   S01117
     C** IF NON-MB SET UP DEBIT PARTY BRANCH WITH SINGLE BRANCH           S01117
     C*                                                                   S01117
     C           @MBIN     IFNE 'Y'                                       S01117
     C                     MOVE BJSBRC    SDRBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE DCUST     ACNTCN
     C                     MOVE DACOD     ACNTAC
     C                     MOVE DACSQ     ACNTAS
     C                     MOVE SDRCY     ACNTCY
     C                     MOVE SDRBR     ACNTBR                          S01117
     C           ACCNTK    CHAINACCNT                99
     C  N99      RECI      COMP 'D'                  9999
     C           *IN99     IFEQ '1'                        ** B04
     C                     ADD  1         S
     C*********************MOVE ' 273'    ERCD,S                          S01117
     C                     MOVE ' 063'    ERCD,S                          S01117
     C                     MOVE '1'       *IN56
     C                     ELSE                            ** X04
     C*******              MOVE 'P'       DRPT                            179732
     C                     MOVE ACST      ACST3                           047179
     C*
     C           ATYP      IFEQ 'G'                        ** B05         179732
     C                     MOVE 'P'       DRPT                            179732
     C                     ENDIF                           ** E05         179732
     C*
     C           ATYP      IFEQ 'R'                        ** B05
     C           BMRANR    IFEQ 'Y'                        ** B06                             212014
     C                     MOVE 'R'       DRPT                            179732
     C                     MOVE *BLANKS   SDRPY                           179732
     C                     MOVE *BLANKS   SDRBR                           179732
     C                     MOVELACNO      SDRPY                           179732
     C                     ELSE                            ** X06                             212014
     C                     MOVE 'P'       DRPT                                                212014
     C                     END                             ** E06                             212014
     C                     Z-ADDDACO      DPOPN
     C                     MOVE COLF      WCOLF   1                                           CGL014
     C                     Z-ADDACNO      WACNO  100                                          CGL014
     C                     END                             ** E05
     C*
     C           ATYP      IFEQ 'N'                                       179732
     C                     MOVE 'N'       DRPT                            179732
     C*                                                                   179732
     C                     MOVE ACNCNA    @CUST   6                       179732
     C**********           MOVE ACNACA    @ACCD   4                                    179732 CGL029
     C                     MOVE ACNACA    @ACCD                                               CGL029
     C                     MOVE ACNASA    @ACSN   2                       179732
     C*                                                                   179732
     C                     CALL 'AONOSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM           @CUST   6                       179732
     C                     PARM ACNTCY    @CYCD   3                       179732
     C**********           PARM           @ACCD   4                                    179732 CGL029
     C                     PARM           @ACCD                                               CGL029
     C                     PARM           @ACSN   2                       179732
     C                     PARM *BLANKS   @NONB   2                       179732
     C                     PARM SDRBR     @BRCD   3                       179732
     C                     PARM *BLANKS   @CSSN  10                       179732
     C                     PARM *BLANKS   @PNOI   1                       179732
     C           SDNOST    PARM SDNOST    DSSDY                           179732
     C*                                                                   179732
     C           @RTCD     IFEQ *BLANKS                                   179732
     C                     MOVE *BLANKS   SDRPY                           179732
     C                     MOVE *BLANKS   SDRBR                           179732
     C                     MOVELA7NONB    SDRPY                           179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
     C*
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C**
     C*  STORE DEBIT PARTY IF DEBIT CURRENCY IS VALID
     C**
     C           *IN58     IFEQ '0'                        ** B02
     C           *IN56     ANDEQ'0'
     C           SDRPY     IFNE DRPY                                                        MD031725
     C                     MOVE 'Y'       SLCTD                                             MD031725
     C                     ELSE                                                             MD031725
     C                     MOVE 'N'       SLCTD                                             MD031725
     C                     ENDIF                                                            MD031725
     C                     MOVE SDRPY     DRPY
     C                     MOVE SDRBR     DRBR                            S01117
     C                     END                             ** E02
     C/COPY WNCPYSRC,FT0080C003
     C*
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C020
     C**
     C*  CHEQUE AMOUNT IS MANDATORY & MUST BE NUMERIC WITH NO MORE
     C*    DECIMAL PLACES THAN PAY CURRENCY.
     C**
     C                     Z-ADD0         CQAM
     C******************** MOVE SCQAM     CQAMSV 140               E22871 E32776
     C           SCQAM     IFEQ *BLANKS                    ** B01
     C********** CQAMSV    OREQ 0                                  E22871 E32776
     C                     ADD  1         S
     C*********************MOVE ' 243'    ERCD,S                          S01117
     C                     MOVE ' 069'    ERCD,S                          S01117
     C                     MOVE '1'       *IN57
     C                     ELSE                            ** X01
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           *IN47     IFEQ '0'                                       CEU006
     C           NDCERR    ANDNE'Y'                                       CEU006
     C                     Z-ADD0         NDAM   130                      CEU006
     C                     MOVE *BLANKS   ZFIELD                          CEU006
     C                     MOVELSNDAM     ZFIELD                          CEU006
     C           13        SUB  N#NBDP    ZADIG                           CEU006
     C                     Z-ADDN#NBDP    ZADEC                           CEU006
     C                     EXSR ZALIGN                                    CEU006
     C           *IN99     IFEQ '1'                                       CEU006
     C                     MOVEL'FTM2568' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL                           CEU006
     C                     PARM           MSGID                           CEU006
     C                     MOVE 'Y'       NDAERR  1                       CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     MOVE ZFIELD    NDAM                            CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*
     C           *IN47     IFEQ '0'                        ** B02
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCQAM     ZFIELD
     C           13        SUB  PCCYDP    ZADIG
     C                     Z-ADDPCCYDP    ZADEC
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '1'                        ** B03
     C                     ADD  1         S
     C*********************MOVE ' 244'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     MOVE '1'       *IN57
     C                     ELSE                            ** X03
     C                     MOVE ZFIELD    CQAM
     C*
     C           CQAM      IFEQ 0                          ** B04         E32776
     C                     ADD  1         S                               E32776
     C*********************MOVE ' 243'    ERCD,S                    E32776S01117
     C                     MOVE ' 069'    ERCD,S                          S01117
     C                     MOVE '1'       *IN57                           E32776
     C                     END                             ** E04         E32776
     C*
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C**
     C*  DEBIT VALUE DATE IS MANDATORY & MUST BE VALID DATE
     C**
     C           SDRVD     IFEQ *BLANKS                    ** B01
     C                     ADD  1         S
     C*********************MOVE ' 275'    ERCD,S                          S01117
     C                     MOVE ' 076'    ERCD,S                          S01117
     C                     MOVE '1'       *IN59
     C                     ELSE                            ** X01
     C*
     C* CHECK IF DATE IS NUMERIC
     C*
     C                     MOVELSDRVD     DATEL   70
     C                     MOVELDATEL     DATES   6
     C*
     C           SDRVD     IFNE DATES                      B002
     C                     SETON                     99
     C                     ELSE                            X002
     C*
     C                     MOVE SDRVD     ZDATE
     C                     EXSR ZDATE1
     C*
      ** THE DEBIT VALUE DATE MUST NOT BE A HOLIDAY IN LOCAL CURRENCY     E32543
      *                                                                   E32543
     C                     MOVE BJLCCY    ZCCY                            E32543
     C                     EXSR ZCHKH                                     E32543
      *                                                                   E32543
      ** if ZIND = 'H' then the date is a holiday                         E32543
      *                                                                   E32543
     C           ZIND      IFEQ 'H'                                       E32543
     C                     SETON                     1923                 E32543
     C                     ADD  1         S                               E32543
     C*********************MOVEA' W10'    ERCD,S                    E32543S01117
     C                     MOVEA' W03'    ERCD,S                          S01117
     C                     ELSE                                           E32543
     C                     SETOF                     23                   E32543
     C                     END                                            E32543
      *                                                                   E32543
     C                     END                             E002
     C*
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 276'    ERCD,S                          S01117
     C                     MOVE ' 077'    ERCD,S                          S01117
     C                     MOVE '1'       *IN59
     C                     ELSE                            ** X02
      *                                                                   047179
      *  Check if date is in the future and if the account is             047179
      *  closing today                                                    047179
      *                                                                   047179
     C           *IN56     IFEQ '0'                                       047179
      *                                                                   047179
     C           ZDAYNO    IFGT BJRDNB                                    047179
     C           ACST3     ANDEQ'C'                                       047179
     C                     SETON                     56                   047179
     C                     ADD  1         S                               047179
     C                     MOVEA' 603'    ERCD,S                          047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
     C*
     C* FOR BACK VALUE IF RETAIL OPEN DATE WILL BE NON-ZERO
     C*
     C           DPOPN     IFNE 0                          B003
     C*
     C           ZDAYNO    IFLT DPOPN                      B004
     C                     SETON                     56
     C                     ADD  1         S
     C*********************MOVEA' 357'    ERCD,S                          S01117
     C                     MOVEA' 064'    ERCD,S                          S01117
     C                     END                             E004
     C*
     C           ZDAYNO    IFLT BVLD                       B004
     C                     SETON                     56
     C                     ADD  1         S
     C*********************MOVEA' 372'    ERCD,S                          S01117
     C                     MOVEA' 065'    ERCD,S                          S01117
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C                     Z-ADDZDAYNO    DRVD
     C                     END                             ** E02
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C014
     C**
     C*  VALIDATE RATE
     C*    IF DEBIT CURRENCY IS VALID
     C*
     C           *IN58     IFEQ '0'                        B001
     C                     EXSR RATES
     C*
     C  N60                DO                              B002
     C           CEU006    IFNE 'Y'                                       CEU006
     C                     Z-ADDVRATE1    RATE
     C                     Z-ADDVRATE1    RATENW
     C                     Z-ADDVMDIN     MDIN
     C                     Z-ADDVMDIN     MDINNW
     C                     ELSE                                           CEU006
     C                     Z-ADDVRATE1    RATE                            CEU006
     C                     ENDIF                                          CEU006
     C                     END                             E002
     C*
     C                     END                             E001
     C*                                                                   CEU006
     C* Check that one of the currencies entered is 'IN' if               CEU006
     C* both Debit and Notify Delivery Currency has been entered.         CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SNDCY     IFNE *BLANKS                                   CEU006
     C                     SELEC                                          CEU006
     C           N#INCY    WHEQ 'Y'                                       CEU006
     C           N#INC1    ANDNE'Y'                                       CEU006
     C           N#TPSD    ANDLEDRVD                                      CEU006
     C*                                                                   CEU006
     C           N#INC1    WHEQ 'Y'                                       CEU006
     C           N#INCY    ANDNE'Y'                                       CEU006
     C           N#TPS1    ANDLEDRVD                                      CEU006
     C*                                                                   CEU006
     C                     OTHER                                          CEU006
     C                     MOVEL'FTM2571' MSGID                           CEU006
     C                     CALL 'ZA0340'                                  CEU006
     C                     PARM MSGFIL    MSGFL  10                       CEU006
     C                     PARM           MSGID  10                       CEU006
     C                     MOVE 'Y'       NDCERR                          CEU006
     C                     MOVE *ON       *IN58                           CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C                     ENDSL                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*
     C**
     C*  OVERRIDE IF ENTERED MUST BE 'Y'
     C**
     C           SOVRD     IFNE *BLANKS                    ** B01
     C           SOVRD     ANDNE'Y'
     C                     ADD  1         S
     C*********************MOVE ' 049'    ERCD,S                          S01117
     C                     MOVE ' 075'    ERCD,S                          S01117
     C                     MOVE '1'       *IN61
     C                     ELSE                            ** X01
     C                     MOVE SOVRD     OVRD
     C                     END                             ** E01
      *
     C           SCDRO     IFEQ *BLANKS
     C                     MOVE DRCY      BORDCY
     C                     Z-ADDDRCYSP    CHSPOT 138
     C                     Z-ADDDRCYMD    CHMDIN  10
     C                     Z-ADDDRCYDP    CHCDP   10
     C                     ELSE
     C*********************MOVE BCCY      BORDCY                          S01194
     C                     MOVE BJCYCD    BORDCY                          S01194
     C                     Z-ADDBCCYSP    CHSPOT
     C                     Z-ADDBCCYMD    CHMDIN
     C                     Z-ADDBCCYDP    CHCDP
     C                     END
      *
      ** Get number of decimal places
      **   and currency code for Charges entry.
     C*
     C                     EXSR GETGCY
      *
      ** Check entry ccy for amendment.
     C*
     C           SCGCY     IFNE SCGCYX
     C                     MOVE SCGCY     SCGCYX
     C                     MOVE *BLANKS   STRCMX
     C                     MOVE *BLANKS   SCLCHX
     C                     MOVE *BLANKS   SCSTAX
     C                     END
      *
     C**
     C*  TRANSFER COMMISSION TARIFF DEFAULTS TO 3, IF ENTERED MUST BE
     C*    IN THE RANGE 1 TO 5
     C**
     C           STRCT     IFEQ *BLANKS                    ** B01
      *
      ** Default Commission tarriff is stored on PYCHGDD.
     C/COPY WNCPYSRC,FT0080C021
     C*
     C                     MOVE DFTRCT    STRCT
     C                     MOVE DFTRCT    TRCT
     C/COPY WNCPYSRC,FT0080C022
     C                     ELSE                            ** X01
     C*
     C           STRCT     IFLT '1'                        ** B02
     C           STRCT     ORGT '5'
     C                     ADD  1         S
     C*********************MOVE ' 177'    ERCD,S                          S01117
     C                     MOVE ' 078'    ERCD,S                          S01117
     C                     MOVE '1'       *IN62
     C                     ELSE                            ** X02
     C*
     C* TO MAKE COMMISSION RECALCULATED IF TARIFF HAS CHANGED
     C* CLEAR VALUE IF HAS NOT CHANGED BUT TARIFF HAS
     C           STRCT     IFNE TRCT                       ** B03
     C           STRCM     ANDEQSTRCMW
     C           SCQAM     ORNE SCQSV
     C           STRCM     ANDEQSTRCMW
     C                     MOVE *BLANK    STRCM
     C                     END                             **  E03
     C*                                                                   S01508
     C** Recalculate FX/Change commission if tariff has changed           S01508
     C** but FX/Change commission amount has not                          S01508
     C*                                                                   S01508
     C           STRCT     IFNE TRCT                                      S01508
     C           SCHCM     ANDEQSCHCMW                                    S01508
     C           SCQAM     ORNE SCQSV                                     S01508
     C           SCHCM     ANDEQSCHCMW                                    S01508
     C                     MOVE *BLANK    SCHCM                           S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE STRCT     TRCT
     C                     END                             ** E02
     C                     END                             ** E01
     C*                                                                   S01508
     C** Charges to the Debit of is optional so set field and type        S01508
     C**   to zero/blank                                                  S01508
     C*                                                                   S01508
     C***********          Z-ADD0         CDRO                                         S01508 CSD027
     C                     MOVE *BLANKS   CDRO                                         S01508 CSD027
     C                     MOVE *BLANKS   CDBR                            S01508
     C                     MOVE ' '       CDRT                            S01508
     C*                                                                   S01508
     C           SCDRO     IFNE *BLANKS                                   S01508
     C           SCDBR     ORNE *BLANKS                                   S01508
     C*                                                                   S01508
     C** Check for invalid ? entered.                                     S01508
     C*                                                                   S01508
     C                     MOVEA*BLANKS   FLDQ                            S01508
     C                     MOVEASCDRO     FLDQ                            S01508
     C           '?'       LOKUPFLDQ                     29               S01508
     C           *IN29     IFEQ '1'                                       S01508
     C                     SETON                         66               S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 086'    ERCD,S                          S01508
     C                     END                                            S01508
     C/COPY WNCPYSRC,FT0080C035
     C*                                                                   S01508
     C** If entered move Charges to the debit of to DS for validation     S01508
     C*                                                                   S01508
     C                     MOVE SCDRO     SCDROX                          S01508
     C*                                                                   S01508
     C** If CDRO not entered as 12 long partial account                   S01508
     C** and CDBR entered then error.                                     S01508
     C*                                                                   S01508
     C           CACSQA    IFEQ *BLANKS                                   S01508
     C           @MBIN     ANDEQ'Y'                                       S01508
     C           SCDBR     ANDNE*BLANKS                                   S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 087'    ERCD,S                          S01508
     C                     SETON                         66               S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** If charges to the debit of entered as 2 characters validate as   S01508
     C** a full nostro with base currency - must be on PF/SDNOSTPD        S01508
     C*                                                                   S01508
     C           CNOSTA    IFNE *BLANKS                                   S01508
     C           CNOSTR    ANDEQ*BLANKS                                   S01508
     C           SCDBR     ANDEQ*BLANKS                                   S01508
     C           *IN66     ANDEQ'0'                                       S01508
     C*                                                                   S01508
     C                     CALL 'AONOSTR0'                                S01508
     C                     PARM *BLANKS   @RTCD                           S01508
     C                     PARM '*KEY   ' @OPTN                           S01508
     C                     PARM *BLANKS   @CUST                           S01508
     C                     PARM BJCYCD    @CYCD                           S01508
     C                     PARM *BLANKS   @ACCD                           S01508
     C                     PARM *BLANKS   @ACSN                           S01508
     C                     PARM CNOSTA    @NONB                           S01508
     C                     PARM *BLANKS   @BRCD                           S01508
     C                     PARM *BLANKS   @CSSN                           S01508
     C                     PARM *BLANKS   @PNOI                           S01508
     C           SDNOST    PARM SDNOST    DSFDY                           S01508
     C*                                                                   S01508
     C           @RTCD     CASEQ*BLANKS   MVNOST     8989                 S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C           *IN89     IFEQ '1'                                       S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 082'    ERCD,S                          S01508
     C                     MOVE '1'       *IN66                           S01508
     C                     ELSE                                           S01508
     C                     MOVE 'N'       CDRT                            S01508
     C                     MOVE CNUM      ACNTCN                          S01508
     C                     MOVELBJCYCD    ACNTCY                          S01508
     C                     MOVE ACOD      ACNTAC                          S01508
     C                     MOVE ACSQ      ACNTAS                          S01508
     C                     EXSR ACCCHN                                    S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** If Charges to the Debit of entered as 10 long validate as a      S01508
     C**   retail account number - must be on LF/ACNUMA & in base ccy.    S01508
     C*                                                                   S01508
     C           *IN66     IFEQ '0'                                       S01508
     C           CDRT      ANDEQ' '                                       S01508
     C*                                                                   S01508
     C           CRETLA    IFNE *BLANKS                                   S01508
     C           CRETLR    ANDEQ*BLANKS                                   S01508
     C           SCDBR     ANDEQ*BLANKS                                   S01508
     C*                                                                   S01508
     C           CRETL     CHAINACNUMA               99                   S01508
     C  N99      RECI      COMP 'D'                  9999                 S01508
     C           *IN99     IFEQ '1'                                       S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 083'    ERCD,S                          S01508
     C                     MOVE '1'       *IN66                           S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C** Check to see if retail account number is allowed                 S01508
     C*                                                                   S01508
     C           BMRANR    IFNE 'Y'                                       S01508
     C                     SETON                     66                   S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 026'    ERCD,S                          S01508
     C*                                                                   S01508
     C                     ELSE                                           S01508
     C           CCY       IFNE BJCYCD                                    S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 084'    ERCD,S                          S01508
     C                     MOVE '1'       *IN66                           S01508
     C                     ELSE                                           S01508
     C                     MOVE 'R'       CDRT                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** If CDRO entered 12 long, MBIN=Y AND CDBR not entered> error      S01508
     C*                                                                   S01508
     C           CACSQA    IFNE *BLANKS                                   S01508
     C           @MBIN     ANDEQ'Y'                                       S01508
     C           SCDBR     ANDEQ*BLANKS                                   S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 088'    ERCD,S                          S01508
     C                     SETON                     66                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** If Charges to the Debit of entered as 12 long validate as a      S01508
     C**   partial customer account number - must be on LF/ACCNT          S01508
     C*                                                                   S01508
     C           CACSQA    IFNE *BLANKS                                   S01508
     C           *IN66     ANDNE'1'                                       S01508
     C*                                                                   S01508
     C** If Non-MB set Charges DB Branch to single branch                 S01508
     C*                                                                   S01508
     C           @MBIN     IFEQ 'N'                                       S01508
     C                     MOVE BJSBRC    SCDBR                           S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE CCUST     ACNTCN                          S01508
     C                     MOVE CACOD     ACNTAC                          S01508
     C                     MOVE CACSQ     ACNTAS                          S01508
     C                     MOVE BJCYCD    ACNTCY                          S01508
     C                     MOVE SCDBR     ACNTBR                          S01508
     C           ACCNTK    CHAINACCNT                99                   S01508
     C  N99      RECI      COMP 'D'                  9999                 S01508
     C           *IN99     IFEQ '1'                                       S01508
     C                     ADD  1         S                               S01508
     C                     MOVE ' 085'    ERCD,S                          S01508
     C                     MOVE '1'       *IN66                           S01508
     C                     ELSE                                           S01508
     C                     MOVE 'P'       CDRT                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** Check if date is in the future and if the account is             S01508
     C** closing today                                                    S01508
     C*                                                                   S01508
     C           *IN66     IFEQ '0'                                       S01508
     C*                                                                   S01508
     C           ZDAYNO    IFGT BJRDNB                                    S01508
     C           ACST      ANDEQ'C'                                       S01508
     C                     SETON                     66                   S01508
     C                     ADD  1         S                               S01508
     C                     MOVEA' 604'    ERCD,S                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** Store Charges to the Debit of if valid                           S01508
     C*                                                                   S01508
     C           *IN66     IFEQ '0'                                       S01508
     C                     MOVE SCDRO     CDRO                            S01508
     C                     MOVE SCDBR     CDBR                            S01508
     C                     END                                            S01508
     C/COPY WNCPYSRC,FT0080C036
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C** Calculate default charges if there are no errors                 S01508
     C*                                                                   S01508
     C           *IN58     IFEQ '0'                                       S01508
     C           *IN66     ANDEQ'0'                                       S01508
     C           *IN62     ANDEQ'0'                                       S01508
     C           *IN47     ANDEQ'0'                                       S01508
     C           *IN56     ANDEQ'0'                                       125390
     C                     EXSR DFTCHG                                    S01508
     C                     END                                            S01508
     C**
     C*  TRANSFER COMMISSION DEFAULTS IF BLANK, DEFAULT CAN ONLY BE
     C*    CALCULATED IF TRANSFER COMMISSION TARRIFF AND CHEQUE AMOUNT
     C*    AMOUNT ARE VALID.  IF TRANSFER COMMISSION IS ENTERED IT MUST
     C*    BE NUMERIC WITH NO MORE DECIMAL PLACES THAN BASE CURRENCY
     C**
     C*
     C*   CAN ONLY OCCUR IF NO ERROR ON DEBIT CURRENCY
     C*
     C           *IN58     IFEQ '0'
     C**
     C           STRCM     IFEQ *BLANKS                    ** B01
     C*                                                                   S01508
     C**  OR the core feature S01508 is installed on AMEND mode           S01508
     C**  AND either the "charges to the debit of" (if entered)           S01508
     C**  or credit party has changed.                                    S01508
     C*                                                                   S01508
     C           S01508    OREQ 'Y'                                       S01508
     C           ACTION    ANDEQ'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C** TEMP07                                                           S01494
     C           STRCM     ANDEQSTRCMW                                    S01494
     C*                                                                   S01508
     C           *IN62     IFEQ '0'                        ** B02
     C           *IN47     ANDEQ'0'
     C*                    EXSR DTRCM
     C***********          EXSR TRCOMM                                    S01508
      *
      ** Edit Base ccy. amount.
     C**                   MOVE *BLANKS   EDITIN
     C**                   MOVE TRCM      EDITIN
     C**                   Z-ADDBCCYDP    CDP
     C**                   EXSR EDIT
     C**                   MOVEADIG2,3    STRCMD
      *
      ***Convert*from*Base*to*Charge*entry*ccy.************************   S01508
     C***********          Z-ADDSSPOT     XSPOT2                          S01508
     C***********          Z-ADDSMDIN     XMDIN2                          S01508
     C***********          Z-ADDECDP      XCDP2                           S01508
     C***********          Z-ADD1         XSPOT1                          S01508
     C***********          Z-ADDBCCYMD    XMDIN1                          S01508
     C***********          Z-ADDBCCYDP    XCDP1                           S01508
     C***********          Z-ADDDTRCM1    XAMNT1                          S01508
     C***********          EXSR XCONVT                                    S01508
      ***********                                                         S01508
      ***Store*amount*on*file*in*base/local/charge*currency************   S01508
     C***********          Z-ADDXAMNT2    TRCH                            S01508
      *
      ** Edit Charge entry ccy. amount.
     C           TRCH      IFNE 0                                         S01508
     C                     MOVE *BLANKS   EDITIN
     C***********          MOVE XAMNT2    EDITIN                          S01508
     C*********************Z-ADDECDP      CDP                             S01194
     C                     MOVE TRCH      EDITIN                          S01508
     C                     Z-ADDECDP      A6NBDP                          S01194
     C                     EXSR EDIT
     C                     MOVEADIG2,3    STRCM
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   STRCM                           S01508
     C                     END                                            S01508
      *
     C***********          Z-ADDCHSPOT    XSPOT2                          S01508
     C***********          Z-ADDCHMDIN    XMDIN2                          S01508
     C***********          Z-ADDCHCDP     XCDP2                           S01508
     C***********          EXSR XCONVT                                    S01508
      ***********                                                         S01508
      ***Store*amount*on*file*in*base/debit*currency*******************   S01508
     C***********          Z-ADDXAMNT2    TRCM                            S01508
     C                     END                             ** E02
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C***********          ELSE                            ** X01         S01508
     C*
     C           STRCM     IFNE *BLANKS                                   S01508
     C           *IN62     ANDEQ'0'                        ** B02         S01508
     C           *IN47     ANDEQ'0'                                       S01508
     C*                                                                   S01508
     C                     Z-ADD0         TRCM                            S01508
     C                     Z-ADD0         TRCH                            S01508
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE STRCM     ZFIELD
     C           11        SUB  ECDP      ZADIG
     C                     Z-ADDECDP      ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 178'    ERCD,S                          S01117
     C                     MOVE ' 079'    ERCD,S                          S01117
     C                     MOVE '1'       *IN63
     C                     ELSE                            ** X02
      *
      ** If no error: store previous valu.
     C                     MOVE STRCM     STRCMX
      *
      ** Convert from Charge entry to base ccy.
     C                     Z-ADDSSPOT     XSPOT1
     C                     Z-ADDSMDIN     XMDIN1
     C                     Z-ADDECDP      XCDP1
     C                     Z-ADDCHSPOT    XSPOT2
     C                     Z-ADDCHMDIN    XMDIN2
     C                     Z-ADDCHCDP     XCDP2
     C                     MOVE ZFIELD    XAMNT1
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           XAMNT1    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE SCGCY     P#DBCY                          CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE BORDCY    P#CRCY                          CEU006
     C                     Z-ADDDRVD      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT
     C                     ENDIF                                          CEU006
     C                     Z-ADDXAMNT2    TRCM
     C                     MOVE ZFIELD    TRCH
     C                     END
      *
      *
      ** If value not changed restore any previous error condition.
     C***********SIN63     IFEQ '1'                                       E23057
     C***********          ADD  1         S                               E23057
     C***********          MOVE ' 178'    ERCD,S                          E23057
     C***********          MOVE '1'       *IN63                           E23057
     C***********          END                                            E23057
      *
     C                     END                             ** E01
     C                     MOVE STRCM     STRCMW
     C                     Z-ADDTRCM      TTLCHG 163                      S01499
     C                     END
      *
      ** Save value of error indicator.
     C                     MOVE *IN63     SIN63   1
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF TRANSFER COMMISSION.                        S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI1    IFNE 'Y'                                       S01499
     C           SVATI1    ANDNE'N'                                       S01499
     C           SVATI1    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 094'    ERCD,S                          S01499
     C                     MOVE '1'       *IN13                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI1                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** CHANGE COMMISSION IS AVAILABLE IF THE FEATURE IS SWITCHED ON.    S01494
     C** IT IS OPTIONAL BUT IF ENTERED MUST BE NUMERIC WITH NO MORE       S01494
     C** DECIMAL PLACES THAN BASE CURRENCY                                S01494
     C*                                                                   S01494
     C           *IN09     IFEQ '1'                                       S01494
     C*                                                                   S01508
     C**  Use the default value of the FX/Change Commission if            S01508
     C**  the field is blank OR the core feature S01508 is installed      S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed on AMEND mode.                         S01508
     C*                                                                   S01508
     C           SCHCM     IFEQ *BLANKS                                   S01508
     C*                                                                   S01508
     C           S01508    OREQ 'Y'                                       S01508
     C           ACTION    ANDEQ'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C** TEMP07                                                           S01494
     C           SCHCM     ANDEQSCHCMW                                    S01494
     C*                                                                   S01508
     C** Must only be entered if debit ccy is different from settle ccy   S01508
     C** and no error in debit currency                                   S01508
     C*                                                                   S01508
     C           PCCY      IFNE DRCY                                      S01508
     C           *IN58     ANDEQ'0'                                       S01508
     C           PDCHCH    IFNE 0                                         S01508
     C                     MOVE *BLANKS   EDITIN                          S01508
     C                     MOVE PDCHCH    EDITIN                          S01508
     C                     Z-ADDECDP      A6NBDP                          S01508
     C                     EXSR EDIT                                      S01508
     C                     MOVEADIG2,3    SCHCM                           S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   SCHCM                           S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01494
     C           SCHCM     IFNE *BLANKS                                   S01494
     C*                                                                   S01494
     C                     Z-ADD0         PDCHCM                          S01494
     C                     Z-ADD0         PDCHCH                          S01494
     C*                                                                   CEU006
     C** Check for 'IN' 'IN' or 'IN' Euro or Euro 'IN' and extend error   CEU006
     C** code 090 if it is.                                               CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE 'N'       SPEUR   1                       CEU006
     C                     MOVE 'N'       SDEUR   1                       CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM PCCY      @CYCD                           CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
     C           A6INCY    IFEQ 'Y'                                       CEU006
     C           A6TPSD    ANDLEDRVD                                      CEU006
     C                     MOVE 'Y'       SPEUR                           CEU006
     C                     ENDIF                                          CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM SDRCY     @CYCD                           CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
     C           A6INCY    IFEQ 'Y'                                       CEU006
     C           A6TPSD    ANDLEDRVD                                      CEU006
     C                     MOVE 'Y'       SDEUR                           CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C*                                                                   S01494
     C** Must only be entered if debit ccy is different from settle ccy   S01494
     C*                                                                   S01494
     C           PCCY      IFEQ DRCY                                      S01494
     C           SPEUR     OREQ 'Y'                                       CEU006
     C           SDEUR     ANDEQ'Y'                                       CEU006
     C           CEU006    ANDEQ'Y'                                       CEU006
     C           SPEUR     OREQ 'Y'                                       CEU006
     C           SDRCY     ANDEQBKEURO                                    CEU006
     C           CEU006    ANDEQ'Y'                                       CEU006
     C           SPCCY     OREQ BKEURO                                    CEU006
     C           SDEUR     ANDEQ'Y'                                       CEU006
     C           CEU006    ANDEQ'Y'                                       CEU006
     C                     ADD  1         S                               S01494
     C                     MOVE ' 090'    ERCD,S                          S01494
     C                     MOVE '1'       *IN20                           S01494
     C                     ELSE                                           S01494
     C                     MOVE *BLANKS   ZFIELD                          S01494
     C                     MOVE SCHCM     ZFIELD                          S01494
     C           11        SUB  ECDP      ZADIG                           S01494
     C                     Z-ADDECDP      ZADEC                           S01494
     C                     EXSR ZALIGN                                    S01494
     C           *IN99     IFEQ '1'                                       S01494
     C                     ADD  1         S                               S01494
     C                     MOVE ' 091'    ERCD,S                          S01494
     C                     MOVE '1'       *IN20                           S01494
     C                     ELSE                            ** X02         S01494
     C*                                                                   S01494
     C** Convert from Charge entry to base ccy if no error in debit ccy   S01494
     C*                                                                   S01494
     C           *IN58     IFEQ '0'                                       S01494
     C                     Z-ADDSSPOT     XSPOT1                          S01494
     C                     Z-ADDSMDIN     XMDIN1                          S01494
     C                     Z-ADDECDP      XCDP1                           S01494
     C                     Z-ADDCHSPOT    XSPOT2                          S01494
     C                     Z-ADDCHMDIN    XMDIN2                          S01494
     C                     Z-ADDCHCDP     XCDP2                           S01494
     C                     MOVE ZFIELD    XAMNT1                          S01494
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           XAMNT1    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE SCGCY     P#DBCY                          CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE BORDCY    P#CRCY                          CEU006
     C                     Z-ADDDRVD      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT                                    S01494
     C                     ENDIF                                          CEU006
     C                     Z-ADDXAMNT2    PDCHCM                          S01494
     C                     MOVE ZFIELD    PDCHCH                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVE SCHCM     SCHCMW                          S01494
     C                     ADD  PDCHCM    TTLCHG                          S01499
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF CHANGE COMMISSION.                          S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI4    IFNE 'Y'                                       S01499
     C           SVATI4    ANDNE'N'                                       S01499
     C           SVATI4    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 095'    ERCD,S                          S01499
     C                     MOVE '1'       *IN83                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI4                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C                     END                                            S01494
     C*                                                                   S01508
     C**  Use the default value of collection charge if core feature      S01508
     C**  S01508 is installed and the field is blank OR core feature      S01508
     C**  S01508 is installed AND either the "charges to the debit of"    S01508
     C**  or credit party has changed on AMEND mode.                      S01508
     C*                                                                   S01508
     C           S01508    IFEQ 'Y'                                       S01508
     C           *IN58     ANDEQ'0'                                       S01508
     C*                                                                   S01508
     C           SCLCH     IFEQ *BLANKS                                   S01508
     C           ACTION    OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C** TEMP07                                                           S01494
     C           SCLCH     ANDEQSCLCHX                                    S01494
     C*                                                                   S01508
     C           COLH      IFNE 0                                         S01508
     C                     MOVE *BLANKS   EDITIN                          S01508
     C                     MOVE COLH      EDITIN                          S01508
     C                     Z-ADDECDP      A6NBDP                          S01508
     C                     EXSR EDIT                                      S01508
     C                     MOVEADIG2,3    SCLCH                           S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   SCLCH                           S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
      *
     C**
     C*  COLLECTION CHARGE IS OPTIONAL IF ENTERED MUST BE NUMERIC
     C*    WITH NO MORE DECIMAL PLACES THAN BASE CURRENCY
     C**
     C           SCLCH     IFNE *BLANKS                    ** B01
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCLCH     ZFIELD
     C           11        SUB  ECDP      ZADIG
     C                     Z-ADDECDP      ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 250'    ERCD,S                          S01117
     C                     MOVE ' 080'    ERCD,S                          S01117
     C                     MOVE '1'       *IN64
     C                     ELSE                            ** X02
      *
      ** If no error: store previous valu.
     C                     MOVE SCLCH     SCLCHX
      *
     C*   CAN ONLY OCCUR IF NO ERROR ON DEBIT CURRENCY
     C           *IN58     IFEQ '0'
      *
      ** Convert from Charge entry to base ccy.
     C                     Z-ADDSSPOT     XSPOT1
     C                     Z-ADDSMDIN     XMDIN1
     C                     Z-ADDECDP      XCDP1
     C                     Z-ADDCHSPOT    XSPOT2
     C                     Z-ADDCHMDIN    XMDIN2
     C                     Z-ADDCHCDP     XCDP2
     C                     MOVE ZFIELD    XAMNT1
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           XAMNT1    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVELSCGCY     P#DBCY                          CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE BORDCY    P#CRCY                          CEU006
     C                     Z-ADDDRVD      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT
     C                     ENDIF                                          CEU006
     C                     Z-ADDXAMNT2    COLL
     C                     MOVE ZFIELD    COLH
     C                     END
     C                     END                             ** E02
      *
      *
      ** If value not changed restore any previous error condition.
     C***********SIN64     IFEQ '1'                                       E23057
     C***********          ADD  1         S                               E23057
     C***********          MOVE ' 250'    ERCD,S                          E23057
     C***********          MOVE '1'       *IN64                           E23057
     C***********          END                                            E23057
      *
     C                     ELSE                            ** X01
     C                     Z-ADD0         COLL
     C                     Z-ADD0         COLH
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C071
     C*                                                                   CEU006
     C** Call FT0010 to calculate Credit, Notify Delivery or              CEU006
     C** Debit currencies.                                                CEU006
     C*                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           NDCERR    IFNE 'Y'                                       CEU006
     C           NDAERR    ANDNE'Y'                                       CEU006
     C           *IN48     ANDNE'1'                                       CEU006
     C           *IN57     ANDNE'1'                                       CEU006
     C           *IN58     ANDNE'1'                                       CEU006
     C           *IN60     ANDNE'1'                                       CEU006
     C                     CLEARP#0010                                    CEU006
     C           RATE      IFNE *ZERO                                     CEU006
     C                     Z-ADDRATE      P#RATE                          CEU006
     C                     ENDIF                                          CEU006
     C                     MOVE OVRD      P#OVRT                          CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     MOVE SNDCY     P#NDCY                          CEU006
     C                     Z-ADDNDAM      P#NDAM                          CEU006
     C                     MOVE SDRCY     P#DBCY                          CEU006
      *                                                                   CEU006
     C           *LIKE     DEFN NDAM      CHECK                           CEU006
     C                     Z-ADD*ZERO     CHECK                           CEU006
     C                     MOVE *BLANKS   ZFIELD                          CEU006
     C                     MOVELSNDAM     ZFIELD                          CEU006
     C           13        SUB  N#NBDP    ZADIG                           CEU006
     C                     Z-ADDN#NBDP    ZADEC                           CEU006
     C                     EXSR ZALIGN                                    CEU006
     C                     MOVE ZFIELD    CHECK                           CEU006
     C           CHECK     IFEQ NDAM                                      CEU006
     C           CHECK     ANDNE*ZERO                                     CEU006
     C                     Z-ADDPDDRAM    P#DBAM                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE PCCY      P#CRCY                          CEU006
     C                     Z-ADDCQAM      P#CRAM                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     Z-ADDRATDIS    P#RTDS                          CEU006
     C                     MOVE 'Y'       P#SDIN                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C           P#INDC    IFNE '00000'                                   CEU006
     C                     MOVE *ON       *IN57                           CEU006
     C                     MOVE *ON       *IN75                           CEU006
     C                     MOVE 'Y'       NDAERR                          CEU006
     C           S         IFEQ 0                                         CEU006
     C                     ADD  1         S                               CEU006
     C                     ENDIF                                          CEU006
     C           P#INDC    IFEQ '00001'                                   CEU006
     C           P#INDC    OREQ '01101'                                   CEU006
     C                     MOVE *ON       *IN60                           CEU006
     C                     ENDIF                                          CEU006
     C                     ELSE                                           CEU006
     C                     Z-ADDP#MDIN    MDIN                            CEU006
     C                     Z-ADDP#RATE    RATE                            CEU006
     C                     MOVE *BLANKS   EDITIN                          CEU006
     C                     MOVE RATE      EDITIN                          CEU006
     C                     Z-ADD8         A6NBDP                          CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SRATE                           CEU006
     C                     Z-ADDP#NDAM    NDAM                            CEU006
     C                     MOVE P#NDAM    EDITIN                          CEU006
     C                     Z-ADDN#NBDP    A6NBDP                          CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     MOVEADIG2,3    SNDAM                           CEU006
     C                     MOVE P#DBAM    PDDRAM                          CEU006
     C                     MOVE P#CRAM    CQAM                            CEU006
     C                     ENDIF                                          CEU006
     C           SNDCY     IFEQ *BLANKS                                   CEU006
     C           NDAM      ANDEQ*ZERO                                     CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     MOVE *BLANKS   NDCY                            CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                                       CGL014
      ** Check if balance remaining for the debit party (retail a/c                           CGL014
      ** and held as collateral) is sufficient to cover the blocked amount                    CGL014
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           DRPT      ANDEQ'R'                                                           CGL014
     C           WCOLF     ANDEQ'Y'                                                           CGL014
     C           *IN57     ANDEQ*OFF                                                          CGL014
     C           *IN58     ANDEQ*OFF                                                          CGL014
     C           *IN60     ANDEQ*OFF                                                          CGL014
     C           ACTION    IFEQ 'I'                                                          BUG3281
     C           ACTION    OREQ 'A'                                                          BUG3281
     C           OEDT      ANDEQBJRDNB                                                       BUG3281
     C                     Z-ADDCQAM      PTAMNT                                              CGL014
      *                                                                                       CGL014
      ** Get no. of decimal places of pay currency                                            CGL014
      *                                                                                       CGL014
     C           SDRCY     IFNE PCCY                                                          CGL014
     C                     MOVE PCCY      @CCY                                                CGL014
     C                     EXSR CCYCHN                                                        CGL014
     C                     Z-ADDA6NBDP    PFNBDP                                              CGL014
      *                                                                                       CGL014
      ** Get no. of decimal places of debit currency                                          CGL014
      *                                                                                       CGL014
     C                     MOVE SDRCY     @CCY                                                CGL014
     C                     EXSR CCYCHN                                                        CGL014
     C                     Z-ADDA6NBDP    PTNBDP                                              CGL014
      *                                                                                       CGL014
     C           MDIN      IFEQ 1                                                             CGL014
     C                     MOVE 'M'       PMDIN                                               CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'D'       PMDIN                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Convert cheque amount to debit currency using the rate entered                       CGL014
      *                                                                                       CGL014
     C                     CALL 'ZCONVZ1'                                                     CGL014
     C                     PARM CQAM      PINAMT 150                                          CGL014
     C                     PARM RATE      PXRATE 138                                          CGL014
     C                     PARM           PMDIN   1                                           CGL014
     C                     PARM PCCY      PFRCCY  3                                           CGL014
     C                     PARM SDRCY     PTOCCY  3                                           CGL014
     C                     PARM           PFNBDP  10                                          CGL014
     C                     PARM           PTNBDP  10                                          CGL014
     C                     PARM 0         POUAMT 150                                          CGL014
      *                                                                                       CGL014
     C                     Z-ADDPOUAMT    PTAMNT                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Validate for sufficient funds                                                        CGL014
      *                                                                                       CGL014
     C                     CALL 'GL006000'                                                    CGL014
     C                     PARM           PTAMNT 150                                          CGL014
     C                     PARM SDRCY     PTCCY   3                                           CGL014
     C                     PARM *BLANKS   PABRCA  3                                           CGL014
     C                     PARM *BLANKS   PACNUM  6                                           CGL014
     C                     PARM *BLANKS   PACCY   3                                           CGL014
     C                     PARM *BLANKS   PAACOD 10                                           CGL014
     C                     PARM *BLANKS   PAACSQ  2                                           CGL014
     C                     PARM WACNO     PAACNO 100                                          CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFNE *BLANKS                                                       CGL014
      *                                                                                       CGL014
      ** Send error msg 'Available balance is not sufficient                                  CGL014
      ** to cover blocked amount'                                                             CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*BLKERR'                                                     CGL014
     C                     ADD  1         S                                                   CGL014
     C                     MOVE *ON       *IN57                                               CGL014
     C                     MOVEL'FTA0140' MSGID                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Balance is greater than blocked amount but less than minimum                         CGL014
      ** balance, send warning msg 'Minimum balance will be exceeded'                         CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*WARN  '                                                     CGL014
     C                     ADD  1         S                                                   CGL014
     C                     MOVE *ON       *IN57                                               CGL014
     C                     MOVE *ON       *IN19                                               CGL014
     C                     MOVEL'FTA0141' MSGID                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C                     CALL 'ZA0340'                                                      CGL014
     C                     PARM MSGFIL    MSGFL                                               CGL014
     C                     PARM           MSGID                                               CGL014
      *                                                                                       CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDIF                                                             BUG3281
     C/COPY WNCPYSRC,FT0080C072
     C*                                                                   S01499
     C                     ADD  COLL      TTLCHG                          S01499
      *
      ** Save value of error indicator.
     C                     MOVE *IN64     SIN64   1
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF COLLECTION CHARGE.                          S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI2    IFNE 'Y'                                       S01499
     C           SVATI2    ANDNE'N'                                       S01499
     C           SVATI2    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 096'    ERCD,S                          S01499
     C                     MOVE '1'       *IN84                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI2                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01508
     C**  Use the default value of the costs abroad if core feature       S01508
     C**  S01508 is installed and the field is blank OR core feature      S01508
     C**  S01508 is installed AND either the "charges to the debit of"    S01508
     C**  or credit party has changed on AMEND mode.                      S01508
     C*                                                                   S01508
     C           S01508    IFEQ 'Y'                                       S01508
     C           *IN58     ANDEQ'0'                                       S01508
     C*                                                                   S01508
     C           SCSTA     IFEQ *BLANKS                                   S01508
     C           ACTION    OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C** TEMP07                                                           S01494
     C           SCSTA     ANDEQSCSTAX                                    S01494
     C*                                                                   S01508
     C           CSTH      IFNE 0                                         S01508
     C                     MOVE *BLANKS   EDITIN                          S01508
     C                     MOVE CSTH      EDITIN                          S01508
     C                     Z-ADDECDP      A6NBDP                          S01508
     C                     EXSR EDIT                                      S01508
     C                     MOVEADIG2,3    SCSTA                           S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   SCSTA                           S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
      *
     C**
     C*  COSTS ABROAD IS OPTIONAL IF ENTERED MUST BE NUMERIC WITH NO
     C*    MORE DECIMAL PLACES THAN BASE CURRENCY
     C**
     C           SCSTA     IFNE *BLANKS                    ** B01
      *
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCSTA     ZFIELD
     C           11        SUB  ECDP      ZADIG
     C                     Z-ADDECDP      ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 182'    ERCD,S                          S01117
     C                     MOVE ' 081'    ERCD,S                          S01117
     C                     MOVE '1'       *IN65
     C                     ELSE                            ** X02
      *
      ** If no error: store previous valu.
     C                     MOVE SCSTA     SCSTAX
      *
     C*   CAN ONLY OCCUR IF NO ERROR ON DEBIT CURRENCY
     C           *IN58     IFEQ '0'
     C**
      *
      ** Convert from Charge entry to base ccy.
     C                     Z-ADDSSPOT     XSPOT1
     C                     Z-ADDSMDIN     XMDIN1
     C                     Z-ADDECDP      XCDP1
     C                     Z-ADDCHSPOT    XSPOT2
     C                     Z-ADDCHMDIN    XMDIN2
     C                     Z-ADDCHCDP     XCDP2
     C                     MOVE ZFIELD    XAMNT1
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           XAMNT1    ANDNE*ZERO                                     CEU006
     C                     CLEARP#0010                                    CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     Z-ADDXAMNT1    P#DBAM                          CEU006
     C                     MOVE SCGCY     P#DBCY                          CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE BORDCY    P#CRCY                          CEU006
     C                     Z-ADDDRVD      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#CRAM    XAMNT2                          CEU006
     C                     ELSE                                           CEU006
     C                     EXSR XCONVT
     C                     ENDIF                                          CEU006
     C                     Z-ADDXAMNT2    CSTA
     C                     MOVE ZFIELD    CSTH
     C                     END
     C                     END                             ** E02
      *
      *
      ** If value not changed restore any previous error condition.
     C***********SIN65     IFEQ '1'                                       E23057
     C***********          ADD  1         S                               E23057
     C***********          MOVE ' 182'    ERCD,S                          E23057
     C***********          MOVE '1'       *IN65                           E23057
     C***********          END                                            E23057
      *
     C                     ELSE                            ** X01
     C                     Z-ADD0         CSTA
     C                     Z-ADD0         CSTH
     C                     END                             ** E01
     C*
     C                     ADD  CSTA      TTLCHG                          S01499
      *
      ** Save value of error indicator.
     C                     MOVE *IN65     SIN65   1
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF COST ABROAD.                                S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI3    IFNE 'Y'                                       S01499
     C           SVATI3    ANDNE'N'                                       S01499
     C           SVATI3    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE ' 097'    ERCD,S                          S01499
     C                     MOVE '1'       *IN85                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI3                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** IF V.A.T. FEATURE IS SWITCHED ON, COMPUTE VAT AMOUNT FOR EACH    S01499
     C** CHARGE.                                                          S01499
     C*                                                                   S01499
     C                     Z-ADD0         PDVATH                          S01499
     C                     Z-ADD0         PDVATT                          S01499
     C                     Z-ADD0         PDVATR                          S01499
     C/COPY WNCPYSRC,FT0080C080
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     Z-ADD0         #PDVAT 110                                          CER049
     C                     Z-ADD0         #PDVAH 110                                          CER049
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           *IN63     ANDNE'1'                                       S01499
     C           *IN64     ANDNE'1'                                       S01499
     C           *IN65     ANDNE'1'                                       S01499
     C           *IN20     ANDNE'1'                                       S01499
     C           *IN13     ANDNE'1'                                       S01499
     C           *IN83     ANDNE'1'                                       S01499
     C           *IN84     ANDNE'1'                                       S01499
     C           *IN85     ANDNE'1'                                       S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ 'Y'                                       S01499
     C           CSTA      MULT O#VATR    VAT    110H                     S01499
     C                     ADD  VAT       PDVATT                          S01499
     C/COPY WNCPYSRC,FT0080C081
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #PDVAT                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ 'Y'                                       S01499
     C           COLL      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ 'Y'                                       S01499
     C           TRCM      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATT                          S01499
     C/COPY WNCPYSRC,FT0080C082
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #PDVAT                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ 'Y'                                       S01499
     C           *IN09     ANDEQ'1'                                       S01494
     C           PDCHCM    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ 'Y'                                       S01499
     C           CSTH      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATH                          S01499
     C/COPY WNCPYSRC,FT0080C083
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #PDVAH                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ 'Y'                                       S01499
     C           COLH      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATH                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ 'Y'                                       S01499
     C           TRCH      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATH                          S01499
     C/COPY WNCPYSRC,FT0080C084
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #PDVAH                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ 'Y'                                       S01499
     C           *IN09     ANDEQ'1'                                       S01494
     C           PDCHCH    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       PDVATH                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** FORMAT VAT FIELD FOR POTENTAIL REDISPLAY                         S01499
     C*                                                                   S01499
     C           PDVATH    IFNE 0                                         S01499
     C                     Z-ADDECDP      A6NBDP                          S01499
     C                     MOVE *BLANKS   EDITIN                          S01499
     C                     MOVE PDVATH    EDITIN                          S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVEADIG2,3    SVATT                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     MOVE SVATI1    PDVAT1                          S01499
     C                     MOVE SVATI2    PDVAT2                          S01499
     C                     MOVE SVATI3    PDVAT3                          S01499
     C                     MOVE SVATI4    PDVAT4                          S01499
     C           PDVATT    IFNE 0                                         S01499
     C           PDVATH    ORNE 0                                         S01499
     C                     Z-ADDO#VATR    PDVATR                          S01499
     C                     ADD  PDVATT    TTLCHG                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C***********          END                                     S01499 084663
     C*                                                                   S01499
     C**  Total charges should not exceed debit currency amount           S01499
     C*                                                                   S01499
     C/COPY WNCPYSRC,FT0080C056
     C           TTLCHG    IFGT W7CAMT                                    S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '098'     ERCD,S                          S01499
     C           STRCM     IFNE *BLANKS                                   S01499
     C                     MOVE '1'       *IN63                           S01499
     C                     END                                            S01499
     C           SCLCH     IFNE *BLANKS                                   S01499
     C                     MOVE '1'       *IN64                           S01499
     C                     END                                            S01499
     C           SCSTA     IFNE *BLANKS                                   S01499
     C                     MOVE '1'       *IN65                           S01499
     C                     END                                            S01499
     C           *IN09     IFEQ '1'                                       S01499
     C           SCHCM     ANDNE*BLANKS                                   S01499
     C                     MOVE '1'       *IN20                           S01499
     C                     END                                            S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATT     ANDNE*BLANKS                                   S01499
     C                     MOVE '1'       *IN87                           S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C/COPY WNCPYSRC,FT0080C057
     C*                                                                   S01499
     C                     END                                            084663
      *
     C**
     C***CHARGES*TO*THE*DEBIT*OF*IS*OPTIONAL*SO*SET*FIELD*AND*TYPE*****   S01508
     C*****TO*ZERO/BLANK***********************************************   S01508
     C***********                                                         S01508
     C***********          Z-ADD0         CDRO                            S01508
     C***********          MOVE *BLANKS   CDBR                     S01117 S01508
     C***********          MOVE ' '       CDRT                            S01508
     C***********                                                         S01508
     C***********SCDRO     IFNE *BLANKS                    ** B01         S01508
     C***********SCDBR     ORNE *BLANKS                            S01117 S01508
     C***********                                                  S01194 S01508
     C***CHECK*FOR*INVALID*?*ENTERED.******************************S01194 S01508
     C***********          MOVEA*BLANKS   FLDQ                     S01194 S01508
     C***********          MOVEASCDRO     FLDQ                            S01508
     C***********'?'       LOKUPFLDQ                     29        S01194 S01508
     C************IN29     IFEQ '1'                                S01194 S01508
     C***********          SETON                         66        S01194 S01508
     C***********          ADD  1         S                        S01194 S01508
     C***********          MOVE ' 086'    ERCD,S                   S01194 S01508
     C***********          END                                     S01194 S01508
     C***********                                                  S01194 S01508
     C***********                                                         S01508
     C***IF*ENTERED*MOVE*CHARGES*TO*THE*DEBIT*OF*TO*DS*FOR*VALIDATION**   S01508
     C***********                                                         S01508
     C***********          MOVE SCDRO     SCDROX                          S01508
     C***IF*CDRO*NOT*ENTERED*AS*12*LONG*PARTIAL*ACCOUNT************S01117 S01508
     C***AND*CDBR*ENTERED*THEN*ERROR.******************************S01117 S01508
     C***********                                                  S01117 S01508
     C***********CACSQA    IFEQ *BLANKS                            S01117 S01508
     C***********@MBIN     ANDEQ'Y'                                S01117 S01508
     C***********SCDBR     ANDNE*BLANKS                            S01117 S01508
     C***********          ADD  1         S                        S01194 S01508
     C***********          MOVE ' 087'    ERCD,S                   S01194 S01508
     C***********          SETON                         66        S01194 S01508
     C***********          END                                     S01194 S01508
     C***********                                                         S01508
     C***IF*CHARGES*TO*THE*DEBIT*OF*ENTERED*AS*2*CHARACTERS*VALIDATE*AS A S01508
     C*****FULL*NOSTRO*WITH*BASE*CURRENCY*-*MUST*BE*ON*PF/SDNOSTPD*****   S01508
     C*****FULL*NOSTRO*WITH*BASE*CURRENCY*-*MUST*BE*ON*PF/TABLETL******   S01194
     C***********                                                         S01508
     C***********CNOSTA    IFNE *BLANKS                    ** B02         S01508
     C***********CNOSTR    ANDEQ*BLANKS                                   S01508
     C***********SCDBR     ANDEQ*BLANKS                            S01117 S01508
     C************IN66     ANDEQ'0'                                S01194 S01508
     C***********                                                  S01194 S01508
     C***********          CALL 'AONOSTR0'                         S01194 S01508
     C***********          PARM *BLANKS   @RTCD                    S01194 S01508
     C***********          PARM '*KEY   ' @OPTN                    S01194 S01508
     C***********          PARM *BLANKS   @CUST                    S01194 S01508
     C***********          PARM BJCYCD    @CYCD                    S01194 S01508
     C***********          PARM *BLANKS   @ACCD                    S01194 S01508
     C***********          PARM *BLANKS   @ACSN                    S01194 S01508
     C***********          PARM CNOSTA    @NONB                    S01194 S01508
     C***********          PARM *BLANKS   @BRCD                    S01194 S01508
     C***********          PARM *BLANKS   @CSSN                    S01194 S01508
     C***********          PARM *BLANKS   @PNOI                    S01194 S01508
     C***********SDNOST    PARM SDNOST    DSFDY                    S01194 S01508
     C***********                                                  S01194 S01508
     C***********@RTCD     CASEQ*BLANKS   MVNOST     8989          S01194 S01508
     C***********          END                                     S01194 S01508
     C***********                                                  S01194 S01508
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************MOVELBCCY      ZTAB08                          S01194
     C*********************MOVE CNOST     ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C***********                                                         S01508
     C************IN89     IFEQ '1'                        ** B03         S01508
     C***********          ADD  1         S                               S01508
     C*********************MOVE ' 185'    ERCD,S                          S01117
     C***********          MOVE ' 082'    ERCD,S                   S01117 S01508
     C***********          MOVE '1'       *IN66                           S01508
     C***********          ELSE                            ** X03         S01508
     C***********          MOVE 'N'       CDRT                            S01508
     C***********          MOVE CNUM      ACNTCN                   047179 S01508
     C***********          MOVELBJCYCD    ACNTCY                   047179 S01508
     C***********          MOVE ACOD      ACNTAC                   047179 S01508
     C***********          MOVE ACSQ      ACNTAS                   047179 S01508
     C***********          EXSR ACCCHN                             047179 S01508
     C***********          END                             ** E03         S01508
     C***********                                                         S01508
     C***********          END                             ** E02         S01508
     C***********                                                         S01508
     C***IF*CHARGES*TO*THE*DEBIT*OF*ENTERED*AS*10*LONG*VALIDATE*AS*A***   S01508
     C*****RETAIL*ACCOUNT*NUMBER*-*MUST*BE*ON*LF/ACNUMA*&*IN*BASE*CCY.*   S01508
     C***********                                                         S01508
     C************IN66     IFEQ '0'                        ** B02         S01508
     C***********CDRT      ANDEQ' '                                       S01508
     C***********                                                         S01508
     C***********CRETLA    IFNE *BLANKS                    ** B03         S01508
     C***********CRETLR    ANDEQ*BLANKS                                   S01508
     C***********SCDBR     ANDEQ*BLANKS                            S01117 S01508
     C***********                                                         S01508
     C***********CRETL     CHAINACNUMA               99                   S01508
     C**N99******RECI      COMP 'D'                  9999                 S01508
     C************IN99     IFEQ '1'                        ** B04         S01508
     C***********          ADD  1         S                               S01508
     C*********************MOVE ' 187'    ERCD,S                          S01117
     C***********          MOVE ' 083'    ERCD,S                   S01117 S01508
     C***********          MOVE '1'       *IN66                           S01508
     C***********          ELSE                            ** X04         S01508
     C***********                                                         S01508
     C***CHECK*TO*SEE*IF*RETAIL*ACCOUNT*NUMBER*IS*ALLOWED**************   S01508
     C***********                                                         S01508
     C***********RACN******IFNE 'Y'                                       S01194
     C***********BMRANR    IFNE 'Y'                                S01194 S01508
     C***********          SETON                     66                   S01508
     C***********          ADD  1         S                               S01508
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C***********          MOVE ' 026'    ERCD,S                   S01117 S01508
     C***********                                                         S01508
     C***********          ELSE                                           S01508
     C***********CCY*******IFNE BCCY                       ** B05         S01194
     C***********CCY       IFNE BJCYCD                     ** B05  S01194 S01508
     C***********          ADD  1         S                               S01508
     C*********************MOVE ' 188'    ERCD,S                          S01117
     C***********          MOVE ' 084'    ERCD,S                   S01117 S01508
     C***********          MOVE '1'       *IN66                           S01508
     C***********          ELSE                            ** X05         S01508
     C***********          MOVE 'R'       CDRT                            S01508
     C***********          END                             ** E05         S01508
     C***********          END                             ** E04         S01508
     C***********          END                             ** E04         S01508
     C***********          END                             ** E03         S01508
     C***********          END                             ** E02         S01508
     C***********                                                  S01117 S01508
     C***IF*CDRO*ENTERED*12*LONG*,MBIN=Y*AND*CDBR*NOT*ENTERED>*ERROS01117 S01508
     C***********                                                  S01117 S01508
     C***********CACSQA    IFNE *BLANKS                            S01117 S01508
     C***********@MBIN     ANDEQ'Y'                                S01117 S01508
     C***********SCDBR     ANDEQ*BLANKS                            S01117 S01508
     C***********          ADD  1         S                        S01117 S01508
     C***********          MOVE ' 088'    ERCD,S                   S01117 S01508
     C***********          SETON                     66            S01117 S01508
     C***********          END                                     S01117 S01508
     C***********                                                  S01117 S01508
     C***IF*CHARGES*TO*THE*DEBIT*OF*ENTERED*AS*12*LONG*VALIDATE*AS*A***   S01508
     C*****PARTIAL*CUSTOMER*ACCOUNT*NUMBER*-*MUST*BE*ON*LF/ACCNT*******   S01508
     C***********                                                         S01508
     C***********CACSQA    IFNE *BLANKS                    ** B02         S01508
     C************IN66     ANDNE'1'                                S01117 S01508
     C***********                                                  S01117 S01508
     C***IF*NON-MB*SET*CHARGES*DB*BRANCH*TO*SINGLE*BRANCH**********S01117 S01508
     C***********                                                  S01117 S01508
     C***********@MBIN     IFEQ 'N'                                S01117 S01508
     C***********          MOVE BJSBRC    SCDBR                    S01117 S01508
     C***********          END                                     S01117 S01508
     C***********                                                  S01117 S01508
     C***********          MOVE CCUST     ACNTCN                          S01508
     C***********          MOVE CACOD     ACNTAC                          S01508
     C***********          MOVE CACSQ     ACNTAS                          S01508
     C*********************MOVE BCCY      ACNTCY                          S01194
     C***********          MOVE BJCYCD    ACNTCY                   S01194 S01508
     C***********          MOVE SCDBR     ACNTBR                   S01117 S01508
     C***********ACCNTK    CHAINACCNT                99                   S01508
     C**N99******RECI      COMP 'D'                  9999                 S01508
     C************IN99     IFEQ '1'                        ** B03         S01508
     C***********          ADD  1         S                               S01508
     C*********************MOVE ' 189'    ERCD,S                          S01117
     C***********          MOVE ' 085'    ERCD,S                   S01117 S01508
     C***********          MOVE '1'       *IN66                           S01508
     C***********          ELSE                            ** X03         S01508
     C***********          MOVE 'P'       CDRT                            S01508
     C***********          END                             ** E03         S01508
     C***********          END                             ** E02         S01508
      ***********                                                  047179 S01508
      ***Check*if*date*is*in*the*future*and*if*the*account*is******047179 S01508
      ***closing*today*********************************************047179 S01508
      ***********                                                  047179 S01508
     C************IN66     IFEQ '0'                                047179 S01508
      ***********                                                  047179 S01508
     C***********ZDAYNO    IFGT BJRDNB                             047179 S01508
     C***********ACST      ANDEQ'C'                                047179 S01508
     C***********          SETON                     66            047179 S01508
     C***********          ADD  1         S                        047179 S01508
     C***********          MOVEA' 604'    ERCD,S                   047179 S01508
     C***********          END                                     047179 S01508
      ***********                                                  047179 S01508
     C***********          END                                     047179 S01508
     C***********                                                         S01508
     C***STORE*CHARGES*TO*THE*DEBIT*OF*IF*VALID************************   S01508
     C***********                                                         S01508
     C************IN66     IFEQ '0'                        ** B02         S01508
     C***********          MOVE SCDRO     CDRO                            S01508
     C***********          MOVE SCDBR     CDBR                     S01117 S01508
     C***********          END                             ** E02         S01508
     C***********                                                         S01508
     C***********          END                             ** E01         S01508
     C**
     C*  CENTRAL BANK REFERENCE IS MANDATORY AND MUST BE A NUMERIC
     C*    WITH 0 DECIMAL PLACES
     C**
     C           SDNBC     IFEQ *BLANKS                    ** B01
     C/COPY WNCPYSRC,FT0080C064
     C                     Z-ADD0         DNBC
     C/COPY WNCPYSRC,FT0080C065
      *
     C                     ELSE                            ** X01
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDNBC     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B02
     C                     ADD  1         S
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 089'    ERCD,S                          S01117
     C                     MOVE '1'       *IN67
     C                     ELSE                            ** X02
     C                     MOVE ZFIELD    SDNBC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE SDNBC     DNBC
     C                     END                             ** E02
     C                     END                             ** E01
      *                                                                   S01414
      ** Check Book Code field for entry of ?                             S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASBOKC     FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     29               S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     CALL 'AOBOOKR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDBOOK    SBOKC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SBOKC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Book Code.                                          S01414
      *                                                                   S01414
     C                     MOVEL*BLANKS   W#BOKC                          179732
     C                     MOVELSBOKC     W#BOKC                          S01414
     C                     EXSR SRBOOK                                    S01414
     C                     MOVELW#BOKC    SBOKC                           S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN25     IFEQ '0'                                       S01414
     C                     MOVELW#BOKC    BOKC                            S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Check Profit Centre field for entry of ?                         S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASPRFC     FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     29               S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN29     IFEQ '1'                                       S01414
     C                     CALL 'AOPRFCR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
     C                     MOVE 'N'       SLCTD                                             MD031725
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDPRFC    SPRFC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SPRFC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Profit Centre if Used.                              S01414
      *                                                                   S01414
     C                     MOVEL*BLANKS   W#PRFC                          179732
     C                     MOVELSPRFC     W#PRFC                          S01414
     C                     EXSR SRPRFC                                    S01414
     C                     MOVELW#PRFC    SPRFC                           S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN33     IFEQ '0'                                       S01414
     C                     MOVELW#PRFC    PRFC                            S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *
      *  END of screen validation
     C/COPY WNCPYSRC,FT0080C015
      * Validate reference rate                                           CDL049
     C                     MOVEA'10'      *IN,40                          CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
      *                                                                   CDL049
      * Set screen display indicator                                      CDL049
     C                     MOVE '0'       *IN40                           CDL049
      *                                                                   CDL049
     C           S#REFR    IFEQ *BLANKS                                   CDL049
     C                     Z-ADD0         SEREFR 138                      CDL049
     C                     ELSE                                           CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   ZFIELD                          CDL049
     C                     MOVELS#REFR    ZFIELD                          CDL049
     C                     Z-ADD8         ZADEC                           CDL049
     C                     Z-ADD5         ZADIG                           CDL049
     C                     EXSR ZALIGN                                    CDL049
      *                                                                   CDL049
     C           *IN99     IFEQ *ON                                       CDL049
     C                     MOVE '1'       *IN41                           CDL049
     C                     MOVEL'FTM1321' ZAMSID                          CDL049
      *                                                                   CDL049
     C           ZAPGMQ    IFEQ *BLANK                                    CDL049
     C                     MOVEL##PGM     ZAPGMQ                          CDL049
     C                     ENDIF                                          CDL049
     C                     MOVEL'FTUSRMSG'ZAMSGF                          CDL049
      *                                                                   CDL049
     C                     CALL 'Y2SNMGC'                                 CDL049
     C                     PARM           ZAPGMQ 10        Program queue  CDL049
     C                     PARM           ZAPGRL  5        Rel queue      CDL049
     C                     PARM           ZAMSID  7        Message Id.    CDL049
     C                     PARM           ZAMSGF 10        Message file.  CDL049
     C                     PARM           ZAMSDA132        Message data.  CDL049
     C                     PARM           ZAMSTP  7        Message type.  CDL049
     C                     ADD  1         S                               CDL049
     C                     MOVE ' 555'    ERCD,S                          CDL049
     C                     Z-ADD0         SWRKRR 138                      CDL049
     C                     ELSE                                           CDL049
      *                                                                   CDL049
     C                     MOVE ZFIELD    SEREFR                          CDL049
      *                                                                   CDL049
     C                     CALL 'ZEDIT'                9090               CDL049
     C                     PARM           ZFIELD 16                       CDL049
     C                     PARM 8         ZADEC   10                      CDL049
     C                     MOVE ZFIELD    S#REFR                          CDL049
      *                                                                   CDL049
     C                     Z-ADD*ZERO     MINRAT 138                      CDL049
     C                     Z-ADD*ZERO     MAXRAT 138                      CDL049
     C                     Z-ADD*ZERO     UETOLR 138                      CDL049
     C                     Z-ADD*ZERO     UERRAT 138                      CDL049
      *                                                                   CDL049
     C           IRATET    DIV  100       UERRAT                          CDL049
     C           VRATE1    MULT UERRAT    UETOLR    H                     CDL049
     C           VRATE1    SUB  UETOLR    MINRAT    H                     CDL049
     C           VRATE1    ADD  UETOLR    MAXRAT    H                     CDL049
      *                                                                   CDL049
     C           SEREFR    IFGT MAXRAT                                    CDL049
     C           SEREFR    ANDNE0                                         CDL049
     C           SEREFR    ORLT MINRAT                                    CDL049
     C           SEREFR    ANDNE0                                         CDL049
      *                                                                   CDL049
      * Make sure warning is displayed at least once                      CDL049
     C           SEREFR    IFNE SWRKRR                                    CDL049
     C                     MOVEL'FTM1320' ZAMSID                          CDL049
      *                                                                   CDL049
     C           ZAPGMQ    IFEQ *BLANK                                    CDL049
     C                     MOVEL##PGM     ZAPGMQ                          CDL049
     C                     ENDIF                                          CDL049
     C                     MOVEL'FTUSRMSG'ZAMSGF                          CDL049
      *                                                                   CDL049
     C                     CALL 'Y2SNMGC'                                 CDL049
     C                     PARM           ZAPGMQ 10        Program queue  CDL049
     C                     PARM           ZAPGRL  5        Rel queue      CDL049
     C                     PARM           ZAMSID  7        Message Id.    CDL049
     C                     PARM           ZAMSGF 10        Message file.  CDL049
     C                     PARM           ZAMSDA132        Message data.  CDL049
     C                     PARM           ZAMSTP  7        Message type.  CDL049
     C                     ADD  1         S                               CDL049
     C                     MOVE 'W10'     ERCD,S                          CDL049
     C                     MOVE '1'       *IN41                           CDL049
     C                     ENDIF                                          CDL049
     C                     MOVE SEREFR    SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     ENDIF                                          CDL049
      *
      *
      * Determine if errors exist
      *
     C*
     C           S         IFGE 1                          ** B01
     C                     MOVE '1'       *IN75
     C           S         IFGT 19                         ** B02
     C                     MOVE '1'       *IN76
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
      *****************************************************************
      *
      **  S.R. GETGCY - get currency for charges entry .
      **
     C           GETGCY    BEGSR
      *
      ** Charge currency code = 'C' (Charge currency).
     C           BTCHCY    IFEQ 'C'                                       S01194
     C                     MOVE BORDCY    SCGCY                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C***********FTCC******IFEQ 'C'                                       S01194
     C*********************MOVE BORDCY    SCGCY                           S01194
     C*********************END                                            S01194
     C*********************                                               S01194
      ** Charge currency code = 'L' (Local currency)
     C           BTCHCY    IFEQ 'L'                                       S01194
     C                     MOVE BJLCCY    SCGCY                           S01194
     C                     END                                            S01194
      *                                                                   S01194
     C***********FTCC******IFEQ 'L'                                       S01194
     C*********************MOVE LOCY      SCGCY                           S01194
     C*********************END                                            S01194
     C*********************                                               S01194
      ** Charge currency code = 'B' (Base currency)
     C           BTCHCY    IFEQ 'B'                                       S01194
     C                     MOVE BJCYCD    SCGCY                           S01194
     C                     END                                            S01194
      *                                                                   S01194
     C           BTCHCY    IFEQ 'F'                                       196947
     C                     MOVE FCHCCY    SCGCY                           196947
     C                     END                                            196947
      *                                                                   196947
     C***********FTCC******IFEQ 'B'                                       S01194
     C*********************MOVE BCCY      SCGCY                           S01194
     C*********************END                                            S01194
     C*********************                                               S01194
     C***Get*number*of*decimal*places.*                                   S01194
     C***********SCGCY*****IFNE BCCY                                      S01194
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE SCGCY     ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
      ** Get number of decimal places.                                    S01194
     C           SCGCY     IFNE BJCYCD                                    S01194
     C                     MOVE SCGCY     @CCY                            S01194
     C                     EXSR CCYCHN
     C*********************Z-ADDCDP       ECDP                            S01194
     C                     Z-ADDA6NBDP    ECDP                            S01194
     C                     Z-ADDMDIN      SMDIN   10
     C*********************Z-ADDSPOT      SSPOT  138                      S01194
     C                     Z-ADDA6SPRT    SSPOT  138                      S01194
     C                     ELSE
     C                     Z-ADD1         SSPOT
     C                     Z-ADDBCCYDP    ECDP    30
     C                     END
     C                     ENDSR
     C/EJECT
     C************************************************************
     C* RATES SR.
     C* VALIDAION OF RATE
     C* OPTIONAL DEFAULTS TO CROSS RATE
     C* IF REGULAR PAYMENT NOT PERMITTED
     C*
     C           RATES     BEGSR
     C           CEU006    IFNE 'Y'                                       CEU006
     C                     EXSR RATDEF
     C                     ENDIF                                          CEU006
     C           SRATE     IFEQ *BLANK                     B001
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     Z-ADD*ZERO     RATE                            CEU006
     C                     Z-ADD*ZERO     VRATE1                          CEU006
     C                     ELSE                                           CEU006
     C                     Z-ADDDRATE     VRATE1 138
     C                     Z-ADDDMDIN     VMDIN   10
     C                     ENDIF                                          CEU006
     C                     ELSE                            X001
     C* CHECK IF VALID NUMERIC
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE SRATE     ZFIELD
     C**********           Z-ADD4         ZADIG                                               145043
     C                     Z-ADD5         ZADIG                                               145043
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B002
     C                     SETON                       60
     C                     ADD  1         S
     C******************   MOVEA' 046'    ERCD,S                          E16366
     C*********************MOVEA' 048'    ERCD,S                    E16366S01117
     C                     MOVEA' 074'    ERCD,S                          S01117
     C                     MOVE 'N'       @VALR   1                       035399
     C                     ELSE                            X002
     C                     MOVE ZFIELD    VRATE1
     C           CEU006    IFNE 'Y'                                       CEU006
     C***********                                                         112287
     C***********DRATE     IFGT 1                          B003           112287
     C***********VRATE1    ANDGT1                                         112287
     C***********DRATE     ORLE 1                                         112287
     C***********VRATE1    ANDLE1                                         112287
     C                     Z-ADDDMDIN     VMDIN
     C***********          ELSE                            X003           112287
     C***********1         SUB  DMDIN     VMDIN                           112287
     C***********          END                             E003           112287
     C           SOVRD     IFNE 'Y'                        B003
     C                     EXSR RATVAL
     C                     END                             E003
     C                     ENDIF                                          CEU006
     C                     END                             E002
     C                     END                             E001
     C*
     C* SETUP SCREEN VERSION OF RATE
     C* only if a valid rate has been entered.                            035399
     C*
     C           @VALR     IFNE 'N'                                       035399
     C                     MOVE *BLANKS   EDITIN
     C                     MOVE VRATE1    EDITIN
     C*********************Z-ADD8         CDP                             S01194
     C                     Z-ADD8         A6NBDP                          S01194
     C                     EXSR EDIT
     C                     MOVEADIG2      SRATE
     C                     END                                            035399
     C*                                                                   035399
     C                     MOVE *BLANKS   @VALR                           035399
     C*
     C                     ENDSR
     C************************************************************
     C* END OF RATE VALIDATION
     C************************************************************
     C/EJECT
     C************************************************************
     C* RATDEF SR.
     C* DEFAULT RATE CALCULATION
     C*
     C           RATDEF    BEGSR
     C* SETUP TO AND FROM RATES
     C                     MOVE DRCY      TCCY    3
     C                     MOVE PCCY      FCCY    3
     C                     Z-ADDPBRAT     TBRAT  138
     C                     Z-ADDDRCYMD    TMDIN   10
     C                     Z-ADDDRCYDP    TCDP    10
     C                     Z-ADDPBRAT     TSRAT  138
     C                     Z-ADDRSRAT     FBRAT  138
     C                     Z-ADDRSRAT     FSRAT  138
     C                     Z-ADDPCCYMD    FMDIN   10
     C                     Z-ADDPCCYDP    FCDP    10
     C* IF CURRENCIES EQUAL RATE IS 1.0
     C           FCCY      IFEQ TCCY                       B001
     C                     Z-ADD1         DRATE  138
     C                     Z-ADD0         DMDIN   10
     C                     ELSE                            X001
     C* IF FROM CURRENCY IS BASE, RATE IS TO CURRENCY
     C***********FCCY******IFEQ BCCY                       B002           S01194
     C           FCCY      IFEQ BJCYCD                     B002           S01194
     C                     Z-ADDTSRAT     DRATE
     C           1         SUB  TMDIN     DMDIN
     C                     ELSE                            X002
     C* IF TO CURRENCY IS BASE, RATE IS FROM CURRENCY
     C***********TCCY******IFEQ BCCY                       B003           S01194
     C           TCCY      IFEQ BJCYCD                     B003           S01194
     C                     Z-ADDFSRAT     DRATE
     C                     Z-ADDFMDIN     DMDIN
     C                     ELSE                            X003
     C* IF BOTH DIVIDE CURRENCIES
     C           FMDIN     IFEQ 0                          B004
     C           TMDIN     IFEQ 0                          B005
     C* RATE IS TO SELL RATE DIVIDE BY FROM BUY RATE
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     ELSE                            X005
     C           FBRAT     MULT TSRAT     DRATE
     C                     Z-ADD0         DMDIN
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD1         DMDIN
     C                     END                             E006
     C                     END                             E005
     C                     ELSE                            X004
     C           TMDIN     IFEQ 0                          B005
     C           TSRAT     MULT FBRAT     DRATE
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     ELSE                            X005
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     END                             E005
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C                     ENDSR
     C************************************************************
     C* END DEFAULT RATE CALCULATION
     C************************************************************
     C/EJECT
     C************************************************************
     C* RATVAL SR.
     C* VALIDATE RATE WHEN ENTERED
     C*
     C           RATVAL    BEGSR
     C           DRCY      IFEQ PCCY                       B001
     C           VRATE1    IFNE 1                          B002
     C                     SETON                     60
     C                     ADD  1         S
     C*********************MOVEA' 048'    ERCD,S                          S01117
     C                     MOVEA' 074'    ERCD,S                          S01117
     C                     END                             E002
     C                     ELSE                            X001
     C*          DRATE     MULT 0.9       DORATE 138H
     C*          DRATE     MULT 1.1       UPRATE 138H
      *
      ** Upper and lower limits are determined by % rate discrepancy
      **                                    from payment charges file.
     C           DRATE     MULT UPMARG    UPRATE 138H
     C           DRATE     MULT LWMARG    DORATE 138H
     C           VRATE1    IFLT DORATE                     B002
     C           VRATE1    ORGT UPRATE
      *
      ** Entered rate may be Pay ccy/Receive ccy or vice versa
      **     (whichever is nearer the default rate(DRATE) is assumed)
     C           1         DIV  DRATE     DRATE
     C           DRATE     MULT UPMARG    UPRATE 138H
     C           DRATE     MULT LWMARG    DORATE 138H
     C           VRATE1    IFLT DORATE                     B003
     C           VRATE1    ORGT UPRATE
     C                     SETON                     60
     C                     ADD  1         S
     C*********************MOVEA' 048'    ERCD,S                          S01117
     C                     MOVEA' 074'    ERCD,S                          S01117
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C                     ENDSR
     C************************************************************
     C* END OF ENTERED RATE VALIDATION
     C************************************************************
     C/EJECT
     C****************************************************************
     C**TRCOMM*SR.*****************************************************   S01508
     C**SUBROUTINE*TO*CALCULATE*DEFAULT*TRANSFER*COMMISSION************   S01508
     C***********                                                         S01508
     C***********TRCOMM    BEGSR                                          S01508
     C***********                                                         S01508
     C**TRANSFER*COMMISSION**************DTRCM1************************   S01508
     C**TRANSFER*COMMISSION*TARIFF***=***STRCT*************************   S01508
     C**SETTLE*AMOUNT********************CQAM**************************   S01508
     C**SETTLE*CURRENCY******************PCCY**************************   S01508
     C***********                                                         S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*1*OR*2***************************   S01508
     C***********STRCT     IFEQ '1'                        B001           S01508
     C***********STRCT     OREQ '2'                                       S01508
     C***********          Z-ADD0         DTRCM1 110                      S01508
     C***********          ELSE                            X001           S01508
     C***********                                                         S01508
     C**READ*TABLE*FILE*FOR*CURRENCY*DETAILS*                             S01194
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELPCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C*********************SETOF                     88                   S01194
     C***********KEY*******CHAINTABTG10F             88                   S01194
     C***********                                                  S01194 S01508
     C***ACCESS*CURRENCIES*FILE*SDCUSTPD*FOR*CURRENCY*DETAILS.*****S01194 S01508
     C***********          CALL 'AOCURRR0'                         S01194 S01508
     C***********          PARM *BLANKS   @RTCD                    S01194 S01508
     C***********          PARM '*KEY   ' @OPTN                    S01194 S01508
     C***********          PARM PCCY      @CYCD                    S01194 S01508
     C***********SDCURR    PARM SDCURR    DSSDY                    S01194 S01508
     C***********                                                  S01194 S01508
     C***********@RTCD     COMP *BLANKS              8888          S01194 S01508
     C**N88******          EXSR MVCURR                                    S01508
     C***********                                                  S01194 S01508
     C****CONVERT*SETTLE*CURRENCY*AMOUNT*TO*BASE*CURRENCY**************   S01508
     C***********CDP*******SUB  BCCYDP    N       10                      S01194
     C***********A6NBDP    SUB  BCCYDP    N       10                      S01194
     C***********N         ADD  4         N                               S01508
     C***********                                                         S01508
     C***********MDIN      IFEQ 1                          B002           S01508
     C***********SPOT******DIV  POWER,N   WK159  159                      S01194
     C***********A6SPRT    DIV  POWER,N   WK159  159               S01194 S01508
     C***********CQAM      MULT WK159     AMOUNT                          S01508
     C***********          ELSE                            X002           S01508
     C***********SPOT******MULT POWER,N   WK159                           S01194
     C***********A6SPRT    MULT POWER,N   WK159                    S01194 S01508
     C***********CQAM      DIV  WK159     AMOUNT                          S01508
     C***********          END                             E002           S01508
     C***********                                                         S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*3********************************   S01508
     C***********STRCT     IFEQ '3'                        B002           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IS*LESS*THAN*START*OF*RANGE*1************************   S01508
     C***********AMOUNT    IFLT RNS1                       B003           S01508
     C***********          Z-ADD0         DTRCM1                          S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*1*******************************************   S01508
     C***********AMOUNT    IFLE RNE1                       B004           S01508
     C***********AMOUNT    MULT RNR1      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*REMAINDER*AFTER*COMMISSION*IS*LESS*START*OF*RANGE**********   S01508
     C***********LEFT      IFLT RNS1                       B005           S01508
     C***********AMOUNT    SUB  RNS1      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT RNMN                       B005           S01508
     C***********          Z-ADDRNMN      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT RNMX                       B005           S01508
     C***********RNMX      ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDRNMX      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********          ELSE                            X004           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*2*******************************************   S01508
     C***********AMOUNT    IFGE RNS2                       B005           S01508
     C***********AMOUNT    ANDLERNE2                                      S01508
     C***********AMOUNT    MULT RNR2      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*REMAINDER*AFTER*COMMISSION*IS*LESS*START*OF*RANGE**********   S01508
     C***********LEFT      IFLT RNS2                       B005           S01508
     C***********AMOUNT    SUB  RNS2      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT RNMN2                      B006           S01508
     C***********          Z-ADDRNMN2     DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT RNMX2                      B006           S01508
     C***********RNMX2     ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDRNMX2     DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********          ELSE                            X005           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*3*******************************************   S01508
     C***********AMOUNT    IFGE RNS3                       B006           S01508
     C***********AMOUNT    MULT RNR3      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*REMAINDER*AFTER*COMMISSION*IS*LESS*START*OF*RANGE**********   S01508
     C***********LEFT      IFLT RNS3                       B005           S01508
     C***********AMOUNT    SUB  RNS3      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT RNMN3                      B007           S01508
     C***********          Z-ADDRNMN3     DTRCM1                          S01508
     C***********          END                             E007           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT RNMX3                      B007           S01508
     C***********RNMX3     ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDRNMX3     DTRCM1                          S01508
     C***********          END                             E007           S01508
     C***********          ELSE                            X006           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*NOT*IN*RANGES****************************************   S01508
     C***********          Z-ADD0         DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          ELSE                            X002           S01508
     C***********                                                         S01508
     C***********                                                         S01508
     C***********STRCT     IFEQ '4'                        B003           S01508
     C***********AMOUNT    IFLT RRS1                       B004           S01508
     C***********          Z-ADD0         DTRCM1                          S01508
     C***********          ELSE                            X004           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*1*******************************************   S01508
     C***********AMOUNT    IFLE RRE1                       B005           S01508
     C***********AMOUNT    MULT RRR1      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*REMAINDER*AFTER*COMMISSION*IS*LESS*START*OF*RANGE**********   S01508
     C***********LEFT      IFLT RRS1                       B005           S01508
     C***********AMOUNT    SUB  RRS1      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT RRMN                       B006           S01508
     C***********          Z-ADDRRMN      DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT RRMX                       B006           S01508
     C***********RRMX      ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDRRMX      DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********          ELSE                            X005           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*2*******************************************   S01508
     C***********AMOUNT    IFGE RRS2                       B006           S01508
     C***********AMOUNT    MULT RRR2      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*REMAINDER*AFTER*COMMISSION*IS*LESS*START*OF*RANGE**********   S01508
     C***********LEFT      IFLT RRS2                       B005           S01508
     C***********AMOUNT    SUB  RRS2      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT RRMN2                      B007           S01508
     C***********          Z-ADDRRMN2     DTRCM1                          S01508
     C***********          END                             E007           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT RRMX2                      B007           S01508
     C***********RRMX2     ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDRRMX2     DTRCM1                          S01508
     C***********          END                             E007           S01508
     C***********          ELSE                            X006           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*NOT*IN*RANGES****************************************   S01508
     C***********          Z-ADD0         DTRCM1                          S01508
     C***********          END                             E006           S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C***********                                                         S01508
     C***********STRCT     IFEQ '5'                        B004           S01508
     C***********AMOUNT    MULT NNRT      DTRCM1    H                     S01508
     C***********AMOUNT    SUB  DTRCM1    LEFT   130                      S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM****************************   S01508
     C***********DTRCM1    IFLT NNMN                       B005           S01508
     C***********          Z-ADDNNMN      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM****************************   S01508
     C***********DTRCM1    IFGT NNMX                       B005           S01508
     C***********NNMX      ANDNE*ZEROS                             E37264 S01508
     C***********          Z-ADDNNMX      DTRCM1                          S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          END                             E002           S01508
     C***********          END                             E001           S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C***********                                                         S01508
     C****************************************************************    S01508
     C**END*OF*TRANSFER*COMMISSION*DEFAULT*SUBROUTINE******************   S01508
     C********************************************************************
     C/EJECT
     C********************************************************************S01508
     C**                                                                  S01508
     C**   DFTCHG - SUBROUTINE TO CALCULATE DEFAULT CHARGES               S01508
     C**                                                                  S01508
     C**                                                                  S01508
     C           DFTCHG    BEGSR                                          S01508
     C*                                                                   S01508
     C**  Set up subroutine stack name                                    S01508
     C*                                                                   S01508
     C                     ADD  1         O                               S01508
     C                     MOVEL'DFTCHG'  @STK,O                          S01508
     C*                                                                   S01508
     C**  If core feature S01508 is installed, set up parameters for      S01508
     C**  FT0035 to get customer number to be debited the charges         S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   W7CUST                          S01508
     C*                                                                   S01508
     C           S01508    IFEQ 'Y'                                       S01508
     C*                                                                   S01508
     C**  Initialise work fields                                          S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   I#PT1                           S01508
     C                     MOVE *BLANKS   I#PTY1                          S01508
     C                     MOVE *BLANKS   I#PT2                           S01508
     C                     MOVE *BLANKS   I#PTY2                          S01508
     C                     MOVE *BLANKS   I#CCY                           S01508
     C                     MOVE *BLANKS   W0SCUS  6                       S01508
     C                     MOVE *BLANKS   W0FCUS  6                       S01508
     C*                                                                   S01508
     C**  If "charges to the debit of" is entered                         S01508
     C*                                                                   S01508
     C           CDRT      IFNE *BLANK                                    S01508
     C*                                                                   S01508
     C**  Check customer no. of "charges to the debit of" (screen         S01508
     C**   field value)                                                   S01508
     C*                                                                   S01508
     C                     MOVE CDRT      I#PT1                           S01508
     C**********           MOVELCDRO      W0FLD  12                                    S01508 CGL029
     C                     MOVELCDRO      W0FLD  18                                           CGL029
     C           W0FLD     CAT  CDBR      I#PTY1    P                     S01508
     C                     MOVE BJCYCD    I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN   7                       S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG 256                       S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ************   S01508
     C                     MOVEL'*CALL   'W0KEY            * DBERR 42 *   S01508
     C                     Z-ADD42        W0ERNB           ************   S01508
     C                     MOVELERR@,1    W0NARR                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0SCUS                          S01508
     C*                                                                   S01508
     C**  Check customer no. of "charges to the debit of" (previous       S01508
     C**   file field value)                                              S01508
     C*                                                                   S01508
     C           WFCDRT    IFNE *BLANK                                    S01508
     C                     MOVE WFCDRT    I#PT1                           S01508
     C           WFCDRO    CAT  WFCDBR    I#PTY1    P                     S01508
     C                     MOVE BJCYCD    I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN   7                       S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG 256                       S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ************   S01508
     C                     MOVEL'*CALL   'W0KEY            * DBERR 43 *   S01508
     C                     Z-ADD43        W0ERNB           ************   S01508
     C                     MOVELERR@,1    W0NARR                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0FCUS                          S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C**  Check customer no. of the "debit party" (screen field value)    S01508
     C*                                                                   S01508
     C           DRPT      IFNE *BLANK                                    S01508
     C                     MOVE DRPT      I#PT1                           S01508
     C                     MOVELDRPY      W0FLD                           S01508
     C           W0FLD     CAT  DRBR      I#PTY1    P                     S01508
     C                     MOVE DRCY      I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN   7                       S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG 256                       S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ************   S01508
     C                     MOVEL'*CALL   'W0KEY            * DBERR 44 *   S01508
     C                     Z-ADD44        W0ERNB           ************   S01508
     C                     MOVELERR@,1    W0NARR                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0SCUS                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Check customer no. of the "debit party" (previous file          S01508
     C**   field value)                                                   S01508
     C*                                                                   S01508
     C           WFDRPT    IFNE *BLANK                                    S01508
     C                     MOVE WFDRPT    I#PT1                           S01508
     C           WFDRPY    CAT  WFDRBR    I#PTY1    P                     S01508
     C                     MOVE WFDRCY    I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN   7                       S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG 256                       S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ************   S01508
     C                     MOVEL'*CALL   'W0KEY            * DBERR 45 *   S01508
     C                     Z-ADD45        W0ERNB           ************   S01508
     C                     MOVELERR@,1    W0NARR                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0FCUS                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Setup "customer to be debited the charges" field                S01508
     C                     MOVE W0SCUS    W7CUST                          S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Payment type and subtype                                        S01508
     C                     MOVELPYTP      W7PYTP                          S01508
     C                     MOVELPYST      W7PYST                          S01508
     C*                                                                   S01508
     C**  Input currency                                                  S01508
     C*                                                                   S01508
     C                     SELEC                                          S01508
     C*                                                                   S01508
     C           BTCHCY    WHEQ 'B'                                       S01508
     C           SCDRO     ORNE *BLANKS                                   S01508
     C                     MOVELBJCYCD    W7ICCY                          S01508
     C*                                                                   S01508
     C           BTCHCY    WHEQ 'L'                                       S01508
     C                     MOVELBJLCCY    W7ICCY                          S01508
     C*                                                                   125390
     C           BTCHCY    WHEQ 'C'                                       125390
     C                     MOVELDRCY      W7ICCY                          125390
     C*                                                                   S01508
     C           BTCHCY    WHEQ 'F'                                       196947
     C                     MOVELFCHCCY    W7ICCY                          196947
     C*                                                                   196947
     C                     ENDSL                                          S01508
     C*                                                                   S01508
     C**  Charge currency                                                 S01508
     C*                                                                   S01508
     C           SCDRO     IFEQ *BLANKS                                   S01508
     C                     MOVE DRCY      W7CCCY                          S01508
     C                     ELSE                                           S01508
     C                     MOVE BJCYCD    W7CCCY                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Settlement method                                               S01508
     C                     MOVELSTMT      W7STMT                          S01508
     C*                                                                   S01508
     C**  Defaults required                                               S01508
     C                     MOVEL'Y'       W7DFRQ                          S01508
     C*                                                                   S01508
     C**  Charges branch                                                  S01508
     C                     MOVELORBR      W7BRCA                          S01508
     C*                                                                   S01508
     C**  Charge currency amount                                          S01508
     C***********          Z-ADDCQAM      W7CAMT                   S01508 S01494
     C                     EXSR SRDREQ                                    S01494
     C                     Z-ADDD#TAMT    W7CAMT                          S01494
     C*                                                                   S01508
     C**  Pay currency                                                    S01508
     C                     MOVELDRCY      W7PCCY                          S01508
     C*                                                                   S01508
     C**  Transfer Commission type                                        S01508
     C                     MOVELTRCT      W7TRCT                          S01508
     C*                                                                   S01508
     C**  SWIFT priority code                                             S01508
     C           SWPC      IFEQ 1                                         S01508
     C                     MOVEL'U'       W7SWPC                          S01508
     C                     ELSE                                           S01508
     C                     MOVEL'N'       W7SWPC                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Transfer Commission amount                                      S01508
     C                     Z-ADDTRCH      W7TRCD                          S01508
     C                     Z-ADDTRCM      W7TRCH                          S01508
     C*                                                                   S01508
     C**  Collection charge                                               S01508
     C                     Z-ADDCOLH      W7COLD                          S01508
     C                     Z-ADDCOLL      W7COLL                          S01508
     C*                                                                   S01508
     C**  Costs Abroad                                                    S01508
     C                     Z-ADDCSTH      W7CSTD                          S01508
     C                     Z-ADDCSTA      W7CSTA                          S01508
     C*                                                                   S01508
     C**  FX/Change Commission                                            S01508
     C*                                                                   S01508
     C           *IN09     IFEQ '1'                                       S01508
     C                     Z-ADDPDCHCH    W7CHCD                          S01508
     C                     Z-ADDPDCHCM    W7CHCM                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Telex Charge                                                    S01508
     C                     Z-ADD0         W7TXCD                          S01508
     C                     Z-ADD0         W7TXCH                          S01508
     C*                                                                   S01508
     C**  SWIFT Priority charge                                           S01508
     C                     Z-ADD0         W7SPCD                          S01508
     C                     Z-ADD0         W7SPCH                          S01508
     C*                                                                   S01508
     C**  Miscellaneous charge                                            S01508
     C                     Z-ADD0         W7MSCD                          S01508
     C                     Z-ADD0         W7MSCH                          S01508
     C*                                                                   S01508
     C**  Advice Charge                                                   S01508
     C                     Z-ADD0         W7ADCD                          S01508
     C                     Z-ADD0         W7ADCH                          S01508
     C*                                                                   S01508
     C**  Telephone Charge                                                S01508
     C                     Z-ADD0         W7TLCD                          S01508
     C                     Z-ADD0         W7TLCH                          S01508
     C*                                                                   S01508
     C**  Cheque Charge                                                   S01508
     C                     Z-ADD0         W7CQCD                          S01508
     C                     Z-ADD0         W7CQCH                          S01508
     C*                                                                   S01508
     C**  Correspondent's Charge                                          S01508
     C                     Z-ADD0         W7COCD                          S01508
     C                     Z-ADD0         W7COCH                          S01508
     C*                                                                   S01508
     C**  Our deductions                                                  S01508
     C                     Z-ADD0         W7DEDD                          S01508
     C                     Z-ADD0         W7DEDS                          S01508
     C*                                                                   S01508
     C                     MOVEL*BLANKS   W7ACT                           S01508
     C                     MOVEL'CP'      W7ACT                           S01508
     C*                                                                   S01508
     C**  Other currency                                                  S01508
     C                     MOVE PCCY      W7OCCY                          S01508
     C*                                                                   S01508
     C**  Default type                                                    S01508
     C                     MOVE 'DET'     W7DFTT                          S01508
     C*                                                                   CEU006
     C**  Settle Value Date                                               CEU006
     C                     Z-ADDDRVD      W7SLDT                          CEU006
     C*                                                                   CEU006
     C**  Settle Value Date                                               CEU006
     C                     Z-ADDPVDT      W7PVDT                          CEU006
     C*                                                                   CEU006
     C**  Add/Deduct Charges                                              CEU006
     C                     MOVE ' '       W7ADDC                          CEU006
     C/COPY WNCPYSRC,FT0080C040
     C*                                                                   S01508
     C**  Call defaults program                                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0320'               9090               S01508
     C                     PARM *BLANKS   W7RTN   7                       S01508
     C                     PARM           W7ACT   8                       S01508
     C                     PARM           W7DATA                          S01508
     C*                                                                   S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W7RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0320  'W0FILE           ************   S01508
     C                     MOVEL'*CALL   'W0KEY            * DBERR 46 *   S01508
     C                     Z-ADD46        W0ERNB           ************   S01508
     C                     MOVELERR@,1    W0NARR                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C**  Transfer Commission amount                                      S01508
     C                     Z-ADDW7TRCD    TRCH                            S01508
     C                     Z-ADDW7TRCH    TRCM                            S01508
     C*                                                                   S01508
     C**  Collection charge                                               S01508
     C                     Z-ADDW7COLD    COLH                            S01508
     C                     Z-ADDW7COLL    COLL                            S01508
     C*                                                                   S01508
     C**  Costs Abroad                                                    S01508
     C                     Z-ADDW7CSTD    CSTH                            S01508
     C                     Z-ADDW7CSTA    CSTA                            S01508
     C*                                                                   S01508
     C**  FX/Change Commission                                            S01508
     C*                                                                   S01508
     C           *IN09     IFEQ '1'                                       S01508
     C                     Z-ADDW7CHCD    PDCHCH                          S01508
     C                     Z-ADDW7CHCM    PDCHCM                          S01508
     C                     END                                            S01508
     C*If FX/change commission has been blanked-out by user do not        140645
     C*default value again.                                               140645
     C           CEU006    IFEQ 'Y'                                       140645
     C           SCHCM     IFEQ *BLANKS                                   140645
     C           W#FCYC    ANDEQ'Y'                                       140645
     C           SDRCY     ANDEQW#SVCY                                    140645
     C                     Z-ADD0         PDCHCH                          140645
     C                     Z-ADD0         PDCHCM                          140645
     C                     END                                            140645
     C*Flag field to indicate that FX/change commission has been defaulted140645
     C                     MOVE 'Y'       W#FCYC  1                       140645
     C                     MOVE SDRCY     W#SVCY  3                       140645
     C                     ENDIF                                          140645
     C*                                                                   S01508
     C**  Unwind subroutine stack name                                    S01508
     C*                                                                   S01508
     C           EXCDFT    TAG                                            S01508
     C                     MOVEA*BLANKS   @STK,O                          S01508
     C                     SUB  1         O                               S01508
     C*                                                                   S01508
     CSR                   ENDSR                                          S01508
     C********************************************************************S01508
     C**  END OF CALCULATE DEFAULT CHARGES SUBROUTINE                     S01508
     C********************************************************************S01508
     C/EJECT
     C********************************************************************
     C**
     C*    WRITHI - SR TO WRITE HEADER TO DATABASE
     C**
     C           WRITHI    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITHI'  @STK,O                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    OBTAIN NEXT SEQUENCE NUMBER AND SET UP PAYMENT REFERENCE
     C**
     C           *LOCK     IN   CQPAYD
     C                     Z-ADDSEQNO     SEQNCE  40
     C                     ADD  1         SEQNO
     C                     OUT  CQPAYD
     C*
     C                     Z-ADDSEQNCE    SEQNOX
     C                     Z-ADDSTMT      STTPPG
     C                     MOVE PREFPG    PREF
     C**
     C*    SETUP VARIOUS DEFAULT FIELDS INCLUDING DAF FIELDS
     C**
     C                     MOVE 'D'       RECI
     C                     Z-ADD0         CQSQ
     C           PCCYDP    ADD  1         W       10
     C           TOTR      DIV  FCTR,W    TOTRD
     C                     Z-ADD0         TOTD
     C                     Z-ADD0         TOTDD
     C           TOTR      SUB  TOTD      DIFF
     C           DIFF      DIV  FCTR,W    DIFFD
     C                     Z-ADDPVDT      DAFD0
     C                     EXSR DAFDAT
     C                     Z-ADDDAFD1     PVDTD1
     C                     Z-ADDDAFD2     PVDTD2
     C                     Z-ADDDAFD3     PVDTD3
      *
     C* CALCULATE BASE CURRENCY EQUIV
      *
     C           PCCYDP    SUB  BCCYDP    N       10
     C                     ADD  4         N
      *
     C           PCCYMD    IFEQ 0                          B001
     C           PCCYSP    MULT POWER,N   WK159     H
     C           PRRM      DIV  WK159     PBCQ      H
     C                     ELSE                            X001
     C           PCCYSP    DIV  POWER,N   WK159  159H
     C           PRRM      MULT WK159     PBCQ      H
     C                     END                             E001
      *
     C           PRRM      DIV  FCTR,W    PRRMD
     C           PCCYDP    ADD  1         W
     C           COCH      DIV  FCTR,W    COCHD
     C           DEDS      DIV  FCTR,W    DEDSD
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'I'       CHTP
     C*********************Z-ADDRUND      OEDT                            S01194
     C                     Z-ADDBJRDNB    OEDT                            S01194
     C                     Z-ADDOEDT1     OEDTD1
     C                     Z-ADDOEDT2     OEDTD2
     C                     Z-ADDOEDT3     OEDTD3
     C                     TIME           LCHT
     C                     Z-ADD0         NCSQ
     C*
     C* Clear non-header fields
     C*
     C                     MOVE *BLANKS   RCRT
     C                     MOVE *BLANKS   RCO1
     C                     MOVE *BLANKS   RCO2
     C                     MOVE *BLANKS   RCO3
     C                     MOVE *BLANKS   RCO4
     C                     MOVE *BLANKS   RCO5
     C                     MOVE *BLANKS   ACBT
     C                     MOVE *BLANKS   ACB1
     C                     MOVE *BLANKS   ACB2
     C                     MOVE *BLANKS   ACB3
     C                     MOVE *BLANKS   ACB4
     C                     MOVE *BLANKS   ACB5
     C                     MOVE *BLANKS   DCH1
     C                     MOVE *BLANKS   DCH2
     C                     MOVE *BLANKS   DCH3
     C                     MOVE *BLANKS   DCH4
     C                     MOVE *BLANKS   DCH5
     C                     MOVE *BLANKS   DCH6
     C                     MOVE *BLANKS   DAA1
     C                     MOVE *BLANKS   DAA2
     C                     MOVE *BLANKS   DAA3
     C                     MOVE *BLANKS   DAA4
     C                     MOVE *BLANKS   DAA5
     C                     MOVE *BLANKS   DAA6
     C                     MOVE *BLANKS   RBKR
     C                     MOVE *BLANKS   BBI1
     C                     MOVE *BLANKS   BBI2
     C                     MOVE *BLANKS   BBI3
     C                     MOVE *BLANKS   BBI4
     C                     MOVE *BLANKS   BBI5
     C                     MOVE *BLANKS   BBI6
     C                     MOVE *BLANKS   IACG
     C                     MOVE *BLANKS   PACG
      *                                                                   033361
      * Initialise RACG to blanks for write to CQPACDD                    033361
      * Error in conversion of names                                      033361
      *                                                                   033361
     C                     MOVEL*BLANKS   RACG                            033361
     C                     MOVE *BLANKS   CRMG
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C                     MOVE *BLANKS   LVIN
     C                     MOVE *BLANKS   CQIN
     C                     MOVE *BLANKS   PRIN
     C*********************MOVE *BLANKS   MT100                           E32481
     C                     MOVE *BLANKS   MT202
     C                     MOVE *BLANKS   MT400
     C*********************MOVE *BLANKS   MT200                           E32481
     C                     MOVE *BLANKS   TXIN
     C                     MOVE *BLANKS   BAIN
     C                     MOVE *BLANKS   ISIN
     C                     MOVE *BLANKS   MPYI
      *
     C* ZEROISE REVERSED AMOUNT
      *
     C                     Z-ADD0         CQRV
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C                     MOVE 'I'       ACTDH
     C**
     C*    WRITE RECORD, MONITOR FOR UPDATED BY ANOTHER WS
     C**
     C                     Z-ADDPVDT      CPVDT   50
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR1 10
     C*
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF   1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP   6                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD1         WX      20                                          CSD015
     C                     Z-ADD2         WY      20                                          CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP   6                                           CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     Z-ADD4         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     WRITECQPACDDF               78
      *
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWHI
     C                     END                             ** E01
      *                                                                   056031
      *  Generate Shadow Postings for Insert Credit Instructions          056031
      *                                                                   056031
     C                     Z-SUBPRRM      ##CRAM                          056031
     C                     EXSR SRADCR                                    056031
      *                                                                   056031
      *  Update database with posting changes                             056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C**
     C*    SAVE LAST CHANGE 'STAMP' FOR LATER AMEND
     C**
     C                     Z-ADDLCHT      LCHTHD  60
     C                     Z-ADDLCD       LCDHD   50
     C                     MOVE CHTP      CHTPHD  1
     C**
     C*    UPDATE TRAILER
     C**
     C           1         CHAINCQPACZZ              99
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVE 'MISSING 'ERMSG1
     C                     MOVE 'TRAILER 'ERMSG2
     C                     MOVE ERRMSG    WDBKEY             ************
    C                     Z-ADD10        WDBASE             * DBERR 10 *
     C                     MOVEL'CQPAC'   WDBFIL             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C*
     C                     ADD  1         NORE1
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     MOVE PRRM      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     UPDATCQPACZZF
     C*
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************         Z-ADDPRRM      AMOUNT                          056031
     C************         EXSR MEMOSH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01         056031
     C************         Z-ADDPRRM      AMOUNT                          056031
     C************         EXSR OLPOSH                                    056031
     C************         Z-ADDPRRM      AMOUNT                          056031
     C************         EXSR PRONOH                                    056031
     C************         END                             ** E01         056031
     C*
     C           *IN78     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C**
     C*    IF NO ERROR SETUP & PERMIT PREVIOUS PAYMENT REFERENCE FIELDS
     C*      ON NEXT INITIAL SCREEN
     C**
     C                     MOVE PREF      PREF01
     C                     MOVE '0'       *IN77
     C                     END                             ** E01
      *                                                                   056031
     C           ENDWHI    TAG                                            056031
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*
     C***********ENDWHI    ENDSR                                          056031
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    WRITDI - SR TO WRITE DETAIL TO DATABASE
     C**
     C           WRITDI    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITDI'  @STK,O                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    OBTAIN NEXT CHEQUE SEQUENCE NUMBER AND UPDATE HEADER
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
    C*
    C           *IN99     IFEQ '1'                        ** B01
    C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD11        WDBASE             * DBERR 11 *
    C                     MOVELCQPKEY    WDBKEY             ************
    C                     EXSR ENDPGM
    C                     END                             ** E01
     C*
     C           AUIN      IFEQ 'Y'                        ** B01
    C           RECI      ORNE 'D'
     C                     ROLBK
    C                     MOVE '1'       *IN78
    C                     GOTO ENDWDI
     C                     END                             ** E01
     C*
     C                     ADD  1         NCSQ
     C                     ADD  CQAM      TOTD
     C           PCCYDP    ADD  1         W
     C           TOTD      DIV  FCTR,W    TOTDD
     C           TOTR      SUB  TOTD      DIFF
     C           DIFF      DIV  FCTR,W    DIFFD
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     TIME           LCHT
     C*********************MOVE 'A'       CHTP                            004120
     C*
     C* CALL WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S           S01241
     C* FT0080DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF         S01241
     C* CORE PGM (FT0080) AND RETURN CODE (7A, BUT BLANK HERE).           S01241
     C*                                                                   S01241
     C********** BGL5ST    IFEQ 'Y'                                 S01241S01251
      *                                                                                       CER001
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE DRPT      ##DRPT                                              CER001
     C                     MOVELDRPY      ##DRPY                                              CER001
     C                     Z-ADDCQAM      ##CQAM                                              CER001
     C                     MOVELDRCY      ##DRCY                                              CER001
     C                     MOVELDRBR      ##DRBR                                              CER001
      *                                                                                       CER001
     C                     MOVELPREF      PREF1                                               CER001
     C                     MOVE SCQSQ     SQCQ                                                CER001
      *                                                                                       CER001
     C                     CALL 'FT0080A'                                                     CER001
     C                     PARM SACTD     #ACTN   1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           RTNCD   7                                           CER001
     C                     PARM           SPARE 256                                           CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           RTNCD     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      ** Allocate dataarea to blanks                                                          CER001
      *                                                                                       CER001
     C                     EXSR DALLOC                                                        CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** Otherwise, F12 has been pressed so redisplay screen                                  CER001
      *                                                                                       CER001
     C           RTNCDE    IFEQ 'USR0790'                                                     CER001
     C                     MOVE *OFF      *IN80                                               CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           BGWDPR    IFEQ 'Y'                                       S01251
     C*                                                                   S01241
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,FT0080MOV4                                           S01241
      *                                                                                       CER049
      ** Payment reference is passed onto Data to be passed onto                              CER049
      ** window controller.                                                                   CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN                                              CER049
     C**********           MOVE *ZEROS    U#LNRF                                       CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF                                              CLE148
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *ZEROS    U#FACT                                              CER049
     C                     MOVE *ZEROS    U#FCNO                                              CER049
     C                     MOVE *ZEROS    U#FSEQ                                              CER049
     C                     MOVE *ZEROS    U#ORED                                              CER049
     C                     MOVE *ZEROS    U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *ZEROS    U#ACOD                                              CER049
     C                     MOVE *ZEROS    U#ACSQ                                              CER049
     C                     MOVE SPREF     U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE TRCH      U#AMNT                                              CER049
     C                     MOVE PCCY      U#TCCY                                              CER049
     C                     MOVE PVDT      U#VDAT                                              CER049
      *                                                                                       CER049
      ** Initialise work fields  for account determination                                    CER049
      *                                                                                       CER049
     C                     MOVEL*BLANKS   @@TYP1                                              CER049
     C                     MOVEL*BLANKS   @@ACC1                                              CER049
     C                     MOVEL*BLANKS   @@TYP2                                              CER049
     C                     MOVEL*BLANKS   @@ACC2                                              CER049
     C                     MOVEL*BLANKS   @@CCY                                               CER049
      *                                                                                       CER049
      ** If "charges to the debit of" is entered                                              CER049
      *                                                                                       CER049
     C           CDRT      IFNE *BLANK                                                        CER049
      *                                                                                       CER049
      ** Check customer no. of "charges to the debit of"                                      CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C                     MOVELCDRT      @@TYP1                                              CER049
     C                     MOVELCDRO      W0FLD                                               CER049
     C           W0FLD     CAT  CDBR      @@ACC1    P                                         CER049
     C                     MOVELBJCYCD    @@CCY                                               CER049
      *                                                                                       CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** Check customer no. of the "credit party"                                             CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C           DRPT      IFNE *BLANK                                                        CER049
     C                     MOVELDRPT      @@TYP1                                              CER049
     C                     MOVELDRPY      W0FLD                                               CER049
     C           W0FLD     CAT  DRBR      @@ACC1    P                                         CER049
     C                     MOVELDRCY      @@CCY                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If Stamp Tax is switched on, call the Stamp Tax details screen.                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'GL008102'                                                    CER049
     C                     PARM SACTD     #ACTN                                               CER049
     C                     PARM           DATA                                                CER049
     C                     PARM *BLANKS   RTNCDE                                              CER049
      *                                                                                       CER049
      ** Process return code.                                                                 CER049
      *                                                                                       CER049
     C                     SELEC                                                              CER049
      *                                                                                       CER049
      ** If error                                                                             CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'ERROR  '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
     C                     GOTO ENDWDI                                                      AR850937
      *                                                                                       CER049
      ** If F3 pressed in window screen, exit                                                 CER049
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'EXIT   '                                                     CER049
     C                     MOVEL'1'       *INKC                                               CER049
     C                     GOTO ENDWDI                                                      AR850937
      *                                                                                       CER049
     C           RTNCDE    WHEQ 'PREV   '                                                   AR850937
     C                     MOVE '0'       *IN80                                             AR850937
     C                     GOTO ENDWDI                                                      AR850937
     C                     ENDSL                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   S01241
     C                     MOVE SACTD     #ACTN                           S01241
     C                     MOVE *BLANKS   RTNCDE                          S01241
     C                     MOVE *BLANKS   ##CMD                           S01241
     C                     MOVEL'FT0080'  ##PGM                           S01241
     C                     CALL 'WN0010'                                  S01241
     C                     PARM           ##PGM                           S01241
     C                     PARM           ##CMD                           S01241
     C                     PARM           #ACTN                           S01241
     C                     PARM           DATA                            S01241
     C**********           PARM           RTNCDE                    S01241S01252
     C                     PARM *BLANKS   RTNCDE                          S01252
     C                     PARM           SPARE 256                       S01252
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP19                                           S01408
     C*                                                                   S01408
     C                     END                                            S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP20                                           S01408
     C*                                                                   S01408
     C*                                                                   S01241
     C           RTNCDE    IFEQ *BLANKS                                   S01241
     C********** BGL5ST    ORNE 'Y'                                 S01241S01251
     C           BGWDPR    ORNE 'Y'                                       S01251
     C                     UPDATCQPACDDF               78
     C                     ELSE                                           S01241
     C                     ROLBK                                          S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP21                                           S01408
     C*                                                                   S01408
     C                     GOTO ENDWDI                                    S01241
     C                     END                                            S01241
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0080CP22                                           S01408
     C*                                                                   S01408
     C*
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDI
     C                     END                             ** E01
     C**
     C/COPY WNCPYSRC,FT0080C079
      *                                                                                       CER049
      ** If Cheque is liable to Stamp Tax                                                     CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
      *                                                                                       CER049
      ** Find default stamp Stamp Tax Rate                                                    CER049
      *                                                                                       CER049
     C                     MOVE PVDT      U#DATE  50                                          CER049
     C                     MOVE *BLANKS   U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** SD008140 will return the Tax Rate to be used to calculate the                        CER049
      ** Stamp Tax and the Stamp Tax Currency                                                 CER049
      *                                                                                       CER049
     C                     CALL 'SD008140'                                                    CER049
     C                     PARM           U#DATE                                              CER049
     C                     PARM           U#ORGN                                              CER049
     C                     PARM           U#TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** If there is a default Tax Rate for the module use this,                              CER049
      ** otherwise use the ICD control Tax Rate.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Calculate Stamp Tax Rate on Entry CCY amount and File CCY                            CER049
      ** amount                                                                               CER049
      *                                                                                       CER049
     C           TRCH      MULT U#TAXR    CSTH                                                CER049
     C           TRCM      MULT U#TAXR    CSTA                                                CER049
      *                                                                                       CER049
      ** Move 'N' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'N'       PDVAT3                                              CER049
     C                     MOVE 'N'       PDVAT1                                              CER049
      *                                                                                       CER049
      ** Get rid of VAT on Stamp Tax relevant amounts that has been calculated                CER049
      ** earlier in FT0080.                                                                   CER049
      *                                                                                       CER049
     C                     SUB  #PDVAT    PDVATT                                              CER049
     C                     SUB  #PDVAH    PDVATH                                              CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQPACQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN 10                                           CER049
     C**********           MOVE *BLANKS   U#LNRF  60                                   CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF  6                                           CLE148
     C                     MOVE *BLANKS   U#FCNM  6                                           CER049
     C                     MOVE *BLANKS   U#FACT  30                                          CER049
     C                     MOVE *BLANKS   U#FCNO  20                                          CER049
     C                     MOVE *BLANKS   U#FSEQ  20                                          CER049
     C                     MOVE *BLANKS   U#ORED  50                                          CER049
     C                     MOVE *BLANKS   U#DLNO  60                                          CER049
     C                     MOVE *BLANKS   U#TDRF  6                                           CER049
     C                     MOVE *BLANKS   U#BRCA  3                                           CER049
     C                     MOVE *BLANKS   U#CNUM  6                                           CER049
     C                     MOVE *BLANKS   U#CCY   3                                           CER049
     C                     MOVE *BLANKS   U#ACOD 100                                          CER049
     C                     MOVE *BLANKS   U#ACSQ  20                                          CER049
     C                     MOVE PREF      U#PREF 15                                           CER049
     C                     MOVE SCQSQ     U#CQSQ  20                                          CER049
     C                     MOVE *BLANKS   U#PBRC  3                                           CER049
     C                     MOVE *BLANKS   U#PSSH 10                                           CER049
     C                     MOVE *BLANKS   U#PCPT  6                                           CER049
     C                     MOVE *BLANKS   U#PDUD  50                                          CER049
     C                     MOVE *BLANKS   U#PEVT  2                                           CER049
      *                                                                                       CER049
     C           KLSTAX    KLIST                                                              CER049
     C                     KFLD           U#PREF                                              CER049
     C                     KFLD           U#CQSQ                                              CER049
      *                                                                                       CER049
     C           KLSTXD    KLIST                                                              CER049
     C                     KFLD           U#ORGN                                              CER049
     C                     KFLD           U#TYPE                                              CER049
     C                     KFLD           U#LNRF                                              CER049
     C                     KFLD           U#FCNM                                              CER049
     C                     KFLD           U#FACT                                              CER049
     C                     KFLD           U#FCNO                                              CER049
     C                     KFLD           U#FSEQ                                              CER049
     C                     KFLD           U#ORED                                              CER049
     C                     KFLD           U#DLNO                                              CER049
     C                     KFLD           U#TDRF                                              CER049
     C                     KFLD           U#BRCA                                              CER049
     C                     KFLD           U#CNUM                                              CER049
     C                     KFLD           U#CCY                                               CER049
     C                     KFLD           U#ACOD                                              CER049
     C                     KFLD           U#ACSQ                                              CER049
     C                     KFLD           U#PREF                                              CER049
     C                     KFLD           U#CQSQ                                              CER049
     C                     KFLD           U#PBRC                                              CER049
     C                     KFLD           U#PSSH                                              CER049
     C                     KFLD           U#PCPT                                              CER049
     C                     KFLD           U#PDUD                                              CER049
     C                     KFLD           U#PEVT                                              CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQPACQL0             80                                       CER049
     C                     MOVE CSTH      QPSTAF                                              CER049
     C                     UPDATCQPACQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'N'                                                           CER049
      *                                                                                       CER049
     C                     MOVE *ZEROS    CSTH                                                CER049
     C                     MOVE *ZEROS    CSTA                                                CER049
      *                                                                                       CER049
      ** Move 'Y' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'Y'       PDVAT3                                              CER049
     C                     MOVE 'N'       PDVAT1                                              CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQPACQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'I/OCHEQ' U#ORGN                                              CER049
     C                     MOVE *BLANKS   U#LNRF                                              CER049
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *BLANKS   U#FACT                                              CER049
     C                     MOVE *BLANKS   U#FCNO                                              CER049
     C                     MOVE *BLANKS   U#FSEQ                                              CER049
     C                     MOVE *BLANKS   U#ORED                                              CER049
     C                     MOVE *BLANKS   U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *BLANKS   U#ACOD                                              CER049
     C                     MOVE *BLANKS   U#ACSQ                                              CER049
     C                     MOVE PREF      U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE *BLANKS   U#PBRC                                              CER049
     C                     MOVE *BLANKS   U#PSSH                                              CER049
     C                     MOVE *BLANKS   U#PCPT                                              CER049
     C                     MOVE *BLANKS   U#PDUD                                              CER049
     C                     MOVE *BLANKS   U#PEVT                                              CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQPACQL0             80                                       CER049
     C                     MOVE *ZEROS    QPSTAF                                              CER049
     C                     UPDATCQPACQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
     C           U#STAX    OREQ 'N'                                                           CER049
      *                                                                                       CER049
     C           KLSTXD    CHAINSDSTMDL0             85                                       CER049
     C           *IN85     IFEQ *OFF                                                          CER049
     C                     MOVEL'CHEQP'   T2KEY                                               CER049
     C                     MOVE QPPREF    T2PREF                                              CER049
     C                     MOVE QPCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QPTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE PCCY      T2ECCY                                              CER049
     C                     MOVE QPSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'A'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
     C                     UPDAT@STMDV0                                                       CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'CHEQP'   T2KEY                                               CER049
     C                     MOVE QPPREF    T2PREF                                              CER049
     C                     MOVE QPCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QPTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE PCCY      T2ECCY                                              CER049
     C                     MOVE QPSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'I'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
      *                                                                                       CER049
      ** Set debit account                                                                    CER049
      *                                                                                       CER049
     C                     MOVE *BLANKS   T2DBRC                                              CER049
     C                     MOVE *BLANKS   T2DCST                                              CER049
     C                     MOVE *BLANKS   T2DCCY                                              CER049
     C                     MOVE *BLANKS   T2DACD                                              CER049
     C                     MOVE *BLANKS   T2DASQ                                              CER049
     C                     CLEART2TXRB                                                        CER049
     C                     WRITE@STMDV0                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C*    SETUP VARIOUS DEFAULT FIELDS INCLUDING DAF FIELDS
     C**
     C                     MOVE 'D'       RECI
     C                     Z-ADDNCSQ      CQSQ
     C           CQAM      DIV  FCTR,W    CQAMD
     C*
     C* CALCULATE BASE CURRENCY EQUIV
     C*
     C           PCCYDP    SUB  BCCYDP    N       10
     C                     ADD  4         N
     C*
     C           PCCYMD    IFEQ 0                          B001
     C           PCCYSP    MULT POWER,N   WK159     H
     C           CQAM      DIV  WK159     SBCQ      H
     C                     ELSE                            X001
     C           PCCYSP    DIV  POWER,N   WK159  159H
     C           CQAM      MULT WK159     SBCQ      H
     C                     END                             E001
     C*
     C                     MOVE PCCY      CURR1   3
     C                     MOVE DRCY      CURR2   3
     C                     Z-ADDCQAM      CQAMNT 130
     C                     Z-ADDMDINNW    MDINN   10
     C                     EXSR CURRY
     C/COPY WNCPYSRC,FT0080C059
     C*
     C                     Z-ADDDRVD      DAFD0
     C                     EXSR DAFDAT
     C                     MOVE DAFD1     DRVDD1
     C                     MOVE DAFD2     DRVDD2
     C                     MOVE DAFD3     DRVDD3
     C*
     C           BCCYDP    ADD  1         W
     C           TRCM      DIV  FCTR,W    TRCMD
     C           CSTA      DIV  FCTR,W    CSTAD
     C           COLL      DIV  FCTR,W    COLLD
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'I'       CHTP
     C*********************Z-ADDRUND      OEDT                            S01194
     C                     Z-ADDBJRDNB    OEDT                            S01194
     C                     Z-ADDOEDT1     OEDTD1
     C                     Z-ADDOEDT3     OEDTD3
     C                     Z-ADDOEDT2     OEDTD2
     C                     TIME           LCHT
     C*
     C                     MOVE *BLANKS   IACG
     C                     MOVE *BLANKS   PACG
     C                     MOVE *BLANKS   DRAG
     C                     MOVE *BLANKS   DMSG
     C                     MOVE *BLANKS   ADIN
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     MOVE 'I'       ACTDD
     C*
     C* MOVE MULTIPLY/DIVIDE INDICATOR IN
     C*
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     MOVE P#MDIN    MDIN                            CEU006
     C                     ELSE                                           CEU006
     C                     MOVE MDINNW    MDIN
     C                     ENDIF                                          CEU006
     C**
     C*    WRITE RECORD, MONITOR FOR UPDATED BY ANOTHER WS
     C**
     C                     Z-ADDDRVD      DDRVD   50
     C**
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C**********           MOVE USRID     INUSR2 10                       E36921
     C                     MOVE USRID     INUSR1 10                       E36921
      *                                                                   CAC001
      **  Setup margin information details                                CAC001
      *                                                                   CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     MOVE WOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQPACDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KLCWHT    CHAINSDCWHTL1             02                                       CSD015
      *                                                                                       CSD015
     C           *IN02     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed Flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Remitting Bank                                                                       CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     Z-ADD2         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Sender's Correspondence                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     Z-ADD4         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver's Correspondent                                                             CSD015
      *                                                                                       CSD015
     C           RCO1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRCO1      PINP1                                               CSD015
     C                     MOVELRCO2      PINP2                                               CSD015
     C                     MOVELRCO3      PINP3                                               CSD015
     C                     MOVELRCO4      PINP4                                               CSD015
     C                     MOVELRCO5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD5         WX                                                  CSD015
     C                     Z-ADD6         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank                                                                    CSD015
      *                                                                                       CSD015
     C           ACB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELACB1      PINP1                                               CSD015
     C                     MOVELACB2      PINP2                                               CSD015
     C                     MOVELACB3      PINP3                                               CSD015
     C                     MOVELACB4      PINP4                                               CSD015
     C                     MOVELACB5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD7         WX                                                  CSD015
     C                     Z-ADD8         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Debit Party                                                                          CSD015
      *                                                                                       CSD015
     C***********DRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           DRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           DRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELDRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELDRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELDRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Charges to the Debit of account                                                      CSD015
      *                                                                                       CSD015
     C***********CDRO      IFNE *ZEROS                                                 CSD015 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CDRT      IFEQ 'N'                                                           CSD015
     C                     MOVELCDRO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCDRO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQPADDL1                                                      CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C           *IN03     DOWEQ*OFF                                                          CSD015
     C           WCCQSQ    ANDNECQSQ                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Other Debit Party                                                                    CSD015
      *                                                                                       CSD015
     C***********WCDRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCDRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCDRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCDRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCDRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCDRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Other Charges to the Debit of account                                                CSD015
      *                                                                                       CSD015
     C***********WCCDRO    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCCDRO    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCCDRT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCCDRO    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCCDRO    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Proceed to insert the detail transaction                                             CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
      *                                                                                       CSD015
      ** Get Details of Counterparties                                                        CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Format 2nd Paramater                                                                 CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
     C***********DRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           DRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           DRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELDRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELDRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELDRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C***********CDRO      IFNE *ZEROS                                                 CSD015 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CDRT      IFEQ 'N'                                                           CSD015
     C                     MOVELCDRO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCDRO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CGL029
     C                     Z-ADD*ZEROS    DRPYQQ                                              CGL029
     C*                                                                   CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVELSEREFR    CPRRAT                          CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
     C*
     C                     WRITECQPADDDF               78
     C*
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDI
     C                     END                             ** E01
      *Reset indicator to default FX/Change Commission                    140645
     C/COPY WNCPYSRC,FT0080C037
     C                     MOVE ' '       W#FCYC                          140645
      *                                                                   056031
      * Calculate Debit currency equivalent                               056031
      *                                                                   056031
     C                     EXSR SRDREQ                                    056031
      *                                                                   056031
      *  Generate Shadow Postings for Posting Debit Instructions          056031
      *                                                                   056031
     C                     Z-ADDD#TAMT    ##DRAM                          056031
     C/COPY WNCPYSRC,FT0080C091
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  If Charges to the Debit are entered, process as well             056031
      *                                                                   056031
     C***********CDRO      IFNE 0                                                      056031 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C**********           Z-ADDTRCH      W#AMT  150                                   056031 237563
     C********** TRCH      ADD  PDVATH    W#AMT                                               237563
     C           TRCH      ADD  PDVATH    W#AMT  150                                   237563 CPK025
     C                     ADD  COLH      W#AMT                           056031              CPK025
     C                     ADD  CSTH      W#AMT                           056031
     C                     ADD  PDCHCH    W#AMT                           S01494
     C                     ELSE                                                               237563
     C           TRCM      ADD  PDCHCM    W#AMT                                               237563
     C                     ADD  COLL      W#AMT                                               237563
     C                     ADD  CSTA      W#AMT                                               237563
     C                     ADD  PDVATT    W#AMT                                               237563
     C                     END                                                                237563
      *                                                                                       237563
     C           W#AMT     IFNE 0                                                             237563
     C/COPY WNCPYSRC,FT0080C092
     C                     Z-ADDW#AMT     ##CDAM                          056031
     C                     EXSR SRADCD                                    056031
     C                     END                                            056031
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C**
     C*    UPDATE TRAILER
     C**
     C           1         CHAINCQPADZZ              99
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVE 'MISSING 'ERMSG1
     C                     MOVE 'TRAILER 'ERMSG2
     C                     MOVE ERRMSG    WDBKEY             ************
    C                     Z-ADD12        WDBASE             * DBERR 12 *
     C                     MOVEL'CQPAC'   WDBFIL             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C*
     C                     ADD  1         NORE1
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     MOVE CQAM      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     UPDATCQPADZZF
      ************                                                        056031
      ************  Remove PRONO, OLPOS, MEMOS                            056031
      ************                                                        056031
     C************                                                        056031
     C*****CALCULATE THE DEBIT CCY EQUIV. OF THE CHEQUE AMOUNT IF NEEDED  056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C***********DLIND     OREQ 'Y'                                       056031
     C************                                                        056031
     C*********************MOVE 'B'       CFLAG                           E29826
     C*********************EXSR GETCCY                                    E29826
     C*********************Z-ADDPCCYSP    XSPOT1                          E29826
     C*********************Z-ADDPCCYMD    XMDIN1                          E29826
     C*********************Z-ADDPCCYDP    XCDP1                           E29826
     C*********************Z-ADDDRCYSP    XSPOT2                          E29826
     C*********************Z-ADDDRCYMD    XMDIN2                          E29826
     C*********************Z-ADDDRCYDP    XCDP2                           E29826
     C*********************Z-ADDCQAM      XAMNT1                          E29826
     C**CONVERT*USING CROSS RATE                                          056031
     C************                                                        056031
     C***********PCCYDP    SUB  DRCYDP    N       10                      056031
     C************         ADD  4         N                               056031
     C**ERROR*FIX*IF*ONE*CURRENCY*IS*BASE*******                          S01194
     C***********DRCY******IFEQ BCCY                                      S01194
     C***********MDINNW    IFEQ 1                          B002           056031
     C***********RATENW    DIV  POWER,N   WK159  159H                     056031
     C***********CQAM      MULT WK159     CQAMEQ    H                     056031
     C************         ELSE                            X002           056031
     C***********RATENW    MULT POWER,N   WK159  159H                     056031
     C***********CQAM      DIV  WK159     CQAMEQ    H                     056031
     C************         END                             E002           056031
     C*********************ELSE                                           E29826
     C***********MDINNW****IFEQ 0                          B002           E29826
     C***********RATENW****DIV  POWER,N   WK159  159H                     E29826
     C***********CQAM******MULT WK159     CQAMEQ    H                     E29826
     C*********************ELSE                            X002           E29826
     C***********RATENW****MULT POWER,N   WK159  159H                     E29826
     C***********CQAM******DIV  WK159     CQAMEQ    H                     E29826
     C*********************END                             E002           E29826
     C*********************END                                            E29826
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************         Z-ADDCQAMEQ    AMOUNT                          056031
     C************         EXSR MEMOSD                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01         056031
     C************         Z-ADDCQAMEQ    AMOUNT                          056031
     C************         EXSR OLPOSD                                    056031
     C************         EXSR PRONOD                                    056031
     C************         END                             ** E01         056031
     C************                                                  035397056031
     C**UPDATE*PRONO, MEMOS, OLPOS and RSACMTD if CDRO id entered   035397056031
     C************                                                  035397056031
     C***********CDRO      IFNE 0                                   035397056031
     C************                                                  035397056031
     C**MOVE*ALL*CDRO RELATED FIELDS INTO THE EQUIVALENT DEBIT PARTY035397056031
     C**FIELDS*TO*ENABLE THE USE OF THE STANDARD MEMOS,PRONO+OLPOS  035397056031
     C**UPDATE*SUBROUTINES. RESTORE ORIGINAL VALUES AFTER USE       035397056031
     C************LIKE     DEFN DRPY      DRPYOL                    035397056031
     C************LIKE     DEFN DRBR      DRBROL                    035397056031
     C************LIKE     DEFN DRPT      DRPTOL                    035397056031
     C************LIKE     DEFN BJCYCD    BCCYOL                    035397056031
     C************         MOVE DRPY      DRPYOL                    035397056031
     C************         MOVE DRBR      DRBROL                    035397056031
     C************         MOVE DRPT      DRPTOL                    035397056031
     C************         MOVE DRCY      DRCYOL                    035397056031
     C************                                                  035397056031
     C************         Z-ADDTRCH      AMOUNT                    035397056031
     C************         ADD  COLH      AMOUNT                    035397056031
     C************         ADD  CSTH      AMOUNT                    035397056031
     C************         MOVE CDRO      DRPY                      035397056031
     C************         MOVE CDBR      DRBR                      035397056031
     C************         MOVE CDRT      DRPT                      035397056031
     C************         MOVE BJCYCD    DRCY                      035397056031
     C************                                                  035397056031
     C***********RTIND     IFEQ 'Y'                        ** B01   035397056031
     C***********REIND     OREQ 'Y'                                 035397056031
     C************         EXSR MEMOSD                              035397056031
     C************         END                             ** E01   035397056031
     C************                                                  035397056031
     C***********DLIND     IFEQ 'Y'                        ** B01   035397056031
     C************         EXSR OLPOSD                              035397056031
     C************         EXSR PRONOD                              035397056031
     C************         END                             ** E01   035397056031
     C************                                                  035397056031
     C************         MOVE DRPYOL    DRPY                      035397056031
     C************         MOVE DRBROL    DRBR                      035397056031
     C************         MOVE DRPTOL    DRPT                      035397056031
     C************         MOVE DRCYOL    DRCY                      035397056031
     C************                                                  035397056031
     C************         END                                      035397056031
     C*
     C           *INLR     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C                     END                             ** E01
      *                                                                   056031
     C           ENDWDI    TAG                                            056031
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*
     C***********ENDWDI    ENDSR                                          056031
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    WRITHA - SR TO UPDATE HEADER ON DATABASE
     C**
     C           WRITHA    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITHA'  @STK,O                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    SAVE CURRENT VALUES OF FIELDS
     C**
     C                     MOVE SAVHED    SAVEH1
     C                     Z-ADDPRRM      PRRMNW
     C**
     C*    ACCESS HEADER RECORD TO SEE IF UPDATED
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
     C***        CQPACK    CHAINCQPAC                99
     C*
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD13        WDBASE             * DBERR 13 *
     C                     MOVELCQPKEY    WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C**
     C*    SEE IF RECORD HAS CHANGED
     C**
     C           LCHT      IFNE LCHTHD                     ** B01
     C           LCD       ORNE LCDHD
     C           CHTP      ORNE CHTPHD
     C                     ROLBK
     C                     MOVE '1'       *IN78
     C                     GOTO ENDWHA
     C                     END                             ** E01
      *                                                                   056031
      *  Generate Shadow Postings for Amend Credit Instructions           056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C                     Z-ADDPRRM      ##CRAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACR  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCR                                    056031
     C/COPY WNCPYSRC,FT0080C099
     C**
     C*    SAVE OLD VALUES OF FIELDS SO THAT CORRECT RECORDS ON MEMOS/
     C*      OLPOS/PRONO ARE AMENDED EVEN IF PARTIES/CURRENCY/ETC HAVE
     C*      BEEN AMENDED
     C**
     C                     MOVE SAVHED    SAVEH2
     C**
     C*    RESTORE NEW VALUES
     C**
     C                     MOVE SAVEH1    SAVHED
     C**
     C*    SETUP VARIOUS DEFAULT FIELDS INCLUDING DAF FIELDS
     C**
     C                     MOVE 'D'       RECI
     C                     Z-ADD0         CQSQ
     C           PCCYDP    ADD  1         W
     C           TOTR      DIV  FCTR,W    TOTRD
     C           TOTR      SUB  TOTD      DIFF
     C           DIFF      DIV  FCTR,W    DIFFD
     C                     Z-ADDPVDT      DAFD0
      *
     C                     EXSR DAFDAT
     C                     Z-ADDDAFD1     PVDTD1
     C                     Z-ADDDAFD2     PVDTD2
     C                     Z-ADDDAFD3     PVDTD3
      *
     C* CALCULATE BASE CURRENCY EQUIV
      *
     C           PCCYDP    SUB  BCCYDP    N       10
     C                     ADD  4         N
      *
     C           PCCYMD    IFEQ 0                          B001
     C           PCCYSP    MULT POWER,N   WK159     H
     C           PRRM      DIV  WK159     PBCQ      H
     C                     ELSE                            X001
     C           PCCYSP    DIV  POWER,N   WK159  159H
     C           PRRM      MULT WK159     PBCQ      H
     C                     END                             E001
      *
     C           PRRM      DIV  FCTR,W    PRRMD
     C           PCCYDP    ADD  1         W
     C           COCH      DIV  FCTR,W    COCHD
     C           DEDS      DIV  FCTR,W    DEDSD
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
     C                     TIME           LCHT
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C                     MOVE 'A'       ACTDH
     C**
     C*    UPDATE RECORD, MONITOR FOR UPDATED BY ANOTHER WS
     C**
     C                     MOVE USRID     INUSR1                          E36921
      *
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQPACDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KLCWHT    CHAINSDCWHTL1             02                                       CSD015
      *                                                                                       CSD015
     C           *IN02     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed Flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Remitting Bank                                                                       CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     Z-ADD2         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Sender's Correspondence                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     Z-ADD4         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver's Correspondent                                                             CSD015
      *                                                                                       CSD015
     C           RCO1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRCO1      PINP1                                               CSD015
     C                     MOVELRCO2      PINP2                                               CSD015
     C                     MOVELRCO3      PINP3                                               CSD015
     C                     MOVELRCO4      PINP4                                               CSD015
     C                     MOVELRCO5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD5         WX                                                  CSD015
     C                     Z-ADD6         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank                                                                    CSD015
      *                                                                                       CSD015
     C           ACB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELACB1      PINP1                                               CSD015
     C                     MOVELACB2      PINP2                                               CSD015
     C                     MOVELACB3      PINP3                                               CSD015
     C                     MOVELACB4      PINP4                                               CSD015
     C                     MOVELACB5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD7         WX                                                  CSD015
     C                     Z-ADD8         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQPADDL1                 03                                   CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C           *IN03     DOWEQ*OFF                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Debit Party                                                                          CSD015
      *                                                                                       CSD015
     C***********WCDRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCDRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCDRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCDRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCDRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCDRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Charges to the Debit of account                                                      CSD015
      *                                                                                       CSD015
     C***********WFCDRO    IFNE *ZEROS                                                 CSD015 CSD027
     C           WFCDRO    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WFCDRT    IFEQ 'N'                                                           CSD015
     C                     MOVELWFCDRO    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWFCDRO    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Only check those amended watch list fields                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE PRBK1                                                         CSD015
     C           RBK1      ANDNE*BLANKS                                                       CSD015
     C           RBK2      ORNE PRBK2                                                         CSD015
     C           RBK2      ANDNE*BLANKS                                                       CSD015
     C           RBK3      ORNE PRBK3                                                         CSD015
     C           RBK3      ANDNE*BLANKS                                                       CSD015
     C           RBK4      ORNE PRBK4                                                         CSD015
     C           RBK4      ANDNE*BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     Z-ADD2         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           SNCO      IFNE PSNCO                                                         CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     Z-ADD4         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     UPDATCQPACDDF               78
      *
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWHA
     C                     END                             ** E01
      *                                                                   056031
      *  Generate Shadow Postings for Amend Credit Instructions           056031
      *  (new value posting)                                              056031
      *                                                                   056031
     C                     Z-SUBPRRM      ##CRAM                          056031
     C                     EXSR SRADCR                                    056031
      *                                                                   056031
      *  Update database with posting changes                             056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C**
     C*    UPDATE TRAILER - SUBTRACT PREVIOUS PROCEEDS REMITTED AND
     C*                     ADD NEW VALUE
     C**
     C           1         CHAINCQPACZZ              99
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVE 'MISSING 'ERMSG1
     C                     MOVE 'TRAILER 'ERMSG2
     C                     MOVE ERRMSG    WDBKEY             ************
    C                     Z-ADD14        WDBASE             * DBERR 14 *
     C                     MOVEL'CQPAC'   WDBFIL             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C*
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     Z-SUBPRRMOL    PRRMOL
     C                     MOVE PRRMOL    ZZAMT
     C                     EXSR GLZADD
     C                     MOVE PRRM      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
      *
     C                     UPDATCQPACZZF
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C*****BEFORE*EACH SR CALL RESTORE ALL THE APPROPRIATE VALUES, VIZ    056031
     C*******THE*OLD VALUES FOR THE FIRST CALL, WHICH WILL REMOVE THE     056031
     C*******PREVIOUS AMOUNT, AND THE THE NEW VALUES FOR THE SECOND       056031
     C*******CALL*WHICH WILL APPLY THE NEW AMOUNT.  THIS IS IN CASE       056031
     C*******A*PARTY OR THE CURRENCY HAS BEEN AMENDED.                    056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************                                                        056031
     C************         MOVE SAVEH2    SAVHED                          056031
     C************         Z-ADDPRRMOL    AMOUNT                          056031
     C************         Z-ADDPVDT      CPVDT                           056031
     C************         EXSR MEMOSH                                    056031
     C************                                                        056031
     C************         MOVE SAVEH1    SAVHED                          056031
     C************         Z-ADDPRRMNW    AMOUNT                          056031
     C************         Z-ADDPVDT      CPVDT                           056031
     C************         EXSR MEMOSH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01         056031
     C************                                                        056031
     C************         MOVE SAVEH2    SAVHED                          056031
     C************         Z-ADDPRRMOL    AMOUNT                          056031
     C************         EXSR OLPOSH                                    056031
     C************                                                        056031
     C************         MOVE SAVEH1    SAVHED                          056031
     C************         Z-ADDPRRMNW    AMOUNT                          056031
     C************         EXSR OLPOSH                                    056031
     C************                                                        056031
     C************         MOVE SAVEH2    SAVHED                          056031
     C************         Z-ADDPRRMOL    AMOUNT                          056031
     C************         EXSR PRONOH                                    056031
     C************                                                        056031
     C************         MOVE SAVEH1    SAVHED                          056031
     C************         Z-ADDPRRMNW    AMOUNT                          056031
     C************         EXSR PRONOH                                    056031
     C************         END                             ** E01         056031
     C*
     C           *IN78     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C                     END                             ** E01
     C*                                                                   056031
     C           ENDWHA    TAG                                            056031
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*
     C***********ENDWHA    ENDSR                                          056031
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    WRITDA - SR TO UPDATE DETAIL ON DATABASE
     C**
     C           WRITDA    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITDA'  @STK,O                          056031
     C/COPY WNCPYSRC,FT0080C077
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    SAVE CURRENT VALUES OF FIELDS
     C**
     C                     MOVE RECI      RECID
     C                     MOVE PREF      PREFD
     C                     Z-ADDCQSQ      CQSQD
     C                     MOVELSAVDET    SAVDTA
     C                     Z-ADDCQAM      CQAMNW
     C                     MOVE DRCY      DRCYNW
     C**
     C*    OBTAIN HEADER AND UPDATE
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
    C*
    C           *IN99     IFEQ '1'                        ** B01
    C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD15        WDBASE             * DBERR 15 *
    C                     MOVELCQPKEY    WDBKEY             ************
    C                     EXSR ENDPGM
    C                     END                             ** E01
    C*
     C           AUIN      IFEQ 'Y'                        ** B01
    C           RECI      ORNE 'D'
    C                     ROLBK
    C                     MOVE '1'       *IN78
    C                     GOTO ENDWDA
     C                     END                             ** E01
     C*
     C                     SUB  CQAMOL    TOTD
     C                     ADD  CQAM      TOTD
     C           PCCYDP    ADD  1         W
     C           TOTD      DIV  FCTR,W    TOTDD
     C           TOTR      SUB  TOTD      DIFF
     C           DIFF      DIV  FCTR,W    DIFFD
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     TIME           LCHT
     C                     MOVE 'A'       CHTP
     C*
     C                     UPDATCQPACDDF               78
     C*
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDA
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C038
     C**
     C*    RESTORE CHEQUE SEQUENCE NUMBER
     C**
     C                     Z-ADDCQSQD     CQSQ
     C**
     C*    ACCESS DETAIL RECORD TO SEE IF UPDATED
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADDCQSQ      CQSQKY
     C           CQPACK    CHAINCQPADDDF             99
     C*
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD16        WDBASE             * DBERR 16 *
     C                     MOVELCQPKEY    WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C**
     C*    SEE IF RECORD HAS CHANGED
     C**
     C           LCHT      IFNE LCHTDT                     ** B01
     C           LCD       ORNE LCDDT
     C           CHTP      ORNE CHTPDT
     C                     ROLBK
     C                     MOVE '1'       *IN78
     C                     GOTO ENDWDA
     C                     END                             ** E01
      *                                                                   056031
      * Calculate Debit currency equivalent                               056031
      *                                                                   056031
     C                     EXSR SRDREQ                                    056031
      *                                                                   056031
      *  Generate Shadow Postings for Posting Debit Instructions          056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C                     Z-SUBD#TAMT    ##DRAM                          056031
     C/COPY WNCPYSRC,FT0080C093
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVADR  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  If Charges to the Debit are entered, process as well             056031
      *                                                                   056031
     C                     Z-ADD0         W#AMT                                               237563
     C***********CDRO      IFNE 0                                                      056031 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C**********           Z-ADDTRCH      W#AMT                                        056031 237563
     C           TRCH      ADD  PDVATH    W#AMT                                               237563
     C                     ADD  COLH      W#AMT                           056031
     C                     ADD  CSTH      W#AMT                           056031
     C                     ADD  PDCHCH    W#AMT                           S01494
     C                     ELSE                                                               237563
     C           TRCM      ADD  PDCHCM    W#AMT                                               237563
     C                     ADD  COLL      W#AMT                                               237563
     C                     ADD  CSTA      W#AMT                                               237563
     C                     ADD  PDVATT    W#AMT                                               237563
     C                     END                                                                237563
      *                                                                                       237563
     C           W#AMT     IFNE 0                                                             237563
     C/COPY WNCPYSRC,FT0080C094
     C                     Z-SUBW#AMT     ##CDAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACD  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCD                                    056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C100
     C**
     C*    SAVE OLD VALUES OF FIELDS SO THAT CORRECT RECORDS ON MEMOS/
     C*      OLPOS/PRONO ARE AMENDED EVEN IF PARTIES/CURRENCY/ETC HAVE
     C*      BEEN AMENDED
     C**
     C                     MOVELSAVDET    SAVDTB
     C                     MOVE DRCY      DRCYOL
     C                     Z-ADDRATE      RATEOL
     C                     Z-ADDMDIN      MDINOL
     C**
     C*    RESTORE ALL OTHER NEW VALUES
     C**
     C                     MOVE SAVDTA    SAVDET
     C                     MOVE RECID     RECI
     C                     MOVE PREFD     PREF
     C**
     C*    SETUP VARIOUS DEFAULT FIELDS INCLUDING DAF FIELDS
     C**
     C                     MOVE 'D'       RECI
     C           CQAM      DIV  FCTR,W    CQAMD
     C*
     C/COPY WNCPYSRC,FT0080C060
      *                                                                                       CER049
      ** If Cheque is liable to Stamp Tax                                                     CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
      *                                                                                       CER049
      ** Find default stamp Stamp Tax Rate                                                    CER049
      *                                                                                       CER049
     C                     MOVE PVDT      U#DATE  50                                          CER049
     C                     MOVE *BLANKS   U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** SD008140 will return the Tax Rate to be used to calculate the                        CER049
      ** Stamp Tax and the Stamp Tax Currency                                                 CER049
      *                                                                                       CER049
     C                     CALL 'SD008140'                                                    CER049
     C                     PARM           U#DATE                                              CER049
     C                     PARM           U#ORGN                                              CER049
     C                     PARM           U#TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** If there is a default Tax Rate for the module use this,                              CER049
      ** otherwise use the ICD control Tax Rate.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Calculate Stamp Tax Rate on Entry CCY amount and File CCY                            CER049
      ** amount                                                                               CER049
      *                                                                                       CER049
     C           TRCH      MULT U#TAXR    CSTH                                                CER049
     C           TRCM      MULT U#TAXR    CSTA                                                CER049
      *                                                                                       CER049
      ** Move 'N' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'N'       PDVAT3                                              CER049
     C                     MOVE 'N'       PDVAT1                                              CER049
      *                                                                                       CER049
      ** Get rid of VAT on Stamp Tax relevant amounts that has been calculated                CER049
      ** earlier in FT0080.                                                                   CER049
      *                                                                                       CER049
     C                     SUB  #PDVAT    PDVATT                                              CER049
     C                     SUB  #PDVAH    PDVATH                                              CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQPACQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN 10                                           CER049
     C**********           MOVE *BLANKS   U#LNRF  60                                   CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF  6                                           CLE148
     C                     MOVE *BLANKS   U#FCNM  6                                           CER049
     C                     MOVE *BLANKS   U#FACT  30                                          CER049
     C                     MOVE *BLANKS   U#FCNO  20                                          CER049
     C                     MOVE *BLANKS   U#FSEQ  20                                          CER049
     C                     MOVE *BLANKS   U#ORED  50                                          CER049
     C                     MOVE *BLANKS   U#DLNO  60                                          CER049
     C                     MOVE *BLANKS   U#TDRF  6                                           CER049
     C                     MOVE *BLANKS   U#BRCA  3                                           CER049
     C                     MOVE *BLANKS   U#CNUM  6                                           CER049
     C                     MOVE *BLANKS   U#CCY   3                                           CER049
     C                     MOVE *BLANKS   U#ACOD 100                                          CER049
     C                     MOVE *BLANKS   U#ACSQ  20                                          CER049
     C                     MOVE PREF      U#PREF 15                                           CER049
     C                     MOVE SCQSQ     U#CQSQ  20                                          CER049
     C                     MOVE *BLANKS   U#PBRC  3                                           CER049
     C                     MOVE *BLANKS   U#PSSH 10                                           CER049
     C                     MOVE *BLANKS   U#PCPT  6                                           CER049
     C                     MOVE *BLANKS   U#PDUD  50                                          CER049
     C                     MOVE *BLANKS   U#PEVT  2                                           CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQPACQL0             80                                       CER049
     C                     MOVE CSTH      QPSTAF                                              CER049
     C                     UPDATCQPACQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'N'                                                           CER049
      *                                                                                       CER049
     C                     MOVE *ZEROS    CSTH                                                CER049
     C                     MOVE *ZEROS    CSTA                                                CER049
      *                                                                                       CER049
      ** Move 'Y' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'Y'       PDVAT3                                              CER049
     C           PDVAT1    IFEQ 'N'                                                           CER049
     C                     SUB  #PDVAT    PDVATT                                              CER049
     C                     SUB  #PDVAH    PDVATH                                              CER049
     C                     END                                                                CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQPACQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQP'   U#ORGN                                              CER049
     C                     MOVE *BLANKS   U#LNRF                                              CER049
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *BLANKS   U#FACT                                              CER049
     C                     MOVE *BLANKS   U#FCNO                                              CER049
     C                     MOVE *BLANKS   U#FSEQ                                              CER049
     C                     MOVE *BLANKS   U#ORED                                              CER049
     C                     MOVE *BLANKS   U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *BLANKS   U#ACOD                                              CER049
     C                     MOVE *BLANKS   U#ACSQ                                              CER049
     C                     MOVE PREF      U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE *BLANKS   U#PBRC                                              CER049
     C                     MOVE *BLANKS   U#PSSH                                              CER049
     C                     MOVE *BLANKS   U#PCPT                                              CER049
     C                     MOVE *BLANKS   U#PDUD                                              CER049
     C                     MOVE *BLANKS   U#PEVT                                              CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQPACQL0             80                                       CER049
     C                     MOVE *ZEROS    QPSTAF                                              CER049
     C                     UPDATCQPACQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
     C           U#STAX    OREQ 'N'                                                           CER049
      *                                                                                       CER049
     C           KLSTXD    CHAINSDSTMDL0             85                                       CER049
     C           *IN85     IFEQ *OFF                                                          CER049
     C                     MOVEL'CHEQP'   T2KEY                                               CER049
     C                     MOVE QPPREF    T2PREF                                              CER049
     C                     MOVE QPCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QPTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE PCCY      T2ECCY                                              CER049
     C                     MOVE QPSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'A'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
     C                     UPDAT@STMDV0                                                       CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'CHEQP'   T2KEY                                               CER049
     C                     MOVE QPPREF    T2PREF                                              CER049
     C                     MOVE QPCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QPTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE PCCY      T2ECCY                                              CER049
     C                     MOVE QPSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'I'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
     C                     MOVE *BLANKS   T2TYPE                                              CER049
      *                                                                                       CER049
      ** Set debit account                                                                    CER049
      *                                                                                       CER049
     C                     MOVE *BLANKS   T2DBRC                                              CER049
     C                     MOVE *BLANKS   T2DCST                                              CER049
     C                     MOVE *BLANKS   T2DCCY                                              CER049
     C                     MOVE *BLANKS   T2DACD                                              CER049
     C                     MOVE *BLANKS   T2DASQ                                              CER049
     C                     CLEART2TXRB                                                        CER049
     C                     WRITE@STMDV0                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C* CALCULATE BASE CURRENCY EQUIV
     C*
     C           PCCYDP    SUB  BCCYDP    N       10
     C                     ADD  4         N
     C*
     C           PCCYMD    IFEQ 0                          B001
     C           PCCYSP    MULT POWER,N   WK159     H
     C           CQAM      DIV  WK159     SBCQ      H
     C                     ELSE                            X001
     C           PCCYSP    DIV  POWER,N   WK159  159H
     C           CQAM      MULT WK159     SBCQ      H
     C                     END                             E001
     C/COPY WNCPYSRC,FT0080C061
     C*
     C                     Z-ADDDRVD      DAFD0
     C                     EXSR DAFDAT
     C                     MOVE DAFD1     DRVDD1
     C                     MOVE DAFD2     DRVDD2
     C                     MOVE DAFD3     DRVDD3
     C**
     C*    CHARGES ARE STORED ON FILE IN CHARGE CCY, WHICH IS BASE CCY OR
     C*      DEBIT CCY DEPENDING ON 'CHARGES TO THE DEBIT OF A/C' FIELD
     C*
     C           BCCYDP    ADD  1         W
     C           TRCM      DIV  FCTR,W    TRCMD
     C           CSTA      DIV  FCTR,W    CSTAD
     C           COLL      DIV  FCTR,W    COLLD
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
     C                     TIME           LCHT
     C*
     C* MOVE MULTIPLY DIVIDE IND AS DOES NOT SEEM TO BE DONE
     C*
     C********** CEU006    IFNE 'Y'                                                    CEU006 237565
     C           CEU006    IFEQ 'Y'                                                           237565
     C                     Z-ADDP#MDIN    MDIN                            CEU006
     C                     ELSE                                           CEU006
     C                     Z-ADDMDINNW    MDIN
     C                     ENDIF                                          CEU006
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     MOVE 'A'       ACTDD
     C**
     C*    UPDATE RECORD, MONITOR FOR ERROR
     C**
     C                     MOVE USRID     INUSR1                          E36921
      *                                                                   CAC001
      **  Setup margin information details                                CAC001
      *                                                                   CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     MOVE WOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQPACDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KLCWHT    CHAINSDCWHTL1             02                                       CSD015
      *                                                                                       CSD015
     C           *IN02     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed Flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Remitting Bank                                                                       CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     Z-ADD2         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Sender's Correspondence                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     Z-ADD4         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver's Correspondent                                                             CSD015
      *                                                                                       CSD015
     C           RCO1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRCO1      PINP1                                               CSD015
     C                     MOVELRCO2      PINP2                                               CSD015
     C                     MOVELRCO3      PINP3                                               CSD015
     C                     MOVELRCO4      PINP4                                               CSD015
     C                     MOVELRCO5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD5         WX                                                  CSD015
     C                     Z-ADD6         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Bank                                                                    CSD015
      *                                                                                       CSD015
     C           ACB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELACB1      PINP1                                               CSD015
     C                     MOVELACB2      PINP2                                               CSD015
     C                     MOVELACB3      PINP3                                               CSD015
     C                     MOVELACB4      PINP4                                               CSD015
     C                     MOVELACB5      PINP5                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD7         WX                                                  CSD015
     C                     Z-ADD8         WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Debit Party                                                                          CSD015
      *                                                                                       CSD015
     C***********DRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           DRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           DRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELDRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELDRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELDRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Charges to the Debit of account                                                      CSD015
      *                                                                                       CSD015
     C***********CDRO      IFNE *ZEROS                                                 CSD015 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CDRT      IFEQ 'N'                                                           CSD015
     C                     MOVELCDRO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCDRO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQPADDL1                 03                                   CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C           *IN03     DOWEQ*OFF                                                          CSD015
     C           WCCQSQ    ANDNECQSQ                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Other Debit Party                                                                    CSD015
      *                                                                                       CSD015
     C***********WCDRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCDRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCDRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCDRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCDRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCDRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Other Charges to the Debit of account                                                CSD015
      *                                                                                       CSD015
     C***********WCCDRO    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCCDRO    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCCDRT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCCDRO    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCCDRO    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQPADDL1                 03                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Only check those amended watch list fields                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
      *                                                                                       CSD015
      ** Get Details of Counterparties                                                        CSD015
      *                                                                                       CSD015
     C           RBK1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELRBK1      PINP1                                               CSD015
     C                     MOVELRBK2      PINP2                                               CSD015
     C                     MOVELRBK3      PINP3                                               CSD015
     C                     MOVELRBK4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WRBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WRBFF                                               CSD015
     C                     MOVELPOUT2     WRBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C********** SNCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           SNCT      IFEQ 'N'                                                           CSD015
     C                     MOVELSNCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSNCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELPCCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WSCCP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Format 2nd Parameter                                                                 CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
     C           DRPY      IFNE PDRPY                                                         CSD015
     C***********DRPY      ANDNE*ZEROS                                                 CSD015 CSD027
     C           DRPY      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           DRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELDRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELDRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELDRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD9         WX                                                  CSD015
     C                     Z-ADD10        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CDRO      IFNE PCDRO                                                         CSD015
     C***********CDRO      ANDNE*ZEROS                                                 CSD015 CSD027
     C           CDRO      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CDRT      IFEQ 'N'                                                           CSD015
     C                     MOVELCDRO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCDRO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELBJCYCD    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD11        WX                                                  CSD015
     C                     Z-ADD12        WY                                                  CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     EXSR SRENGN                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C*
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVELSEREFR    CPRRAT                          CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     UPDATCQPADDDF               78
     C*
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDA
     C                     END                             ** E01
      *                                                                   056031
      * Calculate Debit currency equivalent                               056031
      *                                                                   056031
     C                     EXSR SRDREQ                                    056031
      *                                                                   056031
      *  Generate Shadow Postings for Posting Debit Instructions          056031
      *  (new value posting)                                              056031
      *                                                                   056031
     C                     Z-ADDD#TAMT    ##DRAM                          056031
     C/COPY WNCPYSRC,FT0080C095
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  If Charges to the Debit are entered, process as well             056031
      *                                                                   056031
     C                     Z-ADD0         W#AMT                                               237563
     C***********CDRO      IFNE 0                                                      056031 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C**********           Z-ADDTRCH      W#AMT                                        056031 237563
     C           TRCH      ADD  PDVATH    W#AMT                                               237563
     C                     ADD  COLH      W#AMT                           056031
     C                     ADD  CSTH      W#AMT                           056031
     C                     ADD  PDCHCH    W#AMT                           S01494
     C                     ELSE                                                               237563
     C           TRCM      ADD  PDCHCM    W#AMT                                               237563
     C                     ADD  COLL      W#AMT                                               237563
     C                     ADD  CSTA      W#AMT                                               237563
     C                     ADD  PDVATT    W#AMT                                               237563
     C                     END                                                                237563
      *                                                                                       237563
     C           W#AMT     IFNE 0                                                             237563
     C/COPY WNCPYSRC,FT0080C096
     C                     Z-ADDW#AMT     ##CDAM                          056031
     C                     EXSR SRADCD                                    056031
     C                     END                                            056031
      *                                                                   056031
      *  Update database with posting changes                             056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C**
     C*    UPDATE TRAILER - SUBTRACT PREVIOUS CHEQUE AMOUNT AND ADD
     C*                     NEW VALUE
     C**
     C           1         CHAINCQPADZZ              99
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVE 'MISSING 'ERMSG1
     C                     MOVE 'TRAILER 'ERMSG2
     C                     MOVE ERRMSG    WDBKEY             ************
    C                     Z-ADD17        WDBASE             * DBERR 17 *
     C                     MOVEL'CQPAC'   WDBFIL             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C*
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     Z-SUBCQAMOL    CQAMOL
     C                     MOVE CQAMOL    ZZAMT
     C                     EXSR GLZADD
     C                     MOVE CQAM      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     UPDATCQPADZZF
     C*
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C*****CALCULATE THE DEBIT CCY EQUIVALENT OF THE NEW AND OLD          056031
     C*******CHEQUE AMOUNTS IF REQUIRED                                   056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C***********DLIND     OREQ 'Y'                                       056031
     C************                                                        056031
     C*********************MOVE 'B'       CFLAG                           E29826
     C*********************EXSR GETCCY                                    E29826
     C*********************Z-ADDRATENW    XSPOT1                          E29826
     C*********************Z-ADDMDINNW    XMDIN1                          E29826
     C*********************Z-ADDPCCYDP    XCDP1                           E29826
     C*********************Z-ADD1         XSPOT2                          E29826
     C*********************Z-ADD1         XMDIN2                          E29826
     C*********************Z-ADDDRCYDP    XCDP2                           E29826
     C*********************                                               E29826
     C*********************Z-ADDCQAMNW    XAMNT1                          E29826
     C**CONVERT*USING CROSS RATE                                          056031
     C************                                                        056031
     C***********PCCYDP    SUB  DRCYDP    N       10                      056031
     C************         ADD  4         N                               056031
     C**ERROR*FIX*IF*DRCY*IS*BASE***                                      S01194
     C***********DRCY******IFEQ BCCY                                      S01194
     C***********DRCY******IFEQ BJCYCD                                    S01194
     C*********************                                               E29826
     C***********MDINNW    IFEQ 1                          B002           056031
     C***********RATENW    DIV  POWER,N   WK159  159H                     056031
     C***********CQAMNW    MULT WK159     CQAMEQ    H                     056031
     C************         ELSE                            X002           056031
     C***********RATENW    MULT POWER,N   WK159  159H                     056031
     C***********CQAMNW    DIV  WK159     CQAMEQ    H                     056031
     C************         END                             E002           056031
     C*********************ELSE                                           E29826
     C***********MDINNW****IFEQ 0                          B002           E29826
     C***********RATENW****DIV  POWER,N   WK159  159H                     E29826
     C***********CQAMNW****MULT WK159     CQAMEQ    H                     E29826
     C*********************ELSE                            X002           E29826
     C***********RATENW****MULT POWER,N   WK159  159H                     E29826
     C***********CQAMNW****DIV  WK159     CQAMEQ    H                     E29826
     C*********************END                             E002           E29826
     C*********************END                                            E29826
     C***********DRCYOL    IFNE DRCYNW                     ** B01         056031
     C************         Z-ADD1         B                         E29826056031
     C***********DRCYOL    LOKUPCCYA,B                   88         E29826056031
     C************                                                  E29826056031
     C************IN88     IFEQ '0'                        ** B02   E29826056031
     C************         MOVE 'LOKUP'   WDBFIL       ************ E29826056031
    C************         Z-ADD29        WDBASE       * DBERR 29 * E29826056031
     C************         MOVELDRCYOL    WDBKEY       ************ E29826056031
     C************         EXSR ENDPGM                              E29826056031
     C************         ELSE                      ** X02         E29826056031
     C***CONVERT*USING CROSS RATE                                   E29826056031
     C***********PCCYDP    SUB  CDPA,B    N       10                E29826056031
     C************         ADD  4         N                         E29826056031
     C************         END                             ** E02   E29826056031
     C************         END                             ** E01   E29826056031
     C*********************MOVE 'D'       CFLAG                     E29826056031
     C*********************EXSR GETCCY                                    E29826
     C*********************Z-ADDRATEOL    XSPOT1                          E29826
     C*********************Z-ADDMDINOL    XMDIN1                          E29826
     C*********************Z-ADDPCCYDP    XCDP1                           E29826
     C*********************Z-ADD1         XSPOT2                          E29826
     C*********************Z-ADD1         XMDIN2                          E29826
     C*********************Z-ADDDRCYDP    XCDP2                           E29826
     C*********************END                             ** E02         E29826
     C*********************                                               E29826
     C*********************Z-ADDCQAMOL    XAMNT1                          E29826
     C***CONVERT*USING*CROSS*RATE*****                                    E29826
     C***********PCCYDP****SUB  DRCYDP    N       10                      E29826
     C*********************ADD  4         N                               E29826
     C**ERROR*FIX*IF*DRCYOL*IS*BASE****                                   S01194
     C***********DRCYOL****IFEQ BCCY                                      S01194
     C***********MDINOL    IFEQ 1                          B002           056031
     C***********RATEOL    DIV  POWER,N   WK159  159H                     056031
     C***********CQAMOL    MULT WK159     CQOLEQ    H                     056031
     C************         ELSE                            X002           056031
     C***********RATEOL    MULT POWER,N   WK159  159H                     056031
     C***********CQAMOL    DIV  WK159     CQOLEQ    H                     056031
     C************         END                             E002           056031
     C*********************ELSE                                           E29826
     C***********MDINOL****IFEQ 0                          B002           E29826
     C***********RATEOL****DIV  POWER,N   WK159  159H                     E29826
     C***********CQAMOL****MULT WK159     CQOLEQ    H                     E29826
     C*********************ELSE                            X002           E29826
     C***********RATEOL****MULT POWER,N   WK159  159H                     E29826
     C***********CQAMOL****DIV  WK159     CQOLEQ    H                     E29826
     C*********************END                             E002           E29826
     C*********************END                                            E29826
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****BEFORE*EACH SR CALL RESTORE ALL THE APPROPRIATE VALUES, VIZ    056031
     C*******THE*OLD VALUES FOR THE FIRST CALL, WHICH WILL REMOVE THE     056031
     C*******PREVIOUS AMOUNT, AND THE THE NEW VALUES FOR THE SECOND       056031
     C*******CALL*WHICH WILL APPLY THE NEW AMOUNT.  THIS IS IN CASE       056031
     C*******A*PARTY OR THE CURRENCY HAS BEEN AMENDED.                    056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************                                                        056031
     C************         MOVE SAVDTB    SAVDET                          056031
     C************         Z-ADDCQOLEQ    AMOUNT                          056031
     C************         Z-ADDDRVD      DDRVD                           056031
     C************         EXSR MEMOSD                                    056031
     C************                                                        056031
     C************         MOVE SAVDTA    SAVDET                          056031
     C************         Z-ADDCQAMEQ    AMOUNT                          056031
     C************         Z-ADDDRVD      DDRVD                           056031
     C************         EXSR MEMOSD                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01         056031
     C************         MOVE SAVDTB    SAVDET                          056031
     C************         Z-ADDCQOLEQ    AMOUNT                          056031
     C************         EXSR OLPOSD                                    056031
     C************                                                        056031
     C************         MOVE SAVDTA    SAVDET                          056031
     C************         Z-ADDCQAMEQ    AMOUNT                          056031
     C************         EXSR OLPOSD                                    056031
     C************                                                        056031
     C************         MOVE SAVDTB    SAVDET                          056031
     C************         Z-ADDCQOLEQ    AMOUNT                          056031
     C************         EXSR PRONOD                                    056031
     C************                                                        056031
     C************         MOVE SAVDTA    SAVDET                          056031
     C************         Z-ADDCQAMEQ    AMOUNT                          056031
     C************         EXSR PRONOD                                    056031
     C************         END                             ** E01         056031
     C*
     C           *IN78     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C                     END                             ** E01
     C*                                                                   056031
     C           ENDWDA    TAG                                            056031
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     C***********ENDWDA    ENDSR                                          056031
     C/COPY WNCPYSRC,FT0080C078
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    WRITHD - SR TO DELETE HEADER FROM DATABASE
     C**
     C           WRITHD    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITHD'  @STK,O                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    ACCESS HEADER RECORD TO SEE IF UPDATED
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
     C*
     C           *IN99     IFEQ '1'                        ** B01
     C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD18        WDBASE             * DBERR 18 *
     C                     MOVELCQPKEY    WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C**
     C*    SEE IF RECORD HAS CHANGED
     C**
     C           LCHT      IFNE LCHTHD                     ** B01
     C           LCD       ORNE LCDHD
     C           CHTP      ORNE CHTPHD
     C                     ROLBK
     C                     MOVE '1'       *IN78
     C                     GOTO ENDWHD
     C                     END                             ** E01
      *                                                                   056031
      *  Generate Shadow Postings for Delete Credit Instructions          056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C                     Z-ADDPRRM      ##CRAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCR                                    056031
     C**
     C*    SETUP VARIOUS FIELDS
     C**
     C                     MOVE 'C'       RECI
     C                     MOVE 'D'       CHTP
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     TIME           LCHT
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C                     MOVE 'D'       ACTDH
     C*
     C*    UPDATE RECORD, MONITOR FOR UPDATED BY ANOTHER WS
     C*
     C                     UPDATCQPACDDF               78
     C**
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWHD
     C                     END                             ** E01
      *                                                                   056031
      *  Update posting database changes                                  056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C*
      ************                                                        056031
      ************  Remove PRONO, OLPOS and MEMOS                         056031
      ************                                                        056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************         Z-SUBPRRM      AMOUNT                          056031
     C************         Z-ADDPVDT      CPVDT                           056031
     C************         EXSR MEMOSH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01
     C************         Z-SUBPRRM      AMOUNT
     C************         EXSR OLPOSH
     C************         Z-SUBPRRM      AMOUNT
     C************         EXSR PRONOH
     C************         END                             ** E01
     C*
     C           *IN78     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C                     END                             ** E01
     C*                                                                   056031
     C           ENDWHD    TAG                                            056031
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*                                                                   056031
     C***********ENDWHD    ENDSR                                          056031
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    WRITDD - SR TO DELETE DETAIL FROM DATABASE
     C**
     C           WRITDD    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'WRITDD'  @STK,O                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C**
     C*    STORE CHEQUE SEQUENCE NUMBER
     C**
     C                     Z-ADDCQSQ      CQSQD
     C**
     C*    UPDATE HEADER
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADD0         CQSQKY
     C           CQPACK    CHAINCQPACDDF             99
     C*
    C           *IN99     IFEQ '1'                        ** B01
    C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD19        WDBASE             * DBERR 19 *
    C                     MOVELCQPKEY    WDBKEY             ************
    C                     EXSR ENDPGM
    C                     END                             ** E01
     C*
     C           AUIN      IFEQ 'Y'                        ** B01
    C           RECI      ORNE 'D'
    C                     ROLBK
    C                     MOVE '1'       *IN78
    C                     GOTO ENDWDD
     C                     END                             ** E01
     C*
     C                     SUB  CQAM      TOTD
     C           PCCYDP    ADD  1         W
     C           TOTD      DIV  FCTR,W    TOTDD
     C           TOTR      SUB  TOTD      DIFF
     C           DIFF      DIV  FCTR,W    DIFFD
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C*********************Z-ADDRUND      LCD
     C                     Z-ADDBJRDNB    LCD
     C                     TIME           LCHT
     C                     MOVE 'A'       CHTP
     C*
     C                     UPDATCQPACDDF               78
     C*
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDD
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C039
     C**
     C*    RESTORE CHEQUE SEQUENCE NUMBER
     C**
     C                     Z-ADDCQSQD     CQSQ
     C**
     C*    ACCESS RECORD
     C**
     C                     MOVE PREF      PREFKY
     C                     Z-ADDCQSQ      CQSQKY
     C           CQPACK    CHAINCQPADDDF             99
     C*
    C           *IN99     IFEQ '1'                        ** B01
    C                     MOVE 'CQPAC'   WDBFIL             ************
    C                     Z-ADD20        WDBASE             * DBERR 20 *
    C                     MOVELCQPKEY    WDBKEY             ************
    C                     EXSR ENDPGM
    C                     END                             ** E01
      *                                                                   056031
      * Calculate Debit currency equivalent                               056031
      *                                                                   056031
     C                     EXSR SRDREQ                                    056031
      *                                                                   056031
      *  Generate Shadow Postings for Posting Debit Instructions          056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C                     Z-SUBD#TAMT    ##DRAM                          056031
     C/COPY WNCPYSRC,FT0080C097
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVADR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  If Charges to the Debit are entered, process as well             056031
      *                                                                   056031
     C***********CDRO      IFNE 0                                                      056031 CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C**********           Z-ADDTRCH      W#AMT                                        056031 237563
     C           TRCH      ADD  PDVATH    W#AMT                                               237563
     C                     ADD  COLH      W#AMT                           056031
     C                     ADD  CSTH      W#AMT                           056031
     C                     ADD  PDCHCH    W#AMT                           S01494
     C                     ELSE                                                               237563
     C           TRCM      ADD  PDCHCM    W#AMT                                               237563
     C                     ADD  COLL      W#AMT                                               237563
     C                     ADD  CSTA      W#AMT                                               237563
     C                     ADD  PDVATT    W#AMT                                               237563
     C                     END                                                                237563
      *                                                                                       237563
     C           W#AMT     IFNE 0                                                             237563
     C/COPY WNCPYSRC,FT0080C098
     C                     Z-SUBW#AMT     ##CDAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACD                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCD                                    056031
     C                     END                                            056031
     C**
     C*    SETUP VARIOUS FIELDS
     C**
     C                     MOVE 'C'       RECI
     C*********************Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'D'       CHTP
     C                     TIME           LCHT
     C**
     C*    SET UP FIELDS FOR COMMITMENT TEXT
     C**
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     MOVE 'D'       ACTDD
     C**
     C*    UPDATE RECORD, MONITOR FOR UPDATED BY ANOTHER WS
     C**
     C                     UPDATCQPADDDF               78
     C**
     C           *IN78     IFEQ '1'                        ** B01
     C                     ROLBK
     C                     GOTO ENDWDD
     C                     END                             ** E01
     C/COPY WNCPYSRC,FT0080C055
      *                                                                   056031
      *  Update posting database changes                                  056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
      *                                                                   056031
      ************                                                        056031
      ************  Remove PRONO, OLPOS and MEMOS                         056031
      ************                                                        056031
     C************                                                        056031
     C*****CALCULATE THE DEBIT CCY EQUIV. OF THE CHEQUE AMOUNT IF NEEDED  056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C***********DLIND     OREQ 'Y'                                       056031
     C************                                                        056031
     C*********************MOVE 'B'       CFLAG                           E29826
     C*********************EXSR GETCCY                                    E29826
     C*********************Z-ADDPCCYSP    XSPOT1                          E29826
     C*********************Z-ADDPCCYMD    XMDIN1                          E29826
     C*********************Z-ADDPCCYDP    XCDP1                           E29826
     C*********************Z-ADDDRCYSP    XSPOT2                          E29826
     C*********************Z-ADDDRCYMD    XMDIN2                          E29826
     C*********************Z-ADDDRCYDP    XCDP2                           E29826
     C*********************Z-ADDCQAM      XAMNT1                          E29826
     C************                                                        056031
     C***CONVERT*USING CROSS RATE                                         056031
     C***********PCCYDP    SUB  DRCYDP    N       10                      056031
     C************         ADD  4         N                               056031
     C**ERROR*FIX*IF*DRCY*IS*BASE***                                      S01194
     C***********DRCY******IFEQ BCCY                                      S01194
     C***********MDIN      IFEQ 1                          B002           056031
     C***********RATE      DIV  POWER,N   WK159  159H                     056031
     C***********CQAM      MULT WK159     CQAMEQ    H                     056031
     C************         ELSE                            X002           056031
     C***********RATE      MULT POWER,N   WK159  159H                     056031
     C***********CQAM      DIV  WK159     CQAMEQ    H                     056031
     C************         END                             E002           056031
     C*********************ELSE                                           E29826
     C***********MDIN******IFEQ 1                          B002           E29826
     C***********RATE******DIV  POWER,N   WK159  159H                     E29826
     C***********CQAM******MULT WK159     CQAMEQ    H                     E29826
     C*********************ELSE                            X002           E29826
     C***********RATE******MULT POWER,N   WK159  159H                     E29826
     C***********CQAM******DIV  WK159     CQAMEQ    H                     E29826
     C*********************END                             E002           E29826
     C*********************END                                            E29826
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********RTIND     IFEQ 'Y'                        ** B01         056031
     C***********REIND     OREQ 'Y'                                       056031
     C************         Z-SUBCQAMEQ    AMOUNT                          056031
     C************         Z-ADDDRVD      DDRVD                           056031
     C************         EXSR MEMOSD                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********DLIND     IFEQ 'Y'                        ** B01         056031
     C************         Z-SUBCQAMEQ    AMOUNT                          056031
     C************         EXSR OLPOSD                                    056031
     C************         EXSR PRONOD                                    056031
     C************         END                             ** E01         056031
     C*
     C           *INLR     IFEQ '0'                        ** B01
     C           CMTXTH    COMIT
     C                     END                             ** E01
     C*                                                                   056031
     C           ENDWDD    TAG                                            056031
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*                                                                   056031
     C***********ENDWDD    ENDSR                                          056031
     C                     ENDSR                                          056031
     C********************************************************************
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRCLR    : Clear all positions in store                      *   056031
      *                                                               *   056031
      *  CALLED BY: WRITHI - Write Header to Database                 *   056031
      *             WRITHA - Amend Header on Database                 *   056031
      *             WRITHD - Delete Header from database              *   056031
      *             WRITDI - Write Detail to Database                 *   056031
      *             WRITDA - Amend Detail on Database                 *   056031
      *             WRITDD - Delete Detail from database              *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRCLR     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRCLR'   @STK,O                          056031
      *                                                                   056031
      *  Clear arrays in AOSPOSU0                                         056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*CLEAR  'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD901       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C085
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXCLR     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADDR   : Add shadow positions to store for DEBIT postings  *   056031
      *                                                               *   056031
      *  CALLED BY: WRITDI - Write Detail to Database                 *   056031
      *             WRITDA - Amend Detail on Database                 *   056031
      *             WRITDD - Delete Detail from database              *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADDR    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRADDR'  @STK,O                          056031
      *                                                                   056031
      *  Define debit amount                                              056031
      *                                                                   056031
     C           *LIKE     DEFN W#AMT     ##DRAM                          056031
      *                                                                   056031
      *  Move fields to C#DTA structure and call AOSPOSU0                 056031
      *                                                                   056031
      *         D E B I T      I N S T R U C T I O N S                    056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C                     MOVELDRPT      C#ATYP                          056031
     C                     MOVELDRPY      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     MOVELDRBR      C#BRCA                          056031
     C                     Z-ADDDRVD      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'E'                                       056031
     C                     Z-ADDDRVD      C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           PVDT      IFLT DRVD                                      056031
     C                     Z-ADDPVDT      C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDDRVD      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL'I'       C#IO                            056031
     C                     MOVELDRCY      C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELPREF      C#PREF                          056031
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADDCQSQ      C#CHQN                                              CRE020
     C           WRVADR    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVADR                                              CRE020
     C                     MOVE '*'       WREVER  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     Z-ADD##DRAM    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD10        C#RPNB                          068347
     C                     MOVEL'D'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FT0080C101
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           C#ATYP    ANDNE*BLANKS                                                     BUG11856
     C           R#RTN     ORNE *BLANKS                                   056031
     C********** C#ATYP    ANDNE*BLANKS                                            BUG11856 BUG12897
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD902       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C086
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADCD   : Add shadow positions to store for CHARGES TO DEBIT*   056031
      *                                                               *   056031
      *  CALLED BY: WRITDI - Write Detail to Database                 *   056031
      *             WRITDA - Amend Detail on Database                 *   056031
      *             WRITDD - Delete Detail from database              *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADCD    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRADCD'  @STK,O                          056031
      *                                                                   056031
      *  Define charges to the debit of amount                            056031
      *                                                                   056031
     C           *LIKE     DEFN W#AMT     ##CDAM                          056031
      *                                                                   056031
      *  Move fields to C#DTA structure and call AOSPOSU0                 056031
      *                                                                   056031
      *         D E B I T      I N S T R U C T I O N S                    056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C********** CDRO      IFNE 0                                                             237563
     C           CDRO      IFNE *BLANKS                                               237563 CSD027A
     C                     MOVELCDRT      C#ATYP                          056031
     C                     MOVELCDRO      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     MOVELCDBR      C#BRCA                          056031
     C                     MOVELBJCYCD    C#CCY                                               237563
     C                     ELSE                                                               237563
     C                     MOVELDRPT      C#ATYP                                              237563
     C                     MOVELDRPY      C#ACCT                                              237563
     C                     EXSR SRACCT                                                        237563
     C                     MOVELDRBR      C#BRCA                                              237563
     C                     MOVELDRCY      C#CCY                                               237563
     C                     END                                                                237563
     C                     Z-ADDDRVD      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'E'                                       056031
     C                     Z-ADDDRVD      C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           PVDT      IFLT DRVD                                      056031
     C                     Z-ADDPVDT      C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDDRVD      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL'I'       C#IO                            056031
     C**********           MOVELBJCYCD    C#CCY                           056031       056031 237563
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELPREF      C#PREF                          056031
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADDCQSQ      C#CHQN                                              CRE020
     C           WRVACD    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVACD                                              CRE020
     C                     MOVE '*'       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     Z-ADD##CDAM    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD20        C#RPNB                          068347
     C                     MOVEL'D'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FT0080C090
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD906       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C087
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADCR   : Add shadow positions to store for CREDIT postings *   056031
      *                                                               *   056031
      *  CALLED BY: WRITHI - Write Header to Database                 *   056031
      *             WRITHA - Amend Header on Database                 *   056031
      *             WRITHD - Delete Header from database              *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADCR    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRADCR'  @STK,O                          056031
      *                                                                   056031
      *  Define debit amount                                              056031
      *                                                                   056031
     C           *LIKE     DEFN D#TAMT    ##CRAM                          056031
      *                                                                   056031
      *         C R E D I T    I N S T R U C T I O N S                    056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
      *  Set Posting Type and Account details                             056031
      *                                                                   056031
     C           SNCT      IFNE *BLANKS                                   056031
     C                     MOVELSNCT      C#ATYP                          056031
     C                     MOVELSNCO      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     ELSE                                           056031
     C                     MOVELRBKT      C#ATYP                          056031
     C                     MOVELRBK1      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     END                                            056031
      *                                                                   056031
     C                     Z-ADDPVDT      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDPVDT      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL'O'       C#IO                            056031
     C                     MOVELPCCY      C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELPREF      C#PREF                          056031
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADD0         C#CHQN                                              CRE020
     C           WRVACR    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVACR                                              CRE020
     C                     MOVE '*'       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     Z-ADD##CRAM    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD30        C#RPNB                          068347
     C                     MOVEL'C'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD903       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C088
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRDREQ   : Calculate Debit Currency Equivalent               *   056031
      *                                                               *   056031
      *  CALLED BY: WRITDI - Update Cheque Details on Insert          *   056031
      *             WRITDA - Update Cheque Details on Amend           *   056031
      *             WRITDD - Update Cheque Details on Delete          *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRDREQ    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRDREQ'  @STK,O                          056031
      *                                                                   056031
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     CLEARP#0010                                    CEU006
     C                     Z-ADDRATE      P#RATE                          CEU006
     C                     MOVE 'Y'       P#OVRT                          CEU006
     C                     MOVEL'FT0080'  P#PMSQ                          CEU006
     C                     MOVE DRCY      P#DBCY                          CEU006
     C                     Z-ADDDRVD      P#DBDT                          CEU006
     C                     MOVE PCCY      P#CRCY                          CEU006
     C                     Z-ADDCQAM      P#CRAM                          CEU006
     C                     Z-ADDPVDT      P#CRDT                          CEU006
     C                     EXSR EUXCHK                                    CEU006
     C                     Z-ADDP#DBAM    D#TAMT                          CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C                     Z-ADDCQAM      D#FAMT                          056031
     C                     MOVELPCCY      D#FCCY                          056031
     C                     MOVELDRCY      D#TCCY                          056031
      *                                                                   056031
      * Set multiply/divide indicator                                     056031
      *                                                                   056031
     C           MDIN      IFEQ 0                                         056031
     C                     MOVEL'D'       I#MDIN                          056031
     C                     ELSE                                           056031
     C                     MOVEL'M'       I#MDIN                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     Z-ADDRATE      I#RATE                          056031
     C                     CALL 'AOCCYCV0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*F*T*RAT'W0ACT   8                       056031
     C           D#DTA     PARM D#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOCCYCV0'W0KEY                           056031
     C                     Z-ADD905       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C*                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRUPD    : Update database with shadow positions             *   056031
      *                                                               *   056031
      *  CALLED BY: WRITHI - Write Header to Database                 *   056031
      *             WRITHA - Amend Header on Database                 *   056031
      *             WRITHD - Delete Header from database              *   056031
      *             WRITDI - Write Detail to Database                 *   056031
      *             WRITDA - Amend Detail on Database                 *   056031
      *             WRITDD - Delete Detail from database              *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRUPD     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SRUPD'   @STK,O                          056031
      *                                                                   056031
      *  Call AOSPOSU0 to update database                                 056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*UPDATE 'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD904       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0080C089
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXUPD     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O                               056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRERR    : Report error and close down program               *   056031
      *                                                               *   056031
      *  CALLED BY: SRCLR - Clear arrays                              *   056031
      *             SRUPD - Update Database with shadow positions     *   056031
      *             SRADDR- Add shadow positions to store - Debits    *   056031
      *             SRADCR- Add shadow positions to store - Credits   *   056031
      *             SRDREQ- Calculate Credit Currency Equivalent      *   056031
      *             INITL - Initation subroutine                      *   056031
      *             SRBOOK- Validate Book code field                  *   056031
      *             SRPRFC- Validate Profit Centre field              *   056031
      *                                                               *   056031
      *  CALLS    : *NONE                                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRERR     BEGSR                                          056031
      *                                                                   056031
      *  Define work variables                                            056031
      *                                                                   056031
     C           *LIKE     DEFN @BKEY     W0KEY                           056031
     C           *LIKE     DEFN @BERNB    W0ERNB                          056031
     C           *LIKE     DEFN @BFILE    W0FILE                          056031
     C           *LIKE     DEFN @BNARR    W0NARR                          056031
      *                                                                   056031
      *  Dump program                                                     056031
      *                                                                   056031
     C                     DUMP                                           056031
     C                     ROLBK                                          056031
      *                                                                   056031
      *  Send message to MOPERQ                                           056031
      *                                                                   056031
     C                     MOVEL*BLANKS   DBDTA                           056031
     C                     MOVEL'FT0080  '@BPGM                           056031
      *                                                                   056031
     C           O         IFGT 1                                         056031
     C           O         ANDLT21                                        056031
     C                     MOVEL@STK,O    @BSTK                           056031
     C                     ELSE                                           056031
     C                     MOVEL'*Nostkin'@BSTK                           056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVELW0KEY     @BKEY                           056031
     C                     MOVELW0ERNB    @BERNB                          056031
     C                     MOVELW0FILE    @BFILE                          056031
     C                     MOVELPREF      @BPREF                          056031
      *                                                                   056031
     C           W0NARR    IFEQ *BLANKS                                   056031
     C                     MOVELERR@,1    @BNARR                          056031
     C                     ELSE                                           056031
     C                     MOVELW0NARR    @BNARR                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     CALL 'AOCREPT'              9090               056031
     C                     PARM 'MEM5000' #MSGID  7                       056031
     C                     PARM 'MIDAS  ' #MSGF  10                       056031
     C                     PARM *BLANKS   #MSGFL 10                       056031
     C                     PARM DBDTA     #MSGDT256                       056031
     C                     PARM '*PRV'    #MSGR   5                       056031
     C                     PARM '*'       #PRGM  10                       056031
     C                     PARM 'MOPERQ ' #MSGQ  10                       056031
     C                     PARM '*INFO  ' #MSGT   7                       056031
      *                                                                   056031
      *  Close down program                                               056031
      *                                                                   056031
     C           *LOCK     IN   DLDA                                      056031
     C                     MOVE 'FT0080  'DBPGM                           056031
     C                     MOVELW0FILE    DBFILE           ***************056031
     C                     Z-ADDW0ERNB    DBASE            * DB ERROR 86 *056031
     C                     MOVELW0KEY     DBKEY            ***************056031
     C                     OUT  DLDA                                      056031
     C                     SETON                     U7U8LR               056031
     C                     RETRN                                          056031
     C                     MOVEL*BLANKS   R#RTN   7                       056031
      *                                                                   056031
     CSR         EXERR     ENDSR                                          056031
     C/EJECT
     C************************************************************     ***
     C* CURRY SR.
     C* TO CALCULATE CROSS CALCULATION AND BASE EQUIV OF SAME
     C************************************************************     ***
     C*
     C           CURRY     BEGSR
     C*
     C                     Z-ADD1         B       30
     C           CURR1     LOKUPCCYA,B                   88
     C*
     C*
     C           *IN88     IFEQ '0'                        ** B01
     C                     MOVE 'TABFP'   WDBFIL             ************
    C                     Z-ADD47        WDBASE             * DBERR 47 *
     C                     MOVELCURR1     WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C                     Z-ADDCDPA,B    CDP1    30
     C*
     C                     Z-ADD1         B       30
     C           CURR2     LOKUPCCYA,B                   88
     C*
     C           *IN88     IFEQ '0'                        ** B01
     C                     MOVE 'TABFP'   WDBFIL             ************
    C                     Z-ADD48        WDBASE             * DBERR 48 *
     C                     MOVELCURR2     WDBKEY             ************
     C                     EXSR ENDPGM
     C                     END                             ** E01
     C                     Z-ADDCDPA,B    CDP2    30
     C                     Z-ADDSPTA,B    SPOT2  138
     C                     Z-ADDMDA,B     MDIN2  138
     C           CDP1      SUB  CDP2      N       10
     C           N         ADD  4         N
     C***********CURR1*****IFEQ BCCY                       B001           S01194
     C           CURR1     IFEQ BJCYCD                     B001           S01194
     C           MDINN     IFEQ 0                          B002
     C           RATE      DIV  POWER,N   WK159  159H
     C           CQAMNT    MULT WK159     AMTC   130H
     C                     ELSE                            X002
     C           RATE      MULT POWER,N   WK159  159H
     C           CQAMNT    DIV  WK159     AMTC      H
     C                     END                             E002
     C                     ELSE
     C           MDINN     IFEQ 1                          B002
     C           RATE      DIV  POWER,N   WK159  159H
     C           CQAMNT    MULT WK159     AMTC      H
     C                     ELSE                            X002
     C           RATE      MULT POWER,N   WK159  159H
     C           CQAMNT    DIV  WK159     AMTC      H
     C                     END                             E002
     C                     END                             E001
     C**  CONVERT PAY CURRENCY AMOUNT TO BASE CURRENCY
     C           CDP2      SUB  BCCYDP    N       10
     C           N         ADD  4         N
     C*
     C           MDIN2     IFEQ 1                          B001
     C           SPOT2     DIV  POWER,N   WK159  159H
     C           AMTC      MULT WK159     PBCQ   130H
     C                     ELSE                            X001
     C           SPOT2     MULT POWER,N   WK159     H
     C           AMTC      DIV  WK159     PBCQ      H
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF CURRENCY SUBROUTINE
     C************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C*  ADCHK SUBROUTINE - TO VALIDATE ADDRESS FIELDS
     C*
     C*****************************************************************
     C*
     C           ADCHK     BEGSR
     C*
     C* THERE SHOULD BE NO EMBEDDED SPACES
     C*
     C           ADCHK1    IFEQ *BLANK                                    E37171
     C           ADCHK2    ANDNE*BLANK                                    E37171
     C*                                                                   E37171
     C           ADCHK1    OREQ *BLANK                                    E37171
     C           ADCHK3    ANDNE*BLANK                                    E37171
     C*                                                                   E37171
     C           ADCHK1    OREQ *BLANK                                    E37171
     C           ADCHK4    ANDNE*BLANK                                    E37171
     C*                                                                   E37171
     C           ADCHK1    OREQ *BLANK                                    E37171
     C           ADCHK5    ANDNE*BLANK                                    E37171
     C*                                                                   E37171
     C***********ADCHK2    IFEQ *BLANK                                    E37171
     C***********ADCHK3    ANDNE*BLANK                                    E37171
     C***********                                                         E37171
     C           ADCHK2    OREQ *BLANK                                    E37171
     C           ADCHK3    ANDNE*BLANK                                    E37171
     C*                                                                   E37171
     C           ADCHK2    OREQ *BLANK
     C           ADCHK4    ANDNE*BLANK
     C*
     C           ADCHK2    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK3    OREQ *BLANK
     C           ADCHK4    ANDNE*BLANK
     C*
     C           ADCHK3    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK4    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C                     SETON                     92
     C*
     C                     END
     C*
     C** CHECK FOR NON-VALID SWIFT CHARACTERS
     C*
     C           ADCHK1    IFNE *BLANKS
     C                     MOVEA*BLANKS   #FLD
     C                     MOVE ADCHK1    #FLD
     C                     EXSR SWSET
     C           *IN94     IFEQ '0'
     C                     ADD  1         S
     C*********************MOVE ' 500'    ERCD,S                          S01117
     C                     MOVE ' 028'    ERCD,S                          S01117
     C                     SETON                     93
     C                     END
     C                     END
     C**
     C           ADCHK2    IFNE *BLANKS
     C                     MOVEA*BLANKS   #FLD
     C                     MOVE ADCHK2    #FLD
     C                     EXSR SWSET
     C           *IN94     IFEQ '0'
     C                     ADD  1         S
     C*********************MOVE ' 501'    ERCD,S                          S01117
     C                     MOVE ' 029'    ERCD,S                          S01117
     C                     SETON                     93
     C                     END
     C                     END
     C**
     C           ADCHK3    IFNE *BLANKS
     C                     MOVEA*BLANKS   #FLD
     C                     MOVE ADCHK3    #FLD
     C                     EXSR SWSET
     C           *IN94     IFEQ '0'
     C                     ADD  1         S
     C*********************MOVE ' 502'    ERCD,S                          S01117
     C                     MOVE ' 030'    ERCD,S                          S01117
     C                     SETON                     93
     C                     END
     C                     END
     C**
     C           ADCHK4    IFNE *BLANKS
     C                     MOVEA*BLANKS   #FLD
     C                     MOVE ADCHK4    #FLD
     C                     EXSR SWSET
     C           *IN94     IFEQ '0'
     C                     ADD  1         S
     C*********************MOVE ' 503'    ERCD,S                          S01117
     C                     MOVE ' 031'    ERCD,S                          S01117
     C                     SETON                     93
     C                     END
     C                     END
     C**
     C           ADCHK5    IFNE *BLANKS
     C                     MOVEA*BLANKS   #FLD
     C                     MOVE ADCHK5    #FLD
     C                     EXSR SWSET
     C           *IN94     IFEQ '0'
     C                     SETON                     93
     C                     ADD  1         S
     C*********************MOVE ' 504'    ERCD,S                          S01117
     C                     MOVE ' 032'    ERCD,S                          S01117
     C                     END
     C                     END
     C**
     C                     ENDSR
     C*                                                               *
     C*                                                               *
     C*****************************************************************
    C/EJECT
     C*****************************************************************
     C* SUBROUTINE SWSET CHECK FOR VALID SWIFT CHARACTER USED
     C*   IND '94' IS SET BY AN INVALID CHARACTER IN SWCH
     C*
     C           SWSET     BEGSR                           *** SWSET ****
     C*
     C*** Q REDINED AS USED IN STANDARD SUBROUTINE SWIFT                  094278
     C*                                                                   094278
     C*******************  Z-ADD1         Q       20                      094278
     C                     Z-ADD1         Q       50                      094278
     C                     MOVE '1'       *IN94
     C*
     C                     MOVEA*BLANK    TST
     C*
     C           #FLD,1    IFNE *BLANK                     B002
     C                     MOVEA#FLD      TST
     C                     Z-ADD1         Q
     C*
     C           Q         DOWLE35                         B003
     C*
     C           TST,Q     IFNE ' '                        B004
     C           TST,Q     LOKUPSWCH                     94
     C*
     C           *IN94     IFEQ '0'                        B005
     C                     GOTO ENDLP
     C                     END                             E005
     C                     END                             E004
     C                     ADD  1         Q
     C                     END                             E003
     C                     END                             E002
     C           ENDLP     TAG
     C                     ENDSR
     C********************************************************************
     C/EJECT
      ************                                                        056031
      ************ Remove PRONO, OLPOS and MEMOS                          056031
      ************                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****MEMOSH*- SR TO PROCESS MEMOS UPDATING FOR HEADER               056031
     C************                                                        056031
     C***********MEMOSH    BEGSR                                          056031
     C************                                                        056031
     C*****IF*SENDER'S CORRESPONDENT OR REMITTING BANK IS A NOSTRO        056031
     C*******ACCESS NOSTRO TABLE FOR ACCOUNT DETAILS                      056031
     C************                                                        056031
     C************         MOVEL*BLANKS   ZTABKY                          056031
     C************         MOVE 'N'       FLAG    1        ** B01         056031
     C***********SNCT      IFEQ 'N'                        ** B01         056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         MOVE PCCY      ZTAB08                          056031
     C************         MOVELSNCO      ZTAB11                          056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********SSNCO*****IFEQ *BLANKS                    ** B01         E29829
     C***********SNCO      IFEQ *ZEROS                     ** B01   E29829056031
     C***********RBKT      ANDEQ'F'                                       056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         MOVE RBK1      SRBK1X                          056031
     C************         MOVELRNOST     ZTAB08                          056031
     C************         MOVE RNOST     ZTAB11                          056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********FLAG      IFEQ 'Y'                        ** B01         056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM '*DBERR ' @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM *BLANKS   @CUST                     S01194056031
     C************         PARM ZTAB08    @CYCD                     S01194056031
     C************         PARM *BLANKS   @ACCD                     S01194056031
     C************         PARM *BLANKS   @ACSN                     S01194056031
     C************         PARM ZTAB11    @NONB                     S01194056031
     C************         PARM *BLANKS   @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C************         EXSR MVNOST                              S01194056031
     C************                                                  S01194056031
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************EXSR TABCHN                                    S01194
     C************IN89*****IFEQ '1'                        ** B02         S01194
     C*********************MOVE 'TABFP'   WDBFIL             ************ S01194
    C*********************Z-ADD21        WDBASE             * DBERR 21 * S01194
     C*********************MOVELZTABKY    WDBKEY             ************ S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E02         S01194
     C************                                                        056031
     C*****ACCESS*LF/ACCNT TO OBTAIN ACCOUNT DETAILS                      056031
     C************                                                        056031
     C************         MOVE CNUM      ACNTCN                          056031
     C************         MOVE ZTAB08    ACNTCY                          056031
     C************         MOVE ACOD      ACNTAC                          056031
     C************         MOVE ACSQ      ACNTAS                          056031
     C************         MOVE A7BRCD    ACNTBR                    S01194056031
    C************         EXSR ACCCHN                                    056031
    C************                                                        056031
     C************         GOTO UPDTMH                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*SENDER'S CORRESPONDENT OR REMITTING BANK IS A RETAIL        056031
     C*******ACCOUNT NUMBER ACCESS LF/ACNUMA FOR ACCOUNT DETAILS          056031
     C************                                                        056031
     C************         MOVE 'N'       FLAG             ** B01         056031
     C***********SNCT      IFEQ 'R'                        ** B01         056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         Z-ADDSNCO      RETAIL 100                      056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********SSNCO*****IFEQ *BLANKS                    ** B01         E29829
     C***********SNCO      IFEQ *ZEROS                     ** B01   E29829056031
     C***********RBKT      ANDEQ'R'                                       056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         MOVELRBK1      RETAIL                          056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********FLAG      IFEQ 'Y'                        ** B01         056031
     C************                                                        056031
    C************         EXSR ACNCHN                                    056031
     C************                                                        056031
     C*****CHAIN*TO*TABLETR*LOGICAL*TO*CHECK*IF*IT*IS*A*NOSTRO            S01194
     C*****FOR*LATER*ACCOUNT*MOVEMENTS*FILE*WRITE*************            S01194
     C*****CHAIN*TO SDNOSTPD PF TO CHECK IF IT IS A NOSTRO          S01194056031
     C*****FOR*LATER ACCOUNT MOVEMENTS FILE WRITE                   S01194056031
     C************                                                        056031
     C************         MOVE CNUM      ACNTCN                          056031
     C************         MOVE CCY       ACNTCY                          056031
     C************         MOVE ACOD      ACNTAC                          056031
     C************         MOVE ACSQ      ACNTAS                          056031
     C************         MOVE BRCA      ACNTBR                    S01117056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM ACNCNA    @CUST                     S01194056031
     C************         PARM ACNTCY    @CYCD                     S01194056031
     C************         PARM ACNACA    @ACCD                     S01194056031
     C************         PARM ACNASA    @ACSN                     S01194056031
     C************         PARM *BLANKS   @NONB                     S01194056031
     C************         PARM ACNTBR    @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVFPRT     8888           S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
     C***********ACCNTK****CHAINFPRTNF               88                   S01117
     C**N88******RECI******COMP 'D'                  8888                 S01117
    C************                                                        056031
     C************         GOTO UPDTMH                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*SENDER'S CORRESPONDENT IS BLANK AND REMITTING BANK IS       056031
     C*******A*FULL A/C NO. ACCESS LF/ACCNT FOR ACCOUNT DETAILS           056031
     C************                                                        056031
     C***********SSNCO*****IFEQ *BLANKS                    ** B01         E29829
     C***********SNCO      IFEQ *ZEROS                     ** B01   E29829056031
     C***********RBKT      ANDEQ'G'                                       056031
     C************         MOVE 'Y'       FLAG                            056031
     C************                                                        056031
     C************         MOVELRBK1      ACNTKY                          056031
    C************         EXSR ACCCHN                                    056031
     C************                                                        056031
     C*****CHAIN*TO TABLETL LOGICAL TO CHECK IF IT IS A NOSTRO            056031
     C*****FOR*LATER ACCOUNT MOVEMENTS FILE WRITE                         056031
     C************                                                        056031
     C***********ACCNTK****CHAINFPRTNF               88                   S01194
     C**N88******RECI******COMP 'D'                  8888                 S01194
    C************                                                        056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM ACNCNA    @CUST                     S01194056031
     C************         PARM ACNTCY    @CYCD                     S01194056031
     C************         PARM ACNACA    @ACCD                     S01194056031
     C************         PARM ACNASA    @ACSN                     S01194056031
     C************         PARM *BLANKS   @NONB                     S01194056031
     C************         PARM ACNTBR    @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVFPRT     8888           S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
    C************         GOTO UPDTMH                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********FLAG      IFNE 'Y'                        ** B01         056031
     C************         GOTO ENDMMH                                    056031
     C************         END                             ** E01         056031
     C************                                         ************   056031
     C***********UPDTMH    TAG                             *  UPDTMH  *   056031
     C************                                         ************   056031
     C************                                                        056031
     C*****IF*THIS ISN'T A RETAIL ACCOUNT EXIT SUBROUTINE                 056031
     C************                                                        056031
     C***********ATYP      IFNE 'R'                        ** B01         056031
     C************         GOTO ENDMMH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****ACCESS*AND UPDATE SHADOW BALANCES RECORD                       056031
     C************                                                        056031
     C***********RRNM      CHAINMEMOS                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************IN99     IFEQ '1'                        ** B01         056031
     C************         MOVE 'MEMOS'   WDBFIL             ************ 056031
    C************         Z-ADD22        WDBASE             * DBERR 22 * 056031
     C************         MOVELRRNM      WDBKEY             ************ 056031
     C************         EXSR ENDPGM                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         MOVE LDBLN     LDBLWK 150                      056031
     C************         SUB  AMOUNT    LDBLN                           056031
     C************                                                        056031
     C***********CPVDT*****IFLT DNWD                       ** B02         S01194
     C***********CPVDT     IFLT BJDNWD                     ** B02   S01194056031
     C************         SUB  AMOUNT    CLBLN                           056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C************         UPDATMEMOSMDF                                  056031
     C************                                                   S0119056031
     C**SET*UP*LOCATION CODE OF PARTY FOR CALL TO ZCHKH IN SR AMOVTS S0119056031
     C**IF*PARTY*IS NOSTRO CODE IS NLOC ELSE USE SYSTEM LOCATION.    S0119056031
     C************                                                   S0119056031
     C************IN88     IFEQ '1'                                  S0119056031
     C************         MOVE BJSLCD    ZLOC                       S0119056031
     C************         MOVE 'S'       NOWRK   3                  S0119056031
     C************         ELSE                                      S0119056031
     C************IN88     IFEQ '0'                                  S0119056031
     C***********DLIND     ANDNE'Y'                                  S0119056031
     C************         MOVE NLOC      ZLOC                       S0119056031
     C************         MOVE 'N'       NOWRK                      S0119056031
     C************         END                                       S0119056031
     C************         END                                       S0119056031
     C************                                                   S0119056031
     C************                                                        056031
     C***IF*RETAIL,BUT NOT NOSTRO UPDATE ACCOUNT                          056031
     C***MOVEMENT*ENQUIRIES HERE                                          056031
     C************                                                        056031
     C************IN88     IFEQ '1'                        ** B02         056031
     C************                                                        056031
     C***OR*IF*RETAIL NOSTRO,BUT DEALING MODULE NOT PRESENT,UPDATE.       056031
     C************                                                        056031
     C************IN88     OREQ '0'                                       056031
     C***********DLIND     ANDNE'Y'                                       056031
     C************                                                        056031
     C************         Z-ADDCPVDT     VUDT                            056031
     C************         Z-ADDAMOUNT    MVAM                            056031
     C************         EXSR AMOVTS                                    056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C***********ENDMMH    ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****OLPOSH*- SR TO PROCESS OLPOS UPDATE FOR HEADER                 056031
     C************                                                        056031
     C***********OLPOSH    BEGSR                                          056031
     C************                                                        056031
     C*****ACCESS*RECORD, IF NOT FOUND THIS IS A NEW CCY RETURN TO CALLER 056031
     C************                                                        056031
     C************         MOVELPCCY      OLPOSC                          056031
     C************         Z-ADD01        OLPOSN                          056031
     C************         MOVE BRCH      OLPOSB                    S01117056031
     C***********OLPOSK    CHAINOLPOS                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************                                                        056031
     C************IN99     IFEQ '0'                        ** B01         056031
     C************                                                        056031
     C**IF*DATE*LESS THAN FIRST DATE IGNORE AND RELEASE                   056031
     C***********PVDT      IFLT OLD,1                      ** B02         056031
     C************         EXCPTROLPOS                                    056031
     C************         ELSE                                           056031
     C*****IF*PAY*VALUE DATE IS AFTER 16TH DATE UPDATE 16TH FIGURE     ...056031
     C************                                                        056031
     C***********PVDT      IFGT OLD,16                     ** B02         056031
     C************         ADD  AMOUNT    OUT,16                          056031
     C************         MOVE LCHT      TNLU                            056031
     C************         UPDATOLPOSOAF                                  056031
     C************         ELSE                            ** X02         056031
     C************                                                        056031
     C*****...OTHERWISE UPDATE FIGURE EQUAL TO OR JUST BEFORE VALUE DAT   056031
     C************                                                        056031
     C************         Z-ADD1         X                               056031
     C***********PVDT      LOKUPOLD,X                  8384               056031
     C************IN83     IFEQ '1'                        ** B03         056031
     C************IN84     OREQ '1'                                       056031
     C************         ADD  AMOUNT    OUT,X                           056031
     C************         MOVE LCHT      TNLU                            056031
     C************         UPDATOLPOSOAF                                  056031
     C************         END                             ** E03         056031
     C************                                                        056031
     C************         END                             ** E02         056031
     C************         END                             E002           056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****PRONOH*- SR TO PROCESS PRONO UPDATE FOR A HEADER               056031
     C************                                                        056031
     C***********PRONOH    BEGSR                                          056031
     C************                                                        056031
     C****IF*SENDER'S CORRESPONDENT IS A NOSTRO ACCESS PRONO USING PAY    056031
     C******CCY*AND SENDER'S CORRESPONDENT, IF NOT FOUND ACCESS PRONO     056031
     C******USING*NOSTRO NUMBER OF ZERO, IF NOT FOUND EXIT SUBROUTINE     056031
     C************                                                        056031
     C************         MOVE 'N'       FLAG                            056031
     C************                                                        056031
     C***********SNCT      IFEQ 'N'                        ** B01         056031
     C************         MOVE PCCY      PRONOC                          056031
     C************         MOVELSNCO      PRONON                          056031
     C************         SETON                     85                   056031
     C************         ELSE                                           056031
     C**TEST*FOR*OTHER NOSTROS                                            056031
     C************         MOVE SNCT      NTYPE   1                       056031
     C************         MOVELSNCO      RTNO                            056031
     C************         MOVE PCCY      NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      PRONON                          056031
     C************         MOVE CCY       PRONOC                          056031
     C************         END                                            056031
     C************                                                        056031
     C**IF*A*NOSTRO                                                       056031
     C***85*******         DO                                             056031
     C***STORE*ORIGINAL NOSTRO NO. IN CASE UNALLOCATED NOSTRO NO USEE32536056031
     C************                                                  E32536056031
     C************         Z-ADDPRONON    NOSOR   20                E32536056031
     C************                                                        056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************IN99     IFEQ '1'                        ** B02         056031
     C************                                                        056031
     C************         Z-ADD0         PRONON                          056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************                                                        056031
     C************IN99     IFEQ '1'                        ** B03         056031
     C************         GOTO ENDPRH                                    056031
     C************         END                             ** E03         056031
     C************                                                        056031
     C************         END                             ** E02         056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C****IF*SENDER'S CORRESPONDENT IS BLANK AND REMITTING BANK IS A      056031
     C******NOSTRO ACCESS PRONO USING REMITTING BANK, IF NOT FOUND ACCESS 056031
     C******PRONO*USING NOSTRO NUMBER OF ZERO, IF NOT FOUND EXIT SR       056031
     C************                                                        056031
     C***********SSNCO*****IFEQ *BLANKS                    ** B01         E29829
     C***********SNCO      IFEQ *ZEROS                     ** B01   E29829056031
     C***********RBKT      IFEQ 'F'                                       056031
     C************         MOVE RBK1      SRBK1X                          056031
     C************         MOVELRNOST     PRONOC                          056031
     C************         MOVE RNOST     PRONON                          056031
     C************         SETON                     85                   056031
     C************         ELSE                                           056031
     C**TEST*FOR*OTHER NOSTROS                                            056031
     C************         MOVE RBKT      NTYPE   1                       056031
     C************         MOVELRBK1      RTNO                            056031
     C************         MOVE PCCY      NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      PRONON                          056031
     C************         MOVE CCY       PRONOC                          056031
     C************         END                                            056031
     C************                                                        056031
     C**IF*NOSTRO*                                                        056031
     C***85*******         DO                                             056031
     C***STORE*ORIGINAL NOSTRO NO. IN CASE UNALLOCATED NOSTRO NO USEE32536056031
     C************                                                  E32536056031
     C************         Z-ADDPRONON    NOSOR                     E32536056031
     C************                                                        056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************IN99     IFEQ '1'                        ** B02         056031
     C************                                                        056031
     C************         Z-ADD0         PRONON                          056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************                                                        056031
     C************IN99     IFEQ '1'                        ** B03         056031
     C************         GOTO ENDPRH                                    056031
     C************         END                             ** E03         056031
     C************                                                        056031
     C************         END                             ** E02         056031
     C************         MOVE 'Y'       FLAG                            056031
     C************         END                             ** E01         056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********FLAG      IFNE 'Y'                        ** B01         056031
     C************         GOTO ENDPRH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*PAY*VALUE DATE IS GREATER THAN 5TH PRONO DATE RETURN        056031
     C*******TO*CALLER, ELSE SUBTRACT PROCEEDS REMITTED FROM EACH FIGUR   056031
     C*******CORRESPONDING TO A PRONO DATE .GE. PAY VALUE DATE.           056031
     C*****IF*PAY*VALUE DATE IS BETWEEN 2 PRONO DATES SUBTRACT            056031
     C*******PROCEEDS REMITTED FROM PRECEEDING FIGURE ALSO                056031
     C************                                                        056031
     C***********PVDT      IFGT PDT,5                      ** B01         056031
     C************         EXCPTRPRONO                                    056031
     C************         GOTO ENDPRH                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         Z-ADDPNV       PNO                             056031
     C************                                                        056031
     C***********1         DO   5         X                ** B01         056031
     C************                                                        056031
     C***********X         SUB  1         XX      10                      056031
     C***********XX        IFEQ 0                          ** B02         056031
     C************         Z-ADD1         XX                              056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C***********PDT,X     IFEQ PVDT                       ** B02         056031
     C************         SUB  AMOUNT    PNV,X                           056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C***********PDT,X     IFGT PVDT                       ** B02         056031
     C***********PDT,XX    ANDLTPVDT                                      056031
     C************         SUB  AMOUNT    PNV,X                           056031
     C************         SUB  AMOUNT    PNV,XX                          056031
     C************         ELSE                            ** X02         056031
     C************                                                        056031
     C***********PDT,X     IFGT PVDT                       ** B03         056031
     C************         SUB  AMOUNT    PNV,X                           056031
     C************         END                             ** E03         056031
     C************         END                             ** E02         056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         UPDATPRONOPNF                                  056031
     C************         Z-ADDPVDT      VUDT                            056031
     C************         Z-ADDAMOUNT    MVAM                            056031
     C************         SETON                     87                   056031
     C************                                                        056031
     C***IN*CASE*UNALLOCATED NOSTRO USED FOR PRONO REINSTATE ORIGINAE32536056031
     C***NOSTRO*NUMBER TO PREVENT DB ERROR IN AMOVTS                E32536056031
     C************                                                  E32536056031
     C************         Z-ADDNOSOR     NOSN                      E32536056031
     C************         EXSR AMOVTS                                    056031
     C************                                                        056031
     C***********ENDPRH    ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****MEMOSD*- SR TO PROCESS MEMOS UPDATING FOR CHEQUE DETAIL        056031
     C************                                                        056031
     C***********MEMOSD    BEGSR                                          056031
     C************                                                        056031
     C*****IF*DEBIT*PARTY*IS*A*NOSTRO*ACCESS*NOSTRO*TABLE*FOR*A/C*DETAILS S01194
     C*****IF*DEBIT PARTY IS A NOSTRO ACCESS SDNOSTPD PF  FOR A/C DETAILS S01194
     C************                                                        056031
     C************         MOVE 'N'       DFLAG   1                       056031
     C***********DRPT      IFEQ 'N'                        ** B01         056031
     C************         MOVE 'Y'       DFLAG                           056031
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C************         MOVE DRCY      ZTAB08                          056031
     C************         MOVELDRPY      ZTAB11                          056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM '*DBERR ' @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM *BLANKS   @CUST                     S01194056031
     C************         PARM ZTAB08    @CYCD                     S01194056031
     C************         PARM *BLANKS   @ACCD                     S01194056031
     C************         PARM *BLANKS   @ACSN                     S01194056031
     C************         PARM ZTAB11    @NONB                     S01194056031
     C************         PARM *BLANKS   @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C************         EXSR MVNOST                              S01194056031
     C************                                                  S01194056031
     C*********************MOVE '70'      ZTAB01                          S01194
     C*********************EXSR TABCHN                                    S01194
     C************IN89*****IFEQ '1'                        ** B02         S01194
     C*********************MOVE 'TABFP'   WDBFIL             ************ S01194
     C*********************Z-ADD23        WDBASE             * DBERR 23 * S01194
     C*********************MOVELZTABKY    WDBKEY             ************ S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E02         S01194
     C************                                                        056031
     C*****ACCESS*LF/ACCNT TO OBTAIN ACCOUNT DETAILS                      056031
     C************                                                        056031
     C************         MOVE CNUM      ACNTCN                          056031
     C************         MOVE ZTAB08    ACNTCY                          056031
     C************         MOVE ACOD      ACNTAC                          056031
     C************         MOVE ACSQ      ACNTAS                          056031
     C************         MOVE A7BRCD    ACNTBR                    S01194056031
    C************         EXSR ACCCHN                                    056031
    C************                                                        056031
     C************         GOTO UPDTMD                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*DEBIT PARTY IS A RETAIL ACCOUNT NUMBER ACCESS LF/ACNUMA     056031
     C*******FOR*ACCOUNT DETAILS                                          056031
     C************                                                        056031
     C************         MOVE 'N'       DFLAG                           056031
     C***********DRPT      IFEQ 'R'                        ** B01         056031
     C************         MOVE 'Y'       DFLAG                           056031
     C************         MOVELDRPY      RETAIL 100                      056031
     C************                                                        056031
    C************         EXSR ACNCHN                                    056031
     C************                                                        056031
     C*****CHAIN*TO*TABLETL*LOGICAL*TO*CHECK*IF*IT*IS*A*NOSTRO            S01194
     C*****ACCESS*TO SDNOSTPD PF TO CHECK IF IT IS A NOSTRO               056031
     C*****FOR*LATER ACCOUNT MOVEMENTS FILE WRITE                         056031
     C************                                                        056031
     C************         MOVE CNUM      ACNTCN                          056031
     C************         MOVE CCY       ACNTCY                          056031
     C************         MOVE ACOD      ACNTAC                          056031
     C************         MOVE ACSQ      ACNTAS                          056031
     C************         MOVE BRCA      ACNTBR                    S01194056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM ACNCNA    @CUST                     S01194056031
     C************         PARM ACNTCY    @CYCD                     S01194056031
     C************         PARM ACNACA    @ACCD                     S01194056031
     C************         PARM ACNASA    @ACSN                     S01194056031
     C************         PARM *BLANKS   @NONB                     S01194056031
     C************         PARM ACNTBR    @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVFPRT     8888           S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
     C***********ACCNTK****CHAINFPRTNF               88                   S01194
     C**N88******RECI******COMP 'D'                  8888                 S01194
    C************                                                        056031
     C************         GOTO UPDTMD                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*DEBIT PARTY IS A PARTIAL ACCOUNT NUMBER ACCESS              056031
     C*******LF/ACCNT FOR ACCOUNT DETAILS                                 056031
     C************                                                        056031
     C***********DRPT      IFEQ 'P'                        ** B01         056031
     C************         MOVE 'Y'       FLAG                            056031
     C************                                                        056031
     C************         MOVE DRPY      SDRPYX                          056031
     C************         Z-ADDDCUST     ACNTCN                          056031
     C************         Z-ADDDACOD     ACNTAC                          056031
     C************         Z-ADDDACSQ     ACNTAS                          056031
     C************         MOVE DRCY      ACNTCY                          056031
     C************         MOVE DRBR      ACNTBR                    S01117056031
    C************         EXSR ACCCHN                                    056031
     C************                                                        056031
     C*****CHAIN*TO*TABLETL*LOGICAL*TO*CHECK*IF*IT*IS*A*NOSTRO            S01194
     C*****ACCESS*TO SDNOSTPD PF TO CHECK IF IT IS A NOSTRO               056031
     C*****FOR*LATER ACCOUNT MOVEMENTS FILE WRITE                         056031
     C************                                                        056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM ACNCNA    @CUST                     S01194056031
     C************         PARM ACNTCY    @CYCD                     S01194056031
     C************         PARM ACNACA    @ACCD                     S01194056031
     C************         PARM ACNASA    @ACSN                     S01194056031
     C************         PARM *BLANKS   @NONB                     S01194056031
     C************         PARM ACNTBR    @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVFPRT     8888           S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
     C***********ACCNTK****CHAINFPRTNF               88                   S01117
     C**N88******RECI******COMP 'D'                  8888                 S01117
    C************                                                        056031
     C************         GOTO UPDTMD                                    056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C***********FLAG      IFNE 'Y'                        ** B01         056031
     C************         GOTO ENDMMD                                    056031
     C************         END                             ** E01         056031
     C************                                         ************   056031
     C***********UPDTMD    TAG                             *  UPDTMD  *   056031
     C************                                         ************   056031
     C************                                                        056031
     C*****IF*THIS ISN'T A RETAIL ACCOUNT EXIT SUBROUTINE                 056031
     C************                                                        056031
     C***********ATYP      IFNE 'R'                        ** B01         056031
     C************         GOTO ENDMMD                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****ACCESS*AND UPDATE SHADOW BALANCES RECORD                       056031
     C************                                                        056031
     C***********RRNM      CHAINMEMOS                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************IN99     IFEQ '1'                        ** B01         056031
     C************         MOVE 'MEMOS'   WDBFIL             ************ 056031
     C************         Z-ADD24        WDBASE             * DBERR 24 * 056031
     C************         MOVELRRNM      WDBKEY             ************ 056031
     C************         EXSR ENDPGM                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         MOVE LDBLN     LDBLWK                          056031
     C************         ADD  AMOUNT    LDBLN                           056031
     C************                                                        056031
     C***********DDRVD*****IFLT DNWD                                      S01194
     C***********DDRVD     IFLT BJDNWD                              S01194056031
     C************         ADD  AMOUNT    CLBLN                           056031
     C************         END                                            056031
     C************                                                        056031
     C************         UPDATMEMOSMDF                                  056031
     C************                                                  S01195056031
     C**SET*UP*LOCATION CODE OF PARTY FOR CALL TO ZCHKH IN SR AMOVTSS01195056031
     C**IF*PARTY*IS NOSTRO CODE IS NLOC ELSE USE SYSTEM LOCATION.   S01195056031
     C************                                                  S01195056031
     C************IN88     IFEQ '1'                                 S01195056031
     C************         MOVE BJSLCD    ZLOC                      S01195056031
     C************         MOVE 'S'       NOWRK   3                 S01195056031
     C************         ELSE                                     S01195056031
     C************IN88     IFEQ '0'                                 S01195056031
     C***********DLIND     ANDNE'Y'                                 S01195056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C************         END                                      S01195056031
     C************         END                                      S01195056031
     C************                                                  S01195056031
     C************                                                        056031
     C***IF*RETAIL,BUT NOT NOSTRO UPDATE ACCOUNT                          056031
     C***MOVEMENT*ENQUIRIES HERE                                          056031
     C************                                                        056031
     C************IN88     IFEQ '1'                                       056031
     C************                                                        056031
     C***OR*IF*RETAIL NOSTRO,BUT DEALING MODULE NOT PRESENT,UPDATE.       056031
     C************                                                        056031
     C************IN88     OREQ '0'                                       056031
     C***********DLIND     ANDNE'Y'                                       056031
     C************         Z-ADDDDRVD     VUDT                            056031
     C************         Z-ADDAMOUNT    MVAM                            056031
     C************         EXSR AMOVTS                                    056031
     C************         END                                            056031
     C************                                                        056031
     C***********ENDMMD    ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****OLPOSD*- SR TO PROCESS OLPOS UPDATE FOR CHEQUE DETAIL          056031
     C************                                                        056031
     C***********OLPOSD    BEGSR                                          056031
     C************         Z-ADD0         CQPYVD 130                      056031
     C************                                                        056031
     C*****ACCESS*RECORD, IF NOT FOUND THIS IS A NEW CCY RETURN TO CALLER 056031
     C************                                                        056031
     C************         MOVELDRCY      OLPOSC                          056031
     C************         Z-ADD01        OLPOSN                          056031
     C************         MOVE BRCH      OLPOSB                    S01117056031
     C***********OLPOSK    CHAINOLPOS                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************                                                        056031
     C************IN99     IFEQ '0'                        ** B01         056031
     C************                                                        056031
     C**IF*DATE*LESS THAN FIRST DATE IGNORE AND RELEASE                   056031
     C***********DRVD      IFLT OLD,1                      ** B02         056031
     C************         EXCPTROLPOS                                    056031
     C************         ELSE                                           056031
     C***********DRVD      IFGT OLD,16                     ** B02         056031
     C************         ADD  AMOUNT    OIN,16                          056031
     C************         MOVE LCHT      TNLU                            056031
     C************         UPDATOLPOSOAF                                  056031
     C************         ELSE                            ** X02         056031
     C************                                                        056031
     C*****...OTHERWISE UPDATE FIGURE EQUAL TO OR JUST BEFORE VALUE DAT   056031
     C************                                                        056031
     C************         Z-ADD1         X                               056031
     C***********DRVD      LOKUPOLD,X                  8384               056031
     C************IN83     IFEQ '1'                        ** B03         056031
     C************IN84     OREQ '1'                                       056031
     C************         ADD  AMOUNT    OIN,X                           056031
     C************         MOVE LCHT      TNLU                            056031
     C************         UPDATOLPOSOAF                                  056031
     C************         END                             ** E03         056031
     C************                                                        056031
     C************         END                             ** E02         056031
     C************         END                             ** E02         056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C************         ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****PRONOD*- SR TO PROCESS PRONO UPDATE FOR A CHEQUE DETAIL        056031
     C************                                                        056031
     C***********PRONOD    BEGSR                                          056031
     C************                                                        056031
     C****IF*DEBIT PARTY IS A NOSTRO ACCESS PRONO USING DEBIT CURRENCY    056031
     C******AND*DEBIT PARTY , IF NOT FOUND ACCESS PRONO USING NOSTRO      056031
     C******NOSTRO NUMBER OF ZERO, IF NOT FOUND EXIT SUBROUTINE           056031
     C************                                                        056031
     C***********DRPT      IFNE 'N'                        ** B01         056031
     C**CHECK*FOR*POSSIBLE ACCOUNT NOSTROS                                056031
     C************         MOVE DRPT      NTYPE                           056031
     C************         MOVELDRPY      RTNO                            056031
     C************         MOVE DRCY      NCCY                            056031
     C************         MOVE DRBR      BRCANP                    S01117056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVE NOSN      PRONON                          056031
     C************         MOVE CCY       PRONOC                          056031
     C************         ELSE                                           056031
     C************         SETON                     85                   056031
     C************                                                        056031
     C************         MOVE DRCY      PRONOC                          056031
     C************         MOVELDRPY      PRONON                          056031
     C************         END                                            056031
     C**IF*NOSTRO*                                                        056031
     C***85*******         DO                                             056031
     C***STORE*ORIGINAL NOSTRO NO. IN CASE UNALLOCATED NOSTRO NO USEE32536056031
     C************                                                  E32536056031
     C************         Z-ADDPRONON    NOSOR                     E32536056031
     C************                                                        056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************IN99     IFEQ '1'                        ** B01         056031
     C************                                                        056031
     C************         Z-ADD0         PRONON                          056031
     C***********PRONOK    CHAINPRONO                99                   056031
     C**N99******RECI      COMP 'D'                  9999                 056031
     C************                                                        056031
     C************IN99     IFEQ '1'                        ** B02         056031
     C************         GOTO ENDPRD                                    056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C*****IF*DEBIT VALUE DATE IS GREATER THAN 5TH PRONO DATE RETURN      056031
     C*******TO*CALLER, ELSE ADD CHEQUE AMTOUNT EQUIVALENT FROM EACH      056031
     C*******FIGURE CORRESPONDING TO A PRONO DATE .GE. PAY VALUE DATE.    056031
     C*****IF*PAY*VALUE DATE IS BETWEEN 2 PRONO DATES ADD                 056031
     C*******CHEQUE AMOUNT EQUIVALENT FROM PRECEEDING FIGURE ALSO         056031
     C************                                                        056031
     C***********DRVD      IFGT PDT,5                      ** B01         056031
     C************         EXCPTRPRONO                                    056031
     C************         GOTO ENDPRD                                    056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         Z-ADDPNV       PNO                             056031
     C************                                                        056031
     C***********1         DO   5         X                ** B01         056031
     C************                                                        056031
     C***********X         SUB  1         XX      10                      056031
     C***********XX        IFEQ 0                          ** B02         056031
     C************         Z-ADD1         XX                              056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C***********PDT,X     IFEQ DRVD                       ** B02         056031
     C************         ADD  AMOUNT    PNV,X                           056031
     C************         END                             ** E02         056031
     C************                                                        056031
     C***********PDT,X     IFGT DRVD                       ** B02         056031
     C***********PDT,XX    ANDLTDRVD                                      056031
     C************         ADD  AMOUNT    PNV,X                           056031
     C************         ADD  AMOUNT    PNV,XX                          056031
     C************         ELSE                            ** X02         056031
     C************                                                        056031
     C***********PDT,X     IFGT DRVD                       ** B03         056031
     C************         ADD  AMOUNT    PNV,X                           056031
     C************         END                             ** E03         056031
     C************         END                             ** E02         056031
     C************         END                             ** E01         056031
     C************                                                        056031
     C************         UPDATPRONOPNF                                  056031
     C************         Z-ADDDRVD      VUDT                            056031
     C************         Z-ADDAMOUNT    MVAM                            056031
     C************         SETON                     87                   056031
     C***IN*CASE*UNALLOCATED NOSTRO USED FOR PRONO REINSTATE ORIGINAE32536056031
     C***NOSTRO*NUMBER TO PREVENT DB ERROR IN AMOVTS                E32536056031
     C************                                                  E32536056031
     C************         Z-ADDNOSOR     NOSN                      E32536056031
     C************         EXSR AMOVTS                                    056031
     C************         END                                            056031
     C************                                                        056031
     C***********ENDPRD    ENDSR                                          056031
     C********************************************************************056031
     C*EJECT******                                                        056031
     C************************************************************        056031
     C**AMOVT*SUBROUTINE - TO WRITE TO ACCOUNT MOVEMENTS FILE             056031
     C************************************************************        056031
     C************                                                        056031
     C***********AMOVTS    BEGSR                                          056031
     C************                                                        056031
     C***IF*PRONO*RECORD PROCESSED                                        056031
     C************                                                        056031
     C************IN87     IFEQ '1'                        B001           056031
     C************                                                        056031
     C***ACCESS*FULL A/C DETAILS                                          056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM '*DBERR ' @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM *BLANKS   @CUST                     S01194056031
     C************         PARM CCY       @CYCD                     S01194056031
     C************         PARM *BLANKS   @ACCD                     S01194056031
     C************         PARM *BLANKS   @ACSN                     S01194056031
     C************         PARM NOSNA     @NONB                     S01194056031
     C************         PARM *BLANKS   @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C************         EXSR MVNOST                              S01194056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************                                                  S01194056031
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'70'      KEY                             S01194
     C*********************MOVELCCY       NOSWRK  5                       S01194
     C*********************MOVE NOSN      NOSWRK                          S01194
     C*********************MOVE NOSWRK    KEY                             S01194
     C***********KEY*******CHAINTABLETLF             75                   S01194
     C**N75******RECI******COMP 'D'                  7575                 S01194
     C*********************                                               S01194
     C************IN75*****IFEQ '1'                                       S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0080  'DBPGM                           S01194
     C*********************MOVE 'TABLETL' DBFILE           ***************S01194
     C*********************Z-ADD33        DBASE            * DB ERROR 33 *S01194
     C*********************MOVELZTABKY    DBKEY            *********** ***S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E002           S01194
     C************                                                        056031
     C************         XFOOTPNO       TOT1   150                      056031
     C************         XFOOTPNV       TOT2   150                      056031
     C**IF*NOSTRO*BALANCES INCREASED                                      056031
     C***********TOT1      IFLT TOT2                       B002           056031
     C************         MOVE '0'       DORC                            056031
     C************         ELSE                            X002           056031
     C**IF*NOSTRO*BALANCES DECREASED                                      056031
     C***********TOT1      IFGT TOT2                       B003           056031
     C************         MOVE '1'       DORC                            056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C***IF*MEMO*RECORD PROCESSED                                         056031
     C************                                                        056031
     C************         ELSE                            X001           056031
     C**IF*LEDGER*BALANCE INCREASED                                       056031
     C***********LDBLWK    IFLT LDBLN                      B002           056031
     C************         MOVE '0'       DORC                            056031
     C************         ELSE                            X002           056031
     C**IF*LEDGER*BALANCE DECREASED                                       056031
     C***********LDBLWK    IFGT LDBLN                      B003           056031
     C************         MOVE '1'       DORC                            056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE VUDT      PTDT                            056031
     C**SETUP*VALUE DATE OF ENTRY                                         056031
     C************IN94*****DOUNE'1'                        B001           S01194
     C*********************SETOF                       9394               S01194
     C*********************MOVE *BLANKS   ZTABKY                          S01194
     C*********************MOVE '22'      ZTAB01                          S01194
     C*********************MOVE PTDT      ZTAB07                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C***********ZTABKY****CHAINTABLETJF             93                   S01194
     C**N93******RECI******COMP '*'                      93               S01194
     C************IN93*****IFEQ '0'                        B002           S01194
     C*********************MOVEAHCCY      HCC                             S01194
     C***********CCY*******LOKUPHCC,1                    94               S01194
     C************IN94*****IFEQ '1'                        B003           S01194
     C************                                                  S01195056031
     C**IF*THE*PARTY INVOLVED IS A NOSTRO (EITHER DIRECTLY ENTERED  S01195056031
     C**OR*BACKGROUND) USE RELEVANT CCY AND NOSTRO LOCATION CODE, ELS01195056031
     C**USE*SYSTEM LOCATION AND LOCAL CURRENCY                      S01195056031
     C************                                                  S01195056031
     C***********NOWRK     IFEQ 'N'                                 S01195056031
     C************IN87     OREQ '1'                                 S01195056031
     C************         MOVE CCY       ZCCY                      S01195056031
     C************         ELSE                                     S01195056031
     C************         MOVE BJLCCY    ZCCY                      S01195056031
     C************         END                                      S01195056031
     C************                                                  S01195056031
     C***********ZIND      DOUNE'H'                                 S01194056031
     C************         MOVE PTDT      ZDAYNO                    S01194056031
     C************         EXSR ZCHKH                               S01194056031
     C***********ZIND      IFEQ 'H'                                 S01194056031
     C************         SUB  1         PTDT                            056031
     C*********************END                             E003           S01194
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         Z-ADDCNUM      CUSN                            056031
     C************         MOVE CCY       CCYD                            056031
     C************         Z-ADDACOD      ACDE                            056031
     C************         Z-ADDACSQ      ASNC                            056031
     C************         MOVE PYTP      TRYP                            056031
     C************         MOVE PREF      TNMR                            056031
     C************         MOVE PREF      FUND                      E32880056031
     C************                                                        056031
     C**AS*DORC*CONTROLS DEBIT/CREDIT,ENTRY MUST ALWAYS BE                056031
     C**INHERENTLY POSITIVE                                               056031
     C************                                                        056031
     C***********MVAM      IFLT *ZERO                                     056031
     C************         Z-SUBMVAM      MVAM                            056031
     C************         END                                            056031
     C**WRITE*DETAILS TO FILE                                             056031
     C************         WRITERSACMTPO                                  056031
     C************         SETOF                     879394               056031
     C************                                                        056031
     C************         ENDSR                                          056031
     C************************************************************        056031
     C*EJECT******                                                        056031
     C************************************************************        056031
     C**NOSTRO*SR.                                                        056031
     C**CHECKS*FOR ACCOUNT ENTRIES BEING NOSTROS                          056031
     C************                                                        056031
     C***********NOSTRO    BEGSR                                          056031
     C************                                                        056031
     C************         SETOF                     85                   056031
     C**IF*TYPE*NOT R,P OR G IGNORE                                       056031
     C***********NTYPE     IFEQ 'R'                        B001           056031
     C***********NTYPE     OREQ 'P'                                       056031
     C***********NTYPE     OREQ 'G'                                       056031
     C**IF*RETAIL*NUMBER READ ACNUMA TO GET ACCOUNT DETAILS               056031
     C***********NTYPE     IFEQ 'R'                        B002           056031
     C************         Z-ADDACNON     ACNO                            056031
     C***********ACNO      CHAINACNUMA               89                   056031
     C**N89******RECI      COMP 'D'                  8989                 056031
     C***89*******         DO                              B003           056031
    C************         MOVEL'ACNUM'   WDBFIL             ************ 056031
    C************         Z-ADD34        WDBASE             * DBERR 34 * 056031
    C************         MOVELACNO      WDBKEY             ************ 056031
    C************         EXSR ENDPGM                                    056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C**IF*PARTIAL ACCOUNT FORMAT ACCOUNT NUMBER                          056031
     C***********NTYPE     IFEQ 'P'                        B002           056031
     C************         Z-ADDCNUMN     CNUM                            056031
     C************         MOVE NCCY      CCY                             056031
     C************         Z-ADDACODNP    ACOD                            056031
     C************         Z-ADDACSQNP    ACSQ                            056031
     C************         MOVE BRCANP    ACNTBR                    S01194056031
     C************         END                             E002           056031
     C**IF*FULL*ACCOUNT FORMAT ACCOUNT NUMBER                             056031
     C***********NTYPE     IFEQ 'G'                        B002           056031
     C************         Z-ADDCNUMN     CNUM                            056031
     C************         MOVE CCYN      CCY                             056031
     C************         Z-ADDACODN     ACOD                            056031
     C************         Z-ADDACSQN     ACSQ                            056031
     C************         MOVE BRCAN     ACNTBR                    S01194056031
     C************         END                             E002           056031
     C************         Z-ADDCNUM      ACNTCN                          056031
     C************         MOVE CCY       ACNTCY                          056031
     C************         Z-ADDACOD      ACNTAC                          056031
     C************         Z-ADDACSQ      ACNTAS                          056031
     C**READ*TABLETL*TO*SEE*IF*A*NOSTRO**********                         S01194
     C**READ*TABLETL TO SEE IF A NOSTRO                             S01194056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD                     S01194056031
     C************         PARM '*KEY   ' @OPTN                     S01194056031
     C************         PARM ACNCNA    @CUST                     S01194056031
     C************         PARM ACNTCY    @CYCD                     S01194056031
     C************         PARM ACNACA    @ACCD                     S01194056031
     C************         PARM ACNASA    @ACSN                     S01194056031
     C************         PARM *BLANKS   @NONB                     S01194056031
     C************         PARM ACNTBR    @BRCD                     S01194056031
     C************         PARM *BLANKS   @CSSN                     S01194056031
     C************         PARM *BLANKS   @PNOI                     S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVFPRT     898985         S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
     C************         END                             E001     S01194056031
     C************         ENDSR                                    S01194056031
     C*********************                                               S01194
     C***********ACCNTK****CHAINFPRTNF               89                   S01194
     C**N89******RECI******COMP 'D'                  8989                 S01194
     C**N89****************SETON                     85                   S01194
     C*********************END                             E001           S01194
     C*********************ENDSR                                          S01194
     C************************************************************        056031
     C**END*OF*NOSTRO SUBROUTINE                                          056031
     C************************************************************        056031
     C/EJECT
     C********************************************************************S01199
     C**HELP SR.                                                          S01199
     C**CALLS HELP  PROGRAM                                               S01199
     C**                                                                  S01199
     C**         HELP      BEGSR                                          S01199
     C**                   MOVEAERCD      HERCD 160                       S01199
     C**                   MOVEL'FT0000'  HBPGM   6                       S01199
     C**                   CALL 'MHELP'                                   S01199
     C**                   PARM           HBPGM                           S01199
     C**                   PARM           HERCD                           S01199
     C**                   SETOF                     01                   S01199
     C**                   ENDSR                                          S01199
    C********************************************************************S01199
    C/EJECT
    C********************************************************************
    C*********************                                               S01194
    C*****SUB-ROUTINE*TO*CHAIN*TO*TABLE*FILE.****************            S01194
    C*********************                                               S01194
    C***********TABCHN****BEGSR                                          S01194
    C*********************                                               S01194
    C***********ZTABKY****CHAINTABFP                89                   S01194
    C**N89******RECI******COMP 'D'                  8989                 S01194
    C*********************                                               S01194
    C*********************ENDSR                                          S01194
    C*********************                                               S01194
    C********************************************************************
    C/SPACE 6
    C********************************************************************
    C*
    C**   SUB-ROUTINE TO CHAIN TO CURRENCIES TABLE
    C*
    C           CCYCHN    BEGSR
    C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @CCY      @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C                     EXSR MVCURR                                    S01194
     C*                                                                   S01194
     C*********************                                               S01194
    C*********************MOVE '20'      ZTAB01                          S01194
    C***********ZTABKY****CHAINTABFP                89                   S01194
    C**N89******RECI******COMP 'D'                  8989                 S01194
    C************IN89*****IFEQ '1'                        ** B01         S01194
    C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
    C*********************Z-ADD25        WDBASE             * DBERR 25 * S01194
    C*********************MOVELZTABKY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
    C*********************END                             ** E01         S01194
    C*********************                                               S01194
    C                     ENDSR
    C*
    C********************************************************************
    C/EJECT
    C********************************************************************
    C*
    C**   SUB-ROUTINE TO CHAIN TO ACCOUNTS FILE - LF/ACCNT
    C*
    C           ACCCHN    BEGSR
    C*
    C           ACCNTK    CHAINACCNT                99
    C  N99      RECI      COMP 'D'                  9999
    C*
    C           *IN99     IFEQ '1'                        ** B01
    C                     MOVE 'ACCNT'   WDBFIL             ************
    C                     Z-ADD26        WDBASE             * DBERR 26 *
    C                     MOVELACNTKY    WDBKEY             ************
    C                     EXSR ENDPGM
    C                     END                             ** E01
    C*
    C                     ENDSR
    C*
    C********************************************************************
    C/SPACE 6
      ************                                                        056031
      ************ Remove PRONO, OLPOS and MEMOS                          056031
      ************                                                        056031
    C********************************************************************056031
    C************                                                        056031
    C*****SUB-ROUTINE TO CHAIN TO RETAIL ACCOUNTS FILE - LF/ACNUMA       056031
    C************                                                        056031
    C***********ACNCHN    BEGSR                                          056031
    C************                                                        056031
    C***********RETAIL    CHAINACNUMA               99                   056031
    C**N99******RECI      COMP 'D'                  9999                 056031
    C************                                                        056031
    C************IN99     IFEQ '1'                        ** B01         056031
    C************         MOVE 'ACNUM'   WDBFIL             ************ 056031
    C************         Z-ADD27        WDBASE             * DBERR 27 * 056031
    C************         MOVELRETAIL    WDBKEY             ************ 056031
    C************         EXSR ENDPGM                                    056031
    C************         END                             ** E01         056031
    C************                                                        056031
    C************         ENDSR                                          056031
    C************                                                        056031
    C********************************************************************056031
    C/EJECT
     C********************************************************************
     C*********************                                               E29826
     C*****GETCCY*-*SR*TO*GET*CCY*DETAILS*FOR*PAY*&*DEBIT*CURRENCIES      E29826
     C*********************                                               E29826
     C***********GETCCY****BEGSR                                          E29826
     C*********************                                               E29826
     C*****DEFINE*INPUT*PARAMETER                                         E29826
     C*********************                                               E29826
     C*********************MOVELCFLAG     CFLAG   1                       E29826
     C*********************                                               E29826
    C*********************MOVEL*BLANKS   ZTABKY                          E29826
    C*********************                                               E29826
     C*****IF*NEEDED*OBTAIN AND STORE DETAILS FOR PAY CCY                 E29826
     C*********************                                               E29826
     C***********CFLAG*****IFEQ 'R'                        ** B01         E29826
     C***********CFLAG*****OREQ 'B'                                       E29826
    C*********************                                               E29826
    C*********************MOVE '1'       ZTAB12                          E29826
    C*********************MOVE PCCY      ZTAB09                          E29826
    C*********************EXSR CCYCHN                                    E29826
    C*********************                                               E29826
     C*********************Z-ADDSPOT      PCCYSP                          E29826
     C*********************Z-ADDMDIN      PCCYMD                          E29826
     C*********************Z-ADDCDP       PCCYDP                          E29826
     C*********************                                               E29826
     C*********************MOVE '4'       ZTAB12                          E29826
    C*********************EXSR CCYCHN                                    E29826
    C*********************                                               E29826
     C*********************Z-ADDBSPR      BSPRRE                          E29826
     C*********************MOVE BSSG      BSSGRE                          E29826
     C*********************Z-ADDSSPR      SSPRRE                          E29826
     C*********************MOVE SSSG      SSSGRE                          E29826
     C*********************                                               E29826
     C*********************END                             ** E01         E29826
     C*********************                                               E29826
     C*****IF*NEEDED*OBTAIN AND STORE DETAILS FOR DEBIT CCY               E29826
     C*********************                                               E29826
     C***********CFLAG*****IFEQ 'D'                        ** B01         E29826
     C***********CFLAG*****OREQ 'B'                                       E29826
     C*********************                                               E29826
     C*********************MOVE DRCY      ZTAB09                          E29826
     C*********************MOVE '4'       ZTAB12                          E29826
    C*********************EXSR CCYCHN                                    E29826
    C*********************                                               E29826
     C*********************Z-ADDBSPR      BSPRDR                          E29826
     C*********************MOVE BSSG      BSSGDR                          E29826
     C*********************Z-ADDSSPR      SSPRDR                          E29826
     C*********************MOVE SSSG      SSSGDR                          E29826
     C*********************                                               E29826
     C*********************MOVE '1'       ZTAB12                          E29826
    C*********************EXSR CCYCHN                                    E29826
    C*********************                                               E29826
     C*********************Z-ADDSPOT      DRCYSP                          E29826
     C*********************Z-ADDMDIN      DRCYMD                          E29826
     C*********************Z-ADDCDP       DRCYDP                          E29826
     C*********************                                               E29826
     C*********************END                             ** E01         E29826
     C*********************                                               E29826
     C*********************ENDSR                                          E29826
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    DAFDAT - SR TO PRODUCE THREE REQUIRED DAF FORMATS OF A DAT
     C**
     C           DAFDAT    BEGSR
     C*
     C                     Z-ADDDAFD0     DAFD0   50
     C*
     C                     Z-ADDDAFD0     ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDZDATE     DAFD1   60
     C*
     C           DAFD0     IFLE 10227                      ** B01
     C                     Z-ADD19        DAFD2   20
     C                     ELSE                            ** X01
     C                     Z-ADD20        DAFD2   20
     C                     END                             ** E01
     C*
     C                     Z-ADDDAFD1     DAFDIN
     C                     MOVE DAFDI3    DAFDO1
     C           *IN98     IFEQ '0'                        ** B01
     C                     MOVE DAFDI1    DAFDO3
     C                     MOVE DAFDI2    DAFDO2
     C                     ELSE                            ** X01
     C                     MOVE DAFDI1    DAFDO2
     C                     MOVE DAFDI2    DAFDO3
     C                     END                             ** E01
     C*
     C                     Z-ADDDAFDOT    DAFD3   60
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    XCONVT - SR TO CONVERT BETWEEN CURRENCIES
     C**
     C           XCONVT    BEGSR
     C*
     C                     Z-ADDXAMNT1    XAMNT1 130       FROM VALUES
     C                     Z-ADDXSPOT1    XSPOT1 138
     C                     Z-ADDXMDIN1    XMDIN1  10
     C                     Z-ADDXCDP1     XCDP1   10
     C*
     C                     Z-ADDXAMNT2    XAMNT2 130       TO VALUES
     C                     Z-ADDXSPOT2    XSPOT2 138
     C                     Z-ADDXMDIN2    XMDIN2  10
     C                     Z-ADDXCDP2     XCDP2   10
     C**
     C*    CALCULATE CROSS RATE
     C**
     C           XMDIN1    IFNE XMDIN2                     ** B01
     C           XSPOT1    MULT XSPOT2    XSPOT  138
     C                     END                             ** E01
     C*
     C           XMDIN1    IFEQ XMDIN2                     ** B01
     C           XSPOT1    DIV  XSPOT2    XSPOT  138
     C                     END                             ** E01
     C**
     C*    CALCULATE SCALING FACTOR (CDP DIFFERRNECE)
     C**
     C           XCDP2     SUB  XCDP1     Z       10
     C                     ADD  4         Z
     C**
     C*    SCALE CROSS RATE TO ALLOW FOR DIFFERENT CDP
     C**
     C           XMDIN1    IFEQ 0                          ** B01
     C           POWER,Z   DIV  XSPOT     XRATE  159
     C                     ELSE                            ** X01
     C           POWER,Z   MULT XSPOT     XRATE  159
     C                     END                             ** E01
     C**
     C*    CALCULATE NEW AMOUNT
     C**
     C           XAMNT1    MULT XRATE     XAMNT2    H
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    EDIT   SR - TO EDIT FIELDS FOR LEADINGS ZEROS AND DECIMAL POINT
     C*
     C           EDIT      BEGSR
     C**
     C*   NUMERIC INPUT WILL BE IN AN ALPHA, PUT INTO ARRAY FOR PROCESSING
     C**
     C                     MOVE EDITIN    EDITIN 13
     C                     MOVEA*BLANKS   DIG2
     C                     MOVEA*BLANKS   DIG1
     C                     MOVEAEDITIN    DIG1
     C**
     C*    FIND WHERE DECIMAL POINT SHOULD BE
     C**
     C***********13********SUB  CDP       DP      30                      S01194
     C           13        SUB  A6NBDP    DP      30                      S01194
     C                     Z-ADD14        X       30
     C                     Z-ADD13        Y       30
     C**
     C*    IF NO DECIMAL PLACES RIGHT JUSTIFY FIELD
     C**
     C***********CDP*******IFEQ 0                          ** B01         S01194
     C           A6NBDP    IFEQ 0                          ** B01         S01194
     C                     Z-ADD0         Y
     C                     MOVEADIG1,1    DIG2,2
     C                     END                             ** E01
     C**
     C*    LOOP TO MOVE DIGITS TO EDITED FIELD
     C**
     C           Y         DOWGT0                          ** B01
     C           Y         IFEQ DP                         ** B02
     C                     MOVE '.'       DIG2,X
     C                     SUB  1         X
     C                     END                             ** E02
     C                     MOVE DIG1,Y    DIG2,X
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     END                             ** E01
     C**
     C*    IF NO DECIMAL PLACES ZERO SUPPRESSION NEEDS TO GO FURTHER
     C**
     C***********CDP*******IFEQ 0                          ** B01         S01194
     C           A6NBDP    IFEQ 0                          ** B01         S01194
     C                     Z-ADD14        DP
     C                     END                             ** E01
     C**
     C*    LOOP TO SUPPRESS LEADING ZEROS
     C**
     C                     Z-ADD1         X
     C           X         DOUEQDP                         ** B01
     C           DIG2,X    IFEQ ' '                        ** B02
     C           DIG2,X    OREQ '0'
     C                     MOVE ' '       DIG2,X
     C                     ADD  1         X
     C                     ELSE                            ** X02
     C                     Z-ADDDP        X
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C*    INITIAL PROCESSING
     C**
     C           SETUP     BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         O                               056031
     C                     MOVEL'SETUP'   @STK,O                          056031
     C*
     C           *LIKE     DEFN DBFILE    WDBFIL
     C           *LIKE     DEFN DBKEY     WDBKEY
     C           *LIKE     DEFN DBASE     WDBASE
     C           *LIKE     DEFN SACTD     SLINK
     C*                                                                   S01117
     C** ACCESS RUNDAT AND ZMUSER TO PICKUP @MBIN AND @DFBR               S01117
     C*                                                                   S01117
     C                     IN   ZMUSER                                    S01117
     C                     IN   RUNDAT                                    S01117
     C*                                                                   S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     SETON                     38                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**
     C*****ACCESS*I.C.D.R*1*ON*TABLE*FILE*FOR*SYSTEM*RUN*DATE             S01194
     C*******MONITORING*FOR*DATABASE*ERROR*******************             S01194
     C*********************                                               S01194
     C*********************MOVE '01'      ZTAB01                          S01194
     C*********************MOVE '10'      ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
     C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
     C*********************Z-ADD1         WDBASE             * DBERR 01 * S01194
     C*********************MOVELZTABKY    WDBKEY             ************ S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C*                                                                   S01194
     C**ACCESS SDBANKPD FOR ICD DETAILS                                   S01194
     C*                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C** SET UP SCREEN DATE FIELD                                         S01194
     C*                                                                   S01194
     C                     MOVE BJMRDT    SRUNA                           S01194
     C**
     C*    CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C**
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C***********DATF******COMP 'M'                      98MMDDYY, 98 ON  S01194
     C**
     C*****ACCESS*I.C.D.R.*2 ON TABLE FILE TO OBTAIN BASE CCY             S01194
     C*******MONITORING*FOR DATABASE ERROR                                S01194
     C*********************                                               S01194
     C*********************MOVE '11'      ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
     C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
     C*********************Z-ADD2         WDBASE             * DBERR 02 * S01194
     C*********************MOVELZTABKY    WDBKEY             ************ S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C*                                                                   S01194
     C** ACCESS SDGELRPD FOR ORIGINATING BRANCH DETAILS                   S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01414
      * If return code is not blank - process for a database error        S01414
      *                                                                   S01414
     C           @RTCD     IFNE *BLANKS                                   S01414
     C                     MOVEL'SDGELRPD'W0FILE           *************  S01414
     C                     Z-ADD36        W0ERNB           * DBERR 36  *  S01414
     C                     MOVEL@OPTN     W0KEY            *************  S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
     C*                                                                   S01194
     C*SWITCH ON ORIGINATING BR  DISPLAY FLAG.                            S01194
     C*                                                                   S01194
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C           @MBIN     ANDEQ'Y'
     C                     SETON                     36                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*ACCESS FT ICD FILE SDFTFRPD                                        S01194
     C*                                                                   S01194
     C                     CALL 'AOFTFRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDFTFR    PARM SDFTFR    DSFDY                           S01194
     C*                                                                   S01194
     C           BJRDNB    SUB  BJBVPD    BVLD    50                      S01194
     C***********RUND******SUB  BVLP      BVLD    50                      S01194
      *                                                                   056031
      * Access FT Control data                                            056031
      *                                                                   056031
     C                     CALL 'FT0005'               9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C           C#CNTL    PARM           O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'FT0005'  W0KEY                           056031
     C                     Z-ADD1         W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
      *                                                                   056031
      * Set up FT override for General Ledger Balances                    056031
      *                                                                   056031
     C           C#GLUI    IFEQ 'I'                                       056031
     C                     MOVEL'Y'       ##FTOV  1                       056031
     C                     ELSE                                           056031
     C                     MOVEL*BLANKS   ##FTOV                          056031
     C                     END                                            056031
     C*                                                                   S01194
     C*****ACCESS*TABTB20*TO*SEE*IF*RETAIL*ACCOUNT*NUMBERS*ARE****        S01194
     C*****ALLOWED,*AND*MONITOR*FOR*ANY*DATABASE*ERROR************        S01194
     C*********************                                               S01194
     C*********************MOVE '20'      ZTAB11                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
     C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
     C*********************Z-ADD35        WDBASE             * DBERR 35 * S01194
     C*********************MOVELZTABKY    WDBKEY             ************ S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C**
      * SEE IF WINDOW IS REQUIRED                                         084499
      *                                                                   084499
     C           1         SETLLSDMMODPD                                  084499
     C                     READ SDMMODPD               8989               084499
     C           *IN89     IFEQ '1'                                       084499
     C                     MOVEL'SDMMOD'  WDBFIL                          084499
     C                     MOVEL'FRT'     WDBKEY           ************** 084499
     C                     Z-ADD99        WDBASE           ** DBASE 99 ** 084499
     C                     EXSR ENDPGM                     ************** 084499
     C                     END                                            084499
      *                                                                   CAC001
      **  If Analytical Accounting module is switched on, enable F19      CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE *ON       *IN35                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01194
     C*                                                                   S01117
     C** ACCESS SDRETLPD TO SEE IF RETAIL ACCOUNT NOS ALLOWED.            S01194
     C** ONLY IF RETAIL SWITCHED ON.                                      084499
     C*                                                                   S01194
     C           BGRTBN    IFEQ 'Y'                                       084499
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR'  @RTCD                           S01194
     C                     PARM '*FIRST'  @OPTN                           S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
     C                     END                                            084499
     C*                                                                   S01194
     C*  IF DL IN SYSTEM ACCESS TABTB40 TO OBTAIN US DOLLAR CURRENCY COD
     C**
     C********** *LOCK     IN   MMOD                                      050920
     C**********           OUT  MMOD                                      050920
     C                     IN   MMOD                                      050920
     C           DLIND     IFEQ 'Y'                        ** B01
     C*                                                                   S01194
     C** Read SDTRADPD for sterling currency code                         S01194
     C*                                                                   S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*DBERR'  @RTCD                           S01194
     C                     PARM '*FIRST'  @OPTN                           S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C*                                                                   S01194
     C                     END                                            S01194
     C*********************                                               S01194
     C***********1*********CHAINTABTB40              99                   S01194
     C************IN99*****IFEQ '1'                        ** B02         S01194
     C*********************MOVEL'TABLE'   WDBFIL             ************ S01194
     C*********************Z-ADD3         WDBASE             * DBERR 03 * S01194
     C*********************MOVE *BLANKS   ERRMSG             ************ S01194
     C*********************MOVE 'DEALING 'ERMSG1                          S01194
     C*********************MOVE 'ICD - TA'ERMSG2                          S01194
     C*********************MOVEL'BTB40'   ERMSG3                          S01194
     C*********************MOVELERRMSG    WDBKEY                          S01194
     C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E02         S01194
     C*********************                                               S01194
     C*********************END                             ** E01         S01194
     C**
     C****CHAIN*TO*CURRENCY*RECORD*ON*TABLE*FILE*FOR*BASE*CURRENCY*DETAILSS01194
     C*   CHAIN TO CURRENCY RECORD ON SDCURRPD FOR BASE CURRENCY DETA  ILSS01194
     C*      MONITORING FOR DATABASE ERROR
     C**
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM BJCYCD    @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C                     EXSR MVCURR
     C*                                                                   S01194
     C*********************                                               S01194
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVE '20'      ZTAB01                          S01194
     C*********************MOVE BCCY      ZTAB09                          S01194
     C*********************MOVE '1'       ZTAB12                          S01194
     C*********************EXSR TABCHN                                    S01194
     C*********************                                               S01194
     C************IN89*****IFEQ '1'                        ** B01         S01194
    C*********************MOVEL'TABFP'   WDBFIL             ************ S01194
    C*********************Z-ADD4         WDBASE             * DBERR 04 * S01194
    C*********************MOVELZTABKY    WDBKEY             ************ S01194
    C*********************EXSR ENDPGM                                    S01194
     C*********************END                             ** E01         S01194
     C*
     C**   STORE BASE CCY DETAILS
     C*
     C*********************Z-ADDSPOT      BCCYSP                          S01194
     C                     Z-ADDA6SPRT    BCCYSP                          S01194
     C*********************Z-ADDCDP       BCCYDP                          S01194
     C                     Z-ADDA6NBDP    BCCYDP                          S01194
     C                     Z-ADDMDIN      BCCYMD
     C                     MOVE BJCYCD    SBCCY1                          S01194
     C                     MOVE BJCYCD    SBCCY2                          S01194
     C*********************MOVE BCCY      SBCCY1                          S01194
     C*********************MOVE BCCY      SBCCY2                          S01194
     C**
     C**   BUILD UP CURRENCIES/DEC. POSITIONS ARRAYS
     C**   FROM SDCURRPD                                                  S01194
     C*****FROM*TABTG20****                                               S01194
     C*                                                                   S01194
     C                     Z-ADD1         B       30                      S01194
     C                     MOVE '0'       WIN35   1                       CAC001
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C                     PARM *BLANKS   @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C***********          SETON                     35            S01194 CAC001
     C                     MOVE '1'       WIN35                           CAC001
     C                     ELSE                                           S01194
     C                     EXSR MVCURR                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C************IN35     DOWEQ'0'                        B001    S01194 CAC001
     C           WIN35     DOWEQ'0'                        B001           CAC001
     C*                                                                   S01194
     C                     MOVE A6CYCD    CCYA,B                          S01194
     C                     Z-ADDA6NBDP    CDPA,B                          S01194
     C*                                                                   S01194
     C** CONVERSION BETWEEN SD AND TABLE FILE VALUES                      S01194
     C*                                                                   S01194
     C           A6MDIN    IFEQ 'M'                        B002           S01194
     C                     Z-ADD1         MDA,B                           S01194
     C                     ELSE                                           S01194
     C                     Z-ADD0         MDA,B                           S01194
     C                     END                             E002           S01194
     C*                                                                   S01194
     C                     Z-ADDA6SPRT    SPTA,B                          S01194
     C*                                                                   S01194
     C                     ADD  1         B                               S01194
     C*                                                                   S01194
     C           B         IFGT 150                        B003           S01194
     C***********          SETON                     35            S01194 CAC001
     C                     MOVE '1'       WIN35                           CAC001
     C                     END                             E003           S01194
     C*                                                                   S01194
     C** ACCESS NEXT RECORD IN FILE IF EOF SETON 35                       S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*NEXT  ' @OPTN                           S01194
     C                     PARM *BLANKS   @CYCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                    B004           S01194
     C***********          SETON                     35            S01194 CAC001
     C                     MOVE '1'       WIN35                           CAC001
     C                     ELSE                                           S01194
     C                     EXSR MVCURR                                    S01194
     C                     END                             E004           S01194
     C*                                                                   S01194
     C                     END                             E001           S01194
     C*                                                                   S01194
     C*********************MOVEL'20    '  KEY                             S01194
     C*********************MOVE '      '  KEY                             S01194
     C*********************Z-ADD1         B       30                      S01194
     C*********************                                               S01194
     C***********KEY*******SETLLTABFP                                     S01194
     C*********************                                               S01194
     C************IN35*****DOWEQ'0'                        B001           S01194
     C*********************READ TABFP                    35               S01194
     C***********RECI******IFEQ 'D'                        B002           S01194
     C***********RECTTB****IFNE '20'                       B003           S01194
     C*********************SETON                         35               S01194
     C*********************ELSE                            X003           S01194
     C*********************                                               S01194
     C***********SRECTB****IFEQ '1'                        B004           S01194
     C*********************MOVE CCYTB     CCYA,B                          S01194
     C*********************Z-ADDCDP       CDPA,B                          S01194
     C*********************MOVE MDIN      MDA,B                           S01194
     C*********************Z-ADDSPOT      SPTA,B                          S01194
     C*********************ADD  1         B                               S01194
     C***********B*********IFGT 150                        B005           S01194
     C*********************SETON                     35                   S01194
     C*********************END                             E005           S01194
     C*********************END                             E004           S01194
     C*********************END                             E003           S01194
     C*********************                                               S01194
     C*********************END                             E002           S01194
     C*********************END                             E001           S01194
      *                                                                   S01241
      ** MOVE CODE TO BEFORE ACCESS OF RETAIL ICD FILE                    084499
      **SEE*IF*WINDOW IS REQUIRED                                  S01241 084499
      ******                                                       S01241 084499
     C******     1         SETLLSDMMODPD                           S01241 084499
     C******               READ SDMMODPD               8989        S01241 084499
     C******     *IN89     IFEQ '1'                                S01241 084499
     C******               MOVEL'SDMMOD'  WDBFIL                   S01241 084499
     C******               MOVEL'FRT'     WDBKEY           ******* S01241 084499
     C******               Z-ADD99        WDBASE           ** DBAS S01241 084499
     C******               EXSR ENDPGM                     ******* S01241 084499
     C******               END                                     S01241 084499
     C*********************                                               S01117
     C*********************                                               S01117
     C***ACCESS*PF/PYCHGDD*TO GET VARIOUS DETAILS                         S01117
     C*********************                                               S01117
     C***********1*********CHAINPYCHGDD              99                   S01117
     C************IN99*****IFEQ '1'                        ** B01         S01117
     C*********************MOVEL'PYCHG'   WDBFIL             ************ S01117
     C*********************Z-ADD5         WDBASE             * DBERR 05 * S01117
     C*********************MOVE *BLANKS   ERRMSG             ************ S01117
     C*********************MOVE 'PAYMENT 'ERMSG1                          S01117
     C*********************MOVE 'CHARGES 'ERMSG2                          S01117
     C*********************MOVEL'RECORD M'ERMSG3                          S01117
     C*********************MOVEL'ISSING  'ERMSG4                          S01117
     C*********************MOVELERRMSG    WDBKEY                          S01117
     C*********************EXSR ENDPGM                                    S01117
     C*********************END                             ** E01         S01117
     C*********************CLOSEPYCHGDD                                   S01117
     C*********************                                               S01117
     C***Convert*rate*%*discrepancy to higher & lower rate margins.       S01117
     C***********1*********ADD  RATDIS    UPMARG  74                      S01117
     C***********1*********SUB  RATDIS    LWMARG  74                      S01117
     C*********************                                               S01117
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   @RTCD   7                       S01494
     C                     PARM '*VERIFY' @OPTN   7                       S01494
     C                     PARM 'S01494'  @SARD   6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set on indicator that will       S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           @RTCD     IFEQ *BLANKS                                   S01494
     C                     SETON                     09                   S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           @RTCD     IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'W0FILE                          S01494
     C                     MOVEL'*CALL'   W0KEY            ***************S01494
     C                     Z-ADD30        W0ERNB           * DB ERROR 30 *S01494
     C                     EXSR SRERR                      ***************S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*VERIFY' @OPTN   7                       S01499
     C                     PARM 'S01499'  @SARD   6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set on indicator w/c will        S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           @RTCD     IFEQ *BLANKS                                   S01499
     C                     SETON                     08                   S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           @RTCD     IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD31        W0ERNB           * DB ERROR 31 *S01499
     C                     EXSR SRERR                      ***************S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Read V.A.T. details if S01499 switched ON                        S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     CALL 'AOVATR0'              9090               S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*FIRST ' @OPTN   7                       S01499
     C                     PARM           VATDS                           S01499
     C*                                                                   S01499
     C           *IN90     IFEQ '1'                                       S01499
     C           @RTCD     ORNE *BLANKS                                   S01499
     C                     MOVEL'AOVATR0 'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD32        W0ERNB           * DB ERROR 32 *S01499
     C                     EXSR SRERR                      ***************S01499
     C                     END                                            S01499
     C                     END
     C*                                                                   S01508
     C** Access SAR details file to determine if S01508 is switched ON    S01508
     C*                                                                   S01508
     C                     CALL 'AOSARDR0'                                S01508
     C                     PARM *BLANKS   @RTCD                           S01508
     C                     PARM '*VERIFY' @OPTN                           S01508
     C                     PARM 'S01508'  @SARD                           S01508
     C           SCSARD    PARM SCSARD    DSFDY                           S01508
     C                     MOVE 'N'       S01508  1                       S01508
     C*                                                                   S01508
     C** If core feature is switched ON, set on indicator that will       S01508
     C** condition the rest of the processing                             S01508
     C*                                                                   S01508
     C           @RTCD     IFEQ *BLANKS                                   S01508
     C                     MOVE 'Y'       S01508                          S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C** else, database error (return code other than *NRF)               S01508
     C*                                                                   S01508
     C           @RTCD     IFNE '*NRF   '                                 S01508
     C                     MOVEL'SCSARDPD'W0FILE                          S01508
     C                     MOVEL'*CALL'   W0KEY            ************   S01508
     C                     Z-ADD41        W0ERNB           * DBERR 41 *   S01508
     C                     EXSR SRERR                      ************   S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   CEU006
     C** Access SAR details file to determine if CEU006 is switched ON    CEU006
     C*                                                                   CEU006
     C                     CALL 'AOSARDR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*VERIFY' @OPTN                           CEU006
     C                     PARM 'CEU006'  @SARD                           CEU006
     C           SCSARD    PARM SCSARD    DSFDY                           CEU006
     C                     MOVE 'N'       CEU006  1                       CEU006
     C*                                                                   CEU006
     C** If core feature is switched ON, set on indicator that will       CEU006
     C** condition the rest of the processing                             CEU006
     C*                                                                   CEU006
     C           @RTCD     IFEQ *BLANKS                                   CEU006
     C                     MOVE 'Y'       CEU006                          CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C** else, database error (return code other than *NRF)               CEU006
     C*                                                                   CEU006
     C           @RTCD     IFNE '*NRF   '                                 CEU006
     C                     MOVEL'SCSARDPD'W0FILE                          CEU006
     C                     MOVEL'*CALL'   W0KEY            ************   CEU006
     C                     Z-ADD49        W0ERNB           * DBERR 49 *   CEU006
     C                     EXSR SRERR                      ************   CEU006
     C                     END                                            CEU006
     C                     END                                            CEU006
     C/COPY WNCPYSRC,FT0080C008
     C*                                                                   S01499
     C*    SETUP VARIOUS CONSTANTS FOR LATER USE
     C**
     C                     MOVE 'P'       P
     C                     MOVE 'A'       CLINTA
     C                     MOVE 'FT'      MDIDH
     C                     MOVE 'FT'      MDIDD
     C                     MOVE 'FT0080'  PGMNH
     C                     MOVE 'FT0080'  PGMND
     C                     MOVELWSID      WSIDH
     C                     MOVELWSID      WSIDD
     C                     MOVE USRID     USRIDH
     C                     MOVE USRID     USRIDD
     C                     MOVE 'CP'      CP
     C                     Z-ADDRUNAY     EDATYY
     C*********************Z-ADDRUNAD     EDATDD                          101921
     C           RUNAD1    IFEQ ' '                                       101921
     C                     MOVE '0'       RUNAD1                          101921
     C                     ENDIF                                          101921
     C                     Z-ADDRUNAD     WDATDD  20                      101921
     C                     Z-ADDRUNAD     EDATDD                          101921
     C                     Z-ADD1         ZMTH
     C           RUNAM     LOKUPZMNM,ZMTH                99
     C                     Z-ADDZMTH      EDATMM
     C*
     C*********************Z-ADDRUND      DAFD0                           S01194
     C                     Z-ADDBJRDNB    DAFD0                           S01194
     C                     EXSR DAFDAT
     C                     Z-ADDDAFD1     OEDT1   60
     C                     Z-ADDDAFD2     OEDT2   20
     C                     Z-ADDDAFD3     OEDT3   60
     C*                                                                   S01494
     C** Retrieve the text for FTM2510 using MEC1150                      S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2510' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    WM2510 25                       S01494
     C*
     C                     Z-ADD1         INCR    40
     C*
     C           1         DO   BCCYDP                     ** B01
     C                     MULT 10        INCR
     C                     END                             ** E01
     C**
     C*    SUPPRESS PREVIOUS PAYMENT REF. FIELDS ON FIRST INITIAL SCREEN
     C**
     C                     MOVE '1'       *IN77
     C*
      * HAVE ENTRY PARAMS ETC
     C           *ENTRY    PLIST
     C           SACTD     PARM           @SORT   1
     C           SPREF     PARM           @PREF  15
     C                     PARM           @RETC   1
     C           SLINK     PARM           @LINK   1
     C*                                                                   096486
     C**  If program is called by GL4442, then initialise fields.         096486
     C*                                                                   096486
     C                     MOVE *BLANK    @GL442  1                       096486
     C           @RETC     IFEQ 'G'                                       096486
     C                     MOVE 'Y'       @GL442                          096486
     C                     MOVE *BLANK    @RETC                           096486
     C                     END                                            096486
     C*
     C           @PREF     COMP *BLANK               1010
     C           *IN10     IFEQ '1'                                       096486
     C           @GL442    ANDEQ'Y'                                       096486
     C                     MOVE '0'       *IN10                           096486
     C                     END                                            096486
      *                                                                   CGL007
      ** Access SAR details file to determine if CGL007 is installed.     CGL007
      *                                                                   CGL007
     C                     MOVE *BLANKS   CGL007  1                       CGL007
     C                     CALL 'AOSARDR0'                                CGL007
     C                     PARM *BLANKS   PRTCD   7                       CGL007
     C                     PARM '*VERIFY' POPTN   7                       CGL007
     C                     PARM 'CGL007'  PSARD   6                       CGL007
     C           SCSARD    PARM SCSARD    DSFDY                           CGL007
      *                                                                   CGL007
      ** If CGL007 is ON, set a variable fld. to condition the rest of    CGL007
      ** the processing.                                                  CGL007
      *                                                                   CGL007
     C           PRTCD     IFEQ *BLANKS                                   CGL007
     C                     MOVE 'Y'       CGL007                          CGL007
     C                     MOVE *BLANK    PRGL90  1                       CGL007
      *                                                                   CGL007
      **  If program is called by GL0090, then @RETC contains 'Z'.        CGL007
      *                                                                   CGL007
     C           @RETC     IFEQ 'Z'                                       CGL007
     C                     MOVE 'Y'       PRGL90                          CGL007
     C                     MOVE *BLANK    @RETC                           CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C                     ELSE                                           CGL007
      *                                                                   CGL007
      ** Else, database error (return code other than *NRF)               CGL007
      *                                                                   CGL007
     C           PRTCD     IFNE '*NRF   '                                 CGL007
     C                     MOVEL'SCSARDPD'W0FILE           ************   CGL007
     C                     MOVEL'*VERIFY' W0KEY            * DBERR 50 *   CGL007
     C                     Z-ADD50        W0ERNB           ************   CGL007
     C                     EXSR SRERR                                     CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           PRGL90    ANDEQ'Y'                                       CGL007
     C                     MOVE *OFF      *IN10                           CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
      ** Access SAR details file to determine if Midas 24X7 (CSC011)                          CSD015
      ** is installed                                                                         CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   CSC011  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSC011'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'W0FILE                                              CSD015
     C                     MOVEL'*VERIFY' W0KEY                                               CSD015
     C                     Z-ADD51        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details file to determine if Concord Interface                            CSD015
      ** Development (CCF001) is installed                                                    CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   CCF001  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'W0FILE                                              CSD015
     C                     MOVEL'*VERIFY' W0KEY                                               CSD015
     C                     Z-ADD52        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details file to determine if Compliance Watch                             CSD015
      ** (CSD015) is installed                                                                CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   CSD015  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'W0FILE                                              CSD015
     C                     MOVEL'*VERIFY' W0KEY                                               CSD015
     C                     Z-ADD53        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If CSD015 is on, check if this function is being                                     CSD015
      ** monitored by compliance watch.                                                       CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM 'CHEQPAID'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SDWLCCPD'W0FILE                                              CSD015
     C                     MOVEL'*VERIFY' W0KEY                                               CSD015
     C                     Z-ADD54        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Call access program AOCWCDR0 for Private Customer                                    CSD015
      ** Industry Code                                                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST ' POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C                     MOVEL'SDCWCDPD'W0FILE                                              CSD015
     C                     MOVEL'*FIRST'  W0KEY                                               CSD015
     C                     Z-ADD55        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Retrieve Details of SC24X7 and SDSTAT                                                CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
     C           KLCWHT    KLIST                                                              CSD015
     C                     KFLD           KFUNCC  8                                           CSD015
     C                     KFLD           KIDENT 40                                           CSD015
     C                     KFLD           KBRNCH  3                                           CSD015
      *                                                                                       CSD015
      ** Check if Online Printing of Advices (GE7) is on.                                     CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD                                               CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
      ** Database Error (return code other than *NRF)                                         CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE *BLANKS                                                       CRE020
     C           PRTCD     ANDNE'*NRF   '                                                     CRE020
     C                     MOVEL'SCSARDPD'W0FILE                                              CRE020
     C                     MOVEL'CRE020'  W0KEY                                               CRE020
     C                     Z-ADD57        W0ERNB                                              CRE020
     C                     EXSR SRERR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CGL014
      ** Check if enhancement CGL014 (Collaterals Processing) is on                           CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
     C                     PARM '*VERIFY' POPTN                                               CGL014
     C                     PARM 'CGL014'  PSARD                                               CGL014
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFNE *BLANKS                                                       CGL014
     C           PRTCD     ANDNE'*NRF   '                                                     CGL014
     C                     MOVEL'SCSARDPD'W0FILE                                              CGL014
     C                     MOVEL'*VERIFY' W0KEY                                               CGL014
     C                     Z-ADD51        W0ERNB                                              CGL014
     C                     EXSR SRERR                                                         CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CRE020
      *                                                                                       CER001
      ** Verify that ULX043 - IBLC 2002 is activated                                          CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX043  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD                                               CER001
     C                     PARM '*VERIFY' POPTN                                               CER001
     C                     PARM 'ULX043'  PSARD                                               CER001
     C           SCSARD    PARM SCSARD    DSFDY                                               CER001
      *                                                                                       CER001
     C           PRTCD     IFNE *BLANKS                                                       CER001
     C           PRTCD     ANDNE'*NRF   '                                                     CER001
     C                     MOVEL'SCSARDPD'W0FILE                                              CER001
     C                     MOVEL'*VERIFY' W0KEY                                               CER001
     C                     Z-ADD58        W0ERNB                                              CER001
     C                     EXSR SRERR                                                         CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           PRTCD     IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX043                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** Determine if SAR CAP205 is installed                                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   PRTCD                                               CAP205
     C                     PARM '*VERIFY' POPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           PRTCD     IFNE *BLANKS                                                       CAP205
     C           PRTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'*VERIFY' W0KEY                                               CAP205
     C                     Z-ADD59        W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C           PRTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CER049
      ** Determine if Stamp Tax is switched on.                                               CER049
      *                                                                                       CER049
     C                     MOVE *BLANK    CER049  1                                           CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   PRTCD                                               CER049
     C                     PARM '*VERIFY' POPTN                                               CER049
     C                     PARM 'CER049'  PSARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
     C           PRTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C           PRTCD     IFNE '*NRF   '                                                     CER049
     C                     MOVE '903'     DBASE                                               CER049
     C                     MOVEL'CER049  'DBKEY                                               CER049
     C                     MOVEL'SCSARDPD'DBFILE                                              CER049
     C                     SETON                     U7U8LR                                   CER049
     C                     DUMP                                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C/COPY WNCPYSRC,FT0080C011
      * Check if switchable feature CDL049 is present                                         CDL049
     C                     CALL 'AOSARDR0'                                                    CDL049
     C                     PARM '*MSG   ' PRTCD                                               CDL049
     C                     PARM '*KEY   ' POPTN                                               CDL049
     C                     PARM 'CDL049'  PSARD                                               CDL049
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL049
      *                                                                                       CDL049
      * Set flag for CDL049                                                                   CDL049
     C           PRTCD     IFNE *BLANKS                                                       CDL049
     C                     MOVE 'N'       CDL049  1                                           CDL049
     C                     ELSE                                                               CDL049
     C                     MOVE 'Y'       CDL049                                              CDL049
      *                                                                                       CDL049
      * Retrieve Rate Tolerance Details                                                       CDL049
     C           1         SETLLSDRRATPD                                                      CDL049
     C                     READ SDRRATPD                 90                                   CDL049
      *                                                                                       CDL049
     C           *IN90     IFEQ '1'                                                           CDL049
     C                     MOVE 'SDRRATPD'DBFILE           ***************                    CDL049
     C                     Z-ADD203       DBASE            * DB ERROR 203*                    CDL049
     C                     EXSR SRERR                      ***************                    CDL049
     C                     ENDIF                                                              CDL049
     C                     ENDIF                                                              CDL049
      *                                                                                       CDL049
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,O                          056031
     C                     SUB  1         O       50                      056031
     C*
     C                     ENDSR
     C*
     C/EJECT
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFA   : Determine if Profit Centres are Used              *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : *NONE                                             *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFA    BEGSR                                          S01414
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
      *  If Profit Centres are used determine if field is amendable.      S01414
      *                                                                   S01414
      *  If Insert it is always amendable. If Amend it is only            S01414
      *  amendable if the Profit Centres Amendable flag is set to 'Y'.    S01414
      *  If Enquire or Delete it is not amendable.                        S01414
      *                                                                   S01414
     C           ACTION    IFEQ 'I'                                       S01414
     C           ACTION    OREQ 'A'                                       S01414
     C           BKPRCA    ANDEQ'Y'                                       S01414
     C                     MOVEA'010'     *IN,31           Amendable      S01414
     C                     ELSE                                           S01414
     C                     MOVEA'000'     *IN,31           Protect        S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  If Profit Centres NOT Used - non display field                   S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVEA'100'     *IN,31           Non-display    S01414
     C                     END                                            S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRBOOK   : Validate Book Code                                *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : AOBOOKR0                                          *   S01414
      *             FTSNMS                                            *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRBOOK    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         O                               S01414
     C                     MOVEL'SRBOOK'  @STK,O                          S01414
      *                                                                   S01414
     C           *LIKE     DEFN BOKC      W#BOKC                          S01414
      *                                                                   S01414
      *  Book Code must be entered                                        S01414
      *                                                                   S01414
     C           W#BOKC    IFEQ *BLANKS                                   S01414
     C                     MOVE '1'       *IN25                           S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 400'    ERCD,S                          S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Access the Book Code file for validation                         S01414
      *                                                                   S01414
     C           W#BOKC    IFNE *BLANKS                                   S01414
      *                                                                   S01414
     C                     CALL 'AOBOOKR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY   ' U#OPTN  7                       S01414
     C                     PARM W#BOKC    U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOBOOKR' W0KEY            * DBERR 37 *   S01414
     C                     Z-ADD37        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * else map the book code from the data structure to screen field    S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN25                           S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 400'    ERCD,S                          S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELBDBKCD    W#BOKC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   @STK,O                          S01414
     C                     SUB  1         O       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT                                                              S01414
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFC   : Validation Of Profit Centre                       *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : FTSNMS                                            *   S01414
      *             AOPRFMR0                                          *   S01414
      *             AOPRFCR0                                          *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFC    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         O                               S01414
     C                     MOVEL'SRPRFC'  @STK,O                          S01414
      *                                                                   S01414
     C           *LIKE     DEFN PRFC      W#PRFC                          S01414
      *                                                                   S01414
      *  Profit Centre is Optional input.                                 S01414
      *                                                                   S01414
      *  If the profit centre field is blank set to a default only if     S01414
      *  the Profit Centre Defaults Used flag is set to 'Y'.              S01414
      ***This*could*only*happen*on*an*Insert.*******************   S01414 179732
      *  Do not default if an error was found in Remitting Bank,          179732
      *  Credit party or Book code                                        179732
      *                                                                   S01414
      *  If a nostro account or a retail account                          179732
     C           SLCTD     IFEQ 'Y'                                                         MD031725
     C           W#PRFC    ANDEQ*BLANKS                                                     MD031725
     C           RBKT      IFEQ 'R'                                       179732
     C           *IN45     ANDEQ'0'                                       179732
     C           DRPT      ANDEQ*BLANKS                                   179732
     C           RBKT      OREQ 'F'                                       179732
     C           *IN45     ANDEQ'0'                                       179732
     C           DRPT      ANDEQ*BLANKS                                   179732
     C           DRPT      OREQ 'R'                                       179732
     C           *IN56     ANDNE'1'                                       179732
     C           DRPT      OREQ 'N'                                       179732
     C           *IN56     ANDNE'1'                                       179732
     C                     MOVE ACPRFC    W#PRFC                          179732
     C                     ENDIF                                          179732
     C                     ENDIF                                                            MD031725
      *  If Account is valid                                              179732
     C           RECI      IFEQ 'D'                                       179732
      *                                                                   S01414
     C           ACTION    IFEQ 'I'                                       S01414
     C           W#PRFC    ANDEQ*BLANKS                                   S01414
     C           BKPCDU    ANDEQ'Y'                                       S01414
     C           *IN45     ANDNE'1'                                       179732
     C           *IN46     ANDNE'1'                                       179732
     C           *IN56     ANDNE'1'                                       179732
     C           *IN25     ANDNE'1'                                       179732
      *                                                                   S01414
     C           ACTION    OREQ 'A'                                       179732
     C           W#PRFC    ANDEQ*BLANKS                                   179732
     C           BKPCDU    ANDEQ'Y'                                       179732
     C           *IN45     ANDNE'1'                                       179732
     C           *IN46     ANDNE'1'                                       179732
     C           *IN56     ANDNE'1'                                       179732
     C           *IN25     ANDNE'1'                                       179732
      *                                                                   S01414
      *  Determine parameters to be passed                                S01414
      *                                                                   S01414
      ***For*Nostro*Transfers*the*Customer*and*Account*Officer*willS01414 179732
      ***be*blank.*************************************************S01414 179732
      *                                                                   S01414
      * IF a Nostro moves blanks into Account officer and Cust No.        179732
      * Else get the account officer and Cust No.                         179732
     C           RBKT      IFEQ 'F'                                       179732
     C           DRPT      ANDEQ*BLANKS                                   179732
     C           DRPT      OREQ 'N'                                       179732
     C                     MOVEL*BLANKS   CUST    6        Customer       S01414
     C                     MOVEL*BLANKS   ACOF    2        Account OfficerS01414
      *                                                                   179732
     C                     ELSE                                           179732
      *                                                                   179732
     C           DRPT      IFEQ *BLANKS                                   179732
     C           RBKT      ANDNE*BLANKS                                   179732
     C                     MOVELSRBK1     #CNUM   6        Customer       179732
     C                     ELSE                                           179732
      *                                                                   179732
     C           DRPT      IFNE *BLANKS                                   179732
     C                     MOVELSDRPY     #CNUM   6        Customer       179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
      *                                                                   S01414
     C                     CALL 'AOCUSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM #CNUM     @KEY1  10                       179732
     C                     PARM *BLANKS   @KYST   7                       179732
     C           SDCUST    PARM SDCUST    DSSDY                           179732
      *                                                                   179732
     C                     MOVEL#CNUM     CUST    6        Customer       179732
     C                     MOVELBBACOC    ACOF    2        Account Officer179732
     C                     ENDIF                                          179732
     C                     MOVEL'CP'      TRTP    5        Transaction TypS01414
      *                                                                   S01414
      *  Get default profit centre                                        S01414
      *                                                                   S01414
     C                     CALL 'AOPRFMR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7        Return Code    S01414
     C                     PARM W#BOKC    U#BOKC  2        Book Code      S01414
     C                     PARM TRTP      U#TRTP  5        Transaction TypS01414
     C                     PARM PYST      U#SUTP  2        Sub Type       S01414
     C                     PARM BRCH      U#BRAN  3        Booking Brch   S01414
     C                     PARM DPPT      U#DEPT  3        Department CodeS01414
     C                     PARM USRID     U#USER 10        User           S01414
     C                     PARM ACOF      U#ACOF  2        Account OfficerS01414
     C                     PARM CUST      U#CUST  6        Customer NumberS01414
     C           W#PRFC    PARM *BLANKS   U#PRFC  4        Profit Centre  S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFMR' W0KEY            * DBERR 38 *   S01414
     C                     Z-ADD38        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * If no error then the screen field is filled by passed parameter   S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ '2'                                       S01414
     C                     MOVE '1'       *IN33                           S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 410'    ERCD,S                          S01414
     C                     GOTO EXPRFC                                    S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Validate Profit Centre                                           S01414
      *                                                                   S01414
     C           ACTION    IFEQ 'I'                                       S01414
     C           W#PRFC    ANDNE*BLANKS                                   S01414
     C           ACTION    OREQ 'A'                                       S01414
     C           W#PRFC    ANDNE*BLANKS                                   S01414
     C           ACTION    OREQ 'I'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
     C           ACTION    OREQ 'A'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
      *                                                                   S01414
     C                     CALL 'AOPRFCR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM W#PRFC    U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFCR' W0KEY            * DBERR 39 *   S01414
     C                     Z-ADD39        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN33                           S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 410'    ERCD,S                          S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELDSPCCD    W#PRFC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            179732
      *                                                                   179732
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXPRFC    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,O                          S01414
     C                     SUB  1         O       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
     C********************************************************************
     C/EJECT
      *****************************************************************   CAC001
      *                                                               *   CAC001
      *  SRMGIN - Subroutine to call Margin Information Window.       *   CAC001
      *                                                               *   CAC001
      *  Called By:  DETLI - Process Insertion of Details             *   CAC001
      *              DETLA - Process Amendment of Details             *   CAC001
      *              DETLD - Process Deletion of Details              *   CAC001
      *              DETLE - Process Enquiry of Details               *   CAC001
      *  Calls    :  none                                             *   CAC001
      *                                                               *   CAC001
      *****************************************************************   CAC001
      *                                                                   CAC001
     C           SRMGIN    BEGSR                           *** SRMGIN *** CAC001
      *                                                                   CAC001
      **  Compute for debit currency equivalent amount                    CAC001
      *                                                                   CAC001
     C                     EXSR SRDREQ                                    CAC001
     C                     Z-ADDD#TAMT    WDRAM  130                      CAC001
      *                                                                   CAC001
      **  Set up fields for window                                        CAC001
      *                                                                   CAC001
     C                     MOVE WACTN     ACTION                          CAC001
     C                     Z-ADDRATE      WRATE                           CAC001
     C                     MOVE 'S'       WPSIN                           CAC001
     C                     MOVE PCCY      WPUCY                           CAC001
     C                     MOVE SDRCY     WSLCY                           CAC001
     C                     Z-ADDCQAM      WPUAM                           CAC001
     C                     Z-ADDWDRAM     WSLAM                           CAC001
     C                     Z-ADDMDIN      WMDIN                           CAC001
     C                     Z-ADDWOFXMP    WFXMP                           CAC001
     C                     MOVE WOFXMD    WFXMD                           CAC001
     C                     MOVE WOMBSI    WMBSI                           CAC001
     C                     MOVE WOMSIG    WMSIG                           CAC001
     C                     Z-ADDWOMAMT    WMAMT                           CAC001
      *                                                                   CAC001
      **  Call window manager WN0010 for the optional window              CAC001
      *                                                                   CAC001
     C                     WRITEFT0080F3                                  CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'FT0080  '#PGM   10                       CAC001
     C                     PARM 'KT'      KEY     2                       CAC001
     C                     PARM           ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  F3 has been pressed from window...                              CAC001
      *                                                                   CAC001
     C           #RTRN     IFEQ 'Y2U9999'                                 CAC001
     C                     MOVE *ON       *INLR                           CAC001
     C                     MOVE '1'       @RETC                           CAC001
      *                                                                   CAC001
      **  Allocate dataarea to blanks                                     CAC001
      *                                                                   CAC001
     C                     EXSR DALLOC                                    CAC001
     C                     RETRN                                          CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Else, Enter has been pressed...                                 CAC001
      *                                                                   CAC001
     C           #RTRN     IFEQ *BLANK                                    CAC001
      *                                                                   CAC001
      **  Save margin information details                                 CAC001
      *                                                                   CAC001
     C                     Z-ADDWFXMP     WOFXMP                          CAC001
     C                     MOVE WFXMD     WOFXMD                          CAC001
     C                     MOVE WMBSI     WOMBSI                          CAC001
     C                     MOVE WMSIG     WOMSIG                          CAC001
     C                     Z-ADDWMAMT     WOMAMT                          CAC001
      *                                                                   CAC001
      **  Save transaction rate, debit currency, and cheque amount        CAC001
      *                                                                   CAC001
     C                     Z-ADDRATE      WSVRT  138                      CAC001
     C                     MOVE SDRCY     WSVCY   3                       CAC001
     C                     Z-ADDCQAM      WSVAM  130                      CAC001
      *                                                                   CAC001
      **  If this is not a forced call to window, redisplay screen        CAC001
      *                                                                   CAC001
     C           WFRCI     IFNE 'Y'                                       CAC001
     C                     MOVE *OFF      *IN80                           CAC001
     C                     ENDIF                                          CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Otherwise, F12 has been pressed so redisplay screen             CAC001
      *                                                                   CAC001
     C                     MOVE *OFF      *IN80                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDSR                                          CAC001
      *****************************************************************   CAC001
     C/EJECT                                                              CAC001
     C********************************************************************
     C*
     C**   SUB-ROUTINE TO HANDLE DATABASE ERRORS , SET UP LDA AND
     C**   END PROGRAM. ALSO PRODUCES PROGRAM DUMP.
     C*
     C           ENDPGM    BEGSR
     C*          ------
     C*
     C                     ROLBK
     C*
     C**   UPDATE DATA AREA LDA.
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0080'  DBPGM
     C                     MOVE WDBFIL    DBFILE
     C                     MOVE WDBKEY    DBKEY
     C                     MOVE WDBASE    DBASE
     C                     OUT  DLDA
     C**
     C                     SETON                     U7U8LR
     C*
     C**   PRODUCE PROGRAM DUMP.
     C*
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
     C*
     C**   END PROGRAM
     C*
     C                     RETRN
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF 8RROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO                              ** B01
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END                             ** E01
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO                              ** B01
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END                             ** E01
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY                         ** B01
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             ** E01
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6                          ** B01
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             ** E01
     C**
     C   97N93             DO   3                          ** B01
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             ** E01
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************042167
     C* SUBROUTINE TO DEALLOCATE DATAAREA                              )  042167
     C*                                                                   042167
     C           DALLOC    BEGSR                           *** DALLOC ****042167
      *                                                                   042167
      * Call CL program to de-allocate                                    042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE *BLANKS   @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
      *                                                                   042167
     C                     ENDSR                                          042167
      *                                                                   042167
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +V
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -V
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C********************************************************************
     C********************************************************************
     C/EJECT
      *   Subroutine to zero suppress the central bank ref field          035398
      *                                                                   035398
     C           #CBREF    BEGSR                                          035398
      *                                                                   035398
     C                     MOVEASDNBC     C11                             035398
     C                     Z-ADD1         @V      20                      035398
      *                                                                   035398
     C           @V        DOUGE12                         *** B01        035398
      *                                                                   035398
     C           C11,@V    IFEQ '0'                        *** B02        035398
     C                     MOVEA' '       C11,@V                          035398
     C                     ADD  1         @V                              035398
     C                     ELSE                            *** X02        035398
     C                     Z-ADD12        @V                              035398
     C                     END                             *** E02        035398
     C                     END                             *** E01        035398
      *                                                                   035398
     C                     MOVEAC11       SDNBC                           035398
      *                                                                   035398
     C                     ENDSR                                          035398
      *                                                                   035398
     C********************************************************************CEU006
     C/EJECT                                                              CEU006
      *   Subroutine call FT0010 validation and conversion program.       CEU006
      *                                                                   CEU006
     C           EUXCHK    BEGSR                                          CEU006
     C                     CALL 'FT0010'               90                 CEU006
     C                     PARM           P#0010                          CEU006
     C           *IN90     IFEQ '1'                                       CEU006
     C           P#RTCD    ORNE *BLANKS                                   CEU006
     C                     MOVEL'FT0010  'W0FILE           ************   CEU006
     C                     MOVEL'*CALL   'W0KEY            * DBERR 43 *   CEU006
     C                     Z-ADD43        W0ERNB           ************   CEU006
     C                     MOVELERR@,1    W0NARR                          CEU006
     C                     EXSR SRERR                                     CEU006
     C                     END                                            CEU006
     C                     ENDSR                                          CEU006
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   SDWLTD                                              CSD015
      *                                                                                       CSD015
      ** Setup Counterparty Details                                                           CSD015
      *                                                                                       CSD015
     C                     EXSR SRCPTP                                                        CSD015
      *                                                                                       CSD015
      ** Setup 1st parameter for compliance engine program                                    CSD015
      *                                                                                       CSD015
     C                     MOVEL'FTCHQP'  W4ITEM                                              CSD015
     C                     MOVELPREF      W4IDEN                                              CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     MOVEL'CQPACDD' W4FUNT                                              CSD015
     C                     MOVELPKEY1     W4CNUM                                              CSD015
     C                     MOVELWCTYP     W4CTYP                                              CSD015
     C                     MOVELWRNRT     W4CUST                                              CSD015
     C                     Z-ADDOEDT      W4DDAT                                              CSD015
     C                     Z-ADDPVDT      W4VDAT                                              CSD015
     C                     Z-ADD0         W4MDAT                                              CSD015
     C                     MOVELPCCY      W4DEN1                                              CSD015
     C                     MOVEL*BLANKS   W4DEN2                                              CSD015
     C                     Z-ADDTOTR      W4AMT1                                              CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRENGN    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch                                         CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           SDWLTD                                              CSD015
     C                     PARM           PSTRNG                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCONV    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Convert Watch Fields to Customer Name and Address                                    CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD                                               CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM           PINP2  35                                           CSD015
     C                     PARM           PINP3  35                                           CSD015
     C                     PARM           PINP4  35                                           CSD015
     C                     PARM           PINP5  35                                           CSD015
     C                     PARM           PINP6  35                                           CSD015
     C                     PARM           PCYCD   3                                           CSD015
     C                     PARM           POUT1 216                                           CSD015
     C                     PARM           POUT2   6                                           CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRFMT     BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Format Watch Fields in XML Format                                                    CSD015
      *                                                                                       CSD015
     C           PSTRNG    CAT  XTAG,WX:0 PSTRNG                                              CSD015
     C           PSTRNG    CAT  POUT1:0   PSTRNG                                              CSD015
     C           PSTRNG    CAT  XTAG,WY:0 PSTRNG                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCLRP    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Reset parameters for SDCWLFMT                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PINP1                                               CSD015
     C                     MOVE *BLANKS   PINP2                                               CSD015
     C                     MOVE *BLANKS   PINP3                                               CSD015
     C                     MOVE *BLANKS   PINP4                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PCYCD                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCPTP    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Determine Counterparty type                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PKEY1                                               CSD015
      *                                                                                       CSD015
      ** If Remitting Bank is not free text, use it as counterparty,                          CSD015
      ** else use sender's correspondent.                                                     CSD015
      *                                                                                       CSD015
     C           WRBFF     IFEQ 'N'                                                           CSD015
     C                     MOVELWRBCP     PKEY1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWSCCP     PKEY1                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANK    PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM           PKEY1  10                                           CSD015
     C                     PARM *BLANKS   PKYST   7                                           CSD015
     C           SDCUS2    PARM SDCUS2    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SDCUSTPD'W0FILE                                              CSD015
     C                     MOVELPKEY1     W0KEY                                               CSD015
     C                     Z-ADD56        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WCTYP   1                                           CSD015
     C                     MOVE *BLANKS   WCRNM  20                                           CSD015
     C                     MOVE *BLANKS   WRNRT  30                                           CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVELWLCRNM    WCRNM                                               CSD015
     C           WLCRNM    CAT  WLCRTN    WRNRT                                               CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           WLCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WLLICD    IFNE *BLANKS                                                       CSD015
     C           WLLICD    ANDNEW1IND1                                                        CSD015
     C           WLLICD    ANDNEW1IND2                                                        CSD015
     C           WLLICD    ANDNEW1IND3                                                        CSD015
     C           WLLICD    ANDNEW1IND4                                                        CSD015
     C           WLLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACCT - Moves relevant account data.                        *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACCT    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     MOVE W#CNU1    C#CNU1                                              CGL029
     C                     MOVE W#CCY1    C#CCY1                                              CGL029
     C                     MOVE W#ACO1    C#ACO1                                              CGL029
     C                     MOVE W#ACS1    C#ACS1                                              CGL029
     C                     MOVE W#BRC1    C#BRC1                                              CGL029
      *                                                                                      BUG3194
     C           C#ATYP    IFEQ 'R'                                                          BUG3194
     C                     MOVELC#ACCT    C#ACNO                                             BUG3194
     C                     ENDIF                                                             BUG3194
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
     C********************************************************************035398
     C/EJECT
     C/COPY WNCPYSRC,FT0080C009
     C** NEW HOLIDAY PROCESSING C-SPECS                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/COPY FTCPYSRC,SFTSWFTC                                             094278
     C*                                                                   S01195
     C/EJECT
     OCQPACDDFE                CQCREL
     OCQPADDDFE                CQDREL
     O/COPY WNCPYSRC,FT0080O001
      ************                                                        056031
      ************ Remove PRONO, OLPOS and MEMOS                          056031
      ************                                                        056031
     O*PRONOPNFE***             RPRONO                                    056031
     O*OLPOSOAFE***             ROLPOS                                    056031
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   FCTR - ARRAY OF POWERS OF 10 FOR DAF CONVERSIONS
0001
0010
0100
1000
**   SWCH  - ARRAY OF VALID SWIFT CHARACTER
ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890/-?:().,'+
**  Error text                                                            056031
Error occurred on call to program - see dumps for further details
**  XTAG                                                                                      CSD015
<Remitting Bank>                                                                              CSD015
</Remitting Bank>                                                                             CSD015
<Sender's Correspondence>                                                                     CSD015
</Sender's Correspondence>                                                                    CSD015
<Receiver's Correspondence>                                                                   CSD015
</Receiver's Correspondence>                                                                  CSD015
<Account With Bank>                                                                           CSD015
</Account With Bank>                                                                          CSD015
<Debit Party>                                                                                 CSD015
</Debit Party>                                                                                CSD015
<Charges To The Debit Of Account>                                                             CDS015
</Charges To The Debit Of Account>                                                            CSD015
