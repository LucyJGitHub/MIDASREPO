     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Cheques authorisation')                       *
      *****************************************************************
      *                                                               *
      *  Midas - Funds Transfer Module                                *
      *                                                               *
      *  FT0090 - Cheque Authorisation                                *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. AR1039558          Date 07Feb13               *
      *  Prev Amend No. AR1030313          Date 09Sep12               *
      *                 AR804457A          Date 22Sep11               *
      *                 CER049             Date 06Dec10               *
      *                 AR726295           Date 15Mar11               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 07Jul06               *
      *                 240516             Date 29Jun06               *
      *                 240515             Date 29Jun06               *
      *                 B11356             Date 12May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9055            Date 19Oct05               *
      *                 BUG8968            Date 14Oct05               *
      *                 CER001             Date 25Apr05               *
      *                 TDA035             Date 02Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU006             Date  28Apr98              *
      *                 112583       DATE  24SEP97                    *
      *                 CAC001             DATE 01FEB96               *
      *                 S01499             DATE 06JUN94               *
      *                 S01494             DATE 25MAY94               *
      *                 058694       DATE  27JUL93                    *
      *                 045509       DATE  07MAY93                    *
      *                 S01414       DATE  29MAR93                    *
      *                 048377       DATE  22DEC92                    *
      *                 042167       DATE  05AUG92                    *
      *                 035353       DATE  02FEB92                    *
      *                 E36921       DATE  13MAR92                    *
      *                 E29970       DATE  25JUN91                    *
      *                 S01194       DATE  31AUG90                    *
      *                 S01117       DATE  31AUG90                    *
      *                 S01252       DATE  03FEB90                    *
      *                 S01251       DATE  03FEB90                    *
      *                 S01241       DATE  08JAN90                    *
      *                 S01199       DATE  17/08/89                   *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR1039558 - Cannot Authorise amended Cheque Collection       *
      *              (Child:AR1039559)                                *
      *  AR1030313 - Receiver Correspondent detail is shown as blank  *
      *              and details are not displayed (Child: AR1030314) *
      *  AR804457A - Unable to amend Credit Value Date when debit     *
      *              detail is matured and credit detail is live.     *
      *              Allow reauthorization of a matured collection.   *
      *              (Child: AR804458A)                               *
      *  CER049 - Stamp Tax                                           *
      *  AR726295 - Error when authorizing cheques to be paid         *
      *             (Child: AR726296)                                 *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  240516 - Format Receiver's correspondent correctly.          *
      *           Part of the fix already applied by fix B11356.      *
      *  240515 - Rectify formatting of Debit party and Sender's      *
      *           correspondent fields.                               *
      *           Part of the fix already applied by fix B11356.      *
      *  B11356 - Incorrect formatting of Receivers Correspondent     *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9055 -Make the field on reverse when encounter an error.  *
      *  BUG8968 -Error codes being displayed twice.                  *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CSD006 - Use long DS with SDCURRPD.                          *
      *  CEU006 - EMU Funds Transfer Enhancements                     *
      *  112583 - Re-compiled due to change in display file           *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           Allow F19 for Margin Information if Analytical      *
      *           Accounting is installed.                            *
      *  S01499 - BLI V.A.T. Processing                               *
      *  S01494 - BLI Funds Transfer Enhancements                     *
      *         - If user not found, display message "User not        *
      *           found" and stop authorisation (TEMP03 FIX)          *
      *  058694 - Fix window processing for detail screen and         *
      *           add message file                                    *
      *  045509 - Array index error for USER array when F12 taken     *
      *           several times from detail screen.                   *
      *  S01414 - Book Code and Profit Centre Incorporation.          *
      *  048377 - CANNOT AUTHORISED CHEQUES FOR COLLECTION AWAITNG    *
      *           AUTHORISATION. (REFER TO ERROR 42167 & 044093)      *
      *  042167 - INCLUDE CL PROGRAM TO CHECK FOR RECORD LOCKING      *
      *  035353 - ADD CREDIT CURRENCY AMOUNT                          *
      *  E36921 - UPDATE USER FLAGS CORRECTLY ON FILES                *
      *  E29970 - STANDARDISATION OF CMD7 PROCESSING                  *
      *  S01194 - NEW STANDING DATA                                   *
      *  S01117 - MULTIBRANCHING.                                     *
      *           STANDARDISATION OF CPF ERROR CODES FOR RELEASE 10.  *
      *  S01252 - ADDITIONAL SPARE WINDOW MANAGER PARAMETER.          *
      *           BLANK RETURN CODE.                                  *
      *  S01251 - SYNON FIELD/PROGRAM NAME CHANGES.                   *
      *  S01241 - WINDOW INCORPORATION                                *
      *  S01199 -  HELP SYSTEM.                                       *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  FUNCTION OF INDICATORS                                       *
      *                                                               *
      *  01  F3 - exit program                                        *
      *            - go back to authorisation screen                  *
      *  02  F12 - go back one screen                                 *
      *  03  F12 has been pressed to go back from screen 3            *
      *  05  F12 - return to initial screen                           *
      *  08  F9 - authorise payment                                   *
      ***11  HELP                                                     *   S01199
      *  13  Core feature S01494 installed                            *   S01494
      *  15  Core feature S01499 installed                            *   S01499
      *  16  Analytical Accounting is installed                       *   CAC001
      *  20  invalid cheque reference                                 *
      *  21  invalid total cheque amount                              *
      *  22  invalid total cheque currency                            *
      *  23  invalid first cheque amount                              *
      *  24  invalid first cheque currency                            *
      *  25  invalid first authorising user                           *
      *  26  invalid second authorising user                          *
      *  40  valid cqpacdd (p/f) record                               *
      *  41  valid cqpaddd (p/f) record                               *
      *  42  valid cqcoddd (p/f) record                               *
      *  43  valid cqcocdd (p/f) record                               *
      *  30-33  number of decimal places pay currency                 *
      *  35-38  number of decimal places base currency                *
      *  50  Multibranching Indicator                                 *   S01117
      *  51  Originating Branch used                                  *   S01117
      *  52  Fldqry - On then redisplay screen                        *   S01194
      *  53  Fldqry - Used in LOKUP , on if ? found                   *   S01194
      *  55  Used by message subfile                                  *   058694
      *  56  Putovr and Overlay on message subfile                    *   058694
      *  57  Chain indicator for SDCWHTL1                             *                       CSD015
      *  70  ALL DETAILS HAVE BEEN DISPLAYED FOR THIS CHEQUE          *
      *  71  Profit Centres In Use Flag                               *   S01414
      *  72  Display Notified/Pay Ccy fields for EMU                  *   CEU006
      *  75  WORK INDICATOR USED IN FLDQRY SR.                        *   S01194
      *  77  INPUT USER2 not on array                                 *   045509
      *  78  INPUT USER1 not on array                                 *   045509
      *  80  error flag                                               *
      *  87  not live record                                          *
      *  88  cheque not on file                                       *
      *  89  general invalid field flag                               *
      *  90-99  standard subroutine indicators                        *
      *                                                               *
      *****************************************************************
     FFT0090DFCF  E                    WORKSTN
     FCQPAC   UF  E           K        DISK
     F                                              KCOMIT
     FCQCOD   UF  E           K        DISK
     F                                              KCOMIT
     FMUSER   IF  E           K        DISK
     F*PYCHGDD*IF* E                    DISK                              S01117
     F*TABFP***IF* E           K        DISK                              S01194
     F*********** TABTB20F                          KIGNORE               S01194
     F*********** TABTG20F                          KIGNORE               S01194
     F*********** TABLETJF                          KIGNORE               S01194
     F*********** TABLETLF                          KIGNORE               S01194
     F*********** TABLETPF                          KIGNORE               S01194
     F*SDMMODPDIF**E                   DISK                         S01241S01194
      *                                                                   S01241
      * /COPY used to define extension file that will be updated          S01241
      *       after authorisation of the payement                         S01241
      *                                                                   S01241
     F/COPY WNCPYSRC,FT0090FIL                                            S01241
      *                                                                                       CSD015
      ** Compliance Watch Hit List File                                                       CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CRE020
      ** Retail Advice Index File                                                             CRE020
     FREADVCL1UF  E           K        DISK         KCOMIT       A    UC                      CRE020
      *                                                                                       CRE020
     F/COPY WNCPYSRC,FT0090F001
     E                    CPY@    1   1 80
     E*
     E*   TABLES
     E*
     E                    ZA1        16  1               ZALIGN SR. ARRAY
     E                    ZA2        16  1               ZALIGN SR. ARRAY
     E                    DIG1       13  1               UNEDITED VALUE
     E                    DIG2       14  1               EDITED VALUE
     E                    ERCD       19  4               ERROR CODES
     E                    USER       52 10               INPUT USERS
     E*                                                                   S01194
     E**FLDQ ARRAY FOR '?' HANDLING                                       S01194
     E                    FLDQ       10  1                                S01194
      *                                                                   058694
      *  Subroutine stack                                                 058694
      *                                                                   058694
     E                    @STK       20 10                                058694
      *                                                                   058694
      *  Warning check array                                              058694
      *                                                                   058694
     E                    WRN@       40  1                                058694
     E/COPY WNCPYSRC,FT0090E001
      *                                                                   S01194
      ** Declare CRE020 System Value Constants                                                CRE020
      *                                                                                       CRE020
     I              'ChequesToBeCollected'C         CCOVAL                                    CRE020
     I              'ChequesToBePaid'     C         CPAVAL                                    CRE020
      *                                                                                       CRE020
     I** Rename of Cqpacdd and Cqcoddd Book Code & Profit Centre to       S01414
     I** avoid corruption from Cqpaddd & Cqcocdd.                         S01414
     I*                                                                   S01414
     ICQPACDDF                                                            S01414
     I              BOKC                            H#BOKC                S01414
     I              PRFC                            H#PRFC                S01414
     I*                                                                   S01414
     ICQCODDDF                                                            S01414
     I              BOKC                            H#BOKC                S01414
     I              PRFC                            H#PRFC                S01414
     I*                                                                   S01494
     I** Redefine LCD                                                     S01494
     IMUSERDDF                                                            S01494
     I              LCD                             WLCD                  S01494
     I*                                                                   S01414
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I*     DATA AREA DATA STRUCTURE FOR HANDLING DB ERRORS
     I*
     IDLDA        DS                            256
     I************                          134 138 DBFILE                S01194
     I************                          139 167 DBKEY                 S01194
     I************                          168 175 DBPGM                 S01194
     I************                          176 1770DBASE                 S01194
     I************                          178 178 CMD                   S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I                                      184 184 CMD                   S01194
     I*
     I*     DATA AREA FOR PROGRAM STATUS DISK AREA
     I*
     IPSDS       SDS
     I                                        1  10 ##PGM                 058694
     I                                      244 253 WID
     I                                      254 263 USRID
     I/COPY WNCPYSRC,FT0090I002
     I*
     I*     DATA STRUCTURE FOR LEFT VALUES FOR SCREEN
     I*
     I            DS
     I                                        1   3 CCYLEF
     I                                        1   3 CCYA
     I                                        1   3 CCYB
     I                                        1   3 CCYC
     I                                        1   3 CCYD
     I                                        1   3 CCYE                  S01494
     I                                        1   3 CCYF                  S01499
     I*
     I*     DATA AREA FOR RENAMING OF CURRENCIES FOR DISPLAY
     I*
     I            DS
     I                                        1   3 CCYOUT
     I                                        1   3 CCY1
     I                                        1   3 CCY2
     I                                        1   3 CCY3
     I                                        1   3 CCY4
     I                                        1   3 CCY5                  S01494
     I                                        1   3 CCY6                  S01499
     I*
     I*     DATA AREA TO REDEFINES FIELDS
     I*
     I            DS
     I                                        1  76 ERCD
     I                                        1  76 ERRS
     I                                       77  89 DIG1
     I                                       77  890DIG1N
     I                                       90 103 DIG2
     I                                       90 103 DIG2A
     I*
     I*     DATA AREA TO BLANK OUT UNWANTED DIGITS ON NOSTROS ETC
     I*
     I            DS
     I**********                              1  12 EFLD                                      CGL029
     I**********                              3  12 ENNO                                      CGL029
     I**********                             11  12 ENRT                                      CGL029
     I                                        1  18 EFLD                                      CGL029
     I                                        3  18 ENNO                                      CGL029
     I**********                             17  18 ENRT                               CGL029 B11356
     I                                       11  18 ENRT                                      B11356
     I*
     I*DATA STR TO BLANK BRANCH ON REMITTING BNK WHEN SINGLE BRANCHED     S01117
     I*                                                                   S01117
     I            DS                                                      S01117
     I                                        1  35 SRBK1                 S01117
     I                                       16  18 RBKB                  S01117
     I*                                                                   S01117
     I*DATA STR TO BLANK BRANCH ON COLLCTING BNK WHEN SINGLE BRANCHED     S01117
     I*                                                                   S01117
     I            DS                                                      S01117
     I                                        1  35 SCOB1                 S01117
     I                                       16  18 COBB                  S01117
     I*                                                                   S01117
     I*     DATA STRUCTURE FOR COMMITMENT BOUNDARY IDENTIFIERS
     I*
     I            DS
     I                                        1   50TRANS
     I                                        6   7 MODULE
     I                                        8  15 PROG
     I                                       16  18 WID1
     I                                       19  240TIM
     I                                       25  25 ACTION
     I                                       26  35 USRID1
     I                                       51  60 WID2
     I                                       61  75 PREF
     I                                       74  75 STTP
     I                                       76  89 TVAL
     I                                       90  92 TCCY
     I                                       93 106 FVAL
     I                                      107 109 FCCY
     I                                      110 119 AUP1
     I                                      120 144 NAME
     I                                      145 154 AUP2
     I                                      155 179 NAME2
     I                                        1 179 COMBOU
     I/COPY WNCPYSRC,FT0090I003
     I*
     IDSMTR       DS                                                      S01494
     I*                                                                   S01494
     I** Define fields for message translation                            S01494
     I*                                                                   S01494
     I                                        1 132 #MSDTA                S01494
     I                                       15  30 #MPREF                S01494
     I                                    P   1   20#MPART                S01494
     I                                      133 264 #MSTX1                S01494
     I#MSTX2      DS                                                      S01494
     I                                        1 256 #MSTXA                S01494
     I                                      257 512 #MSTXB                S01494
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I*External data structure for Midas Modules Details                  S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I*External data structure for General Ledger Details                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I*External data structure for Bank Details                           S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I*External data structure for Currency Details                       S01194
     I*                                                                   S01194
     ISDFTFR    E DSSDFTFRPD                                              S01194
     I*External data structure for Funds Transfer Details                 S01194
     I**                                                                  S01494
     ISCSARD    E DSSCSARDPD                                              S01494
     I* External data structure for SAR file details                      S01494
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*1st DS for access program , short data structure                   S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*2nd DS for access program , long data structure                    S01194
     I*                                                                   S01194
      *                                                                   CAC001
     ISPARE       DS                            256                       CAC001
      * Define the data structure to pass data to WN0010 and return pgm   CAC001
      *                                                                   CAC001
     I                                        1   1 WACTN                 CAC001
     I                                    P   2   88RATE                  CAC001
     I                                        9   9 WPSIN                 CAC001
     I                                       10  12 PCCY                  CAC001
     I                                       13  15 SMCY                  CAC001
     I                                    P  16  220TOTR                  CAC001
     I                                    P  23  290TOCL                  CAC001
     I                                       30  300MDIN                  CAC001
     I                                    P  31  342FXMP                  CAC001
     I                                       35  350FXMD                  CAC001
     I                                       36  36 MBSI                  CAC001
     I                                       37  37 MSIG                  CAC001
     I                                    P  38  440MAMT                  CAC001
     I                                       45  45 FRCI                  CAC001
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Details File                                 CSD015
      *                                                                                       CSD015
     ISC24X7    E DS                                                                          CSD015
      ** 24x7 Status Dataarea                                                                 CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD data area                                                                         CSD015
      *                                                                                       CSD015
     I/COPY QWINDSRC,FT0090DTA
     IPDATA       DS                           1024                                           CER001
     I                                        1  15 PREFX                                     CER001
     I                                       16  17 CQSQX                                     CER001
      *                                                                                       CER001
     I/COPY WNCPYSRC,FT0090I001
     C                     MOVEACPY@      BIS@   80
     C/EJECT
     C********************************************************************
     C***
     C***    KLIST FOR KEY TO  - ALL 'CQ' FILES.
     C***
     C           CQKEY     KLIST
     C                     KFLD           PREF
     C                     KFLD           CQSQ
     C*
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *                                                                                       CSD015
     C************************************************************
     C* MAIN SECTION
     C* DISPLAYS FIRST SCREEN UNTIL F3 IS PRESSED
     C************************************************************
     C*
     C* PERFORM INTITIAL SUBROUTINE
     C           *ENTRY    PLIST
     C                     PARM           XPREF
     C                     PARM           @RETC   1
     C                     PARM           GENPR   1
     C           *LIKE     DEFN PREF      XPREF
     C*
     C           *LOCK     IN   DLDA
     C                     MOVE '0'       CMD
     C                     OUT  DLDA
     C*
     C           *BLANK    IFEQ XPREF                      SET BYPASS 1ST
     C                     SETON                     45
     C                     ELSE                            SCREEN INDICATE
     C                     MOVELXPREF     PREF
     C                     SETOF                     45
     C                     END
     C                     EXSR INITL
     C* DO LOOP UNTIL F3 OR F7 HAS BEEN PRESSED
     C           *IN01     DOUEQ'1'                        B001
     C           *IN07     OREQ '1'                                       E29970
      *                                                                   058694
      * Initialise no update indicator, re-display, warning array         058694
      * and warning message sent                                          058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP  1                       058694
     C                     MOVEL*BLANKS   FTRSND  1                       058694
     C                     MOVEL*BLANKS   FTWARN                          058694
     C                     MOVEL*BLANKS   WRN@                            058694
      *                                                                   058694
     C* IF NO ERRORS CLEAR FIELDS
     C   45
     COR 89                DO                              BYPASS LOOP
     C  N89                DO                              B002
     C                     Z-ADD1         Z       30
     C                     MOVE *BLANK    ERCD
     C                     MOVEA'00000'   *IN,20
     C                     MOVE *BLANK    PREF             PAYMENT REF
     C                     MOVE *BLANK    TVAL             TOT AMOUNT
     C                     MOVE *BLANK    TCCY             TOT CURRENCY
     C                     MOVE *BLANK    FVAL             1st AMOUNT
     C                     MOVE *BLANK    FCCY             1st CURRENCY
     C                     END                             E002
      *                                                                   042167
      * Call CL program to de-allocate                                    042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE *BLANKS   @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
      *                                                                   042167
     C                     SETON                     45                   042167
      *                                                                   042167
     C*                                                                   S01194
     C** Tag to redisplay 1st screen if field query is used               S01194
     C*                                                                   S01194
     C           FIRST     TAG                                            S01194
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
     C** To move the time to 'time' on display file                       S01194
     C                     TIME           TIME                            S01194
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C                     WRITEFT0090F1
     C           MNRED     TAG                             ** TAG MNRED
     C                     READ FT0090F1                 80
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C   05                SETOF                     89
     C   07                SETOF                     89
     C**                                                                  S01199
     C** 11                DO                              B002           S01199
     C**                   EXSR HELP                                      S01199
     C**                   GOTO MNRED                                     S01199
     C**                   END                             E002           S01199
     C                     END                             BYPASS LOOP
     C* IF NONE OF HELP, F3 OR F12 HAVE BEEN PRESSED
     C* VALIDATE AND GOT AUTHORISATION SCREEN IF NO ERRORS
     C  N01N05N07          DO                              B002
     C*                                                                   S01194
     C**  Resolve ?'s before validation                                   S01194
     C*                                                                   S01194
     C                     EXSR FLDQRY                                    S01194
     C*                                                                   S01194
     C**  Goto beginning if field in error or queried                     S01194
     C*                                                                   S01194
     C           *IN52     IFEQ '1'                                       S01194
     C                     GOTO FIRST                                     S01194
     C                     END                                            S01194
     C                     EXSR VALONE
     C           FTNOUP    IFEQ *BLANKS                                   058694
     C  N89                EXSR AUTHOR
     C   05 89             SETOF                     05
     C                     END                                            058694
     C                     END                             E002
     C  N89      XPREF     IFNE *BLANK
     C           FTNOUP    ANDEQ*BLANKS                                   058694
     C                     MOVE '1'       *IN01
     C                     END
     C                     END                             E001
     C*
     C           *IN01     IFEQ '1'
     C           *IN05     ANDEQ'0'
     C           *IN07     ANDEQ'0'
     C           *LOCK     IN   DLDA
     C                     MOVE '3'       CMD
     C                     OUT  DLDA
     C* AND SETUP RETURN CODE
     C   01                MOVE '1'       @RETC
     C*                                                                   E29970
     C           *IN07     IFEQ '1'                                       E29970
     C                     MOVE '1'       @RETC                           E29970
     C                     END                                            E29970
      *                                                                   042167
      * Call CL program to de-allocate                                    042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE *BLANKS   @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
     C*                                                                   E29970
     C                     END
     C/COPY WNCPYSRC,FT0090C017
     C*
     C                     SETON                     LR
     C************************************************************
     C* END OF MAIN SECTION
     C************************************************************
     C/EJECT
     C************************************************************
     C* INITL SR.
     C*                                                                   S01194
     C**READS*TABLE*FILE*FOR*BASE*CURRENCY*RUN*DATE*ETC*********          S01194
     C*                                                                   S01194
     C* READS STANDING DATA FILES FOR BASE CURRENCY RUN DATE ETC          S01194
     C*
     C           INITL     BEGSR
     C*
     C* SETUP STANDARD FIELDS FOR ERRORS AND COMIT
     C           *NAMVAR   DEFN LDA       DLDA
     C                     MOVE 'FT'      MODULE
     C                     MOVE 'A'       ACTION
     C                     MOVELWID       WID1
     C                     MOVE WID       WID2
     C                     MOVE USRID     USRID1
     C                     MOVE 'FT0090'  PROG
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C**READ*INSTALLATION*CONTROL*RECORD*1*                               S01194
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'01'      KEY                             S01194
     C*********************MOVE '10'      KEY                             S01194
     C***********KEY*******CHAINTABTB10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD1         DBASE            * DB ERROR 01 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C**READ*INSTALLATION*CONTROL*RECORD*TWO.*                            S01194
     C*********************MOVE '11'      KEY                             S01194
     C***********KEY*******CHAINTABTB11F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD2         DBASE            * DB ERROR 02 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   @RTCD   7                       S01494
     C                     PARM '*VERIFY' @OPTN   7                       S01494
     C                     PARM 'S01494'  @SARD   6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C                     MOVE 'N'       S01494  1                       S01494
     C                     MOVE '0'       *IN13                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set a variable field to          S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           @RTCD     IFEQ *BLANKS                                   S01494
     C                     MOVE 'Y'       S01494                          S01494
     C                     MOVE '1'       *IN13                           S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           @RTCD     IFNE '*NRF   '                                 S01494
     C                     MOVEL'FT0090 ' DBPGM                           S01494
     C                     MOVEL'SCSARDPD'DBFILE           ************   S01494
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 09 *   S01494
     C                     Z-ADD09        DBASE            ************   S01494
     C                     OUT  DLDA                                      S01494
     C                     SETON                     U7U8LR               S01494
     C                     DUMP                                           S01494
     C                     RETRN                                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*VERIFY' @OPTN   7                       S01499
     C                     PARM 'S01499'  @SARD   6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C                     MOVE 'N'       S01499  1                       S01499
     C                     MOVE '0'       *IN15                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set a variable field to          S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           @RTCD     IFEQ *BLANKS                                   S01499
     C                     MOVE 'Y'       S01499                          S01499
     C                     MOVE '1'       *IN15                           S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           @RTCD     IFNE '*NRF   '                                 S01499
     C                     MOVEL'FT0090 ' DBPGM                           S01499
     C                     MOVEL'SCSARDPD'DBFILE           ************   S01499
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 10 *   S01499
     C                     Z-ADD10        DBASE            ************   S01499
     C                     OUT  DLDA                                      S01499
     C                     SETON                     U7U8LR               S01499
     C                     DUMP                                           S01499
     C                     RETRN                                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
      *                                                                   CEU006
      ** Access SAR details file to determine if CEU006 is switched ON    CEU006
      *                                                                   CEU006
     C                     CALL 'AOSARDR0'                                CEU006
     C                     PARM *BLANKS   @RTCD   7                       CEU006
     C                     PARM '*VERIFY' @OPTN   7                       CEU006
     C                     PARM 'CEU006'  @SARD   6                       CEU006
     C           SCSARD    PARM SCSARD    DSFDY                           CEU006
     C                     MOVE 'N'       CEU006  1                       CEU006
     C                     MOVE '0'       *IN72                           CEU006
     C*                                                                   CEU006
     C** If core feature is switched ON, set a variable field to          CEU006
     C** condition the rest of the processing                             CEU006
     C*                                                                   CEU006
     C           @RTCD     IFEQ *BLANKS                                   CEU006
     C                     MOVE 'Y'       CEU006                          CEU006
     C                     MOVE '1'       *IN72                           CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C** else, database error (return code other than *NRF)               CEU006
     C*                                                                   CEU006
     C           @RTCD     IFNE '*NRF   '                                 CEU006
     C                     MOVEL'FT0090 ' DBPGM                           CEU006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU006
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 21 *   CEU006
     C                     Z-ADD21        DBASE            ************   CEU006
     C                     OUT  DLDA                                      CEU006
     C                     SETON                     U7U8LR               CEU006
     C                     DUMP                                           CEU006
     C                     RETRN                                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                                       CSD015
      ** Determine if CSC011 enhancement is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSC011'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   DLDA                                                          CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CSC011'  DBKEY                                               CSD015
     C                     MOVEL'FT0090'  DBPGM                                               CSD015
     C                     Z-ADD30        DBASE                                               CSD015
     C                     OUT  DLDA                                                          CSD015
     C                     MOVE *ON       *INU7                                               CSD015
     C                     MOVE *ON       *INU8                                               CSD015
     C                     MOVE *ON       *INLR                                               CSD015
     C                     DUMP                                                               CSD015
     C                     RETRN                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Determine if CSD015 enhancement is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   DLDA                                                          CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'FT0090'  DBPGM                                               CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     OUT  DLDA                                                          CSD015
     C                     MOVE *ON       *INU7                                               CSD015
     C                     MOVE *ON       *INU8                                               CSD015
     C                     MOVE *ON       *INLR                                               CSD015
     C                     DUMP                                                               CSD015
     C                     RETRN                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       CSD015
      ** Access AOWLCCR0 to check if function code 'CHEQCAOLL' is available                   CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY'    POPTN                                               CSD015
     C                     PARM 'CHEQCOLL'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF'                                                        CSD015
     C           *LOCK     IN   DLDA                                                          CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     MOVEL'FT0090'  DBPGM                                               CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     OUT  DLDA                                                          CSD015
     C                     MOVE *ON       *INU7                                               CSD015
     C                     MOVE *ON       *INU8                                               CSD015
     C                     MOVE *ON       *INLR                                               CSD015
     C                     DUMP                                                               CSD015
     C                     RETRN                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If return code is equal to blank, set WELCC to 'Y'                                   CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C                     MOVE 'Y'       WELCC   1                                           CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access AOWLCCR0 to check if function code 'CHEQPAID' is available                    CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY'    POPTN                                               CSD015
     C                     PARM 'CHEQPAID'PFUNC                                               CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF'                                                        CSD015
     C           *LOCK     IN   DLDA                                                          CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     MOVEL'FT0090'  DBPGM                                               CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     OUT  DLDA                                                          CSD015
     C                     MOVE *ON       *INU7                                               CSD015
     C                     MOVE *ON       *INU8                                               CSD015
     C                     MOVE *ON       *INLR                                               CSD015
     C                     DUMP                                                               CSD015
     C                     RETRN                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If return code is equal to blank, set WELCP to 'Y'                                   CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C                     MOVE 'Y'       WELCP   1                                           CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CRE020
      ** Check if Online Printing of Advices (GE7) is on                                      CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   @RTCD                                               CRE020
     C                     PARM '*VERIFY' @OPTN                                               CRE020
     C                     PARM 'CRE020'  @SARD                                               CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C           @RTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     MOVEL'FT0090'  RPRGMN                                              CRE020
      *                                                                                       CRE020
     C                     ELSE                                                               CRE020
     C           @RTCD     IFNE '*NRF   '                                                     CRE020
     C           *LOCK     IN   DLDA                                                          CRE020
     C                     Z-ADD34        DBASE                                               CRE020
     C                     MOVEL'CRE020'  DBPGM                                               CRE020
     C                     MOVEL'SCSARDPD'DBKEY                                               CRE020
     C                     OUT  DLDA                                                          CRE020
     C                     MOVE *ON       *INU7                                               CRE020
     C                     MOVE *ON       *INU8                                               CRE020
     C                     MOVE *ON       *INLR                                               CRE020
     C                     DUMP                                                               CRE020
     C                     RETRN                                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE *BLANKS   PSVOP1 20                                           CRE020
     C                     MOVE *BLANKS   PSVOP2 20                                           CRE020
      *                                                                                       CRE020
     C                     MOVELCPAVAL    PSVOP1                                              CRE020
     C                     MOVELCCOVAL    PSVOP2                                              CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   PBLNK1 20                                           CRE020
     C                     MOVE *BLANKS   PBLNK2200                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   @RTCD                                               CRE020
     C                     PARM           PSVOP1                                              CRE020
     C                     PARM           PSVAL1200                                           CRE020
     C                     PARM           PSVOP2                                              CRE020
     C                     PARM           PSVAL2200                                           CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
     C                     PARM           PBLNK1                                              CRE020
     C                     PARM           PBLNK2                                              CRE020
      *                                                                                       CRE020
     C           @RTCD     IFNE *BLANKS                                                       CRE020
     C           *LOCK     IN   DLDA                                                          CRE020
     C                     Z-ADD35        DBASE                                               CRE020
     C                     MOVEL'CRE020'  DBPGM                                               CRE020
     C                     MOVEL'SDSVALPD'DBKEY                                               CRE020
     C                     OUT  DLDA                                                          CRE020
     C                     MOVE *ON       *INU7                                               CRE020
     C                     MOVE *ON       *INU8                                               CRE020
     C                     MOVE *ON       *INLR                                               CRE020
     C                     DUMP                                                               CRE020
     C                     RETRN                                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if ULX043 is on                                                                CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX043  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX043'  @SARD                                               CER001
     C           SCSARD    PARM SCSARD    DSFDY                                               CER001
      *                                                                                       CER001
     C           @RTCD     IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX043                                              CER001
     C                     MOVEL'FT0090'  RPRGMN                                              CER001
      *                                                                                       CER001
     C                     ELSE                                                               CER001
     C           @RTCD     IFNE '*NRF   '                                                     CER001
     C           *LOCK     IN   DLDA                                                          CER001
     C                     Z-ADD35        DBASE                                               CER001
     C                     MOVEL'ULX043'  DBPGM                                               CER001
     C                     MOVEL'SCSARDPD'DBKEY                                               CER001
     C                     OUT  DLDA                                                          CER001
     C                     MOVE *ON       *INU7                                               CER001
     C                     MOVE *ON       *INU8                                               CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     DUMP                                                               CER001
     C                     RETRN                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER049
      ** Access SAR file to determine if CER049                                               CER049
      ** (Stamp Tax) is installed.                                                            CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  @SARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE *ON       *IN54                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVE *OFF      *IN54                                               CER049
     C                     ENDIF                                                              CER049
     C/COPY WNCPYSRC,FT0090C008
     C*                                                                   S01494
     C** Retrieve the text "User not found" using MEC1150                 S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2510' #MSGID  7                       S01494
     C                     PARM 'FTUSRMSG'#MSGF  10                       S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    WM2510 28                       S01494
     C*                                                                   S01194
     C** Call to access pgm for bank details                              S01194
     C*                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOBANK                                    S01194
     C*                                                                   S01194
     C**READ*TABLE*FILE*FOR LOCAL CURRENCY                                S01194
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELLOCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD13        DBASE            * DB ERROR 13 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for local currency  details                   S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM LOCY      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C* STORE NUMBER OF DECIMAL PLACES
     C                     MOVE CDP       LCDP    10
     C                     MOVE MDIN      LMDIN   10
     C                     Z-ADDSPOT      LSPOT  138
     C**READ*TABLE*FILE*FOR*BASE*CURRENCY*                                S01194
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELBCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD3         DBASE            * DB ERROR 03 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for base currency  details                    S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM BCCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C* STORE NUMBER OF DECIMAL PLACES AND SET 35,36,37 OR 38
     C                     MOVE CDP       BCDP    10
     C                     MOVE MDIN      BMDIN   10
     C                     MOVEA'0000'    *IN,35
     C           35        ADD  CDP       Q       30
     C                     MOVE '1'       *IN,Q                           S01117
     C**READ*PAYMENT*CHARGES*RECORD*                                      S01117
     C*********************MOVE '1'       *IN,Q                           S01117
     C***********1*********CHAINPYCHGDD              80                   S01117
     C**N80******RECI******COMP 'D'                  8080                 S01117
     C***80****************DO                              B003           S01117
     C************LOCK*****IN   DLDA                                      S01117
     C*********************MOVE 'FT0090'  DBPGM                           S01117
     C*********************MOVE 'PYCHG'   DBFILE           ***************S01117
     C*********************Z-ADD4         DBASE            * DB ERROR 04 *S01117
     C*********************MOVEL'1'       DBKEY            ***************S01117
     C*********************OUT  DLDA                                      S01117
     C*********************SETON                     U7U8LR               S01117
     C*********************DUMP                                           S01117
     C*********************RETRN                                          S01117
     C*********************END                             E003           S01117
     C*********************                                         S01241S01117
     C**SEE*IF*WINDOW*IS*REQUIRED*                                  S01241S01194
     C*********************                                         S01241S01194
     C***********1*********SETLLSDMMODPD                            S01241S01194
     C*********************READ SDMMODPD               8080         S01241S01194
     C************IN80*****IFEQ '1'                                 S01241S01194
     C************LOCK*****IN   DLDA                                S01241S01194
     C*********************MOVE 'FT0090'  DBPGM                     S01241S01194
     C*********************MOVE 'SDMMOD'  DBFILE           *********S01241S01194
     C*********************Z-ADD99        DBASE            * DB ERROS01241S01194
     C*********************MOVEL'1'       DBKEY            *********S01241S01194
     C*********************OUT  DLDA                                S01241S01194
     C*********************SETON                     U7U8LR         S01241S01194
     C*********************DUMP                                     S01241S01194
     C*********************RETRN                                    S01241S01194
     C*********************END                                      S01241S01194
     C*                                                                   S01194
     C** Call to Midas Modules access pgm                                 S01194
     C*                                                                   S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                                   S01194
     C** If Multibranched                                                 S01194
     C*                                                                   S01194
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN50                           S01117
     C                     END                                            S01117
      *                                                                   CAC001
      **  If Analytical Accounting is installed, enable F19 for           CAC001
      **  Margin Information.                                             CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE '1'       *IN16                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE '0'       *IN16                           CAC001
     C                     END                                            CAC001
     C*                                                                   S01194
     C** Call to General Ledger access pgm                                S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN51                           S01117
     C                     END                                            S01117
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
     C                     MOVE '1'       *IN71                           S01414
     C                     END                                            S01414
     C*                                                                   S01194
     C** Call to Funds Transfer access pgm                                S01194
     C** Read FT ICD file                                                 S01194
     C*                                                                   S01194
     C                     CALL 'AOFTFRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDFTFR    PARM SDFTFR    DSFDY                           S01194
     C*                                                                   S01194
     C* 'MINUS1' & 'PLUS1' ARE VALUE THAT CAN BE PLACED IN 'BORF'
     C*  (I.E. BACKWARDS OR FORWARDS) TO PAGE BACK AND FORTH THRU
     C*  THE FILES.
     C                     Z-ADD-1        MINUS1  10
     C                     Z-ADD+1        PLUS1   10
     C*
     C/COPY WNCPYSRC,FT0090C001
     C                     ENDSR
     C*
     C************************************************************
     C* END OF INITIAL SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C* VALONE SR.
     C* TO VALIDATE ENTRIES FOR SCREEN ONE
     C*
     C           VALONE    BEGSR
     C/COPY WNCPYSRC,FT0090C025
     C*
     C* CLEAR ERROR CODES AND SET OFF INDICATORS
     C                     Z-ADD1         Z       30
     C                     MOVE *BLANK    ERCD
     C                     MOVEA'00000'   *IN,20
     C                     MOVEA'000'     *IN,87
     C                     MOVEA'0000'    *IN,40
     C*
     C**   VALIDATE CHEQUE REFERENCE
     C**   CANNOT BE - BLANK
     C**             - NOT ON FILE
     C**             - ENTERED ON DIFFERENT DAY
     C**             - ALREADY FULLY AUTHORISED
     C*
     C           PREF      IFEQ *BLANK                     B001
     C                     SETON                     2089
     C*********************MOVE ' 069'    ERCD,Z           MANDATORY      S01117
     C                     MOVE ' 002'    ERCD,Z           MANDATORY      S01117
     C                     ADD  1         Z
     C                     GOTO VALTOT
     C                     END                             E001
      *                                                                   042167
      * Call CL program to check for other users                          042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE  7                       042167
     C                     MOVE 'FT'      @MODLE  2                       042167
     C                     MOVE PREF      @TREF  15                       042167
     C                     MOVE *BLANKS   @RTINF 80                       042167
     C           *IN45     IFEQ '1'                                       042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
     C                     END                                            042167
      *                                                                   042167
      *  If 'IN USE' then redisplay subfile with error message            042167
      *                                                                   042167
     C           @RTCDE    IFEQ '*IN USE'                                 042167
     C                     MOVE ' 600'    ERCD,Z                          042167
     C                     ADD  1         Z                               042167
      *                                                                   042167
      *        Load error message for record lock                         042167
      *                                                                   042167
     C                     SETON                     89                   042167
     C                     SETON                     20                                      BUG9055
     C                     GOTO VLEND                                     002167
     C                     END                                            042167
      *                                                                   042167
     C                     SETOF                     8887
     C                     MOVE 00        CQSQ
     C           CQKEY     CHAINCQPACDDF             88
     C  N88      RECI      COMP 'D'                  8787
     C   88
     COR 87                DO                              B001
     C      87             EXCPTRCQPAC
     C                     GOTO TOOCOL
     C                     END
     C*
     C* STORE USER FOR VALIDATION CHECK
     C*
     C                     MOVE *BLANKS   USER
     C                     MOVE INUSR1    USER,1
     C*                                                                   S01494
     C** Get name of Input User 1 from MUSER                              S01494
     C*                                                                   S01494
     C                     MOVE INUSR1    IUSR1                           S01494
     C           IUSR1     CHAINMUSER                80                   S01494
     C  N80      RECI      COMP 'D'                  8080                 S01494
     C***80******          DO                                      S01494 S01494
     C************LOCK     IN   DLDA                               S01494 S01494
     C***********          MOVE 'FT0090'  DBPGM                    S01494 S01494
     C***********          MOVE 'MUSER'   DBFILE           ********S01494 S01494
     C***********          Z-ADD20        DBASE            * DBERR S01494 S01494
     C***********          MOVELIUSR1     DBKEY            ********S01494 S01494
     C***********          MOVE '*'       @RETC                    S01494 S01494
     C***********          OUT  DLDA                               S01494 S01494
     C***********          SETON                     U7U8LR        S01494 S01494
     C***********          DUMP                                    S01494 S01494
     C***********          RETRN                                   S01494 S01494
     C***********          END                                     S01494 S01494
     C*                                                                   S01494
     C**  If error occurred, display text "User not found" and            S01494
     C**  stop authorisation                                              S01494
     C*                                                                   S01494
     C           *IN80     IFEQ '1'                                       S01494
     C                     MOVELWM2510    USNM1                           S01494
     C                     MOVE 'Y'       USERR                           S01494
     C                     ELSE                                           S01494
     C                     MOVE USER1     USNM1                           S01494
     C                     END                                            S01494
     C*
     C* SWITCH GENERATE P/R ON FOR CL CALLING PGM
     C*
     C                     MOVE 'Y'       GENPR   1
     C*
     C                     Z-ADD2         A
     C           INUSR2    IFNE *BLANKS
     C                     MOVE INUSR2    USER,A
     C                     ADD  1         A
     C*                                                                   S01494
     C** Get name of Input User 2 from MUSER if it is not equal to        S01494
     C** Input User 1                                                     S01494
     C*                                                                   S01494
     C                     MOVE INUSR2    IUSR2                           S01494
     C*                                                                   S01494
     C           INUSR1    IFEQ INUSR2                                    S01494
     C                     MOVE USNM1     USNM2                           S01494
     C                     ELSE                                           S01494
     C           IUSR2     CHAINMUSER                80                   S01494
     C  N80      RECI      COMP 'D'                  8080                 S01494
     C***80******          DO                                      S01494 S01494
     C************LOCK     IN   DLDA                               S01494 S01494
     C***********          MOVE 'FT0090'  DBPGM                    S01494 S01494
     C***********          MOVE 'MUSER'   DBFILE           ********S01494 S01494
     C***********          Z-ADD21        DBASE            * DBERR S01494 S01494
     C***********          MOVELIUSR2     DBKEY            ********S01494 S01494
     C***********          MOVE '*'       @RETC                    S01494 S01494
     C***********          OUT  DLDA                               S01494 S01494
     C***********          SETON                     U7U8LR        S01494 S01494
     C***********          DUMP                                    S01494 S01494
     C***********          RETRN                                   S01494 S01494
     C***********          END                                     S01494 S01494
     C*
     C**  If error occurred, display text "User not found" and            S01494
     C**  stop authorisation                                              S01494
     C*                                                                   S01494
     C           *IN80     IFEQ '1'                                       S01494
     C                     MOVELWM2510    USNM2                           S01494
     C                     MOVE 'Y'       USERR                           S01494
     C                     ELSE                                           S01494
     C                     MOVE USER1     USNM2                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     ELSE                                           S01494
     C                     MOVE *BLANKS   IUSR2                           S01494
     C                     MOVE *BLANKS   USNM2                           S01494
     C                     END
     C*
      ** When CSD015 enhancement is installed  and WELCP is equal to 'Y'                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
      *                                                                                       CSD015
     C           WELCP     IFEQ 'Y'                                                           CSD015
     C                     MOVEL'CQPACDD' KFUNT                                               CSD015
     C                     MOVELPREF      KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             57                                       CSD015
      *                                                                                       CSD015
      ** If record found and under investigation, activate *IN46 to display on                CSD015
      ** the report, 'Item under review by Compliance Officer'                                CSD015
      *                                                                                       CSD015
     C           *IN57     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
      *                                                                                       CSD015
      ** Display error code 500: Item under review by Compliance Officer                      CSD015
      *                                                                                       CSD015
     C                     MOVE *ON       *IN20                                               CSD015
     C                     MOVE *ON       *IN89                                               CSD015
     C                     MOVE ' 500'    ERCD,Z                                              CSD015
     C                     ADD  1         Z                                                   CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     SETON                     40    RECORD FOUND
     C                     EXCPTRCQPAC
     C*
     C                     EXSR MOVESR
     C**
     C*  POSITION FILE CURSOR ON FIRST CHEQUE - ERROR IF NOT FOUND
     C**
     C                     Z-ADD1         CQSQ
     C           CQKEY     SETLLCQPADDDF                 85
     C           *IN85     IFNE '1'
     C                     SETON                     88
     C                     EXSR ERFILE
     C                     GOTO DATAUT
     C                     END                             ** E01
     C*
     C                     Z-ADD0         CHQNO   20
     C                     MOVE 'Y'       GOON    1
     C**
     C*  LOOP THROUGH CHEQUES UNTIL A LIVE ONE IS FOUND
     C**
     C           GOON      DOWEQ'Y'                        ** B01
     C*
     C           PREF      READECQPADDDF               8888
     C*
     C*  TERMINATE LOOP IF NO RECORD FOUND
     C*
     C           *IN88     IFEQ '1'                        ** B02
     C                     MOVE 'N'       GOON
     C                     ELSE                            ** X02
     C*
     C*  RECORD FOUND - RELEASE IT
     C*
     C                     EXCPTRCQPAD
     C*
     C*  TERMINATE LOOP IF LIVE RECORD FOUND
     C*
     C           RECI      IFEQ 'D'                        ** B03
     C                     MOVE 'N'       GOON
     C                     SETON                     41    RECORD FOUND
     C                     GOTO DATAUT
     C                     ELSE                            ** X03
     C*
     C*  DELETED RECORD FOUND - INCREMENT COUNT OF CHQS FOR THIS HEADER
     C*        AND IF NO LIVE RECORDS FOR THIS HEADER(COUNT = 50)
     C*        TERMINATE LOOP WITH ERROR.
     C*
     C                     ADD  1         CHQNO
     C           CHQNO     IFEQ 50                         ** B04
     C                     MOVE 'N'       GOON
     C                     MOVE '1'       *IN88
     C                     END                             ** E04
     C*
     C                     END                             ** E03
     C*
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C           *IN88     IFEQ '1'                        ** B01
     C                     EXSR ERFILE
     C                     GOTO DATAUT
     C                     END                             ** E01
     C*
     C           TOOCOL    TAG
     C**         ------    ---
     C                     SETOF                     8788
     C                     MOVE 00        CQSQ
     C           CQKEY     CHAINCQCODDDF             88
     C**N88***** RECI      COMP 'D'                  8787                                  AR804457A
     C           *IN88     IFEQ '0'                                                        AR804457A
     C           RECI      IFEQ 'D'                                                        AR804457A
     C           RECI      OREQ 'M'                                                        AR804457A
     C           AUIN      ANDEQ'R'                                                        AR804457A
     C                     MOVE '0'       *IN87                                            AR804457A
     C                     ELSE                                                            AR804457A
     C                     MOVE '1'       *IN87                                            AR804457A
     C                     ENDIF                                                           AR804457A
     C                     ENDIF                                                           AR804457A
     C   87
     COR 88                DO
     C      87             EXCPTRCQCOD
     C                     EXSR ERFILE
     C                     END
     C     N87N88          DO
     C                     MOVE *BLANKS   USER                            E36921
     C                     MOVE INUSR1    USER,1                          E36921
     C                     Z-ADD2         A       20                      E36921
     C                     SETON                     42    RECORD FOUND
     C                     EXCPTRCQCOD
     C                     EXSR MOVESR
     C*                                                                   S01494
     C** Get name of Input User 1 from MUSER                              S01494
     C*                                                                   S01494
     C                     MOVE INUSR1    IUSR1                           S01494
     C           IUSR1     CHAINMUSER                80                   S01494
     C  N80      RECI      COMP 'D'                  8080                 S01494
     C***80******          DO                                      S01494 S01494
     C************LOCK     IN   DLDA                               S01494 S01494
     C***********          MOVE 'FT0090'  DBPGM                    S01494 S01494
     C***********          MOVE 'MUSER'   DBFILE           ********S01494 S01494
     C***********          Z-ADD22        DBASE            * DBERR S01494 S01494
     C***********          MOVELIUSR1     DBKEY            ********S01494 S01494
     C***********          MOVE '*'       @RETC                    S01494 S01494
     C***********          OUT  DLDA                               S01494 S01494
     C***********          SETON                     U7U8LR        S01494 S01494
     C***********          DUMP                                    S01494 S01494
     C***********          RETRN                                   S01494 S01494
     C***********          END                                     S01494 S01494
     C*                                                                   S01494
     C**  If error occurred, display text "User not found" and            S01494
     C**  stop authorisation                                              S01494
     C*                                                                   S01494
     C           *IN80     IFEQ '1'                                       S01494
     C                     MOVELWM2510    USNM1                           S01494
     C                     MOVE 'Y'       USERR                           S01494
     C                     ELSE                                           S01494
     C                     MOVE USER1     USNM1                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END
     C                     SETOF                     8788
     C**
     C*  POSITION FILE CURSOR ON FIRST CHEQUE - ERROR IF NOT FOUND
     C**
     C                     Z-ADD1         CQSQ
     C           CQKEY     SETLLCQCOCDDF                 85
     C           *IN85     IFNE '1'                        ** B01
     C                     SETON                     88
     C                     EXSR ERFILE
     C                     GOTO DATAUT
     C                     END                             ** E01
     C*
     C                     Z-ADD0         CHQNO   20
     C                     MOVE 'Y'       GOON    1
     C**
     C*  LOOP THROUGH CHEQUES UNTIL A LIVE ONE IS FOUND
     C**
     C           GOON      DOWEQ'Y'                        ** B01
     C*
     C           PREF      READECQCOCDDF               8888
     C*
     C*  TERMINATE LOOP IF NO RECORD FOUND
     C           *IN88     IFEQ '1'                        ** B02
     C                     MOVE 'N'       GOON
     C                     ELSE                            ** X02
     C*
      ** When CSD015 enhancement is installed  and WELCC is equal to 'Y'                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
      *                                                                                       CSD015
     C           WELCC     IFEQ 'Y'                                                           CSD015
     C                     MOVEL'CQCOCDD' KFUNT                                               CSD015
     C                     MOVELPREF      KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             57                                       CSD015
      *                                                                                       CSD015
      ** If record found and under investigation, activate *IN46 to display on                CSD015
      ** the report, 'Item under review by Compliance Officer'                                CSD015
      *                                                                                       CSD015
     C           *IN57     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
      *                                                                                       CSD015
      ** Display error code 500: Item under review by Compliance Officer                      CSD015
      *                                                                                       CSD015
     C                     MOVE *ON       *IN20                                               CSD015
     C                     MOVE *ON       *IN89                                               CSD015
     C                     MOVE ' 500'    ERCD,Z                                              CSD015
     C                     ADD  1         Z                                                   CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C*  RECORD FOUND - RELEASE IT
     C                     EXCPTRCQCOC
     C*
     C*  TERMINATE LOOP IF LIVE RECORD FOUND
     C           RECI      IFEQ 'D'                        ** B03
     C                     MOVE 'N'       GOON
     C                     SETON                     43    RECORD FOUND
     C                     GOTO DATAUT
     C                     ELSE                            ** X03
     C*
     C*  DELETED RECORD FOUND - INCREMENT COUNT OF CHQS FOR THIS HEADER
     C*        AND IF NO LIVE RECORDS FOR THIS HEADER(COUNT = 50)
     C*        TERMINATE LOOP WITH ERROR.
     C                     ADD  1         CHQNO
     C           CHQNO     IFEQ 50                         ** B04
     C                     MOVE 'N'       GOON
     C                     MOVE '1'       *IN87
     C                     END                             ** E04
     C                     END                             ** E03
     C                     END                             ** E02
     C                     END                             ** E01
     C*
     C           *IN88     IFEQ '1'                        ** B01
     C                     EXSR ERFILE
     C                     GOTO DATAUT
     C                     END                             ** E01
     C*
     C           DATAUT    TAG
     C**         ------    ---
     C   40                MOVE TOTR      HDAMT  130       'FROM
     C   40                MOVE PCCY      HDCCY   3        'CQPACDD
     C   41                MOVE CQAM      DTAMT  130       'FROM
     C   41                MOVE DRCY      DTCCY   3        'CQPADDD    D
     C*
     C      42             MOVE TOCL      HDAMT            'FROM
     C      42             MOVE SMCY      HDCCY            'CQCODDD
     C      43             MOVE CQAM      DTAMT            'FROM
     C      43             MOVE CRCY      DTCCY            'CQCOCDD    D
     C**   VALIDATE TOTAL CHEQUE VALUE +  CURRENCY
     C           VALTOT    TAG
     C* IF CALLED FROM SOMEWHERE ELSE IGNORE THIS BIT
     C  N45                GOTO VLEND
     C           TVAL      IFEQ '   '                      B001
     C                     SETON                     2189
     C*********************MOVE ' 297'    ERCD,Z           NO VALUE ?     S01117
     C                     MOVE ' 009'    ERCD,Z           NO VALUE ?     S01117
     C                     ADD  1         Z
     C                     END                             E001
     C           TCCY      IFEQ '   '                      B001
     C                     SETON                     2289
     C*********************MOVE ' 300'    ERCD,Z           NO CCY ?       S01117
     C                     MOVE ' 012'    ERCD,Z           NO CCY ?       S01117
     C                     ADD  1         Z
     C                     END                             E001
     C*
     C  N40N42
     COR 89                GOTO VALFST                     VALID RECORD
     C*                                                    SO FAR ???
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELTCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM TCCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              8989                 S01194
     C           *IN89     IFEQ '1'                                       S01194
     C                     MOVE '1'       *IN22                           S01194
     C*********************MOVE ' 301'    ERCD,Z           VALID CCY ?    S01117
     C                     MOVE ' 013'    ERCD,Z           VALID CCY ?    S01117
     C                     ADD  1         Z
     C                     GOTO VALFST
     C                     ELSE                                           S01194
     C                     EXSR AOCURR                                    S01194
     C                     END                             E001
     C*
     C                     Z-ADDCDP       ZADEC
     C           13        SUB  CDP       ZADIG
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE TVAL      ZFIELD           VALIDATE
     C                     EXSR ZALIGN                     CHQ AMOUNT
     C   99                DO                              B001
     C                     SETON                     2189
     C*********************MOVE ' 298'    ERCD,Z           NOT NUMERIC    S01117
     C                     MOVE ' 010'    ERCD,Z           NOT NUMERIC    S01117
     C                     ADD  1         Z
     C                     END                             E001
     C                     MOVE ZFIELD    AMOUNT 130
     C  N99      AMOUNT    IFNE HDAMT                      B001
     C                     SETON                     2189  ENTERED
     C*********************MOVE ' 299'    ERCD,Z           AMOUNT NOT =   S01117
     C                     MOVE ' 011'    ERCD,Z           AMOUNT NOT =   S01117
     C                     ADD  1         Z                CHQ AMOUNT
     C                     END                             E001
     C*
     C           TCCY      IFNE HDCCY                      B001
     C                     SETON                     2289  ENTERED
     C*********************MOVE ' 302'    ERCD,Z           CURRENCY NOT   S01117
     C                     MOVE ' 014'    ERCD,Z           CURRENCY NOT   S01117
     C                     ADD  1         Z                = CHQ CCY
     C                     END                             E001
     C*
     C********** TOEDT     IFNE RUND                       B001                            AR1039558
     C********** AUIN      ANDNE'R'                                              AR804457A AR1039558
     C**********           SETON                     2089                                  AR1039558
     C*********************MOVE ' 072'    ERCD,Z           NOT ENTERED    S01117
     C**********           MOVE ' 003'    ERCD,Z           NOT ENTERED              S01117 AR1039558
     C**********           ADD  1         Z                TODAY                           AR1039558
     C**********           END                             E001                            AR1039558
     C           AUIN      IFEQ 'Y'                        B001
     C                     SETON                     2089
     C*********************MOVE ' 073'    ERCD,Z           ALREADY        S01117
     C                     MOVE ' 004'    ERCD,Z           ALREADY        S01117
     C                     ADD  1         Z                AUTHORISED
     C                     END                             E001
     C**   VALIDATE FIRST CHEQUE AMOUNT & CURRENCY
     C           VALFST    TAG
     C           FVAL      IFEQ *BLANK                     B001
     C                     SETON                     2389
     C*********************MOVE ' 303'    ERCD,Z           MANDATORY      S01117
     C                     MOVE ' 015'    ERCD,Z           MANDATORY      S01117
     C                     ADD  1         Z
     C                     END                             E001
     C*                                                    SO FAR ???
     C                     Z-ADDCDP       ZADEC
     C           13        SUB  CDP       ZADIG
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE FVAL      ZFIELD           VALIDATE
     C                     EXSR ZALIGN                     1st AMOUNT
     C   99                DO                              B001
     C                     SETON                     2389
     C*********************MOVE ' 304'    ERCD,Z           NOT NUMERIC    S01117
     C                     MOVE ' 016'    ERCD,Z           NOT NUMERIC    S01117
     C                     ADD  1         Z
     C                     END                             E001
     C                     MOVE ZFIELD    AMOUNT
     C  N99      AMOUNT    IFNE DTAMT                      B001
     C                     SETON                     2389  ENTERED
     C*********************MOVE ' 305'    ERCD,Z           NOT = 1st      S01117
     C                     MOVE ' 017'    ERCD,Z           NOT = 1st      S01117
     C                     ADD  1         Z                AMOUNT
     C                     END                             E001
     C* FIRST CURRENCY IS NOT RELATED TO AMOUNT
     C           FCCY      IFEQ *BLANK                     B001
     C                     SETON                     2489
     C*********************MOVE ' 306'    ERCD,Z           MANDATORY      S01117
     C                     MOVE ' 018'    ERCD,Z           MANDATORY      S01117
     C                     ADD  1         Z
     C                     END                             E001
     C*
     C  N41N43
     COR 89                GOTO VLEND                      VALID RECORD
     C*                                                    SO FAR ???
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELFCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM FCCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     COMP *BLANKS              8989                 S01194
     C           *IN89     IFEQ '1'                                       S01194
     C                     MOVE '1'       *IN24                           S01194
     C                     MOVE ' 019'    ERCD,Z           VALID CCY ?    S01117
     C                     ADD  1         Z                               S01194
     C                     GOTO VLEND                                     S01194
     C                     ELSE                                           S01194
     C                     EXSR AOCURR                                    S01194
     C                     END                             E001           S01194
     C*********************SETON                     2489                 S01194
     C*********************MOVE ' 307'    ERCD,Z           VALID CCY ?    S01194
     C*********************ADD  1         Z                               S01194
     C*********************GOTO VLEND                                     S01194
     C*********************END                             E001           S01194
     C*
     C           FCCY      IFNE DTCCY                      B001
     C                     SETON                     2489  CURRENCY NOT
     C*********************MOVE ' 308'    ERCD,Z           = FILE         S01117
     C                     MOVE ' 020'    ERCD,Z           = FILE         S01117
     C                     ADD  1         Z                CURRENCY
     C                     END                             E001
     C           VLEND     TAG
     C*                                                                   S01117
     C** IF MULTI-BRANCHED PERFORM BRANCH/ACTION CODE AUTHORITY CHECK     S01117
     C*                                                                   S01117
     C           *IN89     IFEQ '0'                                       S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     EXSR BBAUTH                                    S01117
     C*                                                                   S01117
     C** IF ORIG BRANCH USER VALIDATION 'ON' PERFORM ORIG BR CHECK        S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                                       S01117
     C                     EXSR OBAUTH                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,FT0090C026
     C*                                                                   S01117
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF VALIDATION SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C* AUTHOR SR.
     C* DISPLAY THE AUTHORISE SCREEN
     C* ALLOW ENTRY OF F3 TO GO BACK TO INITIAL SCREEN
     C* F9 TO AUTHORISE OR ENTER TO DISPLAY DETAILS
     C*
     C           AUTHOR    BEGSR
     C/COPY WNCPYSRC,FTH00212
     C*
     C* LINE TO DEFINE F9
     C   08N08             SETON                     08
     C* READ MUSER FOR NAMES IF NOT BLANK
     C           AUP1      IFEQ *BLANK                     B001
     C                     MOVE USRID     AUP1             1ST AUTHOR
     C                     ELSE                            X001
     C                     MOVE USRID     AUP2             2ND AUTHOR
     C                     END                             E001
     C* READ MUSER FOR NAME
     C                     MOVE AUP1      USRP
     C           USRP      CHAINMUSER                80
     C  N80      RECI      COMP 'D'                  8080
     C   80                DO                              B001
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0090'  DBPGM
     C                     MOVE 'MUSER'   DBFILE           ***************
     C                     Z-ADD5         DBASE            * DB ERROR 05 *
     C                     MOVELUSRP      DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
     C                     END                             E001
     C* READ MUSER FOR SECOND NAME
     C                     MOVE USER1     NAME
     C           AUP2      IFNE *BLANK                     B001
     C                     MOVE AUP2      USRP
     C           USRP      CHAINMUSER                80
     C  N80      RECI      COMP 'D'                  8080
     C   80                DO                              B002
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0090'  DBPGM
     C                     MOVE 'MUSER'   DBFILE           ***************
     C                     Z-ADD6         DBASE            * DB ERROR 06 *
     C                     MOVELUSRP      DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
     C                     END                             E002
     C                     MOVE USER1     NAME2
     C/COPY WNCPYSRC,FTH00213
     C                     ELSE                            X001
     C                     MOVE *BLANK    NAME2            NO 2ND USER
     C                     END                             E001
     C*
     C** SETOF INDICATOR TO SHOW IF ALL SET DETAILS HAVE BEEN DISPLAYED
     C*
     C                     SETOF                     70
     C*
     C* DO LOOP UNTIL F3 OR F12
     C           *IN01     DOUEQ'1'                        B001
     C           *IN05     OREQ '1'
     C           *IN07     OREQ '1'
     C/COPY WNCPYSRC,FTH00214
     C** To move the time to 'time' on display file                       S01194
     C                     TIME           TIME                            S01194
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
     C/COPY WNCPYSRC,FT0090C024
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C                     WRITEFT0090F2
     C           AURED     TAG                             ** TAG AURED
     C                     READ FT0090F2                 80
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C                     SETOF                     252689
     C***11****************DO                              B002           S01199
     C*********************EXSR HELP                                      S01199
     C*********************GOTO AURED                                     S01199
     C*********************END                             E002           S01199
     C         08          DO                              B002
     C**   VALIDATE IF ALLOWED TO AUTHORISE   - ON F9 -
     C**   LAST USER RECORD READ IS RELEVANT
     C                     Z-ADD1         Z
     C                     MOVEA*BLANK    ERCD
     C*
     C           *IN41     IFEQ '1'                        CQPAY RECORD
     C           LVIN      ANDNE'Y'                        LEVEL 2 INPUT ?
     C                     SETON                     89
     C*********************MOVE ' 340'    ERCD,Z                          S01117
     C                     MOVE ' 007'    ERCD,Z                          S01117
     C                     ADD  1         Z
     C                     END
     C* THERE SHOULD BE NO DIFFERENCE IN CHEQUE TOTALS
     C           DIFF      IFNE 0
     C                     SETON                     89
     C*********************MOVE ' 341'    ERCD,Z                          S01117
     C                     MOVE ' 008'    ERCD,Z                          S01117
     C                     ADD  1         Z
     C                     END
     C*
     C           PAUT      IFNE 'Y'                        B003
     C*********************MOVE ' 143'    ERCD,Z           NOT ALLOWED    S01117
     C                     MOVE ' 021'    ERCD,Z           NOT ALLOWED    S01117
     C                     ADD  1         Z
     C           AUP2      IFEQ *BLANK                     B004
     C                     SETON                     2589
     C                     ELSE                            X004
     C                     SETON                     2689
     C                     END                             E004
     C                     END                             E003
     C* CHECK IF 1ST USER NOT EQUAL 2ND USER
     C           AUP1      IFEQ AUP2                       B003
     C                     SETON                     2689
     C*********************MOVE ' 162'    ERCD,Z           1ST = 2ND      S01117
     C                     MOVE ' 022'    ERCD,Z           1ST = 2ND      S01117
     C                     ADD  1         Z
     C/COPY WNCPYSRC,FTH00215
     C                     END                             E003
     C*
     C* CHECK IF 1ST USER NOT EQUAL TO INPUT USER
     C                     Z-ADD1         A
     C           USER,A    DOWNE*BLANKS                    B003
     C           A         ANDLE52
     C           AUP1      IFEQ USER,A                     B004
     C                     SETON                     2589
     C*********************MOVE ' 409'    ERCD,Z                          S01117
     C                     MOVE ' 024'    ERCD,Z                          S01117
     C                     END                             E004
     C                     ADD  1         A
     C                     END                             E003
     C***********ERCD,Z****IFEQ ' 409'                     B003           S01117
     C           ERCD,Z    IFEQ ' 024'                     B003           S01117
     C                     ADD  1         Z
     C                     END                             E003
     C*
     C* CHECK IF 2ND USER NOT EQUAL TO INPUT USER
     C           AUP2      IFNE *BLANKS
     C                     Z-ADD1         A
     C           USER,A    DOWNE*BLANKS                    DO LOOP
     C           A         ANDLE52
     C           AUP2      IFEQ USER,A                     IF ERR FOUND
     C                     SETON                     2589
     C*********************MOVE ' 409'    ERCD,Z                          S01117
     C                     MOVE ' 024'    ERCD,Z                          S01117
     C                     END                             END ERR FOUND
     C                     ADD  1         A
     C                     END                             END DO LOOP
     C***********ERCD,Z****IFEQ ' 409'                                    S01117
     C           ERCD,Z    IFEQ ' 024'                                    S01117
     C                     ADD  1         Z
     C                     END
     C                     END
     C*
     C** CHECK IF ALL DETAILS HAVE BEEN DISPLAYED FOR THIS PAYMENT
     C*
     C  N70                DO                              B003
     C                     SETON                     89
     C*********************MOVE ' 279'    ERCD,Z                          S01117
     C                     MOVE ' 023'    ERCD,Z                          S01117
     C                     ADD  1         Z
     C                     END                             E003
     C/COPY WNCPYSRC,FT0090C021
     C*
     C* IF NOT ERRORS UPDATE FILE
     C*                                                                   S01494
     C** If user not found, stop authorisation and go to initial screen   S01494
     C*                                                                   S01494
     C           USERR     IFNE 'Y'                                       S01494
     C*                                                                   S01494
     C           FTNOUP    IFEQ *BLANKS                                   058694
     C  N89                EXSR FILEUP
     C                     END                                            058694
     C*                                                                   S01494
     C                     ELSE                                           S01494
     C                     MOVE '1'       *IN05                           S01494
     C                     MOVE ' '       USERR   1                       S01494
     C                     END                                            S01494
     C                     END                             E002
     C**N07******                                                         CAC001
     C***ANN01N05N08       DO                              B002           CAC001
     C**IF*ENTER*HAS*BEEN*PRESSED*DISPLAY*DETAILS**************           CAC001
     C***41******          EXSR DSSPRO                                    CAC001
     C***43******          EXSR DSPCOL                                    CAC001
      ***********                                                         CAC001
      ****If*ENTER*has*been*pressed,*display*details.                     CAC001
      ***********                                                         CAC001
     C************IN01     IFEQ '0'                        B002           CAC001
     C************IN05     ANDEQ'0'                                       CAC001
     C************IN08     ANDEQ'0'                                       CAC001
     C************IN07     ANDEQ'0'                                       CAC001
     C************INKT     ANDEQ'0'                                       CAC001
     C***********                                                         CAC001
     C************IN41     IFEQ '1'                                       CAC001
     C***********          EXSR DSSPRO                                    CAC001
     C***********          ENDIF                                          CAC001
     C***********                                                         CAC001
     C************IN43     IFEQ '1'                                       CAC001
     C***********          EXSR DSPCOL                                    CAC001
     C***********          ENDIF                                          CAC001
     C***********                                                         CAC001
     C  N07                                                               CAC001
     CANN01N05N08          DO                              B002           CAC001
     C* IF ENTER HAS BEEN PRESSED DISPLAY DETAILS                         CAC001
     C   41                EXSR DSSPRO                                    CAC001
     C   43                EXSR DSPCOL                                    CAC001
     C                     SETOF                     01
     C                     END                             E002
     C                     END                             E001
     C* SETUP RETURN CODE
     C   01                MOVE '1'       @RETC
     C   05N08             MOVE '5'       @RETC
     C           *IN07     IFEQ '1'                                       E29970
     C                     MOVE '7'       @RETC                           E29970
     C                     END                                            E29970
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF AUTHORISATION SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C*  DISPLAY ALL THE 'CHEQUES TO BE PAID' SCREENS
     C*
     C           DSSPRO    BEGSR
     C*
     C           SCREN1    TAG
     C                     EXSR VALPHD
     C** To move the time to 'time' on display file                       S01194
     C                     TIME           TIME                            S01194
     C/COPY WNCPYSRC,FT0090C002
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C                     EXFMTFT0090F3
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C   01                GOTO ENDSP
     C*
     C           SCREN2    TAG
     C** To move the time to 'time' on display file                       S01194
     C                     TIME           TIME                            S01194
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C                     EXFMTFT0090F4
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C   01                GOTO ENDSP
     C   02                GOTO SCREN1
     C*
     C           SCREN3    TAG
     C** To move the time to 'time' on display file                       S01194
     C                     TIME           TIME                            S01194
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C                     EXFMTFT0090F5
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C   01                GOTO ENDSP
     C   02                GOTO SCREN2
     C*
     C                     MOVE 00        CQSQ
     C                     MOVE PLUS1     BORF    10
     C*
     C           PAYDTL    TAG
     C*          ------    ---
     C           CQSQ      ADD  BORF      CQSQ
     C*
     C           CQSQ      IFEQ 00                         'FINISHED
     C                     GOTO SCREN1                      HERE
     C                     END
     C*
     C           CQSQ      IFEQ 51
     C           CQSQ      ORGT NCSQ
     C                     SETON                     01
     C                     GOTO ENDSP                       SCREEN
     C                     END
     C*
     C                     EXSR VALPDT
     C*
     C*  DO NOT DISPLAY SCREEN IF CHEQUE HAS BEEN DELETED (87 ON)
     C*
     C* STORE INPUT USER
     C* Only if not previously stored for the transaction (IN78 Off)      045509
     C*                                                                   045509
     C**********           MOVE INUSR1    USER,A                          E36921
     C**********           ADD  1         A                               E36921
     C*                                                                   045509
     C           INUSR1    LOKUPUSER                     78               045509
     C           *IN78     IFNE '1'                                       045509
     C     N87             MOVE INUSR1    USER,A                          E36921
     C     N87             ADD  1         A                               E36921
     C                     END                                            045509
     C/COPY WNCPYSRC,FT0090C015
     C*                                                                   S01194
     C** To move the time to 'time' on display file                       S01194
     C*                                                                   S01194
     C                     TIME           TIME                            S01194
     C*
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C           *IN87     IFEQ '0'                                       058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
     C                     END                                            058694
      *                                                                   058694
     C     N87             EXFMTFT0090F6
     C/COPY WNCPYSRC,FT0090C011
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
     C/COPY WNCPYSRC,FT0090C012
      *                                                                   CAC001
      **  If F19 is pressed and Analytical Accounting is installed,       CAC001
      **  setup data to be passed to window manager WN0010                CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C           *IN87     ANDEQ*OFF                                      CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE 'E'       ACTN                            CAC001
     C                     MOVE 'E'       WACTN                           CAC001
     C                     MOVE 'P'       WPSIN                           CAC001
     C                     MOVE DRCY      SMCY                            CAC001
     C                     Z-ADD0         TOCL                            CAC001
      *                                                                   CAC001
      **  Call window manager WN0010                                      CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM           ##PGM  10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM           ACTN    1                       CAC001
     C**********           PARM           DATA                                         CAC001 CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C           #RTRN     IFEQ 'Y2U9999'                                 CAC001
     C                     MOVE *ON       *IN01                           CAC001
     C                     GOTO ENDSP                                     CAC001
     C                     ELSE                                           CAC001
     C           #RTRN     IFEQ 'USR0790'                                 CAC001
     C           #RTRN     OREQ *BLANKS                                   CAC001
     C                     Z-ADD0         BORF                            CAC001
     C                     GOTO PAYDTL                                    CAC001
     C                     ELSE                                           CAC001
     C           #RTRN     IFNE *BLANK                                    CAC001
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'FT0090'  ZAPGM  10                       CAC001
     C                     PARM           ZAPGRL  5                       CAC001
     C                     PARM #RTRN     ZAMSID  7                       CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10                       CAC001
     C                     PARM           ZAMSDA132                       CAC001
     C                     PARM           ZAMSTP  7                       CAC001
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM                           CAC001
     C                     MOVEL*BLANK    ZAPGRL                          CAC001
     C                     MOVEL*BLANK    ZAMSID                          CAC001
     C                     MOVEL*BLANK    ZAMSGF                          CAC001
     C                     MOVEL*BLANK    ZAMSDA                          CAC001
     C                     MOVEL*BLANK    ZAMSTP                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   058694
      *                                                                   S01241
      *  CALL WINDOW PROCESSING                                           S01241
      *                                                                   S01241
      *                                                                   058694
      *  Call SRWIND only if live record                                  058694
      *                                                                   058694
     C           *IN87     IFEQ '0'                                       058694
     C           *IN01     ANDEQ'0'                                       058694
     C           *IN02     ANDEQ'0'                                       058694
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE PREF      PREFX                                               CER001
     C                     MOVE CQSQ      CQSQX                                               CER001
     C           *IN87     IFEQ '0'                                                           CER001
     C           *IN01     ANDEQ'0'                                                           CER001
     C           *IN02     ANDEQ'0'                                                           CER001
     C                     CALL 'FT0090A'                                                     CER001
     C                     PARM           ACTION  1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           WWRTRN  7                                           CER001
     C                     PARM           SPARE 256                                           CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      * Call CL program to de-allocate                                                        CER001
      *                                                                                       CER001
     C                     MOVE *BLANKS   @RTCDE                                              CER001
     C                     MOVE 'FT'      @MODLE                                              CER001
     C                     MOVE *BLANKS   @TREF                                               CER001
     C                     MOVE *BLANKS   @RTINF                                              CER001
     C                     CALL 'AOC8000'                                                     CER001
     C                     PARM           @RTCDE                                              CER001
     C                     PARM           @MODLE                                              CER001
     C                     PARM           @TREF                                               CER001
     C                     PARM           @RTINF                                              CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** F12 has been pressed                                                                 CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'USR0790'                                                     CER001
     C                     MOVE '1'       *IN12                                               CER001
     C                     MOVEL'Y'       FTNOUP                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     EXSR SRWIND                                    058694
     C/COPY WNCPYSRC,FT0090C018
      *                                                                   058694
      *  If no update if not blank redisplay record                       058694
      *                                                                   058694
     C           FTNOUP    IFNE *BLANKS                                   058694
     C           *IN01     ANDEQ'0'                                       058694
     C                     Z-ADD0         BORF                            058694
     C                     GOTO PAYDTL                                    058694
     C                     END                                            058694
     C/COPY WNCPYSRC,FT0090C019
     C                     END                                            058694
      *                                                                   058694
     C********** BGL5ST    IFEQ 'Y'                                S01241 S01251
     C***********BGWDPR    IFEQ 'Y'                                S01251 058694
     C***********                                                         058694
      *****/copy*to move data into the data structure fields passedS01241 058694
      ******as*a*parameter to the window controller                S01241 058694
      *COPY*QWINDSRC,FT0090MOV1                                    S01241 058694
      ***********                                                  S01241 058694
     C***********          MOVEL'E'       #ACTN   1                S01241 058694
     C***********          MOVE *BLANKS   RTNCDE  7                S01241 058694
     C***********          MOVE *BLANKS   ##CMD   2                S01241 058694
     C***********          MOVEL'FT0090'  ##PGM  10                S01241 058694
     C***********          CALL 'WN0010'                           S01241 058694
     C***********          PARM           ##PGM                    S01241 058694
     C***********          PARM           ##CMD                    S01241 058694
     C***********          PARM           #ACTN                    S01241 058694
     C***********          PARM           DATA                     S01241 058694
     C*********************PARM           RTNCDE                   S01241 S01252
     C***********          PARM *BLANKS   RTNCDE                   S01252 058694
     C***********          PARM           SPARE 256                S01252 058694
     C***********          END                                     S01241 058694
     C*
      * Only set F9 allowed if F3 and F12 not pressed                     058694
      *                                                                   058694
     C           *IN01     IFEQ '0'                                       058694
     C           *IN02     ANDEQ'0'                                       058694
     C           CQSQ      IFEQ 50
     C           CQSQ      OREQ NCSQ
     C                     SETON                     70    'LAST
     C                     END
     C                     END                                            058694
     C*
     C                     MOVE PLUS1     BORF             +FORWARDS
     C   01                GOTO ENDSP                      DELETED
     C   02                MOVE MINUS1    BORF             -BACKWARDS
     C                     GOTO PAYDTL
     C*
     C           ENDSP     ENDSR
     C*
     C************************************************************
     C* END OF DISPLAY SCREENS SUBROUTINES  ##-COLLECTION-##
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C*  DISPLAY ALL THE 'CHEQUES FOR COLLECTION' SCREENS
     C*
     C           DSPCOL    BEGSR
     C*
     C**********           MOVE *BLANKS   USER                            E36921
     C**********           MOVE INUSR1    USER,1                          E36921
     C**********           Z-ADD2         A       20                      E36921
     C*
     C           SCREN7    TAG
     C                     SETOF                     02                   048377
     C                     EXSR VALCHD
     C*                                                                   S01194
     C** To move the time to 'time' on display file                       S01194
     C*                                                                   S01194
     C                     TIME           TIME                            S01194
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
      *                                                                   058694
     C*
     C                     EXFMTFT0090F7
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
      *                                                                   058694
     C*
     C/COPY WNCPYSRC,FT0090C004
     C   01                GOTO ENDSC
     C*
     C                     MOVE 00        CQSQ
     C                     MOVE PLUS1     BORF
     C           COLDTL    TAG
     C*          ------    ---
     C           CQSQ      ADD  BORF      CQSQ             'FINISHED
     C*
     C           CQSQ      IFEQ 00                          HERE
     C                     GOTO SCREN7
     C                     END
     C*
     C           CQSQ      IFEQ 51                         'LAST
     C           CQSQ      ORGT NCSQ                        SCREEN
     C                     SETON                     01
     C                     GOTO ENDSC
     C                     END
     C*
     C                     EXSR VALCDT
     C*
     C*  DO NOT DISPLAY SCREEN IF CHEQUE HAS BEEN DELETED (87 ON)
     C*
     C* STORE INPUT USER
     C* Only if not previously stored (*IN77 Off)                         045509
     C*                                                                   045509
     C**********           MOVE INUSR2    USER,A                          E36921
     C**********           ADD  1         A                               E36921
     C*                                                                   045509
     C           INUSR2    LOKUPUSER                     77               045509
     C           *IN77     IFNE '1'                                       045509
     C     N87             MOVE INUSR2    USER,A                          E36921
     C     N87             ADD  1         A                               E36921
     C                     END                                            045509
     C/COPY WNCPYSRC,FT0090C016
     C*                                                                   S01194
     C** To move the time to 'time' on display file                       S01194
     C*                                                                   S01194
     C                     TIME           TIME                            S01194
     C*
      *                                                                   058694
      * Initialise no update indicator to allow update                    058694
      *                                                                   058694
     C                     MOVEL*BLANKS   FTNOUP                          058694
      *                                                                   058694
      * Display message subfile                                           058694
      *                                                                   058694
     C           *IN87     IFEQ '0'                                       058694
     C                     MOVEL'1'       *IN56                           058694
     C                     WRITE#MSGCTL                                   058694
     C                     END                                            058694
      *                                                                   058694
     C     N87             EXFMTFT0090F8
     C/COPY WNCPYSRC,FT0090C013
      *                                                                   058694
      * Clear message subfile                                             058694
      *                                                                   058694
     C                     CALL 'Y2CLMSC'                                 058694
     C                     PARM ##PGM     FTPGMQ                          058694
     C                     PARM '*SAME'   FTPGRL                          058694
      *                                                                   058694
      * Reset message sent flag                                           058694
      *                                                                   058694
     C                     MOVEL'N'       FTMSGS                          058694
     C                     MOVEL*BLANKS   FTWARN                          058694
     C/COPY WNCPYSRC,FT0090C014
      *                                                                   CAC001
      **  If F19 is pressed and Analytical Accounting is installed,       CAC001
      **  setup data to be passed to window manager WN0010                CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C           *IN87     ANDEQ*OFF                                      CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE 'E'       ACTN                            CAC001
     C                     MOVE 'E'       WACTN                           CAC001
     C                     MOVE 'S'       WPSIN                           CAC001
     C                     MOVE CRCY      PCCY                            CAC001
     C                     Z-ADD0         TOTR                            CAC001
      *                                                                   CAC001
      **  Call window manager WN0010                                      CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM           ##PGM  10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM           ACTN    1                       CAC001
     C**********           PARM           DATA                                         CAC001 CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C           #RTRN     IFEQ 'Y2U9999'                                 CAC001
     C                     MOVE *ON       *IN01                           CAC001
     C                     GOTO ENDSC                                     CAC001
     C                     ELSE                                           CAC001
     C           #RTRN     IFEQ 'USR0790'                                 CAC001
     C           #RTRN     OREQ *BLANKS                                   CAC001
     C                     Z-ADD0         BORF                            CAC001
     C                     GOTO COLDTL                                    CAC001
     C                     ELSE                                           CAC001
     C           #RTRN     IFNE *BLANK                                    CAC001
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'FT0090'  ZAPGM  10                       CAC001
     C                     PARM           ZAPGRL  5                       CAC001
     C                     PARM #RTRN     ZAMSID  7                       CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10                       CAC001
     C                     PARM           ZAMSDA132                       CAC001
     C                     PARM           ZAMSTP  7                       CAC001
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM                           CAC001
     C                     MOVEL*BLANK    ZAPGRL                          CAC001
     C                     MOVEL*BLANK    ZAMSID                          CAC001
     C                     MOVEL*BLANK    ZAMSGF                          CAC001
     C                     MOVEL*BLANK    ZAMSDA                          CAC001
     C                     MOVEL*BLANK    ZAMSTP                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   058694
      *                                                                   S01241
      *  CALL WINDOW PROCESSING                                           S01241
      *                                                                   S01241
      *                                                                   058694
      *  Call SRWIND only if live record                                  058694
      *                                                                   058694
     C           *IN87     IFEQ '0'                                       058694
     C           *IN01     ANDEQ'0'                                       058694
     C           *IN02     ANDEQ'0'                                       058694
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     MOVE PREF      PREFX                                               CER001
     C                     MOVE CQSQ      CQSQX                                               CER001
     C           *IN87     IFEQ '0'                                                           CER001
     C           *IN01     ANDEQ'0'                                                           CER001
     C           *IN02     ANDEQ'0'                                                           CER001
     C                     CALL 'FT0090A'                                                     CER001
     C                     PARM           ACTION  1                                           CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           WWRTRN  7                                           CER001
     C                     PARM           SPARE 256                                           CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      * Call CL program to de-allocate                                                        CER001
      *                                                                                       CER001
     C                     MOVE *BLANKS   @RTCDE                                              CER001
     C                     MOVE 'FT'      @MODLE                                              CER001
     C                     MOVE *BLANKS   @TREF                                               CER001
     C                     MOVE *BLANKS   @RTINF                                              CER001
     C                     CALL 'AOC8000'                                                     CER001
     C                     PARM           @RTCDE                                              CER001
     C                     PARM           @MODLE                                              CER001
     C                     PARM           @TREF                                               CER001
     C                     PARM           @RTINF                                              CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** F12 has been pressed                                                                 CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'USR0790'                                                     CER001
     C                     MOVE '1'       *IN12                                               CER001
     C                     MOVEL'Y'       FTNOUP                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     EXSR SRWIND                                    058694
      *                                                                   058694
      *  If no update if not blank redisplay record                       058694
      *                                                                   058694
     C           FTNOUP    IFNE *BLANKS                                   058694
     C           *IN01     ANDEQ'0'                                       058694
     C                     Z-ADD0         BORF                            058694
     C                     GOTO COLDTL                                    058694
     C                     END                                            058694
     C/COPY WNCPYSRC,FT0090C020
     C                     END                                            058694
      *                                                                   058694
     C***********BGL5ST****IFEQ 'Y'                                S01241 S01251
      ***********                                                         058694
     C***********BGWDPR    IFEQ 'Y'                                 S01251058694
     C***********                                                         058694
      *****/copy*to move data into the data structure fields passed S01241058694
      ******as*a*parameter to the window controller                 S01241058694
      ***********                                                         058694
      *COPY*QWINDSRC,FT0090MOV2                                     S01241058694
      ***********                                                   S01241058694
     C***********          MOVEL'E'       #ACTN                     S01241058694
     C***********          MOVE *BLANKS   ##CMD                     S01241058694
     C***********          MOVE *BLANKS   RTNCDE                    S01241058694
     C***********          MOVEL'FT0090'  ##PGM                     S01241058694
     C***********          CALL 'WN0010'                            S01241058694
     C***********          PARM           ##PGM                     S01241058694
     C***********          PARM           ##CMD                     S01241058694
     C***********          PARM           #ACTN                     S01241058694
     C***********          PARM           DATA                      S01241058694
     C*********************PARM           RTNCDE                   S01241 S01252
     C***********          PARM *BLANKS   RTNCDE                   S01252 058694
     C***********          PARM           SPARE 256                S01252 058694
     C***********          END                                     S01241 058694
      *
      * Only set F9 allowed if F3 and F12 not pressed                     058694
      *                                                                   058694
     C           *IN01     IFEQ '0'                                       058694
     C           *IN02     ANDEQ'0'                                       058694
     C           CQSQ      IFEQ 50                         'LAST
     C           CQSQ      OREQ NCSQ                        SCREEN
     C                     SETON                     70
     C                     END
     C                     END                                            058694
      *
     C                     MOVE PLUS1     BORF             +FORWARDS
     C   01                GOTO ENDSC                      FINISH
      *
     C   02                MOVE MINUS1    BORF             -BACKWARDS
     C                     GOTO COLDTL
     C*
     C           ENDSC     ENDSR
     C*
     C************************************************************
     C* END OF DISPLAY SCREENS SUBROUTINES  ##-TO BE PAID-##
     C************************************************************
     C/COPY WNCPYSRC,FT0090C022
     C/EJECT                                                              058694
      *****************************************************************   058694
      *                                                               *   058694
      *  SRWIND   : Control Window Processing                         *   058694
      *                                                               *   058694
      *  CALLED BY: DSSPRO - Display Chq to be Paid                   *   058694
      *             DSSCOL - Display Chq for Collection               *   058694
      *                                                               *   058694
      *  CALLS    : *NONE                                             *   058694
      *                                                               *   058694
      *****************************************************************   058694
     CSR         SRWIND    BEGSR                                          058694
      *                                                                   058694
      *  Set up subroutine stack name                                     058694
      *                                                                   058694
     C                     ADD  1         S       30                      058694
     C                     MOVEL'SRWIND'  @STK,S                          058694
      *                                                                   058694
      * If window processing call WN0010                                  058694
      *                                                                   058694
     C           BGWDPR    IFEQ 'Y'                                       058694
      *                                                                   058694
      *    /copy to move data into the data structure fields passed       058694
      *     as a parameter to the window controller                       058694
      *                                                                   058694
      /COPY WNCPYSRC,FT0090MOV3                                           058694
     C                     SELEC                                          058694
      *                                                                   058694
      *     Cheques to be Paid window                                     058694
      *                                                                   058694
     C           *IN41     WHEQ '1'                                       058694
      *                                                                   058694
      *     Cheques for Collection window                                 058694
      *                                                                   058694
      /COPY WNCPYSRC,FT0090MOV1                                           058694
     C           *IN43     WHEQ '1'                                       058694
      /COPY WNCPYSRC,FT0090MOV2                                           058694
     C                     ENDSL                                          058694
      *                                                                   058694
     C                     CALL 'WN0010'                                  058694
     C/COPY WNCPYSRC,FT0090C005
     C                     PARM 'FT0090'  O#PGM  10                       058694
     C/COPY WNCPYSRC,FT0090C006
     C                     PARM *BLANKS   O#CMD   2                       058694
     C                     PARM 'E'       O#ACTN  1                       058694
     C**********           PARM           DATA                                         058694 CER001
     C                     PARM           PDATA                                               CER001
     C           R#RTN     PARM *BLANKS   O#RTN   7                       058694
     C                     PARM           SPARE 256                       058694
      *                                                                   058694
      *   /copy to move data back from the data structure fields passed   058694
      *    as a parameter to the window controller and control user       058694
      *    defined processing.                                            058694
      *                                                                   058694
      /COPY WNCPYSRC,FT0090MOV4                                           058694
      *                                                                   058694
     C           *LIKE     DEFN O#RTN     R#RTN                           058694
     C           R#RTN     CABEQ*BLANKS   EXWIND                          058694
      *                                                                   058694
      *  Check return code and send message on action                     058694
      *  - set no update as some action has been specified.               058694
      *                                                                   058694
     C                     MOVEL'Y'       FTNOUP                          058694
     C                     ROLBK                                          058694
      *                                                                   058694
     C                     SELEC                                          058694
      *                                                                   058694
      * *Return code is *User QUIT requested                              058694
      *                                                                   058694
     C           R#RTN     WHEQ 'Y2U9999'                                 058694
     C                     MOVEL'FTW0001' FTMSID                          058694
     C                     MOVEL'FTUSRMSG'FTMSGF                          058694
     C                     EXSR FTSNMS                                    058694
     C                     MOVEL'1'       *IN01                           058694
      *                                                                   058694
      * *Return code is WN Window Error                                   058694
      *                                                                   058694
     C           R#RTN     WHEQ 'USR0563'                                 058694
     C                     MOVEL'USR0563' FTMSID                          058694
     C                     MOVEL'SDUSRMSG'FTMSGF                          058694
     C                     EXSR FTSNMS                                    058694
     C                     MOVEL'1'       *IN01                           058694
      *                                                                   058694
      * *Return code is *DBF update error                                 058694
      *                                                                   058694
     C           R#RTN     WHEQ 'USR0567'                                 058694
     C                     MOVEL'USR0567' FTMSID                          058694
     C                     MOVEL'SDUSRMSG'FTMSGF                          058694
     C                     EXSR FTSNMS                                    058694
     C                     MOVEL'1'       *IN01                           058694
      *                                                                   058694
      * *Return code is *Previous Screen                                  058694
      *                                                                   058694
     C           R#RTN     WHEQ 'USR0790'                                 058694
     C                     MOVEL'FTW0002' FTMSID                          058694
     C                     MOVEL'FTUSRMSG'FTMSGF                          058694
     C                     EXSR FTSNMS                                    058694
     C                     ENDSL                                          058694
     C/COPY WNCPYSRC,FT0090C023
      *                                                                   058694
     C                     END                                            058694
      *                                                                   058694
      *  Unwind subroutine stack name                                     058694
      *                                                                   058694
     C           EXWIND    TAG                                            058694
     C                     MOVEA*BLANKS   @STK,S                          058694
     C                     SUB  1         S                               058694
      *                                                                   058694
     CSR                   ENDSR                                          058694
     C/EJECT                                                              058694
      *****************************************************************   058694
      *                                                               *   058694
      *  FTSNMS   : Send message to program's message queue           *   058694
      *                                                               *   058694
      *  CALLED BY: ALL OVER                                          *   058694
      *                                                               *   058694
      *  CALLS    : *NONE                                             *   058694
      *                                                               *   058694
      *****************************************************************   058694
     CSR         FTSNMS    BEGSR                                          058694
      *                                                                   058694
      * If no program send to FT0090                                      058694
      *                                                                   058694
     C           FTPGMQ    IFEQ *BLANK                                    058694
     C                     MOVEL##PGM     FTPGMQ                          058694
     C                     END                                            058694
      *                                                                   058694
      * If level to send is blanks default to *SAME                       058694
      *                                                                   058694
     C           FTPGRL    IFEQ *BLANK                                    058694
     C                     MOVEL'*SAME'   FTPGRL                          058694
     C                     END                                            058694
      *                                                                   058694
      * If no message file specified, use default                         058694
      *                                                                   058694
     C           FTMSGF    IFEQ *BLANK                                    058694
     C                     MOVEL'FTUSRMSG'FTMSGF                          058694
     C                     END                                            058694
      *                                                                   058694
     C                     CALL 'AOCREPT'                                 058694
     C                     PARM           FTMSID  7                       058694
     C                     PARM           FTMSGF 10                       058694
     C                     PARM           FTMSFL 10                       058694
     C                     PARM           FTMSDT256                       058694
     C                     PARM           FTPGRL  5                       058694
     C                     PARM           FTPGMQ 10                       058694
     C                     PARM           FTMSGQ 10                       058694
     C                     PARM           FTMSGT  7                       058694
      *                                                                   058694
     C                     MOVEL'Y'       FTMSGS  1                       058694
     C                     MOVELFTWARN    FTWARN  1                       058694
      *                                                                   058694
      * Clear all fields for default mechanism next time                  058694
      *                                                                   058694
     C                     MOVEL*BLANK    FTMSID                          058694
     C                     MOVEL*BLANK    FTMSGF                          058694
     C                     MOVEL*BLANK    FTMSFL                          058694
     C                     MOVEL*BLANK    FTMSDT                          058694
     C                     MOVEL*BLANK    FTPGRL                          058694
     C                     MOVEL*BLANK    FTPGMQ                          058694
     C                     MOVEL*BLANK    FTMSGQ                          058694
     C                     MOVEL*BLANK    FTMSGT                          058694
      *================================================================   058694
     CSR         FTEXIT    ENDSR                                          058694
     C/EJECT
     C************************************************************
     C*
     C* SETUP DISPLAY FIELDS FOR 'CHEQUES TO BE PAID' HEADER
     C*
     C           VALPHD    BEGSR
     C*
     C* MOVE EDITED DATES TO UNEDITED FIELDS
     C                     Z-ADDPVDTD1    PYDTW1  60
     C                     MOVE PCCY      CCYOUT
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELPCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD7         DBASE            * DB ERROR 07 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM PCCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C                     MOVE CDP       CDPH    10
     C                     MOVELSNCO      EFLD
     C                     MOVE SNCT      ETYP    1
     C                     EXSR EDFLD
     C**********           MOVE EFLD      SNCOA                                               240515
     C                     MOVELEFLD      SNCOA                                               240515
     C                     EXSR THRESH
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDPRRM      DIG1N
     C                     EXSR EDIT
     C                     MOVEADIG2      PRRMA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDTOTR      DIG1N
     C                     EXSR EDIT
     C                     MOVEADIG2      TOTRA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCOCH      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      COCHA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDDEDS      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      DEDSA
     C*                                                                   S01499
     C** If core feature S01499 is switched on,                           S01499
     C** ... format the V.A.T correspondent                               S01499
     C** ... format the V.A.T deductions                                  S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C*                                                                   S01499
     C                     MOVE *BLANK    DIG1                            S01499
     C                     Z-ADDPCVATC    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      VATCA                           S01499
     C*                                                                   S01499
     C                     MOVE *BLANK    DIG1                            S01499
     C                     Z-ADDPCVATD    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      VATDA                           S01499
     C                     END                                            S01499
      *                                                                   CEU006
      * Set up Pay delivery currency fields for Cheques to be paid        CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           PDCY      IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
      ** Call to currency codes access program                            CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM '*DBERR ' @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM PDCY      @CCY                            CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
      ** Execute Subroutine to move fields to old field names             CEU006
      *                                                                   CEU006
     C                     EXSR AOCURR                                    CEU006
      *                                                                   CEU006
     C                     MOVE *BLANK    DIG1                            CEU006
     C                     Z-ADDPDAM      DIG1N                           CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SPDAM                           CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
     C*
     C** IF SINGLE BRANCHED & REMITTING BNK= FULL ACCOUNT REMOVE BRANCH   S01117
     C*                                                                   S01117
     C                     MOVELRBK1      SRBK1                           S01117
     C           *IN50     IFEQ '0'                                       S01117
     C           RBKT      ANDEQ'G'                                       S01117
     C                     MOVE *BLANKS   RBKB                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* DISPLAY SWIFT PRIORITY CODE AS : 'U' - URGENT OR 'N' - NORMAL.    S01117
     C*                                                                   S01117
     C           SWPC      IFEQ 1                                         S01117
     C                     MOVE 'U'       SSWPC                           S01117
     C                     ELSE                                           S01117
     C           SWPC      IFEQ 2                                         S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,FT0090C033
     C*                                                                   S01117
     C                     ENDSR
     C*
     C************************************************************
     C* END OF VALUES SUBROUTINE FOR CQPACDD
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C* SETUP DISPLAY FIELDS FOR 'CHEQUES TO BE PAID' DETAIL
     C*
     C           VALPDT    BEGSR
     C/COPY WNCPYSRC,FT0090C027
     C*
     C           CQKEY     CHAINCQPADDDF             60    =PERMIT TO TRY
     C           *IN60     IFEQ '0'                                       042167
     C                     EXCPTRCQPAD                                    042167
     C                     END                                            042167
     C   60                GOTO ENDPDT                     TO AUTHORISE
     C           RECI      COMP 'D'                  8787  =IGNORE
     C   87                GOTO ENDPDT
     C                     MOVE CDPH      CDP
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCQAM      DIG1N
     C                     EXSR EDIT
     C                     MOVEADIG2      CQAMA
     C* MOVE EDITED DATES TO UNEDITED FIELDS
     C                     Z-ADDDRVDD1    DRVDW1  60
     C                     MOVE DRCY      CCYOUT
     C           CQSQ      ADD  3         SCRP
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELDRCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD8         DBASE            * DB ERROR 08 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM DRCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C*
     C                     MOVELDRPY      EFLD
     C                     MOVE DRPT      ETYP
     C                     EXSR EDFLD
     C                     MOVE EFLD      DRPYA
     C                     MOVELCDRO      EFLD
     C                     MOVE CDRT      ETYP
     C                     EXSR EDFLD
     C                     MOVE EFLD      CDROA
     C/COPY WNCPYSRC,FT0090C009
     C*
     C***********CDRO      IFNE *ZEROS                                                        CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C                     MOVE BCDP      CDP
     C                     MOVE BCCY      CCYOUT
     C                     END
     C*
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCSTA      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      CSTAA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDTRCM      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      TRCMA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCOLL      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      COLLA
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE *BLANKS   DIG1                            S01494
     C                     Z-ADDPDCHCM    DIG1N                           S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVE TEMP      CHCMA                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display V.A.T. charge                    S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE *BLANKS   DIG1                            S01499
     C                     Z-ADDPDVATT    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      VATTA                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     EXSR CPLEF
      *                                                                   CEU006
      * Set up Ntf delivery currency fields for Cheques to be paid        CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           NDCY      IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
      ** Call to currency codes access program                            CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM '*DBERR ' @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM NDCY      @CCY                            CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
      ** Execute Subroutine to move fields to old field names             CEU006
      *                                                                   CEU006
     C                     EXSR AOCURR                                    CEU006
      *                                                                   CEU006
     C                     MOVE *BLANK    DIG1                            CEU006
     C                     Z-ADDNDAM      DIG1N                           CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SNDAM                           CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
     C*
     C           ENDPDT    ENDSR
     C*
     C************************************************************
     C* END OF VALUES SUBROUTINE FOR CQPADDD
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C* SETUP DISPLAY FIELDS FOR 'CHEQUES FOR COLLECTION' HEADER
     C*
     C           VALCHD    BEGSR
     C*
     C* MOVE EDITED DATES TO UNEDITED FIELDS
     C                     Z-ADDSLDTD1    SLDTW1  60
     C                     MOVE SMCY      CCYOUT
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELSMCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD9         DBASE            * DB ERROR 09 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SMCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C                     MOVE CDP       CDPH
     C                     MOVELRCCO      EFLD
     C                     MOVE RCRT      ETYP
     C                     EXSR EDFLD                                                      AR1030313
     C**********           MOVE EFLD      RCCOA                                               B11356
     C                     MOVELEFLD      RCCOA                                               B11356
     C**********           MOVE EFLD      RCCOA                                            AR1030313
     C                     EXSR THRESH
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDTOCL      DIG1N
     C                     EXSR EDIT
     C                     MOVEADIG2      TOCLA
     C*
     C** IF SINGLE BRANCHED/COLL BANK IS FULL ACCNT REMOVE BRANCH         S01117
     C*                                                                   S01117
     C                     MOVELCOB1      SCOB1                           S01117
     C           *IN50     IFEQ '0'                                       S01117
     C           COBT      ANDEQ'G'                                       S01117
     C                     MOVE *BLANKS   COBB                            S01117
     C                     END                                            S01117
      *                                                                   CEU006
      * Set up Ntf delivery currency fields for Cheques to be collected   CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           NDCY      IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
      ** Call to currency codes access program                            CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM '*DBERR ' @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM NDCY      @CCY                            CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
      ** Execute Subroutine to move fields to old field names             CEU006
      *                                                                   CEU006
     C                     EXSR AOCURR                                    CEU006
      *                                                                   CEU006
     C                     MOVE *BLANK    DIG1                            CEU006
     C                     Z-ADDNDAM      DIG1N                           CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SNDAM                           CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
     C/COPY WNCPYSRC,FT0090C034
     C*                                                                   S01117
     C                     ENDSR
     C*
     C************************************************************
     C* END OF VALUES SUBROUTINE FOR CQCODDD
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C* SETUP DISPLAY FIELDS FOR 'CHEQUES FOR COLLECTION' DETAIL
     C*
     C           VALCDT    BEGSR
     C/COPY WNCPYSRC,FT0090C028
     C*
     C           CQKEY     CHAINCQCOCDDF             60    =PERMIT TO TRY
     C           *IN60     IFEQ '0'                                       048377
     C                     EXCPTRCQCOC                                    048377
     C                     END                                            048377
     C   60                GOTO ENDCDT                     TO AUTHORISE
     C           RECI      COMP 'D'                  8787  =IGNORE
     C   87                GOTO ENDCDT
     C/COPY WNCPYSRC,FT0090C007
     C                     MOVE CDPH      CDP
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCQAM      DIG1N
     C                     EXSR EDIT
     C                     MOVEADIG2      CQAMA
     C* MOVE EDITED DATES TO UNEDITED FIELDS
     C                     Z-ADDCRVDD1    CRVDW1  60
     C                     MOVE CRCY      CCYOUT
     C           CQSQ      ADD  1         SCRC
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELCRCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      KEY                             S01194
     C***********KEY*******CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD10        DBASE            * DB ERROR 10 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM CRCY      @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*
     C* FORMAT CREDIT CCY AMOUNT FOR DISPLAY                              035353
     C*                                                                   035353
     C           CCYAM     IFNE *ZEROS                                    035353
     C                     MOVE *BLANK    DIG1                            035353
     C                     Z-ADDCCYAM     DIG1N                           035353
     C                     EXSR EDIT                                      035353
     C                     MOVEADIG2      CCYAMA                          035353
     C                     ELSE                                           035353
     C                     MOVE *BLANKS   CCYAMA                          035353
     C                     END                                            035353
     C*                                                                   035353
     C*                                                                   S01194
     C*
     C                     MOVELCRPY      EFLD
     C                     MOVE CRPT      ETYP
     C                     EXSR EDFLD
     C                     MOVE EFLD      CRPYA
     C                     MOVELCDRO      EFLD
     C                     MOVE CDRT      ETYP
     C                     EXSR EDFLD
     C                     MOVE EFLD      CDROA
     C/COPY WNCPYSRC,FT0090C010
     C*
     C***********CDRO      IFNE *ZEROS                                                        CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C                     MOVE BCDP      CDP
     C                     MOVE BCCY      CCYOUT
     C                     END
     C*
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDTRCM      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      TRCMA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDTXCH      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      TXCHA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCSTA      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      CSTAA
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDCOLL      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      COLLA
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE *BLANKS   DIG1                            S01494
     C                     Z-ADDCCCHCM    DIG1N                           S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVE TEMP      CHCMA                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display  V.A.T. charge                   S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE *BLANKS   DIG1                            S01499
     C                     Z-ADDCCVATT    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      VATTA                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     EXSR CCLEF
      *                                                                   CEU006
      * Set up Pay delivery currency fields for Cheques to be collected   CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           PDCY      IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
      ** Call to currency codes access program                            CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM '*DBERR ' @RTCD                           CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM PDCY      @CCY                            CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
      ** Execute Subroutine to move fields to old field names             CEU006
      *                                                                   CEU006
     C                     EXSR AOCURR                                    CEU006
      *                                                                   CEU006
     C                     MOVE *BLANK    DIG1                            CEU006
     C                     Z-ADDPDAM      DIG1N                           CEU006
     C                     EXSR EDIT                                      CEU006
     C                     MOVEADIG2      SPDAM                           CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
     C*
     C           ENDCDT    ENDSR
     C*
     C************************************************************
     C* END OF VALUES SUBROUTINE FOR CQPADDD
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C*  REPORT THE ERROR FOUND
     C*
     C           ERFILE    BEGSR
     C*
     C                     SETON                     89
     C   88                DO
      *                                                                                      BUG8968
      ** Check if the error code already exists in the array.                                BUG8968
      ** If the code exists, adding the same code is not needed.                             BUG6968
      *                                                                                      BUG8968
     C           ' 005'    LOKUPERCD                     82                                  BUG8968
     C           *IN82     IFEQ *OFF                                                         BUG8968
     C*********************MOVE ' 295'    ERCD,Z           MUST EXIST     S01117
     C                     MOVE ' 005'    ERCD,Z           MUST EXIST     S01117
     C                     ADD  1         Z
     C                     ENDIF                                                             BUG8968
     C                     END
     C   87                DO
      *                                                                                      BUG8968
      ** Check if the error code already exists in the array.                                BUG8968
      ** If the code exists, adding the same code is not needed.                             BUG8968
      *                                                                                      BUG8968
     C           ' 006'    LOKUPERCD                     82                                  BUG8968
     C           *IN82     IFEQ *OFF                                                         BUG8968
     C*********************MOVE ' 296'    ERCD,Z           MUST BE LIVE   S01117
     C                     MOVE ' 006'    ERCD,Z           MUST BE LIVE   S01117
     C                     ADD  1         Z
     C                     ENDIF                                                             BUG8968
     C                     END
     C                     MOVE '1'       *IN20
     C*
     C                     ENDSR
     C*
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C* STORE LAST CHANGE DATE, TIME AND ORIGINAL ENTRY DATE
     C*
     C           MOVESR    BEGSR
     C*
     C                     MOVE OEDT      TOEDT   50
     C                     MOVE LCD       TLCD    50
     C                     MOVE LCHT      TLCHT   60
     C*
     C                     ENDSR
     C*
     C************************************************************
     C/EJECT
     C************************************************************
     C*
     C* CONVERT THRESHHOLD TO SAME NUMBER OF DECIMAL PLACES AS CCY
     C* SET *IN30-33 DEPENDING ON PAY NUMBER OF DECIMAL PLACES
     C*
     C           THRESH    BEGSR
     C*
     C                     MOVEA'0000'    *IN,30
     C           30        ADD  CDP       Q
     C                     MOVE '1'       *IN,Q
     C*********************Z-ADDTHRH      BTHRH  140                      S01117
     C                     Z-ADDBTAUDT    BTHRH  140                      S01117
     C           MDIN      IFEQ 0                          B002
     C                     MULT SPOT      BTHRH     H
     C                     ELSE                            X002
     C                     DIV  SPOT      BTHRH     H
     C                     END                             E002
     C   35                MULT 1000      BTHRH
     C   36                MULT 100       BTHRH
     C   37                MULT 10        BTHRH
     C   30                DIV  1000      BTHRH     H
     C   31                DIV  100       BTHRH     H
     C   32                DIV  10        BTHRH     H
     C*
     C                     ENDSR
     C*
     C************************************************************
     C/EJECT
     C************************************************************
     C* FILEUP SR.
     C* UPDATE FILE IF NOT BEEN CHANGED BY OTHER SCREEN
     C*
     C           FILEUP    BEGSR
     C*
     C                     SETON                     05
     C                     MOVE 00        CQSQ
     C/COPY WNCPYSRC,FT0090C003
     C   41      CQKEY     CHAINCQPACDDF             80
     C   43      CQKEY     CHAINCQCODDDF             80
     C**N80***** RECI      COMP 'D'                  8080                                  AR804457A
     C           *IN80     IFEQ '0'                                                        AR804457A
     C           RECI      IFEQ 'D'                                                        AR804457A
     C           RECI      OREQ 'M'                                                        AR804457A
     C           AUIN      ANDEQ'R'                                                        AR804457A
     C                     MOVE '0'       *IN80                                            AR804457A
     C                     ELSE                                                            AR804457A
     C                     MOVE '1'       *IN80                                            AR804457A
     C                     ENDIF                                                           AR804457A
     C                     ENDIF                                                           AR804457A
     C* IF RECORD HAS BEEN UPDATED BY ANOTHER SCREEN
     C           *IN80     IFEQ '1'                        B001
     C           LCD       ORNE TLCD
     C           LCHT      ORNE TLCHT
     C                     SETON                     89    INTERFERED
     C*********************MOVE ' 068'    ERCD,Z           WITH           S01117
     C                     MOVE ' 001'    ERCD,Z           WITH           S01117
     C                     ADD  1         Z
     C   41                EXCPTRCQPAC
     C   43                EXCPTRCQCOD
     C                     END                             E001
     C  N89                DO                              B001
     C           AUP1      IFEQ *BLANK                     B002
     C                     MOVE USRID     AUP1
     C                     ELSE                            X002
     C                     MOVE USRID     AUP2
     C                     END                             E002
     C* IF USER ONE AND NOT OVER THESHHOLD (FOR CQPACDD)
     C   41                DO                              B002
     C/COPY WNCPYSRC,FT0090C029
     C           PRRM      IFLT BTHRH                      B003
     C                     MOVE 'Y'       AUIN
     C                     MOVE 'Y'       @RETC                           S01117
     C                     ELSE                            X002
     C           AUP2      IFNE *BLANKS                    B004
     C                     MOVE 'Y'       AUIN
     C                     MOVE 'Y'       @RETC                           S01117
     C                     END                             E004
     C                     END                             E003
     C/COPY WNCPYSRC,FT0090C030
     C                     END                             E002
     C* IF USER ONE AND NOT OVER THESHHOLD (FOR CQCODDD)
     C   43                DO                              B002
     C/COPY WNCPYSRC,FT0090C031
     C           TOCL      IFLT BTHRH                      B003
     C/COPY WNCPYSRC,FTH00216
     C                     MOVE 'Y'       AUIN
     C                     MOVE 'Y'       @RETC                           S01117
     C                     ELSE                            X003
     C           AUP2      IFNE *BLANKS                    B004
     C                     MOVE 'Y'       AUIN
     C                     MOVE 'Y'       @RETC                           S01117
     C                     END                             E004
     C                     END                             E003
     C/COPY WNCPYSRC,FT0090C032
     C                     END                             E002
     C/COPY WNCPYSRC,FT0090C035
     C* CHANGE LAST CHANGE DATE AND TIME
     C                     Z-ADDRUND      LCD
     C                     TIME           LCHT
     C* UPDATE FILE
     C                     TIME           TIM              FOR COMIT
     C                     MOVE TIM       TRANS            FOR COMIT
      *
      * /COPY used to include an update procedure of the extension
      *       file after authorisation of the payement
      *
      /COPY QWINDSRC,FT0090VAL                                            S01241
     C   41                UPDATCQPACDDF
     C   43                UPDATCQCODDDF
      *                                                                                       CRE020
      ** If CRE020 is Installed, call Settlement Advice Subroutine                            CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C           *IN41     IFEQ '1'                                                           CRE020
     C                     MOVE PSVAL1    WSVAL 200                                           CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           *IN43     IFEQ '1'                                                           CRE020
     C                     MOVE PSVAL2    WSVAL                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Initialize and Load Data                                                             CRE020
      *                                                                                       CRE020
     C           WSVAL     IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     EXSR SRADVC                                                        CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           COMBOU    COMIT
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF FILE UPDATE SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C/COPY WNCPYSRC,FTH00217
     C*********************                                               S01199
     C**HELP*SR.***********                                               S01199
     C**CALLS*HELP**PROGRAM                                               S01199
     C*********************                                               S01199
     C***********HELP******BEGSR                                          S01199
     C*********************                                               S01199
     C*********************MOVEAERCD      HERCD 160                       S01199
     C*********************MOVEL'FT0000'  HBPGM   6                       S01199
     C*********************CALL 'MHELP'                                   S01199
     C*********************PARM           HBPGM                           S01199
     C*********************PARM           HERCD                           S01199
     C*********************SETOF                     01                   S01199
     C*********************                                               S01199
     C*********************ENDSR                                          S01199
     C*********************                                               S01199
     C************************************************************
     C* END OF HELP SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C* EDIT SR.
     C* EDIT VALUE FIELDS FOR LEADINGS ZEROS AND DECIMAL POINT
     C*
     C           EDIT      BEGSR
     C*
     C* FIND WHERE DECIMAL POINT SHOULD BE
     C           13        SUB  CDP       DP      30
     C                     Z-ADD14        X       30
     C                     Z-ADD13        Y       30
     C* IF NO DECIMAL PLACES RIGHT JUSTIFY FIELD
     C           CDP       IFEQ 0                          B001
     C                     Z-ADD0         Y
     C                     MOVEADIG1,1    DIG2,2
     C                     END                             E001
     C* LOOP TO MOVE DIGITS TO EDITED FIELD
     C           Y         DOWGT0                          B001
     C           Y         IFEQ DP                         B002
     C                     MOVE '.'       DIG2,X
     C                     SUB  1         X
     C                     END                             E002
     C                     MOVE DIG1,Y    DIG2,X
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     END                             E001
     C                     Z-ADD1         X
     C* LOOP TO SUPPRESS LEADING ZEROS
     C           X         DOUEQDP                         B001
     C           DIG2,X    IFEQ ' '                        B002
     C           DIG2,X    OREQ '0'
     C                     MOVE ' '       DIG2,X
     C                     ADD  1         X
     C                     ELSE                            X002
     C                     Z-ADDDP        X
     C                     END                             E002
     C                     END                             E001
     C                     MOVEADIG2      TEMP   14
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF EDIT SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************
     C* EDFLD SR.
     C* EDIT ACCOUNT FIELDS TAKING OUT SURPLUS ZEROS AFTER A
     C* NOSTRO OR A RETAIL NUMBER
     C*
     C           EDFLD     BEGSR
     C*
     C           ETYP      IFEQ 'N'                        B001
     C                     MOVE *BLANK    ENNO
     C                     ELSE                            X001
     C           ETYP      IFEQ 'R'                        B002
     C                     MOVE *BLANK    ENRT
     C                     ELSE                            X002
     C           ETYP      IFEQ ' '                        B003
     C                     MOVE *BLANK    EFLD
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF SUBROUTINE
     C************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   CPLEF  SR. TO DISPLAY ORIGINAL CURRENCIES AND VALUES FOR
     C**              CHEQUES TO BE PAID.
     C**
     C           CPLEF     BEGSR                           *** LEFVAL ***
     C**
     C***********CDRO      IFEQ 0                          ** B01                             CSD027
     C           CDRO      IFEQ *BLANKS                    ** B01                             CSD027
     C                     MOVE DRCY      BORDCY  3
     C                     ELSE                            ** X01
     C                     MOVE BCCY      BORDCY
     C                     END                             ** E01
     C*
     C** Get number of decimal places
     C**   and currency code for Charges entry.
     C                     EXSR GETGCY
     C*
     C** Edit charge entry currency amounts.
     C           CCYLEF    IFNE CCYOUT                     ** B01
     C*
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDECDP      CDP
     C                     Z-ADDTRCH      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      STRCM
     C*
     C                     MOVE *BLANKS   DIG1
     C                     Z-ADDCSTH      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      SCSTA
     C*
     C                     MOVE *BLANKS   DIG1
     C                     Z-ADDCOLH      DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      SCOLL
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE *BLANKS   DIG1                            S01494
     C                     Z-ADDPDCHCH    DIG1N                           S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVE TEMP      SCHCM                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display V.A.T. charge                    S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE *BLANKS   DIG1                            S01499
     C                     Z-ADDPDVATH    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      SVATT                           S01499
     C                     END                                            S01499
     C*
     C                     ELSE                            ** X01
     C*
     C                     MOVE TRCMA     STRCM
     C                     MOVE CSTAA     SCSTA
     C                     MOVE COLLA     SCOLL
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE CHCMA     SCHCM                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display V.A.T. charge                    S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE VATTA     SVATT                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                             ** E01
     C*
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**  S.R. GETCCY - get currency for charges entry .
     C**
     C           GETGCY    BEGSR
     C*
     C** Charge currency code = 'C' (Charge currency).
     C***********FTCC******IFEQ 'C'                                       S01194
     C           BTCHCY    IFEQ 'C'                                       S01194
     C                     MOVE BORDCY    CCYLEF
     C                     END
     C*
     C** Charge currency code = 'L' (Local currency)
     C***********FTCC******IFEQ 'L'                                       S01194
     C           BTCHCY    IFEQ 'L'                                       S01194
     C                     MOVE LOCY      CCYLEF
     C                     END
     C*
     C** Charge currency code = 'B' (Base currency)
     C***********FTCC******IFEQ 'B'                                       S01194
     C           BTCHCY    IFEQ 'B'                                       S01194
     C                     MOVE BCCY      CCYLEF
     C                     END
     C*
     C** Charge currency code = 'F' (Fixed currency)                                        AR726295
     C*                                                                                     AR726295
     C           BTCHCY    IFEQ 'F'                                                         AR726295
     C                     MOVE FCHCCY    CCYLEF                                            AR726295
     C                     ENDIF                                                            AR726295
     C*                                                                                     AR726295
     C** Get number of decimal places.
     C*********************MOVEL*BLANKS   ZTABKY 12                       S01194
     C*********************MOVEL'20'      ZTABKY                          S01194
     C           CCYLEF    IFNE BCCY
     C*********************MOVELCCYLEF    KEY4    4                       S01194
     C*********************MOVE '1'       KEY4                            S01194
     C*********************MOVE KEY4      ZTABKY                          S01194
     C***********ZTABKY****CHAINTABTG10F             80                   S01194
     C**N80******RECI******COMP 'D'                  8080                 S01194
     C***80****************DO                              B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0090'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************Z-ADD11        DBASE            * DB ERROR 11 *S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                                            S01194
     C*                                                                   S01194
     C** Call to access pgm for currency  details                         S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM CCYLEF    @CCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Execute Subroutine to move fields to old field names             S01194
     C*                                                                   S01194
     C                     EXSR AOCURR                                    S01194
     C*                                                                   S01194
     C                     Z-ADDCDP       ECDP    10
     C                     ELSE
     C                     Z-ADDBCDP      ECDP
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**   CCLEF  SR. TO DISPLAY ORIGINAL CURRENCIES AND VALUES FOR
     C**              CHEQUES TO BE COLLECTED.
     C**
     C           CCLEF     BEGSR
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT 0 FROM FILE,USE BASE CURRENCY
     C*
     C***********CDRO      IFEQ 0                          ** B01                             CSD027
     C           CDRO      IFEQ *BLANKS                    ** B01                             CSD027
     C                     MOVE CRCY      BORDCY
     C                     ELSE                            ** X01
     C                     MOVE BCCY      BORDCY
     C                     END                             ** E01
     C*
     C** Get number of decimal places
     C**   and currency code for Charges entry.
     C                     EXSR GETGCY
     C*
     C** Edit charge entry currency amounts.
     C           CCYLEF    IFNE CCYOUT                     ** B01
     C*
     C                     MOVE *BLANK    DIG1
     C                     Z-ADDECDP      CDP
     C                     Z-ADDDUMA1     DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      STRCM
     C*
     C                     MOVE *BLANKS   DIG1
     C                     Z-ADDDUMA2     DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      STXCH
     C*
     C                     MOVE *BLANKS   DIG1
     C                     Z-ADDDUMA3     DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      SCSTA
     C*
     C                     MOVE *BLANKS   DIG1
     C                     Z-ADDDUMA4     DIG1N
     C                     EXSR EDIT
     C                     MOVE TEMP      SCOLL
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE *BLANKS   DIG1                            S01494
     C                     Z-ADDCCDUM5    DIG1N                           S01494
     C                     EXSR EDIT                                      S01494
     C                     MOVE TEMP      SCHCM                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display V.A.T. charge                    S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE *BLANKS   DIG1                            S01499
     C                     Z-ADDCCDUM6    DIG1N                           S01499
     C                     EXSR EDIT                                      S01499
     C                     MOVE TEMP      SVATT                           S01499
     C                     END                                            S01499
     C*
     C                     ELSE                            ** X01
     C*
     C                     MOVE TRCMA     STRCM
     C                     MOVE TXCHA     STXCH
     C                     MOVE CSTAA     SCSTA
     C                     MOVE COLLA     SCOLL
     C*                                                                   S01494
     C** If S01494 is installed, display FX/change commission field       S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     MOVE CHCMA     SCHCM                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is installed, display V.A.T. charge                    S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVE VATTA     SVATT                           S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                             ** E01
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C********************************************************************S01194
     C* AOBANK SR.                                                        S01194
     C* MOVES COMMONLY USED FIELDS TO OLD FIELD NAMES                     S01194
     C*                                                                   S01194
     C           AOBANK    BEGSR                                          S01194
     C                     MOVE BJLCCY    LOCY    3                       S01194
     C                     MOVE BJCYCD    BCCY    3                       S01194
     C                     Z-ADDBJRDNB    RUND    50                      S01194
     C                     MOVE BJMRDT    SRUNA   7                       S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C* END OF AOBANK SUBROUTINE                                          S01194
     C********************************************************************S01194
     C/EJECT                                                              S01194
     C********************************************************************S01194
     C* AOCURR SR.                                                        S01194
     C* MOVES COMMONLY USED FIELDS TO OLD FIELD NAMES                     S01194
     C*                                                                   S01194
     C           AOCURR    BEGSR                                          S01194
     C                     MOVE A6NBDP    CDP     10                      S01194
     C                     MOVE A6SPRT    SPOT   138                      S01194
     C*                                                                   S01194
     C** Due to change in files ; a6mdin now can be M (multiply) or D     S01194
     C** (divide) previously mdin was 1 (multiply) or 0 (divide) .        S01194
     C           A6MDIN    IFEQ 'M'                                       S01194
     C                     Z-ADD1         MDIN                            S01194
     C                     ELSE                                           S01194
     C                     Z-ADD0         MDIN                            S01194
     C                     END                                            S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C* END OF AOCURR SUBROUTINE                                          S01194
     C********************************************************************S01194
     C/EJECT                                                              S01194
     C********************************************************************S01194
     C* BBAUTH SR.                                                        S01194
     C* CALL TO ZVACTBU(USER/BRANCH/ACTIONCODE VALIDATION)                S01194
     C*                                                                   S01194
     C           BBAUTH    BEGSR                                          S01194
     C                     CALL 'ZVACTBU'                                 S01194
     C                     PARM 'X'       ZACTN   1                       S01194
     C                     PARM BRCA      ZBRCA   3                       S01194
     C                     PARM 0         ZRETC   10                      S01194
     C*                                                                   S01194
     C           ZRETC     IFEQ 1                                         S01194
     C                     SETON                     2089                 S01194
     C                     MOVE ' 303'    ERCD,Z                          S01194
     C                     ADD  1         Z                               S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C* END OF SUBROUTINE BBAUTH                                          S01194
     C********************************************************************S01194
     C/EJECT                                                              S01194
     C********************************************************************S01194
     C* OBAUTH SR.                                                        S01194
     C* CALL TO ZVOBU(USER/ORIGINATING BRANCH VALIDATION)                 S01194
     C*                                                                   S01194
     C           OBAUTH    BEGSR                                          S01194
     C                     CALL 'ZVOBU'                                   S01194
     C                     PARM ORBR      ZORBR   3                       S01194
     C                     PARM 0         ZRETC2  10                      S01194
     C*                                                                   S01194
     C           ZRETC2    IFEQ 1                                         S01194
     C                     SETON                     2089                 S01194
     C                     MOVE ' 305'    ERCD,Z                          S01194
     C                     ADD  1         Z                               S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           ZRETC2    IFEQ 2                                         S01194
     C                     SETON                     2089                 S01194
     C                     MOVE ' 306'    ERCD,Z                          S01194
     C                     ADD  1         Z                               S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C* END OF SUBROUTINE OBAUTH                                          S01194
     C********************************************************************S01194
     C/EJECT                                                              S01194
     C********************************************************************S01194
     C           FLDQRY    BEGSR                                          S01194
      *----------------------------------------------------------------   S01194
      * Subroutine to resolve entry of ? for standing data fields.        S01194
      * Performed after function key validation and prior to field        S01194
      * validation                                                        S01194
      *                                                                   S01194
      * Indicators used:                                                  S01194
      *  52       on then redisplay screen                                S01194
      *  53       used in LOKUP, on if ? found                            S01194
      *----------------------------------------------------------------   S01194
     C                     SETOF                     5253                 S01194
      *                                                                   S01194
      * check currency for entry of ? (TCCY)                              S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEATCCY      FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     53               S01194
      *                                                                   S01194
      * if ? found seton redisplay ind and call access program            S01194
     C           *IN53     IFEQ '1'                                       S01194
     C                     SETON                     52                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM '?'       @CYCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
      * if selection made move value to screen field                      S01194
     C           @RTCD     COMP *BLANKS                  75               S01194
     C           *IN75     IFEQ '1'                                       S01194
     C                     MOVE A6CYCD    TCCY                            S01194
     C                     ELSE                                           S01194
     C                     MOVE *BLANKS   TCCY                            S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     SETOF                     53                   S01194
     C                     END                                            S01194
      *                                                                   S01194
      * check currency for entry of ? (FCCY)                              S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEAFCCY      FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     53               S01194
      *                                                                   S01194
      * if ? found seton redisplay ind and call access program            S01194
     C           *IN53     IFEQ '1'                                       S01194
     C                     SETON                     52                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM '?'       @CYCD   3                       S01194
     C***********SDCURR    PARM SDCURR    DSFDY                           S01194              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                                               CSD006
      *                                                                   S01194
      * if selection made move value to screen field                      S01194
     C           @RTCD     COMP *BLANKS                  75               S01194
     C           *IN75     IFEQ '1'                                       S01194
     C                     MOVE A6CYCD    FCCY                            S01194
     C                     ELSE                                           S01194
     C                     MOVE *BLANKS   FCCY                            S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     SETOF                     53                   S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     ENDSR                                          S01194
     C********************************************************************S01194
     C* END OF SUBROUTINE FLDQRY                                          S01194
     C********************************************************************S01194
     C/EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRADVC - Update Retail Advice Index File                     *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
      *                                                                                       CRE020
     C           SRADVC    BEGSR                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   RREFNO                                              CRE020
     C                     MOVELPREF      RREFNO                                              CRE020
     C                     MOVE '000'     RSEQNO                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVE PYTP      RTRTYP                                              CRE020
     C                     MOVE 'I'       RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
      *                                                                                       CRE020
     C                     OPEN READVCL1                                                      CRE020
     C           *HIVAL    SETLLREADVCD0                                                      CRE020
     C                     WRITEREADVCD0                                                      CRE020
      *                                                                                       CRE020
     C           *IN41     IFEQ '1'                                                           CRE020
      *                                                                                       CRE020
     C           PREF      SETLLCQPADDDF                                                      CRE020
     C           PREF      READECQPADDDF                 81                                   CRE020
      *                                                                                       CRE020
     C           *IN81     DOWEQ'0'                                                           CRE020
      *                                                                                       CRE020
     C           RECI      IFEQ 'D'                                                           CRE020
     C                     MOVE CQSQ      RSEQNO                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           PREF      READECQPADDDF                 81                                   CRE020
     C                     ENDDO                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           *IN43     IFEQ '1'                                                           CRE020
      *                                                                                       CRE020
     C           PREF      SETLLCQCOCDDF                                                      CRE020
     C           PREF      READECQCOCDDF                 81                                   CRE020
      *                                                                                       CRE020
     C           *IN81     DOWEQ'0'                                                           CRE020
      *                                                                                       CRE020
     C           RECI      IFEQ 'D'                                                           CRE020
     C                     MOVE CQSQ      RSEQNO                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           PREF      READECQCOCDDF                 81                                   CRE020
     C                     ENDDO                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     CLOSEREADVCL1                                                      CRE020
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
     O/EJECT
     O************************************************************
     O* EXCEPT FORMATS TO RELEASE RECORDS
     O*
     OCQPACDDFE                RCQPAC
     O*
     OCQPADDDFE                RCQPAD
     O*
     OCQCODDDFE                RCQCOD
     O*
     OCQCOCDDFE                RCQCOC
     O*
     O/COPY WNCPYSRC,FT0090O001
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
