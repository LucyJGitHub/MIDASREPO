     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT FT0100   ansfers maintenance')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0100 - Nostro Transfer Maintenance                         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. AR949206           Date 10Jun13               *
      *  Prev Amend No. CLE134             Date 01Aug12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15201           Date 30Oct07               *
      *                 CFT032             Date 11Sep06               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 217782             Date 11Oct06               *
      *                 210617             Date 11Oct06               *
      *                 242153             Date 12Sep06               *
      *                 CFT032             Date 11Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 B11333             Date 12May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179732             Date 31May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 156695             Date 18MAR99               *
     F*                 120827             Date 06Jul97               *
     F*                 096486             Date 03Apr97               *
     F*                 S01408             Date 30Apr96               *
     F*                 093958             DATE 17JAN96               *
     F*                 092396             DATE 24AUG95               *
     F*                 087196             DATE 16JUN95               *
     F*                 083319             DATE 09MAR95               *
     F*                 074810             DATE 01AUG94               *
     F*                 S01494             DATE 25MAY94               *
     F*                 068347             DATE 18MAR94               *
     F*                 058581             DATE 27JUL93               *
     F*                 056031             DATE 28MAY93               *
     F*                 S01412             DATE 04MAY93               *
     F*                 054663             DATE 29APR93               *
     F*                 047179             DATE 29APR93               *
     F*                 042167             DATE 15APR93               *
     F*                 S01414             DATE 29MAR93               *
     F*                 E32481             DATE 17JUN91               *
     F*                 E30052             DATE 07AUG91               *
     F*                 E29970             DATE 07AUG91               *
     F*                 E32830             DATE 12JUN91               *
     F*                 E32880             DATE 04JUN91               *
     F*                 E29920             DATE 03MAY91               *
     F*                 E29919             DATE 02MAY91               *
     F*                 E29907             DATE 18APR91               *
     F*                 E32536             DATE 21JAN91               *
     F*                 E23411             DATE 06SEP90               *
     F*                 S01195             DATE 21/08/90              *
     F*                 S01194             DATE 21/08/90              *
     F*                 S01117             DATE 21/08/90              *
     F*                 S01199             DATE 16/08/89              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  AR949206 - Validate the From and To Nostro accounts          *
      *             using the Retail Indicator. (Child: AR949207)     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  BUG15201 - Encounter Database Errors (Recompile)             *
      *  CFT032 - Account line in field 50k in MT103 (recompile)      *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  217782 - No warning message if the 'From Nostro' is a        *
      *           holiday in the transaction currency. Pattern the    *
      *           fix after 210617.                                   *
      *  210617 - Display warning if Beneficiary (= "To Nostro") is   *
      *           holiday in the transaction ccy.                     *
      *  242153 - CGL029 ignored the Nostro sub-field, so it is       *
      *           always passed to AOSPOSU0 as 00.                    *
      *  CFT032 - Account line in field 50k in MT103 (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  B11333 - Recompiled due to changes to display file.          *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT. Recompile only.         *
     F* 179732  - Fix to assign the profit centre from the PCDM only  *
     F*           if a valid Nostro is entered and the account        *
     F*           entered does not have a profit centre nominated.    *
     F* 156695  - Apply standard process to determine/set the century *
     F*           indicator.                                          *
     F*  120827 - Profit Centre Accounting defaulting                 *
     F* 096486  - Previous fix 065890.                                *
     F*           To enable user to enquire on FT payments for FT     *
     F*           postings.                                           *
     F* S01408  - Addition of core hook FT0100IIP1                    *
     F*           Addition of core hook FT0100CCP1                    *
     F* 093958  - Payment input does not check against the payment    *
     F*           type sub-type combination table                     *
     F* 092396  -  Sender to Receiver cannot contain '//' followed    *
     F*            by blanks.                                         *
     F* 087196  -  INBT not reset to *blanks causing DB error/FT0655  *
     F* 083319  -  Recompile for change to display file.              *
     F* 074810  -  After chaining to MUSERDD, check if RECI = 'D'     *
     F* S01494  -  BLI Funds Transfer Enhancements                    *
     F* 068347  -  Suppress Account movement duplicates.              *
     F* 058581  -  Unable to amend or delete unauthorised nostro      *
     F*            transfer record which was entered prior to today.  *
     F* 056031  -  Change processing for Shadow Post Update. Call new *
     F*            program AOSPOSU0. This now orders the updates in   *
     F*            similar way to FX and MM.                          *
     F*            Include primary transaction reference              *
     F*            Call FT0005 to get FT Control Data                 *
     F*            Fix covers errors 041693,045014,031876             *
     F*  S01412  -  Validation of special instructions field          *
     F*             (SR SEPTVM)                                       *
     F*  054663   - File fields not being cleared prior to a write    *
     F*  047179   - Allows input of a closed account in the charge    *
     F*             account field when the value date is greater than *
     F*             the current processing date.                      *
     F*  042167  -  Include CL program to check for record locking    *
     F*  S01414  -  Book Code and Profit Centre Incorporation.        *
     F*  E32481  -  REMOVAL OF REDUNDANT FLAGS                        *
     F*  E30052  -  REDUNDANT CODE, FIELDS DO NOT EXIST!              *
     F*  E29970  -  COMMAND SEVEN PROCESSING FOR NEXT PAYMENT         *
     F*             WHEN CALLED FROM SUBFILE ENQUIRY PROGRAM          *
     F*  E32830 -  Same indicator (39) used for settlement type and   *
     F*            status indicator. Change status to 62.             *
     F*  E32880 -  OUTPUT FULL REF TO RSACMTPD                        *
     F*  E29920  -  INCORRECT SET UP OF DBPGM DBASE ERROR FIELD       *
     F*  E29919  -  INTERMEDIARY BANK ERROR IND NOT BEING RESET       *
     F*             WHEN CMD12 TAKEN                                  *
     F*  E29907  -  ERROR PROCESSING AMENDED TOO CONSTRICTING WILL    *
     F*             NOT ALLOW MORE THAN ONE ERROR TO BE DISPLAYED     *
     F*  E32536  -  IF UNALLOCATED NOSTRO NO 00 USED FOR PRONO UPDATE *
     F*             REINSTATE REAL NOSTRO NO FOR AMOVTS SR TO STOP    *
     F*             DB ERROR IN NOSTRO FILE                           *
     F*  E23411  -  MMOD IS CHECKED IN POSITION TO SEE IF RETAIL 1    *
     F*             IS SWITCHED ON.  THIS IS NOW OBSOLETE AND MMOD    *
     F*             SHOULD BE CHECKED IN POSITIONS IN 16 AND 23 FOR   *
     F*             RETAIL 2 AND INTEREST ON ACCOUNTS.                *
     F*  S01195  -  HOLIDAYS PROCESSING                               *
     F*  S01194  -  NEW STANDING DATA CHANGES                         *
     F*  S01117  -  MULTIBRANCHING                                    *
     F*  S01199  - HELP SYSTEM.                                       *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*    07         F21 IS PRESSED FROM THE ENQUIRY SCREEN              S01494
     F*    08         USER NOT FOUND                                      S01494
     F*    10         ENABLE COMMAND SEVEN KEY                            E29970
     F*    13         USED IN LOKUP, IF ? FOUND IN TRANSFER SUB-TYPE      S01194
     F*    14         USED IN LOKUP, IF ? FOUND IN CURRENCY FIELD         S01194
     F*    15         REDISPLAY SCREEN AFTER ? FOUND                      S01194
     F*    16         USED IN LOKUP,IF ? FOUND IN SBRCA OR SORBR          S01194
     F*    17         INVALID ORIGINATING BRANCH                          S01117
     F*    18         ORIGINATING USED FLAG ON                            S01117
     F*    19         INVALID BOOKING BRANCH                              S01117
     F*    43         MULTIBRANCHING                                      S01117
     F*    20         ENQUIRY
     F*    21         DELETION
     F*    22         INSERTION
     F*    23         AMENDMENT
     F*****25*********HELP                                                S01494
     F*    25         Used by Message Subfile                             S01494
     F*    26         INITIAL SCREEN ONLY
     F*    27         DETAIL SCREEN
     F*    28         ERROR CODE LINE 1
     F*    29         ERROR CODE LINE 2
     F*    30         PREVIOUS INSERT TRANSFER REFERENCE
     F*               DISPLAY SCREEN ERROR INDICATORS:
     F*****10***************-*SETTLE*IBLC*CODE*********                   E30052
     F*****11***************-*PAY*IBLC*CODE************                   E30052
     F*****12***************-*IBLC*COUNTRY*CODE********                   E30052
     F*****13***************-*MARKET*INDICATOR*********                   E30052
     F*    31               - ACTION CODE
     F*    32               - TRANSFER REFERENCE
     F*    33               - DESTINATION
     F*    34               - AMOUNT
     F*    35               - CURRENCY
     F*    36               - VALUE DATE
     F*    37               - A/C WITH BANK NOSTRO
     F*    38               - SWIFT PRIORITY CODE
     F*    40               - TRANSFER TYPE
     F*    41               - TRANSFER SUB-TYPE
     F*****42***************-*INTERMEDIARY*BANK*(CHAIN*TO*CLINTCB*via     S01494
     F*********************************************CLINT/SNAME/MSADR)     S01494
     F*    45               - INVALID INTERMEDIARY BANK LINE 1            S01494
     F*    46               - INVALID INTERMEDIARY BANK LINE 2            S01494
     F*    47               - INVALID INTERMEDIARY BANK LINE 3            S01494
     F*    48               - INVALID INTERMEDIARY BANK LINE 4            S01494
     F*    49               - INVALID INTERMEDIARY BANK LINE 5            S01494
     F*               DISPLAY SCREEN GENERAL INDICATORS:
     F*****39***************- STATUS FIELD NON BLANK                      E32830
     F*    39               - SETTLEMENT TYPE INVALID                     E32830
     F*    62               - STATUS FIELD NON BLANK                      E32830
     F*               WORK INDICATORS CORRESPONDING TO ERROR CODES:
     F*    43               - MULTIBRANCHING INDICATOR.                   S01117
     F*    44 - 60          - ERROR CODES 144 - 160
     F*    65               - DEALING MODULE PRESENT
     F*    66               - RETAIL MODULE PRESENT
     F*               GENERAL WORK INDICATORS:
     F*****68***************- CHAIN FAIL TO TABLETJF RECORD               S01195
     F*****69***************- CHAIN FAIL TO TABLET5F RECORD               S01194
     F*    69               - 'CHAIN' FAIL TO SDDLSTPD RECORD             S01194
     F*****70***************- CHAIN FAIL TO TABLETLF RECORD               S01194
     F*    70               - 'CHAIN' FAIL TO SDNOSTPD RECORD             S01194
     F*    71               - CHAIN FAIL TO NTRANDDF RECORD
     F*****72***************- CHAIN FAIL TO PRONOPNF RECORD               056031
     F*****73***************- CHAIN FAIL TO TABTG10F RECORD               S01194
     F*    74               - CHAIN FAIL TO ACCNTABF RECORD
     F*****75***************- CHAIN FAIL TO MEMOSMDF RECORD               056031
     F*    76               - CHAIN FAIL TO NTRANZZ FILE
     F*    77               - INDICATOR USED TO VALIDATE SPECIAL          S01412
     F*                       INSTRUCTION FLD                             S01412
     F*****78***************- UPDATE TO PRONOPNF FAILED                   056031
     F*****79***************- UPDATE TO MEMOSMDF FAILED                   056031
     F*    80               - UPDATE/WRITE TO NTRANDDF FAILED
     F*    81               - UPDATE TO NTRANZZF FAILED
     F*    82               - Book Code field     - error/reverse image   S01414
     F*    84               - Profit Centre field - non display/protect   S01414
     F*    85               -   "       "     "   - allow input           S01414
     F*    86               -   "       "     "   - error/reverse image   S01414
     F*    87               - PUTOVR and OVERLAY on Message Subfile       S01494
     F********87************- WORK                                        S01494
     F*       88            - WORK
     F*                     - ALSO USED FOR SPECIAL INSTRUCTIONS FIELD    S01412
     F*                       VALIDATION (SR SEPTVM)                      S01412
     F*       89            - UIFRMT SR. INDICATOR
     F*                     - ALSO USED FOR SPECIAL INSTRUCTIONS FIELD    S01412
     F*                       VALIDATION (SR SEPTVM)                      S01412
     F*    90-97      USED BY STANDARD SUBROUTINE ZALIGN
     F*       98      DATE FORMAT MMDDYY IF ON.
     F*       99      INSTALLATION CONTROL DATA RECORD 1 NOT FOUND
     F*       KL      F12, INITIAL SCREEN REQUEST
     F*       KC      F3, END OF PROGRAM REQUEST
     F*     U7 & U8   DATABASE ERROR, REQUIRED RECORDS NOT FOUND
     F********************************************************************
     F/EJECT
     F********************************************************************
     FFT0100DFCF  E                    WORKSTN
     FNTRAN   UF  E           K        DISK                      A
     F                                              KCOMIT
     FNTRANZZ UF  E                    DISK
     F                                              KCOMIT
     FFDDTSTL1IF  E           K        DISK                               093958
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*PRONO***UF**E           K        DISK                              056031
     F************                                  KCOMIT                056031
     F************PRONOHHF                          KIGNORE               056031
     F*MEMOS***UF**E                    DISK                              056031
     F************                                  KCOMIT                056031
     F*TABFP***IF**E***********K        DISK                              S01194
     F************TABTB20F                          KIGNORE               S01194
     F************TABTG20F                          KIGNORE               S01194
     F************TABLETPF                          KIGNORE               S01194
     F************TABTE10F                          KIGNORE               S01194
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FMUSER   IF  E           K        DISK                               S01494
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*RSACMTPDO***E                    DISK         KCOMIT               056031
     F*
     F*SNAME***IF**E           K        DISK                              S01194
     F************CLINTCBF                          KRENAMESNAMECBF       S01194
     F*MSADR***IF**E           K        DISK                              S01194
     F************CLINTCBF                          KRENAMEMSADRCBF       S01194
     F*CLINT***IF**E           K        DISK                              S01194
     F************CLINTCAF                          KIGNORE               S01194
     F************CLINTCCF                          KIGNORE               S01194
     F************CLINTC1F                          KIGNORE               S01194
     F************CLINTSEF                          KIGNORE               S01194
     F***SDCUSTL7IF**E           K        DISK                     S01194 S01494
     F*
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      ** Compliance Watch Hit List by function                                                CSD015
      *                                                                                       CSD015
     F/COPY FTCPYSRC,SFTSWFTF                                             S01494
     F*                                                                   S01494
     E                    CPY@    1   1 80               Copyright Array
     E                    ERCD       19  4               ERROR CODES
     E                    YA1        15  1               UIFRMT SR.ARRAY
     E                    YA2        16  1               UIFRMT SR.ARRAY
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     E************        PNBA        5 15 0             PRONO BAL.ARRAY  056031
     E************        PNO         5 15 0A            PRONO BALS(OLD)  056031
     E************        PNDA        5  5 0A            PRONO DAT.ARRAY  056031
     E                    ZA1        16  1               ZALIGN SR. ARRAY
     E                    ZA2        16  1               ZALIGN SR. ARRAY
     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    POWER   1   7  7 3             POWERS TABLE
     E                    HCC        25  3               HOLIDAY ARRAY
     E                    FLDQ       12  1               Question Mark    S01194
     E                    UPA    27  27  1                                S01412
      ** Valid Upper Case Characters.                                     S01412
      *                                                                   S01412
     E                    APN    37  37  1                                                    CSW201
      ** Valid Upper Case Characters and Numeric Digits                                       CSW201
      *                                                                                       CSW201
     E                    SWCH   47  47  1                                S01412
      ** Valid ISO Characters.                                            S01412
      *                                                                   S01412
      *                                                                   056031
      *  Error texts                                                      056031
      *                                                                   056031
     E                    ERR@    1   1 80                                056031
      *                                                                                       CSD015
     E                    OPTAG   1   3 25                                                    CSD015
     E                    CLTAG   1   3 25                                                    CSD015
      *                                                                                       210617
      ** Warning text                                                                         210617
      *                                                                                       210617
     E                    WTXT    1   1 80                                                    210617
      *                                                                   S01494
      ** Function Keys                                                    S01494
      *                                                                   S01494
     E                    FKEY        6 78                                S01494
      *                                                                   056031
     E                    @STK       20 10                                056031
     E*                                                                   S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      *                                                                   S01412
     E                    SIL         6 35                                S01412
      ** Array of incoming data                                           S01412
      *                                                                   S01412
     E                    CUL         6  1                                S01412
      ** Error line array                                                 S01412
      *                                                                   S01412
     E                    FIELD      35  1                                S01412
      ** Test of Array                                                    S01412
      *                                                                   S01412
     E                    WRN@       40  1                                S01494
     E** Warning array                                                    S01494
     E*                                                                   S01494
     E/COPY FTCPYSRC,SFTSWFTE                                             S01494
     E*                                                                   S01494
     E********************************************************************
     E/EJECT
     I********************************************************************S01117
     I*                                                                   S01414
     I* Rename of ACCNT Profit Centre to avoid overwriting                S01414
     I*                                                                   S01414
     IACCNTABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I              RETB                            ACRETB                                  AR949206
     I*                                                                   S01494
     I** RENAME FIELDS TO PREVENT OVERLAPPING                             S01494
     I*                                                                   S01494
     IMUSERDDF                                                            S01494
     I              RECI                            MRECI                 S01494
     I              DPPT                            MDPPT                 S01494
     I              DBRN                            MDBRN                 S01494
     I              LCD                             MLCD                  S01494
     I              CHTP                            MCHTP                 S01494
     I*                                                                   S01414
     I*                                                                   S01117
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I********************************************************************
     I*
     I** DATA STRUCTURE FOR MEMOS FILE
     I*
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     I*DMEMOS****E*DSMEMOS                                                056031
     I************                            2  160LBAL                  056031
     I************                           17  310CBAL                  056031
     I************                        P  37  390MTNLU                 056031
     I************                                                        056031
     I***DATA*STRUCTURES FOR PRONO FILE  BALANCE AND DATE FIELDS          056031
     I************                                                        056031
     I*DPRONB******DS                                                     056031
     I************                            1  40 PNB                   056031
     I************                        P   1  400PNBA                  056031
     I************                                                        056031
     I*DPROND******DS                                                     056031
     I************                            1  15 PND                   056031
     I************                        P   1  150PNDA                  056031
     I*
     I** PROGRAM STATUS DATA STRUCTURE - RETREIVE USER ID
     I*
     IPSDS       SDS
     I                                        1  10 ##PGM                 S01494
     I                                      244 253 WSID
     I                                      254 263 USRID
     I*                                                                ***S01117
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
      *   User / Branch data area                                         S01117
     I                                       11  13 DBRN                  S01117
     I                                       14  16 DPPT                  S01414
     I*
     I** Data area LDA - Used in the event of database errors
     I*
     IDLDA        DS                            256
      *   Local data area
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I********************************************************************S01194
     I*
     I**   DS FOR DBERR ON ACCNT
     I*
     I*ACKYDS      DS                             15                      S01117
     I***ACKYDS*     DS                             18                                 S01117 CGL029
     IACKYDS      DS                                                                          CGL029
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 MCCY
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I                                       22  24 BRCA                                      CGL029
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I**********                             16  18 BRCA                               S01117 CGL029
     I*
     I** DATA AREA NTRANDA - ASSIGNS NEXT REFERENCE SEQUENCE
     I*
     INTFRFD      DS                              4
     I                                        1   40NTFRF
     I*
     I** DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
     I*
     ICMTTXT      DS                            245
     I                                        1   50TIMEX
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240TIME
     I                                       25  25 ACTCDX
     I                                       26  35 USRIDX
     I                                       51  51 SACTCD
     I                                       52  66 STFRF
     I                                       67  68 SDEST
     I                                       69  82 SAMNT
     I                                       83  85 SCCY
     I                                       86  91 SVDAT
     I                                       92  93 SACBN
     I                                       94 128 SBBI1
     I                                      129 163 SBBI2
     I                                      164 198 SBBI3
     I                                      199 233 SBBI4
     I                                       94 233 SBBI                  S01412
     I**************************************234 235 SSWPC                 S01117
     I                                      234 234 SSWPC                 S01117
     I                                       52 234 SDTA1                                     210617
     ISDTA2       DS                            184                                           210617
     I                                        1 175 SINB                                      210617
     I                                        1  35 SINB1                                     210617
     I                                       36  70 SINB2                                     210617
     I                                       71 105 SINB3                                     210617
     I                                      106 140 SINB4                                     210617
     I                                      141 175 SINB5                                     210617
     I                                      176 177 SBOKC                                     210617
     I                                      178 179 SSTMT                                     210617
     I                                      180 182 SBRCA                                     210617
     I                                      183 184 SPYST                                     210617
     I**
     I*
     I**     MIDAS MODULE DATA AREA
     I*
     IDMMOD       DS                            256
     I                                        2   2 WDL
     I****************************************3   3 WRT                   E23411
     I                                       16  16 WRT2                  E23411
     I                                       23  23 WIOA                  E23411
     I** DS to test contents of array                                     S01412
     ICULTST      DS                                                      S01412
     I                                        1   6 CUL                   S01412
     I*                                                                   S01412
      *                                                                   056031
      *  Send message data structure                                      056031
      *                                                                   056031
     IDBDTA       DS                                                      056031
     I                                        1  10 @BPGM                 056031
     I                                       11  20 @BFILE                056031
     I                                       21  50 @BKEY                 056031
     I                                       51  550@BERNB                056031
     I                                       56 135 @BNARR                056031
     I                                      136 145 @BSTK                 056031
     I                                      146 175 @BPREF                056031
      *                                                                   056031
      *  Calling parameter data structure for AOSPOSU0                    056031
      *                                                                   056031
     IC#DTA       DS                            256                       056031
     I                                        1   1 C#ATYP                056031
     I**********                              2  19 C#ACCT                             056031 CGL029
     I                                        2  19 QQACCT                                    CGL029
     I**********                              2   70C#CNU1                             056031 CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1                056031
     I**********                             11  140C#ACO1                             056031 CGL029
     I                                       11  140QQACO1                                    CGL029
     I                                       15  160C#ACS1                056031
     I                                       17  19 C#BRC1                056031
     I                                        2   30C#NOSN                056031
     I                                        2   6 C#NOS                 056031
     I                                        2  110C#ACNO                056031
     I**********                              2   70C#CNUM                             056031 CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                             056031 CGL029
     I                                        8  110QQACOD                                    CGL029
     I                                       12  130C#ACSQ                056031
     I                                       14  16 C#BRCA                056031
     I                                       24  24 C#IO                  056031
     I                                       25  27 C#CCY                 056031
     I                                       28  29 C#TRYP                056031
     I                                       30  59 C#NARR                056031
     I                                       60  670C#CHQN                056031
     I                                       68  82 C#PREF                056031
     I                                       83  88 C#TRN                 056031
     I                                    P  89  960C#AMT                 056031
     I                                       97  97 C#PRON                056031
     I                                       98  98 C#OLPS                056031
     I                                       99  99 C#MEMS                056031
     I                                      100 100 C#RSAC                056031
     I                                      101 102 C#MOD                 056031
     I                                      103 104 C#OLRC                056031
     I                                      105 105 C#FTOV                056031
     I                                    P 106 1080C#VDAT                056031
     I                                    P 109 1110C#PSTD                056031
     I                                      112 112 C#PSTO                056031
     I                                      113 113 C#RPST                068347
     I                                      114 1160C#RPNB                068347
     I                                      117 117 C#RTYP                068347
     I                                      121 1300C#ACO1                                    CGL029
     I                                      131 1400C#ACOD                                    CGL029
     I                                      141 160 C#OTR1                                    CAP204
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
      *                                                                                       CGL029
     I            DS                                                                          CGL029
     I                                        1  24 C#ACCT                                    CGL029
     I**********                              1   60W#CNU1                             CGL029 CSD027
     I                                        1   6 W#CNU1                                    CSD027
     I                                        1   20W#NOSN                                    242153
     I                                        1   5 W#NOS                                     242153
     I                                        1  100W#ACNO                                    242153
     I                                        7   9 W#CCY1                                    CGL029
     I                                       10  190W#ACO1                                    CGL029
     I                                       20  210W#ACS1                                    CGL029
     I                                       22  24 W#BRC1                                    CGL029
     I/COPY WNCPYSRC,FT0100I001
      *                                                                   056031
      *  Input parameters data structure from FT0005                      056031
      *                                                                   056031
     IC#CNTL      DS                            256                       056031
     I                                        1   1 C#PDTI                056031
     I                                        2   3 C#CCYI                056031
     I                                        4   4 C#GLUI                056031
     I                                        5   5 C#TPCI                056031
      *                                                                   056031
     I*                                                                   S01194
     I**   DUMMY DATA STRUCTURES FOR NEW ACCESS PROGRAMS                  S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I**   EXTERNALLY DEFINED DATA STRUCTURES FOR NEW SD FILE ACCESSES    S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I**                                Nostro location code              S01195
     I                                       29  31 NOSLOC                S01195
     ISDDLST    E DSSDDLSTPD                                              S01194
     I*                                                                   S01194
     ISDBOOK    E DSSDBOOKPD                                              S01414
     ISDPRFC    E DSSDPRFCPD                                              S01414
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01494
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0100IIP1                                           S01408
     I*                                                                   S01408
     I/COPY FTCPYSRC,SFTADDRI                                             S01494
     I/COPY FTCPYSRC,SFTVALCS                                             S01494
     ICLSWTK      DS                                                      S01494
     I*                                                                   S01494
     I** Redefine SWIFT array as field for SETLL.                         S01494
     I*                                                                   S01494
     I                                        1  12 SW                    S01494
     I*                                                                   S01494
     IDSMTR       DS                                                      S01494
     I*                                                                   S01494
     I** Define fields for message translation                            S01494
     I*                                                                   S01494
     I                                        1 132 #MSDTA                S01494
     I                                       15  30 #MPREF                S01494
     I                                    P   1   20#MPART                S01494
     I                                      133 264 #MSTX1                S01494
     I#MSTX2      DS                                                      S01494
     I                                        1 256 #MSTXA                S01494
     I                                      257 512 #MSTXB                S01494
     I*                                                                   S01494
     IW8FT        DS                            128                       S01494
     I*                                                                   S01494
     I** Address data structure                                           S01494
     I*                                                                   S01494
     I** Currency                                                         S01494
     I                                        1   3 W8CCY                 S01494
     I** Settlement Type                                                  S01494
     I                                        4   5 W8STMT                S01494
     I** Mandatory Text - convert BIC identifiers                         S01494
     I                                        6   6 W8MTXT                S01494
     I** Message Tag                                                      S01494
     I                                        7  11 W8MTAG                S01494
     I** Construct of data in field                                       S01494
     I                                       12  12 W8TYPE                S01494
     I** Number of Lines available                                        S01494
     I                                       13  140W8NLIN                S01494
     I** Network and Message Type                                         S01494
     I                                       15  20 W8NWRK                S01494
     I                                       21  23 W8MTPY                S01494
     I** Calling Program                                                  S01494
     I                                       24  33 W8CPGM                S01494
     I** Action *PRINT/*ENQ/*MSG GEN                                      S01494
     I                                       34  41 W8ACT                 S01494
     I** Critical reporting - Database error if 'Y'                       S01494
     I** If no BIC directory and BIC entered no error                     S01494
     I                                       42  42 W8CRIT                S01494
     I** Force Midas Address - where possible                             S01494
     I                                       43  43 W8MADD                S01494
     I** If Retail get first address from account                         S01494
     I                                       44  44 W8RTAD                S01494
     I** Alternative Address                                              S01494
     I                                       45  45 W8ALTN                S01494
     I** Address type selected in W0MSG                                   S01494
     I                                       46  46 W8ADTP                S01494
     I*                                                                   S01494
     ISDCNST    E DSSDCNSTPD                                              S01494
     I*                                                                   S01494
     I** Calling parameter data structure for ME1400                      S01494
     I*                                                                   S01494
     IMEBICD    E DSMEBICDPD                                              S01494
     I*                                                                   S01494
     I** Calling parameter data structure for ME1400                      S01494
     I*                                                                   S01494
     IPXML        DS                           9999                                           CSD015
      ** 2ND PARAMETER in XML Format for Compliance Engine Program                            CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Midas SD Watch List Configuration Data File                                          CSD015
      *                                                                                       CSD015
     IPSDWLT    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction details file                                                  CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Data Structure for Watch List Checking Details                                       CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
     I              SETUP                           WSETUP                                    CSD015
      ** SDSTAT Data Structure                                                                CSD015
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      ** 24X7 Data Structure                                                                  CSD015
      *                                                                                       CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
      ** External data structure for SAR file details                                         CSD015
     I/COPY WNCPYSRC,FTH00578
      *                                                                                       CSD015
     I*****************************************************************
     I/EJECT
     C                     MOVEACPY@      BIS@   80
     C*****************************************************************
     C*
     C***********  INITIAL  PROCESSING  *******************************
     C*
     C*
      ***********                                                         056031
      ***********   Remove PRONO OLPOS and MEMOS                          056031
      ***********                                                         056031
     C***SET*UP*KLIST FOR PRONO FILE TO BE USED IN UPRONO SR.             056031
     C***********                                                         056031
     C***********PROKEY    KLIST                                          056031
     C***********          KFLD           PRCCY   3                       056031
     C***********          KFLD           PRNOSN  20                      056031
     C*
     C** SET UP KLIST FOR ACCNT FILE TO BE USED IN UMEMOS SR. & VALIDATION
     C*
     C           ACCKEY    KLIST
     C**********           KFLD           CNUM    60                                          CSD027
     C                     KFLD           CNUM    6                                           CSD027
     C                     KFLD           MCCY    3
     C**********           KFLD           ACOD    40                                          CGL029
     C                     KFLD           ACOD                                                CGL029
     C                     KFLD           ACSQ    20
     C                     KFLD           BRCA    3                       S01117
     C*
     C           @DTSTK    KLIST                                          093958
     C                     KFLD           SPYTP                           093958
     C                     KFLD           SPYST                           093958
     C*                                                                   093958
     C           CBKEY     KLIST
     C                     KFLD           CBKEYN  60
     C                     KFLD           CBKEYA  1
     C*
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           K3FUNT  8                                           CSD015
     C                     KFLD           K3IDEN 40                                           CSD015
     C                     KFLD           K3BRCH  3                                           CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN LDA       DLDA
     C*********************MOVEL'FT0100'  DBPGM                           E29920
     C*********************                                               S01194
     C***CALL*ZSYSTM*TO*ACCESS I.C.D.R. 1 ON TABLE FILE                   S01194
     C*********************                                               S01194
     C*********************EXSR ZSYSTM                                    S01194
     C*********************                                               S01194
     C************IN99*****IFEQ '1'                        B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************MOVE '01'      DBASE            * DB ERROR 01 *S01194
     C*********************MOVELZTABKY    DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*********************                                               S01194
     C*****ACCESS*I.C.D.R.*2 ON TABLE FILE TO OBTAIN BASE CCY             S01194
     C*********************                                               S01194
     C*********************MOVEL*BLANKS   ZTABKY                          S01194
     C*********************MOVEL'01'      ZTABKY                          S01194
     C*********************MOVE '11'      ZTABKY                          S01194
     C***********ZTABKY****CHAINTABFP                99                   S01194
     C**N99******RECI******COMP 'D'                  9999                 S01194
     C*********************                                               S01194
     C*****CHECK*FOR*DATABASE ERROR                                       S01194
     C*********************                                               S01194
     C************IN99*****IFEQ '1'                        B001           S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVELZTABKY    DBKEY            ***************S01194
     C*********************MOVE '02'      DBASE            * DB ERROR 02 *S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C**STORE*BASE*CURRENCY DECIMAL PLACES                                S01194
     C*********************Z-ADDCDP       BCDP    10                      S01194
     C*                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR'  P@RTCD  7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C*                                                                   S01194
     C** Check date format.  Seton 98 if 'MMDDYY' format                  S01194
     C*                                                                   S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     SETON                     98                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C/COPY WNCPYSRC,FT0100C001
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM BJCYCD    CYC     3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C** Store number of decimal places for base currency                 S01194
     C*                                                                   S01194
     C                     Z-ADDA6NBDP    BCDP    10                      S01194
     C*                                                                   S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR'  P@RTCD  7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                                   S01117
     C** Seton MB indicator 43 if multibranching environment              S01117
     C*                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     SETON                     43                   S01117
     C                     END                                            S01117
      *                                                                   S01414
      * Move the conditional IF so that AOGELRR0 is always called.        S01414
      *                                                                   S01414
     C************IN43     IFEQ '1'                        MB envit S01117S01414
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR'  P@RTCD  7                       S01117
     C                     PARM '*FIRST'  @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01414
      * If return code is not blank - process for a database error        S01414
      *                                                                   S01414
     C           P@RTCD    IFNE *BLANKS                                   S01414
     C                     MOVEL'SDGELRPD'W0FILE           *************  S01414
     C                     Z-ADD26        W0ERNB           * DBERR 26  *  S01414
     C                     MOVEL@OPTN     W0KEY            *************  S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                                       CSW201
      ** Call SWIF2001 to check if CSW201 is switched on                                      CSW201
      *                                                                                       CSW201
     C                     MOVE 'N'       CSW201  1                                           CSW201
     C                     CALL 'SWIF2001'             9090                                   CSW201
     C                     PARM *BLANKS   WRTNCD  7                                           CSW201
      *                                                                                       CSW201
      ** If return with an error (LR seton in called program) then                            CSW201
      ** process for database error.                                                          CSW201
      *                                                                                       CSW201
     C           *IN90     IFEQ *ON                                                           CSW201
     C                     MOVEL'SWIF2001'W0FILE                                              CSW201
     C                     MOVEL'*CALL'   W0KEY                                               CSW201
     C                     Z-ADD27        W0ERNB                                              CSW201
     C                     EXSR SRERR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           WRTNCD    IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201                                              CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSD015
      ** Determine if CSC011 enhancement is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSC011'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'W0FILE                                              CSD015
     C                     MOVEL'CSC011'  W0KEY                                               CSD015
     C                     Z-ADD31        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if switchable feature CCF001 is installed                                      CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank or *NRF, then issue database error                          CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SCSARDPD'W0FILE                                              CSD015
     C                     MOVE 'CCF001'  W0KEY                                               CSD015
     C                     Z-ADD32        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if CSD015 enhancement is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'W0FILE                                              CSD015
     C                     MOVEL'CSD015'  W0KEY                                               CSD015
     C                     Z-ADD33        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CRE020
      ** Check if Online Printing of Advices (GE7) is on.                                     CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD                                               CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
      ** Database Error (return code other than *NRF)                                         CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE *BLANKS                                                       CRE020
     C           PRTCD     ANDNE'*NRF   '                                                     CRE020
     C                     MOVEL'SCSARDPD'W0FILE                                              CRE020
     C                     MOVEL'CRE020'  W0KEY                                               CRE020
     C                     Z-ADD37        W0ERNB                                              CRE020
     C                     EXSR SRERR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CAP205
      ** Determine if SAR CAP205 is installed                                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   PRTCD                                               CAP205
     C                     PARM '*VERIFY' POPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
      ** Database Error (return code other than *NRF)                                         CAP205
      *                                                                                       CAP205
     C           PRTCD     IFNE *BLANKS                                                       CAP205
     C           PRTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD38        W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C           PRTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FTH00579
      *                                                                                       CSD015
      ** Access AOWLCCR0 to check if function code 'FTNOSTRF' is on                           CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY'    POPTN                                               CSD015
     C                     PARM 'FTNOSTRF'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF'                                                        CSD015
     C                     MOVEL'SDWLCCPD'W0FILE                                              CSD015
     C                     MOVEL'FTNOSTRF'W0KEY                                               CSD015
     C                     Z-ADD34        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access compliance watch configuration                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST ' POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C                     MOVE 'SDCWCDPD'W0FILE                                              CSD015
     C                     MOVE '*FIRST ' W0KEY                                               CSD015
     C                     Z-ADD35        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ENDIF                                                              CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
     C*                                                                   S01494
     C** Retrieve the text for FTM2510 using MEC1150                      S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2510' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    WM2510 25                       S01494
     C*                                                                   S01494
     C** Retrieve the text for the function keys using MEC1150            S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2538' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,1                          S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2539' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,4                          S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2540' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,6                          S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2541' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,2                          S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2542' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,3                          S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2543' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    FKEY,5                          S01494
      *                                                                   S01414
      * If multi-branching active.......                                  S01414
      *                                                                   S01414
     C           *IN43     IFEQ '1'                        MB environment S01117
     C*                                                                   S01117
     C** IF ORIGINATING BRANCH USED                                       S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     SETON                     18                   S01117
     C                     END                                            S01117
      *                                                                   S01414
      * Move the access of ZMUSER out of conditional IF by moving         S01414
      * the END statement                                                 S01414
      *                                                                   S01414
     C                     END                                            S01414
     C*                                                                   S01117
     C** RETRIEVE USER'S DEFAULT BRANCH                                   S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER           get DBRN       S01117
     C                     IN   ZMUSER                                    S01117
      *                                                                   S01414
     C*********************END                                      S01117S01414
     C*                                                                   S01117
     C*
     C**   SETUP THE BACKVALUE LIMIT DATE
     C*
     C***********RUND******SUB  BVLP      BVLD    50                      S01194
     C           BJRDNB    SUB  BJBVPD    BVLD    50                      S01194
      *                                                                   056031
      * Access FT Control data                                            056031
      *                                                                   056031
     C                     CALL 'FT0005'               9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C           C#CNTL    PARM           O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     Z-ADD1         Q                               056031
     C                     MOVEL'MAIN '   @STK,Q                          056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'FT0005'  W0KEY                           056031
     C                     Z-ADD1         W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
      *                                                                   056031
      * Set up FT override for General Ledger Balances                    056031
      *                                                                   056031
     C           C#GLUI    IFEQ 'I'                                       056031
     C                     MOVEL'Y'       ##FTOV  1                       056031
     C                     ELSE                                           056031
     C                     MOVEL*BLANKS   ##FTOV                          056031
     C                     END                                            056031
      *                                                                   056031
     C*
     C** DETERMINE IF DEALING AND RETAIL MODULES ARE PRESENT
     C*
     C           *NAMVAR   DEFN MMOD      DMMOD
     C                     IN   DMMOD
     C           WDL       IFEQ 'Y'                        B001
     C                     MOVE '1'       *IN65
     C                     END                             E001
     C*
     C***********WRT       IFEQ 'Y'                        B001           E23411
     C           WRT2      IFEQ 'Y'                                       E23411
     C           WIOA      OREQ 'Y'                                       E23411
     C                     MOVE '1'       *IN66
     C                     END                             E001
     C*                                                                   S01494
     C** Clear message subfile                                            S01494
     C*                                                                   S01494
     C                     CALL 'Y2CLMSC'                                 S01494
     C                     PARM ##PGM     FTPGMQ 10                       S01494
     C                     PARM '*SAME'   FTPGRL  5                       S01494
     C*                                                                   S01494
     C** Reset message sent flag                                          S01494
     C*                                                                   S01494
     C                     MOVEL'N'       FTMSGS  1                       S01494
     C*
     C** SET ON INITIAL SCREEN INDICATOR
     C                     MOVE '1'       *IN26
      *
      *
      * ************  START  OF  MAIN  PROCESSING  CYCLE  ****************
      *
      *
     C           *ENTRY    PLIST
     C           SACTCD    PARM           @SORT   1
     C           STFRF     PARM           @TFRF  15
     C                     PARM           @RTCD   1
     C*                                                                   096486
     C**  If program is called by GL4442, then initialise fields.         096486
     C*                                                                   096486
     C                     MOVE *BLANK    @GL442  1                       096486
     C           @RTCD     IFEQ 'G'                                       096486
     C                     MOVE 'Y'       @GL442                          096486
     C                     MOVE *BLANK    @RTCD                           096486
     C                     END                                            096486
      *
      * IF CALLED FROM OTHER PROGRAM IGNORE INITIAL SCREEN
      *
     C           @TFRF     IFNE *BLANK
     C/COPY WNCPYSRC,FT0100C008
     C           @GL442    IFNE 'Y'                                       096486
     C*                                                                   E29970
     C** ENABLE COMMAND 7                                                 E29970
     C*                                                                   E29970
     C                     SETON                     10                   E29970
     C                     END                                            096486
     C                     GOTO IGINT
     C                     END
     C*                                                                   S01494
     C** Initialise no update indicator, re-display, warning array        S01494
     C** and warning message sent                                         S01494
     C*                                                                   S01494
     C                     MOVEL*BLANKS   FTNOUP  1                       S01494
     C                     MOVEL*BLANKS   FTRSND  1                       S01494
     C                     MOVEL*BLANKS   FTWARN  1                       S01494
     C                     MOVEL*BLANKS   FTWAR   1                                         AR949206
     C                     MOVEL*BLANKS   FTRES   1                                         AR949206
     C                     MOVEL*BLANKS   WRN@                            S01494
      *
      * Write/Read Initial screen
      *
     C           BEGIN     TAG                             ** BEGIN TAG **
      *                                                                   042167
      * Call CL program to deallocate dataarea ONLY prior to processing   042167
      * the initial screen and if not called from an enquiry function     042167
      *                                                                   042167
     C           *IN27     IFEQ '0'                                       042167
     C           @TFRF     ANDEQ*BLANKS                                   042167
     C                     EXSR DALLOC                                    042167
     C                     END                                            042167
     C*
     C                     TIME           TIME
     C*                                                                   S01494
     C** Display message subfile                                          S01494
     C*                                                                   S01494
     C                     MOVE '1'       *IN87                           S01494
     C                     WRITE#MSGCTL                                   S01494
     C*
     C** Select Function Keys to be displayed                             S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SFKEY                           S01494
     C                     SELEC                                          S01494
     C           *IN21     WHEQ '0'                                       S01494
     C           *IN10     ANDEQ'0'                                       S01494
     C           *IN20     ANDEQ'1'                                       S01494
     C                     MOVELFKEY,2    SFKEY                           S01494
     C*                                                                   S01494
     C           *IN21     WHEQ '0'                                       S01494
     C           *IN10     ANDEQ'1'                                       S01494
     C           *IN20     ANDEQ'1'                                       S01494
     C                     MOVELFKEY,3    SFKEY                           S01494
     C*                                                                   S01494
     C           *IN21     WHEQ '1'                                       S01494
     C           *IN27     ANDEQ'1'                                       S01494
     C           *IN10     ANDEQ'0'                                       S01494
     C                     MOVELFKEY,4    SFKEY                           S01494
     C*                                                                   S01494
     C           *IN21     WHEQ '1'                                       S01494
     C           *IN10     ANDEQ'1'                                       S01494
     C                     MOVELFKEY,5    SFKEY                           S01494
     C*                                                                   S01494
     C           *IN21     WHEQ '0'                                       S01494
     C           *IN10     ANDEQ'1'                                       S01494
     C           *IN20     ANDEQ'0'                                       S01494
     C                     MOVELFKEY,6    SFKEY                           S01494
     C*                                                                   S01494
     C                     OTHER                                          S01494
     C                     MOVELFKEY,1    SFKEY                           S01494
     C                     ENDSL                                          S01494
     C*                                                                   S01494
     C/COPY WNCPYSRC,FT0100C006
     C                     WRITEFT0100F1
     C*
     C***********HELP      TAG                                            S01199
     C*
     C* THE DISPLAY FILE WILL BE REDISPLAYED AFTER HELP
     C* AS IT IS CREATED WITH RSTDSP(*YES)
     C*
     C                     READ FT0100F1                 99
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN07     DOWEQ'1'                                       S01494
     C           SACTCD    ANDEQ'E'                                       S01494
     C                     EXSR #LADDI                                    S01494
     C           *INKC     IFEQ '0'                                       S01494
     C                     WRITEFT0100F1
     C                     READ FT0100F1                 99
     C                     ELSE                                           S01494
     C                     SETOF                     07                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C/COPY WNCPYSRC,FT0100C007
     C*                                                                   S01494
     C** Clear message subfile                                            S01494
     C*                                                                   S01494
     C                     CALL 'Y2CLMSC'                                 S01494
     C                     PARM ##PGM     FTPGMQ 10                       S01494
     C                     PARM '*SAME'   FTPGRL  5                       S01494
     C*                                                                   S01494
     C** Reset message sent flag                                          S01494
     C*                                                                   S01494
     C                     MOVEL'N'       FTMSGS  1                       S01494
     C                     MOVEL*BLANKS   FTWARN  1                       S01494
     C                     MOVEL*BLANKS   FTNOUP                          S01494
      *
      * Process Initial Screen
      *
     C           IGINT     TAG
     C*
     C**    CHECK IF FUNCTION KEY 3 WAS PRESSED
     C*
     C           *INKC     IFEQ '1'                        B001
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       @RTCD
     C                     RETRN
     C                     END                             E001
     C*
     C**    CHECK IF FUNCTION KEY 7 WAS PRESSED                           E29970
     C*                                                                   E29970
     C           *INKG     IFEQ '1'                        B001           E29970
     C                     MOVE '1'       *INLR                           E29970
     C                     MOVE '7'       @RTCD                           E29970
     C                     RETRN                                          E29970
     C                     END                             E001           E29970
     C*
     C**    CHECK IF FUNCTION KEY 12 WAS PRESSED
     C*
     C           *INKL     IFEQ '1'                        B001
     C*
     C* If called from other program then return
     C*
     C           @TFRF     IFNE *BLANK
     C/COPY WNCPYSRC,FT0100C009
     C                     MOVE '1'       *INLR
     C                     MOVE '5'       @RTCD
     C                     RETRN
     C*
     C* ELSE re-display cleared initial screen
     C*
     C                     ELSE
     C                     EXSR RESET
     C                     GOTO BEGIN
     C                     END                             E001
     C*
     C                     END                             E001
     C*
     C******CHECK*IF*HELP*KEY*WAS*PRESSED*&*CALL*HELP*PROGRAM*IF*IT*WAS
     C*********************
     C************IN25*****IFEQ '1'                        B001           S01199
     C*********************MOVEAERCD      HERCD 160                       S01199
     C*********************MOVEL'FT0000'  HBPGM   8                       S01199
     C*********************CALL 'MHELP'                                   S01199
     C*********************PARM           HBPGM                           S01199
     C*********************PARM           HERCD                           S01199
     C*********************GOTO HELP                                      S01199
     C*********************END                             E001           S01199
     C*********************
     C*
     C**    BYPASS INITIAL SCREEN VALIDATION IF IND '27' ON
     C**    IND '27' - Detail screen processing
     C*
     C           *IN27     IFEQ '0'                        B001
     C*
     C**     VALIDATE INITIAL SCREEN ENTRIES
     C*
     C                     EXSR INITSC
     C*
     C*  Re-display initial screen if error ocurred or '?' was entered
     C*  in a field
     C*
     C           *IN27     IFEQ '0'                        B002
     C           *IN15     OREQ '1'                                       S01194
     C                     GOTO BEGIN
     C                     END                             E002
     C*
     C**     SETUP FIELDS FOR DETAIL SCREEN OUTPUT
     C*
     C                     EXSR OTPUT
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
      *
     C                     GOTO BEGIN
     C*
     C                     END                             E001
      *
      *
      *   ********     DETAIL SCREEN PROCESSING      ********
      *
      *
     C**   IF ACTION CODE 'D' AND F10 PRESSED PERFORM DELETION PROC.
     C*
     C           *IN21     IFEQ '1'                        B001
     C*
     C           *INKJ     IFEQ '1'                        B002
     C                     EXSR DELET
     C*
     C           ERCD,1    IFNE *BLANKS                    B003
     C                     MOVE '1'       *IN28
     C                     MOVEAERCD      SERCD1
     C                     END                             E003
     C*
     C                     ELSE                            X002
     C                     GOTO BEGIN
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C**   IF ACTION CODE 'I' OR 'A' VALIDATE ALL INPUT
     C*
     C           *IN22     IFEQ '1'                        B001
     C           *IN23     OREQ '1'
     C*
     C**     VALIDATE DETAIL SCREEN ENTRIES
     C*
     C                     EXSR DETSC
     C*
     C           ERCD,1    IFNE *BLANKS                    B002
     C           *IN15     OREQ '1'                                       S01194
     C           ERCD,1    IFNE *BLANKS                                   S01194
     C                     MOVEAERCD      SERCD1
     C                     MOVE '1'       *IN28
     C                     END                                            S01194
     C*
     C                     GOTO BEGIN
     C*
     C                     ELSE                            X002
     C*                                                                   S01494
     C** If no error in validation but warning occurs display warning     S01494
     C** before accepting the transaction.                                S01494
     C*                                                                   S01494
     C           FTNOUP    IFNE *BLANKS                                   S01494
     C                     MOVEL*BLANKS   FTRSND                          S01494
     C                     GOTO BEGIN                                     S01494
     C                     END                                            S01494
     C           FTWARN    IFEQ 'Y'                                       S01494
     C           FTRSND    ANDEQ*BLANKS                                   S01494
     C                     MOVEL'Y'       FTRSND                          S01494
     C                     GOTO BEGIN                                     S01494
     C                     END                                            S01494
     C           FTWAR     IFEQ 'Y'                                                         AR949206
     C           FTRES     ANDEQ*BLANKS                                                     AR949206
     C                     MOVEL'Y'       FTRES                                             AR949206
     C                     GOTO BEGIN                                                       AR949206
     C                     ENDIF                                                            AR949206
     C*
     C*******SWIFT*PRIORITY*CODE*IF*BLANK*DEFAULTS*TO*'02'*               S01117
     C**     SWIFT PRIORITY CODE IF BLANK DEFAULTS TO 'N'                 S01117
     C*
     C           SSWPC     IFEQ *BLANKS                    B003
     C*********************MOVE '02'      SSWPC                           S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     END                             E003
     C*
     C**     SETTLEMENT TYPE IF BLANK DEFAULTS TO '08'
     C*
     C           SSTMT     IFEQ *BLANKS                    B003
     C                     MOVE '08'      SSTMT
     C                     END                             E003
     C                     END                             E002
     C/COPY WNCPYSRC,FT0100C002
     C*
     C**     IF 'I' PERFORM INSERTION PROCESSING
     C*
     C           *IN22     IFEQ '1'                        B002
     C                     EXSR INSERT
     C*
     C           ERCD,1    IFNE *BLANKS                    B003
     C                     MOVE '1'       *IN28
     C                     MOVEAERCD      SERCD1
     C                     ELSE                            X003
     C*
     C                     MOVE '1'       *IN30
     C                     MOVE *BLANKS   SPTFRF
     C                     MOVELTFRF      SPTFRF
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C**     IF 'A' PERFORM AMENDMENT PROCESSING
     C*
     C           *IN23     IFEQ '1'                        B002
     C                     EXSR AMEND
     C           ERCD,1    IFNE *BLANKS                    B003
     C                     MOVE '1'       *IN28
     C                     MOVEAERCD      SERCD1
     C                     END                             E003
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0100CCP1                                           S01408
     C*                                                                   S01408
     C** IF ALL INPUT WAS VALID,COMMIT CHANGES TO FILES
     C** (NOT ENQUIRY MODE)
     C*
     C           *IN20     IFEQ '0'                        B001
     C           SERCD1    ANDEQ*BLANKS
     C                     MOVE TIME      TIMEX
     C                     MOVEL'FT'      MDID
     C                     MOVEL'FT0100'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELSACTCD    ACTCDX
     C                     MOVELUSRID     USRIDX
     C           CMTTXT    COMIT
     C*                                                                   S01494
     C** Clear message subfile                                            S01494
     C*                                                                   S01494
     C                     CALL 'Y2CLMSC'                                 S01494
     C                     PARM ##PGM     FTPGMQ 10                       S01494
     C                     PARM '*SAME'   FTPGRL  5                       S01494
     C*                                                                   S01494
     C** Reset message sent flag                                          S01494
     C*                                                                   S01494
     C                     MOVEL'N'       FTMSGS  1                       S01494
     C                     MOVEL*BLANKS   FTWARN                          S01494
     C*                                                                   S01494
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
     C                     END                             E001
     C*
     C**   RESET INDICATORS AND FIELDS AND OUTPUT INITIAL SCREEN
     C*
     C           @TFRF     IFNE *BLANK
     C/COPY WNCPYSRC,FT0100C010
     C                     MOVE '1'       *INLR
     C                     MOVE ' '       @RTCD
     C                     RETRN
     C                     ELSE
     C                     EXSR RESET
     C                     GOTO BEGIN
     C                     END                             E001
     C*
     C** END OF MAIN PROCESSING CYCLE AND BEGINNING OF SUBROUTINES :
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** INITSC SR. TO VALIDATE INITIAL SCREEN ENTRIES
     C*
     C           INITSC    BEGSR
     C*
     C**      SETOF INDICATORS,CLEAR WORK FIELDS
     C*
     C                     Z-ADD0         X                               E29907
     C                     MOVEL*BLANKS   SERCD1
     C                     MOVEA*BLANKS   ERCD
     C*********************MOVEA'000000'  *IN,44                          E29907
     C                     MOVEA'00'      *IN,28
     C                     MOVEA'00'      *IN,31
     C                     MOVEA'0'       *IN,19                          S01117
      *                                                                   S01194
      ** Resolve ?'s before validation                                    S01194
      *                                                                   S01194
     C                     EXSR FLDQRY                                    S01194
     C*                                                                   S01194
     C*
     C**   ACTION CODE SHOULD NOT BE BLANK
     C*
     C           SACTCD    IFEQ *BLANK                     B001
     C                     ADD  1         X                               E29907
     C                     SETON                     31                   E29907
     C*********************MOVEA' 144'    ERCD,X                    E29907S01117
     C                     MOVEA' 002'    ERCD,X                          S01117
     C*********************MOVE '1'       *IN44                           E29907
     C*********************MOVE ' 144'    ERCD,1                          E29907
     C                     END                             E001
     C*
     C**     IT MUST BE 'I','A','D' OR 'E'
     C*
     C************IN44*****IFEQ '0'                        B001           E29907
     C           *IN31     IFEQ '0'                        B001           E29907
     C           SACTCD    ANDNE'I'
     C           SACTCD    ANDNE'A'
     C           SACTCD    ANDNE'D'
     C           SACTCD    ANDNE'E'
     C                     ADD  1         X                               E29907
     C                     SETON                     31                   E29907
     C*********************MOVEA' 145'    ERCD,X                    E29907S01117
     C                     MOVEA' 003'    ERCD,X                          S01117
     C                     END                             E001           E29907
     C*********************MOVE '1'       *IN45                           E29907
     C*********************MOVE ' 145'    ERCD,1                          E29907
     C*
     C************IN44*****IFEQ '0'                        B001           E29907
     C************IN45*****ANDEQ'0'                                       E29907
     C*
     C**     IF 'I'  TRANSFER REFERENCE MUST BE BLANK
     C*
     C           SACTCD    IFEQ 'I'                        B002
     C           STFRF     ANDNE*BLANKS
     C                     ADD  1         X                               E29907
     C                     SETON                     32                   E29907
     C*********************MOVEA' 146'    ERCD,X                    E29907S01117
     C                     MOVEA' 004'    ERCD,X                          S01117
     C*********************MOVE '1'       *IN46                           E29907
     C*********************MOVE ' 146'    ERCD,1                          E29907
     C                     END                             E002
     C*
     C**     IF 'A','D' OR 'E' TRANSFER REF MUST BE ENTERED AND EXIST
     C*
     C           SACTCD    IFEQ 'A'                        B002
     C           SACTCD    OREQ 'D'
     C           SACTCD    OREQ 'E'
     C*
     C**     TRANSFER REFERENCE MUST BE ENTERED FOR 'A','D' OR 'E'
     C*
     C           STFRF     IFEQ *BLANKS                    B003
     C                     ADD  1         X                               E29907
     C                     SETON                     32                   E29907
     C*********************MOVEA' 147'    ERCD,X                    E29907S01117
     C                     MOVEA' 005'    ERCD,X                          S01117
     C*********************MOVE '1'       *IN47                           E29907
     C*********************MOVE ' 147'    ERCD,1                          E29907
     C                     ELSE                            X003
     C*
     C**     IF ENTERED,TRANSFER REFERENCE MUST EXIST
     C*
     C                     EXSR TRANRF                     CHN FAIL-71
     C*
     C           *IN71     IFEQ '1'                        B004
     C*                                                                   096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'E'       @RTCD                           096486
     C                     SETON                     LR                   096486
     C                     RETRN                                          096486
     C                     END                                            096486
     C*                                                                   096486
     C                     ADD  1         X                               E29907
     C                     SETON                     32                   E29907
     C*********************MOVEA' 148'    ERCD,X                    E29907S01117
     C                     MOVEA' 006'    ERCD,X                          S01117
     C*********************MOVE '1'       *IN48                           E29907
     C*********************MOVE ' 148'    ERCD,1                          E29907
     C                     END                             E004
     C*
     C************IN48     IFEQ '0'                        B004           E29907
     C           X         IFEQ 0                          B004           E29907
     C           SACTCD    ANDNE'E'
     C*
     C*******FOR*ACTION*CODES*'A'*AND*'D'*-*MUST*HAVE*BEEN*INPUT*TODAY,*  058581
     C*******BE*LIVE*AND*NOT*AUTHORISED*                                  058581
      * For action codes 'A' and 'D' - must be live and not authorised.   058581
     C*
     C***********OEDT******IFNE RUND                       B005           S01194
     C***********OEDT      IFNE BJRDNB                     B005     S01194058581
     C***********RECI      ORNE 'D'                                       058581
     C           RECI      IFNE 'D'                                       058581
     C           AUIN      OREQ 'Y'
     C                     ADD  1         X                               E29907
     C                     SETON                     32                   E29907
     C*********************MOVEA' 149'    ERCD,X                    E29907S01117
     C                     MOVEA' 007'    ERCD,X                          S01117
     C*********************MOVE '1'       *IN49                           E29907
     C*********************MOVE ' 149'    ERCD,1                          E29907
     C*
     C                     END                             E005
     C*
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C*********************END                             E001           E29907
      *                                                                   042167
      *                                                                   042167
      * Call CL program to check for other users of reference only if     042167
      * - action 'A' or 'D' (not 'I' as ref. then is still blank)         042167
      * - AND if program is not linked from an enquiry function (as       042167
      *   allocation processing would already have been done)             042167
      *                                                                   042167
     C           @TFRF     IFEQ *BLANKS                                   042167
     C           SACTCD    ANDEQ'A'                                       042167
      *                                                                   042167
     C           @TFRF     OREQ *BLANKS                                   042167
     C           SACTCD    ANDEQ'D'                                       042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE  7                       042167
     C                     MOVE 'FT'      @MODLE  2                       042167
     C                     MOVE STFRF     @TREF  15                       042167
     C                     MOVE *BLANKS   @RTINF 80                       042167
     C*                                                                   042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
      *                                                                   042167
      *  If 'IN USE' then redisplay subfile with error message            042167
      *  for record lock                                                  042167
      *                                                                   042167
     C           @RTCDE    IFEQ '*IN USE'                                 042167
     C                     MOVE '1'       *IN32                           042167
     C                     ADD  1         X                               042167
     C                     MOVE ' 600'    ERCD,X                          042167
     C                     END                                            042167
     C*                                                                   042167
     C                     END                                            042167
     C*                                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C           X         IFEQ 0                          B000           S01117
     C*                                                                   S01117
     C           *IN43     IFEQ '0'                        B001           S01117
     C*                                                                   S01117
     C** IF SINGLE BRANCHED CHECK USERS AUTHORITY TO ACTION CODE          S01117
     C** AND MENU ITEM.                                                   S01117
     C*                                                                   S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTCD    ZACTN   1                       S01117
     C                     PARM           ERR     10                      S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C           ERR       IFNE 0                          B002           S01117
     C                     ADD  1         X                               S01117
     C                     SETON                     31                   S01117
     C                     MOVEA' 302'    ERCD,X                          S01117
     C                     END                             E002           S01117
     C                     END                                            096486
     C                     ELSE                            X001 IN43 = 1  S01117
     C*                                                                   S01117
     C*ELSE MULTI-BRANCHED                                                S01117
     C*IF INSERT AND BRANCH NOT ENTERED DEFAULT TO DEFAULT BR             S01117
     C*                                                                   S01117
     C           SACTCD    IFEQ 'I'                        B002           S01117
     C           SBRCA     ANDEQ*BLANKS                                   S01117
     C                     MOVE DBRN      SBRCA                           S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C** NOT INSERT MOVE RECORD BOOKING BRANCH TO VERIFICATION            S01117
     C** FIELD ELSE MOVE SCREEN FIELD TO VERIFICATION FIELD               S01117
     C*                                                                   S01117
     C           SACTCD    IFNE 'I'                                       S01117
     C                     MOVE BRCA      @BRCH                           S01117
     C                     ELSE                                           S01117
     C                     MOVE SBRCA     @BRCH                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IF MB ENVIRONMENT,                                               S01117
     C** VALIDATE BRANCH CODE ENTERD OR DEFAULTED                         S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7                       S01194
     C                     PARM '*VERIFY' @OPTN   7                       S01194
     C                     PARM @BRCH     @BRCH   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           P@RTCD    IFNE *BLANKS                    B003           S01117
     C                     ADD  1         X                               S01117
     C                     MOVEA' 008'    ERCD,X                          S01117
     C                     SETON                     19                   S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C           SACTCD    IFNE 'I'                        B00F           S01117
     C           SBRCA     ANDNE*BLANKS                                   S01117
     C                     ADD  1         X                               S01117
     C                     MOVEA' 009'    ERCD,X                          S01117
     C                     SETON                     19                   S01117
     C                     END                             E00F           S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C** IF BRANCH ENTRY IS VALID CHECK USERS AUTHORITY TO ACTION CODE    S01117
     C*  AND BRANCH.                                                      S01117
     C*                                                                   S01117
     C           *IN19     IFEQ '0'                        B00F           S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM           SACTCD                          S01117
     C                     PARM           @BRCH                           S01117
     C                     PARM           ERR                             S01117
     C*                                                                   S01117
     C           ERR       IFNE 0                          B002           S01117
     C                     ADD  1         X                               S01117
     C           ERR       IFEQ 1                          B003           S01117
     C                     MOVEA' 303'    ERCD,X                          S01117
     C                     ELSE                            X003  ERR = 2  S01117
     C                     MOVEA' 304'    ERCD,X                          S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C**IF INSERT HIGLIGHT BRANCH CODE AS ERROR ELSE HIGHLIGHT            S01117
     C**TRANSACTION REFERENCE.                                            S01117
     C*                                                                   S01117
     C           SACTCD    IFEQ 'I'                                       S01117
     C                     SETON                     19                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     32                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             E002           S01117
     C                     END                                            096486
     C                     END                             E00F           S01117
     C*                                                                   S01117
     C** IF REQUIRED VALIDATE AUTHORITY TO ORIGINATING BRANCH             S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                        **B02          S01117
     C           SACTCD    ANDNE'I'                                       S01117
     C*                                                                   S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      ZOBRX   3                       S01117
     C                     PARM 0         ERR                             S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          **B03          S01117
     C                     ADD  1         X                               S01117
     C                     SETON                     32                   S01117
     C                     MOVEA' 305'    ERCD,X                          S01117
     C                     END                             **E03          S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          **B03          S01117
     C                     ADD  1         X                               S01117
     C                     SETON                     32                   S01117
     C                     MOVEA' 306'    ERCD,X                          S01117
     C                     END                             **E03          S01117
     C*                                                                   S01117
     C                     END                             **E02          S01117
     C*                                                                   S01117
     C                     END                             E001 MB        S01117
     C                     END                             E000 NO ERROR  S01117
     C********************************************************************S01117
     C           MID       TAG                                            S01117
     C*
     C** IF VALIDATION SUCCESSFUL, SET ON DETAIL SCREEN INDICATOR '27'
     C*
     C***********ERCD,1****COMP *BLANKS                  27 EQ            S01117
     C*                                                                   S01117
     C************IN27*****IFEQ '1'                        B001           S01117
     C*                                                                   S01117
     C           X         IFEQ 0                                         S01117
     C           *IN15     IFEQ '0'                                       S01117
     C*
     C*********************MOVE '0'       *IN26                           E29907
     C*                                                                   E29907
     C** SWITCH OFF 1ST SCREEN INDICATOR AND ON 2ND SCREEN INDICATOR      E29907
     C*                                                                   E29907
     C                     MOVEA'01'      *IN,26                          E29907
     C*
     C**     SET ON ENQUIRY SCREEN INDICATOR
     C           SACTCD    IFEQ 'E'                        B002
     C                     MOVE '1'       *IN20
     C                     ELSE                            X002
     C*
     C**     SET ON DELETION SCREEN INDICATOR
     C           SACTCD    IFEQ 'D'                        B003
     C                     MOVE '1'       *IN21
     C                     ELSE                            X003
     C*
     C**     SET ON INSERTION SCREEN INDICATOR
     C           SACTCD    IFEQ 'I'                        B004
     C                     MOVE '1'       *IN22
     C                     ELSE                            X004
     C*
     C**     SET ON AMENDMENT SCREEN INDICATOR
     C                     MOVE '1'       *IN23
     C*
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C*
     C**     OBTAIN NO. OF D.P. FOR CURRENCY
     C           *IN22     IFEQ '0'                        B002
     C                     MOVE CCY       SCCY
     C                     EXSR CURCHN
     C*
     C**     FORMAT THE TRANSFER AMOUNT FOR OUTPUT TO THE SCREEN
     C*
     C                     MOVEL*BLANKS   WFDIN  15
     C                     MOVE AMNT      WFDIN
     C***********13********SUB  CDP       WDIG    20                      S01194
     C           13        SUB  A6NBDP    WDIG    20                      S01194
     C*********************Z-ADDCDP       WDEC    10                      S01194
     C                     Z-ADDA6NBDP    WDEC    10                      S01194
     C                     EXSR UIFRMT
     C                     MOVE WFDOUT    SAMNT
     C*
     C                     END                             E002
     C*
     C**   IF ERRORS ON INITIAL SCREEN SET ON SCREEN INDICATORS
     C*
     C                     END                                            S01117
     C                     ELSE                            X001
     C                     MOVEAERCD      SERCD1
     C                     MOVE '1'       *IN28
     C                     END                                            E29907
     C*
     C*********************                                               E29907
     C************IN44*****IFEQ '1'                        B002           E29907
     C************IN45*****OREQ '1'                                       E29907
     C*********************MOVE '1'       *IN31                           E29907
     C*********************END                             E002           E29907
     C************IN46*****IFEQ '1'                        B002           E29907
     C************IN47*****OREQ '1'                                       E29907
     C************IN48*****OREQ '1'                                       E29907
     C************IN49*****OREQ '1'                                       E29907
     C*********************MOVE '1'       *IN32                           E29907
     C*********************END                             E002           E29907
     C*********************END                             E001           E29907
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** DETSC SR.TO VALIDATE DETAIL SCREEN INPUT FOR ACTION
     C** CODES 'I' AND 'A'
     C*
     C           DETSC     BEGSR
     C*
     C**   SETOF INDICATORS,CLEAR WORK FIELDS
     C*
     C                     MOVEA'0'       *IN,17                          S01117
     C                     MOVEA'0'       *IN,19                          S01117
     C*********************MOVEA'0000'    *IN,40                          S01117
     C                     MOVEA'000'     *IN,40                          S01117
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'000'     *IN,58
     C                     MOVEA'00'      *IN,77                          S01412
     C                     MOVEA'00000000'*IN,31
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN82                           S01414
     C                     MOVE '0'       *IN86                           S01414
     C                     MOVEA*BLANKS   ERCD
     C                     MOVEL*BLANKS   SERCD1
     C                     Z-ADD1         X       20
     C                     MOVE '0'       *IN29                                               210617
      *                                                                   S01194
      ** Resolve ?'s before validation                                    S01194
      *                                                                   S01194
     C                     EXSR FLDQRY                                    S01194
      *                                                                   S01194
      ** Display error code if '?' entered in Destination, Intermediary   S01194
      ** Bank, or Account With Bank.                                      S01194
      *                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASDEST     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     33               S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASACBN     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     37               S01194
     C*                                                                   S01194
     C***********          MOVEA*BLANKS   FLDQ                     S01194 S01494
     C***********          MOVEASINTB     FLDQ                     S01194 S01494
     C***********'?'       LOKUPFLDQ                     42        S01194 S01494
     C*                                                                   S01194
     C           *IN33     IFEQ '1'                                       S01194
     C           *IN37     OREQ '1'                                       S01194
     C************IN42     OREQ '1'                                S01194 S01494
     C                     MOVE ' 017'    ERCD,X                          S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C*
     C**   TRANSFER SUB-TYPE MUST BE ENTERED,
     C**   AND MUST BE A VALID DEAL SUB-TYPE.
     C*
     C           SPYST     COMP *BLANKS                  41
     C           *IN41     IFEQ '1'                        B001
     C*********************MOVE ' 329'    ERCD,X                          S01117
     C                     MOVE ' 011'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     ELSE                            X001
     C                     MOVE SPYST     DSPYST  2
     C                     EXSR DSTCHN
     C           *IN69     IFEQ '1'                        B002
     C                     MOVE '1'       *IN41
     C*********************MOVE ' 330'    ERCD,X                          S01117
     C                     MOVE ' 012'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E002
     C                     END                             E001
     C*
     C**   DESTINATION MUST BE ENTERED
     C*
     C           SDEST     COMP *BLANKS                  50
     C           *IN50     IFEQ '1'                        B001
     C*********************MOVE ' 150'    ERCD,X                          S01117
     C                     MOVE ' 013'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E001
     C**   CURRENCY MUST BE ENTERED
     C           SCCY      COMP *BLANKS                  54
     C           *IN54     IFEQ '1'                        B001
     C*********************MOVE ' 154'    ERCD,X                          S01117
     C                     MOVE ' 020'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E001
     C**     CURRENCY MUST BE A VALID ONE
     C           *IN54     IFEQ '0'                        B001
     C                     EXSR CURCHN                     CHN FAIL-73
     C*                                                                   S01194
     C           *IN73     IFEQ '1'                        B002           S01194
     C                     MOVE '1'       *IN55
     C*********************MOVE ' 155'    ERCD,X                          S01117
     C                     MOVE ' 021'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E002
     C*
     C                     END                             E001
     C**   IF DESTINATION AND CURRENCY ARE BOTH VALID -
     C           *IN54     IFEQ '0'                        B001
     C           *IN55     ANDEQ'0'
     C           *IN50     ANDEQ'0'
     C*
     C**     CURRENCY AND DESTINATION MUST FORM A VALID NOSTRO
     C                     MOVE SCCY      NRCCY   3
     C*********************MOVE SDEST     NRNOSN  20                      S01194
     C                     MOVE SDEST     NRNOSN  2                       S01194
     C                     MOVE *BLANKS   ERROR   7                       S01117
     C                     MOVE *BLANKS   NOSLO1  3                                           217782
     C                     EXSR NOSCHN                     CHN FAIL-70
     C*
     C           *IN70     IFEQ '1'                        B002
     C                     MOVE '1'       *IN51
     C*********************MOVE ' 151'    ERCD,X                          S01117
     C                     MOVE ' 014'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     ELSE                            X002
     C                     MOVELNOSLOC    NOSLO1                                              217782
     C*
     C**  ACCESS FULL ACCOUNT DETAILS FOR LATER VALIDATION
     C*
     C                     MOVE SCCY      MCCY
     C           ACCKEY    CHAINACCNTABF             99
     C  N99      RECI      COMP 'D'                  9999                 047179
     C           *IN99     IFEQ '1'                        B003
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'ACCNT'   DBFILE           ***************
     C                     MOVE '03'      DBASE            * DB ERROR 03 *
     C                     MOVELACKYDS    DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     ELSE                            X003
     C                     MOVE ACST      ACST2   1                       047179
     C                     Z-ADDDACO      DACOD   50
     C                     MOVE ATYP      ATYPD   1
     C/COPY WNCPYSRC,FTH00580
     C                     BITOF'01234567'WRETB   1                                         AR949206
     C                     MOVE ACRETB    WRETB                                             AR949206
      *                                                                                     AR949206
      ** Check Status of Account                                                            AR949206
      **                                                                                    AR949206
      ** Blocked Debit                                                                      AR949206
      *                                                                                     AR949206
     C                     TESTB'2'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN50                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0014' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Bankrupt/Liquidated                                                                AR949206
      *                                                                                     AR949206
     C                     TESTB'6'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN50                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0015' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Bad Debt                                                                           AR949206
      *                                                                                     AR949206
     C                     TESTB'7'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN50                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0016' FTMSID                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Inactive                                                                           AR949206
      *                                                                                     AR949206
     C                     TESTB'4'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN50                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0017' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTWARN                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Referred Debit                                                                     AR949206
      *                                                                                     AR949206
     C                     TESTB'0'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN50                                             AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0018' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTWARN                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
     C                     END                             E003
     C                     END                             E002           S01194
     C*
     C**   TRANSFER AMOUNT MUST BE ENTERED
     C           SAMNT     COMP *BLANKS                  52
     C           *IN52     IFEQ '1'                        B002
     C*********************MOVE ' 152'    ERCD,X                          S01117
     C                     MOVE ' 018'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     ELSE                            X002
     C*
     C**     MUST BE NON-ZERO AND VALID FOR CURRENCY TYPE
     C*
     C*********************Z-ADDCDP       ZADEC                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C***********13********SUB  CDP       ZADIG                           S01194
     C           13        SUB  A6NBDP    ZADIG                           S01194
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SAMNT     ZFIELD
     C*
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '1'                        B003
     C                     MOVE '0'       *IN99
     C                     MOVE '1'       *IN53
     C*********************MOVE ' 153'    ERCD,X                          S01117
     C                     MOVE ' 019'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E003
     C*
     C**     TRANSFER AMOUNT MUST BE NON-ZERO
     C*
     C           *IN53     IFEQ '0'                        B003
     C                     MOVE *BLANKS   WAMNT  130
     C                     MOVE ZFIELD    WAMNT
     C           WAMNT     IFEQ *ZEROS                     B004
     C                     MOVE '1'       *IN53
     C*********************MOVE ' 153'    ERCD,X                          S01117
     C                     MOVE ' 019'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E004
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C                     ELSE                                                               210617
     C                     MOVEL' '       FTRSND                                              210617
     C                     MOVEA' '       WRN@,1                                              210617
     C                     END                             E001
     C*
     C**   VALUE DATE MUST BE ENTERED
     C                     MOVE *BLANKS   ZDATE
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WDAYNO  50
     C           *IN99     IFEQ '1'                        B001
     C                     MOVE '0'       *IN99
     C                     MOVE '1'       *IN56
     C*********************MOVE ' 156'    ERCD,X                          S01117
     C                     MOVE ' 022'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E001
     C*
     C*****INTERMEDIARY*BANK*MUST*BE*:-*CUST NO./SHORT*NAME/SWIFT*ADDRESS S01494
     C*****IF ENTERED**************************************************   S01494
     C***********                                                         S01494
     C***********SINTB     IFNE *BLANKS                                   S01494
     C***********                                                         S01494
     C***********          MOVE '0'       *IN42                           S01494
     C*********************                                               S01194
     C*********************MOVELSINTB     CBKEYN                          S01194
     C*********************MOVE 'A'       CBKEYA                          S01194
     C***********CBKEY*****CHAINCLINTCBF             42                   S01194
     C*********************                                               S01194
     C************IN42*****IFEQ '1'                                       S01194
     C*********************MOVELSINTB     SHORTN 10                       S01194
     C***********SHORTN****CHAINSNAMECBF             42                   S01194
     C*********************                                               S01194
     C************IN42*****IFEQ '1'                                       S01194
     C***********SINTB*****CHAINMSADRCBF             42                   S01194
     C*********************END                                            S01194
     C*********************                                               S01194
     C***********                                                  S01194 S01494
     C******Is*SINTB*a*customer*number/*customer*shortname...******S01194 S01494
     C***********                                                  S01194 S01494
     C***********          CALL 'AOCUSTR0'                         S01194 S01494
     C***********          PARM *BLANKS   P@RTCD  7                S01194 S01494
     C***********          PARM '*KEY'    @OPTN   7                S01194 S01494
     C***********          PARM SINTB     KEY1   10                S01194 S01494
     C***********          PARM           KYST    7                S01194 S01494
     C***********SDCUST    PARM SDCUST    DSSDY                    S01194 S01494
     C***********                                                  S01194 S01494
     C******If*not,*then*is*SINTB*a*SWIFT*address?*****************S01194 S01494
     C***********                                                  S01194 S01494
     C***********P@RTCD    IFNE *BLANKS                            S01194 S01494
     C***********SINTB     CHAINSDCUSTL7             42            S01194 S01494
     C***********          END                                     S01194 S01494
     C***********                                                  S01194 S01494
     C************IN42     IFEQ '0'                                S01194 S01494
     C***********          MOVE BBCUST    CNUM    60               S01194 S01494
     C***********          END                                     S01194 S01494
     C***********                                                  S01194 S01494
     C*********************END                                            S01194
     C***TEST*THAT*CUSTOMER*IS*A*BANK******************************S01194 S01494
     C************IN42     IFEQ '0'                                S01194 S01494
     C*********************TESTB'0'       CMIN       42            S01194 S01494
     C***********                                                  S01194 S01494
     C***NOT*BANK                                                  S01194 S01494
     C***********BBBNBI    ANDNE'Y'                                S01194 S01494
     C***********          SETON                     42            S01194 S01494
     C***********          END                                     S01194 S01494
     C***********                                                         S01494
     C************IN42     IFEQ '1'                                       S01494
     C***********          MOVE '0'       *IN99                           S01494
     C*********************MOVE ' 411'    ERCD,X                   S01117 S01494
     C***********          MOVE ' 030'    ERCD,X                   S01117 S01494
     C***********          ADD  1         X                               S01494
     C***********          END                                            S01494
     C***********                                                         S01494
     C***********          END                                            S01494
     C*                                                                   S01494
     C** Validate intermediary bank if not blank                          S01494
     C*                                                                   S01494
     C                     MOVEL*BLANKS   UUINBT                          087196
     C           SINB1     IFNE *BLANK                                    S01494
     C           SINB2     ORNE *BLANK                                    S01494
     C           SINB3     ORNE *BLANK                                    S01494
     C           SINB4     ORNE *BLANK                                    S01494
     C           SINB5     ORNE *BLANK                                    S01494
     C                     EXSR SRINBK                                    S01494
     C                     END                                            S01494
     C*
     C**   ACCOUNT WITH BANK MUST BE ENTERED
     C           SACBN     COMP *BLANKS                  58
     C           *IN58     IFEQ '1'                        B001
     C*********************MOVE ' 158'    ERCD,X                          S01117
     C                     MOVE ' 023'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E001
     C**     IF ENTERED MUST NOT EQUAL DESTINATION
     C           *IN58     IFEQ '0'                        B001
     C           SACBN     COMP SDEST                    59
     C           *IN59     IFEQ '1'                        B002
     C*********************MOVE ' 336'    ERCD,X                          S01117
     C                     MOVE ' 025'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E002
     C*
     C                     END                             E001
     C**     IF ENTERED AND NOT EQUAL DESTINATION ,
     C**       MUST BE A VALID NOSTRO WITH CURRENCY ENTERED
     C           *IN58     IFEQ '0'                        B001
     C           *IN59     ANDEQ'0'
     C           *IN55     ANDEQ'0'
     C                     MOVE SCCY      NRCCY
     C                     MOVE SACBN     NRNOSN
     C                     MOVE *BLANKS   ERROR                           S01117
     C                     EXSR NOSCHN                     CHN FAIL-70
     C*
     C           *IN70     IFEQ '1'                        B002
     C                     MOVE '1'       *IN59
     C*********************MOVE ' 159'    ERCD,X                          S01117
     C                     MOVE ' 024'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     ELSE                            X002
     C*
     C**  ACCESS FULL ACCOUNT DETAILS FOR LATER VALIDATION
     C*
     C                     MOVE SCCY      MCCY
     C           ACCKEY    CHAINACCNTABF             99
     C  N99      RECI      COMP 'D'                  9999                 047179
     C           *IN99     IFEQ '1'                        B003
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'ACCNT'   DBFILE           ***************
     C                     MOVE '04'      DBASE            * DB ERROR 04 *
     C                     MOVELACKYDS    DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     ELSE                            X003
     C                     MOVE ACST      ACST1   1                       047179
     C                     Z-ADDDACO      DACOA   50
     C                     MOVE ATYP      ATYPA   1
     C                     MOVELACPRFC    PRFCA   4                       179732
     C/COPY WNCPYSRC,FTH00581
     C                     BITOF'01234567'WRETB                                             AR949206
     C                     MOVE ACRETB    WRETB                                             AR949206
      *                                                                                     AR949206
      ** Check Status of Account                                                            AR949206
      **                                                                                    AR949206
      ** Blocked Credit                                                                     AR949206
      *                                                                                     AR949206
     C                     TESTB'3'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN58                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0019' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Bankrupt/Liquidated                                                                AR949206
      *                                                                                     AR949206
     C                     TESTB'6'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN58                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0015' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Bad Debt                                                                           AR949206
      *                                                                                     AR949206
     C                     TESTB'7'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN58                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0016' FTMSID                                            AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     MOVE 'Y'       FTNOUP                                            AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Inactive                                                                           AR949206
      *                                                                                     AR949206
     C                     TESTB'4'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN58                                             AR949206
     C                     MOVEL'Y'       FTMSGS                                            AR949206
     C                     MOVEL*BLANKS   FTMSDT                                            AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0017' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTWAR                                             AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
      *                                                                                     AR949206
      ** Referred Credit                                                                    AR949206
      *                                                                                     AR949206
     C                     TESTB'1'       WRETB          97                                 AR949206
     C           *IN97     IFEQ '1'                                                         AR949206
     C                     MOVE '1'       *IN58                                             AR949206
     C                     MOVEL##PGM     FTPGMQ                                            AR949206
     C                     MOVEL'FTM0020' FTMSID                                            AR949206
     C                     MOVE 'Y'       FTWAR                                             AR949206
     C                     EXSR FTSNMS                                                      AR949206
     C                     ENDIF                                                            AR949206
     C                     END                             E003
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C**  IF VALUE DATE AND CURRENCY ARE VALID
     C*
     C           *IN54     IFEQ '0'                        B001
     C           *IN55     ANDEQ'0'
     C           *IN56     ANDEQ'0'
     C           *IN57     ANDEQ'0'
     C*
     C**  DESTINATION
      *                                                                   047179
      *  Check if value date is in the future and if the account is       047179
      *  closing today                                                    047179
      *                                                                   047179
     C           *IN50     IFEQ '0'                        B002           047179
     C           *IN51     ANDEQ'0'                                       047179
      *                                                                   047179
     C           WDAYNO    IFGT BJRDNB                                    047179
     C           ACST2     ANDEQ'C'                                       047179
     C                     MOVE ' 601'    ERCD,X                          047179
     C                     ADD  1         X                               047179
     C                     SETON                     3328                 047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
      *                                                                   047179
     C**  IF VALID SO FAR, FOR RETAIL ACCOUNTS ONLY CHECK THAT THE VALUE
     C**    DATE IS NOT BEFORE THE BACKVALUE LIMIT DATE NOR BEFORE THE
     C**    DATE THE ACCOUNT WAS OPENED
     C*
     C           *IN50     IFEQ '0'                        B002
     C           *IN51     ANDEQ'0'
     C           ATYPD     ANDEQ'R'
     C*
     C           WDAYNO    IFLT BVLD                       B003
     C*********************MOVE ' 359'    ERCD,X                          S01117
     C                     MOVE ' 016'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     SETON                     3328
     C                     ELSE                            X003
     C           WDAYNO    IFLT DACOD                      B004
     C*********************MOVE ' 345'    ERCD,X                          S01117
     C                     MOVE ' 015'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     SETON                     3328
     C                     END                             E004
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C**  ACCOUNT WITH BANK
      *                                                                   047179
      *  Check if value date is in the future and if the account is       047179
      *  closing today                                                    047179
      *                                                                   047179
     C           *IN58     IFEQ '0'                        B002           047179
     C           *IN59     ANDEQ'0'                                       047179
      *                                                                   047179
     C           WDAYNO    IFGT BJRDNB                                    047179
     C           ACST1     ANDEQ'C'                                       047179
     C                     MOVE ' 602'    ERCD,X                          047179
     C                     ADD  1         X                               047179
     C                     SETON                     37                   047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
      *                                                                   047179
     C**  IF VALID SO FAR, FOR RETAIL ACCOUNTS ONLY CHECK THAT THE VALUE
     C**    DATE IS NOT BEFORE THE BACKVALUE LIMIT DATE NOR BEFORE THE
     C**    DATE THE ACCOUNT WAS OPENED
     C*
     C           *IN58     IFEQ '0'                        B002
     C           *IN59     ANDEQ'0'
     C           ATYPA     ANDEQ'R'
     C*
     C           WDAYNO    IFLT BVLD                       B003
     C*********************MOVE ' 365'    ERCD,X                          S01117
     C                     MOVE ' 027'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     SETON                     37
     C                     ELSE                            X003
     C           WDAYNO    IFLT DACOD                      B004
     C*********************MOVE ' 350'    ERCD,X                          S01117
     C                     MOVE ' 026'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     SETON                     37
     C                     END                             E004
     C                     END                             E003
     C*
     C                     END                             E002
      *                                                                                       210617
      ** Display warning as long as there are invalid fields                                  210617
      *                                                                                       210617
     C           *LIKE     DEFN SDTA1     WDTA1                                               210617
     C           *LIKE     DEFN SDTA2     WDTA2                                               210617
     C           *LIKE     DEFN SERCD1    WERCD                                               210617
     C           *IN54     IFEQ '0'                                                           210617
     C           *IN55     ANDEQ'0'                                                           210617
     C           *IN56     ANDEQ'0'                                                           210617
     C           *IN57     ANDEQ'0'                                                           210617
     C           *IN58     ANDEQ'0'                                                           210617
     C           *IN59     ANDEQ'0'                                                           210617
      *                                                                                       210617
      ** Check if value date is holiday in the local CCY (SCCY+SACBN)                         210617
      *                                                                                       210617
     C                     MOVE SCCY      ZCCY                                                210617
     C**********           MOVE NOSLOC    ZLOC                                         210617 217782
     C                     MOVELNOSLOC    ZLOC                                                217782
     C                     EXSR ZCHKH                                                         210617
     C           ZIND      IFEQ 'H'                                                           217782
     C                     MOVEL'H'       ZIND1   1                                           217782
     C                     MOVE '1'       *IN37                                               217782
     C                     ELSE                                                               217782
     C                     MOVE *BLANKS   ZIND1                                               217782
     C                     ENDIF                                                              217782
      *                                                                                       217782
      ** Check if value date is holiday in the local CCY (SCCY+SDEST)                         217782
      *                                                                                       217782
     C                     MOVE SCCY      ZCCY                                                217782
     C                     MOVELNOSLO1    ZLOC                                                217782
     C                     EXSR ZCHKH                                                         217782
     C           ZIND      IFEQ 'H'                                                           217782
     C                     MOVEL'H'       ZIND2   1                                           217782
     C                     MOVE '1'       *IN33                                               217782
     C                     ELSE                                                               217782
     C                     MOVE *BLANKS   ZIND2                                               217782
     C                     ENDIF                                                              217782
      *                                                                                       217782
      ** If the FROM or TO nostro falls on a holiday then display                             217782
      ** warning message                                                                      217782
      *                                                                                       217782
     C           ZIND1     IFEQ 'H'                                                           217782
     C           ZIND2     OREQ 'H'                                                           217782
     C                     MOVEL'H'       ZIND                                                217782
     C                     ENDIF                                                              217782
      *                                                                                       210617
      ** if ZIND = 'H', then the date is a holiday                                            210617
      *                                                                                       210617
     C           ZIND      IFEQ 'H'                                                           210617
     C                     MOVELWTXT,1    SERCD2                                              210617
     C                     MOVEAERCD      WERCD                                               210617
     C                     MOVE '1'       *IN36                                               210617
     C                     MOVE '1'       *IN29                                               210617
      *                                                                                       210617
     C           WERCD     IFNE *BLANKS                                                       210617
     C                     MOVEL'Y'       FTNOUP                                              210617
     C                     MOVEL' '       FTRSND                                              210617
     C                     MOVEA' '       WRN@,1                                              210617
     C                     ENDIF                                                              210617
     C           WERCD     IFEQ *BLANKS                                                       210617
     C           SDTA1     IFNE WDTA1                                                         210617
     C           SDTA2     ORNE WDTA2                                                         210617
     C                     MOVE SDTA1     WDTA1                                               210617
     C                     MOVE SDTA2     WDTA2                                               210617
     C                     MOVEA'Y'       WRN@,1                                              210617
     C                     MOVE 'Y'       FTWARN                                              210617
     C                     MOVE *BLANKS   FTRSND                                              210617
     C           WRN@,1    IFEQ ' '                                                           210617
     C                     MOVE *BLANKS   FTRSND                                              210617
     C                     MOVE 'Y'       WRN@,1                                              210617
     C                     ENDIF                                                              210617
     C                     ELSE                                                               210617
     C           WRN@,1    IFEQ ' '                                                           210617
     C                     MOVE 'Y'       FTWARN                                              210617
     C                     MOVE *BLANKS   FTRSND                                              210617
     C                     MOVEA'Y'       WRN@,1                                              210617
     C                     ENDIF                                                              210617
     C                     ENDIF                                                              210617
     C                     ENDIF                                                              210617
      *                                                                                       210617
     C                     ELSE                                                               210617
     C                     MOVE '0'       *IN36                                               210617
     C                     MOVE '0'       *IN29                                               210617
     C                     ENDIF                                                              210617
      *                                                                                       210617
     C                     ELSE                                                               210617
     C                     MOVE '0'       *IN36                                               210617
     C                     MOVE '0'       *IN29                                               210617
     C                     MOVEL*BLANKS   SERCD2                                              210617
     C                     MOVEL*BLANKS   FTRSND                                              210617
     C                     MOVEA' '       WRN@,1                                              210617
     C                     MOVE *BLANKS   FTWARN                                              210617
     C                     ENDIF                                                              210617
     C*
     C                     END                             E001
     C*
     C*****SWIFT*PRIORITY*CODE*IF*ENTERED*MUST*BE*'01','02','11'OR*'12'*  S01117
     C**   SWIFT PRIORITY CODE IF ENTERED MUST BE 'U' OR 'N'              S01117
     C           SSWPC     IFNE *BLANKS                    B001
     C***********SSWPC*****ANDNE'01'                                      S01117
     C***********SSWPC*****ANDNE'02'                                      S01117
     C***********SSWPC*****ANDNE'11'                                      S01117
     C***********SSWPC*****ANDNE'12'                                      S01117
     C           SSWPC     ANDNE'U'                        B001           S01117
     C           SSWPC     ANDNE'N'                                       S01117
     C                     MOVE '1'       *IN60
     C*********************MOVE ' 160'    ERCD,X                          S01117
     C                     MOVE ' 028'    ERCD,X                          S01117
     C                     ADD  1         X
     C                     END                             E001
     C*
     C**VALIDATE SPECIAL INSTRUCTIONS FIELD                               S01412
     C**                                                                  S01412
     C           SBBI      IFNE *BLANKS                                   S01412
     C                     MOVEA*BLANKS   SIL                             S01412
     C                     MOVE SBBI1     SIL,1                           S01412
     C                     MOVE SBBI2     SIL,2                           S01412
     C                     MOVE SBBI3     SIL,3                           S01412
     C                     MOVE SBBI4     SIL,4                           S01412
     C                     EXSR SEPTVM                                    S01412
     C           CULTST    IFNE *BLANKS                                   S01412
     C                     SETON                     7728                 S01412
     C           CUL,1     IFEQ 'E'                                       S01412
     C                     MOVE ' 253'    ERCD,X                          S01412
     C                     ADD  1         X                               S01412
     C                     END                                            S01412
     C           CUL,2     IFEQ 'E'                                       S01412
     C                     MOVE ' 254'    ERCD,X                          S01412
     C                     ADD  1         X                               S01412
     C                     END                                            S01412
     C           CUL,3     IFEQ 'E'                                       S01412
     C                     MOVE ' 255'    ERCD,X                          S01412
     C                     ADD  1         X                               S01412
     C                     END                                            S01412
     C           CUL,4     IFEQ 'E'                                       S01412
     C                     MOVE ' 256'    ERCD,X                          S01412
     C                     ADD  1         X                               S01412
     C                     END                                            S01412
     C                     END                                            S01412
     C*                                                                   092396
     C** '//' FOLLOWED BY *BLANKS IS NOT ALLOWED ANYMORE IN LINE 2,3 & 4  092396
     C*                                                                   092396
     C                     MOVELSBBI2     W2RK2   2                       092396
     C                     MOVE SBBI2     W2RK33 33                       092396
     C                     MOVELSBBI3     W3RK2   2                       092396
     C                     MOVE SBBI3     W3RK33 33                       092396
     C                     MOVELSBBI4     W4RK2   2                       092396
     C                     MOVE SBBI4     W4RK33 33                       092396
     C*                                                                   092396
     C                     MOVE 'N'       SW95ER  1                       092396
     C*                                                                   092396
     C** CHECK LINE 2                                                     092396
     C           W2RK2     IFEQ '//'                                      092396
     C           W2RK33    ANDEQ*BLANKS                                   092396
     C                     MOVE ' 254'    ERCD,X                          092396
     C                     ADD  1         X                               092396
     C                     MOVE 'Y'       SW95ER                          092396
     C                     END                                            092396
     C*                                                                   092396
     C** CHECK LINE 3                                                     092396
     C           W3RK2     IFEQ '//'                                      092396
     C           W3RK33    ANDEQ*BLANKS                                   092396
     C                     MOVE ' 255'    ERCD,X                          092396
     C                     ADD  1         X                               092396
     C                     MOVE 'Y'       SW95ER                          092396
     C                     END                                            092396
     C*                                                                   092396
     C** CHECK LINE 4                                                     092396
     C           W4RK2     IFEQ '//'                                      092396
     C           W4RK33    ANDEQ*BLANKS                                   092396
     C                     MOVE ' 256'    ERCD,X                          092396
     C                     ADD  1         X                               092396
     C                     MOVE 'Y'       SW95ER                          092396
     C                     END                                            092396
     C*                                                                   092396
     C           SW95ER    IFEQ 'Y'                                       092396
     C                     MOVE *ON       *IN77                           092396
     C                     MOVE *ON       *IN28                           092396
     C                     END                                            092396
     C*                                                                   092396
     C                     END                                            S01412
     C*                                                                   S01412
     C*****SETTLEMENT*TYPE*MUST*BE*'01'*OR*'08'************************   S01494
     C*                                                                   S01494
     C** Settlement type must be '01', '02' or '08'                       S01494
     C*                                                                   S01494
     C           SSTMT     IFNE *BLANKS                    B001
     C           SSTMT     ANDNE'01'
     C           SSTMT     ANDNE'08'
     C           SSTMT     ANDNE'02'                                      S01494
     C                     MOVE '1'       *IN39
     C*********************MOVE ' 142'    ERCD,X                          S01117
     C                     MOVE ' 029'    ERCD,X                          S01117
     C                     ADD  1         X
     C*
     C**   IF SETTLEMENT TYPE OK SET OFF ANY OLD ERRORS
     C                     ELSE
     C                     MOVE '0'       *IN39
     C                     END                             E001
     C*
     C*    Originating Branch Processing                                  S01117
     C*                                                                   S01117
     C           *IN43     IFEQ '1'                                       S01117
     C           *IN18     ANDEQ'1'                                       S01117
     C*                                                                   S01117
     C** IF ORIGINATING BRANCH USED AND NOT ENTERED DEFAULT TO BOOKING    S01117
     C*                                                                   S01117
     C           SORBR     IFEQ *BLANKS                    B001           S01117
     C                     MOVE SBRCA     SORBR                           S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C*    VALIDATION OF ORIGINATING BRANCH                               S01117
     C*                                                                   S01117
     C           SBRCA     IFNE SORBR                                     S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7                       S01117
     C                     PARM '*KEY'    @OPTN   7                       S01117
     C                     PARM SORBR     P@BRCD  3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           P@RTCD    IFNE *BLANKS                    B001           S01117
     C                     SETON                     17    (error)        S01117
     C                     MOVEA' 010'    ERCD,X                          S01117
     C                     ADD  1         X                               S01117
     C                     END                             E001           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*    CHECK AUTHORITY TO ORIGINATING BRANCH IF REQUIRED              S01117
     C*    ,ORIGINATING BRANCH VALID AND NOT ENQUIRY                      S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                        Val. needed    S01117
     C           SACTCD    ANDNE'E'                        Not Enquiry    S01117
     C           *IN17     ANDNE'1'                        VALID BRANCH   S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM SORBR     ZOBRX   3                       S01117
     C                     PARM           ERR     10                      S01117
     C*                                                                   S01117
     C           ERR       IFNE 0                                         S01117
     C           ERR       IFEQ 1                                         S01117
     C                     MOVEA' 305'    ERCD,X                          S01117
     C                     ADD  1         X                               S01117
     C                     SETON                     17                   S01117
     C                     ELSE                                           S01117
     C                     MOVEA' 306'    ERCD,X                          S01117
     C                     ADD  1         X                               S01117
     C                     SETON                     17                   S01117
     C                     END                                            S01117
     C                     SETON                     17                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01414
      *  Validate the Book Code. If field returns in error seton          S01414
      *  general error indicator.                                         S01414
      *                                                                   S01414
     C                     EXSR SRBOOK                                    S01414
      *                                                                   S01414
      *  Validate the Profit Centre if Used. If field returns in error    S01414
      *  seton general error indicator.                                   S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
     C                     EXSR SRPRFC                                    S01414
     C                     END                                            S01414
     C*
     C**   SET ERROR INDICATORS FOR SCREEN -
     C*
     C**       ERROR INDICATORS FOR 'SPYTP', 'SPYST' DESTINATION AND A/C
     C**       WITH BANK MAY ALREADY BE SET ON.
     C*
     C**     DESTINATION IN ERROR
     C           *IN50     IFEQ '1'                        B001
     C           *IN51     OREQ '1'
     C                     MOVE '1'       *IN33
     C                     END                             E001
     C*
     C**     TRANSFER AMOUNT IN ERROR
     C           *IN52     IFEQ '1'                        B001
     C           *IN53     OREQ '1'
     C                     MOVE '1'       *IN34
     C                     END                             E001
     C*
     C**     CURRENCY IN ERROR
     C           *IN54     IFEQ '1'                        B001
     C           *IN55     OREQ '1'
     C                     MOVE '1'       *IN35
     C                     END                             E001
     C*
     C**     VALUE DATE IN ERROR
     C           *IN56     IFEQ '1'                        B001
     C           *IN57     OREQ '1'
     C                     MOVE '1'       *IN36
     C                     END                             E001
     C*
     C**     A/C WITH BANK NOSTRO IN ERROR
     C           *IN58     IFEQ '1'                        B001
     C           *IN59     OREQ '1'
     C                     MOVE '1'       *IN37
     C                     END                             E001
     C*
     C**     SWIFT PRIORITY CODE IN ERROR
     C           *IN60     IFEQ '1'                        B001
     C                     MOVE '1'       *IN38
     C                     END                             E001
     C           END       TAG                                            S01194
     C/COPY WNCPYSRC,FTH00582
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT                                                              S01494
     C*****************************************************************   S01494
     C*                                                                   S01494
     C** SRINBK - SUBROUTINE TO VALIDATE INTERMEDIARY BANK                S01494
     C*                                                                   S01494
     C           SRINBK    BEGSR                                          S01494
     C*                                                                   S01494
     C** Set up subroutine stack name                                     S01494
     C*                                                                   S01494
     C                     ADD  1         Q                               S01494
     C                     MOVEL'SRINBK'  @STK,Q                          S01494
     C           *LIKE     DEFN ##PGM     E#CPGM                          S01494
     C           *LIKE     DEFN FTMSGS    E#MSGS                          S01494
     C*                                                                   S01494
     C** /COPY Statement                                                  S01494
     C*                                                                   S01494
     C/COPY WNCPYSRC,FT0100CCPG                                           S01494
     C*                                                                   S01494
     C** Save indicators *IN31 and IN32                                   S01494
     C*                                                                   S01494
     C                     MOVEA*IN,31    ##002   2                       S01494
     C*                                                                   S01494
     C** Intermediary Bank is optional                                    S01494
     C*                                                                   S01494
     C           *LIKE     DEFN NTINBT    UUINBT                          S01494
     C                     MOVEL*BLANKS   UUINBT                          S01494
     C*                                                                   S01494
     C** Set up ADDRSS                                                    S01494
     C*                                                                   S01494
     C                     MOVEL*BLANKS   ADDRSS                          S01494
     C                     MOVELSINB1     ADCHK1                          S01494
     C                     MOVELSINB2     ADCHK2                          S01494
     C                     MOVELSINB3     ADCHK3                          S01494
     C                     MOVELSINB4     ADCHK4                          S01494
     C                     MOVELSINB5     ADCHK5                          S01494
     C*                                                                   S01494
     C           ADDRSS    IFEQ *BLANKS                                   S01494
     C                     GOTO EXINBK                                    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** ? not allowed                                                    S01494
     C*                                                                   S01494
     C           '?'       SCAN SINB1     Y#      50     90               S01494
     C*                                                                   S01494
     C           *IN90     IFEQ '1'                                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVEL*BLANKS   FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2183' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     MOVEL'Y'       FTNOUP  1                       S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     GOTO EXINBK                                    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** If first ten characters used then try to find via SDCUSTPD       S01494
     C*                                                                   S01494
     C           ADCH26    IFEQ *BLANKS                                   S01494
     C           ADEXCS    ANDEQ*BLANKS                                   S01494
     C           ADSLSH    ANDNE'/'                                       S01494
     C           ADCH36    OREQ *BLANKS                                   S01494
     C           ADXCS2    ANDEQ*BLANKS                                   S01494
     C           ADCHK2    ANDNE*BLANKS                                   S01494
     C           ADSLSH    ANDEQ'/'                                       S01494
     C           ADSLS2    ANDNE'/'                                       S01494
     C*                                                                   S01494
     C** First 10 characters should be key for SDCUST                     S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVELADCHK1    @CNUM                           S01494
     C                     ELSE                                           S01494
     C                     MOVELADCHK2    @CNUM                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Call to access pgm for Customer details                          S01494
      *                                                                   S01494
     C                     CALL 'AOCUSTR0'             9090               S01494
     C                     PARM *BLANKS   @RTCDE  7                       S01494
     C                     PARM '*KEY   ' @OPTN   7                       S01494
     C                     PARM           @CNUM  10                       S01494
     C                     PARM *BLANKS   @KYST   7                       S01494
     C           SDCUST    PARM *BLANKS   DSSDY                           S01494
     C*                                                                   S01494
     C           *IN90     IFEQ '1'                                       S01494
     C                     MOVEL'AOCUSTR0'W0FILE           ************   S01494
     C                     MOVEL'*CALL'   W0KEY            * DBERR 30 *   S01494
     C                     Z-ADD30        W0ERNB           ************   S01494
     C                     EXSR SRERR                                     S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           @RTCDE    IFEQ *BLANKS                                   S01494
     C*                                                                   S01494
     C** Check that customer is a bank                                    S01494
     C*                                                                   S01494
     C           BBBNBI    IFNE 'Y'                                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVEL*BLANKS   FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2522' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     ELSE                                           S01494
     C                     MOVEL'1'       *IN46                           S01494
     C                     END                                            S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     GOTO EXINBK                                    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C* Overwrite shortname                                               S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVEL*BLANKS   SINB1                           S01494
     C                     MOVELBBCUST    SINB1                           S01494
     C                     ELSE                                           S01494
     C                     MOVEL*BLANKS   SINB2                           S01494
     C                     MOVELBBCUST    SINB2                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVEL'C'       UUINBT                          S01494
     C*                                                                   S01494
     C** Valid information exit                                           S01494
     C*                                                                   S01494
     C                     GOTO EXINBK                                    S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** If only 1st line entered then SWIFT Address assumed              S01494
     C** Or first is '/' and second is SWIFT Address                      S01494
     C*                                                                   S01494
     C** If field does not begin with '/' and is not longer than 11       S01494
     C** characters, validate as a S.W.I.F.T. Address                     S01494
     C*                                                                   S01494
     C           ADCH26    IFEQ *BLANKS                                   S01494
     C           ADEXSW    ANDEQ*BLANKS                                   S01494
     C           ADSLSH    ANDNE'/'                                       S01494
     C           ADCH36    OREQ *BLANKS                                   S01494
     C           ADEXS2    ANDEQ*BLANKS                                   S01494
     C           ADSLSH    ANDEQ'/'                                       S01494
     C           ADSLS2    ANDNE'/'                                       S01494
     C*                                                                   S01494
     C** First 11 characters should be key for CLSWT.                     S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVELADCHK1    CLSWTK                          S01494
     C                     ELSE                                           S01494
     C                     MOVELADCHK2    CLSWTK                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     EXSR SWIFT                                     S01494
     C*                                                                   S01494
     C           ##CSID    IFEQ 'Y'                                       S01494
     C           *IN31     IFEQ '1'                                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVELCLSWTK    FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2184' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C*                                                                   S01494
     C** Highlight incorrect field                                        S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     ELSE                                           S01494
     C                     MOVEL'1'       *IN46                           S01494
     C                     END                                            S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     GOTO EXINBK                                    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVEL'S'       UUINBT                          S01494
     C*                                                                   S01494
     C** No SWIFT address record.                                         S01494
     C*                                                                   S01494
     C           *IN32     IFEQ '1'                                       S01494
     C           *IN31     ANDEQ'0'                                       S01494
     C*                                                                   S01494
     C** If text changed then warning needs to be changed                 S01494
     C*                                                                   S01494
     C           CLSWTK    IFNE V#INB1                                    S01494
     C           *LIKE     DEFN NTINB1    V#INB1                          S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     MOVELCLSWTK    V#INB1                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Highlight incorrect field                                        S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     ELSE                                           S01494
     C                     MOVEL'1'       *IN46                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVEL'Y'       FTWARN  1                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVELCLSWTK    FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2185' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C*                                                                   S01494
     C           WRN@,1    IFEQ ' '                                       S01494
     C                     MOVEL*BLANKS   FTRSND  1                       S01494
     C                     MOVEA'Y'       WRN@,1                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     ELSE                                           S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Exit as validation complete for S.W.I.F.T.                       S01494
     C*                                                                   S01494
     C                     GOTO EXINBK                                    S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C*                                                                   S01494
     C** Invalid customer number or shortname.                            S01494
     C*                                                                   S01494
     C           ADCH26    IFEQ *BLANKS                                   S01494
     C           ADEXCS    ANDEQ*BLANKS                                   S01494
     C           ADSLSH    ANDNE'/'                                       S01494
     C           ADCH36    OREQ *BLANKS                                   S01494
     C           ADXCS2    ANDEQ*BLANKS                                   S01494
     C           ADCHK2    ANDNE*BLANKS                                   S01494
     C           ADSLSH    ANDEQ'/'                                       S01494
     C           ADSLS2    ANDNE'/'                                       S01494
     C*                                                                   S01494
     C** First 10 characters should be key for SDCUST                     S01494
     C*                                                                   S01494
     C           ADSLSH    IFNE '/'                                       S01494
     C                     MOVELADCHK1    FTMSDT                          S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     ELSE                                           S01494
     C                     MOVELADCHK2    FTMSDT                          S01494
     C                     MOVEL'1'       *IN46                           S01494
     C                     END                                            S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2186' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     MOVEA' '       WRN@,1                          S01494
     C                     GOTO EXINBK                                    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Validate as an address                                           S01494
     C*                                                                   S01494
     C                     MOVEL'Y'       ADLINE  1                       S01494
     C                     MOVEL'FTM2319' ADFLDM                          S01494
     C                     MOVEL'FTUSRMSG'ADFLDF                          S01494
     C                     EXSR ADCHK                                     S01494
     C*                                                                   S01494
     C** Depending on the indicators, highlight the field in error        S01494
     C*                                                                   S01494
     C           *IN91     IFEQ '1'                                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVELADCHK1    FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2187' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           *IN92     IFEQ '1'                                       S01494
     C                     MOVEL'Y'       FTMSGS                          S01494
     C                     MOVELADCHK1    FTMSDT                          S01494
     C                     MOVEL##PGM     FTPGMQ                          S01494
     C                     MOVEL'FTM2188' FTMSID                          S01494
     C                     EXSR FTSNMS                                    S01494
     C                     MOVEA'11111'   *IN,45                          S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Illegal Characters found                                         S01494
     C*                                                                   S01494
     C           *IN93     IFEQ '1'                                       S01494
     C                     MOVEL'Y'       FTNOUP                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           AD#1      IFEQ 'Y'                                       S01494
     C                     MOVEL'1'       *IN45                           S01494
     C                     END                                            S01494
     C           AD#2      IFEQ 'Y'                                       S01494
     C                     MOVEL'1'       *IN46                           S01494
     C                     END                                            S01494
     C           AD#3      IFEQ 'Y'                                       S01494
     C                     MOVEL'1'       *IN47                           S01494
     C                     END                                            S01494
     C           AD#4      IFEQ 'Y'                                       S01494
     C                     MOVEL'1'       *IN48                           S01494
     C                     END                                            S01494
     C           AD#5      IFEQ 'Y'                                       S01494
     C                     MOVEL'1'       *IN49                           S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           *IN45     IFEQ '0'                                       S01494
     C           *IN46     ANDEQ'0'                                       S01494
     C           *IN47     ANDEQ'0'                                       S01494
     C           *IN48     ANDEQ'0'                                       S01494
     C           *IN49     ANDEQ'0'                                       S01494
     C                     MOVEL'A'       UUINBT                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** Unwind subroutine stack name                                     S01494
     C*                                                                   S01494
     C           EXINBK    TAG                                            S01494
     C                     MOVEA*BLANKS   @STK,Q                          S01494
     C                     SUB  1         Q       50                      S01494
     C*                                                                   S01494
     C** Restore indicators *IN31 and IN32                                S01494
     C*                                                                   S01494
     C                     MOVEA##002     *IN,31                          S01494
     C*                                                                   S01494
     CSR                   ENDSR                                          S01494
     C/EJECT
     C********************************************************************
     C*
     C** INSERT SR.TO INSERT A RECORD TO NTRAN FILE
     C*
     C           INSERT    BEGSR
      *                                                                                       CSD015
      ** Check if Watch List Checking Engine needs to be called                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH   1                                           CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'INSERT'  @STK,Q                          056031
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
     C*
     C                     EXSR SETUP
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE 'I'       CHTP
     C                     MOVE TIME      LCHT
     C*********************MOVE RUND      LCD                             S01194
     C                     MOVE BJRDNB    LCD                             S01194
     C*********************MOVE RUND      OEDT                            S01194
     C                     MOVE BJRDNB    OEDT                            S01194
     C                     MOVE OEDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     OEDTD1
     C                     MOVE OEDTD1    WDATE1  60
     C                     EXSR DAFDT
     C                     MOVE WDATE2    OEDTD2
     C                     MOVE WDATE3    OEDTD3
     C**
     C*  SET ALL FIELDS NOT MAINTAINED BY THIS PROGRAM TO BLANK
     C**
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C                     MOVE *BLANKS   IACG
     C                     MOVE *BLANKS   VACG
     C                     MOVE *BLANKS   MSG
     C*********************MOVE *BLANKS   MT100                           E32481
     C*********************MOVE *BLANKS   MT202                           E32481
     C*********************MOVE *BLANKS   MT400                           E32481
     C                     MOVE *BLANKS   MT200
     C                     MOVE *BLANKS   TXIN
     C                     MOVE *BLANKS   BAIN
     C                     MOVE *BLANKS   ISIN
     C                     MOVE *BLANKS   MPYI
     C                     MOVE *BLANKS   PRIN                            054663
     C                     MOVE *BLANKS   MT210                           054663
     C/COPY WNCPYSRC,FT0100C003
     C*
     C**     OBTAIN THE NEXT TRANSFER REF. SEQ. NUMBER
     C*
     C           *NAMVAR   DEFN NTRANDA   NTFRFD
     C           *LOCK     IN   NTFRFD
     C                     Z-ADDNTFRF     WTFRF   40
     C                     ADD  1         NTFRF
     C                     OUT  NTFRFD
     C*
     C**     SET UP THE NEW TRANSFER REFERENCE
     C*
     C                     MOVEL*BLANKS   TFRF
     C                     MOVEL'P'       WKTFRF  7
     C                     MOVE OEDTD3    WKTFRF
     C                     MOVELWKTFRF    TFRF
     C                     MOVEL'NT'      WKFLD4  4
     C                     MOVE STMT      WKFLD4  4
     C                     MOVE WKFLD4    WKFLD8  8
     C                     MOVELWTFRF     WKFLD8
     C                     MOVE WKFLD8    TFRF
     C/COPY WNCPYSRC,FT0100C004
     C*
     C* HOLD INPUT USER FOR LATER AUTHORITY CHECK
     C*
     C                     MOVE USRID     INUSR1
     C*
      ** Call Watch List Checking Engine program                                              CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     WRITENTRANDDF               80
     C*
     C           *IN80     IFEQ '1'                        B001
     C                     ROLBK
     C*********************MOVE '068 '    ERCD,1                          S01117
     C                     MOVE '001 '    ERCD,1                          S01117
     C                     GOTO FINSR
     C                     END                             E001
      *                                                                   042167
      * Call CL program to allocate this reference to a dataarea          042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE TFRF      @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
      *                                                                   056031
      *  Process shadow post                                              056031
      *                                                                   056031
     C                     Z-ADDAMNT      ##AMNT                          056031
     C                     EXSR SRADD                                     056031
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C*
     C**     UPDATE NTRAN FILE TRAILER
     C*
     C                     EXSR UTRLR
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C*******IF*RETAIL MODULE PRESENT UPDATE MEMOS FILE                   056031
     C************                                                        056031
     C************IN66     IFEQ '1'                        B001           056031
     C************         MOVE CCY       MCCY    3                       056031
     C************         MOVE DEST      MDEST   20                      056031
     C************         MOVE ACBN      MACBN   20                      056031
     C************         MOVE WAMNT     MAMNT  130                      056031
     C************         Z-ADDVDAT      MVDAT   50                      056031
     C************                                                        056031
     C************         EXSR UMEMOS                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******IF*DEALING MODULE PRESENT UPDATE PRONO FILE                  056031
     C************                                                        056031
     C************IN65     IFEQ '1'                        B001           056031
     C************         MOVE CCY       SMCY    3                       056031
     C************         MOVE DEST      PDEST   20                      056031
     C************         MOVE ACBN      PACBN   20                      056031
     C************         Z-ADDVDAT      PVDAT                           056031
     C************         MOVE WAMNT     PAMNT  130                      056031
     C************                                                        056031
     C************         EXSR UPRONO                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C*
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           FINSR     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
     C***********FINSR     ENDSR                                          056031
     C                     ENDSR                                          056031
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** AMEND SR. TO AMEND A RECORD ON NTRAN FILE
     C*
     C           AMEND     BEGSR
      *                                                                                       CSD015
      ** Check if Watch List Checking Engine program needs to be called                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WATCH                                               CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           LIBR      ANDEQS1MAIN                                                        CSD015
     C                     EXSR SRCHCK                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'AMEND '  @STK,Q                          056031
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C*
     C                     MOVE '0'       *IN71
     C           STFRF     CHAINNTRANDDF             71
     C*
     C           *IN71     IFEQ '1'                        B001
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVE '05'      DBASE            * DB ERROR 05 *
     C                     MOVELSTFRF     DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E001
     C*
     C**    MUST BE THE SAME RECORD ACCESSED FOR INITIAL SCREEN VALIDATION
     C*
     C           CHTP      IFNE WCHTP                      B001
     C           LCD       ORNE WLCD
     C           LCHT      ORNE WLCHT
     C                     ROLBK
     C*********************MOVE '068 '    ERCD,1                          S01117
     C                     MOVE '001 '    ERCD,1                          S01117
     C                     GOTO FINSR1
     C                     ELSE                            X001
     C                     Z-ADDAMNT      RAMNT  130
     C                     MOVE CCY       RCCY    3
     C                     MOVE VDAT      PVDAT   50
     C                     MOVE DEST      RDEST   20
     C                     MOVE ACBN      RACBN   20
     C**
     C*  RESET AUTH. FIELDS IN CASE OF PARTIAL AUTHORIZATION
     C**
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C*
     C                     MOVE TIME      LCHT
     C*********************MOVE RUND      LCD                             S01194
     C                     MOVE BJRDNB    LCD                             S01194
     C***********OEDT******IFNE RUND                       B002           S01194
     C           OEDT      IFNE BJRDNB                     B002           S01194
     C                     MOVE 'A'       CHTP
     C                     END                             E002
     C*
     C                     END                             E001
     C*
      *                                                                   056031
      *  Process shadow post (reverse out original entries)               056031
      *                                                                   056031
     C                     Z-SUBAMNT      ##AMNT                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVAST  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADD                                     056031
      *                                                                   056031
     C                     EXSR SETUP
     C*
     C                     MOVE '0'       *IN80
     C                     MOVE VDAT      XVDAT   50
     C                     MOVE USRID     INUSR1
      *                                                                                       CSD015
      ** Call Watch List Checking Engine program                                              CSD015
      *                                                                                       CSD015
     C           WATCH     IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     UPDATNTRANDDF               80
     C           *IN80     IFEQ '1'                        B001
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVE '06'      DBASE            * DB ERROR 06 *
     C                     MOVELSTFRF     DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E001
      *                                                                   056031
      *  Process shadow post                                              056031
      *                                                                   056031
     C                     Z-ADDAMNT      ##AMNT                          056031
     C                     EXSR SRADD                                     056031
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
      *                                                                   056031
     C*
     C**     UPDATE NTRAN FILE TRAILER
     C*
     C                     EXSR UTRLR
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C*******IF*RETAIL MODULE PRESENT UPDATE MEMOS FILE BY:               056031
     C*******REVERSING OUT OLD ENTRIES AND UPDATING WITH NEW ONES         056031
     C************                                                        056031
     C************IN66     IFEQ '1'                        B001           056031
     C************                                                        056031
     C*******REVERSE OUT ORIGINAL ENTRIES                                 056031
     C************         MOVE RCCY      MCCY                            056031
     C************         MOVE RDEST     MDEST                           056031
     C************         MOVE RACBN     MACBN                           056031
     C************         Z-SUBRAMNT     MAMNT                           056031
     C************         Z-ADDPVDAT     MVDAT                           056031
     C************                                                        056031
     C************         EXSR UMEMOS                                    056031
     C************                                                        056031
     C*******INSERT AMENDED ENTRIES                                       056031
     C************         Z-ADDWAMNT     MAMNT                           056031
     C************         MOVE SCCY      MCCY                            056031
     C************         MOVE SDEST     MDEST                           056031
     C************         MOVE SACBN     MACBN                           056031
     C************         MOVE XVDAT     MVDAT                           056031
     C************                                                        056031
     C************         EXSR UMEMOS                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C*******IF*DEALING MODULE PRESENT UPDATE PRONO FILE BY:              056031
     C*******REVERSING OUT OLD ENTRIES AND UPDATING WITH NEW ONES         056031
     C************                                                        056031
     C************IN65     IFEQ '1'                        B001           056031
     C************                                                        056031
     C*******REVERSE OUT ORIGINAL VALUES FIRST                            056031
     C************                                                        056031
     C************         MOVE RCCY      SMCY                            056031
     C************         MOVE RDEST     PDEST                           056031
     C************         MOVE RACBN     PACBN                           056031
     C************         Z-SUBRAMNT     PAMNT                           056031
     C************                                                        056031
     C************         EXSR UPRONO                                    056031
     C************                                                        056031
     C*******UPDATE WITH NEW VALUES                                       056031
     C************                                                        056031
     C************         MOVE SCCY      SMCY                            056031
     C************         MOVE SDEST     PDEST                           056031
     C************         MOVE SACBN     PACBN                           056031
     C************         Z-ADDWAMNT     PAMNT                           056031
     C************         Z-ADDVDAT      PVDAT                           056031
     C************                                                        056031
     C************         EXSR UPRONO                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C*
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           FINSR1    TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
     C***********FINSR1    ENDSR                                          056031
     C                     ENDSR                                          056031
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** DELET SR. TO DELETE A RECORD FROM NTRAN FILE
     C*
     C           DELET     BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'DELET '  @STK,Q                          056031
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C*
     C                     MOVE '0'       *IN71
     C           STFRF     CHAINNTRANDDF             71
     C           *IN71     IFEQ '1'                        B001
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVE '07'      DBASE            * DB ERROR 07 *
     C                     MOVELSTFRF     DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E001
      *                                                                   056031
      *  Process shadow post (reverse out original entries)               056031
      *                                                                   056031
     C                     Z-SUBAMNT      ##AMNT                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVAST  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADD                                     056031
      *                                                                   056031
     C*
     C**    MUST BE THE SAME RECORD ACCESSED FOR INITIAL SCREEN VALIDATION
     C*
     C           CHTP      IFNE WCHTP                      B001
     C           LCD       ORNE WLCD
     C           LCHT      ORNE WLCHT
     C                     ROLBK
     C*********************MOVE '068 '    ERCD,1                          S01117
     C                     MOVE '001 '    ERCD,1                          S01117
     C                     GOTO FINSR4
     C                     ELSE                            X001
     C                     MOVE 'C'       RECI
     C                     MOVE TIME      LCHT
     C*********************MOVE RUND      LCD                             S01194
     C                     MOVE BJRDNB    LCD                             S01194
     C                     MOVE 'D'       CHTP
     C                     Z-ADDVDAT      PVDAT
     C                     MOVE DEST      RDEST
     C                     MOVE ACBN      RACBN
     C                     MOVE CCY       RCCY
     C*
     C                     MOVE '0'       *IN80
     C                     MOVE USRID     INUSR1
     C                     UPDATNTRANDDF               80
     C           *IN80     IFEQ '1'                        B002
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVE '08'      DBASE            * DB ERROR 08 *
     C                     MOVELSTFRF     DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E002
     C*
     C                     END                             E001
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
      *                                                                   056031
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C*******IF*RETAIL MODULE - REVERSE OUT ENTRIES FROM MEMOS            056031
     C************IN66     IFEQ '1'                        B001           056031
     C************         MOVE RCCY      MCCY                            056031
     C************         MOVE RDEST     MDEST                           056031
     C************         MOVE RACBN     MACBN                           056031
     C************         Z-SUBAMNT      MAMNT                           056031
     C************         Z-ADDVDAT      MVDAT                           056031
     C************                                                        056031
     C************         EXSR UMEMOS                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******IF*DEALING MODULE - REVERSE OUT ENTRIES FROM PRONOPN         056031
     C************IN65     IFEQ '1'                        B001           056031
     C************         MOVE RCCY      SMCY                            056031
     C************         MOVE RDEST     PDEST                           056031
     C************         MOVE RACBN     PACBN                           056031
     C************         Z-SUBAMNT      PAMNT                           056031
     C************                                                        056031
     C************         EXSR UPRONO                                    056031
     C************                                                        056031
     C************         END                             E001           056031
     C*
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           FINSR4    TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
     C***********FINSR4    ENDSR                                          056031
     C                     ENDSR                                          056031
     C*
     C********************************************************************
     C/COPY WNCPYSRC,FT0100C005
     C/EJECT                                                              S01494
     C/COPY FTCPYSRC,SFTADDRC                                             S01494
     C/COPY FTCPYSRC,SFTADDRSC                                            S01494
     C/COPY FTCPYSRC,SFTSNMSC                                             S01494
     C/COPY FTCPYSRC,SFTSWFTC                                             S01494
    C/EJECT                                                              S01412
     C*****************************************************************   S01412
     C**  SEPTVM - Validate fields for field 72                       *   S01412
     C**  Called by - INITSC - SR to validate initial screen entries  *   S01412
     C**                                                              *   S01412
     C**  Inputs    - SIL    - the field to be validated              *   S01412
     C**  Output    - CUL    - the field was invalid                  *   S01412
     C*****************************************************************   S01412
     C*                                                                   S01412
     C           SEPTVM    BEGSR                                          S01412
     C*                                                                   S01412
     C                     MOVEA*BLANKS   CUL                             S01412
     C*                                                                   S01412
     C** Save the indicators used by this subroutine                      S01412
     C                     MOVEA*IN,88    STOAR   2                       S01412
     C*                                                                   S01412
     C*                                                                   S01412
     C** Set off indicators 88 and 89.                                    S01412
     C                     SETOF                     8889                 S01412
     C*                                                                   S01412
     C** Check through each of the 6 fields in turn.                      S01412
     C           1         DO   6         Y       20       Do1            S01412
     C                     MOVE 'F'       SSF     1                       S01412
     C*                                                                   S01412
     C                     Z-ADD1         L       30                      S01412
     C*                                                                   S01412
     C** Check for blank lines                                            S01412
     C** If the present line is blank the next line cannot be. This       S01412
     C** is checked at the end of the subroutine.                         S01412
     C           SIL,Y     IFEQ *BLANKS                    If1            S01412
     C                     MOVE '1'       *IN89                           S01412
     C                     ELSE                            Else1          S01412
     C*                                                                   S01412
     C                     MOVEASIL,Y     FIELD                           S01412
     C*                                                                   S01412
     C** First position must be a '/'                                     S01412
     C           FIELD,L   IFNE '/'                        If2            S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                             End2           S01412
     C*                                                                   S01412
     C                     Z-ADD2         L                               S01412
     C*                                                                   S01412
     C** The first special instruction line cannot have '/'               S01412
     C** in position 2                                                    S01412
     C           FIELD,L   IFEQ '/'                        If2            S01412
     C           Y         ANDEQ1                                         S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                             End2           S01412
     C*                                                                   S01412
     C** Check the line for '8a/', where 8a represents                    S01412
     C** up to eight upper case alphabetic charaters                      S01412
     C           SSF       DOUEQ'T'                        Do2            S01412
     C           L         ORGT 10                                        S01412
     C           CUL,Y     OREQ 'E'                                       S01412
     C*                                                                   S01412
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           FIELD,L   LOKUPAPN                      88                                   CSW201
     C                     ELSE                                                               CSW201
     C           FIELD,L   LOKUPUPA                      88               S01412
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           *IN88     IFNE '1'                        If2            S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                             End2           S01412
     C*                                                                   S01412
     C           FIELD,L   IFEQ '/'                        If2            S01412
     C                     MOVE 'T'       SSF                             S01412
     C                     END                             End2           S01412
     C*                                                                   S01412
     C                     ADD  1         L                               S01412
     C*                                                                   S01412
     C                     END                             Enddo2         S01412
     C*                                                                   S01412
     C** Invalid if a second slash is not found                           S01412
     C** within the first ten characters of the                           S01412
     C** field being checked                                              S01412
     C           SSF       IFEQ 'F'                        If2            S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                             End2           S01412
     C*                                                                   S01412
     C** Test the rest of the line for ISO format characters              S01412
     C           L         DOUGT35                          Do2           S01412
     C           CUL,Y     OREQ 'E'                                       S01412
     C*                                                                   S01412
     C           FIELD,L   LOKUPSWCH                     88               S01412
     C*                                                                   S01412
     C           *IN88     IFEQ '0'                         If2           S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                              End2          S01412
     C*                                                                   S01412
     C                     ADD  1         L                               S01412
     C*                                                                   S01412
     C                     END                              Enddo2        S01412
     C*                                                                   S01412
     C                     END                             End1           S01412
     C*                                                                   S01412
     C** Check if the line is NOT blank and the previous one is.          S01412
     C           *IN89     IFEQ '1'                        If1            S01412
     C           SIL,Y     ANDNE*BLANKS                                   S01412
     C                     MOVEA'E'       CUL,Y                           S01412
     C                     END                             End1           S01412
     C*                                                                   S01412
     C                     END                             Enddo1         S01412
     C*                                                                   S01412
     C**  Restore the indicators used in the subroutine                   S01412
     C                     MOVEASTOAR     *IN,88                          S01412
     C*                                                                   S01412
     C                     ENDSR                                          S01412
     C*****************************************************************   S01412
     C/EJECT                                                              S01494
     C*****************************************************************   S01494
     C*                                                               *   S01494
     C*  S/R #LADDI - DISPLAY ADDITIONAL INFO FOR ENQUIRY             *   S01494
     C*                                                               *   S01494
     C*  CALLED FROM  MAIN PROCESSING                                 *   S01494
     C*                                                               *   S01494
     C*****************************************************************   S01494
     C*                                                                   S01494
     C           #LADDI    BEGSR                                          S01494
     C*                                                                   S01494
     C** INITIALIZE SCREEN FIELDS                                         S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SUSRP1                          S01494
     C                     MOVE *BLANKS   SUSER1                          S01494
     C                     MOVE *BLANKS   SAUP1                           S01494
     C                     MOVE *BLANKS   SAUT1                           S01494
     C                     MOVE *BLANKS   SAUP2                           S01494
     C                     MOVE *BLANKS   SAUT2                           S01494
     C*                                                                   S01494
     C** RETRIEVE USER PROFILE NAME OF INPUT USER 1, AUTHORISING USER     S01494
     C** 1 AND 2.                                                         S01494
     C*                                                                   S01494
     C                     MOVELINUSR1    SUSRP1                          S01494
     C           INUSR1    IFNE *BLANKS                                   S01494
     C           INUSR1    CHAINMUSER                08                   S01494
     C           *IN08     IFEQ '1'                                       S01494
     C           *IN08     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SUSER1                          S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SUSER1                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVELAUP1      SAUP1                           S01494
     C           AUP1      IFNE *BLANKS                                   S01494
     C           AUP1      CHAINMUSER                08                   S01494
     C           *IN08     IFEQ '1'                                       S01494
     C           *IN08     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT1                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT1                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVELAUP2      SAUP2                           S01494
     C           AUP2      IFNE *BLANKS                                   S01494
     C           AUP2      CHAINMUSER                08                   S01494
     C           *IN08     IFEQ '1'                                       S01494
     C           *IN08     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT2                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT2                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** DISPLAY WINDOW.                                                  S01494
     C*                                                                   S01494
     C                     EXFMTFT0100F2                                  S01494
     C*                                                                   S01494
     C                     ENDSR                                          S01494
     C*****************************************************************   S01494
     C/EJECT
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C***UMEMOS*SR.TO UPDATE THE MEMOS FILE                               056031
     C************                                                        056031
     C***********UMEMOS    BEGSR                                          056031
     C************                                                        056031
     C************         MOVE MCCY      NRCCY                           056031
     C************         MOVE MDEST     NRNOSN                          056031
     C************         MOVEL'*DBERR ' ERROR                           S01194
     C************                                                        056031
     C************         EXSR NOSCHN                     CHN FAIL-70    056031
     C*********************                                               S01194
     C************IN70*****IFEQ '1'                        B001           S01194
     C*********************                                               S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************MOVE '09'      DBASE            * DB ERROR 09 *S01194
     C*********************MOVELNOSKEY    DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C************                                                        056031
     C************         MOVE '0'       *IN74                           056031
     C***********ACCKEY    CHAINACCNTABF             74    CHN FAIL-74    056031
     C**N74******RECI      COMP 'D'                  7474           047179056031
     C************IN74     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVELCNUM      ACKEY9  9                       056031
     C************         MOVE MCCY      ACKEY9                          056031
     C************         MOVELACOD      ACKEY6  60                      056031
     C************         MOVE ACSQ      ACKEY6                          056031
     C************         MOVELACKEY9    ACKEY  15                       056031
     C************         MOVE ACKEY6    ACKEY                           056031
     C************         MOVELACKEY     ACKEYM 18                 S01194056031
     C************         MOVE BRCA      ACKEYM                    S01194056031
     C*********************MOVELACKEY     DBKEY            *********S01194056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         MOVELACKEYM    DBKEY            *********S01194056031
     C************         MOVE '10'      DBASE            * DB ERROR 10 *056031
     C************         MOVE 'ACCNT'   DBFILE           ***************056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********ATYP      IFNE 'R'                        B001           056031
     C************         GOTO FINSR2                                    056031
     C************         ELSE                            X001           056031
     C************         MOVE '0'       *IN75                           056031
     C************                                                        056031
     C***********RRNM      CHAINMEMOSMDF             75                   056031
     C************                                                        056031
     C************IN75     IFEQ '1'                        B002           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         MOVE 'MEMOS'   DBFILE           ***************056031
     C************         MOVE '11'      DBASE            * DB ERROR 11 *056031
     C************         MOVELRRNM      DBKEY            ***************056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E002           056031
     C************                                                        056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE TIME      MTNLU                           056031
     C***********LBAL      SUB  MAMNT     LBAL                            056031
     C***********MVDAT*****IFLT DNWD                       B001     S01194056031
     C***********MVDAT     IFLT BJDNWD                     B001     S01194056031
     C***********CBAL      SUB  MAMNT     CBAL                            056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE '0'       *IN79                           056031
     C************         UPDATMEMOSMDF               79                 056031
     C************IN79     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         MOVE 'MEMOS'   DBFILE           ***************056031
     C************         MOVE '12'      DBASE            * DB ERROR 12 *056031
     C************         MOVELRRNM      DBKEY            ***************056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C************                                                        056031
     C***********FINSR2    TAG                             **FINSR2 TAG   056031
     C************                                                        056031
     C************         MOVE MACBN     NRNOSN                          056031
     C************         MOVEL'*DBERR ' ERROR                     S01194056031
     C************         EXSR NOSCHN                     CHN FAIL-70    056031
     C************                                                        056031
     C*********************                                               S01194
     C************IN70*****IFEQ '1'                        B001           S01194
     C*********************                                               S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'TABLE'   DBFILE           ***************S01194
     C*********************MOVE '13'      DBASE            * DB ERROR 13 *S01194
     C*********************MOVELNOSKEY    DBKEY            ***************S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C************                                                        056031
     C************         MOVE '0'       *IN74                           056031
     C***********ACCKEY    CHAINACCNTABF             74    CHN FAIL-74    056031
     C**N74******RECI      COMP 'D'                  7474           047179056031
     C************IN74     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVELCNUM      ACKEY9                          056031
     C************         MOVE MCCY      ACKEY9                          056031
     C************         MOVELACOD      ACKEY6                          056031
     C************         MOVE ACSQ      ACKEY6                          056031
     C************         MOVELACKEY9    ACKEY                           056031
     C************         MOVE ACKEY6    ACKEY                           056031
     C************         MOVELACKEY     ACKEYM 18                 S01194056031
     C************         MOVE BRCA      ACKEYM                    S01194056031
     C************         MOVELACKEYM    DBKEY                     S01194056031
     C************         MOVE 'ACCNT'   DBFILE           ***************056031
     C************         MOVE '14'      DBASE            * DB ERROR 14 *056031
     C************         MOVELACKEYM    DBKEY            *********S01194056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C*********************MOVELACKEY     DBKEY            ***************S01194
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********ATYP      IFNE 'R'                        B001           056031
     C************         GOTO FINSR3                                    056031
     C************         ELSE                            X001           056031
     C************         MOVE '0'       *IN75                           056031
     C************                                                        056031
     C***********RRNM      CHAINMEMOSMDF             75                   056031
     C************                                                        056031
     C************IN75     IFEQ '1'                        B002           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         MOVE 'MEMOS'   DBFILE           ***************056031
     C************         MOVE '15'      DBASE            * DB ERROR 15 *056031
     C************         MOVELRRNM      DBKEY            ***************056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E002           056031
     C************                                                        056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE TIME      MTNLU                           056031
     C***********LBAL      ADD  MAMNT     LBAL                            056031
     C***********MVDAT*****IFLT DNWD                       B001           S01194
     C***********MVDAT     IFLT BJDNWD                     B001     S01194056031
     C***********CBAL      ADD  MAMNT     CBAL                            056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE '0'       *IN79                           056031
     C************         UPDATMEMOSMDF               79                 056031
     C************IN79     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         MOVE 'MEMOS'   DBFILE           ***************056031
     C************         MOVE '16'      DBASE            * DB ERROR 16 *056031
     C************         MOVELRRNM      DBKEY            ***************056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********FINSR3    ENDSR                                          056031
     C************                                                        056031
     C********************************************************************056031
     C*/EJECT******                                                       056031
     C********************************************************************056031
     C************                                                        056031
     C***UPRONO*SR.TO UPDATE THE PRONO FILE                               056031
     C************                                                        056031
     C***********UPRONO    BEGSR                                          056031
     C************                                                        056031
     C************         MOVE SMCY      PRCCY   3                       056031
     C************         MOVE PDEST     PRNOSN  20                      056031
     C************                                                  E32536056031
     C***STORE*ORIGINAL NOSTRO NUMBER IN CASE UNALLOCATED NO. USED  E32536056031
     C************                                                  E32536056031
     C************         Z-ADDPRNOSN    NOSOR   20                E32536056031
     C************                                                        056031
     C***********PROKEY    CHAINPRONOPNF             72    CHN FAIL-72    056031
     C************                                                        056031
     C************IN72     IFEQ '1'                        B001           056031
     C************         MOVE '0'       *IN72                           056031
     C************         MOVE '00'      PRNOSN                          056031
     C***********PROKEY    CHAINPRONOPNF             72    CHN FAIL-72    056031
     C************IN72     IFEQ '1'                        B002           056031
     C************         GOTO FINSR5                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********PVDAT     IFGT PNDA,5                     B001           056031
     C************         GOTO FINSR5                                    056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******DETERMINE 1ST NOSTRO DATE TO WHICH PAYMENT IS TO BE APPLIED  056031
     C************                                                        056031
     C************         SETOF                     8788                 056031
     C************         Z-ADD1         I                               056031
     C************                                                        056031
     C***********PVDAT     LOKUPPNDA,I               87  88               056031
     C************                                                        056031
     C************IN87     IFEQ '1'                        B001           056031
     C************         SUB  1         I              88 VDAT BETWEEN  056031
     C***88*******         Z-ADD1         I                 TWO DATES     056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******SUBTRACT AMOUNT FROM ALL RELEVANT BALANCES                   056031
     C************                                                        056031
     C************         Z-ADDPNBA      PNO                             056031
     C***********I         DOUGT5                          B001           056031
     C************         SUB  PAMNT     PNBA,I                          056031
     C************         ADD  1         I                               056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE TIME      TNLU                            056031
     C************                                                        056031
     C************         MOVE '0'       *IN78                           056031
     C************         UPDATPRONOPNF               78                 056031
     C************         Z-ADDPVDAT     VUDT                            056031
     C************         Z-ADDPAMNT     MVAM                            056031
     C************                                                  E32536056031
     C***REINSTATE ORIGINAL NOSTRO NUMBER IN CASE UNALL OCATED USED E32536056031
     C************         Z-ADDNOSOR     NOSN                      E32536056031
     C************                                                  E32536056031
     C************         EXSR AMOVTS                                    056031
     C************IN78     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'UPDATE ' KEY13  13                       056031
     C************         MOVE 'FAILED'  KEY13                           056031
     C************         MOVELKEY13     DBKEY            ***************056031
     C************         MOVE '17'      DBASE            * DB ERROR 17 *056031
     C************         MOVE 'PRONO'   DBFILE           ***************056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********FINSR5    TAG                             **FINSR5 TAG** 056031
     C************                                                        056031
     C************         MOVE PACBN     PRNOSN                          056031
     C************                                                  E32536056031
     C***STORE*ORIGINAL NOSTRO NUMBER IN CASE UNALLOCATED NO. USED  E32536056031
     C************                                                  E32536056031
     C************         Z-ADDPRNOSN    NOSOR   20                E32536056031
     C************                                                        056031
     C***********PROKEY    CHAINPRONOPNF             72    CHN FAIL-72    056031
     C************                                                        056031
     C************IN72     IFEQ '1'                        B001           056031
     C************         MOVE '0'       *IN72                           056031
     C************         MOVE '00'      PRNOSN                          056031
     C***********PROKEY    CHAINPRONOPNF             72    CHNFAIL-72     056031
     C************IN72     IFEQ '1'                        B002           056031
     C************         GOTO FINSR6                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********PVDAT     IFGT PNDA,5                     B001           056031
     C************         GOTO FINSR6                                    056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******DETERMINE 1ST NOSTRO DATE TO WHICH PAYMENT IS TO BE APPLIED  056031
     C************                                                        056031
     C************         SETOF                     8788                 056031
     C************         Z-ADD1         I                               056031
     C************                                                        056031
     C***********PVDAT     LOKUPPNDA,I               87  88               056031
     C************                                                        056031
     C************IN87     IFEQ '1'                        B001           056031
     C************         SUB  1         I              88 VDAT BETWEEN  056031
     C***88*******         Z-ADD1         I                 TWO DATES     056031
     C************         END                             E001           056031
     C************                                                        056031
     C*******ADD*AMOUNT TO ALL RELEVANT BALANCES                          056031
     C************                                                        056031
     C************         Z-ADDPNBA      PNO                             056031
     C***********I         DOUGT5                          B001           056031
     C************         ADD  PAMNT     PNBA,I                          056031
     C************         ADD  1         I                               056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE TIME      TNLU                            056031
     C************                                                        056031
     C************         MOVE '0'       *IN78                           056031
     C************         UPDATPRONOPNF               78                 056031
     C************         Z-ADDPVDAT     VUDT                            056031
     C************         Z-ADDPAMNT     MVAM                            056031
     C************                                                  E32536056031
     C***REINSTATE ORIGINAL NOSTRO NUMBER IN CASE UNALL OCATED USED E32536056031
     C************         Z-ADDNOSOR     NOSN                      E32536056031
     C************                                                  E32536056031
     C************         EXSR AMOVTS                                    056031
     C************IN78     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVEL'UPDATE ' KEY13  13                       056031
     C************         MOVE 'FAILED'  KEY13                           056031
     C************         MOVELKEY13     DBKEY            ***************056031
     C************         MOVE '18'      DBASE            * DB ERROR 18 *056031
     C************         MOVE 'PRONO'   DBFILE           ***************056031
     C************         MOVEL'FT0100  'DBPGM                     E29920056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ************                                                  042167056031
      ***Allocate*dataarea to blanks                                042167056031
      ************                                                  042167056031
     C************         EXSR DALLOC                              042167056031
      ************                                                  042167056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************                                                        056031
     C***********FINSR6    ENDSR                                          056031
     C************                                                        056031
     C********************************************************************056031
     C*/EJECT******                                                       056031
     C************************************************************        056031
     C**AMOVT*SUBROUTINE - TO WRITE TO ACCOUNT MOVEMENTS FILE             056031
     C************************************************************        056031
     C************                                                        056031
     C***********AMOVTS    BEGSR                                          056031
     C************                                                        056031
     C***ACCESS*FULL A/C DETAILS                                          056031
     C************                                                        056031
     C*********************                                               S01194
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'70'      KEY                             S01194
     C*********************MOVELCCY       NOSWRK  5                       S01194
     C*********************MOVE NOSN      NOSWRK                          S01194
     C*********************MOVE NOSWRK    KEY                             S01194
     C***********KEY*******CHAINTABLETLF             68                   S01194
     C**N68******RECI******COMP 'D'                  6868                 S01194
     C*********************                                               S01194
     C************IN68*****IFEQ '1'                                       S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0100  'DBPGM                           S01194
     C*********************MOVE 'TABLETL' DBFILE           ***************S01194
     C*********************MOVE '23'      DBASE            * DB ERROR 23 *S01194
     C*********************MOVELZTABKY    DBKEY            *********** ***S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E002           S01194
     C************         MOVE NOSN      NOSNA   2                 S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM '*DBERR'  P@RTCD  7                 S01194056031
     C************         PARM '*KEY'    @OPTN   7                 S01194056031
     C************         PARM *BLANKS   P@CUST  6                 S01194056031
     C************         PARM CCY       P@CYCD  3                 S01194056031
     C************         PARM *BLANKS   P@ACCD  4                 S01194056031
     C************         PARM *BLANKS   P@ACSN  2                 S01194056031
     C************         PARM NOSNA     P@NONB  2                 S01194056031
     C************         PARM *BLANKS   P@BRCD  3                 S01194056031
     C************         PARM *BLANKS   P@CSSN 10                 S01194056031
     C************         PARM *BLANKS   P@PNOI  1                 S01194056031
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194056031
     C************                                                  S01117056031
     C************         MOVE A7ACCD    ACOD    40                S01194056031
     C************         MOVE A7ACSN    ACSQ    20                S01194056031
     C************         MOVE A7CUST    CNUM    60                S01194056031
     C************         MOVE A7BRCD    BRCA                      S01194056031
     C************                                                        056031
     C************         XFOOTPNO       TOT1   150                      056031
     C************         XFOOTPNBA      TOT2   150                      056031
     C**IF*NOSTRO*BALANCES INCREASED                                      056031
     C***********TOT1      IFLT TOT2                       B002           056031
     C************         MOVE '0'       DORC                            056031
     C************         ELSE                            X002           056031
     C**IF*NOSTRO*BALANCES DECREASED                                      056031
     C***********TOT1      IFGT TOT2                       B003           056031
     C************         MOVE '1'       DORC                            056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C************         MOVE VUDT      PTDT                            056031
     C**SETUP*VALUE DATE OF ENTRY                                         056031
     C************         MOVE CCY       ZCCY                      S01195056031
     C************         MOVE NOSLOC    ZLOC                      S01195056031
     C***********ZIND      DOUEQ'W'                                 S01195056031
     C************         MOVE PTDT      ZDAYNO                    S01195056031
     C************         EXSR ZCHKH                               S01195056031
     C***********ZIND      IFNE 'W'                                 S01195056031
     C************         SUB  1         PTDT                      S01195056031
     C************         END                                      S01195056031
     C************         END                                      S01195056031
     C*********************                                               S01195
     C************IN94*****DOUNE'1'                        B001           S01195
     C*********************SETOF                       9394               S01195
     C*********************MOVEL'22    '  ZTABKY                          S01195
     C*********************MOVELPTDT      ZWRK6   6                       S01195
     C*********************MOVE 1         ZWRK6                           S01195
     C*********************MOVE ZWRK6     ZTABKY                          S01195
     C***********ZTABKY****CHAINTABLETJF             93                   S01195
     C**N93******RECI******COMP '*'                      93               S01195
     C************IN93*****IFEQ '0'                        B002           S01195
     C*********************MOVEAHCCY      HCC                             S01195
     C***********CCY*******LOKUPHCC,1                    94               S01195
     C************IN94*****IFEQ '1'                        B003           S01195
     C*********************SUB  1         PTDT                            S01195
     C*********************END                             E003           S01195
     C*********************END                             E002           S01195
     C*********************END                             E001           S01195
     C************         Z-ADDCNUM      CUSN                            056031
     C************         MOVE CCY       CCYD                            056031
     C************         Z-ADDACOD      ACDE                            056031
     C************         Z-ADDACSQ      ASNC                            056031
     C************         MOVE PYTP      TRYP                            056031
     C************         MOVE TFRF      TNMR                            056031
     C************         MOVE TFRF      FUND                      E32880056031
     C************                                                        056031
     C**AS*DORC*CONTROLS DEBIT/CREDIT,ENTRY MUST ALWAYS BE                056031
     C**INHERENTLY POSITIVE                                               056031
     C************                                                        056031
     C***********MVAM      IFLT *ZERO                                     056031
     C************         Z-SUBMVAM      MVAM                            056031
     C************         END                                            056031
     C**WRITE*DETAILS TO FILE                                             056031
     C************         WRITERSACMTPO                                  056031
     C************         SETOF                     9394                 056031
     C************                                                        056031
     C************         ENDSR                                          056031
     C************                                                        056031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** UTRLR SR. TO UPDATE THE NTRAN FILE TRAILER AFTER A SUCCESSFUL
     C** INSERTION,AMENDMENT OR DELETION TO NTRANDD FILE
     C*
     C           UTRLR     BEGSR
     C*
     C           *IN23     IFEQ '1'                        B001
     C           *IN21     OREQ '1'
     C*
     C                     MOVE '0'       *IN76
     C           1         CHAINNTRANZZ              76
     C*
     C           *IN76     IFEQ '1'                        B002
     C           *LOCK     IN   DLDA
     C                     MOVEL'MISSING' MTKEY  15
     C                     MOVE 'TRAILER' MTKEY
     C                     MOVELMTKEY     DBKEY            ***************
     C                     MOVE '19'      DBASE            * DB ERROR 19 *
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E002
     C*
     C                     MOVE '0'       *IN83
     C                     MOVE RAMNT     ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C                     EXSR GLZSUB
     C*
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     MOVE '0'       *IN81
     C                     UPDATNTRANZZF               81
     C           *IN81     IFEQ '1'                        B002
     C*
     C           *LOCK     IN   DLDA
     C***********          MOVEL'UPDATE ' KEY13                           056031
     C                     MOVEL'UPDATE ' KEY13  13                       056031
     C                     MOVE 'FAILED'  KEY13
     C                     MOVELKEY13     DBKEY            ***************
     C                     MOVE '20'      DBASE            * DB ERROR 20 *
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C           *IN21     IFEQ '0'                        B001
     C*
     C                     MOVE '0'       *IN76
     C           1         CHAINNTRANZZ              76
     C*
     C           *IN76     IFEQ '1'                        B002
     C           *LOCK     IN   DLDA
     C                     MOVEL'MISSING' MTKEY  15
     C                     MOVE 'TRAILER' MTKEY
     C                     MOVELMTKEY     DBKEY            ***************
     C                     MOVE '21'      DBASE            * DB ERROR 21 *
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E002
     C*
     C                     MOVE WAMNT     ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C           *IN22     IFEQ '1'                        B002
     C                     ADD  1         NORE1
     C                     END                             E002
     C*
     C                     MOVE '0'       *IN81
     C                     UPDATNTRANZZF               81
     C           *IN81     IFEQ '1'                        B002
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'UPDATE ' KEY13
     C                     MOVE 'FAILED'  KEY13
     C                     MOVELKEY13     DBKEY            ***************
     C                     MOVE '22'      DBASE            * DB ERROR 22 *
     C                     MOVE 'NTRAN'   DBFILE           ***************
     C                     MOVEL'FT0100  'DBPGM                           E29920
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** UIFRMT SR. TO FORMAT THE AMOUNT FIELD FOR OUTPUT TO THE
     C** SCREEN BY SUPPRESSING LEADING ZEROS AND PUTTING A D.P. IN
     C** THE CORRECT POSITION
     C*
     C           UIFRMT    BEGSR
     C*
     C                     Z-ADD*ZERO     I       30
     C                     MOVEAWFDIN     YA1,1
     C*
     C** REPLACE LEADING ZEROES (IF LEFT OF DECIMAL POINT) WITH SPACES
     C*
     C                     SETOF                     89
     C           15        SUB  WDIG      I                 -START
     C                     SUB  WDEC      I                  POS.
     C*
     C           14        SUB  WDEC      I1      30
     C*
     C           *IN89     DOUEQ'1'                        B001
     C                     ADD  1         I
     C           I         IFGT 15                         B002
     C                     SETON                     89    CHECK ARRAY END
     C                     ELSE                            X002
     C           YA1,I     IFNE '0'                        B003
     C                     SETON                     89    CHECK NON-ZERO
     C                     ELSE                            X003
     C           I         IFLE I1                         B004
     C                     MOVEL' '       YA1,I
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*
     C** MOVE TO OUTPUT ARRAY,INSERTING A DECIMAL POINT AS APPROPRIATE
     C** (UNLESS THE INPUT FIELD WAS ALL ZEROES)
     C*
     C           I         IFGT 15                         B001
     C                     MOVEL*BLANKS   WFDOUT
     C                     GOTO UIEND
     C                     END                             E001
     C*
     C                     MOVEL*BLANKS   YA2
     C*
     C           WDEC      IFEQ *ZERO                      B001
     C                     MOVEAYA1,1     YA2,2
     C                     ELSE                            X001
     C                     MOVEAYA1,1     YA2,1
     C           16        SUB  WDEC      I
     C           I         ADD  1         I1
     C                     MOVEL'.'       YA2,I
     C                     MOVEAYA1,I     YA2,I1
     C                     END                             E001
     C*
     C                     MOVEAYA2,1     WFDOUT 16
     C*
     C           UIEND     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** RESET SR. PERFORMED AFTER F12 OR SUCCESSFUL ENQUIRY OR
     C** DELETION,AMENDMENT OR INSERTION PROCESSING
     C*
     C           RESET     BEGSR
     C*
     C                     MOVEA'10'      *IN,26           INIT SCR IND
     C*********************MOVEA'00'      *IN,40                          E29919
     C                     MOVEA'000'     *IN,40                          E29919
     C                     MOVEA'00000000'*IN,44
     C                     MOVEA'00000000'*IN,52
     C                     MOVE '0'       *IN60
     C                     MOVEA'00000000'*IN,31
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN62                           E32830
     C                     MOVE '0'       *IN17                           S01117
     C                     MOVE '0'       *IN19                           S01117
     C                     MOVE '0'       *IN82                           S01414
     C                     MOVE '0'       *IN86                           S01414
     C                     MOVE *BLANKS   SPYST                           S01117
     C                     MOVE *BLANKS   SCCY                            S01117
     C                     MOVE *BLANKS   WDTA1                                               210617
     C                     MOVE *BLANKS   WDTA2                                               210617
     C                     MOVE '0'       *IN29                                               210617
     C*
     C           *IN22     IFEQ '0'                        B001
     C                     MOVE '0'       *IN30
     C                     END                             E001
     C*
     C                     MOVEA'0000'    *IN,20
     C*
     C                     MOVE *BLANKS   SACTCD
     C                     MOVE *BLANKS   STFRF
     C                     MOVE *BLANKS   SBRCA                           S01117
     C*                                                                   S01494
     C** Initialise no update indicator, re-display, warning array        S01494
     C** and warning message sent                                         S01494
     C*                                                                   S01494
     C                     MOVEL*BLANKS   FTNOUP  1                       S01494
     C                     MOVEL*BLANKS   FTRSND  1                       S01494
     C                     MOVEL*BLANKS   FTWARN  1                       S01494
     C                     MOVEL*BLANKS   WRN@                            S01494
     C*
     C           *INKL     IFEQ '1'                        B001
     C                     MOVE *BLANKS   SERCD1
     C                     MOVE '0'       *IN28
     C                     MOVE *BLANKS   SERCD2                                              210617
     C                     MOVE '0'       *IN29                                               210617
     C/COPY WNCPYSRC,FTH00616
     C                     END                             E001
     C*
     C* BLANK OUT THE ERROR CODE ARRAY IF NO ERRORS ARE DUE TO BE
     C* DISPLAYED ON THE SCREEN
     C           *IN28     IFEQ '0'                        B001
     C                     MOVEA*BLANKS   ERCD
     C                     END                             E001
     C*                                                                   S01494
     C** Clear messages from program message queue                        S01494
     C*                                                                   S01494
     C                     CALL 'Y2CLMSC'                                 S01494
     C                     PARM ##PGM     FTPGMQ 10                       S01494
     C                     PARM '*SAME'   FTPGRL  5                       S01494
     C*                                                                   S01494
     C** Reset first message only flag                                    S01494
     C*                                                                   S01494
     C                     MOVEL'N'       FTMSGS  1                       S01494
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** SETUP SR.TO SET UP FIELDS FOR INSERTION OR AMENDMENT PROCESSING
     C*
     C           SETUP     BEGSR
     C*
     C                     MOVE '0'       *IN28
     C                     MOVEA*BLANKS   ERCD
     C                     MOVE *BLANKS   SERCD1
     C*
     C                     MOVE SPYTP     PYTP
     C                     MOVE SPYST     PYST
     C                     MOVE SDEST     DEST
     C                     MOVE SACBN     ACBN
     C*********************MOVE SSWPC     SWPC                            S01117
     C           SSWPC     IFEQ 'U'                        B001           S01117
     C                     Z-ADD1         SWPC                            S01117
     C                     ELSE                            X001           S01117
     C           SSWPC     IFEQ 'N'                        B002           S01117
     C                     Z-ADD2         SWPC                            S01117
     C                     END                             E002           S01117
     C                     END                             E001           S01117
     C                     MOVE SSTMT     STMT
     C                     MOVE SCCY      CCY
     C                     MOVE SBBI1     BBI1
     C                     MOVE SBBI2     BBI2
     C                     MOVE SBBI3     BBI3
     C                     MOVE SBBI4     BBI4
     C***********          MOVE SINTB     INBK                            S01494
     C                     MOVE SINB1     NTINB1                          S01494
     C                     MOVE SINB2     NTINB2                          S01494
     C                     MOVE SINB3     NTINB3                          S01494
     C                     MOVE SINB4     NTINB4                          S01494
     C                     MOVE SINB5     NTINB5                          S01494
     C                     MOVE UUINBT    NTINBT                          S01494
     C*                                                                   S01117
     C** IF MULTIBRANCHED SET UP FILE FIELDS WITH ENTERED OR DEFAULTED    S01117
     C** VALUES ELSE SET UP BRCA/ORBR WITH SINGLE BRANCH FROM SDBANKPD    S01117
     C*                                                                   S01117
     C           *IN43     IFEQ '1'                                       S01117
     C                     MOVE SBRCA     BRCA                            S01117
     C*                                                                   S01117
     C** IF ORIGINATING BRANCH NOT USED DEFAULT FILE FIELD TO BOOKING BR  S01117
     C*                                                                   S01117
     C           *IN18     IFEQ '1'                                       S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SBRCA     ORBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVE BJSBRC    BRCA                            S01117
     C                     MOVE BJSBRC    ORBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
      *
     C                     MOVELSBOKC     BOKC                            S01414
     C                     MOVELSPRFC     PRFC                            S01414
     C*
     C                     Z-ADDWDAYNO    VDAT
     C                     Z-ADDWAMNT     AMNT
     C*
     C**   OBTAIN DAF VALUE DATES
     C                     MOVE SVDAT     VDATD1
     C                     MOVE VDATD1    WDATE1
     C                     EXSR DAFDT
     C                     MOVE WDATE2    VDATD2
     C                     MOVE WDATE3    VDATD3
     C*
     C**   SET UP DIVISOR FOR DAF FIGURE DEPENDING ON D.P. FOR CURRENCY
     C***********CDP*******IFEQ *ZERO                      B001           S01194
     C           A6NBDP    IFEQ *ZERO                      B001           S01194
     C                     Z-ADD1         WDIV    40
     C                     ELSE                            X001
     C***********CDP*******IFEQ 1                          B002           S01194
     C           A6NBDP    IFEQ 1                          B002           S01194
     C                     Z-ADD10        WDIV
     C                     ELSE                            X002
     C***********CDP*******IFEQ 2                          B003           S01194
     C           A6NBDP    IFEQ 2                          B003           S01194
     C                     Z-ADD100       WDIV
     C                     ELSE                            X003
     C                     Z-ADD1000      WDIV
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*
     C**   CALCULATE DAF FIGURE
     C           AMNT      DIV  WDIV      AMNTD  152H
     C*
     C* CALCULATE BASE CURRENCY EQUIV
     C***********CDP*******SUB  BCDP      N       10                      S01194
     C           A6NBDP    SUB  BCDP      N       10                      S01194
     C                     ADD  4         N
     C***********MDIN******IFEQ 0                          B001           S01194
     C           A6MDIN    IFEQ 'D'                        B001           S01194
     C***********SPOT******MULT POWER,N   WK159     H                     S01194
     C           A6SPRT    MULT POWER,N   WK159     H                     S01194
     C           AMNT      DIV  WK159     SBCQ      H
     C                     ELSE                            X001
     C***********SPOT******DIV  POWER,N   WK159  159H                     S01194
     C           A6SPRT    DIV  POWER,N   WK159  159H                     S01194
     C           AMNT      MULT WK159     SBCQ      H
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** OTPUT SR. TO OUTPUT DETAIL SCREEN ENTRIES FOR ENQUIRY,DELETION
     C** AND AMENDMENT REQUESTS
     C*
     C           OTPUT     BEGSR
      *
      * If Amend/Delete/Enquiry move file fields to screen
      *
     C           *IN22     IFEQ '0'                        B001
     C*
     C                     MOVE PYTP      SPYTP
     C                     MOVE PYST      SPYST
     C                     MOVE DEST      SDEST
     C                     MOVE CCY       SCCY
     C                     MOVE VDATD1    SVDAT
     C***********          MOVE INBK      SINTB                           S01494
     C                     MOVE NTINB1    SINB1                           S01494
     C                     MOVE NTINB2    SINB2                           S01494
     C                     MOVE NTINB3    SINB3                           S01494
     C                     MOVE NTINB4    SINB4                           S01494
     C                     MOVE NTINB5    SINB5                           S01494
     C                     MOVE ACBN      SACBN
     C                     MOVE BBI1      SBBI1
     C                     MOVE BBI2      SBBI2
     C                     MOVE BBI3      SBBI3
     C                     MOVE BBI4      SBBI4
     C*********************MOVE SWPC      SSWPC                           S01117
     C           SWPC      IFEQ 1                          B002           S01117
     C                     MOVE 'U'       SSWPC                           S01117
     C                     ELSE                            X002           S01117
     C           SWPC      IFEQ 2                          B003           S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     END                             E003           S01117
     C                     END                             E002           S01117
     C                     MOVE STMT      SSTMT
     C*                                                                   S01494
     C** V#INB1 field is blank if NTINBT is not "S" or "C"                S01494
     C*                                                                   S01494
     C           NTINBT    IFNE 'S'                                       S01494
     C           NTINBT    ANDNE'C'                                       S01494
     C                     MOVE *BLANKS   V#INB1                          S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** If the first character of NTINB1 is not "/", then V#INB1         S01494
     C** is equal to this field                                           S01494
     C*                                                                   S01494
     C                     MOVELNTINB1    WINB1   1                       S01494
     C           WINB1     IFNE '/'                                       S01494
     C                     MOVE NTINB1    V#INB1                          S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** Else, V#INB1 is equal to NTINB2                                  S01494
     C*                                                                   S01494
     C                     MOVE NTINB2    V#INB1                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C*                                                                   S01117
     C**IF MULTIBRANCHED SET UP DETAIL SCREEN VALUES                      S01117
     C*                                                                   S01117
     C           *IN43     IFEQ '1'                                       S01117
     C                     MOVE ORBR      SORBR                           S01117
     C                     MOVE @BRCH     SBRCA                           S01117
     C                     MOVELBOKC      SBOKC                           S01414
     C                     MOVELPRFC      SPRFC                           S01414
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                            X001
     C*
     C                     MOVE 'NT'      SPYTP
     C                     MOVE *BLANKS   SPYST
     C                     MOVE *BLANKS   SDEST
     C                     MOVE *BLANKS   SAMNT
     C                     MOVE *BLANKS   SCCY
     C                     MOVE *BLANKS   SVDAT
     C***********          MOVE *BLANKS   SINTB                           S01494
     C                     MOVE *BLANKS   SINB1                           S01494
     C                     MOVE *BLANKS   SINB2                           S01494
     C                     MOVE *BLANKS   SINB3                           S01494
     C                     MOVE *BLANKS   SINB4                           S01494
     C                     MOVE *BLANKS   SINB5                           S01494
     C                     MOVE *BLANKS   SACBN
     C                     MOVE *BLANKS   SBBI1
     C                     MOVE *BLANKS   SBBI2
     C                     MOVE *BLANKS   SBBI3
     C                     MOVE *BLANKS   SBBI4
     C*********************MOVE '02'      SSWPC                           S01117
     C                     MOVE 'N'       SSWPC                           S01117
     C                     MOVE '08'      SSTMT
     C                     MOVE *BLANKS   SORBR                           S01117
     C                     MOVEL*BLANKS   SBOKC                           S01414
     C                     MOVEL*BLANKS   SPRFC                           S01414
     C*
     C                     END                             E001
     C*                                                                   S01494
     C** If in Enquiry mode, format the Intermediary Bank fields          S01494
     C** (lines 1 to 5) using the FT formatting program FT0315            S01494
     C*                                                                   S01494
     C           *IN20     IFEQ '1'                                       S01494
     C*                                                                   S01494
     C** Set up general parameters                                        S01494
     C*                                                                   S01494
     C                     CLEARW8FT                                      S01494
     C                     MOVEL*BLANKS   W8STMT                          S01494
     C                     MOVELCCY       W8CCY                           S01494
     C                     MOVEL##PGM     W8CPGM                          S01494
     C                     MOVEL'*SCR  '  W8ACT                           S01494
     C                     Z-ADD5         W8NLIN                          S01494
     C*                                                                   S01494
     C** Set up parameters                                                S01494
     C*                                                                   S01494
     C                     MOVELNTINBT    W8TYPE                          S01494
     C                     MOVEL*BLANKS   W8LINS                          S01494
     C                     MOVEL*BLANKS   ADDRSS                          S01494
     C                     MOVELNTINB1    ADCHK1                          S01494
     C                     MOVELNTINB2    ADCHK2                          S01494
     C                     MOVELNTINB3    ADCHK3                          S01494
     C                     MOVELNTINB4    ADCHK4                          S01494
     C                     MOVELNTINB5    ADCHK5                          S01494
     C                     MOVELADDRSS    W8LINS                          S01494
     C*                                                                   S01494
     C** Call expansion program                                           S01494
     C*                                                                   S01494
     C                     CALL 'FT0315'               8989               S01494
     C                     PARM           W8RTN   7                       S01494
     C                     PARM           W8FT                            S01494
     C                     PARM           W8LINS256                       S01494
     C                     PARM           W8RPT 256                       S01494
     C                     PARM           W8MSG 256                       S01494
     C                     PARM           W8SCR 256                       S01494
     C*                                                                   S01494
     C** Check if database error occurred                                 S01494
     C*                                                                   S01494
     C           *IN89     IFEQ '1'                                       S01494
     C           W8RTN     ORNE *BLANKS                                   S01494
     C                     MOVEL'FT0315'  W0FILE                          S01494
     C                     MOVEL'*CALL'   W0KEY                           S01494
     C                     Z-ADD101       W0ERNB                          S01494
     C                     EXSR SRERR                      *ABORT PGM*    S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           35        SUBSTW8SCR:1   SINB1                           S01494
     C           35        SUBSTW8SCR:36  SINB2                           S01494
     C           35        SUBSTW8SCR:71  SINB3                           S01494
     C           35        SUBSTW8SCR:106 SINB4                           S01494
     C           35        SUBSTW8SCR:141 SINB5                           S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** DAFDT SR.TO OBTAIN DAF DATE FORMATS 'CC' & 'YYMMDD'
     C*
     C           DAFDT     BEGSR
     C*
     C                     MOVE WDATE1    WDATE2  20
     C                     MOVELWDATE1    WDATE4  40
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE WDATE4    WDATE3  60
     C                     MOVELWDATE2    WDATE3
     C                     ELSE                            X001
     C                     MOVE WDATE4    WDATE5  20
     C                     MOVELWDATE4    WDATE6  20
     C                     MOVELWDATE5    WDATE4
     C                     MOVE WDATE6    WDATE4
     C                     MOVE WDATE4    WDATE3
     C                     MOVELWDATE2    WDATE3
     C                     END                             E001
     C*
     C******               MOVE '19'      WDATE2                          156695
     C           WDATE2    IFLT 72                                        156695
     C                     MOVE '20'      WDATE2                          156695
     C                     ELSE                                           156695
     C                     MOVE '19'      WDATE2                          156695
     C                     ENDIF                                          156695
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** TRANRF SR.TO CHAIN TO NTRAN FILE
     C*
     C           TRANRF    BEGSR
     C*
     C                     MOVE '0'       *IN71
     C           STFRF     CHAINNTRANDDF             71
     C           *IN71     IFEQ '0'                        B001
     C                     EXCPTNTDDF
     C                     MOVE CHTP      WCHTP   1
     C                     Z-ADDLCD       WLCD    50
     C                     Z-ADDLCHT      WLCHT   60
     C*
     C                     MOVE *BLANKS   SSTAT
     C*********************MOVE '0'       *IN39                           E32830
     C                     MOVE '0'       *IN62                           E32830
     C*
     C           RECI      IFEQ 'C'                        B002
     C                     MOVEL'DELETED' SSTAT
     C                     ELSE                            X002
     C*
     C           RECI      IFEQ 'M'                        B003
     C                     MOVEL'MATURED' SSTAT
     C                     ELSE                            X003
     C*
     C           RECI      IFEQ 'D'                        B004
     C           AUIN      ANDEQ'Y'
     C                     MOVEL'AUTHORIS'SSTAT
     C                     MOVE 'ED'      SSTAT
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C*
     C           SSTAT     IFNE *BLANKS                    B002
     C*********************MOVE '1'       *IN39                           E32830
     C                     MOVE '1'       *IN62                           E32830
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** NOSCHN SR. TO CHAIN TO NOSTROS RECORD ON TABLE FILE
     C*
     C           NOSCHN    BEGSR
     C*
     C*********************MOVE *BLANKS   NOSKEY 12                       S01194
     C*********************MOVEL'70'      NOSKEY                          S01194
     C*********************MOVELNRCCY     NOFLD5  5                       S01194
     C*********************MOVE NRNOSN    NOFLD5                          S01194
     C*********************MOVE NOFLD5    NOSKEY                          S01194
     C*********************                                               S01194
     C*********************MOVE '0'       *IN70                           S01117
     C***********NOSKEY****CHAINTABLETLF             70                   S01194
     C*********************                                               S01194
     C**N70******RECI******COMP 'D'                  7070                 S01194
     C*
     C                     SETOF                     70
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM ERROR     P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM *BLANKS   P@CUST  6                       S01194
     C                     PARM NRCCY     P@CYCD  3                       S01194
     C**********           PARM *BLANKS   P@ACCD  4                                    S01194 CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSN  2                       S01194
     C                     PARM NRNOSN    P@NONB  2                       S01194
     C                     PARM *BLANKS   P@BRCD  3                       S01194
     C                     PARM *BLANKS   P@CSSN 10                       S01194
     C                     PARM *BLANKS   P@PNOI  1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C           P@RTCD    IFEQ *BLANKS                                   S01194
     C**********           MOVE A7ACCD    ACOD    40                                   S01194 CGL029
     C                     MOVE A7ACCD    ACOD                                                CGL029
     C                     MOVE A7ACSN    ACSQ    20                      S01194
     C**********           MOVE A7CUST    CNUM    60                                   S01194 CSD027
     C                     MOVE A7CUST    CNUM    6                                           CSD027
     C                     MOVE A7BRCD    BRCA                            S01194
     C                     ELSE                                           S01194
     C                     SETON                     70                   S01194
     C                     END                                            S01194
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** DSTCHN SR. TO CHAIN TO DEAL SUB-TYPE RECORD ON TABLE FILE
     C*
     C           DSTCHN    BEGSR
     C*********************                                               S01194
     C*********************MOVE *BLANKS   DSTKEY 12                       S01194
     C*********************MOVEL'42'      DSTKEY                          S01194
     C*********************MOVE DSPYST    DSTKEY                          S01194
     C*********************                                               S01194
     C                     MOVE '0'       *IN69
     C***********DSTKEY****CHAINTABLET5F             69                   S01194
     C*********************                                               S01194
     C**N69******RECI******COMP 'D'                  6969                 S01194
     C*
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM '*BLANKS' P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM DSPYST    P@DSTC  2                       S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
     C*                                                                   093958
     C           P@RTCD    COMP *BLANKS              6969                 093958
     C*                                                                   093958
     C           *IN69     IFEQ '0'                                       093958
     C*                                                                   093958
     C** Check in Deal type/Sub type file if combination exists           093958
     C*                                                                   093958
     C           @DTSTK    CHAINFDDTSTL1             69                   093958
     C           *IN69     IFEQ '0'                                       093958
     C           RCID11    ANDEQ'*'                                       093958
     C                     SETON                     69                   093958
     C                     END                                            093958
     C                     END                                            093958
     C*                                                                   093958
     C***********P@RTCD    IFNE *BLANKS                             S01194093958
     C***********          SETON                     69             S01194093958
     C***********          END                                      S01194093958
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** CURCHN SR. TO CHAIN TO CURRENCIES RECORD ON TABLE FILE
     C*
     C           CURCHN    BEGSR
     C*                                                                   S01194
     C*********************MOVE *BLANKS   CURKEY 12                       S01194
     C*********************MOVEL'20'      CURKEY 12                       S01194
     C*********************MOVELSCCY      CUFLD4  4                       S01194
     C*********************MOVE '1'       CUFLD4                          S01194
     C*********************MOVE CUFLD4    CURKEY                          S01194
     C*                                                                   S01194
     C*********************MOVE '0'       *IN73                           S01194
     C***********CURKEY****CHAINTABTG10F             73                   S01194
     C*********************                                               S01194
     C**N73******RECI******COMP 'D'                  7373                 S01194
     C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SCCY      P@K101  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           P@RTCD    COMP *BLANKS              7373                 S01194
     C                     ENDSR
     C/EJECT
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFA   : Determine if Profit Centres are Used              *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : *NONE                                             *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFA    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         Q                               S01414
     C                     MOVEL'SRPRFA'  @STK,Q                          S01414
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
      *  If Profit Centres are used determine if field is amendable.      S01414
      *                                                                   S01414
      *  If Insert it is always amendable. If Amend it is only            S01414
      *  amendable if the Profit Centres Amendable flag is set to 'Y'.    S01414
      *  If Enquire or Delete it is not amendable.                        S01414
      *                                                                   S01414
     C           SACTCD    IFEQ 'I'                                       S01414
     C           SACTCD    OREQ 'A'                                       S01414
     C           BKPRCA    ANDEQ'Y'                                       S01414
     C                     MOVEA'010'     *IN,84           Amendable      S01414
     C                     ELSE                                           S01414
     C                     MOVEA'000'     *IN,84           Protect        S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  If Profit Centres NOT Used - non display field                   S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVEA'100'     *IN,84           Non-display    S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXPRFA    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,Q                          S01414
     C                     SUB  1         Q       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT                                                              S01414
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRBOOK   : Validate Book Code                                *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : AOBOOKR0                                          *   S01414
      *             FTSNMS                                            *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRBOOK    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         Q                               S01414
     C                     MOVEL'SRBOOK'  @STK,Q                          S01414
      *                                                                   S01414
      *  Book Code must be entered                                        S01414
      *                                                                   S01414
     C           SBOKC     IFEQ *BLANKS                                   S01414
     C                     MOVE '1'       *IN82                           S01414
     C                     MOVEL' 400'    ERCD,X                          S01414
     C                     ADD  1         X                               S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Access the Book Code file for validation                         S01414
      *                                                                   S01414
     C           SBOKC     IFNE *BLANKS                                   S01414
      *                                                                   S01414
     C                     CALL 'AOBOOKR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY   ' U#OPTN  7                       S01414
     C                     PARM SBOKC     U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOBOOKR' W0KEY            * DBERR 023*   S01414
     C                     Z-ADD23        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * else map the book code from the data structure to screen field    S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN82                           S01414
     C                     MOVEL' 400'    ERCD,X                          S01414
     C                     ADD  1         X                               S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELBDBKCD    SBOKC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXBOOK    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,Q                          S01414
     C                     SUB  1         Q       50                      S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT                                                              S01414
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFC   : Validation Of Profit Centre                       *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : FTSNMS                                            *   S01414
      *             AOPRFMR0                                          *   S01414
      *             AOPRFCR0                                          *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFC    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         Q                               S01414
     C                     MOVEL'SRPRFC'  @STK,Q                          S01414
      *                                                                   S01414
      *  Profit Centre is Optional input.                                 S01414
      *                                                                   S01414
      *  If a valid A/C with bank                                         179732
     C           *IN37     IFEQ '0'                                       179732
     C           *IN58     ANDEQ'0'                                       179732
     C           *IN59     ANDEQ'0'                                       179732
      *                                                                   179732
      *  If the profit centre is blank and with bank is either retail     179732
      *  or Nostro move the prfc from the A/C with Bank in.               179732
     C           SPRFC     IFEQ *BLANKS                                   179732
     C           ATYPA     IFEQ 'R'                                       179732
     C           ATYPA     OREQ 'N'                                       179732
     C                     MOVELPRFCA     SPRFC                           179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
      *                                                                   179732
      *  If the profit centre field is blank set to a default only if     S01414
      *  the Profit Centre Defaults Used flag is set to 'Y'.              S01414
      *  This could only happen on an Insert.                             S01414
      *                                                                   S01414
     C           SACTCD    IFEQ 'I'                                       S01414
     C           SPRFC     ANDEQ*BLANKS                                   S01414
     C           BKPCDU    ANDEQ'Y'                                       S01414
     C           *IN82     ANDEQ'0'                                       179732
     C           *IN41     ANDEQ'0'                                       179732
     C           *IN17     ANDEQ'0'                                       179732
      *                                                                   S01414
      *  Determine parameters to be passed                                S01414
      *                                                                   S01414
      *  For Nostro Transfers the Customer and Account Officer will       S01414
      *  be blank.                                                        S01414
      *                                                                   S01414
      *                                                                   S01414
     C                     MOVEL*BLANKS   CUST    6        Customer       S01414
     C                     MOVEL*BLANKS   ACOF    2        Account OfficerS01414
     C                     MOVELSPYTP     TRTP    5        Transaction TypS01414
      *                                                                   S01414
      *  Get default profit centre                                        S01414
      *                                                                   S01414
     C                     CALL 'AOPRFMR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7        Return Code    S01414
     C                     PARM SBOKC     U#BOKC  2        Book Code      S01414
     C                     PARM TRTP      U#TRTP  5        Transaction TypS01414
     C                     PARM SPYST     U#SUTP  2        Sub Type       S01414
     C                     PARM SBRCA     U#BRAN  3        Branch Code    S01414
     C                     PARM DPPT      U#DEPT  3        Department CodeS01414
     C                     PARM USRID     U#USER 10        User           S01414
     C                     PARM ACOF      U#ACOF  2        Account OfficerS01414
     C                     PARM CUST      U#CUST  6        Customer NumberS01414
     C           SPRFC     PARM *BLANKS   U#PRFC  4        Profit Centre  S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFMR' W0KEY            * DBERR 24 *   S01414
     C                     Z-ADD24        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * If no error then the screen field is filled by passed parameter   S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ '2'                                       S01414
     C                     MOVE '1'       *IN86                           S01414
     C                     MOVEL' 410'    ERCD,X                          S01414
     C                     ADD  1         X                               S01414
     C                     GOTO EXPRFC                                    S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Validate Profit Centre                                           S01414
      *                                                                   S01414
     C           SACTCD    IFEQ 'I'                                       S01414
     C           SPRFC     ANDNE*BLANKS                                   S01414
     C           SACTCD    OREQ 'A'                                       S01414
     C           SPRFC     ANDNE*BLANKS                                   S01414
     C           SACTCD    OREQ 'I'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
     C           SACTCD    OREQ 'A'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
      *                                                                   S01414
     C                     CALL 'AOPRFCR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM SPRFC     U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFCR' W0KEY            * DBERR 25 *   S01414
     C                     Z-ADD25        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN86                           S01414
     C                     MOVEL' 410'    ERCD,X                          S01414
     C                     ADD  1         X                               S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELDSPCCD    SPRFC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            179732
      *                                                                   179732
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXPRFC    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,Q                          S01414
     C                     SUB  1         Q       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRCLR    : Clear all positions in store                      *   056031
      *                                                               *   056031
      *  CALLED BY: INSERT - Insert a record                          *   056031
      *             AMEND  - Amend a record                           *   056031
      *             DELET  - Delete a record                          *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRCLR     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRCLR'   @STK,Q                          056031
      *                                                                   056031
      *  Clear arrays in AOSPOSU0                                         056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*CLEAR  'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD901       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0100C011
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXCLR     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADD    : Add shadow positions to store                     *   056031
      *                                                               *   056031
      *  CALLED BY: INSERT - Insert a record                          *   056031
      *             AMEND  - Amend a record                           *   056031
      *             DELET  - Delete a record                          *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADD     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRADD'   @STK,Q                          056031
      *                                                                   056031
      *  Define amount                                                    056031
      *                                                                   056031
     C           *LIKE     DEFN AMNT      ##AMNT                          056031
      *                                                                   056031
      *  Move fields to C#DTA structure and call AOSPOSU0                 056031
      *                                                                   056031
      *         S E T T L E    I N S T R U C T I O N S                    056031
      *                                                                   056031
      * A C C O U N T   W I T H   B A N K                                 056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
     C                     MOVEL'N'       C#ATYP                          056031
     C                     MOVELACBN      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     Z-ADDVDAT      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDVDAT      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL' '       C#IO                            056031
     C                     MOVELCCY       C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELTFRF      C#PREF                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELTFRF      C#NARR                                              CRE020
     C                     Z-ADD1         C#CHQN                                              CRE020
     C           WRVAST    IFEQ 'Y'                                                           CRE020
     C                     MOVE '*'       C#NARR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     Z-ADD##AMNT    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD10        C#RPNB                          068347
     C                     MOVEL'D'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'S'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD902       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0100C012
      *                                                                   056031
      *         P A Y          I N S T R U C T I O N S                    056031
      *                                                                   056031
      * D E S T I N A T I O N                                             056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
     C                     MOVEL'N'       C#ATYP                          056031
     C                     MOVELDEST      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     Z-ADDVDAT      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDVDAT      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL' '       C#IO                            056031
     C                     MOVELCCY       C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELTFRF      C#PREF                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELTFRF      C#NARR                                              CRE020
     C                     Z-ADD2         C#CHQN                                              CRE020
     C           WRVAST    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVAST                                              CRE020
     C                     MOVE '*'       C#NARR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     Z-SUB##AMNT    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD20        C#RPNB                          068347
     C                     MOVEL'C'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'S'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD903       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0100C013
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXADD     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRUPD    : Update database with shadow positions             *   056031
      *                                                               *   056031
      *  CALLED BY: INSERT - Insert a record                          *   056031
      *             AMEND  - Amend a record                           *   056031
      *             DELET  - Delete a record                          *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRUPD     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRUPD'   @STK,Q                          056031
      *                                                                   056031
      *  Call AOSPOSU0 to update database                                 056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*UPDATE 'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD904       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0100C014
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXUPD     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q                               056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRERR    : Report error and close down program               *   056031
      *                                                               *   056031
      *  CALLED BY:       - Initial Processing                        *   056031
      *             SRCLR - Clear arrays                              *   056031
      *             SRUPD - Update Database with shadow positions     *   056031
      *             SRADD - Add shadow positions to store             *   056031
      *             SRBOOK- Validate Book code field                  *   056031
      *             SRPRFC- Validate Profit Centre field              *   056031
      *                                                               *   056031
      *  CALLS    : *NONE                                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRERR     BEGSR                                          056031
      *                                                                   056031
      *  Define work variables                                            056031
      *                                                                   056031
     C           *LIKE     DEFN @BKEY     W0KEY                           056031
     C           *LIKE     DEFN @BERNB    W0ERNB                          056031
     C           *LIKE     DEFN @BFILE    W0FILE                          056031
     C           *LIKE     DEFN @BNARR    W0NARR                          056031
      *                                                                   056031
      *  Dump program                                                     056031
      *                                                                   056031
     C                     DUMP                                           056031
     C                     ROLBK                                          056031
      *                                                                   056031
      *  Send message to MOPERQ                                           056031
      *                                                                   056031
     C                     MOVEL*BLANKS   DBDTA                           056031
     C                     MOVEL'FT0100  '@BPGM                           056031
     C           Q         IFGT 1                                         056031
     C           Q         ANDLT21                                        056031
     C                     MOVEL@STK,Q    @BSTK                           056031
     C                     ELSE                                           056031
     C                     MOVEL'*Nostkin'@BSTK                           056031
     C                     END                                            056031
     C                     MOVELW0KEY     @BKEY                           056031
     C                     MOVELW0ERNB    @BERNB                          056031
     C                     MOVELW0FILE    @BFILE                          056031
     C                     MOVELTFRF      @BPREF                          056031
     C           W0NARR    IFEQ *BLANKS                                   056031
     C                     MOVELERR@,1    @BNARR                          056031
     C                     ELSE                                           056031
     C                     MOVELW0NARR    @BNARR                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     CALL 'AOCREPT'              9090               056031
     C                     PARM 'MEM5000' #MSGID  7                       056031
     C                     PARM 'MIDAS  ' #MSGF  10                       056031
     C                     PARM *BLANKS   #MSGFL 10                       056031
     C                     PARM DBDTA     #MSGDT256                       056031
     C                     PARM '*PRV'    #MSGR   5                       056031
     C                     PARM '*'       #PRGM  10                       056031
     C                     PARM 'MOPERQ ' #MSGQ  10                       056031
     C                     PARM '*INFO  ' #MSGT   7                       056031
      *                                                                   056031
      *  Close down program                                               056031
      *                                                                   056031
     C           *LOCK     IN   DLDA                                      056031
     C                     MOVE 'FT0100  'DBPGM                           056031
     C                     MOVELW0FILE    DBFILE                          056031
     C                     Z-ADDW0ERNB    DBASE                           056031
     C                     MOVELW0KEY     DBKEY                           056031
     C                     OUT  DLDA                                      056031
     C                     SETON                     U7U8LR               056031
      *                                                                   042167
      *  Allocate dataarea to blanks                                      042167
      *                                                                   042167
     C                     EXSR DALLOC                                    042167
      *                                                                   042167
     C                     RETRN                                          056031
     C                     MOVEL*BLANKS   R#RTN   7                       056031
      *                                                                   056031
     CSR         EXERR     ENDSR                                          056031
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************042167
     C* SUBROUTINE TO DEALLOCATE DATAAREA                                 042167
     C*                                                                   042167
     C           DALLOC    BEGSR                           *** DALLOC ****042167
      *                                                                   042167
      * Call CL program to de-allocate                                    042167
      *                                                                   042167
     C                     MOVE *BLANKS   @RTCDE                          042167
     C                     MOVE 'FT'      @MODLE                          042167
     C                     MOVE *BLANKS   @TREF                           042167
     C                     MOVE *BLANKS   @RTINF                          042167
     C                     CALL 'AOC8000'                                 042167
     C                     PARM           @RTCDE                          042167
     C                     PARM           @MODLE                          042167
     C                     PARM           @TREF                           042167
     C                     PARM           @RTINF                          042167
      *                                                                   042167
     C                     ENDSR                                          042167
      *                                                                   042167
     C*                                                                   042167
     C/EJECT
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO                              B001
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END                             E001
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO                              B001
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END                             E001
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY                         B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6                          B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C   97N93             DO   3                          B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*********************                                               S01194
     C*********************                                               S01194
     C*****ZSYSTM*SR.*TO*CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
     C*********************                                               S01194
     C***********ZSYSTM****BEGSR                           *** ZSYSTEM ***S01194
     C*********************                                               S01194
     C*****SET*UP*KEY*FOR*INSTALLATION CONTROL RECORD.                    S01194
     C*********************MOVEL'01      'ZTABKY 12                       S01194
     C*********************MOVE '  10'    ZTABKY                          S01194
     C*********************                                               S01194
     C***********ZTABKY****CHAINTABFP                99    ON NOT THERE   S01194
     C**N99******RECI******COMP 'D'                  9999  ON, IS DELETED S01194
     C*********************                                               S01194
     C*****CHECK*SYSTEM*DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C***********DATF******COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*********************                                               S01194
     C*********************ENDSR                                          S01194
     C*********************                                               S01194
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZADD    BEGSR                           *** GLZADD ****
     C*
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     CSR                   EXSR GLZSUM
     C*
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO SUBTRACT AN AMOUNT (ZZAMT) FROM THE TOTAL
     C*                                                   (ZZTOTI,ZZTOTD)
     C*  IND '99' IS SET BY AN OVERFLOW ERROR
     CSR         GLZSUB    BEGSR                           *** GLZSUB ****
     C*                                                   (ZZTOTI,ZZTOTD)
     C* PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
     CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
     CSR                   EXSR GLZADD                       AND 'ADD'
     CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
     C*                                                   (ZZTOTI,ZZTOTD)
     CSR                   ENDSR
     C*                                                   (ZZTOTI,ZZTOTD)
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
     C*
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     C*
     CSR                   ENDSR                             ** ENDSR **
     C*
     C/EJECT                                                              S01194
     C**                                                                  S01194
     C********************************************************************S01194
     C**                                                                  S01194
     C**                                                                  S01194
     C**   FLDQRY SUBROUTINE                                              S01194
     C**                                                                  S01194
     C           FLDQRY    BEGSR                                          S01194
      *----------------------------------------------------------------   S01194
      * Subroutine to resolve entry of ? for standing data fields.        S01194
      * Performed after function key validation and prior to field        S01194
      * validation                                                        S01194
      *                                                                   S01194
      * Indicators used:                                                  S01194
      *  13       used in LOKUP, on if ? found in transfer sub-type       S01194
      *  14       used in LOKUP, on if ? found in currency field          S01194
      *  15       on then redisplay screen                                S01194
      *  16       used in LOKUP, on if ? found in SBRCA  or SORBR         S01194
      *----------------------------------------------------------------   S01194
     C                     SETOF                     15                   S01194
      *                                                                   S01194
      ** Check booking branch for entry of ?                              S01194
      *                                                                   S01194
     C           *IN26     IFEQ '1'                        B001           S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASBRCA     FLDQ                            S01194
     C                     SETOF                     16                   S01194
     C           '?'       LOKUPFLDQ                     16               S01194
     C                     END                             E001           S01194
      *                                                                   S01194
      ** Check originating branch for entry of ?                          S01194
      *                                                                   S01194
     C           *IN27     IFEQ '1'                        B001           S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASORBR     FLDQ                            S01194
     C                     SETOF                     16                   S01194
     C           '?'       LOKUPFLDQ                     16               S01194
     C                     END                             E001           S01194
      *                                                                   S01194
      ** Check transfer sub-type for entry of ?                           S01194
      *                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASPYST     FLDQ                            S01194
     C                     SETOF                     13                   S01194
     C           '?'       LOKUPFLDQ                     13               S01194
      *                                                                   S01194
      ** Check currency field for entry of ?                              S01194
      *                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASCCY      FLDQ                            S01194
     C                     SETOF                     14                   S01194
     C           '?'       LOKUPFLDQ                     14               S01194
      *                                                                   S01414
      ** Check Book Code field for entry of ?                             S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASBOKC     FLDQ                            S01414
     C                     SETOF                     90                   S01414
     C           '?'       LOKUPFLDQ                     90               S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVE 'Y'       QBOKC   1                       S01414
     C                     END                                            S01414
      *                                                                   S01414
      ** Check Profit Centre field for entry of ?                         S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASPRFC     FLDQ                            S01414
     C                     SETOF                     90                   S01414
     C           '?'       LOKUPFLDQ                     90               S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVE 'Y'       QPRFC   1                       S01414
     C                     END                                            S01414
      ********************************************************************S01194
      *                                                                   S01194
      ** If ? found, seton redisplay ind and call access program          S01194
      *                                                                   S01194
     C           *IN16     IFEQ '1'                        B001           S01194
     C                     SETON                     15                   S01194
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM '?'       @DSNB   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01194
      ** If selection made, move value to screen field                    S01194
      *                                                                   S01194
     C           *IN26     IFEQ '1'                        B002           S01194
     C           P@RTCD    IFEQ *BLANKS                    B003           S01194
     C                     MOVELA8BRCD    SBRCA                           S01194
     C                     ELSE                                           S01194
     C                     MOVEL*BLANKS   SBRCA                           S01194
     C                     END                             E003           S01194
     C                     END                             E002           S01194
      *                                                                   S01194
     C           *IN27     IFEQ '1'                        B002           S01194
     C           P@RTCD    IFEQ *BLANKS                    B003           S01194
     C                     MOVELA8BRCD    SORBR                           S01194
     C                     ELSE                                           S01194
     C                     MOVEL*BLANKS   SORBR                           S01194
     C                     END                             E003           S01194
     C                     END                             E002           S01194
     C                     SETOF                     16                   S01194
     C                     END                             E001           S01194
      ********************************************************************S01194
      *                                                                   S01194
      ** If ? found, seton redisplay ind and call access program          S01194
      *                                                                   S01194
     C           *IN13     IFEQ '1'                        B001           S01194
     C                     SETON                     15                   S01194
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM *BLANKS   P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM '?'       P@DSTC  2                       S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
      *                                                                   S01194
      ** If selection made, move value to screen field                    S01194
      *                                                                   S01194
     C           P@RTCD    IFEQ *BLANKS                    B002           S01194
     C                     MOVELASDSTC    SPYST                           S01194
     C                     ELSE                                           S01194
     C                     MOVEL*BLANKS   SPYST                           S01194
     C                     END                             E002           S01194
     C                     SETOF                     13                   S01194
     C                     END                             E001           S01194
      ********************************************************************S01194
      *                                                                   S01194
      ** If ? found, seton redisplay ind and call access program          S01194
      *                                                                   S01194
     C           *IN14     IFEQ '1'                        B001           S01194
     C                     SETON                     15                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   P@RTCD  7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM '?'       P@K101  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
      ** If selection made, move value to screen field                    S01194
      *                                                                   S01194
     C           P@RTCD    IFEQ *BLANKS                    B002           S01194
     C                     MOVELA6CYCD    SCCY                            S01194
     C                     ELSE                                           S01194
     C                     MOVEL*BLANKS   SCCY                            S01194
     C                     END                             E002           S01194
     C                     SETOF                     14                   S01194
     C                     END                             E001           S01194
      ********************************************************************S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           QBOKC     IFEQ 'Y'                        B001           S01414
     C                     SETON                     15                   S01414
     C                     CALL 'AOBOOKR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                    B002           S01414
     C                     MOVELSDBOOK    SBOKC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SBOKC                           S01414
     C                     END                             E002           S01414
     C                     MOVEL*BLANKS   QBOKC                           S01414
     C                     END                             E001           S01414
      ********************************************************************S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           QPRFC     IFEQ 'Y'                        B001           S01414
     C                     SETON                     15                   S01414
     C                     CALL 'AOPRFCR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                    B002           S01414
     C                     MOVELSDPRFC    SPRFC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SPRFC                           S01414
     C                     END                             E002           S01414
     C                     MOVEL*BLANKS   QPRFC                           S01414
     C                     END                             E001           S01414
      ********************************************************************S01194
      *                                                                   S01194
     C                     ENDSR                                          S01194
     C**                                                                  S01194
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRCHCK  - Check if Watch List Checking Engine Program needs  *                       CSD015
      *            to be called                                       *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : None                                              *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRCHCK    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialization                                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       W3UNCF  1                                           CSD015
     C                     MOVE 'N'       WDESTX  1                                           CSD015
     C                     MOVE 'N'       WACBNX  1                                           CSD015
     C                     MOVE 'N'       WINBXX  1                                           CSD015
      *                                                                                       CSD015
     C           SACTCD    IFEQ 'A'                                                           CSD015
     C                     MOVEL'NTRANDD' K3FUNT                                              CSD015
      *                                                                                       CSD015
     C                     MOVELTFRF      K3IDEN                                              CSD015
      *                                                                                       CSD015
     C                     MOVELBRCA      K3BRCH                                              CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             78                                       CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Destination                                                                          CSD015
      *                                                                                       CSD015
     C           SDEST     IFNE *BLANKS                                                       CSD015
     C                     MOVELDEST      WADEST  2                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           SDEST     ORNE WADEST                                                        CSD015
     C                     MOVE 'Y'       WDESTX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Nostro                                                                               CSD015
      *                                                                                       CSD015
     C           SACBN     IFNE *BLANKS                                                       CSD015
     C                     MOVELACBN      WAACBN  2                                           CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           SACBN     ORNE WAACBN                                                        CSD015
     C                     MOVE 'Y'       WACBNX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Intermediary Bank                                                                    CSD015
      *                                                                                       CSD015
     C           SINB1     IFNE *BLANKS                                                       CSD015
     C           SINB2     ORNE *BLANKS                                                       CSD015
     C           SINB3     ORNE *BLANKS                                                       CSD015
     C           SINB4     ORNE *BLANKS                                                       CSD015
     C           SINB5     ORNE *BLANKS                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C           SINB1     ORNE NTINB1                                                        CSD015
     C           SINB1     ANDNE*BLANKS                                                       CSD015
     C           SINB2     ORNE NTINB2                                                        CSD015
     C           SINB2     ANDNE*BLANKS                                                       CSD015
     C           SINB3     ORNE NTINB3                                                        CSD015
     C           SINB3     ANDNE*BLANKS                                                       CSD015
     C           SINB4     ORNE NTINB4                                                        CSD015
     C           SINB4     ANDNE*BLANKS                                                       CSD015
     C           SINB5     ORNE NTINB5                                                        CSD015
     C           SINB5     ANDNE*BLANKS                                                       CSD015
     C                     MOVE 'Y'       WINBXX  1                                           CSD015
     C                     MOVE 'Y'       WATCH                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRWTCH  - Send transaction details to Compliance Engine      *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWRIT, SRUPDT                                    *                       CSD015
      *  Calls    : SRFRMT, SRCTRP                                    *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Convert Nostro to Customer Details                                                   CSD015
      *                                                                                       CSD015
     C                     MOVELACBN      PINP1                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     EXSR SRFRMT                                                        CSD015
      *                                                                                       CSD015
      ** Set-up parameter for Compliance Engine Program                                       CSD015
      *                                                                                       CSD015
      ** 1st Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   W4IDEN                                              CSD015
     C                     MOVE *BLANKS   W4ITEM                                              CSD015
     C                     MOVE *BLANKS   W4BRCH                                              CSD015
     C                     MOVE *BLANKS   W4SYSM                                              CSD015
     C                     MOVE *BLANKS   W4FUNT                                              CSD015
     C                     MOVE *BLANKS   W4CNUM                                              CSD015
     C                     MOVE *BLANKS   W4CTYP                                              CSD015
     C                     MOVE *BLANKS   W4CUST                                              CSD015
     C                     Z-ADD*ZERO     W4DDAT                                              CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     MOVE *BLANKS   W4DEN1                                              CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Item code                                                                            CSD015
      *                                                                                       CSD015
     C                     MOVEL'FTNOST'  W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELTFRF      W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
      *                                                                                       CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Process Counter Party Details                                                        CSD015
      *                                                                                       CSD015
     C                     EXSR SRCTRP                                                        CSD015
      *                                                                                       CSD015
     C                     MOVELPKEY1     W4CNUM                                              CSD015
     C                     MOVELWCTYP     W4CTYP                                              CSD015
     C                     MOVELWRNRT     W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVEL'NTRANDD' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
      *                                                                                       CSD015
     C                     Z-ADDVDAT      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1                                                                  CSD015
      *                                                                                       CSD015
     C                     MOVELCCY       W4DEN1                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 2                                                                  CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADDAMNT      W4AMT1                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 2                                                                        CSD015
      *                                                                                       CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** 2nd Parameter                                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PXML                                                CSD015
      *                                                                                       CSD015
      ** Destination                                                                          CSD015
      *                                                                                       CSD015
     C           WACBNX    IFEQ 'Y'                                                           CSD015
     C                     MOVELACBN      PINP1                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,1:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,1:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Nostro                                                                               CSD015
      *                                                                                       CSD015
     C           WDESTX    IFEQ 'Y'                                                           CSD015
     C                     MOVELDEST      PINP1                                               CSD015
     C                     MOVELCCY       PCCY                                                CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,2:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,2:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Intermediary Bank + Account Line                                                     CSD015
      *                                                                                       CSD015
     C           WINBXX    IFEQ 'Y'                                                           CSD015
     C                     MOVELNTINB1    PINP1                                               CSD015
     C                     MOVELNTINB2    PINP2                                               CSD015
     C                     MOVELNTINB3    PINP3                                               CSD015
     C                     MOVELNTINB4    PINP4                                               CSD015
     C                     MOVELNTINB5    PINP5                                               CSD015
     C                     EXSR SRFRMT                                                        CSD015
     C           PXML      CAT  OPTAG,3:0 PXML                                                CSD015
     C           PXML      CAT  POUT:0    PXML                                                CSD015
     C           PXML      CAT  CLTAG,3:0 PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Send Transaction Details to Compliance Watch by Calling the                          CSD015
      ** Dummy program that will call the watch list enqine.                                  CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           PSDWLT                                              CSD015
     C                     PARM           PXML                                                CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRFRMT  - Format watch list fields for second parameter      *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWTCH                                            *                       CSD015
      *  Calls    : SDCWLFMT                                          *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRFRMT    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD                                               CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM           PINP2  35                                           CSD015
     C                     PARM           PINP3  35                                           CSD015
     C                     PARM           PINP4  35                                           CSD015
     C                     PARM           PINP5  35                                           CSD015
     C                     PARM           PINP6  35                                           CSD015
     C                     PARM           PCCY    3                                           CSD015
     C                     PARM           POUT  216                                           CSD015
     C                     PARM           POUT2   6                                           CSD015
      *                                                                                       CSD015
      ** Initialize to blanks the input parameters.                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PINP1                                               CSD015
     C                     MOVE *BLANKS   PINP2                                               CSD015
     C                     MOVE *BLANKS   PINP3                                               CSD015
     C                     MOVE *BLANKS   PINP4                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PINP6                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *  SRCTRP - Process counter party details                       *                       CSD015
      *                                                               *                       CSD015
      *  Called by: SRWTCH                                            *                       CSD015
      *  Calls    : AOCUSTR0                                          *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRCTRP    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PKEY1                                               CSD015
     C                     MOVE POUT2     PKEY1                                               CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANK    PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM           PKEY1  10                                           CSD015
     C                     PARM *BLANKS   PKYST   7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SDCUSTPD'W0FILE                                              CSD015
     C                     MOVELPKEY1     W0KEY                                               CSD015
     C                     Z-ADD36        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WCTYP   1                                           CSD015
     C                     MOVE *BLANKS   WCRNM  20                                           CSD015
     C                     MOVE *BLANKS   WRNRT  30                                           CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVELBBCRNM    WCRNM                                               CSD015
     C           BBCRNM    CAT  BBCRTN    WRNRT                                               CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACCT - Moves relevant account data.                        *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACCT    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     MOVE W#CNU1    C#CNU1                                              CGL029
     C                     MOVE W#CCY1    C#CCY1                                              CGL029
     C                     MOVE W#ACO1    C#ACO1                                              CGL029
     C                     MOVE W#ACS1    C#ACS1                                              CGL029
     C                     MOVE W#BRC1    C#BRC1                                              CGL029
     C                     MOVE W#NOSN    C#NOSN                                              242153
     C                     MOVE W#NOS     C#NOS                                               242153
     C                     MOVE W#ACNO    C#ACNO                                              242153
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CSD015
     C********************************************************************
     C*                                                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/EJECT
     O********************************************************************
     O*
     ONTRANDDFE                NTDDF
     O*
     O********************************************************************
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   UPA - Valid Upper Case Characters for SWIFT codewords                S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ/
**   APN - Valid Upper Case Alphabets and Numeric digits codewords                            CSW201
ABCDEFGHIJKLMNOPQRSTUVWXYZ/0123456789                                                         CSW201
**   SWCH - Valid ISO Characters                                          S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789/-?:().,'+
**  Error text                                                            056031
Error occurred on call to program - see dumps for further details
** OPTAG                                                                                      CSD015
<Destination>                                                                                 CSD015
<Nostro>                                                                                      CSD015
<Intermediary Bank>                                                                           CSD015
** CLTAG                                                                                      CSD015
</Destination>                                                                                CSD015
</Nostro>                                                                                     CSD015
</Intermediary Bank>                                                                          CSD015
** Warning text                                                                               210617
WARNING: Value date is a holiday in transaction currency.                                     210617
