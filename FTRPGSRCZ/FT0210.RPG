     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Generation of account keys')                  *
      *****************************************************************
      *                                                               *
      *  Midas - Funds Transfer Module                                *
      *                                                               *
      *  RPG/FT0210 - Generation of Account Keys                      *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CSW220             Date 09Mar20               *
      *                 MD046248           Date 27Oct17               *
      *                 CAP212             Date 15Sep14               *
      *                 CFT120             Date 28Sep12               *
      *                 AR821740           Date 29Aug11               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 251339             Date 14Nov07               *
      *                 BUG15142           Date 25Oct07               *
      *                 BUG15046A          Date 24Oct07               *
      *                 BUG15046           Date 19Nov07               *
      *                 250348             Date 25Sep07               *
      *                 CSW207             Date 08Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 159283             Date 06Jun06               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 218411             Date 27Apr06               *
      *                 239283             Date 13Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 BUG4310            Date 23Sep04               *
      *                 BUG1815            Date 08Apr04               *
      *                 221761             Date 01Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      *                 CSD017             Date 08Nov02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 05Dec00               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      *                 CFT009             Date 01Jun00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187220             Date 23Nov00               *
      *                 187225             Date 23Nov00               *
      *                 187220             Date 22Nov00               *
      *                 187218             Date 21Nov00               *
      *                 187217             Date 21Nov00               *
      *                 187215             Date 21Nov00               *
      *                 185701             Date 31Oct00               *
      *                 185700             Date 31Oct00               *
      *                 185107             Date 17Oct00               *
      *                 184181             Date 09OCT00               *
      *                 184180             DATE 09OCT00               *
      *                 184173             DATE 09OCT00               *
      *                 184060             Date 22Sep00               *
      *                 184050             DATE 25SEP00               *
      *                 183624             Date 09Nov00               *
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 178061             Date 19Apr00               *
      *                 177818             DATE 14Apr00               *
      *                 177808             DATE 14APR00               *
      *                 CFT008             DATE 05JAN00               *
      *                 CFT006             DATE 10DEC99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT004             Date 09Aug99               *
      *                 164670             DATE 21Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 142590             DATE 16MAR99               *
      *                 145660             DATE 26OCT98               *
      *                 CEU013             DATE 07APR98               *
      *                 CEU006             DATE 29MAY98               *
      *                 111825             DATE 17SEP97               *
      *                 CAC002             Date 15Sep96               *
      *                 S01408             Date 30Sep96               *
      *                 CAC001             DATE 01FEB96               *
      *                 S01408             DATE 01MAY96               *
      *                 S01408             DATE 13DEC95               *
      *                 094407             DATE 25OCT95               *
      *                 S01408             DATE 10MAR95               *
      *                 S01408             DATE 11JAN95               *
      *                 S01501             Date 06JUN94               *
      *                 067360             DATE 22FEB94               *
      *                 067359             DATE 08FEB94               *
      *                 S01435             DATE 26AUG93               *
      *                 056031             DATE 07JUN93               *
      *                 055507             DATE 07JUN93               *
      *                 044094             DATE 07JUN93               *
      *                 043860             DATE 21APR93               *
      *                 S01414             DATE 14APR93               *
      *                 038714             DATE 23APR92               *
      *                 051400             DATE 01MAR93               *
      *                 052311             DATE 16MAR93               *
      *                 044283             DATE 17SEP92               *
      *                 E37776             DATE 15JUL91               *
      *                 E32916             DATE 15JUL91               *
      *                 E32917             DATE 22MAY91               *
      *                 E32918             DATE 22MAY91               *
      *                 E32873             DATE 01MAY91               *
      *                 E23466             DATE 06SEP90               *
      *                 E23067             DATE 04SEP90               *
      *                 S01117             DATE 24AUG90               *
      *                 S01194             DATE 24AUG90               *
      *                 E23050             DATE 06AUG90               *
      *                 E18528             DATE 09MAY90               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  CSW220 - SWIFT Changes 2020                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  CAP212 - FT Nostro Transfer API (Recompile)                  *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *  AR821740 - COB - No stamp tax account keys generated         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature                            *
      *  CSW209 - SWIFT 2009 Changes (Recompile)                      *
      *  251339 - FRNT was corrupted when writing to OTPAYDD and      *
      *           INPAYDD.                                            *
      *  BUG15142 - Retrieve IBAN record. Same fix as BUG15046A but   *
      *             coded differently                                 *
      *  BUG15046A - Re-open:SWIFT 2007 COB problems                  *
      *              (FT0510 and FT0560)                              *
      *  BUG15046 - SWIFT 2007 COB problems (FT0510 and FT0560)       *
      *  250348 - Rename TMST field from ACNUMA/ACCNTAB               *
      *           Pattern after fix 242863                            *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  CFT032 - Account line in field 50X in MT103                  *
      *  159283 - Amount posted to credit account different from the  *
      *           actual credit ccy amount entered. Do not recompute  *
      *           credit ccy amount to avoid rounding error. Applied  *
      *           fix 133707.                                         *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  218411 - Posting reference of Request for Transfer credit    *
      *           movement gets corrupted sometimes by other FT       *
      *           transaction. In SR/RFTCRD, move the value of RFTID  *
      *           to PREF field. Also initialize RECI and CQSQ fields.*
      *         - When checking if postings need to be generated for  *
      *           Credit Value Date, field CRDVDT should be used      *
      *           instead of EXDATE (requested execution date).       *
      *  239283 - Incorrect Net Pay Amount for OP deals when Add/De-  *
      *           duct Indicator is "A".  Apply fix 232874.           *
      *  BUG4310- Display Branch is All when no account key is        *
      *           generated.                                          *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  BUG1815- Fix to CGL029.  Wrong return code.                  *
      *  221761 - Recompiled due to change made in PF/FT101HPD.       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information                                         *
      *  CSD017 - Midas Compliance Watch - Anti-Money Laundering      *
      *  CDE002 - Data Export - CCRM Revenue Analysis.                *
      *  CSD006 - Use long DS with SDCURRPD.                          *
      *  CFT009 - FT Fees and Charge Development                      *
      *           Add new account keys for incoming and outgoing      *
      *           payments.                                           *
      *           Swift Standarg Charge,                              *
      *           Miscellaneous charge 1,2,3,4,5                      *
      *  187220 - Correct currency on BIC L key                       *
      *  187225 - Use Funds Transfer Internal Suspense not branch due *
      *  187220 - Correct rate for base equivalent key BODxxccc B and *
      *           BODccc D                                            *
      *  187218 - Correct accounting dates                            *
      *  187217 - Correct base equivalent value                       *
      *  187215 - If outgoing to be generated then use suspense       *
      *  185701 - Correct Accounting Amounts for Mt102s               *
      *  185700 - Only update database if Mode is N                   *
      *  185107 - Mapping of details from swift message - Recompile   *
      *  184181 - First page of report blank                          *
      *  184180 - MT102's (CCT'S) brach code missing on report        *
      *         - Fixed under 184181                                  *
      *  184173 - RFT part of report produces blank pages             *
      *         - Fixed under 184181                                  *
      *  184060 - No transaction type code in detail screen -Recompile*
      *  184050 - Incorrect exchange rate used when calculating the   *
      *           Base Ccy Equiv in RFT Credit Date RICxxCCY B.       *
      *  183624 - If debit and credit settled on different days       *
      *           settle account processing was being accidentally    *
      *           bypassed.                                           *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *  178061 - Wrong Heading In Report                             *
      *  177818 - Fix to MT102 Original Ordered Amount key            *
      *  177808 - FIX TO MT101 OUTWARD RETAIL ACCOUNT                 *
      *  CFT008 - Addition of CCT processing.                         *
      *  CFT006 - Addition of RFT processing.                         *
      *  CFT004 - Straight Through Processing Phase 2                 *
      *         - International Bank Account Numbers                  *
      *  164670 - Ensure that the 'associated customer number' is     *
      *           always a positive number. Move the 18A field to a   *
      *           6A field before moving to 6 digit fld FPASOC.       *
      *  142590 - Re-compiled over changed logical files NTRANBB and  *
      *         - NTRANOB                                             *
      *  145660 - Ensure that prior to writing an account key record  *
      *           for a 'Nostro Transfer', the other ccy field        *
      *           OCCY is initialised to *blanks.                     *
      *  CEU013 - EMU Account Postings Narrative                      *
      *  CEU006 - EMU Funds Transfer Enhancements (Recompile Only)    *
      *  111825 - OEDT MAY BE CORRUPT WHEN WRITING TO OTPAYDD AND     *
      *           INPAYDD.                                            *
      *  CAC002 - Profit Centre Accounting Development - Phase 2:     *
      *           Use the 'Teller Profit Centre' for Draft Issued     *
      *           payment.                                            *
      *  S01408 - Addition of core hook FT0210IIP1                    *
      *           Addition of core hook FT0210FFP1                    *
      *           Addition of core hook FT0210CP46                    *
      *           Addition of core hook FT0210CP45                    *
      *           Addition of core hook FT0210CP44                    *
      *           Addition of core hook FT0210CP43                    *
      *           Addition of core hook FT0210CP42                    *
      *           Addition of core hook FT0210CP41                    *
      *           Addition of core hook FT0210CP40                    *
      *           Addition of core hook FT0210CP39                    *
      *           Addition of core hook FT0210CP38                    *
      *           Addition of core hook FT0210CP37                    *
      *           Addition of core hook FT0210CP36                    *
      *           Addition of core hook FT0210CP35                    *
      *           Addition of core hook FT0210CP34                    *
      *           Addition of core hook FT0210CP33                    *
      *           Addition of core hook FT0210CP32                    *
      *           Addition of core hook FT0210CP31                    *
      *           Addition of core hook FT0210CP30                    *
      *           Addition of core hook FT0210CP29                    *
      *           Addition of core hook FT0210CP28                    *
      *           Addition of core hook FT0210CP27                    *
      *           Addition of core hook FT0210CP26                    *
      *           Addition of core hook FT0210CP25                    *
      *           Addition of core hook FT0210CP24                    *
      *           Addition of core hook FT0210CP23                    *
      *           Addition of core hook FT0210CP22                    *
      *           Addition of core hook FT0210CP21                    *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           Produce new account keys on the following days:     *
      *               Authorised Date                                 *
      *               Settle Date     - Incoming Payments             *
      *               Pay Date        - Outgoing Payments             *
      *               Debit Date      - Cheques to be Paid            *
      *               Settle Date     - Cheques to be Collected       *
      *  S01408 - Addition of core hook FT0210CP20                    *
      *           Addition of core hook FT0210CP19                    *
      *           Addition of core hook FT0210CP18                    *
      *           Addition of core hook FT0210CP17                    *
      *           Addition of core hook FT0210CP16                    *
      *           Addition of core hook FT0210CP15                    *
      *           Addition of core hook FT0210CP14                    *
      *           Addition of core hook FT0210CP13                    *
      *  S01408 - Addition of core hooks FT0210CP11                   *
      *                                  FT0210CP12                   *
      *  094407 - Don not print keys as generated if Account keys is  *
      *           missing or deleted                                  *
      *  S01408 - Addition of core hook FT0210CCP2                    *
      *           Addition of core hook FT0210CCP3                    *
      *           Addition of core hook FT0210CCP5                    *
      *           Addition of core hook FT0210CCP6                    *
      *           Addition of core hook FT0210CCP7                    *
      *           Addition of core hook FT0210CCP8                    *
      *           Addition of core hook FT0210CCP9                    *
      *           Addition of core hook FT0210CP10                    *
      *  S01408 - Addition of core hook FT0210FFPG                    *
      *           Addition of core hook FT0210CCPG                    *
      *           Addition of core hook FT0210CCP1                    *
      *           Addition of core hook FT0210CPDR                    *
      *           Addition of core hook FT0210CPD1                    *
      *           Addition of core hook FT0210CPD2                    *
      *           Addition of core hook FT0210CPD3                    *
      *           Addition of core hook FT0210CPD4                    *
      *           Addition of core hook FT0210CPD5                    *
      *           Addition of core hook FT0210CPD6                    *
      *  S01501 - BLI FX and VAT Account Keys Generation              *
      *  067360 - As this pgm outputs can write more than one P1      *
      *           report for a branch, ensure that a new record is    *
      *           written to FCSFNOPD for second and subsequent       *
      *           reports for a branch.                               *
      *  067359 - Fix to 043860. New code for generating T key on     *
      *           pay date for outgoing payments uses wrong field     *
      *           names when totalling charges                        *
      *  S01435 - Incoming Message Management.                        *
      *  056031 - Correct P#EPSD date in INPAYS for E type processing *
      *         - Call FT0005 to get FT Control Data                  *
      *         - Output event post date to FPKEYDD                   *
      *           This will produce all keys for FT.                  *
      *           Combination of fixes 041693,045014                  *
      *  055507 - Check overflow when writing closing lone on P1      *
      *           report                                              *
      *  044094 - Create all remaining keys if one of settle or       *
      *           pay dates have been reached.                        *
      *           Only for INPAY and OTPAY for now.                   *
      *  043860 - Produce the T key for 'Charges to Debit of'         *
      *           and related charge keys on settle date for added    *
      *           charges and pay date for deducted charges for       *
      *           Incoming payments. Note keys manual is not precise  *
      *           on these keys.                                      *
      *                                                               *
      *           Add to E23067.                                      *
      *                                                               *
      *  S01414 - Book Code and Profit Centre Incorporation.          *
      *  038714 - Field RLPR copied not cleared for cheques etc       *
      *  051400 - The Associated customer number is missing from the  *
      *           Income and Expense posting record for F.T.postings. *
      *  052311 - ARRAY COUNTER IS ONLY RESET IF CHEQUE SEQUENCE NO.  *   #16057
      *           IS 1. THIS MEANS THAT IF CHEQUE NUMBER 1 HAS BEEN   *   #16057
      *           DELETED THE ARRAY WILL NOT BE RESET AND CAN CAUSE   *   #16057
      *           ARRAY INDEX ERROR.                                  *   #16057
      *  044283 - DBASE ERROR IN I/C INIT. FILE ACNUM, KEY 4001289100 *
      *           AT 07 CAUSED BY ACCOUNT BEING CLOSED.               *
      *  E37776 - IF PARAMETER PASSED IS 'S' CHANGE EDAT TO *HIVAL,   *
      *           THIS WILL PRODUCE ALL KEYS FOR FT.                  *
      *  E32916 - Cheques to be Paid settle date accounting           *   E32916
      *           conditioned incorrectly for the credit party.       *   E32916
      *  E32917 - USE OF MDIN ERRATIC IN CQPADS.                      *   E32917
      *  E32918 - When CHARGES TO THE DEBIT OF A/C specified, the T   *   E32918
      *           key gets generated twice, once for Settle date &    *   E32918
      *           once for Pay date.  For consistency, should only    *   E32918
      *           be generated on Settle date.  Caused by E23067.     *   E32918
      *  E32873 - RECI, LCD, AND CHTP MAY BE CORRUPT WHEN             *   E32873
      *           WRITING RECORD TO OTPAY                             *   E32873
      *  E23466 - DB ERROR 06 ONLY SHOWS CUSTOMER NUMBER IN DBKEY     *   E23466
      *           EVEN THOUGH CHAIN WAS TO ACCNTAB - A FULL ACCOUNT   *   E23466
      *           BEING THE KEY | DB ERR 09 CHANGED ALSO              *   E23466
      *  E23067 - THE  TOTAL  CHARGES  ACCOUNT  KEY                   *   E23067
      *           FOR INCOMING PAYMENTS, INPYY    T,                  *   E23067
      *           IS  GENERATED  ON THE SETTLE DATE.                  *   E23067
      *  S01117 - CHANGES FOR MULTIBRANCHING                          *   S01117
      *  S01194 - NEW DATABASE ERROR HANDLING, NEW STANDING DATA      *   S01194
      *  E23050 - CORRECTION  OF THE CHEQUE SEQUENCE                  *   E23050
      *           NUMBER FOR ACCOUNT KEYS CCRYY    D,                 *   E23050
      *                                   CPPYY    E,                 *   E23050
      *                                   CPPYY    D,                 *   E23050
      *                                   CPPYY    W;                 *   E23050
      *           THE  REPORT  AMOUNTS EDITED TO THE                  *   E23050
      *           CORRECT  NUMBER  OF DECIMAL PLACES                  *   E23050
      *           FOR  THE  GIVEN  ACCOUNT  CURRENCY.                 *   E23050
      *  E18528 - EVENT AMOUNT EDITING WRONG ON REPORT FT0210P2       *   E18528
      *                                                               *
      *****************************************************************
     F*OTPAY***UP**E***********K        DISK                              S01117
     F*INPAY***US**E***********K        DISK                              S01117
     F*CQCOD***US**E***********K        DISK                              S01117
     F*CQPAC***US**E***********K        DISK                              S01117
     F*NTRAN***US**E***********K        DISK                              S01117
     FOTPAYBB UP  E           K        DISK                               S01117
     FINPAYBB US  E           K        DISK                               S01117
     FCQCODBB US  E           K        DISK                               S01117
     FCQPACBB US  E           K        DISK                               S01117
     FNTRANBB US  E           K        DISK                               S01117
     FFT101HL0US  E           K        DISK                               184181
     FFT102HL0US  E           K        DISK                               184181
     FOTPAYZZ IS  E           K        DISK
     FINPAYZZ IS  E           K        DISK
     FCQCODZZ IS  E           K        DISK
     FCQCOCZZ IS  E           K        DISK
     FCQPACZZ IS  E           K        DISK
     FCQPADZZ IS  E           K        DISK
     FNTRANZZ IS  E           K        DISK
     F*FT101HL0US**E***********K        DISK                        CFT006184181
     F*FT102HL0US**E***********K        DISK                        CFT008184181
     FFT101DL0UF  E           K        DISK                               CFT006
     FFT102DL0UF  E           K        DISK                               CFT008
     F*                                                                   S01408
     F** Core hook for externalisation.                                   S01408
     F/COPY WNCPYSRC,FT0210FFPG                                           S01408
     F*                                                                   S01408
     FCQMAT   UF  E           K        DISK
     F            CQPACDDF                          KRENAMECQPACA
     F            CQCODDDF                          KRENAMECQCODA
     F*INPAYXL0UF**E***********K********DISK                    UC  CFT014CFT009
     FINPAYXL0UF  E           K        DISK                               CFT009
     F*OTPAYXL0UF**E***********K********DISK                    UC  CFT014CFT009
     FOTPAYXL0UF  E           K        DISK                               CFT009
     F*PYCHGDD*IF**E********************DISK                              S01194
     FTABFP   IF  E           K        DISK
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F************TABLETJF                          KIGNORE               S01117
     F            TABLETPF                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABTE10F                          KIGNORE                                   CGL029
      *                                                                   S01408
     F/COPY WNCPYSRC,FT0210FFP1                                           S01408
      *                                                                   S01408
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUMA  IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMAF
     FFPKEYDD O   E                    DISK                      A
     FFPKEYZZ O   E                    DISK                      A
     FACKEY   IF  E           K        DISK                               094407
     F            ACKEYAKF                          KIGNORE               094407
     F/COPY WNCPYSRC,FT0210F001
     F*FT0210P1O***E********************PRINTER                           S01117
     F*FT0210P2O***E********************PRINTER                           S01117
     F*FT0210AUO***E                   PRINTER      KINFDS SPOOLU  S01117 CFT006
     FFT0210AUO   E             87     PRINTER      KINFDS SPOOLU         CFT006
     FFT0210P1O   E                    PRINTER      KINFDS SPOOL1     UC  S01117
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*                                                                  *
     F* 01   'OTPAYDD' RECORD
     F* 02   'INPAYDD' RECORD
     F* 03   'CQCODDD' RECORD
     F* 04   'CQCOCDD' RECORD
     F* 05   'CQPACDD' RECORD
     F* 06   'CQPADDD' RECORD
     F* 07   'NTRANDD' RECORD
     F*
     F* 10   'OTPAYZZ' RECORD
     F* 11   'INPAYZZ' RECORD
     F* 12   'CQCODZZ' RECORD
     F* 13   'CQCOCZZ' RECORD
     F* 14   'CQPACZZ' RECORD
     F* 15   'CQPADZZ' RECORD
     F* 16   'NTRANZZ' RECORD                                             CFT006
     F* 17   'FT101H ' RECORD                                             CFT006
     F* 18   'FT102H ' RECORD                                             CFT008
     F*
     F* 20   FIRST P1 SPOOL FILE HAS BEEN OPENED FOR A BRANCH             067360
     F**20***FIRST*CYCLE*                                                 S01117
     F* 19   FIRST CYCLE                                                  S01117
     F*
     F* 21-25 WORKING INDICATORS                                          S01117
     F*                                                                   S01117
     F* 30   TRAILER ERROR
     F*
     F* 35   FOR CURRENCIES LOAD
     F*
     F* 40   RUN CONTROL HEADER PRINTED
     F*
     F* 50   NORMAL RUN
     F*
     F* 44   MULTIBRANCHING INDICATOR                                     S01117
     F*                                                                   S01117
     F* 45   INDICATES FIRST RECORD READ FROM MAINTENANCE FILES: OTPAYDD  S01117
     F*       INPAYDD, CQCODDD, CQPACDD, NTRANDD                          S01117
     F*                                                                   S01117
     F* 46-49 INDICATE  LAST RECORD READ FROM MAINTENANCE FILES: OTPAYDD  S01117
     F*       INPAYDD, CQCOCDD, CQPADDD, NTRANDD                          S01117
     F*                                                                   S01117
     F* 72   END OF PAGE INDICATOR FOR REPORT
     F*
     F* 73   NO ACCOUNT KEYS GENERATED INDICATOR
     F*
     F* 88   LOOKUP INDICATOR
     F*
     F* 89   GENERAL ERROR
     F*
     F**97***RECORD*NOT*FOUND*ON*PYCHGDD*                                 S01117
     F*
     E                    CPY@    1   1 80
     E/EJECT
     E                    POWER   1   7  7 3
     E********************FILES   1   7  7                                CFT006
     E                    FILES   1   9  7                                CFT006
     E                    CCYA      150  3  A            * CURRENCY CODES
     E                    CDPA      150  1 0             * CCY DEC. PLACES
     E                    SPTA      150 13 8             * SPOT RATE
     E                    MDA       150  1 0             * MUL/DIV IND.
     E********************CTI#        8 15 0             INTEGER HASH TOTACFT006
     E********************CTD#        8  3 0             DECIMAL HASH TOTACFT006
     E********************CTN#        8  5 0             RECORDS HASH TOTACFT006
     E                    TOT        50 13 0             TOTAL FOR SBCQ UP
     E********************ARR     1   5 23               TRANSACTIONS01117CFT006
     E                    CTI#       10 15 0             INTEGER HASH TOTACFT006
     E                    CTD#       10  3 0             DECIMAL HASH TOTACFT006
     E                    CTN#       10  5 0             RECORDS HASH TOTACFT006
     E                    ARR     1   7 25               TRANSACTION TYPE CFT006
     E**********          CARR      100 18                                             CFT006 CGL029
     E                    CARR      100 24                                                    CGL029
     E/COPY ZSRSRC,ZDATE2Z1
     I/EJECT
     IACKEYALF                                                            094407
     I              RECI                            RECIAK                094407
     I              LCD                             LCDAK                 094407
     I              CHTP                            CHTPAK                094407
     I              AKEY                            EXAKEY                CDL038
     ITABLETLF                                                            S01117
     I              BRCA                            BRCAAC                S01117
     IACCNTABF                                                            S01117
     I              BRCA                            BRCAAC                S01117
     I              PRFC                            PRFCAC                S01414
     I              TMST                            TMSTAC                                    250348
     I              FRNT                            PRFRNT                                    251339
     IACNUMAF                                                             S01117
     I              BRCA                            BRCAAC                S01117
     I              PRFC                            PRFCAC                S01414
     I              TMST                            TMSTAC                                    250348
     I              FRNT                            PRFRNT                                    251339
     I/EJECT                                                              S01117
     I*   DETAIL RECORD'S
     IOTPAYDDF    01
     I              RECI                            OTRECI                E32873
     I              LCD                             OTLCD                 E32873
     I              CHTP                            OTCHTP                E32873
     I              OEDT                            OTOEDT                111825
     I              FRNT                            OTFRNT                                    251339
     IINPAYDDF    02
     I              RECI                            INRECI                E32873
     I              LCD                             INLCD                 E32873
     I              CHTP                            INCHTP                E32873
     I              OEDT                            INOEDT                111825
     I              FRNT                            IPFRNT                                    251339
     ICQCODDDF    03
     I              RECI                            CDRECI                E32873
     I              LCD                             CDLCD                 E32873
     I              CHTP                            CDCHTP                E32873
     I              BOKC                            CDBOKC                S01414
     I              PRFC                            CDPRFC                S01414
     I              OEDT                            CDOEDT                111825
     ICQCOCDDF    04
     I              RECI                            CCRECI                E32873
     I              LCD                             CCLCD                 E32873
     I              CHTP                            CCCHTP                E32873
     I              BOKC                            CCBOKC                S01414
     I              PRFC                            CCPRFC                S01414
     I              OEDT                            CCOEDT                111825
     ICQPACDDF    05
     I              RECI                            PCRECI                E32873
     I              LCD                             PCLCD                 E32873
     I              CHTP                            PCCHTP                E32873
     I              BOKC                            PCBOKC                S01414
     I              PRFC                            PCPRFC                S01414
     I              OEDT                            PCOEDT                111825
     ICQPADDDF    06
     I              RECI                            PDRECI                E32873
     I              LCD                             PDLCD                 E32873
     I              CHTP                            PDCHTP                E32873
     I              BOKC                            PDBOKC                S01414
     I              PRFC                            PDPRFC                S01414
     I              OEDT                            PDOEDT                111825
     INTRANDDF    07
     I              RECI                            RNRECI                E32873
     I              LCD                             RNLCD                 E32873
     I              CHTP                            RNCHTP                E32873
     I              OEDT                            RNOEDT                111825
     IFT101HD0    17                                                      CFT006
     I              SINST                           RSINST                CFT006
     I              INDATE                          RHINDT                CFT006
     IFT102HD0    18                                                      CFT008
     I              SINST                           CSINST                CFT008
     I              INDATE                          CHINDT                CFT008
     I              ORDITP                          HOITYP                CFT008
     I              CCTAMT                          HTFAMT                CFT008
     I              CCTCCY                          HTFCCY                CFT008
     I*   TRAILER RECORD'S
     IOTPAYZZF    10
     IINPAYZZF    11
     ICQCODZZF    12
     ICQCOCZZF    13
     ICQPACZZF    14
     ICQPADZZF    15
     INTRANZZF    16
     IINPAYXDF                                                            CFT014
     I              INRECI                          IXRECI                CFT014
     I/EJECT
     IDLDA        DS                            256
     I***
     I***   LOCAL DATA AREA  -  DATABASE ERRORS
     I***
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     ISPOOL1      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I* DATA STRUCTURE FOR ACCESS PROGRAM                                 S01117
     I*
     ISDFTFR    E DSSDFTFRPD                                              S01117
     I* EXTERNAL DS FOR SDFTFRPD DETAILS                                  S01117
     I*                                                                   S01117
     ISCSARD    E DSSCSARDPD                                              S01501
     I* Sar Text details *                                                S01501
     I*                                                                   CAC001
     ISDMMOD    E DSSDMMODPD                                              CAC001
     I**  External DS for Module Details                                  CAC001
     I*                                                                   CAC002
     ISDTCHG    E DSSDTCHGPD                                              CAC002
     I**  External DS for RTS Default Charges Transaction Type Details    CAC002
     I*                                                                   S01501
      *                                                                   CFT006
     ISDACOD    E DSSDACODPD                                                                  CGL029
     ISDCURR    E DSSDCURRPD                                              CFT006
     ISDBRCH    E DSSDBRCHPD                                              CFT006
      *                                                                   CFT014
     ISDGELR    E DSSDGELRPD                                              CFT014
     I              QQACCD                          QQACC1                                    CGL029
      ** Data structure for GL ICD                                        CFT014
      *                                                                   CFT014
      **IBAN*FORMAT*********************************************** CFT006 CFT014
     I***P@FMT***  E DSACCNTCNT                                    CFT006 CFT014
     I***********   CNUM                            ACCNUM         CFT006 CFT014
     I***********   CCY                             ACCCY          CFT006 CFT014
     I***********   ACOD                            ACACOD         CFT006 CFT014
     I***********   ACSQ                            ACACSQ         CFT006 CFT014
      *                                                                   CFT006
     IINFT      E DSMEINFTPD                                              S01435
      *                                                                   S01435
      *  Define parameters to be passed for FT IMM update                 S01435
      *                                                                   S01435
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     I***   DATA AREA TO REDEFINE ACCOUNT KEY
     I***
     I*AKEY********DS                                                     CDL038
     I            DS                                                      CDL038
     I                                        1  14 EXAKEY                CDL038
     I***********                             1  10 AKEY                             CDL038 AR821740
     I                                        1  14 AKEY                                    AR821740
     I                                        1   2 PYTP
     I                                        3   3 KDATE
     I                                        4   5 PYST
     I***********                             6   9 KCCY                  CAC001
     I                                        6   8 KCCY                  CAC001
     I                                        9   9 KCTYP                 CAC001
     I                                       10  10 KPYRE
     I***
     I***   DATA AREA TO REDEFINE SETTLEMENT ACCOUNT KEY
     I***
     I            DS
     I****************************************1  15 SETAC                 S01117
     I**********                              1  18 SETAC                              S01117 CGL029
     I                                        1  24 SETAC                                     CGL029
     I**********                              1   60CNUMX                                     CSD027
     I                                        1   6 CNUMX                                     CSD027
     I                                        7   9 CCYX
     I**********                             10  130ACODX                                     CGL029
     I**********                             14  150ACSQX                                     CGL029
     I**********                             16  18 BRCHX                              S01117 CGL029
     I                                       10  190ACODX                                     CGL029
     I                                       20  210ACSQX                                     CGL029
     I                                       22  24 BRCHX                                     CGL029
     I***                                                                 E23466
     I***   DATA STRUCTURE TO DEFINE KEY FOR DB ERROR 06 AND 09           E23466
     I***                                                                 E23466
     I            DS                                                      E23466
     I                                        1  15 ACNKDB                E23466
     I                                        1   60CNUMDB                E23466
     I                                        7   9 CCY                   E23466
     I**********                             10  130ACOD                               E23466 CGL029
     I                                       14  150ACSQ                  E23466
     I***
     I***   DATA STRUCTURE TO SUB DIVIDE TABLE KEY FIELD - TABTG10
     I***
     I            DS
     I                                        1  12 KEY
     I                                        1   2 RECTTB
     I                                        9  11 CCYTB
     I                                       12  12 SRECTB
     I*
     I*     DATA AREA TO REDEFINE RETAIL PARTY
     I*
     IPARTY       DS
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 SMCYY
     I**********                              7  100PACOD                                     CGL029
     I**********                             10  130ACODN                                     CGL029
     I**********                             11  120PACSQ                                     CGL029
     I**********                             13  15 PBRCH                              S01117 CGL029
     I**********                             14  150ACSQN                                     CGL029
     I**********                             16  18 BRCHN                              S01117 CGL029
     I                                        7  160PACOD                                     CGL029
     I                                       10  190ACODN                                     CGL029
     I                                       17  180PACSQ                                     CGL029
     I                                       19  21 PBRCH                                     CGL029
     I                                       20  210ACSQN                                     CGL029
     I                                       22  24 BRCHN                                     CGL029
      *                                                                   056031
      *  Input parameters data structure from FT0005                      056031
      *                                                                   056031
     IC#CNTL      DS                            256                       056031
     I                                        1   1 C#PDTI                056031
     I                                        2   3 C#CCYI                056031
     I                                        4   4 C#GLUI                056031
     I                                        5   5 C#TPCI                056031
     I*                                                                   CFT006
     I*                                                                   CFT004
     IDSSDY     E DSDSSDY                                                 CFT004
     I*                                                                   CFT004
     I** Second DS for access programs, long data structure               CFT004
     I*                                                                   CFT004
     I*                                                                   CFT004
     I** Data structure for AOIBANR4                                      CFT004
     I*                                                                   CFT004
     I***ACNT***     DS                            485                                 CFT004 CGL029
     IACNT        DS                            573                       CFT004              CGL029
     I**********                              2   70S4CNUM                             CFT004 CSD027
     I                                        2   7 S4CNUM                                    CSD027
     I                                        8  10 S4CCY                 CFT004
     I**********                             11  140S4ACOD                             CFT004 CGL029
     I                                       11  140QQACOD                                    CGL029
     I                                       15  160S4ACSQ                CFT004
     I                                       23  25 S4BRCA                CFT004
     I                                      554 5630S4ACOD                                    CGL029
     INEWFMT      DS                                                      CFT006
     I**********                              1  18 NEWFLD                             CFT006 CGL029
     I**********                              1  24 NEWFLD                           CGL029 BUG15046
     I                                        1  34 NEWFLD                                  BUG15046
     I                                        1   3 XBRCA                 CFT006
     I                                        4   9 XCNUM                 CFT006
     I**********                             10  13 XACC                               CFT006 CGL029
     I**********                             14  16 XCCY                               CFT006 CGL029
     I*                                      10  19 XACC                                      CGL029
     I*                                      20  21 XCCY                                      CGL029
     I                                       10  12 XCCY                  CFT006
     I**********                             13  16 XACC                               CFT006 CGL029
     I**********                             17  18 XSEQ                               CFT006 CGL029
     I                                       13  22 XACC                                      CGL029
     I                                       23  24 XSEQ                                      CGL029
     IOLDFMT      DS                                                      CFT006
     I**********                              1  18 OLDFLD                             CFT006 CGL029
     I**********                              1  24 OLDFLD                           CGL029 BUG15046
     I                                        1  34 OLDFLD                                  BUG15046
     I                                        1   6 YCNUM                 CFT006
     I                                        7   9 YCCY                  CFT006
     I**********                             10  13 YACC                               CFT006 CGL029
     I**********                             14  15 YSEQ                               CFT006 CGL029
     I**********                             16  18 YBRCA                              CFT006 CGL029
     I                                       10  19 YACC                                      CGL029
     I                                       20  21 YSEQ                                      CGL029
     I                                       22  24 YBRCA                                     CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0210IIP1                                           S01408
     I*                                                                   S01408
      /EJECT                                                              CFT006
     I*MOCDS****** DS                        100                    CFT006187220
     IMOCDS       DS                        256                           187220
      * Ordering Customer                                                 CFT006
     I**********                              1  18 MOC                                CFT006 CGL029
     I                                        1  18 QQMOC                                     CGL029
      * Total Transfer Amount                                             CFT006
     I                                       19  330TTLTFR                CFT006
      * Sum of senders Charges                                            CFT006
     I                                       34  470SUMSC                 CFT006
      * Sum of receivers charges where details of charges = OUR           CFT006
     I                                       48  610RCGOUR                CFT006
      * Save currency code : Transaction                                  CFT006
     I                                       62  64 SPYCCY                CFT006
      * Save currency code : Account                                      CFT006
     I                                       65  67 SACCCY                CFT006
      * Save CCTID                                                        CFT006
     I                                       68  82 SCCTID                CFT006
      * Sum of senders charges if OUR or SHA                              CFT006
     I                                       83  950SNDOSH                CFT006
      *                                                                   CFT006
     I I                                     96  98 SVDOC                 CFT006
      * Receivers charges in PAY currency                                 CFT006
     I                                       99 1110RCVPAY                CFT006
      * Pay base ccy equivalent rate                                      187220
     I                                      112 1248PABCQS                187220
      * Transfer base currency equivalent rate                            187220
     I                                      125 1378TABCQS                187220
     I                                      138 161 MOC                                       CGL029
      *                                                                   056031
     IFLD19       DS                                                      CFT006
     I                                        1   1 FST1                  CFT006
     I**********                              2  19 SND18                              CFT006 CGL029
     I**********                              1  18 FST18                              CFT006 CGL029
     I**********                              2  25 SND18                            CGL029 BUG15046
     I**********                              1  24 FST18                            CGL029 BUG15046
     I                                        2  35 SND18                                   BUG15046
     I                                        1  34 FST18                                   BUG15046
     I                                       12  12 CHAR12                CFT006
     IWPIBAN      DS                                                                       BUG15046A
     I                                        1   1 SLASH1                                 BUG15046A
     I                                        2  34 WVIBAN                                 BUG15046A
     I*                                                                                       CGL020
     I** Funds Transfer Settlement Fields Extractor Program Name                              CGL020
     I*                                                                                       CGL020
     I              'ZAAMLSETFT'          C         SETFT                                     CGL020
     I              'SWIFTACTV'           C         SWIFT                                     CSW220
      *                                                                   056031
     C                     MOVEACPY@      BIS@   80
     C/EJECT
     C*
     C**N20****************EXSR FIRST                                     S01117
     C           *IN19     IFNE '1'                                       S01117
     C/COPY WNCPYSRC,FT0210C034
     C                     EXSR FIRST                                     S01117
     C                     END                                            S01117
     C*
     C* DETAIL PROCESSING
     C*
      *                                                                   056031
      *  Reset Event post date to today                                   056031
      *                                                                   056031
     C                     Z-ADDRUND      P#EPSD                          056031
     C                     Z-ADDRUND      S#EPSD                          056031
      *                                                                   CDE002
      ** Initialise transaction identifier                                CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE *BLANKS   FPTRID                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   056031
     C      01             EXSR OTPAYS                     OUTGOING PAYMEN
     C      02             EXSR INPAYS
      *                                                                   038714
      * Clear RLPR if processing record types for cheques and nostros     038714
      *                                                                   038714
     C           *IN03     IFEQ '1'                                       038714
     C           *IN04     OREQ '1'                                       038714
     C           *IN05     OREQ '1'                                       038714
     C           *IN06     OREQ '1'                                       038714
     C           *IN07     OREQ '1'                                       038714
     C                     MOVEL*BLANKS   RLPR                            038714
     C                     END                                            038714
      *                                                                   038714
     C      03             EXSR CQCODS
     C      04             EXSR CQCOCS
     C      05             EXSR CQPACS
     C      06             EXSR CQPADS
     C      07             EXSR NTRANS                                    CFT006
     C      17             EXSR RFTHDR                                    CFT006
     C      18             EXSR CCTHDR                                    CFT008
     C*
     C* TRAILER PROCESSING
     C*
     C* OTPAY TRAILER
     C*
     C   10                Z-ADD1         H
     C   10                EXSR TRAIL
     C*
     C* INPAY TRAILER
     C*
     C   11                Z-ADD2         H
     C   11                EXSR TRAIL
     C*
     C* CQCOD TRAILER
     C*
     C   12                Z-ADD3         H
     C   12                EXSR TRAIL
     C*
     C* CQCOD TRAILER
     C*
     C   13                Z-ADD4         H
     C   13                EXSR TRAIL
     C*
     C* CQPAC TRAILER
     C*
     C   14                Z-ADD5         H
     C   14                EXSR TRAIL
     C*
     C* CQPAD TRAILER
     C*
     C   15                Z-ADD6         H
     C   15                EXSR TRAIL
     C*
     C* NTRAN TRAILER
     C*
     C   16                Z-ADD7         H
     C   16                EXSR TRAIL
     C*
     C* FINAL PROCESSING
     C*
     CLR                   EXSR LAST
     C*
     C************************************************************
     C* KLISTS
     C*
     C* FOR ACCNT
     C*
     C           ACNK      KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCAAC                          S01117
     C/COPY WNCPYSRC,FT0210C031
     C*
     C************************************************************
     C/EJECT
      ************************************************************                            CGL020
      * SRFEEC - Calculate fee fields                                                         CGL020
      ************************************************************                            CGL020
     C           SRFEEC    BEGSR                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       F1FFLG                                              CGL020
     C                     Z-ADDWKNUME    F1FVAL                                              CGL020
      *                                                                                       CGL020
     C           WKDENO    IFNE 0                                                             CGL020
     C           WKNUME    DIV  WKDENO    WKPRCT 134H                                         CGL020
     C                     MULT 100       WKPRCT                                              CGL020
     C                     Z-ADDWKPRCT    F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      ************************************************************                            CGL020
      /EJECT                                                                                  CGL020
     C************************************************************
     C* FIRST SR.
     C* PERFORM FIRST CYCLE ROUTINES
     C************************************************************
     C*
     C           FIRST     BEGSR
     C*
     C*********************SETON                     20                   S01117
     C                     SETON                     19                   S01117
     C*                                                                   S01117
     C* CALL ZSFILE TO LOG SPOOL FILE DETAILS FOR AUDIT REPORT            S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUM                           S01117
     C                     MOVELSFILEU    ZSNAM                           S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           ZSEQ    5                       S01117
     C                     PARM *BLANKS   ZENT    3                       S01117
     C                     PARM           ZSNAM  10                       S01117
     C                     PARM           ZSNUM   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0210'  DBPGM            ***************S01117
     C                     MOVEL'FT0210AU'DBKEY            ** DBERR  17 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD17        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     Z-ADD20        A       20                      S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN LDA       DLDA
     C* READ TABTB10 FOR SYSTEM TITLE AND RUN DATE
     C                     MOVEL'01    '  KEY
     C                     MOVE '    10'  KEY
     C           KEY       CHAINTABFP                89
     C  N89      RECI      COMP 'D'                  8989
     C   89                DO                              B001
     C*********************MOVE 'TABLE'   WFILE   5        ***************S01194
     C*********************MOVELKEY       WKEY   28        ** DBERR  01 **S01194
     C*********************Z-ADD1         WBASE   20       ***************S01194
     C                     MOVE 'TABFP'   WFILE                           S01194
     C                     MOVELKEY       WKEY                            S01194
     C                     Z-ADD1         WBASE                           S01194
     C                     EXSR DBERR
     C                     END                             E001
     C*
     C*********************Z-ADD1         PPAGE            'SET PAGE=1    S01117
     C*********************WRITEP2HEAD                     'HEADINGS      S01117
     C*
     C           DATF      COMP 'M'                      98 'DATE
     C**                                                    'FORMAT
     C*
     C* READ TABTB11 FOR NEXT WORKING DAY AND ACCRUAL PROFIT DATE
     C                     MOVE '11'      KEY
     C           KEY       CHAINTABFP                89    ON NOT THERE
     C  N89      RECI      COMP 'D'                  8989
     C   89                DO                              B001
     C*********************MOVE 'TABLE'   WFILE            ***************S01194
     C                     MOVE 'TABFP'   WFILE            ***************S01194
     C                     MOVELKEY       WKEY             ** DBERR  02 **
     C                     Z-ADD2         WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E001
     C*                                                                   S01117
     C** SETON MULTIBRANCHING INDICATOR                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     44                   S01117
     C                     END                                            S01117
     C*
     C*   CALCULATE  'EVENT CONTROL DATE'
     C*   EVENT DATE IS ACCRUAL/PROFIT DATE OR DATE OF NEXT WORKING
     C*   DAY -1 WHICHEVER IS THE EARLIER
     C*
     C           DNWD      SUB  1         DNWD
     C           APDA      IFLT DNWD                       B001
     C                     Z-ADDAPDA      EDAT    50
     C                     ELSE                            X001
     C                     Z-ADDDNWD      EDAT
     C                     END                             E001
     C*                                                                   E37776
     C**   IF RMODE IS 'S' SET EDAT TO *HIVAL                             E37776
     C*                                                                   E37776
     C           RMODE     IFEQ 'S'                                       E37776
     C                     Z-ADD*HIVAL    EDAT                            E37776
     C                     END                                            E37776
      *                                                                   CFT014
     C**********           CALL 'AOGELRR0'                                CFT014              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7                       CFT014
     C                     PARM '*FIRST'  POPTN   7                       CFT014
     C********** SDGELR    PARM SDGELR    DSFDY                           CFT014              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           PRTCD     IFNE *BLANKS                                   CFT014
     C                     Z-ADD029       WBASE                           CFT014
     C                     MOVEL'*FIRST  'WKEY                            CFT014
     C                     MOVEL'SDGELRPD'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C**
     C**   BUILD UP CURRENCIES/DEC. POSITIONS ARRAYS
     C**   FROM TABTG20
     C                     MOVEL'20    '  KEY
     C                     MOVE '      '  KEY
     C                     Z-ADD1         Z       30
     C*
     C           KEY       SETLLTABFP
     C*
     C           *IN35     DOWEQ'0'                        B002
     C                     READ TABFP                    35
     C           RECI      IFEQ 'D'                        B003
     C           RECTTB    IFNE '20'                       B004
     C                     SETON                         35
     C                     ELSE                            X004
     C*
     C           SRECTB    IFEQ '1'                        B005
     C                     MOVE CCYTB     CCYA,Z
     C                     Z-ADDCDP       CDPA,Z
     C                     MOVE MDIN      MDA,Z
     C                     Z-ADDSPOT      SPTA,Z
     C                     ADD  1         Z
     C           Z         IFGT 150                        B006
     C                     SETON                     35
     C                     END                             E006
     C                     END                             E005
     C                     END                             E004
     C*
     C                     END                             E003
     C                     END                             E002
     C*
     C** DECIMAL POSITIONS FOR 'BASE' CURRENCY
     C*
     C                     Z-ADD1         Z       30
     C           BCCY      LOKUPCCYA,Z                   88
     C*
     C  N88                DO                              B001
     C                     MOVELBCCY      WKEY             ***************
     C*********************MOVE 'TABLE'   WFILE            * DB ERROR 03 *S01194
     C                     MOVE 'TABTG20' WFILE            * DB ERROR 03 *S01194
     C                     Z-ADD3         WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E001
     C                     MOVE CDPA,Z    BCDP    10
      *
      ***Get*branch*internal*customer*no.*for*suspense*a/c*no.*           S01117
      *********************                                               S01117
     C*********************MOVE *BLANKS   KEY                             S01117
     C*********************MOVEL'10    '  KEY                             S01117
     C*********************MOVE FTDB      KEY                             S01117
     C***********KEY*******CHAINTABFP                89                   S01117
     C**N89******RECI******COMP 'D'                  8989                 S01117
     C***89****************DO                              B001           S01117
     C*********************MOVE 'TABLE'   WFILE   5        ***************S01117
     C*********************MOVELKEY       WKEY   28        ** DBERR  13 **S01117
     C*********************Z-ADD13        WBASE   20       ***************S01117
     C*********************EXSR DBERR                                     S01117
     C*********************END                             E001           S01117
      *********************                                               S01117
      ***Get*a/c*code*for*suspense*account*no.*                           S01194
      *********************                                               S01194
     C***********1*********CHAINPYCHGDD              97                   S01194
     C************IN97*****IFEQ '1'                        B001           S01194
     C*********************MOVEL'1'       WKEY             ***************S01194
     C*********************MOVE 'PYCHG'   WFILE            * DB ERROR 14 *S01194
     C*********************Z-ADD14        WBASE            ***************S01194
     C*********************EXSR DBERR                                     S01194
     C*********************END                             E001           S01194
     C*********************CLOSEPYCHGDD                                   S01194
     C*********************                                               S01194
     C** CALL TO FUNDS TRANSFER ACCESS PGM                                S01194
     C** READ SDFTFRPD FILE                                               S01194
     C*                                                                   S01194
     C                     CALL 'AOFTFRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDFTFR    PARM SDFTFR    DSFDY                           S01194
     C*                                                                   S01194
     C* IF NO RECORD FOUND ON SDFTFRPD,DATABASE ERROR PROCESSING          S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE 'SDFTFRPD'WFILE            ***************S01194
     C                     MOVEL@OPTN     WKEY             * DB ERROR 14 *S01194
     C                     Z-ADD14        WBASE            ***************S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C           *LIKE     DEFN BTIOSA    WWIOSA                          187225
     C                     MOVELBTIOSA    WWIOSA                          187225
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP21                                           S01408
     C*                                                                   S01408
     C*                                                                   CAC001
     C**  Access Midas Modules details.                                   CAC001
     C*                                                                   CAC001
     C                     CALL 'AOMMODR0'                                CAC001
     C                     PARM '*MSG   ' @RTCD                           CAC001
     C                     PARM '*FIRST ' @OPTN                           CAC001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC001
     C*                                                                   CAC001
     C           @RTCD     IFNE *BLANKS                                   CAC001
     C                     MOVE 'SDMMODPD'WFILE            ************   CAC001
     C                     MOVEL@OPTN     WKEY             * DBERR 22 *   CAC001
     C                     Z-ADD22        WBASE            ************   CAC001
     C                     EXSR DBERR                                     CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC002
     C**  Check if Retail Teller System (CRT001) SAR is installed.        CAC002
     C*                                                                   CAC002
     C                     CALL 'AOSARDR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*VERIFY' @OPTN                           CAC002
     C                     PARM 'CRT001'  @SARD                           CAC002
     C           SCSARD    PARM SCSARD    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFEQ *BLANKS                                   CAC002
     C                     MOVE 'Y'       CRT001  1                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE 'N'       CRT001                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C**  If Retail Teller System is installed, access RTS Default        CAC002
     C**  Charges Transaction Type details.                               CAC002
     C*                                                                   CAC002
     C           CRT001    IFEQ 'Y'                                       CAC002
     C*                                                                   CAC002
     C                     CALL 'AOTCHGR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDTCHG    PARM SDTCHG    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C                     MOVE 'SDTCHGPD'WFILE            ************   CAC002
     C                     MOVEL@OPTN     WKEY             * DBERR 23 *   CAC002
     C                     Z-ADD23        WBASE            ************   CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CEU013
     C**  Access SAR details file to see if CEU013 is installed.          CEU013
     C*                                                                   CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' @RTCD   7                       CEU013
     C                     PARM '*VERIFY' @OPTN   7                       CEU013
     C                     PARM 'CEU013'  WSARD   6                       CEU013
     C*                                                                   CEU013
     C           @RTCD     IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'N'       CEU013                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*                                                                   CFT006
     C**  Access SAR details file to see if CFT006 is installed.          CFT006
     C*                                                                   CFT006
     C                     CALL 'AOSARDR0'                                CFT006
     C                     PARM '       ' @RTCD   7                       CFT006
     C                     PARM '*VERIFY' @OPTN   7                       CFT006
     C                     PARM 'CFT006'  WSARD   6                       CFT006
     C*                                                                   CFT006
     C           @RTCD     IFEQ *BLANK                                    CFT006
     C                     MOVE 'Y'       CFT006  1                       CFT006
     C                     ELSE                                           CFT006
     C                     MOVE 'N'       CFT006                          CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT008
     C**  Access SAR details file to see if CFT008 is installed.          CFT008
     C*                                                                   CFT008
     C                     CALL 'AOSARDR0'                                CFT008
     C                     PARM '       ' @RTCD   7                       CFT008
     C                     PARM '*VERIFY' @OPTN   7                       CFT008
     C                     PARM 'CFT008'  WSARD   6                       CFT008
     C*                                                                   CFT008
     C           @RTCD     IFEQ *BLANK                                    CFT008
     C                     MOVE 'Y'       CFT008  1                       CFT008
     C                     ELSE                                           CFT008
     C                     MOVE 'N'       CFT008                          CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT004
      *** Check if CFT004 is switched on                                  CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM '       ' @RTCD   7                       CFT004
     C                     PARM '*VERIFY' @OPTN   7                       CFT004
     C                     PARM 'CFT004'  @SARD   6                       CFT004
      *                                                                   CFT004
     C           @RTCD     IFEQ *BLANK                                    CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      ** Check if CDE002 is switched on                                   CDE002
      *                                                                   CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM '       ' @RTCD                           CDE002
     C                     PARM '*VERIFY' @OPTN                           CDE002
     C                     PARM 'CDE002'  @SARD                           CDE002
      *                                                                   CDE002
     C           @RTCD     IFEQ *BLANK                                    CDE002
     C                     MOVE 'Y'       CDE002  1                       CDE002
     C                     ELSE                                           CDE002
     C                     MOVE 'N'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
      *                                                                   CFT009
      * Access switchable features to see if CFT009 and CFT011 are        CFT009
      *  on                                                               CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM '       ' @RTCD   7                       CFT009
     C                     PARM '*VERIFY' @OPTN   7                       CFT009
     C                     PARM 'CFT009'  WSARD   6                       CFT009
     C*                                                                   CFT009
     C           @RTCD     IFEQ *BLANK                                    CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT009                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM '       ' @RTCD   7                       CFT009
     C                     PARM '*VERIFY' @OPTN   7                       CFT009
     C                     PARM 'CFT011'  WSARD   6                       CFT009
     C*                                                                   CFT009
     C           @RTCD     IFEQ *BLANK                                    CFT009
     C                     MOVE 'Y'       CFT011  1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT011                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C*                                                                   S01194
     C** DECLARE ENTRY PARAMETER - RUN MODE TYPE
     C*
     C           *ENTRY    PLIST
     C                     PARM           RMODE   1
     C           RMODE     COMP 'N'                      50
     C*
     C                     WRITEFT0210F1               89
      *                                                                   056031
      * Access FT Control data                                            056031
      *                                                                   056031
     C                     CALL 'FT0005'               9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C           C#CNTL    PARM           O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL'   WKEY             ***************056031
     C                     MOVE 'FT0005'  WFILE            * DB ERROR 44 *056031
     C                     Z-ADD44        WBASE            ***************056031
     C                     EXSR DBERR                                     056031
     C                     MOVEL*BLANKS   R#RTN   7                       056031
     C                     END                                            056031
      *                                                                   056031
      * Set up posting date indicator                                     056031
      *                                                                   056031
     C                     MOVELC#PDTI    C#GPFG  1                       056031
     C/COPY WNCPYSRC,FT0210C018
      *                                                                   056031
     C                     SETON                     40
     C*                                                                   S01501
     C** Access SAR details file to determine if S01501 is switched ON    S01501
     C*                                                                   S01501
     C                     CALL 'AOSARDR0'                                S01501
     C                     PARM *BLANKS   @RTCD   7                       S01501
     C                     PARM '*VERIFY' @OPTN   7                       S01501
     C                     PARM 'S01501'  @SARD   6                       S01501
     C           SCSARD    PARM SCSARD    DSFDY                           S01501
     C*                                                                   S01501
     C** If core feature is switched ON, set a variable field to          S01501
     C** condition the rest of the processing                             S01501
     C*                                                                   S01501
     C           @RTCD     IFEQ *BLANKS                                   S01501
     C                     MOVE 'S01501'  S01501  6                       S01501
     C                     ELSE                                           S01501
     C*                                                                   S01501
     C** else, database error (return code other than *NRF)               S01501
     C*                                                                   S01501
     C           @RTCD     IFNE '*NRF   '                                 S01501
     C                     MOVEL'S01501'  WKEY             ************   S01501
     C                     MOVE 'SCSARDPD'WFILE            * DBERR 21 *   S01501
     C                     Z-ADD21        WBASE            ************   S01501
     C                     EXSR DBERR                                     S01501
     C                     END                                            S01501
     C                     END                                            S01501
     C*
     C                     MOVE 'N'       CFT014  1                       CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   PRTCD                           CFT014
     C                     PARM '*VERIFY' POPTN                           CFT014
     C                     PARM 'CFT014'  PSARD   6                       CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
     C           PRTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014                          CFT014
     C*********************OPEN INPAYXL0                            CFT014CFT009
     C*********************OPEN OTPAYXL0                            CFT014CFT009
     C                     ELSE                                           CFT014
     C           PRTCD     IFNE '*NRF   '                                 CFT014
     C                     Z-ADD024       WBASE                           CFT014
     C                     MOVEL'CFT014  'WKEY                            CFT014
     C                     MOVEL'SCSARDPD'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CSD017
      ** Check if Compliance Watch - AML Interface is installed                               CSD017
      *                                                                                       CSD017
     C                     MOVE 'N'       CSD017  1                                           CSD017
     C                     CALL 'AOSARDR0'                                                    CSD017
     C                     PARM *BLANKS   PRTCD                                               CSD017
     C                     PARM '*VERIFY' POPTN                                               CSD017
     C                     PARM 'CSD017'  PSARD   6                                           CSD017
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD017
      *                                                                                       CSD017
     C           PRTCD     IFEQ *BLANKS                                                       CSD017
     C                     MOVE 'Y'       CSD017                                              CSD017
     C                     ELSE                                                               CSD017
      *                                                                                       CSD017
     C           PRTCD     IFNE '*NRF   '                                                     CSD017
     C                     Z-ADD031       WBASE                                               CSD017
     C                     MOVEL'CSD017  'WKEY                                                CSD017
     C                     MOVEL'SCSARDPD'WFILE                                               CSD017
     C                     EXSR DBERR                                                         CSD017
     C                     ENDIF                                                              CSD017
      *                                                                                       CSD017
     C                     ENDIF                                                              CSD017
      *                                                                                       CGL020
      ** Access SAR details to see if CGL020 is enabled.                                      CGL020
      *                                                                                       CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   PRTCD                                               CGL020
     C                     PARM '*VERIFY' POPTN                                               CGL020
     C                     PARM 'CGL020'  PSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C           PRTCD     IFEQ *BLANKS                                                       CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE '*NRF'                                                        CGL020
     C                     Z-ADD032       WBASE                                               CGL020
     C                     MOVEL'CGL020'  WKEY                                                CGL020
     C                     MOVEL'SCSARDPD'WFILE                                               CGL020
     C                     EXSR DBERR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CFT120
      ** Access SAR details to see if CFT120 is enabled.                                      CFT120
      *                                                                                       CFT120
     C                     CALL 'AOSARDR0'                                                    CFT120
     C                     PARM *BLANKS   PRTCD                                               CFT120
     C                     PARM '*VERIFY' POPTN                                               CFT120
     C                     PARM 'CFT120'  PSARD                                               CFT120
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT120
      *                                                                                       CFT120
     C                     MOVE 'N'       CFT120  1                                           CFT120
     C           PRTCD     IFEQ *BLANKS                                                       CFT120
     C                     MOVE 'Y'       CFT120                                              CFT120
     C                     ELSE                                                               CFT120
      *                                                                                       CFT120
     C           PRTCD     IFNE '*NRF'                                                        CFT120
     C                     Z-ADD033       WBASE                                               CFT120
     C                     MOVEL'CFT120'  WKEY                                                CFT120
     C                     MOVEL'SCSARDPD'WFILE                                               CFT120
     C                     EXSR DBERR                                                         CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CGL020
      ** Reset fee fields                                                                     CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANKS   F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
      *                                                                                       CSW207
     C           @RTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVEL'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVEL'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** Determine if Swift 2020 is activated                                                 CSW220
      *                                                                                       CSW220
     C                     CALL SWIFT                                                         CSW220
     C                     PARM 'CSW220'  PARMSW  6                                           CSW220
     C                     PARM *BLANKS   PRTNCD  7                                           CSW220
      *                                                                                       CSW220
     C           PRTNCD    IFEQ 'CSWACTV'                                                     CSW220
     C                     MOVE 'Y'       CSW220  1                                           CSW220
     C                     ELSE                                                               CSW220
     C                     MOVE 'N'       CSW220                                              CSW220
     C                     ENDIF                                                              CSW220
      *                                                                                       CSW220
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CCP1                                           S01408
      *                                                                                       CFT120
      ** Save original value of base currency - BCCY.                                         CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     MOVE BCCY      UMBCCY  3                                           CFT120
     C                     ENDIF                                                              CFT120
     C*                                                                   S01408
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* LAST SR.
     C* PERFORM LAST CYCLE ROUTINES
     C************************************************************
     C*
     C           LAST      BEGSR
     C*
     C**NO*ACCOUNT*KEYS*HAVE*BEEN*GENERATED,*SO*PRINT*THIS*ON*THE*        S01117
     C**REPORT*                                                           S01117
     C*********************                                               S01117
     C************IN73*****IFEQ '0'                                       S01117
     C*********************ADD  1         PPAGE                           S01117
     C*********************WRITEP2LR                   72                 S01117
     C*********************END                                            S01117
     C*
     C*********************Z-ADD8         H                               CFT006
     C                     Z-ADD10        H                               CFT006
     C                     Z-ADDCTN#,H    NORE1
     C                     Z-ADDCTI#,H    HRWN
     C                     Z-ADDCTD#,H    HRDC
     C                     MOVE 'Z'       RECI
     C                     WRITEFPKEYZZF               89
     C*********************MOVE CTN#,8    CTN                              CFT006
     C*********************MOVE CTI#,8    CTI                              CFT006
     C*********************MOVE CTD#,8    CTD                              CFT006
     C                     MOVE CTN#,10   CTN                              CFT006
     C                     MOVE CTI#,10   CTI                              CFT006
     C                     MOVE CTD#,10   CTD                              CFT006
     C                     MOVE 'FPKEYDD' FILE
     C*                                                                    CFT006
     C           *IN87     IFEQ *ON                                        CFT006
     C                     WRITEFT0210F1                                   CFT006
     C                     SETOF                         87                CFT006
     C                     ENDIF                                           CFT006
     C*                                                                    CFT006
     C                     WRITEFT0210F2
     C                     WRITEFT0210F3
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************        CFT006
     C* RFTHDR SR.                                                        CFT006
     C* CREATE Request for Transfer Account Keys                          CFT006
     C************************************************************        CFT006
     C           RFTHDR    BEGSR                                          CFT006
      *                                                                   CFT006
      * Only process in MT101 active                                      CFT006
     C           CFT006    IFNE 'Y'                                       CFT006
     C                     GOTO RFTEND                                    CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETON                     26                   178061
     C                     Z-ADD25        A                               178061
      *                                                                   CFT006
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          CFT006
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             CFT006
     C*                                                                   CFT006
     C           *IN51     IFEQ '0'                                       CFT006
     C                     WRITEP1CLO                  72                 CFT006
     C                     CLOSEFT0210P1                                  CFT006
     C                     SETOF                     45                   CFT006
     C                     MOVE *BLANKS   BRCA1                           CFT006
     C                     END                                            CFT006
     C                     SETON                     51                   CFT006
     C*                                                                   CFT006
     C                     EXSR CHGBR                                     CFT006
      *                                                                   CFT006
      * Note that for Outgoing RFT's, only 1 account key is generated     CFT006
      *  for the handling charge.                                         CFT006
      *                                                                   CFT006
      * Are there outstanding account keys to be generated ?              CFT006
     C           AKEYAL    IFNE 'Y'                                       CFT006
      *                                                                   CFT006
     C                     MOVEL'N'       RFTHCG  1                       CFT006
      *                                                                   CFT006
      *                                                                   CFT006
      * Determine the type of the RFT                                     CFT006
     C                     SELEC                                          CFT006
     C           PYTP      WHEQ 'RO'                       Outward        CFT006
      *                                                                   CFT006
      * Generate handling charge account key if required.                 CFT006
     C           HANDCG    IFGT *ZERO                                     CFT006
     C           AKEYHC    ANDNE'Y'                                       CFT006
      *                                                                   CFT006
     C                     MOVEL'Y'       RFTHCG                          CFT006
     C                     MOVEL'Y'       AKEYHC                          CFT006
     C                     MOVEL'Y'       AKEYAL                          CFT006
      *                                                                   CFT006
     C                     MOVEL'RO'      PYTP                            CFT006
     C                     MOVEL'I'       KDATE                           CFT006
     C                     MOVELPYST      PYST                            CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     MOVE *BLANK    KCTYP                           CFT006
     C                     MOVEL'H'       KPYRE                           CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C                     MOVELHANDAC    FLD19                           CFT006
     C           CHAR12    IFNE *BLANK                                    CFT006
     C                     MOVEL'G'       PRT1T                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL'R'       PRT1T                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      *                                                                   CFT006
      * Set remaining fields                                              CFT006
     C                     MOVEL'D'       RECI                            CFT006
     C                     MOVELRFTID     PREF                            CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C**********           Z-ADDRUND      EDAT                      CFT006187218
     C                     Z-ADDHANDCG    EAMT                            CFT006
     C                     MOVELHANDCY    ECCY                            CFT006
     C                     Z-ADDRUND      VDAT                            CFT006
     C                     MOVEL*BLANKS   OTAC                            CFT006
     C                     MOVEL*BLANKS   RLPR                            CFT006
     C                     Z-ADD*ZEROS    BRCD                            CFT006
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT006 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
      *                                                                   CFT006
      * Write account key record                                          CFT006
     C                     EXSR WRIT                                      CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * Determine account keys for incoming RFT's                         CFT006
     C           PYTP      WHEQ 'RI'                       Inward         CFT006
      *                                                                   CFT006
     C                     SETOF                         97               CFT006
      *                                                                   CFT006
      * Read RFT Detail Records                                           CFT006
     C           RFTID     SETLLFT101DL0                                  CFT006
     C           RFTID     READEFT101DL0                 97               CFT006
     C           *IN97     DOWEQ*OFF                                      CFT006
      *                                                                   CFT006
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CFT006
     C                     MOVEL'N'       DTLCHG  1                       CFT006
      *                                                                   CFT006
      * If input date not processed                                       CFT006
     C           RHINDT    IFLE RUND                                      CFT006
     C           AKEYID    ANDNE'Y'                                       CFT006
     C                     EXSR RFTIND                                    CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * If debit value date not processed                                 CFT006
     C***********DBTVDT    IFLE RUND                                CFT006187218
     C           DBTVDT    IFLE EDAT                                      187218
     C           AKEYDD    ANDNE'Y'                                       CFT006
     C                     EXSR RFTDBT                                    CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * If credit value date not processed                                CFT006
     C***********EXDATE    IFLE RUND                                CFT006187218
     C********** EXDATE    IFLE EDAT                                                   187218 218411
     C           CRDVDT    IFLE EDAT                                                          218411
     C           AKEYCD    ANDNE'Y'                                       CFT006
     C                     EXSR RFTCRD                                    CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *                                                                   CFT006
      * Update detail record if required                                  CFT006
      *                                                                   CFT006
     C           DTLCHG    IFEQ 'Y'                                       CFT006
     C           RMODE     ANDEQ'N'                                       185700
     C                     UPDATFT101DD0                                  CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * If all detail account keys generated, update header.              CFT006
     C           AKEYID    IFEQ 'Y'                                       CFT006
     C           AKEYDD    ANDEQ'Y'                                       CFT006
     C           AKEYCD    ANDEQ'Y'                                       CFT006
     C                     MOVEL'Y'       RFTHCG                          CFT006
     C                     MOVEL'Y'       AKEYAL                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * Keep totals for hash processing                                   CFT006
     C           *LIKE     DEFN TRNAMT    SAVAMT                          CFT006
     C                     ADD  TRNAMT    SAVAMT                          CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C           RFTID     READEFT101DL0                 97               CFT006
     C                     ENDDO                                          CFT006
      *                                                                   CFT006
      * End of RI's                                                       CFT006
      *                                                                   CFT006
     C                     ENDSL                                          CFT006
      *                                                                   CFT006
      * Update RFTHCG                                                     CFT006
      *                                                                   CFT006
     C           RFTHCG    IFEQ 'Y'                                       CFT006
     C           RMODE     ANDEQ'N'                                       185700
     C                     UPDATFT101HD0                                  CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * End ALL account keys generated.                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           RFTEND    TAG                                            CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* RFTIND SR.                                                        CFT006
     C* CREATE RFT Input Date Account Keys                                CFT006
     C************************************************************        CFT006
     C           RFTIND    BEGSR                                          CFT006
      *                                                                   CFT006
      * Only generate if not previously created                           CFT006
     C           AKEYID    IFNE 'Y'                                       CFT006
      *                                                                   CFT006
     C                     MOVEL'Y'       AKEYID                          CFT006
     C                     MOVEL'Y'       DTLCHG                          CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * On input date :                                                   CFT006
      * 1. Payment amount, Payment ccy, (one per credit), Excluding any   CFT006
      *    charges : BENEFICIARY / INTERMEDIARY / ACCOUNT WITH INST       CFT006
      *                                                                   CFT006
     C                     MOVEL'RI'      PYTP                            CFT006
     C                     MOVEL'I'       KDATE                           CFT006
     C                     MOVE *BLANK    KCTYP                           CFT006
     C                     MOVEL'P'       KPYRE                           CFT006
     C                     MOVE *BLANK    KCCY                            CFT006
      *                                                                   CFT006
      * Set remaining fields                                              CFT006
     C                     MOVEL'D'       RECI                            CFT006
     C                     MOVELRFTID     PREF                            CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C***********          Z-ADDRUND      EDAT                      CFT006187218
      *                                                                   CFT006
      * Do not subtract charges from this amount as excluded              CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
      *                                                                   CFT006
     C                     SELEC                                          CFT006
      * Intermediary ?                                                    CFT006
     C           INTTTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTINST1    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           INTTTP    WHEQ 'G'                        General Ledger CFT006
     C           INTTTP    OREQ 'F'                        Nostro         CFT006
     C           INTTTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTINST1    FLD19                           CFT006
     C                     MOVELINTTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      * Account With Institution ?                                        CFT006
     C           AWITTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTACA35    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C           AWITTP    WHEQ 'G'                        General Ledger CFT006
     C           AWITTP    OREQ 'F'                        Nostro         CFT006
     C           AWITTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTACA35    FLD19                           CFT006
     C                     MOVELAWITTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      * Beneficiary ?                                                     CFT006
     C           BENTTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTBNA35    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           BENTTP    WHEQ 'G'                        General Ledger CFT006
     C           BENTTP    OREQ 'F'                        Nostro         CFT006
     C           BENTTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTBNA35    FLD19                           CFT006
     C                     MOVELBENTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C                     ENDSL                                          CFT006
      *                                                                   CFT006
     C                     MOVELPAYCCY    ECCY                            CFT006
     C                     Z-ADDRUND      VDAT                            CFT006
     C                     MOVEL*BLANKS   OTAC                            CFT006
     C                     MOVEL*BLANKS   RLPR                            CFT006
     C                     Z-ADD*ZEROS    BRCD                            CFT006
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT006 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
      *                                                                   CFT006
      * Write account key record                                          CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * 2. Transfer amount, Transfer ccy, (one per debit), Excluding      CFT006
      *    any charges : ORDERING CUSTOMER                                CFT006
      *                                                                   CFT006
     C                     MOVEL'RI'      PYTP                            CFT006
     C                     MOVEL'I'       KDATE                           CFT006
     C                     MOVE *BLANK    KCCY                            CFT006
     C                     MOVE *BLANK    KCTYP                           CFT006
     C                     MOVEL'T'       KPYRE                           CFT006
      *                                                                   CFT006
      * Set remaining fields                                              CFT006
     C                     MOVEL'D'       RECI                            CFT006
     C                     MOVELRFTID     PREF                            CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C                     Z-ADDRUND      EDAT                            CFT006
      *                                                                   CFT006
      * Do not subtract charges from this amount as excluded              CFT006
     C                     Z-ADDTRNAMT    EAMT                            CFT006
      *                                                                   CFT006
      * The ordering customer may either be in the HEADER or DETAIL       CFT006
      *  record.                                                          CFT006
     C                     SELEC                                          CFT006
      *                                                                   CFT006
     C           CUSTTP    WHNE *BLANK                                    CFT006
     C                     MOVELHOCUS1    FLD19                           CFT006
     C                     MOVELCUSTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           DCUSTP    WHNE *BLANK                                    CFT006
     C                     MOVELTOCUS1    FLD19                           CFT006
     C                     MOVELDCUSTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C                     ENDSL                                          CFT006
      *                                                                   CFT006
     C                     MOVELTRNCCY    ECCY                            CFT006
     C                     Z-ADDRUND      VDAT                            CFT006
     C                     MOVEL*BLANKS   OTAC                            CFT006
     C                     MOVEL*BLANKS   RLPR                            CFT006
     C                     Z-ADD*ZEROS    BRCD                            CFT006
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT006 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* RFTDBT SR.                                                        CFT006
     C* CREATE RFT Debit Value Account Keys                               CFT006
     C************************************************************        CFT006
     C           RFTDBT    BEGSR                                          CFT006
      *                                                                   CFT006
      * Only process if not already done.                                 CFT006
     C           AKEYDD    IFNE 'Y'                                       CFT006
      *                                                                   CFT006
     C                     MOVEL'Y'       AKEYDD                          CFT006
     C                     MOVEL'Y'       DTLCHG                          CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * Set default account key data                                      CFT006
     C                     MOVEL'RI'      PYTP                            CFT006
     C                     MOVEL'D'       KDATE                           CFT006
     C                     MOVE *BLANK    KCCY                            CFT006
     C                     MOVE *BLANK    KCTYP                           CFT006
      *                                                                   CFT006
      * Set Default Data                                                  CFT006
     C                     MOVEL'D'       RECI                            CFT006
     C                     MOVELRFTID     PREF                            CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C***********          Z-ADDRUND      EDAT                      CFT006187218
      *                                                                   CFT006
      * The ordering customer may either be in the HEADER or DETAIL       CFT006
      *  record.                                                          CFT006
     C                     SELEC                                          CFT006
      *                                                                   CFT006
     C           CUSTTP    WHNE *BLANK                                    CFT006
     C                     MOVELHOCUS1    FLD19                           CFT006
     C                     MOVELCUSTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           DCUSTP    WHNE *BLANK                                    CFT006
     C                     MOVELTOCUS1    FLD19                           CFT006
     C                     MOVELDCUSTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C                     ENDSL                                          CFT006
      *                                                                   CFT006
     C                     MOVELTRNCCY    ECCY                            CFT006
     C                     Z-ADDRUND      VDAT                            CFT006
     C                     MOVEL*BLANKS   OTAC                            CFT006
     C                     MOVEL*BLANKS   RLPR                            CFT006
     C                     Z-ADD*ZEROS    BRCD                            CFT006
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT006 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
      *                                                                   CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                    ORDERING CUSTOMER                              CFT006
      * 1.  Transfer amount, Transfer ccy, (one per debit), Excluding     CFT006
      *     any charges                                                   CFT006
     C                     MOVEL'T'       KPYRE                           CFT006
      *                                                                   CFT006
      * Do not subtract charges from this amount as excluded              CFT006
     C                     Z-ADDTRNAMT    EAMT                            CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * 2.  BCEQ transfer amount, Base ccy, (one per debit)               CFT006
     C                     MOVELTRNCCY    KCCY                            CFT006
     C                     MOVEL'B'       KPYRE                           CFT006
      *                                                                   CFT006
     C                     MOVELTRNCCY    OCCY                            CFT006
     C                     MOVELBCCY      ECCY                            CFT006
     C                     MOVELTRNCCY    FRMCCY  3                       CFT006
      *                                                                   CFT006
     C                     MOVELBCCY      TOCCY                           CFT006
      *                                                                   CFT006
     C           *LIKE     DEFN TFBCQS    CVTRAT                          CFT006
     C                     Z-ADDTFBCQS    CVTRAT                          CFT006
     C                     Z-ADDTRNAMT    INPAMT                          CFT006
     C                     Z-ADDTRNAMT    OAMT                            CFT006
      *                                                                   CFT006
     C           TOCCY     IFNE FRMCCY                                    CFT006
     C                     EXSR GETBAS                                    CFT006
     C                     Z-ADDOUTAMT    EAMT                            CFT006
     C                     ELSE                                           CFT006
     C                     Z-ADDINPAMT    EAMT                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD0         OAMT                            CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * 3.  Net transfer amount, Transfer ccy, (one per debit).           CFT006
      *     If SHA or OUR and the message contains a non-blank 'charges   CFT006
      *      account' then 'Transfer amount'.                             CFT006
      *     If  BEN then 'Transfer amount'.                               CFT006
      *     If SHA or OUR and the message contains a blank 'charges       CFT006
      *      account' then 'Transfer amount' plus 'receiver's charges'    CFT006
      *      in transfer currency, else 'transfer amount'.                CFT006
      *                                                                   CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     MOVEL'N'       KPYRE                           CFT006
      *                                                                   CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     MOVELTRNCCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME 130                                          CGL020
     C                     Z-ADD0         WKDENO 130                                          CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
     C                     SELEC                                          CFT006
      *                                                                   CFT006
      * Transfer Amount                                                   CFT006
     C           TDCHGS    WHEQ 'SHA'                                     CFT006
     C           CHGACC    ANDNE*BLANKS                                   CFT006
     C           TDCHGS    OREQ 'OUR'                                     CFT006
     C           CHGACC    ANDNE*BLANKS                                   CFT006
     C           TDCHGS    OREQ 'BEN'                                     CFT006
      *                                                                   CFT006
     C                     Z-ADDTRNAMT    EAMT                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTRNAMT    WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
     C           TDCHGS    WHEQ 'SHA'                                     CFT006
     C           CHGACC    ANDEQ*BLANKS                                   CFT006
     C           TDCHGS    OREQ 'OUR'                                     CFT006
     C           CHGACC    ANDEQ*BLANKS                                   CFT006
      *                                                                   CFT006
     C                     Z-ADDTRNAMT    EAMT                            CFT006
     C                     ADD  RCTCHG    EAMT                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTRNAMT    WKDENO                                              CGL020
     C                     ADD  RCTCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
      *                                                                   CFT006
     C                     ENDSL                                          CFT006
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * 4. Receiver's charge amount.  Transfer ccy.  Transfer ccy         CFT006
      *    (one per debit) Only generated if SHA or OUR.                  CFT006
      *                                                                   CFT006
     C                     SELEC                                          CFT006
      *                                                                   CFT006
     C           TDCHGS    WHEQ 'SHA'                                     CFT006
     C           TDCHGS    OREQ 'OUR'                                     CFT006
      *                                                                   CFT006
     C           CHGACC    IFNE *BLANKS                                   CFT006
     C                     MOVELCHGACC    FLD19                           CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     ACNO                            CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     ACNO                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           ACNO      CHAINACNUMA               89                   CFT006
     C           *IN89     IFEQ *OFF                                      CFT006
     C                     MOVEL'R'       PRT1T                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL'G'       PRT1T                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
     C           TOCUS1    IFNE *BLANK                                    CFT006
     C                     MOVELTOCUS1    FLD19                           CFT006
     C                     MOVELDCUSTP    PRT1T                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVELHOCUS1    FLD19                           CFT006
     C                     MOVELCUSTTP    PRT1T                           CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      *                                                                   CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     MOVEL'R'       KPYRE                           CFT006
     C                     Z-ADDRCTCHG    EAMT                            CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *                                                                   CFT006
     C                     ENDSL                                          CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* RFTCRD SR.                                                        CFT006
     C* CREATE RFT Input Date Account Keys BENEFICIARY / AWI / INTER_M    CFT006
     C************************************************************        CFT006
     C           RFTCRD    BEGSR                                          CFT006
      *                                                                   CFT006
      * Only process if not already done.                                 CFT006
     C           AKEYCD    IFNE 'Y'                                       CFT006
      *                                                                   CFT006
     C                     MOVEL'RI'      PYTP                            CFT006
     C                     MOVEL'C'       KDATE                           CFT006
      *                                                                   CFT006
     C                     MOVEL'Y'       AKEYCD                          CFT006
     C                     MOVEL'Y'       DTLCHG                          CFT006
      *                                                                                       218411
      ** Set default data.                                                                    218411
      *                                                                                       218411
     C                     MOVEL'D'       RECI                                                218411
     C                     MOVELRFTID     PREF                                                218411
     C                     Z-ADD*ZEROS    CQSQ                                                218411
      *                                                                                       218411
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      * If an outgoing payment has been generated, use suspense A/c       CFT006
      *  else use customer account                                        CFT006
     C           GOPFLG    IFEQ 'Y'                                       CFT006
     C                     MOVELBRCA      #BRCA                           CFT006
     C                     MOVELPAYCCY    S#CCY   3                       CFT006
     C                     EXSR GETSPS                                    CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C                     SELEC                                          CFT006
      * Intermediary ?                                                    CFT006
     C           INTTTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTINST1    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           INTTTP    WHEQ 'G'                        General Ledger CFT006
     C           INTTTP    OREQ 'F'                        Nostro         CFT006
     C           INTTTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTINST1    FLD19                           CFT006
     C                     MOVELINTTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      * Account With Institution ?                                        CFT006
     C           AWITTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTACA35    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C           AWITTP    WHEQ 'G'                        General Ledger CFT006
     C           AWITTP    OREQ 'F'                        Nostro         CFT006
     C           AWITTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTACA35    FLD19                           CFT006
     C                     MOVELAWITTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      * Beneficiary ?                                                     CFT006
     C           BENTTP    WHEQ 'I'                        Iban           CFT006
     C                     MOVELTBNA35    P@IBAN                          CFT006
     C                     EXSR SRIBAN                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C           BENTTP    WHEQ 'G'                        General Ledger CFT006
     C           BENTTP    OREQ 'F'                        Nostro         CFT006
     C           BENTTP    OREQ 'R'                        Iban           CFT006
     C                     MOVELTBNA35    FLD19                           CFT006
     C                     MOVELBENTTP    PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
     C                     ENDSL                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      * 1. Payment amount.  Payment ccy.  (one per credit).               CFT006
      *    Excluding any charges                                          CFT006
      *                    Account Key                                    CFT006
     C                     MOVEL'P'       KPYRE                           CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     MOVE *BLANK    KCTYP                           CFT006
      *                    Default Data                                   CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADDRUND      EPSD                            CFT006
     C                     Z-ADDRUND      VDAT                            CFT006
     C                     MOVEL*BLANKS   RLPR                            CFT006
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT006 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     MOVEL*BLANKS   OTAC                            CFT006
     C                     Z-ADD*ZEROS    BRCD                            CFT006
     C                     Z-ADD*ZEROS    OAMT                            CFT006
      *                                                                   CFT006
      *                    Payment Data                                   CFT006
     C                     MOVELPAYCCY    ECCY                            CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
      *                                                                   CFT006
      * Write account key record                                          CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *  2.  BCEQ payment amount.  Base ccy.  (one per credit).           CFT006
      *                                                                   CFT006
     C                     MOVELPAYCCY    KCCY                            CFT006
     C                     MOVEL'B'       KPYRE                           CFT006
      *                                                                   CFT006
     C                     MOVELPAYCCY    OCCY                            CFT006
     C                     MOVELBCCY      ECCY                            CFT006
     C                     MOVELPAYCCY    FRMCCY                          CFT006
      *                                                                   CFT006
     C                     MOVELBCCY      TOCCY                           CFT006
      *                                                                   CFT006
     C*********************Z-ADDTFBCQS    CVTRAT                    CFT006184050
     C                     Z-ADDPYBCQS    CVTRAT                          184050
     C                     Z-ADDPAYAMT    INPAMT                          CFT006
     C                     Z-ADDPAYAMT    OAMT                            CFT006
      *                                                                   CFT006
     C           TOCCY     IFNE FRMCCY                                    CFT006
     C                     EXSR GETBAS                                    CFT006
     C                     Z-ADDOUTAMT    EAMT                            CFT006
     C                     ELSE                                           CFT006
     C                     Z-ADDINPAMT    EAMT                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     Z-ADD0         OAMT                            CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *                                                                   CFT006
      * 3.  Net payment amount.  Payment ccy.  (one per credit).          CFT006
      *     If  SHA or OUR then 'payment amount', else 'payment           CFT006
      *     amount' MINUS 'receiver's charges' in payment currency.       CFT006
      *                                                                   CFT006
     C                     Z-ADD*ZERO     OAMT                            CFT006
     C                     MOVE *BLANKS   OCCY                            CFT006
     C                     MOVEL'N'       KPYRE                           CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     MOVELPAYCCY    ECCY                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADD0         WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
     C           TDCHGS    IFEQ 'SHA'                                     CFT006
     C           TDCHGS    OREQ 'OUR'                                     CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDPAYAMT    WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ELSE                                           CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
     C                     SUB  RCPCHG    EAMT                            CFT006
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDPAYAMT    WKDENO                                              CGL020
     C                     ADD  RCPCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT006
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
      *  4.  Receiver's charge amount.  Payment ccy.  (one per credit).   CFT006
      *      Only generated if BEN.                                       CFT006
      *                                                                   CFT006
      *  If charges account <> Blank, use;  else default (current)        CFT006
     C           CHGACC    IFNE *BLANKS                                   CFT006
      *                                                                   CFT006
     C                     MOVELCHGACC    FLD19                           CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     ACNO                            CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     ACNO                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           ACNO      CHAINACNUMA               89                   CFT006
     C           *IN89     IFEQ *OFF                                      CFT006
     C                     MOVEL'R'       PRT1T                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL'G'       PRT1T                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR SETTLE                                    CFT006
     C                     MOVELSETAC     SEAC                            CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           TDCHGS    IFEQ 'BEN'                                     CFT006
     C                     MOVEL'R'       KPYRE                           CFT006
     C                     MOVELPAYCCY    ECCY                            CFT006
     C                     MOVE *BLANKS   KCCY                            CFT006
     C                     Z-ADDRCPCHG    EAMT                            CFT006
      *                                                                   CFT006
     C                     EXSR WRIT                                      CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT008
     C* CCTHDR SR.                                                        CFT008
     C* CREATE CCT ACCOUNT KEYS                                           CFT008
     C************************************************************        CFT008
     C           CCTHDR    BEGSR                                          CFT008
      *                                                                   CFT008
      * Only process if CFT008 (MT102) active                             CFT008
     C           CFT008    IFNE 'Y'                                       CFT008
     C                     GOTO CCTEND                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     SETON                     27                   178061
     C                     Z-ADD26        A                               178061
      *                                                                   CFT008
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          CFT008
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             CFT008
     C*                                                                   CFT008
     C           *IN52     IFEQ '0'                                       CFT008
     C                     WRITEP1CLO                  72                 CFT008
     C                     CLOSEFT0210P1                                  CFT008
     C                     SETOF                     45                   CFT008
     C                     MOVE *BLANKS   BRCA1                           CFT008
     C                     END                                            CFT008
     C                     SETON                     52                   CFT008
      *                                                                   CFT008
     C                     EXSR CHGBR                                     CFT008
      *                                                                   CFT008
     C           AKEY1L    IFNE 'Y'                                       CFT008
     C                     CLEARMOCDS                                     CFT008
     C                     Z-ADD0         I                               CFT008
     C                     MOVEA*BLANKS   CARR                            CFT008
     C                     Z-ADD0         Y                               CFT008
     C                     MOVEL'Y'       CCTHCG  1                       CFT008
      *                                                                   CFT008
     C                     MOVEL'N'       DTLCHG                          CFT008
      *                                                                   CFT008
     C                     MOVELCCTTYP    PYTP                            CFT008
      *                                                                   CFT008
      * Split amounts by ordering customer                                CFT008
     C           CCTTYP    IFEQ 'BO'                                      CFT008
     C                     EXSR SUMOCA                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * Input Date                                                        CFT008
     C           CHINDT    IFLE RUND                                      CFT008
     C                     EXSR CCTIND                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * Debit Date                                                        CFT008
     C***********DBTVDT    IFLE RUND                                CFT008187218
     C           DBTVDT    IFLE EDAT                                      187218
     C           CCTTYP    ANDEQ'BO'                                      187218
     C           TTVDTE    ORLE EDAT                                      187218
     C           CCTTYP    ANDEQ'BI'                                      187218
     C                     EXSR CCTDVD                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * Credit Date                                                       CFT008
     C***********TTVDTE    IFLE RUND                                CFT008187218
     C           TTVDTE    IFLE EDAT                                      187218
     C           CCTTYP    ANDEQ'BO'                                      187218
     C           CCTTYP    OREQ 'BI'                                      187218
     C                     EXSR CCTCVD                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C           AKEYID    IFEQ 'Y'                                       CFT008
     C           AKEYDD    ANDEQ'Y'                                       CFT008
     C           AKEYCH    ANDEQ'Y'                                       CFT008
     C                     MOVEL'Y'       AKEY1L                          CFT008
     C                     MOVEL'Y'       CCTHCG                          CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * If header changed, update                                         CFT008
     C           CCTHCG    IFEQ 'Y'                                       CFT008
     C           RMODE     ANDEQ'N'                                       185700
     C                     UPDATFT102HD0                                  CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C           CCTEND    TAG                                            CFT008
      *                                                                   CFT008
     C                     ENDSR                                          CFT008
     C************************************************************        CFT008
     C* SUMOCA SR.                                                        CFT008
     C* Sum Ordering Customer Amounts                                     CFT008
     C************************************************************        CFT008
     C           SUMOCA    BEGSR                                          CFT008
      *                                                                   CFT008
     C                     SETOF                         97               CFT008
     C           CCTID     SETLLFT102DL0                                  CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C           *IN97     DOWEQ*OFF                                      CFT008
      *                                                                   CDE002
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CFT008
      * Find Settlement account for Header OC / OI or Detail OC           CFT008
     C                     SELEC                                          CFT008
      *                                                                   CFT008
      * Detail Record first                                               CFT008
     C           CUSTTD    WHEQ 'I'                                       CFT008
     C                     MOVELORDCU1    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTD    WHEQ 'G'                                       CFT008
     C           CUSTTD    OREQ 'F'                        Nostro         CFT008
     C           CUSTTD    OREQ 'R'                        Iban           CFT008
     C                     MOVELORDCU1    FLD19                           CFT008
     C                     MOVELCUSTTD    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           ORDITP    WHEQ 'I'                                       CFT008
     C                     MOVELORDI35    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           ORDITP    WHEQ 'G'                                       CFT008
     C           ORDITP    OREQ 'F'                        Nostro         CFT008
     C           ORDITP    OREQ 'R'                        Iban           CFT008
     C                     MOVELORDI35    FLD19                           CFT008
     C                     MOVELORDITP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      * Header                                                            CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                        Nostro         CFT008
     C           SINSTT    OREQ 'R'                        Iban           CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           HOITYP    WHEQ 'I'                                       CFT008
     C                     MOVELOINST3    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           HOITYP    WHEQ 'G'                                       CFT008
     C           HOITYP    OREQ 'F'                        Nostro         CFT008
     C           HOITYP    OREQ 'R'                        Iban           CFT008
     C                     MOVELOINST3    FLD19                           CFT008
     C                     MOVELHOITYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'I'                                       CFT008
     C                     MOVELTOCUS1    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'G'                                       CFT008
     C           CUSTTH    OREQ 'F'                        Nostro         CFT008
     C           CUSTTH    OREQ 'R'                        Iban           CFT008
     C                     MOVELTOCUS1    FLD19                           CFT008
     C                     MOVELCUSTTH    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
      * Outgoing Payment Generated : Overlay settlement A/C               CFT008
     C           GOPFLG    IFEQ 'Y'                                       CFT008
     C                     MOVELBRCA      #BRCA                           CFT008
     C                     MOVELCCTCCY    S#CCY                           CFT008
     C                     EXSR GETSPS                                    CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * Lookup in array to see if customer account exists                 CFT008
     C                     Z-ADD1         Y       50                      CFT008
     C           SEAC      LOKUPCARR,Y                   96               CFT008
     C           *IN96     IFEQ *OFF                       Not exist      CFT008
     C                     ADD  1         I       50                      CFT008
     C                     MOVEASEAC      CARR,I                          CFT008
     C           I         OCUR MOCDS                                     CFT008
     C                     MOVELSEAC      MOC                             CFT008
     C                     Z-ADD0         TTLTFR                          CFT008
     C                     Z-ADD0         SUMSC                           CFT008
     C                     Z-ADD0         RCGOUR                          CFT008
     C                     Z-ADD0         SNDOSH                          CFT008
     C                     Z-ADD0         RCVPAY                          177818
     C                     Z-ADD0         PABCQS                          187220
     C                     Z-ADD0         TABCQS                          187220
     C                     ELSE                                           CFT008
     C           Y         OCUR MOCDS                                     CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      * Do calculations here                                              CFT008
     C                     MOVELCCY       SACCCY                          CFT008
     C                     MOVELPAYCCY    SPYCCY                          CFT008
     C                     MOVELCCTID     SCCTID                          CFT008
     C                     MOVELCCYCHG    SVDOC                           CFT008
     C                     Z-ADDPYBCQS    PABCQS                          187220
     C                     Z-ADDTFBCQS    TABCQS                          187220
      * 1. Transfer Amount                                                CFT008
     C                     ADD  PAYAMT    TTLTFR                          CFT008
      * 2. Senders Charges                                                CFT008
     C                     ADD  SNDCTF    SUMSC                           CFT008
      * 3. Receivers Charges where OUR                                    CFT008
     C           CCYCHG    IFEQ 'OUR'                                     CFT008
     C           CCTCHG    OREQ 'OUR'                                     CFT008
     C           CCYCHG    ANDEQ*BLANK                                    CFT008
     C                     ADD  RCVCTF    RCGOUR                          CFT008
     C                     ADD  RCVOCG    RCVPAY                          177818
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      *********************                                         CFT008185701
      **4.*Senders**Charges where OUR or SHA.  NOW NOT USED ?       CFT008185701
     C***********CCYCHG****IFEQ 'OUR'                               CFT008185701
     C***********CCYCHG****OREQ 'SHA'                               CFT008185701
     C                     ADD  SNDOCG    SNDOSH                          CFT008
     C*********************ENDIF                                    CFT008185701
      *                                                                   CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
     C                     ENDSR                                          CFT008
     C************************************************************        CFT008
     C* CCTIND SR.                                                        CFT008
     C* CCT Input Date                                                    CFT008
     C************************************************************        CFT008
     C           CCTIND    BEGSR                                          CFT008
      *                                                                   CFT008
      * Only generate if not created previously                           CFT008
     C           AKEYID    IFNE 'Y'                                       CFT008
     C                     MOVEL'Y'       AKEYID                          CFT008
     C                     MOVEL'Y'       CCTHCG                          CFT008
      *                                                                   CFT008
     C           *LIKE     DEFN RCVCTF    TOTRCT                          CFT008
     C                     Z-ADD0         TOTRCT                          CFT008
      *                                                                   CFT008
     C                     MOVEL'I'       KDATE                           CFT008
     C                     MOVELCCTID     PREF                            CFT008
     C                     Z-ADD0         CQSQ                            CFT008
     C                     Z-ADDCHINDT    VDAT                            CFT008
     C                     Z-ADDRUND      EPSD                            CFT008
     C                     MOVELCCTTST    PYST                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
     C           CCTTYP    WHEQ 'BI'                                      CFT008
      *                                                                   CFT008
     C                     SETOF                         97               CFT008
     C           CCTID     SETLLFT102DL0                                  CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C           *IN97     DOWEQ*OFF                                      CFT008
      *                                                                   CDE002
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CFT008
      *    Sum Total Receivers Charges (Transfer Ccy)                     CFT008
     C                     ADD  RCVCTF    TOTRCT                          CFT008
      *                                                                   CFT008
      * 1. Transfer amount, with receiver's charges deducted.             CFT008
      *    Credit ccy.  (one per credit).                                 CFT008
      *    'Credit ccy' is the currency of the account to be credited     CFT008
      *    with the transfer (beneficiary or account with institution).   CFT008
      *                                                                   CFT008
      *    Get settlement account                                         CFT008
      *    Account With Institution ?                                     CFT008
     C                     SELEC                                          CFT008
      * If an outgoing payment has been generated, use suspense A/c       187215
      *  else use customer account                                        187215
     C           GOPFLG    WHEQ 'Y'                                       187215
     C                     MOVELBRCA      #BRCA                           187215
     C                     MOVELPAYCCY    S#CCY   3                       187215
     C                     EXSR GETSPS                                    187215
     C           AWITP     WHEQ 'I'                        Iban           CFT008
     C                     MOVELACCI35    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C           AWITP     WHEQ 'G'                        General Ledger CFT008
     C           AWITP     OREQ 'F'                        Nostro         CFT008
     C           AWITP     OREQ 'R'                        Iban           CFT008
     C                     MOVELACCI35    FLD19                           CFT008
     C                     MOVELAWITP     PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      * Beneficiary ?                                                     CFT008
     C           BENTTD    WHEQ 'I'                        Iban           CFT008
     C                     MOVELBENF1     P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           BENTTD    WHEQ 'G'                        General Ledger CFT008
     C           BENTTD    OREQ 'F'                        Nostro         CFT008
     C           BENTTD    OREQ 'R'                        Iban           CFT008
     C                     MOVELBENF1     FLD19                           CFT008
     C                     MOVELBENTTD    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C           CCTCHG    IFEQ 'BEN'                                     CFT008
     C           CCTCHG    OREQ 'SHA'                                     CFT008
     C           CCYCHG    OREQ 'BEN'                                     CFT008
     C           CCYCHG    OREQ 'SHA'                                     CFT008
     C           PAYAMT    SUB  RCVOCG    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDPAYAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
     C/COPY WNCPYSRC,FT0210C052
      *                                                                   CFT008
     C                     MOVEL'J'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD*ZEROS    OAMT                            CFT008
      *                                                                   CFT008
      * Ensure that the event currency is the credit currency             CFT008
     C                     MOVELCCY       ECCY                            CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
      * 2. Total transfer amount less total receiver's charges.           CFT008
      *    Transfer ccy.  (one per MT102).                                CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     MOVEL'T'       KPYRE                           CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
      *                                                                   CFT008
      *     Find Settlement Account : Must be a header record item        CFT008
     C                     SELEC                                          CFT008
     C           DSTTYP    WHEQ 'I'                                       CFT008
     C                     MOVELCCTDST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           DSTTYP    WHEQ 'G'                                       CFT008
     C           DSTTYP    OREQ 'F'                        Nostro         CFT008
     C           DSTTYP    OREQ 'R'                        Iban           CFT008
     C                     MOVELCCTDST    FLD19                           CFT008
     C                     MOVELDSTTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                        Nostro         CFT008
     C           SINSTT    OREQ 'R'                        Iban           CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'I'                                       CFT008
     C                     MOVELSNDCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'G'                                       CFT008
     C           SNDTYP    OREQ 'F'                                       CFT008
     C           SNDTYP    OREQ 'R'                                       CFT008
     C                     MOVELSNDCOR    FLD19                           CFT008
     C                     MOVELSNDTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           RCVTYP    WHEQ 'I'                                       CFT008
     C                     MOVELRCVCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'G'                                       CFT008
     C           RCVTYP    WHEQ 'F'                                       CFT008
     C           RCVTYP    WHEQ 'R'                                       CFT008
     C                     MOVELRCVCOR    FLD19                           CFT008
     C                     MOVELRCVTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
      * Subtract total receivers charges - Transfer Ccy                   CFT008
     C           HTFAMT    SUB  TOTRCT    EAMT                            CFT008
     C/COPY WNCPYSRC,FT0210C053
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
     C           CCTTYP    WHEQ 'BO'                                      CFT008
      *                                                                   CFT008
      * 1.  Total transfer amount. Transfer ccy.  (one per MT102).        CFT008
      *     This is the total amount remitted to the nostro.              CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
     C           DSTTYP    WHEQ 'I'                                       CFT008
     C                     MOVELCCTDST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           DSTTYP    WHEQ 'G'                                       CFT008
     C           DSTTYP    OREQ 'F'                        Nostro         CFT008
     C           DSTTYP    OREQ 'R'                        Iban           CFT008
     C                     MOVELCCTDST    FLD19                           CFT008
     C                     MOVELDSTTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                        Nostro         CFT008
     C           SINSTT    OREQ 'R'                        Iban           CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'I'                                       CFT008
     C                     MOVELSNDCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'G'                                       CFT008
     C           SNDTYP    OREQ 'F'                                       CFT008
     C           SNDTYP    OREQ 'R'                                       CFT008
     C                     MOVELSNDCOR    FLD19                           CFT008
     C                     MOVELSNDTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'I'                                       CFT008
     C                     MOVELRCVCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'G'                                       CFT008
     C           RCVTYP    OREQ 'F'                                       CFT008
     C           RCVTYP    OREQ 'R'                                       CFT008
     C                     MOVELRCVCOR    FLD19                           CFT008
     C                     MOVELRCVTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
      * Other fields                                                      CFT008
     C                     MOVEL'T'       KPYRE                           CFT008
     C                     Z-ADDHTFAMT    EAMT                            CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
     C***********          Z-ADDRUND      EDAT                      CFT008187218
     C                     Z-ADDRUND      VDAT                            CFT008
     C                     Z-ADDRUND      EPSD                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
      * 2.  Sum of the transfer amounts for each ordering customer/       CFT008
      *     inst less the sender's charges for these amounts plus the     CFT008
      *     receiver's charges where OUR.                                 CFT008
      *     Debit ccy.  (one per ordering cust/inst).                     CFT008
      *     'Debit ccy' is the currency of the account to be debited      CFT008
      *     for the transfer (ordering customer or ordering institution   CFT008
      *     This is the amount debited from the customer's account        CFT008
      *     excluding the sender's charges, but including the receiver'   CFT008
      *     charges (if any).                                             CFT008
      *                                                                   CFT008
     C                     MOVEL'O'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     Z-ADD0         Y                               CFT008
     C                     DO   I         Y                               CFT008
     C           Y         OCUR MOCDS                                     CFT008
     C           SCCTID    CHAINFT102DL0             96                   CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     MOVELSPYCCY    ECCY                            CFT008
     C                     MOVE MOC       SEAC                            CFT008
     C                     Z-ADDTTLTFR    EAMT                            CFT008
     C*********************ADD  RCGOUR    EAMT                      CFT008177818
     C                     ADD  RCVPAY    EAMT                            177818
      *                                                                   CDE002
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
     C/COPY WNCPYSRC,FT0210C054
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     ENDSR                                          CFT008
     C************************************************************        CFT008
     C* CCTDVD SR.                                                        CFT008
     C* Process for Debit Value Date                                      CFT008
     C************************************************************        CFT008
     C           CCTDVD    BEGSR                                          CFT008
      *                                                                   CFT008
      * Only generate if not created previously                           CFT008
     C           AKEYDD    IFNE 'Y'                                       CFT008
     C                     MOVE 'Y'       AKEYDD                          CFT008
     C                     MOVEL'Y'       CCTHCG                          CFT008
      *                                                                   CFT008
      * Set default values                                                CFT008
     C                     MOVELCCTTYP    PYTP                            CFT008
     C                     MOVELCCTTST    PYST                            CFT008
     C                     MOVEL'D'       KDATE                           CFT008
     C                     MOVE *BLANK    KCTYP                           CFT008
     C                     MOVE *BLANK    KCCY                            CFT008
     C                     MOVELCCTID     PREF                            CFT008
     C                     Z-ADD*ZEROS    CQSQ                            CFT008
     C***********          Z-ADDRUND      EDAT                      CFT008187218
     C***********          Z-ADDRUND      VDAT                      CFT008187218
      *                                                                   187218
      * If outgoing then use debit date, if incoming is                   187218
      * transfer date                                                     187218
      *                                                                   187218
     C                     SELEC                                          187218
     C           CCTTYP    WHEQ 'BO'                                      187218
     C                     Z-ADDDBTVDT    VDAT                            187218
     C           CCTTYP    WHEQ 'BI'                                      187218
     C                     Z-ADDTTVDTE    VDAT                            187218
     C                     OTHER                                          187218
     C                     Z-ADDRUND      VDAT                            187218
     C                     ENDSL                                          187218
     C                     MOVEL*BLANKS   OTAC                            CFT008
     C                     MOVEL*BLANKS   RLPR                            CFT008
     C                     Z-ADD*ZEROS    BRCD                            CFT008
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT008 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD*ZEROS    OAMT                            CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
     C           CCTTYP    WHEQ 'BI'                                      CFT008
      *                                                                   CFT008
      * Determine settlement account                                      CFT008
     C                     SELEC                                          CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                        Nostro         CFT008
     C           SINSTT    OREQ 'R'                        Iban           CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'I'                                       CFT008
     C                     MOVELSNDCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'G'                                       CFT008
     C           SNDTYP    OREQ 'F'                                       CFT008
     C           SNDTYP    OREQ 'R'                                       CFT008
     C                     MOVELSNDCOR    FLD19                           CFT008
     C                     MOVELSNDTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'I'                                       CFT008
     C                     MOVELRCVCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'G'                                       CFT008
     C           RCVTYP    OREQ 'F'                                       CFT008
     C           RCVTYP    OREQ 'R'                                       CFT008
     C                     MOVELRCVCOR    FLD19                           CFT008
     C                     MOVELRCVTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           HOITYP    WHEQ 'I'                                       CFT008
     C                     MOVELOINST3    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           HOITYP    WHEQ 'G'                                       CFT008
     C           HOITYP    OREQ 'F'                                       CFT008
     C           HOITYP    OREQ 'R'                                       CFT008
     C                     MOVELOINST3    FLD19                           CFT008
     C                     MOVELHOITYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'I'                                       CFT008
     C                     MOVELTOCUS1    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'G'                                       CFT008
     C           CUSTTH    OREQ 'F'                                       CFT008
     C           CUSTTH    OREQ 'R'                                       CFT008
     C                     MOVELTOCUS1    FLD19                           CFT008
     C                     MOVELCUSTTH    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
      *  Sum receivers charges                                            CFT008
     C                     Z-ADD0         TOTRCT                          CFT008
     C/COPY WNCPYSRC,FT0210C055
     C                     SETOF                         33               CFT008
     C           CCTID     SETLLFT102DL0                                  CFT008
     C           CCTID     READEFT102DL0                 33               CFT008
     C           *IN33     DOWEQ*OFF                                      CFT008
      *                                                                   CDE002
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
     C                     ADD  RCVCTF    TOTRCT                          CFT008
     C/COPY WNCPYSRC,FT0210C056
     C           CCTID     READEFT102DL0                 33               CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
      * 1. Total transfer amount less total receiver's charges.           CFT008
      *    Transfer ccy.  (one per MT102).                                CFT008
     C                     MOVEL'T'       KPYRE                           CFT008
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADD0         WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT008
     C                     Z-ADDHTFAMT    EAMT                            CFT008
     C                     SUB  TOTRCT    EAMT                            CFT008
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDHTFAMT    WKDENO                                              CGL020
     C                     ADD  TOTRCT    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FT0210C057
      *                                                                   CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
      * 2. BCEQ total transfer amount less total receiver's charges       CFT008
      *    Base ccy.  (one per MT102)                                     CFT008
      *                                                                   CFT008
     C                     MOVEL'B'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     Z-ADDHTFAMT    INPAMT                          CFT008
     C                     SUB  TOTRCT    INPAMT                          CFT008
     C/COPY WNCPYSRC,FT0210C058
     C                     MOVELBCCY      TOCCY                           CFT008
     C                     MOVELHTFCCY    FRMCCY                          CFT008
     C**********           Z-ADDPYBCQS    CVTRAT                    CFT008187217
     C                     Z-ADDTFBCQS    CVTRAT                          187217
      *                                                                   CFT008
     C           TOCCY     IFNE FRMCCY                                    CFT008
     C                     EXSR GETBAS                                    CFT008
     C                     Z-ADDOUTAMT    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDINPAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C***********          MOVELBCCY      KCCY                      CFT008187217
     C                     MOVELHTFCCY    KCCY                            187217
     C                     MOVELBCCY      ECCY                            CFT008
      *                                                                   CFT008
     C***********          Z-ADDRUND      EDAT                      CFT008187218
     C                     Z-ADDRUND      VDAT                            CFT008
     C                     Z-ADDRUND      EPSD                            CFT008
      *                                                                   CFT008
     C                     Z-ADDHTFAMT    OAMT                            CFT008
     C                     SUB  TOTRCT    OAMT                            CFT008
     C                     MOVELHTFCCY    OCCY                            CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      * 3. Total receiver's charges. Transfer ccy.  (one per MT102)       CFT008
      *                                                                   CFT008
     C                     Z-ADD0         OAMT                            CFT008
     C                     MOVEL*BLANKS   OCCY                            CFT008
     C                     Z-ADDTOTRCT    EAMT                            CFT008
     C                     MOVEL'R'       KPYRE                           CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
      *                                                                   CFT008
     C/COPY WNCPYSRC,FT0210C059
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
      * 4. Total transfer amount.                                         CFT008
      *    Transfer ccy. (one per MT102).                                 CFT008
      *    This is the amount debited from the nostro                     CFT008
     C                     Z-ADD0         OAMT                            CFT008
     C                     MOVEL*BLANKS   OCCY                            CFT008
     C                     MOVEL'I'       KPYRE                           CFT008
     C                     Z-ADDHTFAMT    EAMT                            CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
     C                     MOVEL*BLANKS   KCCY                            CFT008
     C/COPY WNCPYSRC,FT0210C060
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
     C           CCTTYP    WHEQ 'BO'                                      CFT008
      *                                                                   CFT008
      * 1. Sum of the transfer amounts for each ordering customer/inst    CFT008
      *    less the sender's charges for these amounts plus the           CFT008
      *    receiver's charges where OUR.  Debit ccy.  (one per ordering   CFT008
      *    cust/inst).  'Debit ccy' is the currency of the account to     CFT008
      *    be debited for the transfer (ordering customer or ordering     CFT008
      *    institution).                                                  CFT008
     C                     Z-ADD0         Y                               CFT008
     C                     DO   I         Y                               CFT008
     C           Y         OCUR MOCDS                                     CFT008
     C                     Z-ADD0         OAMT                            CFT008
     C                     MOVEL*BLANKS   OCCY                            CFT008
     C                     MOVEL'O'       KPYRE                           CFT008
     C                     MOVELMOC       SEAC                            CFT008
     C                     Z-ADDTTLTFR    EAMT                            CFT008
     C*********************ADD  RCGOUR    EAMT                      CFT008117818
     C                     ADD  RCVPAY    EAMT                            117818
     C/COPY WNCPYSRC,FT0210C061
     C                     MOVELSPYCCY    ECCY                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     EXSR WRIT                                      CFT008
      *                                                                   CFT008
      * 2. Sum of the transfer amounts for each ordering customer/inst    CFT008
      *    plus sender's charges if OUR or SHA plus receiver's charges    CFT008
      *    charges if OUR.  Debit ccy.  (one per ordering cust/inst).     CFT008
     C                     Z-ADD0         OAMT                            CFT008
     C                     MOVEL*BLANKS   OCCY                            CFT008
     C                     MOVEL'S'       KPYRE                           CFT008
     C                     Z-ADDTTLTFR    EAMT                            CFT008
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDTTLTFR    WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT008
     C           SVDOC     IFEQ 'OUR'                                     CFT008
     C           SVDOC     OREQ 'SHA'                                     CFT008
     C           CCTCHG    OREQ 'OUR'                                     CFT008
     C           CCTCHG    OREQ 'SHA'                                     CFT008
     C***********          ADD  SUMSC     EAMT                      CFT008185701
     C                     ADD  SNDOSH    EAMT                            185701
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  SNDOSH    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C           SVDOC     IFEQ 'OUR'                                     CFT008
     C           CCTCHG    OREQ 'OUR'                                     CFT008
     C**********           ADD  RCGOUR    EAMT                      CFT008187220
     C                     ADD  RCVPAY    EAMT                            187220
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  RCVPAY    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FT0210C062
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     MOVELSPYCCY    ECCY                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     EXSR WRIT                                      CFT008
      *                                                                   CFT008
      * 3. BCEQ of sum of the transfer amounts for each ordering          CFT008
      *    customer/inst plus sender's charges plus                       CFT008
      *    receiver's charges if OUR.  Base ccy.  (one per ordering       CFT008
      *    cust/inst)                                                     CFT008
     C/COPY WNCPYSRC,FT0210C063
     C                     Z-ADDEAMT      OAMT                            CFT008
     C                     MOVELSPYCCY    OCCY                            CFT008
     C                     Z-ADDEAMT      INPAMT                          CFT008
     C***********          Z-ADDPYBCQS    CVTRAT                    CFT008187220
     C                     Z-ADDPABCQS    CVTRAT                          187220
     C                     MOVELBCCY      TOCCY                           CFT008
     C                     MOVELSPYCCY    FRMCCY                          CFT008
      *                                                                   CFT008
     C           TOCCY     IFNE FRMCCY                                    CFT008
     C                     EXSR GETBAS                                    CFT008
     C                     Z-ADDOUTAMT    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDINPAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     MOVEL'B'       KPYRE                           CFT008
     C                     MOVELBCCY      ECCY                            CFT008
     C                     MOVELSACCCY    KCCY                            CFT008
     C                     EXSR WRIT                                      CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *                                                                   CFT008
      * 4. Sum of sender's charges for each ordering customer/inst.       CFT008
      *    Debit ccy.  (one per ordering cust/inst)                       CFT008
     C                     Z-ADD0         OAMT                            CFT008
     C                     MOVEL*BLANKS   OCCY                            CFT008
     C                     MOVEL'C'       KPYRE                           CFT008
     C*********            Z-ADDSUMSC     EAMT                      CFT008185701
     C                     Z-ADDSNDOSH    EAMT                            185701
     C                     MOVELSPYCCY    ECCY                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *                                                                   CFT008
      * 5. BEQ of sum of sender's charges for each ordering customer/     CFT008
      *    inst.  Base ccy.  (one per ordering cust/inst).                CFT008
     C*********            Z-ADDSUMSC     OAMT                      CFT008185701
     C                     Z-ADDSNDOSH    OAMT                            185701
     C                     MOVELSPYCCY    OCCY                            CFT008
     C*********            Z-ADDSUMSC     INPAMT                    CFT008185701
     C                     Z-ADDSNDOSH    INPAMT                          185701
     C***********          Z-ADDPYBCQS    CVTRAT                    CFT008187220
     C                     Z-ADDPABCQS    CVTRAT                          187220
     C                     MOVELBCCY      TOCCY                           CFT008
     C                     MOVELSPYCCY    FRMCCY                          CFT008
      *                                                                   CFT008
     C           TOCCY     IFNE FRMCCY                                    CFT008
     C                     EXSR GETBAS                                    CFT008
     C                     Z-ADDOUTAMT    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDINPAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     MOVEL'D'       KPYRE                           CFT008
     C                     MOVELBCCY      ECCY                            CFT008
     C                     MOVELSACCCY    KCCY                            CFT008
     C                     EXSR WRIT                                      CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *                                                                   CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     ENDSR                                          CFT008
     C************************************************************        CFT008
     C* CCTCVD SR.                                                        CFT008
     C* CCT Credit Value Date                                             CFT008
     C************************************************************        CFT008
     C           CCTCVD    BEGSR                                          CFT008
      *                                                                   CFT008
      * Set default values                                                CFT008
     C                     MOVELCCTTYP    PYTP                            CFT008
     C                     MOVELCCTTST    PYST                            CFT008
     C                     MOVEL'C'       KDATE                           CFT008
     C                     MOVE *BLANK    KCTYP                           CFT008
     C                     MOVELCCTID     PREF                            CFT008
     C                     Z-ADD*ZEROS    CQSQ                            CFT008
     C***********          Z-ADDRUND      EDAT                      CFT008187218
     C                     Z-ADDRUND      VDAT                            CFT008
      *                                                                   187218
      * If outgoing then use transfer date else date set per              187218
      * credit                                                            187218
      *                                                                   187218
     C                     SELEC                                          187218
     C           CCTTYP    WHEQ 'BO'                                      187218
     C                     Z-ADDTTVDTE    VDAT                            187218
     C                     OTHER                                          187218
     C                     Z-ADDRUND      VDAT                            187218
     C                     ENDSL                                          187218
      *                                                                   187218
     C                     MOVEL*BLANKS   OTAC                            CFT008
     C                     MOVEL*BLANKS   RLPR                            CFT008
     C                     Z-ADD*ZEROS    BRCD                            CFT008
     C**********           Z-ADD*ZEROS    FPASOC                                       CFT008 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     Z-ADDRUND      EPSD                            CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD*ZEROS    OAMT                            CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
     C           CCTTYP    WHEQ 'BI'                                      CFT008
      *                                                                   CFT008
     C                     SETOF                         97               CFT008
     C           CCTID     SETLLFT102DL0                                  CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C           *IN97     DOWEQ*OFF                                      CFT008
      *                                                                   CDE002
      ** Set output detail transaction identifier                         CDE002
     C           CDE002    IFEQ 'Y'                                       CDE002
     C           CSD017    OREQ 'Y'                                                           CSD017
     C                     MOVE TRNSID    FPTRID                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   187218
      * Set flag for credit date accounting finished                      187218
      *                                                                   187218
     C                     MOVEL'Y'       AKEYCH                          187218
      *                                                                   CFT008
      * Process only if credit date                                       187218
      *                                                                   187218
     C           AKEYCD    IFNE 'Y'                                       CFT008
     C           CRDVDT    ANDLEEDAT                                      187218
     C***********          MOVEL'Y'       AKEYCH                    CFT008187218
     C                     MOVEL'Y'       AKEYCD                          CFT008
     C                     Z-ADDCRDVDT    VDAT                            187218
      *                                                                   CFT008
      *  1. Transfer amount, with receiver's charges deducted             CFT008
      *     This is the amount that will be credited for the transfer.    CFT008
      *     'Credit ccy' is the currency of the account to be credited    CFT008
      *     with the transfer (beneficiary or account with institution)   CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
      * If an outgoing payment has been generated, use suspense A/c       187215
      *  else use customer account                                        187215
     C           GOPFLG    WHEQ 'Y'                                       187215
     C                     MOVELBRCA      #BRCA                           187215
     C                     MOVELPAYCCY    S#CCY   3                       187215
     C                     EXSR GETSPS                                    187215
      *                                                                   CFT008
     C           AWITP     WHEQ 'I'                                       CFT008
     C                     MOVELACCI35    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           AWITP     WHEQ 'G'                                       CFT008
     C           AWITP     OREQ 'F'                                       CFT008
     C           AWITP     OREQ 'R'                                       CFT008
     C                     MOVELACCI35    FLD19                           CFT008
     C                     MOVELAWITP     PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           BENTTD    WHEQ 'I'                                       CFT008
     C                     MOVELBENF1     P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           BENTTD    WHEQ 'G'                                       CFT008
     C           BENTTD    OREQ 'F'                                       CFT008
     C           BENTTD    OREQ 'R'                                       CFT008
     C                     MOVELBENF1     FLD19                           CFT008
     C                     MOVELBENTTD    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C************         MOVELCCY       ECCY                            187226
     C                     MOVELPAYCCY    ECCY                            187226
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD*ZEROS    OAMT                            CFT008
     C                     Z-ADDPAYAMT    EAMT                            CFT008
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDPAYAMT    WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT008
     C           CCTCHG    IFEQ 'BEN'                                     CFT008
     C           CCTCHG    OREQ 'SHA'                                     CFT008
     C           CCYCHG    OREQ 'BEN'                                     CFT008
     C           CCYCHG    OREQ 'SHA'                                     CFT008
     C                     SUB  RCVOCG    EAMT                            CFT008
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  RCVOCG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     MOVEL'L'       KPYRE                           CFT008
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
     C/COPY WNCPYSRC,FT0210C064
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
      * 2.  BCEQ transfer amount, with receiver's charges deducted if     CFT008
      *     BEN or SHA.  Base ccy.  (one per credit).                     CFT008
      *     It is ESSENTIAL that the total of each of these BCEQ amount   CFT008
      *     EXACTLY equals the BCEQ amount for the total transfer         CFT008
      *     generated on debit date.                                      CFT008
      *                                                                   CFT008
     C                     MOVELPAYCCY    KCCY                            CFT008
     C                     MOVEL'B'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     MOVELCCTCCY    OCCY                            CFT008
     C                     MOVELBCCY      ECCY                            CFT008
     C                     MOVELPAYCCY    FRMCCY                          CFT008
      *                                                                   CFT008
     C                     MOVELBCCY      TOCCY                           CFT008
      *                                                                   CFT008
     C                     Z-ADDPYBCQS    CVTRAT                          CFT008
     C                     Z-ADDEAMT      INPAMT                          CFT008
     C                     Z-ADDEAMT      OAMT                            CFT008
      *                                                                   CFT008
     C                     Z-ADDCCTAMT    EAMT                            CFT008
     C                     SUB  RCVCTF    EAMT                            CFT008
      *                                                                   CFT008
     C           FRMCCY    IFNE TOCCY                                     CFT008
     C                     EXSR GETBAS                                    CFT008
     C                     Z-ADDOUTAMT    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDINPAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
     C           RMODE     IFEQ 'N'                                       185700
     C                     UPDATFT102DD0                                  CFT008
     C                     ENDIF                                          185700
     C                     ENDIF                                          CFT008
      *                                                                   187218
      * If AKEYCD not Y then blank flag                                   187218
      *                                                                   187218
     C           AKEYCD    IFNE 'Y'                                       187218
     C                     MOVEL*BLANKS   AKEYCH                          187218
     C                     ENDIF                                          187218
      *                                                                   CFT008
     C           CCTID     READEFT102DL0                 97               CFT008
     C                     ENDDO                                          CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C           CCTTYP    WHEQ 'BO'                                      CFT008
     C           AKEYCH    ANDNE'Y'                                       CFT008
     C                     MOVEL'Y'       AKEYCH                          CFT008
      *                                                                   CFT008
      * 1.  Total transfer amount.  Transfer ccy.  (one per MT102).       CFT008
      *     This is the total amount remitted to the nostro.              CFT008
      *                                                                   CFT008
     C                     SELEC                                          CFT008
      *                                                                   CFT008
     C           DSTTYP    WHEQ 'I'                                       CFT008
     C                     MOVELCCTDST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           DSTTYP    WHEQ 'G'                                       CFT008
     C           DSTTYP    OREQ 'F'                                       CFT008
     C           DSTTYP    OREQ 'R'                                       CFT008
     C                     MOVELCCTDST    FLD19                           CFT008
     C                     MOVELDSTTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           SNDTYP    WHEQ 'I'                                       CFT008
     C                     MOVELSNDCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SNDTYP    WHEQ 'G'                                       CFT008
     C           SNDTYP    OREQ 'F'                                       CFT008
     C           SNDTYP    OREQ 'R'                                       CFT008
     C                     MOVELSNDCOR    FLD19                           CFT008
     C                     MOVELSNDTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           RCVTYP    WHEQ 'I'                                       CFT008
     C                     MOVELRCVCOR    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           RCVTYP    WHEQ 'G'                                       CFT008
     C           RCVTYP    OREQ 'F'                                       CFT008
     C           RCVTYP    OREQ 'R'                                       CFT008
     C                     MOVELRCVCOR    FLD19                           CFT008
     C                     MOVELRCVTYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                        Nostro         CFT008
     C           SINSTT    OREQ 'R'                        Iban           CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'I'                                       CFT008
     C                     MOVELCSINST    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           SINSTT    WHEQ 'G'                                       CFT008
     C           SINSTT    OREQ 'F'                                       CFT008
     C           SINSTT    OREQ 'R'                                       CFT008
     C                     MOVELCSINST    FLD19                           CFT008
     C                     MOVELSINSTT    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'I'                                       CFT008
     C                     MOVELTOCUS1    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           CUSTTH    WHEQ 'G'                                       CFT008
     C           CUSTTH    OREQ 'F'                                       CFT008
     C           CUSTTH    OREQ 'R'                                       CFT008
     C                     MOVELTOCUS1    FLD19                           CFT008
     C                     MOVELCUSTTH    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
     C           HOITYP    WHEQ 'I'                                       CFT008
     C                     MOVELOINST3    P@IBAN                          CFT008
     C                     EXSR SRIBAN                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
     C           HOITYP    WHEQ 'G'                                       CFT008
     C           HOITYP    OREQ 'F'                                       CFT008
     C           HOITYP    OREQ 'R'                                       CFT008
     C                     MOVELOINST3    FLD19                           CFT008
     C                     MOVELHOITYP    PRT1T                           CFT008
     C                     EXSR FMTACC                                    CFT008
     C                     EXSR SETTLE                                    CFT008
     C                     MOVELSETAC     SEAC                            CFT008
      *                                                                   CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C                     MOVELHTFCCY    ECCY                            CFT008
     C                     MOVE *BLANKS   KCCY                            CFT008
     C                     Z-ADDHTFAMT    EAMT                            CFT008
     C                     MOVEL'T'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
      *   = = = = = = = = = = = = = = = = = = = = = = = = = = = =         CFT008
      *                                                                   CFT008
      * 2.  BCEQ total transfer amount.  Base ccy.  (one per MT102).      CFT008
      *                                                                   CFT008
     C/COPY WNCPYSRC,FT0210C065
     C                     MOVELHTFCCY    FRMCCY                          CFT008
      *                                                                   CFT008
     C                     MOVELBCCY      TOCCY                           CFT008
      *                                                                   CFT008
     C**********           Z-ADDPYBCQS    CVTRAT                    CFT008185701
     C                     Z-ADDTFBCQS    CVTRAT                          185701
     C                     Z-ADDHTFAMT    INPAMT                          CFT008
     C                     Z-ADDHTFAMT    OAMT                            CFT008
     C                     MOVELHTFCCY    OCCY                            CFT008
      *                                                                   CFT008
     C           TOCCY     IFNE FRMCCY                                    CFT008
     C                     EXSR GETBAS                                    CFT008
     C                     Z-ADDOUTAMT    EAMT                            CFT008
     C                     ELSE                                           CFT008
     C                     Z-ADDINPAMT    EAMT                            CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     MOVELBCCY      ECCY                            CFT008
     C                     MOVELHTFCCY    KCCY                            CFT008
     C                     MOVEL'B'       KPYRE                           CFT008
      *                                                                   CFT008
     C                     EXSR WRIT                                      CFT008
     C                     MOVE *BLANKS   OCCY                            CFT008
     C                     Z-ADD0         OAMT                            CFT008
      *                                                                   CFT008
     C                     ENDSL                                          CFT008
      *                                                                   CFT008
     C                     ENDSR                                          CFT008
     C************************************************************        CFT008
     C* SRIBAN SR.                                                        CFT006
     C* Get Account Details from IBAN number                              CFT006
     C************************************************************        CFT006
     C           SRIBAN    BEGSR                                          CFT006
      *                                                                   CFT006
     C                     MOVE *BLANKS   SETAC                           CFT014
     C                     MOVE *BLANKS   WPIBAN                                           BUG15046A
     C                     MOVE P@IBAN    WPIBAN                                           BUG15046A
     C           SLASH1    IFEQ '/'                                                        BUG15046A
     C                     MOVEL*BLANKS   P@IBAN                                           BUG15046A
     C                     MOVELWVIBAN    P@IBAN                                           BUG15046A
     C                     ENDIF                                                           BUG15046A
      *                                                                   CFT014
     C                     CALL 'AOIBANR4'                                CFT006
     C                     PARM *BLANKS   P@RTCD  7                       CFT006
     C                     PARM '*KEY   ' P@OPTN  7                       CFT006
     C                     PARM           P@IBAN 34                       CFT006
     C           ACNT      PARM *BLANKS   DSSDY                           CFT014
     C***********          PARM           P@FMT                    CFT006 CFT014
      *                                                                   CFT006
     C***********          MOVELACCNUM    CNUMC   6                CFT006 CFT014
     C***********          MOVELACACOD    ACODC   4                CFT006 CFT014
     C***********          MOVELACACSQ    ACSQC   2                CFT006 CFT014
      *                                                                   CFT006
     C           P@RTCD    IFNE *BLANKS                                   CFT006
     C                     MOVEL'FT0210'  DBPGM            ***************CFT006
     C                     MOVEL'P@IBAN  'DBKEY            ** DBERR  18 **CFT006
     C                     MOVEL'AOIBANR4'DBFILE           ***************CFT006
     C                     Z-ADD999       DBASE                           CFT006
     C                     OUT  DLDA                                      CFT006
     C                     RETRN                                          CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C***********          MOVELCNUMC     SETAC                    CFT006 CFT014
     C***********SETAC     CAT  ACCCY     SETAC                    CFT006 CFT014
     C***********SETAC     CAT  ACODC     SETAC                    CFT006 CFT014
     C***********SETAC     CAT  ACSQC     SETAC                    CFT006 CFT014
     C***********SETAC     CAT  BRCA      SETAC                    CFT006 CFT014
     C**********           Z-ADDS4CNUM    CNUMX                                        CFT014 CSD027
     C                     MOVE S4CNUM    CNUMX                                               CSD027
     C                     MOVE S4CCY     CCYX                            CFT014
     C                     Z-ADDS4ACOD    ACODX                           CFT014
     C                     Z-ADDS4ACSQ    ACSQX                           CFT014
     C                     MOVE S4BRCA    BRCHX                           CFT014
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* GET BASE AMOUNT                                                   CFT006
     C* Calculates Base Ccy Equivalent                                    CFT006
     C************************************************************        CFT006
     C           GETBAS    BEGSR                                          CFT006
      *                                                                   CFT006
      * Calculate base currency equivalent                                CFT006
      *                                                                   CFT006
     C                     CALL 'AOCURRR0'                                CFT006
     C                     PARM *BLANKS   @RTCD                           CFT006
     C                     PARM '*KEY'    @OPTN                           CFT006
     C                     PARM FRMCCY    @CCY                            CFT006
     C***********SDCURR    PARM SDCURR    DSFDY                           CFT006              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                                               CSD006
      *                                                                   CFT006
     C           *LIKE     DEFN A6NBDP    BASDEC                          CFT006
     C                     MOVELA6NBDP    BASDEC                          CFT006
     C           *LIKE     DEFN A6MDIN    BASMD                           CFT006
     C                     MOVELA6MDIN    BASMD                           CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C                     CALL 'AOCURRR0'                                CFT006
     C                     PARM *BLANKS   @RTCD                           CFT006
     C                     PARM '*KEY'    @OPTN                           CFT006
     C                     PARM TOCCY     @CCY    3                       CFT006
     C***********SDCURR    PARM SDCURR    DSFDY                           CFT006              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                                               CSD006
      *                                                                   CFT006
     C           *LIKE     DEFN A6NBDP    TODEC                           CFT006
     C                     MOVELA6NBDP    TODEC                           CFT006
      *                                                                   CFT006
     C                     CALL 'ZCONVZ1'                                 CFT006
     C                     PARM           INPAMT 150                      CFT006
     C                     PARM           CVTRAT                          CFT006
     C                     PARM           BASMD                           CFT006
     C                     PARM           FRMCCY  3                       CFT006
     C                     PARM           TOCCY   3                       CFT006
     C                     PARM           BASDEC                          CFT006
     C                     PARM           TODEC                           CFT006
     C                     PARM *ZEROS    OUTAMT 150                      CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* GETSPS SR.                                                        CFT006
     C* Get suspense Account details                                      CFT006
     C************************************************************        CFT006
     C           GETSPS    BEGSR                                          CFT006
      *                                                                   CFT006
      * Use branch code to obtain branch details                          CFT006
     C**********           CALL 'AOBRCHR0'                                CFT006              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           CFT006
     C                     PARM '*KEY   ' @OPTN                           CFT006
     C                     PARM           #BRCA   3                       CFT006
     C********** SDBRCH    PARM SDBRCH    DSFDY                           CFT006              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CFT006
      ** If record not found                                              CFT006
     C           @RTCD     IFNE *BLANK                                    CFT006
     C                     Z-ADD42        WBASE            ************   CFT006
     C                     MOVEL'SDBRCHPD'WFILE            *DB ERROR 42   CFT006
     C                     MOVEL#BRCA     WKEY             ************   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *BLANKS   SEAC                            CFT006
     C                     MOVELA8BICN    SEAC                            CFT006
     C           SEAC      CAT  S#CCY:0   SEAC                            CFT006
     C********** SEAC      CAT  A8DFAC:0  SEAC                            187225
     C           SEAC      CAT  WWIOSA:0  SEAC                            187225
     C           SEAC      CAT  '01':0    SEAC                            CFT006
     C           SEAC      CAT  #BRCA:0   SEAC                            CFT006
      *                                                                   CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************        CFT006
     C* FMTACC SR.                                                        CFT006
     C* FORMAT ACCOUNT : MT101 AND MT102 ONLY                             CFT006
     C************************************************************        CFT006
     C           FMTACC    BEGSR                                          CFT006
      *                                                                   CFT006
     C                     MOVEL*BLANKS   OLDFLD                          CFT006
     C                     MOVEL*BLANKS   NEWFLD                          CFT006
      *                                                                   CFT006
     C           PRT1T     IFEQ 'G'                                       CFT006
      * Account was in format                                             CFT006
      *  000018gbp140501dom (Cust/ccy/acc/seq/brch                        CFT006
      * Now in format                                                     CFT006
      * dom000018GBP140501 (brch/cust/CCY/ACC/seq                         CFT006
      *                                                                   CFT006
      * Field PRT1 in old format.  Format to new                          CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     NEWFLD                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     NEWFLD                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVELXCNUM     YCNUM                           CFT006
     C                     MOVELXACC      YACC                            CFT006
     C                     MOVELXCCY      YCCY                            CFT006
     C                     MOVELXBRCA     YBRCA                           CFT006
     C                     MOVELXSEQ      YSEQ                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           PRT1T     IFEQ 'F'                                       CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     OLDFLD                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     OLDFLD                          CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      * FORMAT RETAIL ACCOUNT TO GL ACCOUNT                               CFT006
     C           PRT1T     IFEQ 'R'                                       CFT006
     C                     MOVEL'G'       PRT1T                           CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     ACNO                            CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     ACNO                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C           ACNO      CHAINACNUMA               89                   CFT006
      *                                                                   CFT006
     C                     MOVELCNUM      YCNUM                           CFT006
     C                     MOVELCCY       YCCY                            CFT006
     C                     MOVELACOD      YACC                            CFT006
     C                     MOVELACSQ      YSEQ                            CFT006
     C                     MOVELBRCA      YBRCA                           CFT006
     C                     MOVELBRCAAC    YBRCA                           177808
     C                     ENDIF                                          CFT006
      *                                                                                     BUG15046
      * FORMAT IBAN TO GL ACCOUNT                                                           BUG15046
     C           PRT1T     IFEQ 'I'                                                         BUG15046
      *                                                                                     BUG15046
     C           FST1      IFEQ '/'                                                         BUG15046
     C                     MOVELSND18     P@IBAN                                            BUG15046
     C                     MOVELSND18     OLDFLD                                            BUG15046
     C                     ELSE                                                             BUG15046
     C                     MOVELFST18     P@IBAN                                            BUG15046
     C                     MOVELFST18     OLDFLD                                            BUG15046
     C                     ENDIF                                                            BUG15046
      *                                                                                     BUG15046
     C                     CALL 'AOIBANR4'                                                  BUG15046
     C                     PARM *BLANKS   P@RTCD                                            BUG15046
     C                     PARM '*KEY   ' P@OPTN                                            BUG15046
     C                     PARM           P@IBAN                                            BUG15046
     C           ACNT      PARM *BLANKS   DSSDY                                             BUG15046
     C           P@RTCD    IFEQ *BLANKS                                                     BUG15046
     C                     MOVE S4CNUM    YCNUM                                             BUG15046
     C                     MOVE S4CCY     YCCY                                              BUG15046
     C                     MOVE S4ACOD    YACC                                              BUG15046
     C                     MOVE S4ACSQ    YSEQ                                              BUG15046
     C                     MOVE S4BRCA    YBRCA                                             BUG15046
     C                     ENDIF                                                            BUG15046
      *                                                                                     BUG15046
     C                     ENDIF                                                            BUG15046
      *                                                                   CFT006
     C                     MOVELOLDFLD    PRT1                            CFT006
      *                                                                   CFT006
     C                     ENDSR                                          CFT006
     C************************************************************
     C* OTPAYS SR.
     C* CREATE OUTGOING PAYMENT ACCOUNT KEYS
     C************************************************************
     C*
     C           OTPAYS    BEGSR
     C*
     C                     SETON                     21                   S01117
     C                     EXSR CHGBR                                     S01117
     C*                                                                   S01117
     C* CHECK IF LIVE RECORD AND NOT REGULAR PAYMENT
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           OTRECI    IFNE 'D'                        B001           E32873
     C           PYTP      ORNE 'OP'
     C           AUIN      ORNE 'Y'
     C                     GOTO OTEND
     C                     END                             E001
      *                                                                   CFT014
      ** Access Outgoing Payments extension file.                         CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
     C           PREF      CHAINOTPAYXL0             28                   CFT014
     C           *IN28     IFEQ *ON                                       CFT014
     C           *IN28     OREQ *OFF                                      CFT014
     C           OPRECI    ANDNE'D'                                       CFT014
     C                     Z-ADD025       WBASE                           CFT014
     C                     MOVELPREF      WKEY                            CFT014
     C                     MOVEL'OTPAYXL0'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C*
     C                     Z-ADD0         CQSQ
     C                     MOVE *BLANK    OTAC
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* SETTLE SETTLEMENT ACCOUNT
     C*
      ** If payment generated from an incoming one, use suspense a/c
      ** Otherwise, use ordering bank/customer
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP39                                           S01408
     C*                                                                   S01408
      ** If Charges t the DR of Currency used, set it in Base Ccy field                       CFT120
      ** temporarily                                                                          CFT120
      *                                                                                       CFT120
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    BCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C           OPIN      IFEQ 'Y'
     C*                                                                   S01117
     C** Get branch internal Customer no. for suspense a/c no.            S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   KEY                             S01117
     C                     MOVEL'10    '  KEY                             S01117
     C                     MOVE BRCA      KEY                             S01117
     C           KEY       CHAINTABFP                89                   S01117
     C  N89      RECI      COMP 'D'                  8989                 S01117
     C   89                DO                              B001           S01117
     C                     MOVE 'TABFP'   WFILE            ***************S01117
     C                     MOVELKEY       WKEY             ** DBERR  13 **S01117
     C                     Z-ADD13        WBASE            ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C                     MOVE SMCY      CCYX
     C**********           Z-ADDBICN      CNUMX                                               CSD027
     C                     MOVE BICN      CNUMX                                               CSD027
     C*********************Z-ADDFTCD      ACODX                           S01117
     C                     MOVE BTIOSA    ACODX                           S01117
     C                     MOVE '01'      ACSQX
     C                     MOVE BRCA      BRCHX                           S01117
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP40                                           S01408
     C*                                                                   S01408
     C                     MOVE SMCY      CCCY
     C                     MOVE ORBT      PRT1T
     C*********************MOVELORBK      PRT1                            S01117
     C**********           MOVE *BLANKS   WRK15  15                                    S01117 CGL029
     C                     MOVE *BLANKS   WRK15  21                                           CGL029
     C                     MOVELORBK      WRK15                           S01117
     C                     MOVE ORBB      WRK15                           S01117
     C                     MOVELWRK15     PRT1                            S01117
     C/COPY WNCPYSRC,FT0210C049
     C                     MOVE ORCT      PRT2T
     C                     MOVELORC1      PRT2
     C                     MOVELORC1      WSLASH  1                                           CFT032
     C           WSLASH    IFEQ '/'                                                           CFT032
     C           ORCT      IFEQ 'C'                                                           CFT032
     C           ORCT      OREQ 'S'                                                           CFT032
     C           ORCT      OREQ 'A'                                                           CFT032
     C                     MOVELORC2      PRT2                                                CFT032
     C                     ENDIF                                                              CFT032
     C           ORCT      IFNE 'C'                                                           CFT032
     C           ORCT      ANDNE'S'                                                           CFT032
     C           ORCT      ANDNE'A'                                                           CFT032
     C           34        SUBSTORC1:2    WORC1  34                                           CFT032
     C                     MOVELWORC1     PRT2                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     EXSR SETTLE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP41                                           S01408
     C*                                                                   S01408
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP42                                           S01408
     C*                                                                   S01408
     C*********************MOVELSETAC     STLAC  15                       S01117
     C**********           MOVELSETAC     STLAC  18                                    S01117 CGL029
     C                     MOVELSETAC     STLAC  24                                           CGL029
     C*
     C* PAY SETTLEMENT ACCOUNT
     C*
     C                     MOVE PCCY      CCCY
     C                     MOVE SNCT      PRT1T
     C                     MOVELSNCO      PRT1
     C                     MOVE DSTT      PRT2T
     C                     MOVELDST1      PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     PAYAC  15                       S01117
     C**********           MOVELSETAC     PAYAC  18                                    S01117 CGL029
     C                     MOVELSETAC     PAYAC  24                                           CGL029
     C*
     C* IF CHARGES TO THE DEBIT OF NOT BLANK FIND SETTLEMENT ACCOUNT
     C*
     C***********CDRO      IFNE 0                          B001                               CSD027
     C           CDRO      IFNE *BLANKS                    B001                               CSD027
      *                                                                                       CFT120
     C                     MOVE BCCY      CCCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    CCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVE CDRT      PRT1T
     C*********************MOVELCDRO      PRT1                            S01117
     C                     EXSR CHADBT                                    S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     BASAC  15                       S01117
     C**********           MOVELSETAC     BASAC  18                                    S01117 CGL029
     C                     MOVELSETAC     BASAC  24                                           CGL029
     C                     END                             E001
      *                                                                   044094
      *  Analyse dates to see if keys should be generated                 044094
      *                                                                   044094
     C                     MOVEL'N'       @SDATE  1                       044094
     C                     MOVEL'N'       @PDATE  1                       044094
      *                                                                   044094
      *  If Generate posting flag is 'I' then generate all postings       044094
      *  => Generate postings on authorisation date.                      044094
      *                                                                   044094
     C/COPY WNCPYSRC,FT0210C019
     C           C#GPFG    IFEQ 'I'                                       044094
     C/COPY WNCPYSRC,FT0210C021
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
     C           SACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
     C           PACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
     C                     END                                            044094
      *                                                                   044094
      *  If Generate posting flag is 'E' then generate on event date      044094
      *  => Generate postings when event date is reached.                 044094
      *                                                                   044094
     C/COPY WNCPYSRC,FT0210C022
     C           C#GPFG    IFEQ 'E'                                       044094
     C/COPY WNCPYSRC,FT0210C023
      *                                                                   044094
     C           SACG      IFNE 'Y'                                       044094
     C           SLDT      ANDLEEDAT                                      044094
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C           PACG      IFNE 'Y'                                       044094
     C           PVDT      ANDLEEDAT                                      044094
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
      *                                                                   044094
      *  If Generate posting flag is 'S' then generate on earlier date    044094
      *  => Generate postings either settle or pay date reached.          044094
      *                                                                   044094
     C/COPY WNCPYSRC,FT0210C024
     C           C#GPFG    IFEQ 'S'                                       044094
     C/COPY WNCPYSRC,FT0210C025
      *                                                                   044094
     C           SLDT      IFLE EDAT                                      044094
     C           PVDT      ORLE EDAT                                      044094
      *                                                                   044094
     C           PVDT      IFLE SLDT                                      056031
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     Z-ADDPVDT      S#EPSD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDSLDT      P#EPSD                          056031
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     END                                            056031
      *                                                                   044094
     C           SACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C           PACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
     C/COPY WNCPYSRC,FT0210C020
      *                                                                   044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           OTOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADDRUND      EPSD                            056031
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP2                                           S01408
     C*                                                                   S01408
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     Z-ADDSMAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDEQ0                                                      CFT014 CSD027
     C           CDRO      ANDEQ*BLANKS                                                       CSD027
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C/COPY WNCPYSRC,FT0210C085
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,FT0210C086
     C                     EXSR WRIT
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD4                                           S01408
     C*                                                                   S01408
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     Z-ADDPYAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C026
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDSLDT      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'N'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDPVDT      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     END                                            CAC001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD4                                           S01408
     C*                                                                   S01408
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD3                                           S01408
     C*                                                                   S01408
     C*
     C                     END                             E001
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD6                                           S01408
     C*                                                                   S01408
     C*
     C* IF SETTLE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE SETTLE VALUE DATE ACCOUNT KEYS
     C*
     C***********SACG******IFNE 'Y'                        B001           044094
     C***********SLDT******ANDLEEDAT                                      044094
     C           @SDATE    IFEQ 'Y'                                       044094
     C*
     C                     Z-ADDS#EPSD    EPSD                            056031
     C                     MOVE 'P'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDEQ0                                                      CFT014 CSD027
     C           CDRO      ANDEQ*BLANKS                                                       CSD027
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C003
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDSLDT      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD5                                           S01408
     C*                                                                   S01408
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDEQ0                                                      CFT014 CSD027
     C           CDRO      ANDEQ*BLANKS                                                       CSD027
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSQ    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRBCQ    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDSMAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND SETTLE PLUS CHARGES IS Y
     C* NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'
     C                     ADD  TXCH      EAMT
     C                     ADD  CQCH      EAMT
     C/COPY WNCPYSRC,FT0210C066
     C                     ADD  CSTA      EAMT
     C/COPY WNCPYSRC,FT0210C067
     C                     ADD  SPCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  OPCHCM    EAMT                            S01501
     C                     ADD  OPVATT    EAMT                            S01501
      *                                                                                       CGL020
      ** Accumulate charges and commissions                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  SPCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  OPCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  OPRCSC    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT014
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKNUME                                              CGL020
     C                     ADD  MISC02    WKNUME                                              CGL020
     C                     ADD  MISC03    WKNUME                                              CGL020
     C                     ADD  MISC04    WKNUME                                              CGL020
     C                     ADD  MISC05    WKNUME                                              CGL020
     C                     ADD  SWSCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FT0210C010
     C                     Z-ADDSLDT      VDAT
     C/COPY WNCPYSRC,FT0210C011
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C045
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDPYAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR
     C* IS  NOT 'A' NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'
     C                     SUB  TXCH      EAMT
     C                     SUB  CQCH      EAMT
     C/COPY WNCPYSRC,FT0210C068
     C                     SUB  CSTA      EAMT
     C/COPY WNCPYSRC,FT0210C069
     C                     SUB  SPCH      EAMT
     C                     SUB  MSCH      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     SUB  OPVATT    EAMT                            S01501
     C                     SUB  OPCHCM    EAMT                            S01501
      *                                                                                       CGL020
     C           CFT009    IFEQ 'Y'                                                           239283
     C                     SUB  MISC01    EAMT                                                239283
     C                     SUB  MISC02    EAMT                                                239283
     C                     SUB  MISC03    EAMT                                                239283
     C                     SUB  MISC04    EAMT                                                239283
     C                     SUB  MISC05    EAMT                                                239283
     C                     SUB  SWSCHG    EAMT                                                239283
     C                     ENDIF                                                              239283
      *                                                                                       239283
      ** Accumulate charges and commissions                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  SPCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  OPCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  OPRCRM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT014
     C*                                                                   CFT009
     C********** CFT009    IFEQ 'Y'                                                    CFT009 239283
     C**********           SUB  MISC01    EAMT                                         CFT009 239283
     C**********           SUB  MISC02    EAMT                                         CFT009 239283
     C**********           SUB  MISC03    EAMT                                         CFT009 239283
     C**********           SUB  MISC04    EAMT                                         CFT009 239283
     C**********           SUB  MISC05    EAMT                                         CFT009 239283
     C**********           SUB  SWSCHG    EAMT                                         CFT009 239283
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKNUME                                              CGL020
     C                     ADD  MISC02    WKNUME                                              CGL020
     C                     ADD  MISC03    WKNUME                                              CGL020
     C                     ADD  MISC04    WKNUME                                              CGL020
     C                     ADD  MISC05    WKNUME                                              CGL020
     C                     ADD  SWSCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C**********           ENDIF                                                       CFT009 239283
     C*                                                                   CFT009
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT ZERO
     C* CREATE NET AMOUNT  ACCOUNT KEY
     C*
      *                                                                   043860
      *  Only create T key on settle date if charges added.               043860
      *                                                                   043860
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'                                       043860
     C*
     C                     MOVE 'T'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDTXCH      EAMT
     C                     ADD  CQCH      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  SPCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  OPCHCM    EAMT                            S01501
     C                     ADD  OPVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTXCH      WKCHRG 130                                          CGL020
     C                     ADD  CQCH      WKCHRG                                              CGL020
     C                     ADD  CSTA      WKCHRG                                              CGL020
     C                     ADD  SPCH      WKCHRG                                              CGL020
     C                     ADD  MSCH      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  OPCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKCHRG                                              CGL020
     C                     ADD  MISC02    WKCHRG                                              CGL020
     C                     ADD  MISC03    WKCHRG                                              CGL020
     C                     ADD  MISC04    WKCHRG                                              CGL020
     C                     ADD  MISC05    WKCHRG                                              CGL020
     C                     ADD  SWSCHG    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCSQ    EAMT                            CFT014
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  OPRCSQ    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT014
     C*                                                                   S01501
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDSLDT      VDAT
      *                                                                                       CFT120
     C                     MOVE BCCY      ECCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVELBASAC     SEAC
     C                     EXSR WRIT
     C                     END                             E002
     C*
     C* IF PAY DATE CHARGES DON'T GENRATE
     C*
     C***********CDRO      IFNE 0                          B002           043860
     C***********ADDC      OREQ 'A'                                       043860
      *                                                                   043860
      * Generate individual charge keys if charges added                  043860
      *                                                                   043860
     C/COPY WNCPYSRC,FT0210C012
     C           ADDC      IFEQ 'A'                                       043860
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSLDT      VDAT
     C*
     C* IF CHARGES TO THE DEBIT OF NOT ZERO IN BASE CUEENCY
     C* OTHERWISE IN SETTLE CURRENCY
     C*
     C***********CDRO      IFNE 0                          B003                               CSD027
     C           CDRO      IFNE *BLANKS                    B003                               CSD027
      *                                                                                       CFT120
     C                     MOVE BCCY      ECCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVELBASAC     SEAC
     C                     ELSE                            X003
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     END                             E003
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'X'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'V'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTXCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'Q'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Y'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCQCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C/COPY WNCPYSRC,FT0210C070
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'C'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Z'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCSTA      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C/COPY WNCPYSRC,FT0210C071
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT5    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'S'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '2'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDSPCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT6    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'M'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '3'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDMSCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT7    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDOPCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
      *                                                                   CFT009
      * New account keys for CFT009 Fees and Charges                      CFT009
      *                                                                   CFT009
      * Swift Standard Charge                                             CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVE 'S'       KCTYP                           CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTSWSC    OREQ 'N'                                       CFT009
     C                     MOVE 'S'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'T'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDSWSCHG    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous charge 1                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC1     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC01    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 2                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC2     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC02    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 3                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC3     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC03    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 4                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC4     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC04    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 5                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC5     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC05    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVE *BLANK    KCTYP                           CFT009
      *                                                                   CFT009
      * END CFT009                                                        CFT009
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDOPVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDNE0                                                      CFT014 CSD027
     C           CDRO      ANDNE*BLANKS                                                       CSD027
     C                     MOVE KCCY      ##WCCY  3                       CFT014
     C                     MOVE SMCY      KCCY                            CFT014
     C                     MOVE 'R'       KCTYP                           CFT014
     C                     MOVE 'B'       KPYRE                           CFT014
     C                     Z-ADDOPRCSQ    EAMT                            CFT014
     C                     EXSR WRIT                                      CFT014
     C                     MOVE ##WCCY    KCCY                            CFT014
     C                     MOVE *BLANK    KCTYP                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C/COPY WNCPYSRC,FT0210C013
     C                     END                             E002
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       SACG
     C*
     C                     END                             E001
     C*
     C* IF PAY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE PAY VALUE DATE ACCOUNT KEYS
     C*
     C***********PACG******IFNE 'Y'                        B001           044094
     C***********PVDT******ANDLEEDAT                                      044094
     C           @PDATE    IFEQ 'Y'                                       044094
     C/COPY WNCPYSRC,FT0210C014
     C*
     C                     Z-ADDP#EPSD    EPSD                            056031
     C                     MOVE 'R'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDEQ0                                                      CFT014 CSD027
     C           CDRO      ANDEQ*BLANKS                                                       CSD027
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C004
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDPVDT      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD5                                           S01408
     C*                                                                   S01408
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C           CFT014    IFEQ 'Y'                                       CFT014
     C***********CDRO      ANDEQ0                                                      CFT014 CSD027
     C           CDRO      ANDEQ*BLANKS                                                       CSD027
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSQ    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRBCQ    EAMT                            CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDSMAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C*  "A" NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'
     C                     ADD  TXCH      EAMT
     C                     ADD  CQCH      EAMT
     C/COPY WNCPYSRC,FT0210C072
     C                     ADD  CSTA      EAMT
     C/COPY WNCPYSRC,FT0210C073
     C                     ADD  SPCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  OPCHCM    EAMT                            S01501
     C                     ADD  OPVATT    EAMT                            S01501
      *                                                                                       CGL020
      ** Accumulate charges and commissions                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  SPCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  OPCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  OPRCSC    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT014
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKNUME                                              CGL020
     C                     ADD  MISC02    WKNUME                                              CGL020
     C                     ADD  MISC03    WKNUME                                              CGL020
     C                     ADD  MISC04    WKNUME                                              CGL020
     C                     ADD  MISC05    WKNUME                                              CGL020
     C                     ADD  SWSCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C046
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDPYAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FT0210C074
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C* "D" (DEDUCT) NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'
     C                     SUB  TXCH      EAMT
     C                     SUB  CQCH      EAMT
     C/COPY WNCPYSRC,FT0210C075
     C                     SUB  CSTA      EAMT
     C/COPY WNCPYSRC,FT0210C076
     C                     SUB  SPCH      EAMT
     C                     SUB  MSCH      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     SUB  OPCHCM    EAMT                            S01501
     C                     SUB  OPVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CFT009    IFEQ 'Y'                                                           239283
     C                     SUB  MISC01    EAMT                                                239283
     C                     SUB  MISC02    EAMT                                                239283
     C                     SUB  MISC03    EAMT                                                239283
     C                     SUB  MISC04    EAMT                                                239283
     C                     SUB  MISC05    EAMT                                                239283
     C                     SUB  SWSCHG    EAMT                                                239283
     C                     ENDIF                                                              239283
      *                                                                                       239283
      ** Accumulate charges and commissions                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  SPCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  OPCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  OPRCRM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                          CFT014
     C*                                                                   CFT009
     C********** CFT009    IFEQ 'Y'                                                    CFT009 239283
     C**********           SUB  MISC01    EAMT                                         CFT009 239283
     C**********           SUB  MISC02    EAMT                                         CFT009 239283
     C**********           SUB  MISC03    EAMT                                         CFT009 239283
     C**********           SUB  MISC04    EAMT                                         CFT009 239283
     C**********           SUB  MISC05    EAMT                                         CFT009 239283
     C**********           SUB  SWSCHG    EAMT                                         CFT009 239283
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKNUME                                              CGL020
     C                     ADD  MISC02    WKNUME                                              CGL020
     C                     ADD  MISC03    WKNUME                                              CGL020
     C                     ADD  MISC04    WKNUME                                              CGL020
     C                     ADD  MISC05    WKNUME                                              CGL020
     C                     ADD  SWSCHG    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C**********           ENDIF                                                       CFT009 239283
     C*                                                                   CFT009
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
      *                                                                   043860
      * If Charges to the Debit of is not zero and charges are            043860
      * to be deducted then create T key                                  043860
      *                                                                   043860
     C***********CDRO      IFNE 0                          B002                        043860 CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'                                       043860
      *                                                                   043860
     C                     MOVE 'T'       KPYRE                           043860
     C                     MOVEL*BLANK    KCCY                            043860
     C                     Z-ADDTXCH      EAMT                            043860
     C                     ADD  CQCH      EAMT                            043860
     C***********          ADD  ADCH      EAMT                     043860 067359
     C***********          ADD  TLCH      EAMT                     043860 067359
     C                     ADD  CSTA      EAMT                            067359
     C                     ADD  SPCH      EAMT                            067359
     C                     ADD  MSCH      EAMT                            043860
     C                     ADD  TRCM      EAMT                            043860
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  OPCHCM    EAMT                            S01501
     C                     ADD  OPVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTXCH      WKCHRG                                              CGL020
     C                     ADD  CQCH      WKCHRG                                              CGL020
     C                     ADD  CSTA      WKCHRG                                              CGL020
     C                     ADD  SPCH      WKCHRG                                              CGL020
     C                     ADD  MSCH      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  OPCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
      *                                                                   CFT009
      * If CFT009 active, include new charges                             CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MISC01    WKCHRG                                              CGL020
     C                     ADD  MISC02    WKCHRG                                              CGL020
     C                     ADD  MISC03    WKCHRG                                              CGL020
     C                     ADD  MISC04    WKCHRG                                              CGL020
     C                     ADD  MISC05    WKCHRG                                              CGL020
     C                     ADD  SWSCHG    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT                            043860
     C                     MOVE BCCY      ECCY                            043860
     C                     MOVELBASAC     SEAC                            043860
     C                     EXSR WRIT                                      043860
     C                     END                             E002           043860
     C*
     C* IF SETTLE DATE CHARGES DON'T GENRATE
     C*
     C***********CDRO      IFEQ 0                          B002           043860
     C***********ADDC      ANDNE'A'                                       043860
     C/COPY WNCPYSRC,FT0210C077
      *                                                                   043860
      * Generate individual charge keys on pay date if they are           043860
      * to be deducted.                                                   043860
      *                                                                   043860
     C           ADDC      IFNE 'A'                        B002           043860
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPVDT      VDAT
     C*********************MOVE PCCY      ECCY                            043860
     C*********************MOVELPAYAC     SEAC                            043860
     C*                                                                   043860
     C* IF CHARGES TO THE DEBIT OF NOT ZERO IN BASE CUEENCY               043860
     C* OTHERWISE IN PAY CURRENCY                                         043860
     C*                                                                   043860
     C***********CDRO      IFNE 0                          B003                        043860 CSD027
     C           CDRO      IFNE *BLANKS                    B003                               CSD027
     C                     MOVE BCCY      ECCY                            043860
     C                     MOVELBASAC     SEAC                            043860
     C                     ELSE                            X003           043860
     C                     MOVE PCCY      ECCY                            043860
     C                     MOVELPAYAC     SEAC                            043860
     C                     END                             E003           043860
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'X'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'V'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTXCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'Q'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Y'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCQCH      EAMT
     C                     EXSR WRIT
     C*
     C/COPY WNCPYSRC,FT0210C078
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'C'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Z'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCSTA      EAMT
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C079
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT5    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'S'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '2'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDSPCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT6    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'M'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '3'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDMSCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           OPVAT7    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDOPCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDOPVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
      * New account keys for FT Fees and Charges                          CFT009
      * S.W.I.F.T. standard charge                                        CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTSWSC    OREQ 'N'                                       CFT009
     C                     MOVE 'S'       KCTYP                           CFT009
     C                     MOVE 'S'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'S'       KCTYP                           CFT009
     C                     MOVE 'T'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDSWSCHG    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 1                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC1     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC01    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 2                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC2     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC02    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 3                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC3     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC03    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 4                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC4     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC04    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 5                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VMIC5     OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMISC05    EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVE *BLANK    KCTYP                           CFT009
     C                     END                             E002
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       PACG
     C*
     C/COPY WNCPYSRC,FT0210C015
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           SLDT      IFLE EDAT                                      056031
     C           PVDT      ANDLEEDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           SACG      ANDEQ'Y'
     C           PACG      ANDEQ'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       OTRECI                          E32873
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVE OTRECI    OPRECI                          CFT014
     C                     ENDIF                                          CFT014
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATOTPAYDDF
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           *IN50     ANDEQ*ON                                       CFT014
     C                     UPDATOTPAYXDF                                  CFT014
     C                     ENDIF                                          CFT014
      *                                                                   S01435
      * Update Incoming Message FT Transaction Status File record         S01435
      * if payment created from Incoming Electronic Message and           S01435
      * payment matured                                                   S01435
      *                                                                   S01435
     C           *IN50     IFEQ '1'                                       S01435
     C           OTRECI    ANDEQ'M'                                       S01435
     C           OPMSGR    IFNE 0                                         S01435
      *                                                                   S01435
     C                     EXSR SRINFT                                    S01435
      *                                                                   S01435
     C                     END                                            S01435
     C                     END                                            S01435
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C/COPY WNCPYSRC,FT0210C001
     C           OTEND     TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD1         H       30
     C                     Z-ADDSMAM      PRMAMT 130
     C                     EXSR HASH
     C/COPY WNCPYSRC,FT0210C007
     C*
      ** Restore original value of BCCY.                                                      CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     MOVE UMBCCY    BCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* INPAYS SR.
     C* CREATE INCOMING PAYMENT ACCOUNT KEYS
     C************************************************************
     C*
     C           INPAYS    BEGSR
     C*                                                                   S01117
     C                     SETON                     22                   S01117
     C*                                                                   CAC002
     C**  If Analytical Accounting is installed, use the 'Teller Profit   CAC002
     C**  Centre' for Draft Issued payment.                               CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PYST      ANDEQ'DI'                                      CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          S01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             S01117
     C*                                                                   S01117
     C           *IN46     IFEQ '0'                                       S01117
     C           *IN,A     ANDEQ'1'                                       S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     SETOF                     45                   S01117
     C                     MOVE *BLANKS   BRCA1                           S01117
     C                     END                                            S01117
     C                     SETON                     46                   S01117
     C*                                                                   S01117
     C                     EXSR CHGBR                                     S01117
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPDR                                           S01408
     C*                                                                   S01408
     C*                                                                   S01117
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           INRECI    IFNE 'D'                        B001           E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO INEND
     C                     END                             E001
      *                                                                   CFT014
      ** Access Incoming Payments extension file.                         CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
     C           PREF      CHAININPAYXL0             28                   CFT014
     C           *IN28     IFEQ *ON                                       CFT014
     C           *IN28     OREQ *OFF                                      CFT014
     C           IXRECI    ANDNE'D'                                       CFT014
     C                     Z-ADD026       WBASE                           CFT014
     C                     MOVELPREF      WKEY                            CFT014
     C                     MOVEL'INPAYXL0'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Instructed Ccy details                                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    WINCY1                          CFT014
     C                     Z-ADD0         WTPSD1                          CFT014
     C           NDCY      IFNE *BLANKS                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM *BLANKS   PRTCD                           CFT014
     C                     PARM '*KEY   ' POPTN                           CFT014
     C                     PARM NDCY      PKCCY   3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
     C           PRTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE A6INCY    WINCY1  1                       CFT014
     C                     Z-ADDA6TPSD    WTPSD1  50                      CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADD027       WBASE                           CFT014
     C                     MOVELNDCY      WKEY                            CFT014
     C                     MOVEL'SDCURRPD'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Settlement Ccy details                                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    WINCY2                          CFT014
     C                     Z-ADD0         WTPSD2                          CFT014
     C           SMCY      IFNE *BLANKS                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM *BLANKS   PRTCD                           CFT014
     C                     PARM '*KEY   ' POPTN                           CFT014
     C                     PARM SMCY      PKCCY                           CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
     C           PRTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE A6INCY    WINCY2  1                       CFT014
     C                     Z-ADDA6TPSD    WTPSD2  50                      CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADD028       WBASE                           CFT014
     C                     MOVELSMCY      WKEY                            CFT014
     C                     MOVEL'SDCURRPD'WFILE                           CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD1                                           S01408
     C*                                                                   S01408
      ** If Charges t the DR of Currency used, set it in Base Ccy field                       CFT120
      ** temporarily                                                                          CFT120
      *                                                                                       CFT120
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE INCDRC    BCCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C*
     C                     Z-ADD0         CQSQ
     C                     MOVE *BLANK    OTAC
     C*
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* SETTLE SETTLEMENT ACCOUNT
     C*
     C                     MOVE SMCY      CCCY
      *                                                                   CFT014
      ** Third Reimbursement Institution takes precedence over the        CFT014
      ** Receiver's Correspondent or the Sender.                          CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
     C           INTRIT    WHEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C                     MOVE INTRIB    P@IBAN                          CFT014
     C                     EXSR SRIBAN                                    CFT014
      *                                                                   CFT014
     C           INTRIT    WHNE *BLANKS                                   CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C                     MOVE INTRIT    PRT1T                           CFT014
     C                     MOVELINTRIB    PRT1                            CFT014
     C                     EXSR SETTLE                                    CFT014
      *                                                                   CFT014
     C           INRCRT    WHEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C                     MOVE INRCO1    P@IBAN                          CFT014
     C                     EXSR SRIBAN                                    CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
      *                                                                   CFT014
     C***********          MOVE RCRT      PRT1T                           CFT014
     C***********          MOVELRCCO      PRT1                            CFT014
     C                     MOVE INRCRT    PRT1T                           CFT014
     C                     MOVELINRCO1    PRT1                            CFT014
     C                     MOVE SNTP      PRT2T
     C                     MOVELSND1      PRT2
     C                     EXSR SETTLE
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C*********************MOVELSETAC     STLAC  15                       S01117
     C                     MOVELSETAC     STLAC                           S01117
     C*
     C* PAY SETTLEMENT ACCOUNT
     C*
      ** If outgoing payment generated, use suspense a/c
      ** Otherwise, use account with bank/ beneficiary
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP43                                           S01408
     C*                                                                   S01408
     C           OPIN      IFEQ 'Y'
     C*                                                                   S01117
     C** Get branch internal Customer no. for suspense a/c no.            S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   KEY                             S01117
     C                     MOVEL'10    '  KEY                             S01117
     C                     MOVE BRCA      KEY                             S01117
     C           KEY       CHAINTABFP                89                   S01117
     C  N89      RECI      COMP 'D'                  8989                 S01117
     C   89                DO                              B001           S01117
     C                     MOVE 'TABFP'   WFILE            ***************S01117
     C                     MOVELKEY       WKEY             ** DBERR  13 **S01117
     C                     Z-ADD13        WBASE            ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C                     MOVE PCCY      CCYX
     C**********           Z-ADDBICN      CNUMX                                               CSD027
     C                     MOVE BICN      CNUMX                                               CSD027
     C*********************Z-ADDFTCD      ACODX                           S01117
     C                     MOVE BTIOSA    ACODX                           S01117
     C                     MOVE '01'      ACSQX
     C                     MOVE BRCA      BRCHX                           S01117
     C                     ELSE
      *                                                                   CFT004
      *** If CFT004 is on and the beneficiary field contains an IBAN      CFT004
      *                                                                   CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C           BNCT      ANDEQ'I'                                       CFT004
     C           34        SUBSTBNC1:2    BIBAN  34                       CFT004
      *                                                                   CFT004
     C                     CALL 'AOIBANR4'                                CFT004
     C                     PARM           P@RTCD  7                       CFT004
     C                     PARM '*KEY   ' P@OPTN  7                       CFT004
     C                     PARM BIBAN     P@IBAN 34                       CFT004
     C           ACNT      PARM *BLANKS   DSSDY                           CFT004
      *                                                                   CFT004
     C           P@RTCD    IFEQ *BLANKS                                   CFT004
     C**********           Z-ADDS4CNUM    CNUMX                                        CFT004 CSD027
     C                     MOVE S4CNUM    CNUMX                                               CSD027
     C                     MOVE S4CCY     CCYX                            CFT004
     C                     Z-ADDS4ACOD    ACODX                           CFT004
     C                     Z-ADDS4ACSQ    ACSQX                           CFT004
     C                     MOVE S4BRCA    BRCHX                           CFT004
     C                     ELSE                                           CFT004
     C                     MOVELBIBAN     WKEY             ***************CFT004
     C                     MOVE 'AOIBANR4'WFILE            * DB ERROR 30 *CFT004
     C                     Z-ADD30        WBASE            ***************CFT004
     C                     EXSR DBERR                                     CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     ELSE                                           CFT004
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP44                                           S01408
     C*                                                                   S01408
     C                     MOVE PCCY      CCCY
     C                     MOVE ACBT      PRT1T
     C*********************MOVELACBK      PRT1                            S01117
     C                     MOVE *BLANKS   WRK15                           S01117
     C                     MOVELACBK      WRK15                           S01117
     C                     MOVE ACBB      WRK15                           S01117
     C                     MOVELWRK15     PRT1                            S01117
     C                     MOVE BNCT      PRT2T
     C                     MOVELBNC1      PRT2
     C                     EXSR SETTLE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP45                                           S01408
     C*                                                                   S01408
     C                     ENDIF                                          CFT004
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP46                                           S01408
     C*                                                                   S01408
     C*********************MOVELSETAC     PAYAC  15                       S01117
     C                     MOVELSETAC     PAYAC                           S01117
     C*
     C* IF CHARGES TO THE DEBIT OF NOT BLANK FIND SETTLEMENT ACCOUNT
     C*
     C***********CDRO      IFNE 0                          B001                               CSD027
     C           CDRO      IFNE *BLANKS                    B001                               CSD027
     C                     MOVE BCCY      CCCY
     C                     MOVE CDRT      PRT1T
     C*********************MOVELCDRO      PRT1                            S01117
     C                     EXSR CHADBT                                    S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     BASAC  15                       S01117
     C                     MOVELSETAC     BASAC                           S01117
     C                     END                             E001
      *                                                                   044094
      *  Analyse dates to see if keys should be generated                 044094
      *                                                                   044094
     C                     MOVEL'N'       @SDATE  1                       044094
     C                     MOVEL'N'       @PDATE  1                       044094
      *                                                                   044094
      *  If Generate posting flag is 'I' then generate all postings       044094
      *  => Generate postings on authorisation date.                      044094
      *                                                                   044094
     C           C#GPFG    IFEQ 'I'                                       044094
     C                     Z-ADDRUND      P#EPSD                          056031
     C                     Z-ADDRUND      S#EPSD                          056031
      *                                                                   044094
     C           SACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C           PACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
      *                                                                   044094
      *  If Generate posting flag is 'E' then generate on event date      044094
      *  => Generate postings when event date is reached.                 044094
      *                                                                   044094
     C           C#GPFG    IFEQ 'E'                                       044094
      *                                                                   044094
     C           SACG      IFNE 'Y'                                       044094
     C           SLDT      ANDLEEDAT                                      044094
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C           PACG      IFNE 'Y'                                       044094
     C           PVDT      ANDLEEDAT                                      044094
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
      *                                                                   044094
      *  If Generate posting flag is 'S' then generate on earlier date    044094
      *  => Generate postings either settle or pay date reached.          044094
      *                                                                   044094
     C           C#GPFG    IFEQ 'S'                                       044094
      *                                                                   044094
     C           SLDT      IFLE EDAT                                      044094
     C           PVDT      ORLE EDAT                                      044094
      *                                                                   044094
     C           PVDT      IFLE SLDT                                      056031
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     Z-ADDPVDT      S#EPSD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDSLDT      P#EPSD                          056031
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     END                                            056031
      *                                                                   044094
     C           SACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @SDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C           PACG      IFNE 'Y'                                       044094
     C                     MOVEL'Y'       @PDATE                          044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
      *                                                                   044094
     C                     END                                            044094
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           INOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
      *                                                                   S01408
      ** Hook added below as FT0210CPD2 is a duplicate hook name          S01408
      *                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP13                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADDRUND      EPSD                            056031
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP11                                           S01408
     C*                                                                   S01408
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     Z-ADDSMAM      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C/COPY WNCPYSRC,FT0210C087
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
      *                                                                   CFT014
      ** If Instructed Currency is an 'In' Currency                       CFT014
      **    and Settlement Currency is Euro                               CFT014
      **    and 'In' Currency start date <= Settlement Value date         CFT014
      ** Or Instructed Currency is Euro                                   CFT014
      **    and Settlement Currency is an 'In' Currency                   CFT014
      **    and 'In' Currency start date <= Settlement Value date         CFT014
     C           CFT014    IFEQ 'N'                                       CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY1    ANDEQ'Y'                                       CFT014
     C           SMCY      ANDEQBKEURO                                    CFT014
     C           WTPSD1    ANDLESLDT                                      CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY2    ANDEQ'Y'                                       CFT014
     C           NDCY      ANDEQBKEURO                                    CFT014
     C           WTPSD2    ANDLESLDT                                      CFT014
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,FT0210C088
     C                     EXSR WRIT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP16                                           S01408
     C*                                                                   S01408
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     Z-ADDPYAM      EAMT
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C027
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDSLDT      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'N'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDPVDT      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     END                                            CAC001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP12                                           S01408
     C*                                                                   S01408
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD3                                           S01408
     C*                                                                   S01408
      *                                                                   S01408
      ** Hook added below as FT0210CPD3 is a duplicate hook name          S01408
      *                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP14                                           S01408
     C*                                                                   S01408
     C*
     C                     END                             E001
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD6                                           S01408
     C*                                                                   S01408
      *                                                                   S01408
      ** Hook added below as FT0210CPD6 is a duplicate hook name          S01408
      *                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP15                                           S01408
     C*                                                                   S01408
     C*
     C* IF SETTLE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE SETTLE VALUE DATE ACCOUNT KEYS
     C*
     C***********SACG******IFNE 'Y'                        B001           044094
     C***********SLDT******ANDLEEDAT                                      044094
     C           @SDATE    IFEQ 'Y'                                       044094
     C*
     C                     Z-ADDS#EPSD    EPSD                            056031
     C                     MOVE 'P'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
      *                                                                   CFT014
     C           CFT014    IFEQ 'N'                                       CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY1    ANDEQ'Y'                                       CFT014
     C           SMCY      ANDEQBKEURO                                    CFT014
     C           WTPSD1    ANDLESLDT                                      CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY2    ANDEQ'Y'                                       CFT014
     C           NDCY      ANDEQBKEURO                                    CFT014
     C           WTPSD2    ANDLESLDT                                      CFT014
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C005
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP17                                           S01408
     C*                                                                   S01408
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDSLDT      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C                     Z-ADDPVDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDSMAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FT0210C080
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C* 'A' NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'
     C                     ADD  TXCH      EAMT
     C                     ADD  CQCH      EAMT
     C                     ADD  ADCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP22                                           S01408
     C*                                                                   S01408
     C                     ADD  TLCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP23                                           S01408
     C*                                                                   S01408
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  INCHCM    EAMT                            S01501
     C                     ADD  INVATT    EAMT                            S01501
      *                                                                                       CGL020
      ** Accumulate charges and commissions                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  ADCH      WKNUME                                              CGL020
     C                     ADD  TLCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  INCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     EAMT                            CFT009
     C                     ADD  MSC02     EAMT                            CFT009
     C                     ADD  MSC03     EAMT                            CFT009
     C                     ADD  MSC04     EAMT                            CFT009
     C                     ADD  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKNUME                                              CGL020
     C                     ADD  MSC02     WKNUME                                              CGL020
     C                     ADD  MSC03     WKNUME                                              CGL020
     C                     ADD  MSC04     WKNUME                                              CGL020
     C                     ADD  MSC05     WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C047
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDPYAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C* 'A' NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'
     C                     SUB  TXCH      EAMT
     C                     SUB  CQCH      EAMT
     C                     SUB  ADCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP24                                           S01408
     C*                                                                   S01408
     C                     SUB  TLCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP25                                           S01408
     C*                                                                   S01408
     C                     SUB  MSCH      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     SUB  INCHCM    EAMT                            S01501
     C                     SUB  INVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  ADCH      WKNUME                                              CGL020
     C                     ADD  TLCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  INCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     SUB  MSC01     EAMT                            CFT009
     C                     SUB  MSC02     EAMT                            CFT009
     C                     SUB  MSC03     EAMT                            CFT009
     C                     SUB  MSC04     EAMT                            CFT009
     C                     SUB  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKNUME                                              CGL020
     C                     ADD  MSC02     WKNUME                                              CGL020
     C                     ADD  MSC03     WKNUME                                              CGL020
     C                     ADD  MSC04     WKNUME                                              CGL020
     C                     ADD  MSC05     WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                             E23067E32918
     C**IF*'CHARGES*TO*THE*DEBIT*OF'*IS*NOT*ZERO,*******************E23067E32918
     C**CREATE*THE*NET*AMOUNT*ACCOUNT*KEY***************************E23067E32918
     C*                                                             E23067E32918
     C***********CDRO******IFNE 0                          B002     E23067E32918
     C*                                                             E23067E32918
     C*********************MOVE 'T'       KPYRE                     E23067E32918
     C*********************MOVEL*BLANK    KCCY                      E23067E32918
     C*********************Z-ADDTXCH      EAMT                      E23067E32918
     C*********************ADD  CQCH      EAMT                      E23067E32918
     C*********************ADD  ADCH      EAMT                      E23067E32918
     C*********************ADD  TLCH      EAMT                      E23067E32918
     C*********************ADD  MSCH      EAMT                      E23067E32918
     C*********************ADD  TRCM      EAMT                      E23067E32918
     C*********************Z-ADDSLDT      VDAT                      E23067E32918
     C*********************MOVE BCCY      ECCY                      E23067E32918
     C*********************MOVELBASAC     SEAC                      E23067E32918
     C*********************EXSR WRIT                                E23067E32918
     C*********************END                             E002     E23067E32918
     C*                                                                   043860
     C* IF 'CHARGES TO THE DEBIT OF' IS NOT ZERO,                         043860
     C* CREATE THE NET AMOUNT ACCOUNT KEY                                 043860
     C*                                                                   043860
      *                                                                   043860
      *  Only create T key on settle date if charges added.               043860
      *                                                                   043860
     C***********CDRO      IFNE 0                          B002                        043860 CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'                                       043860
     C*                                                                   043860
     C                     MOVE 'T'       KPYRE                           043860
     C                     MOVEL*BLANK    KCCY                            043860
     C                     Z-ADDTXCH      EAMT                            043860
     C                     ADD  CQCH      EAMT                            043860
     C                     ADD  ADCH      EAMT                            043860
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP26                                           S01408
     C*                                                                   S01408
     C                     ADD  TLCH      EAMT                            043860
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP27                                           S01408
     C*                                                                   S01408
     C                     ADD  MSCH      EAMT                            043860
     C                     ADD  TRCM      EAMT                            043860
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  INCHCM    EAMT                            S01501
     C                     ADD  INVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTXCH      WKCHRG                                              CGL020
     C                     ADD  CQCH      WKCHRG                                              CGL020
     C                     ADD  ADCH      WKCHRG                                              CGL020
     C                     ADD  TLCH      WKCHRG                                              CGL020
     C                     ADD  MSCH      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  INCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     EAMT                            CFT009
     C                     ADD  MSC02     EAMT                            CFT009
     C                     ADD  MSC03     EAMT                            CFT009
     C                     ADD  MSC04     EAMT                            CFT009
     C                     ADD  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKCHRG                                              CGL020
     C                     ADD  MSC02     WKCHRG                                              CGL020
     C                     ADD  MSC03     WKCHRG                                              CGL020
     C                     ADD  MSC04     WKCHRG                                              CGL020
     C                     ADD  MSC05     WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDSLDT      VDAT                            043860
     C                     MOVE BCCY      ECCY                            043860
     C                     MOVELBASAC     SEAC                            043860
     C                     EXSR WRIT                                      043860
     C                     END                             E002           043860
     C*
     C* IF PAY DATE CHARGES DON'T GENRATE
     C*
     C***********CDRO      IFEQ 0                          B002           043860
     C***********ADDC      ANDEQ'A'                                       043860
     C/COPY WNCPYSRC,FT0210C081
      *                                                                   043860
      * Generate individual charge keys if charges added                  043860
      *                                                                   043860
     C           ADDC      IFEQ 'A'                                       043860
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSLDT      VDAT
     C*********************MOVE SMCY      ECCY                            043860
     C*********************MOVELSTLAC     SEAC                            043860
      *                                                                   043860
      * If Charges to the Debit of is not zero then charges in base       043860
      * currency else in settlement currency                              043860
      *                                                                   043860
     C***********CDRO      IFNE 0                          B003                        043860 CSD027
     C           CDRO      IFNE *BLANKS                    B003                               CSD027
     C                     MOVE BCCY      ECCY                            043860
     C                     MOVELBASAC     SEAC                            043860
     C                     ELSE                            X003           043860
     C                     MOVE SMCY      ECCY                            043860
     C                     MOVELSTLAC     SEAC                            043860
     C                     END                             E003           043860
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'X'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'V'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTXCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'Q'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Y'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCQCH      EAMT
     C                     EXSR WRIT
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'G'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '6'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDADCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP33                                           S01408
     C*                                                                   S01408
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT5    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'H'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '7'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTLCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP34                                           S01408
     C*                                                                   S01408
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT6    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'M'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '3'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDMSCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT7    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDINCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
      * Fees and Charges.  New account Keys                               CFT009
      * Miscellaneous charge 1                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC1    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC01     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous charge 2                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC2    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC02     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 3                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC3    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC03     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 4                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC4    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC04     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 5                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC5    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC05     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVE *BLANK    KCTYP                           CFT009
      *                                                                   CFT009
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDINVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     END                             E002
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       SACG
     C                     SETON                     74
     C*
     C                     END                             E001
     C*
     C* IF PAY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE PAY VALUE DATE ACCOUNT KEYS
     C*
     C***********PACG******IFNE 'Y'                        B001           044094
     C***********PVDT******ANDLEEDAT                                      044094
     C           @PDATE    IFEQ 'Y'                                       044094
     C/COPY WNCPYSRC,FT0210C016
     C*
     C                     Z-ADDP#EPSD    EPSD                            056031
     C                     MOVE 'R'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
      *                                                                   CFT014
     C           CFT014    IFEQ 'N'                                       CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY1    ANDEQ'Y'                                       CFT014
     C           SMCY      ANDEQBKEURO                                    CFT014
     C           WTPSD1    ANDLESLDT                                      CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
     C           WINCY2    ANDEQ'Y'                                       CFT014
     C           NDCY      ANDEQBKEURO                                    CFT014
     C           WTPSD2    ANDLESLDT                                      CFT014
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C006
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP18                                           S01408
     C*                                                                   S01408
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDPVDT      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C                     Z-ADDPVDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDSMAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDSMAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C* 'A' NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDEQ'A'
     C                     ADD  TXCH      EAMT
     C                     ADD  CQCH      EAMT
     C                     ADD  ADCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP28                                           S01408
     C*                                                                   S01408
     C                     ADD  TLCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP29                                           S01408
     C*                                                                   S01408
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  INCHCM    EAMT                            S01501
     C                     ADD  INVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  ADCH      WKNUME                                              CGL020
     C                     ADD  TLCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  INCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     EAMT                            CFT009
     C                     ADD  MSC02     EAMT                            CFT009
     C                     ADD  MSC03     EAMT                            CFT009
     C                     ADD  MSC04     EAMT                            CFT009
     C                     ADD  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKNUME                                              CGL020
     C                     ADD  MSC02     WKNUME                                              CGL020
     C                     ADD  MSC03     WKNUME                                              CGL020
     C                     ADD  MSC04     WKNUME                                              CGL020
     C                     ADD  MSC05     WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C048
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPYAM      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDPYAM      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO AND ADD/DEDUCT INDICATOR IS
     C* 'A' NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'
     C                     SUB  TXCH      EAMT
     C                     SUB  CQCH      EAMT
     C/COPY WNCPYSRC,FT0210C082
     C                     SUB  ADCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP30                                           S01408
     C*                                                                   S01408
     C                     SUB  TLCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP31                                           S01408
     C*                                                                   S01408
     C                     SUB  MSCH      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     SUB  INCHCM    EAMT                            S01501
     C                     SUB  INVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CQCH      WKNUME                                              CGL020
     C                     ADD  ADCH      WKNUME                                              CGL020
     C                     ADD  TLCH      WKNUME                                              CGL020
     C                     ADD  MSCH      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  INCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     SUB  MSC01     EAMT                            CFT009
     C                     SUB  MSC02     EAMT                            CFT009
     C                     SUB  MSC03     EAMT                            CFT009
     C                     SUB  MSC04     EAMT                            CFT009
     C                     SUB  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKNUME                                              CGL020
     C                     ADD  MSC02     WKNUME                                              CGL020
     C                     ADD  MSC03     WKNUME                                              CGL020
     C                     ADD  MSC04     WKNUME                                              CGL020
     C                     ADD  MSC05     WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
     C*                                                                   CFT009
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT ZERO
      * and charges are to be deducted                                    043860
     C* CREATE NET AMOUNT  ACCOUNT KEY
     C*
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C           ADDC      ANDNE'A'                                       043860
     C*
     C                     MOVE 'T'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDTXCH      EAMT
     C                     ADD  CQCH      EAMT
     C                     ADD  ADCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP35                                           S01408
     C*                                                                   S01408
     C                     ADD  TLCH      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP36                                           S01408
     C*                                                                   S01408
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  INCHCM    EAMT                            S01501
     C                     ADD  INVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTXCH      WKCHRG                                              CGL020
     C                     ADD  CQCH      WKCHRG                                              CGL020
     C                     ADD  ADCH      WKCHRG                                              CGL020
     C                     ADD  TLCH      WKCHRG                                              CGL020
     C                     ADD  MSCH      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  INCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
      *                                                                   CFT009
      * IF CFT009 active, sum charges                                     CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     EAMT                            CFT009
     C                     ADD  MSC02     EAMT                            CFT009
     C                     ADD  MSC03     EAMT                            CFT009
     C                     ADD  MSC04     EAMT                            CFT009
     C                     ADD  MSC05     EAMT                            CFT009
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  MSC01     WKCHRG                                              CGL020
     C                     ADD  MSC02     WKCHRG                                              CGL020
     C                     ADD  MSC03     WKCHRG                                              CGL020
     C                     ADD  MSC04     WKCHRG                                              CGL020
     C                     ADD  MSC05     WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPVDT      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     EXSR WRIT
     C                     END                             E002
     C*
     C* IF SETTLE DATE CHARGES DON'T GENRATE
     C*
     C***********CDRO      IFNE 0                          B002           043860
     C***********ADDC      ORNE 'A'                                       043860
      *                                                                   043860
      * Generate individual charge keys on pay date if they are           043860
      * to be deducted.                                                   043860
      *                                                                   043860
     C           ADDC      IFNE 'A'                        B002           043860
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDPVDT      VDAT
     C*
     C* IF CHARGES TO THE DEBIT OF NOT ZERO IN BASE CUEENCY
     C* OTHERWISE IN PAY CURRENCY
     C*
     C***********CDRO      IFNE 0                          B003                               CSD027
     C           CDRO      IFNE *BLANKS                    B003                               CSD027
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     ELSE                            X003
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     END                             E003
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'X'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'V'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTXCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'Q'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Y'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCQCH      EAMT
     C                     EXSR WRIT
     C*
     C/COPY WNCPYSRC,FT0210C083
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'G'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '6'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDADCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP37                                           S01408
     C*                                                                   S01408
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT5    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'H'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '7'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTLCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP38                                           S01408
     C*                                                                   S01408
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT6    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'M'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '3'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDMSCH      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           INVAT7    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDINCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
      *                                                                   CFT009
      * Miscellaneous charge 1                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC1    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '1'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC01     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 2                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC2    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '2'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC02     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 3                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC3    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '3'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC03     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 4                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC4    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '4'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC04     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      * Miscellaneous charge 5                                            CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT011    IFEQ 'N'                                       CFT009
     C           VTMIC5    OREQ 'N'                                       CFT009
     C                     MOVE 'M'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       KCTYP                           CFT009
     C                     MOVE '5'       KPYRE                           CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADDMSC05     EAMT                            CFT009
     C                     EXSR WRIT                                      CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVE *BLANK    KCTYP                           CFT009
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDINVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     END                             E002
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP32                                           S01408
     C*                                                                   S01408
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       PACG
     C*
     C/COPY WNCPYSRC,FT0210C017
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           SLDT      IFLE EDAT                                      056031
     C           PVDT      ANDLEEDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           SACG      ANDEQ'Y'
     C           PACG      ANDEQ'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       INRECI                          E32873
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVE INRECI    IXRECI                          CFT014
     C                     ENDIF                                          CFT014
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATINPAYDDF
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           *IN50     ANDEQ*ON                                       CFT014
     C                     UPDATINPAYXDF                                  CFT014
     C                     ENDIF                                          CFT014
      *                                                                   S01435
      * Update Incoming Message FT Transaction Status File record         S01435
      * if payment created from Incoming Electronic Message and           S01435
      * payment matured                                                   S01435
      *                                                                   S01435
     C           *IN50     IFEQ '1'                                       S01435
     C           INRECI    ANDEQ'M'                                       S01435
     C           INMSGR    IFNE 0                                         S01435
      *                                                                   S01435
     C                     EXSR SRINFT                                    S01435
      *                                                                   S01435
     C                     END                                            S01435
     C                     END                                            S01435
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C/COPY WNCPYSRC,FT0210C002
     C           INEND     TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD2         H       30
     C                     Z-ADDSMAM      PRMAMT
     C                     EXSR HASH
     C/COPY WNCPYSRC,FT0210C008
     C*
      ** Restore original value of BCCY.                                                      CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     MOVE UMBCCY    BCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* CQCODS SR.
     C* CREATE CHEQUES FOR COLLECTION HEADER ACCOUNT KEYS
     C************************************************************
     C*
     C           CQCODS    BEGSR
     C*                                                                   S01117
     C                     SETON                     23                   S01117
     C*                                                                   S01117
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          S01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             S01117
     C*                                                                   S01117
     C           *IN47     IFEQ '0'                                       S01117
     C           *IN,A     ANDEQ'1'                                       S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     SETOF                     45                   S01117
     C                     MOVE *BLANKS   BRCA1                           S01117
     C                     END                                            S01117
     C                     SETON                     47                   S01117
     C*
     C                     EXSR CHGBR                                     S01117
     C*                                                                   S01117
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           CDRECI    IFNE 'D'                        B001           E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO CODEND
     C                     END                             E001
     C*
     C                     MOVE *BLANK    OTAC
      *                                                                   S01414
      * Use cheque header book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELCDBOKC    BOKC                            S01414
     C                     MOVELCDPRFC    PRFC                            S01414
     C*                                                                   E23050
     C** SAVE CHEQUE HEADER SEQUENCE FOR A/C KEY GENERATION.              E23050
     C*                                                                   E23050
     C                     Z-ADDCQSQ      HCQSQ   20                      E23050
     C*                                                                   E23050
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* SETTLE SETTLEMENT ACCOUNT
     C*
     C                     MOVE SMCY      CCCY
     C                     MOVE RCRT      PRT1T
     C                     MOVELRCCO      PRT1
     C                     MOVE COBT      PRT2T
     C                     MOVELCOB1      PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     STLAC  15                       S01117
     C                     MOVELSETAC     STLAC                           S01117
      *                                                                   056031
      *  Analyse dates to see if keys should be generated                 056031
      *                                                                   056031
     C                     MOVEL'N'       @SDATE  1                       056031
     C                     MOVEL'N'       @PDATE  1                       056031
      *                                                                   056031
      *  If Generate posting flag is 'I' then generate all postings       056031
      *  => Generate postings on authorisation date.                      056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'I'                                       056031
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
      *                                                                   056031
     C           SACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'E' then generate on event date      056031
      *  => Generate postings when event date is reached.                 056031
      *                                                                   056031
      *                                                                   056031
      *  If Generate posting flag is 'S' then generate on earlier date    056031
      *  => Generate postings either settle or pay date reached.          056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'E'                                       056031
     C           C#GPFG    OREQ 'S'                                       056031
      *                                                                   056031
     C           SACG      IFNE 'Y'                                       056031
     C           SLDT      ANDLEEDAT                                      056031
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           CDOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADDRUND      EPSD                            056031
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'D'       KPYRE
     C                     Z-ADDTOCL      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD3                                           S01408
     C*                                                                   S01408
     C*
     C                     END                             E001
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD6                                           S01408
     C*                                                                   S01408
     C*
     C* IF SETTLE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE SETTLE VALUE DATE ACCOUNT KEYS
     C*
     C***********SACG******IFNE 'Y'                        B001           056031
     C***********SLDT******ANDLEEDAT                                      056031
     C           @SDATE    IFEQ 'Y'                                       056031
     C                     Z-ADDS#EPSD    EPSD                            056031
     C*
     C                     MOVE 'P'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'D'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDTOCL      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       SACG
     C*
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           SLDT      IFLE EDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           SACG      ANDEQ'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       CDRECI                          E32873
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATCQCODDDF
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C           CODEND    TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD3         H       30
     C                     Z-ADDTOCL      PRMAMT
     C                     EXSR HASH
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* CQCOCS SR.
     C* CREATE CHEQUES FOR COLLECTION DETAIL ACCOUNT KEYS
     C************************************************************
     C*
     C           CQCOCS    BEGSR
     C*
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           CCRECI    IFNE 'D'                                       E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO COCEND
     C                     END                             E001
     C/COPY WNCPYSRC,FT0210C032
     C*
     C                     MOVE *BLANK    OTAC
      *                                                                   S01414
      * Use cheque detail book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELCCBOKC    BOKC                            S01414
     C                     MOVELCCPRFC    PRFC                            S01414
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* PAY SETTLEMENT ACCOUNT
     C*
     C                     MOVE CRCY      CCCY
     C                     MOVE CRPT      PRT1T
     C*********************MOVELCRPY      PRT1                            S01117
     C                     MOVE *BLANKS   WRK15                           S01117
     C                     MOVELCRPY      WRK15                           S01117
     C                     MOVE CRBR      WRK15                           S01117
     C                     MOVELWRK15     PRT1                            S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     PAYAC  15                       S01117
     C                     MOVELSETAC     PAYAC                           S01117
     C*
     C* IF CHARGES TO THE DEBIT OF NOT BLANK FIND SETTLEMENT ACCOUNT
     C*
     C***********CDRO      IFNE 0                          B001                               CSD027
     C           CDRO      IFNE *BLANKS                    B001                               CSD027
     C                     MOVE BCCY      CCCY
     C                     MOVE CDRT      PRT1T
     C*********************MOVELCDRO      PRT1                            S01117
     C                     EXSR CHADBT                                    S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     BASAC  15                       S01117
     C                     MOVELSETAC     BASAC                           S01117
     C                     END                             E001
     C*****************************************************************   159283
     C**CALCULATE*PAY*CURRENCY*EQUIVALENT******************************   159283
     C*****************************************************************   159283
     C***********          MOVE SMCY      CURR1   3                       159283
     C***********          MOVE CRCY      CURR2   3                       159283
     C***********          Z-ADDCQAM      AMOUNT 130                      159283
     C***********          Z-ADDMDIN      MDINS   10                      159283
     C***********          EXSR CURRY                                     159283
      *                                                                   159283
      ** Use credit currency amount as pay currency equivalent.           159283
      *                                                                   159283
     C                     Z-ADDCCYAM     AMTC                            159283
     C*
     C* THIS IS TO MAKE BASE CURRENCY EQUIVS EQUAL
     C*
     C                     Z-ADDPBCQ      AMTCB  130
      *                                                                   056031
      *  Analyse dates to see if keys should be generated                 056031
      *                                                                   056031
     C                     MOVEL'N'       @SDATE  1                       056031
     C                     MOVEL'N'       @PDATE  1                       056031
      *                                                                   056031
      *  If Generate posting flag is 'I' then generate all postings       056031
      *  => Generate postings on authorisation date.                      056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'I'                                       056031
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
      *                                                                   056031
     C           CRAG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           SACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'E' then generate on event date      056031
      *  => Generate postings when event date is reached.                 056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'E'                                       056031
      *                                                                   056031
     C           SACG      IFNE 'Y'                                       056031
     C           SLDT      ANDLEEDAT                                      056031
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           CRAG      IFNE 'Y'                                       056031
     C           CRVD      ANDLEEDAT                                      056031
     C                     Z-ADDCRVD      P#EPSD                          056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'S' then generate on earlier date    056031
      *  => Generate postings either settle or pay date reached.          056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'S'                                       056031
      *                                                                   056031
     C           SLDT      IFLE EDAT                                      056031
     C           CRVD      ORLE EDAT                                      056031
      *                                                                   056031
     C           SLDT      IFLE CRVD                                      056031
     C                     Z-ADDSLDT      S#EPSD                          056031
     C                     Z-ADDSLDT      P#EPSD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDCRVD      S#EPSD                          056031
     C                     Z-ADDCRVD      P#EPSD                          056031
     C                     END                                            056031
      *                                                                   056031
     C           SACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           CRAG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           CCOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
     C*
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP5                                           S01408
     C*                                                                   S01408
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C028
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     Z-ADDCQAM      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELPAYAC     SEAC
     C/COPY WNCPYSRC,FT0210C089
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,FT0210C090
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C030
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDCRVD      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'S'                                       CAC001
     C*                                                                   CAC001
     C           CRCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'N'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDCRVD      VDAT                            CAC001
     C                     MOVE CRCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     END                                            CAC001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP7                                           S01408
     C*                                                                   S01408
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*
     C                     END                             E001
     C*
     C* IF SETTLE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE SETTLE VALUE DATE ACCOUNT KEYS
     C*
     C***********SACG******IFNE 'Y'                        B001           056031
     C***********SLDT******                                               056031
     C           @SDATE    IFEQ 'Y'                                       056031
     C*
     C                     Z-ADDS#EPSD    EPSD                            056031
     C                     MOVE 'P'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDCQAM      EAMT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP19                                           S01408
     C*                                                                   S01408
     C                     Z-ADDCRVD      VDAT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP20                                           S01408
     C*                                                                   S01408
     C                     MOVE SMCY      ECCY
     C                     MOVELPAYAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C*                                                                   CAC001
     C           SMCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDCRVD      VDAT                            CAC001
     C                     MOVE SMCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDAMTCB     EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           CRCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELCRCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDAMTC      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO
     C* NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C                     SUB  TXCH      EAMT
     C                     SUB  CSTA      EAMT
     C                     SUB  COLL      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     SUB  CCCHCM    EAMT                            S01501
     C                     SUB  CCVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  COLL      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  CCCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDCRVD      VDAT
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       SACG
     C*
     C                     END                             E001
     C*
     C* IF PAY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE PAY VALUE DATE ACCOUNT KEYS
     C*
     C***********CRAG******IFNE 'Y'                        B001           056031
     C***********CRVD******ANDLEEDAT                                      056031
     C           @PDATE    IFEQ 'Y'                                       056031
     C*
     C                     Z-ADDP#EPSD    EPSD                            056031
     C                     MOVE 'R'       KDATE
     C*
     C* IF FIRST DETAIL PRODUCE ACCOUNT KEY FOR HEADER
     C*
     C           CQSQ      IFEQ 1                          B001
     C                     MOVE 'D'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDTOCL      EAMT
     C                     Z-ADDSLDT      VDAT
     C                     MOVE SMCY      ECCY
     C*                                                                   183624
     C* FIND SETTLEMENT ACCOUNTS IF NOT FOUND PREVIOUSLY                  183624
     C*                                                                   183624
     C* SETTLE SETTLEMENT ACCOUNT                                         183624
     C*                                                                   183624
     C           CDRECI    IFNE 'D'                                       183624
     C           AUIN      ORNE 'Y'                                       183624
     C                     MOVE SMCY      CCCY                            183624
     C                     MOVE RCRT      PRT1T                           183624
     C                     MOVELRCCO      PRT1                            183624
     C                     MOVE COBT      PRT2T                           183624
     C                     MOVELCOB1      PRT2                            183624
     C                     EXSR SETTLE                                    183624
     C                     MOVELSETAC     STLAC                           183624
     C                     ENDIF                                          183624
      *                                                                   183624
     C                     MOVELSTLAC     SEAC
     C*                                                                   E23050
     C** RESTORE CHEQUE HEADER SEQUENCE NUMBER.                           E23050
     C*                                                                   E23050
     C                     Z-ADDCQSQ      DCQSQ   20                      E23050
     C                     Z-ADDHCQSQ     CQSQ                            E23050
      *                                                                   S01414
      * Use cheque header book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELCDBOKC    BOKC                            S01414
     C                     MOVELCDPRFC    PRFC                            S01414
      *                                                                   S01414
     C                     EXSR WRIT
     C*                                                                   E23050
     C** RESTORE CHEQUE DETAIL SEQUENCE NUMBER.                           E23050
     C*                                                                   E23050
     C                     Z-ADDDCQSQ     CQSQ                            E23050
      *                                                                   S01414
      * Use cheque detail book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELCCBOKC    BOKC                            S01414
     C                     MOVELCCPRFC    PRFC                            S01414
      *                                                                   S01414
     C                     END                             E001
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDCQAM      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE SMCY      ECCY
     C                     MOVELPAYAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C*                                                                   CAC001
     C           CRCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDCRVD      VDAT                            CAC001
     C                     MOVE CRCY      ECCY                            CAC001
     C                     MOVELPAYAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELSMCY      KCCY
     C                     Z-ADDAMTCB     EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           CRCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELCRCY      KCCY
     C                     Z-ADDPBCQ      EAMT
     C                     Z-ADDCRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET PAY AMOUNT
     C*
     C                     MOVE 'L'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDAMTC      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO
     C* NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C                     SUB  TXCH      EAMT
     C                     SUB  COLL      EAMT
     C                     SUB  CSTA      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission                                             S01501
     C*                                                                   S01501
     C                     SUB  CCCHCM    EAMT                            S01501
     C                     SUB  CCVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  TXCH      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  COLL      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  CCCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDCRVD      VDAT
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     EXSR WRIT
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT ZERO
     C* CREATE NET AMOUNT  ACCOUNT KEY
     C*
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C*
     C                     MOVE 'T'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDTXCH      EAMT
     C                     ADD  COLL      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  CCCHCM    EAMT                            S01501
     C                     ADD  CCVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDTXCH      WKCHRG                                              CGL020
     C                     ADD  COLL      WKCHRG                                              CGL020
     C                     ADD  CSTA      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  CCCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDCRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     EXSR WRIT
     C                     END                             E002
     C*
     C* CHARGES
     C*
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDCRVD      VDAT
     C*LUX0015
     C*
     C* IF CHARGES TO THE DEBIT OF NOT ZERO IN BASE CUEENCY
     C* OTHERWISE IN PAY CURRENCY
     C*
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     ELSE                            X002
     C                     MOVE CRCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     END                             E002
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           CCVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'X'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'V'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTXCH      EAMT
     C                     EXSR WRIT
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           CCVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'K'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '8'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCOLL      EAMT
     C                     EXSR WRIT
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           CCVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'C'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Z'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCSTA      EAMT
     C                     EXSR WRIT
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           CCVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           CCVAT5    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCCCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDCCVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       CRAG
     C                     SETON                     74
     C*
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           SLDT      IFLE EDAT                                      056031
     C           CRVD      ANDLEEDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           SACG      ANDEQ'Y'
     C           CRAG      ANDEQ'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       CCRECI                          E32873
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATCQCOCDDF
     C*
     C* UPDATE ARRAY FOR PAY BASE CCY EQUIVALENT
     C*
     C* SET FIELDS TO ZERO IF FIRST CHECK
     C*
     C           CQSQ      IFEQ 1                          ## B002
     C           PREF      ORNE LSREFC                                    052311
     C                     Z-ADD0         X       20
     C                     Z-ADD*ZERO     TOT
     C                     Z-ADD*ZERO     CQCHK  150
     C                     Z-ADD*ZERO     TOTAL  150
     C                     MOVE *BLANKS   LSREFC 15                       052311
     C                     MOVE PREF      LSREFC                          052311
     C                     END                             ## E002
     C*
     C* KEEP RUNNING TOTAL OF ALL BASE EQUIVALENTS IN ARRAY
     C*
     C                     ADD  1         X
     C                     ADD  PBCQ      TOT,X
     C*
     C                     ADD  CQAM      CQCHK
     C*
     C* IF THIS IS LAST CHECK(TOTALS NOW MATCH)
     C*
     C           CQCHK     IFEQ TOCL                       ## B002
     C                     XFOOTTOT       TOTAL
     C*
     C* ACCESS HEADER RECORD FOR UPDATE OF BASE EQUIVALENT VALUE
     C*
     C           PREF      CHAINCQMAT                89
     C           *IN89     IFEQ '1'                        ## B003
     C                     MOVELPREF      WKEY             ***************
     C                     MOVE 'CQCOD'   WFILE            * DB ERROR 15 *
     C                     Z-ADD15        WBASE            ***************
     C                     EXSR DBERR
     C                     ELSE                            ## X003
     C*
     C                     Z-ADDTOTAL     SBCQ
     C                     UPDATCQCODA
     C*
     C                     END                             ## E003
     C*
     C                     END                             ## E002
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C           COCEND    TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD4         H       30
     C                     Z-ADDCQAM      PRMAMT
     C                     EXSR HASH
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* CQPACS SR.
     C* CREATE CHEQUES TO BE PAID HEADER ACCOUNT KEYS
     C************************************************************
     C*
     C           CQPACS    BEGSR
     C*                                                                   S01117
     C/COPY WNCPYSRC,FT0210C033
     C                     SETON                     24                   S01117
     C*
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          S01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             S01117
     C*                                                                   S01117
     C           *IN48     IFEQ '0'                                       S01117
     C           *IN,A     ANDEQ'1'                                       S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     SETOF                     45                   S01117
     C                     MOVE *BLANKS   BRCA1                           S01117
     C                     END                                            S01117
     C                     SETON                     48                   S01117
     C*                                                                   S01117
     C                     EXSR CHGBR                                     S01117
     C*                                                                   S01117
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           PCRECI    IFNE 'D'                        B001           E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO PACEND
     C                     END                             E001
     C*
     C                     MOVE *BLANK    OTAC
      *                                                                   S01414
      * Use cheque header book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELPCBOKC    BOKC                            S01414
     C                     MOVELPCPRFC    PRFC                            S01414
     C*                                                                   E23050
     C** SAVE CHEQUE HEADER SEQUENCE NUMBER FOR A/C KEY GENERATION.       E23050
     C*                                                                   E23050
     C                     Z-ADDCQSQ      HCQSQ                           E23050
     C*                                                                   E23050
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* PAY SETTLEMENT ACCOUNT
     C*
     C                     MOVE PCCY      CCCY
     C                     MOVE SNCT      PRT1T
     C                     MOVELSNCO      PRT1
     C                     MOVE RBKT      PRT2T
     C                     MOVELRBK1      PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     PAYAC  15                       S01117
     C**********           MOVELSETAC     PAYAC  18                                    S01117 CGL029
     C                     MOVELSETAC     PAYAC                                               CGL029
      *                                                                   056031
      *  Analyse dates to see if keys should be generated                 056031
      *                                                                   056031
     C                     MOVEL'N'       @SDATE  1                       056031
     C                     MOVEL'N'       @PDATE  1                       056031
      *                                                                   056031
      *  If Generate posting flag is 'I' then generate all postings       056031
      *  => Generate postings on authorisation date.                      056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'I'                                       056031
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
      *                                                                   056031
     C           RACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'E' then generate on event date      056031
      *  => Generate postings when event date is reached.                 056031
      *                                                                   056031
      *                                                                   056031
      *  If Generate posting flag is 'S' then generate on earlier date    056031
      *  => Generate postings either settle or pay date reached.          056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'E'                                       056031
     C           C#GPFG    OREQ 'S'                                       056031
      *                                                                   056031
     C           RACG      IFNE 'Y'                                       056031
     C           PVDT      ANDLEEDAT                                      056031
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           PCOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADDRUND      EPSD                            056031
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'E'       KPYRE
     C                     Z-ADDPRRM      EAMT
     C                     EXSR WRIT
     C*
     C* CORRESPONDENT CHARGE
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'D'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '9'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C039
     C*                                                                   S01501
     C                     Z-ADDCOCH      EAMT                            LUX44
     C                     EXSR WRIT
     C*
     C* OUR DEDUCTIONS
     C*
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'W'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'I'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C040
     C*                                                                   S01501
     C                     Z-ADDDEDS      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDPCVATD    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE '0'       KPYRE                           S01501
     C                     Z-ADDPCVATC    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*
     C                     END                             E001
     C*
     C**IF*SETTLE*DATE*IS*NOT*GREATER*THAN*EVENT*DATE*AND*A/C*KEYS*HAVE   E32916
     C**NOT*ALREADY*BEEN*CREATED,*CREATE*SETTLE*VALUE*DATE*ACCOUNT*KEYS   E32916
     C*                                                                   E32916
     C********** PACG      IFNE 'Y'                        B001           E32916
     C********** PVDT      ANDLEEDAT                                      E32916
     C*                                                                   E32916
      *                                                                   E32916
      ** If settle date is not after event date and account keys have not E32916
      ** already been generated, create settle date account keys.         E32916
      *                                                                   E32916
     C***********PVDT******IFLE EDAT                       B001     E32916056031
     C***********RACG******ANDNE'Y'                                 E32916056031
     C           @PDATE    IFEQ 'Y'                                       056031
      *                                                                   E32916
     C                     Z-ADDP#EPSD    EPSD                            056031
     C                     MOVE 'R'       KDATE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'E'       KPYRE
     C                     Z-ADDPRRM      EAMT
     C                     EXSR WRIT
     C*
     C* CORRESPONDENT CHARGES
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'D'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '9'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C041
     C*                                                                   S01501
     C                     Z-ADDCOCH      EAMT
     C                     EXSR WRIT
     C*
     C* OUR DEDUCTIONS
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'W'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'I'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C042
     C*                                                                   S01501
     C                     Z-ADDDEDS      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDPCVATD    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE '0'       KPYRE                           S01501
     C                     Z-ADDPCVATC    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C****************     MOVE 'Y'       PACG                            E32916
     C                     MOVE 'Y'       RACG                            E32916
     C*
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           PVDT      IFLE EDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           RACG      ANDEQ'Y'                                       E32916
     C********** PACG      ANDEQ'Y'                                       E32916
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       PCRECI                          E32873
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATCQPACDDF
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C           PACEND    TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD5         H       30
     C                     Z-ADDPRRM      PRMAMT
     C                     EXSR HASH
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* CQPADS SR.
     C* CREATE CHEQUES TO BE PAID DETAIL ACCOUNT KEYS
     C************************************************************
     C*
     C           CQPADS    BEGSR
     C*
     C/COPY WNCPYSRC,FT0210C037
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI      IFNE 'D'                        B001           E32873
     C           PDRECI    IFNE 'D'                        B001           E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO PADEND
     C                     END                             E001
     C*
     C                     MOVE *BLANK    OTAC
      *                                                                   S01414
      * Use cheque detail book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELPDBOKC    BOKC                            S01414
     C                     MOVELPDPRFC    PRFC                            S01414
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* SETTLE SETTLEMENT ACCOUNT
     C*
     C                     MOVE DRCY      CCCY
     C                     MOVE DRPT      PRT1T
     C*********************MOVELDRPY      PRT1                            S01117
     C                     MOVE *BLANKS   WRK15                           S01117
     C                     MOVELDRPY      WRK15                           S01117
     C                     MOVE DRBR      WRK15                           S01117
     C                     MOVELWRK15     PRT1                            S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     STLAC  15                       S01117
     C                     MOVELSETAC     STLAC                           S01117
     C*
     C* IF CHARGES TO THE DEBIT OF NOT BLANK FIND SETTLEMENT ACCOUNT
     C*
     C***********CDRO      IFNE 0                          B001                               CSD027
     C           CDRO      IFNE *BLANKS                    B001                               CSD027
     C                     MOVE BCCY      CCCY
     C                     MOVE CDRT      PRT1T
     C*********************MOVELCDRO      PRT1                            S01117
     C                     EXSR CHADBT                                    S01117
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     BASAC  15                       S01117
     C                     MOVELSETAC     BASAC                           S01117
     C                     END                             E001
     C*
     C* CALCULATE PAY CURRENCY EQUIVALENT
     C*
     C                     MOVE PCCY      CURR1   3
     C                     MOVE DRCY      CURR2   3
     C**********           Z-ADDMDIN      MDINS                                               159283
     C                     Z-ADDMDIN      MDINS   10                                          159283
     C*******    PCCY      IFNE BCCY                                      E32917
     C*******    DRCY      ANDNEBCCY                                      E32917
     C*******    1         SUB  MDINS     MDINS                           E32917
     C*******              END                                            E32917
     C                     Z-ADDCQAM      AMOUNT 130
     C                     EXSR CURRY
     C*
     C* THIS IS TO MAKE BASE CURRENCY EQUIVS EQUAL
     C*
     C                     Z-ADDSBCQ      AMTCB
      *                                                                   056031
      *  Analyse dates to see if keys should be generated                 056031
      *                                                                   056031
     C                     MOVEL'N'       @SDATE  1                       056031
     C                     MOVEL'N'       @PDATE  1                       056031
      *                                                                   056031
      *  If Generate posting flag is 'I' then generate all postings       056031
      *  => Generate postings on authorisation date.                      056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'I'                                       056031
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
      *                                                                   056031
     C           DRAG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           PACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'E' then generate on event date      056031
      *  => Generate postings when event date is reached.                 056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'E'                                       056031
      *                                                                   056031
     C           PACG      IFNE 'Y'                                       056031
     C           PVDT      ANDLEEDAT                                      056031
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           DRAG      IFNE 'Y'                                       056031
     C           DRVD      ANDLEEDAT                                      056031
     C                     Z-ADDDRVD      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'S' then generate on earlier date    056031
      *  => Generate postings either settle or pay date reached.          056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'S'                                       056031
      *                                                                   056031
     C           PVDT      IFLE EDAT                                      056031
     C           DRVD      ORLE EDAT                                      056031
      *                                                                   056031
     C           PVDT      IFLE DRVD                                      056031
     C                     Z-ADDPVDT      S#EPSD                          056031
     C                     Z-ADDPVDT      P#EPSD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDDRVD      S#EPSD                          056031
     C                     Z-ADDDRVD      P#EPSD                          056031
     C                     END                                            056031
      *                                                                   056031
     C           PACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @PDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C           DRAG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
     C*
     C* IF ENTRY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE ENTRY DATE ACCOUNT KEYS
     C*
     C           IACG      IFNE 'Y'                        B001
     C*******    OEDT      ANDLEEDAT                                      111825
     C           PDOEDT    ANDLEEDAT                                      111825
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CPD2                                           S01408
     C*                                                                   S01408
     C*
     C                     MOVE 'D'       KDATE
     C                     MOVE *BLANK    KCCY
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP8                                           S01408
     C*                                                                   S01408
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C/COPY WNCPYSRC,FT0210C084
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,FT0210C091
     C                     EXSR WRIT
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     Z-ADDCQAM      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C/COPY WNCPYSRC,FT0210C029
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'B'                                       CAC001
     C*                                                                   CAC001
     C           DRCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDDRVD      VDAT                            CAC001
     C                     MOVE DRCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           MBSI      IFEQ 'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'N'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDDRVD      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     END                                            CAC001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CCP9                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0210CP10                                           S01408
     C*                                                                   S01408
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       IACG
     C*
     C                     END                             E001
     C*
     C* IF SETTLE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE SETTLE VALUE DATE ACCOUNT KEYS
     C*
     C***********PACG******IFNE 'Y'                        B001           056031
     C***********PVDT******ANDLEEDAT                                      056031
     C           @PDATE    IFEQ 'Y'                                       056031
     C*
     C                     Z-ADDP#EPSD    EPSD                            056031
     C                     MOVE 'R'       KDATE
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDCQAM      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C*                                                                   CAC001
     C           PCCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDDRVD      VDAT                            CAC001
     C                     MOVE PCCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELDRCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDAMTCB     EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           DRCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDAMTC      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO
     C* NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C                     ADD  CSTA      EAMT
     C                     ADD  COLL      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  PDCHCM    EAMT                            S01501
     C                     ADD  PDVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  COLL      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  PDCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDDRVD      VDAT
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       PACG
     C*
     C                     END                             E001
     C*
     C* IF PAY DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE PAY VALUE DATE ACCOUNT KEYS
     C*
     C***********DRAG******IFNE 'Y'                        B001           056031
     C***********DRVD******ANDLEEDAT                                      056031
     C           @SDATE    IFEQ 'Y'                                       056031
     C*
     C                     Z-ADDS#EPSD    EPSD                            056031
     C                     MOVE 'P'       KDATE
     C*
     C* IF FIRST DETAIL PRODUCE ACCOUNT KEY FOR HEADER
     C*
     C           CQSQ      IFEQ 1                          B001
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDPVDT      VDAT
     C                     MOVE PCCY      ECCY
     C*                                                                   183624
     C* FIND SETTLEMENT ACCOUNTS                                          183624
     C*                                                                   183624
     C* PAY SETTLEMENT ACCOUNT                                            183624
     C*                                                                   183624
     C           PCRECI    IFNE 'D'                                       183624
     C           AUIN      ORNE 'Y'                                       183624
     C                     MOVE PCCY      CCCY                            183624
     C                     MOVE SNCT      PRT1T                           183624
     C                     MOVELSNCO      PRT1                            183624
     C                     MOVE RBKT      PRT2T                           183624
     C                     MOVELRBK1      PRT2                            183624
     C                     EXSR SETTLE                                    183624
     C**********           MOVELSETAC     PAYAC  18                                    183624 CGL029
     C                     MOVELSETAC     PAYAC                                               CGL029
     C                     ENDIF                                          183624
     C*                                                                   183624
     C                     MOVELPAYAC     SEAC
     C*                                                                   E23050
     C** RESTORE CHEQUE HEADER SEQUENCE NUMBER.                           E23050
     C*                                                                   E23050
     C                     Z-ADDCQSQ      DCQSQ                           E23050
     C                     Z-ADDHCQSQ     CQSQ                            E23050
     C*
     C* HEADER AMOUNT
     C*
     C                     MOVE 'E'       KPYRE
     C                     Z-ADDPRRM      EAMT
      *                                                                   S01414
      * Use cheque header book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELPCBOKC    BOKC                            S01414
     C                     MOVELPCPRFC    PRFC                            S01414
      *                                                                   S01414
     C                     EXSR WRIT
     C*
     C* CORRESPONDENT CHARGES
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'D'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '9'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C043
     C*                                                                   S01501
     C                     Z-ADDCOCH      EAMT
     C                     EXSR WRIT
     C*
     C* OUR DEDUCTIONS
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PCVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'W'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'I'       KPYRE                           S01501
     C                     END                                            S01501
     C/COPY WNCPYSRC,FT0210C044
     C*                                                                   S01501
     C                     Z-ADDDEDS      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDPCVATD    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE '0'       KPYRE                           S01501
     C                     Z-ADDPCVATC    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   E23050
     C** RESTORE CHEQUE DETAIL SEQUENCE NUMBER.                           E23050
     C*                                                                   E23050
     C                     Z-ADDDCQSQ     CQSQ                            E23050
      *                                                                   S01414
      * Use cheque detail book code & profit centre for a/c key generationS01414
      *                                                                   S01414
     C                     MOVELPDBOKC    BOKC                            S01414
     C                     MOVELPDPRFC    PRFC                            S01414
      *                                                                   S01414
     C                     END                             E001
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   OCCY                            CEU013
     C                     Z-ADD0         OAMT                            CEU013
     C           NDCY      IFNE *BLANKS                                   CEU013
     C           NDAM      ANDNE*ZERO                                     CEU013
     C                     MOVE NDCY      OCCY                            CEU013
     C                     Z-ADDNDAM      OAMT                            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR WRIT
     C*
     C* PAY AMOUNT
     C*
     C                     MOVE 'R'       KPYRE
     C                     MOVE *BLANK    KCCY
     C                     Z-ADDCQAM      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE PCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*                                                                   CAC001
     C**  Margin Amount.                                                  CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C*                                                                   CAC001
     C           DRCY      IFEQ BCCY                                      CAC001
     C                     MOVE 'B'       KCTYP                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE 'F'       KCTYP                           CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     MOVE 'M'       KPYRE                           CAC001
     C                     MOVE *BLANK    KCCY                            CAC001
     C                     Z-ADDMAMT      EAMT                            CAC001
     C                     Z-ADDDRVD      VDAT                            CAC001
     C                     MOVE DRCY      ECCY                            CAC001
     C                     MOVELSTLAC     SEAC                            CAC001
     C                     EXSR WRIT                                      CAC001
     C*                                                                   CAC001
     C                     MOVE ' '       KCTYP                           CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C*
     C* BASE CURRENCY EQUIVALENT OF SETTLE AMOUNT
     C*
     C                     MOVE 'B'       KPYRE
     C                     MOVELDRCY      KCCY
     C                     Z-ADDAMTCB     EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           SMCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* BASE CURRENCY EQUIVALENT OF PAY AMOUNT
     C*
     C                     MOVE 'A'       KPYRE
     C                     MOVELPCCY      KCCY
     C                     Z-ADDSBCQ      EAMT
     C                     Z-ADDDRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELSTLAC     SEAC
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'S'                                       CAC001
     C           PCCY      ANDEQBCCY                                      CAC001
     C                     ADD  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           MBSI      ANDEQ'B'                                       CAC001
     C           DRCY      ANDEQBCCY                                      CAC001
     C                     SUB  MAMT      EAMT                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     EXSR WRIT
     C*
     C* NET SETTLE AMOUNT
     C*
     C                     MOVE 'N'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDAMTC      EAMT
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADD0         WKNUME                                              CGL020
     C                     Z-ADDAMTC      WKDENO                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* IF CHARGES TO THE DEBIT OF IS ZERO
     C* NET OFF AMOUNT
     C*
     C***********CDRO      IFEQ 0                          B002                               CSD027
     C           CDRO      IFEQ *BLANKS                    B002                               CSD027
     C                     ADD  COLL      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  PDCHCM    EAMT                            S01501
     C                     ADD  PDVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     ADD  COLL      WKNUME                                              CGL020
     C                     ADD  CSTA      WKNUME                                              CGL020
     C                     ADD  TRCM      WKNUME                                              CGL020
     C                     ADD  PDCHCM    WKNUME                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
     C                     END                             E002
      *                                                                                       CGL020
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRFEEC                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDDRVD      VDAT
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     EXSR WRIT
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT ZERO
     C* CREATE NET AMOUNT  ACCOUNT KEY
     C*
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C*
     C                     MOVE 'T'       KPYRE
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDCOLL      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01501
     C** FX/change commission and VAT                                     S01501
     C*                                                                   S01501
     C                     ADD  PDCHCM    EAMT                            S01501
     C                     ADD  PDVATT    EAMT                            S01501
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDCOLL      WKCHRG                                              CGL020
     C                     ADD  CSTA      WKCHRG                                              CGL020
     C                     ADD  TRCM      WKCHRG                                              CGL020
     C                     ADD  PDCHCM    WKCHRG                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01501
      ** If Compliance Watch AML Interface - Add'l A/C Postings Info is                       CGL020
      ** installed, set up fee fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDWKCHRG    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDDRVD      VDAT
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     EXSR WRIT
     C                     END                             E002
     C*
     C* CHARGES
     C*
     C*
     C                     MOVEL*BLANK    KCCY
     C                     Z-ADDDRVD      VDAT
     C*
     C* IF CHARGES TO THE DEBIT OF NOT ZERO IN BASE CUEENCY
     C* OTHERWISE IN PAY CURRENCY
     C*
     C***********CDRO      IFNE 0                          B002                               CSD027
     C           CDRO      IFNE *BLANKS                    B002                               CSD027
     C                     MOVE BCCY      ECCY
     C                     MOVELBASAC     SEAC
     C                     ELSE                            X002
     C                     MOVE DRCY      ECCY
     C                     MOVELSTLAC     SEAC
     C                     END                             E002
     C*
     C           S01501    IFNE 'S01501'                                  S01501
     C           PDVAT2    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'K'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '8'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCOLL      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           PDVAT3    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'C'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE 'Z'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDCSTA      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           PDVAT1    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'F'       KPYRE
     C                     ELSE                                           S01501
     C                     MOVE '4'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDTRCM      EAMT
     C                     EXSR WRIT
     C*                                                                   S01501
     C           S01501    IFNE 'S01501'                                  S01501
     C           PDVAT4    OREQ 'N'                                       S01501
     C           S01501    ANDEQ'S01501'                                  S01501
     C                     MOVE 'J'       KPYRE                           S01501
     C                     ELSE                                           S01501
     C                     MOVE '5'       KPYRE                           S01501
     C                     END                                            S01501
     C*                                                                   S01501
     C                     Z-ADDPDCHCM    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*                                                                   S01501
     C                     MOVE 'U'       KPYRE                           S01501
     C                     Z-ADDPDVATT    EAMT                            S01501
     C                     EXSR WRIT                                      S01501
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       DRAG
     C*
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           PVDT      IFLE EDAT                                      056031
     C           DRVD      ANDLEEDAT                                      056031
     C           IACG      IFEQ 'Y'
     C           PACG      ANDEQ'Y'
     C           DRAG      ANDEQ'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       PDRECI                          E32873
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATCQPADDDF
     C*
     C*
     C* UPDATE ARRAY FOR REC BASE CCY EQUIVALENT
     C*
     C* SET FIELDS TO ZERO IF FIRST CHECK
     C*
     C           CQSQ      IFEQ 1                          ## B002
     C           PREF      ORNE LSREFP                                    052311
     C                     Z-ADD0         X
     C                     Z-ADD*ZERO     TOT
     C                     Z-ADD*ZERO     CQCHK
     C                     Z-ADD*ZERO     TOTAL
     C                     MOVE *BLANKS   LSREFP 15                       052311
     C                     MOVE PREF      LSREFP                          052311
     C                     END                             ## E002
     C*
     C* KEEP RUNNING TOTAL OF ALL BASE EQUIVALENTS IN ARRAY
     C*
     C                     ADD  1         X
     C                     ADD  SBCQ      TOT,X
     C*
     C                     ADD  CQAM      CQCHK
     C*
     C* IF THIS IS LAST CHECK(TOTALS NOW MATCH)
     C*
     C           CQCHK     IFEQ TOTR                       ## B002
     C                     XFOOTTOT       TOTAL
     C*
     C* ACCESS HEADER RECORD FOR UPDATE OF BASE EQUIVALENT VALUE
     C*
     C           PREF      CHAINCQMAT                89
     C           *IN89     IFEQ '1'                        ## B003
     C                     MOVELPREF      WKEY             ***************
     C                     MOVE 'CQPAC'   WFILE            * DB ERROR 16 *
     C                     Z-ADD16        WBASE            ***************
     C                     EXSR DBERR
     C                     ELSE                            ## X003
     C*
     C                     Z-ADDTOTAL     PBCQ
     C                     UPDATCQPACA
     C*
     C                     END                             ## E003
     C*
     C                     END                             ## E002
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C           PADEND    TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD6         H       30
     C                     Z-ADDCQAM      PRMAMT
     C                     EXSR HASH
     C*
     C/COPY WNCPYSRC,FT0210C038
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* NTRANS SR.
     C* CREATE NOSTRO TRANSFERS ACCOUNT KEYS
     C************************************************************
     C*
     C           NTRANS    BEGSR
     C*                                                                   S01117
     C                     SETON                     25                   S01117
     C*
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          S01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             S01117
     C*                                                                   S01117
     C           *IN49     IFEQ '0'                                       S01117
     C           *IN,A     ANDEQ'1'                                       S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     SETOF                     45                   S01117
     C                     MOVE *BLANKS   BRCA1                           S01117
     C                     END                                            S01117
     C                     SETON                     49                   S01117
     C*                                                                   S01117
     C                     EXSR CHGBR                                     S01117
     C*                                                                   S01117
     C* CHECK IF LIVE RECORD
     C* IF IT IS GO TO END OF SUBROUTINE
     C*
     C***********RECI******IFNE 'D'                        B001           E32873
     C           RNRECI    IFNE 'D'                        B001           E32873
     C           AUIN      ORNE 'Y'
     C                     GOTO NTEND
     C                     END                             E001
     C*
     C                     Z-ADD0         CQSQ
     C* FIND SETTLEMENT ACCOUNTS
     C*
     C* SETTLE SETTLEMENT ACCOUNT
     C*
     C                     MOVE CCY       CCCY
     C                     MOVE 'N'       PRT1T
     C                     MOVELACBN      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     STLAC  15                       S01117
     C                     MOVELSETAC     STLAC                           S01117
     C*
     C* PAY SETTLEMENT ACCOUNT
     C*
     C                     MOVE 'N'       PRT1T
     C                     MOVELDEST      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR SETTLE
     C*********************MOVELSETAC     PAYAC  15                       S01117
     C                     MOVELSETAC     PAYAC                           S01117
      *                                                                   056031
      *  Analyse dates to see if keys should be generated                 056031
      *                                                                   056031
     C                     MOVEL'N'       @SDATE  1                       056031
     C                     MOVEL'N'       @PDATE  1                       056031
      *                                                                   056031
      *  If Generate posting flag is 'I' then generate all postings       056031
      *  => Generate postings on authorisation date.                      056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'I'                                       056031
     C                     Z-ADDRUND      P#EPSD  50                      056031
     C                     Z-ADDRUND      S#EPSD  50                      056031
      *                                                                   056031
     C           VACG      IFNE 'Y'                                       056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *  If Generate posting flag is 'E' then generate on event date      056031
      *  => Generate postings when event date is reached.                 056031
      *                                                                   056031
      *                                                                   056031
      *  If Generate posting flag is 'S' then generate on earlier date    056031
      *  => Generate postings either settle or pay date reached.          056031
      *                                                                   056031
     C           C#GPFG    IFEQ 'E'                                       056031
     C           C#GPFG    OREQ 'S'                                       056031
      *                                                                   056031
     C           VACG      IFNE 'Y'                                       056031
     C           VDAT      ANDLEEDAT                                      056031
     C                     Z-ADDVDAT      S#EPSD                          056031
     C                     MOVEL'Y'       @SDATE                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
     C*
     C* IF VALUE DATE IS NOT GREATER THAN EVENT DATE AND A/C KEYS HAVE
     C* NOT ALREADY BEEN CREATED, CREATE VALUE DATE ACCOUNT KEYS
     C*
     C***********VACG******IFNE 'Y'                        B001           056031
     C***********VDAT******ANDLEEDAT                                      056031
     C           @SDATE    IFEQ 'Y'                                       056031
     C*
     C                     Z-ADDS#EPSD    EPSD                            056031
     C                     MOVE 'V'       KDATE
     C                     MOVE *BLANK    KCCY
     C*
     C* SETTLE AMOUNT
     C*
     C                     MOVE 'P'       KPYRE
     C                     Z-ADDAMNT      EAMT
     C                     MOVE TFRF      PREF
     C                     MOVE CCCY      ECCY
     C                     MOVELPAYAC     SEAC
     C                     MOVELSTLAC     OTAC
     C                     MOVE *BLANKS   OCCY                            145660
     C                     EXSR WRIT
     C*
     C* SET FLAG TO SAY ACCOUNT KEYS HAVE BEEN PRODUCED
     C*
     C                     MOVE 'Y'       VACG
     C*
     C                     END                             E001
     C*
     C* IF ALL FLAGS SET MAKE FLAG RECORD AS MATURED
     C*
     C           VDAT      IFLE EDAT                                      056031
     C           VACG      IFEQ 'Y'
     C*********************MOVE 'M'       RECI                            E32873
     C                     MOVE 'M'       RNRECI                          E32873
     C                     END                             ## E002
     C                     END                                            056031
     C*
     C* UPDATE FILE
     C*
     C   50                UPDATNTRANDDF
     C*
     C* TAG FOR GOTO IF IGNORING RECORD
     C*
     C           NTEND     TAG                             ** OTEND
     C*
     C* ADD TO HASH TOTALS
     C*
     C                     Z-ADD7         H       30
     C                     Z-ADDAMNT      PRMAMT
     C                     EXSR HASH
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT                                                              S01117
     C************************************************************        S01117
     C* CHGBR SR.                                                         S01117
     C* TO DETECT FOR CHANGE OF BRANCH, OPEN AND CLOSE FT0210P1 REPORT    S01117
     C*                                                                   S01117
     C           CHGBR     BEGSR                                          S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C* WHEN MULTIBRANCHING INDICATOR IS SETON                            S01117
     C*                                                                   S01117
     C           *IN44     IFEQ '1'                                       S01117
     C           BRCA      IFNE BRCA1                                     S01117
     C           BRCA      ANDNE*BLANKS                                   178061
     C*                                                                   S01117
     C* WHEN FIRST RECORD IS READ FROM FILES: OTPAYDD,INPAYDD,            S01117
     C* CQCODDD,CQPACDD,NTRANDD - OPEN REPORT FT0210P1 (EXSR SUBZSF)      S01117
     C*                                                                   S01117
     C           *IN45     IFEQ '0'                                       S01117
     C                     EXSR SCLOSE                                    S01117
     C                     EXSR SUBZSF                                    S01117
     C*                                                                   S01117
     C* WRITE HEADER FOR FTO210P1 REPORT                                  S01117
     C*                                                                   S01117
     C                     WRITEP1HEAD                                    S01117
     C                     SETON                     45                   S01117
     C*                                                                   S01117
     C* OTHERWISE WRITE REPORT CLOSING DETAIL, CLOSE REPORT FT0210P1      S01117
     C*  AND OPEN REPORT FT0210P1 FOR NEW BRANCH (BRCA) - EXSR SUBZSF     S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     EXSR SUBZSF                                    S01117
     C                     SETOF                     20                   067360
     C*                                                                   S01117
     C* WRITE HEADER FOR FTO210P1 REPORT                                  S01117
     C*                                                                   S01117
     C                     WRITEP1HEAD                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WHEN MULTIBRANCHING INDICATOR IS SETOF                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* WHEN FIRST RECORD IS READ FROM FILES: OTPAYDD,INPAYDD,            S01117
     C* CQCODDD,CQPACDD,NTRANDD - OPEN REPORT FT0210P1 (EXSR SUBZSF)      S01117
     C*                                                                   S01117
     C           *IN45     IFEQ '0'                                       S01117
     C                     EXSR SCLOSE                                    S01117
     C                     EXSR SUBZSF                                    S01117
     C*                                                                   S01117
     C* WRITE HEADER FOR FTO210P1 REPORT                                  S01117
     C*                                                                   S01117
     C                     WRITEP1HEAD                                    S01117
     C                     SETON                     45                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* SAVE CURRENT BRANCH FOR COMPARISON WITH BRANCH FROM NEXT RECORD   S01117
     C*                                                                   S01117
     C                     MOVE BRCA      BRCA1   3                       S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C************************************************************     ***S01117
     C/EJECT                                                              S01117
     C************************************************************        S01117
     C* SUBZSF SR.                                                        S01117
     C* ZSFILE  HANDLING                                                  S01117
     C*                                                                   S01117
     C           SUBZSF    BEGSR                                          S01117
     C*                                                                   S01117
     C* SET PAGE NBR, OPEN REPORT FT0210P1 AND CALL ZSFILE  TO LOG        S01117
     C*  SPOOL FILE DETAILS                                               S01117
     C*                                                                   S01117
     C                     Z-ADD1         PPAGE                           S01117
     C                     SETOF                     73                   S01117
     C                     MOVE 'ALL'     PBRCA                                              BUG4310
     C*                                                                   S01117
     C                     OPEN FT0210P1                                  S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM1    ZSNUM                           S01117
     C                     MOVELSFILE1    ZSNAM                           S01117
     C                     MOVE BRCA      ZENT                            S01117
     C                     MOVE BRCA      PBRCA                           S01117
     C*                                                                   S01117
     C*  FOR FIRST P1 FILE OPENED, PASS SPOOL FILE NUMBER TO RCF TO       067360
     C*  ENABLE IT TO ACCESS SPOOL FILE NUMBERS RECORD AND UPDATE         067360
     C*  WITH JOB/SPOOL FILE DETAILS.                                     067360
     C           *IN20     IFEQ '0'                                       067360
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           ZSEQ    5                       S01117
     C                     PARM           ZENT    3                       S01117
     C                     PARM           ZSNAM  10                       S01117
     C                     PARM           ZSNUM   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C                     SETON                     20                   067360
      *                                                                   067360
     C*  FOR SECOND AND SUBSEQUENT P1 FILES, PASS BLANK SEQUENCE          067360
     C*  NUMBER TO ZSFILE TO ALLOW IT TO GENERATE NEW SPOOL FILE          067360
     C*  NUMBERS RECORD.                                                  067360
     C                     ELSE                                           067360
     C                     CALL 'ZSFILE'                                  067360
     C                     PARM *BLANKS   ZSEQ    5                       067360
     C                     PARM           ZENT    3                       067360
     C                     PARM           ZSNAM  10                       067360
     C                     PARM           ZSNUM   60                      067360
     C                     PARM *BLANKS   ZERR    1                       067360
     C                     END                                            067360
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0210'  DBPGM            ***************S01117
     C                     MOVEL'FT0210P1'DBKEY            ** DBERR  18 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD18        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C************************************************************     ***S01117
     C/EJECT                                                              S01117
     C************************************************************        S01117
     C* CHADBT SR.                                                        S01117
     C* MOVES FIELDS CDRO, CDBR INTO WORKING FIELD WRK15                  S01117
     C*  IF CHARGES TO THE DEBIT OF NOT BLANK                             S01117
     C*                                                                   S01117
     C           CHADBT    BEGSR                                          S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   WRK15                           S01117
     C                     MOVELCDRO      WRK15                           S01117
     C                     MOVE CDBR      WRK15                           S01117
     C                     MOVELWRK15     PRT1                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C************************************************************     ***S01117
     C/EJECT                                                              S01117
     C************************************************************        S01117
     C* SCLOSE SR.                                                        S01117
     C* TO OPEN REPORT FT0210P1, WRITE HEADINGS AND REPORT CLOSING        S01117
     C* DETAIL AND CLOSE REPORT FT0210P1 WHEN NO RECORDS FOUND ON         S01117
     C* MAINTENANCE FILE                                                  S01117
     C*                                                                   S01117
     C           SCLOSE    BEGSR                                          S01117
     C*                                                                   S01117
     C                     ADD  1         A                               S01117
     C*                                                                   S01117
     C           *IN,A     DOWEQ'0'                                       S01117
     C***********A         ANDLT26                                  S01117CFT006
     C           A         ANDLT28                                        CFT006
     C*                                                                   S01117
     C                     EXSR SARRAY                                    S01117
     C                     EXSR SUBZSF                                    S01117
     C                     MOVE *BLANKS   PBRCA                           S01117
     C                     MOVE 'ALL'     PBRCA                                              BUG4310
     C                     WRITEP1HEAD                                    S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     MOVE '1'       *IN,A                           S01117
     C                     ADD  1         A                               S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WRITE CURRENT TRANSACTION TYPE FOR THE HEADER OF FT0210P1 REPORT  S01117
     C*                                                                   S01117
     C********   A         IFLT 26                                  S01117178061
     C           A         IFLT 28                                        178061
     C                     EXSR SARRAY                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* MOVE CURRENT BRANCH CODE FROM MAINTENANCE FILE TO PBRCA FIELD     S01117
     C*                                                                   S01117
     C                     MOVE BRCA      PBRCA                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C************************************************************     ***S01117
     C/EJECT                                                              S01117
     C************************************************************        S01117
     C* SARRAY SR.                                                        S01117
     C* TO WRITE TRANSACTION TYPE FOR THE HEADER OF FT0210P1 REPORT       S01117
     C* FOR EACH MAINTENANCE FILE CURRENTLY USED BY FT0210 PGM            S01117
     C*                                                                   S01117
     C           SARRAY    BEGSR                                          S01117
     C*                                                                   S01117
     C           A         SUB  20        B       20                      S01117
     C                     MOVELARR,B     TRNTP                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C************************************************************     ***S01117
     C/EJECT
      *****************************************************************   S01435
      *                                                               *   S01435
      *  SRINFT   : Update Incoming Message FT Transaction Status     *   S01435
      *             File record                                       *   S01435
      *  CALLS    : NONE                                              *   S01435
      *                                                               *   S01435
      *                                                               *   S01435
      *  CALLED BY: OTPAYS  - create outgoing payment account keys    *   S01435
      *             INPAYS  - create incoming payment account keys    *   S01435
      *                                                               *   S01435
      *                                                               *   S01435
      *****************************************************************   S01435
     CSR         SRINFT    BEGSR                                          S01435
      *                                                                   S01435
      *  Fill record format data structure with available data            S01435
      *                                                                   S01435
     C                     CLEARINFT                                      S01435
      *                                                                   S01435
      * If indicator 01 on, outgoing payment record is processed          S01435
      *                                                                   S01435
     C           *IN01     IFEQ '1'                                       S01435
     C                     Z-ADDOPMSGR    FTMSGR           Unique Ref.    S01435
     C                     Z-ADDOPKPRT    FTKPRT           Part No.       S01435
     C                     MOVEL'MIN0033' FTOTFG           Outgoing Flag  S01435
     C                     MOVELPREF      FTOPRF           Outg. Pay. Ref S01435
     C                     MOVEL'MIN0196' W2LMSG           Log file Msg IDS01435
     C                     MOVEL'*FT OUT 'W2ACT                           S01435
     C                     ELSE                                           S01435
      *                                                                   S01435
      * else if indicator 02 on, incoming payment record is processed     S01435
      *                                                                   S01435
     C           *IN02     IFEQ '1'                                       S01435
     C                     Z-ADDINMSGR    FTMSGR           Unique Ref.    S01435
     C                     Z-ADDINKPRT    FTKPRT           Part No.       S01435
     C                     MOVEL'MIN0033' FTINFG           Incoming Flag  S01435
     C                     MOVELPREF      FTIPRF           Incom. Pay. RefS01435
     C                     MOVEL'MIN0177' W2LMSG           Log file Msg IDS01435
     C                     MOVEL'*FT INC 'W2ACT                           S01435
     C                     END                                            S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     MOVELBRCA      FTBRCA           Branch Code    S01435
     C                     MOVEL*BLANKS   FTFRGL           Funds From     S01435
     C                     MOVEL*BLANKS   FTTOGL           Funds To       S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   W2NWRK           Network        S01435
     C           CSW220    IFEQ 'Y'                                                           CSW220
     C                     MOVEL'Z'       FTM199                                              CSW220
     C                     ENDIF                                                              CSW220
      *                                                                   S01435
      *  N.B. Audit Stamp details are determined in called program        S01435
      *                                                                   S01435
      *                                                                   S01435
      *  Set up data to be passed using the rcd format data structure     S01435
      *                                                                   S01435
     C                     CALL 'ME1050'               90                 S01435
     C                     PARM           W2ACT   8                       S01435
     C                     PARM 'FT0210  'W2CPGM 10                       S01435
     C                     PARM           W2NWRK  6                       S01435
     C                     PARM           W2LMSG  7                       S01435
     C                     PARM           INFT                            S01435
     C                     PARM *BLANKS   W2RTN   7                       S01435
      *                                                                   S01435
      *  If return with an error (LR seton in called program) then        S01435
      *  process for database error.                                      S01435
      *                                                                   S01435
     C           *IN90     IFEQ '1'                                       S01435
     C           W2RTN     OREQ '*ERROR*'                                 S01435
     C                     MOVE 'ME1050  'WFILE            ***************S01435
     C                     MOVEL'*CALL'   WKEY             * DB ERROR 20 *S01435
     C                     Z-ADD20        WBASE            ***************S01435
     C                     EXSR DBERR                                     S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     COMIT                                          S01435
      *                                                                   S01435
     CSR                   ENDSR                                          S01435
     C/EJECT                                                              S01435
     C************************************************************
     C* TRAIL SR.
     C* TRAILER HANDLING
     C*
     C           TRAIL     BEGSR
     C*                                                                   S01117
     C           *IN10     IFEQ '1'                                       S01117
     C*
     C* WHEN LAST RECORD IS READ FROM PREVIOUS MAINTENANCE FILE,          S01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0210P1             S01117
     C*                                                                   S01117
     C           *IN66     IFEQ '0'                                       S01117
     C           *IN,A     ANDEQ'1'                                       S01117
     C*********************WRITEP1CLO                               S01117055507
     C                     WRITEP1CLO                  72                 055507
     C                     CLOSEFT0210P1                                  S01117
     C                     SETON                     66                   S01117
     C                     END                                            S01117
     C                     EXSR SCLOSE                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           NORE1     IFNE CTN#,H
     C           HRWN      ORNE CTI#,H
     C           HRDC      ORNE CTD#,H
     C                     SETON                     30U8
     C                     END
     C                     MOVE CTN#,H    CTN
     C                     MOVE CTI#,H    CTI
     C                     MOVE CTD#,H    CTD
     C                     MOVE FILES,H   FILE
     C                     WRITEFT0210F2               89
     C                     SETOF                     30
     C*
     C                     ENDSR
     C*
     C************************************************************     ***
     C/EJECT
     C************************************************************
     C* SETTLE SR.
     C* TO FIND CORRECT SETTLEMENT ACCOUNT
     C*
     C           SETTLE    BEGSR
     C*
     C* DEFINE FIELDS
     C                     MOVE PRT1T     PRT1T   1
     C*********************MOVE PRT1      PRT1   15                       S01117
     C**********           MOVE PRT1      PRT1   18                                    S01117 CGL029
     C**********           MOVE PRT1      PRT1   24                                  CGL029 BUG15046
     C                     MOVE PRT1      PRT1   35                                         BUG15046
     C                     MOVE PRT2T     PRT2T   1
     C*********************MOVE PRT2      PRT2   15                       S01117
     C**********           MOVE PRT2      PRT2   18                                    S01117 CGL029
     C**********           MOVE PRT2      PRT2   24                                  CGL029 BUG15046
     C                     MOVE PRT2      PRT2   35                                         BUG15046
     C                     MOVE CCCY      CCCY    3
     C                     MOVE *BLANK    SETAC
      *                                                                                     BUG15046
     C                     MOVELPRT1      WSLS    1                                         BUG15046
     C           WSLS      IFEQ '/'                                                         BUG15046
     C           34        SUBSTPRT1:2    PRT1                                              BUG15046
     C                     ENDIF                                                            BUG15046
      *                                                                                     BUG15046
     C                     MOVELPRT2      WSLS                                              BUG15046
     C           WSLS      IFEQ '/'                                                         BUG15046
     C           34        SUBSTPRT2:2    PRT2                                              BUG15046
     C                     ENDIF                                                            BUG15046
     C*
     C* IF PARTY 1 ENTERED AND NOT SWIFT, AN ADDRESS OR CLIENT NUMBER
     C           PRT1T     IFNE *BLANK                     B001
     C           PRT1T     ANDNE'A'
     C           PRT1T     ANDNE'S'
     C           PRT1T     ANDNE'C'
     C*
     C                     MOVELPRT1      PARTY
     C*
     C* IF RETAIL CHAIN TO ACNUMA
     C           PRT1T     IFEQ 'R'                        B002
     C                     MOVELPRT1      ACNO
     C           ACNO      CHAINACNUMA               89
     C  N89      RECI      COMP 'D'                  8989                 044283
     C***89******          DO                              B003           044283
     C***********          MOVELACNO      WKEY             ***************044283
     C***********          MOVE 'ACNUM'   WFILE            * DB ERROR 04 *044283
     C***********          Z-ADD4         WBASE            ***************044283
     C***********          EXSR DBERR                                     044283
     C***********          END                             E003           044283
     C                     END                             E002
     C*
     C* IS NOSTRO FULL OR NUMBER
     C           PRT1T     IFEQ 'F'                        B002
     C           PRT1T     OREQ 'N'
     C* IF FULL NOSTRO
     C           PRT1T     IFEQ 'F'                        B003
     C                     MOVELPRT1      NOSX    5
     C                     MOVELPRT1      CCY
     C                     ELSE                            X003
     C*
     C* IS A NOSTRO NUMBER
     C                     MOVELCCCY      NOSX
     C                     MOVELPRT1      NO      2
     C                     MOVE NO        NOSX
     C                     MOVE CCCY      CCY
     C                     END                             E003
     C*
     C* CHAIN TO TABLETL
     C                     MOVE *BLANK    KEY
     C                     MOVEL'70'      KEY
     C                     MOVE NOSX      KEY
     C           KEY       CHAINTABLETLF             89
     C  N89      RECI      COMP 'D'                  8989
     C   89                DO                              B003
     C                     MOVELKEY       WKEY             ***************
     C                     MOVE 'TABFP'   WFILE            * DB ERROR 05 *
     C                     Z-ADD5         WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E003
     C                     END                             E002
     C* IS PARTIAL ACCOUNT
     C           PRT1T     IFEQ 'P'                        B002
     C                     MOVE CCCY      CCY
     C                     Z-ADDPACOD     ACOD
     C                     Z-ADDPACSQ     ACSQ
     C                     MOVE PBRCH     BRCAAC                          S01117
     C                     END                             E002
     C           PRT1T     IFEQ 'G'                        B002
     C                     MOVE SMCYY     CCY
     C                     Z-ADDACODN     ACOD
     C                     Z-ADDACSQN     ACSQ
     C                     MOVE BRCHN     BRCAAC                          S01117
     C                     END                             E002
     C           PRT1T     IFEQ 'P'                        B002
     C           PRT1T     OREQ 'G'
     C           PRT1T     OREQ 'F'
     C           PRT1T     OREQ 'N'
      *                                                                                       CGL029
     C                     MOVE ACOD      PAFNB  10                                           CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C************         PARM '*MSG   ' PRTCD   7                                   CGL029 BUG1815
     C                     PARM '*MSG   ' @RTCD   7                                          BUG1815
     C                     PARM '*KEY   ' POPTN   7                                           CGL029
     C                     PARM           PAFNB                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C           @RTCD     IFNE *BLANK                                                        CGL029
     C*                                                                   044283
     C**READ*TABTE10*FOR*ACCOUNT*TYPE**********************************                044283 CGL029
     C**********           MOVEL'30    '  KEY                                          044283 CGL029
     C**********           MOVE '      '  KEY                                          044283 CGL029
     C**********           MOVELACOD      WK5A    5                                    044283 CGL029
     C**********           MOVE '1'       WK5A                                         044283 CGL029
     C**********           MOVE WK5A      KEY                                          044283 CGL029
     C**                                                                  044283
     C********** KEY       CHAINTABFP                89                                044283 CGL029
     C**N89***** RECI      COMP 'D'                  8989                              044283 CGL029
     C***89*****           DO                              B001                        044283 CGL029
     C**********           MOVE 'TABLE'   WFILE            ***************             044283 CGL029
     C                     MOVE 'SDACODPD'WFILE                                               CGL029
     C                     MOVELKEY       WKEY             * DB ERROR 04 *044283
     C                     Z-ADD4         WBASE            ***************044283
     C                     EXSR DBERR                                     044283
     C                     END                                            044283
     C*                                                                   044283
     C           ATYP      IFEQ 'R'                        B003           044283
     C*                                                                   044283
     C           ACNK      CHAINACCNTABF             89
     C  N89      RECI      COMP 'D'                  8989
     C***89******          DO                              B003           044283
     C***********          MOVELCNUM      WKEY             ***************E23466
     C***********          Z-ADDCNUM      CNUMDB                    E23466044283
     C***********          MOVELACNKDB    WKEY             *********E23466044283
     C***********          MOVE 'ACCNT'   WFILE            * DB ERROR 06 *044283
     C***********          Z-ADD6         WBASE            ***************044283
     C***********          EXSR DBERR                                     044283
     C                     END                             E003
     C                     END                             E002
      *                                                                                    BUG15046A
     C           PRT1T     IFEQ 'I'                                                        BUG15046A
     C                     CALL 'AOIBANR4'                                                 BUG15046A
     C                     PARM           P@RTCD  7                                        BUG15046A
     C                     PARM '*KEY   ' P@OPTN  7                                        BUG15046A
     C                     PARM PRT1      P@IBAN 34                                        BUG15046A
     C           ACNT      PARM *BLANKS   DSSDY                                            BUG15046A
      *                                                                                    BUG15046A
     C           P@RTCD    IFEQ *BLANKS                                                    BUG15046A
     C                     MOVE S4CNUM    CNUM                                             BUG15046A
     C                     MOVE S4CCY     CCY                                              BUG15046A
     C                     Z-ADDS4ACOD    ACOD                                             BUG15046A
     C                     Z-ADDS4ACSQ    ACSQ                                             BUG15046A
     C                     MOVE S4BRCA    BRCAAC                                           BUG15046A
     C                     MOVE *OFF      *IN89                                            BUG15046A
     C                     ELSE                                                            BUG15046A
     C                     MOVE *ON       *IN89                                            BUG15046A
     C                     ENDIF                                                           BUG15046A
     C                     ENDIF                                                           BUG15046A
      *                                                                                    BUG15046A
     C                     ELSE                            X001
     C*
     C* NOW TRY PARTY 2
     C*
     C*
     C* IF PARTY 2 ENTERED AND NOT SWIFT, AN ADDRESS OR CLIENT NUMBER
     C           PRT2T     IFNE *BLANK                     B002
     C           PRT2T     ANDNE'A'
     C           PRT2T     ANDNE'S'
     C           PRT2T     ANDNE'C'
     C*
     C                     MOVELPRT2      PARTY
     C*
     C* IF RETAIL CHAIN TO ACNUMA
     C           PRT2T     IFEQ 'R'                        B003
     C                     MOVELPRT2      ACNO
     C           ACNO      CHAINACNUMA               89
     C  N89      RECI      COMP 'D'                  8989
     C***89******          DO                              B004           044283
     C***********          MOVELACNO      WKEY             ***************044283
     C***********          MOVE 'ACNUM'   WFILE            * DB ERROR 07 *044283
     C***********          Z-ADD7         WBASE            ***************044283
     C***********          EXSR DBERR                                     044283
     C***********          END                             E004           044283
     C                     END                             E003
     C*
     C* IS NOSTRO FULL OR NUMBER
     C           PRT2T     IFEQ 'F'                        B003
     C           PRT2T     OREQ 'N'
     C* IF FULL NOSTRO
     C           PRT2T     IFEQ 'F'                        B004
     C                     MOVELPRT2      NOSX    5
     C                     MOVELPRT2      CCY
     C                     ELSE                            X004
     C*
     C* IS A NOSTRO NUMBER
     C                     MOVELCCCY      NOSX
     C                     MOVELPRT2      NO      2
     C                     MOVE NO        NOSX
     C                     MOVE CCCY      CCY
     C                     END                             E004
     C*
     C* CHAIN TO TABLETL
     C                     MOVE *BLANK    KEY
     C                     MOVEL'70'      KEY
     C                     MOVE NOSX      KEY
     C/COPY WNCPYSRC,FT0210C035
     C           KEY       CHAINTABLETLF             89
     C  N89      RECI      COMP 'D'                  8989
     C   89                DO                              B004
     C                     MOVELKEY       WKEY             ***************
     C                     MOVE 'TABFP'   WFILE            * DB ERROR 08 *
     C                     Z-ADD8         WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E004
     C                     END                             E003
     C* IS PARTIAL ACCOUNT
     C           PRT2T     IFEQ 'P'                        B003
     C                     MOVE CCCY      CCY
     C                     Z-ADDPACOD     ACOD
     C                     Z-ADDPACSQ     ACSQ
     C                     MOVE PBRCH     BRCAAC                          S01117
     C                     END                             E003
     C           PRT2T     IFEQ 'G'                        B003
     C                     MOVE SMCYY     CCY
     C                     Z-ADDACODN     ACOD
     C                     Z-ADDACSQN     ACSQ
     C                     MOVE BRCHN     BRCAAC                          S01117
     C                     END                             E003
     C           PRT2T     IFEQ 'P'                        B003
     C           PRT2T     OREQ 'G'
     C           PRT2T     OREQ 'F'
     C           PRT2T     OREQ 'N'
      *                                                                                       CGL029
     C                     MOVE ACOD      PAFNB                                               CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C**********           PARM '*MSG   ' PRTCD                                       CGL029 BUG1815
     C                     PARM '*MSG   ' @RTCD                                              BUG1815
     C                     PARM '*KEY   ' POPTN                                               CGL029
     C                     PARM           PAFNB                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C           @RTCD     IFNE *BLANK                                                        CGL029
     C*                                                                   044283
     C**READ*TABTE10*FOR*ACCOUNT*TYPE**********************************                044283 CGL029
     C**********           MOVEL'30    '  KEY                                          044283 CGL029
     C**********           MOVE '      '  KEY                                          044283 CGL029
     C**********           MOVELACOD      WK5A    5                                    044283 CGL029
     C**********           MOVE '1'       WK5A                                         044283 CGL029
     C**********           MOVE WK5A      KEY                                          044283 CGL029
     C**                                                                  044283
     C********** KEY       CHAINTABFP                89                                044283 CGL029
     C**N89***** RECI      COMP 'D'                  8989                              044283 CGL029
     C***89*****           DO                              B001                        044283 CGL029
     C**********           MOVE 'TABLE'   WFILE            ***************             044283 CGL029
     C                     MOVE 'SDACODPD'WFILE                                               CGL029
     C                     MOVELKEY       WKEY             * DB ERROR 07 *044283
     C                     Z-ADD7         WBASE            ***************044283
     C                     EXSR DBERR                                     044283
     C                     END                                            044283
     C*                                                                   044283
     C           ATYP      IFEQ 'R'                        B004           044283
     C*                                                                   044283
     C           ACNK      CHAINACCNTABF             89
     C  N89      RECI      COMP 'D'                  8989
     C***89******          DO                              B004           044283
     C***********          MOVELCNUM      WKEY             ***************044283
     C***********          MOVE 'ACCNT'   WFILE            * DB ERROR 09 *044283
     C***********          Z-ADD9         WBASE            ***************044283
     C***********          EXSR DBERR                                     044283
     C                     END                             E004
     C                     END                             E003
     C           PRT2T     IFEQ 'I'                                                           CFT032
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM           P@RTCD  7                                           CFT032
     C                     PARM '*KEY   ' P@OPTN  7                                           CFT032
     C                     PARM PRT2      P@IBAN 34                                           CFT032
     C           ACNT      PARM *BLANKS   DSSDY                                               CFT032
      *                                                                                       CFT032
     C           P@RTCD    IFEQ *BLANKS                                                       CFT032
     C**********           MOVE S4CNUM    CNUMX                                      CFT032 BUG15046
     C**********           MOVE S4CCY     CCYX                                       CFT032 BUG15046
     C**********           Z-ADDS4ACOD    ACODX                                      CFT032 BUG15046
     C**********           Z-ADDS4ACSQ    ACSQX                                      CFT032 BUG15046
     C**********           MOVE S4BRCA    BRCHX                                      CFT032 BUG15046
     C                     MOVE S4CNUM    CNUM                                              BUG15046
     C                     MOVE S4CCY     CCY                                               BUG15046
     C                     Z-ADDS4ACOD    ACOD                                              BUG15046
     C                     Z-ADDS4ACSQ    ACSQ                                              BUG15046
     C                     MOVE S4BRCA    BRCAAC                                            BUG15046
     C                     MOVE *OFF      *IN89                                             BUG15046
     C                     ELSE                                                               CFT032
     C**********           MOVELBIBAN     WKEY                                       CFT032 BUG15046
     C**********           MOVE 'AOIBANR4'WFILE                                      CFT032 BUG15046
     C**********           Z-ADD30        WBASE                                      CFT032 BUG15046
     C**********           EXSR DBERR                                                CFT032 BUG15046
     C                     MOVE *ON       *IN89                                             BUG15046
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     END                             E002
     C                     END                             E001
     C*
     C* SET UP FIELDS
     C*
     C           *IN89     IFEQ '0'                                       044283
     C**********           Z-ADDCNUM      CNUMX                                               CSD027
     C                     MOVE CNUM      CNUMX                                               CSD027
     C                     MOVE CCY       CCYX
     C                     Z-ADDACOD      ACODX
     C                     Z-ADDACSQ      ACSQX
     C                     MOVE BRCAAC    BRCHX                           S01117
     C                     ELSE                                           044283
     C*                                                                   044283
     C** Get branch internal Customer no. for suspense a/c no.            044283
     C*                                                                   044283
     C                     MOVE *BLANKS   KEY                             044283
     C                     MOVEL'10    '  KEY                             044283
     C                     MOVE BRCA      KEY                             044283
     C           KEY       CHAINTABFP                89                   044283
     C  N89      RECI      COMP 'D'                  8989                 044283
     C   89                DO                                             044283
     C                     MOVE 'TABFP'   WFILE            ***************044283
     C                     MOVELKEY       WKEY             ** DBERR  09 **044283
     C                     Z-ADD9         WBASE            ***************044283
     C                     EXSR DBERR                                     044283
     C                     END                                            044283
     C*                                                                   044283
     C**********           Z-ADDBICN      CNUMX                                        044283 CSD027
     C                     MOVE BICN      CNUMX                                               CSD027
     C                     MOVE CCY       CCYX                            044283
     C                     MOVE BTIOSA    ACODX                           044283
     C                     MOVE '01'      ACSQX                           044283
     C                     MOVE BRCA      BRCHX                           044283
     C                     END                                            044283
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF SUBROUTINE TO FIND CNUM
     C************************************************************
     C/EJECT
     C************************************************************
     C/COPY ZSRSRC,ZDATE2Z2
     C************************************************************
     C/EJECT
     C************************************************************     ***
     C* WRIT SR.
     C* TO WRITE ACCOUNT KEY RECORD
     C************************************************************     ***
     C*
     C           WRIT      BEGSR
     C/COPY WNCPYSRC,FT0210C009
     C*
      ** For base currency equivalent, ECCY should be base currency.                          CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C           KPYRE     IFEQ 'A'                                                           CFT120
     C           KPYRE     OREQ 'B'                                                           CFT120
     C                     MOVE UMBCCY    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C* ONLY WRITE IF AMOUNT NOT ZERO
     C*
     C           EAMT      IFNE 0                          B001
     C*
      * Process the Associated customer number                            051400
      *                                                                   051400
      * Incoming and Outgoings are processed by Add/Deduct indicator      051400
      *                                                                   051400
     C**********           Z-ADD0         FPASOC                                       051400 CSD027
     C**********           MOVE *ZEROS    WKASOC  6                                    164670 CSD027
     C                     MOVE *BLANKS   FPASOC                                              CSD027
     C                     MOVE *BLANKS   WKASOC  6                                           CSD027
     C           *IN01     IFEQ '1'                                       051400
     C           *IN02     OREQ '1'                                       051400
     C           ADDC      IFEQ 'A'                                       051400
     C***********          MOVELSTLAC     FPASOC                    051400164670
     C                     MOVELSTLAC     WKASOC                          164670
     C                     ELSE                                           051400
     C           ADDC      IFEQ 'D'                                       051400
     C***********          MOVELPAYAC     FPASOC                    051400164670
     C                     MOVELPAYAC     WKASOC                          164670
     C                     END                                            051400
     C                     END                                            051400
     C                     END                                            051400
      *                                                                   051400
      * Cheques are processed by Settlement Account                       051400
      *                                                                   051400
     C           *IN03     IFEQ '1'                                       051400
     C           *IN04     OREQ '1'                                       051400
     C           *IN05     OREQ '1'                                       051400
     C           *IN06     OREQ '1'                                       051400
     C***********          MOVELSEAC      FPASOC                    051400164670
     C                     MOVELSEAC      WKASOC                          164670
     C                     END                                            051400
     C*                                                                   051400
     C                     MOVELWKASOC    FPASOC                          164670
     C**                                                                  164670
      *                                                                                       CGL020
      ** Process the Pay/Receive Settlement Instructions.                                     CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRPRSI                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   EXTD1                                               CER030
     C                     MOVE *BLANKS   EXTD2                                               CER030
     C                     MOVE *BLANKS   EXTD3                                               CER030
     C                     MOVE *BLANKS   EXTD4                                               CER030
     C                     MOVE *BLANKS   EXTD5                                               CER030
     C                     MOVE *BLANKS   EXTD6                                               CER030
      *                                                                                       CER030
     C                     MOVE *BLANKS   EXTC1                                               CER030
     C                     MOVE *BLANKS   EXTC2                                               CER030
     C                     MOVE *BLANKS   EXTC3                                               CER030
     C                     MOVE *BLANKS   EXTC4                                               CER030
     C                     MOVE *BLANKS   EXTC5                                               CER030
     C                     MOVE *BLANKS   EXTC6                                               CER030
     C                     MOVE *BLANKS   RTTY                                                CER030
      *                                                                                       CER030
     C                     MOVELAKEY      WTYPE   2                                           CER030
      *                                                                                       CER030
     C           WTYPE     IFEQ 'IN'                                                          CER030
      *                                                                                       CER030
     C                     MOVE IRTTY     RTTY                                                CER030
      *                                                                                       CER030
     C                     MOVE IEXT1     EXTC1                                               CER030
     C                     MOVE IEXT2     EXTC2                                               CER030
     C                     MOVE IEXT3     EXTC3                                               CER030
     C                     MOVE IEXT4     EXTC4                                               CER030
     C                     MOVE IEXT5     EXTC5                                               CER030
     C                     MOVE IEXT6     EXTC6                                               CER030
      *                                                                                       CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C           WTYPE     IFEQ 'OP'                                                          CER030
      *                                                                                       CER030
     C                     MOVE OPRTTY    RTTY                                                CER030
      *                                                                                       CER030
     C                     MOVE OPEXT1    EXTD1                                               CER030
     C                     MOVE OPEXT2    EXTD2                                               CER030
     C                     MOVE OPEXT3    EXTD3                                               CER030
     C                     MOVE OPEXT4    EXTD4                                               CER030
     C                     MOVE OPEXT5    EXTD5                                               CER030
     C                     MOVE OPEXT6    EXTD6                                               CER030
      *                                                                                       CER030
     C                     MOVE OPEXC1    EXTC1                                               CER030
     C                     MOVE OPEXC2    EXTC2                                               CER030
     C                     MOVE OPEXC3    EXTC3                                               CER030
     C                     MOVE OPEXC4    EXTC4                                               CER030
     C                     MOVE OPEXC5    EXTC5                                               CER030
     C                     MOVE OPEXC6    EXTC6                                               CER030
      *                                                                                       CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C                     WRITEFPKEYDDF               89
     C/COPY WNCPYSRC,FT0210C036
     C   89                DO                              B003
     C                     MOVEL'WRITE'   WKEY             ***************
     C                     MOVE 'FPKEY'   WFILE            * DB ERROR 10 *
     C                     Z-ADD10        WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E003
     C* ADD TO HASH TOTALS
     C*********************Z-ADD8         H       30       CFT006
     C                     Z-ADD10        H       30       CFT006
     C                     Z-ADDEAMT      PRMAMT
     C                     EXSR HASH
     C*
     C* PRODUCE LIST OF GENERATED ACCOUNT KEYS
     C*
     C                     EXSR ACCREP
     C*
     C                     END                             E001
     C*
     C*
      ** Reset fee fields                                                                     CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANKS   F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR
     C*
     C************************************************************
     C* END OF SUBROUTINE TO WRITE TO FPKEYDD
     C************************************************************
     C/EJECT
     C************************************************************
     C* ACCREP SR.
     C**PRODUCES*A*LIST*OF*GENERATED*ACCOUNT*KEYS*(FT0210P2)*             S01117
     C* PRODUCES A LIST OF GENERATED ACCOUNT KEYS (FT0210P1)              S01117
     C************************************************************     ***
     C*
     C           ACCREP    BEGSR
     C*
     C**FORMAT*THE*DATE*AND*PRODUCE*REPORT*FT0210P2*                      S01117
     C* FORMAT THE DATE AND PRODUCE REPORT FT0210P1                       S01117
     C*
     C                     Z-ADDVDAT      ZDAYNO           'FORMAT DATE
     C                     EXSR ZDATE2                     'TO DDMMMYY
     C                     MOVE ZADATE    VDATO   7
     C*                                                                   E23050
     C** FIND THE NUMBER OF DECIMAL PLACES FOR A CURRENCY                 E23050
     C** AND FORMAT AMOUNTS ACCORDINGLY.                                  E23050
     C*                                                                   E23050
     C                     Z-ADD1         Z                               E23050
     C           ECCY      LOKUPCCYA,Z                   88               E23050
     C  N88                DO                                             E23050
     C                     MOVELECCY      WKEY             ************   E23050
     C                     MOVE 'TABLE'   WFILE            * DATABASE *   E23050
     C                     Z-ADD17        WBASE            * ERROR 17 *   E23050
     C                     EXSR DBERR                      ************   E23050
     C                     END                                            E23050
     C*                                                                   E23050
     C           CDPA,Z    COMP 2                    63  62               E23050
     C           CDPA,Z    COMP 1                      6061               E23050
     C   60                MOVE EAMT      AMT0                            E23050
     C   61                MOVE EAMT      AMT1                            E23050
     C   62                MOVE EAMT      AMT2                            E23050
     C   63                MOVE EAMT      AMT3                            E23050
     C*                                                            E18528 E23050
     C*****************    MOVE EAMT      EAMTDP 152               E18528 E23050
     C*                                                                   S01117
     C           *IN72     IFEQ '1'                                       S01117
     C                     ADD  1         PPAGE                           S01117
     C                     WRITEP1HEAD                                    S01117
     C                     END                                            S01117
     C*
     C*********************WRITEP2DETL                 72                 S01117
     C***********AKEY******CHAINACKEY                99             094407CDL038
     C           EXAKEY    CHAINACKEY                99                   CDL038
     C     N99   RECIAK    COMP 'D'                  9999                 094407
     C           *IN99     IFEQ '0'                            B001       094407
     C                     WRITEP1DETL                 72                 S01117
     C                     SETON                     73                   184181
     C                     END                                 E001       094407
     C*********************SETON                     73                   184181
     C*
     C******72*************ADD  1         PPAGE                           S01117
     C******72*************WRITEP2HEAD                                    S01117
     C*
     C                     ENDSR
     C*
     C************************************************************
     C/EJECT
     C************************************************************     ***
     C* CURRY SR.
     C* TO CALCULATE CROSS CALCULATION AND BASE EQUIV OF SAME
     C************************************************************     ***
     C*
     C           CURRY     BEGSR
     C*
     C                     Z-ADD1         Z       30
     C           CURR1     LOKUPCCYA,Z                   88
     C*
     C  N88                DO                              B001
     C                     MOVELCURR1     WKEY             ***************
     C*********************MOVE 'TABLE'   WFILE            * DB ERROR 11 *S01194
     C                     MOVE 'TABTG20' WFILE            * DB ERROR 11 *S01194
     C                     Z-ADD11        WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E001
     C                     Z-ADDCDPA,Z    CDP1    30
     C*
     C                     Z-ADD1         Z       30
     C           CURR2     LOKUPCCYA,Z                   88
     C*
     C  N88                DO                              B001
     C                     MOVELCURR2     WKEY             ***************
     C*********************MOVE 'TABLE'   WFILE            * DB ERROR 12 *S01194
     C                     MOVE 'TABTG20' WFILE            * DB ERROR 12 *S01194
     C                     Z-ADD12        WBASE            ***************
     C                     EXSR DBERR
     C                     END                             E001
     C                     Z-ADDCDPA,Z    CDP2    30
     C                     Z-ADDSPTA,Z    SPOT2  138
     C                     Z-ADDMDA,Z     MDIN2  138
     C           CDP1      SUB  CDP2      N       10
     C           N         ADD  4         N
     C           MDINS     IFEQ 1                          B002
     C           RATE      DIV  POWER,N   WK159  159H
     C           AMOUNT    MULT WK159     AMTC   130H
     C                     ELSE                            X002
     C           RATE      MULT POWER,N   WK159  159H
     C           AMOUNT    DIV  WK159     AMTC      H
     C                     END                             E002
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF CURRENCY SUBROUTINE
     C************************************************************
     C/EJECT
     C************************************************************     ***
     C* HASH SR.
     C* KEEP HASH TOTALS FOR EACH FILE
     C************************************************************     ***
     C*
     C           HASH      BEGSR
     C*
     C                     ADD  1         CTN#,H
     C                     MOVE PRMAMT    ZZAMT
     C           ZZAMT     IFLT 0
     C                     Z-SUBZZAMT     ZZAMT
     C                     END
     C                     MOVE CTI#,H    ZZTOTI
     C                     MOVE CTD#,H    ZZTOTD
     C                     EXSR GLZADD
     C                     MOVE ZZTOTI    CTI#,H
     C                     MOVE ZZTOTD    CTD#,H
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C************************************************************     ***
     C* DBERR SR.
     C* HANDLES DATABASE ERRORS
     C************************************************************     ***
     C*
     C           DBERR     BEGSR
     C*
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0210  'DBPGM
     C                     MOVELWFILE     DBFILE
     C                     MOVELWKEY      DBKEY
     C                     Z-ADDWBASE     DBASE
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
     C  N40                WRITEFT0210F1               89
     C*********************WRITEP1DBER                 89                 S01117
     C                     WRITEAUDBER                 89                 S01117
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C/EJECT
     C*
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C********************************************************************
     C/EJECT
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRPRSI - Handles the Pay/Receieve Settlement Instructions.    *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
     C           SRPRSI    BEGSR                                                              CGL020
      *                                                                                       CGL020
      ** Clear all ZAAMLSETFT input parameters.                                               CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   POCUS1                                              CGL020
     C                     MOVE *BLANKS   POCUS2                                              CGL020
     C                     MOVE *BLANKS   POCUS3                                              CGL020
     C                     MOVE *BLANKS   POCUS4                                              CGL020
     C                     MOVE *BLANKS   POCUS5                                              CGL020
     C                     MOVE *BLANKS   POBNK1                                              CGL020
     C                     MOVE *BLANKS   POBNK2                                              CGL020
     C                     MOVE *BLANKS   POBNK3                                              CGL020
     C                     MOVE *BLANKS   POBNK4                                              CGL020
     C                     MOVE *BLANKS   POBNK5                                              CGL020
     C                     MOVE *BLANKS   POBNKC                                              CGL020
     C                     MOVE *BLANKS   PBEN1                                               CGL020
     C                     MOVE *BLANKS   PBEN2                                               CGL020
     C                     MOVE *BLANKS   PBEN3                                               CGL020
     C                     MOVE *BLANKS   PBEN4                                               CGL020
     C                     MOVE *BLANKS   PBEN5                                               CGL020
     C                     MOVE *BLANKS   PBEN6                                               CGL020
     C                     MOVE *BLANKS   PAWB1                                               CGL020
     C                     MOVE *BLANKS   PAWB2                                               CGL020
     C                     MOVE *BLANKS   PAWB3                                               CGL020
     C                     MOVE *BLANKS   PAWB4                                               CGL020
     C                     MOVE *BLANKS   PAWB5                                               CGL020
     C                     MOVE *BLANKS   PAWBC                                               CGL020
     C                     MOVE *BLANKS   POCCY                                               CGL020
     C                     MOVE *BLANKS   PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Begin Parameter Selection                                                            CGL020
      ** =========================                                                            CGL020
      *                                                                                       CGL020
     C                     SELEC                                                              CGL020
      *                                                                                       CGL020
      ** Outgoing Payments                                                                    CGL020
      ** -----------------                                                                    CGL020
      *                                                                                       CGL020
     C           *IN01     WHEQ *ON                                                           CGL020
      *                                                                                       CGL020
      ** Use the MT100 Ordering Customer if it is available.                                  CGL020
      *                                                                                       CGL020
     C           ODMT      IFNE *BLANKS                                                       CGL020
     C                     MOVELODMT      POCUS1                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE ORC1      POCUS1                                              CGL020
     C                     MOVE ORC2      POCUS2                                              CGL020
     C                     MOVE ORC3      POCUS3                                              CGL020
     C                     MOVE ORC4      POCUS4                                              CGL020
     C                     MOVE ORC5      POCUS5                                              CFT032
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Use the bank details associated with the Ordering Bank Type                          CGL020
      ** if it is available.                                                                  CGL020
      *                                                                                       CGL020
     C           OPMSGR    IFGT 0                                                             CGL020
     C           OPORBT    ANDNE*BLANKS                                                       CGL020
     C                     MOVE OPORB1    POBNK1                                              CGL020
     C                     MOVE OPORB2    POBNK2                                              CGL020
     C                     MOVE OPORB3    POBNK3                                              CGL020
     C                     MOVE OPORB4    POBNK4                                              CGL020
     C                     MOVE OPORB5    POBNK5                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVELORBK      POBNK1                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE BNC1      PBEN1                                               CGL020
     C                     MOVE BNC2      PBEN2                                               CGL020
     C                     MOVE BNC3      PBEN3                                               CGL020
     C                     MOVE BNC4      PBEN4                                               CGL020
     C                     MOVE BNC5      PBEN5                                               CGL020
     C                     MOVE ACB1      PAWB1                                               CGL020
     C                     MOVE ACB2      PAWB2                                               CGL020
     C                     MOVE ACB3      PAWB3                                               CGL020
     C                     MOVE ACB4      PAWB4                                               CGL020
     C                     MOVE ACB5      PAWB5                                               CGL020
     C                     MOVE SMCY      POCCY                                               CGL020
     C                     MOVE PCCY      PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Incoming Payments                                                                    CGL020
      ** -----------------                                                                    CGL020
      *                                                                                       CGL020
     C           *IN02     WHEQ *ON                                                           CGL020
     C                     MOVE ORC1      POCUS1                                              CGL020
     C                     MOVE ORC2      POCUS2                                              CGL020
     C                     MOVE ORC3      POCUS3                                              CGL020
     C                     MOVE ORC4      POCUS4                                              CGL020
     C                     MOVE ORC5      POCUS5                                              CFT032
     C                     MOVE ORB1      POBNK1                                              CGL020
     C                     MOVE ORB2      POBNK2                                              CGL020
     C                     MOVE ORB3      POBNK3                                              CGL020
     C                     MOVE ORB4      POBNK4                                              CGL020
     C                     MOVE ORB5      POBNK5                                              CGL020
     C                     MOVE BNC1      PBEN1                                               CGL020
     C                     MOVE BNC2      PBEN2                                               CGL020
     C                     MOVE BNC3      PBEN3                                               CGL020
     C                     MOVE BNC4      PBEN4                                               CGL020
     C                     MOVE BNC5      PBEN5                                               CGL020
     C                     MOVELACBK      PAWB1                                               CGL020
     C                     MOVE SMCY      POCCY                                               CGL020
     C                     MOVE PCCY      PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Cheques for Collection                                                               CGL020
      ** ----------------------                                                               CGL020
      *                                                                                       CGL020
     C           *IN03     WHEQ *ON                                                           CGL020
     C           *IN04     OREQ *ON                                                           CGL020
     C                     MOVE COB1      POCUS1                                              CGL020
     C                     MOVE COB2      POCUS2                                              CGL020
     C                     MOVE COB3      POCUS3                                              CGL020
     C                     MOVE COB4      POCUS4                                              CGL020
     C                     MOVELRCCO      POBNK1                                              CGL020
     C                     MOVE SMCY      POCCY                                               CGL020
      *                                                                                       CGL020
      ** Add Credit Party data on non-header Cheques for Collection.                          CGL020
      *                                                                                       CGL020
     C           *IN04     IFEQ *ON                                                           CGL020
     C                     MOVELCRPY      PBEN1                                               CGL020
     C                     MOVE CRCY      PDCCY                                               CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Cheques to be Paid                                                                   CGL020
      ** ------------------                                                                   CGL020
      *                                                                                       CGL020
     C           *IN05     WHEQ *ON                                                           CGL020
     C           *IN06     OREQ *ON                                                           CGL020
     C                     MOVE RBK1      PBEN1                                               CGL020
     C                     MOVE RBK2      PBEN2                                               CGL020
     C                     MOVE RBK3      PBEN3                                               CGL020
     C                     MOVE RBK4      PBEN4                                               CGL020
     C                     MOVELSNCO      PBEN6                                               CGL020
     C                     MOVE ACB1      PAWB1                                               CGL020
     C                     MOVE ACB2      PAWB2                                               CGL020
     C                     MOVE ACB3      PAWB3                                               CGL020
     C                     MOVE ACB4      PAWB4                                               CGL020
     C                     MOVE ACB5      PAWB5                                               CGL020
     C                     MOVE PCCY      PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Add Debit Party data on non-header Cheques to be Paid.                               CGL020
      *                                                                                       CGL020
     C           *IN06     IFEQ *ON                                                           CGL020
     C                     MOVELDRPY      POCUS1                                              CGL020
     C                     MOVE DRCY      POCCY                                               CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Nostro Transfers                                                                     CGL020
      ** ----------------                                                                     CGL020
      *                                                                                       CGL020
     C           *IN07     WHEQ *ON                                                           CGL020
     C                     MOVELACBN      POCUS1                                              CGL020
     C                     MOVELDEST      PBEN1                                               CGL020
     C                     MOVELACBN      PAWB1                                               CGL020
     C                     MOVE CCY       POCCY                                               CGL020
     C                     MOVE CCY       PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Request for Transfer                                                                 CGL020
      ** --------------------                                                                 CGL020
      *                                                                                       CGL020
     C           *IN17     WHEQ *ON                                                           CGL020
      *                                                                                       CGL020
      ** Use the detail lines associated with the Header Ordering                             CGL020
      ** Customer Type if it is available.                                                    CGL020
      *                                                                                       CGL020
     C           CUSTTP    IFNE *BLANKS                                                       CGL020
     C                     MOVE HOCUS1    POCUS1                                              CGL020
     C                     MOVE HOCUS2    POCUS2                                              CGL020
     C                     MOVE HOCUS3    POCUS3                                              CGL020
     C                     MOVE HOCUS4    POCUS4                                              CGL020
     C                     MOVE HOCUS5    POCUS5                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE TOCUS1    POCUS1                                              CGL020
     C                     MOVE TOCUS2    POCUS2                                              CGL020
     C                     MOVE TOCUS3    POCUS3                                              CGL020
     C                     MOVE TOCUS4    POCUS4                                              CGL020
     C                     MOVE TOCUS5    POCUS5                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE TBNA35    PBEN1                                               CGL020
     C                     MOVE TBNB35    PBEN2                                               CGL020
     C                     MOVE TBNC35    PBEN3                                               CGL020
     C                     MOVE TBND35    PBEN4                                               CGL020
     C                     MOVE TBNE35    PBEN5                                               CGL020
     C                     MOVE TACA35    PAWB1                                               CGL020
     C                     MOVE TACB35    PAWB2                                               CGL020
     C                     MOVE TACC35    PAWB3                                               CGL020
     C                     MOVE TACD35    PAWB4                                               CGL020
     C                     MOVE TACE35    PAWB5                                               CGL020
     C                     MOVE TACA11    PAWBC                                               CGL020
     C                     MOVE TRNCCY    POCCY                                               CGL020
     C                     MOVE TRNCCY    PDCCY                                               CGL020
      *                                                                                       CGL020
      ** Customer Transfer                                                                    CGL020
      ** -----------------                                                                    CGL020
      *                                                                                       CGL020
     C           *IN18     WHEQ *ON                                                           CGL020
      *                                                                                       CGL020
      ** Use the detail lines associated with the Header Ordering                             CGL020
      ** Customer if it is available.                                                         CGL020
      *                                                                                       CGL020
     C           CUSTTH    IFNE *BLANKS                                                       CGL020
     C                     MOVE TOCUS1    POCUS1                                              CGL020
     C                     MOVE TOCUS2    POCUS2                                              CGL020
     C                     MOVE TOCUS3    POCUS3                                              CGL020
     C                     MOVE TOCUS4    POCUS4                                              CGL020
     C********** CSW207    IFEQ 'Y'                                                  CSW207 BUG15046
     C                     MOVE TOCUS5    POCUS5                                              CSW207
     C**********           ENDIF                                                     CSW207 BUG15046
     C                     ELSE                                                               CGL020
     C                     MOVE ORDCU1    POCUS1                                              CGL020
     C                     MOVE ORDCU2    POCUS2                                              CGL020
     C                     MOVE ORDCU3    POCUS3                                              CGL020
     C                     MOVE ORDCU4    POCUS4                                              CGL020
     C********** CSW207    IFEQ 'Y'                                                  CSW207 BUG15046
     C                     MOVE ORDCU5    POCUS5                                              CSW207
     C**********           ENDIF                                                     CSW207 BUG15046
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE ORDI35    POBNK1                                              CGL020
     C                     MOVE ORDI11    POBNKC                                              CGL020
     C                     MOVE BENF1     PBEN1                                               CGL020
     C                     MOVE BENF2     PBEN2                                               CGL020
     C                     MOVE BENF3     PBEN3                                               CGL020
     C                     MOVE BENF4     PBEN4                                               CGL020
     C                     MOVE BENF5     PBEN5                                               CGL020
     C                     MOVE ACCI35    PAWB1                                               CGL020
     C                     MOVE ACCI11    PAWBC                                               CGL020
     C                     MOVE PAYCCY    POCCY                                               CGL020
     C                     MOVE PAYCCY    PDCCY                                               CGL020
      *                                                                                       CGL020
     C                     ENDSL                                                              CGL020
      *                                                                                       CGL020
      ** End Parameter Selection                                                              CGL020
      ** =======================                                                              CGL020
      *                                                                                       CGL020
      ** Call the Funds Transfer Settlement Fields Extractor.                                 CGL020
      *                                                                                       CGL020
     C                     CALL SETFT                                                         CGL020
     C                     PARM           POCUS1 35                                           CGL020
     C                     PARM           POCUS2 35                                           CGL020
     C                     PARM           POCUS3 35                                           CGL020
     C                     PARM           POCUS4 35                                           CGL020
     C                     PARM           POCUS5 35                                           CGL020
     C                     PARM           POBNK1 35                                           CGL020
     C                     PARM           POBNK2 35                                           CGL020
     C                     PARM           POBNK3 35                                           CGL020
     C                     PARM           POBNK4 35                                           CGL020
     C                     PARM           POBNK5 35                                           CGL020
     C                     PARM           POBNKC 11                                           CGL020
     C                     PARM           PBEN1  35                                           CGL020
     C                     PARM           PBEN2  35                                           CGL020
     C                     PARM           PBEN3  35                                           CGL020
     C                     PARM           PBEN4  35                                           CGL020
     C                     PARM           PBEN5  35                                           CGL020
     C                     PARM           PBEN6  35                                           CGL020
     C                     PARM           PAWB1  35                                           CGL020
     C                     PARM           PAWB2  35                                           CGL020
     C                     PARM           PAWB3  35                                           CGL020
     C                     PARM           PAWB4  35                                           CGL020
     C                     PARM           PAWB5  35                                           CGL020
     C                     PARM           PAWBC  35                                           CGL020
     C                     PARM           POCCY   3                                           CGL020
     C                     PARM           PDCCY   3                                           CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0210CCPG                                           S01408
     C*                                                                   S01408
     C/EJECT
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** POWER
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** FILES
OTPAYDD
INPAYDD
CQCODDD
CQCOCDD
CQPACDD
CQPADDD
NTRANDD
RFTHDR                                                                    CFT006
CCTHDR                                                                    CFT008
**   ARR  - TRANSACTION TYPE                                              S01117
OUTWARD PAYMENTS
INWARD PAYMENTS
CHEQUES TO BE COLLECTED
CHEQUES TO BE PAID
NOSTRO TRANSFERS
REQUEST FOR TRANSFERS                                                     CFT006
CUSTOMER CREDIT TRANSFERS                                                 CFT006
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
