     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Entry generation')                            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FUNDS TRANSFER MODULE                                *
     F*                                                               *
     F*  FT0220  -  FUNDS TRANSFER ENTRY GENERATION                   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD035693           Date 16Nov15               *
      *                 CFT156             Date 15Aug14               *
      *                 MD026327           Date 19Aug14               *
      *                 MD024499           Date 23Jan14               *
      *                 CRE098             Date 02Dec13               *
      *                 AR1091525          Date 27Feb13               *
      *                 AR988246           Date 04Dec12               *
      *                 CER049             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG22979B          Date 26Mar09               *
      *                 BUG22979A          Date 12Mar09               *
      *                 BUG23215           Date 09Mar09               *
      *                 BUG22939A          Date 05Mar09               *
      *                 BUG22979           Date 18Feb09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
     F*                 239272             Date 20Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
     F*                 240899             Date 05Jul06               *
     F*                 240887             Date 04Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 190237             Date 07Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187496             Date 04Apr01               *
     F*                 164066             Date 31Jan01               *
     F*                 092655             DATE 29Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU013             Date 24Apr98               *
      *                 S01408             Date 28Jan98               *
     F*                  108635            DATE  22SEP97              *
     F*                 S01408             DATE 15OCT96               *
     F*                 S01408             DATE 30SEP96               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 S01408             DATE 25JUL96               *
     F*                 S01408             DATE 20JUN96               *
     F*                 S01408             DATE 16APR96               *
     F*                 S01408             DATE 06MAR96               *
     F*                 S01408             DATE 10NOV95               *
     F*                 088034             DATE 18MAY95               *
     F*                  086125             DATE  16MAR95             *
     F*                  S01522             DATE  25JAN95             *
     F*                  066886             DATE  03FEB94             *
     F*                  058846             DATE  07SEP93             *
     F*                  047369             DATE  10JAN94             *
     F*                  056031             DATE  07JUN93             *
     F*                  045178             DATE  13MAY93             *
     F*                  S01414             DATE  13APR93             *   S01414
     F*                  051400             DATE  01MAR93             *
     F*                  044670             DATE  17SEP92             *
     F*                  050925             DATE  29MAY92             *
     F*                  033607             DATE  14NOV90             *
     F*                  S10736             DATE  03SEP92             *   E29835
     F*                  E25537             DATE  03APR92             *   E29835
     F*                  E29835             DATE  20NOV90             *   E29835
     F*                  S01117             DATE  19OCT90             *   S01117
     F*                  S01194             DATE  19OCT90             *   S01194
     F*                  E22511             DATE  03AUG90             *   E22511
     F*                  E21456             DATE  08MAY90             *   E21456
     F*                  S01182             DATE  18NOV89             *   S01182
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  MD035693 - Wrong setup of WMACC                              *
      *  CFT156 - Enhancement to the posting narrative on FT transact *
      *  MD026327 - Narratives in FT posting are changed.             *
      *           - Custom Discard change AR1091525 to avoid Recon.   *
      *  MD024499 - Incorrect trans type used for account postings    *
      *             Added check to CGL013 aside from CRE098 & CER030  *
      *  CRE098 - User-Defined Retail Transaction Types on Postings   *
      *  AR1091525 - Change length of RLPR workfield to avoid         *
      *              truncating PREF value in PNAR                    *
      *              (Applied GEMS 194405)                            *
      *            - Child: AR1091526                                 *
      *  AR988246 - The BF APOST file does not generate account keys  *
      *             for the lending module.                           *
      *             Populate account keys is conditioned by CGL020    *
      *             switch. Omit the condition. (Child: AR988247)     *
      *  CER049 - Stamp Tax                                           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG22979B - Wrong extended narratives output in MT940        *
      *  BUG22979A - Wrong extended narratives output in MT940        *
      *  BUG23215 - Wrong Transaction Type on postings                *
      *  BUG22939A - Check the value of Original Currency and Original*
      *              amount before writing to Funds Transfer Posting  *
      *              Extension file                                   *
      *  BUG22979 - Wrong Extended Narratives output in MT940         *
      *  239272 - FTC0220 failed. Fix is to validate BKMABR only when *
      *           BKIEMB is 'Y'. BKMABR may be blank when BKIEMB = N. *
      *  240899 - Include Releted Payment Reference into narratives.  *
      *           if system value FTPostRelPayRef is Y                *
      *  240887 - Show cheque sequence number on posting narrative if *
      *           system value FTPostNarrChequeSeq is Y               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
      *  190237 - Generate interbranch postings for main branch when  *
      *           booking and settle branch is not equal to main      *
      *           branch.
      *           Fix 164066 can be removed here if it will not       *
      *           affect any of the postings generated.               *
      *  187496 - For Fund Transfer Imbalance, Original Transaction   *
      *           Reference, Type, Sub-type and Book Code are         *
      *           populated by the previous record read. Initialise   *
      *           the said fields correctly.                          *
     F*  164066 - Amended program to return BICN to its original      *
     F*           value of branch internal customer of the transac-   *
     F*           tion's booking branch. Applied fixes 139282 and     *
     F*           136887.                                             *
     F*  092655 - GLC33 attempted to write record to ACCNTAB with     *
     F*           duplicate retail account number, because GL account *
     F*           opened by the system for an FT posting with details *
     F*           from the previous retail account processed. Fix is  *
     F*           to initialise ACNO and RRNM correctly.              *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
     F*  CEU013 - EMU Account Postings Narrative                      *
     F*  S01408 - Hook FT0220E001 moved to correct position in DBA2   *
     F*  108635 - Fix copied from GEMS 67360 in FT0210 with           *
     F*              slight amendment - as audit report was output    *
     F*              on 1st cycle, P1 records need a different        *
     F*              sequence number passed.                          *
     F*              As this pgm outputs can write more than one P1   *
     F*              report for a branch, ensure that a new record is *
     F*              written to FCSFNOPD for second and subsequent    *
     F*              reports for a branch.                            *
     F*  S01408 - Addition of core hook FT0220CP12                    *
     F*           Addition of core hook FT0220CP11                    *
     F*  S01408 - Addition of core hook FT0220CP10                    *
     F*           Addition of core hook FT0220IIP2                    *
     F*  S01408 - Core hook FT0220CCP9  added                         *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Use the account profit centre as the transaction    *
     F*           profit centre of any postings to a retail or nostro *
     F*           account.                                            *
     F*  S01408 - Core hook FT0220OOP2  added                         *
     F*  S01408 - Core hook FT0220CCP8  added                         *
     F*           Core hook FT0220OOP1  added                         *
     F*  S01408 - Core hook FT0220CCP6  added                         *
     F*           Core hook FT0220CCP7  added                         *
     F*  S01408 - Core hook FT0220CCP4  added                         *
     F*           Core hook FT0220CCP5  added                         *
     F*  S01408 - Core hook FT0220CCP1  added                         *
     F*           Core hook FT0220CCP2  added                         *
     F*           Core hook FT0220CCP3  added                         *
     F*           Core hook FT0220FFP1  added                         *
     F*           Core hook FT0220IIP1  added                         *
     F*     088034 - Add extra message GB01001 for 01 posting ref     *
     F*     086125 - Add new parameter to AOPNARR0                    *
     F*     S01522 - Call to AOPNARR0 if switchable feature installed *
     F*              and UDC present                                  *
     F*     066886 - Monitor for printer file overflow on detail      *
     F*              report.                                          *
     F*     058846 - Posting Record Indicator (PRIN) : set bit 0 on   *
     F*              to indicate settlement over retail account.      *
     F*     047369 - Alpha narrative codes - changed pgm back to use  *
     F*              ACKEY as this has been amended to cater for      *
     F*              alpha narr codes - amendment to 033607.          *
     F*     056031 - Add parameter to program.                        *
     F*              If parameter is S then change posting date to    *
     F*              nearest working day in local currency            *
     F*              Combination of 045014, 042779                    *
     F*     045178 - If an account is blocked, direct all entries to  *
     F*              Suspense account.                                *
     F*     S01414 - Book Code and Profit Centre Incorporation.       *
     F*     051400 - The Associated customer number is missing from   *
     F*              the Income and Expense posting record for F.T.   *
     F*              postings.                                        *
     F*     044670 - Imbalance posting on suspense account : Retail   *
     F*              account number of last account processed is      *
     F*              placed on the posting. So, if the system has to  *
     F*              open the account there is a problem of duplicate *
     F*              key for the file ACNUMA (key ACNO).              *
     F*     050925 - Only output transaction type 93000 to retail a/c *
     F*              postings, all others should be 00000. Completes  *
     F*              error fix E21456                                 *
     F*     033607 - AMENDED FOR USE OF ALPHA NARRATIVE CODES         *
     F*     S10736 - MANAGEMENT ACCOUNTING.                           *
     F*     E25537 - ACNO, RRNM and RIND set up incorrectly for some  *
     F*              interbranch postings.                            *
     F*              ** THIS ERROR RELATES TO 034056 IN R3 WHICH IS ***
     F*            - Interbranch postings are assumed to be non-retail*
     F*            - Retail account number of last account processed  *
     F*              is placed on the posting for interbranch         *
     F*              postings. This can cause the system to fail in   *
     F*              the account post phase if the account is to be   *
     F*              opened by the system.                            *
     F*     E29835 - MOVE ATYPTB INSTEAD OF ATYPAC INTO SUSTYP        *   E29835
     F*     S01117 - CHANGES FOR MULTIBRANCHING                       *   S01117
     F*     S01194 - NEW DATABASE ERROR HANDLING                      *   S01194
     F*     E22511 - THE INTERBRANCH NARRATIVE OVERWRITES THE         *   E22511
     F*              PAYMENT REFERENCE FOR INTERBRANCH MOVEMENTS.     *   E22511
     F*     E21456 - TRANSACTION TYPE SHOULD BE 93000                 *   E21456
     F*     S01182 - Amendment to maintain the new account postings   *
     F*              fields on the generated entries file for the     *
     F*              MIS enhancements.                                *
     F*****************************************************************
     FFPKEY   IP  E           K        DISK
     FFPKEYZZ IS  E           K        DISK
     FTABFP   IF  E           K        DISK
     F            TABTG20F                          KIGNORE
     F************TABLETJF                          KIGNORE               S01117
     F            TABLET5F                          KIGNORE
     F            TABLETHF                          KIGNORE
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F/COPY WNCPYSRC,FT0220F003
     F*ACKEY***IF**E***********K********DISK                              033607
     F*ACKEYL2*IF**E***********K********DISK                        033607047369
     FACKEY   IF  E           K        DISK                               047369
     F            ACKEYAKF                          KIGNORE
     F/COPY WNCPYSRC,FT0220F001
     F***GEFPPD* O   E           K        DISK                      A                         CGL020
     FGEFPPD  UF  E           K        DISK                      A                            CGL020
     F            APOSTPDF                          KRENAMEGEFPPDF
     FGEFPZZ  UF  E                    DISK                      A
     F            APOSTZZF                          KRENAMEGEFPZZF
     FGLAPNAPDUF  E           K        DISK                      A        CEU013
     F*  Account Postings Next Available Number file                      CEU013
     F*                                                                   CEU013
     FGEFP1APDO   E           K        DISK                               CEU013
     F*  Funds Transfer Posting Extension file                            CEU013
     F*                                                                   CEU013
     F*                                                                   S01408
     F/COPY WNCPYSRC,FT0220FFP1                                           S01408
      *                                                                                       CFT156
     FOTPAY   IF  E           K        DISK                           UC                      CFT156
     F* Outgoing payment file                                                                 CFT156
      *                                                                                       CFT156
     FINPAY   IF  E           K        DISK                           UC                      CFT156
     F* Incoming payment file                                                                 CFT156
     F*                                                                   S01408
     F*FT0220P2O***E********************PRINTER                           S01117
     F*FT0220P1O***E********************PRINTER                           S01117
     FFT0220AUO   E                    PRINTER      KINFDS SPOOLU         S01117
     FFT0220P1O   E                    PRINTER      KINFDS SPOOL1     UC  S01117
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*                                                                  *
     F*       20      FIRST CYCLE CALC'S
     F*       21      RECORD FOUND ON FPKEYDD                             S01117
     F*       29      POSTING TO SUSPENSE A/C                            *045178
     F*       30      CONDITION READ OF BRANCH CODES
     F*       35      TEST LOOK-UP OF BRANCH ARRAY
     F*       39      IMBALANCE IS CREDIT
     F*     40/43     DECIMAL POSITION'S FOR OUTPUT
     F*       50      VALID CURRENCY                                     *
     F*       55      MULTIBRANCHING INDICATOR                            S01117
     F*       61      ERROR ON TRAILER 'FPKEYZZ'                         *
     F*       62      INDICATES FIRST RECORD READ FROM FPKEYDD FILE       S01117
     F*       66      CHAIN FAIL 'ACCNT'
     F*       67      A/c code is a Spot Trade Equivalent A/c code        CAC001
     F*       72      OVERFLOW, PRINT HEADINGS
     F*       83      Database Error GLAPNAPD                             CEU013
     F*      90/99    STANDARD SUBROUTINE INDICATORS                     *
     F*       U4      MISSING ACCOUNT KEYS
     F*      U7/U8    ERROR INDICATORS
     F*                                                                  *
     F********************************************************************
     F/COPY WNCPYSRC,FT0220F002
     E                    CPY@    1   1 80
     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    NAR     1   3 24               NARRATIVE
     E                    CCYA      150  3   CCYDT  37   * CURRENCY CODES
     E                    CDPA      150  1 0             * CCY DEC. PLACES
     E**********          TACA      150  4 0             * TRADE EQ. A/C  CAC001              CGL029
     E                    TACA      150 10 0             * TRADE EQ. A/C  CAC001              CGL029
     E**********          ACD         6  4 0             A/C CODES                            CGL029
     E                    ACD         6 10 0             A/C CODES                            CGL029
     E******************* NCD         6  2 0             NARR. CODES      033607
     E                    NCD         6  2               NARR. CODES      033607
     E                    PRF         6  1 0
     E                    ASQ         6  2               SEQUENCE NUMBERS                     CER049
     E                    DC          6  2               DR. OR CR.
     E                    CTI#        2 15 0             INTEGER HASH TOTAL
     E                    CTD#        2  3 0             DECIMAL HASH TOTAL
     E                    CTN#        2  5 0             RECORDS HASH TOTAL
     E********************BRN       999  3 0             OCCURRENCE INDEX S01117
     E                    BRN       999  3               OCCURRENCE INDEX S01117
     E/COPY WNCPYSRC,FT0220E001                                           S01408
     I/EJECT
     I/COPY WNCPYSRC,FT0220I004
      *                                                                                       CFT156
     IOTPAYDDF    01                                                                          CFT156
     I              RECI                            RECI27                                    CFT156
     I              BRCA                            BRCA27                                    CFT156
     I              PRIN                            PRIN27                                    CFT156
     I              PRFC                            PRFC27                                    CFT156
     I              PREF                            PREF27                                    CFT156
     I              BOKC                            BOKC27                                    CFT156
     I              ORBR                            ORBR27                                    CFT156
      *                                                                                       CFT156
     IINPAYDDF    01                                                                          CFT156
     I              RECI                            RECI27                                    CFT156
     I              BRCA                            BRCA27                                    CFT156
     I              PRFC                            PRFC27                                    CFT156
     I              PREF                            PREF27                                    CFT156
     I              BOKC                            BOKC27                                    CFT156
     I              ORBR                            ORBR27                                    CFT156
      *                                                                                       CFT156
     IFPKEYDDF
     I              RECI                            RECIFP
     I              BRCA                            BRCAFP                S01117
     **C*PY*WN*PY*RC*FT0220E001                                           S01408
     I***
     IFPKEYZZF
     I              RECI                            RECIFP
     I***
     I/EJECT
     IACCNTABF
     I              RECI                            RECIAC
     I              ATYP                            ATYPAC
     I**************BRCD                            BRCDAC                S01117
     I              BRCA                            BRCAAC                S01117
     I              PRFC                            PRFCAC                S01414
     I***
     I/EJECT
     IACKEYALF
     I              RECI                            RECIAK
     I              AKEY                            EXAKEY                CDL038
     I***
     I/EJECT
     ITABTB10F
     I***
     I***   SD FILE DETAIL  - PF/TABTB10 - ICD 1
     I***
     I              RECI                            RECITB
     ITABTB20F
     I***
     I***   SD FILE DETAIL  - PF/TABTB20 - ICD3
     I***
     I              RECI                            RECITB
     I***
     I/EJECT
     ITABLETRF
     I***
     I***   SD FILE DETAIL  - PF/TABLETR - BRANCH CODES
     I***
     I              RECI                            RECITB
     I***
     ITABLETPF
     I***
     I***   SD FILE DETAIL  - PF/TABLETP - NARRATIVE CODES
     I***
     I              RECI                            RECITB
     I              RTTY                            RTTYTB                                  BUG23215
     I/EJECT
     I***TABTE10F                                                                             CGL029
     I***
     I***   SD FILE DETAIL  - PF/TABLETE - ACCOUNT CODES 1
     I***
     I**********    RECI                            RECITB                                    CGL029
     I**********    ATYP                            ATYPTB                                    CGL029
     I**********    ACCS                            ACSCTB                             S10736 CGL029
     I/COPY WNCPYSRC,FT0220I009
     I***
     ITABTG10F
     I***
     I***   SD FILE DETAIL  - PF/TABTG10 - CURRENCIES
     I***
     I              RECI                            RECITB
      * This Output field was renamed because it conflicts with a record format               CGL020
     IGEFPPDF                                                                                 CGL020
     I              ACKEY                           GEFKEY                                    CGL020
     I/COPY WNCPYSRC,FT0220I001
     I/EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     IDLDA        DS                            256
     I***
     I***   LOCAL DATA AREA  -  DATABASE ERRORS
     I***
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     ISPOOL1      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I* SHORT DATA STRUCTURE FOR ACCESS PROGRAMS                          S01117
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01522
     I* LONG DATA STRUCTURE FOR ACCESS PROGRAMS                           S01522
     I*                                                                   S01522
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I* EXTERNAL DS FOR SDBRCHPD DETAILS                                  S01117
     I*                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              S01522
     I* Module Details Accessed via access program                        S01522
     I*                                                                   S01522
     ISDPCAC    E DSSDPCACPD                                              CAC001
     I* Profit Centre Accounting ICD Details                              CAC001
     I*                                                                   CAC001
     ISDPRFC    E DSSDPRFCPD                                              CAC001
     I* Profit Centre Details                                             CAC001
     I*                                                                   CAC001
     ISCSARD    E DSSCSARDPD                                              S01522
     I* SAR file details accessed via access program AOSARDR0             S01522
     I*                                                                   S01522
      *                                                                                     BUG22979
      ** External data structure for Narrative Codes Details                                BUG22979
      *                                                                                     BUG22979
     ISDNARR    E DSSDNARRPD                                                                BUG22979
      *                                                                                     BUG22979
     ICGPNAR    E DSCGPNARPD                                              S01522
     I* UDC Multi Language Narrative data structure                       S01522
     I*                                                                   S01522
     I/COPY WNCPYSRC,FT0220I007
     I##PRM1      DS                                                      086125
      **  Data Structure for Customer and Branch                          086125
      *                                                                   086125
     I                                        1   6 A#CUST                086125
     I                                        7   9 A#BRCA                086125
      *                                                                   086125
     ISDCUST    E DSSDCUSTPD                                              S01522
     I              QQDFAC                          QQDFA1                                    CGL029
      **  Customer Details                                                S01522
      *                                                                   S01522
     ISDGELR    E DSSDGELRPD                                              190237
     I              QQACCD                          QQACC1                                    CGL029
      **  General Ledger Details                                          190237
      *                                                                   190237
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I              QQFNIC                          QQFNI1                                    CGL029
     I              QQFNAA                          QQFNA1                                    CGL029
     I              QQACCD                          QQACC2                                    CGL029
      **  Account Code Details                                                                CGL029
     I/COPY WNCPYSRC,FT0220I005
     I***
     I***   DATA STRUCTURE TO SUB DIVIDE TABLE KEY FIELD - TABTG10
     I***
     I            DS                             12
     I                                        1  12 KEY
     I                                        1   2 RECTTB
     I                                        9  11 CCYTB
     I***************************************10  120BRNCH                 S01117
     I                                       10  12 BRNCH                 S01117
     I                                       12  12 SRECTB
     I***
     I***   DATA STRUCTURE TO STORE ACCNT FIELDS FOR OUTPUT TO GEFPD
     I***
     I**********  DS                             36                                           CGL029
     I**********                              1  15 STORE1                                    CGL029
     I            DS                             48                                           CGL029
     I                                        1  21 STORE1                                    CGL029
     I                                        1   6 CNUM1
     I                                        7   9 CCY1
     I**********                             10  13 ACOD1                                     CGL029
     I**********                             14  15 ACSQ1                                     CGL029
     I                                       10  19 ACOD1                                     CGL029
     I                                       20  21 ACSQ1                                     CGL029
     I***
     I**********                             16  18 BRCD1                                     CGL029
     I                                       22  24 BRCD1                                     CGL029
     I***
     I**********                             19  33 STORE2                                    CGL029
     I**********                             19  24 CNUM2                                     CGL029
     I**********                             25  27 CCY2                                      CGL029
     I**********                             28  31 ACOD2                                     CGL029
     I**********                             32  33 ACSQ2                                     CGL029
     I                                       25  45 STORE2                                    CGL029
     I                                       25  30 CNUM2                                     CGL029
     I                                       31  33 CCY2                                      CGL029
     I                                       34  43 ACOD2                                     CGL029
     I                                       44  45 ACSQ2                                     CGL029
     I***
     I**********                             34  36 BRCD2                                     CGL029
     I                                       46  48 BRCD2                                     CGL029
      *                                                                   190237
     I**********  DS                             36                                    190237 CGL029
     I**********                              1  15 STORE3                             190237 CGL029
     I            DS                             48                                           CGL029
     I                                        1  21 STORE3                                    CGL029
     I                                        1   6 CNUM3                 190237
     I                                        7   9 CCY3                  190237
     I**********                             10  13 ACOD3                              190237 CGL029
     I**********                             14  15 ACSQ3                              190237 CGL029
     I**********                             16  18 BRCD3                              190237 CGL029
     I                                       10  19 ACOD3                                     CGL029
     I                                       20  21 ACSQ3                                     CGL029
     I                                       22  24 BRCD3                                     CGL029
      *                                                                   190237
     I**********                             19  33 STORE4                             190237 CGL029
     I**********                             19  24 CNUM4                              190237 CGL029
     I**********                             25  27 CCY4                               190237 CGL029
     I**********                             28  31 ACOD4                              190237 CGL029
     I**********                             32  33 ACSQ4                              190237 CGL029
     I**********                             34  36 BRCD4                              190237 CGL029
     I                                       25  45 STORE4                                    CGL029
     I                                       25  30 CNUM4                                     CGL029
     I                                       31  33 CCY4                                      CGL029
     I                                       34  43 ACOD4                                     CGL029
     I                                       44  45 ACSQ4                                     CGL029
     I                                       46  48 BRCD4                                     CGL029
     I***
     I***   DATA STRUCTURE TO EXTRACT 'FRST2'
     I***
     I            DS                             15
     I                                        1  14 EXAKEY                CDL038
     I**********                              1  10 AKEY                                      CER049
     I                                        1  14 AKEY                                      CER049
     I                                        1   2 FRST2
     I                                        4   5 FTST                  S10736
     I                                       10  10 WMACC                                   MD035693
     I/COPY WNCPYSRC,FT0220I006
     I***
     I***   DATA STRUCTURE TO HOLD BRANCH CODE DETAILS
     I***
     ICHGBC       DS                        999
     I                                        1  150BALSUS
     I**********                             16  210BRBICN                                    CSD027
     I                                       16  21 BRBICN                                    CSD027
     I***************************************22  240BRBRCD                S01117
     I                                       22  24 BRBRCD                S01117
     I***
     I***   DATA STRUCTURE TO BUILD UP 'ACCOUNT IDENTIFIER'
     I***
     I**********  DS                             15                                           CGL029
     I            DS                             21                                           CGL029
     I**********                              1   60BICN                                      CSD027
     I                                        1   6 BICN                                      CSD027
     I                                        7   9 ECCY
     I**********                             14  150SEQ01                                     CGL029
     I                                       20  210SEQ01                                     CGL029
     I*
     I**********                             10  13 ACCOD                                     CGL029
     I**********                             10  13 ACCOD1                                    CGL029
     I**********                             10  13 ACCOD2                                    CGL029
     I**********                             10  13 ACCOD3                                    CGL029
     I                                       10  19 ACCOD                                     CGL029
     I                                       10  19 ACCOD1                                    CGL029
     I                                       10  19 ACCOD2                                    CGL029
     I                                       10  19 ACCOD3                                    CGL029
     I/COPY WNCPYSRC,FT0220I008
     I*
     I**********                              1  15 ACCID1                                    CGL029
     I**********                              1  15 ACCID3                                    CGL029
     I                                        1  21 ACCID1                                    CGL029
     I                                        1  21 ACCID3                                    CGL029
     I/EJECT
     I***
     I***   DATA STRUCTURE TO BREAK UP 'ACCOUNT IDENTIFIER' FOR 'KLIST'
     I***
     I************DS**************************   15                       S01117
     I****************************************1  15 ACCID                 S01117
     I**********  DS                             18                                    S01117 CGL029
     I**********                              1  18 ACCID                              S01117 CGL029
     I            DS                             24                                           CGL029
     I                                        1  24 ACCID                                     CGL029
     I**********                              1   60KCNUM                                     CSD027
     I                                        1   6 KCNUM                                     CSD027
     I                                        7   9 KCCY
     I**********                             10  130KACOD                                     CGL029
     I**********                             14  150KACSQ                                     CGL029
     I**********                             16  18 KBRCA                              S01117 CGL029
     I                                       10  190KACOD                                     CGL029
     I                                       20  210KACSQ                                     CGL029
     I                                       22  24 KBRCA                                     CGL029
     I/EJECT
     I***
     I***   DATA STRUCTURE TO BUILD UP 'NARR1'
     I***
     I            DS                             17
     I                                        1  17 NARR1
     I                                        1  15 PREF
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0220IIP2                                           S01408
     I*                                                                   S01408
     I                                       16  170CQSQO
     I            DS                              4
     I                                        1   4 MFLD1
     I                                        1   20LGWORK
     I                                        3   4 MFLD2
     I/COPY WNCPYSRC,FT0220I002
     I***
     I***   DATA STRUCTURE TO BUILD UP ARRAYS
     I***
     I**********  DS                             42                                           CGL029
     I**********                              1   40ACD1                                      CGL029
     I**********                              5   80ACD2                                      CGL029
     I**********                              9  120ACD3                                      CGL029
     I**********                             13  160ACD4                                      CGL029
     I**********                             17  200ACD5                                      CGL029
     I**********                             21  240ACD6                                      CGL029
     I**********                              1  240ACD                                       CGL029
     I*
     I**********                             25  260NCD1                  033607
     I**********                             27  280NCD2                  033607
     I**********                             29  300NCD3                  033607
     I**********                             31  320NCD4                  033607
     I**********                             33  340NCD5                  033607
     I**********                             35  360NCD6                  033607
     I**********                             25  360NCD                   033607
     I*                                                                   033607
     I            DS                                                                          CGL029
     I                                        1  24 ACDQQ                                     CGL029
     I                                       25  26 NCD1                  033607
     I                                       27  28 NCD2                  033607
     I                                       29  30 NCD3                  033607
     I                                       31  32 NCD4                  033607
     I                                       33  34 NCD5                  033607
     I                                       35  36 NCD6                  033607
     I                                       25  36 NCD                   033607
     I*
     I                                       37  370PRF1
     I                                       38  380PRF2
     I                                       39  390PRF3
     I                                       40  400PRF4
     I                                       41  410PRF5
     I                                       42  420PRF6
     I                                       37  420PRF
      *                                                                                       CER049
     I                                       43  44 ASQ1                                      CER049
     I                                       45  46 ASQ2                                      CER049
     I                                       47  48 ASQ3                                      CER049
     I                                       49  50 ASQ4                                      CER049
     I                                       51  52 ASQ5                                      CER049
     I                                       53  54 ASQ6                                      CER049
     I                                       43  54 ASQ                                       CER049
      *                                                                                       CGL029
      ** New Account Codes                                                                    CGL029
      *                                                                                       CGL029
     I            DS                                                                          CGL029
     I                                        1  100ACD1                                      CGL029
     I                                       11  200ACD2                                      CGL029
     I                                       21  300ACD3                                      CGL029
     I                                       31  400ACD4                                      CGL029
     I                                       41  500ACD5                                      CGL029
     I                                       51  600ACD6                                      CGL029
     I                                        1  600ACD                                       CGL029
     I/COPY WNCPYSRC,FT0220I003
     I*
     I***                                                                 E22511
     I***   DATA STRUCTURE FOR INTERBRANCH NARRATIVE                      E22511
     I***                                                                 E22511
     I            DS                             72                       E22511
     I                                        1  72 NAR                   E22511
     I                                       49  62 NAR14                 E22511
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0220IIP1                                           S01408
     I*                                                                   S01408
     ISVAL1       DS                            200                                           240887
     I                                        1   1 SVAL11                                    240887
     ISVAL2       DS                            200                                           240899
     I                                        1   1 SVAL21                                    240899
     ISVAL3       DS                            200                                           CFT156
     I                                        1   2 SVAL32                                    CFT156
      ** DS for AOSVALR0                                                                      240887
      *                                                                                       240887
     I              'FTPostNarrChequeSeq' C         SVALKA                                    240887
     I              'FTPostRelPayRef    ' C         SVALKB                                    240899
     I              'FTRelRefNarrCode   ' C         SVALKC                                    CFT156
     I/COPY WNCPYSRC,FTH00398
     I/EJECT
     C                     MOVEACPY@      BIS@   80
      *                                                                   056031
     C/COPY WNCPYSRC,FT0220C011
      *  Add parameter list                                               056031
      *                                                                   056031
     C           *ENTRY    PLIST                                          056031
     C                     PARM           P0MODE  1                       056031
      *                                                                                       CGL020
     C           *INLR     IFEQ '1'                                                           CGL020
     C           *INLR     ANDEQ'0'                                                           CGL020
     C                     READ GEFPPDF                  LR                                   CGL020
     C                     UPDATGEFPPDF                                                       CGL020
     C                     ENDIF                                                              CGL020
     C********************************************************************
     C***
     C***    KLIST FOR KEY TO  - PF/ACCNTAB
     C***
     C           ACCKEY    KLIST
     C                     KFLD           KCNUM
     C                     KFLD           KCCY
     C                     KFLD           KACOD
     C                     KFLD           KACSQ
     C                     KFLD           KBRCA                           S01117
     C*
     C********************************************************************
     C***
     C***    F I R S T   C Y C L E    C A L C ' S
     C***
     C********************************************************************
     C           *IN20     IFEQ '0'                        ### B001
     C/COPY WNCPYSRC,FT0220C021
     C                     SETON                     20
     C                     Z-ADD0         VOIN                            S10736
     C                     Z-ADD235959    PTIM                            S10736
     C*                                                                   S01117
     C* CALL ZSFILE TO LOG SPOOL FILE DETAILS                             S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUM                           S01117
     C                     MOVELSFILEU    ZSNAM                           S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           ZSEQ    5                       S01117
     C                     PARM *BLANKS   ZENT    3                       S01117
     C                     PARM           ZSNAM  10                       S01117
     C                     PARM           ZSNUM   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0220'  DBPGM            ***************S01117
     C                     MOVEL'FT0220AU'DBKEY            ** DBERR  14 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD14        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP2                                           S01408
     C*                                                                   S01408
     C* TABTB11 ****
     C                     MOVEL'01    '  ZTABKY
     C                     MOVE '    11'  ZTABKY
     C**
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C*
     C           *IN99     IFEQ '1'                        ### B002
     C           RECI      ORNE 'D'
     C                     MOVE 'TABLE'   WBFILE  5        ***************
     C                     MOVELZTABKY    WBKEY  28        ** DBERR  13 **
     C                     Z-ADD13        WBASE   20       ***************
     C                     EXSR ABORT
     C                     END                             ### E002
     C*                                                                   S01117
     C** SETON MULTIBRANCHING INDICATOR                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     55                   S01117
     C                     END                                            S01117
     C* TABTB10 ****
     C                     MOVEL'01    '  ZTABKY 12
     C                     MOVE '    10'  ZTABKY
     C**
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C*
     C           *IN99     IFEQ '1'                        ### B002
     C           RECITB    ORNE 'D'
     C                     MOVE 'TABLE'   WBFILE  5        ***************
     C                     MOVELZTABKY    WBKEY  28        ** DBERR  01 **
     C                     Z-ADD01        WBASE   20       ***************
     C                     EXSR ABORT
     C                     END                             ### E002
     C*
     C*********************Z-ADD1         PPAGE            'SET PAGE=1    S01117
     C*********************WRITEP1HEAD                     'HEADINGS      S01117
     C*
     C           DATF      COMP 'M'                      98 'DATE
     C**                                                    'FORMAT
     C**   BUILD UP CURRENCIES/DEC. POSITIONS ARRAYS
     C**
     C                     MOVEL'20    '  ZTABKY
     C                     MOVE '      '  ZTABKY
     C                     Z-ADD1         Z       30
     C* TABTG10 ***
     C           ZTABKY    SETLLTABFP
     C*
     C           *IN89     DOWEQ'0'                        ### B002
     C                     READ TABFP                    89
     C           RECITB    IFEQ 'D'                        ### B003
     C           RECTTB    IFNE '20'                       ### B004
     C                     SETON                         89
     C                     ELSE                            ### X004
     C*
     C           SRECTB    IFEQ '1'                        ### B005
     C                     MOVE CCYTB     CCYA,Z
     C                     Z-ADDCDP       CDPA,Z
     C                     Z-ADDTACC      TACA,Z                          CAC001
     C                     ADD  1         Z
     C           Z         IFGT 150                        ### B006
     C                     SETON                     89
     C                     END                             ### E006
     C                     END                             ### E005
     C                     END                             ### E004
     C*
     C                     END                             ### E003
     C                     END                             ### E002
     C* TABTB20 *  OBTAIN COMPUTER SUSPENSE CODE
     C                     MOVEL'01    '  ZTABKY 12
     C                     MOVE '    20'  ZTABKY
     C**
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C*
     C           *IN99     IFEQ '1'                        ### B002
     C           RECITB    ORNE 'D'
     C                     MOVE 'TABLE'   WBFILE  5        ***************
     C                     MOVELZTABKY    WBKEY  28        ** DBERR  02 **
     C                     Z-ADD02        WBASE   20       ***************
     C                     EXSR ABORT
     C                     END                             ### E002
     C* TABLETR *  OBTAIN THE BRANCH INTERNAL CUSTOMERS AND SET-UP
     C* OCCURRENCE INDEX.
     C                     Z-ADD0         U
     C           *LOVAL    SETLLTABLETRF
     C                     READ TABLETRF                 30
     C           *IN30     DOWEQ'0'
     C           RECITB    IFEQ 'D'
     C***********BRNCH*****IFEQ FTDB                                      S01117
     C*********************MOVE BICN      BICNFT  60                      S01117
     C*********************END                                            S01117
     C                     ADD  1         U
     C           U         OCUR CHGBC
     C                     Z-ADD0         BALSUS
     C                     MOVE BICN      BRBICN
     C                     MOVE BRNCH     BRBRCD
     C                     MOVE BRNCH     BRN,U
     C                     END
     C                     READ TABLETRF                 30
     C                     END
     C                     Z-ADDU         BRNO    30
     C* TO STORE WHICH INDICES OF THE ARRAYS ARE 'DR/CR'
     C                     MOVE 'DR'      DC,1
     C                     MOVE 'DR'      DC,2
     C                     MOVE 'DR'      DC,3
     C                     MOVE 'CR'      DC,4
     C                     MOVE 'CR'      DC,5
     C                     MOVE 'CR'      DC,6
     C**
     C** SET-UP COMMON FIELDS FOR OUTPUT LATER
     C**
     C                     MOVE '01'      SEQ01   20
     C                     MOVE '******'  ASTRX6  6
     C                     Z-ADD*ZEROS    ZERO15 150
     C                     MOVE *BLANKS   BLNK30 30
     C                     MOVE *BLANKS   BLNK1   1
     C                     MOVE 'P'       RECI
     C                     MOVE '  GE-FT' SPOS
     C                     MOVE 'G'       GETP
     C                     MOVE *BLANKS   DPMT
     C*                                                                   E21456
     C**  Transaction Type hard coded to 93000 for FT.                    E21456
     C*                                                                   E21456
     C***********          Z-ADD*ZEROS    TRAT                            E21456
     C**********           Z-ADD93000     TRAT                      E21456050925
     C                     Z-ADD*ZEROS    TRAT                            050925
     C*                                                                   E21456
     C**********           Z-ADD*ZEROS    ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD*ZEROS    CHQN
     C                     Z-ADD*ZEROS    REJC
     C                     Z-ADDRUND      PSTD
      *                                                                   S01182
      **  Set up fields for output to generated entries file.             S01182
      **  ( MIS amendment. )                                              S01182
      *                                                                   S01182
     C**********           MOVE *BLANKS   PRFC                      S01182S01414
     C**********           MOVE *BLANKS   OTST                      S01182S10736
     C**********           MOVE *BLANKS   OTTP                      S01182S10736
     C                     Z-ADD*ZEROS    SDCB                            S01182
     C                     Z-ADD*ZEROS    SDLB                            S01182
     C**********           MOVE *BLANKS   BOKC                      S01182S01414
      *                                                                   S01182
     C                     BITOF'01234567'PRIN             SET ALL
     C*                                                    BITS OFF
     C**TABTE10****OBTAIN*THE*ACCOUNT*CODE*DETAILS*********************                       CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                           CGL029
     C**********           MOVE '      '  ZTABKY                                              CGL029
     C**********           MOVELCOMS      WK5A    5                                           CGL029
     C**********           MOVE '1'       WK5A                                                CGL029
     C**********           MOVE WK5A      ZTABKY                                              CGL029
     C**
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE                       CGL029
     C*
     C********** *IN99     IFEQ '1'                                                           CGL029
     C********** RECITB    ORNE 'D'                                                           CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************                    CGL029
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  07 **                    CGL029
     C**********           Z-ADD07        WBASE   20       ***************                    CGL029
     C**********           EXSR ABORT                                                         CGL029
     C**********           END                                                                CGL029
     C*********************MOVE ATYPAC    SUSTYP  1                       E29835
     C**********           MOVE ATYPTB    SUSTYP  1                                    E29835 CGL029
     C**********           MOVE ACSCTB    SUSSEC  2                                    S10736 CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     MOVE COMS      PACCD                                               CGL029
     C                     Z-ADD7         WDBNO   20                                          CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB  1                                           CGL029
     C                     MOVE A5ACSC    ACSCTB  2                                           CGL029
     C                     MOVE A5ACTY    SUSTYP  1                                           CGL029
     C                     MOVE A5ACSC    SUSSEC  2                                           CGL029
      *                                                                                       CGL029
     C           SUSTYP    IFEQ 'R'
     C                     MOVE '1'       SUSRND  1
     C                     ELSE
     C                     MOVE '0'       SUSRND
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CP11                                           S01408
     C*                                                                   S01408
     C*                                                                   S01522
     C* CALL MODULE PROG. FOR MODULE DETAILS.                             S01522
     C*                                                                   S01522
     C                     CALL 'AOMMODR0'                                S01522
     C                     PARM '*MSG   ' @RTCD                           S01522
     C                     PARM '*FIRST ' @OPTN                           S01522
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B1             S01522
     C                     MOVEL'SDMMODPD'WBFILE           *************  S01522
     C                     MOVEL'086'     WBASE            * DBERR 86  *  S01522
     C                     MOVEL@OPTN     WBKEY            *************  S01522
     C                     EXSR ABORT                       1             S01522
     C                     ELSE                            X1             S01522
      *                                                                   CAC001
      **  Retrieve Profit Centre Accounting ICD if Analytical             CAC001
      **  Accounting module is installed                                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
     C                     CALL 'AOPCACR0'                                CAC001
     C                     PARM *BLANKS   @RTCD                           CAC001
     C                     PARM '*FIRST ' @OPTN                           CAC001
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC001
      *                                                                   CAC001
      **   Database error if not found                                    CAC001
      *                                                                   CAC001
     C           @RTCD     IFNE *BLANKS                                   CAC001
     C                     MOVEL'SDPCACPD'WBFILE           ************   CAC001
     C                     MOVEL'*FIRST'  WBKEY            * DBERR 16 *   CAC001
     C                     Z-ADD16        WBASE            ************   CAC001
     C                     EXSR ABORT                                     CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,FTH00565
      * Check system values                                                                   240887
     C                     CALL 'AOSVALR0'                                                    240887
     C                     PARM           @RTCD                                               240887
     C                     PARM SVALKA    SVALK1 20                                           240887
     C                     PARM           SVAL1 200                                           240887
     C**********           PARM *BLANK    SVALK2 20                                    240887 240899
     C                     PARM SVALKB    SVALK2 20                                           240899
     C                     PARM           SVAL2 200                                           240887
     C*******              PARM *BLANK    SVALK3 20                                           CFT156
     C                     PARM SVALKC    SVALK3 20                                           CFT156
     C                     PARM           SVAL3 200                                           240887
     C                     PARM *BLANK    SVALK4 20                                           240887
     C                     PARM           SVAL4 200                                           240887
     C                     PARM *BLANK    SVALK5 20                                           240887
     C                     PARM           SVAL5 200                                           240887
     C                     PARM *BLANK    SVALK6 20                                           240887
     C                     PARM           SVAL6 200                                           240887
     C                     PARM *BLANK    SVALK7 20                                           240887
     C                     PARM           SVAL7 200                                           240887
     C                     PARM *BLANK    SVALK8 20                                           240887
     C                     PARM           SVAL8 200                                           240887
     C                     PARM *BLANK    SVALK9 20                                           240887
     C                     PARM           SVAL9 200                                           240887
     C                     PARM *BLANK    SVALK0 20                                           240887
     C                     PARM           SVAL10200                                           240887
      *                                                                                       240887
     C           @RTCD     IFNE *BLANK                                                        240887
     C                     MOVELSVALKA    WBKEY                                               240887
     C                     MOVEL'SDSVALPD'WBFILE           ***************                    240887
     C                     Z-ADD18        WBASE            * DBERROR 018 *                    240887
     C                     EXSR ABORT                                                         240887
     C                     ENDIF                                                              240887
      *                                                                                       240887
     C                     MOVE SVAL11    NARCSQ  1                                           240887
     C                     MOVE SVAL21    NARRLR  1                                           240899
     C                     MOVE SVAL32    FTNCD   2                                           CFT156
     C*                                                                   S01522
     C* CALL SAR PROG. FOR SWITCHABLE FEATURE                             S01522
     C*                                                                   S01522
     C                     MOVE 'N'       FTPNAR  1                       S01522
     C           BGN1ST    IFEQ 'Y'                        B2             S01522
     C/COPY WNCPYSRC,FTH00566
     C*                                                                   S01522
     C                     CALL 'AOSARDR0'                  2             S01522
     C                     PARM '       ' @RTCD             2             S01522
     C                     PARM '*VERIFY' @OPTN             2             S01522
     C                     PARM 'FTPNAR'  @SARD   6         2             S01522
     C           SCSARD    PARM SCSARD    DSFDY             2             S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B3             S01522
     C           @RTCD     ANDNE'*NRF   '                   3             S01522
     C                     MOVEL'SCSARDPD'WBFILE            ************* S01522
     C                     MOVEL'087'     WBASE             *DBERROR 87 * S01522
     C                     MOVEL@SARD     WBKEY             ************* S01522
     C                     EXSR ABORT                       3             S01522
     C                     ENDIF                           E3             S01522
     C*                                                                   S01522
     C           @RTCD     IFEQ *BLANK                     B3             S01522
     C                     MOVE 'Y'       FTPNAR            3             S01522
     C                     ENDIF                           E3             S01522
     C                     ENDIF                           E2             S01522
     C*                                                                   CEU013
     C**  Access SAR details file to see if CEU013 is installed.          CEU013
     C*                                                                   CEU013
     C                     MOVE 'N'       CEU013                          CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' @RTCD                           CEU013
     C                     PARM '*VERIFY' @OPTN                           CEU013
     C                     PARM 'CEU013'  @SARD                           CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C           @RTCD     IFNE *BLANK                                    CEU013
     C           @RTCD     ANDNE'*NRF   '                                 CEU013
     C                     MOVEL'SCSARDPD'WBFILE            ************* CEU013
     C                     Z-ADD88        WBASE             *DBERROR 88 * CEU013
     C                     MOVEL'CEU013'  WBKEY             ************* CEU013
     C                     EXSR ABORT                                     CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C           @RTCD     IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     ENDIF                                          CEU013
      *                                                                                     BUG22979
      ** Check the switchable feature CER030                                                BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'N'       CER030  1                                         BUG22979
     C                     CALL 'AOSARDR0'                                                  BUG22979
     C                     PARM '       ' RTCD    7                                         BUG22979
     C                     PARM '*VERIFY' OPTN    7                                         BUG22979
     C                     PARM 'CER030'  SARD                                              BUG22979
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG22979
      *                                                                                     BUG22979
     C           RTCD      IFNE *BLANKS                                                     BUG22979
     C           RTCD      ANDNE'*NRF   '                                                   BUG22979
      *                                                                                     BUG22979
     C                     MOVEL'SCSARDPD'WBFILE                                            BUG22979
     C                     MOVELSARD      WBKEY                                             BUG22979
     C                     Z-ADD106       WBASE                                             BUG22979
     C                     EXSR ABORT                                                       BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C           RTCD      IFEQ *BLANK                                                      BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'Y'       CER030                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
      ** Check the switchable feature CER031                                                BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'N'       CER031  1                                         BUG22979
     C                     CALL 'AOSARDR0'                                                  BUG22979
     C                     PARM '       ' RTCD                                              BUG22979
     C                     PARM '*VERIFY' OPTN                                              BUG22979
     C                     PARM 'CER031'  SARD                                              BUG22979
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG22979
      *                                                                                     BUG22979
     C           RTCD      IFNE *BLANKS                                                     BUG22979
     C           RTCD      ANDNE'*NRF   '                                                   BUG22979
      *                                                                                     BUG22979
     C                     MOVEL'SCSARDPD'WBFILE                                            BUG22979
     C                     Z-ADD107       WBASE                                             BUG22979
     C                     MOVELSARD      WBKEY                                             BUG22979
     C                     EXSR ABORT                                                       BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C           RTCD      IFEQ *BLANKS                                                     BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'Y'       CER031                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
      ** Check the switchable feature CFT003                                               BUG22979A
      *                                                                                    BUG22979A
     C                     MOVE 'N'       CFT003  1                                        BUG22979A
     C                     CALL 'AOSARDR0'                                                 BUG22979A
     C                     PARM '       ' RTCD                                             BUG22979A
     C                     PARM '*VERIFY' OPTN                                             BUG22979A
     C                     PARM 'CFT003'  SARD                                             BUG22979A
     C           SCSARD    PARM SCSARD    DSFDY                                            BUG22979A
      *                                                                                    BUG22979A
     C           RTCD      IFNE *BLANKS                                                    BUG22979A
     C           RTCD      ANDNE'*NRF   '                                                  BUG22979A
      *                                                                                    BUG22979A
     C                     MOVEL'SCSARDPD'WBFILE                                           BUG22979A
     C                     Z-ADD107       WBASE                                            BUG22979A
     C                     MOVELSARD      WBKEY                                            BUG22979A
     C                     EXSR ABORT                                                      BUG22979A
      *                                                                                    BUG22979A
     C                     ENDIF                                                           BUG22979A
      *                                                                                    BUG22979A
     C           RTCD      IFEQ *BLANKS                                                    BUG22979A
      *                                                                                    BUG22979A
     C                     MOVE 'Y'       CFT003  1                                        BUG22979A
      *                                                                                    BUG22979A
     C                     ENDIF                                                           BUG22979A
      *                                                                                    BUG22979A
      *                                                                                       CRE098
      ** Check the switchable feature CRE098                                                  CRE098
      *                                                                                       CRE098
     C                     MOVE 'N'       CRE098  1                                           CRE098
     C                     CALL 'AOSARDR0'                                                    CRE098
     C                     PARM '       ' RTCD    7                                           CRE098
     C                     PARM '*VERIFY' OPTN    7                                           CRE098
     C                     PARM 'CRE098'  SARD                                                CRE098
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE098
      *                                                                                       CRE098
     C           RTCD      IFNE *BLANKS                                                       CRE098
     C           RTCD      ANDNE'*NRF   '                                                     CRE098
      *                                                                                       CRE098
     C                     MOVEL'SCSARDPD'WBFILE                                              CRE098
     C                     MOVELSARD      WBKEY                                               CRE098
     C                     Z-ADD108       WBASE                                               CRE098
     C                     EXSR ABORT                                                         CRE098
      *                                                                                       CRE098
     C                     ENDIF                                                              CRE098
      *                                                                                       CRE098
     C           RTCD      IFEQ *BLANK                                                        CRE098
      *                                                                                       CRE098
     C                     MOVE 'Y'       CRE098                                              CRE098
      *                                                                                       CRE098
     C                     ENDIF                                                              CRE098
      *                                                                                     MD024499
      ** Check the switchable feature CGL013                                                MD024499
      *                                                                                     MD024499
     C                     MOVE 'N'       CGL013  1                                         MD024499
     C                     CALL 'AOSARDR0'                                                  MD024499
     C                     PARM '       ' RTCD    7                                         MD024499
     C                     PARM '*VERIFY' OPTN    7                                         MD024499
     C                     PARM 'CGL013'  SARD                                              MD024499
     C           SCSARD    PARM SCSARD    DSFDY                                             MD024499
      *                                                                                     MD024499
     C           RTCD      IFNE *BLANKS                                                     MD024499
     C           RTCD      ANDNE'*NRF   '                                                   MD024499
      *                                                                                     MD024499
     C                     MOVEL'SCSARDPD'WBFILE                                            MD024499
     C                     MOVELSARD      WBKEY                                             MD024499
     C                     Z-ADD109       WBASE                                             MD024499
     C                     EXSR ABORT                                                       MD024499
      *                                                                                     MD024499
     C                     ENDIF                                                            MD024499
      *                                                                                     MD024499
     C           RTCD      IFEQ *BLANK                                                      MD024499
      *                                                                                     MD024499
     C                     MOVE 'Y'       CGL013                                            MD024499
      *                                                                                     MD024499
     C                     ENDIF                                                            MD024499
     C/COPY WNCPYSRC,FT0220C029
     C*                                                                   CEU013
     C* Retrieve the Next available number for Account postings           CEU013
     C*                                                                   CEU013
     C           *LIKE     DEFN GLNARN    WKNARN                          CEU013
     C                     MOVE *ZEROS    WKNARN                          CEU013
     C                     MOVE *BLANKS   WKUPDT  1                       CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           CER031    OREQ 'Y'                                                         BUG22979
     C           '001'     CHAINGLAPNAPD             9083                 CEU013
     C           *IN83     IFEQ *ON                                       CEU013
     C                     MOVEL'GLAPNAPD'WBFILE           ***************CEU013
     C                     MOVEL'001'     WBKEY            * DBERROR 89 * CEU013
     C                     Z-ADD89        WBASE            ***************CEU013
     C                     EXSR ABORT                                     CEU013
     C                     ELSE                                           CEU013
     C           *IN90     IFEQ *ON                                       CEU013
     C                     Z-ADD1         WKNARN                          CEU013
     C                     MOVE 'N'       WKUPDT                          CEU013
     C                     ELSE                                           CEU013
     C                     Z-ADDGLNARN    WKNARN                          CEU013
     C                     MOVE 'Y'       WKUPDT                          CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C/COPY WNCPYSRC,FT0220C038
     C                     ENDIF                           E1             S01522
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C                     MOVEL'SCSARDPD'WBFILE                                              CGL020
     C                     Z-ADD91        WBASE                                               CGL020
     C                     MOVEL@SARD     WBKEY                                               CGL020
     C                     EXSR ABORT                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           @RTCD     IFEQ *BLANK                                                        CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C/COPY WNCPYSRC,FTH00394
      *                                                                   190237
      ** Read GL ICD to get General Ledger Details                        190237
      *                                                                   190237
     C**********           CALL 'AOGELRR0'                                190237              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       190237
     C                     PARM '*FIRST ' @OPTN   7                       190237
     C********** SDGELR    PARM SDGELR    DSFDY                           190237              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   190237
      ** Database error if no record found                                190237
      *                                                                   190237
     C           @RTCD     IFNE *BLANKS                                   190237
     C                     MOVE 'SDGELRPD'WBFILE           ***************190237
     C                     MOVEL@OPTN     WBKEY            * DB ERROR 048*190237
     C                     Z-ADD048       WBASE            ***************190237
     C                     EXSR ABORT                                     190237
     C                     END                                            190237
      *                                                                   190237
      ** Read SDBRCHPD to get the details of the Main Branch              190237
      *                                                                   190237
     C** Obtain Main branch details, but only if interbranch accounting                       239272
     C** is through the main branch.                                                          239272
     C*                                                                                       239272
     C           BKIEMB    IFEQ 'Y'                                                           239272
     C**********           CALL 'AOBRCHR0'                                190237              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       190237
     C                     PARM '*KEY   ' @OPTN   7                       190237
     C                     PARM BKMABR    @BRCD   3                       190237
     C********** SDBRCH    PARM SDBRCH    DSFDY                           190237              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   190237
      ** Database error if record not found                               190237
      *                                                                   190237
     C           @RTCD     IFNE *BLANKS                                   190237
     C                     MOVE 'SDBRCHPD'WBFILE           ***************190237
     C                     MOVELBKMABR    WBKEY            * DB ERROR 049*190237
     C                     Z-ADD049       WBASE            ***************190237
     C                     EXSR ABORT                                     190237
     C                     END                                            190237
      *                                                                   190237
      ** Store Main Branch details                                        190237
      *                                                                   190237
     C           *LIKE     DEFN A8BICN    WMBICN                          190237
     C           *LIKE     DEFN A8DFAC    WMDFRM                          190237
     C           *LIKE     DEFN A8DTAC    WMDTO                           190237
      *                                                                   190237
     C                     MOVE A8BICN    WMBICN                          190237
     C                     MOVE A8DFAC    WMDFRM                          190237
     C                     MOVE A8DTAC    WMDTO                           190237
     C                     ENDIF                                                              239272
      *                                                                   190237
     C/COPY WNCPYSRC,FT0220C009
     C*                                                                   S01522
      *                                                                                       CFT156
      ** Check if CFT156 is switched on                                                       CFT156
      *                                                                                       CFT156
     C                     CALL 'AOSARDR0'                                                    CFT156
     C                     PARM *BLANKS   @RTCD   7                                           CFT156
     C                     PARM '*VERIFY' @OPTN   7                                           CFT156
     C                     PARM 'CFT156'  @SARD   6                                           CFT156
      *                                                                                       CFT156
     C           @RTCD     IFEQ *BLANK                                                        CFT156
     C                     MOVEL'Y'       CFT156  1                                           CFT156
     C                     ELSE                                                               CFT156
     C                     MOVEL'N'       CFT156                                              CFT156
     C                     END                                                                CFT156
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C                     OPEN OTPAY                                                         CFT156
     C                     OPEN INPAY                                                         CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     END                             ### E001
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***
     C***   D E T A I L    P R O C E S S I N G
     C***
     C********************************************************************
      *                                                                   CAC001
      **  If Analytical Accounting is installed, save transaction         CAC001
      **  profit centre                                                   CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE PRFC      WTPRFC  4                       CAC001
     C                     ENDIF                                          CAC001
     C*
     C* IF CHANGE OF CURRENCY CHECK IF ANY SUSPENSE ENTRIES ARE
     C* REQUIRED
     C*
     C           ECCY      IFNE EECCY
     C           EECCY     IFNE ' '
     C                     EXSR CCYCHG
     C                     ELSE
     C                     MOVE ECCY      EECCY
     C                     END
     C                     END
     C**    PROCESS A DETAIL RECORD OR A TRAILER.
     C*
     C           RECIFP    IFNE 'Z'
     C                     EXSR DETAIL
     C                     ELSE
     C                     EXSR TRAILR
     C                     END
     C*
     C********************************************************************
     C**
     C**    THE PROCESSING OF A DETAIL RECORD  .
     C**
     C           DETAIL    BEGSR                           ** DETAIL **
     C*
     C/COPY WNCPYSRC,FT0220C027
     C                     SETON                     21                   S01117
     C*                                                                   S01117
     C*********************MOVE BICNFT    BICN                            S01117
     C*
     C* OCCURRENCE COUNT POSITION OF THE BRANCH ARRAY (BRN) IS USED TO    S01117
     C* OBTAIN THE VALUE OF THE CORRESPONDING BRANCH INTERNAL CUSTOMER    S01117
     C* NUMBER  FROM CHBC DATA STRUCTURE                                  S01117
     C*                                                                   S01117
     C                     Z-ADD1         A       30                      S01117
     C           BRCAFP    LOKUPBRN,A                    35               S01117
     C           *IN35     IFEQ '1'                                       S01117
     C           A         OCUR CHGBC                                     S01117
     C                     MOVE BRBICN    BICN                            S01117
     C           *LIKE     DEFN BRBICN    ##BICN                          164066
     C                     MOVELBRBICN    ##BICN                          164066
     C                     END                                            S01117
      *                                                                   056031
      * Initialise posting date to today                                  056031
      *                                                                   056031
     C                     Z-ADDRUND      PSTD                            056031
     C*                                                                   S01117
     C                     Z-ADDEAMT      PRMAMT 130
     C                     Z-ADD1         H       10
     C                     EXSR HASH
     C*
     C                     Z-ADDVDAT      ZDAYNO           'FORMAT DATE
     C                     EXSR ZDATE2                     'TO DDMMMYY
     C                     MOVE ZADATE    VDATO   7
     C*
     C***********AKEY******CHAINACKEY                99                   033607
     C***********AKEY      CHAINACKEYL2              99             033607047369
     C***********AKEY      CHAINACKEY                99             047369CDL038
     C           EXAKEY    CHAINACKEY                99                   CDL038
     C/COPY WNCPYSRC,FT0220C044
     C     N99   RECIAK    COMP 'D'                  9999
     C* PROCESS EACH NON-BLANK POSTING REFERENCE THATS ON ACKEY
     C           *IN99     IFEQ '0'                        ### B001
     C           1         DO   6         X       10       ### B002
     C           PRF,X     IFNE 0                          ### B003
     C                     MOVE BLNK30    PNAR
     C                     MOVE BLNK1     STEP    1
     C/COPY WNCPYSRC,FT0220C045
      *                                                                   051400
      * Initialise ASOC to zero                                           051400
      *                                                                   051400
     C**********           Z-ADD0         ASOC                                         051400 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
      *                                                                   051400
      *                                                                   S01182
      **  Set up field for output to generated entries file.              S01182
      **  ( MIS amendment. )                                              S01182
      *                                                                   S01182
     C**********           MOVE PREF      OTRF                                         S01182 CGL029
     C                     MOVELPREF      OTRF                                                CGL029
      *                                                                                       CER049
      * Re-initialize default sequence '01' (may have been changed if                         CER049
      * posting reference 1 was previous one processed)                                       CER049
     C                     MOVE '01'      SEQ01                                               CER049
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CP10                                           S01408
     C*                                                                   S01408
     C                     MOVELFTST      OTST                            S10736
     C                     MOVELFRST2     OTTP                            S10736
      *                                                                   S01182
     C                     MOVEL##BICN    BICN                            164066
     C/COPY WNCPYSRC,FTH00385
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C                     MOVELNCD,X     WNCD    2                                           CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     EXSR GENKEY
     C*
     C                     END                             ### E003
     C                     END                             ### E002
     C*
     C                     ELSE                            ### X001
     C* REPORT A/C KEY MISSING
     C                     MOVE ECCY      CRNCY   3
     C                     EXSR CCYSR
     C           CDPA,Z    COMP 2                    43  42
     C           CDPA,Z    COMP 1                      4041
     C      40             MOVE EAMT      AMT0
     C      41             MOVE EAMT      AMT1
     C      42             MOVE EAMT      AMT2
     C      43             MOVE EAMT      AMT3
     C*                                                                   S01117
     C* WHEN MULTIBRANCHING INDICATOR IS SETON                            S01117
     C*                                                                   S01117
     C           *IN55     IFEQ '1'                                       S01117
     C           BRCAFP    IFNE BRCA1                                     S01117
     C*                                                                   S01117
     C* WHEN FIRST RECORD IS READ FROM FILE: FPKEYDD - OPEN REPORT        S01117
     C*  FT0220P1 (EXSR SUBZSF)                                           S01117
     C*                                                                   S01117
     C           *IN62     IFEQ '0'                                       S01117
     C                     EXSR SUBZSF                                    S01117
     C                     SETON                     62                   S01117
     C*                                                                   S01117
     C* OTHERWISE WRITE REPORT CLOSING DETAIL, CLOSE REPORT FT0220P1      S01117
     C*  AND OPEN REPORT FT0220P1 FOR NEW BRANCH (BRCA) - EXSR SUBZSF     S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* A RECORD WITH AMISSING ACCOUNT KEY WAS FOUND                      S01117
     C*                                                                   S01117
     C           MISSIN    IFEQ 'YES'                                     S01117
     C                     SETON                     U4                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********          WRITEP1CLO                              S01117 066886
     C                     WRITEP1CLO                  72                 066886
     C                     SETOF                       72                 066886
     C                     CLOSEFT0220P1                                  S01117
     C                     EXSR SUBZSF                                    S01117
     C                     MOVE *BLANKS   MISSIN                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WHEN MULTIBRANCHING INDICATOR IS SETOF                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* WHEN FIRST RECORD IS READ FROM FILE: FPKEYDD - OPEN REPORT        S01117
     C*  FT0220P1 (EXSR SUBZSF)                                           S01117
     C*                                                                   S01117
     C           *IN62     IFEQ '0'                                       S01117
     C                     EXSR SUBZSF                                    S01117
     C                     SETON                     62                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* SAVE CURRENT BRANCH FOR COMPARISON WITH BRANCH FROM NEXT RECORD   S01117
     C*                                                                   S01117
     C                     MOVE BRCAFP    BRCA1   3                       S01117
     C*                                                                   S01117
     C* INCREMENT PAGE AND PRINT HEADINGS                                 S01117
     C      72             ADD  1         PPAGE                           S01117
     C      72             WRITEP1HEAD                                    S01117
     C*                                                                   S01117
     C                     WRITEP1DETL                 72
     C**INCREMENT*PAGE*AND*PRINT*HEADINGS*                                S01117
     C******72*************ADD  1         PPAGE                           S01117
     C******72*************WRITEP1HEAD                                    S01117
     C                     MOVE 'YES'     MISSIN  3
     C*
     C                     END                             ### E001
     C                     ENDSR
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C* SUBZSF SR.                                                        S01117
     C* ZSFILE  HANDLING                                                  S01117
     C*                                                                   S01117
     C           SUBZSF    BEGSR                                          S01117
     C*                                                                   S01117
     C* SET PAGE NBR, OPEN REPORT FT0220P1 AND CALL ZSFILE TO LOG         S01117
     C*  SPOOL FILE DETAILS                                               S01117
     C*                                                                   S01117
     C                     Z-ADD1         PPAGE                           S01117
     C*                                                                   S01117
     C                     OPEN FT0220P1                                  S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM1    ZSNUM                           S01117
     C                     MOVELSFILE1    ZSNAM                           S01117
     C                     MOVE BRCAFP    ZENT                            S01117
     C*                                                                   S01117
     C*  FOR FIRST P1 FILE OPENED, PASS BLANK SEQUENCE NO TO RCF TO       108635
     C*  ENABLE IT TO GENERATE NEW SPOOL FILES NUMBERS RECORD             108635
     C           *IN22     IFEQ '0'                                       108635
     C                     CALL 'ZSFILE'                                  S01117
     C***********          PARM           ZSEQ    5                 S01117108635
     C                     PARM *BLANKS   ZSEQ    5                       108635
     C                     PARM           ZENT    3                       S01117
     C                     PARM           ZSNAM  10                       S01117
     C                     PARM           ZSNUM   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C                     SETON                     22                   108635
      *                                                                   108635
     C*  FOR SECOND AND SUBSEQUENT P1 FILES, PASS CURRENT SEQUENCE        108635
     C*  NUMBER TO ZSFILE                                                 108635
     C                     ELSE                                           108635
     C                     CALL 'ZSFILE'                                  108635
     C                     PARM           ZSEQ    5                       108635
     C                     PARM           ZENT    3                       108635
     C                     PARM           ZSNAM  10                       108635
     C                     PARM           ZSNUM   60                      108635
     C                     PARM *BLANKS   ZERR    1                       108635
     C                     END                                            108635
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0220'  DBPGM            ***************S01117
     C                     MOVEL'FT0220P1'DBKEY            ** DBERR  15 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD15        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WRITE HEADER FOR  FT0220P1 REPORT                                 S01117
     C*                                                                   S01117
     C                     WRITEP1HEAD                                    S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*##  THE NUMBER IN 'STEP' REFERS BACK TO THE NUMBER OF A
     C*##  PARAGRAPH IN THE SPEC.
     C**
     C**    TO GENERATE FUNDS TRANSFER ENTRIES.
     C**
     C           GENKEY    BEGSR                           ** GENKEY **
     C*
     C                     Z-ADDEAMT      PRMAMT
     C                     Z-ADD2         H
     C/COPY WNCPYSRC,FT0220C040
     C                     EXSR HASH
     C/COPY WNCPYSRC,FT0220C041
     C*
     C*--- POSTING REFERENCE = '1'
     C           PRF,X     IFEQ 1
     C                     MOVE ACD,X     ACCOD1
     C/COPY WNCPYSRC,FT0220C046
      *                                                                                       CER049
      * Process default sequence for posting reference 1 if entered on                        CER049
      * account key                                                                           CER049
     C           ASQ,X     IFNE *BLANK                                                        CER049
     C                     MOVELASQ,X     SEQ01                                               CER049
     C                     ENDIF                                                              CER049
     C*********************MOVE ACCID1    ACCID                           S01117
     C                     MOVELACCID1    ACCID                           S01117
     C                     MOVE BRCAFP    ACCID                           S01117
     C                     END
     C*--- POSTING REFERENCE = '2'
     C           PRF,X     IFEQ 2                          ### B001
     C*
     C           FRST2     IFEQ 'NT'                       ### B002
     C           DC,X      ANDEQ'DR'
     C                     MOVE OTAC      ACCID
     C                     ELSE                            ### X002
     C                     MOVE SEAC      ACCID
     C                     END                             ### E002
     C* MOVE THE ACCOUNT CODE FROM THE ACCOUNT IDENTIFIER INTO THE DATA
     C* STRUCTURE SO THAT 'ACCOD' MAY BE RETRIEVED FOR CHAIN TO TABLE.
     C                     MOVE KACOD     ACCOD2
     C                     END                             ### E001
     C* ## STEP 3 ##
     C*--- POSTING REFERENCE = '3'
     C           PRF,X     IFEQ 3
     C                     MOVE '3'       STEP    1
     C/COPY WNCPYSRC,FT0220C042
     C                     MOVE COMS      ACCOD3
     C/COPY WNCPYSRC,FT0220C043
     C*********************MOVE ACCID3    ACCID                           S01117
     C                     MOVELACCID3    ACCID                           S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CP12                                           S01408
     C*                                                                   S01408
     C                     MOVE BRCAFP    ACCID                           S01117
     C                     MOVE SUSTYP    ATYP
     C                     MOVE SUSSEC    ACSC                            S10736
     C                     END
     C*---
     C/COPY WNCPYSRC,FT0220C039
     C**TABTE10****OBTAIN*THE*ACCOUNT*CODE*DETAILS*********************                       CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                           CGL029
     C**********           MOVE '      '  ZTABKY                                              CGL029
     C**********           MOVELACCOD     WK5A    5                                           CGL029
     C**********           MOVE '1'       WK5A                                                CGL029
     C**********           MOVE WK5A      ZTABKY                                              CGL029
     C**
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE                       CGL029
     C*
     C********** *IN99     IFEQ '1'                                                           CGL029
     C********** RECITB    ORNE 'D'                                                           CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************                    CGL029
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  04 **                    CGL029
     C**********           Z-ADD04        WBASE   20       ***************                    CGL029
     C**********           EXSR ABORT                                                         CGL029
     C**********           END                                                                CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     MOVE ACCOD     PACCD                                               CGL029
     C                     Z-ADD4         WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                   051400
      * If an Income/Expense account process Associated Customer.         051400
      *                                                                   051400
     C           ACSCTB    IFEQ 'IN'                                      051400
     C           ACSCTB    OREQ 'EX'                                      051400
     C**********           Z-ADDFPASOC    ASOC                                         051400 CSD027
     C                     MOVE FPASOC    ASOC                                                CSD027
     C                     END                                            051400
      *                                                                   S01522
      **  Set up Posting Narrative Fields                                 S01522
     C                     MOVE KCNUM     ##CUST                          S01522
     C                     MOVE KCCY      ##CCY                           S01522
     C                     MOVE KACOD     ##ACCD                          S01522
     C                     MOVE KACSQ     ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
      *                                                                   051400
     C* ACCNT *  THERE MAY BE ACCOUNT DETAILS ON 'ACCNT'
     C           ACCKEY    CHAINACCNT                66    ON NOT THERE
     C/COPY WNCPYSRC,FT0220C001
     C     N66   RECIAC    COMP 'D'                  6666
     C* ARE THE DETAILS FROM 'ACCNT' OR 'TABLE'
     C           *IN66     IFEQ '1'
     C*********************Z-ADDFTDB      BRCD                            S01117
     C                     MOVE BRCAFP    BRCA                            S01117
     C                     MOVE ATYPTB    ATYP
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADD*ZEROS    RRNM
     C                     ELSE
     C                     MOVE ATYPAC    ATYP
     C*********************Z-ADDBRCDAC    BRCD                            S01117
     C                     MOVE BRCAAC    BRCA                            S01117
     C                     END
     C                     MOVE ACSCTB    ACSC                            S10736
     C/COPY WNCPYSRC,FT0220C002
     C* ## STEP 6 ##
     C*
     C           ATYP      IFEQ 'R'                        ### B001
     C*                                                                   045178
     C* If Debits and Credits are blocked, send posting to Suspense A/C   045178
     C*                                                                   045178
     C                     SETOF                     29                   045178
     C*                                                                   045178
     C           *IN66     IFEQ '0'                                       045178
     C*                                                                   045178
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP4                                           S01408
     C*                                                                   S01408
     C           DC,X      IFEQ 'DR'                                      045178
     C                     TESTB'2'       RETB           29    DEBITS     045178
     C                     ELSE                                           045178
     C                     TESTB'3'       RETB           29    CREDITS    045178
     C                     END                                            045178
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   045178
     C                     END                                            045178
     C*                                                                   045178
     C           *IN66     IFEQ '1'                        ### B002
     C           *IN29     OREQ '1'                                       045178
     C           DACO      ORGT VDAT
     C                     MOVELACCID     NARR2  30
     C                     MOVE '6'       STEP
     C                     MOVE COMS      ACCOD3
     C*********************MOVE ACCID3    ACCID                           S01117
     C                     MOVELACCID3    ACCID                           S01117
     C                     MOVE BRCAFP    ACCID                           S01117
     C                     MOVE SUSTYP    ATYP
     C                     MOVE SUSSEC    ACSC                            S10736
     C                     Z-ADD*ZEROS    ACNO                            092655
     C                     Z-ADD*ZEROS    RRNM                            092655
     C                     END                             ### E002
     C                     END                             ### E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP8                                           S01408
     C*                                                                   S01408
     C* ## STEP 7 ##
     C*
     C           ECCY      IFNE KCCY                       ### B001
     C                     MOVELACCID     NARR2
     C                     MOVE '7'       STEP
     C                     MOVE COMS      ACCOD3
     C                     Z-ADD*ZERO     ACNO                            092655
     C*********************MOVE ACCID3    ACCID                           S01117
     C                     MOVELACCID3    ACCID                           S01117
     C                     MOVE BRCAFP    ACCID                           S01117
     C                     MOVE SUSTYP    ATYP
     C                     MOVE SUSSEC    ACSC                            S10736
     C                     Z-ADD*ZEROS    RRNM                            092655
     C                     END                             ### E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP1                                           S01408
     C*                                                                   S01408
     C* STEPS 3,6, OR 7 HAVE NOT BEEN PROCESSED
     C           STEP      IFEQ ' '                        ### B001
     C/COPY WNCPYSRC,FT0220C025
     C**
     C* TABLETP *  USE THE NARRATIVE CODE TO OBTAIN THE POSTING REF.
     C                     MOVE *BLANKS   ZTABKY
     C                     MOVEL'90    '  ZTABKY 12
     C*                    MOVE MFLD1     ZTABKY
     C                     MOVE '      '  ZTABKY
     C                     MOVE NCD,X     ZTABKY
     C*
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C*
     C           *IN99     IFEQ '1'
     C           RECITB    ORNE 'D'
     C                     MOVE 'TABLE'   WBFILE  5        ***************
     C                     MOVELZTABKY    WBKEY  28        ** DBERR  05 **
     C                     Z-ADD05        WBASE   20       ***************
     C                     EXSR ABORT
     C                     END
     C*
     C/COPY WNCPYSRC,FT0220CCP6                                           S01408
     C*
     C           NARRLR    IFNE 'Y'                                                           240899
     C                     MOVE NARD      PNAR
     C                     MOVELPREF      PNAR
     C                     ELSE                                                               240899
      * Rather than use the narrative, use ref. to related message                            240899
      * truncate RLPR so that the resulting narrative format will be :                     AR1091525
      * PREF(15) + ' ' + RLPR(14)                                                          AR1091525
     C**********           MOVE *BLANKS   PR13   13                                 240899 AR1091525
     C**********           MOVELPREF      PR13                                      240899 AR1091525
     C**********           MOVELPR13      PNAR                                      240899 AR1091525
     C**********           MOVE RLPR      PNAR                                      240899 AR1091525
     C********   PREF      CAT  RLPR:1    PNAR                                    AR1091525 MD026327
     C                     MOVE *BLANKS   PR13   13                                         MD026327
     C                     MOVELPREF      PR13                                              MD026327
     C                     MOVELPR13      PNAR                                              MD026327
     C                     MOVE RLPR      PNAR                                              MD026327
     C                     ENDIF                                                              240899
     C*
     C/COPY WNCPYSRC,FT0220CCP7                                           S01408
     C*
     C           CQSQ      IFNE *ZEROS                     ### B002
     C/COPY WNCPYSRC,FT0220C026
     C                     MOVE CQSQ      CQSQO
     C                     MOVELNARR1     PNAR
     C                     MOVELCQSQO     ##CHNB                          S01522
     C/COPY WNCPYSRC,FT0220C014
     C                     END                             ### E002
     C/COPY WNCPYSRC,FT0220C015
     C*                                                                   S01522
      *                                                                   088034
      *  If posting narrative '01' use message GB01001                    088034
      *                                                                   088034
     C           NCD,X     IFNE '01'                                      088034
     C                     MOVE *ZEROS    ##MGID                          S01522
     C                     MOVE NCD,X     ##WK4   4                       S01522
     C                     MOVEL##WK4     ##MGID                          S01522
     C                     MOVEL'GB'      ##MGID                          S01522
      *                                                                   088034
     C                     ELSE                                           088034
     C                     MOVEL'GB01001' ##MGID                          088034
     C                     ENDIF                                          088034
      *                                                                   088034
     C                     END                             ### E001
     C* STEP 3  WAS PROCESSED
     C           STEP      IFEQ '3'                        ### B001
     C                     MOVELASTRX6    WK9A    9
     C                     MOVE ECCY      WK9A
     C                     MOVELKACOD     WK6A    6
     C                     MOVE SEQ01     WK6A
     C                     MOVELWK9A      WK15A  15
     C                     MOVE WK6A      WK15A
     C/COPY WNCPYSRC,FT0220C003
     C                     MOVELWK15A     PNAR
     C                     MOVE PREF      PNAR
     C/COPY WNCPYSRC,FT0220C004
     C                     MOVEL'GB00030' ##MGID                          S01522
     C                     END                             ### E001
     C* STEP 6 OR 7  WAS PROCESSED
     C           STEP      IFEQ '6'                        ### B001
     C           STEP      OREQ '7'
     C                     MOVE PREF      NARR2
     C                     MOVE NARR2     PNAR
     C                     MOVEL'GB00030' ##MGID                          S01522
     C                     END                             ### E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP3                                           S01408
     C*                                                                   S01408
     C**
     C**      SET-UP FIELDS FOR OUTPUT
     C**
     C                     MOVE KCNUM     CNUM
     C                     MOVE KCCY      CCY
     C                     MOVE KACOD     ACOD
     C                     MOVE KACSQ     ACSQ
     C                     Z-ADDEAMT      PSTA
     C                     Z-ADDVDAT      VALD
     C*
     C           ATYP      IFEQ 'R'
     C                     BITON'0'       PRIN                            058846
     C                     MOVE '1'       RIND
     C                     ELSE
     C                     MOVE '0'       RIND
     C                     END
     C*
     C           DC,X      IFEQ 'DR'
     C                     MOVE '0'       DRCR             'DEBIT
     C                     ELSE
     C                     MOVE '1'       DRCR             'CREDIT
     C                     END
     C*
     C* ADD AMOUNT TO BRANCHES OCCURRENCE OF DATA STRUCTURE
     C                     EXSR ADDAMT
     C*
     C* REVERSE THE POSTING AND MAKE THE AMOUNT POSITIVE IF
     C* THE POSTING AMOUNT IS NEGATIVE
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
      *
     C           DRCR      IFEQ 0
     C                     MOVE '1'       DRCR
     C                     ELSE
     C                     MOVE '0'       DRCR
     C                     END
     C                     END
     C*
     C                     MOVE RLPR      SWCR
     C*                                                                   050925
     C           ATYP      IFEQ 'R'                                       050925
     C/COPY WNCPYSRC,FT0220C030
     C                     Z-ADD93000     TRAT                            050925
     C/COPY WNCPYSRC,FT0220C031
     C                     ELSE                                           050925
     C                     Z-ADD*ZEROS    TRAT                            050925
     C                     END                                            050925
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   056031
      * Call subroutine SRPSTD to determine correct posting date          056031
      *    only run if mode is S                                          056031
      *                                                                   056031
     C           P0MODE    IFEQ 'S'                                       056031
     C                     EXSR SRPSTD                                    056031
     C                     END                                            056031
     C*                                                                   050925
     C* Retrieve the posting narrative:                                   S01522
     C*                                                                   S01522
     C                     MOVELPREF      ##TRNO                          S01522
     C                     MOVE ASOC      ##ASOC                          S01522
     C                     MOVE ACNO      ##ACNO                          S01522
     C                     EXSR SRPNAR                                    S01522
      *                                                                   CAC001
      **  Determine profit centre to be used                              CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     EXSR SRPRCU                                    CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01522
     C/COPY WNCPYSRC,FT0220C006
     C*                                                                   CEU013
     C* Generate extension record to file GEFP1APD if the Original        CEU013
     C*  currency and amount fields are non blank.                        CEU013
     C*                                                                   CEU013
     C                     EXSR GENPX1                                    CEU013
     C/COPY WNCPYSRC,FT0220C028
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     MOVELAKEY      GEFKEY                                            AR988246
      *                                                                                       CGL020
      ** Pass AML fields to the Gen. Entries Funds Transfer Details File                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
      *                                                                                       CGL020
     C**********           MOVELAKEY      GEFKEY                                     CGL020 AR988246
     C                     MOVE F1FFLG    FEEFLG                                              CGL020
     C                     MOVE F1FVAL    FEEVAL                                              CGL020
     C                     MOVE F1FPCT    FEEPCT                                              CGL020
     C                     MOVELFPTRID    FDTRID                                              CGL020
     C           ATYP      IFEQ 'R'                                                           CGL020
     C           ATYP      OREQ 'N'                                                           CGL020
     C                     MOVELF1RACT    RORACT                                              CGL020
     C                     MOVELF1RCTY    RORCTY                                              CGL020
     C                     MOVELF1RBNK    RORBNK                                              CGL020
     C                     MOVELF1RCDE    RORCDE                                              CGL020
     C                     MOVELF1PACT    PORACT                                              CGL020
     C                     MOVELF1PCTY    PORCTY                                              CGL020
     C                     MOVELF1PBNK    PORBNK                                              CGL020
     C                     MOVELF1PCDE    PORCDE                                              CGL020
     C                     MOVELF1DACT    DSTACT                                              CGL020
     C                     MOVELF1DCTY    DSTCTY                                              CGL020
     C                     MOVELF1DBNK    DSTBNK                                              CGL020
     C                     Z-ADDF1SDAT    SETDAT                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD*ZEROS    SETDAT                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD*ZEROS    NOMINL                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
     C/COPY WNCPYSRC,FTH00395
     C*                                                                   CEU013
     C                     EXCPTGEFPDT                     'OUTPUT
     C/COPY WNCPYSRC,FT0220C016
     C                     BITOF'0'       PRIN                            058846
     C/COPY WNCPYSRC,FT0220C005
     C*
     C           PRF,X     IFEQ 2
     C           *IN66     ANDEQ'0'
     C***********BRCD******ANDNEFTDB                                      S01117
     C           BRCA      ANDNEBRCAFP                                    S01117
      *                                                                   190237
      ** Generate Interbranch Postings and postings via the Main Branch   190237
      *                                                                   190237
     C           BKIEMB    IFEQ 'Y'                                       190237
     C           BKMABR    ANDNEBRCA                                      190237
     C           BKMABR    ANDNEBRCAFP                                    190237
     C                     EXSR EXTRA2                                    190237
     C                     ELSE                                           190237
      *                                                                   190237
      ** Else, generate Interbranch postings only                         190237
      *                                                                   190237
     C                     EXSR EXTRA
     C                     ENDIF                                          190237
      *                                                                   190237
     C                     END
     C*
     C/COPY WNCPYSRC,FT0220C008
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C/COPY WNCPYSRC,FTH00399
     C********************************************************************
     C**
     C**      ADD AMOUNT INTO BRANCH CODES OCCURRENCE OF CHGBC
     C**
     C           ADDAMT    BEGSR
     C*
     C                     Z-ADD1         Y       30
     C***********BRCD******LOKUPBRN,Y                    35               S01117
     C           BRCA      LOKUPBRN,Y                    35               S01117
     C           *IN35     IFEQ '1'
     C           Y         OCUR CHGBC
     C           DRCR      IFEQ 0
     C                     ADD  EAMT      BALSUS
     C                     ELSE
     C                     SUB  EAMT      BALSUS
     C                     END
     C                     ELSE
     C                     MOVE 'ARRAY'   WBFILE  5        ***************
     C                     MOVELNAR,2     WBKEY  28        ** DBERR  08 **
     C*********************MOVE BRCD      WBKEY            **           **S01117
     C                     MOVE BRCA      WBKEY            **           **S01117
     C                     Z-ADD08        WBASE   20       ***************
     C                     EXSR ABORT
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT                                                              056031
     C********************************************************************056031
     C**                                                                  056031
     C**   Find correct date for posting if forward valued                056031
     C**                                                                  056031
     C           SRPSTD    BEGSR                                          056031
      *                                                                   056031
      *  If value date is less than next working day use run date         056031
      *                                                                   056031
     C           EPSD      IFLT DNWD                                      056031
     C                     Z-ADDRUND      PSTD                            056031
     C                     GOTO EXPSTD                                    056031
     C                     END                                            056031
      *                                                                   056031
     C           EPSD      IFEQ DNWD                                      056031
     C                     Z-ADDEPSD      PSTD                            056031
     C                     GOTO EXPSTD                                    056031
     C                     END                                            056031
      *                                                                   056031
      *  If value date is greater than next working day                   056031
      *  use program SZDATE3 to determine correct date                    056031
      *                                                                   056031
     C                     Z-ADDEPSD      W#NDAT  50                      056031
     C                     Z-ADDEPSD      P#SDAT  50                      056031
      *                                                                   056031
     C           W#NDAT    DOUEQW#SDAT                                    056031
     C                     Z-ADDP#SDAT    W#SDAT  50                      056031
     C           P#SDAT    SUB  1         P#SDAT                          056031
     C                     CALL 'SZDATE3'                                 056031
     C                     PARM P#SDAT    #DAYNO  50       I: Cvt. VDa te 056031
     C                     PARM LOCY      #CCY    3        I: Currency    056031
     C                     PARM *BLANKS   #LOC    3        I: Location    056031
     C                     PARM 1         #NRDYS  20       I: Nbr Days    056031
     C           W#NDAT    PARM           #DYNBR  50       O: Nbr Days    056031
     C                     END                                            056031
      *                                                                   056031
     C                     Z-ADDW#SDAT    PSTD                            056031
      *                                                                   056031
     C           EXPSTD    ENDSR                                          056031
     C/EJECT
     C********************************************************************
     C**
     C**   CREATE BALANCING ENTRIES IF REQUIRED
     C**
     C           CCYCHG    BEGSR
     C                     MOVELAKEY      GEFKEY                                            AR988246
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
      *                                                                                       CGL020
     C**********           MOVELAKEY      GEFKEY                                     CGL020 AR988246
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     MOVE *BLANKS   FEEVAL                                              CGL020
     C                     MOVE *BLANKS   FEEPCT                                              CGL020
     C                     MOVE *BLANKS   FDTRID                                              CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD*ZEROS    SETDAT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD*ZEROS    NOMINL                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
     C                     Z-ADD1         U       30
     C                     DO   BRNO
     C           U         OCUR CHGBC
     C*    CHECK FOR IMBALANCE FOR BRANCH/CCY
     C           BALSUS    IFNE 0
     C*
     C*********************MOVE BRBRCD    BRCD                            S01117
     C                     MOVE BRBRCD    BRCA                            S01117
     C                     MOVE BRBICN    BICN
     C                     Z-ADDBALSUS    PSTA         39
     C           *IN39     IFEQ '1'
     C                     MOVE '0'       DRCR
     C                     Z-SUBPSTA      PSTA
     C                     ELSE
     C                     MOVE '1'       DRCR
     C                     END
     C**TABTE10****OBTAIN*THE*ACCOUNT*CODE*DETAILS*********************                       CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                           CGL029
     C**********           MOVE '      '  ZTABKY                                              CGL029
     C**********           MOVELCOMS      WK5A    5                                           CGL029
     C**********           MOVE '1'       WK5A                                                CGL029
     C**********           MOVE WK5A      ZTABKY                                              CGL029
     C**
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE                       CGL029
     C*
     C********** *IN99     IFEQ '1'                                                           CGL029
     C********** RECITB    ORNE 'D'                                                           CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************                    CGL029
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  12 **                    CGL029
     C**********           Z-ADD12        WBASE   20       ***************                    CGL029
     C**********           EXSR ABORT                                                         CGL029
     C**********           END                                                                CGL029
     C*
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     MOVE COMS      PACCD                                               CGL029
     C                     Z-ADD12        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                                       CGL029
     C                     MOVE ATYPTB    ATYP
     C                     MOVE ACSCTB    ACSC                            S10736
     C                     MOVE SUSRND    RIND
     C           RIND      IFEQ 1                                         058846
     C                     BITON'0'       PRIN                            058846
     C                     END                                            058846
     C                     Z-ADD0         RRNM
     C                     Z-ADDRUND      VALD
     C                     MOVE '01'      ACSQ
     C                     MOVE COMS      ACOD
     C                     MOVE EECCY     CCY
     C                     MOVELNAR,1     PNAR
     C                     MOVE BICN      CNUM
     C                     MOVE 'P'       RECI
     C*                                                                   044670
     C**********           Z-ADDCNUM      KCNUM                                        044670 CSD027
     C                     MOVE CNUM      KCNUM                                               CSD027
     C                     MOVELCCY       KCCY                            044670
     C                     Z-ADDACOD      KACOD                           044670
     C                     Z-ADDACSQ      KACSQ                           044670
     C                     MOVELBRCA      KBRCA                           044670
     C           ACCKEY    CHAINACCNT                66                   044670
     C           *IN66     IFEQ '1'                                       044670
     C                     Z-ADD*ZEROS    ACNO                            044670
     C                     END                                            044670
     C*                                                                   050925
     C           ATYP      IFEQ 'R'                                       050925
     C/COPY WNCPYSRC,FT0220C032
     C                     Z-ADD93000     TRAT                            050925
     C/COPY WNCPYSRC,FT0220C033
     C                     ELSE                                           050925
     C                     Z-ADD*ZEROS    TRAT                            050925
     C                     END                                            050925
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   056031
      * Imbalance posting must have today as posting date                 056031
      *                                                                   056031
     C                     Z-ADDRUND      PSTD                            056031
     C*
     C* Retrieve the posting narrative:                                   S01522
     C*                                                                   S01522
     C                     MOVE KCNUM     ##CUST                          S01522
     C                     MOVE KCCY      ##CCY                           S01522
     C                     MOVE KACOD     ##ACCD                          S01522
     C                     MOVE KACSQ     ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE ASOC      ##ASOC                          S01522
     C                     MOVE ACNO      ##ACNO                          S01522
     C                     MOVE 'GB00010' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
      *                                                                   CAC001
      **  If Analytical Accounting is installed, use Primary Funding      CAC001
      **  Profit Centre for the suspense entry                            CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE FTPRFP    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01522
     C*                                                                   CEU013
     C* Generate extension record to file GEFP1APD if the Original        CEU013
     C*  currency and amount fields are non blank.                        CEU013
     C*                                                                   CEU013
     C                     EXSR GENPX1                                    CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANKS   OTRF                            187496
     C                     MOVE *BLANKS   OTST                            187496
     C                     MOVE *BLANKS   OTTP                            187496
     C                     MOVE *BLANKS   BOKC                            187496
      *                                                                   187496
     C                     EXCPTIMBAL
     C/COPY WNCPYSRC,FT0220C017
     C                     BITOF'0'       PRIN                            058846
     C*
     C                     Z-ADDBALSUS    PRMAMT
     C                     Z-ADD2         H
     C                     EXSR HASH
     C* END OF ENTRY SET-UP
     C                     END
     C                     Z-ADD0         BALSUS
     C                     ADD  1         U
     C* END OF DO LOOP
     C                     END
     C                     MOVE ECCY      EECCY   3
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   CREATE A SEPERATE SET OF HASH TOTALS FOR EACH RECORD.
     C**
     C           HASH      BEGSR                           ** HASH   **
     C*
     C                     MOVE ZERO15    ZZAMT
     C                     MOVE ZERO15    ZZTOTI
     C                     MOVE ZERO15    ZZTOTD
     C*
     C                     ADD  1         CTN#,H
     C                     MOVE PRMAMT    ZZAMT
     C           ZZAMT     IFLT 0
     C                     Z-SUBZZAMT     ZZAMT
     C                     END
     C                     MOVE CTI#,H    ZZTOTI
     C                     MOVE CTD#,H    ZZTOTD
     C                     EXSR GLZADD
     C                     MOVE ZZTOTI    CTI#,H
     C                     MOVE ZZTOTD    CTD#,H
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
0760 C********************************************************************
0761 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0762 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0763 C*
0764 C           GLZADD    BEGSR                           *** GLZADD ****
0765 C*
0766 C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0767 C   91                GOTO ZZAEND                     AMT = 0.BYPASS
0768 C*
0769 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0770 C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0771 C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0772 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0773 C*
0774 C                     EXSR GLZSUM
0775 C           ZZAEND    ENDSR                           ** ZZAEND TAG *
0777 C********************************************************************
     I/EJECT
0777 C********************************************************************
0778 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0779 C*                        GLZADD, GLZSUB, GLZCMP.
0780 C*          PARAMETERS PASSED -
0781 C*                     I/P ZZAMTI ZZAMTD
0782 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0783 C*
0784 C           GLZSUM    BEGSR                           *** GLZSUM ****
0785 C*
0786 C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0787 C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0788 C                     SETOF                     919293
0789 C                     SETOF                     949599
0790 C*
0791 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0792 C           ZZAMTI    COMP 0                      9293
0793 C   93      ZZAMTD    COMP 0                      9293
0794 C   93                GOTO ZZSEND                     ZERO BYPASS
0795 C*
0796 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0797 C           ZZTOTI    COMP 0                      9193
0798 C   93      ZZTOTD    COMP 0                      9193
0799 C*
0800 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0801 C   93                Z-ADDZZAMTI    ZZTOTI
0802 C   93                Z-ADDZZAMTD    ZZTOTD
0803 C   93                GOTO ZZSEND                     ZERO BYPASS
0804 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0805 C   91N92
0806 CORN91 92             GOTO ZZOFPS
0807 C*
0808 C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0809 C           ZZWK2     COMP 999                  93    '93' = CARRY
0810 C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
0811 C*
0812 C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0813 C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0814 C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
0815 C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0816 C*
0817 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0818 C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0819 C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0820 C  N99                Z-ADDZZWK2     ZZTOTD
0821 C  N99                Z-ADDZZWK3     ZZTOTI
0822 C*
0823 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0824 C   99                Z-ADD0         ZZAMT  153
0825 C                     GOTO ZZSEND
0826 C*
0827 C* THE 'SIGNS' ARE DIFFERENT
0828 C           ZZOFPS    TAG                             ** ZZOFPS TAG**
0829 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0830 C*
0831 C   92                Z-SUBZZAMTI    ZZAMTI 150
0832 C   92                Z-SUBZZAMTD    ZZAMTD  30
0833 C*
0834 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0835 C*
0836 C   91                Z-SUBZZTOTI    ZZTOTI
0837 C   91                Z-SUBZZTOTD    ZZTOTD
0838 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0839 C*
0840 C           ZZTOTI    COMP ZZAMTI               93  95
0841 C   95      ZZTOTD    COMP ZZAMTD               93  95
0842 C*
0843 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0844 C   95                Z-ADD0         ZZTOTI
0845 C   95                Z-ADD0         ZZTOTD
0846 C   95                GOTO ZZSEND
0847 C*
0848 C* IF ZZTOT GT. ZZAMT.
0849 C   93      ZZAMTD    COMP ZZTOTD               94
0850 C   93 94   ZZTOTI    SUB  1         ZZTOTI
0851 C   93 94   ZZTOTD    ADD  1000      ZZWK2
0852 C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0853 C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0854 C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0855 C*
0856 C*
0857 C* IF ZZAMT GT. ZZTOT.
0858 C  N93      ZZTOTD    COMP ZZAMTD               94
0859 C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
0860 C  N93 94   ZZAMTD    ADD  1000      ZZWK2
0861 C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0862 C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0863 C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0864 C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0865 C*
0866 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0867 C                     SETOF                     94
0868 C   93 91
0869 CORN93 92             SETON                     94
0870 C   94                Z-SUBZZTOTI    ZZTOTI
0871 C   94                Z-SUBZZTOTD    ZZTOTD
0872 C**
0873 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0874 C   92                Z-SUBZZAMTI    ZZAMTI
0875 C   92                Z-SUBZZAMTD    ZZAMTD
0876 C           ZZSEND    TAG                             ** ZZSEND TAG *
0877 C**
0878 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0879 C                     SETOF                     96
0880 C           ZZTOTD    COMP 0                        91
0881 C   91      ZZTOTI    COMP 0                      96
0882 C   96                MOVE '.000-'   ZZNEGD  5
0883 C                     ENDSR                             ** ENDSR **
3806 C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   TO LOOK-UP THE CCY AND FIND DEC. POSITIONS
     C**
     C           CCYSR     BEGSR                           ** CCYARR **
     C                     Z-ADD001       Z
     C           CRNCY     LOKUPCCYA,Z                   50
     C*
     C           *IN50     IFEQ '0'
     C                     MOVE 'TABFP'   WBFILE
     C                     MOVE *BLANKS   KEY
     C                     MOVE '1'       SRECTB
     C                     MOVE CRNCY     CCYTB
     C                     MOVE '20'      RECTTB           ***************
     C                     MOVELKEY       WBKEY            ** DBERR  06 **
     C                     Z-ADD06        WBASE            ***************
     C                     EXSR ABORT
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   TO OUTPUT EXTRA RECORDS TO GEFPD IF POSTING REF = 2
     C**
     C           EXTRA     BEGSR                           ** EXTRA **
     C                     MOVELAKEY      GEFKEY                                            AR988246
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
      *                                                                                       CGL020
     C**********           MOVELAKEY      GEFKEY                                     CGL020 AR988246
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     MOVE *BLANKS   FEEVAL                                              CGL020
     C                     MOVE *BLANKS   FEEPCT                                              CGL020
     C                     MOVELFPTRID    FDTRID                                              CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD*ZEROS    SETDAT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD*ZEROS    NOMINL                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   051400
      * Initialise ASOC to zero                                           051400
      *                                                                   051400
     C**********           Z-ADD0         ASOC                                         051400 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
      *                                                                   051400
     C*
     C**TABLETR****OBTAIN*THE*VALUES*OUTPUT*FROM*FTDB*                    S01117
     C**(ALTHOUGH*COULD*MOVE*AT*FIRST*CYCLE,FULL*MULTIBRANCHING*          S01117
     C***WILL*NEED*CODING*AT*THIS*POINT,AS*BOOKING*BRANCH*COULD*          S01117
     C***DIFFER*FOR*EACH*TRADE*WHEN*FULLY*CONVERTED)*                     S01117
     C*********************                                               S01117
     C*********************MOVE *BLANKS   ZTABKY                          S01117
     C*********************MOVEL'10    '  ZTABKY 12                       S01117
     C*********************MOVE FTDB      ZTABKY                          S01117
     C*********************                                               S01117
     C***********ZTABKY****CHAINTABFP                99    ON NOT THERE   S01117
     C*********************                                               S01117
     C************IN99*****IFEQ '1'                        ### B001       S01117
     C***********RECITB****ORNE 'D'                                       S01117
     C*********************MOVE 'TABLE'   WBFILE  5        ***************S01117
     C*********************MOVELZTABKY    WBKEY  28        ** DBERR  09 **S01117
     C*********************Z-ADD09        WBASE   20       ***************S01117
     C*********************EXSR ABORT                                     S01117
     C*********************END                             ### E001       S01117
     C*                                                                   S01117
     C** READ SDBRCHPD VIA ACCESS PROGRAM AOBRCHR0                        S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCAFP    @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C* IF NO RECORD FOUND ON SDBRCHPD,DATABASE ERROR PROCESSING          S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE 'SDBRCHPD'WBFILE           ***************S01117
     C                     MOVEL@OPTN     WBKEY            * DB ERROR 09 *S01117
     C                     Z-ADD09        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     END                                            S01117
     C**TABTE10****OBTAIN*THE*ACCOUNT*CODE*DETAILS*********************                       CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                           CGL029
     C**********           MOVE '      '  ZTABKY                                              CGL029
     C*********************MOVELNBACB     WK5A    5                       S01117
     C********** DRCR      IFEQ 1                                                      S01117 CGL029
     C**********           MOVELA8DTAC    WK5A                                         S01117 CGL029
     C**********           END                                                         S01117 CGL029
     C********** DRCR      IFEQ 0                                                      S01117 CGL029
     C**********           MOVELA8DFAC    WK5A                                         S01117 CGL029
     C**********           END                                                         S01117 CGL029
     C**********           MOVE '1'       WK5A                                                CGL029
     C**********           MOVE WK5A      ZTABKY                                              CGL029
     C**
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE                       CGL029
     C*
     C********** *IN99     IFEQ '1'                        ### B001                           CGL029
     C********** RECITB    ORNE 'D'                                                           CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************                    CGL029
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  03 **                    CGL029
     C**********           Z-ADD03        WBASE   20       ***************                    CGL029
     C**********           EXSR ABORT                                                         CGL029
     C**********           END                             ### E001                           CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR      WHEQ 1                                                             CGL029
     C                     MOVE A8DTAC    PACCD                                               CGL029
     C           DRCR      WHEQ 0                                                             CGL029
     C                     MOVE A8DFAC    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD3         WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
     C*
     C*********            MOVE BICN      KCNUM                           190237
     C                     MOVE A8BICN    KCNUM                           190237
     C*********************MOVE NBACB     KACOD                           S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVE A8DTAC    KACOD                           S01117
     C                     END                                            S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     MOVE A8DFAC    KACOD                           S01117
     C                     END                                            S01117
     C                     MOVE '01'      KACSQ
     C                     MOVELACCID     STORE1
     C*********************MOVE FTDB      BRCD1                           S01117
     C                     MOVE BRCAFP    BRCD1                           S01117
     C                     MOVE ATYPTB    ATYP1   1
     C                     MOVE ACSCTB    ACSC1   2                       S10736
     C*
     C** SET UP ACNO AND RRNM FOR FIRST EXTRA POSTING                     E25537
     C*                                                                   E25537
     C           *LIKE     DEFN ACNO      ACNO1                           E25537
     C           *LIKE     DEFN RRNM      RRNM1                           E25537
     C           ACCKEY    CHAINACCNT                66                   E25537
     C           *IN66     IFEQ '1'                                       E25537
     C           RECIAC    ORNE 'D'                                       E25537
     C                     Z-ADD*ZEROS    ACNO1                           E25537
     C                     Z-ADD*ZEROS    RRNM1                           E25537
     C                     ELSE                                           E25537
     C                     Z-ADDACNO      ACNO1                           E25537
     C                     Z-ADDRRNM      RRNM1                           E25537
     C                     END                                            E25537
     C*                                                                   E25537
     C**TABLETR****OBTAIN*THE*VALUES*FOR*OUTPUT*FROM*SETTLE*SIDE********  190237
     C**********           MOVEL'10    '  ZTABKY 12                       190237
     C**********           MOVE '      '  ZTABKY                          190237
     C*********************MOVE BRCD      ZTABKY                   S01117 S01117
     C**********           MOVE BRCA      ZTABKY                   S01117 S01117
     C**********                                                          190237
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE   190237
     C**********                                                          190237
     C********** *IN99     IFEQ '1'                        ### B001       190237
     C********** RECITB    ORNE 'D'                                       190237
     C**********           MOVE 'TABLE'   WBFILE  5        ***************190237
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  10 **190237
     C**********           Z-ADD10        WBASE   20       ***************190237
     C**********           EXSR ABORT                                     190237
     C**********           END                             ### E001       190237
      *                                                                   190237
      ** READ SDBRCHPD VIA ACCESS PROGRAM AOBRCHR0                        190237
      *                                                                   190237
     C**********           CALL 'AOBRCHR0'                                190237              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       190237
     C                     PARM '*KEY   ' @OPTN   7                       190237
     C                     PARM BRCA      @BRCD   3                       190237
     C********** SDBRCH    PARM SDBRCH    DSFDY                           190237              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   190237
      ** IF NO RECORD FOUND ON SDBRCHPD,DATABASE ERROR PROCESSING         190237
      *                                                                   190237
     C           @RTCD     IFNE *BLANKS                                   190237
     C                     MOVE 'SDBRCHPD'WBFILE           ***************190237
     C                     MOVEL@OPTN     WBKEY            * DB ERROR 10 *190237
     C                     Z-ADD10        WBASE            ***************190237
     C                     EXSR ABORT                                     190237
     C                     END                                            190237
      *                                                                   190237
     C**TABTE10****OBTAIN*THE*ACCOUNT*CODE*DETAILS*********************                       CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                           CGL029
     C**********           MOVE '      '  ZTABKY                                              CGL029
     C*********************MOVELNBACB     WK5A    5                       S01117
     C********** DRCR      IFEQ 0                                                      S01117 CGL029
     C**********           MOVELA8DTAC    WK5A                                         S01117 CGL029
     C**********           END                                                         S01117 CGL029
     C********** DRCR      IFEQ 1                                                      S01117 CGL029
     C**********           MOVELA8DFAC    WK5A                                         S01117 CGL029
     C**********           END                                                         S01117 CGL029
     C**********           MOVE '1'       WK5A                                                CGL029
     C**********           MOVE WK5A      ZTABKY                                              CGL029
     C**
     C********** ZTABKY    CHAINTABFP                99    ON NOT THERE                       CGL029
     C*
     C********** *IN99     IFEQ '1'                        ### B001                           CGL029
     C********** RECITB    ORNE 'D'                                                           CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************                    CGL029
     C**********           MOVELZTABKY    WBKEY  28        ** DBERR  11 **                    CGL029
     C**********           Z-ADD11        WBASE   20       ***************                    CGL029
     C**********           EXSR ABORT                                                         CGL029
     C**********           END                             ### E001                           CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR      WHEQ 0                                                             CGL029
     C                     MOVE A8DTAC    PACCD                                               CGL029
     C           DRCR      WHEQ 1                                                             CGL029
     C                     MOVE A8DFAC    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD11        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
     C*
     C**********           MOVE BICN      KCNUM                           190237
     C                     MOVE A8BICN    KCNUM                           190237
     C*********************MOVE NBACB     KACOD                           S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     MOVE A8DTAC    KACOD                           S01117
     C                     END                                            S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVE A8DFAC    KACOD                           S01117
     C                     END                                            S01117
     C                     MOVE '01'      KACSQ
     C                     MOVELACCID     STORE2
     C*********************MOVE BRCD      BRCD2                           S01117
     C                     MOVE BRCA      BRCD2                           S01117
     C                     MOVE ATYPTB    ATYP2   1
     C                     MOVE ACSCTB    ACSC2   2                       S10736
     C*
     C** SET UP ACNO AND RRNM FOR SECOND EXTRA POSTING                    E25537
     C*                                                                   E25537
     C           *LIKE     DEFN ACNO      ACNO2                           E25537
     C           *LIKE     DEFN RRNM      RRNM2                           E25537
     C           ACCKEY    CHAINACCNT                66                   E25537
     C           *IN66     IFEQ '1'                                       E25537
     C           RECIAC    ORNE 'D'                                       E25537
     C                     Z-ADD*ZEROS    ACNO2                           E25537
     C                     Z-ADD*ZEROS    RRNM2                           E25537
     C                     ELSE                                           E25537
     C                     Z-ADDACNO      ACNO2                           E25537
     C                     Z-ADDRRNM      RRNM2                           E25537
     C                     END                                            E25537
     C*                                                                   E25537
     C* SET UP THE OTHER FIELDS FOR OUTPUT
     C*
     C**********           Z-ADD*ZEROS    ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD*ZEROS    CHQN
     C***********          Z-ADD*ZEROS    RIND                            E25537
     C                     Z-ADD*ZEROS    RRNM
     C                     MOVE *BLANKS   EXIN
     C                     MOVE *BLANKS   FACO
     C                     MOVE PNAR      WRK1   14
     C*                                                                   E22511
     C***********          MOVE NAR,3     PNAR                            E22511
     C                     MOVE NAR14     PNAR                            E22511
     C*                                                                   E22511
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0220CCP9                                           S01408
     C*                                                                   S01408
     C*  SWITCH ACCOUNT NUMBERS + OUTPUT
     C*********************MOVE CNUM1     CNUM                            S01117
     C                     MOVE CNUM2     CNUM                            S01117
     C                     MOVE CCY1      CCY
     C                     MOVE ACOD1     ACOD
     C                     MOVE ACSQ1     ACSQ
     C*********************MOVE BRCD1     BRCD                            S01117
     C                     MOVE BRCD1     BRCA                            S01117
     C                     MOVE ATYP1     ATYP
     C                     MOVE ACSC1     ACSC                            S10736
     C           ATYP1     IFEQ 'R'                                       E25537
     C                     BITON'0'       PRIN                            058846
     C                     Z-ADD1         RIND                            E25537
     C                     ELSE                                           E25537
     C                     Z-ADD0         RIND                            E25537
     C                     END                                            E25537
     C                     Z-ADDACNO1     ACNO                            E25537
     C                     Z-ADDRRNM1     RRNM                            E25537
     C*                                                                   050925
     C           ATYP      IFEQ 'R'                                       050925
     C/COPY WNCPYSRC,FT0220C034
     C                     Z-ADD93000     TRAT                            050925
     C/COPY WNCPYSRC,FT0220C035
     C                     ELSE                                           050925
     C                     Z-ADD*ZEROS    TRAT                            050925
     C                     END                                            050925
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   CAC001
      **  If Analytical Accounting is installed, use Primary Funding      CAC001
      **  Profit Centre for the interbranch entries                       CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE FTPRFP    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   S01522
     C*                                                                   CEU013
     C/COPY WNCPYSRC,FT0220C012
     C* Generate extension record to file GEFP1APD if the Original        CEU013
     C*  currency and amount fields are non blank.                        CEU013
     C*                                                                   CEU013
     C                     EXSR GENPX1                                    CEU013
     C/COPY WNCPYSRC,FT0220C022
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C*                                                                   CEU013
     C                     EXCPTGEFPDT                     'OUTPUT
     C/COPY WNCPYSRC,FT0220C018
     C                     BITOF'0'       PRIN                            058846
     C/COPY WNCPYSRC,FT0220C023
     C                     Z-ADDEAMT      PRMAMT
     C                     Z-ADD2         H
     C                     EXSR HASH
     C*
     C* ADD AMOUNT TO BRANCHES OCCURRENCE OF DATA STRUCTURE
     C                     EXSR ADDAMT
     C*
     C******   OUTPUT SECOND RECORD     **********
     C           DRCR      IFEQ 1
     C                     MOVE '0'       DRCR
     C                     ELSE
     C                     MOVE '1'       DRCR
     C                     END
     C*********************MOVE CNUM2     CNUM                            S01117
     C                     MOVE CNUM1     CNUM                            S01117
     C                     MOVE CCY2      CCY
     C                     MOVE ACOD2     ACOD
     C                     MOVE ACSQ2     ACSQ
     C*********************MOVE BRCD2     BRCD                            S01117
     C                     MOVE BRCD2     BRCA                            S01117
     C                     MOVE ATYP2     ATYP
     C                     MOVE ACSC2     ACSC                            S10736
     C           ATYP2     IFEQ 'R'                                       E25537
     C                     BITON'0'       PRIN                            058846
     C                     Z-ADD1         RIND                            E25537
     C                     ELSE                                           E25537
     C                     Z-ADD0         RIND                            E25537
     C                     END                                            E25537
     C                     Z-ADDACNO2     ACNO                            E25537
     C                     Z-ADDRRNM2     RRNM                            E25537
     C*                                                                   050925
     C           ATYP      IFEQ 'R'                                       050925
     C/COPY WNCPYSRC,FT0220C036
     C                     Z-ADD93000     TRAT                            050925
     C/COPY WNCPYSRC,FT0220C037
     C                     ELSE                                           050925
     C                     Z-ADD*ZEROS    TRAT                            050925
     C                     END                                            050925
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
     C*
     C* Retrieve the posting narrative:                                   S01522
     C*                                                                   S01522
     C                     MOVE 'GB00420' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C*                                                                   CEU013
     C/COPY WNCPYSRC,FT0220C013
     C* Generate extension record to file GEFP1APD if the Original        CEU013
     C*  currency and amount fields are non blank.                        CEU013
     C*                                                                   CEU013
     C                     EXSR GENPX1                                    CEU013
     C/COPY WNCPYSRC,FT0220C024
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C*                                                                   CEU013
     C                     EXCPTGEFPDT                     'OUTPUT
     C/COPY WNCPYSRC,FT0220C019
     C                     BITOF'0'       PRIN                            058846
     C*
     C* RESET POSTING NARRATIVE
     C*
     C                     MOVE WRK1      PNAR
     C*
     C                     Z-ADDEAMT      PRMAMT
     C                     Z-ADD2         H
     C                     EXSR HASH
     C*
     C* ADD AMOUNT TO BRANCHES OCCURRENCE OF DATA STRUCTURE
     C                     EXSR ADDAMT
      *                                                                   164066
      ** Reset branch customer number                                     164066
      *                                                                   164066
     C                     Z-ADD1         A       30                      164066
     C           BRCAFP    LOKUPBRN,A                    35               164066
     C           *IN35     IFEQ '1'                                       164066
     C           A         OCUR CHGBC                                     164066
     C                     MOVE BRBICN    BICN                            164066
     C                     END                                            164066
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT                                                              190237
      *****************************************************************   190237
      *                                                               *   190237
      *  EXTRA2 - To output four postings to PF/GEFPPD                *   190237
      *           Two postings for interbranch and another two        *   190237
      *           postings for the Main Branch.                       *   190237
      *                                                               *   190237
      *  Based from GL-Functional Specs                               *   190237
      *                                                                   190237
      *                Posting #2   Posting #4   Posting #3   Posting #1  190237
      *  Branch        Settlement   Main         Main         Booking     190237
      *  Customer      Main Brch    Sett Brch    Book Brch    Main Brch   190237
      *  Currency      Event Currency            Event Currency           190237
      *  A/c code (Cr) Sett Due Fr  Main Due To  Main Due Fr  Book Due To 190237
      *  A/c code (Dr) Sett Due To  Main Due Fr  Main Due To  Book Due Fr 190237
      *  A/c sequence  01           01           01           01          190237
      *  Deb/Cred (Cr) DR (0)       CR (1)       DR (0)       CR (1)      190237
      *  Deb/Cred (Dr) CR (1)       DR (0)       CR (1)       DR (0)      190237
      *                                                               *   190237
      *  Called by: GENKEY                                            *   190237
      *                                                               *   190237
      *  Calls: GENPX1, HASH, ADDAMT, SRPNAR                          *   190237
      *                                                               *   190237
      *****************************************************************   190237
      *                                                                   190237
     C           EXTRA2    BEGSR                                          190237
     C                     MOVELAKEY      GEFKEY                                            AR988246
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
      *                                                                                       CGL020
     C**********           MOVELAKEY      GEFKEY                                     CGL020 AR988246
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     MOVE *BLANKS   FEEVAL                                              CGL020
     C                     MOVE *BLANKS   FEEPCT                                              CGL020
     C                     MOVELFPTRID    FDTRID                                              CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD*ZEROS    SETDAT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD*ZEROS    NOMINL                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   190237
      ** Initialise ASOC to zero                                          190237
      *                                                                   190237
     C**********           Z-ADD0         ASOC                                         190237 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
      *                                                                   190237
      ** Initialise Debit/Credit Indicator                                190237
      *                                                                   190237
     C           DRCR      IFEQ 1                                         190237
     C                     MOVE '1'       DRCR1   10                      190237
     C                     MOVE '0'       DRCR2   10                      190237
     C                     MOVE '0'       DRCR3   10                      190237
     C                     MOVE '1'       DRCR4   10                      190237
     C                     ELSE                                           190237
     C                     MOVE '0'       DRCR1                           190237
     C                     MOVE '1'       DRCR2                           190237
     C                     MOVE '1'       DRCR3                           190237
     C                     MOVE '0'       DRCR4                           190237
     C                     ENDIF                                          190237
      *                                                                   190237
      ** Read SDBRCHPD (POSTING #1) - Booking Branch (Debit Side)         190237
      *                                                                   190237
     C**********           CALL 'AOBRCHR0'                                190237              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       190237
     C                     PARM '*KEY   ' @OPTN   7                       190237
     C                     PARM BRCAFP    @BRCD   3                       190237
     C********** SDBRCH    PARM SDBRCH    DSFDY                           190237              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   190237
      ** If record not found, database error                              190237
      *                                                                   190237
     C           @RTCD     IFNE *BLANKS                                   190237
     C                     MOVE 'SDBRCHPD'WBFILE           ***************190237
     C                     MOVEL@OPTN     WBKEY            * DB ERROR 041*190237
     C                     Z-ADD41        WBASE            ***************190237
     C                     EXSR ABORT                                     190237
     C                     END                                            190237
      *                                                                   190237
      ***TABTE10*-*Obtain*the*account*code*details*(Posting*#1)********                190237 CGL029
      *                                                                   190237
     C********** DRCR1     IFEQ 1                                                      190237 CGL029
     C**********           MOVELA8DTAC    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C********** DRCR1     IFEQ 0                                                      190237 CGL029
     C**********           MOVELA8DFAC    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C**********           MOVE '1'       WK5A                                         190237 CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                    190237 CGL029
     C**********           MOVE '      '  ZTABKY                                       190237 CGL029
     C**********           MOVE WK5A      ZTABKY                                       190237 CGL029
      *                                                                   190237
     C********** ZTABKY    CHAINTABFP                99                                190237 CGL029
      *                                                                   190237
     C********** *IN99     IFEQ '1'                                                    190237 CGL029
     C********** RECITB    ORNE 'D'                                                    190237 CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************             190237 CGL029
     C**********           MOVELZTABKY    WBKEY  28        * DB ERROR 042*             190237 CGL029
     C**********           Z-ADD42        WBASE   20       ***************             190237 CGL029
     C**********           EXSR ABORT                                                  190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR1     WHEQ 1                                                             CGL029
     C                     MOVE A8DTAC    PACCD                                               CGL029
     C           DRCR1     WHEQ 0                                                             CGL029
     C                     MOVE A8DFAC    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD42        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                   190237
      ** (POSTING #1)                                                     190237
      ** Current Branch customer number will be used in (Posting #3)      190237
      ** Use Main Branch Internal Customer number for (Posting #1)        190237
      *                                                                   190237
     C                     MOVE A8BICN    CNUM3                           190237
     C                     MOVE WMBICN    KCNUM                           190237
      *                                                                   190237
     C           DRCR1     IFEQ 1                                         190237
     C                     MOVE A8DTAC    KACOD                           190237
     C                     ENDIF                                          190237
      *                                                                   190237
     C           DRCR1     IFEQ 0                                         190237
     C                     MOVE A8DFAC    KACOD                           190237
     C                     ENDIF                                          190237
      *                                                                   190237
     C                     MOVE '01'      KACSQ                           190237
     C                     MOVE BRCAFP    KBRCA                           190237
     C                     MOVELACCID     STORE1                          190237
     C                     MOVE BRCAFP    BRCD1                           190237
     C                     MOVE ATYPTB    ATYP1   1                       190237
     C                     MOVE ACSCTB    ACSC1   2                       190237
      *                                                                   190237
      ** Set up ACNO & RRNM (Posting #1)                                  190237
      *                                                                   190237
     C           ACCKEY    CHAINACCNT                66                   190237
      *                                                                   190237
     C           *IN66     IFEQ '1'                                       190237
     C           RECIAC    ORNE 'D'                                       190237
     C                     Z-ADD*ZEROS    ACNO1                           190237
     C                     Z-ADD*ZEROS    RRNM1                           190237
     C                     ELSE                                           190237
      *                                                                   190237
     C                     Z-ADDACNO      ACNO1                           190237
     C                     Z-ADDRRNM      RRNM1                           190237
     C                     END                                            190237
      *                                                                   190237
      ** Processing for (POSTING #2) - Settlement/Credit Side             190237
      ** Read SDBRCHPD                                                    190237
      *                                                                   190237
     C**********           CALL 'AOBRCHR0'                                190237              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       190237
     C                     PARM '*KEY   ' @OPTN   7                       190237
     C                     PARM BRCA      @BRCD   3                       190237
     C********** SDBRCH    PARM SDBRCH    DSFDY                           190237              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   190237
      ** Record not found, database error processing                      190237
      *                                                                   190237
     C           @RTCD     IFNE *BLANKS                                   190237
     C                     MOVE 'SDBRCHPD'WBFILE           ***************190237
     C                     MOVEL@OPTN     WBKEY            * DB ERROR 043*190237
     C                     Z-ADD43        WBASE            ***************190237
     C                     EXSR ABORT                                     190237
     C                     END                                            190237
      *                                                                   190237
      ***TABTE10*-*obtain*account*code*details*(Posting*#2)************                190237 CGL029
      *                                                                   190237
     C********** DRCR2     IFEQ 1                                                      190237 CGL029
     C**********           MOVELA8DTAC    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C********** DRCR2     IFEQ 0                                                      190237 CGL029
     C**********           MOVELA8DFAC    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C**********           MOVE '1'       WK5A                                         190237 CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                    190237 CGL029
     C**********           MOVE '      '  ZTABKY                                       190237 CGL029
     C**********           MOVE WK5A      ZTABKY                                       190237 CGL029
      *                                                                   190237
     C********** ZTABKY    CHAINTABFP                99                                190237 CGL029
      *                                                                   190237
     C********** *IN99     IFEQ '1'                                                    190237 CGL029
     C********** RECITB    ORNE 'D'                                                    190237 CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************             190237 CGL029
     C**********           MOVELZTABKY    WBKEY  28        *DB ERROR  044*             190237 CGL029
     C**********           Z-ADD44        WBASE   20       ***************             190237 CGL029
     C**********           EXSR ABORT                                                  190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR2     WHEQ 1                                                             CGL029
     C                     MOVE A8DTAC    PACCD                                               CGL029
     C           DRCR2     WHEQ 0                                                             CGL029
     C                     MOVE A8DFAC    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD42        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                   190237
      ** (POSTING #2)                                                     190237
      ** Current Branch customer number will be used in (Posting #4)      190237
      ** Use Main Branch Internal Customer number for (Posting #2)        190237
      *                                                                   190237
     C                     MOVE A8BICN    CNUM4                           190237
     C                     MOVE WMBICN    KCNUM                           190237
      *                                                                   190237
     C           DRCR2     IFEQ 1                                         190237
     C                     MOVE A8DTAC    KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C           DRCR2     IFEQ 0                                         190237
     C                     MOVE A8DFAC    KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C                     MOVE '01'      KACSQ                           190237
     C                     MOVE BRCA      KBRCA                           190237
     C                     MOVELACCID     STORE2                          190237
     C                     MOVE BRCA      BRCD2                           190237
     C                     MOVE ATYPTB    ATYP2   1                       190237
     C                     MOVE ACSCTB    ACSC2   2                       190237
      *                                                                   190237
      ** Set up ACNO & RRNM for (Posting #2)                              190237
      *                                                                   190237
     C           ACCKEY    CHAINACCNT                66                   190237
      *                                                                   190237
     C           *IN66     IFEQ '1'                                       190237
     C           RECIAC    ORNE 'D'                                       190237
     C                     Z-ADD*ZEROS    ACNO2                           190237
     C                     Z-ADD*ZEROS    RRNM2                           190237
     C                     ELSE                                           190237
      *                                                                   190237
     C                     Z-ADDACNO      ACNO2                           190237
     C                     Z-ADDRRNM      RRNM2                           190237
     C                     END                                            190237
      *                                                                   190237
      ** Processing for (POSTING #3)                                      190237
      **                                                                  190237
      ***TABTE10*-*Obtain*the*account*code*details*(Posting*#3)********                190237 CGL029
      ***Main*Branch*details:*WMDTO*=A8DTAC*-*Due*To*******************                190237 CGL029
      ************************WMDFRM=A8DFAC*-*Due*From*****************                190237 CGL029
      *                                                                   190237
     C********** DRCR3     IFEQ 1                                                      190237 CGL029
     C**********           MOVELWMDTO     WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C********** DRCR3     IFEQ 0                                                      190237 CGL029
     C**********           MOVELWMDFRM    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C**********           MOVE '1'       WK5A                                         190237 CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                    190237 CGL029
     C**********           MOVE '      '  ZTABKY                                       190237 CGL029
     C**********           MOVE WK5A      ZTABKY                                       190237 CGL029
      *                                                                   190237
     C********** ZTABKY    CHAINTABFP                99                                190237 CGL029
      *                                                                   190237
     C********** *IN99     IFEQ '1'                                                    190237 CGL029
     C********** RECITB    ORNE 'D'                                                    190237 CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************             190237 CGL029
     C**********           MOVELZTABKY    WBKEY  28        * DB ERROR 045*             190237 CGL029
     C**********           Z-ADD45        WBASE   20       ***************             190237 CGL029
     C**********           EXSR ABORT                                                  190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR3     WHEQ 1                                                             CGL029
     C                     MOVELWMDTO     PACCD                                               CGL029
     C           DRCR3     WHEQ 0                                                             CGL029
     C                     MOVELWMDFRM    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD45        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                   190237
      ** (POSTING #3)                                                     190237
      ** Use the Branch Internal Customer number of Posting #1            190237
      *                                                                   190237
     C                     MOVE CNUM3     KCNUM                           190237
      *                                                                   190237
     C           DRCR3     IFEQ 1                                         190237
     C                     MOVE WMDTO     KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C           DRCR3     IFEQ 0                                         190237
     C                     MOVE WMDFRM    KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C                     MOVE '01'      KACSQ                           190237
     C                     MOVE BKMABR    KBRCA                           190237
     C                     MOVELACCID     STORE3                          190237
     C                     MOVE BKMABR    BRCD3                           190237
     C                     MOVE ATYPTB    ATYP3   1                       190237
     C                     MOVE ACSCTB    ACSC3   2                       190237
      *                                                                   190237
      ** Set up ACNO & RRNM (Posting #3)                                  190237
      *                                                                   190237
     C           *LIKE     DEFN ACNO      ACNO3                           190237
     C           *LIKE     DEFN RRNM      RRNM3                           190237
     C           ACCKEY    CHAINACCNT                66                   190237
      *                                                                   190237
     C           *IN66     IFEQ '1'                                       190237
     C           RECIAC    ORNE 'D'                                       190237
     C                     Z-ADD*ZEROS    ACNO3                           190237
     C                     Z-ADD*ZEROS    RRNM3                           190237
     C                     ELSE                                           190237
      *                                                                   190237
     C                     Z-ADDACNO      ACNO3                           190237
     C                     Z-ADDRRNM      RRNM3                           190237
     C                     END                                            190237
      *                                                                   190237
      ** Processing for (POSTING #4)                                      190237
      *                                                                   190237
      ***TABTE10*-*obtain*account*code*details*(Posting*#4)************                190237 CGL029
      ***Main*Branch*details:*WMDTO*=A8DTAC*-*Due*To*******************                190237 CGL029
      ************************WMDFRM=A8DFAC*-*Due*From*****************                190237 CGL029
      *                                                                   190237
     C********** DRCR4     IFEQ 1                                                      190237 CGL029
     C**********           MOVELWMDTO     WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C********** DRCR4     IFEQ 0                                                      190237 CGL029
     C**********           MOVELWMDFRM    WK5A                                         190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                   190237
     C**********           MOVE '1'       WK5A                                         190237 CGL029
     C**********           MOVEL'30    '  ZTABKY 12                                    190237 CGL029
     C**********           MOVE '      '  ZTABKY                                       190237 CGL029
     C**********           MOVE WK5A      ZTABKY                                       190237 CGL029
      *                                                                   190237
     C********** ZTABKY    CHAINTABFP                99                                190237 CGL029
      *                                                                   190237
     C********** *IN99     IFEQ '1'                                                    190237 CGL029
     C********** RECITB    ORNE 'D'                                                    190237 CGL029
     C**********           MOVE 'TABLE'   WBFILE  5        ***************             190237 CGL029
     C**********           MOVELZTABKY    WBKEY  28        *DB ERROR  046*             190237 CGL029
     C**********           Z-ADD46        WBASE   20       ***************             190237 CGL029
     C**********           EXSR ABORT                                                  190237 CGL029
     C**********           END                                                         190237 CGL029
      *                                                                                       CGL029
     C                     MOVE *BLANKS   PACCD                                               CGL029
     C                     SELEC                                                              CGL029
     C           DRCR4     WHEQ 1                                                             CGL029
     C                     MOVELWMDTO     PACCD                                               CGL029
     C           DRCR4     WHEQ 0                                                             CGL029
     C                     MOVELWMDFRM    PACCD                                               CGL029
     C                     ENDSL                                                              CGL029
     C                     Z-ADD46        WDBNO                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     MOVE A5ACTY    ATYPTB                                              CGL029
     C                     MOVE A5ACSC    ACSCTB                                              CGL029
      *                                                                   190237
      ** (POSTING #4)                                                     190237
      ** Use the Branch Internal Customer number of Posting #1            190237
      *                                                                   190237
     C                     MOVE CNUM4     KCNUM                           190237
      *                                                                   190237
     C           DRCR4     IFEQ 1                                         190237
     C                     MOVE WMDTO     KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C           DRCR4     IFEQ 0                                         190237
     C                     MOVE WMDFRM    KACOD                           190237
     C                     END                                            190237
      *                                                                   190237
     C                     MOVE '01'      KACSQ                           190237
     C                     MOVE BKMABR    KBRCA                           190237
     C                     MOVELACCID     STORE4                          190237
     C                     MOVE BKMABR    BRCD4                           190237
     C                     MOVE ATYPTB    ATYP4   1                       190237
     C                     MOVE ACSCTB    ACSC4   2                       190237
      *                                                                   190237
      ** Set up ACNO & RRNM for (Posting #4)                              190237
      *                                                                   190237
     C           *LIKE     DEFN ACNO      ACNO4                           190237
     C           *LIKE     DEFN RRNM      RRNM4                           190237
     C           ACCKEY    CHAINACCNT                66                   190237
      *                                                                   190237
     C           *IN66     IFEQ '1'                                       190237
     C           RECIAC    ORNE 'D'                                       190237
     C                     Z-ADD*ZEROS    ACNO4                           190237
     C                     Z-ADD*ZEROS    RRNM4                           190237
     C                     ELSE                                           190237
      *                                                                   190237
     C                     Z-ADDACNO      ACNO4                           190237
     C                     Z-ADDRRNM      RRNM4                           190237
     C                     END                                            190237
      *                                                                   190237
      ** Setup other common fields for output                             190237
      *                                                                   190237
     C**********           Z-ADD*ZEROS    ASOC                                         190237 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD*ZEROS    CHQN                            190237
     C                     Z-ADD*ZEROS    RRNM                            190237
     C                     MOVE *BLANKS   EXIN                            190237
     C                     MOVE *BLANKS   FACO                            190237
     C                     MOVE PNAR      WRK1   14                       190237
      *                                                                   190237
     C                     MOVE NAR14     PNAR                            190237
      *                                                                   190237
      ** Format (Posting #1)                                              190237
      *                                                                   190237
     C                     MOVE CNUM1     CNUM                            190237
     C                     MOVE CCY1      CCY                             190237
     C                     MOVE ACOD1     ACOD                            190237
     C                     MOVE ACSQ1     ACSQ                            190237
     C                     MOVE BRCD1     BRCA                            190237
     C                     MOVE DRCR1     DRCR                            190237
      *                                                                   190237
     C                     MOVE ATYP1     ATYP                            190237
     C                     MOVE ACSC1     ACSC                            190237
     C                     Z-ADDACNO1     ACNO                            190237
     C                     Z-ADDRRNM1     RRNM                            190237
      *                                                                   190237
     C           ATYP1     IFEQ 'R'                                       190237
     C                     BITON'0'       PRIN                            190237
     C                     Z-ADD1         RIND                            190237
     C                     ELSE                                           190237
     C                     Z-ADD0         RIND                            190237
     C                     ENDIF                                          190237
      *                                                                   190237
      *                                                                   190237
     C           ATYP      IFEQ 'R'                                       190237
     C                     Z-ADD93000     TRAT                            190237
     C                     ELSE                                           190237
     C                     Z-ADD*ZEROS    TRAT                            190237
     C                     END                                            190237
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   190237
      ** If Analytical Accounting is installed, use Primary Funding       190237
      ** Profit Centre for the interbranch entries                        190237
      *                                                                   190237
     C           BGN0ST    IFEQ 'Y'                                       190237
     C                     MOVE FTPRFP    PRFC                            190237
     C                     ENDIF                                          190237
      *                                                                   190237
      ** Generate extension record to file GEFP1APD if the Original       190237
      ** currency and amount fields are non blank.                        190237
      *                                                                   190237
     C                     EXSR GENPX1                                    190237
      *                                                                   190237
      ** Output to PF/GEFPPD (Posting #1)                                 190237
      *                                                                   190237
     C/COPY WNCPYSRC,FTH00386
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     EXCPTGEFPDT                                    190237
      *                                                                   190237
     C                     BITOF'0'       PRIN                            190237
     C                     Z-ADDEAMT      PRMAMT                          190237
     C                     Z-ADD2         H                               190237
     C                     EXSR HASH                                      190237
      *                                                                   190237
      ** Add amount to branches occurance of data structure               190237
      *                                                                   190237
     C                     EXSR ADDAMT                                    190237
      *                                                                   190237
      ** Format (Posting #2)                                              190237
      *                                                                   190237
     C                     MOVE CNUM2     CNUM                            190237
     C                     MOVE CCY2      CCY                             190237
     C                     MOVE ACOD2     ACOD                            190237
     C                     MOVE ACSQ2     ACSQ                            190237
     C                     MOVE BRCD2     BRCA                            190237
     C                     MOVE DRCR2     DRCR                            190237
      *                                                                   190237
     C                     MOVE ATYP2     ATYP                            190237
     C                     MOVE ACSC2     ACSC                            190237
     C                     Z-ADDACNO2     ACNO                            190237
     C                     Z-ADDRRNM2     RRNM                            190237
      *                                                                   190237
     C           ATYP2     IFEQ 'R'                                       190237
     C                     BITON'0'       PRIN                            190237
     C                     Z-ADD1         RIND                            190237
     C                     ELSE                                           190237
     C                     Z-ADD0         RIND                            190237
     C                     ENDIF                                          190237
      *                                                                   190237
     C           ATYP      IFEQ 'R'                                       190237
     C                     Z-ADD93000     TRAT                            190237
     C                     ELSE                                           190237
     C                     Z-ADD*ZEROS    TRAT                            190237
     C                     END                                            190237
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   190237
      ** Retrieve the posting narrative:                                  190237
      *                                                                   190237
     C                     MOVE 'GB00420' ##MGID                          190237
     C                     EXSR SRPNAR                                    190237
      *                                                                   190237
      ** Generate extension record to file GEFP1APD if the Original       190237
      ** currency and amount fields are non blank.                        190237
      *                                                                   190237
     C                     EXSR GENPX1                                    190237
      *                                                                   190237
      ** Output to PF/GEFPPD (Posting #2)                                 190237
      *                                                                   190237
     C/COPY WNCPYSRC,FTH00387
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     EXCPTGEFPDT                                    190237
      *                                                                   190237
     C                     BITOF'0'       PRIN                            190237
     C                     Z-ADDEAMT      PRMAMT                          190237
     C                     Z-ADD2         H                               190237
     C                     EXSR HASH                                      190237
      *                                                                   190237
      ** Add amount to branches occurrence of data structure              190237
      *                                                                   190237
     C                     EXSR ADDAMT                                    190237
      *                                                                   190237
      ** Format (Posting #3)                                              190237
      *                                                                   190237
     C                     MOVE NAR14     PNAR                            190237
     C                     MOVE CNUM3     CNUM                            190237
     C                     MOVE CCY3      CCY                             190237
     C                     MOVE ACOD3     ACOD                            190237
     C                     MOVE ACSQ3     ACSQ                            190237
     C                     MOVE BRCD3     BRCA                            190237
     C                     MOVE DRCR3     DRCR                            190237
      *                                                                   190237
     C                     MOVE ATYP3     ATYP                            190237
     C                     MOVE ACSC3     ACSC                            190237
     C                     Z-ADDACNO3     ACNO                            190237
     C                     Z-ADDRRNM3     RRNM                            190237
      *                                                                   190237
     C           ATYP3     IFEQ 'R'                                       190237
     C                     BITON'0'       PRIN                            190237
     C                     Z-ADD1         RIND                            190237
     C                     ELSE                                           190237
     C                     Z-ADD0         RIND                            190237
     C                     ENDIF                                          190237
      *                                                                   190237
     C           ATYP      IFEQ 'R'                                       190237
     C                     Z-ADD93000     TRAT                            190237
     C                     ELSE                                           190237
     C                     Z-ADD*ZEROS    TRAT                            190237
     C                     END                                            190237
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   190237
      ** Generate extension record to file GEFP1APD if the Original       190237
      ** currency and amount fields are non blank.                        190237
      *                                                                   190237
     C                     EXSR GENPX1                                    190237
      *                                                                   190237
      ** Output to PF/GEFPPD                                              190237
      *                                                                   190237
     C/COPY WNCPYSRC,FTH00388
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     EXCPTGEFPDT                                    190237
      *                                                                   190237
     C                     BITOF'0'       PRIN                            190237
     C                     Z-ADDEAMT      PRMAMT                          190237
     C                     Z-ADD2         H                               190237
     C                     EXSR HASH                                      190237
      *                                                                   190237
      ** Add amount to branches occurance of data structure               190237
      *                                                                   190237
     C                     EXSR ADDAMT                                    190237
      *                                                                   190237
      ** Format (Posting #4)                                              190237
      *                                                                   190237
     C                     MOVE CNUM4     CNUM                            190237
     C                     MOVE CCY4      CCY                             190237
     C                     MOVE ACOD4     ACOD                            190237
     C                     MOVE ACSQ4     ACSQ                            190237
     C                     MOVE BRCD4     BRCA                            190237
     C                     MOVE DRCR4     DRCR                            190237
      *                                                                   190237
     C                     MOVE ATYP4     ATYP                            190237
     C                     MOVE ACSC4     ACSC                            190237
     C                     Z-ADDACNO4     ACNO                            190237
     C                     Z-ADDRRNM4     RRNM                            190237
      *                                                                   190237
     C           ATYP4     IFEQ 'R'                                       190237
     C                     BITON'0'       PRIN                            190237
     C                     Z-ADD1         RIND                            190237
     C                     ELSE                                           190237
     C                     Z-ADD0         RIND                            190237
     C                     ENDIF                                          190237
      *                                                                   190237
     C           ATYP      IFEQ 'R'                                       190237
     C                     Z-ADD93000     TRAT                            190237
     C                     ELSE                                           190237
     C                     Z-ADD*ZEROS    TRAT                            190237
     C                     END                                            190237
      *                                                                                     BUG22979
     C           CER030    IFEQ 'Y'                                                         BUG22979
     C           TRAT      ANDEQ93000                                                       BUG22979
     C           CGL013    OREQ 'Y'                                                         MD024499
     C           TRAT      ANDEQ93000                                                       MD024499
     C           CRE098    OREQ 'Y'                                                           CRE098
     C           TRAT      ANDEQ93000                                                         CRE098
     C                     EXSR SRTRAT                                                      BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                   190237
      ** Generate extension record to file GEFP1APD if the Original       190237
      ** currency and amount fields are non blank.                        190237
      *                                                                   190237
     C                     EXSR GENPX1                                    190237
      *                                                                   190237
      ** Output to PF/GEFPPD (Posting #4)                                 190237
      *                                                                   190237
     C/COPY WNCPYSRC,FTH00389
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
     C           WNCD      ANDEQFTNCD                                                         CFT156
     C                     EXSR GETFPN                                                        CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     EXCPTGEFPDT                                    190237
      *                                                                   190237
     C                     BITOF'0'       PRIN                            190237
      *                                                                   190237
      ** Reset Posting narrative                                          190237
      *                                                                   190237
     C                     MOVE WRK1      PNAR                            190237
      *                                                                   190237
     C                     Z-ADDEAMT      PRMAMT                          190237
     C                     Z-ADD2         H                               190237
     C                     EXSR HASH                                      190237
      *                                                                   190237
      ** Add amount to branches occurrence of data structure              190237
      *                                                                   190237
     C                     EXSR ADDAMT                                    190237
      *                                                                   190237
     C                     ENDSR                                          190237
      *                                                                   190237
      ********************************************************************190237
     C/EJECT
3806 C********************************************************************
4843 C**
4844 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
4845 C**
4846 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
4847 C**
4848 C           ZDATE2    BEGSR                           *** ZDATE2 ***
4849 C**
4850 C**   CLEAR DATE FIELDS.
4851 C                     Z-ADD0         ZDATE   60
4852 C                     MOVEL'       ' ZADATE  7
4853 C**
4854 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
4855 C                     Z-ADDZDAYNO    ZDAYNO  50
4856 C**
4857 C**   DETERMINE YEAR NUMBER.
4858 C**
4859 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
4860 C           ZDAYNO    SUB  1         ZDAYN1  50   99
4861 C   99                GOTO ZDEND2
4862 C**
4863 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
4864 C           ZDAYN1    DIV  1461      ZLYR    20
4865 C                     MVR            ZDAYN1           SAVE REMAINING
4866 C**                                                   DAYS
4867 C**   CALCULATE NUMBER OF REMAINING YEARS.
4868 C                     Z-ADD1         ZWRK2   20
4869 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
4870 C           ZDAYN1    COMP ZYDY,ZWRK2             90
4871 C  N90      ZWRK2     ADD  1         ZWRK2
4872 C  N90                GOTO ZDTAG1
4873 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
4874 C**
4875 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
4876 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
4877 C**
4878 C**   CALCULATE ACTUAL YEAR NUMBER.
4879 C           ZLYR      MULT 4         ZWRK3   30
4880 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
4881 C                     Z-ADDZWRK3     ZYEAR   20
4882 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
4883 C**
4884 C**   DETERMINE MONTH NUMBER.
4885 C**
4886 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
4887 C                     SETOF                     9293
4888 C   91      ZDAYN1    COMP 59                     9293
4889 C   91N92   ZDAYN1    SUB  1         ZDAYN1
4890 C**
4891 C**   CALCULATE MONTH NUMBER.
4892 C                     Z-ADD2         ZWRK2
4893 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
4894 C           ZDAYN1    COMP ZMDY,ZWRK2             94
4895 C  N94      ZWRK2     ADD  1         ZWRK2
4896 C  N94                GOTO ZDTAG2
4897 C           ZWRK2     SUB  1         ZWRK2
4898 C**
4899 C                     Z-ADDZWRK2     ZMTH    20       MONTH
4900 C**
4901 C**   DETERMINE DAY OF MONTH.
4902 C**
4903 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
4904 C           ZDAYN1    ADD  1         ZDAYN1
4905 C**
4906 C**   CALCULATE DAY OF MONTH.
4907 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
4908 C**
4909 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
4910 C   93      ZDAY      ADD  1         ZDAY
4911 C**
4912 C**   FORMAT DATE, DDMMYY OR MMDDYY.
4913 C  N98                MOVELZDAY      ZWRK4   40
4914 C   98                MOVE ZDAY      ZWRK4
4915 C  N98                MOVE ZMTH      ZWRK4
4916 C   98                MOVELZMTH      ZWRK4
4917 C                     MOVELZWRK4     ZDATE
4918 C                     MOVE ZYEAR     ZDATE
4919 C**
4920 C**   FORMAT ALPHA DATE, DDMMMYY.
4921 C           ZDAY      COMP 10                     95
4922 C                     MOVELZDAY      ZWRK5   5
4923 C   95                MOVEL' '       ZWRK5
4924 C                     MOVE ZMNM,ZMTH ZWRK5
4925 C                     MOVELZWRK5     ZADATE
4926 C                     MOVE ZYEAR     ZADATE
4927 C**
4928 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
4929 C**
3903 C********************************************************************
     C/EJECT
     C********************************************************************
     C**   .. TRAILR ..
     C**   THIS SUBR. IS USED PERFORM ALL THE TRAILER PROCESSING
     C**
     C           TRAILR    BEGSR                           ** TRAILR **
     C*                                                                   S01117
     C* WHEN LAST RECORD IS READ FROM FPKEYDD FILE WRITE REPORT           S01117
     C* CLOSING DETAIL AND CLOSE REPORT FT0220P1                          S01117
     C*                                                                   S01117
     C           *IN21     IFEQ '1'                                       S01117
     C*
     C* A RECORD WITH AMISSING ACCOUNT KEY WAS FOUND
     C*                                                                   S01117
     C           MISSIN    IFEQ 'YES'
     C                     SETON                     U4
     C                     ELSE
     C                     MOVE *BLANKS   BRCAFP                          S01117
     C                     EXSR SUBZSF                                    S01117
     C*********************ADD  1         PPAGE                           S01117
     C*********************WRITEP1LR                   72                 S01117
     C                     WRITEP1LR                                      S01117
     C                     END
     C*                                                                   S01117
     C***********          WRITEP1CLO                              S01117 066886
     C                     WRITEP1CLO                  72                 066886
     C                     CLOSEFT0220P1                                  S01117
     C*                                                                   S01117
     C* WHEN NO RECORDS FOUND ON FPKEYDD, OPEN REPORT FT0220P1(EXSR SUBZSF)01117
     C* WRITE REPORT CLOSING DETAIL AND CLOSE REPORT FT0220P1             S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     EXSR SUBZSF                                    S01117
     C                     WRITEP1LR                                      S01117
     C                     WRITEP1CLO                                     S01117
     C                     CLOSEFT0220P1                                  S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* 0.5. CHECK IF FINAL CURRENCY NEEDS BALANCING ENTRIES.
     C* 1. COMPARE CALC. TRAILER WITH ACTUAL TRAILER.
     C* 2. SET UP 'GE' TRAILER.
     C* 3. DUMMY UPDATE, BUT NOT EXECUTED. SEE SUBROUTINE.
     C* 4. OUTPUT TRAILER.
     C                     EXSR CCYCHG                     #0.5 #
     C                     EXSR FPKEYT                     # 1. #
     C                     EXSR GEFPT                      # 2. #
     C*********************EXSR*CHGFLD*********************# 3. #
     C                     EXCPTGEFPLR                     # 4. #
     C*
     C           *IN61     IFEQ '1'                        'ERROR ON
     C                     SETON                     U8    'TRAILER
     C                     END
     C*
     C*********************WRITEP2HEAD                                    S01117
     C                     WRITEAUHEAD                                    S01117
     C*
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           CER031    OREQ 'Y'                                                         BUG22979
     C           WKUPDT    IFEQ 'Y'                                       CEU013
     C                     Z-ADDWKNARN    GLNARN                          CEU013
     C                     UPDATGLAPNAPF               83                 CEU013
     C                     ELSE                                           CEU013
     C                     MOVE '001'     GLNARI                          CEU013
     C                     Z-ADDWKNARN    GLNARN                          CEU013
     C                     WRITEGLAPNAPF               83                 CEU013
     C                     ENDIF                                          CEU013
     C           *IN83     IFEQ *ON                                       CEU013
     C                     MOVE 'GLAPNAPD'WBFILE           ***************CEU013
     C                     MOVE '001'     WBKEY            * DBERROR 90  *CEU013
     C                     Z-ADD90        WBASE            ***************CEU013
     C                     EXSR ABORT                                     CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C                     ENDSR
     C*
     C********************************************************************
     I/EJECT
     C********************************************************************
     C**   .. GEFPT ..
     C**   THIS SUBR. IS USED TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
     C**
     C           GEFPT     BEGSR                           ** GEFPT **
     C*
     C                     Z-ADD2         H
     C                     Z-ADDCTN#,H    NORE1
     C                     Z-ADDCTI#,H    HRWN
     C                     Z-ADDCTD#,H    HRDC
     C                     Z-ADDCTN#,H    CTN#02
     C                     Z-ADDCTI#,H    CTI#02
     C                     Z-ADDCTD#,H    CTD#02
     C                     MOVE 'T'       RECI
     C                     ENDSR
     C********************************************************************
     I/EJECT
     C********************************************************************
     C**   .. FPKEYT ..
     C**   THIS SUBR. IS USED TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
     C**
     C           FPKEYT    BEGSR                           ** FPKEYT **
     C*
     C                     Z-ADD1         H
     C                     EXSR CTRAIL
     C*
     C           *IN61     IFEQ '1'
     C                     MOVEL'*** DIFF'DIFF01 16
     C                     MOVE 'ERENCE *'DIFF01
     C                     END
     C*
     C                     Z-ADDNORE1     ITN#01
     C                     Z-ADDHRWN      ITI#01
     C                     Z-ADDHRDC      ITD#01
     C                     Z-ADDCTN#,H    CTN#01
     C                     Z-ADDCTI#,H    CTI#01
     C                     Z-ADDCTD#,H    CTD#01
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**   .. CTRAIL ..
     C**   COMPARE THE TOTALS ON THE  TRAILER AND SETON THE
     C**   APPROPRIATE ERROR INDICATOR
     C**
     C           CTRAIL    BEGSR                           ** CTRAIL **
     C*
     C           H         ADD  60        Z
     C           NORE1     IFNE CTN#,H
     C           HRWN      ORNE CTI#,H
     C           HRDC      ORNE CTD#,H
     C                     MOVE '1'       *IN,Z
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*    .. CHGFLD ..
     C*    This subroutine is not executed.
     C*
     C           CHGFLD    BEGSR                           ** CHGFLD **
     C*
     C                     Z-ADD1         RRNCHG  50
     C           RRNCHG    CHAINGEFPZZ               99
     C     N99             EXCPTDUMUPD                     'THIS WILL
     C*
     C                     ENDSR                           'NEVER EXCPT
     C*
     C********************************************************************
     C/EJECT                                                              S01522
     C********************************************************************S01522
     C**  Subroutine SRPNAR determines the required narratives.         **S01522
     C********************************************************************S01522
     C           SRPNAR    BEGSR                           * S R P N A R *S01522
     C*                                                                   S01522
     C* Define the data structure parameter:                              S01522
     C*                                                                   S01522
     C           *LIKE     DEFN CGPNAR    ##PNAR                          S01522
     C*                                                                   S01522
     C* Define the work variables:                                        S01522
     C*                                                                   S01522
     C           *LIKE     DEFN MNBRCA    ##BRCA                          S01522
     C           *LIKE     DEFN MNCUST    ##CUST                          S01522
     C           *LIKE     DEFN MNCYCD    ##CCY                           S01522
     C           *LIKE     DEFN MNACCD    ##ACCD                          S01522
     C           *LIKE     DEFN MNACSQ    ##ACSQ                          S01522
     C           *LIKE     DEFN MNRACN    ##ACNO                          S01522
     C           *LIKE     DEFN MNTRNO    ##TRNO                          S01522
     C           *LIKE     DEFN MNASOC    ##ASOC                          S01522
     C           *LIKE     DEFN MNCHNB    ##CHNB                          S01522
     C*                                                                   S01522
     C* If the facility is switched off or unavailable,                   S01522
     C*  or UDC is not installed, exit this subroutine:                   S01522
     C*                                                                   S01522
     C           FTPNAR    IFNE 'Y'                                       S01522
     C           FTPNAR    OREQ 'Y'                                                           240899
     C           RLPR      ANDNE*BLANKS                                                       240899
     C           NARRLR    ANDEQ'Y'                                                           240899
     C                     GOTO EXPNAR                                    S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C                     CLEARCGPNAR                                    S01522
     C                     CLEAR##PRM1                                    086125
     C*                                                                   S01522
     C* Determine the customer's name:                                    S01522
     C*                                                                   S01522
     C                     MOVEL##CUST    ##KEY     P                     S01522
     C*                                                                   S01522
     C                     CALL 'AOCUSTR0'                                S01522
     C                     PARM           ##RTN   7                       S01522
     C                     PARM '*KEY   ' ##OPT   7                       S01522
     C                     PARM           ##KEY  10                       S01522
     C                     PARM           ##STS   7                       S01522
     C           SDCUST    PARM SDCUST    DSSDY                           S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'SDCUSTPD'DBFILE             *************S01522
     C                     MOVEL'101'     DBASE              * DBERR 101 *S01522
     C                     MOVEL##KEY     DBKEY              *************S01522
     C                     EXSR ABORT                                     S01522
     C                     ENDIF                                          S01522
     C*...................................................................S01522
     C/EJECT                                                              S01522
     C*...................................................................S01522
     C* Determine the value for the posting narrative using AOPNARR0:     S01522
     C*                                                                   S01522
     C                     MOVE 'FT'      MNMODI                          S01522
     C                     MOVE ##BRCA    MNBRCA                          S01522
     C                     MOVE ##CUST    MNCUST                          S01522
     C                     MOVE ##CCY     MNCYCD                          S01522
     C                     MOVE ##ACCD    MNACCD                          S01522
     C                     MOVE ##ACSQ    MNACSQ                          S01522
     C                     MOVE ##ACNO    MNRACN                          S01522
     C                     MOVE ##TRNO    MNTRNO                          S01522
     C                     MOVE ##ASOC    MNASOC                          S01522
     C                     MOVE ##CHNB    MNCHNB                          S01522
     C                     MOVE BOKC      MNBOKC                          S01522
     C                     MOVE BBCRNM    MNCRNM                          S01522
     C                     MOVELPNAR      MNNARR    P                     S01522
     C/COPY WNCPYSRC,FTH00567
     C*                                                                   S01522
     C                     CALL 'AOPNARR0'                                S01522
     C                     PARM           ##RTN                           S01522
     C                     PARM           ##MGID  7                       S01522
     C                     PARM           ##PRM1                          086125
     C           CGPNAR    PARM CGPNAR    ##PNAR                          S01522
     C                     PARM           ##NARR 50                       S01522
     C/COPY WNCPYSRC,FTH00568
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'CGPNARPD'DBFILE             *************S01522
     C                     MOVEL'102'     DBASE              * DBERR 102 *S01522
     C                     MOVELMNCUST    DBKEY              *************S01522
     C                     EXSR ABORT                                     S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C                     MOVEL##NARR    PNAR      P                     S01522
      *                                                                                       240887
      ** Preventative fix for cheque sequence not being shown.                                240887
      *                                                                                       240887
     C           NARCSQ    IFEQ 'Y'                                                           240887
     C                     MOVELPNAR      XNAR   15                                           240887
     C           PREF      IFEQ XNAR                                                          240887
     C           CQSQ      ANDNE0                                                             240887
     C                     MOVELXNAR      ZNAR   17                                           240887
     C                     MOVE CQSQ      ZNAR                                                240887
     C                     MOVELZNAR      PNAR                                                240887
     C                     ENDIF                                                              240887
     C                     ENDIF                                                              240887
     C*                                                                   S01522
     C/COPY WNCPYSRC,FT0220C020
     C           EXPNAR    TAG                             < EXPNAR       S01522
     C/COPY WNCPYSRC,FT0220C010
     C*                                                                   S01522
     C                     ENDSR                                          S01522
     C********************************************************************S01522
     C/EJECT
     C/COPY WNCPYSRC,FT0220C007
     C********************************************************************
     C*
     C*  FUNCTION : TO ABORT THE PROGRAM IN THE EVENT OF A DATABASE
     C*             ERROR.
     C*
     C           ABORT     BEGSR
     C*
     C** SETON INDICATORS TO INDICATE DATABASE ERRORS
     C*
     C                     SETON                     U7U8LR
     C*
     C           *NAMVAR   DEFN LDA       DLDA
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0220'  DBPGM
     C                     MOVELWBKEY     DBKEY
     C                     MOVELWBFILE    DBFILE
     C*********************MOVELWBASE     DBASE                           S01117
     C                     MOVE WBASE     DBASE                           S01117
     C                     OUT  DLDA
     C*
     C** REPORT DATABASE ERROR
     C*
     C                     EXSR FPKEYT
     C                     EXSR GEFPT
     C*
     C*********************MOVELDBASE     P2DBAS                          S01117
     C*********************MOVELDBFILE    P2DBFL                          S01117
     C*********************MOVELDBKEY     P2DBKY                          S01117
     C*********************WRITEP2HEAD                                    S01117
     C*********************WRITEP2DBER                                    S01117
     C                     MOVELDBASE     AUDBAS                          S01117
     C                     MOVELDBFILE    AUDBFL                          S01117
     C                     MOVELDBKEY     AUDBKY                          S01117
     C                     WRITEAUHEAD                                    S01117
     C                     WRITEAUDBER                                    S01117
     C*
     C** PRODUCE PROGRAM DUMP
     C*
     C                     DUMP
     C*
     C** END PROGRAM
     C*
     C                     RETRN
     C*
     C           UEEND     ENDSR
     C*
     C********************************************************************
     C/EJECT                                                              CAC001
      *****************************************************************   CAC001
      *                                                               *   CAC001
      *  Subroutine  :  SRPRCU                                        *   CAC001
      *  Function    :  Determine Profit Centre to be Used            *   CAC001
      *                                                               *   CAC001
      *  Called by   :  GENKEY - Generate Funds Transfer Entries      *   CAC001
      *                 EXTRA  - Output Extra Records to GEFPD        *   CAC001
      *                                                               *   CAC001
      *  Calls       :  SRPRFC - Get Profit Centre Details            *   CAC001
      *                                                               *   CAC001
      *****************************************************************   CAC001
      *                                                                   CAC001
     C           SRPRCU    BEGSR                           ** SRPRCU **   CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
      **  If posting is to suspense, use Primary Funding Profit Centre    CAC001
      *                                                                   CAC001
     C           ACOD      WHEQ COMS                                      CAC001
     C                     MOVE FTPRFP    PRFC                            CAC001
      *                                                                   CAC001
      **  If account is retail or nostro, use Profit Centre of the a/c    CAC001
      *                                                                   CAC001
     C           ATYP      WHEQ 'R'                                       CAC001
     C           ATYP      OREQ 'N'                                       CAC001
     C                     MOVE PRFCAC    PRFC                            CAC001
      *                                                                   CAC001
      **  For other account codes...                                      CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
      *                                                                   CAC001
      **  If posting is to spot trade or trade equivalent account,        CAC001
      **  check if transaction profit centre can hold FX position         CAC001
      *                                                                   CAC001
     C           ACOD      LOKUPTACA,1                   67               CAC001
     C           *IN67     IFEQ *ON                                       CAC001
     C           ACOD      OREQ SPAC                                      CAC001
     C                     EXSR SRPRFC                                    CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Else, use transaction profit centre                             CAC001
      *                                                                   CAC001
     C                     MOVE WTPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
      *                                                                   CAC001
     C           SRPRC9    ENDSR                           ** SRPRC9 **   CAC001
      *                                                                   CAC001
      *****************************************************************   CAC001
     C/EJECT                                                              CAC001
      *****************************************************************   CAC001
      *                                                               *   CAC001
      *  Subroutine  :  SRPRFC                                        *   CAC001
      *  Function    :  Access Profit Centre Details                  *   CAC001
      *                                                               *   CAC001
      *  Called by   :  SRPRCU - Determine Profit Centre to be Used   *   CAC001
      *  Calls       :  None                                          *   CAC001
      *                                                               *   CAC001
      *****************************************************************   CAC001
      *                                                                   CAC001
     C           SRPRFC    BEGSR                           ** SRPRFC **   CAC001
      *                                                                   CAC001
      **  Access Profit Centre details via access object                  CAC001
      *                                                                   CAC001
     C                     CALL 'AOPRFCR0'                                CAC001
     C                     PARM *BLANKS   @RTCD                           CAC001
     C                     PARM '*KEY   ' @OPTN                           CAC001
     C                     PARM WTPRFC    @PRFC   4                       CAC001
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC001
      *                                                                   CAC001
      **  Database error if not found                                     CAC001
      *                                                                   CAC001
     C           @RTCD     IFNE *BLANKS                                   CAC001
     C                     MOVEL'SDPRFCPD'WBFILE           ************   CAC001
     C                     MOVELWTPRFC    WBKEY            * DBERR 17 *   CAC001
     C                     Z-ADD17        WBASE            ************   CAC001
     C                     EXSR ABORT                                     CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Use FX Position Profit Centre if not blank                      CAC001
      *                                                                   CAC001
     C           DSFPPC    IFNE *BLANK                                    CAC001
     C                     MOVE DSFPPC    PRFC                            CAC001
     C                     ELSE                                           CAC001
     C                     MOVE WTPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           SRPRF9    ENDSR                           ** SRPRF9 **   CAC001
      *                                                                   CAC001
      *****************************************************************   CAC001
     C/EJECT                                                              CEU013
      *****************************************************************   CEU013
      *                                                               *   CEU013
      *  Subroutine  :  GENPX1                                        *   CEU013
      *  Function    :  Generate Funds transfer Posting Extension file*   CEU013
      *                                                               *   CEU013
      *  Called by   :  GENKEY - To generate funds transfer entries   *   CEU013
      *                 EXTRA  - To output extra records to GEFPD if  *   CEU013
      *                          Posting ref = 2.                     *   CEU013
      *                 CCYCHG - Generate balancing entries if        *   CEU013
      *                          required.                            *   CEU013
      *  Calls       :  None                                          *   CEU013
      *                                                               *   CEU013
      *****************************************************************   CEU013
     C           GENPX1    BEGSR                           ** GENPX1 **   CEU013
     C*  If the Original currency and Amount fields are non-blank on      CEU013
     C*   Account key file, write the next available Reference ID and     CEU013
     C*   Reference Number to the Funds Transfer Posting file.            CEU013
     C*   The Original currency and amount fields are written to          CEU013
     C*   Funds transfer Posting Extension file using the same next       CEU013
     C*   available reference ID and Number.                              CEU013
     C*                                                                   CEU013
      *                                                                                     BUG22979
     C                     MOVELAKEY      WTYPE   2                                         BUG22979
     C                     MOVE *BLANKS   EXNAR1                                           BUG22979B
     C                     MOVE *BLANKS   EXNAR2                                           BUG22979B
     C                     MOVE *BLANKS   EXNAR3                                           BUG22979B
     C                     MOVE *BLANKS   EXNAR4                                           BUG22979B
     C                     MOVE *BLANKS   EXNAR5                                           BUG22979B
     C                     MOVE *BLANKS   EXNAR6                                           BUG22979B
      *                                                                                    BUG22979B
     C           WTYPE     IFEQ 'OP'                                                        BUG22979
      *                                                                                     BUG22979
     C********** ATYP      IFEQ 'R'                                               BUG22979 BUG22979A
     C           DRCR      IFEQ 0                                                          BUG22979B
      *                                                                                    BUG22979A
      ** Move debit side extended narrative                                                BUG22979A
      *                                                                                    BUG22979A
     C           CER031    IFEQ 'Y'                                                        BUG22979A
      *                                                                                    BUG22979A
     C                     MOVE EXTD1     EXNAR1                                           BUG22979A
     C                     MOVE EXTD2     EXNAR2                                           BUG22979A
     C                     MOVE EXTD3     EXNAR3                                           BUG22979A
     C                     MOVE EXTD4     EXNAR4                                           BUG22979A
     C                     MOVE EXTD5     EXNAR5                                           BUG22979A
     C                     MOVE EXTD6     EXNAR6                                           BUG22979A
     C                     ENDIF                                                           BUG22979A
     C                     ELSE                                                            BUG22979B
      *                                                                                    BUG22979A
     C           CFT003    IFEQ 'Y'                                                        BUG22979A
     C           CER031    ANDEQ'Y'                                                        BUG22979A
      *                                                                                     BUG22979
      ** Move credit side extended narratives                                               BUG22979
      *                                                                                     BUG22979
     C                     MOVE EXTC1     EXNAR1 65                                         BUG22979
     C                     MOVE EXTC2     EXNAR2 65                                         BUG22979
     C                     MOVE EXTC3     EXNAR3 65                                         BUG22979
     C                     MOVE EXTC4     EXNAR4 65                                         BUG22979
     C                     MOVE EXTC5     EXNAR5 65                                         BUG22979
     C                     MOVE EXTC6     EXNAR6 65                                         BUG22979
      *                                                                                     BUG22979
      ** Move debit side extended narrative                                                 BUG22979
      *                                                                                     BUG22979
     C**********           ELSE                                                   BUG22979 BUG22979A
      *                                                                           BUG22979 BUG22979A
     C**********           MOVE EXTD1     EXNAR1                                  BUG22979 BUG22979A
     C**********           MOVE EXTD2     EXNAR2                                  BUG22979 BUG22979A
     C**********           MOVE EXTD3     EXNAR3                                  BUG22979 BUG22979A
     C**********           MOVE EXTD4     EXNAR4                                  BUG22979 BUG22979A
     C**********           MOVE EXTD5     EXNAR5                                  BUG22979 BUG22979A
     C**********           MOVE EXTD6     EXNAR6                                  BUG22979 BUG22979A
     C                     ENDIF                                                            BUG22979
     C                     ENDIF                                                           BUG22979B
      *                                                                                     BUG22979
     C**********           ELSE                                                   BUG22979 BUG22979A
      *                                                                                     BUG22979
      ** Move credit side extended narrative                                                BUG22979
      *                                                                                     BUG22979
     C********** WTYPE     IFEQ 'IN'                                              BUG22979 BUG22979A
      *                                                                                     BUG22979
     C**********           MOVE EXTC1     EXNAR1                                  BUG22979 BUG22979A
     C**********           MOVE EXTC2     EXNAR2                                  BUG22979 BUG22979A
     C**********           MOVE EXTC3     EXNAR3                                  BUG22979 BUG22979A
     C**********           MOVE EXTC4     EXNAR4                                  BUG22979 BUG22979A
     C**********           MOVE EXTC5     EXNAR5                                  BUG22979 BUG22979A
     C**********           MOVE EXTC6     EXNAR6                                  BUG22979 BUG22979A
      *                                                                                     BUG22979
     C**********           ENDIF                                                  BUG22979 BUG22979A
      *                                                                                    BUG22979B
     C                     ELSE                                                            BUG22979B
      *                                                                                    BUG22979B
      ** Move credit side extended narrative                                               BUG22979B
      *                                                                                    BUG22979B
     C           WTYPE     IFEQ 'IN'                                                       BUG22979B
      *                                                                                    BUG22979B
     C                     MOVE EXTC1     EXNAR1                                           BUG22979B
     C                     MOVE EXTC2     EXNAR2                                           BUG22979B
     C                     MOVE EXTC3     EXNAR3                                           BUG22979B
     C                     MOVE EXTC4     EXNAR4                                           BUG22979B
     C                     MOVE EXTC5     EXNAR5                                           BUG22979B
     C                     MOVE EXTC6     EXNAR6                                           BUG22979B
      *                                                                                    BUG22979B
     C                     ENDIF                                                           BUG22979B
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     MOVE *BLANKS   XRFI             Exten Ref ID   CEU013
     C                     Z-ADD0         XRFN             Exten Ref No.  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           OCCY      ANDNE*BLANKS                                   CEU013
     C           OAMT      ANDNE*ZEROS                                    CEU013
     C           CER031    OREQ 'Y'                                                         BUG22979
     C           EXNAR1    ANDNE*BLANKS                                                     BUG22979
     C********** OCCY      ANDNE*BLANKS                                          BUG22939A BUG22979A
     C********** OAMT      ANDNE*ZEROS                                           BUG22939A BUG22979A
      *                                                                                    BUG22939A
     C*  Set up the fields for Account posting file                       CEU013
     C                     MOVE '001'     XRFI             Exten Ref ID   CEU013
     C                     Z-ADDWKNARN    XRFN             Exten Ref No.  CEU013
     C*  Set up the fields for Account posting extension file             CEU013
     C                     MOVE '001'     RFID             Reference ID   CEU013
     C                     Z-ADDWKNARN    RFNO             Reference No.  CEU013
      *                                                                                     BUG22979
     C                     MOVE EXNAR1    PSNAR1                                            BUG22979
     C                     MOVE EXNAR2    PSNAR2                                            BUG22979
     C                     MOVE EXNAR3    PSNAR3                                            BUG22979
     C                     MOVE EXNAR4    PSNAR4                                            BUG22979
     C                     MOVE EXNAR5    PSNAR5                                            BUG22979
     C                     MOVE EXNAR6    PSNAR6                                            BUG22979
      *                                                                                     BUG22979
     C                     WRITEGEFP1APF                                  CEU013
     C                     ADD  1         WKNARN                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDSR                           ** GENPX1 **   CEU013
     C*                                                                   CEU013
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACOD - Gets Account Codes via AOACODR0.                    *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACOD    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7                                           CGL029
     C                     PARM '*KEY   ' POPTN   7                                           CGL029
     C                     PARM           PACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C                     MOVE *ON       *IN99                                               CGL029
     C           PRTCD     IFEQ *BLANKS                                                       CGL029
     C                     MOVE *OFF      *IN99                                               CGL029
     C                     ELSE                                                               CGL029
     C                     MOVE 'SDACODPD'WBFILE                                              CGL029
     C                     MOVE PACCD     WBKEY                                               CGL029
     C                     Z-ADDWDBNO     WBASE                                               CGL029
     C                     EXSR ABORT                                                         CGL029
     C                     ENDIF                                                              CGL029
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                     BUG22979
      *                                                               *                     BUG22979
      *  SRTRAT - Transaction Type Allocation                         *                     BUG22979
      *                                                               *                     BUG22979
      *  Called By - GENKEY, EXTRA, EXTRA2, CCYCHG                    *                     BUG22979
      *                                                               *                     BUG22979
      *  Calls - None                                                 *                     BUG22979
      *                                                               *                     BUG22979
      *****************************************************************                     BUG22979
     C           SRTRAT    BEGSR                                                            BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'N'       WRKFLG  1                                         BUG22979
     C                     MOVELAKEY      WPTYPE  2                                         BUG22979
     C**********           MOVE AKEY      WMACC   1                                BUG22979 MD035693
      *                                                                                     BUG22979
      ** Payment is issued from incoming / outgoing payment                                 BUG22979
      ** and is from main amount                                                            BUG22979
      *                                                                                     BUG22979
     C           WPTYPE    IFEQ 'IN'                                                        BUG22979
     C           WPTYPE    OREQ 'OP'                                                        BUG22979
      *                                                                                     BUG22979
     C           WMACC     IFEQ 'N'                                                         BUG22979
     C           WMACC     OREQ 'L'                                                         BUG22979
     C           WMACC     OREQ 'R'                                                         BUG22979
     C           WMACC     OREQ 'P'                                                         BUG22979
      *                                                                                     BUG22979
     C           RTTY      IFNE *BLANKS                                                     BUG22979
     C                     MOVE RTTY      TRAT                                              BUG22979
     C                     MOVE 'Y'       WRKFLG                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
      ** Derive Transaction Type from Narrative code                                        BUG22979
      *                                                                                     BUG22979
     C           WRKFLG    IFNE 'Y'                                                         BUG22979
      *                                                                                     BUG22979
     C                     CALL 'AONARRR0'                                                  BUG22979
     C                     PARM *BLANKS   RTCD                                              BUG22979
     C                     PARM '*KEY   ' OPTN                                              BUG22979
     C                     PARM NCD,X     NRCD    2                                         BUG22979
     C           SDNARR    PARM SDNARR    DSFDY                                             BUG22979
      *                                                                                     BUG22979
      ** Narrative Code not found                                                           BUG22979
      *                                                                                     BUG22979
     C           RTCD      IFNE *BLANKS                                                     BUG22979
      *                                                                                     BUG22979
     C                     MOVE 'SDNARRPD'WBFILE                                            BUG22979
     C                     Z-ADD108       WBASE                                             BUG22979
     C                     MOVELNCD,X     DBKEY                                             BUG22979
     C                     EXSR ABORT                                                       BUG22979
      *                                                                                     BUG22979
     C                     ELSE                                                             BUG22979
      *                                                                                     BUG22979
     C           ALRTTY    IFNE *BLANKS                                                     BUG22979
     C                     MOVE ALRTTY    TRAT                                              BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDIF                                                            BUG22979
      *                                                                                     BUG22979
     C                     ENDSR                                                            BUG22979
      *****************************************************************                     BUG22979
      /EJECT                                                                                BUG22979
      *****************************************************************   CEU013
     C/COPY WNCPYSRC,FTH00390
      *                                                                                       CFT156
      *****************************************************************                       CFT156
      *  Get the FT Posting Narrative                                 *                       CFT156
      *****************************************************************                       CFT156
     C           GETFPN    BEGSR                                                              CFT156
      *                                                                                       CFT156
     C           PREF      CHAINOTPAY                70                                       CFT156
     C   70      PREF      CHAININPAY                70                                       CFT156
      *                                                                                       CFT156
     C           *IN70     IFEQ *OFF                                                          CFT156
     C           RLPR      IFNE *BLANKS                                                       CFT156
     C                     MOVE RLPR      WRLPR  17 P                                         CFT156
     C                     MOVE WRLPR     PNAR                                                CFT156
     C                     ELSE                                                               CFT156
     C                     MOVELPREF      PNAR      P                                         CFT156
     C                     ENDIF                                                              CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     ENDSR                                                              CFT156
      *                                                                                       CFT156
      *****************************************************************                       CFT156
      /EJECT                                                                                  CFT156
      *****************************************************************   CEU013              CFT156
     C/EJECT
     OGEFPZZF E                DUMUPD
     O*
     OGEFPPDF EADD             GEFPDT
     O                         RECI
     O                         CNUM
     O                         CCY
     O**********               ACOD                                                           CGL029
     O                         ACODQQ                                                         CGL029
     O                         ACSQ
     O                         ACNO
     O                         PSTD
     O                         VALD
     O                         TRAT
     O                         PNAR
     O                         PSTA
     O                         DRCR
     O                         ASOC
     O                         CHQN
     O                         SPOS
     O*************************BRCD                                       S01117
     O                         BRCA                                       S01117
     O                         RIND
     O                         REJC
     O                         DPMT
     O                         RRNM
     O                         ATYP
     O                         PRIN
     O                         GETP
     O                         PRFC                                       S01182
     O*                                                                   S01408
     O/COPY WNCPYSRC,FT0220OOP1                                           S01408
     O*                                                                   S01408
     O                         PTIM                                       S10736
     O                         VOIN                                       S10736
     O                         ACSC                                       S10736
     O*                                                                   S01408
     O/COPY WNCPYSRC,FT0220OOP2                                           S01408
     O*                                                                   S01408
     O                         SWCR
     O                         PREF
     O**********               OTRF                                                    S01182 CGL029
     O                         OTRFQQ                                                         CGL029
     O                         OTST                                       S01182
     O                         OTTP                                       S01182
     O                         SDCB                                       S01182
     O                         SDLB                                       S01182
     O                         BOKC                                       S01182
     O                         XRFI                                       CEU013
     O                         XRFN                                       CEU013
     O                         GEFKEY                                                         CGL020
     O                         FEEFLG                                                         CGL020
     O                         FEEVAL                                                         CGL020
     O                         FEEPCT                                                         CGL020
     O                         RORACT                                                         CGL020
     O                         RORCTY                                                         CGL020
     O                         RORBNK                                                         CGL020
     O                         RORCDE                                                         CGL020
     O                         PORACT                                                         CGL020
     O                         PORCTY                                                         CGL020
     O                         PORBNK                                                         CGL020
     O                         PORCDE                                                         CGL020
     O                         DSTACT                                                         CGL020
     O                         DSTCTY                                                         CGL020
     O                         DSTBNK                                                         CGL020
     O                         SETDAT                                                         CGL020
     O                         TICKER                                                         CGL020
     O                         EXCHNG                                                         CGL020
     O                         NOMINL                                                         CGL020
     O                         FDTRID                                                         CGL020
     O                         ACOD                                                           CGL029
     O                         OTRF                                                           CGL029
     O*
     O*    SUSPENSE ENTRY TO CATER FOR IMBALANCE WITHIN BRANCH/CCY
     OGEFPPDF EADD             IMBAL
     O                         RECI
     O                         CNUM
     O                         CCY
     O**********               ACOD                                                           CGL029
     O                         ACODQQ                                                         CGL029
     O                         ACSQ
     O                         ACNO
     O                         PSTD
     O                         VALD
     O                         TRAT
     O                         PNAR
     O                         PSTA
     O                         DRCR
     O                         ASOC                                       S10736
     O                         SPOS
     O*************************BRCD                                       S01117
     O                         BRCA                                       S01117
     O                         RIND
     O                         REJC
     O                         RRNM
     O/COPY WNCPYSRC,FT0220O003
     O                         ATYP
     O                         PRIN
     O                         GETP                                       S10736
     O                         ACUM
     O                         PRFC                                       S10736
     O                         PTIM                                       S10736
     O                         VOIN                                       S10736
     O                         ACSC                                       S10736
     O/COPY WNCPYSRC,FT0220O004
     O**********               OTRF                                                    S10736 CGL029
     O                         OTRFQQ                                                         CGL029
     O                         OTST                                       S10736
     O                         OTTP                                       S10736
     O                         SDCB                                       S10736
     O                         SDLB                                       S10736
     O                         BOKC                                       S10736
     O                         XRFI                                       CEU013
     O                         XRFN                                       CEU013
     O                         GEFKEY                                                         CGL020
     O                         FEEFLG                                                         CGL020
     O                         FEEVAL                                                         CGL020
     O                         FEEPCT                                                         CGL020
     O                         RORACT                                                         CGL020
     O                         RORCTY                                                         CGL020
     O                         RORBNK                                                         CGL020
     O                         RORCDE                                                         CGL020
     O                         PORACT                                                         CGL020
     O                         PORCTY                                                         CGL020
     O                         PORBNK                                                         CGL020
     O                         PORCDE                                                         CGL020
     O                         DSTACT                                                         CGL020
     O                         DSTCTY                                                         CGL020
     O                         DSTBNK                                                         CGL020
     O                         SETDAT                                                         CGL020
     O                         TICKER                                                         CGL020
     O                         EXCHNG                                                         CGL020
     O                         NOMINL                                                         CGL020
     O                         FDTRID                                                         CGL020
     O                         ACOD                                                           CGL029
     O                         OTRF                                                           CGL029
     O/COPY WNCPYSRC,FT0220O002
     O*
     OGEFPZZF EADD             GEFPLR
     O                         RECI
     O                         NORE1
     O                         HRWN
     O                         HRDC
     O*
     O/COPY WNCPYSRC,FT0220O001
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   NAR
FUNDS TRANSFER IMBALANCE
BRANCH CODES ARRAY ERROR
F.T. INTERBCH.
