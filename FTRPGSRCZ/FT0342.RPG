     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Outgoing payments valid. S1/LVL 1')           *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0342 - Validate Outgoing Payments - Level 1                *
     F*                                                               *
     F*  Function:  This program validates the level 1 input for      *
     F*  Outgoing Payments.                                           *
     F*                                                               *
     F*  Called By: FT0340  - Outgoing Payments Maintenence           *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CSW213             Date 03Jun13               *
      *                 MD020161           Date 24Apr13               *
      *                 AR928992           Date 21Feb13               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG26138           Date 22Sep09               *
      *                 BUG26136           Date 22Sep09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15201           Date 30Oct07               *
      *                 BUG15042           Date 17Oct07               *
      *                 BUG15037           Date 17Oct07               *
      *                 250804A            Date 11Oct07               *
      *                 250600             Date 01Oct07               *
      *                 BUG14926           Date 03Oct07               *
      *                 BUG14771           Date 12Aug07               *
      *                 CSW207A            Date 09Aug07               *
      *                 CSW207             Date 28Jun07               *
      *                 BUG14042           Date 24May07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CDL038             Date 10May05               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CFT017             Date 08Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 183398             Date 20Sep00               *
      *                 CFT014             Date 18Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
     F*                 175484             Date 23Feb00               *
     F*                 175479             Date 14Feb00               *
     F*                 175474             Date 24Jan00               *
     F*                 177284             Date 25Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
     F*                 CGL009             Date 19Aug99               *
     F*                 166199             Date 19Aug99               *
     F*                 166210             Date 19Aug99               *
     F*                 166214             Date 19Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CFT002             Date 12Apr99               *
     F*                 148229             Date 13Dec98               *
     F*                 CEU006             DATE 01MAY98               *
     F*                 S01408             DATE 01NOV96               *
     F*                 069250             DATE 03MAY94               *
     F*                 068230             DATE 23JAN94               *
     F*                 068088             DATE 04JAN94               *
     F*                 S01435             DATE 22AUG93               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSW213 - SWIFT Changes 2013 (Recompile)                      *
      *  MD020161 - Messages sent thru Multicash not processed by STP *
      *             Added hooks:                                      *
      *             OFCPYSRCZ,CFT148_029                              *
      *             OFCPYSRCZ,CFT148_030                              *
      *             OFCPYSRCZ,CFT148_031                              *
      *  AR928992 - Set up DRSMM message file for MMA* messages.      *
      *             (Child: AR928993)                                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043   - German Features LF041-00 New Fields and Defaulting*
      *             (Recompile)                                       *
      *  BUG26138 - Ordering customer is missing                      *
      *  BUG26136 - Transaction is not accepted                       *
      *  BUG15201 - Encounter Database Errors (Recompile)             *
      *  BUG15042 - Ensure Ordering Customer IBAN entry is formatted  *
      *             as Midas account before passing to FT0805.        *
      *           - Also added DBASE error handling to ensure program *
      *             terminates abnormally if error in FT0805.         *
      *  BUG15037 - DB error in AOCUSTR0. Take correct customer number*
      *  250804A - Correct set up of @2ACNT account format.           *
      *  250600   - CFT032 errors                                     *
      *  BUG14926 - Parameter mismatch in program AOIBANR3            *
      *  BUG14771 - Amended the input function and the message        *
      *             generation for CFT032                             *
      *  CSW207A - SWIFT 2007 Changes                                 *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  BUG14042 - CFT032 errors ; applied fix 13798                 *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CFT032 - Account line in field 50X in MT103                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFT017 - Multilateral Inter-bank Exchange Fee. (Recompile)   *
     F*  183398 - Here, default S4SNMT to 'N' as it results to        *
     F*           blank when the Sender's Correspondent has no        *
     F*           SWIFT ID                                            *
     F*  CFT014 - Addition of MT103 messages                          *
     F*  175484 - Fix on % of discrepancy allowed for entered rate    *
     F*  175479 - FONTIS : Recompile over changes in parameters       *
     F*  175474 - FONTIS : Invalid A/C in :53a:                       *
     F*  177284 - The cover 202 field is defaulted to 'Y' if a senders*
     F*           correspondent is entered. This is incorrect. If the *
     F*           sender and sender's correspondent are the same      *
     F*           institution then the default should be 'N' as other-*
     F*           wise a cover 202 to oneself is generated.           *
     F*  CGL009 - FONTIS IAT/TPP interface                            *
     F*  166199 - System rate when CEU006 is on                       *
     F*  166210 - Account DS overlapped by CEU006 changes             *
     F*  166214 - Missing parameters in FT0010                        *
     F*  CFT002 - STP phase 1                                         *
     F*  148229 - Changes to /COPY FT0010I001 (Recompile only)        *
     F*  CEU006 - EMU FT Payments and Settlement.                     *
     F*  S01408 - Addition of core hook FT0342CCP2                    *
     F*         - Addition of core hook FT0342CCP1                    *
     F*  069250 - Remove dummy OVRDBF command from creation parms.    *
     F*  068230 - Add validation for SWIFT in destination             *
     F*  068088 - MT202 valid if bank or branch subsiduary            *
     F*  S01435 - Incoming Message Management                         *
     F*                                                               *
     F*****************************************************************
     F*
     F*  Indicator usage
     F*  ~~~~~~~~~~~~~~~
     F*
     F*  31    Invalid S.W.I.F.T. Address format
     F*  32    S.W.I.F.T. Address not on file
     F*
     F*  50    Program Initialised
     F*
     F*  89    Error processing on return from FT0010                     CEU006
     F*  90    General Error Indicator
     F*  91    / found
     F*  92    Embedded spaces found
     F*  93    Illegal characters found
     F*  94    Work indicator used in checking illegal characters
     F*
     F*  U7/U8 Error Ocurred
     F*  LR    End program
     F*
     F*****************************************************************
     FACCNT   IF  E           K        DISK         KINFSR SRFILE     UC
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
      *
      * RTV : General Ledger Accounts by GL Account Number
      *
     FACNUMA  IF  E           K        DISK         KINFSR SRFILE     UC
     F            ACCNTABF                          KRENAMEACNUMAF
      *
      * RSQ : General Ledger Accounts by Retail Account Number
      *
     FPYCHGDB IF  E           K        DISK         KINFSR SRFILE     UC
      *
      * RSQ : Payment and charges details
      *
     FFDDTSTL1IF  E           K        DISK                                                   CFT002
      *                                                                                       CFT002
      ** Standing data module - Deal type/subtype file                                        CFT002
      *                                                                                       CFT002
     FMEISOCL1IF  E           K        DISK                               CFT014
      *                                                                   CFT014
      ** ISO Country Codes file                                           CFT014
      *                                                                   CFT014
     E/COPY FTCPYSRC,SFTSWFTF
     F/COPY WNCPYSRC,FT0342DFPG
      *
      *  /Copy point for File Definition
      *
     F/EJECT
     E                    CPY@    1   1 80
      *
      *  Copyright table
      *
     E/COPY WNCPYSRC,FT0342DEPG
      *
      *  /Copy point for Arrays
      *
     E/COPY FTCPYSRC,SRERRE
      *
      *  End of Copysource for error processing
      *
      *
      *  Error Codes Output
      *
     E                    ERCD       38  4               Codes
     E/COPY FTCPYSRC,SFTSWFTE
      *
      *  Tables for look ups
      *
     E                    NDY    31  31  2  A            Day In Month
      *                                                                   CFT014
      *  Day in Month                                                     CFT014
      *                                                                   CFT014
     E                    POWER   1   7  7 3                              CFT014
      *                                                                   CFT014
      *  Power table                                                      CFT014
      *                                                                   CFT014
     E                    ALPH   26  26  1                                                    CFT032
      *                                                                                       CFT032
      ** Alphabetic array                                                                     CFT032
      *                                                                                       CFT032
     E                    NUMC   10  10  1                                                    CFT032
      *                                                                                       CFT032
      ** Numeric array                                                                        CFT032
      *                                                                                       CFT032
      *
      *  Warning codes array
      *
     E                    WRN@       40  1
      *
     E/EJECT
      *                                                                                       CFT032
      ** Constants                                                                            CFT032
      *                                                                                       CFT032
     I              'ACOUNTLINE'          C         CACNT1                                    CFT032
     I              'ACOUNTIBAN'          C         CACNT2                                    CFT032
     I              'Ordering Customer'   C         CORDRC                                    CFT032
     I              'AllowMT103AccFATF'   C         CMT103                                    CFT032
      *
      * Rename of ACCNT/ACNUMA Profit Centre to avoid overwriting
      *
     IACCNTABF
     I              PRFC                            ACPRFC
      *
     IACNUMAF
     I              PRFC                            ACPRFC
      /EJECT
      *
     I/COPY WNCPYSRC,FT0342DIPG
      *
      *  /Copy point for Input specifications
      *
      /EJECT                                                              CEU006
      *                                                                   CEU006
     I/COPY FTCPYSRC,FT0010I001                                           CEU006
      *                                                                   CEU006
     ICPYR@#      DS
      *
      *  Data structure for compilation  - Copyright insertion
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY FTCPYSRC,SRERRI
      *
      *  End of Program Error Processing source
      *
      *  Data Structures for parameters to access programs
      *
     IDSFDY     E DSDSFDY
     IDSSDY     E DSDSSDY
      *
      *  Data Structures used by access programs
      *
     ISDCURR    E DSSDCURRPD
     ISDNOST    E DSSDNOSTPD
      *           Nostro location code
     I                                       29  31 NLOC
     ISDCUST    E DSSDCUSTPD
      *
      *  Calling parameter data structure for AOCUSTR0
      *
     ISDCNST    E DSSDCNSTPD
     I/COPY WNCPYSRC,FT0342I001
      *
      *  Calling parameter data structure for ME1400
      *
     IMEBICD    E DSMEBICDPD
     I/COPY WNCPYSRC,FT0342I002
      *
      *  Calling parameter data structure for ME1400
      *
     ISDCTRY    E DSSDCTRYPD                                              CFT014
      *                                                                   CFT014
      ** Country codes file format data structure                         CFT014
      *                                                                   CFT014
     ISDLOCN    E DSSDLOCNPD                                              CFT014
      *                                                                   CFT014
      ** Location codes file format data structure                        CFT014
      *                                                                   CFT014
     ISDDLST    E DSSDDLSTPD
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
     ISDBOOK    E DSSDBOOKPD
     ISDPRFC    E DSSDPRFCPD
     ISDFTFR    E DSSDFTFRPD                                              166214
      *
     IOACCNT    E DSACCNTAB                   4
      *
      *  Define account data structure
      *
      *  1 = Ordering Bank
      *  2 = Ordering Customer
      *  3 = Destination
      *  4 = Sender's Correspondent
      *****                                                         CEU006166210
      **Switchable*Features*Descriptions *                          CEU006166210
      *****                                                         CEU006166210
     I*****SCSARD    E DSSCSARDPD                                   CEU006166210
      *****                                                         CEU006166210
      **Rename*of*SCSARDPD/LCD*Last*change*date*for*compile*reasons CEU006166210
      *****                                                         CEU006166210
     I**************LCD                             SCLCD           CEU006166210
      *
      *  Data Structure redefining ACCNT key fields
      *
     I                                        2   7 CNUMA
     I**********                             11  14 ACODA                                     CGL029
     I                                       11  14 ACODA#                                    CGL029
     I                                       15  16 ACSQA
     I**********                              2  19 AKEYF                                     CGL029
     I                                      554 563 ACODA                                     CGL029
      *                                                                                       CFT032
      ** Outgoing message                                                                     CFT032
      *                                                                                       CFT032
     IMEOUFM    E DSMEOUFMPD                                                                  CFT032
      *                                                                                       CFT032
      ** Bank DEtails                                                                         CFT032
      *                                                                                       CFT032
     ISDBANK    E DSSDBANKPD                                                                  CFT032
      *                                                                   166210
      * Switchable Features Descriptions *                                166210
      *                                                                   166210
     ISCSARD    E DSSCSARDPD                                              166210
      *                                                                   166210
      * Rename of SCSARDPD/LCD Last change date for compile reasons       166210
      *                                                                   166210
     I              LCD                             SCLCD                 166210
      *
     IRUNDTA    E DSRUNDAT
      *
      *  Define rundat data area
      *
      *
     IZMUSER    E DSZMUSER
      *
      *  User / Branch Data Area
      *
     E/COPY FTCPYSRC,SFT0340S
     E/COPY FTCPYSRC,SFTVALDI
     E/COPY FTCPYSRC,SFT0340F
     E/COPY FTCPYSRC,SFT0340I
     ID#DTA       DS                            256
      *
      *  Calling parameter data structure for AOCCYCV0
      *
      *                                       From Currency & amount
     I                                        1   3 D#FCCY
     I                                    P   4  110D#FAMT
      *                                       To Currency & amount
     I                                       12  14 D#TCCY
     I                                    P  15  220D#TAMT
      *                                       Rate and multi/div ind.
     I                                       23  23 D#MDIN
     I                                    P  24  368D#RATE
      *                            Output     Rate and multi/div ind.
      *                                       If no in rate
     I                                       37  37 O#MDIN
     I                                    P  38  508O#RATE
      *
     E/COPY FTCPYSRC,SFTADDRI
     ICLSWTK      DS
      *
      *  Redefine SWIFT array as field for SETLL.
      *
     I                                        1  12 SW
      *
     I            DS
      *  Currency, amounts and rates
     I                                        1  48 R#RCHK
     I                                        1   3 R#SMCY
     I                                        4   6 R#PCCY
     I                                        7  190R#SMAM
     I                                       20  320R#PYAM
     I                                       33  458R#RATE
     I                                       46  46 R#OVRD
     I                                       47  48 R#STMT
      *
      *
     I            DS
     I**********                              1  18 DSTDS                                     CGL029
     I**********                             19  36 SNCDS                                     CGL029
     I**********                             37  54 ORCDS                                     CGL029
     I**********                             55  72 ORBDS                                     CGL029
     I                                        1  24 DSTDS                                     CGL029
     I                                       25  48 SNCDS                                     CGL029
     I                                       49  72 ORCDS                                     CGL029
     I                                       73  96 ORBDS                                     CGL029
     I/COPY WNCPYSRC,FT0342I003
      *
     I***IMACNT*     DS                             18                                        CGL029
     IIMACNT      DS                             24                                           CGL029
      *
      *  Define full account to be passed for FT IMM update
      *
     I**********                              1   60IMCNUM                                    CSD027
     I                                        1   6 IMCNUM                                    CSD027
     I                                        7   9 IMCCY
     I**********                             10  130IMACOD                                    CGL029
     I**********                             14  150IMACSQ                                    CGL029
     I**********                             16  18 IMBRCA                                    CGL029
     I                                       10  190IMACOD                                    CGL029
     I                                       20  210IMACSQ                                    CGL029
     I                                       22  24 IMBRCA                                    CGL029
      *
      *                                                                   CGL009
      ** Data Structure to hold Ord Customer as a partial account + CCY   CGL009
      *                                                                   CGL009
     IDSORC1      DS                             35                       CGL009
     I**********                              1  15 WORPA                              CGL009 CGL029
     I**********                              1  18 WORPAC                             CGL009 CGL029
     I                                        1  21 WORPA                                     CGL029
     I                                        1  24 WORPAC                                    CGL029
     I                                        1   6 WORCN                 CGL009
     I**********                              7  10 WORAC                              CGL009 CGL029
     I**********                             11  12 WORSQ                              CGL009 CGL029
     I**********                             13  15 WORBR                              CGL009 CGL029
     I**********                             16  18 WORCY                              CGL009 CGL029
     I**********                             19  35 WORFI                              CGL009 CGL029
     I                                        7  16 WORAC                                     CGL029
     I                                       17  18 WORSQ                                     CGL029
     I                                       19  21 WORBR                                     CGL029
     I                                       22  24 WORCY                                     CGL029
     I                                       25  35 WORFI                                     CGL029
      *                                                                   CGL009
      ** Data Structure to hold G/L account                               CGL009
      *                                                                   CGL009
     IDSGLAC      DS                                                      CGL009
     I                                        1   6 WGLCN                 CGL009
     I                                        7   9 WGLCY                 CGL009
     I**********                             10  13 WGLAC                              CGL009 CGL029
     I**********                             14  15 WGLSQ                              CGL009 CGL029
     I**********                             16  18 WGLBR                              CGL009 CGL029
     I                                       10  19 WGLAC                                     CGL029
     I                                       20  21 WGLSQ                                     CGL029
     I                                       22  24 WGLBR                                     CGL029
      *                                                                   166199
      ** Data Structure for P#INDC of FT0010                              166199
      *                                                                   166199
     IDSINDC      DS                                                      166199
     I                                        1   1 WINDC1                166199
     I                                        2   2 WINDC2                166199
     I                                        3   3 WINDC3                166199
     I                                        4   4 WINDC4                166199
     I                                        5   5 WINDC5                166199
     IDSMTR       DS
      *
      *  Define fields for message transalation
      *
     I                                        1 132 #MSDTA
     I                                       15  30 #MPREF
     I                                    P   1   20#MPART
     I                                      133 264 #MSTX1
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
     E/COPY FTCPYSRC,SFTVALCS
     I/EJECT
      *****************************************************************
      *                 M A I N L I N E
      *****************************************************************
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *  Define entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           W0RTN   7
     C                     PARM           W0ACT   8
     C                     PARM           S4DATA
     C                     PARM           V#DATA
     C                     PARM           F4DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I4DATA
      *                                                                                       CFT032
      ** Parameter List for calling AOOUFMR0                                                  CFT032
      *                                                                                       CFT032
     C           PLOUFM    PLIST                                                              CFT032
     C                     PARM *BLANKS   @RTRN                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @NTWRK  6                                           CFT032
     C                     PARM           @MSGTP  3                                           CFT032
     C                     PARM           @MSGTG  5                                           CFT032
     C**********           PARM           BRCA                                       CFT032 BUG14042
     C                     PARM           BRCA4A  4                                         BUG14042
     C**********           PARM           @CNTLC  2                                  CFT032 BUG14042
     C                     PARM           CTRY4A  4                                         BUG14042
     C**********           PARM           S4PCCY                                     CFT032 BUG14771
     C                     PARM           WCCY    3                                         BUG14771
     C                     PARM           @NOSTN  2                                           CFT032
     C                     PARM           @ACTNF 10                                           CFT032
     C           MEOUFM    PARM *BLANKS   DSFDY                                               CFT032
      ** Parameter list for calling FT001000 program                                          CSW207
     C           PLSWFT    PLIST                                                              CSW207
     C                     PARM           PRTCDE  7                                           CSW207
     C                     PARM           PMSGID  7                                           CSW207
     C                     PARM           PRFLG   1                                           CSW207
     C                     PARM           PVTYP   4                                           CSW207
     C                     PARM           P501   35                                           CSW207
     C                     PARM           P502   35                                           CSW207
     C                     PARM           P503   35                                           CSW207
     C                     PARM           P504   35                                           CSW207
     C                     PARM           P505   35                                           CSW207
     C                     PARM           PATYP   1                                           CSW207
     C                     PARM           PACCT  34                                           CSW207
     C                     PARM           PCUST   6                                           CSW207
     C                     PARM           PNONA  10                                           CSW207
     C                     PARM           PNWRK   6                                           CSW207
     C                     PARM           PMSGTP  3                                           CSW207
     C                     PARM           PMSGTG  5                                           CSW207
     C                     PARM           PCTRY   2                                           CSW207
     C                     PARM           PBRCH   3                                           CSW207
     C                     PARM           PCURR   3                                           CSW207
     C                     PARM           PNOST   2                                           CSW207
     C                     PARM           PMODI   2                                           CSW207
     C                     PARM           POUT1  35                                           CSW207
     C                     PARM           POUT2  35                                           CSW207
     C                     PARM           POUT3  35                                           CSW207
     C                     PARM           POUT4  35                                           CSW207
     C                     PARM           POUT5  35                                           CSW207
      *
      *  Set up Primary Reference for database errors
      *
     C                     MOVELS4DATA    W0PREF
      *
      *  Initialise program
      *
     C           *IN50     IFEQ '0'
     C                     EXSR SRINIT
     C                     END
      *
      *  Determine the mode of processing and execute subroutine :-
      *
      *
      *  Action Code : *VALID
      *  --------------------
      *
      *  Called from FT0050 to validate all input fields on the detail
      *  screen. Once verified, control returns to the calling program
      *  where the appropriate error indicators are set on and the
      *  processing continues.
      *
      *
     C           W0ACT     CASEQ'*VALID  'SRPROC
     C                     CAS            SRACT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *  Return to calling program
      *
     C                     RETRN
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPROC   : Validate All Detail Fields Entered                *
      *             Seton appropriate indicators and set up the array *
      *             of relevant error codes for display.              *
      *                                                               *
      *  CALLED BY: Main processing section                           *
      *                                                               *
      *  CALLS    : SRERR   - report error and close down program     *
      *                                                               *
      *****************************************************************
     CSR         SRPROC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPROC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PROC
      *
      *  Move warning array passed to WRN@ and error indicators
      *
     C                     MOVEAE#WARA    WRN@
     C                     MOVEA*BLANKS   ERCD
     C                     CLEARI4DATA
     C                     Z-ADD0         X       50
      *
      * See if Payment Details have changed
      *
      * If the payment has been entered by the user, the settlement
      *  cannot be changed, but if the amount, currency, rate or
      *  override ind is changed, then the amounts will be re-calculat-
      *  ed.
      *
      * If the payment has been generated from an incoming payment, the
      *  amounts, currencies, rate and override ind cannot be changed,
      *  but the settlement type must be entered.  This will cause the
      *  receive amount, which is zero when the payment is generated,
      *  to be calculated from the pay amount.
      *
      *
      * Clear work fields
      *
     C                     EXSR SRCLR
      *
      * Validate Booking Branch
      *
      * If Multibranching environment validate booking branch
      *
     C           WUMBIN    IFEQ 'Y'
     C                     EXSR SRBRCA
     C                     END
      *
      *  Validate Originating Branch
      *
     C           WUMBIN    IFEQ 'Y'
     C           V#OBUV    ANDEQ'Y'
     C                     EXSR SRORBR
     C                     END
      *
      *  Get Access Payment Charges
      *
     C           I4BRCA    IFEQ *BLANKS
     C           I4ORBR    ANDEQ*BLANKS
     C                     EXSR SRPAYC
     C                     END
      *
      *  Validate Payment Type
      *
     C                     EXSR SRPYTP
      *
      *  Validate Payment Subtype
      *
     C                     EXSR SRPYST
      *
      *  Validate Swift Code
      *
     C                     EXSR SRSWPC
      *
      *  Validate Settlement Type
      *
     C                     EXSR SRSTMT
     C/COPY WNCPYSRC,FT0342C023
      *
      *  Validate Destination
      *
     C                     EXSR SRDST
      *
      *  Validate MT100 Customer
      *
     C                     EXSR SRODMT
      *
      *  Validate Settle Currency
      *
     C                     EXSR SRSMCY
      *
      *  Validate Settle Amount if settle currency valid
      *
     C           I4SMCY    IFEQ *BLANKS
     C                     EXSR SRSMAM
      *
      *  Validate Ordering Customer
      *
     C                     EXSR SRORC
      *
      *  Validate Ordering Bank
      *
     C                     EXSR SRORBK
     C                     END
      *
      *  Validate Pay Currency
      *
     C                     EXSR SRPCCY
     C/COPY WNCPYSRC,FT0342C047
      *
      *  Validate Pay Amount if pay currency valid
      *
     C           I4PCCY    IFEQ *BLANKS
     C                     EXSR SRPYAM
      *
      *  Validate Senders Correspondent
      *
     C                     EXSR SRSNCO
     C                     END
      *
      *  Validate Settle Date
      *
     C                     EXSR SRSLDT
      *
      *  Validate Pay Date
      *
     C                     EXSR SRPVDT
      *
      *  Validate Rate if currencies and amounts are valid
      *
     C           I4SMCY    IFEQ *BLANKS
     C           I4PCCY    ANDEQ*BLANKS
     C           I4PYAM    ANDEQ*BLANKS
     C           I4SMAM    ANDEQ*BLANKS
     C                     EXSR SRRATE
      *
      *  Validate Override Flag if rate valid
      *
     C           I4RATE    IFEQ *BLANKS
     C                     EXSR SROVRD
     C                     END
      *
     C                     END
      *
      *  Validate Pay Amount plus Charges
      *
     C                     EXSR SRADDC
     C/COPY WNCPYSRC,FT0342C009
      *                                                                   CFT014
      *  Validate Receiver's charges currency from the Network            CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           I4PCCY    IFEQ *BLANKS                                   CFT014
     C           I4SMCY    OREQ *BLANKS                                   CFT014
     C                     EXSR SRRCCN                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Validate Receiver's charges amount from the Network              CFT014
      *                                                                   CFT014
     C           I4RCCN    IFEQ *BLANKS                                   CFT014
     C                     EXSR SRRCNW                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  Validate the Book Code.
      *
     C                     EXSR SRBOOK
      *
      *  Validate the Profit Centre if Used.
      *
     C           V#PRCU    IFEQ 'Y'
     C                     EXSR SRPRFC
     C                     END
      *
      *  Validate Regular Payment
      *
     C                     EXSR SRRPAY
      *
      *  Validate Payment Frequency
      *
     C                     EXSR SRPAYF
      *
      *  Validate Day In Month
      *
     C                     EXSR SRDYIM
      *
      *  Validate Next Date
      *
     C           I4SLDT    IFEQ *BLANKS
     C           I4SMCY    ANDEQ*BLANKS
     C                     EXSR SRNDAT
     C                     END
      *
      *  Validate Final Date
      *
     C                     EXSR SRFIND
      *
      *  Validate Cover MT202 Indicator
      *
     C                     EXSR SRSNMT
      *                                                                   CEU006
      *  Validate Notified delivery currency                              CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C                     EXSR SRNDCY                                    CEU006
      *                                                                   CEU006
      * If entered and valid                                              CEU006
     C           V#NDCY    IFNE *BLANKS                                   CEU006
     C           I4NDCY    ANDEQ*BLANKS                                   CEU006
      *                                                                   CEU006
      *  Validate Notified delivery amount                                CEU006
     C                     EXSR SRNDAM                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CGL009
      *  Validate Payment delivery currency                               CGL009
      *                                                                   CGL009
     C                     EXSR SRPDCY                                    CGL009
      *                                                                   CGL009
      * If entered and valid                                              CGL009
     C           V#PDCY    IFNE *BLANKS                                   CGL009
     C           I4PDCY    ANDEQ*BLANKS                                   CGL009
      *                                                                   CGL009
      *  Validate Payment delivery amount                                 CGL009
     C                     EXSR SRPDAM                                    CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CEU006
      *  Cross validate amounts                                           CEU006
      *  Check original rate                                              CFT014
     C           I4NDCY    IFEQ *BLANKS                                   CEU006
     C           I4NDAM    ANDEQ*BLANKS                                   CEU006
     C           I4PDCY    ANDEQ*BLANKS                                   CGL009
     C           I4PDAM    ANDEQ*BLANKS                                   CGL009
     C           I4SMCY    ANDEQ*BLANKS                                   CEU006
     C           I4SMAM    ANDEQ*BLANKS                                   CEU006
     C           I4PCCY    ANDEQ*BLANKS                                   CEU006
     C           I4PYAM    ANDEQ*BLANKS                                   CEU006
     C                     EXSR SRAMTV                                    CEU006
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     EXSR SRORTE                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *
      *  Cross validation subroutine
      *
     C           E#NOUP    IFEQ *BLANKS
     C                     EXSR SRXVAL
     C                     END
      *
      *  Move waring array back and errors
      *
     C                     MOVEAWRN@      E#WARA
     C                     MOVEAERCD      C#ERCD
      *
      *  Unwind subroutine stack name
      *
     C           EXPROC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRCLR    : Validate Booking Branch                           *
      *                                                               *
      *  CALLED BY: SRPROC                                            *
      *                                                               *
      *  CALLS    :                                                   *
      *                                                               *
      *****************************************************************
     CSR         SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR '  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RCLR
      *
      *  Clear account arrays
      *
     C           1         DO   4         Y#
     C           Y#        OCUR OACCNT
     C                     CLEAROACCNT
     C                     ENDDO
      *
      *  Set Pay location to System default
      *
     C                     MOVELV#SLCD    PLOC
     C                     MOVEL'S'       NOWRK
      *
      *  Save entered amounts
      *
     C           *LIKE     DEFN S4SMAM    K#SMAM
     C           *LIKE     DEFN S4PYAM    K#PYAM
     C                     MOVELS4SMAM    K#SMAM
     C                     MOVELS4PYAM    K#PYAM
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRBRCA   : Validate Booking Branch                           *
      *                                                               *
      *  CALLED BY: SRPROC                                            *
      *                                                               *
      *  CALLS    : AOBRCHR0                                          *
      *             ZVACTBU                                           *
      *                                                               *
      *****************************************************************
     CSR         SRBRCA    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRBRCA'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342BRCA
      *
      * If Booking Branch blank, use default branch on data area ZMUSER
      *
     C           S4BRCA    IFEQ *BLANKS
     C                     MOVELDBRN      S4BRCA
     C                     END
      *
      * Check Booking Branch valid by calling 'AOBRCHR0'
      *
     C**********           CALL 'AOBRCHR0'             9090                                   CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   RTCD    7
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S4BRCA    @BRCD   3
     C********** SDBRCH    PARM *BLANKS   DSFDY                                               CGL029
     C           SDBRCH    PARM *BLANKS   DSSDY                                               CGL029
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBRCHR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 01 *
     C                     Z-ADD1         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Branch does not exist
      *
     C           RTCD      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4BRCA    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2021' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4BRCA
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBRCA
     C                     END
      *
      *                                                                   177284
      * Save BICN of the booking branch to retrieve sender's SWIFT        177284
      * address later on                                                  177284
      *                                                                   177284
     C                     MOVE A8BICN    SNBICN  6                       177284
      *
      * Check user is authorised to perform action code on
      * booking branch
      *
     C**********           CALL 'ZVACTBU'              9090                                 MD020161
     C                     CALL 'ZVACTBU'              90                                   MD020161
     C                     PARM S4ACTD    @ACTN   1
     C                     PARM S4BRCA    @BRCD   3
     C                     PARM 0         ERR     10
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZVACTBU 'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 02 *
     C                     Z-ADD2         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * User not authorised to any action codes for this item and branch
      *
     C           ERR       IFEQ 1
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2023' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4BRCA
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBRCA
     C                     END
      *
      * User not authorised to action code for this particular item
      * and branch
      *
     C           ERR       IFEQ 2
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ACTD    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2024' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4BRCA
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBRCA
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXBRCA    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRORBR   : Validate Originating Branch                       *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRORBR    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRORBR'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342ORBR
      *
      *  If no entry made to Originating branch then use booking branch
      *  if valid otherwise exit
      *
     C           S4ORBR    IFEQ *BLANKS
     C           I4BRCA    IFEQ *BLANKS
     C                     MOVELS4BRCA    S4ORBR
     C                     ELSE
     C                     GOTO EXORBR
     C                     END
     C                     END
      *
      *  Check Originating Branch valid by calling 'AOBRCHR0'
      *
     C**********           CALL 'AOBRCHR0'             9090                                   CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S4ORBR    @BRCD
     C********** SDBRCH    PARM *BLANKS   DSFDY                                               CGL029
     C           SDBRCH    PARM *BLANKS   DSSDY                                               CGL029
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBRCHR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 03 *
     C                     Z-ADD3         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBR    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2025' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBR
     C                     END
      *
      *  If originating branch validation required
      *
     C                     CALL 'ZVOBU'                9090
     C                     PARM S4ORBR    ZOBRX   3
     C                     PARM 0         ERR     10
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZVOBU   'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 04 *
     C                     Z-ADD4         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * User is not authorised to any Originating Branches
      *
     C           ERR       IFEQ 1
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2026' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBR
     C                     END
      *
      *  User is not authorised to this Originating Branch
      *
     C           ERR       IFEQ 2
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBR    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2027' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBR
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXORBR    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPAYC   : Validate Payment Charges                          *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRPAYC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPAYC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PAYC
      *
      *  Determine branch for charge defaults
      *
     C                     SELEC
      *
      *  If single branch mode, use single branch code from SDBANKPD
      *
     C           WUMBIN    WHNE 'Y'
     C                     MOVELV#SBRC    PYBR
      *
      *  Multibranched and originating branches used
      *
     C           V#OBUV    WHEQ 'Y'
     C                     MOVELS4ORBR    PYBR
      *
      *  Multibranched and originating branches not used
      *
     C                     OTHER
     C                     MOVELS4BRCA    PYBR
      *
     C                     ENDSL
      *
     C           PYBR      CHAINPYCHGDB              90    Get defaults.
      *
      *  No record found - DB error only if not multibranched
      *
     C           *IN90     IFEQ '1'
     C           WUMBIN    ANDNE'Y'
     C                     MOVEL'PYCHGDB 'W0FILE           ***************
     C                     MOVELPYBR      W0KEY            * DB ERROR 04 *
     C                     Z-ADD5         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  No payment charges information
      *
     C           *IN90     IFEQ '1'
      *
     C           V#OBUV    IFEQ 'Y'
     C                     MOVEL'Y'       I4ORBR
     C                     ELSE
     C                     MOVEL'Y'       I4BRCA
     C                     END
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C                     MOVELPYBR      FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2001' FTMSID
     C                     EXSR FTSNMS
     C                     GOTO EXPAYC
     C                     END
      *
      *  Convert rate % discrepancy to higher & lower rate margins.
      *
     C           1         ADD  V#PCRD    UPMARG  74
     C           1         SUB  V#PCRD    LWMARG  74
      *
      *  Set up default charge and commission
      *
     C                     MOVELDFTRCT    V#TRCT
      *
      *  Unwind subroutine stack name
      *
     C           EXPAYC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPYTP   : Validate Payment Type                             *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPYTP    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRPYTP'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PYTP
      *
      *  Payment Type is mandatory
      *
     C           S4PYTP    IFEQ *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PYTP    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2227' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYTP
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYTP
     C                     END
      *
      *  Payment Type may only be OP or RP
      *
     C           S4PYTP    IFNE 'OP'
     C           S4PYTP    ANDNE'RP'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PYTP    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2228' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYTP
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYTP
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXPYTP    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPYST   : Validate Payment Subtype                          *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPYST    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRPYST'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PYST
      *
      *  Payment subtype is a mandatory field
      *
     C           S4PYST    IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2028' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYST
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYST
     C                     END
      *
      * Check sub-type exists
      *
     C                     CALL 'AODLSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*VERIFY' @OPTN   7
     C                     PARM S4PYST    @DSTC   2
     C           SDDLST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AODLSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 06 *
     C                     Z-ADD6         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PYST    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2029' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYST
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYST
     C                     END
      *                                                                   CFT002
      *** Check the vailidity of the payment type/subtype for outgoing    CFT002
      *** payments before STP to ensure correct combination               CFT002
      *                                                                   CFT002
      *** Check in Deal type/Sub type file if combination exists          CFT002
      *** for the entered values of payment type/subtype                  CFT002
      *                                                                   CFT002
     C           @DTSTK    KLIST                                          CFT002
     C                     KFLD           S4PYTP                          CFT002
     C                     KFLD           S4PYST                          CFT002
      *                                                                   CFT002
     C           @DTSTK    CHAINFDDTSTL1             90                   CFT002
     C           *IN90     IFEQ '1'                                       CFT002
     C           RCID11    OREQ '*'                                       CFT002
     C                     MOVEL'Y'       E#MSGS                          CFT002
     C                     MOVELE#CPGM    FTPGMQ                          CFT002
     C                     MOVEL'FTX0009' FTMSID                          CFT002
     C                     EXSR FTSNMS                                    CFT002
     C                     MOVEL'Y'       I4PYST                          CFT002
     C                     MOVEL'Y'       E#NOUP                          CFT002
     C                     GOTO EXPYST                                    CFT002
     C                     ENDIF                                          CFT002
      *
      *  Unwind subroutine stack name
      *
     C           EXPYST    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSWPC   : Validate Swift Priority Code                      *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRSWPC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRSWPC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SWPC
      *
      * Optional default to 'N'
      *
     C           S4SWPC    IFEQ *BLANK
     C                     MOVEL'N'       S4SWPC
     C                     GOTO EXSWPC
     C                     END
      *
      * If entered must be N(ormal) or U(rgent)
      *
     C           S4SWPC    IFNE 'U'
     C           S4SWPC    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SWPC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2030' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SWPC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSWPC
     C                     END                             E001
      *
      *  Unwind subroutine stack name
      *
     C           EXSWPC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSTMT   : Validate Settlement Type                          *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRSTMT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRSTMT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342STMT
      *
      * Field is mandatory and must be one of the following values
      *
      *        01 = Telex
      *        02 = Payment Order
      *        08 = S.W.I.F.T.
      *        10 = CHAPS S.W.I.F.T.
      *        12 = Cheque
      *        13 = Draft
      *
     C           S4STMT    IFEQ *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4STMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2229' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4STMT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSTMT
     C                     END
      *
     C/COPY WNCPYSRC,FT0342C048
     C           S4STMT    IFNE '01'
     C           S4STMT    ANDNE'02'
     C           S4STMT    ANDNE'08'
     C           S4STMT    ANDNE'10'
     C           S4STMT    ANDNE'12'
     C           S4STMT    ANDNE'13'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4STMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2230' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4STMT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSTMT
     C                     END
      *
     C/COPY WNCPYSRC,FT0342C049
      *  Unwind subroutine stack name
      *
     C           EXSTMT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRDST    : Validate Destination                              *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRDST     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRDST '  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RDST
      *
      *  Set Type of Destination to blanks
      *
     C                     MOVEL*BLANK    F4DSTT
     C/COPY WNCPYSRC,FT0342C024
      *
      *  Destination is mandatory field
      *
     C           S4DST     IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2231' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      *  ? not allowed
      *
     C           '?'       SCAN S4DST1    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2232' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      *  Move Destination to ADDRSS data structure for Analysis
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS4DST     ADDRSS
     C/COPY WNCPYSRC,FT0342C004
      *
      *  If first 5 Character are not blank but rest is blank
      *  validate as a full nostro
      *
     C           ADFNOS    IFNE *BLANKS
     C           ADFNEX    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
      *
      * Look up Nostro via Access Object
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   @CUST
     C                     PARM ADFCCY    @CYCD
     C                     PARM *BLANKS   @ACCD
     C                     PARM *BLANKS   @ACSN
     C                     PARM ADFNNB    @NONB   2
     C                     PARM *BLANKS   @BRCD
     C                     PARM *BLANKS   @CSSN
     C                     PARM *BLANKS   @PNOI
     C           SDNOST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AONOSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 07 *
     C                     Z-ADD7         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Nostro found mark as full nostro and get GL information
      *
     C           RTCD      IFEQ *BLANKS
     C                     MOVEL'F'       F4DSTT
      *
      * Store in occurrance data structure 3 any information
      *
     C           3         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C                     MOVELA7CUST    CNUM
     C                     MOVELADFCCY    CCY
     C                     MOVELA7ACCD    ACOD
     C                     MOVELA7ACSN    ACSQ
     C                     MOVELA7BRCD    BRCA
      *
     C           AKEY      CHAINACCNTABF             90
      *
      *  Database error account does not exist
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANKS   ADCHK1
     C                     MOVELA7CUST    ADGCNM
     C                     MOVELADFCCY    ADGCCY
     C                     MOVELA7ACCD    ADGACD
     C                     MOVELA7ACSN    ADGASQ
     C                     MOVELA7BRCD    ADGBRC
     C                     MOVEL'ACCNT   'W0FILE           ***************
     C                     MOVELADCHK1    W0KEY            * DB ERROR 08 *
     C                     Z-ADD8         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
     C                     END
      *
      *  If first 6 Characters are numeric but rest is blank
      *  validate as a customer reference
      *
      *  Only validate if F4DSTT is blank
      *
     C           ADCNUM    IFNE *BLANKS
     C           ADEXCN    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4DSTT    ANDEQ*BLANKS
      *
      *  Check first 6 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELS4DST1    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  6 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ7
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM ADCNUM    @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 09 *
     C                     Z-ADD9         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Customer not found
      *
     C           RTCD      IFNE *BLANKS
     C           @KYST     ORNE '*CNUM  '
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2233' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      *  Customer found mark as Customer
      *
     C                     MOVEL'C'       F4DSTT
      *
     C                     END
      *
     C                     END
      *
      *  If first 10 Characters are numeric but rest is blank
      *  validate as a retail account
      *
      *  Only validate if F4DSTT is blank
      *
     C           ADACNO    IFNE *BLANKS
     C           ADEXAC    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4DSTT    ANDEQ*BLANKS
      *
      *  Check first 10 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELS4DST1    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  10 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ11
      *
      *  Check that retail account numbers are allowed
      *
     C           V#RANR    IFEQ 'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2234' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      * Store in occurrance data structure 3 any information
      *
     C           3         OCUR OACCNT
      *
      *  Check account is on ACCNTAB
      *
     C                     MOVELADACNO    ACNO
     C           ACNO      CHAINACNUMAF              90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2235' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      *  Retail Account found mark as Retail
      *
     C                     MOVEL'R'       F4DSTT
      *
     C                     END
      *
     C                     END
      *                                                                   068230
      *  If 1st 11 Chars of 1st line then SWIFT address assumed           068230
      *  Or first is '/' and second is SWIFT Address                      068230
      *                                                                   068230
      *                                                                   068230
      *  If field does not begin with '/' and is not longer than 11       068230
      *  characters, validate as a S.W.I.F.T. Address                     068230
      *                                                                   068230
     C           ADCH26    IFEQ *BLANKS                                   068230
     C           ADEXSW    ANDEQ*BLANKS                                   068230
     C           ADSLSH    ANDNE'/'                                       068230
     C           F4DSTT    ANDEQ*BLANKS                                   068230
      *                                                                   068230
      *  First 11 characters should be key for CLSWT.                     068230
      *                                                                   068230
     C                     MOVELADCHK1    CLSWTK                          068230
      *                                                                   068230
     C                     EXSR SWIFT                                     068230
      *                                                                   068230
     C           ##CSID    IFEQ 'Y'                                       068230
     C           *IN32     IFEQ '0'                                       068230
     C           *IN31     ANDEQ'0'                                       068230
      *                                                                   068230
     C                     MOVEL'S'       F4DSTT                          068230
      *                                                                   068230
      *  No SWIFT address record.                                         068230
      *                                                                   068230
     C                     ELSE                                           068230
     C                     MOVEL'Y'       I4DST1                          068230
     C                     MOVEL'Y'       E#NOUP                          068230
     C                     MOVEL'Y'       E#MSGS                          068230
     C                     MOVELCLSWTK    FTMSDT                          068230
     C                     MOVELE#CPGM    FTPGMQ                          068230
     C                     MOVEL'FTM2358' FTMSID                          068230
     C                     EXSR FTSNMS                                    068230
     C                     GOTO EXDST                                     068230
      *                                                                   068230
     C                     END                                            068230
     C                     END                                            068230
      *                                                                   068230
     C                     END                                            068230
      *
      *  If first 10 Characters are non blank but rest is blank
      *  validate as a customer shortname
      *
      *  Only validate if F4DSTT is blank
      *
     C           ADCUST    IFNE *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4DSTT    ANDEQ*BLANKS
      *
      * Check if name exists
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM ADCUST    @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 10 *
     C                     Z-ADD10        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFNE *BLANKS
     C           @KYST     ORNE '*CSHT  '
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2236' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END                             X001
      *
      *  Customer found mark as Customer
      *
     C                     MOVEL'C'       F4DSTT
     C                     MOVEL*BLANK    S4DST1
     C                     MOVELBBCUST    S4DST1
      *
     C                     END
      *
      *  If 18 chars have been entered and multi branched , or
      *  15 long and single branch , is a full account.
      *
      *  Only validate if F4DSTT is blank
      *
     C           ADCHK1    IFNE *BLANKS
     C           ADEXGL    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4DSTT    ANDEQ*BLANKS
     C           WUMBIN    ANDEQ'Y'
     C           ADCHK1    ORNE *BLANKS
     C           ADEXG1    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4DSTT    ANDEQ*BLANKS
     C           WUMBIN    ANDEQ'N'
      *
      *  Customer number, account code and account sequence must be
      *  numeric
      *
     C                     MOVELADGCNM    PTCNUM
     C                     MOVELADGACD    PTACOD
     C                     MOVELADGASQ    PTACSQ
      *
      ***Check*first*12*characters*are*numeric*************************                       CGL029
      ** Check first 18 characters are numeric                                                CGL029
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELPTACCT    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      ***12*digits*allowed*********************************************                       CGL029
      ** 18 digits allowed                                                                    CGL029
      *
     C           *IN90     IFEQ '1'
     C********   Y#        ANDNE13                                                            CGL029
     C           Y#        ANDNE19                                                            CGL029
     C/COPY WNCPYSRC,FT0342C005
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2237' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      * Store in occurrance data structure 3 any information
      *
     C           3         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C                     MOVELADGCNM    CNUM
     C                     MOVELADGCCY    CCY
     C                     MOVELADGACD    ACOD
     C                     MOVELADGASQ    ACSQ
      *
      *  Set up branch depending on multibranching
      *
     C                     SELEC
     C           WUMBIN    WHNE 'Y'
     C                     MOVE V#SBRC    BRCA
     C           ADGBRC    WHEQ *BLANKS
     C                     MOVELDBRN      BRCA
     C                     OTHER
     C                     MOVELADGBRC    BRCA
     C                     ENDSL
      *
     C           AKEY      CHAINACCNTABF             90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2238' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDST
     C                     END
      *
      *  GL Account found mark as Ledger
      *
     C                     MOVEL'G'       F4DSTT
     C           WUMBIN    IFEQ 'Y'
     C           ADGBRC    ANDEQ*BLANKS
     C                     MOVELBRCA      ADGBRC
     C                     END
     C                     MOVELADCHK1    S4DST1
      *
     C                     END
      *
      * If F4DSTT is not blank then get other information
      *
      *  If destination is a NOSTRO set pay location to nostro location
      *  Else use system location
      *
     C                     SELEC
     C           F4DSTT    WHEQ 'G'
     C           F4DSTT    OREQ 'R'
      *
     C                     MOVELCNUM      @CUST
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @CUST   6
     C                     PARM CCY       @CYCD   3
     C**********           PARM ACODA     @ACCD   4                                           CGL029
     C                     PARM ACODA     @ACCD  10                                           CGL029
     C                     PARM ACSQA     @ACSN   2
     C                     PARM *BLANKS   @NONB
     C                     PARM BRCA      @BRCD
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AONOSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 11 *
     C                     Z-ADD11        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFEQ *BLANKS
     C                     MOVELNLOC      PLOC
     C                     MOVEL'N'       NOWRK
     C                     ELSE
     C                     MOVELV#SLCD    PLOC
     C                     MOVEL'S'       NOWRK
     C                     END
      *
     C           F4DSTT    WHEQ 'F'
     C                     MOVELNLOC      PLOC
     C                     MOVEL'N'       NOWRK
      *
     C                     OTHER
     C                     MOVELV#SLCD    PLOC
     C                     MOVEL'S'       NOWRK
     C                     ENDSL
      *
      * If a valid account has been entered,
      * store full account details for FT Transaction Status File
      * record update.
      *
     C           F4DSTT    IFEQ 'F'
     C           F4DSTT    OREQ 'R'
     C           F4DSTT    OREQ 'G'
     C**********           Z-ADDCNUM      IMCNUM                                              CSD027
     C                     MOVE CNUM      IMCNUM                                              CSD027
     C                     MOVE CCY       IMCCY
     C                     Z-ADDACOD      IMACOD
     C                     Z-ADDACSQ      IMACSQ
     C                     MOVE BRCA      IMBRCA
     C                     MOVELIMACNT    DSTDS
     C                     END
     C/COPY WNCPYSRC,FT0342C006
      *
      *  If no destination defined validate as an address
      *
     C           F4DSTT    IFEQ *BLANKS
      *
      * Validate as an address
      *
     C                     MOVEL'FTM2340' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     EXSR ADCHK
      *
      *  Depending on the indicators, highlight the field in error
      *
     C           *IN91     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2239' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2240' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I4DST1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I4DST2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I4DST3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I4DST4
     C                     END
      *
      *  If no errors then customer is an address
      *
     C           I4DST     IFEQ *BLANKS
     C                     MOVEL'A'       F4DSTT
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,FT0342C025
      *
      *  Unwind subroutine stack name
      *
     C           EXDST     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     MOVELF4DSTT    V#DSTT                                              CFT032
     C                     MOVELS4DST1    V#DST1                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRODMT   : Validate MT100 Customer                           *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRODMT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRODMT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342ODMT
      *
      * Optional - Must be 6 digit customer no. or
      *            10 character customer shortname
      *
     C           S4ODMT    IFEQ *BLANKS
     C                     GOTO EXODMT
     C                     END
      *                                                                                       CFT032
     C           3         OCUR OACCNT                                                        CFT032
     C                     MOVE 'N'       @@IBAN                                              CFT032
      *                                                                                       CFT032
      ** Move Ordering Customer to ADDRSS data structure for Analysis                         CFT032
      *                                                                                       CFT032
     C                     MOVEL*BLANKS   ADDRSS                                              CFT032
     C                     MOVELS4ODMT    ADDRSS                                              CFT032
      *                                                                                       CFT032
      ** Retrieve "Allow MT103 Accounts between FATF countries" system value                  CFT032
      ** to see if such transactions are allowed or not.                                      CFT032
      *                                                                                       CFT032
     C                     CALL 'AOSVALR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM CMT103    @OP01  20                                           CFT032
     C                     PARM *BLANKS   @VL01 200                                           CFT032
     C                     PARM *BLANKS   @OP02  20                                           CFT032
     C                     PARM *BLANKS   @VL02 200                                           CFT032
     C                     PARM *BLANKS   @OP03  20                                           CFT032
     C                     PARM *BLANKS   @VL03 200                                           CFT032
     C                     PARM *BLANKS   @OP04  20                                           CFT032
     C                     PARM *BLANKS   @VL04 200                                           CFT032
     C                     PARM *BLANKS   @OP05  20                                           CFT032
     C                     PARM *BLANKS   @VL05 200                                           CFT032
     C                     PARM *BLANKS   @OP06  20                                           CFT032
     C                     PARM *BLANKS   @VL06 200                                           CFT032
     C                     PARM *BLANKS   @OP07  20                                           CFT032
     C                     PARM *BLANKS   @VL07 200                                           CFT032
     C                     PARM *BLANKS   @OP08  20                                           CFT032
     C                     PARM *BLANKS   @VL08 200                                           CFT032
     C                     PARM *BLANKS   @OP09  20                                           CFT032
     C                     PARM *BLANKS   @VL09 200                                           CFT032
     C                     PARM *BLANKS   @OP10  20                                           CFT032
     C                     PARM *BLANKS   @VL10 200                                           CFT032
     C                     MOVEL@VL01     WVL01   1                                           CFT032
      *                                                                                       CFT032
      ** Not Allowed                                                                          CFT032
      *                                                                                       CFT032
     C           WVL01     IFEQ 'N'                                                           CFT032
      *                                                                                       CFT032
      ** Check if sender is part of FATF                                                      CFT032
      *                                                                                       CFT032
     C                     CALL 'AOBRCHR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @OPTN                                               CFT032
     C                     PARM           S4BRCA                                              CFT032
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     CALL 'AOLOCNR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @OPTN                                               CFT032
     C                     PARM           A8LCCD                                              CFT032
     C           SDLOCN    PARM SDLOCN    DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     CALL 'AOCTRYR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @OPTN                                               CFT032
     C                     PARM           A8LCCD                                              CFT032
     C           SDCTRY    PARM SDCTRY    DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C           A4ISOC    CHAINMEISOCL1             84                                       CFT032
     C           *IN84     IFEQ *OFF                                                          CFT032
     C                     MOVELM3FATF    WSFATF  1                                           CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Check if destination is part of FATF                                                 CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           F4DSTT    WHEQ 'A'                                                           CFT032
     C                     MOVE *BLANKS   WCLOC   2                                           CFT032
     C           F4DSTT    WHEQ 'S'                                                           CFT032
     C********** 2         SUBSTCLSWTK:5  WCLOC                                      CFT032 BUG14771
     C           2         SUBSTS4DST1:5  WCLOC                                             BUG14771
     C                     OTHER                                                              CFT032
     C                     CALL 'AOACCTV1'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @TYP    7                                           CFT032
     C**********           PARM S4ODMT    @STR   35                                  CFT032 BUG14771
     C                     PARM S4DST1    @STR   35                                         BUG14771
     C                     PARM           DSSDY                                               CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           @TYP      WHEQ '*RETAIL'                                                     CFT032
     C           @TYP      OREQ '*LEDGER'                                                     CFT032
     C                     MOVELDSSDY     OACCNT                                              CFT032
     C                     MOVELCNUM      WCUST   6                                           CFT032
     C           @TYP      WHEQ '*NOSTRO'                                                     CFT032
     C                     MOVELDSSDY     SDNOST                                              CFT032
     C                     MOVELA7CUST    WCUST                                               CFT032
     C           @TYP      WHEQ '*CUSTNO'                                                     CFT032
     C           @TYP      OREQ '*SHNAME'                                                     CFT032
     C                     MOVELDSSDY     SDCUST                                              CFT032
     C                     MOVELBBCUST    WCUST                                               CFT032
     C                     ENDSL                                                              CFT032
     C                     CALL 'AOCUSTR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY'    @OPTN                                               CFT032
     C                     PARM WCUST     @KEY1                                               CFT032
     C                     PARM *BLANKS   @KYST                                               CFT032
     C           SDCUST    PARM SDCUST    DSSDY                                               CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVELBBCOLC    WCLOC                                               CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C           WCLOC     CHAINMEISOCL1             84                                       CFT032
     C           *IN84     IFEQ *OFF                                                          CFT032
     C                     MOVELM3FATF    WDFATF  1                                           CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           WSFATF    IFEQ 'Y'                                                           CFT032
     C           WDFATF    ANDEQ'Y'                                                           CFT032
     C           S4ODMT    ANDNE*BLANKS                                                       CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELS4ODMT    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'MMANNN2' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1402' FTMSID                                            BUG14042
     C                     MOVEL'DRSMM   'FTMSGF                                            AR928992
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXODMT                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Check for IBAN                                                                       CFT032
      *                                                                                       CFT032
     C           1         SUBSTS4ODMT:1  WTRD1                                               CFT032
     C           1         SUBSTS4ODMT:2  WTRD2                                               CFT032
     C           1         SUBSTS4ODMT:3  WTRD3                                               CFT032
     C           1         SUBSTS4ODMT:4  WTRD4                                               CFT032
     C           WTRD1     LOKUPALPH                     87                                   CFT032
     C   87      WTRD2     LOKUPALPH                     87                                   CFT032
     C   87      WTRD3     LOKUPNUMC                     87                                   CFT032
     C   87      WTRD4     LOKUPNUMC                     87                                   CFT032
     C           *IN87     IFEQ *ON                                                           CFT032
     C                     MOVELS4ODMT    P@IBAN                                              CFT032
     C                     EXSR SRIBAN                                                        CFT032
      * If found to be an IBAN, no need to check other type of account                      BUG14771
     C********** @RTCD     IFNE *BLANKS                                              CFT032 BUG14771
     C           @RTCD     IFEQ *BLANKS                                                     BUG14771
     C********** F4ODTT    ANDEQ'I'                                                     250600250600
     C           @@IBAN    ANDEQ'Y'                                                         BUG14771
     C                     MOVE 'I'       F4ODTT                                            BUG14771
     C                     GOTO EXODMT                                                        CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Check for full nostro                                                                CFT032
      *                                                                                       CFT032
     C           ALPHAN    CHECKS4ODMT    WLEN    10                                          CFT032
     C           WLEN      IFEQ 6                                                             CFT032
     C           3         SUBSTS4ODMT    @CYCD                                               CFT032
     C           2         SUBSTS4ODMT:4  @NONB                                               CFT032
     C                     MOVE *BLANKS   @CUST                                               CFT032
     C                     MOVE *BLANKS   @ACCD                                               CFT032
     C                     MOVE *BLANKS   @ACSN                                               CFT032
     C                     MOVE *BLANKS   @BRCD                                               CFT032
     C                     MOVE *BLANKS   @CSSN                                               CFT032
     C                     MOVE *BLANKS   @PNOI                                               CFT032
     C                     EXSR SRNOST                                                        CFT032
     C********** @RTCD     IFNE *BLANKS                                              CFT032 BUG14771
     C**********           MOVEL'Y'       E#MSGS                                     CFT032 BUG14771
     C**********           MOVELS4ODMT    FTMSDT                                     CFT032 BUG14771
     C**********           MOVELE#CPGM    FTPGMQ                                     CFT032 BUG14771
     C**********           MOVEL'MMANNN4' FTMSID                                     CFT032 BUG14042
     C**********           MOVEL'MMA1404' FTMSID                                   BUG14042 BUG14771
     C**********           EXSR FTSNMS                                               CFT032 BUG14771
     C**********           MOVEL'Y'       I4ODMT                                     CFT032 BUG14771
     C**********           MOVEL'Y'       E#NOUP                                     CFT032 BUG14771
     C**********           GOTO EXODMT                                               CFT032 BUG14771
     C**********           ENDIF                                                     CFT032 BUG14771
      *                                                                                       CFT032
      ** Nostro found mark as full nostro and get GL information                              CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                     BUG14771
     C                     MOVEL'F'       F4ODTT                                              CFT032
     C                     MOVELA7CUST    CNUM                                                CFT032
     C                     MOVELADFCCY    CCY                                                 CFT032
     C                     MOVELA7ACCD    ACOD                                                CFT032
     C                     MOVELA7ACSN    ACSQ                                                CFT032
     C                     MOVELA7BRCD    BRCA                                                CFT032
     C                     EXSR SRACCT                                                        CFT032
     C           IBAN      IFNE *BLANKS                                                       CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     GOTO EXODMT                                                      BUG14771
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                            BUG14771
      *                                                                                     BUG14771
      * If found no need to check other type of account                                     BUG14771
     C           F4ODTT    IFNE ' '                                                         BUG14771
      *                                                                                       CFT032
      ** Validate as Customer number                                                          CFT032
      *                                                                                       CFT032
     C           DIGITS    CHECKS4ODMT    WLEN                                                CFT032
     C           WLEN      IFEQ 7                                                             CFT032
     C                     MOVELADCNUM    @KEY1     P                                         CFT032
     C                     EXSR SRCUST                                                        CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVEL'C'       F4ODTT                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                            BUG14771
      *                                                                                       CFT032
      ** Validate as Retail number                                                            CFT032
      *                                                                                       CFT032
      * If found no need to check other type of account                                     BUG14771
     C           F4ODTT    IFNE ' '                                                         BUG14771
      *                                                                                     BUG14771
     C           DIGITS    CHECKS4ODMT    WLEN                                                CFT032
     C           WLEN      IFEQ 11                                                            CFT032
     C                     EXSR SRRETN                                                        CFT032
     C           F4ODTT    IFEQ 'R'                                                         BUG14771
     C********** @RTCD     IFNE *BLANKS                                              CFT032 BUG14771
     C                     GOTO EXODMT                                                        CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                     BUG14771
     C                     ENDIF                                                            BUG14771
      *                                                                                     BUG14771
      *                                                                                       CFT032
      ** Check for customer shortname                                                         CFT032
      *                                                                                       CFT032
     C********** ALPHAB    CHECKS4ODMT    WLEN                                       CFT032 BUG14771
     C           ALPHAN    CHECKS4ODMT    WLEN                                              BUG14771
     C           WLEN      IFNE 0                                                             CFT032
     C           WLEN      ANDLE11                                                            CFT032
     C                     MOVELADCUST    @KEY1                                               CFT032
     C                     EXSR SRCUST                                                        CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVEL'C'       F4ODTT                                              CFT032
     C                     GOTO EXODMT                                                      BUG14771
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Check for SWIFT code                                                                 CFT032
      *                                                                                       CFT032
     C********** ALPHAB    CHECKS4ODMT    WLEN                                       CFT032 BUG14771
     C           ALPHAN    CHECKS4ODMT    WLEN                                              BUG14771
     C           WLEN      IFEQ 9                                                             CFT032
     C           WLEN      OREQ 12                                                            CFT032
     C                     EXSR SRSWFT                                                        CFT032
     C           F4ODTT    IFEQ 'S'                                                         BUG14771
     C                     GOTO EXODMT                                                      BUG14771
     C                     END                                                              BUG14771
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Check for general ledger account                                                     CFT032
      *                                                                                       CFT032
     C           DIGITS    CHECKS4ODMT    WLEN                                                CFT032
     C           WUMBIN    IFEQ 'N'                                                           CFT032
     C           WLEN      ANDEQ16                                                            CFT032
     C           WUMBIN    OREQ 'Y'                                                           CFT032
     C********** WLEN      ANDEQ18                                                   CFT032 BUG14771
     C           WLEN      ANDEQ19                                                          BUG14771
     C                     EXSR SRLEDA                                                        CFT032
     C********** @RTCD     IFNE *BLANKS                                              CFT032 BUG14771
     C           F4ODTT    IFNE *BLANKS                                                     BUG14771
     C                     GOTO EXODMT                                                        CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** If account has been entered                                                          CFT032
      *                                                                                       CFT032
     C           F4ODTT    IFEQ 'I'                                                           CFT032
     C           F4ODTT    OREQ 'G'                                                           CFT032
     C           F4ODTT    OREQ 'F'                                                           CFT032
     C           F4ODTT    OREQ 'R'                                                           CFT032
     C           S4SMCY    IFNE *BLANKS                                                       CFT032
     C                     MOVELS4SMCY    WCCY    3                                           CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELS4PCCY    WCCY    3                                           CFT032
     C                     ENDIF                                                              CFT032
     C           CCY       IFNE WCCY                                                          CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELS4ODMT    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'MMANNN4' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1404' FTMSID                                            BUG14042
     C                     MOVEL'DRSMM   'FTMSGF                                            AR928992
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXODMT                                                        CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** S4ODMT not blanks                                                                    CFT032
      *                                                                                       CFT032
     C           S4ODMT    IFNE *BLANKS                                                       CFT032
     C                     MOVE F4ODTT    WENTTP  1                                           CFT032
     C                     MOVELS4ODMT    WOCUST 35                                           CFT032
     C                     MOVE *BLANKS   @RTCD                                               CFT032
     C                     EXSR SROUFM                                                        CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      *
     C**********           CALL 'AOCUSTR0'             9090                                   CFT032
     C**********           PARM *BLANKS   RTCD                                                CFT032
     C**********           PARM '*KEY   ' @OPTN                                               CFT032
     C**********           PARM S4ODMT    @KEY1                                               CFT032
     C**********           PARM *BLANKS   @KYST                                               CFT032
     C********** SDCUST    PARM *BLANKS   DSSDY                                               CFT032
      *
      *  If error on call
      *
     C********** *IN90     IFEQ '1'                                                           CFT032
     C**********           MOVEL'AOCUSTR0'W0FILE           ***************                    CFT032
     C**********           MOVEL'*CALL'   W0KEY            * DB ERROR 12 *                    CFT032
     C**********           Z-ADD12        W0ERNB           ***************                    CFT032
     C**********           MOVEL'MEM5003' W0MSGD                                              CFT032
     C**********           MOVEL'MIDAS  ' W0MSGF                                              CFT032
     C**********           EXSR SRERR                                                         CFT032
     C**********           END                                                                CFT032
      *                                                                                       CFT032
     C********** RTCD      IFNE *BLANKS                                                       CFT032
     C**********           MOVEL'Y'       E#MSGS                                              CFT032
     C**********           MOVELS4ODMT    FTMSDT                                              CFT032
     C**********           MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'FTM2241' FTMSID                                              CFT032
     C**********           EXSR FTSNMS                                                        CFT032
     C**********           MOVEL'Y'       I4ODMT                                              CFT032
     C**********           MOVEL'Y'       E#NOUP                                              CFT032
     C**********           GOTO EXODMT                                                        CFT032
     C**********           END                                                                CFT032
      *                                                                                       CFT032
     C**********           MOVEL*BLANKS   S4ODMT                                              CFT032
     C**********           MOVELBBCUST    S4ODMT                                              CFT032
      *
      *  Unwind subroutine stack name
      *
     C           EXODMT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSMCY   : Validate Settlement Currency                      *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRSMCY    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRSMCY'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SMCY
      *
      *  Field is mandatory
      *
     C           S4SMCY    IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SMCY    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2041' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SMCY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSMCY
     C                     END
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S4SMCY    @K101   3
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 13 *
     C                     Z-ADD13        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFNE *BLANKS                    B001
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SMCY    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2042' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SMCY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSMCY
     C                     END
      *
      *  Move new standing data field into field used in program
      *
     C           *LIKE     DEFN A6NBDP    SCNBDP
     C           *LIKE     DEFN A6SPRT    SCSPOT
     C           *LIKE     DEFN A6MDIN    SCMDIN
     C           *LIKE     DEFN A6SPRT    SCBUY
     C           *LIKE     DEFN A6SPRT    SCSELL
      *
      * Store Decimal Places Spot Rate Multiply/Divide Ind.
      *
     C                     Z-ADDA6NBDP    SCNBDP
     C                     Z-ADDA6SPRT    SCSPOT
     C                     MOVELA6MDIN    SCMDIN
     C/COPY WNCPYSRC,FT0342C028
      *
     C           A6BYSS    IFEQ '+'
     C           A6SPRT    ADD  A6BYSR    SCBUY
     C                     ELSE
     C           A6SPRT    SUB  A6BYSR    SCBUY
     C                     END
      *
     C           A6SLSS    IFEQ '+'
     C           A6SPRT    ADD  A6SLSR    SCSELL
     C                     ELSE
     C           A6SPRT    SUB  A6SLSR    SCSELL
     C                     END
     C/COPY WNCPYSRC,FT0342C029
      *
      *  Unwind subroutine stack name
      *
     C           EXSMCY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSMAM   : Validate Settle Amount                            *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRSMAM    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRSMAM'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SMAM
      *
     C                     Z-ADD0         F4SMAM
      *
      * Mandatory if pay amount not entered
      *
     C           S4SMAM    IFEQ *BLANK
     C           S4PYAM    ANDEQ*BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SMAM    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2043' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SMAM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSMAM
     C                     END
      *
      * If entered Validate
      *
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE S4SMAM    ZFIELD
     C           13        SUB  SCNBDP    ZADIG
     C                     Z-ADDSCNBDP    ZADEC
      *
     C                     EXSR SRALGN
      *
     C           ZRTN      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SMAM    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2044' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SMAM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSMAM
     C                     END
      *
     C                     MOVE ZFIELD    F4SMAM
      *
      * Set amount entered indicator if pay amount
      * or it is blanks
      *
     C           S4PYAM    IFEQ *BLANK
     C           F4FAIN    OREQ *BLANK
     C                     MOVEL'P'       F4FAIN
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXSMAM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRORC    : Validate Ordering Customer                        *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRORC     BEGSR
      *
     C                     MOVE 'N'       @@IBAN  1                                           CFT032
     C                     MOVE *BLANKS   WORC1  34                                           CFT032
     C                     MOVELS4ORC1    WSLSH   1                                           CFT032
     C           WSLSH     IFEQ '/'                                                           CFT032
     C           34        SUBSTS4ORC1:2  WORC1                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELS4ORC1    WORC1                                               CFT032
     C                     ENDIF                                                              CFT032
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRORC '  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RORC
      *
     C                     MOVEL*BLANK    F4ORCT
      *
      *  ? not allowed
      *
     C           '?'       SCAN S4ORC1    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2242' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      *  Ordering Customer is mandatory
      *
     C           S4ORC     IFEQ *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2243' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *                                                                   CGL009
      **  If the message is from the FONTIS and the first line is         CGL009
      **  a partial account, we have appended the currency at the end.    CGL009
      **  If this currency is the same as the one of the settlement we    CGL009
      **  remove it and let the rest of validation operates it            CGL009
      **  as a partial account                                            CGL009
      **                                                                  CGL009
      *                                                                   CGL009
     C           V#NWRK    IFEQ 'FONTIS'                                  CGL009
     C           ' '       CHEKRS4ORC1    WACLN   20                      CGL009
      ** It is not a retail account                                       CGL009
      ** (Currency has been added at the end of the partial account)      CGL009
     C********** WACLN     IFEQ 18                                                     CGL009 CGL029
     C           WACLN     IFEQ 24                                                            CGL029
     C                     MOVELS4ORC1    DSORC1                          CGL009
     C           WORCY     IFEQ S4SMCY                                    CGL009
     C                     MOVEL*BLANK    WORCY                           CGL009
     C                     MOVELDSORC1    S4ORC1                          CGL009
     C                     ELSE                                           CGL009
      ** If it has been recognized as a Midas valid A/C in FT0300  the    175474
      ** other lines are blank. Otherwise Ord Cus = :53: + :50:           175474
     C           S4ORC2    IFEQ *BLANK                                    175474
     C           S4ORC3    ANDEQ*BLANK                                    175474
     C           S4ORC4    ANDEQ*BLANK                                    175474
     C           S4ORC5    ANDEQ*BLANK                                                        CFT032
     C                     MOVEL'Y'       E#MSGS                          CGL009
     C                     MOVELWORBR     WGLBR                           CGL009
     C                     MOVELWORCN     WGLCN                           CGL009
     C                     MOVELWORCY     WGLCY                           CGL009
     C                     MOVELWORAC     WGLAC                           CGL009
     C                     MOVELWORSQ     WGLSQ                           CGL009
     C                     MOVELDSGLAC    FTMSDT                          CGL009
     C                     MOVELE#CPGM    FTPGMQ                          CGL009
     C                     MOVEL'FTM2610' FTMSID                          CGL009
     C                     EXSR FTSNMS                                    CGL009
     C                     MOVEL'Y'       I4ORC                           CGL009
     C                     MOVEL'Y'       E#NOUP                          CGL009
     C                     GOTO EXORC                                     CGL009
     C                     ENDIF                                          175474
     C                     ENDIF                                          CGL009
     C                     ENDIF                                          CGL009
     C                     ENDIF                                          CGL009
      *
      *  Move Ordering Customer to ADDRSS data structure for Analysis
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS4ORC     ADDRSS
      *
      *  If line 1 is MT202 then set as an address
      *
     C           ADCHK1    IFEQ ORCFLD
      *
      * Validate as an address
      *
     C                     MOVEL'FTM2341' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     MOVE 'Y'       ADLINE                                            BUG14771
     C                     EXSR ADCHK
      *
      *  Depending on the indicators, highlight the field in error
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2110' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2111' FTMSID
     C                     EXSR FTSNMS
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC4
     C                     END
     C           AD#5      IFEQ 'Y'                                                           CFT032
     C                     MOVEL'Y'       I4ORC5                                              CFT032
     C                     END                                                                CFT032
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      * Field is valid exit as an address
      *
     C                     MOVEL'A'       F4ORCT
     C                     GOTO EXORC
     C                     END
      *                                                                                       CFT032
     C           WSLSH     IFEQ '/'                                                           CFT032
      *                                                                                       CFT032
      ** If first character of ordering customer is '/' statement type                        CFT032
      ** must be SWIFT or TELEX                                                               CFT032
      *                                                                                       CFT032
     C           S4STMT    IFNE '08'                                                          CFT032
     C********** S4STMT    ORNE '01'                                                  CFT032 CSW207A
     C           S4STMT    ANDNE'01'                                                         CSW207A
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELS4STMT    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'MMAnn11' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1411' FTMSID                                            BUG14042
     C                     MOVEL'DRSMM   'FTMSGF                                            AR928992
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ORC1                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              250600
      *                                                                                       CFT032
      ** If switchable feature CFT004 is on, validate entry                                   CFT032
      ** as an IBAN.                                                                          CFT032
      *                                                                                       CFT032
     C           CFT004    IFEQ 'Y'                                                           CFT032
     C           S4ORBK    IFNE *BLANKS                                                       CFT032
      *                                                                                       CFT032
      ** Remove any blanks and special characters                                             CFT032
      *                                                                                       CFT032
     C**********           MOVELWORC1     PWORC1 47                                   CSW207A 250600
     C                     MOVELWORC1     PIBAN  47 P                                         250600
     C                     CALL 'AOIBANR3'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C**********           PARM           WORC1                                       CFT032 CSW207A
     C**********           PARM           PWORC1                                      CSW207A 250600
     C                     PARM           PIBAN                                               250600
     C                     PARM           POWITH 47                                           CFT032
     C           P@IBAN    PARM           PONOBL 34                                           CFT032
      *                                                                                       CFT032
      ** First 2 characters must be alpha and the next 2 numeric                              CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C           1         SUBSTP@IBAN:1  WTRD1   1                                           CFT032
     C           1         SUBSTP@IBAN:2  WTRD2   1                                           CFT032
     C           1         SUBSTP@IBAN:3  WTRD3   1                                           CFT032
     C           1         SUBSTP@IBAN:4  WTRD4   1                                           CFT032
     C           WTRD1     LOKUPALPH                     87                                   CFT032
     C   87      WTRD2     LOKUPALPH                     87                                   CFT032
     C   87      WTRD3     LOKUPNUMC                     87                                   CFT032
     C   87      WTRD4     LOKUPNUMC                     87                                   CFT032
      *                                                                                       CFT032
      ** If entry is in valid IBAN format, validate external IBAN                             CFT032
      *                                                                                       CFT032
     C           *IN87     IFEQ *ON                                                           CFT032
     C                     CALL 'AOIBANR5'             86                                     CFT032
     C                     PARM *BLANKS   @RTCD   7                                           CFT032
     C                     PARM           P@IBAN 34                                           CFT032
      *                                                                                       CFT032
      ** Valid external IBAN                                                                  CFT032
      *                                                                                       CFT032
     C           *IN86     IFEQ *OFF                                                          CFT032
     C           @RTCD     ANDEQ*BLANKS                                                       CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
      *                                                                                       CFT032
      ** Invalid external IBAN                                                                CFT032
      *                                                                                       CFT032
     C                     ELSE                                                               CFT032
     C                     MOVE @RTCD     WRTCD   1                                           CFT032
     C                     MOVELCORDRC    FTMSDT                                              CFT032
     C                     SELEC                                                              CFT032
      *                                                                                       CFT032
      ** Invalid ISO Country Code                                                             CFT032
      *                                                                                       CFT032
     C           WRTCD     WHEQ '1'                                                           CFT032
     C                     MOVEL'FTM2400' FTMSID                                              CFT032
      *                                                                                       CFT032
      ** Invalid BBAN Length                                                                  CFT032
      *                                                                                       CFT032
     C           WRTCD     WHEQ '2'                                                           CFT032
     C                     MOVEL'FTM2401' FTMSID                                              CFT032
      *                                                                                       CFT032
      ** Invalid Character                                                                    CFT032
      *                                                                                       CFT032
     C           WRTCD     WHEQ '3'                                                           CFT032
     C                     MOVEL'FTM2402' FTMSID                                              CFT032
      *                                                                                       CFT032
      ** Invalid IBAN Length                                                                  CFT032
      *                                                                                       CFT032
     C           WRTCD     WHEQ '4'                                                           CFT032
     C                     MOVEL'FTM2403' FTMSID                                              CFT032
      *                                                                                       CFT032
      ** Invalid Check Digit                                                                  CFT032
      *                                                                                       CFT032
     C           WRTCD     WHEQ '5'                                                           CFT032
     C                     MOVEL'FTM2404' FTMSID                                              CFT032
     C                     OTHER                                                              CFT032
     C                     MOVEL'FTM2405' FTMSID                                              CFT032
     C                     ENDSL                                                              CFT032
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ORC1                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXORC                                                         CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      **  Determine corresponding Midas account of IBAN account                               CFT032
      *                                                                                       CFT032
     C                     ELSE                                                               CFT032
      *                                                                                     BUG15037
      * Store in occurrance data structure 2 any information                                BUG15037
      *                                                                                     BUG15037
     C           2         OCUR OACCNT                                                      BUG15037
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           P@IBAN                                              CFT032
     C           OACCNT    PARM           DSSDY                                               CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C           RECI      ANDEQ'D'                                                           CFT032
     C                     MOVE 'I'       F4ORCT                                              CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C**********           ENDIF                                                       CFT032 250600
      *                                                                                       CFT032
     C/COPY WNCPYSRC,FT0342C001
      *
      *  If first 6 Characters are numeric but rest is blank
      *  validate as a customer reference
      *
      *  Only validate if F4ORCT is blank
      *
     C           ADCNUM    IFNE *BLANKS
     C           ADEXCN    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4ORCT    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           ADSLSH    OREQ '/'                                                           CFT032
     C           ADCNM2    ANDNE*BLANKS                                                       CFT032
     C           ADXCN2    ANDEQ*BLANKS                                                       CFT032
     C           F4ORCT    ANDEQ*BLANKS                                                       CFT032
      *
      *  Check first 6 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C                     MOVELS4ORC2    I#FLD                                               CFT032
     C                     MOVELS4ORC2    @KEY1                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELS4ORC1    I#FLD  35
     C                     MOVELS4ORC1    @KEY1                                               CFT032
     C                     ENDIF                                                              CFT032
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  6 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ7
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C**********           PARM ADCNUM    @KEY1                                               CFT032
     C                     PARM           @KEY1                                               CFT032
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 50 *
     C                     Z-ADD50        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Customer not found
      *
     C           RTCD      IFNE *BLANKS
     C           @KYST     ORNE '*CNUM  '
     C                     MOVEL'Y'       E#MSGS
     C**********           MOVELS4ORC1    FTMSDT                                              CFT032
     C                     MOVEL@KEY1     FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2353' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      *  Customer found mark as Customer
      *
     C                     MOVEL'C'       F4ORCT
      *
     C                     END
      *
     C                     END
      *                                                                                       CFT032
      ** Check if input can be a swift addresss                                               CFT032
      *                                                                                       CFT032
     C           F4ORCT    IFEQ *BLANKS                                                       CFT032
     C                     MOVELS4ORC2    WSLSH2  1                                           CFT032
     C********** WSLSH     IFNE '/'                                                  CFT032 BUG14771
     C********** WSLSH2    OREQ '/'                                                  CFT032 BUG14771
      *                                                                                       CFT032
     C           WSLSH     IFNE '/'                                                           CFT032
     C                     MOVELS4ORC1    CLSWTK                                              CFT032
     C                     ELSE                                                             BUG14771
     C**********           ENDIF                                                     CFT032 BUG14771
     C********** WSLSH2    IFEQ '/'                                                  CFT032 BUG14771
     C                     MOVELS4ORC2    CLSWTK                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     EXSR SWIFT                                                         CFT032
     C           ##CSID    IFEQ 'Y'                                                           CFT032
      *                                                                                       CFT032
      ** Mark as a SWIFT address                                                              CFT032
      *                                                                                       CFT032
     C           *IN32     IFEQ *OFF                                                          CFT032
     C           *IN31     ANDEQ*OFF                                                          CFT032
     C                     MOVEL'S'       F4ORCT                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      **  No SWIFT address record                                                             CFT032
      *                                                                                       CFT032
     C           *IN32     IFEQ *ON                                                           CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELCLSWTK    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'FTM2358' FTMSID                                              CFT032
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ORC1                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXORC                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
     C**********           ENDIF                                                     CFT032 BUG14771
     C                     ENDIF                                                              CFT032
      *
      *  If first 10 Characters are numeric but rest is blank
      *  validate as a retail account
      *
     C           ADACNO    IFNE *BLANKS
     C           ADEXAC    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           F4ORCT    ANDEQ*BLANKS                                                     BUG14771
     C           ADSLSH    OREQ '/'                                                           CFT032
     C           ADACN2    ANDNE*BLANKS                                                       CFT032
     C           ADCHA2    ANDEQ*BLANKS                                                       CFT032
     C           F4ORCT    ANDEQ*BLANKS                                                     BUG14771
      *
      *  Check first 10 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C                     MOVELADACN2    I#FLD                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELS4ORC1    I#FLD  35
     C                     ENDIF                                                              CFT032
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  10 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ11
      *
      *  Check that retail account numbers are allowed
      *
     C           V#RANR    IFEQ 'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2245' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      * Store in occurrance data structure 2 any information
      *
     C           2         OCUR OACCNT
      *
      *  Check account is on ACCNTAB
      *
     C**********           MOVELADACNO    ACNO                                                CFT032
     C                     MOVELI#FLD     ACNO                                                CFT032
     C           ACNO      CHAINACNUMAF              90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2246' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      * If Ordering Bank is blank currency must equal settle currency
      *
     C           S4ORBK    IFEQ *BLANK
     C           CCY       ANDNES4SMCY
     C                     MOVEL'Y'       E#MSGS
     C           S4SMCY    CAT  S4ORC1    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2247' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      *  Retail Account found mark as Retail
      *
     C                     MOVEL'R'       F4ORCT
      *
     C                     END
      *
     C                     END
      *
      *  If first 10 Characters are non blank but rest is blank
      *  validate as a customer shortname
      *
      *  Only validate if F4ORCT is blank
      *
     C           ADCUST    IFNE *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4ORCT    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           ADSLSH    OREQ '/'                                                           CFT032
     C           ADCUS2    ANDNE*BLANKS                                                       CFT032
     C           ADXCS2    ANDEQ*BLANKS                                                       CFT032
     C           ADCH36    ANDEQ*BLANKS                                                     BUG26138
     C           F4ORCT    ANDEQ*BLANKS                                                     BUG26138
      *                                                                                       CFT032
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C                     MOVELADCUS2    @KEY1                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELADCUST    @KEY1                                               CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                     BUG15042
     C                     MOVEL@KEY1     W1ST    1                                         BUG15042
     C                     TESTN          W1ST       95                                     BUG15042
      *                                                                                     BUG15042
     C           *IN95     IFEQ *OFF                                                        BUG15042
      *
      * Check if name exists
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN   7
     C**********           PARM ADCUST    @KEY1  10                                           CFT032
     C                     PARM           @KEY1  10                                           CFT032
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 51 *
     C                     Z-ADD51        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFNE *BLANKS
     C           @KYST     ORNE '*CSHT  '
     C                     MOVEL'Y'       E#MSGS
     C**********           MOVELS4ORC1    FTMSDT                                              CFT032
     C                     MOVEL@KEY1     FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2354' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END                             X001
     C**********           ENDIF                                                   BUG15042 BUG26138
      *
      *  Customer found mark as Customer
      *
     C                     MOVEL'C'       F4ORCT
     C                     MOVEL*BLANK    S4ORC1
     C                     MOVELBBCUST    S4ORC1
      *
     C                     ENDIF                                                            BUG26138
     C                     END
      *
      *  If 15 char have been entered and multi branched , or
      *  12 characters and single branch , must be a partial account.
      *
      *  Only validate if F4ORCT is blank
      *
     C           ADCHK1    IFNE *BLANKS
     C           ADEXPA    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4ORCT    ANDEQ*BLANKS
     C           WUMBIN    ANDEQ'Y'
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           ADCHK1    ORNE *BLANKS
     C           ADEXP1    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4ORCT    ANDEQ*BLANKS
     C           WUMBIN    ANDEQ'N'
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           ADSLSH    OREQ '/'                                                           CFT032
     C           ADCHK1    ANDNE*BLANKS                                                       CFT032
     C           ADEXA2    ANDEQ*BLANKS                                                       CFT032
     C           ADCH26    ANDEQ*BLANKS                                                       CFT032
     C           F4ORCT    ANDEQ*BLANKS                                                       CFT032
     C           WUMBIN    ANDEQ'Y'                                                           CFT032
     C           ADSLSH    OREQ '/'                                                           CFT032
     C           ADCHK1    ANDNE*BLANKS                                                       CFT032
     C           ADEXP2    ANDEQ*BLANKS                                                       CFT032
     C           ADCH26    ANDEQ*BLANKS                                                       CFT032
     C           F4ORCT    ANDEQ*BLANKS                                                       CFT032
     C           WUMBIN    ANDEQ'N'                                                           CFT032
      *                                                                                       CFT032
     C                     MOVEL*BLANKS   ##BRCA  3                                           CFT032
      *
      *  Customer number, account code and account sequence must be
      *  numeric
      *
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C                     MOVELADPCN2    PTCNUM                                              CFT032
     C                     MOVELADPAC2    PTACOD                                              CFT032
     C                     MOVELADPAS2    PTACSQ                                              CFT032
     C                     MOVELADPBR2    ##BRCA                                              CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELADPCNM    PTCNUM
     C                     MOVELADPACD    PTACOD
     C                     MOVELADPASQ    PTACSQ
     C                     MOVELADPBRC    ##BRCA                                              CFT032
     C                     ENDIF                                                              CFT032
      *
      ***Check*first*12*characters*are*numeric*************************                       CGL029
      ** Check first 18 characters are numeric                                                CGL029
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELPTACCT    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      ***12*digits*allowed*********************************************                       CGL029
      ** 18 digits allowed                                                                    CGL029
      *
     C           *IN90     IFEQ '1'
     C********   Y#        ANDNE13                                                            CGL029
     C           Y#        ANDNE19                                                            CGL029
     C/COPY WNCPYSRC,FT0342C003
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2248' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      * Store in occurrance data structure 2 any information
      *
     C           2         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C**********           MOVELADPCNM    CNUM                                                CFT032
     C                     MOVELPTCNUM    CNUM                                                CFT032
     C                     MOVELS4SMCY    CCY
     C**********           MOVELADPACD    ACOD                                                CFT032
     C**********           MOVELADPASQ    ACSQ                                                CFT032
     C                     MOVELPTACOD    ACOD                                                CFT032
     C                     MOVELPTACSQ    ACSQ                                                CFT032
      *
      *  Set up branch depending on multibranching
      *
     C                     SELEC
     C           WUMBIN    WHNE 'Y'
     C                     MOVE V#SBRC    BRCA
     C           ADPBRC    WHEQ *BLANKS
     C                     MOVELDBRN      BRCA
     C                     OTHER
     C**********           MOVELADPBRC    BRCA                                                CFT032
     C                     MOVEL##BRCA    BRCA                                                CFT032
     C                     ENDSL
      *
     C           AKEY      CHAINACCNTABF             90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2249' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORC
     C                     END
      *
      *  GL Account found mark as Partial Account
      *
     C                     MOVEL'P'       F4ORCT
     C           WUMBIN    IFEQ 'Y'
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C           ADPBR2    IFEQ *BLANKS                                                       CFT032
     C                     MOVELBRCA      ADPBR2                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ELSE                                                               CFT032
     C********** ADPBRC    ANDEQ*BLANKS                                                       CFT032
     C           ADPBRC    IFEQ *BLANKS                                                       CFT032
     C                     MOVELBRCA      ADPBRC
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     END
     C                     MOVELADCHK1    S4ORC1
      *
     C                     END
     C/COPY WNCPYSRC,FT0342C002
      *
      *  If no destination defined validate as an address
      *
     C           F4ORCT    IFEQ *BLANKS
      *
      * Validate as an address
      *
     C                     MOVEL'FTM2341' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     MOVE 'Y'       ADLINE                                            BUG14771
     C                     EXSR ADCHK
      *
      *  Depending on the indicators, highlight the field in error
      *
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2250' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I4ORC4
     C                     END
     C           AD#5      IFEQ 'Y'                                                           CFT032
     C                     MOVEL'Y'       I4ORC5                                              CFT032
     C                     END                                                                CFT032
      *
      *  If no errors then customer is an address
      *
     C           I4ORC     IFEQ *BLANKS
     C                     MOVEL'A'       F4ORCT
     C                     END
      *
     C                     END
      *
      * If a valid account has been entered,
      * store full account details for FT Transaction Status File
      * record update.
      *
     C           F4ORCT    IFEQ 'R'
     C           F4ORCT    OREQ 'P'
     C**********           Z-ADDCNUM      IMCNUM                                              CSD027
     C                     MOVE CNUM      IMCNUM                                              CSD027
     C                     MOVE CCY       IMCCY
     C                     Z-ADDACOD      IMACOD
     C                     Z-ADDACSQ      IMACSQ
     C                     MOVE BRCA      IMBRCA
     C                     MOVELIMACNT    ORCDS
     C           IBAN      IFNE *BLANKS                                                       CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     END
      *                                                                                       CFT032
     C           S4ORC1    IFEQ ORCFLD                                                        CFT032
     C           S4ORC2    ANDEQ*BLANKS                                                       CFT032
     C           S4ORC3    ANDEQ*BLANKS                                                       CFT032
     C           S4ORC4    ANDEQ*BLANKS                                                       CFT032
     C           S4ORC5    ANDEQ*BLANKS                                                       CFT032
     C********** S4ODMT    ORNE *BLANKS                                              CFT032 BUG14771
      *                    ELSE                                                               CFT032
     C                     ELSE                                                             BUG14771
     C           S4ODMT    IFEQ *BLANKS                                                     BUG14771
     C                     MOVE *BLANKS   @RTCD                                               CFT032
     C                     MOVE F4ORCT    WENTTP                                              CFT032
     C                     MOVELS4ORC1    WOCUST                                              CFT032
     C                     EXSR SROUFM                                                        CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C                     MOVE 'Y'       I4ORC1                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                            BUG14771
      *                                                                                       CFT032
     C           F4ORCT    IFEQ 'I'                                                           CFT032
     C                     MOVELIMACNT    ORCDS                                               CFT032
     C                     ENDIF                                                              CFT032
      ** Process FT001000 validation                                                          CSW207
     C/COPY OFCPYSRCZ,CFT148_029                                                            MD020161
     C                     EXSR SRSWF2                                                        CSW207
     C/COPY OFCPYSRCZ,CFT148_030                                                            MD020161
      *
      *  Unwind subroutine stack name
      *
     C           EXORC     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  SRSWF2   : Validate via FT001000                             *                       CSW207
      *                                                               *                       CSW207
      *  CALLED BY: SRORC  - Validate Ordering Customer               *                       CSW207
      *                                                               *                       CSW207
      *  CALLS    :        -                                          *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
     C           SRSWF2    BEGSR                                                              CSW207
     C           CSW207    IFEQ 'Y'                                                           CSW207
     C********** 15        SUBSTIMACNT:4  @1ACNT 15                                   250600 250804A
     C                     MOVELIMACNT    @1ACNT 21                                          250804A
     C********** IMBRCA    CAT  @1ACNT    @2ACNT 18                                   250600 250804A
     C           IMBRCA    CAT  @1ACNT    @2ACNT 24                                          250804A
     C                     MOVEL*BLANKS   PBRCH                                               CSW207
     C                     MOVEL*BLANKS   PACCT                                               CSW207
     C                     MOVEL*BLANK    PATYP                                               CSW207
     C                     MOVEL*BLANKS   PCUST                                               CSW207
     C                     MOVEL*BLANKS   PNWRK                                               250600
      * Check if / is needed in S4ORC1                                                        CSW207
     C**********           MOVEL*BLANKS   WAC    24                                    CSW207 250600
     C**********           Z-ADD0         WACLN   20                                   CSW207 250600
     C**********           MOVELS4ORC1    WAC                                          CSW207 250600
     C**********           MOVELS4ORC1    WCHK1   1                                    CSW207 250600
     C********** ' '       CHEKRWAC       WACLN                                        CSW207 250600
     C********** WCHK1     IFNE '/'                                                    CSW207 250600
     C********** WACLN     IFNE 10                                                     CSW207 250600
     C********** S4ORC1    ANDNE*BLANKS                                                CSW207 250600
     C********** '/'       CAT  S4ORC1    S4ORC1                                       CSW207 250600
     C**********           ENDIF                                                       CSW207 250600
     C**********           ENDIF                                                       CSW207 250600
      * Populate according to account type                                                    CSW207
     C           F4ORCT    IFEQ 'C'                                                           CSW207
     C                     MOVELBBCUST    PCUST                                               CSW207
     C                     MOVEL'C'       PATYP                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           F4ORCT    IFEQ 'S'                                                           CSW207
     C**********           MOVELBBCUST    PCUST                                        CSW207 250600
     C                     MOVEL'S'       PATYP                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           F4ORCT    IFEQ 'R'                                                           CSW207
     C                     MOVELCNUM      PCUST                                               CSW207
     C                     MOVEL'R'       PATYP                                               CSW207
     C**********           MOVELACNO      PACCT                                        CSW207 250600
     C                     MOVEL@2ACNT    PACCT                                               250600
     C                     MOVELBRCA      PBRCH                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           F4ORCT    IFEQ 'I'                                                           CSW207
     C                     MOVELCNUM      PCUST                                               CSW207
     C                     MOVEL'I'       PATYP                                               CSW207
     C**********           MOVELACNO      PACCT                                        CSW207 250600
     C                     MOVEL@2ACNT    PACCT                                               250600
     C                     MOVELBRCA      PBRCH                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           F4ORCT    IFEQ 'P'                                                           CSW207
     C                     MOVELCNUM      PCUST                                               CSW207
     C**********           MOVEL'G'       PATYP                                        CSW207 250600
     C                     MOVEL'P'       PATYP                                               250600
     C**********           MOVELACNO      PACCT                                        CSW207 250600
     C                     MOVEL@2ACNT    PACCT                                               250600
     C                     MOVELBRCA      PBRCH                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     MOVEL*BLANKS   PRTCDE                                              CSW207
     C                     MOVEL*BLANKS   PNONA                                               CSW207
     C                     SELEC                                                              250600
     C           V#NWRK    WHNE *BLANKS                                                       250600
     C                     MOVELV#NWRK    PNWRK                                               250600
     C           V#STMT    WHEQ '01'                                                          250600
     C                     MOVEL'TELEX'   PNWRK                                               250600
     C           V#STMT    WHEQ '02'                                                          250600
     C                     MOVEL'MAIL '   PNWRK                                               250600
     C           V#STMT    WHEQ '12'                                                          250600
     C           V#STMT    WHEQ '13'                                                          250600
     C                     MOVEL'CHEQUE'  PNWRK                                               250600
     C           V#STMT    WHEQ '08'                                                          250600
     C                     MOVEL'SWIFT'   PNWRK                                               CSW207
     C                     OTHER                                                              250600
     C                     MOVEL*BLANKS   PNWRK                                               250600
     C                     ENDSL                                                              250600
     C           V#MTPY    IFNE *BLANKS                                                       250600
     C                     MOVELV#MTPY    PMSGTP                                              250600
     C                     ELSE                                                               250600
     C           S4ORC1    IFEQ ORCFLD                                                        250600
     C                     MOVEL'202'     PMSGTP                                              250600
     C                     ELSE                                                               250600
     C                     MOVEL'103'     PMSGTP                                              CSW207
     C                     ENDIF                                                              250600
     C                     ENDIF                                                              250600
     C                     MOVEL':50F:'   PMSGTG                                              CSW207
      * Country of location set in SROUFM                                                     250600
     C**********           MOVELBBCOLC    PCTRY                                        CSW207 250600
     C                     MOVEL@CNTLC    PCTRY                                               250600
     C           S4PCCY    IFNE *BLANKS                                                       250600
     C                     MOVELS4PCCY    PCURR                                               CSW207
     C                     ELSE                                                               250600
     C                     MOVELS4SMCY    PCURR                                               250600
     C                     ENDIF                                                              250600
      * Nostro set in SROUFM                                                                  250600
     C**********           MOVEL*BLANKS   PNOST                                        CSW207 250600
     C                     MOVEL@NOSTN    PNOST                                               250600
     C                     MOVELS4ORC1    P501                                                CSW207
     C                     MOVELS4ORC2    P502                                                CSW207
     C                     MOVELS4ORC3    P503                                                CSW207
     C                     MOVELS4ORC4    P504                                                CSW207
     C                     MOVELS4ORC5    P505                                                CSW207
     C                     MOVEL'TRAN'    PVTYP                                               CSW207
     C                     MOVEL*BLANKS   PMSGID                                              CSW207
     C**********           MOVEL*BLANKS   PMODI                                        CSW207 250600
     C                     MOVEL'FT'      PMODI                                               250600
     C                     MOVEL*BLANKS   PRFLG                                               CSW207
     C                     MOVEL*BLANKS   POUT1                                               CSW207
     C                     MOVEL*BLANKS   POUT2                                               CSW207
     C                     MOVEL*BLANKS   POUT3                                               CSW207
     C                     MOVEL*BLANKS   POUT4                                               CSW207
     C                     MOVEL*BLANKS   POUT5                                               CSW207
     C                     CALL 'FT001000'PLSWFT                                              CSW207
     C           PRTCDE    IFEQ '*ERROR'                                                      CSW207
     C           PRFLG     IFEQ 'E'                                                           CSW207
     C                     MOVEL'Y'       E#MSGS                                              CSW207
     C                     MOVELE#CPGM    FTPGMQ                                              CSW207
     C                     MOVELPMSGID    FTMSID                                              CSW207
     C                     EXSR FTSNMS                                                        CSW207
     C                     MOVEL'Y'       I4ORC1                                              CSW207
     C                     MOVEL'Y'       I4ORC2                                              CSW207
     C                     MOVEL'Y'       I4ORC3                                              CSW207
     C                     MOVEL'Y'       I4ORC4                                              CSW207
     C                     MOVEL'Y'       I4ORC5                                              CSW207
     C                     MOVEL'Y'       E#NOUP                                            BUG26136
     C                     ENDIF                                                              CSW207
     C           PRFLG     IFEQ 'W'                                                           CSW207
     C           WRN@,6    IFEQ ' '                                                           250600
     C                     MOVEL*BLANKS   E#RSND                                              250600
     C                     MOVEA'Y'       WRN@,6                                              250600
     C                     END                                                                250600
      *                                                                                       250600
     C                     MOVEL'Y'       E#MSGS                                              CSW207
     C**********           MOVEL'Y'       E#NOUP                                     250600 BUG26136
     C                     MOVEL'Y'       E#WARN                                              250600
     C                     MOVELE#CPGM    FTPGMQ                                              CSW207
     C                     MOVELPMSGID    FTMSID                                              CSW207
     C                     EXSR FTSNMS                                                        CSW207
     C                     MOVEL'Y'       I4ORC1                                              CSW207
     C                     MOVEL'Y'       I4ORC2                                              CSW207
     C                     MOVEL'Y'       I4ORC3                                              CSW207
     C                     MOVEL'Y'       I4ORC4                                              CSW207
     C                     MOVEL'Y'       I4ORC5                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDSR                                                              CSW207
      *****************************************************************
      *                                                               *
      *  SRORBK   : Ordering Bank                                     *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRORBK    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRORBK'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342ORBK
      *
     C                     MOVEL*BLANK    F4ORBT
      *
      *  ? not allowed
      *
     C           '?'       SCAN S4ORBK    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2260' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *                                                                   CFT002
      ** If blank and ordering customer is an address, a customer         CFT002
      ** number or a swift address, error                                 CFT002
      *                                                                   CFT002
     C           S4ORBK    IFEQ *BLANKS                                   CFT002
      *                                                                   CFT002
     C           F4ORCT    IFEQ 'A'                                       CFT002
     C           F4ORCT    OREQ 'C'                                       CFT002
     C           F4ORCT    OREQ 'S'                                       CFT002
     C/COPY WNCPYSRC,FT0342C027
     C                     MOVEL'Y'       E#MSGS                          CFT002
     C                     MOVELS4ORBK    FTMSDT                          CFT002
     C                     MOVELE#CPGM    FTPGMQ                          CFT002
     C*********************MOVEL'FTM2605' FTMSID                    CFT002CGL009
     C                     MOVEL'FTM2607' FTMSID                          CGL009
     C                     EXSR FTSNMS                                    CFT002
     C                     MOVEL'Y'       I4ORBK                          CFT002
     C                     MOVEL'Y'       I4ORBB                          CFT002
     C                     MOVEL'Y'       E#NOUP                          CFT002
     C                     GOTO EXORBK                                    CFT002
     C/COPY WNCPYSRC,FT0342C026
     C                     ENDIF                                          CFT002
      *                                                                   CFT002
     C                     ENDIF                                          CFT002
     C/COPY WNCPYSRC,FT0342C010
      *
      *  If blank and branch entered error
      *
     C           S4ORBK    IFEQ *BLANKS
     C           S4ORBB    ANDNE*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2261' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      *  Field is optional
      *
     C           S4ORBK    IFEQ *BLANK
     C                     GOTO EXORBK
     C                     END
     C/COPY WNCPYSRC,FT0342C011
      *
      *  Move Ordering Bank to ADDRSS data structure for Analysis
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS4ORBK    ADDRSS
      *
      *  If first 2 Character are not blank but rest is blank
      *  validate as a nostro number
      *
     C           ADNOSN    IFNE *BLANKS
     C           ADEXNN    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           S4ORBB    ANDEQ*BLANKS
      *
      * Look up Nostro via Access Object
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   @CUST
     C                     PARM S4SMCY    @CYCD
     C                     PARM *BLANKS   @ACCD
     C                     PARM *BLANKS   @ACSN
     C                     PARM ADNOSN    @NONB
     C                     PARM *BLANKS   @BRCD
     C                     PARM *BLANKS   @CSSN
     C                     PARM *BLANKS   @PNOI
     C           SDNOST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AONOSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 14 *
     C                     Z-ADD14        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Nostro not found
      *
     C           RTCD      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C           S4SMCY    CAT  S4ORBK    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2262' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      *  Nostro found mark as full nostro and get GL information
      *
     C                     MOVEL'N'       F4ORBT
      *
      * Store in occurrance data structure 1 any information
      *
     C           1         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C                     MOVELA7CUST    CNUM
     C                     MOVELA7CYCD    CCY
     C                     MOVELA7ACCD    ACOD
     C                     MOVELA7ACSN    ACSQ
     C                     MOVELA7BRCD    BRCA
      *
     C           AKEY      CHAINACCNTABF             90
      *
      *  Database error account does not exist
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANKS   ADCHK1
     C                     MOVELA7CUST    ADGCNM
     C                     MOVELADFCCY    ADGCCY
     C                     MOVELA7ACCD    ADGACD
     C                     MOVELA7ACSN    ADGASQ
     C                     MOVELA7BRCD    ADGBRC
     C                     MOVEL'ACCNT   'W0FILE           ***************
     C                     MOVELADCHK1    W0KEY            * DB ERROR 15 *
     C                     Z-ADD15        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
      *  If first 10 Characters are numeric but rest is blank
      *  validate as a retail account
      *
      *  Only validate if F4ORBT is blank
      *
     C           ADACNO    IFNE *BLANKS
     C           ADEXAC    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4ORBT    ANDEQ*BLANKS
     C           S4ORBB    ANDEQ*BLANKS
      *
      *  Check first 10 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELS4ORBK    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  10 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ11
      *
      *  Check that retail account numbers are allowed
      *
     C           V#RANR    IFEQ 'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2263' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      * Store in occurrance data structure 1 any information
      *
     C           1         OCUR OACCNT
      *
      *  Check account is on ACCNTAB
      *
     C                     MOVELADACNO    ACNO
     C           ACNO      CHAINACNUMAF              90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2264' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      * Currency of account must be equal to settle currency
      *
     C           S4SMCY    IFNE CCY
     C                     MOVEL'Y'       E#MSGS
     C           S4SMCY    CAT  S4ORBK    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2265' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      *  Retail Account found mark as Retail
      *
     C                     MOVEL'R'       F4ORBT
      *
     C                     END
      *
     C                     END
      *
      * If Ordering Bank still not set validate as partail
      *
     C           F4ORBT    IFEQ *BLANKS
      *
      *  Customer number, account code and account sequence must be
      *  numeric
      *
     C                     MOVELADPCNM    PTCNUM
     C                     MOVELADPACD    PTACOD
     C                     MOVELADPASQ    PTACSQ
      *
      ***Check*first*12*characters*are*numeric*************************                       CGL029
      ** Check first 18 characters are numeric                                                CGL029
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELPTACCT    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      ***12*digits*allowed*********************************************                       CGL029
      ** 18 digits allowed                                                                    CGL029
      *
     C           *IN90     IFEQ '1'
     C********** Y#        ANDNE13                                                            CGL029
     C           Y#        ANDNE19                                                            CGL029
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORBK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2266' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      * Store in occurrance data structure 1 any information
      *
     C           1         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C                     MOVELADPCNM    CNUM
     C                     MOVELS4SMCY    CCY
     C                     MOVELADPACD    ACOD
     C                     MOVELADPASQ    ACSQ
      *
      *  Set up branch depending on multibranching
      *
     C                     SELEC
     C           WUMBIN    WHNE 'Y'
     C                     MOVE V#SBRC    BRCA
     C           S4ORBB    WHEQ *BLANKS
     C                     MOVELDBRN      BRCA
     C                     OTHER
     C                     MOVELS4ORBB    BRCA
     C                     ENDSL
      *
     C           AKEY      CHAINACCNTABF             90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C           S4ORBB    CAT  S4ORBK    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2267' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXORBK
     C                     END
      *
      *  GL Account found mark as Partial Account
      *
     C                     MOVEL'P'       F4ORBT
     C                     SELEC
     C           WUMBIN    WHNE 'Y'
     C                     MOVELBRCA      S4ORBB
     C           WUMBIN    WHEQ 'Y'
     C           S4ORBB    ANDEQ*BLANKS
     C                     MOVELBRCA      S4ORBB
     C                     ENDSL
      *
     C                     END
     C/COPY WNCPYSRC,FT0342C035
      *
      * If a valid account has been entered,
      * store full account details for FT Transaction Status File
      * record update.
      *
     C           F4ORBT    IFEQ 'N'
     C           F4ORBT    OREQ 'R'
     C           F4ORBT    OREQ 'P'
     C**********           Z-ADDCNUM      IMCNUM                                              CSD027
     C                     MOVE CNUM      IMCNUM                                              CSD027
     C                     MOVE CCY       IMCCY
     C                     Z-ADDACOD      IMACOD
     C                     Z-ADDACSQ      IMACSQ
     C                     MOVE BRCA      IMBRCA
     C                     MOVELIMACNT    ORBDS
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXORBK    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C                     ENDSR
     C*
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPCCY   : Validate Pay Currency                             *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPCCY    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRPCCY'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PCCY
      *
      * Field defaults to Settle currency if not entered
      *
     C           S4PCCY    IFEQ *BLANK
     C           I4SMCY    ANDEQ*BLANK
     C                     MOVELS4SMCY    S4PCCY
     C                     END
      *
      * Mandatory field
      *
     C           S4PCCY    IFEQ *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PCCY    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2097' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PCCY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPCCY
     C                     END
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S4PCCY    @K101
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 16 *
     C                     Z-ADD16        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFNE *BLANKS                    B001
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PCCY    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2098' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PCCY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPCCY
     C                     END
      *
      *  Move new standing data field into field used in program
      *
     C           *LIKE     DEFN A6NBDP    PCNBDP
     C           *LIKE     DEFN A6SPRT    PCSPOT
     C           *LIKE     DEFN A6MDIN    PCMDIN
     C           *LIKE     DEFN A6SPRT    PCBUY
     C           *LIKE     DEFN A6SPRT    PCSELL
     C           *LIKE     DEFN A6INCY    PCINCY                          CFT014
     C           *LIKE     DEFN A6TPSD    PCTPSD                          CFT014
      *
      * Store Decimal Places Spot Rate Multiply/Divide Ind.
      *
     C                     Z-ADDA6NBDP    PCNBDP
     C                     Z-ADDA6SPRT    PCSPOT
     C                     MOVELA6MDIN    PCMDIN
     C/COPY WNCPYSRC,FT0342C030
      *
     C           A6BYSS    IFEQ '+'
     C           A6SPRT    ADD  A6BYSR    PCBUY
     C                     ELSE
     C           A6SPRT    SUB  A6BYSR    PCBUY
     C                     END
      *
     C           A6SLSS    IFEQ '+'
     C           A6SPRT    ADD  A6SLSR    PCSELL
     C                     ELSE
     C           A6SPRT    SUB  A6SLSR    PCSELL
     C                     END
     C/COPY WNCPYSRC,FT0342C031
      ** Memorize status of in ccy for X validation amount SRAMTV         CFT014
     C                     MOVELA6INCY    PCINCY                          CFT014
     C                     Z-ADDA6TPSD    PCTPSD                          CFT014
      *                                                                   CFT014
      *
      *  Unwind subroutine stack name
      *
     C           EXPCCY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPYAM   : Validate Pay Amount                               *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPYAM    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRPYAM'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PYAM
      *
     C                     Z-ADD0         F4PYAM
      *
      * Mandatory if pay amount not entered
      *
     C           S4SMAM    IFEQ *BLANK
     C           S4PYAM    ANDEQ*BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PYAM    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2099' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYAM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYAM
     C                     END
      *
      * If entered Validate
      *
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE S4PYAM    ZFIELD
     C           13        SUB  PCNBDP    ZADIG
     C                     Z-ADDPCNBDP    ZADEC
      *
     C                     EXSR SRALGN
      *
     C           ZRTN      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PYAM    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2100' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PYAM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPYAM
     C                     END
      *
     C                     MOVE ZFIELD    F4PYAM
      *
      * Set amount entered indicator if pay amount
      * or it is blanks
      *
     C           S4SMAM    IFEQ *BLANK
     C           F4FAIN    OREQ *BLANK
     C                     MOVEL'R'       F4FAIN
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXPYAM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSNCO   : Validate Senders Correspondent                    *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRSNCO    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRSNCO'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SNCO
      *
     C                     MOVEL*BLANK    F4SNCT
      *
      *  Field is optional
      *
     C           S4SNCO    IFEQ *BLANK
     C                     GOTO EXSNCO
     C                     END
      *
      *  Move Sender's Corr to ADDRSS data structure for Analysis
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS4SNCO    ADDRSS
      *
      *  If first 2 Character are not blank but rest is blank
      *  validate as a nostro number
      *
     C           ADNOSN    IFNE *BLANKS
     C           ADEXNN    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
      *
      * Look up Nostro via Access Object
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   @CUST
     C                     PARM S4PCCY    @CYCD
     C                     PARM *BLANKS   @ACCD
     C                     PARM *BLANKS   @ACSN
     C                     PARM ADNOSN    @NONB
     C                     PARM *BLANKS   @BRCD
     C                     PARM *BLANKS   @CSSN
     C                     PARM *BLANKS   @PNOI
     C           SDNOST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AONOSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 17 *
     C                     Z-ADD17        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Nostro not found
      *
     C           RTCD      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4SNCO    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2268' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNCO
     C                     END
      *
      *  Nostro found mark as nostro and get GL information
      *
     C                     MOVEL'N'       F4SNCT
      *
      * Store in occurrance data structure 4 any information
      *
     C           4         OCUR OACCNT
      *
      *  Set up key for chain
      *
     C                     MOVELA7CUST    CNUM
     C                     MOVELA7CYCD    CCY
     C                     MOVELA7ACCD    ACOD
     C                     MOVELA7ACSN    ACSQ
     C                     MOVELA7BRCD    BRCA
      *
     C           AKEY      CHAINACCNTABF             90
      *
      *  Database error account does not exist
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL*BLANKS   ADCHK1
     C                     MOVELA7CUST    ADGCNM
     C                     MOVELADFCCY    ADGCCY
     C                     MOVELA7ACCD    ADGACD
     C                     MOVELA7ACSN    ADGASQ
     C                     MOVELA7BRCD    ADGBRC
     C                     MOVEL'ACCNT   'W0FILE           ***************
     C                     MOVELADCHK1    W0KEY            * DB ERROR 18 *
     C                     Z-ADD18        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
      *  If first 10 Characters are numeric but rest is blank
      *  validate as a retail account
      *
      *  Only validate if F4SNCT is blank
      *
     C           ADACNO    IFNE *BLANKS
     C           ADEXAC    ANDEQ*BLANKS
     C           ADCH26    ANDEQ*BLANKS
     C           F4SNCT    ANDEQ*BLANKS
      *
      *  Check first 10 characters are numeric and rest is blank
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELS4SNCO    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  10 digits allowed
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ11
      *
      *  Check that retail account numbers are allowed
      *
     C           V#RANR    IFEQ 'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNCO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2269' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNCO
     C                     END
      *
      * Store in occurrance data structure 4 any information
      *
     C           4         OCUR OACCNT
      *
      *  Check account is on ACCNTAB
      *
     C                     MOVELADACNO    ACNO
     C           ACNO      CHAINACNUMAF              90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNCO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2270' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNCO
     C                     END
      *
      * Currency of account must be equal to settle currency
      *
     C           S4PCCY    IFNE CCY
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4SNCO    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2271' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNCO
     C                     END
      *
      *  Retail Account found mark as Retail
      *
     C                     MOVEL'R'       F4SNCT
      *
     C                     END
     C                     END                             E001
     C/COPY WNCPYSRC,FT0342C012
      *
      * If senders correspondent type is not setup, then the entry
      * is invalid retail account
      *
     C           F4SNCT    IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNCO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2272' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNCO
     C                     END
      *
      *  If senders correspondent is a NOSTRO set pay location
      *  to nostro location.Else use system location
      *
     C                     SELEC
     C           F4SNCT    WHEQ 'R'
      *
     C                     MOVELCNUM      @CUST
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @CUST   6
     C                     PARM CCY       @CYCD   3
     C**********           PARM ACODA     @ACCD   4                                           CGL029
     C                     PARM ACODA     @ACCD                                               CGL029
     C                     PARM ACSQA     @ACSN   2
     C                     PARM *BLANKS   @NONB
     C                     PARM BRCA      @BRCD
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM *BLANKS   DSFDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AONOSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 19 *
     C                     Z-ADD19        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           RTCD      IFEQ *BLANKS
     C                     MOVE NLOC      PLOC
     C                     MOVE 'N'       NOWRK   1
     C                     ELSE
     C                     MOVELV#SLCD    PLOC
     C                     MOVEL'S'       NOWRK
     C                     END
      *
     C           F4SNCT    WHEQ 'N'
     C                     MOVE NLOC      PLOC    3
     C                     MOVE 'N'       NOWRK
      *
     C                     OTHER
     C                     MOVELV#SLCD    PLOC
     C                     MOVEL'S'       NOWRK
     C                     ENDSL
      *
      * If a valid account has been entered,
      * store full account details for FT Transaction Status File
      * record update.
      *
     C           F4SNCT    IFEQ 'N'
     C           F4SNCT    OREQ 'R'
     C**********           Z-ADDCNUM      IMCNUM                                              CSD027
     C                     MOVE CNUM      IMCNUM                                              CSD027
     C                     MOVE CCY       IMCCY
     C                     Z-ADDACOD      IMACOD
     C                     Z-ADDACSQ      IMACSQ
     C                     MOVE BRCA      IMBRCA
     C                     MOVELIMACNT    SNCDS
     C                     END
     C/COPY WNCPYSRC,FT0342C013
      *
      *  Unwind subroutine stack name
      *
     C           EXSNCO    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSLDT   : Validate Settle Value Date                        *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRSLDT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRSLDT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SLDT
      *
     C                     Z-ADD0         F4SLDT
      *
      *  If date not entered default to today
      *
     C           S4SLDT    IFEQ *BLANK
     C                     Z-ADDWURDNB    F4SLDT
     C                     MOVELV#MRDT    S4SLDT
     C                     END
      *
      * Check if date is numeric
      *
     C                     MOVELS4SLDT    DATEL   70
     C                     MOVELDATEL     DATES   6
      *
      * Date not numeric
      *
     C           S4SLDT    IFNE DATES
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2119' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SLDT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,2
     C                     GOTO EXSLDT
     C                     END
      *
     C                     MOVE S4SLDT    ZDATE
      *
     C                     CALL 'ZDATE1'               9090
     C                     PARM *BLANKS   ZERR    7        error code
     C                     PARM           ZDATE   60       Value date
     C                     PARM WUDFF     ZDATFM  1        Date format ind
     C                     PARM *ZEROS    ZDAYNO  50       Value date
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE1  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 20 *
     C                     Z-ADD20        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Date invalid
      *
     C           ZERR      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2120' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SLDT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,2
     C                     GOTO EXSLDT
     C                     END
      *
      *  Continue with checks if date is not in error
      *
      *  The Settle date must not be a holiday in local currency
      *
     C                     CALL 'FT0305'               9090
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM ZDAYNO    W0RDNB  50
     C                     PARM V#LCCY    W0CCY   3
     C                     PARM *BLANKS   W0LOC   3
     C                     PARM *BLANKS   W0IND   1
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'FT0305  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 21 *
     C                     Z-ADD21        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  if ZIND = 'H' then the date is a holiday
      *
     C           W0IND     IFEQ 'H'
      *
     C                     MOVEL'Y'       I4SLDT
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2121' FTMSID
     C                     EXSR FTSNMS
      *
     C           WRN@,2    IFEQ ' '
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRN@,2
     C                     END
      *
     C                     ELSE
     C                     MOVEA' '       WRN@,2
     C                     END
      *
     C           S4ACTD    IFEQ 'I'
     C           ZDAYNO    ANDLTWURDNB
     C           S4PYTP    ANDEQ'RP'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2250' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SLDT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSLDT
     C                     END
      *
     C                     Z-ADDZDAYNO    F4SLDT
      *
      *  Unwind subroutine stack name
      *
     C           EXSLDT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPVDT   : Validate Pay Date                                 *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPVDT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRPVDT  '@STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PVDT
      *
     C                     Z-ADDZDAYNO    F4PVDT
      *
      *  If blank then find next working day
      *
     C           S4PVDT    IFEQ *BLANK
     C                     MOVEL'D'       ZFREQ   1
      *
     C           NOWRK     IFEQ 'N'
     C                     MOVE S4PCCY    ZCCY    3
     C                     ELSE
     C                     MOVE V#BCCY    ZCCY
     C                     END
      *
     C                     Z-ADDWURDNB    ZDAYNO
     C                     MOVE PLOC      ZLOC    3
      *
      * Find run date plus 1
      *
     C                     CALL 'FT0310'               9090
     C                     PARM *BLANKS   ZZERR@  7
     C                     PARM '*NEWDATE'W0ACT   8
     C                     PARM ZFREQ     W0FREQ  1
     C           ZDAYNO    PARM ZDAYNO    W0RDNB  50
     C                     PARM 0         W0MDAY  20
     C                     PARM ZCCY      W0CCY   3
     C                     PARM ZLOC      W0LOC   3
      *
      *  If error on call
      *
     C           ZZERR@    IFNE *BLANKS
     C           *IN90     OREQ '1'
     C                     MOVEL'FT0310  'W0FILE           ***************
     C                     MOVELZCCY      W0KEY            * DB ERROR 22 *
     C                     Z-ADD22        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * If not base currency find run date plus 2
      *
     C           S4PCCY    IFNE V#BCCY
      *
     C                     CALL 'FT0310'               9090
     C                     PARM *BLANKS   ZZERR@  7
     C                     PARM '*NEWDATE'W0ACT   8
     C                     PARM ZFREQ     W0FREQ  1
     C           ZDAYNO    PARM ZDAYNO    W0RDNB  50
     C                     PARM 0         W0MDAY  20
     C                     PARM ZCCY      W0CCY   3
     C                     PARM ZLOC      W0LOC   3
      *
      *  If error on call
      *
     C           ZZERR@    IFNE *BLANKS
     C           *IN90     OREQ '1'
     C                     MOVEL'FT0310  'W0FILE           ***************
     C                     MOVELZCCY      W0KEY            * DB ERROR 23 *
     C                     Z-ADD23        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
      *
      * Format day
      *
     C                     CALL 'ZDATE2'               9090Entry parameter
     C                     PARM           ZDAYNO           Value date
     C                     PARM WUDFF     ZDATFM           Date format ind
     C                     PARM           ZDATE            Value date
     C                     PARM           ZADATE  7        Run-date in DDM
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE2  'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 24 *
     C                     Z-ADD24        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE ZDATE     S4PVDT
      *
     C                     ELSE
      *
      * Check if date is numeric
      *
     C                     MOVELS4PVDT    DATEL
     C                     MOVELDATEL     DATES
      *
     C           S4PVDT    IFNE DATES
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PVDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2122' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PVDT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,3
     C                     GOTO EXPVDT
     C                     END
      *
     C                     MOVE S4PVDT    ZDATE
      *
     C                     CALL 'ZDATE1'               9090
     C                     PARM *BLANKS   ZERR    7        error code
     C                     PARM           ZDATE   60       Value date
     C                     PARM           ZDATFM  1        Date format ind
     C                     PARM *ZEROS    ZDAYNO  50       Value date
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE1  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 25 *
     C                     Z-ADD25        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Date invalid
      *
     C           ZERR      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PVDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2123' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PVDT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,3
     C                     GOTO EXPVDT
     C                     END
      *
     C                     END
      *
      *  Continue with checks if date is not in error
      *
      *  The pay date must not be a holiday in local currency
      *
     C                     CALL 'FT0305'               9090
     C                     PARM *BLANKS   W0RTN
     C                     PARM ZDAYNO    W0RDNB
     C                     PARM V#LCCY    W0CCY
     C                     PARM *BLANKS   W0LOC
     C                     PARM *BLANKS   W0IND
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'FT0305  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 26 *
     C                     Z-ADD26        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  if ZIND = 'H' then the date is a holiday
      *
     C           W0IND     IFEQ 'H'
      *
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       I4PVDT
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PVDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2124' FTMSID
     C                     EXSR FTSNMS
      *
     C           WRN@,3    IFEQ ' '
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRN@,3
     C                     END
      *
     C                     ELSE
     C                     MOVEA' '       WRN@,3
     C                     END
      *
      * If type equals RP - cannot be less than settle date
      *
     C           ZDAYNO    IFLT F4SLDT
     C           S4PYTP    ANDEQ'RP'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2273' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PVDT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,3
     C                     GOTO EXPVDT
     C                     END
      *
     C                     Z-ADDZDAYNO    F4PVDT
     C/COPY WNCPYSRC,FT0342C014
      *
      *
      *  Unwind subroutine stack name
      *
     C           EXPVDT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRRATE   : Validate Rate Field                               *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRRATE    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRRATE'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RATE
      *
      * If rate entered validate
      *
     C                     MOVEL'N'       WFRATE  1                       CGL009
     C           S4RATE    IFNE *BLANK
     C                     MOVEL'Y'       WFRATE                          CGL009
      *
      * If regular payment then rate not allowed
      *
     C           S4RPAY    IFEQ 'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4RATE    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2274' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RATE
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRATE
     C                     END
      *
      * Check if numeric
      *
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE S4RATE    ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD8         ZADEC
      *
     C                     EXSR SRALGN
      *
     C           ZRTN      IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4RATE    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2125' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RATE
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRATE
     C                     END
      *
     C                     MOVE ZFIELD    F4RATE
      *
     C                     END
      *
      ** We will let FT0010 rebuild the rate, MDI and amounts             166199
     C           CEU006    IFNE 'Y'                                       166199
      *
      * Calculate default rate
      *
     C                     EXSR SRDRAT
      *
      * If rate not entered use defaults.
      *
     C           S4RATE    IFEQ *BLANK
     C                     Z-ADDDRATE     F4RATE
     C                     MOVELDMDIN     F4MDIN
      *
      * Format rate for screen
      *
     C           S4PYTP    IFNE 'RP'
     C                     MOVE DRATE     ZFIELD
     C/COPY WNCPYSRC,FT0342C007
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD           B:FUNCTION FIELD
     C                     PARM 8         ZADEC            I:NO OF DECIMALS
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZEDIT   'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 27 *
     C                     Z-ADD27        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE ZFIELD    S4RATE
     C                     END
      *
     C                     ELSE
      *
      * Determine multiply/divide
      *
     C                     SELEC
      *
      * If either currencies are base use default
      *
     C           S4SMCY    WHEQ V#BCCY
     C           S4PCCY    OREQ V#BCCY
     C                     MOVELDMDIN     F4MDIN
      *
      * If rate is same side of 1 as default rate use default ind.
      *
     C           DRATE     WHGT 1
     C           F4RATE    ANDGT1
     C           DRATE     ORLE 1
     C           F4RATE    ANDLE1
     C                     MOVELDMDIN     F4MDIN
      *
     C                     OTHER
      *
     C           DMDIN     IFEQ 'M'
     C                     MOVEL'D'       F4MDIN
     C                     ELSE
     C                     MOVEL'M'       F4MDIN
     C                     END
      *
     C                     ENDSL
      *
      *  Check rate
      *
     C           S4OVRD    IFNE 'Y'
     C           S4SMCY    OREQ S4PCCY
     C           S4OVRD    ANDEQ'Y'
     C                     EXSR SRRVAL
      *
      * If error exit
      *
     C           I4RATE    IFNE *BLANKS
     C                     GOTO EXRATE
     C                     END
     C                     END
      *
     C                     END
      *
     C                     EXSR SRRCAL
     C                     ENDIF                                          166199
      *
      *  Unwind subroutine stack name
      *
     C           EXRATE    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRDRAT   : Default Rate Calculation                          *
      *                                                               *
      *  CALLED BY: SRRATE - Validate Rate                            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRDRAT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDRAT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342DRAT
      *
      * Calculate default rate
      *
     C           *LIKE     DEFN A6SPRT    DRATE
     C           *LIKE     DEFN A6MDIN    DMDIN
      *
      * If Currencies are equal then rate is 1 and flag Divide
      *
      *
     C           S4SMCY    IFEQ S4PCCY
     C                     Z-ADD1         DRATE
     C                     MOVEL'D'       DMDIN
     C                     GOTO EXDRAT
     C                     END
      *
      * If Settle currency is base then use Pay Currency Sell
      *
     C           S4SMCY    IFEQ V#BCCY
     C                     Z-ADDPCSELL    DRATE
      *
     C           PCMDIN    IFEQ 'M'
     C                     MOVEL'D'       DMDIN
     C                     ELSE
     C                     MOVEL'M'       DMDIN
     C                     END
      *
     C                     GOTO EXDRAT
     C                     END
      *
      * If Pay currency is base then use Settle Currency Buy
      *
     C           S4PCCY    IFEQ V#BCCY
     C                     Z-ADDSCBUY     DRATE
     C                     MOVELSCMDIN    DMDIN
     C                     GOTO EXDRAT
     C                     END
      *
      * Neither currencies are base or the same
      *
     C                     SELEC
      *
      * If both divide then
      *
     C           SCMDIN    WHEQ 'D'
     C           PCMDIN    ANDEQ'D'
      *
      * Rate is Pay Sell divide by Settle Buy
      *
     C           PCSELL    DIV  SCBUY     DRATE     H
     C                     MOVEL'M'       DMDIN
      *
     C           DRATE     IFLT 1
     C           SCBUY     DIV  PCSELL    DRATE     H
     C                     MOVEL'D'       DMDIN
     C                     END
      *
      * If Settle divide and Pay Multiply
      *
     C           SCMDIN    WHEQ 'D'
     C           PCMDIN    ANDEQ'M'
      *
      * Rate is Pay Sell multiplied by settle Buy
      *
     C           PCSELL    MULT SCBUY     DRATE     H
     C                     MOVEL'D'       DMDIN
      *
     C           DRATE     IFLT 1
     C           1         DIV  DRATE     DRATE     H
     C                     MOVEL'M'       DMDIN
     C                     END
      *
      * If Settle Multiply and Pay Divide
      *
     C           SCMDIN    WHEQ 'M'
     C           PCMDIN    ANDEQ'D'
      *
      * Rate is Pay Sell divide by Settle Buy
      *
     C           PCSELL    MULT SCBUY     DRATE     H
     C                     MOVEL'M'       DMDIN
      *
     C           DRATE     IFLT 1
     C           1         DIV  DRATE     DRATE     H
     C                     MOVEL'D'       DMDIN
     C                     END
      *
      * If both multiply then
      *
     C                     OTHER
      *
      * Rate is Pay Sell divide by Settle Buy
      *
     C           PCSELL    DIV  SCBUY     DRATE     H
     C                     MOVEL'D'       DMDIN
      *
     C           DRATE     IFLT 1
     C           SCBUY     DIV  PCSELL    DRATE     H
     C                     MOVEL'M'       DMDIN
     C                     END
      *
     C                     ENDSL
      *
      *  Unwind subroutine stack name
      *
     C           EXDRAT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRRCAL   : Unentered Value Calculation                       *
      *                                                               *
      *  CALLED BY: SRRATE - Validate Rate                            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
      *
     C           SRRCAL    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRRCAL'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RCAL
      *
      * If amounts entered on screen exit
      *
     C           S4SMAM    IFNE *BLANKS
     C           S4PYAM    ANDNE*BLANKS
     C                     GOTO EXRCAL
     C                     END
      *
      * If Settle amounts not entered
      *
     C           S4SMAM    IFEQ *BLANKS
      *
     C                     CLEARD#DTA
     C                     Z-ADDF4PYAM    D#FAMT
      *
     C           F4MDIN    IFEQ 'D'
     C                     MOVEL'M'       D#MDIN
     C                     ELSE
     C                     MOVEL'D'       D#MDIN
     C                     END
      *
     C                     Z-ADDF4RATE    D#RATE
     C                     MOVELS4SMCY    D#TCCY
     C                     MOVELS4PCCY    D#FCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN   7
     C                     PARM '*F*T*RAT'W0ACT   8
     C           D#DTA     PARM D#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     MOVEL'AOCCYCV0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 28 *
     C                     Z-ADD28        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     Z-ADDD#TAMT    F4SMAM
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     Z-ADDF4SMAM    D#FAMT
     C                     MOVELS4SMCY    D#FCCY
     C                     MOVELS4PCCY    D#TCCY
     C                     MOVELF4MDIN    D#MDIN
     C                     Z-ADDF4RATE    D#RATE
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN   7
     C                     PARM '*F*T*RAT'W0ACT   8
     C           D#DTA     PARM D#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     MOVEL'AOCCYCV0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 30 *
     C                     Z-ADD30        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     Z-ADDD#TAMT    F4PYAM
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZEDIT   'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 31 *
     C                     Z-ADD31        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXRCAL    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRRVAL   : Validate Rate When Entered                        *
      *                                                               *
      *  CALLED BY: SRRATE - Validate Rate                            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRRVAL    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRRVAL'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RVAL
      *
      * If rate not 1 and currencies are equal error
      *
     C           S4SMCY    IFEQ S4PCCY
     C           F4RATE    ANDNE1
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4RATE    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2126' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RATE
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRVAL
     C                     END
      *
      *  Upper and lower limits are determined by % rate discrepancy
      *      from payment charges file .
      *
     C           *LIKE     DEFN A6SPRT    UPRATE
     C           *LIKE     DEFN A6SPRT    DORATE
      *
     C           DRATE     MULT UPMARG    UPRATE    H
     C           DRATE     MULT LWMARG    DORATE    H
      *
     C           F4RATE    IFLT DORATE
     C           F4RATE    ORGT UPRATE
      *
      *  Entered rate may be Pay ccy/Receive ccy or vice versa
      *      (whichever is nearer the default rate(DRATE) is assumed)
      *
     C           1         DIV  DRATE     DRATE
     C           DRATE     MULT UPMARG    UPRATE
     C           DRATE     MULT LWMARG    DORATE
      *
     C           F4RATE    IFLT DORATE
     C           F4RATE    ORGT UPRATE
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4RATE    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2127' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RATE
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRVAL
     C                     END
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXRVAL    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SROVRD   : Validate Override Flag                            *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SROVRD    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SROVRD'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342OVRD
      *
      * Optional field defaults to N
      *
     C           S4OVRD    IFEQ *BLANK
     C                     MOVEL'N'       S4OVRD
     C                     END
      *
      * Must be N or Y
      *
     C           S4OVRD    IFNE 'N'
     C           S4OVRD    ANDNE'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4OVRD    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2128' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4OVRD
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXOVRD
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXOVRD    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRADDC   : Validate Add/Deduct Charges Indicator             *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRADDC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRADDC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342ADDC
      *
      *  Optional field defaults to 'A'
      *
     C           S4ADDC    IFEQ *BLANKS
     C                     MOVEL'A'       S4ADDC
     C                     END
      *
      *  Must be A or D
      *
     C           S4ADDC    IFNE 'A'
     C           S4ADDC    ANDNE'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ADDC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2129' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ADDC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXADDC
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXADDC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRRCCN   : Validate Receiver's charges ccy from the network  *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: SRPROC - Control Process of Validation            *   CFT014
      *                                                               *   CFT014
      *  CALLS    :        -                                          *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     CSR         SRRCCN    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'SRRCCN'  @STK,Q                          CFT014
      *                                                                   CFT014
      *  No need to validate it if empty                                  CFT014
      *                                                                   CFT014
     C           S4RCCN    IFEQ *BLANK                                    CFT014
     C                     GOTO EXRCCN                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  No need to validate it if it is the same as the                  CFT014
      *  payment currency or settlement currency                          CFT014
      *                                                                   CFT014
     C           S4RCCN    IFEQ S4PCCY                                    CFT014
     C                     Z-ADDPCNBDP    RCNBDP                          CFT014
     C                     GOTO EXRCCN                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           S4RCCN    IFEQ S4SMCY                                    CFT014
     C                     Z-ADDSCNBDP    RCNBDP                          CFT014
     C                     GOTO EXRCCN                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Look field up on database                                        CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM S4RCCN    @K101   3                       CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      *  If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'AOCURRR0'W0FILE           ***************CFT014
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 71 *CFT014
     C                     Z-ADD71        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C           RTCD      IFNE *BLANKS                                   CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS4RCCN    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM4004' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4RCCN                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXRCCN                                    CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
      *  Move new standing data field into field used in program          CFT014
      *                                                                   CFT014
     C           *LIKE     DEFN A6NBDP    RCNBDP                          CFT014
     C                     Z-ADDA6NBDP    RCNBDP                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXRCCN    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
     C/EJECT                                                              CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRRCNW   : Validate Receiver's charges  from the network     *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: SRPROC - Control Process of Validation            *   CFT014
      *                                                               *   CFT014
      *  CALLS    :        -                                          *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     CSR         SRRCNW    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'SRRCNW'  @STK,Q                          CFT014
      *                                                                   CFT014
      **  No need to validate it if empty                                 CFT014
      *                                                                   CFT014
     C           S4RCNW    IFEQ *BLANK                                    CFT014
     C                     GOTO EXRCNW                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Amount need currency to be formated                              CFT014
      *                                                                   CFT014
     C           S4RCNW    IFNE *BLANK                                    CFT014
     C           S4RCCN    ANDEQ*BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM4005' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RCNW
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRCNW
     C                     ENDIF                                          CFT014
      *
     C           V#DETC    IFEQ 'BEN'
     C           V#DETC    OREQ 'SHA'                                     CFT014
     C           V#DETC    OREQ 'OUR'
     C           S4ADDC    ANDNE'A'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM3231' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RCNW
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRCNW
     C                     ENDIF
      *
     C           11        SUB  RCNBDP    ZADIG
     C                     Z-ADDRCNBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS4RCNW    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S4RCCN    CAT  S4RCNW    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM3232' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RCNW
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRCNW
     C                     ENDIF
      *
     C                     MOVE ZFIELD    F4RCNW
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXRCNW    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
     C/EJECT                                                              CFT014
      *****************************************************************
      *                                                               *
      *  SRBOOK   : Validate Book Code                                *
      *                                                               *
      *  CALLED BY: SRPROC - Control of Validation Processing         *
      *                                                               *
      *  CALLS    : AOBOOKR0                                          *
      *             FTSNMS                                            *
      *                                                               *
      *****************************************************************
     CSR         SRBOOK    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRBOOK'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342BOOK
      *
      *  Book Code must be entered
      *
     C           S4BOKC    IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4BOKC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2130' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4BOKC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBOOK
     C                     END
      *
      *  Access the Book Code file for validation if an Insert OR
      *  if an Amend and the Book Code has been changed
      *
     C                     CALL 'AOBOOKR0'             9090
     C                     PARM *BLANKS   U#RTCD  7
     C                     PARM '*KEY   ' U#OPTN  7
     C                     PARM S4BOKC    U#BOKC  2
     C           SDBOOK    PARM *BLANKS   DSFDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBOOKR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 32 *
     C                     Z-ADD32        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * If return code is not blank - process for an error
      * else map the book code from the data structure to screen field
      *
     C           U#RTCD    IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4BOKC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2131' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4BOKC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBOOK
     C                     END
      *
     C                     MOVELBDBKCD    S4BOKC
      *
      *  Unwind subroutine stack name
      *
     C           EXBOOK    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPRFC   : Validation Of Profit Centre                       *
      *                                                               *
      *  CALLED BY: SRPROC - Control of Validation Processing         *
      *                                                               *
      *  CALLS    : FTSNMS                                            *
      *             AOPRFMR0                                          *
      *             AOPRFCR0                                          *
      *                                                               *
      *****************************************************************
     CSR         SRPRFC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPRFC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PRFC
      *
      *  Profit Centre is Optional input.
      *
      *  If the profit centre field is blank set to a default only if
      *  the Profit Centre Defaults Used flag is set to 'Y'.
      *  This could only happen on an Insert.
      *
     C           S4ACTD    IFEQ 'I'
     C           S4PRFC    ANDEQ*BLANKS
     C           V#PCDU    ANDEQ'Y'
      *
      *  Determine parameters to be passed
      *
      *  For Outgoing Payments the Customer and Account Officer will
      *  be blank.
      *
      *
     C                     MOVEL*BLANKS   CUST    6        Customer
     C                     MOVEL*BLANKS   ACOF    2        Account Officer
     C                     MOVELS4PYTP    TRTP    5        Transaction Typ
      *
      *  Get default profit centre
      *
     C                     CALL 'AOPRFMR0'             90
     C                     PARM *BLANKS   U#RTCD  7        Return Code
     C                     PARM S4BOKC    U#BOKC  2        Book Code
     C                     PARM TRTP      U#TRTP  5        Transaction Typ
     C                     PARM S4PYST    U#SUTP  2        Sub Type
     C                     PARM S4BRCA    U#BRAN  3        Branch Code
     C                     PARM DPPT      U#DEPT  3        Department Code
     C                     PARM ##USR     U#USER 10        User
     C                     PARM ACOF      U#ACOF  2        Account Officer
     C                     PARM CUST      U#CUST  6        Customer Number
     C           S4PRFC    PARM *BLANKS   U#PRFC  4        Profit Centre
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOPRFMR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 33 *
     C                     Z-ADD33        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * If return code is not blank - process for an error
      * If no error then the screen field is filled by passed parameter
      *
     C           U#RTCD    IFEQ '2'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PRFC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2132' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PRFC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPRFC
     C                     END
      *
     C                     END
      *
      *  Validate Profit Centre
      *
     C           S4ACTD    IFEQ 'I'
     C           S4PRFC    ANDNE*BLANKS
     C           S4ACTD    OREQ 'A'
     C           S4PRFC    ANDNE*BLANKS
      *
     C                     CALL 'AOPRFCR0'             9090
     C                     PARM *BLANKS   U#RTCD  7
     C                     PARM '*KEY'    U#OPTN  7
     C                     PARM S4PRFC    U#PRFC  4
     C           SDPRFC    PARM *BLANKS   DSFDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOPRFCR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 34 *
     C                     Z-ADD34        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * If return code is not blank - process for an error
      *
     C           U#RTCD    IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PRFC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2133' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PRFC
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPRFC
     C                     END
      *
     C                     MOVELDSPCCD    S4PRFC
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXPRFC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
      *
      *****************************************************************
      *                                                               *
      *  SRRPAY   : Validate Regular Payment Flag                     *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRRPAY    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRRPAY'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342RPAY
      *
      * Optional field defaults to N
      *
     C           S4RPAY    IFEQ *BLANK
      *
     C           S4PYTP    IFEQ 'RP'
     C                     MOVEL'Y'       S4RPAY
     C                     ELSE
     C                     MOVEL'N'       S4RPAY
     C                     END
      *
     C                     END
      *
      * Must be Y is RP else N
      *
     C           S4PYTP    IFEQ 'RP'
     C           S4RPAY    ANDNE'Y'
     C           S4PYTP    ORNE 'RP'
     C           S4RPAY    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4RPAY    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2275' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4RPAY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRPAY
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXRPAY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPAYF   : Validate Payment Frequency                        *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRPAYF    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPAYF'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342PAYF
      *
      * If OP then this field can be blank
      *
     C           S4PAYF    IFEQ *BLANK
     C           S4PYTP    ANDEQ'OP'
     C                     GOTO EXPAYF
     C                     END
      *
      * Mandatory if regular payment
      *
     C           S4PAYF    IFEQ *BLANK
     C           S4PYTP    ANDEQ'RP'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PAYF    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2276' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PAYF
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPAYF
     C                     END
      *
      * Check frequency is valid
      *
     C                     CALL 'FT0310'               9090
     C                     PARM *BLANKS   ZZERR@  7
     C                     PARM '*VERIFY 'W0ACT   8
     C                     PARM S4PAYF    W0FREQ  1
     C                     PARM 0         W0RDNB  50
     C                     PARM 0         W0MDAY  20
     C                     PARM *BLANKS   W0CCY   3
     C                     PARM *BLANKS   W0LOC   3
      *
      *  If error on call
      *
     C           ZZERR@    IFNE *BLANKS
     C           ZZERR@    ANDNE'FTM2002'
     C           *IN90     OREQ '1'
     C                     MOVEL'FT0310  'W0FILE           ***************
     C                     MOVELS4PAYF    W0KEY            * DB ERROR 35 *
     C                     Z-ADD35        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           ZZERR@    IFEQ 'FTM2002'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PAYF    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2277' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PAYF
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPAYF
     C                     END
      *
      * If not a regular payment but frequency specified error
      *
      * Or OP and frequency specified error
      *
     C           S4PYTP    IFEQ 'OP'
     C           S4PAYF    ANDNE*BLANK
      *
      * Only if valid
      *
     C           I4PYTP    IFEQ *BLANKS
     C           I4PAYF    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PAYF    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2278' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4PAYF
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXPAYF
     C                     END
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXPAYF    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
     C*
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRDYIM   : Validate Day In Month                             *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRDYIM    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDYIM'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342DYIM
      *
      * Mandatory if a regular payment and not set frequency
      *
     C           S4PYTP    IFEQ 'OP'
     C           S4DYIM    ANDEQ*BLANK
     C                     GOTO EXDYIM
     C                     END
      *
     C           S4DYIM    IFEQ *BLANK
     C           S4RPAY    ANDEQ'Y'
      *
      * But not equal to Daily, weekly or fornightly.
      *
     C           S4PAYF    IFNE 'D'
     C           S4PAYF    ANDNE'F'
     C           S4PAYF    ANDNE'W'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PAYF    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2279' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DYIM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDYIM
     C                     END
     C                     END
      *
      * Check valid day in month
      *
     C           S4DYIM    LOKUPNDY                      90
      *
     C           *IN90     IFEQ '0'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PAYF    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2280' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DYIM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDYIM
     C                     END
      *
      *
      * If not a regular payment but frequency specified error
      *
      * Or OP and frequency specified error
      *
     C           S4RPAY    IFEQ 'N'
     C           S4DYIM    ANDNE*BLANK
     C           S4PYTP    OREQ 'OP'
     C           S4DYIM    ANDNE*BLANK
      *
      * Only if valid
      *
     C           I4PYTP    IFEQ *BLANKS
     C           I4PAYF    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DYIM    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2281' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DYIM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXDYIM
     C                     END
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXDYIM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRNDAT   : Validate Next Payment Date                        *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRNDAT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRNDAT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342NDAT
      *
     C                     Z-ADD0         F4NDAT
      *
      * Mandatory if regular payment
      *
      * If blank and insert then defaults to settle date if
      * greater than run date else run date plus 1 working day.
      *
      * The next payment date must be greater than the run date
      * and less than the final date.
      *
     C           S4NDAT    IFEQ *BLANK
     C           S4RPAY    ANDNE'Y'
     C                     GOTO EXNDAT
     C                     END
      *
      * If not a regular payment but frequency specified error
      *
      *
      * Or OP and frequency specified error
      *
     C           S4RPAY    IFEQ 'N'
     C           S4NDAT    ANDNE*BLANK
     C           S4PYTP    OREQ 'OP'
     C           S4NDAT    ANDNE*BLANK
      *
      * Only if valid
      *
     C           I4PYTP    IFEQ *BLANKS
     C           I4PAYF    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4NDAT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2294' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,4
     C                     END
      *
     C                     GOTO EXNDAT
     C                     END
      *
     C           S4ACTD    IFEQ 'I'
     C           S4NDAT    ANDEQ*BLANKS
      *
      *  Next payment date
      *
     C           F4SLDT    IFLE WURDNB
      *
     C                     Z-ADDWURDNB    ZDAYNO
     C                     MOVELS4SMCY    ZCCY
     C                     MOVEL'D'       ZFREQ
      *
     C                     CALL 'FT0310'               9090
     C                     PARM *BLANKS   ZZERR@  7
     C                     PARM '*NEWDATE'W0ACT   8
     C                     PARM ZFREQ     W0FREQ  1
     C           ZDAYNO    PARM ZDAYNO    W0RDNB  50
     C                     PARM 0         W0MDAY  20
     C                     PARM ZCCY      W0CCY   3
     C                     PARM ZLOC      W0LOC   3
      *
      *  If error on call
      *
     C           ZZERR@    IFNE *BLANKS
     C           *IN90     OREQ '1'
     C                     MOVEL'FT0310  'W0FILE           ***************
     C                     MOVELZCCY      W0KEY            * DB ERROR 36 *
     C                     Z-ADD36        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     Z-ADDZDAYNO    F4NDAT
      *
      * Format day
      *
     C                     CALL 'ZDATE2'               9090Entry parameter
     C                     PARM           ZDAYNO           Value date
     C                     PARM WUDFF     ZDATFM           Date format ind
     C                     PARM           ZDATE            Value date
     C                     PARM           ZADATE           Run-date in DDM
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE2  'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 37 *
     C                     Z-ADD37        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVELZDATE     S4NDAT
      *
     C                     ELSE
     C                     MOVELF4SLDT    F4NDAT
     C                     MOVELS4SLDT    S4NDAT
     C                     END
      *
     C                     END
      *
     C           S4NDAT    IFEQ *BLANK
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4NDAT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2295' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,4
     C                     GOTO EXNDAT
     C                     END
      *
      *  Date must be numeric
      *
     C                     MOVELS4NDAT    DATEL
     C                     MOVELDATEL     DATES
      *
     C           S4NDAT    IFNE DATES
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4NDAT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2296' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,4
     C                     GOTO EXNDAT
     C                     END
      *
     C                     MOVELS4NDAT    ZDATE
      *
     C                     CALL 'ZDATE1'               9090
     C                     PARM *BLANKS   ZERR    7        error code
     C                     PARM           ZDATE   60       Value date
     C                     PARM           ZDATFM  1        Date format ind
     C                     PARM *ZEROS    ZDAYNO  50       Value date
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE1 ' W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 38 *
     C                     Z-ADD38        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  If error report
      *
     C           ZERR      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4NDAT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2297' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,4
     C                     GOTO EXNDAT
     C                     END
      *
     C                     Z-ADDZDAYNO    F4NDAT
      *
      *  The next payment date must not be a holiday in local
      *  Currency
      *
     C                     CALL 'FT0305'               9090
     C                     PARM *BLANKS   W0RTN
     C                     PARM ZDAYNO    W0RDNB
     C                     PARM V#LCCY    W0CCY
     C                     PARM *BLANKS   W0LOC
     C                     PARM *BLANKS   W0IND
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'FT0305  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 39 *
     C                     Z-ADD39        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** if ZIND = 'H' then the date is a holiday
      *
     C           W0IND     IFEQ 'H'
      *
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4NDAT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2298' FTMSID
     C                     EXSR FTSNMS
      *
     C           WRN@,4    IFEQ ' '
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRN@,4
     C                     END
      *
     C                     ELSE
     C                     MOVEA' '       WRN@,4
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXNDAT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRFIND   : Validate Final Date                               *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRFIND    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFIND'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342FIND
      *
     C                     Z-ADD0         F4FIND
      *
      * Mandatory field for Regular Payment
      * else should not be entered
      *
     C           S4FIND    IFEQ *BLANK
     C           S4RPAY    ANDEQ'N'
     C                     GOTO EXFIND
     C                     END
      *
     C           S4FIND    IFEQ *BLANK
     C           S4RPAY    ANDEQ'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4FIND    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2299' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,5
     C                     GOTO EXFIND
     C                     END
      *
      * If not a regular payment but frequency specified error
      *
      * Or OP and frequency specified error
      *
     C           S4RPAY    IFEQ 'N'
     C           S4FIND    ANDNE*BLANK
     C           S4PYTP    OREQ 'OP'
     C           S4FIND    ANDNE*BLANK
      *
      * Only if valid
      *
     C           I4PYTP    IFEQ *BLANKS
     C           I4PAYF    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4FIND    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2300' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,5
     C                     END
      *
     C                     GOTO EXFIND
     C                     END
      *
      *  Date must be numeric
      *
     C                     MOVELS4FIND    DATEL
     C                     MOVELDATEL     DATES
      *
     C           S4FIND    IFNE DATES
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4FIND    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2301' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,5
     C                     GOTO EXFIND
     C                     END
      *
     C                     MOVELS4FIND    ZDATE
      *
     C                     CALL 'ZDATE1'               9090
     C                     PARM *BLANKS   ZERR    7        error code
     C                     PARM           ZDATE   60       Value date
     C                     PARM           ZDATFM  1        Date format ind
     C                     PARM *ZEROS    ZDAYNO  50       Value date
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZDATE1 ' W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 40 *
     C                     Z-ADD40        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Continue with checks if date is not in error
      *
     C           ZERR      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4FIND    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2302' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#NOUP
     C                     MOVEA' '       WRN@,5
     C                     GOTO EXFIND
     C                     END
      *
     C                     Z-ADDZDAYNO    F4FIND
      *
      *  Continue with checks if date is not in error
      *
      *  The final payment date must not be a holiday in local
      *  currency
      *
     C                     CALL 'FT0305'               9090
     C                     PARM *BLANKS   W0RTN
     C                     PARM ZDAYNO    W0RDNB
     C                     PARM V#LCCY    W0CCY
     C                     PARM *BLANKS   W0LOC
     C                     PARM *BLANKS   W0IND
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'FT0305  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 41 *
     C                     Z-ADD41        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** if ZIND = 'H' then the date is a holiday
      *
     C           W0IND     IFEQ 'H'
      *
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4FIND    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2303' FTMSID
     C                     EXSR FTSNMS
      *
     C           WRN@,5    IFEQ ' '
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRN@,5
     C                     END
      *
     C                     ELSE
     C                     MOVEA' '       WRN@,5
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXFIND    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRSNMT   : Validate SWIFT MT202 Indicator                    *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -  CHKCVR                                  *   177284
      *                                                               *
      *****************************************************************
     C           SRSNMT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRSNMT'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342SNMT
      *
     C                     MOVEL*BLANKS   DSADD
     C                     MOVEL*BLANKS   SSADD
      *
      * Default dependent on Sender's correspondent
      *
     C           S4SNMT    IFEQ *BLANK
      *
      * If no correspondent mark as No
      *
     C                     MOVEL'N'       S4SNMT                          183398
     C           S4SNCO    IFEQ *BLANK
     C                     MOVEL'N'       S4SNMT
     C                     GOTO EXSNMT
     C                     ELSE
     C*********************MOVEL'Y'       S4SNMT                          177284
     C                     EXSR CHKCVR                                    177284
     C                     END
      *
     C                     END
      *
      * Must be N or Y
      *
     C           S4SNMT    IFNE 'Y'
     C           S4SNMT    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2282' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNMT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNMT
     C                     END
      *
      * If Y then Sender's Correspondent must be entered
      *
     C           S4SNMT    IFEQ 'Y'
     C           S4SNCO    ANDEQ*BLANK
     C/COPY WNCPYSRC,FT0342C032
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2283' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNMT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNMT
     C                     END
      *
      * If Sender's Correspondent or destination invalid exit
      *
     C           I4DST     IFNE *BLANKS
     C           I4SNCO    ORNE *BLANKS
     C                     GOTO EXSNMT
     C                     END
      *
      * If Full address in destination exit
      *
     C           F4DSTT    IFEQ 'A'
     C                     GOTO EXSNMT
     C                     END
      *
      * If SWIFT Address save first 6 characters
      * i.e. bank plus bank country location
      *
     C                     SELEC
     C           F4DSTT    WHEQ 'S'
     C                     MOVELS4DST1    DSADD   6
      *
      * If full nostro (F) or General Ledger (G) or Retail (R)
      *
     C           F4DSTT    WHEQ 'F'
     C           F4DSTT    OREQ 'G'
     C           F4DSTT    OREQ 'R'
      *
      *  Set occurrance data structure
      *
     C           3         OCUR OACCNT
      *
      ** Read SDCUSTPD for swift address
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM CNUMA     @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 42 *
     C                     Z-ADD42        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVELBBCSID    DSADD
      *
      * If customer (C)
      *
     C           F4DSTT    WHEQ 'C'
      *
     C                     MOVELS4DST1    @KEY1
      *
      ** Read SDCUSTPD for swift address
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 43 *
     C                     Z-ADD43        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVELBBCSID    DSADD
      *
     C                     ENDSL
      *
      * Extract Sender's Correspondent
      *
     C/COPY WNCPYSRC,FT0342C036
      *
      *  Set occurrance data structure
      *
     C           4         OCUR OACCNT
      *
      ** Read SDCUSTPD for swift address
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM CNUMA     @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 44 *
     C                     Z-ADD44        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVELBBCSID    SSADD   6
     C/COPY WNCPYSRC,FT0342C037
      *
      * Only check if SSADD and DSADD have information
      *
     C           DSADD     IFEQ *BLANK
     C           SSADD     OREQ *BLANK
     C                     GOTO EXSNMT
     C                     END
      *
      * If currency is local and addresses are the same then
      * MT202 must be N
      *
     C           DSADD     IFEQ SSADD
     C           S4SNMT    ANDEQ'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SNMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2284' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       I4SNMT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXSNMT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXSNMT    TAG
     C/COPY WNCPYSRC,FT0342C033
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
      *                                                                   177284
     C/EJECT                                                              177284
      *****************************************************************   177284
      *                                                               *   177284
      *  CHKCVR   : Setup default of Cover 202 field if senders       *   177284
      *             correspondent field is present.                   *   177284
      *                                                               *   177284
      *  CALLED BY:        - SRSNMT                                   *   177284
      *                                                               *   177284
      *  CALLS    :        -                                          *   177284
      *                                                               *   177284
      *****************************************************************   177284
     C           CHKCVR    BEGSR                                          177284
      *                                                                   177284
      * Extract Sender's Correspondent SWIFT address                      177284
      *                                                                   177284
      *  Set occurrance data structure                                    177284
      *                                                                   177284
     C           4         OCUR OACCNT                                    177284
      *                                                                   177284
      ** Read SDCUSTPD for swift address                                  177284
      *                                                                   177284
     C                     CALL 'AOCUSTR0'             9090               177284
     C                     PARM *BLANKS   RTCD                            177284
     C                     PARM '*KEY   ' @OPTN                           177284
     C                     PARM CNUMA     @KEY1                           177284
     C                     PARM *BLANKS   @KYST                           177284
     C           SDCUST    PARM *BLANKS   DSSDY                           177284
      *                                                                   177284
      *  If error on CALL - process as database error                     177284
      *                                                                   177284
     C           *IN90     IFEQ '1'                                       177284
     C                     MOVEL'AOCUSTR0'W0FILE           ***************177284
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 58 *177284
     C                     Z-ADD58        W0ERNB           ***************177284
     C                     MOVEL'MEM5003' W0MSGD                          177284
     C                     MOVEL'MIDAS  ' W0MSGF                          177284
     C                     EXSR SRERR                                     177284
     C                     END                                            177284
      *                                                                   177284
     C                     MOVELBBCSID    SCADD   6                       177284
      *                                                                   177284
      * Extract senders SWIFT Address, i.e. SWIFT address of booking      177284
      * branch BICN.                                                      177284
      *                                                                   177284
      ** Read SDCUSTPD for swift address                                  177284
      *                                                                   177284
     C                     CALL 'AOCUSTR0'             9090               177284
     C                     PARM *BLANKS   RTCD                            177284
     C                     PARM '*KEY   ' @OPTN                           177284
     C                     PARM SNBICN    @KEY1                           177284
     C                     PARM *BLANKS   @KYST                           177284
     C           SDCUST    PARM *BLANKS   DSSDY                           177284
      *                                                                   177284
      *  If error on CALL - process as database error                     177284
      *                                                                   177284
     C           *IN90     IFEQ '1'                                       177284
     C                     MOVEL'AOCUSTR0'W0FILE           ***************177284
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 59 *177284
     C                     Z-ADD59        W0ERNB           ***************177284
     C                     MOVEL'MEM5003' W0MSGD                          177284
     C                     MOVEL'MIDAS  ' W0MSGF                          177284
     C                     EXSR SRERR                                     177284
     C                     END                                            177284
      *                                                                   177284
     C                     MOVELBBCSID    SNADD   6                       177284
      *                                                                   177284
      * If sender and sender's correspondent SWIFT addresses are the      177284
      * same then default cover 202 to 'N' otherwise 'Y'.                 177284
      *                                                                   177284
     C           SCADD     IFNE *BLANKS                                   177284
     C           SCADD     IFEQ SNADD                                     177284
     C                     MOVEL'N'       S4SNMT                          177284
     C                     ELSE                                           177284
     C                     MOVEL'Y'       S4SNMT                          177284
     C                     ENDIF                                          177284
     C                     ENDIF                                          177284
      *                                                                   177284
     C                     ENDSR                                          177284
      *                                                                   177284
      *                                                                   CEU006
     C/EJECT                                                              CEU006
      *****************************************************************   CEU006
      *                                                               *   CEU006
      *  SRNDCY   : Notified delivery currency                        *   CEU006
      *                                                               *   CEU006
      *  CALLED BY:        - SRPROC                                   *   CEU006
      *                                                               *   CEU006
      *  CALLS    :        -                                          *   CEU006
      *                                                               *   CEU006
      *****************************************************************   CEU006
     C           SRNDCY    BEGSR                                          CEU006
      *                                                                   CEU006
      *  Set up subroutine stack name                                     CEU006
      *                                                                   CEU006
     C                     ADD  1         Q                               CEU006
     C                     MOVEL'SRNDCY'  @STK,Q                          CEU006
      *                                                                   CEU006
     C           S4NDCY    IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
      *  Look field up on database                                        CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'             9090               CEU006
     C                     PARM *BLANKS   RTCD                            CEU006
     C                     PARM '*KEY   ' @OPTN                           CEU006
     C                     PARM S4NDCY    @K101   3                       CEU006
     C           SDCURR    PARM *BLANKS   DSSDY                           CEU006
      *                                                                   CEU006
      *  If error on call                                                 CEU006
      *                                                                   CEU006
     C           *IN90     IFEQ '1'                                       CEU006
     C                     MOVEL'AOCURRR0'W0FILE           ***************CEU006
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 53 *CEU006
     C                     Z-ADD53        W0ERNB           ***************CEU006
     C                     MOVEL'MEM5003' W0MSGD                          CEU006
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C           RTCD      IFNE *BLANKS                                   CEU006
     C                     MOVEL'Y'       E#MSGS                          CEU006
     C                     MOVELS4NDCY    FTMSDT                          CEU006
     C                     MOVELE#CPGM    FTPGMQ                          CEU006
     C                     MOVEL'FTM2601' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     MOVEL'Y'       I4NDCY                          CEU006
     C                     MOVEL'Y'       E#NOUP                          CEU006
     C                     GOTO EXNDCY                                    CEU006
     C                     ENDIF                                          CEU006
     C                     MOVE S4NDCY    V#NDCY                          CEU006
      *                                                                   CEU006
      *  Move new standing data field into field used in program          CEU006
      *                                                                   CEU006
     C           *LIKE     DEFN A6NBDP    @1NBDP                          CEU006
     C           *LIKE     DEFN A6SPRT    @1SPOT                          CEU006
     C           *LIKE     DEFN A6MDIN    @1MDIN                          CEU006
     C           *LIKE     DEFN A6SPRT    @1BUY                           CEU006
     C           *LIKE     DEFN A6SPRT    @1SELL                          CEU006
      *                                                                   CEU006
      * Store Decimal Places Spot Rate Multiply/Divide Ind.               CEU006
      *                                                                   CEU006
     C                     Z-ADDA6NBDP    @1NBDP                          CEU006
     C                     Z-ADDA6SPRT    @1SPOT                          CEU006
     C                     MOVELA6MDIN    @1MDIN                          CEU006
      *                                                                   CEU006
     C           A6BYSS    IFEQ '+'                                       CEU006
     C           A6SPRT    ADD  A6BYSR    @1BUY                           CEU006
     C                     ELSE                                           CEU006
     C           A6SPRT    SUB  A6BYSR    @1BUY                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C           A6SLSS    IFEQ '+'                                       CEU006
     C           A6SPRT    ADD  A6SLSR    @1SELL                          CEU006
     C                     ELSE                                           CEU006
     C           A6SPRT    SUB  A6SLSR    @1SELL                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      *  Unwind subroutine stack name                                     CEU006
      *                                                                   CEU006
     C           EXNDCY    TAG                                            CEU006
     C                     MOVEA*BLANKS   @STK,Q                          CEU006
     C                     SUB  1         Q       50                      CEU006
      *                                                                   CEU006
     C                     ENDSR                                          CEU006
      *                                                                   CEU006
     C/EJECT                                                              CEU006
      *****************************************************************   CEU006
      *                                                               *   CEU006
      *  SRNDAM   : Notified delivery amount                          *   CEU006
      *                                                               *   CEU006
      *  CALLED BY:        - SRPROC                                   *   CEU006
      *                                                               *   CEU006
      *  CALLS    :        -                                          *   CEU006
      *                                                               *   CEU006
      *****************************************************************   CEU006
     C           SRNDAM    BEGSR                                          CEU006
      *                                                                   CEU006
      *  Set up subroutine stack name                                     CEU006
      *                                                                   CEU006
     C                     ADD  1         Q                               CEU006
     C                     MOVEL'SRNDAM'  @STK,Q                          CEU006
      *                                                                   CEU006
      * Mandatory if Notified delivery currency entered                   CEU006
      *                                                                   CEU006
     C           S4NDCY    IFNE *BLANK                                    CEU006
     C           S4NDAM    ANDEQ*BLANK                                    CEU006
     C                     MOVEL'Y'       E#MSGS                          CEU006
     C                     MOVELS4NDAM    FTMSDT                          CEU006
     C                     MOVELE#CPGM    FTPGMQ                          CEU006
     C                     MOVEL'FTM2602' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     MOVEL'Y'       I4NDAM                          CEU006
     C                     MOVEL'Y'       E#NOUP                          CEU006
     C                     GOTO EXNDAM                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      * If entered Validate                                               CEU006
      *                                                                   CEU006
     C                     MOVEL*BLANK    ZFIELD                          CEU006
     C                     MOVE S4NDAM    ZFIELD                          CEU006
     C           13        SUB  @1NBDP    ZADIG                           CEU006
     C                     Z-ADD@1NBDP    ZADEC                           CEU006
      *                                                                   CEU006
     C                     EXSR SRALGN                                    CEU006
      *                                                                   CEU006
     C           ZRTN      IFNE *BLANKS                                   CEU006
     C                     MOVEL'Y'       E#MSGS                          CEU006
     C                     MOVELS4NDAM    FTMSDT                          CEU006
     C                     MOVELE#CPGM    FTPGMQ                          CEU006
     C                     MOVEL'FTM2603' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     MOVEL'Y'       I4NDAM                          CEU006
     C                     MOVEL'Y'       E#NOUP                          CEU006
     C                     GOTO EXNDAM                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE ZFIELD    WNDAM  130                      CEU006
     C                     Z-ADDWNDAM     V#NDAM                          CEU006
      *                                                                   CEU006
      *  Unwind subroutine stack name                                     CEU006
      *                                                                   CEU006
     C           EXNDAM    TAG                                            CEU006
     C                     MOVEA*BLANKS   @STK,Q                          CEU006
     C                     SUB  1         Q       50                      CEU006
      *                                                                   CEU006
     C                     ENDSR                                          CEU006
      *                                                                   CEU006
     C/EJECT                                                              CEU006
      *****************************************************************   CGL009
      *                                                               *   CGL009
      *  SRPDCY   : Pay delivery currency                             *   CGL009
      *                                                               *   CGL009
      *  CALLED BY:        - SRPROC                                   *   CGL009
      *                                                               *   CGL009
      *  CALLS    :        -                                          *   CGL009
      *                                                               *   CGL009
      *****************************************************************   CGL009
     C           SRPDCY    BEGSR                                          CGL009
      *                                                                   CGL009
      *  Set up subroutine stack name                                     CGL009
      *                                                                   CGL009
     C                     ADD  1         Q                               CGL009
     C                     MOVEL'SRPDCY'  @STK,Q                          CGL009
      *                                                                   CFT014
     C                     MOVE *BLANKS   PDINEU  1                       CFT014
     C           *LIKE     DEFN A6TPSD    PDTPSD                          CFT014
     C                     Z-ADD0         PDTPSD                          CFT014
      *                                                                   CFT014
     C           S4PDCY    IFNE *BLANKS                                   CGL009
      *                                                                   CFT014
      *  Not allowed for regular payment                                  CFT014
      *                                                                   CFT014
     C           S4PYTP    IFEQ 'RP'                                      CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2563' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4PDCY                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXPDCY                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CGL009
      *  Look field up on database                                        CGL009
      *                                                                   CGL009
     C                     CALL 'AOCURRR0'             9090               CGL009
     C                     PARM *BLANKS   RTCD                            CGL009
     C                     PARM '*KEY   ' @OPTN                           CGL009
     C                     PARM S4PDCY    @K101   3                       CGL009
     C           SDCURR    PARM *BLANKS   DSSDY                           CGL009
      *                                                                   CGL009
      *  If error on call                                                 CGL009
      *                                                                   CGL009
     C           *IN90     IFEQ '1'                                       CGL009
     C                     MOVEL'AOCURRR0'W0FILE           ***************CGL009
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 59 *CGL009
     C                     Z-ADD59        W0ERNB           ***************CGL009
     C                     MOVEL'MEM5003' W0MSGD                          CGL009
     C                     MOVEL'MIDAS  ' W0MSGF                          CGL009
     C                     EXSR SRERR                                     CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
     C           CFT014    IFNE 'Y'                                       CFT014
     C           RTCD      IFNE *BLANKS                                   CGL009
     C           A6INCY    ORNE 'Y'                                       CFT014
     C           S4PDCY    ANDNEV#EURO                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CGL009
     C                     MOVELS4PDCY    FTMSDT                          CGL009
     C                     MOVELE#CPGM    FTPGMQ                          CGL009
     C*********************MOVEL'FTM2564' FTMSID                    CGL009CFT014
     C                     MOVEL'FTM3248' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CGL009
     C                     MOVEL'Y'       I4PDCY                          CGL009
     C                     MOVEL'Y'       E#NOUP                          CGL009
     C                     GOTO EXPDCY                                    CGL009
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           A6INCY    IFEQ 'Y'                                       CFT014
     C                     MOVE 'I'       PDINEU                          CFT014
     C                     Z-ADDA6TPSD    WTPSD                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'E'       PDINEU                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CGL009
      *                                                                   CFT014
      ** CFT014 is active                                                 CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Entry is not a valid currency code.                              CFT014
      *                                                                   CFT014
     C           RTCD      IFNE *BLANKS                                   CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3101' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4PDCY                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXPDCY                                    CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Currency is an 'In' currency.                                    CFT014
      *                                                                   CFT014
     C           CEU006    IFEQ 'Y'                                       CFT014
     C           A6INCY    ANDEQ'Y'                                       CFT014
     C                     MOVE 'I'       PDINEU                          CFT014
     C                     Z-ADDA6TPSD    WTPSD                           CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Currency is a Euro currency.                                     CFT014
      *                                                                   CFT014
     C           CEU006    IFEQ 'Y'                                       CFT014
     C           S4PDCY    ANDEQV#EURO                                    CFT014
     C                     MOVE 'E'       PDINEU                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Otherwise, an 'Out' currency.                                    CFT014
      *                                                                   CFT014
     C                     MOVE 'O'       PDINEU                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVE S4PDCY    V#PDCY                          CGL009
      *                                                                   CGL009
      *  Move new standing data field into field used in program          CGL009
      *                                                                   CGL009
     C           *LIKE     DEFN A6NBDP    PDNBDP                          CGL009
     C           *LIKE     DEFN A6SPRT    PDSPOT                          CGL009
     C           *LIKE     DEFN A6MDIN    PDMDIN                          CGL009
     C           *LIKE     DEFN A6SPRT    PDBUY                           CGL009
     C           *LIKE     DEFN A6SPRT    PDSELL                          CGL009
      *                                                                   CGL009
      * Store Decimal Places Spot Rate Multiply/Divide Ind.               CGL009
      *                                                                   CGL009
     C                     Z-ADDA6NBDP    PDNBDP                          CGL009
     C                     Z-ADDA6SPRT    PDSPOT                          CGL009
     C                     MOVELA6MDIN    PDMDIN                          CGL009
      *                                                                   CGL009
     C           A6BYSS    IFEQ '+'                                       CGL009
     C           A6SPRT    ADD  A6BYSR    PDBUY                           CGL009
     C                     ELSE                                           CGL009
     C           A6SPRT    SUB  A6BYSR    PDBUY                           CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
     C           A6SLSS    IFEQ '+'                                       CGL009
     C           A6SPRT    ADD  A6SLSR    PDSELL                          CGL009
     C                     ELSE                                           CGL009
     C           A6SPRT    SUB  A6SLSR    PDSELL                          CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
      *  Unwind subroutine stack name                                     CGL009
      *                                                                   CGL009
     C           EXPDCY    TAG                                            CGL009
     C                     MOVEA*BLANKS   @STK,Q                          CGL009
     C                     SUB  1         Q       50                      CGL009
      *                                                                   CGL009
     C                     ENDSR                                          CGL009
      *                                                                   CGL009
     C/EJECT                                                              CGL009
      *****************************************************************   CGL009
      *                                                               *   CGL009
      *  SRPDAM   : Pay delivery amount                               *   CGL009
      *                                                               *   CGL009
      *  CALLED BY:        - SRPROC                                   *   CGL009
      *                                                               *   CGL009
      *  CALLS    :        -                                          *   CGL009
      *                                                               *   CGL009
      *****************************************************************   CGL009
     C           SRPDAM    BEGSR                                          CGL009
      *                                                                   CGL009
      *  Set up subroutine stack name                                     CGL009
      *                                                                   CGL009
     C                     ADD  1         Q                               CGL009
     C                     MOVEL'SRPDAM'  @STK,Q                          CGL009
      *                                                                   CGL009
      **Mandatory*if*Payment*delivery*currency*entered**            CGL009CFT014
      ****************************************************          CGL009CFT014
     C***********S4PDCY    IFNE *BLANK                              CGL009CFT014
     C***********S4PDAM    ANDEQ*BLANK                              CGL009CFT014
      *                                                                   CFT014
      * Forbidden if Payment delivery currency not entered                CFT014
      *                                                                   CFT014
     C           S4PDCY    IFEQ *BLANK                                    CFT014
     C           S4PDAM    ANDNE*BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CGL009
     C                     MOVELS4PDAM    FTMSDT                          CGL009
     C                     MOVELE#CPGM    FTPGMQ                          CGL009
     C*********************MOVEL'FTM2608' FTMSID                    CGL009CFT014
     C                     MOVEL'FTM2598' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CGL009
     C                     MOVEL'Y'       I4PDAM                          CGL009
     C                     MOVEL'Y'       E#NOUP                          CGL009
     C                     GOTO EXPDAM                                    CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
      * If entered Validate                                               CGL009
      *                                                                   CGL009
     C                     MOVEL*BLANK    ZFIELD                          CGL009
     C                     MOVE S4PDAM    ZFIELD                          CGL009
     C           13        SUB  PDNBDP    ZADIG                           CGL009
     C                     Z-ADDPDNBDP    ZADEC                           CGL009
      *                                                                   CGL009
     C                     EXSR SRALGN                                    CGL009
      *                                                                   CGL009
     C           ZRTN      IFNE *BLANKS                                   CGL009
     C                     MOVEL'Y'       E#MSGS                          CGL009
     C                     MOVELS4PDAM    FTMSDT                          CGL009
     C                     MOVELE#CPGM    FTPGMQ                          CGL009
     C                     MOVEL'FTM2600' FTMSID                          CGL009
     C                     EXSR FTSNMS                                    CGL009
     C                     MOVEL'Y'       I4PDAM                          CGL009
     C                     MOVEL'Y'       E#NOUP                          CGL009
     C                     GOTO EXPDAM                                    CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
     C*********************MOVE ZFIELD    WPDAM  130                CGL009CFT014
     C*********************Z-ADDWPDAM     V#PDAM                    CGL009CFT014
      ** (Suppress duplicate variable)                                    CFT014
     C                     MOVE ZFIELD    V#PDAM                          CFT014
      *                                                                   CGL009
      *  Unwind subroutine stack name                                     CGL009
      *                                                                   CGL009
     C           EXPDAM    TAG                                            CGL009
     C                     MOVEA*BLANKS   @STK,Q                          CGL009
     C                     SUB  1         Q       50                      CGL009
      *                                                                   CGL009
     C                     ENDSR                                          CGL009
      *                                                                   CGL009
     C/EJECT                                                              CGL009
      *****************************************************************   CEU006
      *                                                               *   CEU006
      *  SRAMTV   : Cross-Validate All Amounts                        *   CEU006
      *                                                               *   CEU006
      *  CALLED BY:        - SRPROC                                   *   CEU006
      *                                                               *   CEU006
      *  CALLS    :        -                                          *   CEU006
      *                                                               *   CEU006
      *****************************************************************   CEU006
     C           SRAMTV    BEGSR                                          CEU006
      *                                                                   CEU006
      *  Set up subroutine stack name                                     CEU006
      *                                                                   CEU006
     C                     ADD  1         Q                               CEU006
     C                     MOVEL'SRAMTV'  @STK,Q                          CEU006
      *                                                                   CFT014
      ** Cross check pay currency                                         CFT014
      *                                                                   CFT014
     C                     EXSR XCKPCY                                    CFT014
     C           WXERAM    IFEQ 'Y'                                       CFT014
     C                     GOTO EXAMTV                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cross check pay value date                                       CFT014
      *                                                                   CFT014
     C                     EXSR XCKPVD                                    CFT014
     C           WXERAM    IFEQ 'Y'                                       CFT014
     C                     GOTO EXAMTV                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Determine if the pay and instructed currency is 'In' and         CFT014
      ** 'Euro' combination                                               CFT014
      *                                                                   CFT014
     C           PDINEU    IFEQ 'I'                                       CFT014
     C           PCINEU    ANDEQ'E'                                       CFT014
     C           PDINEU    OREQ 'E'                                       CFT014
     C           PCINEU    ANDEQ'I'                                       CFT014
     C                     MOVE 'Y'       WINEU                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       WINEU   1                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CEU006
      ** Set paramaters for call to FT0010                                CEU006
      *                                                                   CEU006
     C                     CLEARP#0010                                    CEU006
      *                                                                   CEU006
     C                     MOVEL'FT0010'  P#PMSQ                          CEU006
      *                                                                   CEU006
     C                     MOVE S4NDCY    P#NDCY                          CEU006
     C                     Z-ADDWNDAM     P#NDAM                          CEU006
     C*                                                                   CFT014
     C           CEU006    IFNE 'Y'                                       CFT014
     C                     MOVE *BLANKS   P#NDCY                          CFT014
     C                     Z-ADD0         P#NDAM                          CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   CFT014
     C                     Z-ADD0         WNDAM                           CFT002
     C                     MOVE S4SMCY    P#DBCY                          CEU006
     C                     Z-ADDF4SMAM    P#DBAM                          CEU006
     C                     MOVE S4PCCY    P#CRCY                          CEU006
     C                     Z-ADDF4PYAM    P#CRAM                          CEU006
      ** Original amount / Original currency are passed right from        CFT014
      ** the beginning (difference with pay amount on the screen is       CFT014
      ** due to the exchange rate) but because of presence of charges     CFT014
      ** when we pass this information to another destination, the        CFT014
      ** link with payment amount is 'flawed' by the fact we can either   CFT014
      ** deduct charges from :32A: to fill the payment amount, or         CFT014
      ** substract charges from payment amount before filling :32A:       CFT014
     C           CFT014    IFEQ 'N'                                       CFT014
     C                     MOVELS4PDCY    P#PDCY                          CEU006
     C*********************Z-ADDWPDAM     P#PDAM                    CEU006CFT014
     C                     Z-ADDV#PDAM    P#PDAM                          CFT014
     C                     ENDIF                                          CFT014
     C                     Z-ADDF4SLDT    P#DBDT                          CEU006
     C*********************MOVE BTPCRD    P#RTDS                    166214175484
     C           BTPCRD    MULT 0.01      P#RTDS                          175484
     C                     MOVEL'Y'       P#SDIN                          166214
     C                     Z-ADDF4PVDT    P#CRDT                          166214
      *                                                                   CGL009
     C           V#NWRK    IFEQ 'FONTIS'                                  CGL009
      ** FONTIS can transmit another rate by using the code work          CGL009
      ** /RATE/ in tag :72:                                               CGL009
     C           I4RATE    IFEQ *BLANK                                    CGL009
     C           WFRATE    ANDEQ'Y'                                       CGL009
     C                     Z-ADDF4RATE    P#RATE                          CGL009
     C                     ENDIF                                          CGL009
      ***FONTIS*fills*only*the*pay*delivery*currency*********             CFT014
     C***********S4PDCY    IFNE *BLANK                                    CFT014
     C*********************MOVE S4PDCY    P#PDCY                          CFT014
     C*********************Z-ADDWPDAM     P#PDAM                          CFT014
     C*********************ENDIF                                          CFT014
      *                                                                   CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CEU006
     C                     CALL 'FT0010'                                  CEU006
     C                     PARM           P#0010                          CEU006
      *                                                                   CEU006
     C           P#RTCD    IFNE *BLANK                                    CEU006
     C                     MOVEL'AOCURRR0'W0FILE                          CEU006
     C                     MOVEL'*CALL'   W0KEY                           CEU006
     C                     Z-ADD54        W0ERNB                          CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      * Check for returned error                                          CEU006
     C           '1'       SCAN P#INDC:1  RESULT  10                      CEU006
      *                                                                   CEU006
     C           RESULT    IFGT 0                                         CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     ELSE                                           CGL009
     C                     MOVE *OFF      *IN89                           CGL009
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C           *IN89     IFEQ *ON                                       CEU006
     C                     MOVE 'Y'       I4NDCY                          CEU006
     C                     MOVE 'Y'       I4NDAM                          CEU006
     C                     MOVE 'Y'       I4SMCY                          CEU006
     C                     MOVE 'Y'       I4SMAM                          CEU006
     C                     MOVE 'Y'       I4PCCY                          CEU006
     C                     MOVE 'Y'       I4PYAM                          CEU006
     C                     MOVE 'Y'       I4RATE                          166199
      *                                                                   CEU006
     C                     MOVELP#INDC    DSINDC                          166199
      ** Rate incorrect                                                   166199
     C           WINDC5    IFEQ '1'                                       166199
     C                     MOVEL'FTM2611' FTMSID                          166199
     C                     MOVELS4RATE    FTMSDT                          166199
     C                     ELSE                                           166199
     C                     MOVEL'FTM2604' FTMSID                          166199
     C                     ENDIF                                          166199
      *                                                                   166199
     C                     MOVEL'Y'       E#MSGS                          CEU006
     C                     MOVELE#CPGM    FTPGMQ                          CEU006
     C*********************MOVEL'FTM2604' FTMSID                    CEU006166199
     C                     EXSR FTSNMS                                    CEU006
     C                     MOVEL'Y'       E#NOUP                          CEU006
      *                                                                   CGL009
     C*********************ELSE                                     CGL009CFT014
     C                     GOTO EXAMTV                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CGL009
     C           F4SMAM    IFEQ 0                                         CGL009
     C                     MOVE P#DBAM    F4SMAM                          CGL009
     C                     MOVE *BLANK    ZFIELD                          CGL009
     C                     MOVE P#DBAM    ZFIELD                          CGL009
      *                                                                   CGL009
     C                     CALL 'ZEDIT'                9090               CGL009
     C                     PARM           ZFIELD                          CGL009
     C                     PARM SCNBDP    ZADEC                           CGL009
      *                                                                   CGL009
      *  If error on call                                                 CGL009
      *                                                                   CGL009
     C           *IN90     IFEQ '1'                                       CGL009
     C                     MOVEL'ZEDIT   'W0FILE           ***************CGL009
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 56 *CGL009
     C                     Z-ADD56        W0ERNB           ***************CGL009
     C                     MOVEL'MEM5003' W0MSGD                          CGL009
     C                     MOVEL'MIDAS  ' W0MSGF                          CGL009
     C                     EXSR SRERR                                     CGL009
     C                     END                                            CGL009
      *                                                                   CGL009
     C                     MOVE ZFIELD    S4SMAM                          CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CGL009
     C           F4PYAM    IFEQ 0                                         CGL009
     C                     MOVE P#CRAM    F4PYAM                          CGL009
     C                     MOVE *BLANK    ZFIELD                          CGL009
     C                     MOVE P#CRAM    ZFIELD                          CGL009
      *                                                                   CGL009
     C                     CALL 'ZEDIT'                9090               CGL009
     C                     PARM           ZFIELD                          CGL009
     C                     PARM PCNBDP    ZADEC                           CGL009
      *                                                                   CGL009
      *  If error on call                                                 CGL009
      *                                                                   CGL009
     C           *IN90     IFEQ '1'                                       CGL009
     C                     MOVEL'ZEDIT   'W0FILE           ***************CGL009
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 55 *CGL009
     C                     Z-ADD55        W0ERNB           ***************CGL009
     C                     MOVEL'MEM5003' W0MSGD                          CGL009
     C                     MOVEL'MIDAS  ' W0MSGF                          CGL009
     C                     EXSR SRERR                                     CGL009
     C                     END                                            CGL009
      *                                                                   CGL009
     C                     MOVE ZFIELD    S4PYAM                          CGL009
     C                     ENDIF                                          CGL009
      *                                                                   CEU006
     C           CFT014    IFEQ 'N'                                       CFT014
     C           S4PDCY    IFNE *BLANK                                    CFT014
     C           V#PDAM    ANDEQ0                                         CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE P#PDAM    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM PDNBDP    ZADEC                           CFT014
      *                                                                   CFT014
      *  If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'ZEDIT   'W0FILE           ***************CFT014
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 61 *CFT014
     C                     Z-ADD61        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    S4PDAM                          CFT014
     C                     Z-ADDP#PDAM    V#PDAM                          CGL009
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CEU006
     C           F4RATE    IFEQ 0                                         166199
     C                     MOVE P#RATE    F4RATE                          166199
     C                     MOVE *BLANK    ZFIELD                          166199
     C                     MOVE P#RATE    ZFIELD                          166199
      *                                                                   166199
     C                     CALL 'ZEDIT'                9090               166199
     C                     PARM           ZFIELD                          166199
     C                     PARM 8         ZADEC                           166199
      *                                                                   166199
      *  If error on call                                                 166199
      *                                                                   166199
     C           *IN90     IFEQ '1'                                       166199
     C                     MOVEL'ZEDIT   'W0FILE           ***************166199
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 60 *166199
     C                     Z-ADD60        W0ERNB           ***************166199
     C                     MOVEL'MEM5003' W0MSGD                          166199
     C                     MOVEL'MIDAS  ' W0MSGF                          166199
     C                     EXSR SRERR                                     166199
     C                     END                                            166199
      *                                                                   166199
     C                     MOVE ZFIELD    S4RATE                          166199
     C                     ENDIF                                          166199
      *                                                                   166199
     C           F4MDIN    IFEQ *BLANK                                    166199
     C           P#MDIN    IFEQ 1                                         166199
     C                     MOVE 'M'       F4MDIN                          166199
     C                     ELSE                                           166199
     C                     MOVE 'D'       F4MDIN                          166199
     C                     ENDIF                                          166199
     C                     ENDIF                                          166199
      *                                                                   CFT014
      ** Default Instructed Amount                                        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      *                                                                   CFT014
      ** FT0010 was designed to default all the other amounts when        CFT014
      ** at least one currency, one amount have been entered.             CFT014
      ** Except one case: it can calculate the pay delivery amount        CFT014
      ** only when the pay delivery currency is an IN currency.           CFT014
      ** Now the pay delivery currency (renamed instructed currency)      CFT014
      ** can be an OUT currency. Therefore to achieve the previous        CFT014
      ** functionality we are obliged to call FT0010 once again.          CFT014
      ** Setup FT0010 parameters to calculate instructed amount when      CFT014
      ** currency is entered while the amount is not.                     CFT014
      *                                                                   CFT014
     C           S4PDCY    IFNE *BLANK                                    CFT014
     C           S4PDAM    ANDEQ*BLANK                                    CFT014
     C           S4PDCY    ORNE *BLANK                                    CFT014
     C           V#PDAM    ANDEQ*ZERO                                     CFT014
     C                     CLEARP#0010                                    CFT014
     C                     MOVE S4PCCY    P#FRCY                          CFT014
     C                     MOVE F4PVDT    P#FRDT                          CFT014
     C                     Z-ADDF4PYAM    P#FRAM                          CFT014
     C                     MOVE S4PDCY    P#TOCY                          CFT014
     C                     MOVE F4PVDT    P#TODT                          CFT014
     C           BTPCRD    MULT 0.01      P#RTDS                          CFT014
     C                     MOVEL'Y'       P#SDIN                          CFT014
      *                                                                   CFT014
      ** Calculate Instructed amount via FT0010                           CFT014
      *                                                                   CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
      ** Error calling FT0010                                             CFT014
      *                                                                   CFT014
     C           P#RTCD    IFEQ '*ERROR*'                                 CFT014
     C                     MOVEL'FT0010  'W0FILE                          CFT014
     C                     Z-ADD62        W0ERNB                          CFT014
     C                     MOVEL'*CALL '  W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Set Instructed amount (Formatted for screen)                     CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE P#TOAM    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM PDNBDP    ZADEC                           CFT014
      *                                                                   CFT014
      *  If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'ZEDIT   'W0FILE           ***************CFT014
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 63 *CFT014
     C                     Z-ADD63        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    S4PDAM                          CFT014
     C                     Z-ADDP#TOAM    V#PDAM                          CGL009
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** When Instructed currency/amount is blank, must be defaulted      CFT014
      ** to be the same as Pay currency and amount given that the sen     CFT014
      ** der and the receiver both support charge transparency            CFT014
      *                                                                   CFT014
     C           S4PDCY    IFEQ *BLANK                                    CFT014
     C           S4PDAM    ANDEQ*BLANK                                    CFT014
      *                                                                   CFT014
      ** Find out first the sender/receiver ISO Country Code to be        CFT014
      ** use in getting charge transparency indicator                     CFT014
      *                                                                   CFT014
     C                     EXSR SRRISO                                    CFT014
     C                     EXSR SRSISO                                    CFT014
      *                                                                   CFT014
      ** Access ISO country codes via LF/MEISOCL1 to get receiver         CFT014
      ** charge tranparency flag                                          CFT014
      *                                                                   CFT014
     C                     MOVELWRISOC    WISOC   2                       CFT014
     C                     EXSR SRISOC                                    CFT014
      *                                                                   CFT014
      ** Receiver charge transparency flag is 'Y', set 'Y' to receiver    CFT014
      ** transparency work field, otherwise 'N'.                          CFT014
      *                                                                   CFT014
     C           WTRANS    IFEQ 'Y'                                       CFT014
     C                     MOVE 'Y'       WRTRAN  1                       CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       WRTRAN                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Access ISO country codes via LF/MEISOCL1 to get sender           CFT014
      ** charge tranparency flag                                          CFT014
      *                                                                   CFT014
     C                     MOVELWSISOC    WISOC                           CFT014
     C                     EXSR SRISOC                                    CFT014
      *                                                                   CFT014
      ** Sender charge transparency flag is 'Y', set 'Y' to sender        CFT014
      ** transparency work field, otherwise 'N'.                          CFT014
      *                                                                   CFT014
     C           WTRANS    IFEQ 'Y'                                       CFT014
     C                     MOVE 'Y'       WSTRAN  1                       CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       WSTRAN                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           WRTRAN    IFEQ 'Y'                                       CFT014
     C           WSTRAN    ANDEQ'Y'                                       CFT014
     C                     MOVELS4PCCY    S4PDCY                          CFT014
     C                     MOVELS4PYAM    S4PDAM                          CFT014
     C                     Z-ADDF4PYAM    V#PDAM                          CFT014
      *                                                                   CFT014
      ** Save Pay Currency details to Instructed Currency                 CFT014
      ** details.                                                         CFT014
      ** (Need to know the number of decimal positions when we will       CFT014
      ** default the rate.)                                               CFT014
     C                     Z-ADDPCNBDP    PDNBDP                          CFT014
     C                     Z-ADDPCTPSD    PDTPSD                          CFT014
     C                     MOVELPCMDIN    PDMDIN                          CFT014
     C           PCINCY    IFEQ 'Y'                                       CFT014
     C                     MOVE 'I'       PDINEU                          CFT014
     C                     ELSE                                           CFT014
     C           S4PCCY    IFEQ V#EURO                                    CFT014
     C                     MOVE 'E'       PDINEU                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'O'       PDINEU                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   166199
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      *  Unwind subroutine stack name                                     CEU006
      *                                                                   CEU006
     C           EXAMTV    TAG                                            CEU006
     C                     MOVEA*BLANKS   @STK,Q                          CEU006
     C                     SUB  1         Q       50                      CEU006
      *                                                                   CEU006
     C                     ENDSR                                          CEU006
      *
     C/EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  XCKPCY   : Cross-Validate Pay currency                       *   CFT014
      *                                                               *   CFT014
      *  CALLED BY:        - SRAMTV                                   *   CFT014
      *                                                               *   CFT014
      *  CALLS    :        -                                          *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     C           XCKPCY    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'XCKPCY'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       WXERAM  1                       CFT014
      *                                                                   CFT014
      ** Determine if pay currency is an 'In' or Euro currency            CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    PCINEU  1                       CFT014
     C           PCINCY    IFEQ 'Y'                                       CFT014
     C                     MOVE 'I'       PCINEU                          CFT014
     C                     Z-ADDPCTPSD    WTPSD                           CFT014
     C                     ENDIF                                          CFT014
     C           S4PCCY    IFEQ V#EURO                                    CFT014
     C                     MOVE 'E'       PCINEU                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           PDINEU    IFEQ 'I'                                       CFT014
     C           S4PCCY    ANDNEV#EURO                                    CFT014
     C           CFT014    ANDNE'Y'                                       CFT014
     C           PDINEU    OREQ 'E'                                       CFT014
     C           PCINCY    ANDNE'Y'                                       CFT014
     C           CFT014    ANDNE'Y'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2566' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4PCCY                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXXPCY                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *                                                                   CFT014
      *  At this point we assume that there are no errors                 CFT014
      *                                                                   CFT014
     C                     MOVEL'N'       WXERAM  1                       CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXXPCY    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q       50                      CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *                                                                   CFT014
     C/EJECT                                                              CF0T14
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  XCKPVD   : Cross-Validate Pay Value Date                     *   CFT014
      *                                                               *   CFT014
      *  CALLED BY:        - SRAMTV                                   *   CFT014
      *                                                               *   CFT014
      *  CALLS    :        -                                          *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     C           XCKPVD    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'XCKPVD'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       WXERAM  1                       CFT014
      *                                                                   CFT014
     C           *LIKE     DEFN A6TPSD    WTPSD                           CFT014
     C           CFT014    IFEQ 'N'                                       CFT014
     C           S4PDCY    IFNE *BLANKS                                   CFT014
     C           WTPSD     ANDGTF4PVDT                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2571' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4PVDT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXXPVD                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      ** Transition period date tested only if IN ccy are involved in     CFT014
      ** transaction.                                                     CFT014
     C           S4PDCY    IFNE *BLANKS                                   CFT014
     C           PDTPSD    ANDGTF4PVDT                                    CFT014
     C           WINEU     ANDEQ'Y'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2571' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4PVDT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXXPVD                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  At this point we assume that there are no errors                 CFT014
      *                                                                   CFT014
     C                     MOVEL'N'       WXERAM  1                       CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXXPVD    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q       50                      CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *                                                                   CFT014
     C/EJECT                                                              CFT014
      *****************************************************************
      *                                                               *
      *  SRXVAL   : Cross Validations                                 *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     C           SRXVAL    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRXVAL'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0342XVAL
      *
      *  Ordering Customer MT202 Keyword validations
      *
      *  If line 1 is MT202 then settle type must be '01' or '08'
      *  or '02'                                                          CFT002
      *
     C           S4ORC1    IFEQ ORCFLD
     C           S4STMT    ANDNE'01'
     C           S4STMT    ANDNE'02'                                      CFT002
     C           S4STMT    ANDNE'08'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C           S4ORC1    CAT  S4STMT    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2108' FTMSID
     C                     EXSR FTSNMS
     C                     GOTO EXXVAL
     C                     END
      *
      *  If line 1 is MT202 and line 2 not specified Ordering bank
      *  must be a bank
      *
     C/COPY WNCPYSRC,FT0342C038
     C           S4ORC1    IFEQ ORCFLD
     C           S4ORC2    ANDEQ*BLANKS
     C/COPY WNCPYSRC,FT0342C039
      *
      *  Set occurrance data structure
      *
     C           1         OCUR OACCNT
      *
      ** Read SDCUSTPD for bank details
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM CNUMA     @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 45 *
     C                     Z-ADD45        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Ordering Bank must be a bank
      * or part of the branch network                                     068088
      *
     C           BBBNBI    IFNE 'Y'
     C           BBBSIN    ANDEQ*BLANKS                                   068088
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C           S4ORBK    CAT  S4ORBB    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2109' FTMSID
     C                     EXSR FTSNMS
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
      * If Settlement type 08 - Destination must be S.W.I.F.T.
      * if not issue warning
      *
     C           S4STMT    IFNE '08'
     C                     MOVEA' '       WRN@,1
     C                     ELSE
      *
     C                     MOVEL*BLANKS   BBCSID
      *
      * If SWIFT Address save
      * i.e. bank plus bank country location
      *
     C                     SELEC
     C           F4DSTT    WHEQ 'S'
     C                     MOVELS4DST1    BBCSID
      *
      * If full nostro (F) or General Ledger (G) or Retail (R)
      *
     C           F4DSTT    WHEQ 'F'
     C           F4DSTT    OREQ 'G'
     C           F4DSTT    OREQ 'R'
      *
      *  Set occurrance data structure
      *
     C           3         OCUR OACCNT
      *
      ** Read SDCUSTPD for swift address
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM CNUMA     @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 45 *
     C                     Z-ADD45        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * If customer (C)
      *
     C           F4DSTT    WHEQ 'C'
      *
     C                     MOVELS4DST1    @KEY1
      *
      ** Read SDCUSTPD for swift address
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 46 *
     C                     Z-ADD46        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     ENDSL
      *
     C           BBCSID    IFEQ *BLANK
      *
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       I4STMT
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2285' FTMSID
     C                     EXSR FTSNMS
      *
     C           WRN@,1    IFEQ ' '
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRN@,1
     C                     END
      *
     C                     ELSE
     C                     MOVEA' '       WRN@,1
     C                     END
      *
     C                     END
      *
      * If settlement type 13 Destination must be NOSTRO.
      *
     C           S4STMT    IFEQ '13'
     C           F4DSTT    ANDNE'F'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2286' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * If Sender's Correspondent is blank Destination currency must
      * equal pay
      *
     C/COPY WNCPYSRC,FT0342C034
     C           S4SNCO    IFEQ *BLANK
     C/COPY WNCPYSRC,FT0342C015
      *
     C           F4DSTT    IFEQ 'F'
     C           F4DSTT    OREQ 'G'
     C           F4DSTT    OREQ 'R'
      *
      * Set occurrance structure
      *
     C           3         OCUR OACCNT
      *
     C                     SELEC
     C           CCY       WHNE S4PCCY
     C           F4DSTT    ANDEQ'R'
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4DST1    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2287' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
      *
     C           CCY       WHNE S4PCCY
     C           F4DSTT    ANDEQ'G'
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4DST1    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2288' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
      *
     C           CCY       WHNE S4PCCY
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4DST1    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2289' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
      *
     C                     ENDSL
      *
     C                     END
      *
     C                     END
      *
      * If Settlement type is 10 must be Sterling
      *
     C           S4STMT    IFEQ '10'
     C           S4SMCY    ANDNEV#GBP
     C                     MOVEL'Y'       E#MSGS
     C           V#GBP     CAT  S4DST1    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2290' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4STMT
     C                     MOVEL'Y'       I4SMCY
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * If Ordering Customer not an account and Ordering Bank
      * blank then error
     C/COPY WNCPYSRC,FT0342C016
      *
     C           F4ORCT    IFNE 'R'
     C           F4ORCT    ANDNE'P'                                       E35508
     C           F4ORCT    ANDNE'I'                                                           CFT032
     C           S4ORBK    ANDEQ*BLANKS                                   E35508
     C/COPY WNCPYSRC,FT0342C040
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2291' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
     C/COPY WNCPYSRC,FT0342C017
      *
      * If Ordering Customer an account and Ordering Bank
      * an account then error
      *
     C           F4ORCT    IFEQ 'R'
     C           F4ORCT    OREQ 'P'                                       E35508
     C           F4ORCT    OREQ 'I'                                                           CFT032
     C           S4ORBK    IFNE *BLANKS                                   E35508
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2352' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
     C                     END
      *
      * If Sender's Correspondent bank and Destination not an account
      * error
      *
     C           F4DSTT    IFNE 'R'
     C           F4DSTT    ANDNE'F'                                       E35508
     C           F4DSTT    ANDNE'G'                                       E35508
     C           S4SNCO    ANDEQ*BLANKS                                   E35508
     C/COPY WNCPYSRC,FT0342C018
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2292' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C/COPY WNCPYSRC,FT0342C019
     C                     END
      *
      * If Destination has a customer check not the same
      * as sender's correspondent
      *
     C           F4SNCT    IFNE *BLANKS
     C           F4DSTT    IFEQ 'F'
     C           F4DSTT    OREQ 'R'
     C           F4DSTT    OREQ 'G'
     C           F4DSTT    OREQ 'C'
      *
      *  Set occurrance data structure for destination
      *
     C           F4DSTT    IFNE 'C'
     C           3         OCUR OACCNT
     C                     MOVELCNUMA     DSCNUM  6
     C                     ELSE
     C                     MOVELS4DST1    DSCNUM
     C                     END
     C/COPY WNCPYSRC,FT0342C041
      *
      *  Set occurrance data structure for Sender's Correspondent
      *
     C           4         OCUR OACCNT
      *
     C           DSCNUM    IFEQ CNUMA
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCNUMA     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2304' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
     C/COPY WNCPYSRC,FT0342C042
      *
     C                     END
      *
     C                     END
      *
      *  If Destination is an account then no entry is allowed
      *  into Sender's Correspondent if currency of account is
      *  pay currency
      *
     C           F4SNCT    IFNE *BLANKS
     C           F4DSTT    IFEQ 'F'
     C           F4DSTT    OREQ 'R'
     C           F4DSTT    OREQ 'G'
      *
      *  Set occurrance data structure
      *
     C           3         OCUR OACCNT
      *
     C           S4PCCY    IFEQ CCY
     C                     MOVEL'Y'       E#MSGS
     C           S4PCCY    CAT  S4DST1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2293' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
     C                     END
      *
      *  Check if settle date is in the future and if the
      *  account is closing today
      *
     C/COPY WNCPYSRC,FT0342C043
     C           F4ORBT    IFEQ *BLANKS
      *
      *  Set occurrance data structure for Ordering Customer
      *
     C           2         OCUR OACCNT
      *
     C           F4SLDT    IFGT WURDNB
     C           ACST      ANDEQ'C'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2305' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * For back valued transactions check against account open date
      *
     C           S4PYTP    IFNE 'RP'
      *
     C           F4SLDT    IFLT DACO
     C           ATYP      ANDEQ'R'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4ORC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2306' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * Check against back value limit
      *
     C           F4SLDT    IFLT V#BVLD
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2142' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORC1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,FT0342C044
      *
     C           F4ORBT    IFNE *BLANKS
      *
      *  Set occurrance data structure for Ordering Customer
      *
     C           1         OCUR OACCNT
      *
     C           F4SLDT    IFGT WURDNB
     C           ACST      ANDEQ'C'
     C                     ADD  1         X
     C                     MOVE '604'     ERCD,X
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * For back valued transactions check against account open date
      *
     C           S4PYTP    IFNE 'RP'
      *
     C           F4SLDT    IFLT DACO
     C           ATYP      ANDEQ'R'
     C                     ADD  1         X
     C                     MOVE '052'     ERCD,X
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * Check against back value limit
      *
     C           F4SLDT    IFLT V#BVLD
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4SLDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2142' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4ORBK
     C                     MOVEL'Y'       I4ORBB
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
     C                     END
      *
      * Find difference between settle and pay
      *
     C                     Z-ADD0         F4PRBD
     C                     MOVEL'D'       ZFREQ
     C                     MOVELS4PCCY    ZCCY
      *
     C           F4SLDT    IFLT F4PVDT
     C                     Z-ADDF4SLDT    DAYNO1
     C                     Z-ADDF4PVDT    DAYNO2
     C                     ELSE
     C                     Z-ADDF4SLDT    DAYNO2  50
     C                     Z-ADDF4PVDT    DAYNO1  50
     C                     END
      *
     C                     Z-ADDDAYNO1    ZDAYNO
     C                     MOVE PLOC      ZLOC
      *
     C           ZDAYNO    DOWLTDAYNO2
      *
     C                     CALL 'FT0310'               9090
     C                     PARM *BLANKS   ZZERR@  7
     C                     PARM '*NEWDATE'W0ACT   8
     C                     PARM ZFREQ     W0FREQ  1
     C           ZDAYNO    PARM ZDAYNO    W0RDNB  50
     C                     PARM 0         W0MDAY  20
     C                     PARM ZCCY      W0CCY   3
     C                     PARM ZLOC      W0LOC   3
      *
      *  If error on call
      *
     C           ZZERR@    IFNE *BLANKS
     C           *IN90     OREQ '1'
     C                     MOVEL'FT0310  'W0FILE           ***************
     C                     MOVELZCCY      W0KEY            * DB ERROR 47 *
     C                     Z-ADD47        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     ADD  1         F4PRBD
     C                     END
      *
     C           F4SLDT    IFGT F4PVDT
     C                     MULT -1        F4PRBD
     C                     END
      *
      *  Check if pay date is in the future and if the
      *  account is closing today
      *
     C/COPY WNCPYSRC,FT0342C045
     C           S4SNCO    IFEQ *BLANKS
      *
      *  Set occurrance data structure for Ordering Customer
      *
     C           3         OCUR OACCNT
      *
     C           F4PVDT    IFGT WURDNB
     C           ACST      ANDEQ'C'
     C                     ADD  1         X
     C                     MOVE '601'     ERCD,X
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * For back valued transactions check against account open date
      *
     C           S4PYTP    IFNE 'RP'
      *
     C           F4PVDT    IFLT DACO
     C           ATYP      ANDEQ'R'
     C                     ADD  1         X
     C                     MOVE '021'     ERCD,X
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * Check against back value limit
      *
     C           F4PVDT    IFLT V#BVLD
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PVDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2148' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4DST1
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C           S4SNCO    IFNE *BLANKS
      *
      *  Set occurrance data structure for Ordering Customer
      *
     C           4         OCUR OACCNT
      *
     C           F4PVDT    IFGT WURDNB
     C           ACST      ANDEQ'C'
     C                     ADD  1         X
     C                     MOVE '602'     ERCD,X
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * For back valued transactions check against account open date
      *
     C           S4PYTP    IFNE 'RP'
      *
     C           F4PVDT    IFLT DACO
     C           ATYP      ANDEQ'R'
     C                     ADD  1         X
     C                     MOVE '035'     ERCD,X
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * Check against back value limit
      *
      *                                                                   S01408
     C/COPY WNCPYSRC,FT0342CCP1                                           S01408
      *                                                                   S01408
     C           F4PVDT    IFLT V#BVLD
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS4PVDT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2148' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I4SNCO
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *                                                                   S01408
     C/COPY WNCPYSRC,FT0342CCP2                                           S01408
      *                                                                   S01408
      *
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,FT0342C046
      *
      * Check if settle/pay/rate information has changed if so
      * one amount field must have been blank
      *
     C                     CLEARR#RCHK
     C                     MOVELS4SMCY    R#SMCY
     C                     MOVELS4PCCY    R#PCCY
     C                     Z-ADDF4SMAM    R#SMAM
     C                     Z-ADDF4PYAM    R#PYAM
     C                     Z-ADDF4RATE    R#RATE
     C                     MOVELS4OVRD    R#OVRD
     C                     MOVELS4STMT    R#STMT
      *
     C           V#NWRK    IFNE 'FONTIS'                                  CGL009
      *                                                                   CGL009
     C           V#RCHK    IFNE R#RCHK
     C           K#SMAM    ANDNE*BLANKS
     C           K#PYAM    ANDNE*BLANKS
     C                     ADD  1         X
     C                     MOVE '059'     ERCD,X
     C                     ADD  1         X
     C                     MOVE '055'     ERCD,X
     C                     ADD  1         X
     C                     MOVE '064'     ERCD,X
     C                     MOVEL'Y'       I4RATE
     C                     MOVEL'Y'       I4SMAM
     C                     MOVEL'Y'       I4PYAM
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     ELSE
     C                     MOVELR#RCHK    V#RCHK
     C                     END
      *                                                                   CGL009
     C                     ENDIF                                          CGL009
      *
     C           S4PYTP    IFEQ 'RP'
      *
      * Next date must be greater than today and less than final
      * date
      *
     C           F4NDAT    IFLE WURDNB
     C           F4NDAT    ORGT F4FIND
     C                     ADD  1         X
     C                     MOVE '080'     ERCD,X
     C                     MOVEL'Y'       I4NDAT
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
      * Final date must be greater than today and greater than
      * next date
      *
     C           F4FIND    IFLE WURDNB
     C           F4FIND    ORLE F4NDAT
     C           F4FIND    ORLE F4SLDT
     C                     ADD  1         X
     C                     MOVE '082'     ERCD,X
     C                     MOVEL'Y'       I4FIND
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *
      *  Set up From and To GL accounts
      *
     C           F4ORBT    IFEQ *BLANKS
     C                     MOVELORCDS     V#FRGL
     C                     ELSE
     C                     MOVELORBDS     V#FRGL
     C                     END
     C/COPY WNCPYSRC,FT0342C020
      *
     C           F4SNCT    IFEQ *BLANKS
     C                     MOVELDSTDS     V#TOGL
     C                     ELSE
     C                     MOVELSNCDS     V#TOGL
     C                     END
     C/COPY WNCPYSRC,FT0342C021
      *
      * Format amount for screen
      *
     C                     MOVE F4SMAM    ZFIELD
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD           B:FUNCTION FIELD
     C                     PARM SCNBDP    ZADEC            I:NO OF DECIMALS
      *
     C                     MOVE ZFIELD    S4SMAM
      *
      * Format amount for screen
      *
     C                     MOVE F4PYAM    ZFIELD
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD           B:FUNCTION FIELD
     C                     PARM PCNBDP    ZADEC            I:NO OF DECIMALS
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZEDIT   'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 29 *
     C                     Z-ADD29        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE ZFIELD    S4PYAM
      *
      *  Unwind subroutine stack name
      *
     C           EXXVAL    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     C                     ENDSR
     E/COPY FTCPYSRC,SFTADDRC
     E/COPY FTCPYSRC,SFTADDRSC
     E/COPY FTCPYSRC,SFTSWFTC
     E/COPY FTCPYSRC,SFTSNMSC
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRALGN   : To call ZALIGN                                    *
      *                                                               *
      *  CALLED BY:        -                                          *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRALGN    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRALGN'  @STK,Q
      *
     C                     CALL 'ZALIGN'               90
     C                     PARM *BLANKS   ZRTN    7        B:Return Code
     C                     PARM           ZFIELD 16        B:Check Field
     C                     PARM           ZADEC   10       I:No Of Decs
     C                     PARM           ZADIG   20       I:No Of Digits
     C                     PARM *BLANKS   ZAFLD  16        O:Check Field
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'ZALIGN  'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD48        W0ERNB           * DB ERROR 48 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXALGN    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRACT    : Undefined action - error                          *
      *                                                               *
      *  CALLED BY: Main Processing                                   *
      *                                                               *
      *  CALLS    : SRERR   - report error and close down program     *
      *                                                               *
      *****************************************************************
     CSR         SRACT     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRACT '  @STK,Q
      *
      *  Database error undefined action
      *
     C                     MOVEL'*ACTION 'W0FILE           ***************
     C                     MOVELW0ACT     W0KEY            * DB ERROR 49 *
     C                     Z-ADD49        W0ERNB           ***************
     C                     MOVEL'MEM5006' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
      *
      *  Unwind subroutine stack name
      *
     C           EXACT     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRRISO - Find out Receiver ISO Country Code                  *   CFT014
      *                                                               *   CFT014
      *  Called By: SRAMTV Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  SRACCS   - Access standing data detail file                  *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRRISO    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRRISO'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    WRISOC  2                       CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Destination type is SWIFT                                        CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'S'                                       CFT014
     C           2         SUBSTS4DST1:5  WRISOC                          CFT014
      *                                                                   CFT014
      ** Destination type is Customer, Full Nostro, Retail and GL         CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'C'                                       CFT014
     C           F4DSTT    OREQ 'F'                                       CFT014
     C           F4DSTT    OREQ 'R'                                       CFT014
     C           F4DSTT    OREQ 'G'                                       CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Full nostro, access nostro file to get customer number           CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'F'                                       CFT014
     C           3         SUBSTS4DST1:1  WCYCD                           CFT014
     C           2         SUBSTS4DST1:4  WNONB                           CFT014
     C                     MOVE *BLANKS   WCUSN                           CFT014
     C                     MOVE *BLANKS   WACCN                           CFT014
     C                     MOVE *BLANKS   WACSN                           CFT014
     C                     MOVE *BLANKS   WBRCD                           CFT014
     C                     MOVE *BLANKS   WCSSN                           CFT014
     C                     MOVE *BLANKS   WPNOI                           CFT014
      *                                                                   CFT014
     C                     MOVE 'N'       WACCS   1                       CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C                     MOVELA7CUST    WCNUM  10                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Customer, might be a customer name or a customer number.         CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'C'                                       CFT014
     C           10        SUBSTS4DST1:1  WCNUM                           CFT014
      *                                                                   CFT014
      ** Retail, or GL, get customer number.                              CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'R'                                       CFT014
     C           10        SUBSTS4DST1:1  WALN10 10                       CFT014
     C                     MOVE WALN10    ACNO                            CFT014
     C           ACNO      CHAINACNUMAF              90                   CFT014
     C           *IN90     IFEQ '0'                                       CFT014
     C           RECI      ANDEQ'D'                                       CFT014
     C                     MOVELCNUM      WCNUM                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F4DSTT    WHEQ 'G'                                       CFT014
     C           6         SUBSTS4DST1:1  WCNUM                           CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      ** Access customer's file to get SWIFT id                           CFT014
      *                                                                   CFT014
     C                     MOVE 'C'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C           BBCSID    IFNE *BLANK                                    CFT014
     C                     MOVELBBCSID    WSWIFT 12                       CFT014
     C           2         SUBSTWSWIFT:5  WRISOC                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** No SWIFT id, get country code                                    CFT014
      *                                                                   CFT014
     C                     MOVELBBCOLC    WCNCD   2                       CFT014
      *                                                                   CFT014
      ** Get ISO Country Code via access object AOCTRYR0                  CFT014
      *                                                                   CFT014
     C                     MOVE 'O'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C                     MOVELA4ISOC    WRISOC                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXRISO    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRSISO - Find out Sender ISO Country Code                    *   CFT014
      *                                                               *   CFT014
      *  Called By: SRAMTV Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  SRACCS   - Access to standing data detail file               *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRSISO    BEGSR                           *** SRSISO *** CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRSISO'  @STK,Q                          CFT014
      *                                                                   CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    WSISOC  2                       CFT014
      *                                                                   CFT014
      ** If multi-branching environment access branch file thru           CFT014
      ** booking branch, otherwise thru single branch code                CFT014
      *                                                                   CFT014
     C           WUMBIN    IFEQ 'Y'                                       CFT014
     C                     MOVELS4BRCA    WMBRCA  3                       CFT014
     C                     ELSE                                           CFT014
     C                     MOVELV#SBRC    WMBRCA                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Get SWIFT Id via access object AOBRCHR0                          CFT014
      *                                                                   CFT014
     C                     MOVE 'B'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Get ISO Country code via SWIFT Id.                               CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
     C           A8BTID    WHNE *BLANK                                    CFT014
     C           2         SUBSTA8BTID:5  WSISOC                          CFT014
      *                                                                   CFT014
      ** No SWIFT Id., get ISO Country code via location code.            CFT014
      *                                                                   CFT014
     C           A8LCCD    WHNE *BLANK                                    CFT014
     C                     MOVELA8LCCD    WLCCD   3                       CFT014
      *                                                                   CFT014
      ** Get country code via access object AOLOCNR0                      CFT014
      *                                                                   CFT014
     C                     MOVE 'L'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C                     MOVELDVCNCD    WCNCD                           CFT014
      *                                                                   CFT014
      ** Get ISO Country Code via access object AOCTRYR0                  CFT014
      *                                                                   CFT014
     C                     MOVE 'O'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C                     MOVELA4ISOC    WSISOC                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Otherwise, use customer number to derive the ISO Country Code.   CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELA8BICN    WCNUM                           CFT014
      *                                                                   CFT014
      ** Access customer's file to get SWIFT id                           CFT014
      *                                                                   CFT014
     C                     MOVE 'C'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C           BBCSID    IFNE *BLANK                                    CFT014
     C                     MOVELBBCSID    WSWIFT                          CFT014
     C           2         SUBSTWSWIFT:5  WSISOC                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** No SWIFT id, get country code                                    CFT014
      *                                                                   CFT014
     C                     MOVELBBCOLC    WCNCD                           CFT014
      *                                                                   CFT014
      ** Get ISO Country Code via access object AOCTRYR0                  CFT014
      *                                                                   CFT014
     C                     MOVE 'O'       WACCS                           CFT014
     C                     EXSR SRACCS                                    CFT014
      *                                                                   CFT014
     C           WACOK     IFEQ 'Y'                                       CFT014
     C                     MOVELA4ISOC    WSISOC                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXSISO    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRACCS - Accesses Customer, Nostro, Location, Country Code   *   CFT014
      *           and Branch code detail file.                        *   CFT014
      *                                                               *   CFT014
      *  Called By: SRRISO and SRSISO subroutines                     *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  AOCUSTR0 - Access to customer's file                         *   CFT014
      *  AOLOCNR0 - Access to location code's file                    *   CFT014
      *  AONOSTR0 - Access to Nostro file                             *   CFT014
      *  AOCTRYR0 - Access to country code's file                     *   CFT014
      *  AOBRCHR0 - Access to Branch code                             *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRACCS    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRACCS'  @STK,Q                          CFT014
      *                                                                   CFT014
      ** Initialise access OK indicator                                   CFT014
      *                                                                   CFT014
     C                     MOVE 'N'       WACOK   1                       CFT014
      *                                                                   CFT014
      ** Access detail file according to access indicator                 CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Customer                                                         CFT014
      *                                                                   CFT014
     C           WACCS     WHEQ 'C'                                       CFT014
     C                     CALL 'AOCUSTR0'             9090               CFT014
     C                     PARM *BLANKS   WRTRN   7                       CFT014
     C                     PARM '*KEY   ' WOPTN   7                       CFT014
     C                     PARM WCNUM     WKEY1  10                       CFT014
     C                     PARM *BLANKS   WKYST   7                       CFT014
     C           SDCUST    PARM SDCUST    DSSDY                           CFT014
      *                                                                   CFT014
     C           WRTRN     IFEQ *BLANK                                    CFT014
     C           *IN90     ANDEQ*OFF                                      CFT014
     C                     MOVE 'Y'       WACOK                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDCUSTPD'W0FILE                          CFT014
     C                     Z-ADD064       W0ERNB                          CFT014
     C                     MOVELWCNUM     W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Nostro                                                           CFT014
      *                                                                   CFT014
     C           WACCS     WHEQ 'N'                                       CFT014
     C                     CALL 'AONOSTR0'             9090               CFT014
     C                     PARM *BLANKS   WRTRN                           CFT014
     C                     PARM '*KEY   ' WOPTN                           CFT014
     C                     PARM           WCUSN   6                       CFT014
     C                     PARM           WCYCD   3                       CFT014
     C**********           PARM           WACCN   4                                    CFT014 CGL029
     C                     PARM           WACCN  10                                           CGL029
     C                     PARM           WACSN   2                       CFT014
     C                     PARM           WNONB   2                       CFT014
     C                     PARM           WBRCD   3                       CFT014
     C                     PARM           WCSSN  10                       CFT014
     C                     PARM           WPNOI   1                       CFT014
     C           SDNOST    PARM SDNOST    DSFDY                           CFT014
      *                                                                   CFT014
     C           WRTRN     IFEQ *BLANK                                    CFT014
     C           *IN90     ANDEQ*OFF                                      CFT014
     C                     MOVE 'Y'       WACOK                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDNOSTPD'W0FILE                          CFT014
     C                     Z-ADD65        W0ERNB                          CFT014
     C                     MOVELWOPTN     W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Location                                                         CFT014
      *                                                                   CFT014
     C           WACCS     WHEQ 'L'                                       CFT014
     C                     CALL 'AOLOCNR0'             9090               CFT014
     C                     PARM *BLANKS   WRTRN                           CFT014
     C                     PARM '*KEY   ' WOPTN                           CFT014
     C                     PARM WLCCD     WLOCN   3                       CFT014
     C           SDLOCN    PARM SDLOCN    DSFDY                           CFT014
      *                                                                   CFT014
     C           WRTRN     IFEQ *BLANK                                    CFT014
     C           *IN90     ANDEQ*OFF                                      CFT014
     C                     MOVE 'Y'       WACOK                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDLOCNPD'W0FILE                          CFT014
     C                     Z-ADD66        W0ERNB                          CFT014
     C                     MOVELWLCCD     W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Country Code                                                     CFT014
      *                                                                   CFT014
     C           WACCS     WHEQ 'O'                                       CFT014
     C                     CALL 'AOCTRYR0'             9090               CFT014
     C                     PARM *BLANKS   WRTRN                           CFT014
     C                     PARM '*KEY   ' WOPTN                           CFT014
     C                     PARM WCNCD     WCTCD   2                       CFT014
     C           SDCTRY    PARM SDCTRY    DSFDY                           CFT014
      *                                                                   CFT014
     C           WRTRN     IFEQ *BLANK                                    CFT014
     C           *IN90     ANDEQ*OFF                                      CFT014
     C                     MOVE 'Y'       WACOK                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDCTRYPD'W0FILE                          CFT014
     C                     Z-ADD67        W0ERNB                          CFT014
     C                     MOVELWCNCD     W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Branch                                                           CFT014
      *                                                                   CFT014
     C           WACCS     WHEQ 'B'                                       CFT014
     C**********           CALL 'AOBRCHR0'                                CFT014              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   WRTRN                           CFT014
     C                     PARM '*KEY   ' WOPTN                           CFT014
     C                     PARM WMBRCA    WBRCD   3                       CFT014
     C********** SDBRCH    PARM SDBRCH    DSFDY                           CFT014              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CFT014
     C           WRTRN     IFEQ *BLANK                                    CFT014
     C           *IN90     ANDEQ*OFF                                      CFT014
     C                     MOVE 'Y'       WACOK                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDBRCHPD'W0FILE                          CFT014
     C                     Z-ADD68        W0ERNB                          CFT014
     C                     MOVELWMBRCA    W0KEY                           CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXACCS    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRISOC - Access to ISO Country Codes file                    *   CFT014
      *                                                               *   CFT014
      *  Called By: SRAMTV Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls: None                                                  *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRISOC    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRISOC'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     MOVE *OFF      *IN90                           CFT014
     C                     MOVE *BLANK    WTRANS  1                       CFT014
     C           WISOC     CHAINMEISOCL1             90                   CFT014
     C           *IN90     IFEQ *OFF                                      CFT014
     C                     MOVELM3SCHT    WTRANS                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXISOC    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRORTE - Validate Original Rate                              *   CFT014
      *                                                               *   CFT014
      *  Called By: SRPROC Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls: None                                                  *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRORTE    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRORTE'  @STK,Q                          CFT014
      *                                                                   CFT014
      ** Validate original rate if entered.                               CFT014
      *                                                                   CFT014
     C           S4OEXR    IFNE *BLANK                                    CFT014
      *                                                                   CFT014
      ** Original Rate entry not allowed if Instructed Amount not         CFT014
      ** entered.                                                         CFT014
      *                                                                   CFT014
     C           V#PDAM    IFEQ 0                                         CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3103' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4OEXR                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXORTE                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    ZFIELD                          CFT014
     C                     MOVE S4OEXR    ZFIELD                          CFT014
     C                     Z-ADD4         ZADIG                           CFT014
     C                     Z-ADD8         ZADEC                           CFT014
      *                                                                   CFT014
     C                     EXSR SRALGN                                    CFT014
      *                                                                   CFT014
     C           ZRTN      IFNE *BLANKS                                   CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS4OEXR    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2125' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I4OEXR                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXORTE                                    CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    F4OEXR                          CFT014
      *                                                                   CFT014
      ** Original Rate not entered.                                       CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C           S4PDCY    IFNE *BLANK                                    CFT014
      *                                                                   CFT014
      ** Setup FT0010 parameters                                          CFT014
      *                                                                   CFT014
     C                     CLEARP#0010                                    CFT014
     C                     MOVE S4PCCY    P#FRCY                          CFT014
     C                     Z-ADDF4PYAM    P#FRAM                          CFT014
     C                     Z-ADDF4PVDT    P#FRDT                          CFT014
     C                     MOVE S4PDCY    P#TOCY                          CFT014
     C                     Z-ADDV#PDAM    P#TOAM                          CFT014
     C                     Z-ADDF4PVDT    P#TODT                          CFT014
     C           BTPCRD    MULT 0.01      P#RTDS                          CFT014
     C                     MOVEL'Y'       P#SDIN                          CFT014
      *                                                                   CFT014
      ** Get multiply/divide indicator via FT0010                         CFT014
      *                                                                   CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
      ** Error calling FT0010                                             CFT014
      *                                                                   CFT014
     C           P#RTCD    IFEQ '*ERROR*'                                 CFT014
     C                     MOVEL'FT0010  'DBFILE                          CFT014
     C                     Z-ADD69        DBASE                           CFT014
     C                     MOVEL'*CALL '  DBKEY                           CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           PDNBDP    SUB  PCNBDP    N       20                      CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Same number of decimal places, set workfield same as amounts     CFT014
      *                                                                   CFT014
     C           N         WHEQ 0                                         CFT014
     C                     Z-ADDV#PDAM    WPDAMT 110                      CFT014
     C                     Z-ADDF4PYAM    WPYAMT 110                      CFT014
      *                                                                   CFT014
      ** Instructed amount dec. greater than the payment amount dec.,     CFT014
      ** align payment amount to instructed amount.                       CFT014
      *                                                                   CFT014
     C           N         WHGT 0                                         CFT014
     C           F4PYAM    DIV  POWER,N   WPYAMT                          CFT014
     C                     Z-ADDV#PDAM    WPDAMT                          CFT014
      *                                                                   CFT014
      ** Instructed amount dec. less  than the payment amount dec.,       CFT014
      ** align instructed amount to payment amount.                       CFT014
      *                                                                   CFT014
     C           N         WHLT 0                                         CFT014
     C                     Z-SUBN         N
     C           V#PDAM    DIV  POWER,N   WPDAMT                          CFT014
     C                     Z-ADDF4PYAM    WPYAMT                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      ** Calculate original rate depending on mult/div indicator          CFT014
      ** (1 = Multiply otherwise, Divide) and set result as default       CFT014
      *                                                                   CFT014
     C                     Z-ADD*ZERO     F4OEXR                          CFT014
      *                                                                   CFT014
     C           S4PDCY    IFNE *BLANK                                    CFT014
     C           V#PDAM    ANDNE*ZERO                                     CFT014
     C           P#MDIN    IFEQ 1                                         CFT014
     C           WPDAMT    DIV  WPYAMT    F4OEXR                          CFT014
     C                     ELSE                                           CFT014
     C           WPYAMT    DIV  WPDAMT    F4OEXR                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Set original rate screen field                                   CFT014
      *                                                                   CFT014
     C           F4OEXR    IFNE 0                                         CFT014
     C                     MOVE F4OEXR    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM 8         ZADEC                           CFT014
      *                                                                   CFT014
      *  If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'ZEDIT   'W0FILE           ***************CFT014
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 70 *CFT014
     C                     Z-ADD70        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    S4OEXR                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXORTE    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRIBAN - Check for IBAN                                      *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT, SRORC Subroutine                          *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRIBAN    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           P@IBAN                                              CFT032
     C********** OACCNT    PARM           DSSDY                                      CFT032 BUG15037
     C                     PARM           DSSDY                                             BUG15037
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C**********           MOVEL'I'       F4ODTT                                     CFT032 BUG14771
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C**********           ELSE                                                      CFT022 BUG14771
     C**********           MOVEL'Y'       E#MSGS                                     CFT032 BUG14771
     C**********           MOVELS4ODMT    FTMSDT                                     CFT032 BUG14771
     C**********           MOVELE#CPGM    FTPGMQ                                     CFT032 BUG14771
     C**********           MOVEL'MMANNN8' FTMSID                                     CFT032 BUG14042
     C**********           MOVEL'MMA1408' FTMSID                                   BUG14042 BUG14771
     C**********           EXSR FTSNMS                                               CFT032 BUG14771
     C**********           MOVEL'Y'       I4ODMT                                     CFT032 BUG14771
     C**********           MOVEL'Y'       E#NOUP                                     CFT032 BUG14771
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRNOST   - Check for full Nostro                             *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRNOST    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AONOSTR0'             9090                                   CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @CUST                                               CFT032
     C                     PARM           @CYCD                                               CFT032
     C                     PARM           @ACCD                                               CFT032
     C                     PARM           @ACSN                                               CFT032
     C                     PARM           @NONB   2                                           CFT032
     C                     PARM           @BRCD                                               CFT032
     C                     PARM           @CSSN                                               CFT032
     C                     PARM           @PNOI                                               CFT032
     C           SDNOST    PARM *BLANKS   DSFDY                                               CFT032
      *                                                                                       CFT032
      ** If error on call                                                                     CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ *ON                                                           CFT032
     C                     MOVEL'AONOSTR0'W0FILE                                              CFT032
     C                     MOVEL'*CALL'   W0KEY                                               CFT032
     C                     Z-ADD7         W0ERNB                                              CFT032
     C                     MOVEL'MEM5003' W0MSGD                                              CFT032
     C                     MOVEL'MIDAS  ' W0MSGF                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRACCT   - Retrieve Account Details                          *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRACCT    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C           AKEY      CHAINACCNTABF             90                                       CFT032
      *                                                                                       CFT032
      ** Database error account does not exist                                                CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ *ON                                                           CFT032
     C                     MOVEL*BLANKS   ADCHK1                                              CFT032
     C                     MOVELA7CUST    ADGCNM                                              CFT032
     C                     MOVELADFCCY    ADGCCY                                              CFT032
     C                     MOVELA7ACCD    ADGACD                                              CFT032
     C                     MOVELA7ACSN    ADGASQ                                              CFT032
     C                     MOVELA7BRCD    ADGBRC                                              CFT032
     C                     MOVEL'ACCNT   'W0FILE                                              CFT032
     C                     MOVELADCHK1    W0KEY                                               CFT032
     C                     Z-ADD8         W0ERNB                                              CFT032
     C                     MOVEL'MEM5004' W0MSGD                                              CFT032
     C                     MOVEL'MIDAS  ' W0MSGF                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *                                                                                       CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRCUST   - Check for Customer                                *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRCUST    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AOCUSTR0'             9090                                   CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @KEY1                                               CFT032
     C                     PARM *BLANKS   @KYST                                               CFT032
     C           SDCUST    PARM *BLANKS   DSSDY                                               CFT032
      *                                                                                       CFT032
      ** If error on call                                                                     CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ *ON                                                           CFT032
     C                     MOVEL'AOCUSTR0'W0FILE                                              CFT032
     C                     MOVEL'*CALL'   W0KEY                                               CFT032
     C                     Z-ADD9         W0ERNB                                              CFT032
     C                     MOVEL'MEM5003' W0MSGD                                              CFT032
     C                     MOVEL'MIDAS  ' W0MSGF                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRRETN   - Check for Retail Number                           *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRRETN    BEGSR                                                              CFT032
      *                                                                                       CFT032
      **  Check account is on ACCNTAB                                                         CFT032
      *                                                                                       CFT032
     C                     MOVELADACNO    ACNO                                                CFT032
     C           ACNO      CHAINACNUMAF              90                                       CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ '1'                                                           CFT032
     C           RECI      ORNE 'D'                                                           CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELS4ODMT    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'MMANNN5' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1405' FTMSID                                            BUG14042
     C                     MOVEL'DRSMM   'FTMSGF                                            AR928992
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ELSE                                                               CFT032
      *                                                                                       CFT032
      **  Retail Account found mark as Retail                                                 CFT032
      *                                                                                       CFT032
     C                     MOVEL'R'       F4ODTT                                              CFT032
     C           IBAN      IFNE *BLANKS                                                       CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     END                                                                CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRSWFT   - Check for SWIFT Code                              *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRSWFT    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C                     MOVELADCHK1    CLSWTK                                              CFT032
     C                     EXSR SWIFT                                                         CFT032
      *                                                                                       CFT032
     C           ##CSID    IFEQ 'Y'                                                           CFT032
     C           *IN32     IFEQ '0'                                                           CFT032
     C           *IN31     ANDEQ'0'                                                           CFT032
      *                                                                                       CFT032
     C                     MOVEL'S'       F4ODTT                                              CFT032
      *                                                                                       CFT032
      **  No SWIFT address record.                                                            CFT032
      *                                                                                       CFT032
     C                     ELSE                                                               CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELCLSWTK    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'FTM2358' FTMSID                                              CFT032
     C                     EXSR FTSNMS                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRLEDA   - Check for General Ledger Account                  *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRLEDA    BEGSR                                                              CFT032
      *                                                                                       CFT032
      ** Set up key for chain                                                                 CFT032
      *                                                                                       CFT032
     C                     MOVELADGCNM    CNUM                                                CFT032
     C                     MOVELADGCCY    CCY                                                 CFT032
     C                     MOVELADGACD    ACOD                                                CFT032
     C                     MOVELADGASQ    ACSQ                                                CFT032
      *                                                                                       CFT032
      ** Set up branch depending on multibranching                                            CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           WUMBIN    WHNE 'Y'                                                           CFT032
     C                     MOVE V#SBRC    BRCA                                                CFT032
     C           ADGBRC    WHEQ *BLANKS                                                       CFT032
     C                     MOVELDBRN      BRCA                                                CFT032
     C                     OTHER                                                              CFT032
     C                     MOVELADGBRC    BRCA                                                CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C           AKEY      CHAINACCNTABF             90                                       CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ '1'                                                           CFT032
     C           RECI      ORNE 'D'                                                           CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELS4ODMT    FTMSDT                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C**********           MOVEL'MMANNN7' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1407' FTMSID                                            BUG14042
     C                     MOVEL'DRSMM   'FTMSGF                                            AR928992
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       I4ODMT                                              CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ELSE                                                               CFT032
      *                                                                                       CFT032
      ** GL Account found mark as Ledger                                                      CFT032
      *                                                                                       CFT032
     C                     MOVEL'G'       F4ODTT                                              CFT032
     C           IBAN      IFNE *BLANKS                                                       CFT032
     C                     MOVE 'Y'       @@IBAN                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRCNTL   - Retrieve Country of location                      *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRODMT Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRCNTL    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C**********           MOVE *BLANKS   @CNTLC                                     CFT032 BUG14042
     C                     MOVE *BLANKS   @CNTLC  4                                         BUG14042
     C                     CALL 'AOACCTV1'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @TYP                                                CFT032
     C                     PARM           WOCUST                                              CFT032
     C                     PARM           DSSDY                                               CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           @TYP      WHEQ '*RETAIL'                                                     CFT032
     C           @TYP      OREQ '*LEDGER'                                                     CFT032
     C                     MOVELDSSDY     OACCNT                                              CFT032
     C                     MOVELCNUM      WCUST   6                                           CFT032
     C           @TYP      WHEQ '*NOSTRO'                                                     CFT032
     C                     MOVELDSSDY     SDNOST                                              CFT032
     C                     MOVELA7CUST    WCUST                                               CFT032
     C           @TYP      WHEQ '*CUSTNO'                                                     CFT032
     C           @TYP      OREQ '*SHNAME'                                                     CFT032
     C                     MOVELDSSDY     SDCUST                                              CFT032
     C                     MOVELBBCUST    WCUST                                               CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AOCUSTR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY'    @OPTN                                               CFT032
     C                     PARM WCUST     @KEY1                                               CFT032
     C                     PARM *BLANKS   @KYST                                               CFT032
     C           SDCUST    PARM SDCUST    DSSDY                                               CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVELBBCOLC    @CNTLC                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SROUFM - Retrieve Outgoing Message Field Management          *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRORC, SRODMT Subroutine                          *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SROUFM    BEGSR                                                              CFT032
      *                                                                                       CFT032
      *  Set up subroutine stack name                                                         CFT032
      *                                                                                       CFT032
     C                     ADD  1         Q                                                   CFT032
     C                     MOVEL'SROUFM'  @STK,Q                                              CFT032
      *                                                                                       CFT032
      ** Account Input?                                                                       CFT032
      *                                                                                       CFT032
     C                     MOVE 'N'       WACCIN  1                                           CFT032
     C           WENTTP    IFEQ 'I'                                                           CFT032
     C           WENTTP    OREQ 'G'                                                           CFT032
     C           WENTTP    OREQ 'F'                                                           CFT032
     C           WENTTP    OREQ 'R'                                                           CFT032
     C                     MOVE 'Y'       WACCIN                                              CFT032
      *                                                                                       CFT032
      ** Retrive Customer Details                                                             CFT032
      *                                                                                       CFT032
     C                     MOVELCNUM      @KEY1     P                                         CFT032
     C                     EXSR SRCUST                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Message Tag                                                                          CFT032
      *                                                                                       CFT032
     C           WENTTP    IFEQ 'S'                                                           CFT032
     C           WENTTP    OREQ 'C'                                                           CFT032
     C           WACCIN    OREQ 'Y'                                                           CFT032
     C           CSW024    ANDEQ'N'                                                           CFT032
     C           BBCSID    ANDNE*BLANKS                                                       CFT032
     C           WACCIN    OREQ 'Y'                                                           CFT032
     C           CSW024    ANDEQ'Y'                                                           CFT032
     C           BBCBEI    ANDNE*BLANKS                                                       CFT032
     C                     MOVE ':50A:'   @MSGTG                                              CFT032
     C                     ELSE                                                               CFT032
     C                     MOVE ':50K:'   @MSGTG                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Network                                                                              CFT032
      *                                                                                       CFT032
     C                     MOVE *BLANKS   @NTWRK                                              CFT032
     C                     SELEC                                                              CFT032
     C           S4STMT    WHEQ '08'                                                          CFT032
     C                     MOVEL'SWIFT'   @NTWRK                                              CFT032
     C           S4STMT    WHEQ '01'                                                          CFT032
     C**********           MOVEL'Telex'   @NTWRK                                     CFT032 BUG14771
     C                     MOVEL'TELEX'   @NTWRK                                            BUG14771
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
      ** Message Type                                                                         CFT032
      *                                                                                       CFT032
     C                     MOVE '103'     @MSGTP                                              CFT032
      *                                                                                       CFT032
      ** Country of Location                                                                  CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           F4DSTT    WHEQ 'A'                                                           CFT032
     C                     MOVE *BLANKS   @CNTLC                                              CFT032
     C           F4DSTT    WHEQ 'S'                                                           CFT032
     C           WENTTP    ANDEQ'S'                                                           CFT032
     C********** 2         SUBSTWOCUST:5  @CNTLC                                     CFT032 BUG14771
     C           2         SUBSTS4DST1:5  @CNTLC                                            BUG14771
     C                     OTHER                                                              CFT032
     C                     MOVELS4DST1    WOCUST                                            BUG14771
     C                     EXSR SRCNTL                                                        CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
      ** Nostro Number                                                                        CFT032
      *                                                                                       CFT032
     C                     MOVE *BLANKS   @NOSTN                                              CFT032
     C                     MOVEL*BLANKS   @NONB                                               CFT032
      *                                                                                     BUG14771
     C                     MOVE *BLANKS   ADDRSS                                            BUG14771
     C           S4SNCO    IFNE *BLANKS                                                     BUG14771
     C                     MOVELS4SNCO    ADDRSS                                            BUG14771
     C                     MOVELF4SNCT    WENTT2  1                                         BUG14771
     C                     ELSE                                                             BUG14771
     C                     MOVELS4DST1    ADDRSS                                            BUG14771
     C                     MOVELF4DSTT    WENTT2                                            BUG14771
     C                     END                                                              BUG14771
      *                                                                                     BUG14771
     C********** S4SMCY    IFNE *BLANKS                                              CFT032 BUG14771
     C**********           MOVELS4SMCY    WCCY                                       CFT032 BUG14771
     C**********           ELSE                                                      CFT032 BUG14771
     C**********           MOVELS4PCCY    WCCY                                       CFT032 BUG14771
     C**********           ENDIF                                                     CFT032 BUG14771
     C           S4PCCY    IFNE *BLANKS                                                     BUG14771
     C                     MOVELS4PCCY    WCCY                                              BUG14771
     C                     ELSE                                                             BUG14771
     C                     MOVELS4SMCY    WCCY                                              BUG14771
     C                     ENDIF                                                            BUG14771
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C********** WENTTP    WHEQ 'N'                                                  CFT032 BUG14771
     C           WENTT2    WHEQ 'N'                                                         BUG14771
     C                     MOVELADNOSN    @NOSTN                                              CFT032
      *                                                                                       CFT032
     C********** WENTTP    WHEQ 'F'                                                  CFT032 BUG14771
     C           WENTT2    WHEQ 'F'                                                         BUG14771
     C                     MOVELADFNNB    @NOSTN                                              CFT032
      *                                                                                       CFT032
     C********** WENTTP    WHEQ 'P'                                                  CFT032 BUG14771
     C           WENTT2    WHEQ 'P'                                                         BUG14771
     C           WUMBIN    IFEQ 'Y'                                                           CFT032
     C                     MOVELBJSBRC    @BRCD                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELADPBRC    @BRCD                                               CFT032
     C                     ENDIF                                                              CFT032
     C                     MOVELADPCNM    @CUST                                               CFT032
     C                     MOVELADPACD    @ACCD                                               CFT032
     C                     MOVELADPASQ    @ACSN                                               CFT032
     C                     MOVELWCCY      @CYCD                                               CFT032
     C                     EXSR SRNOST                                                        CFT032
     C                     MOVELA7NONB    @NOSTN                                              CFT032
      *                                                                                       CFT032
     C********** WENTTP    WHEQ 'G'                                                  CFT032 BUG14771
     C           WENTT2    WHEQ 'G'                                                         BUG14771
     C           WUMBIN    IFEQ 'Y'                                                           CFT032
     C                     MOVELBJSBRC    @BRCD                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELADGBRC    @BRCD                                               CFT032
     C                     ENDIF                                                              CFT032
     C                     MOVELADGCNM    @CUST                                               CFT032
     C                     MOVELADGACD    @ACCD                                               CFT032
     C                     MOVELADGASQ    @ACSN                                               CFT032
     C                     MOVELADGCCY    @CYCD                                               CFT032
     C                     EXSR SRNOST                                                        CFT032
     C                     MOVELA7NONB    @NOSTN                                              CFT032
      *                                                                                       CFT032
     C********** WENTTP    WHEQ 'R'                                                  CFT032 BUG14771
     C           WENTT2    WHEQ 'R'                                                         BUG14771
     C                     MOVELADACNO    ACNO                                                CFT032
     C           ACNO      CHAINACNUMAF              90                                       CFT032
     C                     MOVELBRCA      @BRCD                                               CFT032
     C                     MOVELCNUM      @CUST                                               CFT032
     C                     MOVELACOD      @ACCD                                               CFT032
     C                     MOVELACSQ      @ACSN                                               CFT032
     C                     MOVELCCY       @CYCD                                               CFT032
     C                     EXSR SRNOST                                                        CFT032
     C                     MOVELA7NONB    @NOSTN                                              CFT032
      *                                                                                       CFT032
     C********** WENTTP    WHEQ 'I'                                                  CFT032 BUG14771
     C********** WENTT2    WHEQ 'I'                                                  BUG14771 250600
     C**********           MOVELWOCUST    PWORC1                                     BUG14926 250600
     C**********           CALL 'AOIBANR3'                                             CFT032 250600
     C**********           PARM *BLANKS   @RTCD                                        CFT032 250600
     C**********           PARM           WOCUST                                     CFT032 BUG14926
     C**********           PARM           PWORC1                                     BUG14926 250600
     C**********           PARM           POWITH                                       CFT032 250600
     C********** P@IBAN    PARM           PONOBL                                       CFT032 250600
     C********** P@IBAN    PARM           PONOBL                                     CFT032 BUG14771
     C**********           EXSR SRIBAN                                                 CFT032 250600
     C**********           MOVELBRCA      @BRCD                                        CFT032 250600
     C**********           MOVELCNUM      @CUST                                        CFT032 250600
     C**********           MOVELACOD      @ACCD                                        CFT032 250600
     C**********           MOVELACSQ      @ACSN                                        CFT032 250600
     C**********           MOVELCCY       @CYCD                                        CFT032 250600
     C**********           EXSR SRNOST                                                 CFT032 250600
     C**********           MOVELA7NONB    @NOSTN                                       CFT032 250600
      *                                                                                       CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
      ** Action                                                                               CFT032
      *                                                                                       CFT032
     C                     MOVE CACNT1    @ACTNF                                              CFT032
      *                                                                                       CFT032
      ** Call Access program                                                                  CFT032
      *                                                                                       CFT032
     C                     MOVELBRCA      BRCA4A                                            BUG14042
     C                     MOVEL@CNTLC    CTRY4A                                            BUG14042
     C                     CALL 'AOOUFMR0'PLOUFM                                              CFT032
      *                                                                                       CFT032
      ** If no error                                                                          CFT032
      *                                                                                       CFT032
     C********** @RTRN     IFEQ *BLANKS                                              CFT032 BUG14771
     C           @RTRN     IFNE *BLANKS                                                     BUG14771
     C                     MOVE 'O'       OMFLAG                                            BUG14771
     C                     ENDIF                                                            BUG14771
      *                                                                                       CFT032
     C           S4ODMT    IFNE *BLANKS                                                       CFT032
     C           F4ODTT    IFEQ 'I'                                                           CFT032
     C           F4ODTT    OREQ 'R'                                                           CFT032
     C           F4ODTT    OREQ 'G'                                                           CFT032
     C           F4ODTT    OREQ 'F'                                                           CFT032
     C                     MOVE '/'       ADSLSH                                              CFT032
     C                     ELSE                                                               CFT032
     C                     MOVE *BLANKS   ADSLSH                                              CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     MOVE 'N'       WASC    1                                           CFT032
     C           WENTTP    IFEQ 'A'                                                           CFT032
     C           WENTTP    OREQ 'S'                                                           CFT032
     C           WENTTP    OREQ 'C'                                                           CFT032
     C                     MOVE 'Y'       WASC                                                CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C********** OMAACT    WHEQ *BLANKS                                              CFT032 BUG14042
     C**********           MOVE 'O'       OMAACT                                     CFT032 BUG14042
     C           OMFLAG    WHEQ *BLANKS                                                     BUG14042
     C                     MOVE 'O'       OMFLAG                                            BUG14042
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'M'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'M'                                                         BUG14042
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           WASC      ANDEQ'Y'                                                           CFT032
     C           S4ODMT    IFEQ *BLANKS                                                       CFT032
     C**********           MOVEL'MMANN12' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1412' FTMSID                                            BUG14042
     C                     ELSE                                                               CFT032
     C**********           MOVEL'MMANN24' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1424' FTMSID                                            BUG14042
     C                     ENDIF                                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                              250600
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXOUFM                                                        CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'W'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'W'                                                         BUG14042
     C           ADSLSH    ANDNE'/'                                                           CFT032
     C           WASC      ANDEQ'Y'                                                           CFT032
     C           S4ODMT    IFEQ *BLANKS                                                       CFT032
     C**********           MOVEL'MMANN13' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1413' FTMSID                                            BUG14042
     C                     ELSE                                                               CFT032
     C**********           MOVEL'MMANN25' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1425' FTMSID                                            BUG14042
     C                     ENDIF                                                              CFT032
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
      *                                                                                       CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C********** OMAACT    IFEQ 'P'                                                  CFT032 BUG14042
     C           OMFLAG    IFEQ 'P'                                                         BUG14042
     C           S4ODMT    ANDEQ*BLANKS                                                       CFT032
     C           ADSLSH    ANDEQ'/'                                                           CFT032
     C**********           MOVEL'MMANN14' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1414' FTMSID                                            BUG14042
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C**********           ENDIF                                                     CFT032 BUG14771
      *                                                                                       CFT032
      ** IBAN numbers                                                                         CFT032
      *                                                                                       CFT032
     C           CFT004    IFEQ 'Y'                                                           CFT032
     C                     MOVE CACNT2    @ACTNF                                              CFT032
     C                     MOVELBRCA      BRCA4A                                            BUG14042
     C                     MOVEL@CNTLC    CTRY4A                                            BUG14042
     C                     CALL 'AOOUFMR0'PLOUFM                                              CFT032
     C********** @RTRN     IFEQ *BLANKS                                              CFT032 BUG14771
     C           @RTRN     IFNE *BLANKS                                                     BUG14771
     C                     MOVE 'O'       OMFLAG                                            BUG14771
     C                     ENDIF                                                            BUG14771
      *                                                                                     BUG14771
     C                     SELEC                                                              CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ *BLANKS                                              CFT032 BUG14042
     C**********           MOVE 'O'       OMAACT                                     CFT032 BUG14042
     C           OMFLAG    WHEQ *BLANKS                                                     BUG14042
     C                     MOVE 'O'       OMFLAG                                            BUG14042
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'M'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'M'                                                         BUG14042
     C           @@IBAN    ANDEQ'N'                                                           CFT032
     C           S4ODMT    IFEQ *BLANKS                                                       CFT032
     C**********           MOVEL'MMANN15' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1415' FTMSID                                            BUG14042
     C                     ELSE                                                               CFT032
     C**********           MOVEL'MMANN26' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1426' FTMSID                                            BUG14042
     C                     ENDIF                                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXOUFM                                                        CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'W'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'W'                                                         BUG14042
     C           @@IBAN    ANDEQ'N'                                                           CFT032
     C**********           ENDSL                                                     CFT032 BUG14771
     C           S4ODMT    IFEQ *BLANKS                                                       CFT032
     C**********           MOVEL'MMANN16' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1416' FTMSID                                            BUG14042
     C                     ELSE                                                               CFT032
     C**********           MOVEL'MMANN27' FTMSID                                     CFT032 BUG14042
     C                     MOVEL'MMA1427' FTMSID                                            BUG14042
     C                     ENDIF                                                              CFT032
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
      *                                                                                     BUG14771
     C                     ENDSL                                                            BUG14771
      *                                                                                     BUG14771
     C                     ENDIF                                                              CFT032
     C**********           ENDIF                                                     CFT032 BUG14771
      *                                                                                       CFT032
      ** Unwind subroutine stack name                                                         CFT032
      *                                                                                       CFT032
     C           EXOUFM    TAG                                                                CFT032
     C                     MOVEA*BLANKS   @STK,Q                                              CFT032
     C                     SUB  1         Q       50                                          CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************
      *                                                               *
      *  SRINIT   : Initialise and define fields                      *
      *                                                               *
      *  CALLED BY: Main processing                                   *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRINIT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *  Set up copyright statement
      *
     C                     MOVEACPY@      BIS@   80
      *
      *  Open Files
      *
     C                     OPEN ACCNT
     C                     OPEN ACNUMA
     C                     OPEN PYCHGDB
      *
      *  Set up KLIST for ACCNT
      *
     C           AKEY      KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA                            S01117
      *                                                                   CEU006
     C                     MOVE *OFF      *IN89                           CEU006
      *                                                                   CEU006
      *
      *  Get Rundate information
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
     C/COPY WNCPYSRC,FT0342C022
      *
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
      *
      *  Set up MT202 compare variable
      *
     C           *LIKE     DEFN S4ORC1    ORCFLD
     C                     MOVEL*BLANKS   ORCFLD
     C                     MOVEL'MT202'   ORCFLD
      *                                                                   CEU006
      ** Access SAR details file to determine if CEU006 is switched ON    CEU006
      *                                                                   CEU006
     C                     CALL 'AOSARDR0'                                CEU006
     C                     PARM *BLANKS   @RTRN   7                       CEU006
     C                     PARM '*VERIFY' @OPTN   7                       CEU006
     C                     PARM 'CEU006'  @SARD   6                       CEU006
     C           SCSARD    PARM SCSARD    DSFDY                           CEU006
      *                                                                   CEU006
      ** If core feature is switched ON, set a variable field to          CEU006
      ** condition the rest of the processing                             CEU006
      *                                                                   CEU006
     C           @RTRN     IFEQ *BLANKS                                   CEU006
     C                     MOVE 'Y'       CEU006  1                       CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
      ** else, database error (return code other than *NRF)               CEU006
      *                                                                   CEU006
     C           @RTRN     IFNE '*NRF   '                                 CEU006
     C                     MOVEL'SCSARDPD'W0FILE           ************   CEU006
     C                     MOVEL'*VERIFY' W0KEY            * DBERR 52 *   CEU006
     C                     Z-ADD52        W0ERNB           ************   CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ELSE                                           CEU006
     C                     MOVE 'N'       CEU006                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CFT014
      ** Access SAR details file to determine if CFT014 is switched ON    CFT014
      *                                                                   CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   @RTRN   7                       CFT014
     C                     PARM '*VERIFY' @OPTN   7                       CFT014
     C                     PARM 'CFT014'  @SARD   6                       CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
      ** If core feature is switched ON, set a variable field to          CFT014
      ** condition the rest of the processing                             CFT014
      *                                                                   CFT014
     C           @RTRN     IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014  1                       CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** else, database error (return code other than *NRF)               CFT014
      *                                                                   CFT014
     C           @RTRN     IFNE '*NRF   '                                 CFT014
     C                     MOVEL'SCSARDPD'W0FILE           ************   CFT014
     C                     MOVEL'*VERIFY' W0KEY            * DBERR 69 *   CFT014
     C                     Z-ADD69        W0ERNB           ************   CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       CFT014                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CFT032
      ** Access SAR details to see if CFT004 is enabled.                                      CFT032
      *                                                                                       CFT032
     C                     CALL 'AOSARDR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*VERIFY' @OPTN                                               CFT032
     C                     PARM 'CFT004'  @SARD                                               CFT032
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C           @RTCD     ANDNE'*NRF   '                                                     CFT032
     C                     MOVEL'CFT004'  W0KEY                                               CFT032
     C                     MOVEL'SCSARDPD'W0FILE                                              CFT032
     C                     Z-ADD71        W0ERNB                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVEL'Y'       CFT004  1                                           CFT032
     C                     ELSE                                                               CFT032
     C                     MOVEL'N'       CFT004                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Access SAR details to see if CSW024 is enabled.                                      CFT032
      *                                                                                       CFT032
     C                     CALL 'AOSARDR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*VERIFY' @OPTN                                               CFT032
     C                     PARM 'CSW024'  @SARD                                               CFT032
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C           @RTCD     ANDNE'*NRF   '                                                     CFT032
     C                     MOVEL'CSW024'  W0KEY                                               CFT032
     C                     MOVEL'SCSARDPD'W0FILE                                              CFT032
     C                     Z-ADD72        W0ERNB                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVEL'Y'       CSW024  1                                           CFT032
     C                     ELSE                                                               CFT032
     C                     MOVEL'N'       CSW024                                              CFT032
     C                     ENDIF                                                              CFT032
     C/COPY OFCPYSRCZ,CFT148_031                                                            MD020161
      * Check CSW207 feature                                                                  CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C           @RTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVEL'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVEL'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CFT032
      ** Call Access Program for Bank Details                                                 CFT032
      *                                                                                       CFT032
     C                     CALL 'AOBANKR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*FIRST ' @OPTN                                               CFT032
     C           SDBANK    PARM SDBANK    DSFDY                                               CFT032
      *                                                                                       CFT032
      ** Handle Database Error                                                                CFT032
      *                                                                                       CFT032
     C           @RTCD     IFNE *BLANK                                                        CFT032
     C                     MOVEL'SDBANKPD'W0FILE                                              CFT032
     C                     MOVEL'*FIRST ' W0KEY                                               CFT032
     C                     Z-ADD73        W0ERNB                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C/COPY WNCPYSRC,FT0342C008
      *                                                                   166214
      ** Extract Fund Transfert Details                                   166214
      *                                                                   166214
     C                     CALL 'AOFTFRR0'             90                 166214
     C                     PARM '*DBERR ' @RTCD   7                       166214
     C                     PARM '*FIRST ' @OPTN   7                       166214
     C           SDFTFR    PARM SDFTFR    DSFDY                           166214
     C           @RTCD     IFNE *BLANK                                    166214
     C           *IN90     OREQ '1'                                       166214
     C                     MOVEL'SDFTFRPD'W0FILE           ************   166214
     C                     MOVEL'*FIRST ' W0KEY            * DBERR 57 *   166214
     C                     Z-ADD57        W0ERNB           ************   166214
     C                     EXSR SRERR                                     166214
     C                     ENDIF                                          166214
      *
      *  Indicate that set up is complete
      *
     C                     SETON                     50
      *
      *  Unwind subroutine stack name
      *
     C           EXINIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/COPY WNCPYSRC,FT0342DCPG
      *
      *  /Copy point for Calculations
      *
     C**
     C/EJECT
      *
      *  File and Program Error Processing
      *
     C/COPY FTCPYSRC,SRERRC
     C/EJECT
     O/COPY WNCPYSRC,FT0342DOPG
      *
      *  /Copy point for Outputs
      *
     O/EJECT
**  CPY@ table
(c) Finastra International Limited 2001
**   NDY  - DAY IN MONTH TABLE
01020304050607080910111213141516171819202122232425262728293031
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ALPH  - Array of alphabetic                                          CFT004
ABCDEFGHIJKLMNOPQRSTUVWXYZ
**   NUMC  - Array of numeric                                             CFT004
1234567890
