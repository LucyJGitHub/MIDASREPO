     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Outgoing payments maintenance level two')              *
/*XBIA*  OVRDBF OTPAYL1 OTPAY                                         *
/*XBIB*  OVRDBF OTPAYL0 OTPAY                                         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0345 - FT Outgoing Maintenance Level 2                     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CFT162             Date 08Sep17               *
      *  Prev Amend No. CFT050             Date 03Jun13               *
      *                 CFT120             Date 28Sep12               *
      *                 CLE134             Date 01Aug12               *
      *                 CER049             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 BUG26775           Date 23Nov09               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      *                 BUG24998           Date 17Jul09               *
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15201           Date 30Oct07               *
      *                 250600             Date 07Oct07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CSW206             Date 03Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG433             Date 05Dec05               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CER001             Date 25Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CTI004             Date 27May04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 219241             Date 01Jul03               *
      *                 CSW203             Date 26May03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 197834             Date 23Sep02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 199657             Date 08Jan02               *
      *                 CFT017             Date 08Nov01               *
      *                 193190             Date 27Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 18Jul00               *
      *                 191351             Date 23Mar01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187056             Date 01Dec00               *
      *                 CFT014             Date 25May00               *
      *                 183723             Date  4Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CFT007             Date 12Nov99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP031             DATE 07FEB00               *
      *                 133860             DATE 22MAY98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 126281             DATE 04OCT98               *
     F*                 CEU006             DATE 01MAY98               *
     F*                 100660             DATE 06MAY97               *
     F*                 096486             DATE 03APR97               *
     F*                 CRT002             DATE 01DEC95               *
     F*                 S01408             DATE 03OCT96               *
     F*                 CSW096             DATE 18JUL96               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 S01408             DATE 04SEP95               *
     F*                 CPK001             DATE 03MAY94               *
     F*                 082485             DATE 09MAR95               *
     F*                 081699             DATE 02FEB95               *
     F*                 S01508             DATE 27JUN94               *
     F*                 S01506             DATE 27JUN94               *
     F*                 S01499             DATE 06JUN94               *
     F*                 S01494             DATE 25MAY94               *
     F*                 068347             DATE 18MAR94               *
     F*                 068320             DATE 17MAR94               *
     F*                 S01435             DATE 11OCT93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CFT162 - MT900 and MT910 Message Generation (Recompile)      *
      *  CFT050 - SWIFTRef Directories upload                         *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *           (Recompile)                                         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CER049 - Stamp Tax                                           *
      *  CRE075 - Effective Date for Retail Accounts                  *
      *  BUG26775 - Validation error in Outgoing Validation Flag      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24C KWG         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  BUG24998 - Bank operation code is missing (Recompile)        *
      *  CSW209 - SWIFT 2009 Changes (Recompile)                      *
      *  BUG15201 - Encounter Database Errors (Recompile)             *
      *  250600 - Fix CFT032 and CSW207 (recompile)                   *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CFT032 - Account Line in Field 50X in MT103                  *
      *  CSW206 - SWIFT 2006 Standard Changes                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG433 - Recompiled due to change in FTPCHGPD                *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CTI004 - MidasPlus TI Integration Enhancements               *
      *  CLE025 - Credit Lines                                        *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value                                        *
      *  CSW203 - SWIFT 2003 Standards Update                         *
      *  197834 - Receiver's charges (in settle currency) base        *
      *           currency equivalent is half adjusted twice causing  *
      *           FT imbalance.                                       *
      *  199657 - Obtain customer no. for retail accounts             *
      *  CFT017 - Multilateral Inter-bank Exchange Fee.               *
      *  193190 - Move call to SUBR/SRRCAL after field F7CDRT had     *
      *           already been initialised. Also add a condition to   *
      *           execute SRRCAL only when the 'Charges to the DR of  *
      *           A/C' field had already been validated with no error.*
      *  CSW201 - SWIFT 2001 Standards Update                         *
     F*  CFT009 - Fees and Charges Development                        *
      *  191351 - Cannot input any payments because the program is    *
      *           trying to access payments on new file OTPAYXL0 even *
      *           though CFT014 is not switched on. Condition the     *
      *           chain on CFT014 being on. Also condition the update *
      *           of OTPAYXL2 on CFT014 being on.                     *
      *  187056 - IP and OP do not recalculate screen charges if      *
      *           'Charges to the Debit of a/c' has been changed      *
      *           from blank to non-blank.                            *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
     F*  183723 - @1DBRC must be kept the same length as #1DBRC (from *
     F*           OTPAYDD) to avoid error in update. Increase length  *
     F*           to include new fields added for CAP031/CPB001/175479*
      *  CFT007 - BIC Database Plus Integration                       *
     F*  CAP031 - FT OPAY API - Recompile for changes to OTPAYDD      *
     F*  133860 - Charges disappear when amending an incoming payment.*
     F*           Fix is to remove 100660 from FT0345 and FT0355 only.*
     F*  126281 - Cheque charge or swift charge displayed in proj.    *
     F*           account movements with wrong sign if payment is     *
     F*           cheque or swift priority is 'U'.                    *
     F*           Do not reverse charges on insert.                   *
     F*  CEU006 - EMU FT enhancements                                 *
     F*  100660 - Telex and other charges should not be cleared when  *
     F*           payment amount only is changed. If only pay/settle  *
     F*           amount is amended the telex charge etc. are retained*
     F*           System recalculates commission as before.           *
     F*           Recalculate charges on any amend                    *
     F*  096486 - Previous Fix 065890.                                *
     F*           Skip the SPF Action validation if program is        *
     F*           triggered from GL4442 program.                      *
     F*  CRT002 - Retail Branch Access.                               *
     F*  S01408 - Addition of hooks FT0345FFP1                        *  *
     F*           Addition of hooks FT0345CCP7                        *  *
     F*           Addition of hooks FT0345CCP6                        *  *
     F*           Addition of hooks FT0345CCP5                        *  *
     F*           Addition of hooks FT0345CCP4                        *  *
     F*           Addition of hooks FT0345CCP3                        *  *
     F*           Addition of hooks FT0345CCP2                        *  *
     F*  CSW096 - Fill V#FRGL and V#TOGL with correct accounts        *  *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Allow F19 for Margin Information if Analytical      *
     F*           Accounting is installed.                            *
     F*  S01408 - Addition of hooks FT0345CCP1                        *  *
     F*  CPK001 - R10.6 packaging. Move non-empty /COPY to QWINDSRC   *
     F*  082485 - Shadow posting records were being generated for     *
     F*           charges for Regular Payments. Amended pgm to not    *
     F*           generate shadow postings if payment type is 'RP'.   *
     F*  081699 - Set up charges currency correctly on screen -       *
     F*           should check #1CDRO instead of S5CDRO which is      *
     F*           blank.                                              *
     F*  S01508 - BLI Extended Payment Charges                        *
     F*  S01506 - BLI Payment Charges Enhancements                    *
     F*  S01499 - BLI V.A.T. Processing                               *
     F*         - Add V.A.T. amount to the charges (TEMP25)           *
     F*  S01494 - BLI Funds Transfer Enhancements                     *
     F*  068347 - Suppress Account movement duplicates.               *
     F*  068320 - Allow for Charge Movements                          *
     F*  S01435 - Incoming Message Management                         *
     F*                                                               *
     F*****************************************************************
     F*EDTRCD: Cpysrc Templates Initialise Program F-spec
     F/COPY WNCPYSRC,FT0345DFPG
     FFT0345DFCF  E                    WORKSTN
     F                                              KINFDS INFDS#
     F                                              KINFSR SRFILE
      * DSP: FT Outgoing Payments Level 1
      *
     FOTPAYL1 IF  E           K        DISK
     F                                              KINFDS INFDS1
     F                                              KINFSR SRFILE
     F            OTPAYDDF                          KRENAME@OTPAYL1
      * RTV : FT Outgoing Payments      Retrieval index
      *
     FOTPAYL0 UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFSR SRFILE
     F            OTPAYDDF                          KRENAME@OTPAYL0
      * UPD : FT Outgoing Payments      Update index
      *
      ** Outgoing payment extension file (retrieve)                       CFT014
     FOTPAYXL0IF  E           K        DISK                               CFT014
     F                                              KINFSR SRFILE         CFT014
     F                                              KCOMIT                CFT009
     F            OTPAYXDF                          KRENAMEOPAYXL0        CFT014
      *                                                                   CFT014
      ** Outgoing payment extension file (update)                         CFT014
     FOTPAYXL2UF  E           K        DISK                               CFT014
     F                                              KCOMIT                CFT014
     F                                              KINFSR SRFILE         CFT014
     F            @OPYXL2                           KRENAMEOPAYXL2        CFT014
      *                                                                   CFT014
     FPYCHGDB IF  E           K        DISK         KINFSR SRFILE
      *                                                                   CFT009
      ** Payment Charge defintion file                                    CFT009
     FFTPCHGL0IF  E           K        DISK         KINFSR SRFILE         CFT009
      *
      * RSQ : Payment and charges details
      *
     FMEISOCL1IF  E           K        DISK                                                   CFT017
      ** Midas ME SWIFT ISO Country Codes retrieval index                                     CFT017
      *                                                                                       CFT017
     F*                                                                   S01408
     F/COPY WNCPYSRC,FT0345FFP1                                           S01408
     F*                                                                   S01408
     E/EJECT
     E                    DESC    1   5 30                                CFT009
     E                    CPY@    1   1 80
     E                    FCTR    1   4  4 0             FACTORS TABLE    CFT009
     E*
     E*  Array containing Copyright statement
     E***************** FIRST COMPILE TIME ARRAY *********************
     E*
      *
      *  Error Codes Output
      *
     E                    ERCD       38  4               Codes
      *
      *  Amount change array
      *
     E                    YA1        15  1
     E                    FLDQ       10  1                                CFT009
      *                                                                                       CSC022
      ** Array to hold commitment jobs name                                                   CSC022
     E                    CMTJOB     10 10                                                    CSC022
      *
     E/COPY FTCPYSRC,SRERRE
     E*
     E*  Copysource for error processing
     E*
     E*EDTRCD: Cpysrc Templates Initialise Program E-spec
     E/COPY WNCPYSRC,FT0345DEPG
      /EJECT
     IPYCHGDDF
     I              RECI                            PYRECI
     I              CQCH                            PYCQCH
     I              CQCHD                           PYCQCD
     I              SPCH                            PYSPCH
     I              SPCHD                           PYSPCD
     I              LCD                             PYLCD
     I              CHTP                            PYCHTP
     I              LCHT                            PYLCHT
     I/COPY WNCPYSRC,FT0345I007
     I/COPY FTCPYSRC,SRERRI
     I*
     I*  End of Program Error Processing copysource
     I*
     I*
     I*EDTRCD: Cpysrc Templates Initialise Program I-spec
     I/COPY FTCPYSRC,FT0010I001                                           CFT014
     I/COPY WNCPYSRC,FT0345DIPG
      /EJECT
      * Data structures:
     I*                                                                   S01499
     I** V.A.T. rate                                                      S01499
     I*                                                                   S01499
     IVATDS       DS                                                      S01499
     I                                        1   3 I#BRCA                S01499
     I                                        4   9 I#CUST                S01499
     I                                    P  10  124O#VATR                S01499
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSOTPAYDD
      * UPD : FT Outgoing Payments      Update index
      * Current/previous master file format fields for change control
      *
      * NOTE FIELD #1DBRC MUST SAME LENGTH AS @1DBRC
      *
     I***#1DBRC******DS***********************    2054                    S01494
     I***#1DBRC******DS                           2106             S01494 CAC001
     I***#1DBRC******DS                           2120             CAC001 CEU006
     I***#1DBRC******DS                           2140             CEU006 183723
     I***#1DBRC*     DS                           2218                                 183723 CSW206
     I#1DBRC      DS                           2254                                           CSW206
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     IRUNDTA    E DSRUNDAT
      *
      * Get Rundate - Rundate  *
      *
     IZMUSER    E DSZMUSER
      *
      **  Data structure to retrieve default branch
      *
     ISDMMOD    E DSSDMMODPD
      *
      * Modules Data Structure *
      *
     ISDBRCH    E DSSDBRCHPD
      *
      * Branch Data Structure *
      *
     ISDCURR    E DSSDCURRPD
      *
      * Currency details      *
      *
     ISDBANK    E DSSDBANKPD
      *
      * Bank details Structure *
      *
     ISDGELR    E DSSDGELRPD
      *
      * General Ledger Details *
      *
     ISDFTFR    E DSSDFTFRPD
      *
      * Funds Transfer Details *
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          QQACD1                                    CGL029
      *
      * Retail Details *
      *
     ISDTRAD    E DSSDTRADPD
     I              QQACCD                          QQACD2                                    CGL029
      *
      * Trading Data details
      *
     ISDDLST    E DSSDDLSTPD
      *
      * Deal Sub-types        *
      *
     ISDBOOK    E DSSDBOOKPD
      *
      * Book codes            *
      *
     ISDPRFC    E DSSDPRFCPD
      *
      * Profit Centres        *
      *                                                                   CFT014
     ISDCUST    E DSSDCUSTPD                                              CFT014
     I              QQDFAC                          DFACQQ                                    CGL029
      ** Customer details file                                            CFT014
      *                                                                   CFT014
     ISDNOST    E DSSDNOSTPD                                              CFT014
     I              QQACCD                          QQACD3                                    CGL029
      ** External data structures for Nostro Details                      CFT014
      *                                                                   CFT014
     I**                                                                  S01494
     ISCSARD    E DSSCSARDPD                                              S01494
     I* SAR file details                                                  S01494
     I              LCD                             SCLCD                 S01494
     ISDLOCN    E DSSDLOCNPD                                                                  CFT017
      ** Location code details                                                                CFT017
      *                                                                                       CFT017
     ISDCTRY    E DSSDCTRYPD                                                                  CFT017
      ** Country code details                                                                 CFT017
      *                                                                                       CFT017
     ISDACCT    E DSACCNTAB                                                                   CFT017
      ** Account details                                                                      CFT017
     I              RECI                            WARECI                                    CFT017
     I              BRCA                            WABRCA                                    CFT017
     I              LCD                             WALCD                                     CFT017
     I              PRFC                            WAPRFC                                    CFT017
     I              CHTP                            WACHTP                                    CFT017
     I              FRNT                            WAFRNT                                    CFT017
     I              REPA                            WAREPA                                    CFT017
     I              TMST                            WATMST                                    CFT017
      *                                                                                       CFT017
     ISDCNST    E DSSDCNSTPD                                                                  CFT017
      ** Counterparty details                                                                 CFT017
      *                                                                                       CFT017
     IMEBICD    E DSMEBICDPD                                                                  CFT017
      ** BIC details                                                                          CFT017
      *                                                                                       219241
     ISDMGME    E DSSDMGMEPD                                                                  219241
      ** External Data structure for Message Management ICD.                                  219241
      *                                                                   CFT009
      *  Transaction details file parameter for FT000652                  CFT009
      *                                                                   CFT009
     ITRNDET      DS                           3000                       CFT009
      *                                                                   CFT009
      *  Transaction details extension file parameter for FT000652        CFT009
      *                                                                   CFT009
     ITRNEXT      DS                           3000                       CFT009
      *                                                                   CFT009
      *  Outgoing Payments Details Extension data structure               CFT009
      *                                                                   CFT009
     IOTPXDS    E DSOTPAYXPD                                              CFT009
      *
     IINLF      E DSMEINLFPD
     IACCINF    E DSACCNTAB                                                                   199657
     I              RECI                            IFRECI                                    199657
     I              CNUM                            IFCNUM                                    199657
     I              CCY                             IFCCY                                     199657
     I              ACODQQ                          QQACOD                                    CGL029
     I              ACOD                            IFACOD                                    199657
     I              ACSQ                            IFACSQ                                    199657
     I              ZZ006                           IFZZ06                                    199657
     I              BRCA                            IFBRCA                                    199657
     I              ATYP                            IFATYP                                    199657
     I              STYP                            IFSTYP                                    199657
     I              MFFQ                            IFMFFQ                                    199657
     I              ACST                            IFACST                                    199657
     I              DACO                            IFDACO                                    199657
     I              DACC                            IFDACC                                    199657
     I              ANAM                            IFANAM                                    199657
     I              LDBL                            IFLDBL                                    199657
     I              CLBL                            IFCLBL                                    199657
     I              STFQ                            IFSTFQ                                    199657
     I              STDY                            IFSTDY                                    199657
     I              LSTD                            IFLSTD                                    199657
     I              NSTD                            IFNSTD                                    199657
     I              LSTP                            IFLSTP                                    199657
     I              CFSB                            IFCFSB                                    199657
     I              LMVD                            IFLMVD                                    199657
     I              EPLB                            IFEPLB                                    199657
     I              EPCB                            IFEPCB                                    199657
     I              YTDB                            IFYTDB                                    199657
     I              GLBT                            IFGLBT                                    199657
     I              ADREF1                          IFARF1                                    199657
     I              PRFC                            IFPRFC                                    199657
     I              ZZ004                           IFZZ04                                    199657
     I              ORED                            IFORED                                    199657
     I              DLIM                            IFDLIM                                    199657
     I              LRCR                            IFLRCR                                    199657
     I              RTCB                            IFRTCB                                    199657
     I              RTLB                            IFRTLB                                    199657
     I              DITM                            IFDITM                                    199657
     I              CITM                            IFCITM                                    199657
     I              ADREF2                          IFREF2                                    199657
     I              ZZ002                           IFZZ02                                    199657
     I              CDIR                            IFCDIR                                    199657
     I              CCIR                            IFCCIR                                    199657
     I              ACNO                            IFACNO                                    199657
     I              RETB                            IFRETB                                    199657
     I              ODSC                            IFODSC                                    199657
     I              ODLN                            IFODLN                                    199657
     I              ODED                            IFODED                                    199657
     I              DIOD                            IFDIOD                                    199657
     I              FACT                            IFFACT                                    199657
     I              FCNO                            IFFCNO                                    199657
     I              EFAC                            IFEFAC                                    199657
     I              HELD                            IFHELD                                    199657
     I              MINB                            IFMINB                                    199657
     I              LACD                            IFLACD                                    199657
     I              LISP                            IFLISP                                    199657
     I              RRNM                            IFRRNM                                    199657
     I              DRIB                            IFDRIB                                    199657
     I              DRIS                            IFDRIS                                    199657
     I              DRCD                            IFDRCD                                    199657
     I              DRIC                            IFDRIC                                    199657
     I              DRIF                            IFDRIF                                    199657
     I              DRDY                            IFDRDY                                    199657
     I              NDID                            IFNDID                                    199657
     I              LDID                            IFLDID                                    199657
     I              LDIA                            IFLDIA                                    199657
     I              SDAP                            IFSDAP                                    199657
     I              LPAR                            IFLPAR                                    199657
     I              DIIE                            IFDIIE                                    199657
     I              DAIC                            IFDAIC                                    199657
     I              MADI                            IFMADI                                    199657
     I              GADI                            IFGADI                                    199657
     I              DDIS                            IFDDIS                                    199657
     I              DDIA                            IFDDIA                                    199657
     I              OLDR                            IFOLDR                                    199657
     I              OLDB                            IFOLDB                                    199657
     I              OLDS                            IFOLDS                                    199657
     I              CRIB                            IFCRIB                                    199657
     I              CRIS                            IFCRIS                                    199657
     I              CRCD                            IFCRCD                                    199657
     I              CRIC                            IFCRIC                                    199657
     I              CRIF                            IFCRIF                                    199657
     I              CRDY                            IFCRDY                                    199657
     I              NCID                            IFNCID                                    199657
     I              LCID                            IFLCID                                    199657
     I              LCIA                            IFLCIA                                    199657
     I              SCAP                            IFSCAP                                    199657
     I              LPAP                            IFLPAP                                    199657
     I              CIIE                            IFCIIE                                    199657
     I              CAIC                            IFCAIC                                    199657
     I              MACI                            IFMACI                                    199657
     I              GACI                            IFGACI                                    199657
     I              CDIS                            IFCDIS                                    199657
     I              DCIA                            IFDCIA                                    199657
     I              OLCR                            IFOLCR                                    199657
     I              OLCB                            IFOLCB                                    199657
     I              OLCS                            IFOLCS                                    199657
     I              LCD                             IFLCD                                     199657
     I              CHTP                            IFCHTP                                    199657
     I              TNLU                            IFTNLU                                    199657
     I              BRTCA                           IFBRTA                                    199657
     I              NACSG                           IFNACG                                    199657
     I              R4ACNT                          IFR4AC                                    199657
     I              ENOC                            IFENOC                                    199657
     I              EPNO                            IFEPNO                                    199657
     I              ECFB                            IFECFB                                    199657
     I              LTAB                            IFLTAB                                    199657
     I              LTACQQ                          QQLTAC                                    CGL029
     I              LTAC                            IFLTAC                                    199657
     I              LTAS                            IFLTAS                                    199657
     I              HCFB                            IFHCFB                                    199657
     I              PTFR                            IFPTFR                                    199657
     I              HLEX                            IFHLEX                                    199657
     I              A5TIAC                          IFA5TA                                    199657
     I              A5TIAN                          IFA5TN                                    199657
     I              A5TIAS                          IFA5TS                                    199657
     I              EUSB                            IFEUSB                                    199657
     I              FRNT                            IFFRNT                                    199657
     I              AFRT                            IFAFRT                                    199657
     I              REPA                            IFREPA                                    199657
     I              TMST                            IFTMST                                    199657
     I              REPI                            IFREPI                                    199657
     I              IBAN                            IFIBAN                                    199657
     I              IBSEQN                          IFSEQN                                    199657
     I              FCCU                            IFFCCU                                    CLE025
     I              COLF                            IFCOLF                                    CLE025
     I              BCOA                            IFBCOA                                    CLE025
     I              COLA                            IFCOLA                                    CLE025
     I              PFCU                            IFPFCU                                    CLE025
     I              PFTP                            IFPFTP                                    CLE025
     I              PFSQ                            IFPFSQ                                    CLE025
     I              A5ACKY                          IFACKY                                    CTI004
     I              A5INTL                          IFINTL                                    CTI004
     I              A5TIAB                          IFTIAB                                    CTI004
     I              AUTH                            IFAUTH                                    CER001
     I              K24C                            IFK24C                                    CER047
     I              ACEFDT                          IFEFDT                                    CRE075
     I              DCSP                            IFDCSP                                    CER049
     I              DCSG                            IFDCSG                                    CER049
     I              DRMT                            IFDRMT                                    CER049
     I              DRFD                            IFDRFD                                    CER049
     I              CCSP                            IFCCSP                                    CER049
     I              CCSG                            IFCCSG                                    CER049
     I              CRMT                            IFCRMT                                    CER049
     I              CRFD                            IFCRFD                                    CER049
      *
     IW0DATA      DS                            256
      *
      *  Define data structure used to pass parameters
      *
     I                                        1   3 B#BRCA
     I                                        4   4 O#ACTD
     I                                        5  14 O#CPGM
      *
      * Define parameters to be passed for FT IMM update
      *
     IT#CNTL      DS                            256
      *
      *  Input parameters data structure from FT0005
      *
     I                                        1   1 T#PDTI
     I                                        2   3 T#CCYI
     I                                        4   4 T#GLUI
     I                                        5   5 T#TPCI
     I*                                                                   S01499
     I** Apply V.A.T. flag indicator                                      S01499
     I*                                                                   S01499
     I                                        6   6 T#VATT                S01499
      *
     IQ#DTA       DS                            256
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     I                                        1   1 Q#ATYP
     I**********                              2  19 Q#ACCT                                    CGL029
     I**********                              2   70Q#CNU1                                    CSD027
     I                                        2   7 Q#CNU1                                    CSD027
     I                                        8  10 Q#CCY1
     I**********                             11  140Q#ACO1                                    CGL029
     I                                       15  160Q#ACS1
     I                                       17  19 Q#BRC1
     I                                        2   30Q#NOSN
     I                                        2   6 Q#NOS
     I                                        2  110Q#ACNO
     I**********                              2   70Q#CNUM                                    CSD027
     I                                        2   7 Q#CNUM                                    CSD027
     I**********                              8  110Q#ACOD                                    CGL029
     I                                       12  130Q#ACSQ
     I                                       14  16 Q#BRCA
     I                                       24  24 Q#IO
     I                                       25  27 Q#CCY
     I                                       28  29 Q#TRYP
     I                                       30  59 Q#NARR
     I                                       60  670Q#CHQN
     I                                       68  82 Q#PREF
     I                                       83  88 Q#TRN
     I                                    P  89  960Q#AMT
     I                                       97  97 Q#PRON
     I                                       98  98 Q#OLPS
     I                                       99  99 Q#MEMS
     I                                      100 100 Q#RSAC
     I                                      101 102 Q#MOD
     I                                      103 104 Q#OLRC
     I                                      105 105 Q#FTOV
     I                                    P 106 1080Q#VDAT
     I                                    P 109 1110Q#PSTD
     I                                      112 112 Q#PSTO
     I                                      113 113 Q#RPST                068347
     I                                      114 1160Q#RPNB                068347
     I                                      117 117 Q#RTYP                068347
     I                                      118 120 Q#BBRN                                    CGL029
     I                                      121 1300Q#ACO1                                    CGL029
     I                                      131 1400Q#ACOD                                    CGL029
     I                                      141 160 Q#OTR1                                    CAP204
     I                                      161 161 Q#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 Q#XRFI                                    CLE134
     I                                      165 1740Q#XRFN                                    CLE134
     I/COPY WNCPYSRC,FT0345I010
      *
     I            DS
      *  Currency, amounts and rates
     I                                        1  48 R#RCHK
     I                                        1   3 R#SMCY
     I                                        4   6 R#PCCY
     I                                        7  190R#SMAM
     I                                       20  320R#PYAM
     I                                       33  458R#RATE
     I                                       46  46 R#OVRD
     I                                       47  48 R#STMT
      *
     I/COPY MECPYSRC,SME1100P
     ISWDT2       DS                              6
      *
      *  Data structure for date change
      *
     I                                        1   2 DD
     I                                        3   4 MM
     I                                        5   6 YY
      *
     I/COPY FTCPYSRC,SFT0345S5
     I/COPY FTCPYSRC,SFT0345F5
     I/COPY FTCPYSRC,SFT0345I5
     I/COPY FTCPYSRC,SFT0345S6
     I/COPY FTCPYSRC,SFT0345F6
     I/COPY FTCPYSRC,SFT0345I6
     I/COPY FTCPYSRC,SFT0345S7                                            CFT014
     I/COPY FTCPYSRC,SFT0345F7                                            CFT014
     I/COPY FTCPYSRC,SFT0345I7                                            CFT014
     I/COPY FTCPYSRC,SFT0340F                                                               BUG26775
     I/COPY FTCPYSRC,SFT0340S                                                               BUG26775
      *
     I/COPY WNCPYSRC,FT0345I006
     E/COPY FTCPYSRC,SFTVALDI
     E/COPY WNCPYSRC,FT0345E001
      *
     IDSFDY     E DSDSFDY
      *
      * Data Structures used by Access Programs
      *
     IDSSDY     E DSDSSDY
      *
      * Data Structures used by Access Programs
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : MAP Action Code
     I                                        1   1 P1ACTC
     IP2PARM      DS                             15
      * I : MAP FT Payment Reference
     I                                        1  15 P2PREF
      * I : MAP Message Management Reference
     I                                        1   80P2MSGR
      * I : MAP Message Management Part
     I                                        9  110P2KPRT
     IP3PARM      DS                             64
      * I : MAP Link processing
     I                                        1   1 P3LINK
     I/COPY WNCPYSRC,FT0345I008
     IP4PARM      DS                             14                       CAC001
     I/COPY WNCPYSRC,FT0345I009
      * I : MAP Margin Info Processing                                    CAC001
     I                                    P   1   42P4FXMP                CAC001
     I                                        5   50P4FXMD                CAC001
     I                                        6   6 P4MBSI                CAC001
     I                                        7   7 P4MSIG                CAC001
     I                                    P   8  140P4MAMT                CAC001
     I/COPY WNCPYSRC,FT0345I005
      *                                                                   CAC001
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Invalid Action code (FT)'
      * Action Code
     I                                        1   1 ZA0001
      *
     C/COPY FTCPYSRC,SFTADDRI
      *
      * Address data structure
      *
     IDSMTR       DS
      *
      *  Define fields for message transalation
      *
     I                                        1 132 #MSDTA
     I                                       15  30 #MPREF
     I                                    P   1   20#MPART
     I                                      133 264 #MSTX1
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
      /EJECT
     IW8FT        DS                            128
      *
      * Address data structure
      *
      * Currency
     I                                        1   3 W8CCY
      * Settlement Type
     I                                        4   5 W8STMT
      * Mandatory Text - convert BIC identifiers
     I                                        6   6 W8MTXT
      * Message Tag
     I                                        7  11 W8MTAG
      * Construct of data in field
     I                                       12  12 W8TYPE
      * Number of Lines available
     I                                       13  140W8NLIN
      * Network and Message Type
     I                                       15  20 W8NWRK
     I                                       21  23 W8MTPY
      * Calling Program
     I                                       24  33 W8CPGM
      * Action *PRINT/*ENQ/*MSG GEN
     I                                       34  41 W8ACT
      * Critical reporting - Database error if 'Y'
      * If no BIC directory and BIC entered no error
     I                                       42  42 W8CRIT
      * Force Midas Address - where possible
     I                                       43  43 W8MADD
      * If Retail get first address from account
     I                                       44  44 W8RTAD
      * Alternative Address
     I                                       45  45 W8ALTN
      * Address type selected in W0MSG
     I                                       46  46 W8ADTP
      *
     I***W7DATA******DS***********************     256                    S01506
     I****W7DATA******DS                            310            S01506 CEU006
     I/COPY WNCPYSRC,FT0345I001
     I*****W7DATA      DS                            321            CEU006CFT009
     IW7DATA      DS                            399                       CFT009
     I/COPY WNCPYSRC,FT0345I002
      *
      * Payment type and subtype
     I                                        1   2 W7PYTP
     I                                        3   4 W7PYST
      *
      * Input currency and charge currency
     I                                        5   7 W7ICCY
     I                                        8  10 W7CCCY
      *
      * Settlement method
     I                                       11  12 W7STMT
      *
      * Defaults required
     I                                       13  13 W7DFRQ
      *
      * Charges branch
     I                                       14  16 W7BRCA
      *
      * Charge currency amount
     I                                       17  290W7CAMT
      *
      * Transfer Commission type
     I                                       30  30 W7TRCT
      *
      * SWIFT priority code
     I                                       31  31 W7SWPC
      *
      * Transfer Commission amount
     I                                       32  420W7TRCD
     I                                       43  530W7TRCH
      *
      * Telex charge
     I                                       54  640W7TXCD
     I                                       65  750W7TXCH
      *
      * Cheque Charge
     I                                       76  860W7CQCD
     I                                       87  970W7CQCH
      *
      * Costs Abroad
     I                                       98 1080W7CSTD
     I                                      109 1190W7CSTA
      *
      * SWIFT Priority Charge
     I                                      120 1300W7SPCD
     I                                      131 1410W7SPCH
      *
      * Miscellaneous charge
     I                                      142 1520W7MSCD
     I                                      153 1630W7MSCH
      *
      * Advice Charge
     I                                      164 1740W7ADCD
     I                                      175 1850W7ADCH
      *
      * Telephone Charge
     I                                      186 1960W7TLCD
     I                                      197 2070W7TLCH
      *
      * Collection Charge
     I                                      208 2180W7COLD
     I                                      219 2290W7COLL
      *
      * Payment amount currency
     I                                      230 232 W7PCCY
     I*                                                                   S01506
     I** Other currency                                                   S01506
     I                                      233 235 W7OCCY                S01506
     I*                                                                   S01506
     I** FX/Change commission (input ccy)                                 S01506
     I                                      236 2460W7CHCD                S01506
     I*                                                                   S01506
     I** FX/Change commission (charge ccy)                                S01506
     I                                      247 2570W7CHCM                S01506
     I*                                                                   S01506
     I** Our deductions (input ccy)                                       S01506
     I                                      258 2680W7DEDD                S01506
     I*                                                                   S01506
     I** Our deductions (charge ccy)                                      S01506
     I                                      269 2790W7DEDS                S01506
     I*                                                                   S01506
     I** Correspondent charge (input ccy)                                 S01506
     I                                      280 2900W7COCD                S01506
     I*                                                                   S01506
     I** Correspondent charge (charge ccy)                                S01506
     I                                      291 3010W7COCH                S01506
     I*                                                                   S01506
     I** Default type (HDR or DET or " ")                                 S01506
     I                                      302 304 W7DFTT                S01506
     I*                                                                   S01506
     I** Customer to be debited the charge                                S01506
     I                                      305 310 W7CUST                S01506
     I** Settle Date                                                      CEU006
     I                                      311 3150W7SLDT                CEU006
     I** Pay Date                                                         CEU006
     I                                      316 3200W7PVDT                CEU006
     I** Add/Deduct Charges                                               CEU006
     I                                      321 321 W7ADDC                CEU006
     I** CFT009 Additional charges                                        CFT009
     I                                      322 3340W7STCH                CFT009
     I                                      335 3470W7M1CH                CFT009
     I                                      348 3600W7M2CH                CFT009
     I                                      361 3730W7M3CH                CFT009
     I                                      374 3860W7M4CH                CFT009
     I                                      387 3990W7M5CH                CFT009
      *                                                                   CFT009
     I/COPY WNCPYSRC,FT0345I003
     I*                                                                   S01506
     IW0DTA       DS                            256                       S01506
     I*                                                                   S01506
     I** Calling parameter data structure                                 S01506
     I*                                                                   S01506
     I                                        1   1 I#PT1                 S01506
     I                                        2  36 I#PTY1                S01506
     I                                       37  37 I#PT2                 S01506
     I                                       38  72 I#PTY2                S01506
     I                                       73  75 I#CCY                 S01506
     I                                       76  81 O#CUST                S01506
      /EJECT
      *
      * Data to be passed to window processing
      *
     I*****/COPY WNCPYSRC,FT0345WDTA                                      CPK001
      *                                                                   CAC001
     IEXTRA       DS                            256                       CAC001
      * Define the data structure to pass data to WN0010 and return pgm   CAC001
      *                                                                   CAC001
     I                                        1   1 WACTN                 CAC001
     I                                    P   2   88WRATE                 CAC001
     I                                        9   9 WPSIN                 CAC001
     I                                       10  12 WPCCY                 CAC001
     I                                       13  15 WSMCY                 CAC001
     I                                    P  16  220WPYAM                 CAC001
     I                                    P  23  290WSMAM                 CAC001
     I                                       30  300WMDIN                 CAC001
     I                                    P  31  342WFXMP                 CAC001
     I                                       35  350WFXMD                 CAC001
     I                                       36  36 WMBSI                 CAC001
     I                                       37  37 WMSIG                 CAC001
     I                                    P  38  440WMAMT                 CAC001
     I                                       45  45 WFRCI                 CAC001
     I/COPY QWINDSRC,FT0345WDTA                                           CPK001
     I                                        1  15 PREF1                                     CER001
      *                                                                   CFT007
     I@OADD       DS                            175                       CFT007
      * Output Data Structure for BIC reformatted address                 CFT007
     I                                        1  35 OADD1                 CFT007
     I                                       36  70 OADD2                 CFT007
     I                                       71 105 OADD3                 CFT007
     I                                      106 140 OADD4                 CFT007
     I                                      141 175 OADD5                 CFT007
      *                                                                   CFT007
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      ** Commitment Control dataarea                                                          CSC022
      *                                                                                       CSC022
     IP@ACCN      DS                                                                          CFT032
     I                                        2   7 P@CNUM                                    CFT032
     I                                      554 563 P@ACOD                                    CFT032
     I                                       15  16 P@ACSQ                                    CFT032
     I                                       23  25 P@BRCA                                    CFT032
     I/COPY WNCPYSRC,FT0345I004
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C***********P1ACTC    PARM           WP0001  1        Action Code    096486
     C           P1ACTC    PARM P1ACTC    WP0001  1        Action Code    096486
     C                     PARM           P2PARM           Reference
     C                     PARM           P3PARM           Other data
     C                     PARM           P4PARM           Margin Info    CAC001
     C                     PARM           FLAG12  1        F12 pressed    CFT009
     C/COPY WNCPYSRC,FT0345C001
      *
      *  Set up primary reference
      *
     C                     MOVELP2PARM    W0PREF
     C/COPY WNCPYSRC,FT0345C035
      *****************************************************************
     C*                                                                   096486
     C**  Restore back correct action code if triggered through A/C       096486
     C**  Movements (GL4442).                                             096486
     C*                                                                   096486
     C                     MOVE *BLANK    @GL442  1                       096486
     C           P1ACTC    IFEQ 'G'                                       096486
     C                     MOVE 'Y'       @GL442                          096486
     C                     MOVE 'E'       P1ACTC                          096486
     C                     ENDIF                                          096486
      *
      *  Set up subroutine stack name
      *
     C                     Z-ADD1         Q
     C                     MOVEL*BLANKS   @STK
     C                     MOVEL'MAIN  '  @STK,Q
      *
      * Initialise
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP6                                           S01408
     C*                                                                   S01408
     C           *IN81     IFEQ '0'
     C                     EXSR ZZINIT
     C                     END
      *
      * Check passed parameters
      *
     C                     EXSR FACKPM
      *                                                                                       CSC022
      ** Check if CSC022 is switched ON.                                                      CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD   6                                           CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL'N'       CMTSKP  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C           @RTCD     IFNE '*NRF '                                                       CSC022
     C           *LOCK     IN   LDA                                                           CSC022
     C                     SETON                       U7U8                                   CSC022
     C                     Z-ADD5         DBASE                                               CSC022
     C                     MOVEL'SCSARDPD'DBFILE                                              CSC022
     C                     MOVEL'CSC022'  DBKEY                                               CSC022
     C                     OUT  LDA                                                           CSC022
     C                     EXSR SRERR                                                         CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      * Perform once if all passed, else repeat
      *
     C           W0RPT     DOUEQ'N'
      *
      * Display and process key screen
      *
     C                     EXSR BADSKY
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *
      * Terminate program
      *
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BADSKY'  @STK,Q
      *
      * Initialise key screen
      *
     C                     EXSR MDIZ#K
      *
      * Bypass first display of key screen if possible
      *
     C           P1ACTC    IFNE *BLANKS
     C                     MOVEL'Y'       W0BYP   1
     C                     ELSE
     C                     MOVEL'N'       W0BYP
     C                     END
      *
      * Signal start of transaction
      *
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      *
      * Ensure transaction continues (if reset)
      *
     C                     MOVEL'Y'       W0TRN   1
      *
      * Initialise detail screen
      *
     C                     EXSR MAIZ#1
      *
      * Conduct screen conversation
      *
     C           W0TRN     DOWEQ'Y'
      *
      * Is bypass key screen still viable?
      *
     C           W0BYP     IFEQ 'Y'
     C           P2PARM    IFEQ *BLANKS
      *
      * One or more key fields is blank
      *
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      *
      * Bypass key screen
      *
     C           W0BYP     IFNE 'Y'
      *
      * Display key screen
      *
     C                     EXSR BBEXFM
     C                     END
      *
      * Cancel key screen bypass
      *
     C                     MOVEL'N'       W0BYP
      *
      * Process response to key screen
      * Cancel & exit program
      *
     C   03                CAS            ZXEXPG
     C   07                CAS            ZXEXPG
     C   12                CAS            ZXEXPG
      *
      * HOME: Reset screen fields
      *
     C   05                CAS            BDHMKY
      *
      * Process key screen input
      *
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BBEXFM'  @STK,Q
      *
      * Set screen conditioning indicators
      *
     C                     EXSR GADSAK
      *
      * Update screen time
      *
     C                     TIME           ##TME
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
      *
      * PUTOVR unless conditioned fields change
      *
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      *
      * Update job time
      *
     C                     TIME           ##JTM
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
      *
      * Reset global error indicator and clear error codes
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X
     C                     SETOF                         99*
      *                                                                   CAC001
      ** If Analytical Accounting is installed, initialise margin         CAC001
      ** info work fields.                                                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADD*ZEROS    WOFXMP  72                      CAC001
     C                     Z-ADD*ZEROS    WOFXMD  10                      CAC001
     C                     MOVE *BLANKS   WOMBSI  1                       CAC001
     C                     MOVE *BLANKS   WOMSIG  1                       CAC001
     C                     Z-ADD*ZEROS    WOMAMT 130                      CAC001
     C                     ENDIF                                          CAC001
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BBEXFM'  @STK,Q
      *
     C                     MOVEL'N'       W0TRN
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BEPRKY'  @STK,Q
      *
      * Validate key fields
      *
     C                     EXSR BFVLKY
      *
     C           *IN99     CABEQ'1'       BEEXIT
      *
      * If insert mode change W0PMD
      *
     C           #1ACTC    IFEQ 'I'
      *
      *
      * Load screen fields from DBF
      *
     C                     EXSR MBFL#1
      *
      * USER: Initialise detail screen (new record)
      * EDTRCD: Init. det. scr NW - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Dtl New Rcd
     C/COPY WNCPYSRC,FT0345DISN
      *
     C                     ELSE
      *
     C                     MOVEL'1'       *IN73
      *
      * If record does exist, flip to change mode
      *
     C                     MOVEL'CHG'     W0PMD   3
      *
      * CALC: Detail screen function fields
      * EDTRCD: Detail scrn funcs - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Calc Detail Function Flds
     C/COPY WNCPYSRC,FT0345DSFF
      *
      * Load screen fields from DBF
      *
     C                     EXSR MBFL#1
      * USER: Initialise detail screen (existing record)
      * EDTRCD: Init. det. scr EX - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Dtl Exist Rcd
     C/COPY WNCPYSRC,FT0345DISE
     C                     END
      *..................................................
     C   99                GOTO BEEXIT
      *
      * Clear Warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      * Re-send screen indicator
     C                     MOVEL*BLANKS   E#RSND
      *
      * No error: Display and process details
      *
     C                     EXSR CADSDA
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BFVLKY'  @STK,Q
      *
      * Action code must be I, A, D or E
      *
     C           #1ACTC    IFNE 'I'
     C           #1ACTC    ANDNE'A'
     C           #1ACTC    ANDNE'E'
     C                     SETON                     9931  *
     C                     MOVEL'FTM2175' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO BFEXIT
     C                     END
      *
      * Payment reference must exist
      *
     C                     EXSR VBCKRL
      *
      * If error exit
      *
     C           *IN99     IFEQ '1'
     C                     GOTO BFEXIT
     C                     END
      *
      * USER: Validate key screen
      * EDTRCD: Valid key screen - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Key Screen
     C/COPY WNCPYSRC,FT0345DVKS
      *
      * Check branch SPF action
      *
     C                     EXSR VDCKRL
      *
      * If error exit
      *
     C           *IN99     IFEQ '1'
     C                     GOTO BFEXIT
     C                     END
      *
      * If not a linked function and not enquire
      * allocate payment reference
      *
     C           P2PREF    IFNE *BLANKS
     C           #1ACTC    ANDNE'E'
      *
     C                     CALL 'AOC8000'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM 'FT'      P@MODI  2
     C                     PARM #1PREF    P@PREF 15
     C                     PARM *BLANKS   P@D80  80
      *
      *  If 'IN USE' then redisplay subfile with error message
      *  for record lock
      *
     C           P@RTCD    IFEQ '*IN USE'
     C                     SETON                     9932  *
     C                     MOVEL'FTM2181' ZAMSID
     C                     MOVELP@D80     ZAMSDA
     C                     EXSR ZASNMS
     C                     GOTO BFEXIT
     C                     END
      *                                                                   CFT009
      *  Need to also look for *ERROR in return code as well as           CFT009
      *  *IN USE                                                          CFT009
      *                                                                   CFT009
     C           P@RTCD    IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'AOC8000 'W0FILE           ***************CFT009
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 03 *CFT009
     C                     Z-ADD3         W0ERNB           ***************CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *
     C                     END
     C/COPY WNCPYSRC,FT0345C060
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CADSDA'  @STK,Q
      *                                                                   CFT014
      ** Find out if there is a MT103 bilateral agreement exists bet      CFT014
      ** ween the booking branch and the receiver only when CFT014 is     CFT014
      ** setup.                                                           CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           P1ACTC    IFEQ 'I'                                       CFT014
     C           P1ACTC    OREQ 'A'                                       CFT014
     C           #1ACTC    OREQ 'I'                                       CFT014
     C           #1ACTC    OREQ 'A'                                       CFT014
     C                     MOVE *BLANK    V#M103                          CFT014
     C                     EXSR SRB103                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
     C                     MOVEL'SCR1'    ##SCR   4
      *
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
      *
     C           W0TRN     DOWEQ'Y'
      *
      * Display detail screen
      *
     C                     EXSR CBEXFM
      *                                                                   CAC001
      **  Initialise force indicator                                      CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
      *
      * Process response to detail screen
      * Cancel & exit program
      *
     C   03                CAS            ZXEXPG
     C   07                CAS            ZXEXPG
      *
      * Redisplay previous screen
      *
     C   12                CAS            CCDSPV
      *
      * HOME: Reset screen fields
      *
     C   05                CAS            CCDSPV
      *                                                                   CAC001
      * F19 pressed. Process call to margin info window.                  CAC001
      *                                                                   CAC001
     C   KT                CAS            SRMGIN                          CAC001
      *                                                                   CFT007
     C* F4 or F16 pressed. BIC Database Plus processing                   CFT007
      *                                                                   CFT007
     C   08                CAS            SRBICP                          CFT007
     C   13                CAS            SRBICP                          CFT007
      *                                                                   CFT007
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP3                                           S01408
     C*                                                                   S01408
      *
      * Process detail screen input
      *
     C                     CAS            CFPRSC
     C                     END
      *
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CBEXFM'  @STK,Q
      *
      * Set screen conditioning indicators
      *
     C                     EXSR GBDSAD
      *
      * Update screen time
      *
     C                     TIME           ##TME
     C                     MOVE *ALL'0'   ##OFF  30
      *                                                                    CFT009
      ** Only reset error inds if there is no error to display.            CFT009
      *                                                                    CFT009
     C           *IN99     IFEQ *OFF                                       CFT009
     C                     MOVEA##OFF     *IN,1
     C                     ENDIF                                           CFT009
      *                                                                    CFT009
      ** Chain to payment charge defintion file to get miscellaneous cd    CFT009
      *                                                                    CFT009
     C           CFT009    IFEQ 'Y'                                        CFT009
     C           ##SCR     ANDEQ'SCR3'                                     CFT009
     C           M1CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M1DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,1    M1DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M2CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M2DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,2    M2DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M3CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M3DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,3    M3DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M4CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M4DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,4    M4DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M5CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M5DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,5    M5DESC                           CFT009
     C                     ENDIF                                           CFT009
      *                                                                    CFT009
     C                     EXSR DCVLDL                                     CFT009
      *                                                                    CFT009
     C                     ENDIF                                           CFT009
      *                                                                    CFT009
     C/COPY WNCPYSRC,FT0345C016
      *
      * PUTOVR unless conditioned fields change
      *
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
      *                                                                   CFT014
      ** Enable F4 & F16 only if BIC Database Plus Integration is on and  CFT014
      ** the screen to be displayed is second screen level2, otherwise    CFT014
      ** disable the function keys.                                       CFT014
      *                                                                   CFT014
     C           CFT007    IFEQ 'CFT007'                                  CFT014
     C           ##SCR     ANDEQ'SCR1'                                    CFT014
     C                     MOVE *ON       *IN85                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVE *OFF      *IN85                           CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0345C004
     C                     WRITE#MSGCTL
     C           ##SCR     IFEQ 'SCR1'
     C                     WRITE#CMDTXT2
     C/COPY WNCPYSRC,FT0345C002
     C                     EXFMT#RCDDTL1
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP2                                           S01408
     C*                                                                   S01408
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
     C                     MOVELWCMDS3    ##CMD2                          CFT014
     C***********          WRITE#CMDTXT3                                  CFT014
     C                     WRITE#CMDTXT2                                  CFT014
     C                     EXFMT#RCDDTL2
     C                     ELSE                                           CFT014
     C           ##SCR     IFEQ 'SCR3'                                    CFT014
     C                     WRITE#CMDTXT3                                  CFT014
     C/COPY WNCPYSRC,FT0345C084
     C                     EXFMT#RCDDTL3                                  CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     END
      *                                                                   CFT009
      * UPDATE SCREEN CURRENCIES                                          CFT009
      *                                                                   CFT009
     C                     EXSR SCNCUR                                    CFT009
      *
      * Update job time
      *
     C                     TIME           ##JTM
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,31
     C/COPY WNCPYSRC,FT0345C046
      *
      * Reset global error indicator
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X
     C                     SETOF                         99*
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CCDSPV'  @STK,Q
      *
      * USER: Process key screen request
      * EDTRCD: Process key req. - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Process Key Screen Rqst
     C/COPY WNCPYSRC,FT0345DPKR
      *                                                                   CFT014
      ** Process command keys as pressed when the active screen is        CFT014
      ** screen3                                                          CFT014
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR3'                                    CFT014
      *                                                                   CFT014
      ** Initialise screen3 fields when command 5 is pressed              CFT014
      *                                                                   CFT014
     C           *IN05     IFEQ *ON                                       CFT014
     C                     EXSR SRISC3                                    CFT014
     C                     GOTO CCEXIT                                    CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT009
      ** Update file info.                                                CFT009
      *                                                                   CFT009
     C                     EXSR SDCHRC                                    CFT009
      *                                                                   CFT014
      ** Command 12 is pressed, go back to screen2                        CFT014
      *                                                                   CFT014
     C           *IN12     IFEQ *ON                                       CFT014
     C                     CLEARE#WARA                                    CFT014
     C                     MOVEL'SCR2'    ##SCR                           CFT014
     C                     MOVE 'Y'       FLAG12                          CFT009
     C                     GOTO CCEXIT                                    CFT014
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       FLAG12                          CFT009
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
     C           ##SCR     IFEQ 'SCR2'
     C           *IN05     IFEQ '1'
     C                     EXSR MEIZ#D
     C                     GOTO CCEXIT
     C                     END
      *
     C           *IN12     IFEQ '1'
     C                     MOVEL*BLANKS   E#WARA
     C                     MOVEL'SCR1'    ##SCR
     C                     GOTO CCEXIT
     C                     END
     C                     END
      *
     C           *IN05     IFEQ '1'
     C                     MOVEL'R'       W0TRN
     C                     END
      *
      * If not linked go to key screen else exit
      *
     C           *IN12     IFEQ '1'
     C           P3LINK    IFEQ 'Y'
     C           P2PREF    ORNE *BLANKS
     C                     EXSR ZXEXPG
     C                     ELSE
     C                     MOVEL'K'       W0TRN
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CCEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CFPRSC'  @STK,Q
      *
      * Confirm/update is not deferred
      *
     C                     MOVEL'N'       W0DCF   1
      *
      * If delete is not pending....
      * Validate details
      *
     C           #1ACTC    IFEQ 'I'
     C           #1ACTC    OREQ 'A'
     C  N10                CAS            DCVLDL
     C                     END
     C                     END
      *
      *  Call window processing
      *
     C           *IN99     IFEQ '0'
     C           W0DCF     ANDNE'Y'
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP1                                           S01408
     C*                                                                   S01408
     C           ULX004    IFEQ 'Y'                                                           CER001
     C           ##SCR     ANDEQ'SCR2'                                                        CER001
      *                                                                                       CER001
     C                     EXSR SRWIND
     C                     ENDIF                                                              CER001
     C/COPY WNCPYSRC,FT0345C083
     C                     END
      *
      * QUIT if error:
      *
     C   99                GOTO CFEXIT
      *
      * Defer confirm/update requested
      *
     C           W0DCF     CABEQ'Y'       CFEXIT
      *
      * if screen 1 progress to screen 2
      *
     C           ##SCR     IFEQ 'SCR1'
     C                     EXSR MEIZ#D
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,31
     C/COPY WNCPYSRC,FT0345C047
      *
     C                     MOVEL'SCR2'    ##SCR
     C                     GOTO CFEXIT
     C                     END
      *                                                                   CFT014
      ** If screen2 progress to screen3                                   CFT014
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
      *                                                                   CFT014
      ** Initialise screen3                                               CFT014
      *                                                                   CFT014
     C                     EXSR SRISC3                                    CFT014
      *                                                                   CFT014
      ** Clear messages from program message queue                        CFT014
      *                                                                   CFT014
     C                     CALL 'Y2CLMSC'                                 CFT014
     C                     PARM ##PGM     ZAPGMQ                          CFT014
     C                     PARM '*SAME'   ZAPGRL                          CFT014
      *                                                                   CFT014
      ** Reset first message only flag                                    CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       ZAFSMS                          CFT014
     C                     MOVE *ALL'0'   ##OFF                           CFT014
     C                     MOVEA##OFF     *IN,31                          CFT014
     C                     MOVEL'SCR3'    ##SCR                           CFT014
      *                                                                   CFT009
      ** Set on flag to indicate that we going from screen2 to screen 3   CFT009
      *                                                                   CFT009
     C                     MOVEL'Y'       FRST3S  1                       CFT009
     C                     GOTO CFEXIT                                    CFT014
     C                     ENDIF                                          CFT014
      *
      * No error: update record
      *
     C           #1ACTC    IFEQ 'A'
     C           #1ACTC    OREQ 'I'
     C                     EXSR EBPR##
     C                     END
      *
      * Exit if linked
      *
     C           *IN99     IFEQ '0'
     C           P3LINK    IFEQ 'Y'
     C           P2PREF    ORNE *BLANKS
     C                     MOVEL'N'       W0RPT
     C                     MOVEL'N'       W0TRN
     C                     ELSE
     C                     MOVEL'R'       W0RPT
     C                     MOVEL'N'       W0TRN
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'DCVLDL'  @STK,Q
      *
      *  Perform selection processing
      *
     C                     EXSR SRQURY
      *
      * EDTRCD: Valid det. scrn - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Detail Screen
     C/COPY WNCPYSRC,FT0345DVSF
      *
      * USER: Validate detail screen fields
      *
     C***********##SCR     IFEQ 'SCR1'                                    CFT014
     C                     SELEC                                          CFT014
     C           ##SCR     WHEQ 'SCR1'                                    CFT014
      *
      *  Call access object FT0347 to validate screen
      *
     C                     EXSR SRFTS1
     C***********          ELSE                                           CFT014
     C           ##SCR     WHEQ 'SCR2'                                    CFT014
      *
      *  Call access object FT0348 to validate screen
      *
     C                     EXSR SRFTS2
      *                                                                   CFT014
     C           ##SCR     WHEQ 'SCR3'                                    CFT014
      *                                                                   CFT014
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     EXSR SRQRY3                                    CFT009
     C                     EXSR SREQR3                                    CFT009
     C                     ENDIF                                          CFT009
      ** Call program FT0349 to validate screen3                          CFT014
      *                                                                   CFT014
     C                     EXSR SRFTS3                                    CFT014
     C***********          END                                            CFT014
     C                     ENDSL                                          CFT014
      *
      * CALC: Detail screen function fields
      * EDTRCD: Detail scrn funcs - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Calc Detail Function Flds
     C/COPY WNCPYSRC,FT0345DSFF
      * USER: Validate detail screen relations
      * EDTRCD: Detail scrn rels - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Screen Relns
     C/COPY WNCPYSRC,FT0345DVSR
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           DCEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SRQURY    BEGSR
      *================================================================
      * Do ? mark processing
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRQURY'  @STK,Q
      *----------------------------------------------------------------
      * Subroutine to resolve entry of ? for standing data fields.
      * Performed after function key validation and prior to field
      * validation for screen 2.
      *
      * Indicators used:
      *  W0DCF    defer confirm redisplay screen
      *  90       used in SCAN on if ? found
      *----------------------------------------------------------------
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EXQURY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
     CSR         SRQRY3    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? prompt proceesing for charge codes on screen three           CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      * Subroutine to resolve entry of ?.                                 CFT009
      * Performed after function key validation and prior to field        CFT009
      * validation for screen 3.                                          CFT009
      *                                                                   CFT009
      * Indicators used:                                                  CFT009
      *  90       used in SCAN on if ? found                              CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'SRQRY3'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEATRCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    TRCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   TRCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAFXCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    FXCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   FXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEATXCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    TXCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   TXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEACQCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    CQCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   CQCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEASTCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    STCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   STCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEASPCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    SPCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   SPCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAMSCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    MSCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   MSCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM1CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M1CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M1CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM2CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M2CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M2CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM3CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M3CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M3CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM4CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M4CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M4CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM5CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M5CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M5CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXQRY3    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *****************************************************************   CFT009
     CSR         SREQR3    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? mark processing for enquiry on charge calulation amounts     CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'SREQR3'  @STK,Q                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      * Subroutine to resolve entry of ?.                                 CFT009
      * Performed after function key validation and prior to field        CFT009
      * validation for screen 3.                                          CFT009
      *                                                                   CFT009
      * Indicators used:                                                  CFT009
      *  W0DCF    defer confirm redisplay screen                          CFT009
      *  90       used in SCAN on if ? found                              CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3TRCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           TRCDE     IFNE *BLANKS                                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
     C                     MOVE TRCDE     CHGCDE                          CFT009
      *                                                                   CFT009
      ***  Call SR to process enquiry screen for each code                CFT009
      *                                                                   CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7TRCD    #3TRCD                          CFT009
     C           WI7CDE    IFEQ *ON                                       CFT009
     C                     MOVE 'Y'       I7CDE1                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELTRCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3CHCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           FXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE FXCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7CHCD    #3CHCD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE2                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELFXCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3TXCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           TXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE TXCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7TXCD    #3TXCD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE3                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELTXCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3CQCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           CQCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE CQCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7CQCD    #3CQCD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE4                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCQCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3CSTD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           CACDE     IFNE *BLANKS                                   CFT009
     C                     MOVE CACDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7CSTD    #3CSTD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE5                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCACDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3SPCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           SPCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE SPCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7SPCD    #3SPCD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE7                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELSPCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3MSCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           MSCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE MSCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7MSCD    #3MSCD                          CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE8                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELMSCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEASTCD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           STCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE STCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7STCD    STCD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE6                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELSTCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM1CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M1CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M1CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7M1CD    M1CD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CDE9                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM1CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM2CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M2CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M2CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7M2CD    M2CD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CD10                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM2CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM3CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M3CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M3CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7M3CD    M3CD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CD11                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM3CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM4CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M4CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M4CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7M4CD    M4CD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CD12                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM4CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM5CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M5CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M5CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVE S7M5CD    M5CD                            CFT009
     C           WI7CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I7CD13                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM5CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXEQR3    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     CSR         FT0652    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? mark processing for amounts                                  CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'FT0652'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Check that charge code exists before call to enquiry             CFT009
      *                                                                   CFT009
     C           CHGCDE    CHAINFTPCHGL0             90                   CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ *ON                                       CFT009
     C                     MOVELCHGCDE    ZAMSDA                          CFT009
     C                     MOVEL'FTF3206' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     MOVEL'Y'       WI7CDE  1                       CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL' '       WI7CDE                          CFT009
      *                                                                   CFT009
      ** Call ft000652 for display of charge caculation enquiry scrn      CFT009
      *                                                                   CFT009
     C                     CLEARTRNDET                                    CFT009
     C                     CLEARTRNEXT                                    CFT009
      *                                                                   CFT009
     C                     SELEC                                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'B'                                       CFT009
     C           S7CDRO    ORNE *BLANKS                                   CFT009
     C                     MOVELV#BCCY    OPCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'L'                                       CFT009
     C                     MOVELV#LCCY    OPCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'F'                                       CFT009
     C                     MOVELFCHCCY    OPCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'C'                                       CFT009
     C           V#ADDC    ANDEQ'A'                                       CFT009
     C                     MOVELV#SMCY    OPCHGC                          CFT009
      *                                                                   CFT009
     C                     OTHER                                          CFT009
     C                     MOVELV#PCCY    OPCHGC                          CFT009
      *                                                                   CFT009
     C                     ENDSL                                          CFT009
      *                                                                   CFT009
     C                     MOVEL'M'       STP                             CFT009
     C                     MOVE #3CDRO    CDRO                            CFT009
     C                     MOVEL@1DBRC    TRNDET                          CFT009
     C                     MOVELOTPXDS    TRNEXT                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVE 'OP'      TRNTYP                          CFT009
      *                                                                   CFT009
     C                     CALL 'FT000652'                                CFT009
     C                     PARM *BLANKS   MRTCD  10                       CFT009
     C                     PARM           TRNDET                          CFT009
     C                     PARM           TRNEXT                          CFT009
     C                     PARM           TRNTYP  2                       CFT009
     C                     PARM           CHGCDE  5                       CFT009
     C                     PARM *BLANKS   INKC    1                       CFT009
      *                                                                   CFT009
      ** Force redisplay of screen on F12                                 CFT009
      *                                                                   CFT009
     C                     SETON                     99                   CFT009
      *                                                                   CFT009
     C           MRTCD     IFNE *BLANKS                                   CFT009
     C                     MOVEL'FT000652'W0FILE                          CFT009
     C                     MOVEL'*CALL'   W0KEY                           CFT009
     C                     Z-ADD82        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C           INKC      IFEQ '1'                                       CFT009
     C                     MOVE *ON       *IN03                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXFT06    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************
      /EJECT
     CSR         SRFTS1    BEGSR
      *================================================================
      * Call validation access object
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFTS1'  @STK,Q
      *================================================================
     C                     MOVEL#1ACTC    S5ACTD
     C                     MOVEL#1PREF    S5PREF
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVEL#1TRCT    S5TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL#1CDRO    S5CDRO                          CFT014
     C/COPY WNCPYSRC,FT0345C017
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVEL#1CDBR    S5CDBR                          CFT014
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVEL#1BKOP    S5BNCD                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C                     MOVEL#1TRNT    S5TTCD                          CFT014
     C                     ENDIF                                          CFT014
      *  Receivers Correspondent
     C                     MOVEL#1RCO1    S5RCO1
     C                     MOVEL#1RCO2    S5RCO2
     C                     MOVEL#1RCO3    S5RCO3
     C                     MOVEL#1RCO4    S5RCO4
     C                     MOVEL#1RCO5    S5RCO5
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVEL#1TRI1    S5TRI1                          CFT014
     C                     MOVEL#1TRI2    S5TRI2                          CFT014
     C                     MOVEL#1TRI3    S5TRI3                          CFT014
     C                     MOVEL#1TRI4    S5TRI4                          CFT014
     C                     MOVEL#1TRI5    S5TRI5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Intermediary                                                     CFT014
      *                                                                   CFT014
     C                     MOVEL#1INB1    S5IBK1                          CFT014
     C                     MOVEL#1INB2    S5IBK2                          CFT014
     C                     MOVEL#1INB3    S5IBK3                          CFT014
     C                     MOVEL#1INB4    S5IBK4                          CFT014
     C                     MOVEL#1INB5    S5IBK5                          CFT014
      *  Account with Institution
     C                     MOVEL#1ACB1    S5ACB1
     C                     MOVEL#1ACB2    S5ACB2
     C                     MOVEL#1ACB3    S5ACB3
     C                     MOVEL#1ACB4    S5ACB4
     C                     MOVEL#1ACB5    S5ACB5
      *  Beneficiary
     C                     MOVEL#1BNC1    S5BNC1
     C                     MOVEL#1BNC2    S5BNC2
     C                     MOVEL#1BNC3    S5BNC3
     C                     MOVEL#1BNC4    S5BNC4
     C                     MOVEL#1BNC5    S5BNC5
      ***Details*of*Payment********************************************   CFT014
     C***********          MOVEL#1DTP1    S5PAY1                          CFT014
     C***********          MOVEL#1DTP2    S5PAY2                          CFT014
     C***********          MOVEL#1DTP3    S5PAY3                          CFT014
     C***********          MOVEL#1DTP4    S5PAY4                          CFT014
      ***Sender*to*Receiver*information********************************   CFT014
     C***********          MOVEL#1BBI1    S5BTB1                          CFT014
     C***********          MOVEL#1BBI2    S5BTB2                          CFT014
     C***********          MOVEL#1BBI3    S5BTB3                          CFT014
     C***********          MOVEL#1BBI4    S5BTB4                          CFT014
     C***********          MOVEL#1BBI5    S5BTB5                          CFT014
     C***********          MOVEL#1BBI6    S5BTB6                          CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Instruction codes                                                CFT014
      *                                                                   CFT014
     C           OPICD1    CAT  OPICD2    W5INC1 70                       CFT014
     C           W5INC1    CAT  OPICD3    W5INC2105                       CFT014
     C           W5INC2    CAT  OPICD4    W5INC3140                       CFT014
     C           W5INC3    CAT  OPICD5    W5INC4175                       CFT014
     C                     MOVELW5INC4    V#INCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Sender's Correspondent                                           CFT014
      *                                                                   CFT014
     C**********           Z-ADDSNCO      V#SNCO                                       CFT014 CSD027
     C                     MOVELSNCO      V#SNCO                                              CSD027
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Fields needed for error processing
      *
      * No update indicator
     C                     MOVEL*BLANKS   E#NOUP
      * Warning message sent
     C                     MOVEL*BLANKS   E#WARN
      * Message sent via FTSNMS
     C                     MOVEL*BLANKS   E#MSGS
      * Program to send messages to
     C                     MOVEL##PGM     E#CPGM
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Error codes to be displayed
      *
     C                     MOVEL*BLANKS   C#ERCD
     C                     MOVEL*BLANKS   I5DATA
      *
     C/COPY WNCPYSRC,FT0345C027
     C                     MOVELDSTT      V#DSTT                                              CFT032
     C                     MOVELDST1      V#DST1                                              CFT032
      *
      *  Define entry parameters
      *
     C                     CALL 'FT0347'               9090
     C                     PARM           P@RTCD
     C                     PARM '*VALID'  W0ACT   8
     C                     PARM           S5DATA
     C                     PARM           V#DATA
     C                     PARM           F5DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I5DATA
     C/COPY WNCPYSRC,FT0345C028
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    ORNE *BLANKS
     C                     MOVEL'FT0347  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 01 *
     C                     Z-ADD1         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Data Structure to pass data between programs
      *
      *
      *  Move back validated data
      *
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVELS5TRCT    #1TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVELS5CDRO    #1CDRO                          CFT014
     C/COPY WNCPYSRC,FT0345C018
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVELS5CDBR    #1CDBR                          CFT014
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVELS5BNCD    #1BKOP                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C                     MOVELS5TTCD    #1TRNT                          CFT014
     C                     ENDIF                                          CFT014
      *  Receivers Correspondent
     C                     MOVELS5RCO1    #1RCO1
     C                     MOVELS5RCO2    #1RCO2
     C                     MOVELS5RCO3    #1RCO3
     C                     MOVELS5RCO4    #1RCO4
     C                     MOVELS5RCO5    #1RCO5
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVELS5TRI1    #1TRI1                          CFT014
     C                     MOVELS5TRI2    #1TRI2                          CFT014
     C                     MOVELS5TRI3    #1TRI3                          CFT014
     C                     MOVELS5TRI4    #1TRI4                          CFT014
     C                     MOVELS5TRI5    #1TRI5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Intermediary                                                     CFT014
      *                                                                   CFT014
     C                     MOVELS5IBK1    #1INB1                          CFT014
     C                     MOVELS5IBK2    #1INB2                          CFT014
     C                     MOVELS5IBK3    #1INB3                          CFT014
     C                     MOVELS5IBK4    #1INB4                          CFT014
     C                     MOVELS5IBK5    #1INB5                          CFT014
      *                                                                   CFT014
      *  Account with Institution
     C                     MOVELF5ACBT    V#ACBT
     C                     MOVELS5ACB1    #1ACB1
     C                     MOVELS5ACB2    #1ACB2
     C                     MOVELS5ACB3    #1ACB3
     C                     MOVELS5ACB4    #1ACB4
     C                     MOVELS5ACB5    #1ACB5
      *  Beneficiary
     C                     MOVELS5BNC1    #1BNC1
     C                     MOVELS5BNC2    #1BNC2
     C                     MOVELS5BNC3    #1BNC3
     C                     MOVELS5BNC4    #1BNC4
     C                     MOVELS5BNC5    #1BNC5
      ***Details*of*Payment********************************************   CFT014
     C***********          MOVELS5PAY1    #1DTP1                          CFT014
     C***********          MOVELS5PAY2    #1DTP2                          CFT014
     C***********          MOVELS5PAY3    #1DTP3                          CFT014
     C***********          MOVELS5PAY4    #1DTP4                          CFT014
      ***Sender*to*Receiver*information********************************   CFT014
     C***********          MOVELS5BTB1    #1BBI1                          CFT014
     C***********          MOVELS5BTB2    #1BBI2                          CFT014
     C***********          MOVELS5BTB3    #1BBI3                          CFT014
     C***********          MOVELS5BTB4    #1BBI4                          CFT014
     C***********          MOVELS5BTB5    #1BBI5                          CFT014
     C***********          MOVELS5BTB6    #1BBI6                          CFT014
      *
      *  Error indicators
      ** Reset error inds.                                                 CFT009
      *                                                                    CFT009
     C                     MOVE *ALL'0'   ##OFF  30                        CFT009
     C                     MOVEA##OFF     *IN,1                            CFT009
      *
      * Re-send screen indicator
      *
     C           E#NOUP    IFNE *BLANKS
     C                     MOVEL'1'       *IN99
     C                     END
      *
     C           I5DATA    IFEQ *BLANKS
     C                     MOVEA*BLANKS   ERCD
     C                     GOTO EXFTS1
     C                     END
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********I5TRCT    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN31                           CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********I5CDRT    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN32                           CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********I5CDBR    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN33                           CFT014
     C***********          END                                            CFT014
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           I5BNCD    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN31                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C           I5TTCD    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN32                           CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *  Receivers Correspondent
     C           I5RCOT    IFEQ 'Y     '
     C***********          MOVEA'11111'   *IN,34                          CFT014
     C                     MOVEA'11111'   *IN,33                          CFT014
     C                     END
     C           I5RCO1    IFNE *BLANKS
     C***********          MOVEL'1'       *IN34                           CFT014
     C                     MOVE *ON       *IN33                           CFT014
     C                     END
     C           I5RCO2    IFNE *BLANKS
     C***********          MOVEL'1'       *IN35                           CFT014
     C                     MOVE *ON       *IN34                           CFT014
     C                     END
     C           I5RCO3    IFNE *BLANKS
     C***********          MOVEL'1'       *IN36                           CFT014
     C                     MOVE *ON       *IN35                           CFT014
     C                     END
     C           I5RCO4    IFNE *BLANKS
     C***********          MOVEL'1'       *IN37                           CFT014
     C                     MOVE *ON       *IN36                           CFT014
     C                     END
     C           I5RCO5    IFNE *BLANKS
     C***********          MOVEL'1'       *IN38                           CFT014
     C                     MOVE *ON       *IN37                           CFT014
     C                     END
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           I5TRIT    IFEQ 'Y     '                                  CFT014
     C                     MOVEA'11111'   *IN,38                          CFT014
     C                     ENDIF                                          CFT014
     C           I5TRI1    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN38                           CFT014
     C                     ENDIF                                          CFT014
     C           I5TRI2    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN39                           CFT014
     C                     ENDIF                                          CFT014
     C           I5TRI3    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN40                           CFT014
     C                     ENDIF                                          CFT014
     C           I5TRI4    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN41                           CFT014
     C                     ENDIF                                          CFT014
     C           I5TRI5    IFNE *BLANK                                    CFT014
     C                     MOVE *ON       *IN42                           CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Intermediary                                                     CFT014
      *                                                                   CFT014
     C           I5INBK    IFEQ 'Y     '                                  CFT014
     C***********          MOVEA'11111'   *IN,54                   CFT014 CFT009
     C                     MOVEA'11111'   *IN,26                          CFT009
     C                     ENDIF                                          CFT014
     C           I5INB1    IFNE *BLANK                                    CFT014
     C***********          MOVE *ON       *IN54                    CFT014 CFT009
     C                     MOVE *ON       *IN26                           CFT009
     C                     ENDIF                                          CFT014
     C           I5INB2    IFNE *BLANK                                    CFT014
     C***********          MOVE *ON       *IN55                    CFT014 CFT009
     C                     MOVE *ON       *IN27                           CFT009
     C                     ENDIF                                          CFT014
     C           I5INB3    IFNE *BLANK                                    CFT014
     C***********          MOVE *ON       *IN56                    CFT014 CFT009
     C                     MOVE *ON       *IN28                           CFT009
     C                     ENDIF                                          CFT014
     C           I5INB4    IFNE *BLANK                                    CFT014
     C***********          MOVE *ON       *IN57                    CFT014 CFT009
     C                     MOVE *ON       *IN29                           CFT009
     C                     ENDIF                                          CFT014
     C           I5INB5    IFNE *BLANK                                    CFT014
     C***********          MOVE *ON       *IN58                    CFT014 CFT009
     C                     MOVE *ON       *IN30                           CFT009
     C                     ENDIF                                          CFT014
      *  Account with Institution
     C           I5ACBT    IFEQ 'Y     '
     C***********          MOVEA'11111'   *IN,39                          CFT014
     C                     MOVEA'11111'   *IN,49                          CFT014
     C                     END
     C           I5ACB1    IFNE *BLANKS
     C***********          MOVEL'1'       *IN39                           CFT014
     C                     MOVE *ON       *IN49                           CFT014
     C                     END
     C           I5ACB2    IFNE *BLANKS
     C***********          MOVEL'1'       *IN40                           CFT014
     C                     MOVE *ON       *IN50                           CFT014
     C                     END
     C           I5ACB3    IFNE *BLANKS
     C***********          MOVEL'1'       *IN41                           CFT014
     C                     MOVE *ON       *IN51                           CFT014
     C                     END
     C           I5ACB4    IFNE *BLANKS
     C***********          MOVEL'1'       *IN42                           CFT014
     C                     MOVE *ON       *IN52                           CFT014
     C                     END
     C           I5ACB5    IFNE *BLANKS
     C***********          MOVEL'1'       *IN43                           CFT014
     C                     MOVE *ON       *IN53                           CFT014
     C                     END
      *  Beneficiary
     C           I5BNCT    IFEQ 'Y     '
     C                     MOVEA'11111'   *IN,44
     C                     END
     C           I5BNC1    IFNE *BLANKS
     C                     MOVEL'1'       *IN44
     C                     END
     C           I5BNC2    IFNE *BLANKS
     C                     MOVEL'1'       *IN45
     C                     END
     C           I5BNC3    IFNE *BLANKS
     C                     MOVEL'1'       *IN46
     C                     END
     C           I5BNC4    IFNE *BLANKS
     C                     MOVEL'1'       *IN47
     C                     END
     C***********I5ACB5    IFNE *BLANKS                                   CFT014
     C           I5BNC5    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN48
     C                     END
      ***Details*of*Payment********************************************   CFT014
     C***********I5PAY     IFEQ 'Y    '                                   CFT014
     C***********          MOVEA'1111'    *IN,49                          CFT014
     C***********          END                                            CFT014
     C***********I5PAY1    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN49                           CFT014
     C***********          END                                            CFT014
     C***********I5PAY2    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN50                           CFT014
     C***********          END                                            CFT014
     C***********I5PAY3    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN51                           CFT014
     C***********          END                                            CFT014
     C***********I5PAY4    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN52                           CFT014
     C***********          END                                            CFT014
      ***Sender*to*Receiver*information********************************   CFT014
     C***********I5BTB     IFEQ 'Y      '                                 CFT014
     C***********          MOVEA'111111'  *IN,53                          CFT014
     C***********          END                                            CFT014
     C***********I5BTB1    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN53                           CFT014
     C***********          END                                            CFT014
     C***********I5BTB2    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN54                           CFT014
     C***********          END                                            CFT014
     C***********I5BTB3    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN55                           CFT014
     C***********          END                                            CFT014
     C***********I5BTB4    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN56                           CFT014
     C***********          END                                            CFT014
     C***********I5BTB5    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN57                           CFT014
     C***********          END                                            CFT014
     C***********I5BTB6    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN68                           CSW096
     C***********          MOVEL'1'       *IN58                    CSW096 CFT014
     C***********          END                                            CFT014
      *
     C                     MOVEAC#ERCD    ERCD
      *
      *  If warning sent then delay confirm
      *
     C           E#WARN    IFEQ 'Y'
     C           E#RSND    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#RSND
     C                     MOVEL'1'       *IN99
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXFTS1    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SRFTS2    BEGSR
      *================================================================
      * Call validation access object
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFTS2'  @STK,Q
      *================================================================
     C                     MOVEL#1ACTC    S6ACTD
     C                     MOVEL#1PREF    S6PREF
      *                                                                   CFT014
      ** Details of Payment                                               CFT014
      *                                                                   CFT014
     C                     MOVEL#2DTP1    S6PAY1                          CFT014
     C                     MOVEL#2DTP2    S6PAY2                          CFT014
     C                     MOVEL#2DTP3    S6PAY3                          CFT014
     C                     MOVEL#2DTP4    S6PAY4                          CFT014
      *                                                                   CFT014
      ** Sender to Receiver information                                   CFT014
      *                                                                   CFT014
     C                     MOVEL#2BBI1    S6BTB1                          CFT014
     C                     MOVEL#2BBI2    S6BTB2                          CFT014
     C                     MOVEL#2BBI3    S6BTB3                          CFT014
     C                     MOVEL#2BBI4    S6BTB4                          CFT014
     C                     MOVEL#2BBI5    S6BTB5                          CFT014
     C                     MOVEL#2BBI6    S6BTB6                          CFT014
      **Intermediary*Bank**********************************************   CFT014
     C***********          MOVEL#2INB1    S6IBK1                          CFT014
     C***********          MOVEL#2INB2    S6IBK2                          CFT014
     C***********          MOVEL#2INB3    S6IBK3                          CFT014
     C***********          MOVEL#2INB4    S6IBK4                          CFT014
     C***********          MOVEL#2INB5    S6IBK5                          CFT014
      * Central Bank Reference
     C                     MOVEL#2DNBC    S6CBKR
      *                                                                   CFT014
      ** Transfer commission tarriff                                      CFT014
      *                                                                   CFT014
     C                     MOVEL#2TRCT    S6TRCT                          CFT014
      **Details*of*Charge**********************************************   CFT014
     C***********          MOVEL#2DTCH    S6DETC                          CFT014
      ***********                                                         CFT014
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********          MOVEL#2TRCD    S6TRCD                          CFT014
      **Telex**********************************************************   CFT014
     C***********          MOVEL#2TXCD    S6TXCD                          CFT014
      **Cheque*********************************************************   CFT014
     C***********          MOVEL#2CQCD    S6CQCD                          CFT014
      **Costs*Abroad***************************************************   CFT014
     C***********          MOVEL#2CSTD    S6CSTD                          CFT014
      **SWIFT*Priority*************************************************   CFT014
     C***********          MOVEL#2SPCD    S6SPCD                          CFT014
      **Miscellaneous**************************************************   CFT014
     C***********          MOVEL#2MSCD    S6MSCD                          CFT014
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission**************************************S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL#2CHCD    S6CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
      * Related Reference
     C                     MOVEL#2RLPR    S6RLRF
      * CHAPS Code
     C                     MOVEL#2CHAP    S6CHAP
     C/COPY WNCPYSRC,FT0345C050
     C***********                                                  S01499 CFT014
     C***V.A.T.*flags**********************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVEL#2VAT1    S6VAT1                   S01499 CFT014
     C***********          MOVEL#2VAT2    S6VAT2                   S01499 CFT014
     C***********          MOVEL#2VAT3    S6VAT3                   S01499 CFT014
     C***********          MOVEL#2VAT4    S6VAT4                   S01499 CFT014
     C***********          MOVEL#2VAT5    S6VAT5                   S01499 CFT014
     C***********          MOVEL#2VAT6    S6VAT6                   S01499 CFT014
     C***********          MOVEL#2VAT7    S6VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
      ** Instruction code                                                 CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVEL#2INS1    S6INC1                          CFT014
     C                     MOVEL#2INS2    S6INC2                          CFT014
     C                     MOVEL#2INS3    S6INC3                          CFT014
     C                     MOVEL#2INS4    S6INC4                          CFT014
     C                     MOVEL#2INS5    S6INC5                          CFT014
      *                                                                   CFT014
      ** Regulatory reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVEL#2RGR1    S6RRP1                          CFT014
     C                     MOVEL#2RGR2    S6RRP2                          CFT014
     C                     MOVEL#2RGR3    S6RRP3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Pass data from first screen that will be needed in cross-vali    CFT014
      ** dating the bank to bank information on second screen.            CFT014
      *                                                                   CFT014
     C                     MOVELF5RCOT    V#RCOT                          CFT014
     C                     MOVELF5ACBT    V#ACBT                          CFT014
     C                     MOVELF5BNCT    V#BNCT                          CFT014
     C                     MOVELS5ACB     V#ABK                           CFT014
     C                     MOVELS5BNC     V#BNF                           CFT014
     C                     MOVELS5BNCD    V#BNCD                          CFT014
     C/COPY WNCPYSRC,FT0345C064
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Fields needed for error processing
      *
      * No update indicator
     C                     MOVEL*BLANKS   E#NOUP
      * Warning message sent
     C                     MOVEL*BLANKS   E#WARN
      * Message sent via FTSNMS
     C                     MOVEL*BLANKS   E#MSGS
      * Program to send messages to
     C                     MOVEL##PGM     E#CPGM
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Error codes to be displayed
      *
     C                     MOVEL*BLANKS   C#ERCD
     C                     MOVEL*BLANKS   I6DATA
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE #1INB1    I6INB1                                              CSW201
     C                     ENDIF                                                              CSW201
     C/COPY WNCPYSRC,FT0345C042
      *
      *
      *  Define entry parameters
      *
     C                     CALL 'FT0348'               9090
     C                     PARM           P@RTCD
     C                     PARM '*VALID'  W0ACT   8
     C                     PARM           S6DATA
     C                     PARM           V#DATA
     C                     PARM           F6DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I6DATA
     C                     PARM           S4DATA                                            BUG26775
     C                     PARM           F4DATA                                            BUG26775
     C                     PARM           S5DATA                                            BUG26775
     C                     PARM           F5DATA                                            BUG26775
     C/COPY WNCPYSRC,FT0345C069
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    ORNE *BLANKS
     C                     MOVEL'FT0348  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 02 *
     C                     Z-ADD2         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Data Structure to pass data between programs
      *
      *
      *  Move back validated data
     C/COPY WNCPYSRC,FT0345C048
      *                                                                   CFT014
      ** Details of Payment                                               CFT014
      *                                                                   CFT014
     C                     MOVELS6PAY1    #2DTP1                          CFT014
     C                     MOVELS6PAY2    #2DTP2                          CFT014
     C                     MOVELS6PAY3    #2DTP3                          CFT014
     C                     MOVELS6PAY4    #2DTP4                          CFT014
      *                                                                   CFT014
      ** Sender to Receiver information                                   CFT014
      *                                                                   CFT014
     C                     MOVELS6BTB1    #2BBI1                          CFT014
     C                     MOVELS6BTB2    #2BBI2                          CFT014
     C                     MOVELS6BTB3    #2BBI3                          CFT014
     C                     MOVELS6BTB4    #2BBI4                          CFT014
     C                     MOVELS6BTB5    #2BBI5                          CFT014
     C                     MOVELS6BTB6    #2BBI6                          CFT014
      *
      **Intermediary*Bank**********************************************   CFT014
     C***********          MOVELS6IBK1    #2INB1                          CFT014
     C***********          MOVELS6IBK2    #2INB2                          CFT014
     C***********          MOVELS6IBK3    #2INB3                          CFT014
     C***********          MOVELS6IBK4    #2INB4                          CFT014
     C***********          MOVELS6IBK5    #2INB5                          CFT014
      * Central Bank Reference
     C                     MOVELS6CBKR    #2DNBC
      *                                                                   CFT014
      ** Transfer commission tarriff                                      CFT014
      *                                                                   CFT014
     C                     MOVELS6TRCT    #2TRCT                          CFT014
      **Details*of*Charge**********************************************   CFT014
     C***********          MOVELS6DETC    #2DTCH                          CFT014
     C/COPY WNCPYSRC,FT0345C051
      ***********                                                         CFT014
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********          MOVELS6TRCD    #2TRCD                          CFT014
      **Telex**********************************************************   CFT014
     C***********          MOVELS6TXCD    #2TXCD                          CFT014
      **Cheque*********************************************************   CFT014
     C***********          MOVELS6CQCD    #2CQCD                          CFT014
      **Costs*Abroad***************************************************   CFT014
     C***********          MOVELS6CSTD    #2CSTD                          CFT014
      **SWIFT*Priority*************************************************   CFT014
     C***********          MOVELS6SPCD    #2SPCD                          CFT014
      **Miscellaneous**************************************************   CFT014
     C***********          MOVELS6MSCD    #2MSCD                          CFT014
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission**************************************S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELS6CHCD    #2CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
      * Related Reference
     C                     MOVELS6RLRF    #2RLPR
      * CHAPS Code
     C                     MOVELS6CHAP    #2CHAP
     C***********                                                  S01499 CFT014
     C***V.A.T.*flags**********************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELS6VAT1    #2VAT1                   S01499 CFT014
     C***********          MOVELS6VAT2    #2VAT2                   S01499 CFT014
     C***********          MOVELS6VAT3    #2VAT3                   S01499 CFT014
     C***********          MOVELS6VAT4    #2VAT4                   S01499 CFT014
     C***********          MOVELS6VAT5    #2VAT5                   S01499 CFT014
     C***********          MOVELS6VAT6    #2VAT6                   S01499 CFT014
     C***********          MOVELS6VAT7    #2VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
      ** Instruction code                                                 CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVELS6INC1    #2INS1                          CFT014
     C                     MOVELS6INC2    #2INS2                          CFT014
     C                     MOVELS6INC3    #2INS3                          CFT014
     C                     MOVELS6INC4    #2INS4                          CFT014
     C                     MOVELS6INC5    #2INS5                          CFT014
      *                                                                   CFT014
      ** Regulatory reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVELS6RRP1    #2RGR1                          CFT014
     C                     MOVELS6RRP2    #2RGR2                          CFT014
     C                     MOVELS6RRP3    #2RGR3                          CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0345C065
      **Initialise*charges*********************************************   CFT014
     C***********          EXSR MFIZ#D                                    CFT014
      *
      *  Error indicators
      *
      * Re-send screen indicator
      *
     C           E#NOUP    IFNE *BLANKS
     C                     MOVEL'1'       *IN99
     C                     END
      *
     C           I6DATA    IFEQ *BLANKS
     C                     MOVEA*BLANKS   ERCD
     C                     GOTO EXFTS2
     C                     END
     C/COPY WNCPYSRC,FT0345C049
      **Intermediary*Bank**********************************************   CFT014
     C***********I6INBK    IFEQ 'Y     '                                  CFT014
     C***********          MOVEA'11111'   *IN,31                          CFT014
     C***********          END                                            CFT014
     C***********I6INB1    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN31                           CFT014
     C***********          END                                            CFT014
     C***********I6INB2    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN32                           CFT014
     C***********          END                                            CFT014
     C***********I6INB3    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN33                           CFT014
     C***********          END                                            CFT014
     C***********I6INB4    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN34                           CFT014
     C***********          END                                            CFT014
     C***********I6INB5    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN35                           CFT014
     C***********          END                                            CFT014
      *                                                                   CFT014
      ** Details of Payment                                               CFT014
      *                                                                   CFT014
     C           I6PAY     IFEQ 'Y    '                                   CFT014
     C                     MOVEA'1111'    *IN,31                          CFT014
     C                     ENDIF                                          CFT014
     C           I6PAY1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN31                           CFT014
     C                     ENDIF                                          CFT014
     C           I6PAY2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN32                           CFT014
     C                     ENDIF                                          CFT014
     C           I6PAY3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN33                           CFT014
     C                     ENDIF                                          CFT014
     C           I6PAY4    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN34                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Sender to Receiver information                                   CFT014
      *                                                                   CFT014
     C           I6BTB     IFEQ 'Y      '                                 CFT014
     C                     MOVEA'111111'  *IN,35                          CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN35                           CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN36                           CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN37                           CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB4    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN38                           CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB5    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN39                           CFT014
     C                     ENDIF                                          CFT014
     C           I6BTB6    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN68                           CFT014
     C                     MOVEL*ON       *IN40                           CFT014
     C                     ENDIF                                          CFT014
      * Central Bank Reference
     C           I6CBKR    IFNE *BLANKS
     C***********          MOVEL'1'       *IN36                           CFT014
     C                     MOVE *ON       *IN41                           CFT014
     C                     END
      *                                                                   CFT014
      ** Transfer commission tariff                                       CFT014
      *                                                                   CFT014
     C           I6TRCT    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN42                           CFT014
     C                     ENDIF                                          CFT014
      **Details*of*Charge**********************************************   CFT014
     C***********I6DETC    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN37                           CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********I6TRCM    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN38                           CFT014
     C***********          END                                            CFT014
      **Telex**********************************************************   CFT014
     C***********I6TXCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN39                           CFT014
     C***********          END                                            CFT014
      **Cheque*********************************************************   CFT014
     C***********I6CQCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN40                           CFT014
     C***********          END                                            CFT014
      **Costs*Abroad***************************************************   CFT014
     C***********I6CSTH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN41                           CFT014
     C***********          END                                            CFT014
      **SWIFT*Priority*************************************************   CFT014
     C***********I6SPCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN42                           CFT014
     C***********          END                                            CFT014
      **Miscellaneous**************************************************   CFT014
     C***********I6MSCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN43                           CFT014
     C***********          END                                            CFT014
      * Related Reference
     C           I6RLRF    IFNE *BLANKS
     C                     MOVEL'1'       *IN44
     C                     END
      * CHAPS Code
     C           I6CHAP    IFNE *BLANKS
     C                     MOVEL'1'       *IN45
     C                     END
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission**************************************S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********I6CHCM    IFNE *BLANKS                            S01494 CFT014
     C***********          MOVEL'1'       *IN46                    S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***If*switchable*feature*S01499*is*switched*ON*check*error*onS01499 CFT014
     C***V.A.T.*flags**********************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Transfer*Commission*V.A.T.*Flag***************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT1    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN47                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telex*V.A.T.*Flag*****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT2    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN48                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Cheque*V.A.T.*Flag****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT3    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN49                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Costs*V.A.T.*Flag*****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT4    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN50                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***SWIFT*Priority*V.A.T.*Flag********************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT5    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN51                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Miscellaneous*V.A.T.*Flag*********************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT6    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN52                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***FX/Change*Commission*V.A.T.*Flag**************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I6VAT7    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN53                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Instruction code                                                 CFT014
      *                                                                   CFT014
     C           I6INCD    IFEQ 'Y     '                                  CFT014
     C                     MOVEA'11111'   *IN,46                          CFT014
     C                     ENDIF                                          CFT014
     C           I6INC1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN46                           CFT014
     C                     ENDIF                                          CFT014
     C           I6INC2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN47                           CFT014
     C                     ENDIF                                          CFT014
     C           I6INC3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN48                           CFT014
     C                     ENDIF                                          CFT014
     C           I6INC4    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN49                           CFT014
     C                     ENDIF                                          CFT014
     C           I6INC5    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN50                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Regulatory Reporting                                             CFT014
      *                                                                   CFT014
     C           I6RRPT    IFEQ 'Y   '                                    CFT014
     C                     MOVEA'111'     *IN,51                          CFT014
     C                     ENDIF                                          CFT014
     C           I6RRP1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN51                           CFT014
     C                     ENDIF                                          CFT014
     C           I6RRP2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN52                           CFT014
     C                     ENDIF                                          CFT014
     C           I6RRP3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN53                           CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0345C066
     C                     ENDIF                                          CFT014
      *
     C                     MOVEAC#ERCD    ERCD
      *
      *  If warning sent then delay confirm
      *
     C           E#WARN    IFEQ 'Y'
     C           E#RSND    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#RSND
     C                     MOVEL'1'       *IN99
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXFTS2    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************   CFT014
      /TITLE SR/SRFTS3                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRFTS3 - Validate screen3 details                            *   CFT014
      *                                                               *   CFT014
      *  Called By: DCVLDL Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FT0349    - Detail screen 3 validation program               *   CFT014
      *  MFIZ#D    - Reset fields on screen.                          *   CFT014
      *  SRERR     - Error subroutine.                                *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRFTS3    BEGSR                           *** SRFTS3 *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRFTS3'  @STK,Q                          CFT014
      **********                                                          187056 193190
      ***Check*if*'charges to the debit of' has changed,                  187056 193190
      ***recalculated charges.                                            187056 193190
      **********                                                          187056 193190
     C**********           EXSR SRRCAL                                    187056 193190
      **********                                                          CFT009 193190
      ***Check*if*'charges to the debit of' has changed,                  CFT009 193190
      ***recalculated charges.                                            CFT009 193190
      **********                                                          CFT009 193190
     C**********           EXSR SRRCAL                                    CFT009 193190
      *                                                                   CFT014
      ** Action code                                                      CFT014
      *                                                                   CFT014
     C                     MOVEL#1ACTC    S7ACTD                          CFT014
      *                                                                   CFT014
      ** Payment reference                                                CFT014
      *                                                                   CFT014
     C                     MOVEL#1PREF    S7PREF                          CFT014
      *                                                                   CFT014
      ** Charges to the debit of                                          CFT014
      *                                                                   CFT014
     C                     MOVEL#3CDRO    S7CDRO                          CFT014
      *                                                                   CFT014
      ** Charges to the debit of branch                                   CFT014
      *                                                                   CFT014
     C                     MOVEL#3CDBR    S7CDBR                          CFT014
      *                                                                   CFT014
      ** Details of Charge                                                CFT014
      *                                                                   CFT014
     C                     MOVEL#3DTCH    S7DETC                          CFT014
      *                                                                   CFT014
      ** Transfer commission                                              CFT014
      *                                                                   CFT014
     C                     MOVEL#3TRCD    S7TRCD                          CFT014
      *                                                                   CFT014
      ** FX/Change Commission                                             CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVEL#3CHCD    S7CHCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex                                                            CFT014
      *                                                                   CFT014
     C                     MOVEL#3TXCD    S7TXCD                          CFT014
      *                                                                   CFT014
      ** Cheque                                                           CFT014
      *                                                                   CFT014
     C                     MOVEL#3CQCD    S7CQCD                          CFT014
      *                                                                   CFT014
      ** Costs Abroad                                                     CFT014
      *                                                                   CFT014
     C                     MOVEL#3CSTD    S7CSTD                          CFT014
      *                                                                   CFT014
      ** SWIFT Priority                                                   CFT014
      *                                                                   CFT014
     C                     MOVEL#3SPCD    S7SPCD                          CFT014
      *                                                                   CFT014
      ** Miscellaneous                                                    CFT014
      *                                                                   CFT014
     C                     MOVEL#3MSCD    S7MSCD                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** SWIFT STANDARD                                                   CFT009
      *                                                                   CFT009
     C                     MOVELSTCD      S7STCD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM1CD      S7M1CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM2CD      S7M2CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM3CD      S7M3CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM4CD      S7M4CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM5CD      S7M5CD                          CFT009
      *                                                                   CFT009
      ** charge codes for each charge                                     CFT009
      *                                                                   CFT009
     C                     MOVELTRCDE     S7CDE1                          CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELFXCDE     S7CDE2                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELTXCDE     S7CDE3                          CFT009
     C                     MOVELCQCDE     S7CDE4                          CFT009
     C                     MOVELCACDE     S7CDE5                          CFT009
     C                     MOVELSTCDE     S7CDE6                          CFT009
     C                     MOVELSPCDE     S7CDE7                          CFT009
     C                     MOVELMSCDE     S7CDE8                          CFT009
     C                     MOVELM1CDE     S7CDE9                          CFT009
     C                     MOVELM2CDE     S7CD10                          CFT009
     C                     MOVELM3CDE     S7CD11                          CFT009
     C                     MOVELM4CDE     S7CD12                          CFT009
     C                     MOVELM5CDE     S7CD13                          CFT009
      *                                                                   CFT009
      ** If we are going from screen2 to screen 3                         CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** V.A.T. flags                                                     CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
     C                     MOVEL#3VAT1    S7VAT1                          CFT014
     C                     MOVEL#3VAT2    S7VAT2                          CFT014
     C                     MOVEL#3VAT3    S7VAT3                          CFT014
     C                     MOVEL#3VAT4    S7VAT4                          CFT014
     C                     MOVEL#3VAT5    S7VAT5                          CFT014
     C                     MOVEL#3VAT6    S7VAT6                          CFT014
     C                     MOVEL#3VAT7    S7VAT7                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** V.A.T. flags                                                     CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
     C                     MOVELVAT14     S7VT14                          CFT009
     C                     MOVELVAT9      S7VT9                           CFT009
     C                     MOVELVAT10     S7VT10                          CFT009
     C                     MOVELVAT11     S7VT11                          CFT009
     C                     MOVELVAT12     S7VT12                          CFT009
     C                     MOVELVAT13     S7VT13                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Receiver's charges remitted                                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     Z-ADDPDAM      V#PDAM                          CFT014
     C                     MOVEL#3RCDR    S7RCRM                          CFT014
      *                                                                   CFT014
      ** Sender's charges                                                 CFT014
      *                                                                   CFT014
     C                     MOVEL#3SCD1    S7SCH1                          CFT014
     C                     MOVEL#3SCD2    S7SCH2                          CFT014
     C                     MOVEL#3SCD3    S7SCH3                          CFT014
     C                     MOVEL#3SCD4    S7SCH4                          CFT014
     C                     MOVEL#3SCD5    S7SCH5                          CFT014
     C                     MOVEL#3SCC1    S7SCC1                          CFT014
     C                     MOVEL#3SCC2    S7SCC2                          CFT014
     C                     MOVEL#3SCC3    S7SCC3                          CFT014
     C                     MOVEL#3SCC4    S7SCC4                          CFT014
     C                     MOVEL#3SCC5    S7SCC5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Data structure to pass data between programs                     CFT014
      *                                                                   CFT014
     C                     MOVELPYTP      V#PYTP                          CFT014
      *                                                                   CFT014
      ** Data structure to pass data between programs                     CFT014
      ** Fields needed for error processing:                              CFT014
      ** No update indicator                                              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#NOUP                          CFT014
      *                                                                   CFT014
      ** Warning message sent                                             CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#WARN                          CFT014
      *                                                                   CFT014
      ** Message sent via FTSNMS                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#MSGS                          CFT014
      *                                                                   CFT014
      ** Program to send messages to                                      CFT014
      *                                                                   CFT014
     C                     MOVEL##PGM     E#CPGM                          CFT014
      *                                                                   CFT014
      ** Error codes to be displayed                                      CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   C#ERCD                          CFT014
     C                     MOVEL*BLANKS   I7DATA                          CFT014
      *                                                                   CFT009
      ** This is an interactive call to FT0349 therefore the STP          CFT009
      ** function is manual                                               CFT009
      *                                                                   CFT009
     C                     MOVE 'M'       STP                             CFT009
      *                                                                                       CFT017
      ** Receivers Charges Remitted                                                           CFT017
      *                                                                                       CFT017
     C           CFT009    IFEQ 'Y'                                                           CFT017
     C           #3DTCH    ANDEQ'OUR'                                                         CFT017
     C           #3RCDR    ANDEQ*BLANKS                                                       CFT017
     C           V#ADDC    ANDEQ'A'                                                           CFT017
      *                                                                                       CFT017
     C                     CLEARTRNDET                                                        CFT017
     C                     CLEARTRNEXT                                                        CFT017
      *                                                                                       CFT017
     C                     MOVE F5INBT    INBT                                                CFT017
     C                     MOVE F5ACBT    ACBT                                                CFT017
     C                     MOVELS5IBK1    INB1                                                CFT017
     C                     MOVELS5IBK2    INB2                                                CFT017
     C                     MOVELS5ACB1    ACB1                                                CFT017
     C                     MOVELS5ACB2    ACB2                                                CFT017
      *                                                                                       CFT017
     C                     MOVEL@1DBRC    TRNDET                                              CFT017
     C                     MOVELOTPXDS    TRNEXT                                              CFT017
      *                                                                                       CFT017
     C                     CALL 'FT000984'                                                    CFT017
     C                     PARM           MRTCD                                               CFT017
     C                     PARM           TRNDET                                              CFT017
     C                     PARM           TRNEXT                                              CFT017
     C                     PARM 'OP'      TYPE    2                                           CFT017
     C                     PARM           OPRCRM                                              CFT017
      *                                                                                       CFT017
      ** Get currency details of BKEURO                                                       CFT017
     C                     MOVE PCCY      WCURCY                                              CFT017
     C                     Z-ADD84        WERNB                                               CFT017
     C                     EXSR SRACCY                                                        CFT017
      *                                                                                       CFT017
      ** Format amount                                                                        CFT017
     C                     MOVE *BLANKS   ZFIELD                                              CFT017
     C                     MOVE OPRCRM    ZFIELD                                              CFT017
     C                     CALL 'ZEDIT'                                                       CFT017
     C                     PARM           ZFIELD                                              CFT017
     C                     PARM A6NBDP    ZADEC                                               CFT017
     C                     MOVE ZFIELD    S7RCRM                                              CFT017
      *                                                                                       CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Determine if MIF is applicable for this transaction                                  CFT017
      *                                                                                       CFT017
     C           CFT017    IFEQ 'Y'                                                           CFT017
     C                     EXSR SRMIF                                                         CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** If MIF = 'Y', default receiver's charges to multilateral                             CFT017
      ** inter-bank fee defined in FT ICD.                                                    CFT017
      *                                                                                       CFT017
     C           V#MIFF    IFEQ 'Y'                                                           CFT017
     C           #3RCDR    ANDEQ*BLANKS                                                       CFT017
      *                                                                                       CFT017
      ** Get currency details of BKEURO                                                       CFT017
     C                     MOVE BKEURO    WCURCY                                              CFT017
     C                     Z-ADD83        WERNB                                               CFT017
     C                     EXSR SRACCY                                                        CFT017
      *                                                                                       CFT017
      ** Format amount                                                                        CFT017
     C                     MOVE *BLANKS   ZFIELD                                              CFT017
     C                     MOVE BTMIFE    ZFIELD                                              CFT017
     C                     CALL 'ZEDIT'                                                       CFT017
     C                     PARM           ZFIELD                                              CFT017
     C                     PARM A6NBDP    ZADEC                                               CFT017
     C                     MOVE ZFIELD    S7RCRM                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                   CFT014
      ** Call screen3 validation program                                  CFT014
      *                                                                   CFT014
     C                     CALL 'FT0349'               9090               CFT014
     C                     PARM           P@RTCD                          CFT014
     C                     PARM '*VALID'  W0ACT                           CFT014
     C                     PARM           S7DATA                          CFT014
     C                     PARM           V#DATA                          CFT014
     C                     PARM           F7DATA                          CFT014
     C                     PARM           E#DATA                          CFT014
     C                     PARM           C#DATA                          CFT014
     C                     PARM           I7DATA                          CFT014
     C                     PARM           STP     1                       CFT009
      *                                                                   CFT014
      ** Error calling validation program                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           P@RTCD    ORNE *BLANKS                                   CFT014
     C                     MOVEL'FT0349  'W0FILE                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     Z-ADD35        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Move back validated data:                                        CFT014
      ** Charges to the debit of                                          CFT014
      *                                                                   CFT014
     C                     MOVELS7CDRO    #3CDRO                          CFT014
      *                                                                   CFT014
      ** Charges to the debit of branch                                   CFT014
      *                                                                   CFT014
     C                     MOVELS7CDBR    #3CDBR                          CFT014
      *                                                                   CFT014
      ** Details of Charge                                                CFT014
      *                                                                   CFT014
     C                     MOVELS7DETC    #3DTCH                          CFT014
      *                                                                   CFT014
      ** Transfer and Commission                                          CFT014
      *                                                                   CFT014
     C                     MOVELS7TRCD    #3TRCD                          CFT014
      *                                                                   CFT014
      ** FX/Change Commission                                             CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELS7CHCD    #3CHCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex                                                            CFT014
      *                                                                   CFT014
     C                     MOVELS7TXCD    #3TXCD                          CFT014
      *                                                                   CFT014
      ** Cheque                                                           CFT014
      *                                                                   CFT014
     C                     MOVELS7CQCD    #3CQCD                          CFT014
      *                                                                   CFT014
      ** Costs Abroad                                                     CFT014
      *                                                                   CFT014
     C                     MOVELS7CSTD    #3CSTD                          CFT014
      *                                                                   CFT014
      ** SWIFT Priority                                                   CFT014
      *                                                                   CFT014
     C                     MOVELS7SPCD    #3SPCD                          CFT014
      *                                                                   CFT014
      ** Miscellaneous                                                    CFT014
      *                                                                   CFT014
     C                     MOVELS7MSCD    #3MSCD                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** SWIFT STANDARD                                                   CFT009
      *                                                                   CFT009
     C                     MOVELS7STCD    STCD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS7M1CD    M1CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS7M2CD    M2CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS7M3CD    M3CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS7M4CD    M4CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS7M5CD    M5CD                            CFT009
      *                                                                   CFT009
      ** CHARGE CODES FOR  ALL FIELDS                                     CFT009
      *                                                                   CFT009
     C                     MOVELS7CDE1    TRCDE                           CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELS7CDE2    FXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELS7CDE3    TXCDE                           CFT009
     C                     MOVELS7CDE4    CQCDE                           CFT009
     C                     MOVELS7CDE5    CACDE                           CFT009
     C                     MOVELS7CDE6    STCDE                           CFT009
     C                     MOVELS7CDE7    SPCDE                           CFT009
     C                     MOVELS7CDE8    MSCDE                           CFT009
     C                     MOVELS7CDE9    M1CDE                           CFT009
     C                     MOVELS7CD10    M2CDE                           CFT009
     C                     MOVELS7CD11    M3CDE                           CFT009
     C                     MOVELS7CD12    M4CDE                           CFT009
     C                     MOVELS7CD13    M5CDE                           CFT009
      *                                                                   CFT009
      **Receivers*Charges*Remitted*                                                    CFT009 CFT017
      ** The codes below are moved before call to FT0349.                              CFT009 CFT017
     C********** #3DTCH    IFEQ 'OUR'                                                  CFT009 CFT017
     C********** #3RCDR    ANDEQ*BLANKS                                                CFT009 CFT017
     C********** V#ADDC    ANDEQ'A'                                                    CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           CLEARTRNDET                                                 CFT009 CFT017
     C**********           CLEARTRNEXT                                                 CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           MOVE F5INBT    INBT                                         CFT009 CFT017
     C**********           MOVE F5ACBT    ACBT                                         CFT009 CFT017
     C**********           MOVELS5IBK1    INB1                                         CFT009 CFT017
     C**********           MOVELS5ACB1    ACB1                                         CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           MOVEL@1DBRC    TRNDET                                       CFT009 CFT017
     C**********           MOVELOTPXDS    TRNEXT                                       CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           CALL 'FT000984'                                             CFT009 CFT017
     C**********           PARM           MRTCD                                        CFT009 CFT017
     C**********           PARM           TRNDET                                       CFT009 CFT017
     C**********           PARM           TRNEXT                                       CFT009 CFT017
     C**********           PARM 'OP'      TYPE    2                                    CFT009 CFT017
     C**********           PARM           OPRCRM                                       CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           Z-ADDOPRCRM    F7RCRM                                       CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C**********           ENDIF                                                       CFT009 CFT017
      **********                                                                       CFT009 CFT017
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** V.A.T. flags                                                     CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
     C           TRCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT1    #3VAT1                          CFT014
     C                     ENDIF                                          CFT009
     C           TXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT2    #3VAT2                          CFT014
     C                     ENDIF                                          CFT009
     C           CQCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT3    #3VAT3                          CFT014
     C                     ENDIF                                          CFT009
     C           CACDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT4    #3VAT4                          CFT014
     C                     ENDIF                                          CFT009
     C           SPCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT5    #3VAT5                          CFT014
     C                     ENDIF                                          CFT009
     C           MSCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT6    #3VAT6                          CFT014
     C                     ENDIF                                          CFT009
     C           FXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VAT7    #3VAT7                          CFT014
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT014
      ** V.A.T. flags                                                     CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
     C           STCDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT14    VAT14                           CFT009
     C                     ENDIF                                          CFT009
     C           M1CDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT9     VAT9                            CFT009
     C                     ENDIF                                          CFT009
     C           M2CDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT10    VAT10                           CFT009
     C                     ENDIF                                          CFT009
     C           M3CDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT11    VAT11                           CFT009
     C                     ENDIF                                          CFT009
     C           M4CDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT12    VAT12                           CFT009
     C                     ENDIF                                          CFT009
     C           M5CDE     IFNE *BLANKS                                   CFT009
     C                     MOVELS7VT13    VAT13                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Receiver's charges remitted                                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVELS7RCRM    #3RCDR                          CFT014
      *                                                                   CFT014
      ** Sender's charges                                                 CFT014
      *                                                                   CFT014
     C                     MOVELS7SCH1    #3SCD1                          CFT014
     C                     MOVELS7SCH2    #3SCD2                          CFT014
     C                     MOVELS7SCH3    #3SCD3                          CFT014
     C                     MOVELS7SCH4    #3SCD4                          CFT014
     C                     MOVELS7SCH5    #3SCD5                          CFT014
     C                     MOVELS7SCC1    #3SCC1                          CFT014
     C                     MOVELS7SCC2    #3SCC2                          CFT014
     C                     MOVELS7SCC3    #3SCC3                          CFT014
     C                     MOVELS7SCC4    #3SCC4                          CFT014
     C                     MOVELS7SCC5    #3SCC5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initialise charges                                               CFT014
      *                                                                   CFT014
     C                     EXSR MFIZ#D                                    CFT014
      *                                                                   CFT014
      ** Check if 'charges to the debit of' has changed.  Recalculate                         193190
      ** charges if no error in validation.                                                   193190
      *                                                                                       193190
     C           I7CDRT    IFEQ *BLANKS                                                       193190
     C           I7CDBR    ANDEQ*BLANKS                                                       193190
     C                     EXSR SRRCAL                                                        193190
     C                     ENDIF                                                              193190
      *                                                                                       193190
      ** Re-send screen indicator                                         CFT014
      *                                                                   CFT014
     C           E#NOUP    IFNE *BLANKS                                   CFT014
     C           WREDSP    OREQ 'Y'                                       187056
     C                     MOVE *ON       *IN99                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Charges to the debit of                                          CFT014
      *                                                                   CFT014
     C           I7CDRT    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN31                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Charges to the debit of branch                                   CFT014
      *                                                                   CFT014
     C           I7CDBR    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN32                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Details of charges                                               CFT014
      *                                                                   CFT014
     C           I7DETC    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN33                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Transfer commission                                              CFT014
      *                                                                   CFT014
     C           I7TRCM    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN34                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** FX/Change commission                                             CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C           I7CHCM    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN35                           CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex                                                            CFT014
      *                                                                   CFT014
     C           I7TXCH    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN36                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque                                                           CFT014
      *                                                                   CFT014
     C           I7CQCH    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN37                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Costs abroad                                                     CFT014
      *                                                                   CFT014
     C           I7CSTH    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN38                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** SWIFT priority                                                   CFT014
      *                                                                   CFT014
     C           I7SPCH    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN39                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous charge                                             CFT014
      *                                                                   CFT014
     C           I7MSCH    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN40                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES)                                 CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** SWIFT STANDARD                                                   CFT009
      *                                                                   CFT009
     C           I7STCD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN72                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C           I7M1CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN92                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C           I7M2CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN95                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C           I7M3CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN54                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C           I7M4CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN57                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C           I7M5CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN60                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** CODES FOR  ALL FIELDS                                            CFT009
      *                                                                   CFT009
     C           I7CDE1    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN66                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C           I7CDE2    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN67                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE3    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN68                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE4    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN69                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE5    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN70                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE6    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN71                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE7    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN84                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE8    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN87                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CDE9    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN88                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CD10    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN94                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CD11    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN97                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CD12    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN56                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I7CD13    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN59                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** If switchable feature S01499 is switched ON check error on       CFT014
      ** V.A.T. flags                                                     CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer Commission V.A.T. Flag                                  CFT014
      *                                                                   CFT014
     C           I7VAT1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN41                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex V.A.T flag                                                 CFT014
      *                                                                   CFT014
     C           I7VAT2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN42                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque V.A.T. Flag                                               CFT014
      *                                                                   CFT014
     C           I7VAT3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN43                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Costs V.A.T. Flag                                                CFT014
      *                                                                   CFT014
     C           I7VAT4    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN44                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** SWIFT Priority V.A.T. Flag                                       CFT014
      *                                                                   CFT014
     C           I7VAT5    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN45                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous V.A.T. Flag                                        CFT014
      *                                                                   CFT014
     C           I7VAT6    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN46                           CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
      ** FX/Change Commission V.A.T. Flag                                 CFT014
      *                                                                   CFT014
     C           I7VAT7    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN47                           CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      ** V.A.T. flags                                                     CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Swift Standard VAT flag                                          CFT009
      *                                                                   CFT009
     C           I7VT14    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN83                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 1 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I7VT9     IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN93                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 2 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I7VT10    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN96                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 3 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I7VT11    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN55                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 4 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I7VT12    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN58                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 5 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I7VT13    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN65                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Receiver's remitted charges                                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           I7RCRM    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN48                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Sender's charges deducted                                        CFT014
      *                                                                   CFT014
     C           I7SCH1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN49                           CFT014
     C                     ENDIF                                          CFT014
     C           I7SCH2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN50                           CFT014
     C                     ENDIF                                          CFT014
     C           I7SCH3    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN51                           CFT014
     C                     ENDIF                                          CFT014
     C           I7SCH4    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN52                           CFT014
     C                     ENDIF                                          CFT014
     C           I7SCH5    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN53                           CFT014
     C                     ENDIF                                          CFT014
     C           I7SCC1    IFNE *BLANKS                                   CFT014
     C***********          MOVE *ON       *IN54                    CFT014 CFT009
     C                     MOVE *ON       *IN26                           CFT009
     C                     ENDIF                                          CFT014
     C           I7SCC2    IFNE *BLANKS                                   CFT014
     C***********          MOVE *ON       *IN55                    CFT014 CFT009
     C                     MOVE *ON       *IN27                           CFT009
     C                     ENDIF                                          CFT014
     C           I7SCC3    IFNE *BLANKS                                   CFT014
     C***********          MOVE *ON       *IN56                    CFT014 CFT009
     C                     MOVE *ON       *IN28                           CFT009
     C                     ENDIF                                          CFT014
     C           I7SCC4    IFNE *BLANKS                                   CFT014
     C***********          MOVE *ON       *IN57                    CFT014 CFT009
     C                     MOVE *ON       *IN29                           CFT009
     C                     ENDIF                                          CFT014
     C           I7SCC5    IFNE *BLANKS                                   CFT014
     C***********          MOVE *ON       *IN58                    CFT014 CFT009
     C                     MOVE *ON       *IN30                           CFT009
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If warning sent then delay confirm                               CFT014
      *                                                                   CFT014
     C           E#WARN    IFEQ 'Y'                                       CFT014
     C           E#RSND    ANDEQ*BLANKS                                   CFT014
     C                     MOVEL'Y'       E#RSND                          CFT014
     C                     MOVE *ON       *IN99                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRMIF - Determine if MIF is applicable                       *                       CFT017
      *                                                               *                       CFT017
      *  Called By: Main processing                                   *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRMIF     BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL*BLANK    V#MIFF                                              CFT017
      *                                                                                       CFT017
      ** Check if Sender and Intermediary Bank/Account with Bank are                          CFT017
      ** located in two different EEA member countries by getting                             CFT017
      ** their ISO country codes.                                                             CFT017
      *                                                                                       CFT017
     C                     EXSR SRSISO                                                        CFT017
     C           WCNCD     IFEQ *BLANKS                                                       CFT017
     C           WSCNCD    OREQ *BLANKS                                                       CFT017
     C           WCNCD     OREQ WSCNCD                                                        CFT017
     C                     GOTO ENDMIF                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Go to end of subroutine if the following condistions                                 CFT017
      ** are not met.                                                                         CFT017
      ** 1. payment currency is in Euro                                                       CFT017
      ** 2. payment amount is less than or equal to the MIF                                   CFT017
      ** threshold defined in ICD                                                             CFT017
      ** 3. details of charges is 'OUR' and Add/Deduct ind is 'A'                             CFT017
      *                                                                                       CFT017
     C           PCCY      IFNE BKEURO                                                        CFT017
     C           PYAM      ORGT BTMIFT                                                        CFT017
     C           S7DETC    ORNE 'OUR'                                                         CFT017
     C           V#ADDC    ORNE 'A'                                                           CFT017
     C                     GOTO ENDMIF                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Beneficiary must be an IBAN account                                                  CFT017
      *                                                                                       CFT017
     C                     MOVELS5BNC1    WSLSH                                               CFT017
     C           WSLSH     IFEQ '/'                                                           CFT017
     C           34        SUBSTS5BNC1:2  PIBN                                                CFT017
     C                     ELSE                                                               CFT017
     C                     MOVELS5BNC1    PIBN                                                CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL'I'       WACCS   1                                           CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C           PRTCD     ANDNE'      6'                                                     CFT017
     C                     GOTO ENDMIF                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Source of Payment must be an MT103.                                                  CFT017
      *                                                                                       CFT017
     C                     EXSR SRM103                                                        CFT017
     C           WM103     IFNE 'Y'                                                           CFT017
     C                     GOTO ENDMIF                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** If all conditions were satisfied, set MIF flag to 'Y'                                CFT017
      *                                                                                       CFT017
     C                     MOVEL'Y'       V#MIFF                                              CFT017
      *                                                                                       CFT017
     C           ENDMIF    ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRSISO - Determine ISO country code                          *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRMIF                                             *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRSISO    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL'Y'       WSISO   1                                           CFT017
     C                     MOVEL*BLANKS   WSCNCD  2                                           CFT017
     C                     MOVEL*BLANKS   WSNDTP  1                                           CFT017
     C                     MOVEL*BLANKS   WSNDID 35                                           CFT017
     C                     MOVEL*BLANKS   WSNDI2 35                                           CFT017
      *                                                                                       CFT017
      ** Check if booking branch has an ISO country code                                      CFT017
     C                     MOVELBRCA      WMBRCA                                              CFT017
     C                     EXSR SRBISO                                                        CFT017
      *                                                                                       CFT017
      ** Do not proceed if error in country code or                                           CFT017
      ** country is not an EEA member                                                         CFT017
     C           WCNCD     IFEQ *BLANKS                                                       CFT017
     C                     GOTO ENSISO                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     MOVELWCNCD     WSCNCD                                              CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
      *                                                                                       CFT017
      ** Get the other field's country code                                                   CFT017
      ** Get country code of Intermediary if present                                          CFT017
      *                                                                                       CFT017
     C           S5IBK1    IFNE *BLANKS                                                       CFT017
     C                     MOVELF5INBT    WSNDTP                                              CFT017
     C                     MOVELS5IBK1    WSNDID                                              CFT017
     C                     MOVELS5IBK2    WSNDI2                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     ELSE                                                               CFT017
      *                                                                                       CFT017
      ** Else get country code of Account with Bank if present                                CFT017
      *                                                                                       CFT017
     C           S5ACB1    IFNE *BLANKS                                                       CFT017
     C           F5ACBT    IFEQ 'N'                                                           CFT017
     C                     MOVELPCCY      PCYCD                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     MOVELF5ACBT    WSNDTP                                              CFT017
     C                     MOVELS5ACB1    WSNDID                                              CFT017
     C                     MOVELS5ACB2    WSNDI2                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL'N'       WSISO                                               CFT017
      *                                                                                       CFT017
     C           ENSISO    ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRBISO - Determine Branch ISO country code                   *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRSISO                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRBISO    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
     C                     MOVEL*BLANKS   WWCUS                                               CFT017
      *                                                                                       CFT017
      ** If multi-branching environment access branch file thru                               CFT017
      ** booking branch, otherwise thru single branch code                                    CFT017
      *                                                                                       CFT017
     C           WUMBIN    IFNE 'Y'                                                           CFT017
     C                     MOVELBJSBRC    WMBRCA  3                                           CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Get SWIFT Id via access object AOBRCHR0                                              CFT017
      *                                                                                       CFT017
     C                     MOVE 'B'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENBISO                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     SELEC                                                              CFT017
      *                                                                                       CFT017
      ** Get ISO Country code via SWIFT Id.                                                   CFT017
      *                                                                                       CFT017
     C           A8BTID    WHNE *BLANKS                                                       CFT017
     C           2         SUBSTA8BTID:5  WCNCD                                               CFT017
      *                                                                                       CFT017
      ** No SWIFT Id., get ISO Country code via location code.                                CFT017
      *                                                                                       CFT017
     C           A8LCCD    WHNE *BLANK                                                        CFT017
     C                     MOVELA8LCCD    WLCCD   3                                           CFT017
     C                     MOVE 'L'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENBISO                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     MOVELDVCNCD    WCNCD                                               CFT017
     C                     MOVE 'O'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
     C                     GOTO ENBISO                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Otherwise, use customer number to derive the ISO Country Code.                       CFT017
      *                                                                                       CFT017
     C                     OTHER                                                              CFT017
     C                     MOVELA8BICN    WWCUS                                               CFT017
     C                     MOVE 'C'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENBISO                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           BBCSID    IFNE *BLANK                                                        CFT017
     C           2         SUBSTBBCSID:5  WCNCD                                               CFT017
     C                     ELSE                                                               CFT017
      *                                                                                       CFT017
      ** No SWIFT id, get country code                                                        CFT017
      ** Get ISO Country Code via access object AOCTRYR0                                      CFT017
     C                     MOVELBBCOLC    WCNCD                                               CFT017
     C                     MOVE 'O'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
     C                     GOTO ENBISO                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDSL                                                              CFT017
      *                                                                                       CFT017
     C           WCNCD     IFNE *BLANKS                                                       CFT017
     C                     EXSR SRCNCD                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           ENBISO    ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRCSID - Determine SWIFT id                                  *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRMIF                                             *                       CFT017
      *             SRSISO                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRCSID    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL*BLANKS   WWCUS  10                                           CFT017
     C                     MOVEL*BLANKS   WCSID  11                                           CFT017
     C                     MOVELWSNDID    WSLSH   1                                           CFT017
     C                     MOVELWSNDID    WSNDIB 35                                           CFT017
      *                                                                                       CFT017
     C           WSLSH     IFEQ '/'                                                           CFT017
     C           WSNDI2    ANDNE*BLANKS                                                       CFT017
     C                     MOVELWSNDI2    WSNDID                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     SELEC                                                              CFT017
      *                                                                                       CFT017
      ** Nostro                                                                               CFT017
     C           WSNDTP    WHEQ 'F'                                                           CFT017
     C           WSNDTP    OREQ 'N'                                                           CFT017
      *                                                                                       CFT017
     C           WSNDTP    IFEQ 'F'                                                           CFT017
     C                     MOVELWSNDID    PCYCD                                               CFT017
     C           2         SUBSTWSNDID:4  PNONB                                               CFT017
     C                     ELSE                                                               CFT017
     C                     MOVELWSNDID    PNONB                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     MOVEL'N'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFEQ *BLANKS                                                       CFT017
     C                     MOVELA7CUST    WWCUS                                               CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Retail                                                                               CFT017
     C           WSNDTP    WHEQ 'R'                                                           CFT017
     C                     MOVE *BLANKS   PPSTR  35                                           CFT017
     C                     MOVELWSNDID    PPSTR                                               CFT017
     C                     MOVEL'A'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFEQ *BLANKS                                                       CFT017
     C                     MOVELCNUM      WWCUS                                               CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Customer                                                                             CFT017
     C           WSNDTP    WHEQ 'C'                                                           CFT017
     C                     MOVELWSNDID    WWCUS                                               CFT017
      *                                                                                       CFT017
      ** Full account/partial account                                                         CFT017
     C           WSNDTP    WHEQ 'G'                                                           CFT017
     C           WSNDTP    OREQ 'P'                                                           CFT017
     C           6         SUBSTWSNDID:1  WWCUS                                               CFT017
      *                                                                                       CFT017
      ** SWIFT id                                                                             CFT017
     C           WSNDTP    WHEQ 'S'                                                           CFT017
     C                     MOVELWSNDID    WCSID                                               CFT017
     C           2         SUBSTWCSID:5   WCNCD   2                                           CFT017
      *                                                                                       CFT017
      ** IBAN or Address                                                                      CFT017
     C           WSNDTP    WHEQ 'I'                                                           CFT017
     C           WSNDTP    OREQ 'A'                                                           CFT017
     C           WSLSH     IFEQ '/'                                                           CFT017
     C           34        SUBSTWSNDIB:2  PIBN                                                CFT017
     C                     ELSE                                                               CFT017
     C                     MOVELWSNDIB    PIBN                                                CFT017
     C                     ENDIF                                                              CFT017
     C                     MOVEL'I'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFEQ *BLANKS                                                       CFT017
     C                     MOVELCNUM      WWCUS                                               CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDSL                                                              CFT017
      *                                                                                       CFT017
     C                     MOVEL*BLANKS   WSNDID                                              CFT017
     C                     MOVEL*BLANKS   WSNDI2                                              CFT017
      *                                                                                       CFT017
      ** If customer is entered, check if there is SWIFT Id                                   CFT017
      ** attached to it.                                                                      CFT017
      *                                                                                       CFT017
     C           WWCUS     IFNE *BLANKS                                                       CFT017
     C                     MOVEL'C'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENCSID                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           BBCSID    IFNE *BLANKS                                                       CFT017
     C                     MOVELBBCSID    WCSID                                               CFT017
     C           2         SUBSTWCSID:5   WCNCD                                               CFT017
     C                     ELSE                                                               CFT017
      *                                                                                       CFT017
      ** No SWIFT id, get country code                                                        CFT017
      ** Get ISO Country Code via access object AOCTRYR0                                      CFT017
     C           WSISO     IFEQ 'Y'                                                           CFT017
     C                     MOVELBBCOLC    WCNCD                                               CFT017
     C                     MOVE 'O'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Get ISO country code                                                                 CFT017
      *                                                                                       CFT017
     C           WCNCD     IFNE *BLANKS                                                       CFT017
     C           WSISO     ANDEQ'Y'                                                           CFT017
     C                     EXSR SRCNCD                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           ENCSID    ENDSR                                                              CFT017
      *                                                                                       CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRACCS - Process using access object                         *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRMIF                                             *                       CFT017
      *             SRSISO                                            *                       CFT017
      *             SRBISO                                            *                       CFT017
      *             SRCSID                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRACCS    BEGSR                                                              CFT017
      *                                                                                       CFT017
      ** Access detail file according to access indicator                                     CFT017
      *                                                                                       CFT017
     C                     SELEC                                                              CFT017
      *                                                                                       CFT017
      ** Customer                                                                             CFT017
     C           WACCS     WHEQ 'C'                                                           CFT017
     C                     CALL 'AOCUSTR0'                                                    CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM '*KEY   ' POPTN                                               CFT017
     C                     PARM WWCUS     PKEY1  10                                           CFT017
     C                     PARM *BLANKS   PKYST   7                                           CFT017
     C           SDCUST    PARM SDCUST    DSSDY                                               CFT017
      *                                                                                       CFT017
      ** Nostro                                                                               CFT017
     C           WACCS     WHEQ 'N'                                                           CFT017
     C                     CALL 'AONOSTR0'                                                    CFT017
     C                     PARM *BLANKS   PRTCD   7                                           CFT017
     C                     PARM '*KEY   ' POPTN   7                                           CFT017
     C                     PARM *BLANKS   PCNOM   6                                           CFT017
     C                     PARM           PCYCD   3                                           CFT017
     C**********           PARM *BLANKS   PACCN   4                                    CFT017 CFT017
     C                     PARM *BLANKS   PACCN  10                                           CGL029
     C                     PARM *BLANKS   PACSN   2                                           CFT017
     C                     PARM           PNONB   2                                           CFT017
     C                     PARM *BLANKS   PBRCD   3                                           CFT017
     C                     PARM *BLANKS   PCSSN  10                                           CFT017
     C                     PARM *BLANKS   PPNOI   1                                           CFT017
     C           SDNOST    PARM SDNOST    DSFDY                                               CFT017
      *                                                                                       CFT017
      ** Location                                                                             CFT017
     C           WACCS     WHEQ 'L'                                                           CFT017
     C                     CALL 'AOLOCNR0'                                                    CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM '*KEY   ' POPTN                                               CFT017
     C                     PARM WLCCD     PLOCN   3                                           CFT017
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CFT017
      *                                                                                       CFT017
      ** Country Code                                                                         CFT017
     C           WACCS     WHEQ 'O'                                                           CFT017
     C                     CALL 'AOCTRYR0'                                                    CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM '*KEY   ' POPTN                                               CFT017
     C                     PARM WCNCD     PCTCD   2                                           CFT017
     C           SDCTRY    PARM SDCTRY    DSFDY                                               CFT017
      *                                                                                       CFT017
      ** Branch                                                                               CFT017
     C           WACCS     WHEQ 'B'                                                           CFT017
     C**********           CALL 'AOBRCHR0'                                             CFT017 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM '*KEY   ' POPTN                                               CFT017
     C                     PARM WMBRCA    PBRCD   3                                           CFT017
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CFT017 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                                       CFT017
      ** Branch                                                                               CFT017
     C           WACCS     WHEQ 'A'                                                           CFT017
     C                     CALL 'AOACCTV1'                                                    CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM *BLANKS   POPTN                                               CFT017
     C                     PARM           PPSTR                                               CFT017
     C           SDACCT    PARM *BLANKS   DSSDY                                               CFT017
      *                                                                                       CFT017
      ** IBAN                                                                                 CFT017
     C           WACCS     WHEQ 'I'                                                           CFT017
     C                     CALL 'AOIBANR2'                                                    CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM           PIBN   34                                           CFT017
     C           SDACCT    PARM *BLANKS   DSSDY                                               CFT017
      *                                                                                       CFT017
     C                     ENDSL                                                              CFT017
      *                                                                                       CFT017
     C                     ENDSR                                                              CFT017
      *                                                                                       CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRCNCD - Get country code                                    *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRCSID                                            *                       CFT017
      *             SRBISO                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRCNCD    BEGSR                                                              CFT017
      *                                                                                       CFT017
      ** Get ISO country code. Country must be an EEA member.                                 CFT017
      *                                                                                       CFT017
     C           WCNCD     CHAINMEISOCL1             01                                       CFT017
      *                                                                                       CFT017
     C           *IN01     IFEQ *ON                                                           CFT017
     C           M3EEAM    ORNE 'Y'                                                           CFT017
     C                     MOVEL*BLANKS   WCNCD                                               CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRM103 - Determine if source of payment is MT103             *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRMIF                                             *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRM103    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVE *BLANK    WM103   1                                           CFT017
     C                     MOVE *BLANK    WBTBK                                               CFT017
     C                     MOVE *BLANKS   WCSID                                               CFT017
     C                     MOVE *BLANKS   WWCUS                                               CFT017
      *                                                                                       CFT017
      ** Check if beneficiary is a non-bank. At this stage,                                   CFT017
      ** beneficiary could only be an IBAN account.                                           CFT017
      *                                                                                       CFT017
     C           PRTCD     IFEQ *BLANKS                                                       CFT017
     C                     MOVELCNUM      WWCUS                                               CFT017
     C                     MOVEL'C'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C           BBBNBI    OREQ 'Y'                                                           CFT017
      *                                                                                       CFT017
     C                     MOVEL*BLANKS   WWCUS                                               CFT017
      *                                                                                       CFT017
      ** Otherwise, check if ordering customer is non-bank.                                   CFT017
      *                                                                                       CFT017
     C                     SELEC                                                              CFT017
     C           ORCT      WHEQ 'C'                                                           CFT017
     C                     MOVELORC1      WWCUS                                               CFT017
     C           ORCT      WHEQ 'S'                                                           CFT017
     C                     MOVELORC1      WCSID                                               CFT017
     C                     OTHER                                                              CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDSL                                                              CFT017
      *                                                                                       CFT032
     C                     MOVELORC1      WC1     1                                           CFT032
     C           WC1       IFEQ '/'                                                           CFT032
     C                     SELEC                                                              CFT032
     C           ORCT      WHEQ 'C'                                                           CFT032
     C                     MOVELORC2      WWCUS                                               CFT032
     C           ORCT      WHEQ 'S'                                                           CFT032
     C                     MOVELORC2      WCSID                                               CFT032
     C                     ENDSL                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT017
      ** Ordering cust entered is a SWIFT id. Get customer                                    CFT017
      ** attached to it.                                                                      CFT017
      *                                                                                       CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     EXSR SR1400                                                        CFT017
     C           PCNUM     IFEQ 'Y'                                                           CFT017
     C           BBBNBI    IFEQ 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ELSE                                                               CFT017
     C           PCNST     IFEQ 'Y'                                                           CFT017
     C                     MOVELAWCSN1    WWCUS                                               CFT017
     C                     MOVE AWCSN2    WWCUS                                               CFT017
     C                     ELSE                                                               CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           WWCUS     IFNE *BLANKS                                                       CFT017
     C                     MOVEL'C'       WACCS                                               CFT017
     C                     EXSR SRACCS                                                        CFT017
     C           PRTCD     IFNE *BLANKS                                                       CFT017
     C           BBBNBI    OREQ 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Check if any of these fields are entered as a SWIFT BIC or                           CFT017
      ** input can be linked to a SWIFT BIC.                                                  CFT017
      ** 1. Ordering bank                                                                     CFT017
      ** 2. Sender's Correspondent                                                            CFT017
      ** 3. Receiver's Correspondent                                                          CFT017
      ** 4. Intermediary                                                                      CFT017
      ** 5. Account with Bank                                                                 CFT017
      *                                                                                       CFT017
     C                     EXSR SRSBIC                                                        CFT017
      *                                                                                       CFT017
      ** If SWIFT id is present, check if it exists in BIC directory                          CFT017
      *                                                                                       CFT017
     C           WCSID     IFEQ *BLANKS                                                       CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Intruction code fields may only contain SDVA, INTC and CORT                          CFT017
      *                                                                                       CFT017
     C           S6INC1    IFNE *BLANKS                                                       CFT017
     C           S6INC1    ANDNE'SDVA'                                                        CFT017
     C           S6INC1    ANDNE'CORT'                                                        CFT017
     C           S6INC1    ANDNE'INTC'                                                        CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           S6INC2    IFNE *BLANKS                                                       CFT017
     C           S6INC2    ANDNE'SDVA'                                                        CFT017
     C           S6INC2    ANDNE'CORT'                                                        CFT017
     C           S6INC2    ANDNE'INTC'                                                        CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           S6INC3    IFNE *BLANKS                                                       CFT017
     C           S6INC3    ANDNE'SDVA'                                                        CFT017
     C           S6INC3    ANDNE'CORT'                                                        CFT017
     C           S6INC3    ANDNE'INTC'                                                        CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           S6INC4    IFNE *BLANKS                                                       CFT017
     C           S6INC4    ANDNE'SDVA'                                                        CFT017
     C           S6INC4    ANDNE'CORT'                                                        CFT017
     C           S6INC4    ANDNE'INTC'                                                        CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C           S6INC5    IFNE *BLANKS                                                       CFT017
     C           S6INC5    ANDNE'SDVA'                                                        CFT017
     C           S6INC5    ANDNE'CORT'                                                        CFT017
     C           S6INC5    ANDNE'INTC'                                                        CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Bank to Bank info                                                                    CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB1    WWBTBK 35                                           CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB2    WWBTBK                                              CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB3    WWBTBK                                              CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB4    WWBTBK                                              CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB5    WWBTBK                                              CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVELS6BTB6    WWBTBK                                              CFT017
     C                     EXSR SRBTBK                                                        CFT017
     C           WBTBK     IFNE 'Y'                                                           CFT017
     C                     GOTO ENM103                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** If all conditions were satisfied, set ind to 'Y'                                     CFT017
      *                                                                                       CFT017
     C                     MOVEL'Y'       WM103                                               CFT017
      *                                                                                       CFT017
     C           ENM103    ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRSBIC - Check if field is attached to SWIFT BIC             *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRM103                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRSBIC    BEGSR                                                              CFT017
      *                                                                                       CFT017
      ** Ordering bank is SWIFT id                                                            CFT017
     C                     MOVELORBT      WSNDTP                                              CFT017
     C           ORBT      IFEQ 'R'                                                           CFT017
     C                     MOVELORBK      WSND10 10                                           CFT017
     C                     MOVELWSND10    WSNDID                                              CFT017
     C                     ELSE                                                               CFT017
     C                     MOVELORBK      WSNDID                                              CFT017
     C                     ENDIF                                                              CFT017
     C           ORBT      IFEQ 'N'                                                           CFT017
     C                     MOVELSMCY      PCYCD                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENSBIC                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Sender's Correspondent is SWIFT id                                                   CFT017
     C                     MOVELSNCT      WSNDTP                                              CFT017
     C                     MOVELSNCO      WSNDID                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENSBIC                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Receiver's correspondent                                                             CFT017
     C                     MOVELF5RCOT    WSNDTP                                              CFT017
     C                     MOVELS5RCO1    WSNDID                                              CFT017
     C                     MOVELS5RCO2    WSNDI2                                              CFT017
     C           F5RCOT    IFEQ 'N'                                                           CFT017
     C                     MOVELSMCY      PCYCD                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENSBIC                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Third Reimbursement Institution                                                      CFT017
     C                     MOVELF5TRIT    WSNDTP                                              CFT017
     C                     MOVELS5TRI1    WSNDID                                              CFT017
     C                     MOVELS5TRI2    WSNDI2                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENSBIC                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Intermediary                                                                         CFT017
     C                     MOVELF5INBT    WSNDTP                                              CFT017
     C                     MOVELS5IBK1    WSNDID                                              CFT017
     C                     MOVELS5IBK2    WSNDI2                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
     C                     GOTO ENSBIC                                                        CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** Account with Bank                                                                    CFT017
     C                     MOVELF5ACBT    WSNDTP                                              CFT017
     C                     MOVELS5ACB1    WSNDID                                              CFT017
     C                     MOVELS5ACB2    WSNDI2                                              CFT017
     C           F5ACBT    IFEQ 'N'                                                           CFT017
     C                     MOVELPCCY      PCYCD                                               CFT017
     C                     ENDIF                                                              CFT017
     C                     EXSR SRCSID                                                        CFT017
     C                     EXSR SR1400                                                        CFT017
      *                                                                                       CFT017
     C           ENSBIC    ENDSR                                                              CFT017
      *                                                                                       CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SR1400 - Call ME1400 to check valid SWIFT address            *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRSBIC                                            *                       CFT017
      *             SRBTBK                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SR1400    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C           WCSID     IFNE *BLANKS                                                       CFT017
      *                                                                                       CFT017
     C                     MOVELWCSID     PBICC   8                                           CFT017
     C                     MOVE WCSID     PBICB   3                                           CFT017
      *                                                                                       CFT017
     C                     CALL 'ME1400'                                                      CFT017
     C                     PARM *BLANKS   PRTCD                                               CFT017
     C                     PARM           PBICC                                               CFT017
     C                     PARM           PBICB                                               CFT017
     C                     PARM           SDCUST                                              CFT017
     C                     PARM           SDCNST                                              CFT017
     C                     PARM           MEBICD                                              CFT017
     C                     PARM *BLANKS   PCNUM   1                                           CFT017
     C                     PARM *BLANKS   PCNST   1                                           CFT017
     C                     PARM *BLANKS   PBICD   1                                           CFT017
      *                                                                                       CFT017
     C           PCNUM     IFNE 'Y'                                                           CFT017
     C           PCNST     ANDNE'Y'                                                           CFT017
     C           PBICD     ANDNE'Y'                                                           CFT017
     C           BDSUBT    OREQ 'BEID'                                                        CFT017
     C           WBTBK     ANDEQ*BLANK                                                        CFT017
     C           BDSUBT    OREQ 'TRCO'                                                        CFT017
     C           WBTBK     ANDEQ*BLANK                                                        CFT017
     C                     MOVE *BLANKS   WCSID                                               CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     ENDSR                                                              CFT017
      *                                                                                       CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                                                  CFT017
      *****************************************************************                       CFT017
      *                                                               *                       CFT017
      *  SRBTBK - Check Bank to Bank field                            *                       CFT017
      *                                                               *                       CFT017
      *  Called By: SRM103                                            *                       CFT017
      *                                                               *                       CFT017
      *****************************************************************                       CFT017
     C           SRBTBK    BEGSR                                                              CFT017
      *                                                                                       CFT017
     C                     MOVE 'N'       WBTBK   1                                           CFT017
      *                                                                                       CFT017
      ** It must not contain the codeword /REJT/, /RETN/, nor the ERI                         CFT017
      ** codeword /OCMT/.                                                                     CFT017
      *                                                                                       CFT017
     C           WWBTBK    IFNE *BLANKS                                                       CFT017
     C           '/REJT/'  SCAN WWBTBK                   01                                   CFT017
     C           *IN01     IFEQ *ON                                                           CFT017
     C                     GOTO ENBTBK                                                        CFT017
     C                     ENDIF                                                              CFT017
     C           '/RETN/'  SCAN WWBTBK                   01                                   CFT017
     C           *IN01     IFEQ *ON                                                           CFT017
     C                     GOTO ENBTBK                                                        CFT017
     C                     ENDIF                                                              CFT017
     C           '/OCMT/'  SCAN WWBTBK                   01                                   CFT017
     C           *IN01     IFEQ *ON                                                           CFT017
     C                     GOTO ENBTBK                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
      ** If field contains /INS/, it should be followed by a SWIFT                            CFT017
      ** address.  The SWIFT address will be validated via call to                            CFT017
      ** ME1400.  It is a SWIFT address if it is found in Customers                           CFT017
      ** file, Counterparty Nostros file, or in BIC Directory.                                CFT017
      *                                                                                       CFT017
     C           WWBTBK    IFNE *BLANKS                                                       CFT017
     C           '/INS/'   SCAN WWBTBK                   01                                   CFT017
     C           *IN01     IFEQ *ON                                                           CFT017
     C           11        SUBSTWWBTBK:6  WCSID                                               CFT017
     C                     EXSR SR1400                                                        CFT017
     C           WCSID     IFEQ *BLANKS                                                       CFT017
     C                     GOTO ENBTBK                                                        CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CFT017
     C                     MOVE 'Y'       WBTBK                                               CFT017
      *                                                                                       CFT017
     C           ENBTBK    ENDSR                                                              CFT017
      *****************************************************************                       CFT017
     C/EJECT                                                              CFT014
      *****************************************************************   CFT014
      /TITLE SR/SRISC3                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRISC3 - Initialise screen 3                                 *   CFT014
      *                                                               *   CFT014
      *  Called By: CCDSPV, CFPRSC subroutines                        *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FT0035    - Get customer number for default processing.      *   CFT014
      *  SRCDFT    - Calculate default.                               *   CFT014
      *  AOCURRR0  - Access Object to get currency details.           *   CFT014
      *  ZEDIT     - Edit screen field.                               *   CFT014
      *  SRVATC    - V.A.T calculation.                               *   CFT014
      *  SRERR     - Error subroutine.                                *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRISC3    BEGSR                           *** SRISC3 *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRISC3'  @STK,Q                          CFT014
      *                                                                   CFT009
      ** Initialise error indicator fields                                CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   I7DATA                          CFT009
     C                     MOVEL*BLANKS   E#WARA                          CFT009
     C                     MOVEA'00000'   *IN,33                          CFT009
     C                     MOVEA'00000'   *IN,38                          CFT009
     C                     MOVEA'00000'   *IN,43                          CFT009
     C                     MOVEA'00000'   *IN,48                          CFT009
     C                     MOVEA'00000'   *IN,53                          CFT009
     C                     MOVEA'000'     *IN,58                          CFT009
     C                     MOVEA'00000'   *IN,65                          CFT009
     C                     MOVEA'00'      *IN,70                          CFT009
     C                     MOVEA'00'      *IN,83                          CFT009
     C                     MOVEA'00'      *IN,87                          CFT009
     C                     MOVEA'00000'   *IN,92                          CFT009
     C                     MOVE '0'       *IN97                           CFT009
      *                                                                   CFT014
      ** Initialise charges to the debit of type                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CDRO                          CFT014
     C           CDRT      IFNE *BLANKS                                   CFT014
     C           *LIKE     DEFN #3CDRO    A#0012                          CFT014
     C                     MOVELCDRO      A#0012                          CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
     C           CDRT      WHEQ 'N'                                       CFT014
     C           2         SUBSTA#0012:1  #3CDRO    P                     CFT014
     C           CDRT      WHEQ 'R'                                       CFT014
     C           10        SUBSTA#0012:1  #3CDRO    P                     CFT014
     C           CDRT      WHEQ 'P'                                       CFT014
     C                     MOVELCDRO      #3CDRO                          CFT014
     C                     ENDSL                                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   #3CDRO                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initialise charges to the debit of branch                        CFT014
      *                                                                   CFT014
     C                     MOVELCDBR      #3CDBR                          CFT014
      *                                                                   CFT014
      ** Default to BEN if blank                                          CFT014
      *                                                                   CFT014
     C           DTCH      IFNE *BLANKS                                   CFT014
     C                     MOVELDTCH      #3DTCH                          CFT014
     C                     ELSE                                           CFT014
      *                                                                                       219241
      ** If CFT014 is installed, use the default value from the                               219241
      ** Message Management ICD                                                               219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
     C                     MOVELENDCHG    #3DTCH                                              219241
     C                     ELSE                                                               219241
     C                     MOVEL'BEN'     #3DTCH                          CFT014
     C/COPY WNCPYSRC,FT0345C092
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** Input currency and charge currency                               CFT009
      *                                                                   CFT014
     C                     SELEC                                          CFT014
     C           BTCHCY    WHEQ 'B'                                       CFT014
     C           #3CDRO    ORNE *BLANKS                                   CFT014
     C                     MOVELV#BCCY    V#CCCY                          CFT014
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'F'                                       CFT009
     C                     MOVELFCHCCY    V#CCCY                          CFT009
      *                                                                   CFT009
     C           BTCHCY    WHEQ 'L'                                       CFT014
     C                     MOVELV#LCCY    V#CCCY                          CFT014
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'C'                                       CFT014
     C           V#ADDC    ANDEQ'A'                                       CFT014
     C                     MOVELSMCY      V#CCCY                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELPCCY      V#CCCY                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT009
     C                     MOVELV#CCCY    #3CCY1                          CFT014
     C                     MOVELV#CCCY    #3CCY2                          CFT014
     C                     MOVELV#CCCY    #3CCY3                          CFT014
     C                     MOVELV#CCCY    #3CCY4                          CFT014
     C                     MOVELV#CCCY    #3CCY5                          CFT014
     C                     MOVELV#CCCY    #3CCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    CCY9                            CFT009
     C                     MOVELV#CCCY    CCY10                           CFT009
     C                     MOVELV#CCCY    CCY11                           CFT009
     C                     MOVELV#CCCY    CCY12                           CFT009
     C                     MOVELV#CCCY    CCY13                           CFT009
     C                     MOVELV#CCCY    CCY14                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
     C           #3CDRO    WHNE *BLANKS                                   CFT014
     C                     MOVELV#BCCY    V#RCCY                          CFT014
      *                                                                   CFT014
     C           V#ADDC    WHEQ 'A'                                       CFT014
     C                     MOVELSMCY      V#RCCY                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELPCCY      V#RCCY                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C                     MOVELV#RCCY    #3RCY1                          CFT014
     C                     MOVELV#RCCY    #3RCY2                          CFT014
     C                     MOVELV#RCCY    #3RCY3                          CFT014
     C                     MOVELV#RCCY    #3RCY4                          CFT014
     C                     MOVELV#RCCY    #3RCY5                          CFT014
     C                     MOVELV#RCCY    #3RCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    RCY9                            CFT009
     C                     MOVELV#RCCY    RCY10                           CFT009
     C                     MOVELV#RCCY    RCY11                           CFT009
     C                     MOVELV#RCCY    RCY12                           CFT009
     C                     MOVELV#RCCY    RCY13                           CFT009
     C                     MOVELV#RCCY    RCY14                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Perform the following only if core feature S01508 is             CFT014
      ** installed and core feature S01506 is NOT installed               CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   W0FCUS                          CFT014
     C                     MOVE *BLANKS   W0SCUS                          CFT014
      *                                                                   CFT014
     C           S01508    IFEQ 'Y'                                       CFT014
     C           S01506    ANDNE'Y'                                       CFT014
      *                                                                   CFT014
      ** Get "Charges to the debit of" customer (database field)          CFT014
      ** using FT0035                                                     CFT014
      *                                                                   CFT014
     C********** CDRT      IFNE *BLANKS                             CFT014187056
     C**********           MOVE CDRT      I#PT1                     CFT014187056
     C**********           MOVELCDRO      W0FLD  12                 CFT014187056
     C********** W0FLD     CAT  CDBR      I#PTY1    P               CFT014187056
     C**********           MOVEL*BLANKS   W0FLD  12                                    187056 CGL029
     C                     MOVEL*BLANKS   W0FLD  18                                           CGL029
     C           WCDRT     IFNE *BLANKS                                   187056
     C                     MOVE WCDRT     I#PT1                           187056
     C           WCDRO     CAT  WCDBR     I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           CFT014
      *                                                                   CFT014
     C                     CALL 'FT0035'                                  CFT014
     C                     PARM *BLANKS   W0RTN                           CFT014
     C                     PARM           W0DTA                           CFT014
     C                     PARM           W0MSG                           CFT014
      *                                                                   CFT014
     C                     MOVE O#CUST    W0FCUS  6                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Get "Charges to the debit of" customer (screen field)            CFT014
      ** using FT0035                                                     CFT014
      *                                                                   CFT014
     C********** F7CDRT    IFNE *BLANKS                             CFT014187056
     C**********           MOVE F7CDRT    I#PT1                     CFT014187056
     C           CDRT      IFNE *BLANKS                                   187056
     C                     MOVE CDRT      I#PT1                           187056
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     CFT014
     C                     MOVE V#BCCY    I#CCY                           CFT014
      *                                                                   CFT014
     C                     CALL 'FT0035'                                  CFT014
     C                     PARM *BLANKS   W0RTN                           CFT014
     C                     PARM           W0DTA                           CFT014
     C                     PARM           W0MSG                           CFT014
      *                                                                   CFT014
     C                     MOVE O#CUST    W0SCUS  6                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** Only calculate default charges if SAR CFT009 is off              CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *                                                                   CFT014
      ** If Commission type changed or charges to the debit of            CFT014
      ** recalculate charges                                              CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'                                       CFT014
     C           #2TRCT    ORNE TRCT                                      CFT014
     C           #3CDRO    ORNE WCDRO                                     187056
     C           #3CDBR    ORNE WCDBR                                     187056
     C           W0FCUS    ORNE W0SCUS                                    187056
     C********** #3CDRO    ORNE *BLANKS                             CFT014187056
     C********** CDRO      ANDEQ0                                   CFT014187056
     C********** #3CDRO    OREQ *BLANKS                             CFT014187056
     C********** CDRO      ANDNE0                                   CFT014187056
     C********** #1ACTC    OREQ 'A'                                 CFT014187056
     C********** W0FCUS    ANDNEW0SCUS                              CFT014187056
     C                     EXSR SRCDFT                                    CFT014
     C                     MOVEL#3CDRO    WCDRO                           187056
     C                     MOVEL#3CDBR    WCDBR                           187056
     C                     MOVELCDRT      WCDRT                           187056
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Look field up on database                                        CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM V#CCCY    @K101                           CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      ** If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           RTCD      ORNE *BLANK                                    CFT014
     C                     MOVEL'AOCURRR0'W0FILE                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     Z-ADD36        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Save number of decimal places (input currency)                   CFT014
      *                                                                   CFT014
     C                     Z-ADDA6NBDP    V#CDCP  10                      CFT014
      *                                                                   CFT014
      ** Do not perform blank and reformat if CFT009 is turned on.        CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C/COPY WNCPYSRC,FT0345C090
     C                     MOVEL*BLANKS   #3TRCD                          CFT014
      *                                                                   CFT014
     C           DUMA1     IFNE 0                                         CFT014
     C                     MOVE DUMA1     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3TRCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVEL*BLANKS   #3CHCD                          CFT014
     C           OPDUM7    IFNE 0                                         CFT014
     C                     MOVE OPDUM7    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CHCD                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3TXCD                          CFT014
      *                                                                   CFT014
     C           DUMA2     IFNE 0                                         CFT014
     C                     MOVE DUMA2     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3TXCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CQCD                          CFT014
      *                                                                   CFT014
     C           DUMA3     IFNE 0                                         CFT014
     C                     MOVE DUMA3     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CQCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CSTD                          CFT014
      *                                                                   CFT014
     C           DUMA4     IFNE 0                                         CFT014
     C                     MOVE DUMA4     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CSTD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SPCD                          CFT014
      *                                                                   CFT014
     C           DUMA5     IFNE 0                                         CFT014
     C                     MOVE DUMA5     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3SPCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3MSCD                          CFT014
      *                                                                   CFT014
     C           DUMA6     IFNE 0                                         CFT014
     C                     MOVE DUMA6     ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3MSCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3TRCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA1     IFNE 0                                         CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA1     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3TRCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3CHCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           OPDUM7    IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE OPDUM7    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3CHCD                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3TXCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA2     IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA2     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3TXCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3CQCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA3     IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA3     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3CQCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3CSTD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA4     IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA4     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3CSTD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3SPCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA5     IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA5     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3SPCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3MSCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           DUMA6     IFNE 0                                         CFT009
      ** Do not perform this if CFT009 is turned on.                      CFT009
     C           P1ACTC    ANDNE'I'                                       CFT009
     C                     MOVE DUMA6     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    #3MSCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Calculate Charge currency equivalent                             CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   RTCD                            CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM V#RCCY    @K101                           CFT009
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6MDIN    FRMMD                           CFT009
     C           *LIKE     DEFN A6SPRT    CVTRAT                          CFT009
     C           *LIKE     DEFN A6NBDP    WKDP2                           CFT009
     C           *LIKE     DEFN A6NBDP    FRMDEC                          CFT009
     C                     MOVELA6NBDP    WKDP1                           CFT009
     C                     MOVELWKDP2     TODEC                           CFT009
     C                     MOVELA6MDIN    TOMD    1                       CFT009
     C                     MOVELV#RCCY    TOCCY   3                       CFT009
     C                     Z-ADDOPCHRT    CVTRAT                          CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   RTCD                            CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM V#CCCY    @K101                           CFT009
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6NBDP    WKDP1                           CFT009
     C           *LIKE     DEFN A6NBDP    TODEC                           CFT009
     C                     MOVELA6NBDP    WKDP2                           CFT009
     C                     MOVELWKDP1     FRMDEC                          CFT009
     C                     MOVELA6MDIN    FRMMD                           CFT009
     C                     MOVELV#CCCY    FRMCCY  3                       CFT009
      *                                                                   CFT009
      ** Find multiply/divide indicator between ccys                      CFT009
      *                                                                   CFT009
     C           FRMCCY    IFEQ BJCYCD                                    CFT009
     C                     MOVE TOMD      FRMMD                           CFT009
     C                     ELSE                                           CFT009
     C           FRMMD     IFEQ TOMD                                      CFT009
     C                     MOVE 'M'       FRMMD                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'D'       FRMMD                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   STCH                            CFT009
     C           SWSCCC    IFNE 0                                         CFT009
     C                     Z-ADDSWSCCC    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    STCH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CH                            CFT009
     C           MISCC1    IFNE 0                                         CFT009
     C                     Z-ADDMISCC1    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    M1CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CH                            CFT009
     C           MISCC2    IFNE 0                                         CFT009
     C                     Z-ADDMISCC2    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    M2CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CH                            CFT009
     C           MISCC3    IFNE 0                                         CFT009
     C                     Z-ADDMISCC3    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    M3CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CH                            CFT009
     C           MISCC4    IFNE 0                                         CFT009
     C                     Z-ADDMISCC4    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    M4CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CH                            CFT009
     C           MISCC5    IFNE 0                                         CFT009
     C                     Z-ADDMISCC5    INPAMT                          CFT009
     C                     EXSR CONVRT                                    CFT009
     C                     MOVE ZFIELD    M5CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** CODES FOR  ALL FIELDS                                            CFT009
      ** Only perform this if F12 has not been pressed, to prevent        CFT009
      ** changes from being lost.                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVELTFCCCD    TRCDE                           CFT009
     C                     MOVELFXCACC    FXCDE                           CFT009
     C                     MOVELTLXCDE    TXCDE                           CFT009
     C                     MOVELCHQCHC    CQCDE                           CFT009
     C                     MOVELCACHCD    CACDE                           CFT009
     C                     MOVELSSTCCD    STCDE                           CFT009
     C                     MOVELSPRCCD    SPCDE                           CFT009
     C                     MOVELMSCHC     MSCDE                           CFT009
     C                     MOVELMSCHC1    M1CDE                           CFT009
     C                     MOVELMSCHC2    M2CDE                           CFT009
     C                     MOVELMSCHC3    M3CDE                           CFT009
     C                     MOVELMSCHC4    M4CDE                           CFT009
     C                     MOVELMSCHC5    M5CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Access currencies file                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM V#RCCY    @K101                           CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      ** If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           RTCD      ORNE *BLANK                                    CFT014
     C                     MOVEL'AOCURRR0'W0FILE                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     Z-ADD37        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Save number of decimal places (charge currency)                  CFT014
      *                                                                   CFT014
     C                     Z-ADDA6NBDP    V#RDCP  10                      CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3TRCM                          CFT014
      *                                                                   CFT014
     C           TRCM      IFNE 0                                         CFT014
     C                     MOVE TRCM      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3TRCM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVEL*BLANKS   #3CHCM                          CFT014
     C                     MOVEL*BLANKS   #3CHCD                          CFT009
      *                                                                   CFT014
     C***********OPCHCM    IFNE 0                                   CFT014CFT009
     C           OPDUM7    IFNE 0                                         CFT014
     C*********************MOVE OPCHCM    ZFIELD                    CFT014CFT009
     C                     MOVE OPDUM7    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CHCM                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3TXCH                          CFT014
      *                                                                   CFT014
     C           TXCH      IFNE 0                                         CFT014
     C                     MOVE TXCH      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3TXCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CQCH                          CFT014
      *                                                                   CFT014
     C           CQCH      IFNE 0                                         CFT014
     C                     MOVE CQCH      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CQCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CSTA                          CFT014
      *                                                                   CFT014
     C           CSTA      IFNE 0                                         CFT014
     C                     MOVE CSTA      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3CSTA                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SPCH                          CFT014
      *                                                                   CFT014
     C           SPCH      IFNE 0                                         CFT014
     C                     MOVE SPCH      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3SPCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format amount for screen                                         CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3MSCH                          CFT014
      *                                                                   CFT014
     C           MSCH      IFNE 0                                         CFT014
     C                     MOVE MSCH      ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM A6NBDP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3MSCH                          CFT014
     C                     ENDIF                                          CFT014
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   STCD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           SWSCCC    IFNE 0                                         CFT009
     C                     MOVE SWSCCC    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    STCD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   M1CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           MISCC1    IFNE 0                                         CFT009
     C                     MOVE MISCC1    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M1CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   M2CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           MISCC2    IFNE 0                                         CFT009
     C                     MOVE MISCC2    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M2CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   M3CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           MISCC3    IFNE 0                                         CFT009
     C                     MOVE MISCC3    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M3CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   M4CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           MISCC4    IFNE 0                                         CFT009
     C                     MOVE MISCC4    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M4CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           MISCC5    IFNE 0                                         CFT009
     C                     MOVE MISCC5    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM V#CDCP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT014
      ** If switchable feature S01499 is switched ON, initialise          CFT014
      ** V.A.T. flags and total V.A.T. amount.                            CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer commission V.A.T. flag                                  CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT1                          CFT014
     C           OPVAT1    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT1    #3VAT1                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT1                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex V.A.T. flag                                                CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT2                          CFT014
     C           OPVAT2    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT2    #3VAT2                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT2                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque V.A.T. flag                                               CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT3                          CFT014
     C           OPVAT3    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT3    #3VAT3                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT3                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Costs V.A.T. flag                                                CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT4                          CFT014
     C           OPVAT4    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT4    #3VAT4                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT4                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** SWIFT priority V.A.T. flag                                       CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT5                          CFT014
     C           OPVAT5    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT5    #3VAT5                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT5                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous V.A.T. flag                                        CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT6                          CFT014
     C           OPVAT6    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT6    #3VAT6                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT6                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** FX/Change commission V.A.T. flag                                 CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT7                          CFT014
     C           OPVAT7    IFNE *BLANK                                    CFT014
     C                     MOVELOPVAT7    #3VAT7                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT7                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Swift Standard V.A.T. flag                                       CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVTSWSC    VAT14                           CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 1 V.A.T. flag                               CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVMIC1     VAT9                            CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 2 V.A.T. flag                               CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVMIC2     VAT10                           CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 3 V.A.T. flag                               CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVMIC3     VAT11                           CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 4 V.A.T. flag                               CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVMIC4     VAT12                           CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 5 V.A.T. flag                               CFT009
      *                                                                   CFT009
      ** Check to ensure VAT flag is appropriate                          CFT009
     C                     MOVELVMIC5     VAT13                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** If charges are recalculated, then recalculate total V.A.T. amt   CFT014
      *                                                                   CFT014
     C           W0RCAL    IFEQ 'Y'                                       CFT014
     C                     EXSR SRVATC                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format total V.A.T. amount for screen                            CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VATD                          CFT014
     C           OPDUM8    IFNE 0                                         CFT014
     C                     MOVE OPDUM8    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM V#CDCP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3VATD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format total V.A.T. amount for screen                            CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VATT                          CFT014
     C           OPVATT    IFNE 0                                         CFT014
     C                     MOVE OPVATT    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM V#RDCP    ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3VATT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Reset recalculation flag                                         CFT014
      *                                                                   CFT014
     C                     MOVE 'N'       W0RCAL                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C           V#ADDC    IFEQ 'A'                                       CFT014
     C           OPRCUS    IFEQ 'N'                                       CFT014
     C           OPRCNW    ANDNE0                                         CFT014
      ** Sum charges in settlement currency                               CFT014
     C                     Z-ADD0         OPRCSC                          CFT014
     C                     Z-ADD0         OPRCSQ                          CFT014
     C                     EXSR SUMCHG                                    CFT014
      ** Receiver's charges = :71G: received - our charges                CFT014
      ** Result holds in pay currency                                     CFT014
     C                     EXSR SUBRCG                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initialise receiver's charges remitted                           CFT014
      *                                                                   CFT014
     C                     MOVELPCCY      #3RCCY                          CFT014
     C                     MOVE *BLANK    #3RCDR                          CFT014
     C**********           Z-ADDO         OPRCRM                          CFT009
     C                     Z-ADD0         F7RCRM                          CFT009
     C                     MOVE PCCY      WCURCY  3                       CFT014
     C                     Z-ADD50        WERNB   50                      CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPRCRM    IFNE *ZERO                                     CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE OPRCRM    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3RCDR                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initialise sender's charges deducted                             CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    #3SCD1                          CFT014
     C                     Z-ADDOPSCLE    V#SENT                          CFT014
     C                     MOVE OPSCC1    #3SCC1                          CFT014
      *                                                                   CFT014
     C           OPSCC1    IFNE *BLANK                                    CFT014
     C                     MOVE OPSCC1    WCURCY                          CFT014
     C                     Z-ADD51        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPSCH1    IFNE *ZERO                                     CFT014
     C           OPSCH1    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDEQ1                                         CFT014
     C           OPSCH1    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDGT1                                         CFT014
     C                     MOVE *ZERO     ZFIELD                          CFT014
     C           OPSCH1    IFNE *ZERO                                     CFT014
     C                     MOVE OPSCH1    ZFIELD                          CFT014
     C                     ENDIF                                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD1                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    #3SCD2                          CFT014
     C                     MOVE OPSCC2    #3SCC2                          CFT014
      *                                                                   CFT014
     C           OPSCC2    IFNE *BLANK                                    CFT014
     C                     MOVE OPSCC2    WCURCY                          CFT014
     C                     Z-ADD52        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPSCH2    IFNE *ZERO                                     CFT014
     C           OPSCH2    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDEQ2                                         CFT014
     C           OPSCH2    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDGT2                                         CFT014
     C                     MOVE *ZERO     ZFIELD                          CFT014
     C           OPSCH2    IFNE *ZERO                                     CFT014
     C                     MOVE OPSCH2    ZFIELD                          CFT014
     C                     ENDIF                                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD2                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    #3SCD3                          CFT014
     C                     MOVE OPSCC3    #3SCC3                          CFT014
      *                                                                   CFT014
     C           OPSCC3    IFNE *BLANK                                    CFT014
     C                     MOVE OPSCC3    WCURCY                          CFT014
     C                     Z-ADD53        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPSCH3    IFNE *ZERO                                     CFT014
     C           OPSCH3    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDEQ3                                         CFT014
     C           OPSCH3    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDGT3                                         CFT014
     C                     MOVE *ZERO     ZFIELD                          CFT014
     C           OPSCH3    IFNE *ZERO                                     CFT014
     C                     MOVE OPSCH3    ZFIELD                          CFT014
     C                     ENDIF                                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD3                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    #3SCD4                          CFT014
     C                     MOVE OPSCC4    #3SCC4                          CFT014
      *                                                                   CFT014
     C           OPSCC4    IFNE *BLANK                                    CFT014
     C                     MOVE OPSCC4    WCURCY                          CFT014
     C                     Z-ADD54        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPSCH4    IFNE *ZERO                                     CFT014
     C           OPSCH4    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDEQ4                                         CFT014
     C           OPSCH4    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDGT4                                         CFT014
     C                     MOVE *ZERO     ZFIELD                          CFT014
     C           OPSCH4    IFNE *ZERO                                     CFT014
     C                     MOVE OPSCH4    ZFIELD                          CFT014
     C                     ENDIF                                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD4                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    #3SCD5                          CFT014
     C                     MOVE OPSCC5    #3SCC5                          CFT014
      *                                                                   CFT014
     C           OPSCC5    IFNE *BLANK                                    CFT014
     C                     MOVE OPSCC5    WCURCY                          CFT014
     C                     Z-ADD55        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
     C           OPSCH5    IFNE *ZERO                                     CFT014
     C           OPSCH5    OREQ *ZERO                                     CFT014
     C           OPSCLE    ANDEQ5                                         CFT014
     C                     MOVE *ZERO     ZFIELD                          CFT014
     C           OPSCH5    IFNE *ZERO                                     CFT014
     C                     MOVE OPSCH5    ZFIELD                          CFT014
     C                     ENDIF                                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD5                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
     C/EJECT                                                              CFT014
      *****************************************************************   CFT014
      /TITLE SR/SRACCY                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRACCY - Access Currency details                             *   CFT014
      *                                                               *   CFT014
      *  Called By: SRISC3 subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  AOCURRR0  - Access Object to get currency details            *   CFT014
      *  SRERR     - Error subroutine                                 *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRACCY    BEGSR                           *** SRACCY *** CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM WCURCY    @K101                           CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      ** Error found on call                                              CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           RTCD      ORNE *BLANK                                    CFT014
     C                     MOVEL'AOCURRR0'W0FILE                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     Z-ADDWERNB     W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADD*ZERO     W0ERNB                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      *                                                                   CFT014
      *****************************************************************   CFT009
     C/EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/CONVRT                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  CONVRT - Convert file field to screen currency               *   CFT009
      *                                                               *   CFT009
      *  Called By: SRISC3 subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  ZCONVZ1                                                      *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           CONVRT    BEGSR                           *** CONVRT *** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'CONVRT'  @STK,Q                          CFT009
      *                                                                   CFT009
     C           FRMCCY    IFNE TOCCY                                     CFT009
     C                     CALL 'ZCONVZ1'                                 CFT009
     C                     PARM           INPAMT 150                      CFT009
     C                     PARM           CVTRAT                          CFT009
     C                     PARM           FRMMD                           CFT009
     C                     PARM           FRMCCY  3                       CFT009
     C                     PARM           TOCCY   3                       CFT009
     C                     PARM           FRMDEC                          CFT009
     C                     PARM           TODEC                           CFT009
     C                     PARM *ZEROS    OUTAMT 150                      CFT009
     C                     ELSE                                           CFT009
     C                     Z-ADDINPAMT    OUTAMT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVE OUTAMT    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM TODEC     ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT014
      /TITLE SR/SRB103                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRB103 - Check MT103 agreement                               *   CFT014
      *                                                               *   CFT014
      *  Called By: CADSDA subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  AOCUSTR0  - Access Object to get customer details            *   CFT014
      *  AOBRCHR0  - Access Object to get branch details              *   CFT014
      *  AOACCTR0  - Access Object to get account details             *                       199657
      *  ME1730    - Determines whether an MT103 exists               *   CFT014
      *  SRERR     - Error subroutine                                 *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRB103    BEGSR                           *** SRB103 *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRB103'  @STK,Q                          CFT014
     C                     MOVEL*BLANK    PSNBRC                          CFT014
     C                     MOVEL*BLANK    PSBICA                          CFT014
     C                     MOVEL*BLANK    PSWIFT                          CFT014
     C                     MOVEL*BLANK    PORDBK                          CFT014
     C                     MOVEL*BLANK    PORTCD                          CFT014
     C                     MOVEL*BLANK    WSWIFT                          CFT014
     C                     MOVEL*BLANK    WCNUM                           CFT014
      *                                                                   CFT014
      ** Get SWIFT-BIC of destination                                     CFT014
      *                                                                   CFT014
     C           DSTT      IFEQ 'S'                                       CFT014
     C           11        SUBSTDST1:1    WSWIFT 11                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Destination type is a full nostro 'F', customer number 'C'       CFT014
      ** retail account 'R' or GL account 'G', get SWIFT ID through       CFT014
      ** customer number                                                  CFT014
      *                                                                   CFT014
     C           DSTT      IFEQ 'F'                                       CFT014
     C           DSTT      OREQ 'C'                                       CFT014
     C           DSTT      OREQ 'R'                                       CFT014
     C           DSTT      OREQ 'G'                                       CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
     C           DSTT      WHEQ 'F'                                       CFT014
     C           3         SUBSTDST1:1    WCYCD                           CFT014
     C           2         SUBSTDST1:4    WNONB                           CFT014
     C                     CALL 'AONOSTR0'             9090               CFT014
     C                     PARM *BLANKS   WRTCD   7                       CFT014
     C                     PARM '*KEY   ' WOPTN   7                       CFT014
     C                     PARM *BLANKS   WCUST   6                       CFT014
     C                     PARM           WCYCD   3                       CFT014
     C**********           PARM *BLANKS   WACCN   4                                    CFT014 CGL029
     C                     PARM *BLANKS   WACCN  10                                           CGL029
     C                     PARM *BLANKS   WACSN   2                       CFT014
     C                     PARM           WNONB   2                       CFT014
     C                     PARM *BLANKS   WBRCD   3                       CFT014
     C                     PARM *BLANKS   WCSSN  10                       CFT014
     C                     PARM *BLANKS   WPNOI   1                       CFT014
     C           SDNOST    PARM SDNOST    DSFDY                           CFT014
      *                                                                   CFT014
      ** If error on call                                                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           WRTCD     ORNE *BLANK                                    CFT014
     C                     MOVE 'SDNOSTPD'W0FILE                          CFT014
     C                     MOVELWCYCD     W0KEY5  5                       CFT014
     C                     MOVE WNONB     W0KEY5                          CFT014
     C                     MOVELWNONB     W0KEY                           CFT014
     C                     Z-ADD48        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     MOVELA7CUST    WCNUM  10                       CFT014
      *                                                                   CFT014
     C           DSTT      WHEQ 'C'                                       CFT014
     C           10        SUBSTDST1:1    WCNUM                           CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELDST1      P@RETL                                              199657
     C                     CALL 'AOACCTR0'             90                                     199657
     C                     PARM           P@RTCD  7                                           199657
     C                     PARM '*KEY   ' P@OPTN  7                                           199657
     C                     PARM           P@RETL 10                                           199657
     C                     PARM *BLANKS   P@CNUM  6                                           199657
     C                     PARM *BLANKS   P@CUCD  3                                           199657
     C**********           PARM *BLANKS   P@ACCD  4                                    199657 CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSQ  2                                           199657
     C                     PARM *BLANKS   P@BRCA  3                                           199657
     C                     PARM           ACCINF                                              199657
     C           *IN90     IFEQ *ON                                                           199657
     C           P@RTCD    ORNE *BLANK                                                        199657
     C                     MOVE 'AOACCTR0'W0FILE                                              199657
     C                     MOVELDST1      W0KEY                                               199657
     C                     Z-ADD65        W0ERNB                                              199657
     C                     MOVEL'MEM5003' W0MSGD                                              199657
     C                     MOVEL'MIDAS  ' W0MSGF                                              199657
     C                     EXSR SRERR                                                         199657
     C                     ENDIF                                                              199657
     C                     MOVELIFCNUM    WCNUM                                               199657
     C***********6         SUBSTDST1:1    WCNUM                                        CFT014 199657
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      ** Access customer's file to get SWIFT id                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCUSTR0'                                CFT014
     C                     PARM *BLANKS   @RTRN   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM WCNUM     @KEY1  10                       CFT014
     C                     PARM *BLANKS   @KYST   7                       CFT014
     C           SDCUST    PARM SDCUST    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTRN     IFEQ *BLANK                                    CFT014
     C           BBCSID    IFNE *BLANK                                    CFT014
     C                     MOVELBBCSID    WSWIFT                          CFT014
     C                     ENDIF                                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'SDCUSTPD'W0FILE                          CFT014
     C                     Z-ADD45        W0ERNB                          CFT014
     C                     MOVELWCNUM     W0KEY                           CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Setup parameter to ME1730                                        CFT014
      *                                                                   CFT014
     C           WSWIFT    IFNE *BLANK                                    CFT014
     C                     MOVELBRCA      PSNBRC                          CFT014
     C**********           CALL 'AOBRCHR0'             9090               CFT014              CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM BRCA      @BRCD   3                       CFT014
     C********** SDBRCH    PARM SDBRCH    DSFDY                           CFT014              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CFT014
      ** Error found on call                                              CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           RTCD      ORNE *BLANK                                    CFT014
     C                     MOVEL'AOBRCHR0'W0FILE                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     Z-ADD46        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     MOVELA8BTID    PSBICA                          CFT014
     C                     MOVELWSWIFT    PSWIFT                          CFT014
     C                     MOVELORBK      PORDBK                          CFT014
      *                                                                                       CSW203
     C           CSW203    IFEQ 'Y'                                                           CSW203
     C                     MOVE '*CRT103' PORTCD                                              CSW203
     C                     ELSE                                                               CSW203
      *                                                                   CFT014
      ** Call ME1730                                                      CFT014
      *                                                                   CFT014
     C                     CALL 'ME1730'                                  CFT014
     C                     PARM           PSNBRC  3                       CFT014
     C                     PARM           PSBICA 11                       CFT014
     C                     PARM           PSWIFT 11                       CFT014
     C                     PARM           PORDBK256                       CFT014
     C                     PARM *BLANK    PBBINF256                       CFT014
     C                     PARM *BLANK    PSNCOR256                       CFT014
     C                     PARM *BLANK    PRCCOR256                       CFT014
     C                     PARM *BLANK    PORTCD  7                       CFT014
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                   CFT014
      ** Error on call                                                    CFT014
      *                                                                   CFT014
     C           PORTCD    IFEQ '*ERROR '                                 CFT014
     C                     MOVEL'ME1730  'W0FILE                          CFT014
     C                     Z-ADD47        W0ERNB                          CFT014
     C                     MOVEL'*CALL   'W0KEY                           CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C           PORTCD    IFEQ '*CRT103'                                 CFT014
     C                     MOVE 'Y'       V#M103                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      /EJECT                                                              CFT014
      *****************************************************************   187056
      *                                                               *   187056
      *  SRRCAL   : Recalculate charges due to change in Charges to   *   187056
      *             the Debit of.                                     *   187056
      *  CALLED BY: SRFTS3                                            *   187056
      *                                                               *   187056
      *  CALLS    : FT0359                                            *   187056
      *                                                               *   187056
      *****************************************************************   187056
     CSR         SRRCAL    BEGSR                                          187056
      *                                                                   187056
      ** Set up subroutine stack name.                                    187056
      *                                                                   187056
     C                     ADD  1         Q                               187056
     C                     MOVEL'SRRCAL'  @STK,Q                          187056
      *                                                                   187056
     C                     MOVE *BLANKS   W0FCUS                          187056
     C                     MOVE *BLANKS   W0SCUS                          187056
     C                     MOVE 'N'       WREDSP  1                       187056
      *                                                                   187056
      ** Perform the following only if core feature S01508 is             187056
      ** installed and core feature S01506 is NOT installed.              187056
      *                                                                   187056
     C           S01508    IFEQ 'Y'                                       187056
     C           S01506    ANDNE'Y'                                       187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (saved field)             187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           WCDRT     IFNE *BLANKS                                   187056
     C                     MOVE WCDRT     I#PT1                           187056
     C           WCDRO     CAT  WCDBR     I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0FCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (screen field)            187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           F7CDRT    IFNE *BLANKS                                   187056
     C                     MOVE F7CDRT    I#PT1                           187056
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0SCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C           #3CDRO    IFNE WCDRO                                     187056
     C           #3CDBR    ORNE WCDBR                                     187056
     C           W0FCUS    ORNE W0SCUS                                    187056
      *                                                                   187056
     C                     MOVEL#3CDRO    WCDRO                           187056
     C                     MOVEL#3CDBR    WCDBR                           187056
     C                     MOVELF7CDRT    WCDRT                           187056
      *                                                                   187056
     C                     SELEC                                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'B'                                       187056
     C           #3CDRO    ORNE *BLANKS                                   187056
     C                     MOVELV#BCCY    V#CCCY                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'L'                                       187056
     C                     MOVELV#LCCY    V#CCCY                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'C'                                       187056
     C           V#ADDC    ANDEQ'A'                                       187056
     C                     MOVELSMCY      V#CCCY                          187056
      *                                                                   187056
     C                     OTHER                                          187056
     C                     MOVELPCCY      V#CCCY                          187056
      *                                                                   187056
     C                     ENDSL                                          187056
      *                                                                   187056
     C                     MOVELV#CCCY    #3CCY1                          187056
     C                     MOVELV#CCCY    #3CCY2                          187056
     C                     MOVELV#CCCY    #3CCY3                          187056
     C                     MOVELV#CCCY    #3CCY4                          187056
     C                     MOVELV#CCCY    #3CCY5                          187056
     C                     MOVELV#CCCY    #3CCY6                          187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVELV#CCCY    #3CCY7                          187056
     C                     ENDIF                                          187056
     C           S01499    IFEQ 'Y'                                       187056
     C                     MOVELV#CCCY    #3CCY8                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     SELEC                                          187056
      *                                                                   187056
     C           #3CDRO    WHNE *BLANKS                                   187056
     C                     MOVELV#BCCY    V#RCCY                          187056
      *                                                                   187056
     C           V#ADDC    WHEQ 'A'                                       187056
     C                     MOVELSMCY      V#RCCY                          187056
      *                                                                   187056
     C                     OTHER                                          187056
     C                     MOVELPCCY      V#RCCY                          187056
      *                                                                   187056
     C                     ENDSL                                          187056
      *                                                                   187056
     C                     MOVELV#RCCY    #3RCY1                          187056
     C                     MOVELV#RCCY    #3RCY2                          187056
     C                     MOVELV#RCCY    #3RCY3                          187056
     C                     MOVELV#RCCY    #3RCY4                          187056
     C                     MOVELV#RCCY    #3RCY5                          187056
     C                     MOVELV#RCCY    #3RCY6                          187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVELV#RCCY    #3RCY7                          187056
     C                     ENDIF                                          187056
     C           S01499    IFEQ 'Y'                                       187056
     C                     MOVELV#RCCY    #3RCY8                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Call routine to calculate defaults.                              187056
      *                                                                   187056
     C                     EXSR SRCDFT                                    187056
      *                                                                   187056
      ** Look field up on database.                                       187056
      *                                                                   187056
     C                     CALL 'AOCURRR0'             9090               187056
     C                     PARM *BLANKS   RTCD                            187056
     C                     PARM '*KEY   ' @OPTN                           187056
     C                     PARM V#CCCY    @K101                           187056
     C           SDCURR    PARM *BLANKS   DSSDY                           187056
      *                                                                   187056
      ** Error on call.                                                   187056
      *                                                                   187056
     C           *IN90     IFEQ '1'                                       187056
     C           RTCD      ORNE *BLANK                                    187056
     C                     Z-ADD63        W0ERNB                          187056
     C                     MOVEL'*CALL'   W0KEY                           187056
     C                     MOVEL'AOCURRR0'W0FILE                          187056
     C                     MOVEL'MEM5003' W0MSGD                          187056
     C                     MOVEL'MIDAS  ' W0MSGF                          187056
     C                     EXSR SRERR                                     187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Save number of decimal places (input currency).                  187056
      *                                                                   187056
     C                     Z-ADDA6NBDP    V#CDCP  10                      187056
      *                                                                   187056
      ** Format Transfer Commission amount for screen.                    187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TRCD                          187056
     C           DUMA1     IFNE 0                                         187056
     C                     MOVE DUMA1     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TRCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVEL*BLANKS   #3CHCD                          187056
     C           OPDUM7    IFNE 0                                         187056
     C                     MOVE OPDUM7    ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CHCD                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TXCD                          187056
      *                                                                   187056
     C           DUMA2     IFNE 0                                         187056
     C                     MOVE DUMA2     ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3TXCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CQCD                          187056
      *                                                                   187056
     C           DUMA3     IFNE 0                                         187056
     C                     MOVE DUMA3     ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CQCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CSTD                          187056
      *                                                                   187056
     C           DUMA4     IFNE 0                                         187056
     C                     MOVE DUMA4     ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CSTD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3SPCD                          187056
      *                                                                   187056
     C           DUMA5     IFNE 0                                         187056
     C                     MOVE DUMA5     ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3SPCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3MSCD                          187056
      *                                                                   187056
     C           DUMA6     IFNE 0                                         187056
     C                     MOVE DUMA6     ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3MSCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Access currencies file                                           187056
      *                                                                   187056
     C                     CALL 'AOCURRR0'             9090               187056
     C                     PARM *BLANKS   RTCD                            187056
     C                     PARM '*KEY   ' @OPTN                           187056
     C                     PARM V#RCCY    @K101                           187056
     C           SDCURR    PARM *BLANKS   DSSDY                           187056
      *                                                                   187056
      ** If error on call                                                 187056
      *                                                                   187056
     C           *IN90     IFEQ *ON                                       187056
     C           RTCD      ORNE *BLANK                                    187056
     C                     MOVEL'AOCURRR0'W0FILE                          187056
     C                     MOVEL'*CALL'   W0KEY                           187056
     C                     Z-ADD64        W0ERNB                          187056
     C                     MOVEL'MEM5003' W0MSGD                          187056
     C                     MOVEL'MIDAS  ' W0MSGF                          187056
     C                     EXSR SRERR                                     187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Save number of decimal places (charge currency)                  187056
      *                                                                   187056
     C                     Z-ADDA6NBDP    V#RDCP  10                      187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C/COPY WNCPYSRC,FT0345C091
     C                     MOVEL*BLANKS   #3TRCM                          187056
      *                                                                   187056
     C           TRCM      IFNE 0                                         187056
     C                     MOVE TRCM      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3TRCM                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVEL*BLANKS   #3CHCM                          187056
      *                                                                   187056
     C           OPCHCM    IFNE 0                                         187056
     C                     MOVE OPCHCM    ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CHCM                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TXCH                          187056
      *                                                                   187056
     C           TXCH      IFNE 0                                         187056
     C                     MOVE TXCH      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3TXCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CQCH                          187056
      *                                                                   187056
     C           CQCH      IFNE 0                                         187056
     C                     MOVE CQCH      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CQCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CSTA                          187056
      *                                                                   187056
     C           CSTA      IFNE 0                                         187056
     C                     MOVE CSTA      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3CSTA                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3SPCH                          187056
      *                                                                   187056
     C           SPCH      IFNE 0                                         187056
     C                     MOVE SPCH      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3SPCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format amount for screen                                         187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3MSCH                          187056
      *                                                                   187056
     C           MSCH      IFNE 0                                         187056
     C                     MOVE MSCH      ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C                     MOVE ZFIELD    #3MSCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** If switchable feature S01499 is switched ON, initialise          187056
      ** V.A.T. flags, total V.A.T. amount and recalculate total          187056
      ** V.A.T. amount.                                                   187056
      *                                                                   187056
     C           S01499    IFEQ 'Y'                                       187056
      *                                                                   187056
      ** Transfer commission V.A.T. flag                                  187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT1                          187056
     C           OPVAT1    IFNE *BLANK                                    187056
     C                     MOVELOPVAT1    #3VAT1                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT1                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Telex V.A.T. flag                                                187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT2                          187056
     C           OPVAT2    IFNE *BLANK                                    187056
     C                     MOVELOPVAT2    #3VAT2                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT2                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Cheque V.A.T. flag                                               187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT3                          187056
     C           OPVAT3    IFNE *BLANK                                    187056
     C                     MOVELOPVAT3    #3VAT3                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT3                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Costs V.A.T. flag                                                187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT4                          187056
     C           OPVAT4    IFNE *BLANK                                    187056
     C                     MOVELOPVAT4    #3VAT4                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT4                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** SWIFT priority V.A.T. flag                                       187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT5                          187056
     C           OPVAT5    IFNE *BLANK                                    187056
     C                     MOVELOPVAT5    #3VAT5                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT5                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Miscellaneous V.A.T. flag                                        187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT6                          187056
     C           OPVAT6    IFNE *BLANK                                    187056
     C                     MOVELOPVAT6    #3VAT6                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT6                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** FX/Change commission V.A.T. flag                                 187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT7                          187056
     C           OPVAT7    IFNE *BLANK                                    187056
     C                     MOVELOPVAT7    #3VAT7                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT7                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Recalculate total V.A.T. amount.                                 187056
      *                                                                   187056
     C                     EXSR SRVATC                                    187056
      *                                                                   187056
      ** Format total V.A.T. amount for screen                            187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VATD                          187056
     C           OPDUM8    IFNE 0                                         187056
     C                     MOVE OPDUM8    ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM V#CDCP    ZADEC                           187056
     C                     MOVE ZFIELD    #3VATD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format total V.A.T. amount for screen                            187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VATT                          187056
     C           OPVATT    IFNE 0                                         187056
     C                     MOVE OPVATT    ZFIELD                          187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM V#RDCP    ZADEC                           187056
     C                     MOVE ZFIELD    #3VATT                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Reset recalculation flag                                         187056
      *                                                                   187056
     C                     MOVE 'N'       W0RCAL                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     MOVE 'Y'       WREDSP                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Unwind subroutine stack name.                                    187056
      *                                                                   187056
     C           EXRCAL    TAG                                            187056
     C                     MOVEA*BLANKS   @STK,Q                          187056
     C                     SUB  1         Q                               187056
      *                                                                   187056
     CSR                   ENDSR                                          187056
      *****************************************************************   187056
      /EJECT                                                              187056
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'EBPR##'  @STK,Q
      *================================================================
      *
      * Clear Update positions arrays
      *
     C                     EXSR SRCLR
      *
      * Process request
      *
     C           #1ACTC    CASEQ'I'       EECHRQ
     C           #1ACTC    CASEQ'A'       EECHRQ
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      *
      * Error: ROLLBACK any DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     GOTO EBEXIT
     C                     ELSE
      *
      * Otherwise COMMIT any DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     COMIT
     C                     ENDIF                                                              CSC022
     C                     END
     C           W0RTN     IFEQ *BLANK
      *
      * USER: Process command keys
      * EDTRCD: Process cmds - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Process Command Keys
     C/COPY WNCPYSRC,FT0345DPCK
      *
     C           P3LINK    IFNE 'Y'
     C           P2PREF    ANDNE*BLANKS
      *
      * Exit after successful add
      *
     C                     MOVEL'R'       W0RPT
     C                     END
      *
      * Restart program for next record
      *
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EBEXIT    TAG
      *
      * Clear Update positions arrays
      *
     C                     EXSR SRCLR
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'EECHRQ'  @STK,Q
      *================================================================
      * USER: Change DBF record
      * Change object - Incoming Valid Messages  *
      *
     C                     EXSR SDCHRC
     C           W0RTN     IFNE *BLANK
      *
      * DBF update error
      * Reset screen fields if changed record
      *
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      *
      * Send message '*Record changed'
      *
     C                     MOVEL*BLANKS   #MSDTA
     C                     MOVELPREF      #MPREF
     C                     MOVEL#MSDTA    ZAMSDA
     C                     MOVEL'MIN0028' ZAMSID
     C                     MOVEL'MEMSG   'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         FACKPM    BEGSR
      *================================================================
      * Check passed parameters
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'FACKPM'  @STK,Q
      *
      * Set off command keys
      *
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
      *
      * Is full key present?
      *
     C           P2PREF    IFEQ *BLANK                     Reference
      *
      * Not every key field passed - loop program
      *
     C                     MOVEL'Y'       W0RPT   1
     C                     ELSE
      *
      * Full key passed, so single shot program
      *
      * Allow command F7
      *
     C                     MOVEL'N'       W0RPT
     C           P3LINK    IFEQ 'Y'
     C                     MOVEL'1'       *IN75
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           FAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'GADSAK'  @STK,Q
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      * If errors in #1ERR1 or #1ERR2 display
      *
     C                     MOVEL'0'       *IN76
     C                     MOVEAERCD,1    #1ERR1
     C                     MOVEAERCD,19   #1ERR2
     C           #1ERR1    IFNE *BLANKS
     C           #1ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           GAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'GBDSAD'  @STK,Q
     C/COPY WNCPYSRC,FT0345C015
      *
      * If enquiry or delete protect screen
      *
     C           #1ACTC    IFEQ 'E'
     C                     MOVEL'1'       *IN79
     C                     ELSE
     C                     MOVEL'0'       *IN79
     C                     END
      *
      * Originating branches used
      *
     C           BKOBRU    IFEQ 'Y'
     C                     MOVEL'1'       *IN77
     C                     ELSE
     C                     MOVEL'0'       *IN77
     C                     END
      *
      * Allow entry of all fields if add
      *
     C           #1ACTC    IFEQ 'A'
     C                     MOVEL'1'       *IN73
     C                     ELSE
     C                     MOVEL'0'       *IN73
     C                     END
      *
      * Enable F7 if linked
      *
     C           P3LINK    IFEQ 'Y'
     C                     MOVEL'1'       *IN75
     C                     ELSE
     C                     MOVEL'0'       *IN75
     C                     END
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      * If errors in #1ERR1 or #1ERR2 display
      *
     C                     MOVEL'0'       *IN76
     C           ##SCR     IFEQ 'SCR1'
     C                     MOVEAERCD,1    #1ERR1
     C                     MOVEAERCD,19   #1ERR2
     C           #1ERR1    IFNE *BLANKS
     C           #1ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
     C                     ELSE
     C                     MOVEAERCD,1    #2ERR1
     C                     MOVEAERCD,19   #2ERR2
     C           #2ERR1    IFNE *BLANKS
     C           #2ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
     C                     END
      *
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           GBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIZ#K'  @STK,Q
      *
      * Clear Warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      *
      * Clear screen fields
      *
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVEL*BLANKS   #1TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVEL*BLANKS   #1CDBR                          CFT014
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #1BKOP                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #1TRNT                          CFT014
      *  Receivers Correspondent
     C                     MOVEL*BLANKS   #1RCO1
     C                     MOVEL*BLANKS   #1RCO2
     C                     MOVEL*BLANKS   #1RCO3
     C                     MOVEL*BLANKS   #1RCO4
     C                     MOVEL*BLANKS   #1RCO5
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #1TRI1                          CFT014
     C                     MOVEL*BLANKS   #1TRI2                          CFT014
     C                     MOVEL*BLANKS   #1TRI3                          CFT014
     C                     MOVEL*BLANKS   #1TRI4                          CFT014
     C                     MOVEL*BLANKS   #1TRI5                          CFT014
      *                                                                   CFT014
      ** Intermediary                                                     CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #1INB1                          CFT014
     C                     MOVEL*BLANKS   #1INB2                          CFT014
     C                     MOVEL*BLANKS   #1INB3                          CFT014
     C                     MOVEL*BLANKS   #1INB4                          CFT014
     C                     MOVEL*BLANKS   #1INB5                          CFT014
      *                                                                   CFT014
      *  Account with Institution
     C                     MOVEL*BLANKS   #1ACB1
     C                     MOVEL*BLANKS   #1ACB2
     C                     MOVEL*BLANKS   #1ACB3
     C                     MOVEL*BLANKS   #1ACB4
     C                     MOVEL*BLANKS   #1ACB5
      *  Beneficiary
     C                     MOVEL*BLANKS   #1BNC1
     C                     MOVEL*BLANKS   #1BNC2
     C                     MOVEL*BLANKS   #1BNC3
     C                     MOVEL*BLANKS   #1BNC4
     C                     MOVEL*BLANKS   #1BNC5
      ***Details*of*Payment********************************************   CFT014
     C***********          MOVEL*BLANKS   #1DTP1                          CFT014
     C***********          MOVEL*BLANKS   #1DTP2                          CFT014
     C***********          MOVEL*BLANKS   #1DTP3                          CFT014
     C***********          MOVEL*BLANKS   #1DTP4                          CFT014
      ***Sender*to*Receiver*information********************************   CFT014
     C***********          MOVEL*BLANKS   #1BBI1                          CFT014
     C***********          MOVEL*BLANKS   #1BBI2                          CFT014
     C***********          MOVEL*BLANKS   #1BBI3                          CFT014
     C***********          MOVEL*BLANKS   #1BBI4                          CFT014
     C***********          MOVEL*BLANKS   #1BBI5                          CFT014
     C***********          MOVEL*BLANKS   #1BBI6                          CFT014
      *
     C                     MOVEL*BLANKS   #1ACTC
     C                     MOVEL*BLANKS   #1PREF
      *
      ** If passed action code is not blank put this in #1ACTC
      *
     C           P1ACTC    IFNE *BLANKS
     C                     MOVELP1ACTC    #1ACTC
     C                     END
      *
      ** If passed reference is not blank use this if action not I
      *
     C           P2PREF    IFNE *BLANKS
     C                     MOVELP2PREF    #1PREF
     C                     END
      *
      * Fill Command lines and narrative text from messages
      *
     C                     SELEC
      *
      * Insert, Amendment or Enquiry screen
      *
     C           #1ACTC    WHEQ 'A'
     C           #1ACTC    OREQ 'E'
     C           #1ACTC    OREQ 'I'
     C           #1ACTC    OREQ ' '
      *
      * Function keys and Action codes
      *
     C                     MOVEL*BLANKS   W#ACTC  7
     C                     SELEC
     C           P3LINK    WHEQ 'Y'
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2628' W#FKEY                          CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2006' W#FKEY  7
     C                     ENDIF                                          CFT007
      *                                                                   CAC001
      **  If Analytical Accounting installed, include 'F19' text.         CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2612' W#FKY                           CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2553' W#FKY   7                       CAC001
     C                     ENDIF                                          CFT007
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     OTHER
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2615' W#FKEY                          CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2003' W#FKEY
     C                     ENDIF                                          CFT007
      *                                                                   CAC001
      **  If Analytical Accounting installed, include 'F19' text.         CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2627' W#FKY                           CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2552' W#FKY                           CAC001
     C                     ENDIF                                          CFT007
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END
     C                     MOVEL'0'       *IN74
     C                     ENDSL
      *
      * Blank out action code and function key lines
      *
     C***********          MOVEL*BLANKS   ##CMD1                          CFT014
     C                     MOVEL*BLANKS   ##CMD2
     C***********          MOVEL*BLANKS   ##CMD3                          CFT014
     C                     MOVEL*BLANKS   ##CMD4
      *
      * Action codes
      *
     C***********W#ACTC    IFNE *BLANKS                                   CFT014
     C***********          CALL 'MEC1150'              9090               CFT014
     C***********          PARM W#ACTC    #MSGID                          CFT014
     C***********          PARM 'FTUSRMSG'#MSGF                           CFT014
     C***********          PARM           #MSDTA                          CFT014
     C***********          PARM *BLANKS   #MSTX1                          CFT014
     C***********          PARM *BLANKS   #MSTX2                          CFT014
      ***********                                                         CFT014
     C***********          MOVEL#MSTX1    ##CMD1                          CFT014
     C***********          MOVEL#MSTX1    ##CMD3                          CFT014
     C***********          END                                            CFT014
      *                                                                   CFT014
      ** Function keys for the 3rd Screen Level 2 and Charges Screen      CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    WCMDS3 78                       CFT014
     C                     CALL 'MEC1150'              9090               CFT014
     C                     PARM 'FTM2003' #MSGID                          CFT014
     C                     PARM 'FTUSRMSG'#MSGF                           CFT014
     C                     PARM           #MSDTA                          CFT014
     C                     PARM *BLANKS   #MSTX1                          CFT014
     C                     PARM *BLANKS   #MSTX2                          CFT014
      *                                                                   CFT014
     C                     MOVEL#MSTX1    WCMDS3                          CFT014
     C                     MOVEL#MSTX1    ##CMD4                          CFT014
      *
      * Function keys and allow delete key
      *
     C           W#FKEY    IFNE *BLANKS
     C                     CALL 'MEC1150'              9090
     C                     PARM W#FKEY    #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    ##CMD2
     C***********          MOVEL#MSTX1    ##CMD4                          CFT014
     C                     END
      *                                                                   CAC001
      ** If Analytical Accounting is installed, make 'F19' accessible     CAC001
      ** in CHARGES screen only.                                          CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C***********W#FKY     ANDNE*BLANKS                            CAC001 CFT014
     C                     MOVE *BLANKS   ##CMD4                          CAC001
     C                     CALL 'MEC1150'              9090               CAC001
     C***********          PARM W#FKY     #MSGID                   CAC001 CFT014
     C                     PARM 'FTM2552' #MSGID                          CFT014
     C                     PARM 'FTUSRMSG'#MSGF                           CAC001
     C                     PARM           #MSDTA                          CAC001
     C                     PARM *BLANKS   #MSTX1                          CAC001
     C                     PARM *BLANKS   #MSTX2                          CAC001
      *                                                                   CAC001
     C                     MOVEL#MSTX1    ##CMD4                          CAC001
     C                     END                                            CAC001
     C/COPY WNCPYSRC,FT0345C045
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @OTPAYL1 fields to screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MBFL#1'  @STK,Q
      ***Transfer*Comission*tariff*************************************   CFT014
     C/COPY WNCPYSRC,FT0345C032
     C***********          MOVELTRCT      #1TRCT                          CFT014
     C/COPY WNCPYSRC,FT0345C033
      *
      *  Determine branch for charge defaults
      *
     C                     SELEC
      *
      *  If single branch mode, use single branch code from SDBANKPD
      *
     C           WUMBIN    WHNE 'Y'
     C                     MOVELV#SBRC    PYBR
      *
      *  Multibranched and originating branches used
      *
     C           V#OBUV    WHEQ 'Y'
     C                     MOVELORBR      PYBR
      *
      *  Multibranched and originating branches not used
      *
     C                     OTHER
     C                     MOVELBRCA      PYBR
      *
     C                     ENDSL
      ***********                                                         CFT014
      ***If*transfer*commission*blank*and*action*insert*default********   CFT014
      ***********                                                         CFT014
     C***********#1ACTC    IFEQ 'I'                                       CFT014
     C***********#1TRCT    ANDEQ*BLANKS                                   CFT014
      ***********                                                         CFT014
     C***********PYBR      CHAINPYCHGDB              90    Get defaults.  CFT014
      ***********                                                         CFT014
      ***No*record*found*-*DB*error*only*if*not*multibranched**********   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********WUMBIN    ANDNE'Y'                                       CFT014
     C***********          MOVEL'PYCHGDB 'W0FILE           ***************CFT014
     C***********          MOVELPYBR      W0KEY            * DB ERROR 22 *CFT014
     C***********          Z-ADD22        W0ERNB           ***************CFT014
     C***********          MOVEL'MEM5004' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***No*payment*charges*information********************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
      ***********                                                         CFT014
     C***********          MOVEL'1'       *IN31                           CFT014
     C***********          MOVELPYBR      ZAMSDA                          CFT014
     C***********          MOVEL'FTM2001' ZAMSID                          CFT014
     C***********          EXSR ZASNMS                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Payment*charges*information***********************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '0'                                       CFT014
     C*/COPY*WNCPYSRC,FT0345C034                                          CFT014
     C***********          MOVELDFTRCT    #1TRCT                          CFT014
     C***********          END                                            CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
      ***********                                                         CFT014
     C***********CDRT      IFNE *BLANKS                                   CFT014
     C************LIKE     DEFN #1CDRO    A#0012                          CFT014
     C***********          MOVELCDRO      A#0012                          CFT014
      ***********                                                         CFT014
     C***********          SELEC                                          CFT014
     C***********CDRT      WHEQ 'N'                                       CFT014
     C***********2         SUBSTA#0012:1  #1CDRO    P                     CFT014
     C***********CDRT      WHEQ 'R'                                       CFT014
     C***********10        SUBSTA#0012:1  #1CDRO    P                     CFT014
     C***********CDRT      WHEQ 'P'                                       CFT014
     C***********          MOVELCDRO      #1CDRO                          CFT014
     C***********          ENDSL                                          CFT014
      ***********                                                         CFT014
     C*/COPY WNCPYSRC,FT0345C019                                          CFT014
     C***********          ELSE                                           CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVELCDBR      #1CDBR                          CFT014
     C/COPY WNCPYSRC,FT0345C039
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C                     MOVELOPBOCD    #1BKOP                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C                     MOVELOPTTCD    #1TRNT                          CFT014
      *  Receivers Correspondent
     C                     MOVELRCO1      #1RCO1
     C                     MOVELRCO2      #1RCO2
     C                     MOVELRCO3      #1RCO3
     C                     MOVELRCO4      #1RCO4
     C                     MOVELRCO5      #1RCO5
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C                     MOVELOPTRI1    #1TRI1                          CFT014
     C                     MOVELOPTRI2    #1TRI2                          CFT014
     C                     MOVELOPTRI3    #1TRI3                          CFT014
     C                     MOVELOPTRI4    #1TRI4                          CFT014
     C                     MOVELOPTRI5    #1TRI5                          CFT014
      *                                                                   CFT014
      ** Intermediary Bank                                                CFT014
      *                                                                   CFT014
     C                     MOVELINB1      #1INB1                          CFT014
     C                     MOVELINB2      #1INB2                          CFT014
     C                     MOVELINB3      #1INB3                          CFT014
     C                     MOVELINB4      #1INB4                          CFT014
     C                     MOVELINB5      #1INB5                          CFT014
      *  Account with Institution
     C                     MOVELACB1      #1ACB1
     C                     MOVELACB2      #1ACB2
     C                     MOVELACB3      #1ACB3
     C                     MOVELACB4      #1ACB4
     C                     MOVELACB5      #1ACB5
      *  Beneficiary
     C/COPY WNCPYSRC,FT0345C074
     C                     MOVELBNC1      #1BNC1
     C/COPY WNCPYSRC,FT0345C075
     C                     MOVELBNC2      #1BNC2
     C                     MOVELBNC3      #1BNC3
     C                     MOVELBNC4      #1BNC4
     C                     MOVELBNC5      #1BNC5
      ***Details*of Payment                                               CFT014
     C/COPY WNCPYSRC,FT0345C076
     C***********          MOVELDTP1      #1DTP1                          CFT014
     C***********          MOVELDTP2      #1DTP2                          CFT014
     C***********          MOVELDTP3      #1DTP3                          CFT014
     C***********          MOVELDTP4      #1DTP4                          CFT014
     C/COPY WNCPYSRC,FT0345C077
      ***Sender*to Receiver information                                   CFT014
     C***********          MOVELBBI1      #1BBI1                          CFT014
     C***********          MOVELBBI2      #1BBI2                          CFT014
     C***********          MOVELBBI3      #1BBI3                          CFT014
     C***********          MOVELBBI4      #1BBI4                          CFT014
     C***********          MOVELBBI5      #1BBI5                          CFT014
     C***********          MOVELBBI6      #1BBI6                          CFT014
      *                                                                   187056
      ** Save work previous value of Charges to the Debit of.             187056
      *                                                                   187056
     C**********           MOVEL*BLANKS   WCDRO  12                                    187056 CGL029
     C                     MOVEL*BLANKS   WCDRO  18                                           CGL029
     C                     MOVELCDBR      WCDBR   3                       187056
     C                     MOVELCDRT      WCDRT   1                       187056
      *                                                                   187056
     C           CDRT      IFNE *BLANKS                                   187056
     C                     MOVELCDRO      A#0012                          187056
     C                     SELEC                                          187056
     C           CDRT      WHEQ 'N'                                       187056
     C           2         SUBSTA#0012:1  WCDRO     P                     187056
     C           CDRT      WHEQ 'R'                                       187056
     C           10        SUBSTA#0012:1  WCDRO     P                     187056
     C           CDRT      WHEQ 'P'                                       187056
     C                     MOVELCDRO      WCDRO                           187056
     C                     ENDSL                                          187056
     C                     ENDIF                                          187056
     C/COPY WNCPYSRC,FT0345C005
      *
      * Set V# variables
      *
     C                     MOVEL*BLANKS   R#RCHK
     C                     MOVELSMCY      R#SMCY
     C                     MOVELPCCY      R#PCCY
     C                     Z-ADDSMAM      R#SMAM
     C                     Z-ADDPYAM      R#PYAM
     C                     Z-ADDRATE      R#RATE
     C                     MOVELOVRD      R#OVRD
     C                     MOVELSTMT      R#STMT
     C                     MOVELR#RCHK    V#RCHK
     C                     MOVELRCO1      V#RCO1
     C                     MOVELACB1      V#ACB1
     C                     MOVELBNC1      V#BNC1
     C                     MOVELADDC      V#ADDC
     C                     Z-ADDSLDT      V#SLDT
     C                     Z-ADDPVDT      V#PVDT
     C                     Z-ADDSWPC      V#SWPC                          CFT009
     C                     MOVELSTMT      V#STMT
     C                     MOVEL*BLANKS   V#CCCY
     C                     MOVEL*BLANKS   V#RCCY
     C                     MOVELACBT      V#ACBT
     C                     MOVELCDRT      V#CDRT
     C                     Z-ADDSMAM      V#SMAM
     C                     Z-ADDPYAM      V#PYAM
     C                     MOVELINB1      V#INB1
     C                     MOVELORC1      V#ORC1
     C                     MOVEL*BLANKS   V#ORB1
     C                     MOVEL*BLANKS   V#SNC1
     C                     MOVELTRCT      V#TRCT
     C                     MOVELSNCT      V#SNCT
     C                     MOVELSNMT      V#SNMT
     C                     MOVELSMCY      V#SMCY
     C                     MOVELPCCY      V#PCCY
     C/COPY WNCPYSRC,FT0345C052
      *                                                                   CSW096
      * Fill From GL account                                              CSW096
      *                                                                   CSW096
     C                     SELEC                                          CSW096
      * Ordering Bank entered                                             CSW096
     C           ORBT      WHNE *BLANKS                                   CSW096
     C**********           MOVELORBK      ##018A 18 P                     CSW096       CSW096 CGL029
     C                     MOVELORBK      ##018A 24 P                                         CGL029
     C                     SELEC                                          CSW096
     C/COPY WNCPYSRC,FT0345C053
      * Retail Account                                                    CSW096
     C           ORBT      WHEQ 'R'                                       CSW096
     C           10        SUBST##018A:1  V#FRGL    P                     CSW096
      * Partial Nostro                                                    CSW096
     C           ORBT      WHEQ 'N'                                       CSW096
     C           2         SUBST##018A:1  V#FRGL    P                     CSW096
      * Others                                                            CSW096
     C                     OTHER                                          CSW096
     C                     MOVEL##018A    V#FRGL    P                     CSW096
     C                     MOVE ORBB      V#FRGL                          CSW096
     C                     ENDSL                                          CSW096
      * Ordering Customer entered no Ordering Bank                        CSW096
     C                     OTHER                                          CSW096
     C                     MOVELORC1      V#FRGL                          CSW096
      *                                                                                       CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C                     MOVELORC1      W01C    1                                           CFT032
     C           W01C      IFEQ '/'                                                           CFT032
     C           34        SUBSTORC1:2    PIBAN                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELORC1      PIBAN                                               CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM           @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           PIBAN                                               CFT032
     C           P@ACCN    PARM           DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C           *LOCK     IN   LDA                                                           CFT032
     C                     Z-ADD6         DBASE                                               CFT032
     C                     MOVELPIBAN     DBKEY                                               CFT032
     C                     MOVEL'ACCNTL6' DBFILE                                              CFT032
     C                     OUT  LDA                                                           CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           P@CNUM    CAT  P@ACOD    V#FRGL    P                                         CFT032
     C                     CAT  P@ACSQ:0  V#FRGL                                              CFT032
     C                     CAT  P@BRCA:0  V#FRGL                                              CFT032
     C                     ENDIF                                                              CFT032
      *
     C                     ENDSL                                          CSW096
      *                                                                   CSW096
      * Fill To GL account                                                CSW096
      *                                                                   CSW096
     C                     SELEC                                          CSW096
     C/COPY WNCPYSRC,FT0345C054
      * Sender's Correspondent entered                                    CSW096
     C           SNCT      WHNE *BLANKS                                   CSW096
     C**********           MOVELSNCO      ##018A 18 P                                  CSW096 CGL029
     C                     MOVELSNCO      ##018A    P                                         CGL029
     C                     SELEC                                          CSW096
      * Retail Account                                                    CSW096
     C           SNCT      WHEQ 'R'                                       CSW096
     C           10        SUBST##018A:1  V#TOGL    P                     CSW096
      * Partial Nostro                                                    CSW096
     C           SNCT      WHEQ 'N'                                       CSW096
     C           2         SUBST##018A:1  V#TOGL    P                     CSW096
      * Others                                                            CSW096
     C                     OTHER                                          CSW096
     C                     MOVEL##018A    V#TOGL    P                     CSW096
     C                     ENDSL                                          CSW096
      * Destination entered no Sender's Correspondent                     CSW096
     C                     OTHER                                          CSW096
     C                     MOVELDST1      V#FRGL                          CSW096
     C                     ENDSL                                          CSW096
     C/COPY WNCPYSRC,FT0345C070
      *                                                                   CAC001
      **  If margin info parameters passed from FT0040 is blank,          CAC001
      **  retrieve margin info fields from file.                          CAC001
      *                                                                   CAC001
     C           P4PARM    IFNE '*BLANKS'                                 CAC001
     C                     Z-ADDP4FXMP    WOFXMP                          CAC001
     C                     Z-ADDP4FXMD    WOFXMD                          CAC001
     C                     MOVE P4MBSI    WOMBSI                          CAC001
     C                     MOVE P4MSIG    WOMSIG                          CAC001
     C                     Z-ADDP4MAMT    WOMAMT                          CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADDFXMP      WOFXMP                          CAC001
     C                     Z-ADDFXMD      WOFXMD                          CAC001
     C                     MOVE MBSI      WOMBSI                          CAC001
     C                     MOVE MSIG      WOMSIG                          CAC001
     C                     Z-ADDMAMT      WOMAMT                          CAC001
     C                     ENDIF                                          CAC001
      *
      * Format status if action code is Enquiry
      *
     C                     MOVEL*BLANKS   #1STAT
     C           #1ACTC    IFEQ 'E'
      *
     C                     SELEC
     C           RECI      WHEQ 'M'
     C                     MOVEL'FTM2308' #MSGID
     C           RECI      WHEQ 'D'
     C           AUIN      ANDEQ'Y'
     C                     MOVEL'FTM2309' #MSGID
     C           RECI      WHEQ 'D'
     C                     MOVEL'FTM2310' #MSGID
     C           RECI      WHEQ 'C'
     C                     MOVEL'FTM2311' #MSGID
     C                     ENDSL
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM           #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #1STAT
     C                     END
      *
      * Format status if action code is Enquiry
      *
     C           #1ACTC    IFEQ 'E'
     C/COPY WNCPYSRC,FT0345C078
     C                     EXSR SRENQ1
     C                     END
      *
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialise key screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MDIZ#K'  @STK,Q
      *
     C                     MOVEL*BLANKS   #1ACTC           Action Code
     C                     MOVEL*BLANKS   #1PREF           Reference
     C                     MOVELP1ACTC    #1ACTC           Action Code
     C                     MOVELP2PREF    #1PREF           Reference
     C                     MOVEL'0'       *IN76            Remove Err
      *                                                                   CFT014
      ** Reset error indicators                                           CFT014
      *                                                                   CFT014
     C                     MOVE *ALL'0'   WERIND 30                       CFT014
     C                     MOVEAWERIND    *IN,31                          CFT014
      *
      * USER: Initialise key screen
      * EDTRCD: Init. key screen - R10 Copy source templates  *
      *
      * Action codes
      *
     C                     MOVEL*BLANKS   #KCMD1
     C           P1ACTC    IFEQ *BLANKS
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2009' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #KCMD1
     C                     END
      *
      * Function keys
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2003' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #KCMD2
      *
     C*EDTRCD: Cpysrc Templates Initialise Key Screen
     C/COPY WNCPYSRC,FT0345DIKS
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MEIZ#D    BEGSR
      *================================================================
      * Initialise Second detail screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MEIZ#D'  @STK,Q
      *
      * Recheck record Payment reference must exist
      *
     C                     EXSR VBCKRL
      *
      * Reset warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      *
     C***********          MOVELINB1      #2INB1                          CFT014
     C***********          MOVELINB2      #2INB2                          CFT014
     C***********          MOVELINB3      #2INB3                          CFT014
     C***********          MOVELINB4      #2INB4                          CFT014
     C***********          MOVELINB5      #2INB5                          CFT014
     C/COPY WNCPYSRC,FT0345C043
      *                                                                   CFT014
      ** Details of Payment                                               CFT014
      *                                                                   CFT014
     C                     MOVELDTP1      #2DTP1                          CFT014
     C                     MOVELDTP2      #2DTP2                          CFT014
     C                     MOVELDTP3      #2DTP3                          CFT014
     C                     MOVELDTP4      #2DTP4                          CFT014
      *                                                                   CFT014
      ** Sender to Receiver information                                   CFT014
      *                                                                   CFT014
     C                     MOVELBBI1      #2BBI1                          CFT014
     C                     MOVELBBI2      #2BBI2                          CFT014
     C                     MOVELBBI3      #2BBI3                          CFT014
     C                     MOVELBBI4      #2BBI4                          CFT014
     C                     MOVELBBI5      #2BBI5                          CFT014
     C                     MOVELBBI6      #2BBI6                          CFT014
      *                                                                   CFT014
     C           DNBC      IFNE 0
     C/COPY WNCPYSRC,FT0345C044
     C                     MOVELDNBC      #2DNBC
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP7                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C                     MOVEL*BLANKS   #2DNBC
     C                     END
      *                                                                   CFT014
      ** Transfer comission tariff                                        CFT014
      *                                                                   CFT014
     C                     MOVELTRCT      #2TRCT                          CFT014
      *                                                                   CFT014
      ** If transfer commission blank and action insert default           CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'                                       CFT014
     C           #2TRCT    ANDEQ*BLANKS                                   CFT014
     C           CFT009    ANDEQ'N'                                       CFT009
      *                                                                   CFT014
     C           PYBR      CHAINPYCHGDB              90                   CFT014
      *                                                                   CFT014
      ** No record found - DB error only if not multibranched             CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           WUMBIN    ANDNE'Y'                                       CFT014
     C                     MOVEL'PYCHGDB 'W0FILE                          CFT014
     C                     MOVELPYBR      W0KEY                           CFT014
     C                     Z-ADD22        W0ERNB                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** No payment charges information                                   CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVE *ON       *IN42                           CFT014
     C                     MOVELPYBR      ZAMSDA                          CFT014
     C                     MOVEL'FTM2001' ZAMSID                          CFT014
     C                     EXSR ZASNMS                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Payment charges information                                      CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *OFF                                      CFT014
     C                     MOVELDFTRCT    #2TRCT                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      ***********                                                         CFT014
      ***Default*to*BEN*if*blank***************************************   CFT014
      ***********                                                         CFT014
     C***********DTCH      IFNE *BLANKS                                   CFT014
     C***********          MOVELDTCH      #2DTCH                          CFT014
     C***********          ELSE                                           CFT014
     C***********          MOVEL'BEN'     #2DTCH                          CFT014
     C*/COPY*WNCPYSRC,FT0345C003                                          CFT014
     C***********          END                                            CFT014
     C/COPY WNCPYSRC,FT0345C055
      *
     C***********          SELEC                                          CFT014
     C*/COPY*WNCPYSRC,FT0345C020                                          CFT014
      *
     C***********BTCHCY    WHEQ 'B'                                       CFT014
     C***********#1CDRO    ORNE *BLANKS                            081699 CFT014
     C***********S5CDRO    ORNE *BLANKS                                   081699
     C***********          MOVELV#BCCY    V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********BTCHCY    WHEQ 'L'                                       CFT014
     C***********          MOVELV#LCCY    V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********BTCHCY    WHEQ 'C'                                       CFT014
     C***********V#ADDC    ANDEQ'A'                                       CFT014
     C***********          MOVELSMCY      V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********          OTHER                                          CFT014
     C***********          MOVELPCCY      V#CCCY                          CFT014
     C***********          ENDSL                                          CFT014
     C***********          MOVELV#CCCY    #2CCY1                          CFT014
     C***********          MOVELV#CCCY    #2CCY2                          CFT014
     C***********          MOVELV#CCCY    #2CCY3                          CFT014
     C***********          MOVELV#CCCY    #2CCY4                          CFT014
     C***********          MOVELV#CCCY    #2CCY5                          CFT014
     C***********          MOVELV#CCCY    #2CCY6                          CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELV#CCCY    #2CCY7                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELV#CCCY    #2CCY8                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      ***********                                                         CFT014
     C***********          SELEC                                          CFT014
      ***********                                                         CFT014
     C***********#1CDRO    WHNE *BLANKS                                   CFT014
     C***********          MOVELV#BCCY    V#RCCY                          CFT014
      ***********                                                         CFT014
     C***********V#ADDC    WHEQ 'A'                                       CFT014
     C***********          MOVELSMCY      V#RCCY                          CFT014
      ***********                                                         CFT014
     C***********          OTHER                                          CFT014
     C***********          MOVELPCCY      V#RCCY                          CFT014
     C***********          ENDSL                                          CFT014
      ***********                                                         CFT014
     C***********          MOVELV#RCCY    #2RCY1                          CFT014
     C***********          MOVELV#RCCY    #2RCY2                          CFT014
     C***********          MOVELV#RCCY    #2RCY3                          CFT014
     C***********          MOVELV#RCCY    #2RCY4                          CFT014
     C***********          MOVELV#RCCY    #2RCY5                          CFT014
     C***********          MOVELV#RCCY    #2RCY6                          CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELV#RCCY    #2RCY7                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELV#RCCY    #2RCY8                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01508 CFT014
     C****Perform*the*following*only*if*core*feature*S01508*is*****S01508 CFT014
     C****installed*and*core*feature*S01506*is*NOT*installed*******S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          MOVE *BLANKS   W0FCUS                   S01506 CFT014
     C***********          MOVE *BLANKS   W0SCUS                   S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********S01508    IFEQ 'Y'                                S01508 CFT014
     C***********S01506    ANDNE'Y'                                S01506 CFT014
     C***********                                                  S01506 CFT014
     C****Get*"Charges*to*the*debit*of"*customer*(database*field)**S01506 CFT014
     C****using*FT0035*********************************************S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********CDRT      IFNE *BLANKS                            S01506 CFT014
     C***********          MOVE CDRT      I#PT1                    S01506 CFT014
     C***********          MOVELCDRO      W0FLD  12                S01506 CFT014
     C***********W0FLD     CAT  CDBR      I#PTY1    P              S01506 CFT014
     C***********          MOVE V#BCCY    I#CCY                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          CALL 'FT0035'                           S01506 CFT014
     C***********          PARM *BLANKS   W0RTN                    S01506 CFT014
     C***********          PARM           W0DTA                    S01506 CFT014
     C***********          PARM           W0MSG                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          MOVE O#CUST    W0FCUS  6                S01506 CFT014
     C***********          END                                     S01506 CFT014
     C***********                                                  S01506 CFT014
     C****Get*"Charges*to*the*debit*of"*customer*(screen*field)****S01506 CFT014
     C****using*FT0035*********************************************S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********F5CDRT    IFNE *BLANKS                            S01506 CFT014
     C***********          MOVE F5CDRT    I#PT1                    S01506 CFT014
     C***********#1CDRO    CAT  #1CDBR    I#PTY1    P              S01506 CFT014
     C***********          MOVE V#BCCY    I#CCY                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C*/COPY*WNCPYSRC,FT0345C021                                          CFT014
     C***********          CALL 'FT0035'                           S01506 CFT014
     C***********          PARM *BLANKS   W0RTN                    S01506 CFT014
     C***********          PARM           W0DTA                    S01506 CFT014
     C***********          PARM           W0MSG                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          MOVE O#CUST    W0SCUS  6                S01506 CFT014
     C***********          END                                     S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          END                                     S01506 CFT014
      ***********                                                         CFT014
      ***If*Commission*type*changed*or*charges*to*the*debit*of*********   CFT014
      ***recalculate*charges*******************************************   CFT014
      ***********                                                         CFT014
     C***********#1ACTC    IFEQ 'I'                                       CFT014
     C***********#1ACTC    OREQ 'A'                                 100660133860
     C***********#1TRCT    ORNE TRCT                                      CFT014
     C***********#1CDRO    ORNE *BLANKS                                   CFT014
     C***********CDRO      ANDEQ0                                         CFT014
     C***********#1CDRO    OREQ *BLANKS                                   CFT014
     C***********CDRO      ANDNE0                                         CFT014
     C***********#1ACTC    OREQ 'A'                                S01506 CFT014
     C***********W0FCUS    ANDNEW0SCUS                             S01506 CFT014
     C***********          EXSR SRCDFT                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Look*field*up*on*database                                        CFT014
      ***********                                                         CFT014
     C***********          CALL 'AOCURRR0'             9090               CFT014
     C***********          PARM *BLANKS   RTCD    7                       CFT014
     C***********          PARM '*KEY   ' @OPTN   7                       CFT014
     C***********          PARM V#CCCY    @K101   3                       CFT014
     C***********SDCURR    PARM *BLANKS   DSSDY                           CFT014
      ***********                                                         CFT014
      ***If*error*on*call**********************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'AOCURRR0'W0FILE           ***************CFT014
     C***********          MOVEL'*CALL'   W0KEY            * DB ERROR 03 *CFT014
     C***********          Z-ADD3         W0ERNB           ***************CFT014
     C***********          MOVEL'MEM5003' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
     C***********                                                  S01499 CFT014
     C****Save*number*of*decimal*places*(input*currency)***********S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          Z-ADDA6NBDP    V#CDCP  10               S01499 CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C*/COPY*WNCPYSRC,FT0345C030                                          CFT014
     C***********          MOVEL*BLANKS   #2TRCD                          CFT014
     C*/COPY*WNCPYSRC,FT0345C006                                          CFT014
     C***********DUMA1     IFNE 0                                         CFT014
     C***********          MOVE DUMA1     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TRCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TXCD                          CFT014
     C*/COPY*WNCPYSRC,FT0345C007                                          CFT014
     C***********DUMA2     IFNE 0                                         CFT014
     C***********          MOVE DUMA2     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TXCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CQCD                          CFT014
     C*/COPY*WNCPYSRC,FT0345C008                                          CFT014
     C***********DUMA3     IFNE 0                                         CFT014
     C***********          MOVE DUMA3     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CQCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CSTD                          CFT014
     C*/COPY*WNCPYSRC,FT0345C009                                          CFT014
     C***********DUMA4     IFNE 0                                         CFT014
     C***********          MOVE DUMA4     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CSTD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      *
     C***********          MOVEL*BLANKS   #2SPCD                          CFT014
     C*/COPY*WNCPYSRC,FT0345C010                                          CFT014
     C***********DUMA5     IFNE 0                                         CFT014
     C***********          MOVE DUMA5     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2SPCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2MSCD                          CFT014
     C***********DUMA6     IFNE 0                                         CFT014
     C***********          MOVE DUMA6     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2MSCD                          CFT014
     C***********          END                                            CFT014
     C***********                                                  S01494 CFT014
     C**FFormataamountfforsscreen**********************************S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL*BLANKS   #2CHCD                   S01494 CFT014
     C***********OPDUM7    IFNE 0                                  S01494 CFT014
     C***********          MOVE OPDUM7    ZFIELD                   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          CALL 'ZEDIT'                9090        S01494 CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTIONS01494 CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DES01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          MOVE ZFIELD    #2CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
      ***********                                                         CFT014
      ***Look*field*up*on*database*************************************   CFT014
      ***********                                                         CFT014
     C***********          CALL 'AOCURRR0'             9090               CFT014
     C***********          PARM *BLANKS   RTCD                            CFT014
     C***********          PARM '*KEY   ' @OPTN                           CFT014
     C***********          PARM V#RCCY    @K101                           CFT014
     C***********SDCURR    PARM *BLANKS   DSSDY                           CFT014
      ***********                                                         CFT014
      ***If*error*on*call**********************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'AOCURRR0'W0FILE           ***************CFT014
     C***********          MOVEL'*CALL'   W0KEY            * DB ERROR 04 *CFT014
     C***********          Z-ADD4         W0ERNB           ***************CFT014
     C***********          MOVEL'MEM5003' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
     C***********                                                  S01499 CFT014
     C****Save*number*of*decimal*places*(charge currency)**********S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          Z-ADDA6NBDP    V#RDCP  10               S01499 CFT014
      ***********                                                         CFT014
     C**Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C*/COPY*WNCPYSRC,FT0345C031                                          CFT014
     C***********          MOVEL*BLANKS   #2TRCM                          CFT014
     C***********TRCM      IFNE 0                                         CFT014
     C***********          MOVE TRCM      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16     B:FUNCTION FIELD  CFT014
     C***********          PARM A6NBDP    ZADEC   10    I:NO OF DECIMALS  CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TRCM                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TXCH                          CFT014
     C***********TXCH      IFNE 0                                         CFT014
     C***********          MOVE TXCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16       B:FUNCTION FIEL CFT014
     C***********          PARM A6NBDP    ZADEC   10      I:NO OF DECIMAL CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TXCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CQCH                          CFT014
     C***********CQCH      IFNE 0                                         CFT014
     C***********          MOVE CQCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CQCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CSTA                          CFT014
     C***********CSTA      IFNE 0                                         CFT014
     C***********          MOVE CSTA      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CSTA                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2SPCH                          CFT014
     C***********SPCH      IFNE 0                                         CFT014
     C***********          MOVE SPCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2SPCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***********************************S01494 CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2MSCH                          CFT014
     C***********MSCH      IFNE 0                                         CFT014
     C***********          MOVE MSCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2MSCH                          CFT014
     C***********          END                                            CFT014
     C***********                                                  S01494 CFT014
     C***Format*amount*for*screen**********************************S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL*BLANKS   #2CHCM                   S01494 CFT014
     C***********OPCHCM    IFNE 0                                  S01494 CFT014
     C***********          MOVE OPCHCM    ZFIELD                   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          CALL 'ZEDIT'                9090        S01494 CFT014
     C***********          PARM           ZFIELD 16     B:FUNCTION S01499 CFT014
     C***********          PARM A6NBDP    ZADEC   10    I:NO OF DECS01499 CFT014
     C***********                                                  S01494 CFT014
     C***********          MOVE ZFIELD    #2CHCM                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***If*switchable*feature*S01499*is*switched*ON,*initialise***S01499 CFT014
     C***V.A.T.*flags*and*total*V.A.T.*amount.*********************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Transfer*commission*V.A.T.*flag***************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT1                   S01499 CFT014
     C***********OPVAT1    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT1    #2VAT1                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT1                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telex*V.A.T.*flag*****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT2                   S01499 CFT014
     C***********OPVAT2    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT2    #2VAT2                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT2                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Cheque*V.A.T.*flag****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT3                   S01499 CFT014
     C***********OPVAT3    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT3    #2VAT3                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT3                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Costs*V.A.T.*flag*****************************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT4                   S01499 CFT014
     C***********OPVAT4    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT4    #2VAT4                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT4                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***SWIFT*priority*V.A.T.*flag********************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT5                   S01499 CFT014
     C***********OPVAT5    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT5    #2VAT5                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT5                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Miscellaneous*V.A.T.*flag*********************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT6                   S01499 CFT014
     C***********OPVAT6    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT6    #2VAT6                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT6                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***FX/Change*commission*V.A.T.*flag**************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT7                   S01499 CFT014
     C***********OPVAT7    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELOPVAT7    #2VAT7                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***If*charges*are*recalculated,*then recalculate*total*V.A.T.S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********W0RCAL    IFEQ 'Y'                                S01499 CFT014
     C***********          EXSR SRVATC                             S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Format*total*V.A.T.*amount*for*screen*********************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VATD                   S01499 CFT014
     C***********OPDUM8    IFNE 0                                  S01499 CFT014
     C***********          MOVE OPDUM8    ZFIELD                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          CALL 'ZEDIT'                9090        S01499 CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTIONS01499 CFT014
     C***********          PARM V#CDCP    ZADEC   10    I:NO OF DECS01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE ZFIELD    #2VATD                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Format*total*V.A.T.*amount*for*screen*********************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VATT                   S01499 CFT014
     C***********OPVATT    IFNE 0                                  S01499 CFT014
     C***********          MOVE OPVATT    ZFIELD                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          CALL 'ZEDIT'                9090        S01499 CFT014
     C***********          PARM           ZFIELD 16        B:FUNCTION1FLD CFT014
     C***********          PARM V#RDCP    ZADEC   10       I:NO OF DEC499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE ZFIELD    #2VATT                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C****Reset*recalculation*flag*********************************S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE 'N'       W0RCAL                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C                     MOVELRLPR      #2RLPR
     C           CHAP      IFNE 0
     C                     MOVELCHAP      #2CHAP
     C                     ELSE
     C                     MOVEL*BLANKS   #2CHAP
     C                     END
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Instruction codes                                                CFT014
      *                                                                   CFT014
     C                     MOVELOPICD1    #2INS1                          CFT014
     C                     MOVELOPICD2    #2INS2                          CFT014
     C                     MOVELOPICD3    #2INS3                          CFT014
     C                     MOVELOPICD4    #2INS4                          CFT014
     C                     MOVELOPICD5    #2INS5                          CFT014
      *                                                                   CFT014
      ** Regulatory reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVELOPRRP1    #2RGR1                          CFT014
     C                     MOVELOPRRP2    #2RGR2                          CFT014
     C                     MOVELOPRRP3    #2RGR3                          CFT014
     C                     ENDIF                                          CFT014
      ***********                                                         CFT014
      **Format*status*if*action*code*is*Enquiry************************   CFT014
      ***********                                                         CFT014
     C***********#1ACTC    IFEQ 'E'                                       CFT014
     C***********          EXSR SRENQ2                                    CFT014
     C***********          END                                            CFT014
     C/COPY WNCPYSRC,FT0345C036
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MFIZ#D    BEGSR
      *================================================================
      * Reset fields on screen                   *
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MFIZ#D'  @STK,Q
      *                                                                   CFT014
     C                     MOVELV#CCCY    #3CCY1                          CFT014
     C                     MOVELV#CCCY    #3CCY2                          CFT014
     C                     MOVELV#CCCY    #3CCY3                          CFT014
     C                     MOVELV#CCCY    #3CCY4                          CFT014
     C                     MOVELV#CCCY    #3CCY5                          CFT014
     C                     MOVELV#CCCY    #3CCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY8                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD    7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM V#CCCY    @K101   3
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 05 *
     C                     Z-ADD5         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                   CFT009
      ** Save the number of decimal places, for later use with the        CFT009
      ** VAT amounts.                                                     CFT009
      *                                                                   CFT009
     C                     Z-ADDA6NBDP    SAVEDP  10                      CFT009
      *
      * Format amount for screen
      *
     C***********F6TRCD    IFNE 0                                         CFT014
     C***********I6TRCM    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6TRCD    ZFIELD                          CFT014
     C           F7TRCD    IFNE 0                                         CFT014
     C           I7TRCM    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7TRCD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TRCD                          CFT014
     C                     MOVE ZFIELD    #3TRCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F6TXCD    IFNE 0                                         CFT014
     C***********I6TXCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6TXCD    ZFIELD                          CFT014
     C           F7TXCD    IFNE 0                                         CFT014
     C           I7TXCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7TXCD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TXCD                          CFT014
     C                     MOVE ZFIELD    #3TXCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F6CQCD    IFNE 0                                         CFT014
     C***********I6CQCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6CQCD    ZFIELD                          CFT014
     C           F7CQCD    IFNE 0                                         CFT014
     C           I7CQCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7CQCD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CQCD                          CFT014
     C                     MOVE ZFIELD    #3CQCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F6CSTD    IFNE 0                                         CFT014
     C***********I6CSTH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6CSTD    ZFIELD                          CFT014
     C           F7CSTD    IFNE 0                                         CFT014
     C           I7CSTH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7CSTD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CSTD                          CFT014
     C                     MOVE ZFIELD    #3CSTD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F6SPCD    IFNE 0                                         CFT014
     C***********I6SPCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6SPCD    ZFIELD                          CFT014
     C           F7SPCD    IFNE 0                                         CFT014
     C           I7SPCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7SPCD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2SPCD                          CFT014
     C                     MOVE ZFIELD    #3SPCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F6MSCD    IFNE 0                                         CFT014
     C***********I6MSCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F6MSCD    ZFIELD                          CFT014
     C           F7MSCD    IFNE 0                                         CFT014
     C           I7MSCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7MSCD    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2MSCD                          CFT014
     C                     MOVE ZFIELD    #3MSCD                          CFT014
     C                     END
     C*                                                                   S01494
     C** Format amount for screen                                         S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C***********F6CHCD    IFNE 0                                  S01494 CFT014
     C***********I6CHCM    ANDEQ*BLANKS                            S01494 CFT014
     C***********          MOVE F6CHCD    ZFIELD                   S01494 CFT014
     C           F7CHCD    IFNE 0                                         CFT014
     C           I7CHCM    ANDEQ*BLANKS                                   CFT014
     C                     MOVE F7CHCD    ZFIELD                          CFT014
     C*                                                                   S01494
     C                     CALL 'ZEDIT'                9090               S01494
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01494
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01494
     C*                                                                   S01494
     C***********          MOVE ZFIELD    #2CHCD                   S01494 CFT014
     C                     MOVE ZFIELD    #3CHCD                          CFT014
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      * Format amount for screen                                          CFT009
      *                                                                   CFT009
     C           F7STCD    IFNE 0                                         CFT009
     C           I7STCD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7STCD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    STCD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F7M1CD    IFNE 0                                         CFT009
     C           I7M1CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7M1CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M1CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F7M2CD    IFNE 0                                         CFT009
     C           I7M2CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7M2CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M2CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F7M3CD    IFNE 0                                         CFT009
     C           I7M3CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7M3CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M3CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F7M4CD    IFNE 0                                         CFT009
     C           I7M4CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7M4CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M4CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F7M5CD    IFNE 0                                         CFT009
     C           I7M5CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F7M5CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     MOVELV#RCCY    #3RCY1                          CFT014
     C                     MOVELV#RCCY    #3RCY2                          CFT014
     C                     MOVELV#RCCY    #3RCY3                          CFT014
     C                     MOVELV#RCCY    #3RCY4                          CFT014
     C                     MOVELV#RCCY    #3RCY5                          CFT014
     C                     MOVELV#RCCY    #3RCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY8                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM V#RCCY    @K101
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 06 *
     C                     Z-ADD6         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2TRCM                          CFT014
     C***********F6TRCM    IFNE 0                                         CFT014
     C***********          MOVE F6TRCM    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3TRCM                          CFT014
     C           F7TRCM    IFNE 0                                         CFT014
     C                     MOVE F7TRCM    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TRCM                          CFT014
     C                     MOVE ZFIELD    #3TRCM                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2TXCH                          CFT014
     C***********F6TXCH    IFNE 0                                         CFT014
     C***********          MOVE F6TXCH    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3TXCH                          CFT014
     C           F7TXCH    IFNE 0                                         CFT014
     C                     MOVE F7TXCH    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TXCH                          CFT014
     C                     MOVE ZFIELD    #3TXCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2CQCH                          CFT014
     C***********F6CQCH    IFNE 0                                         CFT014
     C***********          MOVE F6CQCH    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3CQCH                          CFT014
     C           F7CQCH    IFNE 0                                         CFT014
     C                     MOVE F7CQCH    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CQCH                          CFT014
     C                     MOVE ZFIELD    #3CQCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2CSTA                          CFT014
     C***********F6CSTA    IFNE 0                                         CFT014
     C***********          MOVE F6CSTA    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3CSTA                          CFT014
     C           F7CSTA    IFNE 0                                         CFT014
     C                     MOVE F7CSTA    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CSTA                          CFT014
     C                     MOVE ZFIELD    #3CSTA                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2SPCH                          CFT014
     C***********F6SPCH    IFNE 0                                         CFT014
     C***********          MOVE F6SPCH    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3SPCH                          CFT014
     C           F7SPCH    IFNE 0                                         CFT014
     C                     MOVE F7SPCH    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2SPCH                          CFT014
     C                     MOVE ZFIELD    #3SPCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2MSCH                          CFT014
     C***********F6MSCH    IFNE 0                                         CFT014
     C***********          MOVE F6MSCH    ZFIELD                          CFT014
     C                     MOVEL*BLANKS   #3MSCH                          CFT014
     C           F7MSCH    IFNE 0                                         CFT014
     C                     MOVE F7MSCH    ZFIELD                          CFT014
      *
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2MSCH                          CFT014
     C                     MOVE ZFIELD    #3MSCH                          CFT014
     C                     END
     C*                                                                   S01494
     C** Format amount for screen                                         S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          MOVEL*BLANKS   #2CHCM                   S01494 CFT014
     C***********F6CHCM    IFNE 0                                  S01494 CFT014
     C***********          MOVE F6CHCM    ZFIELD                   S01494 CFT014
     C                     MOVEL*BLANKS   #3CHCM                          CFT014
     C           F7CHCM    IFNE 0                                         CFT014
     C                     MOVE F7CHCM    ZFIELD                          CFT014
     C*                                                                   S01494
     C                     CALL 'ZEDIT'                9090               S01494
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01494
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01494
     C*                                                                   S01494
     C***********          MOVE ZFIELD    #2CHCM                   S01494 S01494
     C                     MOVE ZFIELD    #3CHCM                          CFT014
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Format amount for screen                                         S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT010    OREQ 'Y'                                       CFT009
     C*                                                                   S01499
     C***********          MOVEL*BLANKS   #2VATD                   S01499 CFT014
     C***********F6VATD    IFNE 0                                  S01499 CFT014
     C***********          MOVE F6VATD    ZFIELD                   S01499 CFT014
     C                     MOVEL*BLANKS   #3VATD                          CFT014
     C           F7VATD    IFNE 0                                         CFT014
     C                     MOVE F7VATD    ZFIELD                          CFT014
     C*                                                                   S01499
     C                     CALL 'ZEDIT'                9090               S01499
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01499
     C***********          PARM A6NBDP    ZADEC   10       I:NO OF  S01499CFT009
     C                     PARM SAVEDP    ZADEC                           CFT009
     C*                                                                   S01499
     C***********          MOVE ZFIELD    #2VATD                   S01499 S01499
     C                     MOVE ZFIELD    #3VATD                          CFT014
     C                     END                                            S01499
     C*                                                                   S01499
     C***********          MOVEL*BLANKS   #2VATT                   S01499 CFT014
     C***********F6VATT    IFNE 0                                  S01499 CFT014
     C***********          MOVE F6VATT    ZFIELD                   S01499 CFT014
     C                     MOVEL*BLANKS   #3VATT                          CFT014
     C           F7VATT    IFNE 0                                         CFT014
     C                     MOVE F7VATT    ZFIELD                          CFT014
     C*                                                                   S01499
     C                     CALL 'ZEDIT'                9090               S01499
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01499
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01499
     C*                                                                   S01499
     C***********          MOVE ZFIELD    #2VATT                   S01499 S01499
     C                     MOVE ZFIELD    #3VATT                          CFT014
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                                            S01499
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   STCH                            CFT009
     C           F7STCH    IFNE 0                                         CFT009
     C                     MOVE F7STCH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    STCH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CH                            CFT009
     C           F7M1CH    IFNE 0                                         CFT009
     C                     MOVE F7M1CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M1CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CH                            CFT009
     C           F7M2CH    IFNE 0                                         CFT009
     C                     MOVE F7M2CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M2CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CH                            CFT009
     C           F7M3CH    IFNE 0                                         CFT009
     C                     MOVE F7M3CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M3CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CH                            CFT009
     C           F7M4CH    IFNE 0                                         CFT009
     C                     MOVE F7M4CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M4CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CH                            CFT009
     C           F7M5CH    IFNE 0                                         CFT009
     C                     MOVE F7M5CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M5CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C                     MOVE PCCY      WCURCY                          CFT014
     C                     Z-ADD56        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
      *                                                                   CFT014
      ** Format receiver's charge remitted                                CFT014
      *                                                                   CFT014
     C           F7RCRM    IFNE *ZERO                                     CFT014
     C           I7RCRM    ANDEQ*BLANK                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7RCRM    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3RCDR                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format sender's charges deducted                                 CFT014
      *                                                                   CFT014
     C           F7SCH1    IFNE *ZERO                                     CFT014
     C           I7SCH1    ANDEQ*BLANK                                    CFT014
     C           I7SCC1    ANDEQ*BLANK                                    CFT014
     C                     MOVE F7SCC1    WCURCY                          CFT014
     C                     Z-ADD57        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7SCH1    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD1                          CFT014
     C                     MOVELF7SCC1    #3SCC1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F7SCH2    IFNE *ZERO                                     CFT014
     C           I7SCH2    ANDEQ*BLANK                                    CFT014
     C           I7SCC2    ANDEQ*BLANK                                    CFT014
     C                     MOVE F7SCC2    WCURCY                          CFT014
     C                     Z-ADD58        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7SCH2    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD2                          CFT014
     C                     MOVE F7SCC2    #3SCC2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F7SCH3    IFNE *ZERO                                     CFT014
     C           I7SCH3    ANDEQ*BLANK                                    CFT014
     C           I7SCC3    ANDEQ*BLANK                                    CFT014
     C                     MOVE F7SCC3    WCURCY                          CFT014
     C                     Z-ADD59        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7SCH3    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD3                          CFT014
     C                     MOVE F7SCC3    #3SCC3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F7SCH4    IFNE *ZERO                                     CFT014
     C           I7SCH4    ANDEQ*BLANK                                    CFT014
     C           I7SCC4    ANDEQ*BLANK                                    CFT014
     C                     MOVE F7SCC4    WCURCY                          CFT014
     C                     Z-ADD60        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7SCH4    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD4                          CFT014
     C                     MOVE F7SCC4    #3SCC4                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F7SCH5    IFNE *ZERO                                     CFT014
     C           I7SCH5    ANDEQ*BLANK                                    CFT014
     C           I7SCC5    ANDEQ*BLANK                                    CFT014
     C                     MOVE F7SCC5    WCURCY                          CFT014
     C                     Z-ADD61        WERNB                           CFT014
     C                     EXSR SRACCY                                    CFT014
     C                     MOVE *BLANK    ZFIELD                          CFT014
     C                     MOVE F7SCH5    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM A6NBDP    ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCD5                          CFT014
     C                     MOVE F7SCC5    #3SCC5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Change Record - Incoming Paymenet        *
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SDCHRC'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      * Move key fields to @OTPAYL0
      *
     C                     MOVEL#1PREF    PREF
     C           KPREF     CHAIN@OTPAYL0             9091  *
     C/COPY WNCPYSRC,FT0345C022
      *
     C           *IN90     IFEQ '1'
     C                     Z-ADD7         W0ERNB           **************
     C                     MOVEL'OTPAYL1 'W0FILE           *DB ERROR 07 *
     C                     MOVELPREF      W0KEY            **************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           *IN91     IFEQ '1'
      *
      * Record locked
      *
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     END
     C/COPY WNCPYSRC,FT0345C029
      *
      * Check for changed record
      *
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      *
      * Send message '*Update not accepted'
      *
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * Use SETLL to release record lock
      *
     C           KPREF     SETLL@OTPAYL0             9091  *
     C                     GOTO SDEXIT
     C                     END                             FI #1DBRC
      *                                                                   CFT014
      ** Access outgoing payments extension file (update file)            CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       191351
     C           KPREF     CHAINOPAYXL2              90                   CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVEL'OTPAYXL0'W0FILE                          CFT014
     C                     MOVELPREF      W0KEY                           CFT014
     C                     Z-ADD40        W0ERNB                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C********** CFT014    IFEQ 'Y'                                 CFT014191351
      *                                                                   CFT014
      ** Save the old value of Receiver's Charges remitted                CFT014
      *                                                                   CFT014
     C                     Z-ADDOPRCRM    WOLDRC 110                      CFT014
      *                                                                   CFT014
     C           LVL1      IFEQ 'Y'                                       CFT014
     C           PYTP      ANDNE'RP'                                      CFT014
     C           OPRCRM    ANDNEF7RCRM                                    CFT014
     C           PYAM      ADD  OPRCRM    ##PYAM                          CFT014
     C                     Z-SUB##PYAM    ##PYAM                          CFT014
     C                     EXSR SRPADD                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   068320
      * Calculate charge amount (always debit)                            068320
      *                                                                   068320
     C                     MOVEL' '       CHGTYP  1                       CFT009
     C                     EXSR SUMCHG                                    CFT014
     C***********TXCH      ADD  CQCH      ##CHGS                    068320CFT014
     C***********          ADD  CSTA      ##CHGS                    068320CFT014
     C***********          ADD  SPCH      ##CHGS                    068320CFT014
     C***********          ADD  MSCH      ##CHGS                    068320CFT014
     C***********          ADD  TRCM      ##CHGS                    068320CFT014
     C***********S01494    IFEQ 'Y'                                 S01494CFT014
     C***********          ADD  OPCHCM    ##CHGS                    S01494CFT014
     C***********          END                                      S01494CFT014
     C***********S01499    IFEQ 'Y'                                 S01499CFT014
     C*********************ADD  OPVATT    ##CHGS                    S01499CFT014
     C*********************END                                      S01499CFT014
      *                                                                   068320
     C           ##CHGS    IFNE 0                                         068320
     C           PYTP      ANDNE'RP'                                      082485
     C           #1ACTC    ANDNE'I'                                       126281
     C           ##CHGS    ORNE 0                                         CFT009
     C           CFT009    ANDEQ'Y'                                       CFT009
      *                                                                   CFT014
      * Include Receiver's Charges remitted, if present                   CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     SELEC                                          CFT014
     C***********CDRO      WHNE 0                                                      CFT014 CSD027
     C           CDRO      WHNE *BLANKS                                                       CSD027
     C                     ADD  OPRBCQ    ##CHGS                          CFT014
     C           V#ADDC    WHEQ 'A'                                       CFT014
     C                     ADD  OPRCSC    ##CHGS                          CFT014
     C                     ENDSL                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-SUB##CHGS    ##CHGS                          068320
     C                     EXSR SRSCHG                                    068320
     C/COPY WNCPYSRC,FT0345C087
     C                     END                                            068320
      *
      * Move all fields to @OTPAYL0
      *
     C                     EXSR SRMOVE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP5                                           S01408
     C*                                                                   S01408
      *                                                                   CFT009
      ** Set up DAF fields, as per FT0040 incase user has changed         CFT009
      ** default charges                                                  CFT009
      *                                                                   CFT009
     C                     EXSR DAFSUB                                    CFT009
      *                                                                   CFT009
     C                     UPDAT@OTPAYL0               91  *
      *
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'SD008160'                                                    CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           *IN91     IFEQ '1'
      *
      * Change error detected
      *
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   068320
      * Calculate charge amount (always debit)                            068320
      *                                                                   068320
     C                     MOVEL'C'       CHGTYP  1                       CFT009
     C                     EXSR SUMCHG                                    CFT014
     C                     MOVEL' '       CHGTYP  1                       CFT009
     C***********TXCH      ADD  CQCH      ##CHGS                   068320 CFT014
     C***********          ADD  CSTA      ##CHGS                   068320 CFT014
     C***********          ADD  SPCH      ##CHGS                   068320 CFT014
     C***********          ADD  MSCH      ##CHGS                   068320 CFT014
     C***********          ADD  TRCM      ##CHGS                   068320 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          ADD  OPCHCM    ##CHGS                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C*********************ADD  OPVATT    ##CHGS                   S01499 CFT014
     C*********************END                                     S01499 CFT014
      *                                                                   068320
     C           ##CHGS    IFNE 0                                         068320
     C           PYTP      ANDNE'RP'                                      082485
      *                                                                   CFT014
      * Include Receiver's Charges remitted, if present                   CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     SELEC                                          CFT014
     C           #3CDRO    WHNE *BLANKS                                   CFT014
     C                     ADD  OPRBCQ    ##CHGS                          CFT014
     C           V#ADDC    WHEQ 'A'                                       CFT014
     C                     ADD  OPRCSC    ##CHGS                          CFT014
     C                     ENDSL                                          CFT014
     C                     ENDIF                                          CFT014
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELF7CHCY    OPCHGC                          CFT009
     C                     Z-ADDF7CHXR    OPCHRT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     EXSR SRSCHG                                    068320
     C                     END                                            068320
      *                                                                   CFT014
      ** Update extension file OTPAYXL2                                   CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       191351
     C                     UPDATOPAYXL2                                   CFT014
      *                                                                   CFT014
     C***********CFT014    IFEQ 'Y'                                 CFT014191351
     C***********LVL1      ANDEQ'Y'                                 CFT014191351
     C           LVL1      IFEQ 'Y'                                       191351
     C           PYTP      ANDNE'RP'                                      CFT014
     C           WOLDRC    ANDNEF7RCRM                                    CFT014
     C           PYAM      ADD  OPRCRM    ##PYAM                          CFT014
     C                     EXSR SRPADD                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          191351
      *
      * DBF change successful
      *
      * Update Incoming Message FT Transaction Status File record
      *
     C           OPMSGR    IFNE 0
      *
     C                     MOVEL'MIN0193' W0LMSG  7
      *
     C                     EXSR SRLOG
      *
     C                     END
      *
      *  Update database with changes
      *
     C                     EXSR SRUPD
      *
      * Update saved record image
      *
     C                     MOVEL@1DBRC    #1DBRC
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           SDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************   CFT014
      /TITLE SR/SRPADD                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRPADD - Update shadow postings for payment amount           *   CFT014
      *                                                               *   CFT014
      *  Called By: SDCHRC Subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  AOSPOSU0  - Control update to online positions               *   CFT014
      *  SRERR     - Error subroutine.                                *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRPADD    BEGSR                           *** SRPADD *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRPADD'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     CLEARQ#DTA                                     CFT014
     C           SNCT      IFNE *BLANKS                                   CFT014
     C                     MOVELSNCT      Q#ATYP                          CFT014
     C**********           MOVELSNCO      Q#ACCT                                       CFT014 CGL029
     C                     MOVELSNCO      Q#ACCT 24                                           CGL029
     C           6         SUBSTQ#ACCT:1  W#CNU1  6                                           CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1 10                                           CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1  2                                           CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ELSE                                           CFT014
     C                     MOVELDSTT      Q#ATYP                          CFT014
     C                     MOVELDST1      Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ENDIF                                          CFT014
     C                     Z-ADDPVDT      Q#VDAT                          CFT014
      *                                                                   CFT014
      ** Set posting date according to FT Control Data                    CFT014
      *                                                                   CFT014
     C           T#PDTI    IFEQ 'I'                                       CFT014
     C                     Z-ADDBJRDNB    Q#PSTD                          CFT014
     C                     ELSE                                           CFT014
     C           T#PDTI    IFEQ 'E'                                       CFT014
     C                     Z-ADDPVDT      Q#PSTD                          CFT014
     C                     ELSE                                           CFT014
     C           SLDT      IFLT PVDT                                      CFT014
     C                     Z-ADDSLDT      Q#PSTD                          CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDPVDT      Q#PSTD                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL'O'       Q#IO                            CFT014
     C                     MOVELPCCY      Q#CCY                           CFT014
     C                     MOVELPYTP      Q#TRYP                          CFT014
     C                     MOVELPREF      Q#PREF                          CFT014
     C                     Z-SUB##PYAM    Q#AMT                           CFT014
     C                     MOVEL'FT'      Q#MOD                           CFT014
     C                     MOVEL'01'      Q#OLRC                          CFT014
     C                     MOVEL##FTOV    Q#FTOV                          CFT014
     C                     MOVEL'Y'       Q#RPST                          CFT014
     C                     Z-ADD20        Q#RPNB                          CFT014
     C                     MOVEL'C'       Q#RTYP                          CFT014
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   CFT014
      ** Call AOSPOSU0                                                    CFT014
     C/COPY WNCPYSRC,FT0345C086
      *                                                                   CFT014
     C                     CALL 'AOSPOSU0'             9090               CFT014
     C           R#RTN     PARM *BLANKS   O#RTN                           CFT014
     C                     PARM '*ADD    'W0ACT                           CFT014
     C                     PARM Q#DTA     O#DTA                           CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           R#RTN     ORNE *BLANKS                                   CFT014
     C                     MOVEL'AOSPOSU0'W0FILE                          CFT014
     C                     MOVEL'*CALL   'W0KEY                           CFT014
     C                     Z-ADD41        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q       50                      CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
     C/EJECT                                                              CFT014
      *****************************************************************
      *                                                               *
      *  SRENQ1   : Expand fields using FT0315                        *
      *                                                               *
      *  CALLED BY: MBFL#1 - Format data for screen                   *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRENQ1    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRENQ1'  @STK,Q
      *
      *  Set up general parameters
      *
     C                     CLEARW8FT
     C                     MOVELSTMT      W8STMT
     C                     MOVEL##PGM     W8CPGM
     C                     MOVEL'*ENQ'    W8ACT
     C                     Z-ADD5         W8NLIN
      *
      *  Receivers Correspondent
      *
     C                     MOVELRCRT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELRCO1      ADCHK1
     C                     MOVELRCO2      ADCHK2
     C                     MOVELRCO3      ADCHK3
     C                     MOVELRCO4      ADCHK4
     C                     MOVELRCO5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1RCO1
     C                     MOVELADCHK2    #1RCO2
     C                     MOVELADCHK3    #1RCO3
     C                     MOVELADCHK4    #1RCO4
     C                     MOVELADCHK5    #1RCO5
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVELOPTRIT    W8TYPE                          CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT014
     C                     MOVELOPTRI1    ADCHK1                          CFT014
     C                     MOVELOPTRI2    ADCHK2                          CFT014
     C                     MOVELOPTRI3    ADCHK3                          CFT014
     C                     MOVELOPTRI4    ADCHK4                          CFT014
     C                     MOVELOPTRI5    ADCHK5                          CFT014
     C                     MOVELADDRSS    W8LINS                          CFT014
      *                                                                   CFT014
      ** Call expansion program                                           CFT014
      *                                                                   CFT014
     C                     CALL 'FT0315'                                  CFT014
     C                     PARM           W8RTN                           CFT014
     C                     PARM           W8FT                            CFT014
     C                     PARM           W8LINS                          CFT014
     C                     PARM           W8RPT                           CFT014
     C                     PARM           W8MSG                           CFT014
     C                     PARM           W8SCR                           CFT014
      *                                                                   CFT014
     C                     MOVELW8SCR     ADDRSS                          CFT014
     C                     MOVELADCHK1    #1TRI1                          CFT014
     C                     MOVELADCHK2    #1TRI2                          CFT014
     C                     MOVELADCHK3    #1TRI3                          CFT014
     C                     MOVELADCHK4    #1TRI4                          CFT014
     C                     MOVELADCHK5    #1TRI5                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  Account with Institution
      *
     C                     MOVELACBT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELACB1      ADCHK1
     C                     MOVELACB2      ADCHK2
     C                     MOVELACB3      ADCHK3
     C                     MOVELACB4      ADCHK4
     C                     MOVELACB5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1ACB1
     C                     MOVELADCHK2    #1ACB2
     C                     MOVELADCHK3    #1ACB3
     C                     MOVELADCHK4    #1ACB4
     C                     MOVELADCHK5    #1ACB5
      *
      *  Beneficiary
      *
     C                     MOVELBNCT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELBNC1      ADCHK1
     C                     MOVELBNC2      ADCHK2
     C                     MOVELBNC3      ADCHK3
     C                     MOVELBNC4      ADCHK4
     C                     MOVELBNC5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1BNC1
     C                     MOVELADCHK2    #1BNC2
     C                     MOVELADCHK3    #1BNC3
     C                     MOVELADCHK4    #1BNC4
     C                     MOVELADCHK5    #1BNC5
      *                                                                   CFT014
      ** Intermediary                                                     CFT014
      *                                                                   CFT014
     C                     MOVELINBT      W8TYPE                          CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT014
     C                     MOVELINB1      ADCHK1                          CFT014
     C                     MOVELINB2      ADCHK2                          CFT014
     C                     MOVELINB3      ADCHK3                          CFT014
     C                     MOVELINB4      ADCHK4                          CFT014
     C                     MOVELINB5      ADCHK5                          CFT014
     C                     MOVELADDRSS    W8LINS                          CFT014
      *                                                                   CFT014
      ** Call expansion program                                           CFT014
      *                                                                   CFT014
     C                     CALL 'FT0315'                                  CFT014
     C                     PARM           W8RTN                           CFT014
     C                     PARM           W8FT                            CFT014
     C                     PARM           W8LINS                          CFT014
     C                     PARM           W8RPT                           CFT014
     C                     PARM           W8MSG                           CFT014
     C                     PARM           W8SCR                           CFT014
      *                                                                   CFT014
     C                     MOVELW8SCR     ADDRSS                          CFT014
     C                     MOVELADCHK1    #1INB1                          CFT014
     C                     MOVELADCHK2    #1INB2                          CFT014
     C                     MOVELADCHK3    #1INB3                          CFT014
     C                     MOVELADCHK4    #1INB4                          CFT014
     C                     MOVELADCHK5    #1INB5                          CFT014
      *
      *  Unwind subroutine stack name
      *
     C           EXENQ1    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      ************                                                    *   CFT014
      ***SRENQ2***:*Expand*fields*using*FT0315*************************   CFT014
      ************                                                    *   CFT014
      ***CALLED*BY:*MEFL#1*-*Format*data*for*screen********************   CFT014
      ************                                                    *   CFT014
      ***CALLS****:*SRERR*-*Report*errors******************************   CFT014
      ************                                                    *   CFT014
      *****************************************************************   CFT014
     C*SR********SRENQ2    BEGSR                                          CFT014
      ***********                                                         CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********          ADD  1         Q                               CFT014
     C***********          MOVEL'SRENQ2'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***Set*up*general*parameters*************************************   CFT014
      ***********                                                         CFT014
     C***********          CLEARW8FT                                      CFT014
     C***********          MOVELSTMT      W8STMT                          CFT014
     C***********          MOVEL##PGM     W8CPGM                          CFT014
     C***********          MOVEL'*ENQ'    W8ACT                           CFT014
     C***********          Z-ADD5         W8NLIN                          CFT014
      ***********                                                         CFT014
      **Intermediary*Bank**********************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVELINBT      W8TYPE                          CFT014
     C***********          MOVEL*BLANKS   ADDRSS                          CFT014
     C***********          MOVELINB1      ADCHK1                          CFT014
     C***********          MOVELINB2      ADCHK2                          CFT014
     C***********          MOVELINB3      ADCHK3                          CFT014
     C***********          MOVELINB4      ADCHK4                          CFT014
     C***********          MOVELINB5      ADCHK5                          CFT014
     C***********          MOVELADDRSS    W8LINS                          CFT014
      ***********                                                         CFT014
      **Call*expansion*program*****************************************   CFT014
      ***********                                                         CFT014
     C***********          CALL 'FT0315'                                  CFT014
     C***********          PARM           W8RTN   7                       CFT014
     C***********          PARM           W8FT                            CFT014
     C***********          PARM           W8LINS256                       CFT014
     C***********          PARM           W8RPT 256                       CFT014
     C***********          PARM           W8MSG 256                       CFT014
     C***********          PARM           W8SCR 256                       CFT014
      ***********                                                         CFT014
     C***********          MOVELW8SCR     ADDRSS                          CFT014
     C***********          MOVELADCHK1    #2INB1                          CFT014
     C***********          MOVELADCHK2    #2INB2                          CFT014
     C***********          MOVELADCHK3    #2INB3                          CFT014
     C***********          MOVELADCHK4    #2INB4                          CFT014
     C***********          MOVELADCHK5    #2INB5                          CFT014
      ***********                                                         CFT014
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXENQ2    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q       50                      CFT014
      ***********                                                         CFT014
     C*SR********          ENDSR                                          CFT014
     C*/EJECT****                                                         CFT014
      *****************************************************************
      *                                                               *
      *  SRCDFT   : Calculate defaults                                *
      *                                                               *
      *  CALLED BY: MEIZ#K - Initialise second screen                 *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRCDFT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCDFT'  @STK,Q
      *
      * Payment type and subtype
     C                     MOVELPYTP      W7PYTP
     C                     MOVELPYST      W7PYST
      *
      * Input currency and charge currency
     C                     MOVELV#CCCY    W7ICCY
     C                     MOVELV#RCCY    W7CCCY
      *
      * Settlement method
     C                     MOVELSTMT      W7STMT
      *
      * Defaults required
     C                     MOVEL'Y'       W7DFRQ
      *
      * Charges branch
     C                     MOVELPYBR      W7BRCA
      *
      * Charge currency amount
      *
     C                     SELEC
      *
     C           V#ADDC    WHEQ 'A'
     C                     Z-ADDSMAM      W7CAMT
     C                     MOVELSMCY      W7PCCY
      *
     C                     OTHER
     C                     Z-ADDPYAM      W7CAMT
     C                     MOVELPCCY      W7PCCY
     C                     ENDSL
      *
      * Transfer Commission type
     C***********          MOVEL#1TRCT    W7TRCT                          CFT014
     C                     MOVEL#2TRCT    W7TRCT                          CFT014
      *
      * SWIFT priority code
     C           SWPC      IFEQ 1
     C                     MOVEL'U'       W7SWPC
     C                     ELSE
     C                     MOVEL'N'       W7SWPC
     C                     END
      *
      * Transfer Commission amount
     C                     Z-ADDDUMA1     W7TRCD
     C                     Z-ADDTRCM      W7TRCH
      *
      * Telex charge
     C                     Z-ADDDUMA2     W7TXCD
     C                     Z-ADDTXCH      W7TXCH
      *
      * Cheque Charge
     C                     Z-ADDDUMA3     W7CQCD
     C                     Z-ADDCQCH      W7CQCH
      *
      * Costs Abroad
     C                     Z-ADDDUMA4     W7CSTD
     C                     Z-ADDCSTA      W7CSTA
      *
      * SWIFT Priority Charge
     C                     Z-ADDDUMA5     W7SPCD
     C                     Z-ADDSPCH      W7SPCH
      *
      * Miscellaneous charge
     C                     Z-ADDDUMA6     W7MSCD
     C                     Z-ADDMSCH      W7MSCH
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     Z-ADDOPDUM7    W7CHCD                          S01494
     C                     Z-ADDOPCHCM    W7CHCM                          S01494
     C                     END                                            S01494
      *
      * Advice Charge
     C                     Z-ADD0         W7ADCD
     C                     Z-ADD0         W7ADCH
      *
      * Telephone Charge
     C                     Z-ADD0         W7TLCD
     C                     Z-ADD0         W7TLCH
      *
      * Collection Charge
     C                     Z-ADD0         W7COLD
     C                     Z-ADD0         W7COLL
      *
     C                     MOVEL*BLANKS   W7ACT
     C                     MOVEL'OP'      W7ACT
     C*                                                                   S01506
     C**  Other currency                                                  S01506
     C                     SELEC                                          S01506
     C*                                                                   S01506
     C***********#1CDRO    WHNE *BLANK                             S01506 CFT014
     C           #3CDRO    WHNE *BLANK                                    CFT014
     C           SMCY      ANDNEPCCY                                      S01506
     C                     MOVE '***'     W7OCCY                          S01506
     C*                                                                   S01506
     C***********#1CDRO    WHNE *BLANK                             S01506 CFT014
     C           #3CDRO    WHNE *BLANK                                    CFT014
     C           SMCY      ANDEQPCCY                                      S01506
     C                     MOVE W7PCCY    W7OCCY                          S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'D'                                       S01506
     C                     MOVE SMCY      W7OCCY                          S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'A'                                       S01506
     C                     MOVE PCCY      W7OCCY                          S01506
     C*                                                                   S01506
     C                     ENDSL                                          S01506
     C*                                                                   S01508
     C**  If core feature S01508 is installed, set up parameters for      S01508
     C**  FT0035 to get the customer to be debited the charges            S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   W7CUST                          S01506
     C*                                                                   S01508
     C           S01508    IFEQ 'Y'                                       S01508
     C*                                                                   S01508
     C**  Initialise work fields                                          S01506
     C*                                                                   S01506
     C                     MOVE *BLANKS   I#PT1                           S01506
     C                     MOVE *BLANKS   I#PTY1                          S01506
     C                     MOVE *BLANKS   I#PT2                           S01506
     C                     MOVE *BLANKS   I#PTY2                          S01506
     C                     MOVE *BLANKS   I#CCY                           S01506
     C*                                                                   S01506
     C                     SELEC                                          S01506
     C*                                                                   S01506
     C           S01506    WHEQ 'Y'                                       S01506
     C                     MOVE ORCT      I#PT1                           S01506
     C                     MOVE ORC1      I#PTY1                          S01506
     C                     MOVE SMCY      I#CCY                           S01506
     C           ORCT      IFEQ 'C'                                                           CFT032
     C           ORCT      OREQ 'S'                                                           CFT032
     C           ORCT      OREQ 'A'                                                           CFT032
     C                     MOVELORC2      I#PTY1                                              CFT032
     C                     ENDIF                                                              CFT032
     C*                                                                   S01506
     C***********#1CDRO    WHNE *BLANKS                            S01506 CFT014
     C           #3CDRO    WHNE *BLANKS                                   CFT014
     C***********          MOVE F5CDRT    I#PT1                    S01506 CFT014
     C                     MOVE F7CDRT    I#PT1                           CFT014
     C***********#1CDRO    CAT  #1CDBR    I#PTY1    P              S01506 CFT014
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     CFT014
     C                     MOVE V#BCCY    I#CCY                           S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'A'                                       S01506
     C                     MOVE ORCT      I#PT1                           S01506
     C                     MOVE ORC1      I#PTY1                          S01506
     C                     MOVE SMCY      I#CCY                           S01506
     C                     MOVE ORBT      I#PT2                           S01506
     C           ORCT      IFEQ 'C'                                                           CFT032
     C           ORCT      OREQ 'S'                                                           CFT032
     C           ORCT      OREQ 'A'                                                           CFT032
     C                     MOVELORC2      I#PTY1                                              CFT032
     C                     ENDIF                                                              CFT032
     C***********ORBK      IFNE 0                                                      S01506 CSD027
     C           ORBK      IFNE *BLANKS                                                       CSD027
     C                     MOVELORBK      W0FLD                           S01506
     C           W0FLD     CAT  ORBB      I#PTY2    P                     S01506
     C                     END                                            S01506
     C/COPY WNCPYSRC,FT0345C071
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'D'                                       S01506
     C                     MOVE DSTT      I#PT1                           S01506
     C                     MOVE DST1      I#PTY1                          S01506
     C                     MOVE PCCY      I#CCY                           S01506
     C                     MOVE SNCT      I#PT2                           S01506
     C********** SNCO      IFNE 0                                                      S01506 CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSNCO      I#PTY2                          S01506
     C                     END                                            S01506
     C/COPY WNCPYSRC,FT0345C072
     C*                                                                   S01506
     C                     ENDSL                                          S01506
     C/COPY WNCPYSRC,FT0345C023
     C*                                                                   S01506
     C**  Call FT0035 to get customer number to be debited the charges    S01506
     C*                                                                   S01506
     C                     CALL 'FT0035'               9090               S01506
     C                     PARM *BLANKS   W0RTN   7                       S01506
     C                     PARM           W0DTA                           S01506
     C                     PARM           W0MSG 256                       S01506
     C*                                                                   S01506
     C           *IN90     IFEQ '1'                                       S01506
     C           W0RTN     ORNE *BLANKS                                   S01506
     C                     MOVEL'FT0035  'W0FILE           ************   S01506
     C                     MOVEL'*CALL   'W0KEY            * DBERR 33 *   S01506
     C                     Z-ADD33        W0ERNB           ************   S01506
     C                     MOVEL'MEM5003' W0MSGD                          S01506
     C                     MOVEL'MIDAS  ' W0MSGF                          S01506
     C                     EXSR SRERR                                     S01506
     C                     END                                            S01506
     C*                                                                   S01506
     C                     MOVE O#CUST    W7CUST                          S01506
     C*                                                                   S01506
     C                     END                                            S01508
      *                                                                   CEU006
      * Set up EMU fields for default calculations                        CEU006
      *                                                                   CEU006
      * Settle Value Date                                                 CEU006
     C                     Z-ADDSLDT      W7SLDT                          CEU006
      *                                                                   CEU006
      * Pay Value Date                                                    CEU006
     C                     Z-ADDPVDT      W7PVDT                          CEU006
      *                                                                   CEU006
      * Add/Deduct Indicator                                              CEU006
     C                     MOVELADDC      W7ADDC                          CEU006
      *
      *  Call defaults program
      *
     C***********#1ACTC    IFEQ 'I'                                100660133860
     C***********#1ACTC    OREQ 'A'                                100660133860
     C***********#1TRCT    ORNE TRCT                               100660133860
     C***********#1CDRO    ORNE *BLANKS                            100660133860
     C***********CDRO      ANDEQ0                                  100660133860
     C***********#1CDRO    OREQ *BLANKS                            100660133860
     C***********CDRO      ANDNE0                                  100660133860
     C***********#1ACTC    OREQ 'A'                                100660133860
     C***********W0FCUS    ANDNEW0SCUS                             100660133860
     C                     CALL 'FT0320'               9090
     C                     PARM *BLANKS   W7RTN   7
     C                     PARM           W7ACT   8
     C                     PARM           W7DATA
     C***********          END                                     100660133860
      *
     C           *IN90     IFEQ '1'
     C           W7RTN     ORNE *BLANKS
     C                     MOVEL'FT0320  'W0FILE           ***************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 08 *
     C                     Z-ADD23        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Transfer Commission amount
     C                     Z-ADDW7TRCD    DUMA1
     C                     Z-ADDW7TRCH    TRCM
      *
      * Telex charge
     C                     Z-ADDW7TXCD    DUMA2
     C                     Z-ADDW7TXCH    TXCH
      *
      * Cheque Charge
     C                     Z-ADDW7CQCD    DUMA3
     C                     Z-ADDW7CQCH    CQCH
      *
      * Costs Abroad
     C                     Z-ADDW7CSTD    DUMA4
     C                     Z-ADDW7CSTA    CSTA
      *
      * SWIFT Priority Charge
     C                     Z-ADDW7SPCD    DUMA5
     C                     Z-ADDW7SPCH    SPCH
      *
      * Miscellaneous charge
     C                     Z-ADDW7MSCD    DUMA6
     C                     Z-ADDW7MSCH    MSCH
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     Z-ADDW7CHCD    OPDUM7                          S01494
     C                     Z-ADDW7CHCM    OPCHCM                          S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Set recalculation flag                                           S01499
     C*                                                                   S01499
     C                     MOVE 'Y'       W0RCAL  1                       S01499
      *
      *  Unwind subroutine stack name
      *
     C           EXCDFT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRMOVE   : Move data to file fields                          *
      *                                                               *
      *  CALLED BY: SACRRC - Create record                            *
      *           : SCCHRC - Change record                            *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRMOVE    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *  Set fields
      *
     C                     MOVEL'D'       RECI
     C                     MOVEL#1PREF    PREF
     C                     MOVEL'Y'       LVL2
      *  Transfer Comission tariff
     C***********          MOVEL#1TRCT    TRCT                            CFT014
     C                     MOVEL#2TRCT    TRCT                            CFT014
      *  Charges to the debit of
     C***********          MOVELF5CDRT    CDRT                            CFT014
     C***********          MOVEL#1CDRO    CDRO                            CFT014
     C                     MOVELF7CDRT    CDRT                            CFT014
     C                     MOVEL#3CDRO    CDRO                            CFT014
     C/COPY WNCPYSRC,FT0345C024
      *  Charges to the debit of branch
     C***********          MOVEL#1CDBR    CDBR                            CFT014
     C                     MOVEL#3CDBR    CDBR                            CFT014
     C/COPY WNCPYSRC,FT0345C040
      *  Receivers Correspondent
     C                     MOVELF5RCOT    RCRT
     C                     MOVEL#1RCO1    RCO1
     C                     MOVEL#1RCO2    RCO2
     C                     MOVEL#1RCO3    RCO3
     C                     MOVEL#1RCO4    RCO4
     C                     MOVEL#1RCO5    RCO5
      *  Account with Institution
     C                     MOVELF5ACBT    ACBT
     C                     MOVEL#1ACB1    ACB1
     C                     MOVEL#1ACB2    ACB2
     C                     MOVEL#1ACB3    ACB3
     C                     MOVEL#1ACB4    ACB4
     C                     MOVEL#1ACB5    ACB5
      *  Beneficiary
     C                     MOVELF5BNCT    BNCT
     C                     MOVEL#1BNC1    BNC1
     C                     MOVEL#1BNC2    BNC2
     C                     MOVEL#1BNC3    BNC3
     C                     MOVEL#1BNC4    BNC4
     C                     MOVEL#1BNC5    BNC5
      *  Details of Payment
     C***********          MOVEL#1DTP1    DTP1                            CFT014
     C***********          MOVEL#1DTP2    DTP2                            CFT014
     C***********          MOVEL#1DTP3    DTP3                            CFT014
     C***********          MOVEL#1DTP4    DTP4                            CFT014
     C                     MOVEL#2DTP1    DTP1                            CFT014
     C                     MOVEL#2DTP2    DTP2                            CFT014
     C                     MOVEL#2DTP3    DTP3                            CFT014
     C/COPY WNCPYSRC,FT0345C088
     C                     MOVEL#2DTP4    DTP4                            CFT014
     C/COPY WNCPYSRC,FT0345C089
      *  Sender to Receiver information
     C***********          MOVEL#1BBI1    BBI1                            CFT014
     C***********          MOVEL#1BBI2    BBI2                            CFT014
     C***********          MOVEL#1BBI3    BBI3                            CFT014
     C***********          MOVEL#1BBI4    BBI4                            CFT014
     C***********          MOVEL#1BBI5    BBI5                            CFT014
     C***********          MOVEL#1BBI6    BBI6                            CFT014
     C                     MOVEL#2BBI1    BBI1                            CFT014
     C                     MOVEL#2BBI2    BBI2                            CFT014
     C                     MOVEL#2BBI3    BBI3                            CFT014
     C                     MOVEL#2BBI4    BBI4                            CFT014
     C                     MOVEL#2BBI5    BBI5                            CFT014
     C                     MOVEL#2BBI6    BBI6                            CFT014
      *  Intermediary Bank
     C***********          MOVELF6INBT    INBT                            CFT014
     C***********          MOVEL#2INB1    INB1                            CFT014
     C***********          MOVEL#2INB2    INB2                            CFT014
     C***********          MOVEL#2INB3    INB3                            CFT014
     C***********          MOVEL#2INB4    INB4                            CFT014
     C***********          MOVEL#2INB5    INB5                            CFT014
     C                     MOVELF5INBT    INBT                            CFT014
     C                     MOVEL#1INB1    INB1                            CFT014
     C                     MOVEL#1INB2    INB2                            CFT014
     C                     MOVEL#1INB3    INB3                            CFT014
     C                     MOVEL#1INB4    INB4                            CFT014
     C                     MOVEL#1INB5    INB5                            CFT014
      *  Central Bank Reference
     C                     MOVEL#2DNBC    DNBC
      *  Details of Charges
     C***********          MOVEL#2DTCH    DTCH                            CFT014
     C                     MOVEL#3DTCH    DTCH                            CFT014
      *  Related Reference
     C                     MOVEL#2RLPR    RLPR
      *  Chaps code
     C                     MOVEL#2CHAP    CHAP
      *  Charges
     C***********          Z-ADDF6TRCD    DUMA1                           CFT014
     C***********          Z-ADDF6TXCD    DUMA2                           CFT014
     C***********          Z-ADDF6CQCD    DUMA3                           CFT014
     C***********          Z-ADDF6CSTD    DUMA4                           CFT014
     C***********          Z-ADDF6SPCD    DUMA5                           CFT014
     C***********          Z-ADDF6MSCD    DUMA6                           CFT014
     C                     Z-ADDF7TRCD    DUMA1                           CFT014
     C                     Z-ADDF7TXCD    DUMA2                           CFT014
     C                     Z-ADDF7CQCD    DUMA3                           CFT014
     C                     Z-ADDF7CSTD    DUMA4                           CFT014
     C                     Z-ADDF7SPCD    DUMA5                           CFT014
     C                     Z-ADDF7MSCD    DUMA6                           CFT014
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          Z-ADDF6CHCD    OPDUM7                   S01494 CFT014
     C                     Z-ADDF7CHCD    OPDUM7                          CFT014
     C                     END                                            S01494
     C***********          Z-ADDF6TRCM    TRCM                            CFT014
     C***********          Z-ADDF6TXCH    TXCH                            CFT014
     C***********          Z-ADDF6CQCH    CQCH                            CFT014
     C***********          Z-ADDF6CSTA    CSTA                            CFT014
     C***********          Z-ADDF6SPCH    SPCH                            CFT014
     C***********          Z-ADDF6MSCH    MSCH                            CFT014
     C                     Z-ADDF7TRCM    TRCM                            CFT014
     C                     Z-ADDF7TXCH    TXCH                            CFT014
     C                     Z-ADDF7CQCH    CQCH                            CFT014
     C                     Z-ADDF7CSTA    CSTA                            CFT014
     C                     Z-ADDF7SPCH    SPCH                            CFT014
     C                     Z-ADDF7MSCH    MSCH                            CFT014
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          Z-ADDF6CHCM    OPCHCM                   S01494 CFT014
     C                     Z-ADDF7CHCM    OPCHCM                          CFT014
     C                     END                                            S01494
     C*                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Ensure that charges are in CHARGE currency                       CFT009
     C                     Z-ADDF7STCD    SWSCCC                          CFT009
     C                     Z-ADDF7M1CD    MISCC1                          CFT009
     C                     Z-ADDF7M2CD    MISCC2                          CFT009
     C                     Z-ADDF7M3CD    MISCC3                          CFT009
     C                     Z-ADDF7M4CD    MISCC4                          CFT009
     C                     Z-ADDF7M5CD    MISCC5                          CFT009
      *                                                                   CFT009
      ** Ensure that charges are in LEVIED currency                       CFT009
     C                     Z-ADDF7STCH    SWSCHG                          CFT009
     C                     Z-ADDF7M1CH    MISC01                          CFT009
     C                     Z-ADDF7M2CH    MISC02                          CFT009
     C                     Z-ADDF7M3CH    MISC03                          CFT009
     C                     Z-ADDF7M4CH    MISC04                          CFT009
     C                     Z-ADDF7M5CH    MISC05                          CFT009
      *                                                                   CFT009
      ** Charge Codes                                                     CFT009
      *                                                                   CFT009
     C                     MOVELTRCDE     TFCCCD                          CFT009
     C                     MOVELFXCDE     FXCACC                          CFT009
     C                     MOVELTXCDE     TLXCDE                          CFT009
     C                     MOVELCQCDE     CHQCHC                          CFT009
     C                     MOVELCACDE     CACHCD                          CFT009
     C                     MOVELSTCDE     SSTCCD                          CFT009
     C                     MOVELSPCDE     SPRCCD                          CFT009
     C                     MOVELMSCDE     MSCHC                           CFT009
     C                     MOVELM1CDE     MSCHC1                          CFT009
     C                     MOVELM2CDE     MSCHC2                          CFT009
     C                     MOVELM3CDE     MSCHC3                          CFT009
     C                     MOVELM4CDE     MSCHC4                          CFT009
     C                     MOVELM5CDE     MSCHC5                          CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01499
     C** If switchable feature S01499 is switched ON, set up V.A.T.       S01499
     C** details                                                          S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT010    OREQ 'Y'                                       CFT009
     C***********          Z-ADDF6VATD    OPDUM8                   S01499 CFT014
     C***********          Z-ADDF6VATT    OPVATT                   S01499 CFT014
     C***********          MOVEL#2VAT1    OPVAT1                   S01499 CFT014
     C***********          MOVEL#2VAT2    OPVAT2                   S01499 CFT014
     C***********          MOVEL#2VAT3    OPVAT3                   S01499 CFT014
     C***********          MOVEL#2VAT4    OPVAT4                   S01499 CFT014
     C***********          MOVEL#2VAT5    OPVAT5                   S01499 CFT014
     C***********          MOVEL#2VAT6    OPVAT6                   S01499 CFT014
     C***********          MOVEL#2VAT7    OPVAT7                   S01499 CFT014
     C                     Z-ADDF7VATD    OPDUM8                          CFT014
     C                     Z-ADDF7VATT    OPVATT                          CFT014
     C                     MOVEL#3VAT1    OPVAT1                          CFT014
     C                     MOVEL#3VAT2    OPVAT2                          CFT014
     C                     MOVEL#3VAT3    OPVAT3                          CFT014
     C                     MOVEL#3VAT4    OPVAT4                          CFT014
     C                     MOVEL#3VAT5    OPVAT5                          CFT014
     C                     MOVEL#3VAT6    OPVAT6                          CFT014
     C                     MOVEL#3VAT7    OPVAT7                          CFT014
      *                                                                   CFT009
      ** If switchable feature CFT010 is switched ON, set up V.A.T.       CFT009
      ** details                                                          CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
     C                     MOVELVAT14     VTSWSC                          CFT009
     C                     MOVELVAT9      VMIC1                           CFT009
     C                     MOVELVAT10     VMIC2                           CFT009
     C                     MOVELVAT11     VMIC3                           CFT009
     C                     MOVELVAT12     VMIC4                           CFT009
     C                     MOVELVAT13     VMIC5                           CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01499
     C** Store V.A.T. rate if used                                        S01499
     C***********F6VATD    IFNE 0                                  S01499 CFT014
     C***********F6VATT    ORNE 0                                  S01499 CFT014
     C           F7VATD    IFNE 0                                         CFT014
     C           F7VATT    ORNE 0                                         CFT014
     C                     Z-ADDV#VATR    OPVATR                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                                            S01499
      *                                                                   CFT014
      ** Move MT103 validated screen fields to file for update            CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Flag to avoid using again Receiver's charges Network             CFT014
      *                                                                   CFT014
     C           OPRCUS    IFEQ 'N'                                       CFT014
     C                     MOVEL'Y'       OPRCUS                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Bank operation code                                              CFT014
      *                                                                   CFT014
     C                     MOVEL#1BKOP    OPBOCD                          CFT014
      *                                                                   CFT014
      ** Instruction code                                                 CFT014
      *                                                                   CFT014
     C                     MOVEL#2INS1    OPICD1                          CFT014
     C                     MOVEL#2INS2    OPICD2                          CFT014
     C                     MOVEL#2INS3    OPICD3                          CFT014
     C                     MOVEL#2INS4    OPICD4                          CFT014
     C                     MOVEL#2INS5    OPICD5                          CFT014
      *                                                                   CFT014
      ** Transaction type code                                            CFT014
      *                                                                   CFT014
     C                     MOVEL#1TRNT    OPTTCD                          CFT014
      *                                                                   CFT014
      ** Third reimbursement institution                                  CFT014
      *                                                                   CFT014
     C                     MOVELF5TRIT    OPTRIT                          CFT014
     C                     MOVEL#1TRI1    OPTRI1                          CFT014
     C                     MOVEL#1TRI2    OPTRI2                          CFT014
     C                     MOVEL#1TRI3    OPTRI3                          CFT014
     C                     MOVEL#1TRI4    OPTRI4                          CFT014
     C                     MOVEL#1TRI5    OPTRI5                          CFT014
      *                                                                   CFT014
      ** Sender's charges                                                 CFT014
      *                                                                   CFT014
     C                     Z-ADDF7SCH1    OPSCH1                          CFT014
     C                     Z-ADDF7SCH2    OPSCH2                          CFT014
     C                     Z-ADDF7SCH3    OPSCH3                          CFT014
     C                     Z-ADDF7SCH4    OPSCH4                          CFT014
     C                     Z-ADDF7SCH5    OPSCH5                          CFT014
     C                     MOVELF7SCC1    OPSCC1                          CFT014
     C                     MOVELF7SCC2    OPSCC2                          CFT014
     C                     MOVELF7SCC3    OPSCC3                          CFT014
     C                     MOVELF7SCC4    OPSCC4                          CFT014
     C                     MOVELF7SCC5    OPSCC5                          CFT014
     C                     Z-ADDV#SENT    OPSCLE                          CFT014
      *                                                                   CFT014
      ** Receiver's charges remitted                                      CFT014
      *                                                                   CFT014
     C                     Z-ADDF7RCRM    OPRCRM                          CFT014
      *                                                                   CFT014
      ** Calculate receiver's charges base currency equivalent            CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDPVDT      P#FRDT                          CFT014
     C                     Z-ADDSLDT      P#TODT                          CFT014
     C                     MOVELPCCY      P#FRCY                          CFT014
     C                     Z-ADDOPRCRM    P#FRAM                          CFT014
     C                     MOVELBJCYCD    P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 42 *CFT014
     C                     Z-ADD42        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    OPRBCQ                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Calculate receiver's charges remitted in settlement ccy          CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDPVDT      P#FRDT                          CFT014
     C                     Z-ADDSLDT      P#TODT                          CFT014
     C                     MOVELPCCY      P#FRCY                          CFT014
     C                     Z-ADDOPRCRM    P#FRAM                          CFT014
     C                     MOVELSMCY      P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 43 *CFT014
     C                     Z-ADD43        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    OPRCSC                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ***Base*currency equivalent of Receiver's Charges Remitted in                    CFT014 197834
      ***Settlement currency                                                           CFT014 197834
     C**********           CLEARP#0010                                                 CFT014 197834
     C**********           Z-ADDPVDT      P#FRDT                                       CFT014 197834
     C**********           Z-ADDSLDT      P#TODT                                       CFT014 197834
     C**********           MOVELSMCY      P#FRCY                                       CFT014 197834
     C**********           Z-ADDOPRCSC    P#FRAM                                       CFT014 197834
     C**********           MOVELBJCYCD    P#TOCY                                       CFT014 197834
     C**********           Z-ADD0         P#TOAM                                       CFT014 197834
     C**********           Z-ADD0         P#RATE                                       CFT014 197834
     C**********           CALL 'FT0010'                                               CFT014 197834
     C**********           PARM           P#0010                                       CFT014 197834
      **********                                                                       CFT014 197834
     C********** P#RTCD    IFNE *BLANK                                                 CFT014 197834
     C**********           MOVEL'FT0010  'W0FILE           ***************             CFT014 197834
     C**********           MOVEL'*CALL  ' W0KEY            * DB ERROR 49 *             CFT014 197834
     C**********           Z-ADD49        W0ERNB           ***************             CFT014 197834
     C**********           MOVEL'MEM5003' W0MSGD                                       CFT014 197834
     C**********           MOVEL'MIDAS  ' W0MSGF                                       CFT014 197834
     C**********           EXSR SRERR                                                  CFT014 197834
     C**********           ELSE                                                        CFT014 197834
     C**********           Z-ADDP#TOAM    OPRCSQ                                       CFT014 197834
     C**********           ENDIF                                                       CFT014 197834
      *                                                                                       197834
      ** Base currency equivalent of the receiver's charges from both                         197834
      ** pay/settle currency should be equal.                                                 197834
      *                                                                                       197834
     C                     Z-ADDOPRBCQ    OPRCSQ                                              197834
      *                                                                   CFT014
      ** Regulatory reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVEL#2RGR1    OPRRP1                          CFT014
     C                     MOVEL#2RGR2    OPRRP2                          CFT014
     C                     MOVEL#2RGR3    OPRRP3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CAC001
      ** If Analytical Accounting installed, set up margin info fields.   CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     Z-ADDWOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
     C                     ENDIF                                          CAC001
      *
      * If insert set up audit information
      *
     C           #1ACTC    IFEQ 'I'
     C                     TIME           LCHT
     C                     Z-ADDWURDNB    OEDT
     C                     MOVEL'I'       CHTP
     C                     Z-ADDWURDNB    LCD
     C                     MOVEL##USR     INUSR2
     C                     END
      *
      * If amend set up audit information
      *
     C           #1ACTC    IFEQ 'A'
     C                     TIME           LCHT
      *
     C           LCD       IFNE WURDNB
     C                     MOVEL'A'       CHTP
     C                     END
      *
     C                     MOVEL*BLANKS   AUP1
     C                     Z-ADDWURDNB    LCD
     C                     MOVEL##USR     INUSR2
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXMOVE    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all positions in store                      *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARQ#DTA
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*CLEAR  'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           ***************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 08 *
     C                     Z-ADD8         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0345C079
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRADD    : Add shadow positions to store                     *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRADD     BEGSR
      *                                                                                       CFT032
     C                     MOVE *BLANKS   PIBAN  34                                           CFT032
      *                                                                                       CFT032
     C           ORBT      IFEQ *BLANK                                                        CFT032
     C                     MOVELORC1      W#C1    1                                           CFT032
      *                                                                                       CFT032
     C           W#C1      IFEQ '/'                                                           CFT032
     C           34        SUBSTORC1:2    PIBAN                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELORC1      PIBAN                                               CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM           @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           PIBAN                                               CFT032
     C           P@ACCN    PARM *BLANKS   DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C           *LOCK     IN   LDA                                                           CFT032
     C                     Z-ADD7         DBASE                                               CFT032
     C                     MOVELPIBAN     DBKEY                                               CFT032
     C                     MOVEL'ACCNTL6' DBFILE                                              CFT032
     C                     OUT  LDA                                                           CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           P@CNUM    CAT  P@ACOD    PIBAN     P                                         CFT032
     C                     CAT  P@ACSQ:0  PIBAN                                               CFT032
     C                     CAT  P@BRCA:0  PIBAN                                               CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRADD'   @STK,Q
      *
      *  Define settle and pay amounts
      *
     C           *LIKE     DEFN SMAM      ##SMAM
     C           *LIKE     DEFN PYAM      ##PYAM
      *
      *  Move fields to C#DTA structure and call AOSPOSU0
      *
      *         S E T T L E    I N S T R U C T I O N S
      *
      *  Only execute if Outgoing Payment not generated
      *
     C           OPIN      IFNE 'Y'
     C                     CLEARQ#DTA
     C           ORBT      IFNE *BLANKS
     C                     MOVELORBT      Q#ATYP
     C                     MOVELORBK      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELORBB      Q#BRCA
     C                     ELSE
     C                     MOVELORCT      Q#ATYP
     C**********           MOVELORC1      Q#ACCT                                              CFT032
     C                     MOVELPIBAN     Q#ACCT                                              CFT032
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     END
     C/COPY WNCPYSRC,FT0345C056
     C                     Z-ADDSLDT      Q#VDAT
      *
      * Set posting date according to FT Control Data
      *
     C           T#PDTI    IFEQ 'I'
     C                     Z-ADDBJRDNB    Q#PSTD
     C                     ELSE
     C           T#PDTI    IFEQ 'E'
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C           SLDT      IFLT PVDT
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C                     Z-ADDPVDT      Q#PSTD
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL'I'       Q#IO
     C                     MOVELSMCY      Q#CCY
     C                     MOVELPYTP      Q#TRYP
     C                     MOVELPREF      Q#PREF
     C                     Z-ADD##SMAM    Q#AMT
     C                     MOVEL'FT'      Q#MOD
     C                     MOVEL'01'      Q#OLRC
     C                     MOVEL##FTOV    Q#FTOV
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD10        Q#RPNB                          068347
     C                     MOVEL'D'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 09
     C                     Z-ADD9         W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
     C/COPY WNCPYSRC,FT0345C080
      *
      *         P A Y          I N S T R U C T I O N S
      *
     C                     CLEARQ#DTA
     C           SNCT      IFNE *BLANKS
     C                     MOVELSNCT      Q#ATYP
     C                     MOVELSNCO      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ELSE
     C                     MOVELDSTT      Q#ATYP
     C                     MOVELDST1      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     END
     C/COPY WNCPYSRC,FT0345C057
     C                     Z-ADDPVDT      Q#VDAT
      *
      * Set posting date according to FT Control Data
      *
     C           T#PDTI    IFEQ 'I'
     C                     Z-ADDBJRDNB    Q#PSTD
     C                     ELSE
     C           T#PDTI    IFEQ 'E'
     C                     Z-ADDPVDT      Q#PSTD
     C                     ELSE
     C           SLDT      IFLT PVDT
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C                     Z-ADDPVDT      Q#PSTD
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL'O'       Q#IO
     C                     MOVELPCCY      Q#CCY
     C                     MOVELPYTP      Q#TRYP
     C                     MOVELPREF      Q#PREF
     C                     Z-SUB##PYAM    Q#AMT
     C                     MOVEL'FT'      Q#MOD
     C                     MOVEL'01'      Q#OLRC
     C                     MOVEL##FTOV    Q#FTOV
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD20        Q#RPNB                          068347
     C                     MOVEL'C'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 10
     C                     Z-ADD10        W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0345C081
      *
      *  Unwind subroutine stack name
      *
     C           EXADD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT                                                              068320
      *****************************************************************   068320
      *                                                               *   068320
      *  SRSCHG   : Reverse charges from database                     *   068320
      *                                                               *   068320
      *  CALLED BY: UPDATE - Update Database                          *   068320
      *                                                               *   068320
      *  CALLS    : SRERR - Report errors                             *   068320
      *                                                               *   068320
      *****************************************************************   068320
     CSR         SRSCHG    BEGSR                                          068320
      *                                                                                       CFT032
     C                     MOVE *BLANKS   PIBAN  34                                           CFT032
      *                                                                                       CFT032
     C           ORBT      IFEQ *BLANK                                                        CFT032
     C                     MOVELORC1      W#C1    1                                           CFT032
      *                                                                                       CFT032
     C           W#C1      IFEQ '/'                                                           CFT032
     C           34        SUBSTORC1:2    PIBAN                                               CFT032
     C                     ELSE                                                               CFT032
     C                     MOVELORC1      PIBAN                                               CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C                     CALL 'AOIBANR4'                                                    CFT032
     C                     PARM           @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           PIBAN                                               CFT032
     C           P@ACCN    PARM *BLANKS   DSSDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFNE *BLANKS                                                       CFT032
     C           *LOCK     IN   LDA                                                           CFT032
     C                     Z-ADD8         DBASE                                               CFT032
     C                     MOVELPIBAN     DBKEY                                               CFT032
     C                     MOVEL'ACCNTL6' DBFILE                                              CFT032
     C                     OUT  LDA                                                           CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           P@CNUM    CAT  P@ACOD    PIBAN     P                                         CFT032
     C                     CAT  P@ACSQ:0  PIBAN                                               CFT032
     C                     CAT  P@BRCA:0  PIBAN                                               CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                   068320
      *  Set up subroutine stack name                                     068320
      *                                                                   068320
     C                     ADD  1         Q                               068320
     C                     MOVEL'SRSCHG'  @STK,Q                          068320
      *                                                                   068320
      *  Move fields to Q#DTA structure and call AOSPOSU0                 068320
      *                                                                   068320
     C                     CLEARQ#DTA                                     068320
      *                                                                   068320
      *  If add use Receiver's Correspondent and Sender                   068320
      *                                                                   068320
     C                     SELEC                                          068320
     C           CDRT      WHNE *BLANKS                                   068320
     C                     MOVELCDRT      Q#ATYP                          068320
     C                     MOVELCDRO      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELCDBR      Q#BRCA                          068320
     C                     MOVELBJCYCD    Q#CCY                           068320
     C/COPY WNCPYSRC,FT0345C025
     C           ADDC      IFEQ 'A'                                       068320
     C                     Z-ADDSLDT      Q#VDAT                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#VDAT                          068320
     C                     END                                            068320
     C           ADDC      WHEQ 'A'                                       068320
     C                     MOVELSMCY      Q#CCY                           068320
     C           ORBT      IFNE *BLANKS                                   068320
     C                     MOVELORBT      Q#ATYP                          068320
     C                     MOVELORBK      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELORBB      Q#BRCA                          068320
     C                     ELSE                                           068320
     C                     MOVELORCT      Q#ATYP                          068320
     C**********           MOVELORC1      Q#ACCT                          068320              CFT032
     C                     MOVELPIBAN     Q#ACCT                                              CFT032
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     END                                            068320
     C/COPY WNCPYSRC,FT0345C058
     C                     Z-ADDSLDT      Q#VDAT                          068320
     C                     OTHER                                          068320
      *                                                                   068320
      *  If deduct use Account with Bank and Beneficiary                  068320
      *                                                                   068320
     C                     MOVELPCCY      Q#CCY                           068320
     C           SNCT      IFNE *BLANKS                                   068320
     C                     MOVELSNCT      Q#ATYP                          068320
     C                     MOVELSNCO      Q#ACCT                          068320
     C                     ELSE                                           068320
     C                     MOVELDSTT      Q#ATYP                          068320
     C                     MOVELDST1      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C/COPY WNCPYSRC,FT0345C059
     C                     END                                            068320
     C                     Z-ADDPVDT      Q#VDAT                          068320
     C                     END                                            068320
      *                                                                   068320
      * Set posting date according to FT Control Data                     068320
      *                                                                   068320
     C           T#PDTI    IFEQ 'I'                                       068320
     C                     Z-ADDBJRDNB    Q#PSTD                          068320
     C                     ELSE                                           068320
     C           T#PDTI    IFEQ 'E'                                       068320
     C           ADDC      IFEQ 'A'                                       068320
     C                     Z-ADDSLDT      Q#PSTD                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#PSTD                          068320
     C                     END                                            068320
     C                     ELSE                                           068320
     C           SLDT      IFLT PVDT                                      068320
     C                     Z-ADDSLDT      Q#PSTD                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#PSTD                          068320
     C                     END                                            068320
     C                     END                                            068320
     C                     END                                            068320
      *                                                                   068320
     C                     MOVEL'I'       Q#IO                            068320
     C                     MOVELPYTP      Q#TRYP                          068320
     C                     MOVELPREF      Q#PREF                          068320
     C                     MOVEL'FT'      Q#MOD                           068320
     C                     MOVEL'01'      Q#OLRC                          068320
     C                     MOVEL##FTOV    Q#FTOV                          068320
     C           *LIKE     DEFN Q#AMT     ##CHGS                          068320
     C                     Z-ADD##CHGS    Q#AMT                           068320
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD30        Q#RPNB                          068347
     C                     MOVEL'D'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   068320
      *  Call AOSPOSU0                                                    068320
     C/COPY WNCPYSRC,FT0345C085
      *                                                                   068320
     C                     CALL 'AOSPOSU0'             9090               068320
     C           R#RTN     PARM *BLANKS   O#RTN   7                       068320
     C                     PARM '*ADD    'W0ACT   8                       068320
     C                     PARM Q#DTA     O#DTA 256                       068320
      *                                                                   068320
     C           *IN90     IFEQ '1'                                       068320
     C           R#RTN     ORNE *BLANKS                                   068320
     C                     MOVEL'AOSPOSU0'W0FILE           ************** 068320
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 511 068320
     C                     Z-ADD511       W0ERNB           ************** 068320
     C                     MOVEL'MEM5003' W0MSGD                          068320
     C                     MOVEL'MIDAS  ' W0MSGF                          068320
     C                     EXSR SRERR                                     068320
     C                     END                                            068320
      *                                                                   068320
     C/COPY WNCPYSRC,FT0345C073
      *  Unwind subroutine stack name                                     068320
      *                                                                   068320
     C           EXSCHG    TAG                                            068320
     C                     MOVEA*BLANKS   @STK,Q                          068320
     C                     SUB  1         Q                               068320
      *                                                                   068320
     CSR                   ENDSR                                          068320
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow positions             *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *  Call AOSPOSU0 to update database
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*UPDATE 'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 11
     C                     Z-ADD11        W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0345C082
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRLOG    : Add Incoming Message Log File record              *
      *                                                               *
      *  CALLED BY: SDCHRC- Update Payment Record                     *
      *                                                               *
      *  CALLS    : SRERR - report error and close down program       *
      *                                                               *
      *****************************************************************
     CSR         SRLOG     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRLOG '  @STK,Q
      *
      *  Fill record format data structure with available data
      *
     C                     CLEARINLF
      *
     C                     Z-ADDOPMSGR    LFMSGR           Unique Ref.
     C                     Z-ADDOPKPRT    LFKPRT           Part No.
     C                     MOVELW0LMSG    LFMSID           Action - Msg ID
     C                     MOVELPREF      LFMSDT           Action Data
     C                     MOVEL*BLANKS   LFARSM           Action Result
     C                     MOVEL*BLANKS   LFARSD           Act Result Data
     C                     MOVEL##PGM     LFCPGM           Calling Process
     C                     MOVEL##PGM     LFRPGM           Called Process
      *
      *  N.B. Audit Stamp details are determined in called program
      *
      *
      *  Set up data to be passed using the rcd format data structure
      *
     C                     CALL 'ME1040'               90
     C                     PARM '*ADD    'W2ACT   8
     C                     PARM           INLF
     C                     PARM *BLANKS   W2RTN   7
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           W2RTN     OREQ '*ERROR*'
     C                     MOVEL'ME1040  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 21 *
     C                     Z-ADD21        W0ERNB           ***************
     C                     EXSR SRERR
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXLOG     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
      /EJECT
     C*****************************************************************   S01499
     C*                                                               *   S01499
     C*  SRVATC   : V.A.T. Calculation                                *   S01499
     C*                                                               *   S01499
     C*  CALLED BY: MEIZ#D - Initialise second detail screen          *   S01499
     C*                                                               *   S01499
     C*  CALLS    :        -                                          *   S01499
     C*                                                               *   S01499
     C*****************************************************************   S01499
     CSR         SRVATC    BEGSR                                          S01499
     C*                                                                   S01499
     C*  Set up subroutine stack name                                     S01499
     C*                                                                   S01499
     C                     ADD  1         Q       50                      S01499
     C                     MOVEL'SRVATC'  @STK,Q                          S01499
     C*                                                                   S01499
     C                     Z-ADD0         OPDUM8                          S01499
     C                     Z-ADD0         OPVATT                          S01499
     C*                                                                   S01499
     C** If apply V.A.T. flag is 'Y', calculate V.A.T. charge             S01499
     C**                                                                  S01499
     C** .... Transfer commission                                         S01499
     C*                                                                   S01499
     C***********#2VAT1    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT1    IFEQ 'Y'                                       CFT014
     C***********DUMA1     MULT V#VATR    @TVATD 130H               S01499CFT009
     C***********TRCM      MULT V#VATR    @TVATT 130H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA1     OPDUM8                          CFT009
     C                     ADD  TRCM      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Telex                                                       S01499
     C*                                                                   S01499
     C***********#2VAT2    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT2    IFEQ 'Y'                                       CFT014
     C***********DUMA2     MULT V#VATR    @TVATD    H               S01499CFT009
     C***********TXCH      MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA2     OPDUM8                          CFT009
     C                     ADD  TXCH      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Cheque                                                      S01499
     C*                                                                   S01499
     C***********#2VAT3    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT3    IFEQ 'Y'                                       CFT014
     C***********DUMA3     MULT V#VATR    @TVATD    H               S01499CFT009
     C***********CQCH      MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA3     OPDUM8                          CFT009
     C                     ADD  CQCH      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Costs                                                       S01499
     C*                                                                   S01499
     C***********#2VAT4    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT4    IFEQ 'Y'                                       CFT014
     C***********DUMA4     MULT V#VATR    @TVATD    H               S01499CFT009
     C***********CSTA      MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA4     OPDUM8                          CFT009
     C                     ADD  CSTA      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... SWIFT                                                       S01499
     C*                                                                   S01499
     C***********#2VAT5    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT5    IFEQ 'Y'                                       CFT014
     C***********DUMA5     MULT V#VATR    @TVATD    H               S01499CFT009
     C***********SPCH      MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA5     OPDUM8                          CFT009
     C                     ADD  SPCH      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Miscellaneous                                               S01499
     C*                                                                   S01499
     C***********#2VAT6    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT6    IFEQ 'Y'                                       CFT014
     C***********DUMA6     MULT V#VATR    @TVATD    H               S01499CFT009
     C***********MSCH      MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  DUMA6     OPDUM8                          CFT009
     C                     ADD  MSCH      OPVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... FX/Change commission                                        S01499
     C*                                                                   S01499
     C***********#2VAT7    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT7    IFEQ 'Y'                                       CFT014
     C           S01494    ANDEQ'Y'                                       S01499
     C***********OPDUM7    MULT V#VATR    @TVATD    H               S01499CFT009
     C***********OPCHCM    MULT V#VATR    @TVATT    H               S01499CFT009
     C***********          ADD  @TVATD    OPDUM8                    S01499CFT009
     C***********          ADD  @TVATT    OPVATT                    S01499CFT009
     C                     ADD  OPDUM7    OPDUM8                          CFT009
     C                     ADD  OPCHCM    OPVATT                          CFT009
     C                     END                                            S01499
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** .... Swift Standard                                              CFT009
      *                                                                   CFT009
     C           VAT14     IFEQ 'Y'                                       CFT009
     C                     ADD  SWSCCC    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 1                                      CFT009
      *                                                                   CFT009
     C           VAT9      IFEQ 'Y'                                       CFT009
     C                     ADD  MISCC1    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 2                                      CFT009
      *                                                                   CFT009
     C           VAT10     IFEQ 'Y'                                       CFT009
     C                     ADD  MISCC2    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 3                                      CFT009
      *                                                                   CFT009
     C           VAT11     IFEQ 'Y'                                       CFT009
     C                     ADD  MISCC3    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 4                                      CFT009
      *                                                                   CFT009
     C           VAT12     IFEQ 'Y'                                       CFT009
     C                     ADD  MISCC4    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 5                                      CFT009
      *                                                                   CFT009
     C           VAT13     IFEQ 'Y'                                       CFT009
     C                     ADD  MISCC5    OPVATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Calculate VAT amounts based on total charge                      CFT009
      *                                                                   CFT009
     C           OPDUM8    MULT V#VATR    OPDUM8    H                     CFT009
     C           OPVATT    MULT V#VATR    OPVATT    H                     CFT009
      *                                                                   CFT009
     C*                                                                   S01499
     C** Unwind subroutine stack name                                     S01499
     C*                                                                   S01499
     C           EXVATC    TAG                                            S01499
     C                     MOVEA*BLANKS   @STK,Q                          S01499
     C                     SUB  1         Q                               S01499
     C*                                                                   S01499
     CSR                   ENDSR                                          S01499
     C/EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Midas Message Net
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'VBCKRL'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      *  Key list for OTPAYL*
      *
     C           KPREF     KLIST
     C                     KFLD           PREF
      *
     C                     MOVEL#1PREF    PREF
      *
      *  Chain to OTPAYL1 to find information
      *
     C           KPREF     CHAIN@OTPAYL1             90
     C/COPY WNCPYSRC,FT0345C026
      *
      * If not found error
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'FTM2176' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * Must be enquiry if record not live
      *
     C           RECI      IFNE 'D'
     C           #1ACTC    ANDNE'E'
     C                     MOVEL'FTM2177' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * If amend and level 2 not complete error
     C/COPY WNCPYSRC,FT0345C011
      *
     C           RECI      IFEQ 'D'
     C           #1ACTC    ANDEQ'A'
     C           LVL2      ANDNE'Y'
     C                     MOVEL'FTM2307' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
     C/COPY WNCPYSRC,FT0345C012
      *
      * Record authorised
      *
     C           RECI      IFEQ 'D'
     C           PYTP      ANDNE'RP'
     C           AUIN      ANDEQ'Y'
     C           #1ACTC    ANDNE'E'
     C                     MOVEL'FTM2178' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * Record input already so I invalid
      *
     C           RECI      IFEQ 'D'
     C           LVL2      ANDEQ'Y'
     C           #1ACTC    ANDEQ'I'
     C                     MOVEL'FTM2179' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * Record level 1 incomplete only E valid.
     C/COPY WNCPYSRC,FT0345C013
      *
     C           RECI      IFEQ 'D'
     C           LVL1      ANDNE'Y'
     C           #1ACTC    ANDNE'E'
     C                     MOVEL'FTM2180' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
     C/COPY WNCPYSRC,FT0345C014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Access outgoing payments extension file                          CFT014
      *                                                                   CFT014
     C           KPREF     CHAINOPAYXL0              90                   CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C           *IN90     OREQ *OFF                                      CFT014
     C           #1ACTC    ANDEQ'I'                                       CFT014
     C           OPRECI    ANDNE'D'                                       CFT014
     C           *IN90     OREQ *OFF                                      CFT014
     C           #1ACTC    ANDEQ'A'                                       CFT014
     C           OPRECI    ANDNE'D'                                       CFT014
     C                     MOVEL'OTPAYXL0'W0FILE                          CFT014
     C                     MOVELPREF      W0KEY                           CFT014
     C                     Z-ADD34        W0ERNB                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           VBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0345CCP4                                           S01408
     C*                                                                   S01408
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check branch SPF actions
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'VDCKRL'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      * Set up parameters
      *
     C                     CLEARW0DATA
     C                     MOVELBRCA      B#BRCA
     C                     MOVEL#1ACTC    O#ACTD
     C                     MOVEL##PGM     O#CPGM
     C*                                                                   096486
     C**  Skip validation if FT0345 is triggered through A/C Movements.   096486
     C*                                                                   096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     GOTO VDEXIT                                    096486
     C                     ENDIF                                          096486
      *
      * Check all valid actions
      *
     C                     CALL 'ME1190'               9090
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM '*ACTCODE'W0ACT   8
     C                     PARM           W0DATA
      *
      * Option ended in error
      *
     C           *IN90     IFEQ '1'                        *IF
     C                     MOVEL'MIN0019' P0RTN
     C                     MOVEL'MIN0019' ZAMSID
     C                     MOVEL'MEMSG  ' ZAMSGF
     C                     EXSR ZASNMS
     C                     SETON                     993132*
     C                     GOTO VDEXIT
     C                     END                             *FI
      *
      * Invalid action
      *
     C           W0RTN     IFNE *BLANKS                    *IF
     C                     SETON                     993231*
     C                     GOTO VDEXIT
     C                     END                             *FI
      *
      * Set up parameters
      *
     C                     CLEARW0DATA
     C                     MOVELBRCA      B#BRCA
     C                     MOVEL#1ACTC    O#ACTD
     C                     MOVEL##PGM     O#CPGM
      *
      * Check all valid actions
      *
     C                     CALL 'ME1190'               9090
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM '*ORGN   'W0ACT   8
     C                     PARM           W0DATA
      *
      * Option ended in error
      *
     C           *IN90     IFEQ '1'                        *IF
     C                     MOVEL'MIN0019' P0RTN
     C                     MOVEL'MIN0019' ZAMSID
     C                     MOVEL'MEMSG  ' ZAMSGF
     C                     EXSR ZASNMS
     C                     SETON                     993132*
     C                     END                             *FI
      *
      * Invalid action
      *
     C           W0RTN     IFNE *BLANKS                    *IF
     C                     SETON                     993231*
     C                     END                             *FI
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           VDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * EDTRCD: Exit program - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Exit Program Processing
     C/COPY WNCPYSRC,FT0345DEPP
      *
     C                     MOVEL*BLANK    P0RTN
      *
      * CASE: CTL.*CMD key is CF07
      *
     C           *IN07     IFEQ '1'                        *IF
     C                     MOVEL'FTM2005' P0RTN            *Return code
     C                     END                             *FI
      *
      * CASE: CTL.*CMD key is CF03
      *
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     END                             *FI
      *
      * CASE: CTL.*CMD key is CF12
      *
     C           *IN12     IFEQ '1'                        *IF
     C                     MOVEL'USR0790' P0RTN            *Return code
     C                     END                             *FI
      *
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      *
      * ROLLBACK any uncommitted DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK                       90
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      * Copy any undisplayed messages back to caller
      *
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Exit program
      *
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *
      *  Set up copyright parameter
      *
     C                     MOVEACPY@      BIS@   80
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'ZZINIT'  @STK,Q
      *
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      *
      * Initialise indicators for re-entry
      *
     C                     MOVE '0'       *IN
      *
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      *
      * Update screen time
      *
     C                     TIME           ##TME   60
      *
      * Obtain default message file
      *
     C                     MOVEL'FTUSRMSG'ZADFMF 10
      *
      * Open files first time only
      *
     C           W0OPN     IFEQ *BLANK
      *
      * Begin commit control
      *
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
     C                     OPEN OTPAYL0
      *
      * Signal that files are now open
      *
     C                     MOVE 'Y'       W0OPN   1
     C                     END
      *
      * Change mode
      *
     C                     MOVEL'CHG'     W0PMD
     C                     MOVEL*BLANK    W0GRP   1
      *
      * USER: Initialise program
      * Retrieve Midas Date - R10 Standard Functions  *
      *
      * Get Rundate - Rundate  *
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    ##MRDT  7        Midas Run date
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
     C/COPY WNCPYSRC,FT0345C061
      *
      * Get modules information
      *
     C                     CALL 'AOMMODR0'             9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDMMOD    PARM *BLANKS   DSFDY            O:Module Flg
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOMMODR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD14        W0ERNB           * DB ERROR 14 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                   CAC001
      **  If Analytical Accounting is installed, enable F19 for           CAC001
      **  Margin Information.                                             CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE '1'       *IN61                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE '0'       *IN61                           CAC001
     C                     END                                            CAC001
      *
      * Get default branch
      *
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
      *
      *  Extract bank details
      *
     C                     CALL 'AOBANKR0'             9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDBANK    PARM SDBANK    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD15        W0ERNB           * DB ERROR 15 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C** Extract general ledger details from SDGELRPD
     C*
     C**********           CALL 'AOGELRR0'             9090                                   CGL029
     C                     CALL 'AOGELRR1'             9090                                   CGL029
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOGELRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD16        W0ERNB           * DB ERROR 16 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   P@RTCD  7                       S01494
     C                     PARM '*VERIFY' P@OPTN  7                       S01494
     C                     PARM 'S01494'  P@SARD  6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C                     MOVE 'N'       S01494  1                       S01494
     C                     MOVE '0'       *IN80                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set a variable field to          S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           P@RTCD    IFEQ *BLANKS                                   S01494
     C                     MOVE 'Y'       S01494                          S01494
     C                     MOVE '1'       *IN80                           S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           P@RTCD    IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'W0FILE                          S01494
     C                     MOVEL'*CALL'   W0KEY            ***************S01494
     C                     Z-ADD12        W0ERNB           * DB ERROR 12 *S01494
     C                     MOVEL'MEM5003' W0MSGD           ***************S01494
     C                     MOVEL'MIDAS  ' W0MSGF                          S01494
     C                     EXSR SRERR                                     S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   P@RTCD  7                       S01499
     C                     PARM '*VERIFY' P@OPTN  7                       S01499
     C                     PARM 'S01499'  P@SARD  6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C                     MOVE 'N'       S01499  1                       S01499
     C                     MOVE 'N'       V#VATP                          S01499
     C                     MOVE '0'       *IN82                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set a variable field to          S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           P@RTCD    IFEQ *BLANKS                                   S01499
     C                     MOVE 'Y'       S01499                          S01499
     C                     MOVE '1'       *IN82                           S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           P@RTCD    IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD13        W0ERNB           * DB ERROR 13 *S01499
     C                     MOVEL'MEM5003' W0MSGD           ***************S01499
     C                     MOVEL'MIDAS  ' W0MSGF                          S01499
     C                     EXSR SRERR                                     S01499
     C                     END                                            S01499
     C                     END                                            S01499
      *                                                                   CFT009
      ** Determine if SAR CFT009 FEES AND CHARGES IS INSTALLED            CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   P@RTCD                          CFT009
     C                     PARM '*VERIFY 'P@OPTN                          CFT009
     C                     PARM 'CFT009'  @SARD                           CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
     C           P@RTCD    IFNE *BLANKS                                   CFT009
     C           P@RTCD    ANDNE'*NRF   '                                 CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     Z-ADD45        W0ERNB                          CFT009
     C                     MOVEL'CFT009'  W0KEY                           CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           P@RTCD    IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     MOVE *ON       *IN63                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT009                          CFT009
     C                     MOVE *OFF      *IN63                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Determine if SAR CFT010 FEES AND CHARGES IS INSTALLED            CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   P@RTCD                          CFT009
     C                     PARM '*VERIFY 'P@OPTN                          CFT009
     C                     PARM 'CFT010'  @SARD                           CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
     C           P@RTCD    IFNE *BLANKS                                   CFT009
     C           P@RTCD    ANDNE'*NRF   '                                 CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     Z-ADD46        W0ERNB                          CFT009
     C                     MOVEL'CFT010'  W0KEY                           CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           P@RTCD    IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT010  1                       CFT009
     C                     MOVE *ON       *IN64                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT010                          CFT009
     C                     MOVE *OFF      *IN64                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Access SAR details file to determine if ULX004 is switched ON                        CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX004  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   P@RTCD  7                                           CER001
     C                     PARM '*VERIFY' P@OPTN  7                                           CER001
     C                     PARM 'ULX004'  P@SARD  6                                           CER001
     C           SCSARD    PARM SCSARD    DSFDY                                               CER001
      *                                                                                       CER001
     C           P@RTCD    IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX004                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** else, database error (return code other than *NRF)                                   CER001
      *                                                                                       CER001
     C           P@RTCD    IFNE '*NRF   '                                                     CER001
     C                     MOVEL'SCSARDPD'W0FILE                                              CER001
     C                     MOVEL'*CALL'   W0KEY                                               CER001
     C                     Z-ADD75        W0ERNB                                              CER001
     C                     MOVEL'MEM5003' W0MSGD                                              CER001
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER001
     C                     EXSR SRERR                                                         CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER049
      ** Access SAR details file to determine if CER049 is switched ON                        CER049
      *                                                                                       CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   P@RTCD                                              CER049
     C                     PARM '*VERIFY' P@OPTN                                              CER049
     C                     PARM 'CER049'  P@SARD                                              CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
     C           P@RTCD    IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** else, database error (return code other than *NRF)                                   CER049
      *                                                                                       CER049
     C           P@RTCD    IFNE '*NRF   '                                                     CER049
     C                     MOVEL'SCSARDPD'W0FILE                                              CER049
     C                     MOVEL'*CALL'   W0KEY                                               CER049
     C                     Z-ADD76        W0ERNB                                              CER049
     C                     MOVEL'MEM5003' W0MSGD                                              CER049
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C*                                                                   S01499
     C** Read V.A.T. details if S01499 switched ON                        S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT009    ANDEQ'N'                                       CFT009
     C           CFT009    OREQ 'Y'                                       CFT009
     C           CFT010    ANDEQ'Y'                                       CFT009
     C*                                                                   S01499
     C                     CALL 'AOVATR0'              9090               S01499
     C                     PARM '*MSG   ' P@RTCD  7        B:Return code  S01499
     C                     PARM '*FIRST ' P@OPTN  7        I:Option       S01499
     C                     PARM           VATDS                           S01499
     C*                                                                   S01499
     C** If return with an error (LR seton in called program) then        S01499
     C** process for database error.                                      S01499
     C*                                                                   S01499
     C           *IN90     IFEQ '1'                                       S01499
     C           P@RTCD    OREQ '*ERROR*'                                 S01499
     C                     MOVEL'AOVATR0 'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD14        W0ERNB           * DB ERROR 14 *S01499
     C                     MOVEL'MEM5003' W0MSGD           ***************S01499
     C                     MOVEL'MIDAS  ' W0MSGF                          S01499
     C                     EXSR SRERR                                     S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Store V.A.T. rate.  Set ON a variable field to be used later     S01499
     C** in FT0348 for validation.                                        S01499
     C*                                                                   S01499
     C                     Z-ADDO#VATR    V#VATR                          S01499
     C                     MOVEL'Y'       V#VATP                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Access SAR details file to determine if S01506 is switched ON    S01506
     C*                                                                   S01506
     C                     CALL 'AOSARDR0'                                S01506
     C                     PARM *BLANKS   P@RTCD                          S01506
     C                     PARM '*VERIFY' P@OPTN                          S01506
     C                     PARM 'S01506'  P@SARD                          S01506
     C           SCSARD    PARM SCSARD    DSFDY                           S01506
     C                     MOVE 'N'       S01506  1                       S01506
     C*                                                                   S01506
     C** If core feature is switched ON, set a variable field to          S01506
     C** condition the rest of the processing                             S01506
     C*                                                                   S01506
     C           P@RTCD    IFEQ *BLANKS                                   S01506
     C                     MOVE 'Y'       S01506                          S01506
     C                     ELSE                                           S01506
     C*                                                                   S01506
     C** else, database error (return code other than *NRF)               S01506
     C*                                                                   S01506
     C           P@RTCD    IFNE '*NRF   '                                 S01506
     C                     MOVEL'SCSARDPD'W0FILE                          S01506
     C                     MOVEL'*CALL'   W0KEY            ************   S01506
     C                     Z-ADD30        W0ERNB           * DBERR 30 *   S01506
     C                     MOVEL'MEM5003' W0MSGD           ************   S01506
     C                     MOVEL'MIDAS  ' W0MSGF                          S01506
     C                     EXSR SRERR                                     S01506
     C                     END                                            S01506
     C                     END                                            S01506
     C*                                                                   S01508
     C** Access SAR details file to determine if S01508 is switched ON    S01508
     C*                                                                   S01508
     C                     CALL 'AOSARDR0'                                S01508
     C                     PARM *BLANKS   P@RTCD                          S01508
     C                     PARM '*VERIFY' P@OPTN                          S01508
     C                     PARM 'S01508'  P@SARD                          S01508
     C           SCSARD    PARM SCSARD    DSFDY                           S01508
     C                     MOVE 'N'       S01508  1                       S01508
     C*                                                                   S01508
     C** If core feature is switched ON, set a variable field to          S01508
     C** condition the rest of the processing                             S01508
     C*                                                                   S01508
     C           P@RTCD    IFEQ *BLANKS                                   S01508
     C                     MOVE 'Y'       S01508                          S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C** else, database error (return code other than *NRF)               S01508
     C*                                                                   S01508
     C           P@RTCD    IFNE '*NRF   '                                 S01508
     C                     MOVEL'SCSARDPD'W0FILE                          S01508
     C                     MOVEL'*CALL'   W0KEY            ************   S01508
     C                     Z-ADD31        W0ERNB           * DBERR 31 *   S01508
     C                     MOVEL'MEM5003' W0MSGD           ************   S01508
     C                     MOVEL'MIDAS  ' W0MSGF                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C                     END                                            S01508
      *                                                                   CFT007
      *  Access SAR details file to see if CFT007 is installed.           CFT007
      *                                                                   CFT007
     C                     CALL 'AOSARDR0'                                CFT007
     C                     PARM *BLANKS   P@RTCD  7                       CFT007
     C                     PARM '*VERIFY' P@OPTN  7                       CFT007
     C                     PARM 'CFT007'  @SARD   6                       CFT007
     C           SCSARD    PARM *BLANKS   DSFDY                           CFT007
      *                                                                   CFT007
      *  Allow BIC Database Plus Integration                              CFT007
      *                                                                   CFT007
     C           P@RTCD    IFEQ *BLANKS                                   CFT007
     C                     MOVEL'CFT007'  CFT007  6                       CFT007
     C                     MOVE *ON       *IN85                           CFT007
     C                     ENDIF                                          CFT007
      *                                                                                       CFT050
      ** Access SAR file to determine if CFT050 (SWIFTRef Directories                         CFT050
      ** upload) is installed.                                                                CFT050
      *                                                                                       CFT050
     C                     CALL 'AOSARDR0'                                                    CFT050
     C                     PARM *BLANKS   PRTCD   7                                           CFT050
     C                     PARM '*VERIFY' POPTN   7                                           CFT050
     C                     PARM 'CFT050'  PSARD   6                                           CFT050
      *                                                                                       CFT050
      ** CFT007 process will take place when CFT050 is switched on                            CFT050
      *                                                                                       CFT050
     C           PRTCD     IFEQ *BLANKS                                                       CFT050
     C                     MOVEL'CFT007'  CFT007                                              CFT050
     C                     MOVE *ON       *IN85                                               CFT050
     C                     ENDIF                                                              CFT050
      *                                                                   CFT014
      ** Determine if SAR CFT014 MT103 Message Generation is ins -        CFT014
      ** talled.                                                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*VERIFY 'P@OPTN                          CFT014
     C                     PARM 'CFT014'  @SARD                           CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C           P@RTCD    ANDNE'*NRF   '                                 CFT014
     C                     MOVEL'SCSARDPD'W0FILE                          CFT014
     C                     Z-ADD44        W0ERNB                          CFT014
     C                     MOVEL'CFT014'  W0KEY                           CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           P@RTCD    IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014  1                       CFT014
     C                     MOVE *ON       *IN62                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       CFT014                          CFT014
     C                     MOVE *OFF      *IN62                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       219241
      ** If CFT014 is installed, read SDMGMEPD                                                219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
      *                                                                                       219241
     C                     CALL 'AOMGMER1'                                                    219241
     C                     PARM *BLANKS   P@RTCD                                              219241
     C                     PARM '*FIRST'  P@OPTN                                              219241
     C           SDMGME    PARM SDMGME    DSSDY                                               219241
      *                                                                                       219241
     C           P@RTCD    IFNE *BLANKS                                                       219241
     C                     MOVEL'SDMGMEPD'W0FILE                                              219241
     C                     Z-ADD70        W0ERNB                                              219241
     C                     MOVELP@OPTN    W0KEY                                               219241
     C                     EXSR SRERR                                                         219241
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ENDIF                                                              219241
      *                                                                                       CSW201
      ** Check if SWIFT 2001 (CSW201) is installed                                            CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   P@RTCD                                              CSW201
      *                                                                                       CSW201
     C           P@RTCD    IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW203
      ** Check if SWIFT Changes 2003 (CSW203) is installed                                    CSW203
      *                                                                                       CSW203
     C                     CALL 'SWIF2003'                                                    CSW203
     C                     PARM *BLANKS   P@RTCD                                              CSW203
      *                                                                                       CSW203
     C           P@RTCD    IFEQ 'CSW2003'                                                     CSW203
     C                     MOVE 'Y'       CSW203  1                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'N'       CSW203                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CFT017
      ** Access SAR details file to determine if CFT017 is switched on.                       CFT017
      *                                                                                       CFT017
     C                     CALL 'AOSARDR0'                                                    CFT017
     C                     PARM *BLANKS   @RTRN                                               CFT017
     C                     PARM '*VERIFY' @OPTN                                               CFT017
     C                     PARM 'CFT017'  @SARD                                               CFT017
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT017
      *                                                                                       CFT017
     C           @RTRN     IFEQ *BLANKS                                                       CFT017
     C                     MOVE 'Y'       CFT017  1                                           CFT017
     C                     ELSE                                                               CFT017
     C                     MOVE 'N'       CFT017                                              CFT017
     C                     ENDIF                                                              CFT017
      *                                                                                       CAP205
      ** Determine if SAR CAP205 is instlled                                                  CAP205
      *                                                                                       CAP205
     C                     MOVEL'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTRN                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTRN     IFNE *BLANKS                                                       CAP205
     C           @RTRN     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     Z-ADD25        W0ERNB                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C           @RTRN     IFEQ *BLANKS                                                       CAP205
     C                     MOVEL'Y'       CAP205                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   CFT007
     C/COPY WNCPYSRC,FT0345C041
      *
      ** Read SDFTFRPD
      *
     C                     CALL 'AOFTFRR0'             90
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDFTFR    PARM SDFTFR    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOFTFRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD17        W0ERNB           * DB ERROR 17 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                   CFT014
     C                     MOVE BTCHCY    V#CHCY                          CFT014
      *
      * Get data -branch indicator
      *
     C           BGRTBN    IFEQ 'Y'                        Full Retail
     C           BGIOAC    OREQ 'Y'                        Interest on Account
      *
      ** Read SDRETLPD for retail account nos. indicator
      *
     C                     CALL 'AORETLR0'             90
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*FIRST'  P@OPTN
     C           SDRETL    PARM SDRETL    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AORETLR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD18        W0ERNB           * DB ERROR 18 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
      ** Read SDTRADPD for sterling currency code
      *
     C                     CALL 'AOTRADR0'             90
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOTRADR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD19        W0ERNB           * DB ERROR 19 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Access FT Control data
      *
     C                     CALL 'FT0005'               9090
     C                     PARM *BLANKS   P@RTCD
     C           T#CNTL    PARM           DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'FT0005  'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD20        W0ERNB           * DB ERROR 20 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Set up FT override for General Ledger Balances
      *
     C           T#GLUI    IFEQ 'I'
     C                     MOVEL'Y'       ##FTOV  1
     C                     ELSE
     C                     MOVEL*BLANKS   ##FTOV
     C                     END
     C*                                                                   S01499
     C** Set up apply V.A.T. flag default value                           S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVELT#VATT    V#VATT                          S01499
     C                     END                                            S01499
      *
      * Calculate Back Value Date and set other V# values
      *
     C           BJRDNB    SUB  BJBVPD    V#BVLD
     C                     MOVELBKOBUV    V#OBUV
     C                     MOVELBJSBRC    V#SBRC
     C                     MOVELBJSLCD    V#SLCD
     C                     MOVELBMRANR    V#RANR
     C                     MOVELBJCYCD    V#BCCY
     C                     MOVELBJLCCY    V#LCCY
     C                     MOVELBKPRCU    V#PRCU
     C                     MOVELBKPCDU    V#PCDU
     C                     MOVELBLCYCD    V#GBP
     C                     MOVELBTPCRD    V#PCRD
      *
      * Obtain Midas run date in user format
      *
     C                     CALL 'ZDATE2'               9090Entry parameter
     C                     PARM WURDNB    ZDAYNO  50       Value date
     C                     PARM WUDFF     ZDATFM  1        Date format ind
     C                     PARM           ZDATE   60       Value date
     C                     PARM           ZADATE  7        Run-date in DDM
      *
     C                     MOVELZDATE     V#MRDT
      *
      * Set up payment reference r
      *
     C                     MOVEL*BLANKS   W#YMD   6
     C           WUDFF     IFEQ 'M'
     C                     MOVELZDATE     SWDT1   6
     C           2         SUBSTSWDT1:5   MM
     C           2         SUBSTSWDT1:3   YY
     C           2         SUBSTSWDT1:1   DD
     C                     MOVELSWDT2     W#YMD
     C                     ELSE
      *
      * DDMMYY format display
      *
     C                     MOVELZDATE     SWDT1
     C           2         SUBSTSWDT1:5   YY
     C           2         SUBSTSWDT1:3   MM
     C           2         SUBSTSWDT1:1   DD
     C                     MOVELSWDT2     W#YMD
     C                     END
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      ** If originating branch used flag = 'Y'
      *
     C           BKOBRU    IFEQ 'Y'
     C                     SETON                     78
     C                     END
      *
      * Reset global error indicator and clear error codes
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X       50
     C                     SETON                     81
     C/COPY WNCPYSRC,FT0345C037
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EXINIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      * EDTRCD: Initialise prog - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Program C-spec
     C/COPY WNCPYSRC,FT0345DCPG
     C/EJECT
      *================================================================   CAC001
      *                                                               *   CAC001
      *  SRMGIN  -  Control Window Processing for Margin Information  *   CAC001
      *                                                               *   CAC001
      *  Called By:  CADSDA - Display and Process key screen          *   CAC001
      *              CFPRSC - Validate record                         *   CAC001
      *                                                               *   CAC001
      *  Calls    :  ZASNMS - Send message to program's message queue *   CAC001
      *              ZYEXPG - Cancel and exit from key screen         *   CAC001
      *                                                               *   CAC001
      *================================================================   CAC001
     CSR         SRMGIN    BEGSR                                          CAC001
      *                                                                   CAC001
      *  Set up subroutine stack name                                     CAC001
      *                                                                   CAC001
     C                     ADD  1         Q                               CAC001
     C                     MOVEL'SRMGIN'  @STK,Q                          CAC001
      *                                                                   CAC001
      **  Check if window processing required.                            CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                        B001           CAC001
      *                                                                   CAC001
      **  Check if Analytical Accounting installed.                       CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                        B002           CAC001
      *                                                                   CAC001
      **  Disallow F19 if pay and settle currencies are the same and      CAC001
      **  margin info details are blanks.                                 CAC001
      *                                                                   CAC001
     C           #1ACTC    IFEQ 'I'                        B003           CAC001
     C           #1ACTC    OREQ 'A'                                       CAC001
      *                                                                   CAC001
     C           PCCY      IFEQ SMCY                                      CAC001
     C           WOMBSI    ANDEQ*BLANKS                                   CAC001
     C           WOMSIG    ANDEQ*BLANKS                                   CAC001
     C                     MOVEL'FTM2554' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     99    *              CAC001
     C                     GOTO SMEXIT                                    CAC001
     C                     ENDIF                           E004           CAC001
     C                     ENDIF                           E003           CAC001
      *                                                                   CAC001
      **  Call MARGIN INFORMATION WINDOW:                                 CAC001
      **  If F19 pressed and DB and CR currencies are different...        CAC001
      **  Or F19 pressed and DB and CR currencies the same                CAC001
      **           and margin info are not blanks...                      CAC001
      **  Or Action code is 'E' for Enquiry...                            CAC001
      *                                                                   CAC001
     C           WFRCI     IFEQ 'N'                        B003           CAC001
     C           PCCY      ANDNESMCY                                      CAC001
      *                                                                   CAC001
     C           WFRCI     OREQ 'N'                                       CAC001
     C           PCCY      ANDEQSMCY                                      CAC001
     C           WOMBSI    ANDNE*BLANKS                                   CAC001
     C           WOMSIG    ANDNE*BLANKS                                   CAC001
      *                                                                   CAC001
     C           #1ACTC    OREQ 'E'                                       CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,FT0345C067
     C                     MOVE 'KT'      KEY                             CAC001
     C/COPY WNCPYSRC,FT0345C062
     C                     MOVE #1ACTC    ACTION                          CAC001
     C                     MOVE #1ACTC    WACTN                           CAC001
     C                     Z-ADDRATE      WRATE                           CAC001
     C                     MOVE 'P'       WPSIN                           CAC001
     C                     MOVE PCCY      WPCCY                           CAC001
     C                     MOVE SMCY      WSMCY                           CAC001
     C                     Z-ADDPYAM      WPYAM                           CAC001
     C                     Z-ADDSMAM      WSMAM                           CAC001
     C                     Z-ADDMDIN      WMDIN                           CAC001
     C                     Z-ADDWOFXMP    WFXMP                           CAC001
     C                     Z-ADDWOFXMD    WFXMD                           CAC001
     C                     MOVE WOMBSI    WMBSI                           CAC001
     C                     MOVE WOMSIG    WMSIG                           CAC001
     C                     Z-ADDWOMAMT    WMAMT                           CAC001
      *                                                                   CAC001
      ** If record id is not 'D', change value of action parameter        CAC001
      ** sent as 'E' as no changes are allowed for matured/authorised     CAC001
      ** deals.                                                           CAC001
      *                                                                   CAC001
     C           #1ACTC    IFEQ 'A'                                       CAC001
     C           RECI      ANDNE'D'                        B004           CAC001
     C                     MOVE 'E'       ACTION                          CAC001
     C                     ENDIF                           E004           CAC001
      *                                                                   CFT009
      ** Chain to payment charge defintion file to get miscellaneous cd   CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           ##SCR     ANDEQ'SCR3'                                    CFT009
     C           M1CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M1DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,1    M1DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M2CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M2DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,2    M2DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M3CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M3DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,3    M3DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M4CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M4DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,4    M4DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M5CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M5DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,5    M5DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CAC001
      **  Write record format and message control so screen will          CAC001
      **  not blank out when option '?' is used                           CAC001
      *                                                                   CAC001
     C                     SETON                         86*              CAC001
     C                     WRITE#MSGCTL                                   CAC001
     C                     WRITE#CMDTXT3                                  CAC001
     C***********          WRITE#RCDDTL2                           CAC001 CFT014
     C                     WRITE#RCDDTL3                                  CFT014
      *                                                                   CAC001
      **  Call window manager WN0010                                      CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'FT0345'  #PGM   10                       CAC001
     C/COPY WNCPYSRC,FT0345C068
     C                     PARM           KEY     2                       CAC001
     C/COPY WNCPYSRC,FT0345C063
     C                     PARM           ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           EXTRA 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C                     SELEC                           B004           CAC001
      *                                                                   CAC001
      * *Return code is *User QUIT requested                              CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'Y2U9999'                                 CAC001
     C                     MOVEL'Y2U9999' P0RTN                           CAC001
     C                     MOVEL'Y2U9999' ZAMSID                          CAC001
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     EXSR ZYEXPG                                    CAC001
      *                                                                   CAC001
      * *Return code is WN Window Error                                   CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0563'                                 CAC001
     C                     MOVEL'USR0563' ZAMSID                          CAC001
     C                     MOVEL'SDUSRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *DBF update error                                 CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0567'                                 CAC001
     C                     MOVEL'USR0567' ZAMSID                          CAC001
     C                     MOVEL'SDUSRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *Previous Screen                                  CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0790'                                 CAC001
     C                     MOVEL'USR0790' ZAMSID                          CAC001
     C                     MOVEL'WNMSGF  'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *Blanks. Update margin info fields with           CAC001
      * new values from window program.                                   CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ *BLANKS                                   CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C                     Z-ADDWFXMP     WOFXMP                          CAC001
     C                     Z-ADDWFXMD     WOFXMD                          CAC001
     C                     MOVE WMBSI     WOMBSI                          CAC001
     C                     MOVE WMSIG     WOMSIG                          CAC001
     C                     Z-ADDWMAMT     WOMAMT                          CAC001
      *                                                                   CAC001
     C           P4PARM    IFNE '*BLANKS'                                 CAC001
     C                     Z-ADDWFXMP     P4FXMP                          CAC001
     C                     Z-ADDWFXMD     P4FXMD                          CAC001
     C                     MOVE WMBSI     P4MBSI                          CAC001
     C                     MOVE WMSIG     P4MSIG                          CAC001
     C                     Z-ADDWMAMT     P4MAMT                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDSL                           E004           CAC001
      *                                                                   CAC001
     C                     ENDIF                           E003           CAC001
     C                     ENDIF                           E002           CAC001
     C                     ENDIF                           E001           CAC001
      *================================================================   CAC001
      *                                                                   CAC001
      *  Unwind subroutine stack name                                     CAC001
      *                                                                   CAC001
     C           SMEXIT    TAG                                            CAC001
     C                     MOVEA*BLANKS   @STK,Q                          CAC001
     C                     SUB  1         Q                               CAC001
      *                                                                   CAC001
     C                     ENDSR                                          CAC001
     C/EJECT                                                              CAC001
     C*================================================================   CFT007
      *                                                               *   CFT007
      *  SRBICP  -  BIC Database Plus Integration                     *   CFT007
      *                                                               *   CFT007
      *  Called By:  CADSDA - Display and Process key screen          *   CFT007
      *                                                               *   CFT007
      *  Calls    :  ZASNMS - Send message to program's message queue *   CFT007
      *================================================================   CFT007
     CSR         SRBICP    BEGSR                                          CFT007
      *                                                                   CFT007
      *  Set up subroutine stack name                                     CFT007
      *                                                                   CFT007
     C                     ADD  1         Q                               CFT007
     C                     MOVEL'SRBICP'  @STK,Q                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
      *                                                                   CFT007
      * Determine whether cursor is on an allowed field                   CFT007
      *                                                                   CFT007
     C                     Z-ADD@#RWCL    WKSCPS  50                      CFT007
      *                                                                   CFT007
      * Note: If these screen fields move then these values will          CFT007
      *       need changing.                                              CFT007
      *                                                                   CFT007
      *       The value is cursor row number * 256 + column number        CFT007
      *                                                                   CFT007
      * Receiver's correspondent line 1                                   CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1RC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE1325                                      CFT007
     C           WKSCPS    ANDLE1359                                      CFT007
     C                     MOVE *ON       LIN1RC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Receiver's correspondent line 2                                   CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2RC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE1538                                      CFT007
     C           WKSCPS    ANDLE1572                                      CFT007
     C                     MOVE *ON       LIN2RC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Account with bank line 1                                          CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1AB  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C***********WKSCPS    ANDGE2093                               CFT007 CFT014
     C***********WKSCPS    ANDLE2127                               CFT007 CFT014
     C           WKSCPS    ANDGE3629                                      CFT014
     C           WKSCPS    ANDLE3663                                      CFT014
     C                     MOVE *ON       LIN1AB                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Account with bank line 2                                          CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2AB  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C***********WKSCPS    ANDGE2306                               CFT007 CFT014
     C***********WKSCPS    ANDLE2340                               CFT007 CFT014
     C           WKSCPS    ANDGE3842                                      CFT014
     C           WKSCPS    ANDLE3876                                      CFT014
     C                     MOVE *ON       LIN2AB                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Beneficiary line 1                                                CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1BE  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C***********WKSCPS    ANDGE2861                               CFT007 CFT014
     C***********WKSCPS    ANDLE2895                               CFT007 CFT014
     C           WKSCPS    ANDGE4397                                      CFT014
     C           WKSCPS    ANDLE4431                                      CFT014
     C                     MOVE *ON       LIN1BE                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Beneficiary line 2                                                CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2BE  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C***********WKSCPS    ANDGE3074                               CFT007 CFT014
     C***********WKSCPS    ANDLE3108                               CFT007 CFT014
     C           WKSCPS    ANDGE4610                                      CFT014
     C           WKSCPS    ANDLE4644                                      CFT014
     C                     MOVE *ON       LIN2BE                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Intermediary bank line 1                                          CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1IB  1                       CFT007
     C***********##SCR     IFEQ 'SCR2'                             CFT007 CFT014
     C***********WKSCPS    ANDGE1050                               CFT007 CFT014
     C***********WKSCPS    ANDLE1084                               CFT007 CFT014
     C           ##SCR     IFEQ 'SCR1'                                    CFT014
     C           WKSCPS    ANDGE2861                                      CFT014
     C           WKSCPS    ANDLE2895                                      CFT014
     C                     MOVE *ON       LIN1IB                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C* Intermediary bank line 2                                          CFT007
     C*                                                                   CFT007
     C                     MOVE *OFF      LIN2IB  1                       CFT007
     C***********##SCR     IFEQ 'SCR2'                             CFT007 CFT014
     C***********WKSCPS    ANDGE1306                               CFT007 CFT014
     C***********WKSCPS    ANDLE1340                               CFT007 CFT014
     C           ##SCR     IFEQ 'SCR1'                                    CFT014
     C           WKSCPS    ANDGE3074                                      CFT014
     C           WKSCPS    ANDLE3108                                      CFT014
     C                     MOVE *ON       LIN2IB                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT014
      ** Third reimbursement institution line 1                           CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVE *OFF      LIN1TR  1                       CFT014
     C           ##SCR     IFEQ 'SCR1'                                    CFT014
     C           WKSCPS    ANDGE2093                                      CFT014
     C           WKSCPS    ANDLE2127                                      CFT014
     C                     MOVE *ON       LIN1TR                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Third reimbursement institution line 2                           CFT014
      *                                                                   CFT014
     C                     MOVE *OFF      LIN2TR  1                       CFT014
     C           ##SCR     IFEQ 'SCR1'                                    CFT014
     C           WKSCPS    ANDGE2306                                      CFT014
     C           WKSCPS    ANDLE2340                                      CFT014
     C                     MOVE *ON       LIN2TR                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   CFT007
     C* If cursor is not on an allowed field, error                       CFT007
     C*                                                                   CFT007
     C           LIN1RC    IFNE *ON                                       CFT007
     C           LIN2RC    ANDNE*ON                                       CFT007
     C           LIN1AB    ANDNE*ON                                       CFT007
     C           LIN2AB    ANDNE*ON                                       CFT007
     C           LIN1BE    ANDNE*ON                                       CFT007
     C           LIN2BE    ANDNE*ON                                       CFT007
     C           LIN1IB    ANDNE*ON                                       CFT007
     C           LIN2IB    ANDNE*ON                                       CFT007
     C           CFT014    ANDNE'Y'                                       CFT014
     C           LIN1RC    ORNE *ON                                       CFT014
     C           LIN2RC    ANDNE*ON                                       CFT014
     C           LIN1AB    ANDNE*ON                                       CFT014
     C           LIN2AB    ANDNE*ON                                       CFT014
     C           LIN1BE    ANDNE*ON                                       CFT014
     C           LIN2BE    ANDNE*ON                                       CFT014
     C           LIN1IB    ANDNE*ON                                       CFT014
     C           LIN2IB    ANDNE*ON                                       CFT014
     C           LIN1TR    ANDNE*ON                                       CFT014
     C           LIN2TR    ANDNE*ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
      *                                                                   CFT007
      * Error message:                                                    CFT007
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVEL'FTM3259' ZAMSID                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'FTM2613' ZAMSID                          CFT007
     C                     ENDIF                                          CFT014
     C                     EXSR ZASNMS                                    CFT007
      *                                                                   CFT007
     C                     ELSE                                           CFT007
      *                                                                   CFT007
      * F4 and F16 are not allowed in Enquiry (and delete) mode           CFT007
     C           #1ACTC    IFEQ 'E'                                       CFT007
      * Error message:                                                    CFT007
     C                     MOVEL'FTM2619' ZAMSID                          CFT007
     C                     EXSR ZASNMS                                    CFT007
      *                                                                   CFT007
     C                     ELSE                                           CFT007
      * check indicators                                                  CFT007
      *                                                                   CFT007
      * In-line prompt or search mode, capture criteria from screen       CFT007
      *                                                                   CFT007
     C           *IN08     IFEQ *ON                                       CFT007
     C           *IN13     OREQ *ON                                       CFT007
      *                                                                   CFT007
     C           LIN1RC    IFEQ *ON                                       CFT007
     C                     MOVE #1RCO1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2RC    IFEQ *ON                                       CFT007
     C                     MOVE #1RCO2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1AB    IFEQ *ON                                       CFT007
     C                     MOVE #1ACB1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2AB    IFEQ *ON                                       CFT007
     C                     MOVE #1ACB2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1BE    IFEQ *ON                                       CFT007
     C                     MOVE #1BNC1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2BE    IFEQ *ON                                       CFT007
     C                     MOVE #1BNC2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1IB    IFEQ *ON                                       CFT007
     C***********          MOVE #2INB1    @ICRIT                   CFT007 CFT014
     C                     MOVE #1INB1    @ICRIT                          CFT014
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2IB    IFEQ *ON                                       CFT007
     C***********          MOVE #2INB2    @ICRIT                   CFT007 CFT014
     C                     MOVE #1INB2    @ICRIT                          CFT014
     C                     ENDIF                                          CFT007
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           LIN1TR    IFEQ *ON                                       CFT014
     C                     MOVE #1TRI1    @ICRIT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           LIN2TR    IFEQ *ON                                       CFT014
     C                     MOVE #1TRI2    @ICRIT                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT007
     C* In-line prompt mode                                               CFT007
     C*                                                                   CFT007
     C           *IN08     IFEQ *ON                                       CFT007
     C                     MOVE 'P'       @IMODE                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C* In-line search mode                                               CFT007
     C*                                                                   CFT007
     C           *IN13     IFEQ *ON                                       CFT007
     C                     MOVE 'F'       @IMODE                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C* Call BIC Plus enquiry program                                     CFT007
     C*                                                                   CFT007
     C                     CALL 'FT0900'                                  CFT007
     C                     PARM           @IMODE  1                       CFT007
     C                     PARM           @ICRIT 35                       CFT007
     C                     PARM *BLANKS   @OADD 175                       CFT007
     C                     PARM *BLANKS   @OCHIP 10                       CFT007
     C                     PARM *BLANKS   @OUTCD  2                       CFT007
     C                     PARM *BLANKS   @RTCD   7                       CFT007
     C                     MOVEL*BLANKS   @ICRIT                          CFT007
      *                                                                   CFT007
      *  F3 pressed - exit program                                        CFT007
      *                                                                   CFT007
     C           @RTCD     IFEQ 'F3'                                      CFT007
     C                     MOVE *ON       *IN03                           CFT007
     C                     END                                            CFT007
      *                                                                   CFT007
     C           @RTCD     IFEQ *BLANKS                                   CFT007
      *                                                                   CFT007
      * If a CHIPS code exists and relevant currency is USD, replace      CFT007
      * clearing code with CHIPS code                                     CFT007
      *                                                                   CFT007
     C           @OCHIP    IFNE *BLANKS                                   CFT007
     C           @OUTCD    ANDNE'AC'                                      CFT007
      *                                                                   CFT007
      * Check payment currency against SDTRAD US dollar code              CFT007
      *                                                                   CFT007
     C           PCCY      IFEQ BLUSCY                                    CFT007
     C           LIN1RC    IFEQ *ON                                       CFT007
     C           LIN1AB    OREQ *ON                                       CFT007
     C           LIN1BE    OREQ *ON                                       CFT007
     C           LIN1IB    OREQ *ON                                       CFT007
      *                                                                   CFT007
      * If clearing code is not present, move details down to             CFT007
      * create space for CHIPS code                                       CFT007
      *                                                                   CFT007
     C           @OUTCD    IFNE 'BC'                                      CFT007
     C           @OUTCD    ANDNE'DC'                                      CFT007
     C                     MOVE @OADD     WKADD1210                       CFT007
     C                     MOVELWKADD1    @OADD                           CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C                     MOVEL*BLANKS   WKCOCH 14                       CFT007
     C                     MOVEL'//CH'    WKCOCH                          CFT007
     C                     MOVE @OCHIP    WKCOCH                          CFT007
     C                     MOVELWKCOCH    OADD1                           CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
      * If command key pressed on 2nd line, remove clearing               CFT007
      * code from details                                                 CFT007
     C*                                                                   CFT007
     C           LIN2RC    IFEQ *ON                                       CFT007
     C           LIN2AB    OREQ *ON                                       CFT007
     C           LIN2BE    OREQ *ON                                       CFT007
     C           LIN2IB    OREQ *ON                                       CFT007
     C           LIN2TR    OREQ *ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C           @OUTCD    OREQ 'AC'                                      CFT007
     C*                                                                   CFT007
     C           @OUTCD    IFEQ 'BC'                                      CFT007
     C           @OUTCD    OREQ 'DC'                                      CFT007
     C           @OUTCD    OREQ 'AC'                                      CFT007
     C                     MOVE @OADD     WKADD2140                       CFT007
     C                     MOVE *BLANKS   @OADD                           CFT007
     C                     MOVELWKADD2    @OADD                           CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
      * Move details to screen                                            CFT007
      *                                                                   CFT007
     C           LIN1RC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1RCO1                          CFT007
     C                     MOVELOADD2     #1RCO2                          CFT007
     C                     MOVELOADD3     #1RCO3                          CFT007
     C                     MOVELOADD4     #1RCO4                          CFT007
     C                     MOVELOADD5     #1RCO5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C* If cursor line 1 move 'address' data direct to screen fields      CFT007
     C*                                                                   CFT007
     C           LIN1AB    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1ACB1                          CFT007
     C                     MOVELOADD2     #1ACB2                          CFT007
     C                     MOVELOADD3     #1ACB3                          CFT007
     C                     MOVELOADD4     #1ACB4                          CFT007
     C                     MOVELOADD5     #1ACB5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN1BE    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1BNC1                          CFT007
     C                     MOVELOADD2     #1BNC2                          CFT007
     C                     MOVELOADD3     #1BNC3                          CFT007
     C                     MOVELOADD4     #1BNC4                          CFT007
     C                     MOVELOADD5     #1BNC5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN1IB    IFEQ *ON                                       CFT007
     C***********          MOVELOADD1     #2INB1                   CFT007 CFT014
     C***********          MOVELOADD2     #2INB2                   CFT007 CFT014
     C***********          MOVELOADD3     #2INB3                   CFT007 CFT014
     C***********          MOVELOADD4     #2INB4                   CFT007 CFT014
     C***********          MOVELOADD5     #2INB5                   CFT007 CFT014
     C                     MOVELOADD1     #1INB1                          CFT014
     C                     MOVELOADD2     #1INB2                          CFT014
     C                     MOVELOADD3     #1INB3                          CFT014
     C                     MOVELOADD4     #1INB4                          CFT014
     C                     MOVELOADD5     #1INB5                          CFT014
     C                     ENDIF                                          CFT007
      *                                                                   CFT014
     C           LIN1TR    IFEQ *ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C                     MOVELOADD1     #1TRI1                          CFT014
     C                     MOVELOADD2     #1TRI2                          CFT014
     C                     MOVELOADD3     #1TRI3                          CFT014
     C                     MOVELOADD4     #1TRI4                          CFT014
     C                     MOVELOADD5     #1TRI5                          CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   CFT007
     C           LIN2RC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1RCO2                          CFT007
     C                     MOVELOADD2     #1RCO3                          CFT007
     C                     MOVELOADD3     #1RCO4                          CFT007
     C                     MOVELOADD4     #1RCO5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2AB    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1ACB2                          CFT007
     C                     MOVELOADD2     #1ACB3                          CFT007
     C                     MOVELOADD3     #1ACB4                          CFT007
     C                     MOVELOADD4     #1ACB5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2BE    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1BNC2                          CFT007
     C                     MOVELOADD2     #1BNC3                          CFT007
     C                     MOVELOADD3     #1BNC4                          CFT007
     C                     MOVELOADD4     #1BNC5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2IB    IFEQ *ON                                       CFT007
     C***********          MOVELOADD1     #2INB2                   CFT007 CFT014
     C***********          MOVELOADD2     #2INB3                   CFT007 CFT014
     C***********          MOVELOADD3     #2INB4                   CFT007 CFT014
     C***********          MOVELOADD4     #2INB5                   CFT007 CFT014
     C                     MOVELOADD1     #1INB2                          CFT014
     C                     MOVELOADD2     #1INB3                          CFT014
     C                     MOVELOADD3     #1INB4                          CFT014
     C                     MOVELOADD4     #1INB5                          CFT014
     C                     ENDIF                                          CFT007
      *                                                                   CFT014
     C           LIN2TR    IFEQ *ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C                     MOVELOADD1     #1TRI2                          CFT014
     C                     MOVELOADD2     #1TRI3                          CFT014
     C                     MOVELOADD3     #1TRI4                          CFT014
     C                     MOVELOADD4     #1TRI5                          CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
      *                                                                   CFT007
      *  Unwind subroutine stack name                                     CFT007
      *                                                                   CFT007
     C                     MOVEA*BLANKS   @STK,Q                          CFT007
     C                     SUB  1         Q                               CFT007
      *                                                                   CFT007
     C                     ENDSR                                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
     C/EJECT                                                              CFT007
      *================================================================
      *                                                               *
      *  SRWIND   : Control Window Processing                         *
      *                                                               *
      *================================================================
     CSR         SRWIND    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRWIND'  @STK,Q
      *
      * If window processing call WN0010
      *
     C           BGWDPR    IFEQ 'Y'
      *
      *    /copy to move data into the data structure fields passed
      *     as a parameter to the window controller
      *
      /COPY WNCPYSRC,FT0345MOV1
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     MOVELPREF      PREF1                                               CER001
     C                     ENDIF                                                              CER001
     C                     SELEC
     C           #1ACTC    WHEQ 'I'
      *
      *     Insert Processing
      *
      /COPY WNCPYSRC,FT0345MOV2
     C           #1ACTC    WHEQ 'A'
      *
      *     Amend Processing
      *
      /COPY WNCPYSRC,FT0345MOV3
     C           #1ACTC    WHEQ 'D'
      *
      *     Delete Processing
      *
      /COPY WNCPYSRC,FT0345MOV4
     C           #1ACTC    WHEQ 'E'
      *
      *     Enquire Processing
      *
      /COPY WNCPYSRC,FT0345MOV5
     C                     ENDSL
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     O#PGM  10
     C                     PARM *BLANKS   O#CMD   2
     C                     PARM #1ACTC    O#ACTN  1
     C                     PARM           DATA
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM           EXTRA 256
      *
      *   /copy to move data back from the data structure fields passed
      *    as a parameter to the window controller and control user
      *    defined processing.
      *
      /COPY WNCPYSRC,FT0345MOV6
      *
     C           *LIKE     DEFN O#RTN     R#RTN
     C           R#RTN     CABEQ*BLANKS   EXWIND
      *
      *  Check return code and send message on action
      *  - set no update as some action has been specified.
      *
     C                     MOVEL'Y'       W0DCF
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
     C                     SELEC
      *
      * *Return code is *User QUIT requested
      *
     C           R#RTN     WHEQ 'Y2U9999'
     C                     MOVEL'Y2U9999' P0RTN
     C                     MOVEL'Y2U9999' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     EXSR ZYEXPG
      *
      * *Return code is WN Window Error
      *
     C           R#RTN     WHEQ 'USR0563'
     C                     MOVEL'USR0563' ZAMSID
     C                     MOVEL'SDUSRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * *Return code is *DBF update error
      *
     C           R#RTN     WHEQ 'USR0567'
     C                     MOVEL'USR0567' ZAMSID
     C                     MOVEL'SDUSRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * *Return code is *Previous Screen
      *
     C           R#RTN     WHEQ 'USR0790'
     C                     MOVEL'MIN0001' ZAMSID
     C                     MOVEL'MEMSG   'ZAMSGF
     C                     EXSR ZASNMS
     C                     ENDSL
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXWIND    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      *================================================================   CFT014
      *                                                               *   CFT014
      *  SUMCHG   : Sum of charges                                    *   CFT014
      *                                                               *   CFT014
      *================================================================   CFT014
     CSR         SUMCHG    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SUMCHG'  @STK,Q                          CFT014
      ** Input parameters                                                 CFT014
      ** ----------------                                                 CFT014
      ** Telex charges                                                    CFT014
      **                                  TXCH                            CFT014
      ** Cheque charges                                                   CFT014
      **                                  CQCH                            CFT014
      ** Coast abroad                                                     CFT014
      **                                  CSTA                            CFT014
      ** Swift Priority charges                                           CFT014
      **                                  SPCH                            CFT014
      ** Miscellaneous charges                                            CFT014
      **                                  MSCH                            CFT014
      ** Transfer Commission                                              CFT014
      **                                  MSCH                            CFT014
      ** Receiver's charges in base currency (from settlement ccy)        CFT014
      **                                  OPRCSQ                          CFT014
      ** Receiver's charges in settlement currency                        CFT014
      **                                  OPRCSQ                          CFT014
      ** DR Account for charges                                           CFT014
      **                                  #3CDRO                          CFT014
      ** Add/deduct indicator                                             CFT014
      **                                  V#ADDC                          CFT014
      ** Output parameters                                                CFT014
      ** -----------------                                                CFT014
      ** Sum of charges                                                   CFT014
      **                                  ##CHGS                          CFT014
      *                                                                   CFT014
      *                                                                   CFT014
     C           TXCH      ADD  CQCH      ##CHGS                          CFT014
     C                     ADD  CSTA      ##CHGS                          CFT014
     C                     ADD  SPCH      ##CHGS                          CFT014
     C                     ADD  MSCH      ##CHGS                          CFT014
     C                     ADD  TRCM      ##CHGS                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     ADD  OPCHCM    ##CHGS                          CFT014
     C                     END                                            CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     ADD  OPVATT    ##CHGS                          CFT014
     C                     END                                            CFT014
      *                                                                   CFT014
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  SWSCHG    ##CHGS                          CFT009
     C                     ADD  MISC01    ##CHGS                          CFT009
     C                     ADD  MISC02    ##CHGS                          CFT009
     C                     ADD  MISC03    ##CHGS                          CFT009
     C                     ADD  MISC04    ##CHGS                          CFT009
     C                     ADD  MISC05    ##CHGS                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXSMCG    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *================================================================   CFT014
      *                                                               *   CFT014
      *  SUBRCG   : Default Receiver's Charges Remitted in Pay Ccy    *   CFT014
      *             from network                                      *   CFT014
      *                                                               *   CFT014
      *================================================================   CFT014
     CSR         SUBRCG    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SUBRCG'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     Z-ADD0         OPRCRM                          CFT014
     C                     Z-ADD0         W#PCHG 120                      CFT014
      *                                                                   CFT014
      *  Convert sum of charges to pay currency                           CFT014
      *                                                                   CFT014
     C           OPRCCN    IFNE SMCY                                      CFT014
     C           ##CHGS    ANDGT0                                         CFT014
      *                                                                   CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDSLDT      P#FRDT                          CFT014
     C                     Z-ADDSLDT      P#TODT                          CFT014
     C                     MOVELSMCY      P#FRCY                          CFT014
     C                     Z-ADD##CHGS    P#FRAM                          CFT014
     C                     MOVELPCCY      P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 50 *CFT014
     C                     Z-ADD50        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    W#PCHG                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Network Receiver's Charges currency is = to pay currency         CFT014
      *                                                                   CFT014
     C           OPRCCN    WHEQ PCCY                                      CFT014
     C                     Z-ADDOPRCNW    OPRCRM                          CFT014
      ** If receiver's charges is greater than our charges,               CFT014
     C           OPRCRM    IFGT W#PCHG                                    CFT014
     C           OPRCRM    SUB  W#PCHG    OPRCRM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Network Receiver's Charges currency is = to settle ccy           CFT014
      *                                                                   CFT014
     C           OPRCCN    WHEQ SMCY                                      CFT014
     C                     Z-ADDOPRCNW    OPRCSC                          CFT014
     C           OPRCSC    IFGT ##CHGS                                    CFT014
     C           OPRCSC    SUB  ##CHGS    OPRCSC                          CFT014
     C                     ENDIF                                          CFT014
      ** Convert to pay currency,                                         CFT014
     C           OPRCSC    IFGT 0                                         CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDSLDT      P#FRDT                          CFT014
     C                     Z-ADDSLDT      P#TODT                          CFT014
     C                     MOVELSMCY      P#FRCY                          CFT014
     C                     Z-ADDOPRCSC    P#FRAM                          CFT014
     C                     MOVELPCCY      P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 51 *CFT014
     C                     Z-ADD51        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    OPRCRM                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
      *                                                                   CFT014
      ** Calculate receiver's charges network in payment currency         CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDSLDT      P#FRDT                          CFT014
     C                     Z-ADDPVDT      P#TODT                          CFT014
     C                     MOVELOPRCCN    P#FRCY                          CFT014
     C                     Z-ADDOPRCNW    P#FRAM                          CFT014
     C                     MOVELPCCY      P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 52 *CFT014
     C                     Z-ADD52        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    OPRCRM                          CFT014
      ** If receiver's charges is greater than our charges,               CFT014
     C           OPRCRM    IFGT W#PCHG                                    CFT014
     C           OPRCRM    SUB  W#PCHG    OPRCRM                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXSBRC    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *================================================================   CFT009
      *                                                               *   CFT009
      *  SUBRCG   : Default Receiver's Charges Remitted in Pay Ccy    *   CFT009
      *             from network                                      *   CFT009
      *                                                               *   CFT009
      *================================================================   CFT009
     C           SCNCUR    BEGSR                                          CFT009
      *                                                                   CFT009
     C                     SELEC                                          CFT009
     C           BTCHCY    WHEQ 'B'                                       CFT009
     C           #3CDRO    ORNE *BLANKS                                   CFT009
     C                     MOVELV#BCCY    V#CCCY                          CFT009
      *                                                                   CFT009
     C           BTCHCY    WHEQ 'F'                                       CFT009
     C                     MOVELFCHCCY    V#CCCY                          CFT009
      *                                                                   CFT009
     C           BTCHCY    WHEQ 'L'                                       CFT009
     C                     MOVELV#LCCY    V#CCCY                          CFT009
      *                                                                   CFT009
     C           BTCHCY    WHEQ 'C'                                       CFT009
     C           V#ADDC    ANDEQ'A'                                       CFT009
     C                     MOVELSMCY      V#CCCY                          CFT009
      *                                                                   CFT009
     C                     OTHER                                          CFT009
     C                     MOVELPCCY      V#CCCY                          CFT009
     C                     ENDSL                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#CCCY    #3CCY1                          CFT009
     C                     MOVELV#CCCY    #3CCY2                          CFT009
     C                     MOVELV#CCCY    #3CCY3                          CFT009
     C                     MOVELV#CCCY    #3CCY4                          CFT009
     C                     MOVELV#CCCY    #3CCY5                          CFT009
     C                     MOVELV#CCCY    #3CCY6                          CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    #3CCY7                          CFT009
     C                     ENDIF                                          CFT009
     C           S01499    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    #3CCY8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    CCY9                            CFT009
     C                     MOVELV#CCCY    CCY10                           CFT009
     C                     MOVELV#CCCY    CCY11                           CFT009
     C                     MOVELV#CCCY    CCY12                           CFT009
     C                     MOVELV#CCCY    CCY13                           CFT009
     C                     MOVELV#CCCY    CCY14                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     SELEC                                          CFT009
      *                                                                   CFT009
     C           #3CDRO    WHNE *BLANKS                                   CFT009
     C                     MOVELV#BCCY    V#RCCY                          CFT009
      *                                                                   CFT009
     C           V#ADDC    WHEQ 'A'                                       CFT009
     C                     MOVELSMCY      V#RCCY                          CFT009
      *                                                                   CFT009
     C                     OTHER                                          CFT009
     C                     MOVELPCCY      V#RCCY                          CFT009
     C                     ENDSL                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#RCCY    #3RCY1                          CFT009
     C                     MOVELV#RCCY    #3RCY2                          CFT009
     C                     MOVELV#RCCY    #3RCY3                          CFT009
     C                     MOVELV#RCCY    #3RCY4                          CFT009
     C                     MOVELV#RCCY    #3RCY5                          CFT009
     C                     MOVELV#RCCY    #3RCY6                          CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    #3RCY7                          CFT009
     C                     ENDIF                                          CFT009
     C           S01499    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    #3RCY8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    RCY9                            CFT009
     C                     MOVELV#RCCY    RCY10                           CFT009
     C                     MOVELV#RCCY    RCY11                           CFT009
     C                     MOVELV#RCCY    RCY12                           CFT009
     C                     MOVELV#RCCY    RCY13                           CFT009
     C                     MOVELV#RCCY    RCY14                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDSR                                          CFT009
      *================================================================   CFT009
     C/EJECT                                                              CFT009
      *================================================================   CFT009
      *                                                               *   CFT009
      *  DAFSUB   : Set up file DAF fields, in case used has changed  *   CFT009
      *             defaults.                                         *   CFT009
      *                                                               *   CFT009
      *================================================================   CFT009
     C           DAFSUB    BEGSR                                          CFT009
      *                                                                   CFT009
      ** File DAF Format                                                  CFT009
      *                                                                   CFT009
     C           V#ADDC    IFEQ 'A'                                       CFT009
     C                     MOVE SMCY      SCCCY   3                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE PCCY      SCCCY                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   RTCD                            CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM SCCCY     @K101                           CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
     C                     Z-ADDA6NBDP    FCDP    10                      CFT009
      *                                                                   CFT009
      ** Transfer Commission                                              CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W       10                      CFT009
     C           TRCM      DIV  FCTR,W    TRCMD                           CFT009
      *                                                                   CFT009
      ** Telex charge                                                     CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W                               CFT009
     C           TXCH      DIV  FCTR,W    TXCHD                           CFT009
      *                                                                   CFT009
      ** Cheque charge                                                    CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W                               CFT009
     C           CQCH      DIV  FCTR,W    CQCHD                           CFT009
      *                                                                   CFT009
      ** Costs abroad                                                     CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W                               CFT009
     C           CSTA      DIV  FCTR,W    CSTAD                           CFT009
      *                                                                   CFT009
      ** Swift priority charge                                            CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W                               CFT009
     C           SPCH      DIV  FCTR,W    SPCHD                           CFT009
      *                                                                   CFT009
      ** Miscellaneous charge                                             CFT009
      *                                                                   CFT009
     C           FCDP      ADD  1         W                               CFT009
     C           MSCH      DIV  FCTR,W    MSCHD                           CFT009
      *                                                                   CFT009
     C                     ENDSR                                          CFT009
      *================================================================   CFT009
     C/COPY WNCPYSRC,FT0345C038
     C/EJECT
     C*
     C* File and Program Error Processing
     C*
     C/COPY FTCPYSRC,SRERRC
     O*EDTRCD: Cpysrc Templates Initialise Program O-spec
     O/COPY WNCPYSRC,FT0345DOPG
**  DESC
Miscellaneous Charge 1                                                    CFT009
Miscellaneous Charge 2                                                    CFT009
Miscellaneous Charge 3                                                    CFT009
Miscellaneous Charge 4                                                    CFT009
Miscellaneous Charge 5                                                    CFT009
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   FCTR - ARRAY OF POWERS OF 10 FOR DAF CONVERSIONS
0001
0010
0100
1000
