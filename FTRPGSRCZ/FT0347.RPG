     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Outgoing payments valid. S1/level 2')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0347 - Validate Outgoing Payments - Screen 1, Level 2      *
     F*                                                               *
     F*  Function:  This program validates the level 2 input for      *
     F*  Outgoing Payments.                                           *
     F*                                                               *
     F*  Called By: FT0345  - Incomimg Payments Maintenence Level 2   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CSW215             Date 06Apr15               *
      *                 CFT120             Date 28Sep12               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK028             Date 25Jan08               *
      *                 BUG15201           Date 30Oct07               *
      *                 250600             Date 07Oct07               *
      *                 BUG14771           Date 12Aug07               *
      *                 BUG14042           Date 24May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 241855             Date 04Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSW203             Date 26May03               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CFT017             Date 08Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 09Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP031             Date 07Feb00               *
      *                 CFT004             DATE 05Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CEU006             DATE 07MAY98               *
     F*                 090943             DATE 09SEP97               *
     F*                 S01408             DATE 01NOV96               *
     F*                 CSW096             DATE 04JUL96               *
     F*                 092396             DATE 24AUG95               *
     F*                 S01408             DATE 20JAN95               *
     F*                 069250             DATE 03MAY94               *
     F*                 S01435             DATE 29SEP93               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CSW215 - SWIFT Changes 2015                                  *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CPK028 - Conversion of Customer Number to Alpha.             *
      *  BUG15201 - Encounter Database Errors (Recompile)             *
      *  250600 - Fix CFT032 and CSW207                               *
      *  BUG14771 - Amended the input function and the message        *
      *             generation for CFT032                             *
      *  BUG14042 - CFT032 errors ; applied fix 13798                 *
      *  CFT032 - Account Line in Field 50X in MT103                  *
      *  241855 - System is not validating clearing codes for field   *
      *           56A, 56D, 57A and 57D even though it is required    *
      *           by SWIFT to be validated.                           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CSW203 - SWIFT 2003 Standards Update                         *
      *  CSW202 - Swift 2002 Standard Update                          *
      *  CFT017 - Multilateral Inter-bank Exchange Fee. (Recompile)   *
      *  CFT009 - Funds Transfer Fees and Charges - phase 1           *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
     F*  CAP031 - FT OPAY API - Recompile for changes to ACNUMA       *
     F*  CFT004 - International Bank Account Number                   *
     F*           Enable IBAN Number in fields: Receiver's Correspon. *
     F*           Account with Bank, and Beneficiary.                 *
     F*  CEU006 - EMU FT Payments and Settlement (recompile only).    *
     F*  090943 - Correct error message for beneficiary field         *
     F*  S01408 - Addition of core hook FT0347CCP2                    *
     F*         - Addition of core hook FT0347CCP1                    *
     F*  CSW096 - SWIFT November 1996 Changes                         *
     F*           Use ME9950 to validate Bank to Bank Information     *
     F*  092396 - Sender to Receiver cannot contain '//' followed     *
     F*           by blanks.                                          *
     F*  S01408 - Addition of core hook FT0347CCPG.                   *
     F*  069250 - Remove dummy OVRDBF command from creation parms.    *
     F*  S01435 - Incoming Message Management                         *
     F*                                                               *
     F*****************************************************************
     F*
     F*  Indicator usage
     F*  ~~~~~~~~~~~~~~~
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*  31    Invalid S.W.I.F.T. Address format
     F*  32    S.W.I.F.T. Address not on file
     F*
     F*  50    Program Initialised
     F*
     F*  90    General Error Indicator
     F*  91    / found
     F*  92    Embedded spaces found
     F*  93    Illegal characters found
     F*  94    Work indicator used in checking illegal characters
     F*
     F*  U7/U8 Error Ocurred
     F*  LR    End program
     F*
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F***ACCNT***IF  E           K        DISK         KINFSR SRFILE UC   CFT014
     F*********** ACCNTAAF                          KIGNORE               CFT014
     F*********** ACCNTACF                          KIGNORE               CFT014
      *
      * RTV : General Ledger Accounts by GL Account Number
      *
     F***ACNUMA**IF  E           K        DISK         KINFSR SRFILE UC   CFT014
     F*********** ACCNTABF                          KRENAMEACNUMABF       CFT014
      *
      * RSQ : General Ledger Accounts by Retail Account Number
      *
     E/COPY FTCPYSRC,SFTSWFTF
     F/COPY WNCPYSRC,FT0347DFPG
      *
      *  /Copy point for File Definition
      *
     F/EJECT
     E                    CPY@    1   1 80
      *
      *  Copyright table
     E                    ALPH   26  26  1                                CFT004
      *Alphabetic array                                                   CFT004
     E                    NUMC   10  10  1                                CFT004
      *Numeric array                                                      CFT004
      *
     E/COPY WNCPYSRC,FT0347DEPG
      *
      *  /Copy point for Arrays
      *
     E/COPY FTCPYSRC,SRERRE
      *
      *  End of Copysource for error processing
      *
     E                    ERCD       38  4               Codes
     E                    O#E        50  3               Return Error codeCSW096
     E/COPY FTCPYSRC,SFTSWFTE
      *
      *  Warning codes array
      *
     E                    WRN@       40  1
      *
      *  Array for validating Bank to Bank
      *
     E                    #ER         6  1
      *
     E/EJECT
      *
      * Constants                                                         CFT004
     I              'Beneficiary      '   C         WBEN                  CFT004
     I              'Acc. with Bank   '   C         WACW                  CFT004
     I              'Receivers Corres.'   C         WRCV                  CFT004
     I              'Intermediary     '   C         WINT                  CFT014
     I              'Third Reimb. Ins.'   C         WTRI                  CFT014
     I              'ACOUNTLINE'          C         CACNT1                                    CFT032
     I              'ACOUNTIBAN'          C         CACNT2                                    CFT032
      * Rename of ACCNT/ACNUMA Profit Centre to avoid overwriting
      *
     I***ACCNTABF                                                         CFT014
     I***********   PRFC                            ACPRFC                CFT014
      *
     I***ACNUMABF                                                         CFT014
     I***********   PRFC                            ACPRFC                CFT014
     I/EJECT
     I/COPY WNCPYSRC,FT0347DIPG
      *
      *  /Copy point for Input specifications
      *
      *
     ICPYR@#      DS
      *
      *  Data structure for compilation  - Copyright insertion
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY FTCPYSRC,SRERRI
      *
      *  End of Program Error Processing source
      *
     IRUNDTA    E DSRUNDAT
      *
      *  Define rundat data area
      *
      *
      *  Data Structures used by access programs
      *
     IDSFDY     E DSDSFDY
     I*
     IDSSDY     E DSDSSDY
     I*
     I***SDNOST**  E DSSDNOSTPD                                           CFT014
      *
     ISDCUST    E DSSDCUSTPD
      *
      *  Calling parameter data structure for AOCUSTR0
      *
     ISDCNST    E DSSDCNSTPD
      *
      *  Calling parameter data structure for ME1400
      *
     IMEBICD    E DSMEBICDPD
      *
      *  Calling parameter data structure for ME1400
      *
     ISCSARD    E DSSCSARDPD                                              CFT004
     I* External data structure for SAR file details                      CFT004
     I*                                                                   CFT004
      *                                                                                       CFT032
      ** Outgoing message                                                                     CFT032
      *                                                                                       CFT032
     IMEOUFM    E DSMEOUFMPD                                                                  CFT032
      *                                                                                       CFT032
      ** Bank Details                                                                         CFT032
      *                                                                                       CFT032
     ISDBANK    E DSSDBANKPD                                                                  CFT032
      *                                                                                       CFT032
      ** Account structure                                                                    CFT032
      *                                                                                       CFT032
     IOACCNT    E DSACCNTAB                   4                                               CFT032
     I              LCD                             OLCD                                      CFT032
     ISDNOST    E DSSDNOSTPD                                                                  CFT032
      /EJECT
      *
     E/COPY FTCPYSRC,SFT0345S5
     E/COPY FTCPYSRC,SFTVALDI
     E/COPY FTCPYSRC,SFT0345F5
     E/COPY FTCPYSRC,SFT0345I5
     I***ACKYDS**    DS                             18                    CFT014
      ***********                                                         CFT014
      ***Data*Structure*for*DB*errors*on*ACCNT*************************   CFT014
      ***********                                                         CFT014
     I***********                             1   60KACNUM                CFT014
     I***********                             1   6 KACNMA                CFT014
     I***********                             7   9 KACCCY                CFT014
     I***********                            10  130KACCD                 CFT014
     I***********                            10  13 KACCDA                CFT014
     I***********                            14  150KACSQ                 CFT014
     I***********                            14  15 KACSQA                CFT014
     I***********                            16  18 KBRCA                 CFT014
      *
     E/COPY FTCPYSRC,SFTADDRI
     ICLSWTK      DS
      *
      *  Redefine SWIFT array as field for SETLL.
      *
     I                                        1  12 SW
      *                                                                                     BUG14771
     I***IMACNT      DS                             18                               BUG14771 250600
     IIMACNT      DS                             24                                           250600
      *                                                                                     BUG14771
      *  Define full account to be passed for FT IMM update                                 BUG14771
      *                                                                                     BUG14771
     I**********                              1   60IMCNUM                           BUG14771 CPK028
     I                                        1   6 IMCNUM                                    CPK028
     I                                        7   9 IMCCY                                   BUG14771
     I**********                             10  130IMACOD                           BUG14771 250600
     I                                       10  190IMACOD                                    250600
     I**********                             14  150IMACSQ                           BUG14771 250600
     I                                       20  210IMACSQ                                    250600
     I**********                             16  18 IMBRCA                           BUG14771 250600
     I                                       22  240IMBRCA                                    250600
      *
     IDSMTR       DS
      *
      *  Define fields for message transalation
      *
     I                                        1 132 #MSDTA
     I                                       15  30 #MPREF
     I                                    P   1   20#MPART
     I                                      133 264 #MSTX1
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
     E/COPY FTCPYSRC,SFTVALCS
      *                                                                   CSW096
      * Input Parameters                                                  CSW096
      *                                                                   CSW096
     I***I#PARM*     DS                            512                                 CSW096 CGL029
     II#PARM      DS                            514                                           CGL029
      * Field to be validated                                             CSW096
     I                                        1   5 I#VFLD                CSW096
      * Pay/Receive Settlement (PAY/REC)                                  CSW096
     I                                        6   8 I#PR                  CSW096
      * Customer/Counterparty Nostro /BIC indentified type                CSW096
      *    C           X              S  X-> C'party Nostro or Customer   CSW096
      * Customer/Counterparty/BIC indentified                             CSW096
     I                                        9   9 I#PRTT                CSW096
     I                                       10  20 I#PRTY                CSW096
      * Pay Currency                                                      CSW096
     I                                       21  23 I#PCCY                CSW096
      * Receive Currency                                                  CSW096
     I                                       24  26 I#RCCY                CSW096
      * Account Line                                                      CSW096
     I                                       27  61 I#ACLN                CSW096
      * Account Line Character 1                                          CSW096
     I                                       27  27 I#ACC1                CSW096
      * Account Line Character 2                                          CSW096
     I                                       28  28 I#ACC2                CSW096
      * Account Line Character 3                                          CSW096
     I                                       29  29 I#ACC3                CSW096
      * Account Line first 4 characters                                   CSW096
     I                                       27  30 I#ACCL                CSW096
      * Account Line Clearing System                                      CSW096
     I                                       29  30 I#ACCS                CSW096
      * Account Line No account data                                      CSW096
     I                                       31  61 I#SPC1                CSW096
      * Message Type                                                      CSW096
     I                                       62  64 I#MTYP                CSW096
      * Intermediary Institution for Bank to Bank validation              CSW096
     I                                       65  65 I#INBT                CSW096
     I                                       66  76 I#INBK                CSW096
      * Account with Institution for Bank to Bank validation              CSW096
     I                                       77  77 I#AWBT                CSW096
     I                                       78  88 I#AWBK                CSW096
      * Beneficiary for Bank to Bank validation                           CSW096
     I                                       89  89 I#BENT                CSW096
     I                                       90 100 I#BENF                CSW096
      * Pay and Receive Settlement Methods                                CSW096
     I                                      101 102 I#RSTM                CSW096
     I                                      103 104 I#PSTM                CSW096
      * Field 53 and 54 Entered                                           CSW096
     I                                      105 105 I#5354                CSW096
      * Midas Module                                                      CSW096
     I                                      106 107 I#MMOD                CSW096
      * Pay and Receive Settlement Accounts                               CSW096
     I**********                            108 125 I#PYAC                CSW096              CGL029
     I**********                            126 143 I#RCAC                CSW096              CGL029
     I                                      108 125 QQPYAC                                    CGL029
     I                                      126 143 QQRCAC                                    CGL029
      * Transaction Type                                                  CSW096
     I                                      144 145 I#TTYP                CSW096
      * Cover Required ?                                                  CSW096
     I                                      146 146 I#COVR                CSW096
      * Bank to Bank Information                                          CSW096
     I                                      257 466 I#BTB                 CSW096
     I                                      257 291 I#BTB1                CSW096
     I                                      292 326 I#BTB2                CSW096
     I                                      327 361 I#BTB3                CSW096
     I                                      362 396 I#BTB4                CSW096
     I                                      397 431 I#BTB5                CSW096
     I                                      432 466 I#BTB6                CSW096
     I                                      467 490 I#PYAC                                    CGL029
     I                                      491 514 I#RCAC                                    CGL029
      *                                                                   CSW096
      * Output Parameters                                                 CSW096
      *                                                                   CSW096
     I***O#PARM*     DS                            512                                 CSW096 CGL029
     IO#PARM      DS                            514                                           CGL029
      * Account Line modified                                             CSW096
     I                                        1  35 O#ACLN                CSW096
      * Bank to Bank Information                                          CSW096
     I                                      257 466 O#BTB                 CSW096
     I                                      257 291 O#BTB1                CSW096
     I                                      292 326 O#BTB2                CSW096
     I                                      327 361 O#BTB3                CSW096
     I                                      362 396 O#BTB4                CSW096
     I                                      397 431 O#BTB5                CSW096
     I                                      432 466 O#BTB6                CSW096
      *                                                                   CSW096
      * Error Parameters                                                  CSW096
      *                                                                   CSW096
     IX#PARM      DS                            256                       CSW096
      * Calling Program                                                   CSW096
     I                                        1  10 X#CPGM                CSW096
      * Error message sent                                                CSW096
     I                                       12  12 X#ERRM                CSW096
      * Warning message sent                                              CSW096
     I                                       13  13 X#WARN                CSW096
      * Error index                                                       CSW096
     I                                       14  180X#INDX                CSW096
      * Message text to prefix error message                              CSW096
     I                                       19  25 X#MSGD                CSW096
     I                                       26  35 X#MSGF                CSW096
      * Fields in error                                                   CSW096
     I                                       36  41 X#FLDS                CSW096
      * Error codes array                                                 CSW096
     I                                       51 200 X#ERCD                CSW096
     I                                       51 200 O#E                   CSW096
     I/COPY WNCPYSRC,FT0347I001
      *                                                                   CSW096
     I/EJECT
      *****************************************************************
      *                 M A I N L I N E
      *****************************************************************
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *  Define entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           W0RTN   7
     C                     PARM           W0ACT   8
     C                     PARM           S5DATA
     C                     PARM           V#DATA
     C                     PARM           F5DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I5DATA
      *                                                                                       CFT032
      ** Parameter List for calling AOOUFMR0                                                  CFT032
      *                                                                                       CFT032
     C           PLOUFM    PLIST                                                              CFT032
     C                     PARM *BLANKS   @RTRN   7                                           CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @NTWRK  6                                           CFT032
     C                     PARM           @MSGTP  3                                           CFT032
     C                     PARM           @MSGTG  5                                           CFT032
     C**********           PARM           BRCA                                       CFT032 BUG14042
     C                     PARM           BRCA4A  4                                         BUG14042
     C**********           PARM           @CNTLC  2                                  CFT032 BUG14042
     C                     PARM           CTRY4A  4                                         BUG14042
     C                     PARM           V#PCCY                                              CFT032
     C                     PARM           @NOSTN  2                                           CFT032
     C                     PARM           @ACTNF 10                                           CFT032
     C           MEOUFM    PARM *BLANKS   DSFDY                                               CFT032
     C/COPY WNCPYSRC,FT0347C019
      *
      *  Set up Primary Reference for database errors
      *
     C                     MOVELS5DATA    W0PREF
      *
      *  Initialise program
      *
     C           *IN50     IFEQ '0'
     C                     EXSR SRINIT
     C                     END
      *
      *  Determine the mode of processing and execute subroutine :-
      *
      *
      *  Action Code : *VALID
      *  --------------------
      *
      *  Called from FT0050 to validate all input fields on the detail
      *  screen. Once verified, control returns to the calling program
      *  where the appropriate error indicators are set on and the
      *  processing continues.
      *
      *
     C           W0ACT     CASEQ'*VALID  'SRPROC
     C                     CAS            SRACT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *  Return to calling program
      *
     C                     RETRN
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRPROC   : Validate All Detail Fields Entered                *
      *             Seton appropriate indicators and set up the array *
      *             of relevant error codes for display.              *
      *                                                               *
      *  CALLED BY: Main processing section                           *
      *                                                               *
      *  CALLS    : SRERR   - report error and close down program     *
      *                                                               *
      *****************************************************************
     CSR         SRPROC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPROC'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0347PROC
      *
      *  Move warning array passed to WRN@ and error indicators
      *
     C                     MOVEAE#WARA    WRN@
     C                     MOVEA*BLANKS   ERCD
     C                     CLEARI5DATA
     C                     Z-ADD0         X       50
     C/COPY WNCPYSRC,FT0347C033
      ***********                                                         CFT014
      ***Validate*Transfer*Commission*Tariff***************************   CFT014
      ***********                                                         CFT014
     C***********          EXSR SRTRCT                                    CFT014
      ***********                                                         CFT014
      ***Validate*Charges*To*The*Debit*Of******************************   CFT014
      ***********                                                         CFT014
     C***********          EXSR SRCDRO                                    CFT014
      *                                                                   CFT014
      ** Validate bank operation code                                     CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     EXSR SRBOCD                                    CFT014
      *                                                                   CFT014
      ** Validate transaction type code                                   CFT014
      *                                                                   CFT014
     C                     EXSR SRTTCD                                    CFT014
     C                     ENDIF                                          CFT014
      *
      *  Validate Receiver's Correspondent
      *
     C                     EXSR SRRCO
      *                                                                   CFT014
      ** Validate third reimbursement institution                         CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     EXSR SRTRIB                                    CFT014
     C                     ENDIF                                          CFT014
      *
      *  Validate Account with Institution
      *
     C                     EXSR SRACBK
      *                                                                   CFT014
      ** Validate intermediary bank                                       CFT014
      *                                                                   CFT014
     C                     EXSR SRINBK                                    CFT014
      *
      *  Validate Beneficiary
      *
     C                     EXSR SRBNC
      ***********                                                         CFT014
      ***Validate*Details*Of*Payment***********************************   CFT014
      ***********                                                         CFT014
     C***********          EXSR SRDPAY                                    CFT014
      ***********                                                         CFT014
      ***Validate*Bank*To*Bank*Information*****************************   CFT014
      ***********                                                         CFT014
     C***********          EXSR SRBTOB                                    CFT014
     C/COPY WNCPYSRC,FT0347C034
      *                                                                   CFT014
      ** Cross validations                                                CFT014
      *                                                                   CFT014
     C           E#NOUP    IFEQ *BLANKS
     C                     EXSR SRXVAL
     C/COPY WNCPYSRC,FT0347C028
     C                     END
      *
      *  End Of Validation - set parameters for return
      *
      *
      *  Move waring array back and errors
      *
     C                     MOVEAWRN@      E#WARA
     C                     MOVEAERCD      C#ERCD
      *
      *  Unwind subroutine stack name
      *
     C           EXPROC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************   CFT014
      /TITLE SR/SRBOCD                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRBOCD - Validate Bank Operation Code                        *   CFT014
      *                                                               *   CFT014
      *  Called By: SRPROC subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FTSNMS    - Send message to program message queue.           *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRBOCD    BEGSR                           *** SRBOCD *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'SRBOCD'  @STK,Q                          CFT014
      *                                                                   CFT014
      ** If not blank, bank operation code entered must be a valid        CFT014
      ** code from the following: 'CRED', 'SPAY', 'SSTD', or 'SPRI'       CFT014
      *                                                                   CFT014
     C           S5BNCD    IFNE *BLANK                                    CFT014
     C           S5BNCD    ANDNE'CRED'                                    CFT014
     C           S5BNCD    ANDNE'SPAY'                                    CFT014
     C           S5BNCD    ANDNE'SSTD'                                    CFT014
     C           S5BNCD    ANDNE'SPRI'                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5BNCD    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3200' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5BNCD                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If not entered, default to 'CRED'                                CFT014
      *                                                                   CFT014
     C           S5BNCD    IFEQ *BLANK                                    CFT014
     C                     MOVEL'CRED'    S5BNCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
      /EJECT                                                              CFT014
      *****************************************************************   CFT014
      /TITLE SR/SRTTCD                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRTTCD - Validate Transaction Type Code                      *   CFT014
      *                                                               *   CFT014
      *  Called By: SRPROC subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FTSNMS    - Send message to program message queue.           *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRTTCD    BEGSR                           *** SRTTCD *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'SRTTCD'  @STK,Q                          CFT014
      *                                                                   CFT014
      ** If entered, transaction type code must be a 3 alphabetic         CFT014
      ** character, otherwise an error message will be displayed.         CFT014
      *                                                                   CFT014
     C           S5TTCD    IFNE *BLANK                                    CFT014
     C                     Z-ADD1         C       10                      CFT014
     C                     MOVE *BLANK    WTSTCH  1                       CFT014
     C           C         DOUGT3                                         CFT014
     C           *IN94     OREQ *OFF                                      CFT014
     C           1         SUBSTS5TTCD:C  WTSTCH                          CFT014
     C           WTSTCH    LOKUPALPH                     94               CFT014
      *                                                                                       CSW202
      ** For SWIFT 2002, if not uppercase alphanumeric then issue                             CSW202
      ** error message.                                                                       CSW202
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           *IN94     ANDEQ*OFF                                                          CSW202
     C           WTSTCH    LOKUPNUMC                     94                                   CSW202
     C                     ENDIF                                                              CSW202
      *                                                                   CFT014
      ** Transaction type code entered contains value that is not         CFT014
      ** an alphabet, issue error message.                                CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *OFF                                      CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TTCD    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C                     MOVEL'RFV0901' FTMSID                                              CSW202
     C                     ELSE                                                               CSW202
     C                     MOVEL'FTM3201' FTMSID                          CFT014
     C                     ENDIF                                                              CSW202
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TTCD                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Get next character of the entered value.                         CFT014
      *                                                                   CFT014
     C                     ADD  1         C                               CFT014
     C                     ENDDO                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
      /EJECT                                                              CFT014
      *****************************************************************   CFT014
      /TITLE SR/SRTRIB                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRTRIB - Validate Third Reimbursement Institution            *   CFT014
      *                                                               *   CFT014
      *  Called By: SRPROC subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FTSNMS    - Send message to program message queue.           *   CFT014
      *  AOCUSTR0  - Access Object to get customer details.           *   CFT014
      *  SWIFT     - Validate SWIFT Address.                          *   CFT014
      *  ADCHK     - Validate Address fields.                         *   CFT014
      *  AOIBANR3  - IBAN format.                                     *   CFT014
      *  AOIBANR5  - Validate external IBAN.                          *   CFT014
      *  SRERR     - Error subroutine.                                *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRTRIB    BEGSR                           *** SRTRIB *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'SRTRIB'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANK    F5TRIT                          CFT014
      *                                                                   CFT014
      ** Third reimbursement institution not entered.                     CFT014
      *                                                                   CFT014
     C           S5TRIB    IFEQ *BLANK                                    CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** '?' not available                                                CFT014
      *                                                                   CFT014
     C           '?'       SCAN S5TRI1    Y#             90               CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TRI1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3204' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,1                          CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Sender's and Receiver's correspondent cannot be both blank if    CFT014
      ** third reimbursement institution is entered.                      CFT014
      *                                                                   CFT014
     C           S5TRIB    IFNE *BLANK                                    CFT014
     C           V#SNCO    IFEQ *ZERO                                     CFT014
     C           S5RCO     OREQ *BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TRIB    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3203' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TRIT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT014
     C                     MOVELS5TRIB    ADDRSS                          CFT014
      *                                                                   CFT014
      ** If first ten characters used then try to find via SDCUSTPD       CFT014
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXCS    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADXCS2    ANDEQ*BLANKS                                   CFT014
     C           ADCHK2    ANDNE*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 10 characters should be key for SDCUST                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    @CNUM                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    @CNUM                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Check customer's file                                            CFT014
      *                                                                   CFT014
     C                     CALL 'AOCUSTR0'             9090               CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM           @CNUM                           CFT014
     C                     PARM *BLANKS   @KYST                           CFT014
     C           SDCUST    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVEL'AOCUSTR0'W0FILE                          CFT014
     C                     MOVEL@CNUM     W0KEY                           CFT014
     C                     Z-ADD8         W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           @RTCD     IFEQ *BLANKS                                   CFT014
      *                                                                   CFT014
      ** Overwrite shortname                                              CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL*BLANKS   S5TRI1                          CFT014
     C                     MOVELBBCUST    S5TRI1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   S5TRI2                          CFT014
     C                     MOVELBBCUST    S5TRI2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Set third reimbursement type to 'C' customer.                    CFT014
      *                                                                   CFT014
     C                     MOVEL'C'       F5TRIT                          CFT014
      *                                                                   CFT014
      ** Valid information exit                                           CFT014
      *                                                                   CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Check SWIFT address                                              CFT014
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXSW    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADEXS2    ANDEQ*BLANKS                                   CFT014
     C           ADCHK2    ANDNE*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 11 characters should be key for CLSWT.                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    CLSWTK                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    CLSWTK                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     EXSR SWIFT                                     CFT014
      *                                                                   CFT014
     C           ##CSID    IFEQ 'Y'                                       CFT014
     C           *IN31     IFEQ *ON                                       CFT014
     C/COPY WNCPYSRC,FT0347C039
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELCLSWTK    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3206' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'Y'       I5TRI2                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,1                          CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL'S'       F5TRIT                          CFT014
      *                                                                   CFT014
      ** There is not SWIFT address record found.                         CFT014
      *                                                                   CFT014
     C           *IN32     IFEQ *ON                                       CFT014
     C           *IN31     ANDEQ*OFF                                      CFT014
     C/COPY WNCPYSRC,FT0347C040
      *                                                                   CFT014
      ** First 11 characters should be key for CLSWT.                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'Y'       I5TRI2                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVEL'Y'       E#WARN                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELCLSWTK    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3207' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
      *                                                                   CFT014
     C           WRN@,1    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT014
     C                     MOVEA'Y'       WRN@,1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVEA' '       WRN@,1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Exit as validation complete for S.W.I.F.T.                       CFT014
      *                                                                   CFT014
     C                     GOTO EXTRIB                                    CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Invalid customer number or shortname.                            CFT014
     C/COPY WNCPYSRC,FT0347C041
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXCS    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADXCS2    ANDEQ*BLANKS                                   CFT014
     C           ADCHK2    ANDNE*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 10 characters should be key for SDCUST                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    FTMSDT                          CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    FTMSDT                          CFT014
     C                     MOVEL'Y'       I5TRI2                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3205' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     GOTO EXTRIB                                    CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0347C042
      *                                                                   CFT014
      ** Validate as an address                                           CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       ADLINE                          CFT014
     C                     MOVEL'FTM3208' ADFLDM                          CFT014
     C                     MOVEL'FTUSRMSG'ADFLDF                          CFT014
     C                     EXSR ADCHK                                     CFT014
      *                                                                   CFT014
      ** Depending on the indicators, highlight the field in error        CFT014
      *                                                                   CFT014
     C           *IN91     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TRI1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3209' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN92     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TRI1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3210' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TRIT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN93     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           AD#1      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5TRI1                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#2      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5TRI2                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#3      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5TRI3                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#4      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5TRI4                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#5      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5TRI5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If no errors then customer is an address                         CFT014
      *                                                                   CFT014
     C           I5TRIT    IFEQ *BLANKS                                   CFT014
     C                     MOVEL'A'       F5TRIT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           EXTRIB    TAG                                            CFT014
      *                                                                   CFT014
      ** Entry must have a SWIFT ID if the bank operation code is         CFT014
      ** 'SSTD' or 'SPRI' or 'SPAY'                                       CFT014
      *                                                                   CFT014
     C           S5TRIB    IFNE *BLANKS                                   CFT014
     C           S5BNCD    IFEQ 'SPRI'                                    CFT014
     C           S5BNCD    OREQ 'SSTD'                                    CFT014
     C           S5BNCD    OREQ 'SPAY'                                    CFT014
      *                                                                   CFT014
     C           F5TRIT    IFNE 'S'                                       CFT014
     C           F5TRIT    ANDNE'C'                                       CFT014
     C           F5TRIT    OREQ 'C'                                       CFT014
     C           BBCSID    ANDEQ*BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5TRIB    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3211' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5TRIT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Check if line one contain an IBAN                                CFT014
      *                                                                   CFT014
     C           CFT004    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** If the field start with '/aann' or 'aann'                        CFT014
      ** validate as an IBAN (INTERNATIONAL BANK ACCOUNT NUMBER)          CFT014
      ** having first formatted field removing blanks and IBAN prefix     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFEQ '/'                                       CFT014
     C           34        SUBSTADCHK1:2  PIBAN                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK1    PIBAN                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOIBANR3'                                CFT014
     C                     PARM           @RTCD                           CFT014
     C                     PARM           PIBAN                           CFT014
     C                     PARM           POWITH                          CFT014
     C           P@IBAN    PARM           PONOBL                          CFT014
      *                                                                   CFT014
     C           1         SUBSTP@IBAN:1  IBCTY1  1                       CFT014
     C           1         SUBSTP@IBAN:2  IBCTY2  1                       CFT014
     C           1         SUBSTP@IBAN:3  IBCHK1  1                       CFT014
     C           1         SUBSTP@IBAN:4  IBCHK2  1                       CFT014
      *                                                                   CFT014
     C           IBCTY1    LOKUPALPH                     94               CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCTY2    LOKUPALPH                     94               CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCHK1    LOKUPNUMC                     94               CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCHK2    LOKUPNUMC                     94               CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C                     CALL 'AOIBANR5'             90                 CFT014
     C                     PARM *BLANKS   @RTCD   7                       CFT014
     C                     PARM           P@IBAN 34                       CFT014
     C           *IN90     IFEQ *OFF                                      CFT014
     C           @RTCD     ANDEQ*BLANKS                                   CFT014
     C           '/'       CAT  P@IBAN    S5TRI1                          CFT014
     C                     MOVEA' '       WRN@,2                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE @RTCD     WRTCD   1                       CFT014
     C                     MOVELWTRI      FTMSDT                          CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Invalid ISO Country Code                                         CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '1'                                       CFT014
     C                     MOVEL'FTM2400' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid BBAN Length                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '2'                                       CFT014
     C                     MOVEL'FTM2401' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid Character                                                CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '3'                                       CFT014
     C                     MOVEL'FTM2402' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid IBAN Length                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '4'                                       CFT014
     C                     MOVEL'FTM2403' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid Check Digit                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '5'                                       CFT014
     C                     MOVEL'FTM2404' FTMSID                          CFT014
     C                     OTHER                                          CFT014
     C                     MOVEL'FTM2405' FTMSID                          CFT014
     C                     ENDSL                                          CFT014
     C                     MOVE 'Y'       I5TRI1                          CFT014
     C                     MOVEL'Y'       E#WARN                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     EXSR FTSNMS                                    CFT014
      *                                                                   CFT014
     C           WRN@,2    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT014
     C                     MOVEA'Y'       WRN@,2                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
     C/EJECT                                                              CFT014
      *****************************************************************   CFT014
      /TITLE SR/SRINBK                                                    CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRINBK - Validate Intermediary                               *   CFT014
      *                                                               *   CFT014
      *  Called By: SRPROC subroutine                                 *   CFT014
      *                                                               *   CFT014
      *  Calls:                                                       *   CFT014
      *  FTSNMS    - Send message to program message queue.           *   CFT014
      *  AOCUSTR0  - Access Object to get customer details.           *   CFT014
      *  SWIFT     - Validate SWIFT Address.                          *   CFT014
      *  ADCHK     - Validate Address fields.                         *   CFT014
      *  AOIBANR3  - IBAN format.                                     *   CFT014
      *  AOIBANR5  - Validate external IBAN.                          *   CFT014
      *  SRERR     - Error subroutine.                                *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
      *                                                                   CFT014
     C           SRINBK    BEGSR                           *** SRINBK *** CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRINBK'  @STK,Q                          CFT014
      *                                                                   CFT009
     C           F5ACBT    IFNE *BLANKS                                   CFT009
     C                     MOVELF5ACBT    V#ACBX                          CFT009
     C                     MOVELS5ACB1    V#ACBY                          CFT009
     C                     MOVELS5ACB2    V#ACBZ                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE *BLANKS   V#ACBX                          CFT009
     C                     MOVE *BLANKS   V#ACBY                          CFT009
     C                     MOVE *BLANKS   V#ACBZ                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Intermediary Bank is optional                                    CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   F5INBT                          CFT014
      *                                                                   CFT014
     C           S5IBK     IFEQ *BLANKS                                   CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT014
     C                     GOTO EXINBK                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Entry not allowed if no Account with Institution                 CFT014
      *                                                                   CFT014
     C           F5ACBT    IFEQ *BLANKS                                   CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVEL*BLANKS   FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2182' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INBK                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     GOTO EXINBK                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** ? not allowed                                                    CFT014
      *                                                                   CFT014
     C           '?'       SCAN S5IBK1    Y#             90               CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVEL*BLANKS   FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2183' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     GOTO EXINBK                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Move in data for address validation                              CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ADDRSS                          CFT014
     C                     MOVELS5IBK     ADDRSS                          CFT014
      *                                                                   CFT014
      ** If first ten characters used then try to find via SDCUSTPD       CFT014
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXCS    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADXCS2    ANDEQ*BLANKS                                   CFT014
     C           ADCHK2    ANDNE*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 10 characters should be key for SDCUST                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    @CNUM                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    @CNUM                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Call to access pgm for Customer details                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOCUSTR0'             9090               CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM           @CNUM                           CFT014
     C                     PARM *BLANKS   @KYST                           CFT014
     C           SDCUST    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *ON                                       CFT014
     C                     MOVEL'AOCUSTR0'W0FILE                          CFT014
     C                     MOVEL@CNUM     W0KEY                           CFT014
     C                     Z-ADD10        W0ERNB                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           @RTCD     IFEQ *BLANKS                                   CFT014
      *                                                                   CFT014
      ** Overwrite shortname                                              CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL*BLANKS   S5IBK1                          CFT014
     C                     MOVELBBCUST    S5IBK1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   S5IBK2                          CFT014
     C                     MOVELBBCUST    S5IBK2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL'C'       F5INBT                          CFT014
      *                                                                   CFT014
      ** Valid information exit                                           CFT014
      *                                                                   CFT014
     C                     GOTO EXINBK                                    CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If only 1st line entered then SWIFT Address assumed              CFT014
      ** Or first is '/' and second is SWIFT Address.                     CFT014
      ** If field does not begin with '/' and is not longer than 11       CFT014
      ** characters, validate as a S.W.I.F.T. Address.                    CFT014
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXSW    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADEXS2    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 11 characters should be key for CLSWT.                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    CLSWTK                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    CLSWTK                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     EXSR SWIFT                                     CFT014
      *                                                                   CFT014
     C           ##CSID    IFEQ 'Y'                                       CFT014
     C           *IN31     IFEQ '1'                                       CFT014
     C/COPY WNCPYSRC,FT0347C043
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELCLSWTK    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2184' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
      *                                                                   CFT014
      ** Highlight correct field                                          CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'Y'       I5INB2                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     GOTO EXINBK                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL'S'       F5INBT                          CFT014
      *                                                                   CFT014
      ** No SWIFT address record.                                         CFT014
      *                                                                   CFT014
     C           *IN32     IFEQ '1'                                       CFT014
     C           *IN31     ANDEQ'0'                                       CFT014
     C/COPY WNCPYSRC,FT0347C044
      *                                                                   CFT014
      ** If text changed then warning needs to be changed                 CFT014
      *                                                                   CFT014
     C           CLSWTK    IFNE V#INB1                                    CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     MOVELCLSWTK    V#INB1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Highlight correct field                                          CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL'Y'       I5INB2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       E#WARN                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELCLSWTK    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2185' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
      *                                                                   CFT014
     C           WRN@,3    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT014
     C                     MOVEA'Y'       WRN@,3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Exit as validation complete for S.W.I.F.T.                       CFT014
      *                                                                   CFT014
     C                     GOTO EXINBK                                    CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
      *                                                                   CFT014
      ** Invalid customer number or shortname.                            CFT014
     C/COPY WNCPYSRC,FT0347C045
      *                                                                   CFT014
     C           ADCH26    IFEQ *BLANKS                                   CFT014
     C           ADEXCS    ANDEQ*BLANKS                                   CFT014
     C           ADSLSH    ANDNE'/'                                       CFT014
     C           ADCH36    OREQ *BLANKS                                   CFT014
     C           ADXCS2    ANDEQ*BLANKS                                   CFT014
     C           ADCHK2    ANDNE*BLANKS                                   CFT014
     C           ADSLSH    ANDEQ'/'                                       CFT014
     C           ADSLS2    ANDNE'/'                                       CFT014
      *                                                                   CFT014
      ** First 10 characters should be key for SDCUST                     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVELADCHK1    FTMSDT                          CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK2    FTMSDT                          CFT014
     C                     MOVEL'Y'       I5INB2                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2186' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     MOVEA' '       WRN@,3                          CFT014
     C                     GOTO EXINBK                                    CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0347C046
      *                                                                   CFT014
      ** Validate as an address                                           CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       ADLINE  1                       CFT014
     C                     MOVEL'FTM2319' ADFLDM                          CFT014
     C                     MOVEL'FTUSRMSG'ADFLDF                          CFT014
     C                     EXSR ADCHK                                     CFT014
      *                                                                   CFT014
      ** Bilateral agreement exists and account line is a clearing code   CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           V#M103    ANDEQ'Y'                                       CFT014
     C           ADNOSN    ANDEQ'//'                                      CFT014
     C           ADCH26    ANDEQ*BLANK                                    CFT014
     C                     MOVE 'Y'       WCL103  1                       CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       WCL103                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Depending on the indicators, highlight the field in error        CFT014
      *                                                                   CFT014
     C           *IN91     IFEQ *ON                                       CFT014
     C           CFT014    ANDEQ'N'                                       CFT014
     C           *IN91     OREQ *ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C           WCL103    ANDEQ'N'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELADCHK1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2187' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN92     IFEQ '1'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELADCHK1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM2188' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INBK                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Illegal Characters found                                         CFT014
      *                                                                   CFT014
     C           *IN93     IFEQ *ON                                       CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           AD#1      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#2      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5INB2                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#3      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5INB3                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#4      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5INB4                          CFT014
     C                     ENDIF                                          CFT014
     C           AD#5      IFEQ 'Y'                                       CFT014
     C                     MOVEL'Y'       I5INB5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I5INBK    IFEQ *BLANKS                                   CFT014
     C                     MOVEL'A'       F5INBT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           EXINBK    TAG                                            CFT014
      *                                                                   CFT014
      ** Entry not allowed if Bank Operation Code is 'SPRI'               CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           S5BNCD    IFEQ 'SPRI'                                    CFT014
     C           S5IBK     ANDNE*BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5IBK     FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3212' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** No SWIFT BIC for customer with branch operation code 'SSTD'      CFT014
      ** or 'SPAY'                                                        CFT014
      *                                                                   CFT014
     C           S5BNCD    IFEQ 'SSTD'                                    CFT014
     C           S5BNCD    OREQ 'SPAY'                                    CFT014
      *                                                                   CFT014
     C           F5INBT    IFEQ 'C'                                       CFT014
     C           BBCSID    ANDEQ*BLANK                                    CFT014
     C           WCL103    IFNE 'Y'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5IBK1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3213' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INBK                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Entry type is not a customer or SWIFT, error                     CFT014
      *                                                                   CFT014
     C           F5INBT    IFNE 'C'                                       CFT014
     C           F5INBT    ANDNE'S'                                       CFT014
     C           WCL103    ANDEQ'N'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5IBK1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3214' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Clearing code exists                                             CFT014
      *                                                                   CFT014
     C           ADNOSN    IFEQ '//'                                      CFT014
     C********** ADCH26    ANDEQ*BLANK                                                 CFT014 241855
     C                     CLEARI#PARM                                    CFT014
     C                     CLEARO#PARM                                    CFT014
     C                     CLEARX#PARM                                    CFT014
     C                     MOVEL'INBK'    I#VFLD                          CFT014
     C                     MOVEL'PAY'     I#PR                            CFT014
     C           WCL103    IFEQ 'N'                                       CFT014
     C           CSW203    IFEQ 'N'                                                           CSW203
     C                     MOVEL'100'     I#MTYP                          CFT014
     C                     ELSE                                                               CSW203
     C                     MOVEL'103'     I#MTYP                                              CSW203
     C                     ENDIF                                                              CSW203
     C                     ELSE                                           CFT014
     C           CSW203    IFEQ 'N'                                                           CSW203
     C                     MOVEL'100'     I#MTYP                          CFT014
     C                     ELSE                                                               CSW203
     C                     MOVEL'103'     I#MTYP                                              CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                          CFT014
     C           F5INBT    IFEQ 'C'                                       CFT014
     C                     MOVEL'C'       I#PRTT                          CFT014
     C                     MOVEL@CNUM     I#PRTY                          CFT014
     C                     ENDIF                                          CFT014
     C           F5INBT    IFEQ 'S'                                       CFT014
     C                     MOVEL'S'       I#PRTT                          CFT014
     C                     MOVELCLSWTK    I#PRTY                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE *BLANK    I#PRTT                          CFT014
     C                     MOVE *BLANK    I#PRTY                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVELV#PCCY    I#PCCY                          CFT014
     C                     MOVELV#SMCY    I#RCCY                          CFT014
     C                     MOVELS5IBK1    I#ACLN                          CFT014
      *                                                                   CFT014
     C                     MOVELE#CPGM    X#CPGM                          CFT014
     C                     MOVEL'MEC0016' X#MSGD                          CFT014
     C                     MOVEL'MEMSG'   X#MSGF                          CFT014
      *                                                                   CFT014
      ** Validate account line                                            CFT014
      *                                                                   CFT014
     C                     CALL 'ME9940'                                  CFT014
     C                     PARM           W0RTN                           CFT014
     C                     PARM           I#PARM                          CFT014
     C                     PARM           O#PARM                          CFT014
     C                     PARM           X#PARM                          CFT014
     C                     PARM *BLANK    Z#PARM256                       CFT014
      *                                                                   CFT014
      ** On return if errors copy into error array                        CFT014
      *                                                                   CFT014
     C           X#ERRM    IFNE *BLANKS                                   CFT014
     C                     MOVE 'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Check if line one contain an IBAN                                CFT014
      *                                                                   CFT014
     C           CFT004    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** If the field start with '/aann' or 'aann'                        CFT014
      ** validate as an IBAN (INTERNATIONAL BANK ACCOUNT NUMBER)          CFT014
      ** having first formatted field removing blanks and IBAN prefix     CFT014
      *                                                                   CFT014
     C           ADSLSH    IFEQ '/'                                       CFT014
     C           34        SUBSTADCHK1:2  PIBAN                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELADCHK1    PIBAN                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOIBANR3'                                CFT014
     C                     PARM           @RTCD                           CFT014
     C                     PARM           PIBAN                           CFT014
     C                     PARM           POWITH                          CFT014
     C           P@IBAN    PARM           PONOBL                          CFT014
      *                                                                   CFT014
     C           1         SUBSTP@IBAN:1  IBCTY1                          CFT014
     C           1         SUBSTP@IBAN:2  IBCTY2                          CFT014
     C           1         SUBSTP@IBAN:3  IBCHK1                          CFT014
     C           1         SUBSTP@IBAN:4  IBCHK2                          CFT014
      *                                                                   CFT014
     C           IBCTY1    LOKUPALPH                     94               CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCTY2    LOKUPALPH                     94               CFT014
     C                     ENDIF                                          CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCHK1    LOKUPNUMC                     94               CFT014
     C                     ENDIF                                          CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C           IBCHK2    LOKUPNUMC                     94               CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN94     IFEQ *ON                                       CFT014
     C                     CALL 'AOIBANR5'             90                 CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM           P@IBAN                          CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ *OFF                                      CFT014
     C           @RTCD     ANDEQ*BLANKS                                   CFT014
     C           '/'       CAT  P@IBAN    S5IBK1                          CFT014
     C                     MOVEA' '       WRN@,4                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE @RTCD     WRTCD   1                       CFT014
     C                     MOVELWINT      FTMSDT                          CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** Invalid ISO Country Code                                         CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '1'                                       CFT014
     C                     MOVEL'FTM2400' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid BBAN Length                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '2'                                       CFT014
     C                     MOVEL'FTM2401' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid Character                                                CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '3'                                       CFT014
     C                     MOVEL'FTM2402' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid IBAN Length                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '4'                                       CFT014
     C                     MOVEL'FTM2403' FTMSID                          CFT014
      *                                                                   CFT014
      ** Invalid Check Digit                                              CFT014
      *                                                                   CFT014
     C           WRTCD     WHEQ '5'                                       CFT014
     C                     MOVEL'FTM2404' FTMSID                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVEL'FTM2405' FTMSID                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C                     MOVE 'Y'       I5INB1                          CFT014
     C                     MOVEL'Y'       E#WARN                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     EXSR FTSNMS                                    CFT014
      *                                                                   CFT014
     C           WRN@,4    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT014
     C                     MOVEA'Y'       WRN@,4                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           F5INBT    IFNE *BLANKS                                   CFT009
     C                     MOVELF5INBT    V#INBX                          CFT009
     C                     MOVELS5IBK1    V#INBY                          CFT009
     C                     MOVELS5IBK2    V#INBZ                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE *BLANKS   V#INBX                          CFT009
     C                     MOVE *BLANKS   V#INBY                          CFT009
     C                     MOVE *BLANKS   V#INBZ                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q       50                      CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
     C/EJECT                                                              CFT014
      *                                                                   CFT014
      ** This subroutine has been moved to program FT0348                 CFT014
      *                                                                   CFT014
      *****************************************************************
      ***********                                                     *   CFT014
      ***SRTRCT***:*Validate*Transfer*Commission*Tariff****************   CFT014
      ***********                                                     *   CFT014
      ***CALLED*BY:*SRPROC*********************************************   CFT014
      ***********                                                     *   CFT014
      ***CALLS****:****************************************************   CFT014
      ***********                                                     *   CFT014
      *****************************************************************   CFT014
     C***SR******   SRTRCT    BEGSR                                       CFT014
      ***********                                                         CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********          ADD  1         Q                               CFT014
     C***********          MOVEL'SRTRCT'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***/COPY*Statement***********************************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347TRCT                                        CFT014
      ***********                                                         CFT014
      ***Tariff*is*optional*but*if*entered*must*be*1/2/3/4/5.**********   CFT014
      ***********                                                         CFT014
     C***********S5TRCT    IFNE '1'                                       CFT014
     C***********S5TRCT    ANDNE'2'                                       CFT014
     C***********S5TRCT    ANDNE'3'                                       CFT014
     C***********S5TRCT    ANDNE'4'                                       CFT014
     C***********S5TRCT    ANDNE'5'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5TRCT    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2055' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5TRCT                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXTRCT    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q       50                      CFT014
      ***********                                                         CFT014
     C***SR******             ENDSR                                       CFT014
      ***********                                                         CFT014
     C***/EJECT**                                                         CFT014
      *                                                                   CFT014
      ** This subroutine has been moved to program FT0349 (New Charge     CFT014
      ** and Commission Screen)                                           CFT014
      *                                                                   CFT014
      *****************************************************************
      ***********                                                     *   CFT014
      ***SRCDRO***:*Validate*Charges*To*The*Debit*Of*and*Debit*********   CFT014
      **************Customer*Reference*********************************   CFT014
      ***********                                                     *   CFT014
      ***CALLED*BY:*SRPROC*-*Control*Process*of*Validation*************   CFT014
      ***********                                                     *   CFT014
      ***CALLS****:********-*******************************************   CFT014
      ***********                                                     *   CFT014
      *****************************************************************   CFT014
     C***SR******   SRCDRO    BEGSR                                       CFT014
      ***********                                                         CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********          ADD  1         Q       50                      CFT014
     C***********          MOVEL'SRCDRO'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***/COPY*Statement***********************************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347CDRO                                        CFT014
      ***********                                                         CFT014
     C***********          Z-ADD0         F5CDRO                          CFT014
     C***********          MOVEL*BLANKS   F5CDRT                          CFT014
      ***********                                                         CFT014
      ***Charges*To*The*Debit*of*A/C*is*optional.**********************   CFT014
      ***3*formats*acceptable*-*Nostro,*Retail*A/C,*A/C*No.************   CFT014
      ***********                                                         CFT014
      ***If*blank*and*branch*entered*error*****************************   CFT014
      ***********                                                         CFT014
     C***********S5CDRO    IFEQ *BLANKS                                   CFT014
     C***********S5CDBR    ANDNE*BLANKS                                   CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2056' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Field*is*optional,*exit*if*blank******************************   CFT014
      ***********                                                         CFT014
     C***********S5CDRO    IFEQ *BLANKS                                   CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***?*not*allowed*************************************************   CFT014
      ***********                                                         CFT014
     C***********'?'       SCAN S5CDRO    Y#             90               CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2202' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Determine*the*number*of*digits*in*the*field*******************   CFT014
      ***********                                                         CFT014
      ***Check*first*two*characters*are*numeric*and*rest*is*blank******   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   I#FLD                           CFT014
     C***********          MOVELS5CDRO    I#FLD  35                       CFT014
     C***********DIGITS    CHECKI#FLD     Y#      30     90               CFT014
     C***/COPY*WNCPYSRC,FT0347C030                                        CFT014
      ***********                                                         CFT014
      ***2,*10*and*12*digits*allowed***********************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********Y#        ANDEQ3                                         CFT014
     C************IN90     OREQ '1'                                       CFT014
     C***********Y#        ANDEQ11                                        CFT014
     C************IN90     OREQ '1'                                       CFT014
     C***********Y#        ANDEQ13                                        CFT014
     C***********S5CDBR    ANDNE*BLANKS                                   CFT014
     C***********WUMBIN    ANDEQ'Y'                                       CFT014
     C************IN90     OREQ '1'                                       CFT014
     C***********Y#        ANDEQ13                                        CFT014
     C***********WUMBIN    ANDNE'Y'                                       CFT014
     C***********          MOVEL'0'       *IN90                           CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Field*is*invalid*format***************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2057' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***If*10*digits*and*Retail*accounts*not*used*error***************   CFT014
      ***********                                                         CFT014
     C***********V#RANR    IFNE 'Y'                                       CFT014
     C***********Y#        ANDEQ11                                        CFT014
     C***********S5CDBR    ANDEQ*BLANKS                                   CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2058' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Check*if*a*2*digit*Nostro*code*has*been*entered*-*based*on****   CFT014
      ***no.*of*blanks*found*in*field**********************************   CFT014
      ***********                                                         CFT014
     C***********Y#        IFEQ 3                                         CFT014
     C***********S5CDBR    ANDEQ*BLANKS                                   CFT014
      ***********                                                         CFT014
      ***Validate*Nostro*Code******************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVELS5CDRO    TNOSN   2                       CFT014
      ***********                                                         CFT014
     C***********          CALL 'AONOSTR0'                                CFT014
     C***********          PARM *BLANKS   @RTCD   7                       CFT014
     C***********          PARM '*KEY   ' @OPTN   7                       CFT014
     C***********          PARM *BLANKS   @CUST   6                       CFT014
     C***********          PARM V#BCCY    @CYCD   3                       CFT014
     C***********          PARM *BLANKS   @ACCN   4                       CFT014
     C***********          PARM *BLANKS   @ACSN   2                       CFT014
     C***********          PARM TNOSN     @NONB   2                       CFT014
     C***********          PARM *BLANKS   @BRCD   3                       CFT014
     C***********          PARM *BLANKS   @CSSN  10                       CFT014
     C***********          PARM *BLANKS   @PNOI   1                       CFT014
     C***********SDNOST    PARM SDNOST    DSFDY                           CFT014
      ***********                                                         CFT014
      ***If*error*on*call**********************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'AONOSTR0'W0FILE           ***************CFT014
     C***********          MOVEL'*CALL'   W0KEY            * DB ERROR 01 *CFT014
     C***********          Z-ADD1         W0ERNB           ***************CFT014
     C***********          MOVEL'MEM5003' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***If*not*found*error********************************************   CFT014
      ***********                                                         CFT014
     C***********@RTCD     IFNE *BLANKS                                   CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2059' FTMSID                          CFT014
     C***/COPY*WNCPYSRC,FT0347C014                                        CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Set*up*ACCNTAB*fields******************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVE A7ACCD    ACOD                            CFT014
     C***********          MOVE A7ACSN    ACSQ                            CFT014
     C***********          MOVE A7CUST    CNUM                            CFT014
     C***********          MOVE A7CYCD    CCY                             CFT014
     C***********          MOVE A7BRCD    BRCA                            CFT014
      ***********                                                         CFT014
      ***Access*Full*Account*Details*for*later*validation**************   CFT014
      ***********                                                         CFT014
     C***********          MOVELA7CYCD    KACCCY                          CFT014
     C***********          Z-ADDCNUM      KACNUM                          CFT014
     C***********          Z-ADDACOD      KACCD                           CFT014
     C***********          Z-ADDACSQ      KACSQ                           CFT014
     C***********          MOVE BRCA      KBRCA                           CFT014
      ***********                                                         CFT014
     C***********TACKEY    CHAINACCNTABF             90                   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********RECI      ORNE 'D'                                       CFT014
     C***********          MOVE V#BCCY    KACCCY                          CFT014
     C***********          MOVEL'ACCNT'   W0FILE           ***************CFT014
     C***********          MOVELACKYDS    W0KEY            * DB ERROR 02 *CFT014
     C***********          Z-ADD2         W0ERNB           ***************CFT014
     C***********          MOVEL'MEM5004' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Check*for*Retail*Account*No.*being*entered********************   CFT014
      ***only*if*Debit*Customer*reference*is*not*entered*OR************   CFT014
      ***multibranching*is*not*active.*********************************   CFT014
      ***********                                                         CFT014
     C***********Y#        IFEQ 11                                        CFT014
     C***********S5CDBR    ANDEQ*BLANKS                                   CFT014
      ***********                                                         CFT014
     C***********          MOVELS5CDRO    TRENO  100                      CFT014
     C***********TRENO     CHAINACNUMA               90                   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********RECI      ORNE 'D'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2060' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***A/C*Currency*must*be*base*currency****************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347C015                                        CFT014
     C***********CCY       IFNE V#BCCY                     B005           CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2061' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
     C***/COPY*WNCPYSRC,FT0347C016                                        CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Validate*for*G/L*Account*No.**********************************   CFT014
      ***********                                                         CFT014
      ***If*12*digits*when*combined*with*base*currency*must*exist******   CFT014
      ***on*PF/ACCNTAB*************************************************   CFT014
      ***********                                                         CFT014
     C***********Y#        IFEQ 13                                        CFT014
     C***********S5CDBR    ORNE *BLANKS                                   CFT014
      ***********                                                         CFT014
     C***********          MOVELS5CDRO    KACNUM  60                      CFT014
     C***********          MOVE S5CDRO    ACCS    6                       CFT014
     C***********          MOVELACCS      KACCD   40                      CFT014
     C***********          MOVE ACCS      KACSQ   20                      CFT014
      ***********                                                         CFT014
      **If*multibranched*use*screen*branch*else*use*passed*branch******   CFT014
      ***********                                                         CFT014
     C***********WUMBIN    IFEQ 'Y'                                       CFT014
     C***********          MOVELS5CDBR    KBRCA   3                       CFT014
     C***********          ELSE                                           CFT014
     C***********          MOVELV#SBRC    KBRCA                           CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********TACKEY    KLIST                                          CFT014
     C***********          KFLD           KACNUM                          CFT014
     C***********          KFLD           V#BCCY                          CFT014
     C***********          KFLD           KACCD                           CFT014
     C***********          KFLD           KACSQ                           CFT014
     C***********          KFLD           KBRCA                           CFT014
      ***********                                                         CFT014
     C***********TACKEY    CHAINACCNTABF             90                   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********RECI      ORNE 'D'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********S5CDRO    CAT  S5CDBR    FTMSDT    P                     CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2062' FTMSID                          CFT014
     C***/COPY*WNCPYSRC,FT0347C017                                        CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
      ***********                                                         CFT014
      **Highlight*branch*if*entered************************************   CFT014
      ***********                                                         CFT014
     C***********S5CDBR    IFNE *BLANK                                    CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          GOTO EXCDRO                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***If*'Charges*To*The*Debit*Of*is*entered*then*******************   CFT014
      ***check*if*date*is*in*the*future*and*if*the*account*is**********   CFT014
      ***closing*today*************************************************   CFT014
      ***********                                                         CFT014
     C***********V#ADDC    IFEQ 'A'                                       CFT014
     C***********          Z-ADDV#SLDT    @DATE   50                      CFT014
     C***********          ELSE                                           CFT014
     C***********          Z-ADDV#PVDT    @DATE                           CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********@DATE     IFGT WURDNB                                    CFT014
     C***********ACST      ANDEQ'C'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2063' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Check*not*past*backvalue*period*******************************   CFT014
      ***********                                                         CFT014
      ***********                                                  S01408 CFT014
     C***/COPY*WNCPYSRC,FT0347CCP1                                 S01408 CFT014
      ***********                                                  S01408 CFT014
     C***********@DATE     IFLT V#BVLD                                    CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2064' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
      ***********                                                  S01408 CFT014
     C***/COPY*WNCPYSRC,FT0347CCP2                                 S01408 CFT014
      ***********                                                  S01408 CFT014
      ***********                                                         CFT014
      ***For*Retail*accounts*only,*check*that*the**********************   CFT014
      ***earlier*of*the*two*value*dates*is*not*before*the*Backvalue****   CFT014
      ***Limit*Date*nor*before*the*account*was*opened******************   CFT014
      ***********                                                         CFT014
     C***********ATYP      IFEQ 'R'                                       CFT014
      ***********                                                         CFT014
     C***********@DATE     IFLT DACO                                      CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5CDRO    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2065' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5CDRT                          CFT014
     C***********          MOVEL'Y'       I5CDBR                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
     C***/COPY*WNCPYSRC,FT0347C001                                        CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***If*no*errors*then*set*file*fields*****************************   CFT014
      ***********                                                         CFT014
     C***********I5CDRT    IFEQ *BLANKS                                   CFT014
     C***********          SELEC                                          CFT014
     C***********Y#        WHEQ 3                                         CFT014
     C***********          MOVEL'N'       F5CDRT                          CFT014
     C***********Y#        WHEQ 11                                        CFT014
     C***********          MOVEL'R'       F5CDRT                          CFT014
     C***********Y#        WHEQ 13                                        CFT014
     C***********          MOVEL'P'       F5CDRT                          CFT014
     C***********          ENDSL                                          CFT014
     C***/COPY*WNCPYSRC,FT0347C018                                        CFT014
      ***********                                                         CFT014
     C***********          MOVELS5CDRO    F5CDRO                          CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXCDRO    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q                               CFT014
      ***********                                                         CFT014
     C***SR******             ENDSR                                       CFT014
     C***/EJECT**                                                         CFT014
      *****************************************************************
      *                                                               *
      *  SRRCO    : Receiver's Correspondent                          *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRRCO     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRRCO '  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0347RRCO
      *
      *  Receiver's Correspondent is Optional
      *
     C                     MOVEL*BLANKS   F5RCOT
      *
     C           S5RCO     IFEQ *BLANKS
     C                     MOVEL*BLANKS   ADDRSS                          CFT004
     C                     GOTO EXRCO
     C                     END
      *
      *  ? not allowed
      *
     C           '?'       SCAN S5RCO1    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5RCO1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2203' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5RCO1
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,1                          CFT014
     C                     MOVEA' '       WRN@,5                          CFT014
     C                     GOTO EXRCO
     C                     END
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS5RCO     ADDRSS
      *
      *  If first ten characters used then try to find via SDCUSTPD
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    @CNUM
     C                     ELSE
     C                     MOVELADCHK2    @CNUM
     C                     END
      *
      *  Call to access pgm for Customer details
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CNUM  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 03 *
     C                     Z-ADD3         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           @RTCD     IFEQ *BLANKS
      *
      * Overwrite shortname
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL*BLANKS   S5RCO1
     C                     MOVELBBCUST    S5RCO1
     C                     ELSE
     C                     MOVEL*BLANKS   S5RCO2
     C                     MOVELBBCUST    S5RCO2
     C                     END
      *
     C                     MOVEL'C'       F5RCOT
      *
      * Valid information exit
      *
     C                     GOTO EXRCO
      *
     C                     END
      *
     C                     END
      *
      *  If 1st 11 Chars of 1st line then SWIFT address assumed
      *  Or first is '/' and second is SWIFT Address
      *
      *
      *  If field does not begin with '/' and is not longer than 11
      *  characters, validate as a S.W.I.F.T. Address
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXSW    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADEXS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    CLSWTK
     C                     ELSE
     C                     MOVELADCHK2    CLSWTK
     C                     END
      *
     C                     EXSR SWIFT
      *
     C           ##CSID    IFEQ 'Y'
     C           *IN31     IFEQ '1'
     C/COPY WNCPYSRC,FT0347C008
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2204' FTMSID
     C                     EXSR FTSNMS
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5RCO1
     C                     ELSE
     C                     MOVEL'Y'       I5RCO2
     C                     END
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,1                          CFT014
     C                     MOVEA' '       WRN@,5                          CFT014
     C                     GOTO EXRCO
     C                     END
      *
     C                     MOVEL'S'       F5RCOT
      *
      *  No SWIFT address record.
      *
     C           *IN32     IFEQ '1'
     C           *IN31     ANDEQ'0'
     C/COPY WNCPYSRC,FT0347C009
      *
      *  If text changed then warning needs to be changed
      *
     C           CLSWTK    IFNE V#RCO1
     C***********          MOVEA' '       WRN@,1                          CFT014
     C                     MOVEA' '       WRN@,5                          CFT014
     C                     MOVELCLSWTK    V#RCO1
     C                     END
      *
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5RCO1
     C                     ELSE
     C                     MOVEL'Y'       I5RCO2
     C                     END
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2205' FTMSID
     C                     EXSR FTSNMS
      *
     C***********WRN@,1    IFEQ ' '                                       CFT014
     C           WRN@,5    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND
     C***********          MOVEA'Y'       WRN@,1                          CFT014
     C                     MOVEA'Y'       WRN@,5                          CFT014
     C                     END
      *
     C                     ELSE
     C***********          MOVEA' '       WRN@,1                          CFT014
     C                     MOVEA' '       WRN@,5                          CFT014
     C                     END
      *
      * Exit as validation complete for S.W.I.F.T.
      *
     C                     GOTO EXRCO
      *
     C                     END
      *
     C                     END
      *
      * Invalid customer number or shortname.
      *
     C/COPY WNCPYSRC,FT0347C002
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    FTMSDT
     C                     MOVEL'Y'       I5RCO1
     C                     ELSE
     C                     MOVELADCHK2    FTMSDT
     C                     MOVEL'Y'       I5RCO2
     C                     END
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2206' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXRCO
     C                     END
     C/COPY WNCPYSRC,FT0347C003
      *
      * Validate as an address
      *
     C                     MOVEL'Y'       ADLINE
     C                     MOVEL'FTM2314' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     EXSR ADCHK
      *
      *  Depending on the indicators, highlight the field in error
      *
     C           *IN91     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5RCO1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2208' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5RCO1
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5RCO1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2207' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5RCOT
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I5RCO1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I5RCO2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I5RCO3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I5RCO4
     C                     END
     C           AD#5      IFEQ 'Y'
     C                     MOVEL'Y'       I5RCO5
     C                     END
      *
      *  If no errors then customer is an address
      *
     C           I5RCOT    IFEQ *BLANKS
     C                     MOVEL'A'       F5RCOT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXRCO     TAG
      *                                                                   CFT014
      ** Error when bank operation code entered is 'SPRI', or 'SSTD' or   CFT014
      ** 'SPAY' and type of receiver's correspondent entered is not 'S'   CFT014
      ** or not 'C' or receiver's correspondent type is 'C' but the       CFT014
      ** customer entered does not have a SWIFT BIC.                      CFT014
      *                                                                   CFT014
     C           S5RCO     IFNE *BLANKS                                   CFT014
     C           S5BNCD    IFEQ 'SPRI'                                    CFT014
     C           S5BNCD    OREQ 'SSTD'                                    CFT014
     C           S5BNCD    OREQ 'SPAY'                                    CFT014
      *                                                                   CFT014
     C           F5RCOT    IFNE 'S'                                       CFT014
     C           F5RCOT    ANDNE'C'                                       CFT014
     C           F5RCOT    OREQ 'C'                                       CFT014
     C           BBCSID    ANDEQ*BLANK                                    CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5RCO1    FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3202' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5RCOT                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT004
      * Check if line one contain an IBAN                                 CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C*                                                                   CFT004
     C** If the field start with '/aann' or 'aann'                        CFT004
     C** validate as an IBAN (INTERNATIONAL BANK ACCOUNT NUMBER)          CFT004
     C** having first formatted field removing blanks and IBAN prefix     CFT004
     C*                                                                   CFT004
     C           ADSLSH    IFEQ '/'                                       CFT004
     C           34        SUBSTADCHK1:2  PIBAN                           CFT004
     C                     ELSE                                           CFT004
     C                     MOVELADCHK1    PIBAN                           CFT004
     C                     ENDIF                                          CFT004
     C*                                                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM           @RTCD                           CFT004
     C                     PARM           PIBAN  47                       CFT004
     C                     PARM           POWITH 47                       CFT004
     C           P@IBAN    PARM           PONOBL 34                       CFT004
     C*                                                                   CFT004
     C           1         SUBSTP@IBAN:1  IBCTY1  1                       CFT004
     C           1         SUBSTP@IBAN:2  IBCTY2  1                       CFT004
     C           1         SUBSTP@IBAN:3  IBCHK1  1                       CFT004
     C           1         SUBSTP@IBAN:4  IBCHK2  1                       CFT004
     C           IBCTY1    LOKUPALPH                     94               CFT004
     C   94      IBCTY2    LOKUPALPH                     94               CFT004
     C   94      IBCHK1    LOKUPNUMC                     94               CFT004
     C   94      IBCHK2    LOKUPNUMC                     94               CFT004
     C*                                                                   CFT004
     C           *IN94     IFEQ *ON                                       CFT004
     C                     CALL 'AOIBANR5'             90                 CFT004
     C                     PARM *BLANKS   @RTCD   7                       CFT004
     C                     PARM           P@IBAN 34                       CFT004
     C           *IN90     IFEQ *OFF                                      CFT004
     C           @RTCD     ANDEQ*BLANKS                                   CFT004
     C           '/'       CAT  P@IBAN    S5RCO1                          CFT004
     C***********          MOVEA' '       WRN@,4                   CFT004 CFT014
     C                     MOVEA' '       WRN@,6                          CFT014
     C                     ELSE                                           CFT004
     C                     MOVE @RTCD     WRTCD   1                       CFT004
     C                     MOVELWRCV      FTMSDT                          CFT004
     C                     SELEC                                          CFT004
      * Invalid ISO Country Code                                          CFT004
     C           WRTCD     WHEQ '1'                                       CFT004
     C                     MOVEL'FTM2400' FTMSID                          CFT004
      * Invalid BBAN Length                                               CFT004
     C           WRTCD     WHEQ '2'                                       CFT004
     C                     MOVEL'FTM2401' FTMSID                          CFT004
      * Invalid Character                                                 CFT004
     C           WRTCD     WHEQ '3'                                       CFT004
     C                     MOVEL'FTM2402' FTMSID                          CFT004
      * Invalid IBAN Length                                               CFT004
     C           WRTCD     WHEQ '4'                                       CFT004
     C                     MOVEL'FTM2403' FTMSID                          CFT004
      * Invalid Check Digit                                               CFT004
     C           WRTCD     WHEQ '5'                                       CFT004
     C                     MOVEL'FTM2404' FTMSID                          CFT004
     C                     OTHER                                          CFT004
     C                     MOVEL'FTM2405' FTMSID                          CFT004
     C                     ENDSL                                          CFT004
     C                     MOVE 'Y'       I5RCO1                          CFT004
     C                     MOVEL'Y'       E#WARN                          CFT004
     C                     MOVEL'Y'       E#MSGS                          CFT004
     C                     MOVELE#CPGM    FTPGMQ                          CFT004
     C                     EXSR FTSNMS                                    CFT004
     C*                                                                   CFT004
     C***********WRN@,4    IFEQ ' '                                CFT004 CFT014
     C           WRN@,6    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT004
     C***********          MOVEA'Y'       WRN@,4                   CFT004 CFT014
     C                     MOVEA'Y'       WRN@,6                          CFT014
     C                     END                                            CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRACBK   : Validate Account with Bank                        *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *  ME9940    - Validate Account Line.                           *   CFT014
      *                                                               *
      *****************************************************************
     CSR         SRACBK    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRACBK'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0347ACBK
      *
      *  Account with Bank is Optional
      *
     C                     MOVEL*BLANKS   F5ACBT
      *
     C           S5ACB     IFEQ *BLANKS
     C                     MOVEL*BLANKS   ADDRSS                          CFT004
     C/COPY WNCPYSRC,FT0347C036
     C                     GOTO EXACBK
     C                     END
      *
      *  ? not allowed
      *
     C           '?'       SCAN S5ACB1    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5ACB1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2209' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5ACB1
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
     C                     GOTO EXACBK
     C                     END
      *
      *  Account with Bank not allowed for settlement type 12 or 13
      *  i.e. Cheques and Drafts
      *
     C           V#STMT    IFEQ '12'
     C           V#STMT    OREQ '13'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELV#STMT    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2210' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5ACB1
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
     C                     GOTO EXACBK
     C                     END
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS5ACB     ADDRSS
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0347CCPG                                           S01408
     C*                                                                   S01408
      *
      *  If first ten characters used then try to find via SDCUSTPD
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    @CNUM
     C                     ELSE
     C                     MOVELADCHK2    @CNUM
     C                     END
      *
      *  Call to access pgm for Customer details
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CNUM  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 04 *
     C                     Z-ADD4         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           @RTCD     IFEQ *BLANKS
     C/COPY WNCPYSRC,FT0347C037
      *
      * Overwrite shortname
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL*BLANKS   S5ACB1
     C                     MOVELBBCUST    S5ACB1
     C                     ELSE
     C                     MOVEL*BLANKS   S5ACB2
     C                     MOVELBBCUST    S5ACB2
     C                     END
      *
     C                     MOVEL'C'       F5ACBT
      *
      * Valid information exit
      *
     C                     GOTO EXACBK
      *
     C                     END
      *
     C                     END
      *
      *  If only 1st line entered then SWIFT address assumed
      *  Or first is '/' and second is SWIFT Address
      *
      *  If field does not begin with '/' and is not longer than 11
      *  characters, validate as a S.W.I.F.T. Address
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXSW    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADEXS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    CLSWTK
     C                     ELSE
     C                     MOVELADCHK2    CLSWTK
     C                     END
      *
     C                     EXSR SWIFT
      *
     C           ##CSID    IFEQ 'Y'
     C           *IN31     IFEQ '1'
     C/COPY WNCPYSRC,FT0347C010
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2211' FTMSID
     C                     EXSR FTSNMS
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5ACB1
     C                     ELSE
     C                     MOVEL'Y'       I5ACB2
     C                     END
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
     C                     GOTO EXACBK
     C                     END
      *
     C                     MOVEL'S'       F5ACBT
      *
      *  No SWIFT address record.
      *
     C           *IN32     IFEQ '1'
     C           *IN31     ANDEQ'0'
     C/COPY WNCPYSRC,FT0347C011
      *
      *  If text changed then warning needs to be changed
      *
     C           CLSWTK    IFNE V#ACB1
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
     C                     MOVELCLSWTK    V#ACB1
     C                     END
      *
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5ACB1
     C                     ELSE
     C                     MOVEL'Y'       I5ACB2
     C                     END
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2212' FTMSID
     C                     EXSR FTSNMS
      *
     C***********WRN@,2    IFEQ ' '                                       CFT014
     C           WRN@,7    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND
     C***********          MOVEA'Y'       WRN@,2                          CFT014
     C                     MOVEA'Y'       WRN@,7                          CFT014
     C                     END
     C                     ELSE
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
     C                     END
     C/COPY WNCPYSRC,FT0347C038
      *
      * Exit as validation complete for S.W.I.F.T.
      *
     C                     GOTO EXACBK
      *
     C                     END
      *
     C                     END
      *
     C***********          MOVEA' '       WRN@,2                          CFT014
     C                     MOVEA' '       WRN@,7                          CFT014
      *
      * Invalid customer number or shortname.
      *
     C/COPY WNCPYSRC,FT0347C004
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    FTMSDT
     C                     MOVEL'Y'       I5ACB1
     C                     ELSE
     C                     MOVELADCHK2    FTMSDT
     C                     MOVEL'Y'       I5ACB2
     C                     END
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2214' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXACBK
     C                     END
     C/COPY WNCPYSRC,FT0347C005
      *
      * Validate as an address
      *
      * No address line allowed
      *
     C                     MOVEL'Y'       ADLINE
     C                     MOVEL'FTM2315' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     EXSR ADCHK
      *                                                                   CFT014
      ** Bilateral agreement exists and account line is a clearing code   CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           V#M103    ANDEQ'Y'                                       CFT014
     C           ADNOSN    ANDEQ'//'                                      CFT014
     C           ADCH26    ANDEQ*BLANK                                    CFT014
     C                     MOVE 'Y'       WCL103                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       WCL103                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  Depending on the indicators, highlight the field in error
      *
     C           *IN91     IFEQ '1'
     C           CFT014    ANDEQ'N'                                       CFT014
     C           *IN91     OREQ *ON                                       CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C           WCL103    ANDEQ'N'                                       CFT014
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5ACB1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2215' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5ACB1
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5ACB1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2216' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5ACBT
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I5ACB1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I5ACB2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I5ACB3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I5ACB4
     C                     END
     C           AD#5      IFEQ 'Y'
     C                     MOVEL'Y'       I5ACB5
     C                     END
      *                                                                   CFT014
      ** Address not allowed without an account line if bank operation    CFT014
      ** code is either a 'SPRI', 'SSTD' or a 'SPAY'.                     CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           S5BNCD    IFEQ 'SPRI'                                    CFT014
     C           S5BNCD    OREQ 'SPAY'                                    CFT014
     C           S5BNCD    OREQ 'SSTD'                                    CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5ACB     FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3215' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5ACB1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
      *  If no errors then bank is an address
      *
     C           I5ACBT    IFEQ *BLANKS
     C                     MOVEL'A'       F5ACBT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXACBK    TAG
      *                                                                   CFT014
      ** Clearing code exists                                             CFT014
      *                                                                   CFT014
     C           ADNOSN    IFEQ '//'                                      CFT014
     C           ADCH26    ANDEQ*BLANK                                    CFT014
     C                     CLEARI#PARM                                    CFT014
     C                     CLEARO#PARM                                    CFT014
     C                     CLEARX#PARM                                    CFT014
     C                     MOVEL'AWBK'    I#VFLD                          CFT014
     C                     MOVEL'PAY'     I#PR                            CFT014
     C           WCL103    IFEQ 'N'                                       CFT014
     C           CSW203    IFEQ 'N'                                                           CSW203
     C                     MOVEL'100'     I#MTYP                          CFT014
     C                     ELSE                                                               CSW203
     C                     MOVEL'103'     I#MTYP                                              CSW203
     C                     ENDIF                                                              CSW203
     C                     ELSE                                           CFT014
     C           CSW203    IFEQ 'N'                                                           CSW203
     C                     MOVEL'100'     I#MTYP                          CFT014
     C                     ELSE                                                               CSW203
     C                     MOVEL'103'     I#MTYP                                              CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                          CFT014
     C           F5ACBT    IFEQ 'C'                                       CFT014
     C                     MOVEL'C'       I#PRTT                          CFT014
     C                     MOVEL@CNUM     I#PRTY                          CFT014
     C                     ENDIF                                          CFT014
     C           F5ACBT    IFEQ 'S'                                       CFT014
     C                     MOVEL'S'       I#PRTT                          CFT014
     C                     MOVELCLSWTK    I#PRTY                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVE *BLANK    I#PRTT                          CFT014
     C                     MOVE *BLANK    I#PRTY                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVELV#PCCY    I#PCCY                          CFT014
     C                     MOVELV#SMCY    I#RCCY                          CFT014
     C                     MOVELS5ACB1    I#ACLN                          CFT014
      *                                                                   CFT014
     C                     MOVELE#CPGM    X#CPGM                          CFT014
     C                     MOVEL'MEC0017' X#MSGD                          CFT014
     C                     MOVEL'MEMSG'   X#MSGF                          CFT014
      *                                                                   CFT014
      ** Validate account line                                            CFT014
      *                                                                   CFT014
     C                     CALL 'ME9940'                                  CFT014
     C                     PARM           W0RTN                           CFT014
     C                     PARM           I#PARM                          CFT014
     C                     PARM           O#PARM                          CFT014
     C                     PARM           X#PARM                          CFT014
     C                     PARM *BLANK    Z#PARM                          CFT014
      *                                                                   CFT014
      ** On return if errors copy into error array                        CFT014
      *                                                                   CFT014
     C           X#ERRM    IFNE *BLANKS                                   CFT014
     C                     MOVE 'Y'       I5ACB1                          CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT004
      * Check if line one contain an IBAN                                 CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C*                                                                   CFT004
     C** If the field start with '/aann' or 'aann'                        CFT004
     C** validate as an IBAN (INTERNATIONAL BANK ACCOUNT NUMBER)          CFT004
     C** having first formatted field removing blanks and IBAN prefix     CFT004
     C*                                                                   CFT004
     C           ADSLSH    IFEQ '/'                                       CFT004
     C           34        SUBSTADCHK1:2  PIBAN                           CFT004
     C                     ELSE                                           CFT004
     C                     MOVELADCHK1    PIBAN                           CFT004
     C                     ENDIF                                          CFT004
     C*                                                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM           @RTCD                           CFT004
     C                     PARM           PIBAN  47                       CFT004
     C                     PARM           POWITH 47                       CFT004
     C           P@IBAN    PARM           PONOBL 34                       CFT004
     C*                                                                   CFT004
     C           1         SUBSTP@IBAN:1  IBCTY1  1                       CFT004
     C           1         SUBSTP@IBAN:2  IBCTY2  1                       CFT004
     C           1         SUBSTP@IBAN:3  IBCHK1  1                       CFT004
     C           1         SUBSTP@IBAN:4  IBCHK2  1                       CFT004
     C           IBCTY1    LOKUPALPH                     94               CFT004
     C   94      IBCTY2    LOKUPALPH                     94               CFT004
     C   94      IBCHK1    LOKUPNUMC                     94               CFT004
     C   94      IBCHK2    LOKUPNUMC                     94               CFT004
     C*                                                                   CFT004
     C           *IN94     IFEQ *ON                                       CFT004
     C                     CALL 'AOIBANR5'             90                 CFT004
     C                     PARM *BLANKS   @RTCD   7                       CFT004
     C                     PARM           P@IBAN                          CFT004
     C           *IN90     IFEQ *OFF                                      CFT004
     C           @RTCD     ANDEQ*BLANKS                                   CFT004
     C           '/'       CAT  P@IBAN    S5ACB1                          CFT004
     C***********          MOVEA' '       WRN@,5                   CFT004 CFT014
     C                     MOVEA' '       WRN@,8                          CFT014
     C                     ELSE                                           CFT004
     C                     MOVE @RTCD     WRTCD   1                       CFT004
     C                     MOVELWACW      FTMSDT                          CFT004
     C                     SELEC                                          CFT004
      * Invalid ISO Country Code                                          CFT004
     C           WRTCD     WHEQ '1'                                       CFT004
     C                     MOVEL'FTM2400' FTMSID                          CFT004
      * Invalid BBAN Length                                               CFT004
     C           WRTCD     WHEQ '2'                                       CFT004
     C                     MOVEL'FTM2401' FTMSID                          CFT004
      * Invalid Character                                                 CFT004
     C           WRTCD     WHEQ '3'                                       CFT004
     C                     MOVEL'FTM2402' FTMSID                          CFT004
      * Invalid IBAN Length                                               CFT004
     C           WRTCD     WHEQ '4'                                       CFT004
     C                     MOVEL'FTM2403' FTMSID                          CFT004
      * Invalid Check Digit                                               CFT004
     C           WRTCD     WHEQ '5'                                       CFT004
     C                     MOVEL'FTM2404' FTMSID                          CFT004
     C                     OTHER                                          CFT004
     C                     MOVEL'FTM2405' FTMSID                          CFT004
     C                     ENDSL                                          CFT004
     C                     MOVE 'Y'       I5ACB1                          CFT004
     C                     MOVEL'Y'       E#WARN                          CFT004
     C                     MOVEL'Y'       E#MSGS                          CFT004
     C                     MOVELE#CPGM    FTPGMQ                          CFT004
     C                     EXSR FTSNMS                                    CFT004
     C*                                                                   CFT004
     C***********WRN@,5    IFEQ ' '                                CFT004 CFT014
     C           WRN@,8    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT004
     C***********          MOVEA'Y'       WRN@,5                   CFT004 CFT014
     C                     MOVEA'Y'       WRN@,8                          CFT014
     C                     END                                            CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRBNC    : Validate Beneficiary                              *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRBNC     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRBNC '  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0347RBNC
      *
      *  ? not allowed
      *
     C           '?'       SCAN S5BNC1    Y#             90
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5BNC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2217' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5BNC1
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     MOVEL*BLANKS   ADDRSS                          CFT004
     C                     GOTO EXBNC
     C                     END
      *
      *  Beneficiary is mandatory
      *
     C                     MOVEL*BLANKS   F5BNCT
      *
     C           S5BNC     IFEQ *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5BNC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2218' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5BNC1
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     GOTO EXBNC
     C                     END
     C/COPY WNCPYSRC,FT0347C048
      *
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELS5BNC     ADDRSS
      *
      *  If first ten characters used then try to find via SDCUSTPD
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    @CNUM
     C                     ELSE
     C                     MOVELADCHK2    @CNUM
     C                     END
      *
      *  Check if the first 6 characters are numeric if so
      *  look for customer number else look for shortname
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVEL@CNUM     I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      *  Valid only if 6 digits - now check rest for blanks
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ7
     C           ' '       CHECKI#FLD:7   Y#      30     90
      *
      * Customer validation
      *
     C           *IN90     IFEQ '0'
      *
      *  Call to access pgm for Customer details
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CNUM  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
     C/COPY WNCPYSRC,FT0347C020
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 05 *
     C                     Z-ADD5         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0347C021
      *
     C           @RTCD     IFEQ *BLANKS
     C           @KYST     ORNE '*CNUM  '
     C                     MOVEL'C'       F5BNCT
     C                     GOTO EXBNC
     C                     ELSE
      *
      *  Highlight correct field
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5BNC1
     C                     ELSE
     C                     MOVEL'Y'       I5BNC2
     C                     END
      *
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL@CNUM     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2219' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     GOTO EXBNC
     C                     END
      *
     C                     END
      *
     C                     ELSE
      *
      *  Call to access pgm for Customer details
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CNUM  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM *BLANKS   DSSDY
      *
     C/COPY WNCPYSRC,FT0347C022
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 06 *
     C                     Z-ADD6         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0347C023
      *
     C           @RTCD     IFEQ *BLANKS
     C           @KYST     ANDEQ'*CSHT  '
     C           ADSLSH    IFNE '/'
     C                     MOVEL*BLANKS   S5BNC1
     C                     MOVELBBCUST    S5BNC1
     C                     ELSE
     C                     MOVEL*BLANKS   S5BNC2
     C                     MOVELBBCUST    S5BNC2
     C                     END
     C                     MOVEL'C'       F5BNCT
     C                     GOTO EXBNC
     C                     END
      *
     C                     END
      *
     C                     END
      *
      *  If only 1st line entered then SWIFT address assumed
      *  Or first is '/' and second is SWIFT Address
      *
      *  If field does not begin with '/' and is not longer than 11
      *  characters, validate as a S.W.I.F.T. Address
      *
     C           ADCH26    IFEQ *BLANKS
     C           ADEXSW    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADEXS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  First 11 characters should be key for CLSWT.
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELADCHK1    CLSWTK
     C                     ELSE
     C                     MOVELADCHK2    CLSWTK
     C                     END
      *
     C                     EXSR SWIFT
      *
     C           ##CSID    IFEQ 'Y'
     C           *IN31     IFEQ '1'
     C/COPY WNCPYSRC,FT0347C012
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2220' FTMSID
     C                     EXSR FTSNMS
      *
      *  Highlight correct field
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5BNC1
     C                     ELSE
     C                     MOVEL'Y'       I5BNC2
     C                     END
     C                     MOVEL'Y'       E#NOUP
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     GOTO EXBNC
     C                     END
      *
     C                     MOVEL'S'       F5BNCT
      *
      *  No SWIFT address record.
      *
     C           *IN32     IFEQ '1'
     C           *IN31     ANDEQ'0'
     C/COPY WNCPYSRC,FT0347C013
      *
      *  If text changed then warning needs to be changed
      *
     C           CLSWTK    IFNE V#BNC1
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     MOVELCLSWTK    V#BNC1
     C                     END
      *
      *
      *  Highlight correct field
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5BNC1
     C                     ELSE
     C                     MOVEL'Y'       I5BNC2
     C                     END
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELCLSWTK    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2221' FTMSID
     C                     EXSR FTSNMS
      *
     C***********WRN@,3    IFEQ ' '                                       CFT014
     C           WRN@,9    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND
     C***********          MOVEA'Y'       WRN@,3                          CFT014
     C                     MOVEA'Y'       WRN@,9                          CFT014
     C                     END
      *
     C                     ELSE
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
     C                     END
      *
      * Exit as validation complete for S.W.I.F.T.
      *
     C                     GOTO EXBNC
      *
     C                     END
      *
     C                     END
      *
     C***********          MOVEA' '       WRN@,3                          CFT014
     C                     MOVEA' '       WRN@,9                          CFT014
      *
     C/COPY WNCPYSRC,FT0347C006
     C           ADCH26    IFEQ *BLANKS
     C           ADEXCS    ANDEQ*BLANKS
     C           ADSLSH    ANDNE'/'
     C           ADCH36    OREQ *BLANKS
     C           ADXCS2    ANDEQ*BLANKS
     C           ADCHK2    ANDNE*BLANKS
     C           ADSLSH    ANDEQ'/'
     C           ADSLS2    ANDNE'/'
      *
      *  Highlight correct field
      *
     C           ADSLSH    IFNE '/'
     C                     MOVEL'Y'       I5BNC1
     C                     MOVELS5BNC1    FTMSDT
     C                     ELSE
     C                     MOVEL'Y'       I5BNC2
     C                     MOVELS5BNC2    FTMSDT
     C                     END
      *
     C/COPY WNCPYSRC,FT0347C026
     C                     MOVEL'Y'       E#MSGS
     C***********          MOVELS5BNC1    FTMSDT                          090943
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2222' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXBNC
     C/COPY WNCPYSRC,FT0347C027
     C                     END
     C/COPY WNCPYSRC,FT0347C007
      *
      * Validate as an address
      *
      * Allow only '/' in first line
      *
     C                     MOVEL'Y'       ADLINE  1
     C*********            MOVEL'Y'       ADSLON  1
     C                     MOVEL'FTM2316' ADFLDM
     C                     MOVEL'FTUSRMSG'ADFLDF
     C                     EXSR ADCHK
      *
      *  Depending on the indicators, highlight the field in error
      *
     C/COPY WNCPYSRC,FT0347C024
     C           *IN91     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5BNC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2223' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5BNC1
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C/COPY WNCPYSRC,FT0347C025
      *
     C           *IN92     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS5BNC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2224' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I5BNCT
     C                     MOVEL'Y'       E#NOUP
     C                     END
      *
     C           *IN93     IFEQ '1'
     C                     MOVEL'Y'       E#NOUP
     C                     END
     C*
     C           AD#1      IFEQ 'Y'
     C                     MOVEL'Y'       I5BNC1
     C                     END
     C           AD#2      IFEQ 'Y'
     C                     MOVEL'Y'       I5BNC2
     C                     END
     C           AD#3      IFEQ 'Y'
     C                     MOVEL'Y'       I5BNC3
     C                     END
     C           AD#4      IFEQ 'Y'
     C                     MOVEL'Y'       I5BNC4
     C                     END
     C           AD#5      IFEQ 'Y'
     C                     MOVEL'Y'       I5BNC5
     C                     END
      *
      *  If no errors then bank is an address
      *
     C           I5BNCT    IFEQ *BLANKS
     C                     MOVEL'A'       F5BNCT
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXBNC     TAG
      *                                                                   CFT014
      ** Beneficiary does not contain an account line while bank          CFT014
      ** operation code is 'SPRI', 'SSTD' or 'SPAY'.                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           S5BNCD    IFEQ 'SPRI'                                    CFT014
     C           S5BNCD    OREQ 'SSTD'                                    CFT014
     C           S5BNCD    OREQ 'SPAY'                                    CFT014
     C           ADSLSH    IFNE '/'                                       CFT014
     C                     MOVEL'Y'       E#MSGS                          CFT014
     C                     MOVELS5BNC     FTMSDT                          CFT014
     C                     MOVELE#CPGM    FTPGMQ                          CFT014
     C                     MOVEL'FTM3216' FTMSID                          CFT014
     C                     EXSR FTSNMS                                    CFT014
     C                     MOVEL'Y'       I5BNC1                          CFT014
     C                     MOVEL'Y'       E#NOUP                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
      * Check if line one contain an IBAN                                 CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C*                                                                   CFT004
     C** If the field start with '/aann' or 'aann'                        CFT004
     C** validate as an IBAN (INTERNATIONAL BANK ACCOUNT NUMBER)          CFT004
     C** having first formatted field removing blanks and IBAN prefix     CFT004
     C*                                                                   CFT004
     C           ADSLSH    IFEQ '/'                                       CFT004
     C           34        SUBSTADCHK1:2  PIBAN                           CFT004
     C                     ELSE                                           CFT004
     C                     MOVELADCHK1    PIBAN                           CFT004
     C                     ENDIF                                          CFT004
     C*                                                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM           @RTCD                           CFT004
     C                     PARM           PIBAN  47                       CFT004
     C                     PARM           POWITH 47                       CFT004
     C           P@IBAN    PARM           PONOBL 34                       CFT004
     C*                                                                   CFT004
     C           1         SUBSTP@IBAN:1  IBCTY1  1                       CFT004
     C           1         SUBSTP@IBAN:2  IBCTY2  1                       CFT004
     C           1         SUBSTP@IBAN:3  IBCHK1  1                       CFT004
     C           1         SUBSTP@IBAN:4  IBCHK2  1                       CFT004
     C           IBCTY1    LOKUPALPH                     94               CFT004
     C   94      IBCTY2    LOKUPALPH                     94               CFT004
     C   94      IBCHK1    LOKUPNUMC                     94               CFT004
     C   94      IBCHK2    LOKUPNUMC                     94               CFT004
     C*                                                                   CFT004
     C           *IN94     IFEQ *ON                                       CFT004
     C                     CALL 'AOIBANR5'             90                 CFT004
     C                     PARM *BLANKS   @RTCD   7                       CFT004
     C                     PARM           P@IBAN                          CFT004
     C                     Z-ADD10        Z       30                      CFT014
     C           *IN90     IFEQ *OFF                                      CFT004
     C           @RTCD     ANDEQ*BLANKS                                   CFT004
     C                     MOVE 'Y'       @@IBAN  1                                           CFT032
     C                     EXSR SROUFM                                                        CFT032
     C           '/'       CAT  P@IBAN    S5BNC1                          CFT004
     C***********          MOVEA' '       WRN@,6                   CFT004 CFT014
     C                     MOVEA' '       WRN@,Z                          CFT014
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       @@IBAN                                              CFT032
     C                     EXSR SROUFM                                                        CFT032
     C                     MOVE @RTCD     WRTCD   1                       CFT004
     C                     MOVELWBEN      FTMSDT                          CFT004
     C                     SELEC                                          CFT004
      * Invalid ISO Country Code                                          CFT004
     C           WRTCD     WHEQ '1'                                       CFT004
     C                     MOVEL'FTM2400' FTMSID                          CFT004
      * Invalid BBAN Length                                               CFT004
     C           WRTCD     WHEQ '2'                                       CFT004
     C                     MOVEL'FTM2401' FTMSID                          CFT004
      * Invalid Character                                                 CFT004
     C           WRTCD     WHEQ '3'                                       CFT004
     C                     MOVEL'FTM2402' FTMSID                          CFT004
      * Invalid IBAN Length                                               CFT004
     C           WRTCD     WHEQ '4'                                       CFT004
     C                     MOVEL'FTM2403' FTMSID                          CFT004
      * Invalid Check Digit                                               CFT004
     C           WRTCD     WHEQ '5'                                       CFT004
     C                     MOVEL'FTM2404' FTMSID                          CFT004
     C                     OTHER                                          CFT004
     C                     MOVEL'FTM2405' FTMSID                          CFT004
     C                     ENDSL                                          CFT004
     C                     MOVE 'Y'       I5BNC1                          CFT004
     C                     MOVEL'Y'       E#WARN                          CFT004
     C                     MOVEL'Y'       E#MSGS                          CFT004
     C                     MOVELE#CPGM    FTPGMQ                          CFT004
     C                     EXSR FTSNMS                                    CFT004
     C*                                                                   CFT004
     C***********WRN@,6    IFEQ ' '                                CFT004 CFT014
     C           WRN@,Z    IFEQ ' '                                       CFT014
     C                     MOVEL*BLANKS   E#RSND                          CFT004
     C***********          MOVEA'Y'       WRN@,6                   CFT004 CFT014
     C                     MOVEA'Y'       WRN@,Z                          CFT014
     C                     END                                            CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      ** Validate 59F format if CSW215 is switched on                                         CSW215
      *                                                                                       CSW215
     C           CSW215    IFEQ 'Y'                                                           CSW215
     C           I5BNCT    ANDEQ*BLANKS                                                       CSW215
     C                     EXSR VAL59F                                                        CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *                                                                   CFT014
      ** This subroutine has been moved to program FT0348                 CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
      *****************************************************************   CFT014
      ***SRDPAY***:*Validate*Details*Of*Payment************************   CFT014
      *****************************************************************   CFT014
      ***CALLED*BY:*SRPROC*-*Control*Process*of*Validation*************   CFT014
      *****************************************************************   CFT014
      ***CALLS****:********-*******************************************   CFT014
      *****************************************************************   CFT014
      *****************************************************************   CFT014
     C***SR*****   SSRDPAY   BBEGSR                                       CFT014
      ***********                                                         CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********          ADD  1         Q       50                      CFT014
     C***********          MOVEL'SRDPAY'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***/COPY*Statement***********************************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347DPAY                                        CFT014
      ***********                                                         CFT014
      **If*MT202*in*Ordering*Customer*then*this*field*should*be********   CFT014
      **blank*as*:70:*not*on*MT200*series*messages*********************   CFT014
      ***********                                                         CFT014
     C***********S5PAY     IFNE *BLANKS                                   CFT014
     C***********V#ORC1    ANDEQORCFLD                                    CFT014
     C***/COPY*WNCPYSRC,FT0347C035                                        CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5PAY1    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2351' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5PAY                           CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          GOTO EXDPAY                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Validate*details*of*payment************************************   CFT014
      ***********                                                         CFT014
     C***********S5PAY     IFNE *BLANKS                                   CFT014
      ***********                                                         CFT014
      **Prevent*first*check*in*ADCHK*subroutine************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL' '       ADLINE                          CFT014
     C***********          MOVEL'FTM2317' ADFLDM                          CFT014
     C***********          MOVEL'FTUSRMSG'ADFLDF                          CFT014
      ***********                                                         CFT014
     C***********          MOVE *BLANKS   ADDRSS                          CFT014
     C***********          MOVELS5PAY     ADDRSS                          CFT014
      ***********                                                         CFT014
     C***********          EXSR ADCHK                                     CFT014
      ***********                                                         CFT014
      ***Depending*on*the*indicators,*highlight*the*field*in*error*****   CFT014
      ***********                                                         CFT014
     C************IN92     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5PAY1    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2225' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5PAY                           CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Illegal*Characters*found**************************************   CFT014
      ***********                                                         CFT014
     C************IN93     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
     C***********                                                         CFT014
     C***********AD#1      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5PAY1                          CFT014
     C***********          END                                            CFT014
     C***********AD#2      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5PAY2                          CFT014
     C***********          END                                            CFT014
     C***********AD#3      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5PAY3                          CFT014
     C***********          END                                            CFT014
     C***********AD#4      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5PAY4                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C/COPY WNCPYSRC,FT0347C047
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXDPAY    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q                               CFT014
      ***********                                                         CFT014
     C***SR******             ENDSR                                       CFT014
     C***/EJECT**                                                         CFT014
      *                                                                   CFT014
      ** This subroutine has been moved to program FT0348                 CFT014
      *                                                                   CFT014
      *****************************************************************   CFT014
      *****************************************************************   CFT014
      ***SRBTOB***:*Validate*Bank*To*Bank*Information******************   CFT014
      *****************************************************************   CFT014
      ***CALLED*BY:*SRPROC*-*Control*Process*of*Validation*************   CFT014
      *****************************************************************   CFT014
      ***CALLS****:********-*******************************************   CFT014
      *****************************************************************   CFT014
      *****************************************************************   CFT014
     C***SR*****    SRBTOB    BEGSR                                       CFT014
      *****************************************************************   CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      *****************************************************************   CFT014
     C***********          ADD  1         Q       50                      CFT014
     C***********          MOVEL'SRBTOB'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***/COPY*Statement***********************************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347BTOB                                        CFT014
      ***********                                                         CFT014
      ***Validate*Bank*to*Bank*Information*****************************   CFT014
      ***********                                                         CFT014
     C***********S5BTB     IFNE *BLANKS                                   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   ADDRSS                          CFT014
     C***********          MOVELS5BTB     ADDRSS                          CFT014
      ***********                                                         CFT014
     C***********          MOVEL'FTM2318' ADFLDM                          CFT014
     C***********          MOVEL'FTUSRMSG'ADFLDF                          CFT014
     C***********          EXSR ADCHK                                     CFT014
      ***********                                                         CFT014
      ***Depending*on*the*indicators,*highlight*the*field*in*error*****   CFT014
      ***********                                                         CFT014
     C************IN92     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVELS5PAY1    FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2226' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEL'Y'       I5BTB                           CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C************IN93     IFEQ '1'                                       CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          END                                            CFT014
     C***********                                                         CFT014
     C***********AD#1      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB1                          CFT014
     C***********          END                                            CFT014
     C***********AD#2      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB2                          CFT014
     C***********          END                                            CFT014
     C***********AD#3      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB3                          CFT014
     C***********          END                                            CFT014
     C***********AD#4      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB4                          CFT014
     C***********          END                                            CFT014
     C***********AD#5      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB5                          CFT014
     C***********          END                                            CFT014
     C***********AD#6      IFEQ 'Y'                                       CFT014
     C***********          MOVEL'Y'       I5BTB6                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***If*settlement*type*if*"01"*or*"08"*or*Sender's*Corres.*then***   CFT014
      ***validate*as*SWIFT.********************************************   CFT014
      ***********                                                         CFT014
     C***********I5BTB     IFEQ *BLANKS                                   CFT014
     C***********V#STMT    IFEQ '01'                                      CFT014
     C***********V#STMT    OREQ '08'                                      CFT014
     C***********V#SNCT    ORNE *BLANKS                                   CFT014
     C***********V#SNMT    ANDEQ'Y'                                       CFT014
     C***********          EXSR SRSEPT                                    CFT014
     C***********          END                                            CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXBTOB    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q                               CFT014
      ***********                                                         CFT014
     C***SR******             ENDSR                                       CFT014
     C***/EJECT**                                                         CFT014
      *                                                                   CFT014
      ** This subroutine has been moved to program FT0348                 CFT014
      *                                                                   CFT014
      *****************************************************************
      *****************************************************************   CFT014
      ***SRSEPT***:*SWIFT*validation*changes***************************   CFT014
      *****************************************************************   CFT014
      ***CALLED*BY:*SRPROC*-*Control*Process*of*Validation*************   CFT014
      *****************************************************************   CFT014
      ***CALLS****:********-*******************************************   CFT014
      *****************************************************************   CFT014
      *****************************************************************
     C***SR******  SSRSEPT   BBEGSR                                       CFT014
      ***********                                                         CFT014
      ***Set*up*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********          ADD  1         Q       50                      CFT014
     C***********          MOVEL'SRSEPT'  @STK,Q                          CFT014
      ***********                                                         CFT014
      ***/COPY*Statement***********************************************   CFT014
      ***********                                                         CFT014
     C***/COPY*WNCPYSRC,FT0347SEPT                                        CFT014
      ***********                                                  S01412 CFT014
      ***Check*through*each*of*the*6*fields*in*turn.***************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********          Z-ADD1         #S      50               S01412 CFT014
     C***********          MOVEA*BLANKS   #ER                      S01412 CFT014
     C***********1         DO   6         #T      50               S01412 CFT014
      ***********                                                  S01412 CFT014
      ***Set*flag*to*show*line*correct*and*move*data*to*work*fieldsS01412 CFT014
      ***********                                                  S01412 CFT014
     C***********          MOVE 'F'       SSF     1                S01412 CFT014
     C***********35        SUBSTS5BTB:#S  I#FLD                    S01412 CFT014
      ***********                                                  S01412 CFT014
      ***If*not*equal*to*blanks*validate***************************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********I#FLD     IFNE *BLANKS                            S01412 CFT014
      ***********                                                  S01412 CFT014
      **If*line*is*not*blank*then*first*position*must*be*a*"/"*****S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********1         SUBSTI#FLD:1   ##001   1                S01412 CFT014
      ***********                                                  S01412 CFT014
      ***First*position*must*be*a*'/'******************************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********##001     IFNE '/'                                S01412 CFT014
     C***********          MOVEA'Y'       #ER,#T                   S01412 CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          MOVEL*BLANKS   FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2171' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          ELSE                                    S01412 CFT014
      ***********                                                  S01412 CFT014
      ***The*first*special*instruction*line*cannot*have*'/'********S01412 CFT014
      ***in*position*2*********************************************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********#S        IFEQ 1                                  S01412 CFT014
     C***********1         SUBSTI#FLD:2   ##001   1                S01412 CFT014
     C***********##001     IFEQ '/'                                S01412 CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          MOVEL*BLANKS   FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2172' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEA'Y'       #ER,#T                   S01412 CFT014
     C***********          END                                     S01412 CFT014
     C***********          END                                     S01412 CFT014
      ***********                                                  092396 CFT014
      ***2nd*-*6th*special*instruction*line*cannot*have*'/'********092396 CFT014
      ***in*position*2*followed*by*a*narrative*of*blanks.**********092396 CFT014
      ***********                                                  092396 CFT014
     C***********#S        IFNE 1                                  092396 CFT014
     C***********1         SUBSTI#FLD:2   POS02   1                092396 CFT014
     C***********33        SUBSTI#FLD:3   NARR   33                092396 CFT014
     C***********POS02     IFEQ '/'                                092396 CFT014
     C***********NARR      ANDEQ*BLANKS                            092396 CFT014
     C***********          MOVEL'Y'       E#MSGS                   092396 CFT014
     C***********          MOVEL'Y'       E#NOUP                   092396 CFT014
     C***********          MOVEL*BLANKS   FTMSDT                   092396 CFT014
     C***********          MOVELE#CPGM    FTPGMQ                   092396 CFT014
     C***********          MOVEL'FTM2170' FTMSID                   092396 CFT014
     C***********          EXSR FTSNMS                             092396 CFT014
     C***********          MOVEA'Y'       #ER,#T                   092396 CFT014
     C***********          END                                     092396 CFT014
     C***********          END                                     092396 CFT014
      ***********                                                  092396 CFT014
      ***Check*the*line*for*'8a/',*where*8a*represents*************S01412 CFT014
      ***up*to*eight*upper*case*alphabetic*charaters***************S01412 CFT014
      ***********                                                  S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********          Z-ADD2         #R      30               S01412 CFT014
     C***********ALPHAB    CHECKI#FLD:#R  #R                       S01412 CFT014
     C***********#R        IFGE 11                                 S01412 CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          MOVEL*BLANKS   FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2173' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEA'Y'       #ER,#T                   S01412 CFT014
     C***********          END                                     S01412 CFT014
      ***********                                                  S01412 CFT014
      ***If*#R*less*than*eleven*then*this*character*must*be*"/"****S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********#R        IFLT 11                                 S01412 CFT014
     C***********1         SUBSTI#FLD:#R  ##001                    S01412 CFT014
     C***********##001     IFNE '/'                                S01412 CFT014
     C***********          MOVEL'Y'       E#MSGS                          CFT014
     C***********          MOVEL'Y'       E#NOUP                          CFT014
     C***********          MOVEL*BLANKS   FTMSDT                          CFT014
     C***********          MOVELE#CPGM    FTPGMQ                          CFT014
     C***********          MOVEL'FTM2174' FTMSID                          CFT014
     C***********          EXSR FTSNMS                                    CFT014
     C***********          MOVEA'Y'       #ER,#T                   S01412 CFT014
     C***********          END                                     S01412 CFT014
     C***********          END                                     S01412 CFT014
     C***********          END                                     S01412 CFT014
     C***********          END                                     S01412 CFT014
      ***********                                                  S01412 CFT014
      **Move*pointer*on*35*characters******************************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********          ADD  35        #S                       S01412 CFT014
     C***********          ENDDO                                   S01412 CFT014
      ***********                                                  S01412 CFT014
      **Move*array*of*errors*to*I5BTB******************************S01412 CFT014
      ***********                                                  S01412 CFT014
     C***********          MOVEA#ER       ##006   6                S01412 CFT014
     C***********          MOVE ##006     I5BTB                    S01412 CFT014
      ***********                                                         CFT014
      ***Unwind*subroutine*stack*name**********************************   CFT014
      ***********                                                         CFT014
     C***********EXSEPT    TAG                                            CFT014
     C***********          MOVEA*BLANKS   @STK,Q                          CFT014
     C***********          SUB  1         Q                               CFT014
      ***********                                                         CFT014
     C***SR******             ENDSR                                       CFT014
     C***/EJECT**                                                         CFT014
      *****************************************************************
      *                                                               *
      *  SRXVAL   : Cross validations                                 *
      *                                                               *
      *  CALLED BY: SRPROC - Control Process of Validation            *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRXVAL    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRXVAL'  @STK,Q
      *
      *  /COPY Statement
      *
     C/COPY WNCPYSRC,FT0347XVAL
      *
      ** If V#ORC1 is keyword MT202 and customer number in Beneficiary
      ** this customer must be a bank
      *
     C           V#ORC1    IFEQ ORCFLD
     C           F5BNCT    ANDEQ'C'
      *
      ** Read SDCUSTPD for bank details
      *
     C                     MOVELS5BNC     ADDRSS
      *
      *  First 10 characters should be key for SDCUST
      *
     C           ADSLSH    IFNE '/'
     C                     MOVELS5BNC1    @CNUM
     C                     ELSE
     C                     MOVELS5BNC2    @CNUM
     C                     END
      *
     C                     CALL 'AOCUSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CNUM  10
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM *BLANKS   DSSDY
      *
      *  If error on CALL - process as database error
      *
     C           *IN90     IFEQ '1'
     C           @RTCD     ORNE *BLANKS
     C                     MOVEL'AOCUSTR0'W0FILE           ***************
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 45 *
     C                     Z-ADD45        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Ordering Bank must be a bank
      *
     C           BBBNBI    IFNE 'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'Y'       E#NOUP
     C                     MOVELS5BNC1    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2112' FTMSID
     C                     EXSR FTSNMS
     C                     GOTO EXXVAL
     C                     END
      *
     C                     END
      *****************************************************************   CSW096
      ***********                                                  CSW096 CFT014
      **Call*Bank*to*Bank*Validation*object************************CSW096 CFT014
      ***********                                                  CSW096 CFT014
      **Set*up*parameters******************************************CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          MOVEL*BLANKS   W0RTN                    CSW096 CFT014
     C***********          CLEARI#PARM                             CSW096 CFT014
      **Set*up*Control*fields**************************************CSW096 CFT014
     C***********          MOVEL':72: '   I#VFLD                   CSW096 CFT014
     C***********          MOVEL'PAY'     I#PR                     CSW096 CFT014
      **Set*up*Currency*fields*************************************CSW096 CFT014
     C***********          MOVELV#PCCY    I#PCCY                   CSW096 CFT014
     C***********          MOVELV#SMCY    I#RCCY                   CSW096 CFT014
      * Set up Intermediary                                        CSW096 CFT014
     C*****      PMPIBN    IFNE *BLANKS                                   CSW096
     C*****                MOVEL'X'       I#INBT                          CSW096
     C*****                MOVELPMPIBN    I#INBK                          CSW096
     C*****                ENDIF                                          CSW096
      **Set*up*Account*with*Bank***********************************CSW096 CFT014
     C***********F5ACBT    IFNE *BLANKS                            CSW096 CFT014
     C***********          MOVELF5ACBT    I#AWBT                   CSW096 CFT014
     C***********          MOVELS5ACB1    ##001A  1                CSW096 CFT014
     C***********##001A    IFEQ '/'                                CSW096 CFT014
     C***********          MOVELS5ACB2    I#AWBK                   CSW096 CFT014
     C***********          ELSE                                    CSW096 CFT014
     C***********          MOVELS5ACB1    I#AWBK                   CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
      **Set*up*Beneficiary*****************************************CSW096 CFT014
     C***********F5BNCT    IFNE *BLANKS                            CSW096 CFT014
     C***********          MOVELF5BNCT    I#BENT                   CSW096 CFT014
     C***********          MOVELS5BNC     ##001A  1                CSW096 CFT014
     C***********##001A    IFEQ '/'                                CSW096 CFT014
     C***********          MOVELS5BNC     I#BENF                   CSW096 CFT014
     C***********          ELSE                                    CSW096 CFT014
     C***********          MOVELS5BNC     I#BENF                   CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
      **Move*in*Bank*to*Bank*Information***************************CSW096 CFT014
     C***********          MOVELS5BTB     I#BTB                    CSW096 CFT014
     C***********          MOVELV#STMT    I#PSTM                   CSW096 CFT014
     C***********          MOVEL*BLANKS   I#RSTM                   CSW096 CFT014
      **Set*up*Receive/Settle*account*information******************CSW096 CFT014
     C***********          MOVELV#FRGL    I#RCAC                   CSW096 CFT014
      **Set*up*Pay*account*information*****************************CSW096 CFT014
     C***********          MOVELV#TOGL    I#PYAC                   CSW096 CFT014
      **If*extra*message*and*Rec*Corr.*then*set*5354*field*********CSW096 CFT014
     C***********V#SNCT    IFNE *BLANKS                            CSW096 CFT014
     C***********F5RCOT    ANDNE*BLANKS                            CSW096 CFT014
     C***********          MOVEL'Y'       I#5354                   CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
      **Transaction*Type*******************************************CSW096 CFT014
     C***********          MOVEL'OP'      I#TTYP                   CSW096 CFT014
      **Covered*Required*******************************************CSW096 CFT014
     C***********          MOVELV#SNMT    I#COVR                   CSW096 CFT014
      ***********                                                  CSW096 CFT014
      **Set*up*message*type****************************************CSW096 CFT014
     C***********          SELEC                                   CSW096 CFT014
     C***********V#ORC1    WHEQ ORCFLD                             CSW096 CFT014
     C***********          MOVEL'202'     I#MTYP                   CSW096 CFT014
     C***********          OTHER                                   CSW096 CFT014
     C***********          MOVEL'100'     I#MTYP                   CSW096 CFT014
     C***********          ENDSL                                   CSW096 CFT014
     C***********          CLEARO#PARM                             CSW096 CFT014
     C***********          CLEARX#PARM                             CSW096 CFT014
      ***********                                                  CSW096 CFT014
      **Send*messages*to*correct*calling*process*******************CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          MOVELE#CPGM    X#CPGM                   CSW096 CFT014
     C***********          MOVEL'FT'      I#MMOD                   CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          MOVEL'MEC0114' X#MSGD                   CSW096 CFT014
     C***********          MOVEL'MEMSG'   X#MSGF                   CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          CALL 'ME9950'                           CSW096 CFT014
     C***********          PARM           W0RTN   7                CSW096 CFT014
     C***********          PARM           I#PARM           I Input CSW096 CFT014
     C***********          PARM           O#PARM           O OutputCSW096 CFT014
     C***********          PARM           X#PARM           E Error CSW096 CFT014
     C***********          PARM           Z#PARM256        B User DCSW096 CFT014
      ***********                                                  CSW096 CFT014
      **On*return*if*errors*copy*into*error*array******************CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          MOVELO#BTB     S5BTB                    CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********X#ERRM    IFNE *BLANKS                            CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          MOVE X#FLDS    I5BTB                    CSW096 CFT014
     C***********          MOVEL'Y'       E#MSGS                   CSW096 CFT014
     C***********          MOVEL'Y'       E#NOUP                   CSW096 CFT014
      ***********                                                  CSW096 CFT014
     C***********          ENDIF                                   CSW096 CFT014
      *                                                                   CSW096
      *****************************************************************   CSW096
      *
      *  Unwind subroutine stack name
      *
     C           EXXVAL    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/COPY WNCPYSRC,FT0347C029
     E/COPY FTCPYSRC,SFTADDRC
     E/COPY FTCPYSRC,SFTADDRSC
     E/COPY FTCPYSRC,SFTSWFTC
     E/COPY FTCPYSRC,SFTSNMSC
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRACT    : Undefined action - error                          *
      *                                                               *
      *  CALLED BY: Main Processing                                   *
      *                                                               *
      *  CALLS    : SRERR   - report error and close down program     *
      *                                                               *
      *****************************************************************
     CSR         SRACT     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRACT '  @STK,Q
      *
      *  Database error undefined action
      *
     C                     MOVEL'*ACTION 'W0FILE           ***************
     C                     MOVELW0ACT     W0KEY            * DB ERROR 07 *
     C                     Z-ADD7         W0ERNB           ***************
     C                     MOVEL'MEM5006' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
      *
      *  Unwind subroutine stack name
      *
     C           EXACT     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SROUFM - Retrieve Outgoing Message Field Management          *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SRBNC                                             *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SROUFM    BEGSR                                                              CFT032
      *                                                                                       CFT032
      ** Set up subroutine stack name                                                         CFT032
      *                                                                                       CFT032
     C                     ADD  1         Q                                                   CFT032
     C                     MOVEL'SROUFM'  @STK,Q                                              CFT032
      *                                                                                       CFT032
      ** Account Input?                                                                       CFT032
      *                                                                                       CFT032
     C                     MOVE 'N'       WACCIN  1                                           CFT032
     C********** F5INBT    IFEQ 'I'                                                  CFT032 BUG14771
     C********** F5INBT    OREQ 'G'                                                  CFT032 BUG14771
     C********** F5INBT    OREQ 'F'                                                  CFT032 BUG14771
     C********** F5INBT    OREQ 'R'                                                  CFT032 BUG14771
     C           F5BNCT    IFEQ 'I'                                                         BUG14771
     C           F5BNCT    OREQ 'G'                                                         BUG14771
     C           F5BNCT    OREQ 'F'                                                         BUG14771
     C           F5BNCT    OREQ 'R'                                                         BUG14771
     C                     MOVE 'Y'       WACCIN                                              CFT032
      *                                                                                       CFT032
      ** Retrive Customer Details                                                             CFT032
      *                                                                                       CFT032
     C                     MOVELCNUM      @KEY1  10 P                                         CFT032
     C                     EXSR SRCUST                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Message Tag                                                                          CFT032
      *                                                                                       CFT032
     C********** F5INBT    IFEQ 'S'                                                  CFT032 BUG14771
     C********** F5INBT    OREQ 'C'                                                  CFT032 BUG14771
     C           F5BNCT    IFEQ 'S'                                                         BUG14771
     C           F5BNCT    OREQ 'C'                                                         BUG14771
     C           WACCIN    OREQ 'Y'                                                           CFT032
     C           CSW024    ANDEQ'N'                                                           CFT032
     C           BBCSID    ANDNE*BLANKS                                                       CFT032
     C           WACCIN    OREQ 'Y'                                                           CFT032
     C           CSW024    ANDEQ'Y'                                                           CFT032
     C           BBCBEI    ANDNE*BLANKS                                                       CFT032
     C                     MOVE ':59A:'   @MSGTG                                              CFT032
     C                     ELSE                                                               CFT032
     C                     MOVE ':59: '   @MSGTG                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Network                                                                              CFT032
      *                                                                                       CFT032
     C                     MOVE *BLANKS   @NTWRK                                              CFT032
     C                     SELEC                                                              CFT032
     C           V#STMT    WHEQ '08'                                                          CFT032
     C                     MOVEL'SWIFT'   @NTWRK                                              CFT032
     C           V#STMT    WHEQ '01'                                                          CFT032
     C**********           MOVEL'Telex'   @NTWRK                                     CFT032 BUG14771
     C                     MOVEL'TELEX'   @NTWRK                                            BUG14771
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
      ** Message Type                                                                         CFT032
      *                                                                                       CFT032
     C                     MOVE '103'     @MSGTP                                              CFT032
      *                                                                                       CFT032
      ** Country of Location                                                                  CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           V#DSTT    WHEQ 'A'                                                           CFT032
     C                     MOVE *BLANKS   @CNTLC                                              CFT032
     C           V#DSTT    WHEQ 'S'                                                           CFT032
     C********** 2         SUBSTWOCUST:5  @CNTLC                                     CFT032 BUG14771
     C           2         SUBSTV#DST1:5  @CNTLC                                            BUG14771
     C                     OTHER                                                              CFT032
     C                     MOVELV#DST1    WOCUST                                            BUG14771
     C                     EXSR SRCNTL                                                        CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
      ** Nostro Number                                                                        CFT032
      *                                                                                       CFT032
     C                     MOVE *BLANKS   @NOSTN                                              CFT032
     C                     MOVE *BLANKS   ADDRSS                                            BUG14771
      *                                                                                       CFT032
     C********** V#SNC1    IFNE *BLANK                                               CFT032 BUG14771
     C**********           MOVELV#SNC1    @NOSTN                                     CFT032 BUG14771
     C**********           ELSE                                                      CFT032 BUG14771
     C**********           MOVELV#DST1    @NOSTN                                     CFT032 BUG14771
     C**********           ENDIF                                                     CFT032 BUG14771
      *                                                                                       CFT032
     C**********           MOVELADPCNM    @CUST                                      CFT032 BUG14771
     C**********           MOVELV#PCCY    @CYCD                                      CFT032 BUG14771
     C**********           MOVELADPACD    @ACCD                                      CFT032 BUG14771
     C**********           MOVELADPASQ    @ACSN                                      CFT032 BUG14771
     C                     MOVEL@NOSTN    @NONB                                               CFT032
      *                                                                                     BUG14771
     C                     MOVELV#TOGL    IMACNT                                            BUG14771
     C                     MOVELIMCNUM    @CUST                                             BUG14771
     C                     MOVELIMCCY     @CYCD                                             BUG14771
     C                     MOVELIMACOD    @ACCD                                             BUG14771
     C                     MOVELIMACSQ    @ACSN                                             BUG14771
     C                     MOVELADGBRC    @BRCD                                               CFT032
      *                                                                                       CFT032
     C                     CALL 'AONOSTR0'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @CUST   6                                           CFT032
     C                     PARM           @CYCD   3                                           CFT032
     C                     PARM           @ACCD  10                                           CFT032
     C                     PARM           @ACSN   2                                           CFT032
     C                     PARM           @NONB   2                                           CFT032
     C                     PARM           @BRCD   3                                           CFT032
     C                     PARM           @CSSN  10                                           CFT032
     C                     PARM           @PNOI   1                                           CFT032
     C                     PARM *BLANKS   DSFDY                                               CFT032
      *                                                                                       CFT032
     C           @RTCD     IFNE *BLANK                                                        CFT032
     C                     MOVE *BLANK    @NOSTN                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Action                                                                               CFT032
      *                                                                                       CFT032
     C                     MOVE CACNT1    @ACTNF                                              CFT032
      *                                                                                       CFT032
      ** Call Access program                                                                  CFT032
      *                                                                                       CFT032
     C                     MOVELBRCA      BRCA4A                                            BUG14042
     C                     MOVEL@CNTLC    CTRY4A                                            BUG14042
     C                     CALL 'AOOUFMR0'PLOUFM                                              CFT032
      *                                                                                       CFT032
      ** If no error                                                                          CFT032
      *                                                                                       CFT032
     C           @RTRN     IFEQ *BLANKS                                                       CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C********** OMAACT    WHEQ *BLANKS                                              CFT032 BUG14042
     C**********           MOVE 'O'       OMAACT                                     CFT032 BUG14042
     C           OMFLAG    WHEQ *BLANKS                                                     BUG14042
     C                     MOVE 'O'       OMFLAG                                            BUG14042
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'M'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'M'                                                         BUG14042
     C           ADSLSH    IFNE '/'                                                           CFT032
     C                     MOVEL'MMA1417' FTMSID                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXOUFM                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C*********  OMAACT    WHEQ 'W'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'W'                                                         BUG14042
     C           ADSLSH    IFNE '/'                                                           CFT032
     C                     MOVEL'MMA1414' FTMSID                                              CFT032
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'P'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'P'                                                         BUG14042
     C           ADSLSH    IFEQ '/'                                                           CFT032
     C                     MOVEL'MMA1419' FTMSID                                              CFT032
     C                     MOVEL'Y'       E#WARN                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** IBAN numbers                                                                         CFT032
      *                                                                                       CFT032
     C           CFT004    IFEQ 'Y'                                                           CFT032
     C                     MOVE CACNT2    @ACTNF                                              CFT032
     C                     MOVELBRCA      BRCA4A                                            BUG14042
     C                     MOVEL@CNTLC    CTRY4A                                            BUG14042
     C                     CALL 'AOOUFMR0'PLOUFM                                              CFT032
     C           @RTRN     IFEQ *BLANKS                                                       CFT032
     C                     SELEC                                                              CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ *BLANKS                                              CFT032 BUG14042
     C**********           MOVE 'O'       OMAACT                                     CFT032 BUG14042
     C           OMFLAG    WHEQ *BLANKS                                                     BUG14042
     C                     MOVE 'O'       OMFLAG                                            BUG14042
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'M'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'M'                                                         BUG14042
     C           @@IBAN    IFEQ 'N'                                                           CFT032
     C                     MOVEL'MMA1420' FTMSID                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXOUFM                                                        CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C********** OMAACT    WHEQ 'W'                                                  CFT032 BUG14042
     C           OMFLAG    WHEQ 'W'                                                         BUG14042
     C           @@IBAN    IFEQ 'N'                                                           CFT032
     C                     MOVEL'MMA1421' FTMSID                                              CFT032
     C                     MOVEL'Y'       E#MSGS                                              CFT032
     C                     MOVELE#CPGM    FTPGMQ                                              CFT032
     C                     MOVEL'DRSMM   'FTMSGF                                            BUG14771
     C                     EXSR FTSNMS                                                        CFT032
     C                     MOVEL'Y'       E#NOUP                                              CFT032
     C                     GOTO EXOUFM                                                        CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Unwind subroutine stack name                                                         CFT032
      *                                                                                       CFT032
     C           EXOUFM    TAG                                                                CFT032
     C                     MOVEA*BLANKS   @STK,Q                                              CFT032
     C                     SUB  1         Q                                                   CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRCNTL   - Retrieve Country of location                      *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SROUFM Subroutine                                 *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRCNTL    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C**********           MOVE *BLANKS   @CNTLC                                     CFT032 BUG14042
     C                     MOVE *BLANKS   @CNTLC  2                                         BUG14042
      *                                                                                       CFT032
     C                     CALL 'AOACCTV1'                                                    CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM *BLANKS   @TYP    7                                           CFT032
     C                     PARM           WOCUST 35                                           CFT032
     C                     PARM           DSSDY                                               CFT032
      *                                                                                       CFT032
     C                     SELEC                                                              CFT032
     C           @TYP      WHEQ '*RETAIL'                                                     CFT032
     C           @TYP      OREQ '*LEDGER'                                                     CFT032
     C                     MOVELDSSDY     OACCNT                                              CFT032
     C                     MOVELCNUM      WCUST   6                                           CFT032
     C           @TYP      WHEQ '*NOSTRO'                                                     CFT032
     C                     MOVELDSSDY     SDNOST                                              CFT032
     C                     MOVELA7CUST    WCUST                                               CFT032
     C           @TYP      WHEQ '*CUSTNO'                                                     CFT032
     C           @TYP      OREQ '*SHNAME'                                                     CFT032
     C                     MOVELDSSDY     SDCUST                                              CFT032
     C                     MOVELBBCUST    WCUST                                               CFT032
     C                     ENDSL                                                              CFT032
      *                                                                                       CFT032
     C                     MOVELWCUST     @KEY1     P                                         CFT032
     C                     EXSR SRCUST                                                        CFT032
      *                                                                                       CFT032
     C           @RTCD     IFEQ *BLANKS                                                       CFT032
     C                     MOVELBBCOLC    @CNTLC                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CFT032
      *                                                                                       CFT032
      *****************************************************************                       CFT032
      *                                                               *                       CFT032
      *  SRCUST   - Check for Customer                                *                       CFT032
      *                                                               *                       CFT032
      *  Called By: SROUFM, SRCNTL                                    *                       CFT032
      *                                                               *                       CFT032
      *  Calls: None                                                  *                       CFT032
      *                                                               *                       CFT032
      *****************************************************************                       CFT032
      *                                                                                       CFT032
     C           SRCUST    BEGSR                                                              CFT032
      *                                                                                       CFT032
     C                     CALL 'AOCUSTR0'             9090                                   CFT032
     C                     PARM *BLANKS   @RTCD                                               CFT032
     C                     PARM '*KEY   ' @OPTN                                               CFT032
     C                     PARM           @KEY1                                               CFT032
     C                     PARM *BLANKS   @KYST                                               CFT032
     C           SDCUST    PARM *BLANKS   DSSDY                                               CFT032
      *                                                                                       CFT032
      ** If error on call                                                                     CFT032
      *                                                                                       CFT032
     C           *IN90     IFEQ *ON                                                           CFT032
     C                     MOVEL'AOCUSTR0'W0FILE                                              CFT032
     C                     MOVEL'*CALL'   W0KEY                                               CFT032
     C                     Z-ADD9         W0ERNB                                              CFT032
     C                     MOVEL'MEM5003' W0MSGD                                              CFT032
     C                     MOVEL'MIDAS  ' W0MSGF                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     ENDSR                                                              CFT032
     C/EJECT                                                                                  CSW215
      *****************************************************************                       CSW215
      *                                                               *                       CSW215
      *  VAL59  : VALIDATE 59F FORMAT                                 *                       CSW215
      *                                                               *                       CSW215
      *  CALLED BY: SRBNC - Validate Beneficiary                      *                       CSW215
      *                                                               *                       CSW215
      *  CALLS    : MG001001                                          *                       CSW215
      *                                                               *                       CSW215
      *****************************************************************                       CSW215
     CSR         VAL59F    BEGSR                                                              CSW215
      *                                                                                       CSW215
     C                     CALL 'MG001001'                                                    CSW215
     C                     PARM *BLANKS   PRTCD   7                                           CSW215
     C                     PARM 'TRAN'    PCLFR   4                                           CSW215
     C                     PARM           S5BNC1                                              CSW215
     C                     PARM           S5BNC2                                              CSW215
     C                     PARM           S5BNC3                                              CSW215
     C                     PARM           S5BNC4                                              CSW215
     C                     PARM           S5BNC5                                              CSW215
     C                     PARM V#NWRK    PNWRK   6                                           CSW215
     C                     PARM '103'     PTYPE   3                                           CSW215
     C                     PARM ':59F:'   PTAG    5                                           CSW215
     C                     PARM           PBRCH   3                                           CSW215
     C                     PARM @CNTLC    PCNTY   2                                           CSW215
     C                     PARM V#PCCY    PCURR   3                                           CSW215
     C                     PARM @NOSTN    PNOST   2                                           CSW215
     C                     PARM *BLANKS   POUT1  35                                           CSW215
     C                     PARM *BLANKS   POUT2  35                                           CSW215
     C                     PARM *BLANKS   POUT3  35                                           CSW215
     C                     PARM *BLANKS   POUT4  35                                           CSW215
     C                     PARM *BLANKS   POUT5  35                                           CSW215
     C                     PARM *BLANKS   PMSGID  7                                           CSW215
     C                     PARM *BLANKS   PERRT   1                                           CSW215
      *                                                                                       CSW215
     C           PRTCD     IFEQ '*ERROR'                                                      CSW215
      *                                                                                       CSW215
     C           PERRT     IFEQ 'W'                                                           CSW215
     C                     MOVEL'Y'       E#WARN                                              CSW215
     C                     ELSE                                                               CSW215
     C                     MOVEL'Y'       E#NOUP                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     MOVELPMSGID    FTMSID                                              CSW215
     C                     MOVELE#CPGM    FTPGMQ                                              CSW215
     C                     MOVEL'Y'       E#MSGS                                              CSW215
     C                     MOVEL'Y'       I5BNC1                                              CSW215
     C                     MOVEL'Y'       I5BNC2                                              CSW215
     C                     MOVEL'Y'       I5BNC3                                              CSW215
     C                     MOVEL'Y'       I5BNC4                                              CSW215
     C                     MOVEL'Y'       I5BNC5                                              CSW215
     C                     MOVEL'GBMEMSG' FTMSGF                                              CSW215
      *                                                                                       CSW215
     C                     EXSR FTSNMS                                                        CSW215
     C                     ENDIF                                                              CSW215
     C                     ENDSR                                                              CSW215
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT   : Initialise and define fields                      *
      *                                                               *
      *  CALLED BY: Main processing                                   *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRINIT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *  Set up copyright statement
      *
     C                     MOVEACPY@      BIS@   80
      *
      *  Indicate that set up is complete
      *
     C                     SETON                     50
      *
      *  Open Files
      *
     C***********          OPEN ACCNT                                     CFT014
     C***********          OPEN ACNUMA                                    CFT014
      *
      *  Get Rundate information
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
      *
      *  Set up MT202 compare variable
      *
     C           *LIKE     DEFN V#ORC1    ORCFLD
     C                     MOVEL*BLANKS   ORCFLD
     C                     MOVEL'MT202'   ORCFLD
     C/COPY WNCPYSRC,FT0347C032
      *                                                                   CFT004
      ** Access SAR details file to see if CFT004 is installed.           CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   P@RTCD  7                       CFT004
     C                     PARM '*VERIFY' P@OPTN  7                       CFT004
     C                     PARM 'CFT004'  P@SARD  6                       CFT004
     C           SCSARD    PARM *BLANKS   DSFDY                           CFT004
      *                                                                   CFT004
      ** Allow IBAN processing                                            CFT004
      *                                                                   CFT004
     C           P@RTCD    IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C                     END                                            CFT004
      *                                                                   CFT014
      ** Determine if SAR CFT014 MT103 Message Generation is ins -        CFT014
      ** talled.                                                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*VERIFY 'P@OPTN                          CFT014
     C                     PARM 'CFT014'  P@SARD                          CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C           P@RTCD    ANDNE'*NRF   '                                 CFT014
     C                     MOVEL'SCSARDPD'W0FILE                          CFT014
     C                     Z-ADD11        W0ERNB                          CFT014
     C                     MOVEL'CFT014'  W0KEY                           CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           P@RTCD    IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014  1                       CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       CFT014                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CFT032
      ** Access SAR details to see if CSW024 is enabled.                                      CFT032
      *                                                                                       CFT032
     C                     CALL 'AOSARDR0'                                                    CFT032
     C                     PARM *BLANKS   P@RTCD                                              CFT032
     C                     PARM '*VERIFY' P@OPTN                                              CFT032
     C                     PARM 'CSW024'  P@SARD                                              CFT032
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT032
      *                                                                                       CFT032
     C           P@RTCD    IFNE *BLANKS                                                       CFT032
     C           P@RTCD    ANDNE'*NRF   '                                                     CFT032
     C                     MOVEL'CSW024'  W0KEY                                               CFT032
     C                     MOVEL'SCSARDPD'W0FILE                                              CFT032
     C                     Z-ADD14        W0ERNB                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           P@RTCD    IFEQ *BLANKS                                                       CFT032
     C                     MOVEL'Y'       CSW024  1                                           CFT032
     C                     ELSE                                                               CFT032
     C                     MOVEL'N'       CSW024                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      ** Call Access Program for Bank Details                                                 CFT032
      *                                                                                       CFT032
     C                     CALL 'AOBANKR0'                                                    CFT032
     C                     PARM *BLANKS   P@RTCD                                              CFT032
     C                     PARM '*FIRST ' P@OPTN                                              CFT032
     C           SDBANK    PARM SDBANK    DSFDY                                               CFT032
      *                                                                                       CFT032
      ** Handle Database Error                                                                CFT032
      *                                                                                       CFT032
     C           P@RTCD    IFNE *BLANK                                                        CFT032
     C                     MOVEL'SDBANKPD'W0FILE                                              CFT032
     C                     MOVEL'*FIRST ' W0KEY                                               CFT032
     C                     Z-ADD12        W0ERNB                                              CFT032
     C                     EXSR SRERR                                                         CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
      *                                                                                       CSW202
      ** Check if switchable feature CSW202 is switched on                                    CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   P@RTCD                                              CSW202
      *                                                                                       CSW202
     C           P@RTCD    IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW203
      ** Check if SWIFT Changes 2003 (CSW203) is installed                                    CSW203
      *                                                                                       CSW203
     C                     CALL 'SWIF2003'                                                    CSW203
     C                     PARM *BLANKS   P@RTCD                                              CSW203
      *                                                                                       CSW203
     C           P@RTCD    IFEQ 'CSW2003'                                                     CSW203
     C                     MOVE 'Y'       CSW203  1                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'N'       CSW203                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW202
      ** Check if switchable feature CSW215 is on                                             CSW215
      *                                                                                       CSW215
     C                     CALL 'SWIF2015'                                                    CSW215
     C                     PARM *BLANKS   PRTCD                                               CSW215
      *                                                                                       CSW215
     C           PRTCD     IFEQ 'CSW2015'                                                     CSW215
     C                     MOVE 'Y'       CSW215  1                                           CSW215
     C                     ELSE                                                               CSW215
     C                     MOVE 'N'       CSW215                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C/COPY WNCPYSRC,FT0347C049
      *
      *  Unwind subroutine stack name
      *
     C           EXINIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C/COPY WNCPYSRC,FT0347C031
     CSR                   ENDSR
     C/COPY WNCPYSRC,FT0347DCPG
      *
      *  /Copy point for Calculations
      *
     C**
     C/EJECT
      *
      *  File and Program Error Processing
      *
     C/COPY FTCPYSRC,SRERRC
     C/EJECT
     O/COPY WNCPYSRC,FT0347DOPG
      *
      *  /Copy point for Outputs
      *
     O/EJECT
**  CPY@ table
(c) Finastra International Limited 2001
**   ALPH  - Array of alphabetic                                          CFT004
ABCDEFGHIJKLMNOPQRSTUVWXYZ
**   NUMC  - Array of numeric                                             CFT004
1234567890
     X/COPY WNCPYSRC,FT0347X001
