     H        1
      *****************************************************************
/*XBIA*  OVRDBF INPAYL1 INPAY                                         *
/*XBIB*  OVRDBF INPAYL0 INPAY                                         *
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Incoming payments maintenance level one')     *
      *****************************************************************
      *                                                               *
      *  Midas - Funds Transfer Module                                *
      *                                                               *
      *  FT0355 - FT Incoming Maintenance Level 2                     *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 254598             Date 20Feb20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CFT050             Date 03Jun13               *
      *                 222568             Date 24Jan13               *
      *                 CFT120             Date 28Sep12               *
      *                 CLE134             Date 01Aug12               *
      *                 CER049             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      *                 BUG24998           Date 17Jul09               *
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15201           Date 30Oct07               *
      *                 250600             Date 07Oct07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CSW206             Date 03Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG433             Date 05Dec05               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 219241             Date 01Jul03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 202914             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CFT017             Date 08Nov01               *
      *                 193190             Date 27Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 18Aug00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187056             Date 01Dec00               *
      *                 183723             Date 04Oct00               *
      *                 CFT014             Date 25May00               *
      *                 CAP136             Date 14Aug00               *
      *                 133860             Date 22May98               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT007             Date 05Nov99               *
      *                 CFT004             DATE 27Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 126281             DATE 04OCT98               *
      *                 CEU006             Date 05May98               *
      *                 122060             Date 31Oct97               *
      *                 119049             Date 24Sep97               *
      *                 100660             Date 06May97               *
      *                 096486             DATE 03APR97               *
      *                 CRT002             Date 01DEC95               *
      *                 S01408             DATE 03OCT96               *
      *                 CAC001             DATE 01FEB96               *
      *                 S01408             DATE 04SEP95               *
      *                 CPK001             DATE 03MAY94               *
      *                 S01408             DATE 12JAN95               *
      *                 S01508             DATE 27JUN94               *
      *                 S01506             DATE 27JUN94               *
      *                 S01499             DATE 06JUN94               *
      *                 S01494             DATE 25MAY94               *
      *                 068347             DATE 18MAR94               *
      *                 068320             DATE 17MAR94               *
      *                 S01435             DATE 11OCT93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  254598 - Increase length of DP32B and DATA2 (JMI106/113)     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CFT050 - SWIFTRef Directories upload                         *
      *  222568 - In Charge details 2 tab, charges on the left and    *
      *           right hand side of the screen is incorrect          *
      *         - Applied for AR1080200                               *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *           (Recompile)                                         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CER049 - Stamp Tax                                           *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  BUG24998 - Bank operation code is missing (Recompile)        *
      *  CSW209 - SWIFT 2009 Changes (Recompile)                      *
      *  BUG15201 - Encounter Database Errors (Recompile)             *
      *  250600 - Fix CFT032 and CSW207 (recompile)                  *
      *  CFT032 - Account Line in Field 50X in MT103                  *
      *  CSW206 - SWIFT 2006 Standard Changes                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG433 - Recompiled due to change in FTPCHGPD                *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value                                        *
      *  202914 - FT Incoming payment assigns wrong commision. Do the *
      *           defaulting when the user enters the third screen.   *
      *  CFT017 - Multilateral Inter-bank Exchange Fee. (Recompile)   *
      *  193190 - Move call to SUBR/SRRCAL after field F0CDRT had     *
      *           already been initialised. Also add a condition to   *
      *           execute SRRCAL only when the 'Charges to the DR of  *
      *           A/C' field had already been validated with no error.*
      *  CPK014 - Release 4 packaging.  Rename of timestamp field.    *
      *  CFT009 - Fees and Charges Development                        *
      *  187056 - IP and OP do not recalculate screen charges if      *
      *           'Charges to the Debit of a/c' has been changed      *
      *           from blank to non-blank.                            *
      *  183723 - @1DBRC must be kept the same length as #1DBRC (from *
      *           INPAYDD) to avoid error in update. Increase length  *
      *           to include new fields added for CAP136/CPB001/175479*
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *  CAP136 - Conversion of FT Incoming Payment inputs into       *
      *           modular structure to use as APIs.                   *
      *  133860 - Charges disappear when amending an incoming payment.*
      *           Fix is to remove 100660 from FT0345 and FT0355 only.*
      *  CFT007 - BIC Database Plus Integration                       *
      *  CFT004 - International Bank Account Number                   *
      *           Enable IBAN Number in field Beneficiary             *
      *  126281 - Cheque charge or swift charge displayed in proj.    *
      *           account movements with wrong sign if payment is     *
      *           cheque or swift priority is 'U'.                    *
      *           Do not reverse charges on insert.                   *
      *  CEU006 - EMU FT enhancements                                 *
      *  122060 - Drafts Issuance Function.                           *
      *  119049 - Ordering Customer should only have four fields      *
      *           (Re-compile only - fifth field now non-display in   *
      *           screen)                                             *
      *  100660 - Recalculate charges on any amend                    *
      *  096486 - Previous fix (065890)                               *
      *           Skip the SPF Action validation if program is        *
      *           triggered from GL4442 program.                      *
      *  CRT002 - Retail Branch Access.                               *
      *  S01408 - Addition of hooks FT0355CCP2                        *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           Allow F19 for Margin Information if Analytical      *
      *           Accounting is installed.                            *
      *  S01408 - Addition of hooks FT0355CCP1                        *
      *  CPK001 - R10.6 packaging. Move non-empty /COPY to QWINDSRC   *
      *  S01408 - Addition of core hook FT0355CBDU                    *
      *           Addition of core hook FT0355CISE                    *
      *  S01508 - BLI Extended Payment Charges                        *
      *  S01506 - BLI Payment Charges Enhancements                    *
      *  S01499 - BLI V.A.T. Processing                               *
      *         - Add V.A.T. amount to the charges. (TEMP25)          *
      *  S01494 - BLI Funds Transfer Enhancements                     *
      *  068347 - Suppress Account movement duplicates.               *
      *  068320 - Allow for Charge Movements                          *
      *  S01435 - Incoming Message Management                         *
      *                                                               *
      *****************************************************************
     F*EDTRCD: Cpysrc Templates Initialise Program F-spec
     F/COPY WNCPYSRC,FT0355DFPG
     FFT0355DFCF  E                    WORKSTN
     F                                              KINFDS INFDS#
     F                                              KINFSR SRFILE
      * DSP: FT Outgoing Payments Level 1
      *
     FINPAYL1 IF  E           K        DISK
     F                                              KINFDS INFDS1
     F                                              KINFSR SRFILE
     F            INPAYDDF                          KRENAME@INPAYL1
      * RTV : FT Outgoing Payments      Retrieval index
      *
     FINPAYL0 UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFSR SRFILE
     F            INPAYDDF                          KRENAME@INPAYL0
      * UPD : FT Outgoing Payments      Update index
      *
     FPYCHGDB IF  E           K        DISK         KINFSR SRFILE
      *
      * RSQ : Payment and charges details
      *
     FINPAYXL0UF  E           K        DISK         KINFSR SRFILE     UC  CFT014
     F                                              KCOMIT                CFT014
      *                                                                   CFT014
      ** Incoming Payments Details Extension update index                 CFT014
      *                                                                   CFT014
     FINPAYXL2IF  E           K        DISK         KINFSR SRFILE     UC  CFT014
      *                                                                   CFT014
      ** Incoming Payments Details Extension retrieval index              CFT014
      *                                                                   CFT009
      ** Payment Charge defintion file                                    CFT009
      *                                                                   CFT014
     FFTPCHGL0IF  E           K        DISK         KINFSR SRFILE         CFT009
      *
     F/COPY WNCPYSRC,FT0355F001
     E/EJECT
     E                    DESC    1   5 30                                CFT009
     E                    CPY@    1   1 80
     E*
     E*  Array containing Copyright statement
     E***************** FIRST COMPILE TIME ARRAY *********************
     E*
      *
      *  Error Codes Output
      *
     E                    ERCD       38  4               Codes
      *
      *  Amount change array
      *
     E                    YA1        15  1
     E                    FLDQ       10  1                                CFT009
      *                                                                                       CSC022
      ** Array to hold commitment jobs name                                                   CSC022
     E                    CMTJOB     10 10                                                    CSC022
      *
     E/COPY FTCPYSRC,SRERRE
     E*
     E*  Copysource for error processing
     E*
     E*EDTRCD: Cpysrc Templates Initialise Program E-spec
     E/COPY WNCPYSRC,FT0355DEPG
      /EJECT
     IPYCHGDDF
     I              RECI                            PYRECI
     I              CQCH                            PYCQCH
     I              CQCHD                           PYCQCD
     I              SPCH                            PYSPCH
     I              SPCHD                           PYSPCD
     I              LCD                             PYLCD
     I              CHTP                            PYCHTP
     I              LCHT                            PYLCHT
     I/COPY FTCPYSRC,SRERRI
     I/COPY FTCPYSRC,FT0010I001                                           CFT014
     I*
     I*  End of Program Error Processing copysource
     I*
     I*
     I*EDTRCD: Cpysrc Templates Initialise Program I-spec
     I/COPY WNCPYSRC,FT0355DIPG
      /EJECT
      * Data structures:
     I*                                                                   S01499
     I** V.A.T. rate                                                      S01499
     I*                                                                   S01499
     IVATDS       DS                                                      S01499
     I                                        1   3 I#BRCA                S01499
     I                                        4   9 I#CUST                S01499
     I                                    P  10  124O#VATR                S01499
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSINPAYDD
      * UPD : FT Outgoing Payments      Update index
      * Current/previous master file format fields for change control
     I              FRNT                            INFRNT                                    CAP136
     I              REPA                            INREPA                                    CAP136
     I              TMST                            XXTMST                                    CPK014
      *
      * NOTE FIELD #1DBRC MUST SAME LENGTH AS @1DBRC
      *
      * NOTE FIELD #1DBRC MUST SAME LENGTH AS @1DBRC
      *
     I***#1DBRC******DS***********************    2191                    S01494
     I***#1DBRC******DS                           2243             S01494 CAC001
     I***#1DBRC******DS                           2257             CAC001 CEU006
     I***#1DBRC******DS                           2267             CEU006 183723
     I***#1DBRC*     DS                           2345                                 183723 CSW206
     I#1DBRC      DS                           2381                                           CSW206
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     IRUNDTA    E DSRUNDAT
      *
      * Get Rundate - Rundate  *
      *
     IZMUSER    E DSZMUSER
      *
      **  Data structure to retrieve default branch
      *
     ISDMMOD    E DSSDMMODPD
      *
      * Modules Data Structure *
      *
     ISDBRCH    E DSSDBRCHPD
      *
      * Branch Data Structure *
      *
     ISDCURR    E DSSDCURRPD
      *
      * Currency details      *
      *
     ISDBANK    E DSSDBANKPD
      *
      * Bank details Structure *
      *
     ISDGELR    E DSSDGELRPD
      *
      * General Ledger Details *
      *
     ISDFTFR    E DSSDFTFRPD
      *
      * Funds Transfer Details *
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          QQACD1                                    CGL029
      *
      * Retail Details *
      *
     ISDTRAD    E DSSDTRADPD
     I              QQACCD                          QQACD2                                    CGL029
      *
      * Trading Data details
      *
     ISDDLST    E DSSDDLSTPD
      *
      * Deal Sub-types        *
      *
     ISDBOOK    E DSSDBOOKPD
      *
      * Book codes            *
      *
     ISDPRFC    E DSSDPRFCPD
      *
      * Profit Centres        *
     I**                                                                  S01494
     IP@ACCN    E DSACCNTAB                                               CFT004
     I* Account Details                                                   CFT004
     I              RECI                            IBRECI                CFT004
     I              BRCA                            IBBRCA                CFT004
     I              PRFC                            IBPRFC                CFT004
     I              LCD                             IBLCD                 CFT004
     I              CHTP                            IBCHTP                CFT004
     I              FRNT                            IBFRNT                CFT014
     I              AFRT                            IBAFRT                CFT014
     I              REPA                            IBREPA                CFT014
     I              REPI                            IBREPI                CFT014
      *                                                                   CFT004
     ISCSARD    E DSSCSARDPD                                              S01494
     I* SAR file details                                                  S01494
     I              LCD                             SCLCD                 S01494
      *                                                                                       219241
     ISDMGME    E DSSDMGMEPD                                                                  219241
      ** External Data structure for Message Management ICD.                                  219241
      *                                                                                       219241
     I/COPY WNCPYSRC,FT0355I005
      *
     IINLF      E DSMEINLFPD
      *
     IW0DATA      DS                            256
      *
      *  Define data structure used to pass parameters
      *
     I                                        1   3 B#BRCA
     I                                        4   4 O#ACTD
     I                                        5  14 O#CPGM
      *
      * Define parameters to be passed for FT IMM update
      *
     IT#CNTL      DS                            256
      *
      *  Input parameters data structure from FT0005
      *
     I                                        1   1 T#PDTI
     I                                        2   3 T#CCYI
     I                                        4   4 T#GLUI
     I                                        5   5 T#TPCI
     I*                                                                   S01499
     I** Apply V.A.T. flag indicator                                      S01499
     I*                                                                   S01499
     I                                        6   6 T#VATT                S01499
      *
     IQ#DTA       DS                            256
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     I                                        1   1 Q#ATYP
     I**********                              2  19 Q#ACCT                                    CGL029
     I**********                              2   70Q#CNU1                                    CSD027
     I                                        2   7 Q#CNU1                                    CSD027
     I                                        8  10 Q#CCY1
     I**********                             11  140Q#ACO1                                    CGL029
     I                                       15  160Q#ACS1
     I                                       17  19 Q#BRC1
     I                                        2   30Q#NOSN
     I                                        2   6 Q#NOS
     I                                        2  110Q#ACNO
     I**********                              2   70Q#CNUM                                    CSD027
     I                                        2   7 Q#CNUM                                    CSD027
     I**********                              8  110Q#ACOD                                    CGL029
     I                                       12  130Q#ACSQ
     I                                       14  16 Q#BRCA
     I                                       24  24 Q#IO
     I                                       25  27 Q#CCY
     I                                       28  29 Q#TRYP
     I                                       30  59 Q#NARR
     I                                       60  670Q#CHQN
     I                                       68  82 Q#PREF
     I                                       83  88 Q#TRN
     I                                    P  89  960Q#AMT
     I                                       97  97 Q#PRON
     I                                       98  98 Q#OLPS
     I                                       99  99 Q#MEMS
     I                                      100 100 Q#RSAC
     I                                      101 102 Q#MOD
     I                                      103 104 Q#OLRC
     I                                      105 105 Q#FTOV
     I                                    P 106 1080Q#VDAT
     I                                    P 109 1110Q#PSTD
     I                                      112 112 Q#PSTO
     I                                      113 113 Q#RPST                068347
     I                                      114 1160Q#RPNB                068347
     I                                      117 117 Q#RTYP                068347
     I                                      118 120 Q#BBRN                                    CGL029
     I                                      121 1300Q#ACO1                                    CGL029
     I                                      131 1400Q#ACOD                                    CGL029
     I                                      141 160 Q#OTR1                                    CAP204
     I                                      161 161 Q#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 Q#XRFI                                    CLE134
     I                                      165 1740Q#XRFN                                    CLE134
     I/COPY WNCPYSRC,FT0355I007
      *
     I            DS
      *  Currency, amounts and rates
     I                                        1  48 R#RCHK
     I                                        1   3 R#SMCY
     I                                        4   6 R#PCCY
     I                                        7  190R#SMAM
     I                                       20  320R#PYAM
     I                                       33  458R#RATE
     I                                       46  46 R#OVRD
     I                                       47  48 R#STMT
      *
     I/COPY MECPYSRC,SME1100P
     ISWDT2       DS                              6
      *
      *  Data structure for date change
      *
     I                                        1   2 DD
     I                                        3   4 MM
     I                                        5   6 YY
      *
     I/COPY FTCPYSRC,SFT0355S2
     I/COPY FTCPYSRC,SFT0355F2
     I/COPY FTCPYSRC,SFT0355I2
     I/COPY FTCPYSRC,SFT0355S3
     I/COPY WNCPYSRC,FT0355I001
     I/COPY FTCPYSRC,SFT0355F3
     I/COPY FTCPYSRC,SFT0355I3
      *                                                                   CFT014
     I/COPY FTCPYSRC,SFT0355S0                                            CFT014
     I/COPY FTCPYSRC,SFT0355F0                                            CFT014
     I/COPY FTCPYSRC,SFT0355I0                                            CFT014
      *
     E/COPY FTCPYSRC,SFTVALDI
      *
     IDSFDY     E DSDSFDY
      *
      * Data Structures used by Access Programs
      *
     IDSSDY     E DSDSSDY
      *
      * Data Structures used by Access Programs
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : MAP Action Code
     I                                        1   1 P1ACTC
     IP2PARM      DS                             15
      * I : MAP FT Payment Reference
     I                                        1  15 P2PREF
      * I : MAP Message Management Reference
     I                                        1   80P2MSGR
      * I : MAP Message Management Part
     I                                        9  110P2KPRT
     IP3PARM      DS                             64
      * I : MAP Link processing
     I                                        1   1 P3LINK
     I/COPY WNCPYSRC,FT0355I006
     IP4PARM      DS                             14                       CAC001
      * I : MAP Margin Info Processing                                    CAC001
     I                                    P   1   42P4FXMP                CAC001
     I                                        5   50P4FXMD                CAC001
     I                                        6   6 P4MBSI                CAC001
     I                                        7   7 P4MSIG                CAC001
     I                                    P   8  140P4MAMT                CAC001
      *                                                                   CAC001
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Invalid Action code (FT)'
      * Action Code
     I                                        1   1 ZA0001
      *
     C/COPY FTCPYSRC,SFTADDRI
      *
      * Address data structure
      *
     IDSMTR       DS
      *
      *  Define fields for message transalation
      *
     I                                        1 132 #MSDTA
     I                                       15  30 #MPREF
     I                                    P   1   20#MPART
     I                                      133 264 #MSTX1
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
      /EJECT
     IW8FT        DS                            128
      *
      * Address data structure
      *
      * Currency
     I                                        1   3 W8CCY
      * Settlement Type
     I                                        4   5 W8STMT
      * Mandatory Text - convert BIC identifiers
     I                                        6   6 W8MTXT
      * Message Tag
     I                                        7  11 W8MTAG
      * Construct of data in field
     I                                       12  12 W8TYPE
      * Number of Lines available
     I                                       13  140W8NLIN
      * Network and Message Type
     I                                       15  20 W8NWRK
     I                                       21  23 W8MTPY
      * Calling Program
     I                                       24  33 W8CPGM
      * Action *PRINT/*ENQ/*MSG GEN
     I                                       34  41 W8ACT
      * Critical reporting - Database error if 'Y'
      * If no BIC directory and BIC entered no error
     I                                       42  42 W8CRIT
      * Force Midas Address - where possible
     I                                       43  43 W8MADD
      * If Retail get first address from account
     I                                       44  44 W8RTAD
      * Alternative Address
     I                                       45  45 W8ALTN
      * Address type selected in W0MSG
     I                                       46  46 W8ADTP
      *
     I***W7DATA******DS***********************     256                    S01506
     I****W7DATA******DS                            310            S01506 CEU006
     I/COPY WNCPYSRC,FT0355I002
     I*****W7DATA      DS                            321            CEU006CFT009
     IW7DATA      DS                            399                       CFT009
     I/COPY WNCPYSRC,FT0355I003
      *
      * Payment type and subtype
     I                                        1   2 W7PYTP
     I                                        3   4 W7PYST
      *
      * Input currency and charge currency
     I                                        5   7 W7ICCY
     I                                        8  10 W7CCCY
      *
      * Settlement method
     I                                       11  12 W7STMT
      *
      * Defaults required
     I                                       13  13 W7DFRQ
      *
      * Charges branch
     I                                       14  16 W7BRCA
      *
      * Charge currency amount
     I                                       17  290W7CAMT
      *
      * Transfer Commission type
     I                                       30  30 W7TRCT
      *
      * SWIFT priority code
     I                                       31  31 W7SWPC
      *
      * Transfer Commission amount
     I                                       32  420W7TRCD
     I                                       43  530W7TRCH
      *
      * Telex charge
     I                                       54  640W7TXCD
     I                                       65  750W7TXCH
      *
      * Cheque Charge
     I                                       76  860W7CQCD
     I                                       87  970W7CQCH
      *
      * Costs Abroad
     I                                       98 1080W7CSTD
     I                                      109 1190W7CSTA
      *
      * SWIFT Priority Charge
     I                                      120 1300W7SPCD
     I                                      131 1410W7SPCH
      *
      * Miscellaneous charge
     I                                      142 1520W7MSCD
     I                                      153 1630W7MSCH
      *
      * Advice Charge
     I                                      164 1740W7ADCD
     I                                      175 1850W7ADCH
      *
      * Telephone Charge
     I                                      186 1960W7TLCD
     I                                      197 2070W7TLCH
      *
      * Collection Charge
     I                                      208 2180W7COLD
     I                                      219 2290W7COLL
      *
      * Payment amount currency
     I                                      230 232 W7PCCY
     I*                                                                   S01506
     I** Other currency                                                   S01506
     I                                      233 235 W7OCCY                S01506
     I*                                                                   S01506
     I** FX/Change commission (input ccy)                                 S01506
     I                                      236 2460W7CHCD                S01506
     I*                                                                   S01506
     I** FX/Change commission (charge ccy)                                S01506
     I                                      247 2570W7CHCM                S01506
     I*                                                                   S01506
     I** Our deductions (input ccy)                                       S01506
     I                                      258 2680W7DEDD                S01506
     I*                                                                   S01506
     I** Our deductions (charge ccy)                                      S01506
     I                                      269 2790W7DEDS                S01506
     I*                                                                   S01506
     I** Correspondent charge (input ccy)                                 S01506
     I                                      280 2900W7COCD                S01506
     I*                                                                   S01506
     I** Correspondent charge (charge ccy)                                S01506
     I                                      291 3010W7COCH                S01506
     I*                                                                   S01506
     I** Default type (HDR or DET or " ")                                 S01506
     I                                      302 304 W7DFTT                S01506
     I*                                                                   S01506
     I** Customer to be debited the charge                                S01506
     I                                      305 310 W7CUST                S01506
     I** Settle Date                                                      CEU006
     I                                      311 3150W7SLDT                CEU006
     I** Pay Date                                                         CEU006
     I                                      316 3200W7PVDT                CEU006
     I** Add/Deduct Charges                                               CEU006
     I                                      321 321 W7ADDC                CEU006
     I** CFT009 Additional charges                                        CFT009
     I                                      322 3340W7STCH                CFT009
     I                                      335 3470W7M1CH                CFT009
     I                                      348 3600W7M2CH                CFT009
     I                                      361 3730W7M3CH                CFT009
     I                                      374 3860W7M4CH                CFT009
     I                                      387 3990W7M5CH                CFT009
      *                                                                   CFT009
     I/COPY WNCPYSRC,FT0355I004
     I*                                                                   S01506
     IW0DTA       DS                            256                       S01506
     I*                                                                   S01506
     I** Calling parameter data structure                                 S01506
     I*                                                                   S01506
     I                                        1   1 I#PT1                 S01506
     I                                        2  36 I#PTY1                S01506
     I                                       37  37 I#PT2                 S01506
     I                                       38  72 I#PTY2                S01506
     I                                       73  75 I#CCY                 S01506
     I                                       76  81 O#CUST                S01506
      /EJECT
      *
      * Data to be passed to window processing
      *
     I*****/COPY WNCPYSRC,FT0355WDTA                                      CPK001
      *                                                                   CAC001
     IEXTRA       DS                            256                       CAC001
      * Define the data structure to pass data to WN0010 and return pgm   CAC001
      *                                                                   CAC001
     I                                        1   1 WACTN                 CAC001
     I                                    P   2   88WRATE                 CAC001
     I                                        9   9 WPSIN                 CAC001
     I                                       10  12 WPCCY                 CAC001
     I                                       13  15 WSMCY                 CAC001
     I                                    P  16  220WPYAM                 CAC001
     I                                    P  23  290WSMAM                 CAC001
     I                                       30  300WMDIN                 CAC001
     I                                    P  31  342WFXMP                 CAC001
     I                                       35  350WFXMD                 CAC001
     I                                       36  36 WMBSI                 CAC001
     I                                       37  37 WMSIG                 CAC001
     I                                    P  38  440WMAMT                 CAC001
     I                                       45  45 WFRCI                 CAC001
      *                                                                   CFT007
     I@OADD       DS                            175                       CFT007
      * Output Data Structure for BIC reformatted address                 CFT007
     I                                        1  35 OADD1                 CFT007
     I                                       36  70 OADD2                 CFT007
     I                                       71 105 OADD3                 CFT007
     I                                      106 140 OADD4                 CFT007
     I                                      141 175 OADD5                 CFT007
      *                                                                   CFT014
      ** Define full account for IBAN.                                    CFT014
      *                                                                   CFT014
     I***WIACNT*     DS                             18                                 CFT014 CGL029
     IWIACNT      DS                             24                                           CGL029
     I**********                              1   60WICNUM                             CFT014 CSD027
     I                                        1   6 WICNUM                                    CSD027
     I                                        7   9 WICCY                 CFT014
     I**********                             10  130WIACOD                CFT014       CFT014 CGL029
     I**********                             14  150WIACSQ                CFT014       CFT014 CGL029
     I**********                             16  18 WIBRCA                CFT014       CFT014 CGL029
     I                                       10  190WIACOD                                    CGL029
     I                                       20  210WIACSQ                                    CGL029
     I                                       22  24 WIBRCA                                    CGL029
      *                                                                   CFT009
      *  Transaction details file parameter for FT000652                  CFT009
      *                                                                   CFT009
     ITRNDET      DS                           3000                       CFT009
      *                                                                   CFT009
      *  Transaction details extension file parameter for FT000652        CFT009
      *                                                                   CFT009
     ITRNEXT      DS                           3000                       CFT009
      *                                                                   CFT009
      *  Outgoing Payments Details Extension data structure               CFT009
      *                                                                   CFT009
     IINPXDS    E DSINPAYXPD                                              CFT009
     I              INFRNT                          WKFRNT                CFT009
     I              INREPA                          WKREPA                CFT009
      *                                                                   CFT009
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      ** Commitment Control dataarea                                                          CSC022
      *                                                                                       CSC022
     I/COPY QWINDSRC,FT0355WDTA                                           CPK001
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C***********P1ACTC    PARM           WP0001  1        Action Code    096486
     C           P1ACTC    PARM P1ACTC    WP0001  1        Action Code    096486
     C                     PARM           P2PARM           Reference
     C                     PARM           P3PARM           Other data
     C                     PARM           P4PARM           Margin Info    CAC001
     C                     PARM           FLAG12  1        F12 pressed    CFT009
     C/COPY WNCPYSRC,FT0355C012
      *
      *  Set up primary reference
      *
     C                     MOVELP2PARM    W0PREF
     C/COPY WNCPYSRC,FT0355C017
      *****************************************************************
     C*                                                                   096486
     C**  Restore back correct action code if triggered through A/C       096486
     C**  Movements (GL4442).                                             096486
     C*                                                                   096486
     C                     MOVE *BLANK    @GL442  1                       096486
     C           P1ACTC    IFEQ 'G'                                       096486
     C                     MOVE 'Y'       @GL442                          096486
     C                     MOVE 'E'       P1ACTC                          096486
     C                     ENDIF                                          096486
      *
      *  Set up subroutine stack name
      *
     C                     Z-ADD1         Q
     C                     MOVEL*BLANKS   @STK
     C                     MOVEL'MAIN  '  @STK,Q
      *
      * Initialise
      *
     C           *IN81     IFEQ '0'
     C                     EXSR ZZINIT
     C                     END
      *                                                                   CFT009
      * Screen fields                                                     CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVE *BLANKS   #3TRCD                          CFT009
     C                     MOVE *BLANKS   #3CHCD                          CFT009
     C                     MOVE *BLANKS   #3TXCD                          CFT009
     C                     MOVE *BLANKS   #3CQCD                          CFT009
     C                     MOVE *BLANKS   #3ADCD                          CFT009
     C                     MOVE *BLANKS   #3TLCD                          CFT009
     C                     MOVE *BLANKS   #3MSCD                          CFT009
     C                     MOVE *BLANKS   M1CD                            CFT009
     C                     MOVE *BLANKS   M2CD                            CFT009
     C                     MOVE *BLANKS   M3CD                            CFT009
     C                     MOVE *BLANKS   M4CD                            CFT009
     C                     MOVE *BLANKS   M5CD                            CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0TRCD                          CFT009
     C                     Z-ADD0         F0TRCM                          CFT009
     C                     Z-ADD0         F0TXCD                          CFT009
     C                     Z-ADD0         F0TXCH                          CFT009
     C                     Z-ADD0         F0CQCD                          CFT009
     C                     Z-ADD0         F0CQCH                          CFT009
     C                     Z-ADD0         F0ADCD                          CFT009
     C                     Z-ADD0         F0ADCH                          CFT009
     C                     Z-ADD0         F0TLCD                          CFT009
     C                     Z-ADD0         F0TLCH                          CFT009
     C                     Z-ADD0         F0MSCD                          CFT009
     C                     Z-ADD0         F0MSCH                          CFT009
     C                     Z-ADD0         F0CHCD                          CFT009
     C                     Z-ADD0         F0CHCM                          CFT009
     C                     Z-ADD0         F0M1CD                          CFT009
     C                     Z-ADD0         F0M1CH                          CFT009
     C                     Z-ADD0         F0M2CD                          CFT009
     C                     Z-ADD0         F0M2CH                          CFT009
     C                     Z-ADD0         F0M3CD                          CFT009
     C                     Z-ADD0         F0M3CH                          CFT009
     C                     Z-ADD0         F0M4CD                          CFT009
     C                     Z-ADD0         F0M4CH                          CFT009
     C                     Z-ADD0         F0M5CD                          CFT009
     C                     Z-ADD0         F0M5CH                          CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   S0TRCD                          CFT009
     C                     MOVE *BLANKS   S0TXCD                          CFT009
     C                     MOVE *BLANKS   S0CQCD                          CFT009
     C                     MOVE *BLANKS   S0ADCD                          CFT009
     C                     MOVE *BLANKS   S0TLCD                          CFT009
     C                     MOVE *BLANKS   S0MSCD                          CFT009
     C                     MOVE *BLANKS   S0CHCD                          CFT009
     C                     MOVE *BLANKS   S0M1CD                          CFT009
     C                     MOVE *BLANKS   S0M2CD                          CFT009
     C                     MOVE *BLANKS   S0M3CD                          CFT009
     C                     MOVE *BLANKS   S0M4CD                          CFT009
     C                     MOVE *BLANKS   S0M5CD                          CFT009
      *                                                                   CFT009
     C                     Z-ADD0         DUMA1                           CFT009
     C                     Z-ADD0         DUMA2                           CFT009
     C                     Z-ADD0         DUMA3                           CFT009
     C                     Z-ADD0         DUMA4                           CFT009
     C                     Z-ADD0         DUMA5                           CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   #3TXCD                          CFT009
     C                     MOVE *BLANKS   #3CQCD                          CFT009
     C                     MOVE *BLANKS   #3ADCD                          CFT009
     C                     MOVE *BLANKS   #3TLCD                          CFT009
     C                     MOVE *BLANKS   #3MSCD                          CFT009
     C                     MOVE *BLANKS   #3CHCD                          CFT009
     C                     MOVE *BLANKS   M1CD                            CFT009
     C                     MOVE *BLANKS   M2CD                            CFT009
     C                     MOVE *BLANKS   M3CD                            CFT009
     C                     MOVE *BLANKS   M4CD                            CFT009
     C                     MOVE *BLANKS   M5CD                            CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      * Check passed parameters
      *
     C                     EXSR FACKPM
      *
      *                                                                                       CSC022
      ** Check if CSC022 is switched ON.                                                      CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD   6                                           CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL'N'       CMTSKP  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C           @RTCD     IFNE '*NRF '                                                       CSC022
     C           *LOCK     IN   LDA                                                           CSC022
     C                     SETON                       U7U8                                   CSC022
     C                     Z-ADD5         DBASE                                               CSC022
     C                     MOVEL'SCSARDPD'DBFILE                                              CSC022
     C                     MOVEL'CSC022'  DBKEY                                               CSC022
     C                     OUT  LDA                                                           CSC022
     C                     EXSR SRERR                                                         CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      * Perform once if all passed, else repeat
      *
     C           W0RPT     DOUEQ'N'
      *
      * Display and process key screen
      *
     C                     EXSR BADSKY
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *
      * Terminate program
      *
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BADSKY'  @STK,Q
      *
      * Initialise key screen
      *
     C                     EXSR MDIZ#K
      *
      * Bypass first display of key screen if possible
      *
     C           P1ACTC    IFNE *BLANKS
     C                     MOVEL'Y'       W0BYP   1
     C                     ELSE
     C                     MOVEL'N'       W0BYP
     C                     END
      *
      * Signal start of transaction
      *
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      *
      * Ensure transaction continues (if reset)
      *
     C                     MOVEL'Y'       W0TRN   1
      *
      * Initialise detail screen
      *
     C                     EXSR MAIZ#1
      *
      * Conduct screen conversation
      *
     C           W0TRN     DOWEQ'Y'
      *
      * Is bypass key screen still viable?
      *
     C           W0BYP     IFEQ 'Y'
     C           P2PARM    IFEQ *BLANKS
      *
      * One or more key fields is blank
      *
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      *
      * Bypass key screen
      *
     C           W0BYP     IFNE 'Y'
      *
      * Display key screen
      *
     C                     EXSR BBEXFM
     C                     END
      *
      * Cancel key screen bypass
      *
     C                     MOVEL'N'       W0BYP
      *
      * Process response to key screen
      * Cancel & exit program
      *
     C   03                CAS            ZXEXPG
     C   07                CAS            ZXEXPG
     C   12                CAS            ZXEXPG
      *
      * HOME: Reset screen fields
      *
     C   05                CAS            BDHMKY
      *
      * Process key screen input
      *
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BBEXFM'  @STK,Q
      *
      * Set screen conditioning indicators
      *
     C                     EXSR GADSAK
      *
      * Update screen time
      *
     C                     TIME           ##TME
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
      *
      * PUTOVR unless conditioned fields change
      *
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      *
      * Update job time
      *
     C                     TIME           ##JTM
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
      *
      * Reset global error indicator and clear error codes
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X
     C                     SETOF                         99*
      *                                                                   CAC001
      ** If Analytical Accounting is installed, initialise margin         CAC001
      ** info work fields.                                                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADD*ZEROS    WOFXMP  72                      CAC001
     C                     Z-ADD*ZEROS    WOFXMD  10                      CAC001
     C                     MOVE *BLANKS   WOMBSI  1                       CAC001
     C                     MOVE *BLANKS   WOMSIG  1                       CAC001
     C                     Z-ADD*ZEROS    WOMAMT 130                      CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,FT0355C032
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BBEXFM'  @STK,Q
      *
     C                     MOVEL'N'       W0TRN
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BEPRKY'  @STK,Q
      *
      * Validate key fields
      *
     C                     EXSR BFVLKY
      *
     C           *IN99     CABEQ'1'       BEEXIT
      *
      * If insert mode change W0PMD
      *
     C           #1ACTC    IFEQ 'I'
      *
      *
      * Load screen fields from DBF
      *
     C                     EXSR MBFL#1
      *
      * USER: Initialise detail screen (new record)
      * EDTRCD: Init. det. scr NW - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Dtl New Rcd
     C/COPY WNCPYSRC,FT0355DISN
      *
     C                     ELSE
      *
     C                     MOVEL'1'       *IN73
      *
      * If record does exist, flip to change mode
      *
     C                     MOVEL'CHG'     W0PMD   3
      *
      * CALC: Detail screen function fields
      * EDTRCD: Detail scrn funcs - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Calc Detail Function Flds
     C/COPY WNCPYSRC,FT0355DSFF
      *
      * Load screen fields from DBF
      *
     C                     EXSR MBFL#1
      * USER: Initialise detail screen (existing record)
      * EDTRCD: Init. det. scr EX - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Dtl Exist Rcd
     C/COPY WNCPYSRC,FT0355DISE
     C                     END
      *..................................................
     C   99                GOTO BEEXIT
      *
      * Clear Warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      * Re-send screen indicator
     C                     MOVEL*BLANKS   E#RSND
      *
      * No error: Display and process details
      *
     C                     EXSR CADSDA
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BFVLKY'  @STK,Q
      *
      * Action code must be I, A, or E
      *
     C           #1ACTC    IFNE 'I'
     C           #1ACTC    ANDEQ'A'
     C           #1ACTC    ANDEQ'E'
     C                     SETON                     9931  *
     C                     MOVEL'FTM2175' ZAMSID
     C                     EXSR ZASNMS
     C                     END
      *
      * If error exit
      *
     C           *IN99     IFEQ '1'
     C                     GOTO BFEXIT
     C                     END
      *
      * Payment reference must exist
      *
     C                     EXSR VBCKRL
      *
      * If error exit
      *
     C           *IN99     IFEQ '1'
     C                     GOTO BFEXIT
     C                     END
      *
      * USER: Validate key screen
      * EDTRCD: Valid key screen - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Key Screen
     C/COPY WNCPYSRC,FT0355DVKS
      *
      * Check branch SPF action
      *
     C                     EXSR VDCKRL
      *
      * If error exit
      *
     C           *IN99     IFEQ '1'
     C                     GOTO BFEXIT
     C                     END
      *
      * If not a linked function and not insert or enquire
      * allocate payment reference
      *
     C           P2PREF    IFEQ *BLANKS
     C           #1ACTC    ANDNE'E'
      *
     C                     CALL 'AOC8000'
     C                     PARM *BLANKS   P@RTCD
     C                     PARM 'FT'      P@MODI  2
     C                     PARM #1PREF    P@PREF 15
     C                     PARM *BLANKS   P@D80  80
      *
      *  If 'IN USE' then redisplay subfile with error message
      *  for record lock
      *
     C           P@RTCD    IFEQ '*IN USE'
     C                     ADD  1         X
     C                     MOVE ' 600'    ERCD,X
     C                     SETON                     9932  *
     C                     END
      *
     C                     END
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           BFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CADSDA'  @STK,Q
      *
     C                     MOVEL'SCR1'    ##SCR   4
      *
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
      *
     C           W0TRN     DOWEQ'Y'
      *
      * Display detail screen
      *
     C                     EXSR CBEXFM
      *                                                                   CAC001
      **  Initialise force indicator                                      CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WFRCI                           CAC001
      *
      * Process response to detail screen
      * Cancel & exit program
      *
     C   03                CAS            ZXEXPG
     C   07                CAS            ZXEXPG
      *
      * Redisplay previous screen
      *
     C   12                CAS            CCDSPV
      *
      * HOME: Reset screen fields
      *
     C   05                CAS            CCDSPV
      *                                                                   CAC001
      * F19 pressed. Process call to margin info window.                  CAC001
      *                                                                   CAC001
     C   KT                CAS            SRMGIN                          CAC001
      *
     C* F4 or F16 pressed. BIC Database Plus processing                   CFT007
      *                                                                   CFT007
     C   08                CAS            SRBICP                          CFT007
     C   13                CAS            SRBICP                          CFT007
      *                                                                   CFT007
      * Process detail screen input
      *
     C                     CAS            CFPRSC
     C                     END
      *
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CBEXFM'  @STK,Q
      *
      * Set screen conditioning indicators
      *
     C                     EXSR GBDSAD
      *
      * Update screen time
      *
     C                     TIME           ##TME
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVE *IN26     SAVE26  1                        CFT009
     C                     MOVE *IN27     SAVE27  1                        CFT009
     C                     MOVEA##OFF     *IN,1
     C                     MOVE SAVE26    *IN26                            CFT009
     C                     MOVE SAVE27    *IN27                            CFT009
     C/COPY WNCPYSRC,FT0355C001
      *                                                                    CFT009
      ** Chain to payment charge defintion file to get miscellaneous cd    CFT009
      *                                                                    CFT009
     C           CFT009    IFEQ 'Y'                                        CFT009
     C           ##SCR     ANDEQ'SCR3'                                     CFT009
     C           M1CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M1DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,1    M1DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M2CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M2DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,2    M2DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M3CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M3DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,3    M3DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M4CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M4DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,4    M4DESC                           CFT009
     C                     ENDIF                                           CFT009
     C           M5CDE     CHAINFTPCHGL0             90                    CFT009
     C           *IN90     IFEQ '0'                                        CFT009
     C                     MOVELCHDESC    M5DESC                           CFT009
     C                     ELSE                                            CFT009
     C                     MOVELDESC,5    M5DESC                           CFT009
     C                     ENDIF                                           CFT009
      *                                                                    CFT009
     C                     EXSR DCVLDL                                     CFT009
      *                                                                    CFT009
     C                     ENDIF                                           CFT009
      *                                                                    CFT009
      *
      * PUTOVR unless conditioned fields change
      *
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
     C                     WRITE#MSGCTL
     C           ##SCR     IFEQ 'SCR1'
     C                     WRITE#CMDTXT2
     C                     EXFMT#RCDDTL1
     C                     ELSE
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
     C                     WRITE#CMDTXT3
     C/COPY WNCPYSRC,FT0355C013
     C                     EXFMT#RCDDTL2
     C                     ELSE                                           CFT014
     C                     WRITE#CMDTXT4                                  CFT014
     C/COPY WNCPYSRC,FT0355C045
     C                     EXFMT#RCDDTL3                                  CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     END
      *
      * Update job time
      *
     C                     TIME           ##JTM
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,31
      *
      * Reset global error indicator
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X
     C                     SETOF                         99*
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CCDSPV'  @STK,Q
      *
      * USER: Process key screen request
      * EDTRCD: Process key req. - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Process Key Screen Rqst
     C/COPY WNCPYSRC,FT0355DPKR
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR3'                                    CFT014
      *                                                                   CFT014
     C           *IN05     IFEQ '1'                                       CFT014
     C                     EXSR SRISC3                                    CFT014
     C                     GOTO CCEXIT                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN12     IFEQ '1'                                       CFT014
     C                     MOVEL*BLANKS   E#WARA                          CFT014
     C                     MOVEL'SCR2'    ##SCR                           CFT014
     C                     MOVE 'Y'       FLAG12                          CFT009
     C                     GOTO CCEXIT                                    CFT014
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       FLAG12                          CFT009
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
     C           ##SCR     IFEQ 'SCR2'
     C           *IN05     IFEQ '1'
     C                     EXSR MEIZ#D
     C                     GOTO CCEXIT
     C                     END
      *
     C           *IN12     IFEQ '1'
     C                     MOVEL*BLANKS   E#WARA
     C                     MOVEL'SCR1'    ##SCR
     C                     GOTO CCEXIT
     C                     END
     C                     END
      *
     C           *IN05     IFEQ '1'
     C                     MOVEL'R'       W0TRN
     C                     END
      *
      * If not linked go to key screen else exit
      *
     C           *IN12     IFEQ '1'
     C           P3LINK    IFEQ 'Y'
     C           P2PREF    ORNE *BLANKS
     C                     EXSR ZXEXPG
     C                     ELSE
     C                     MOVEL'K'       W0TRN
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CCEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CFPRSC'  @STK,Q
      *
      * Confirm/update is not deferred
      *
     C                     MOVEL'N'       W0DCF   1
      *
      * If delete is not pending....
      * Validate details
      *
     C           #1ACTC    IFEQ 'I'
     C           #1ACTC    OREQ 'A'
     C  N10                CAS            DCVLDL
     C                     END
     C                     END
      *
      *  Call window processing
      *
     C           *IN99     IFEQ '0'
     C           W0DCF     ANDNE'Y'
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0355CCP1                                           S01408
     C*                                                                   S01408
     C                     EXSR SRWIND
     C/COPY WNCPYSRC,FT0355C044
     C                     END
      *
      * QUIT if error:
      *
     C   99                GOTO CFEXIT
      *
      * Defer confirm/update requested
      *
     C           W0DCF     CABEQ'Y'       CFEXIT
      *
      * if screen 1 progress to screen 2
      *
     C           ##SCR     IFEQ 'SCR1'
     C                     EXSR MEIZ#D
      *
      * Clear messages from program message queue
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      *
      * Reset first message only flag
      *
     C                     MOVEL'Y'       ZAFSMS  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,31
     C/COPY WNCPYSRC,FT0355C028
      *
     C                     MOVEL'SCR2'    ##SCR
     C                     GOTO CFEXIT
     C                     END
      *                                                                   CFT014
      ** If screen 2, progress to screen 3.                               CFT014
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
     C                     EXSR SRISC3                                    CFT014
      *                                                                   CFT014
      ** Clear messages from program message queue.                       CFT014
      *                                                                   CFT014
     C                     CALL 'Y2CLMSC'                                 CFT014
     C                     PARM ##PGM     ZAPGMQ                          CFT014
     C                     PARM '*SAME'   ZAPGRL                          CFT014
      *                                                                   CFT014
      ** Reset first message only flag.                                   CFT014
      *                                                                   CFT014
     C                     MOVEL'Y'       ZAFSMS                          CFT014
     C                     MOVE *ALL'0'   ##OFF                           CFT014
     C                     MOVEA##OFF     *IN,31                          CFT014
      *                                                                   CFT014
     C                     MOVEL'SCR3'    ##SCR                           CFT014
     C                     GOTO CFEXIT                                    CFT014
     C                     ENDIF                                          CFT014
      *
      * No error: update record
      *
     C           #1ACTC    IFEQ 'A'
     C           #1ACTC    OREQ 'I'
     C                     EXSR EBPR##
     C                     END
      *
      * Exit if linked
      *
     C           *IN99     IFEQ '0'
     C           P3LINK    IFEQ 'Y'
     C           P2PREF    ORNE *BLANKS
     C                     MOVEL'N'       W0RPT
     C                     MOVEL'N'       W0TRN
     C                     ELSE
     C                     MOVEL'R'       W0RPT
     C                     MOVEL'N'       W0TRN
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           CFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'DCVLDL'  @STK,Q
      *
      *  Perform selection processing
      *
     C                     EXSR SRQURY
      *
      * EDTRCD: Valid det. scrn - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Detail Screen
     C/COPY WNCPYSRC,FT0355DVSF
      *
      * USER: Validate detail screen fields
      *
     C           ##SCR     IFEQ 'SCR1'
      *
      *  Call access object FT0357 to validate screen
      *
     C                     EXSR SRFTS1
     C                     ELSE
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
      *
      *  Call access object FT0358 to validate screen
      *
     C                     EXSR SRFTS2
     C                     MOVE 'Y'       P0RSET                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT009
      ** Do question mark prcessing for screen 3                          CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** If showing charges first time on insert mode, load up default    CFT009
      ** charges                                                          CFT009
      *                                                                   CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C           #1ACTC    ANDNE'E'                                       CFT009
     C                     EXSR SRCL#3                                    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     EXSR SRQRY3                                    CFT009
     C                     EXSR SREQR3                                    CFT009
     C                     ENDIF                                          CFT009
     C                     EXSR SRFTS3                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     END
      *
      * CALC: Detail screen function fields
      * EDTRCD: Detail scrn funcs - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Calc Detail Function Flds
     C/COPY WNCPYSRC,FT0355DSFF
      * USER: Validate detail screen relations
      * EDTRCD: Detail scrn rels - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Validate Screen Relns
     C/COPY WNCPYSRC,FT0355DVSR
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           DCEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SRQURY    BEGSR
      *================================================================
      * Do ? mark processing
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRQURY'  @STK,Q
      *----------------------------------------------------------------
      * Subroutine to resolve entry of ? for standing data fields.
      * Performed after function key validation and prior to field
      * validation for screen 2.
      *
      * Indicators used:
      *  W0DCF    defer confirm redisplay screen
      *  90       used in SCAN on if ? found
      *----------------------------------------------------------------
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EXQURY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     CSR         SRQRY3    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? prompt proceesing for charge codes on screen three           CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      * Subroutine to resolve entry of ?.                                 CFT009
      * Performed after function key validation and prior to field        CFT009
      * validation for screen 3.                                          CFT009
      *                                                                   CFT009
      * Indicators used:                                                  CFT009
      *  90       used in SCAN on if ? found                              CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'SRQRY3'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEATRCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    TRCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   TRCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAFXCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    FXCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   FXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEATXCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    TXCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   TXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEACQCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    CQCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   CQCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAADCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    ADCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   ADCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEATPCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    TPCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   TPCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAMSCDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    MSCDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   MSCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM1CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M1CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M1CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM2CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M2CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M2CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM3CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M3CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M3CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM4CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M4CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M4CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM5CDE     FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C                     MOVE 'N'       W0DCF                           CFT009
     C                     CALL 'FT000940'                                CFT009
     C                     PARM *BLANKS   P#PYCD  5                       CFT009
      *                                                                   CFT009
      * if selection made move value to screen field                      CFT009
     C           P#PYCD    IFNE *BLANKS                                   CFT009
     C                     MOVELP#PYCD    M5CDE                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL*BLANKS   M5CDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXQRY3    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *****************************************************************   CFT009
     CSR         SREQR3    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? mark processing for enquiry on charge calulation amounts     CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'SREQR3'  @STK,Q                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      * Subroutine to resolve entry of ?.                                 CFT009
      * Performed after function key validation and prior to field        CFT009
      * validation for screen 3.                                          CFT009
      *                                                                   CFT009
      * Indicators used:                                                  CFT009
      *  W0DCF    defer confirm redisplay screen                          CFT009
      *  90       used in SCAN on if ? found                              CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** if ? found seton redisplay ind and call access program           CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   FT652   1                       CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3TRCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           TRCDE     IFNE *BLANKS                                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
     C                     MOVE TRCDE     CHGCDE                          CFT009
      *                                                                   CFT009
      ***  Call SR to process enquiry screen for each code                CFT009
      *                                                                   CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0TRCD    #3TRCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE1                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELTRCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3CHCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           FXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE FXCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0CHCD    #3CHCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE2                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELFXCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3TXCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           TXCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE TXCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0TXCD    #3TXCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE3                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELTXCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3CQCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           CQCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE CQCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0CQCD    #3CQCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE4                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCQCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3ADCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           ADCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE ADCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0ADCD    #3ADCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE5                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELADCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTM3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3TLCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           TPCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE TPCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0TLCD    #3TLCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE6                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELTPCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTM3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEA#3MSCD    FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           MSCDE     IFNE *BLANKS                                   CFT009
     C                     MOVE MSCDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0MSCD    #3MSCD                          CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE7                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELMSCDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM1CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M1CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M1CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0M1CD    M1CD                            CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE8                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM1CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM2CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M2CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M2CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0M2CD    M2CD                            CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CDE9                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM2CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM3CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M3CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M3CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0M3CD    M3CD                            CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CD10                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM3CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM4CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M4CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M4CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0M4CD    M4CD                            CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CD11                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM4CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   FLDQ                            CFT009
     C                     MOVEAM5CD      FLDQ                            CFT009
     C                     SETOF                     90                   CFT009
     C           '?'       LOKUPFLDQ                     90               CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ '1'                                       CFT009
     C           M5CDE     IFNE *BLANKS                                   CFT009
     C                     MOVE M5CDE     CHGCDE                          CFT009
     C                     EXSR FT0652                                    CFT009
     C                     MOVELS0M5CD    M5CD                            CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVEL'Y'       I0CD12                          CFT009
     C                     ENDIF                                          CFT009
     C           *IN03     IFEQ *ON                                       CFT009
     C                     EXSR ZXEXPG                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELM5CDE     ZAMSDA                          CFT009
     C                     MOVEL'FTF3196' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXEQR3    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     CSR         FT0652    BEGSR                                          CFT009
      *                                                                   CFT009
      *================================================================   CFT009
      * Do ? mark processing for amounts                                  CFT009
      *================================================================   CFT009
      *                                                                   CFT009
      *  Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'FT0652'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Check that charge code exists before call to enquiry             CFT009
      *                                                                   CFT009
     C           CHGCDE    CHAINFTPCHGL0             90                   CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ *ON                                       CFT009
     C                     MOVELCHGCDE    ZAMSDA                          CFT009
     C                     MOVEL'FTF3206' ZAMSID                          CFT009
     C                     EXSR ZASNMS                                    CFT009
     C                     MOVEL'Y'       WI0CDE  1                       CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL' '       WI0CDE                          CFT009
     C                     MOVEL'Y'       FT652                           CFT009
      *                                                                   CFT009
      ** Call ft000652 for display of charge caculation enquiry scrn      CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     CLEARTRNDET                                    CFT009
     C                     CLEARTRNEXT                                    CFT009
      *                                                                   CFT009
     C                     SELEC                                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'B'                                       CFT009
     C           S0CDRO    ORNE *BLANKS                                   CFT009
     C           I0CDRT    ANDEQ*BLANKS                                   CFT009
     C           V#CHCY    ANDEQ'C'                                                           222568
     C                     MOVELV#BCCY    INCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'L'                                       CFT009
     C                     MOVELV#LCCY    INCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'F'                                       CFT009
     C                     MOVELFCHCCY    INCHGC                          CFT009
      *                                                                   CFT009
     C           V#CHCY    WHEQ 'C'                                       CFT009
     C           V#ADDC    ANDEQ'A'                                       CFT009
     C                     MOVELV#SMCY    INCHGC                          CFT009
      *                                                                   CFT009
     C                     OTHER                                          CFT009
     C                     MOVELV#PCCY    INCHGC                          CFT009
      *                                                                   CFT009
     C                     ENDSL                                          CFT009
      *                                                                   CFT009
     C           I0CDRT    IFEQ *BLANKS                                   CFT009
     C           I0CDBR    ANDEQ*BLANKS                                   CFT009
     C                     MOVELS0CDRO    CDRO                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL'M'       STP                             CFT009
     C                     MOVEL@1DBRC    TRNDET                          CFT009
     C                     MOVELINPXDS    TRNEXT                          CFT009
     C                     MOVE 'IN'      TRNTYP                          CFT009
      *                                                                   CFT009
     C                     CALL 'FT000652'                                CFT009
     C                     PARM *BLANKS   MRTCD  10                       CFT009
     C                     PARM           TRNDET                          CFT009
     C                     PARM           TRNEXT                          CFT009
     C                     PARM           TRNTYP  2                       CFT009
     C                     PARM           CHGCDE  5                       CFT009
     C                     PARM *BLANKS   INKC    1                       CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C           MRTCD     IFNE *BLANKS                                   CFT009
     C                     MOVEL'FT000652'W0FILE                          CFT009
     C                     MOVEL'*CALL'   W0KEY                           CFT009
     C                     Z-ADD82        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C           INKC      IFEQ '1'                                       CFT009
     C                     MOVE *ON       *IN03                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *  Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXFT06    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      /EJECT
     CSR         SRFTS1    BEGSR
      *================================================================
      * Call validation access object
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFTS1'  @STK,Q
      *================================================================
     C                     MOVEL#1ACTC    S2ACTD
     C                     MOVEL#1PREF    S2PREF
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVEL#1TRCT    S2TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL#1CDRO    S2CDRO                          CFT014
     C/COPY WNCPYSRC,FT0355C011
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVEL#1CDBR    S2CDBR                          CFT014
      *  Ordering Bank
     C                     MOVEL#1OBK1    S2ORB1
     C                     MOVEL#1OBK2    S2ORB2
     C                     MOVEL#1OBK3    S2ORB3
     C                     MOVEL#1OBK4    S2ORB4
     C                     MOVEL#1OBK5    S2ORB5
      *  Sender's Correspondent
     C                     MOVEL#1SNC1    S2SNC1
     C                     MOVEL#1SNC2    S2SNC2
     C                     MOVEL#1SNC3    S2SNC3
     C                     MOVEL#1SNC4    S2SNC4
     C                     MOVEL#1SNC5    S2SNC5
      *  Ordering Customer
     C                     MOVEL#1ORC1    S2ORC1
     C                     MOVEL#1ORC2    S2ORC2
     C                     MOVEL#1ORC3    S2ORC3
     C                     MOVEL#1ORC4    S2ORC4
     C                     MOVEL#1ORC5    S2ORC5
      *  Sender to Receiver information
     C                     MOVEL#1BBI1    S2BTB1
     C                     MOVEL#1BBI2    S2BTB2
     C                     MOVEL#1BBI3    S2BTB3
     C                     MOVEL#1BBI4    S2BTB4
     C                     MOVEL#1BBI5    S2BTB5
     C                     MOVEL#1BBI6    S2BTB6
      *
      *  Data Structure to pass data between programs
      *
      *  Fields needed for error processing
      *
      * No update indicator
     C                     MOVEL*BLANKS   E#NOUP
      * Warning message sent
     C                     MOVEL*BLANKS   E#WARN
      * Message sent via FTSNMS
     C                     MOVEL*BLANKS   E#MSGS
      * Program to send messages to
     C                     MOVEL##PGM     E#CPGM
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Error codes to be displayed
      *
     C                     MOVEL*BLANKS   C#ERCD
     C                     MOVEL*BLANKS   I2DATA
      *
      *
      *  Define entry parameters
      *
     C                     CALL 'FT0357'               9090
     C                     PARM           P@RTCD
     C                     PARM '*VALID'  W0ACT   8
     C                     PARM           S2DATA
     C                     PARM           V#DATA
     C                     PARM           F2DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I2DATA
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    ORNE *BLANKS
     C                     MOVEL'FT0357  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 01 *
     C                     Z-ADD1         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Data Structure to pass data between programs
      *
      *
      *  Move back validated data
      *
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVELS2TRCT    #1TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVELS2CDRO    #1CDRO                          CFT014
     C/COPY WNCPYSRC,FT0355C002
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVELS2CDBR    #1CDBR                          CFT014
      *  Ordering Bank
     C                     MOVELS2ORB1    #1OBK1
     C                     MOVELS2ORB2    #1OBK2
     C                     MOVELS2ORB3    #1OBK3
     C                     MOVELS2ORB4    #1OBK4
     C                     MOVELS2ORB5    #1OBK5
      *  Sender's Correspondent
     C                     MOVELS2SNC1    #1SNC1
     C                     MOVELS2SNC2    #1SNC2
     C                     MOVELS2SNC3    #1SNC3
     C                     MOVELS2SNC4    #1SNC4
     C                     MOVELS2SNC5    #1SNC5
      *  Ordering Customer
     C                     MOVELS2ORC1    #1ORC1
     C                     MOVELS2ORC2    #1ORC2
     C                     MOVELS2ORC3    #1ORC3
     C                     MOVELS2ORC4    #1ORC4
     C                     MOVELS2ORC5    #1ORC5
      *  Sender to Receiver information
     C                     MOVELS2BTB1    #1BBI1
     C                     MOVELS2BTB2    #1BBI2
     C                     MOVELS2BTB3    #1BBI3
     C                     MOVELS2BTB4    #1BBI4
     C                     MOVELS2BTB5    #1BBI5
     C                     MOVELS2BTB6    #1BBI6
      *
      *  Error indicators
      *
      * Re-send screen indicator
      *
     C           E#NOUP    IFNE *BLANKS
     C                     MOVEL'1'       *IN99
     C                     END
      *
     C           I2DATA    IFEQ *BLANKS
     C                     MOVEA*BLANKS   ERCD
     C                     GOTO EXFTS1
     C                     END
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********I2TRCT    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN52                           CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********I2CDRT    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN53                           CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********I2CDBR    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN54                           CFT014
     C***********          END                                            CFT014
      *  Ordering Bank
     C           I2ORBT    IFEQ 'Y     '
     C                     MOVEA'11111'   *IN,31
     C                     END
     C           I2ORB1    IFNE *BLANKS
     C                     MOVEL'1'       *IN31
     C                     END
     C           I2ORB2    IFNE *BLANKS
     C                     MOVEL'1'       *IN32
     C                     END
     C           I2ORB3    IFNE *BLANKS
     C                     MOVEL'1'       *IN33
     C                     END
     C           I2ORB4    IFNE *BLANKS
     C                     MOVEL'1'       *IN34
     C                     END
     C           I2ORB5    IFNE *BLANKS
     C                     MOVEL'1'       *IN35
     C                     END
      *  Sender's Correspondent
     C           I2SNCT    IFEQ 'Y     '
     C                     MOVEA'11111'   *IN,36
     C                     END
     C           I2SNC1    IFNE *BLANKS
     C                     MOVEL'1'       *IN36
     C                     END
     C           I2SNC2    IFNE *BLANKS
     C                     MOVEL'1'       *IN37
     C                     END
     C           I2SNC3    IFNE *BLANKS
     C                     MOVEL'1'       *IN38
     C                     END
     C           I2SNC4    IFNE *BLANKS
     C                     MOVEL'1'       *IN39
     C                     END
     C           I2SNC5    IFNE *BLANKS
     C                     MOVEL'1'       *IN40
     C                     END
      *  Ordering Customer
     C           I2ORCT    IFEQ 'Y     '
     C                     MOVEA'11111'   *IN,41
     C                     END
     C           I2ORC1    IFNE *BLANKS
     C                     MOVEL'1'       *IN41
     C                     END
     C           I2ORC2    IFNE *BLANKS
     C                     MOVEL'1'       *IN42
     C                     END
     C           I2ORC3    IFNE *BLANKS
     C                     MOVEL'1'       *IN43
     C                     END
     C           I2ORC4    IFNE *BLANKS
     C                     MOVEL'1'       *IN44
     C                     END
     C           I2ORC5    IFNE *BLANKS
     C                     MOVEL'1'       *IN45
     C                     END
      *  Sender to Receiver information
     C           I2BTB     IFEQ 'Y      '
     C                     MOVEA'111111'  *IN,46
     C                     END
     C           I2BTB1    IFNE *BLANKS
     C                     MOVEL'1'       *IN46
     C                     END
     C           I2BTB2    IFNE *BLANKS
     C                     MOVEL'1'       *IN47
     C                     END
     C           I2BTB3    IFNE *BLANKS
     C                     MOVEL'1'       *IN48
     C                     END
     C           I2BTB4    IFNE *BLANKS
     C                     MOVEL'1'       *IN49
     C                     END
     C           I2BTB5    IFNE *BLANKS
     C                     MOVEL'1'       *IN50
     C                     END
     C           I2BTB6    IFNE *BLANKS
     C                     MOVEL'1'       *IN51
     C                     END
      *
     C                     MOVEAC#ERCD    ERCD
      *
      *  If warning sent then delay confirm
      *
     C           E#WARN    IFEQ 'Y'
     C           E#RSND    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#RSND
     C                     MOVEL'1'       *IN99
     C                     END
     C/COPY WNCPYSRC,FT0355C031
      *
      *  Unwind subroutine stack name
      *
     C           EXFTS1    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SRFTS2    BEGSR
      *================================================================
      * Call validation access object
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFTS2'  @STK,Q
      *================================================================
     C                     MOVEL#1ACTC    S3ACTD
     C                     MOVEL#1PREF    S3PREF
      * Intermediary Bank
     C                     MOVEL#2INB1    S3IBK1
     C                     MOVEL#2INB2    S3IBK2
     C                     MOVEL#2INB3    S3IBK3
     C                     MOVEL#2INB4    S3IBK4
     C                     MOVEL#2INB5    S3IBK5
      *  Details of Payment
     C                     MOVEL#2DTP1    S3PAY1
     C                     MOVEL#2DTP2    S3PAY2
     C                     MOVEL#2DTP3    S3PAY3
     C                     MOVEL#2DTP4    S3PAY4
      * Central Bank Reference
     C                     MOVEL#2DNBC    S3CBKR
      * Related Reference
     C                     MOVEL#2RLPR    S3RLRF
      **Details*of*Charge**********************************************   CFT014
     C***********          MOVEL#2DTCH    S3DETC                          CFT014
      *                                                                   CFT014
      ** Transfer Commission Tariff                                       CFT014
      *                                                                   CFT014
     C                     MOVEL#2TRCT    S3TRCT                          CFT014
     C                     MOVE ' '       TRANSC  1                                           202914
     C           #2TRCT    IFNE #2TRCX                                                        202914
     C           #2TRCX    ANDNE*BLANKS                                                       202914
     C                     MOVE 'Y'       TRANSC                                              202914
     C                     ENDIF                                                              202914
     C                     MOVEL#2TRCT    #2TRCX  1                                           202914
      *                                                                   CFT014
      * Outgoing indicator
     C                     MOVEL#2OPIN    S3OPIN
      *                                                                   CFT014
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********          MOVEL#2TRCD    S3TRCD                          CFT014
      **Telex**********************************************************   CFT014
     C***********          MOVEL#2TXCD    S3TXCD                          CFT014
      **Cheque*********************************************************   CFT014
     C***********          MOVEL#2CQCD    S3CQCD                          CFT014
      **Advice*Charge**************************************************   CFT014
     C***********          MOVEL#2ADCD    S3ADCD                          CFT014
      **Telephone*charge***********************************************   CFT014
     C***********          MOVEL#2TLCD    S3TLCD                          CFT014
      **Miscellaneous**************************************************   CFT014
     C***********          MOVEL#2MSCD    S3MSCD                          CFT014
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission************************************* S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL#2CHCD    S3CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***V.A.T.*flags********************************************* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVEL#2VAT1    S3VAT1                   S01499 CFT014
     C***********          MOVEL#2VAT2    S3VAT2                   S01499 CFT014
     C***********          MOVEL#2VAT3    S3VAT3                   S01499 CFT014
     C***********          MOVEL#2VAT4    S3VAT4                   S01499 CFT014
     C***********          MOVEL#2VAT5    S3VAT5                   S01499 CFT014
     C***********          MOVEL#2VAT6    S3VAT6                   S01499 CFT014
     C***********          MOVEL#2VAT7    S3VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
      ** Enhancement CFT014 is on.                                        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Bank Operation Code                                              CFT014
      *                                                                   CFT014
     C                     MOVEL#2BOCD    S3BOCD                          CFT014
      *                                                                   CFT014
      ** Transaction Type Code                                            CFT014
      *                                                                   CFT014
     C                     MOVEL#2TTCD    S3TTCD                          CFT014
      *                                                                   CFT014
      ** Instruction Code                                                 CFT014
      *                                                                   CFT014
     C                     MOVEL#2ICD1    S3ICD1                          CFT014
     C                     MOVEL#2ICD2    S3ICD2                          CFT014
     C                     MOVEL#2ICD3    S3ICD3                          CFT014
     C                     MOVEL#2ICD4    S3ICD4                          CFT014
     C                     MOVEL#2ICD5    S3ICD5                          CFT014
      *                                                                   CFT014
      ** Regulatory Reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVEL#2RRP1    S3RRP1                          CFT014
     C                     MOVEL#2RRP2    S3RRP2                          CFT014
     C                     MOVEL#2RRP3    S3RRP3                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C*COPY WNCPYSRC,FT0355C029
      *
      *  Data Structure to pass data between programs
      *
      *  Fields needed for error processing
      *
      * No update indicator
     C                     MOVEL*BLANKS   E#NOUP
      * Warning message sent
     C                     MOVEL*BLANKS   E#WARN
      * Message sent via FTSNMS
     C                     MOVEL*BLANKS   E#MSGS
      * Program to send messages to
     C                     MOVEL##PGM     E#CPGM
      *
      *
      *  Data Structure to pass data between programs
      *
      *  Error codes to be displayed
      *
     C                     MOVEL*BLANKS   C#ERCD
     C                     MOVEL*BLANKS   I3DATA
      *
      *
      *  Define entry parameters
      *
     C                     CALL 'FT0358'               9090
     C                     PARM           P@RTCD
     C                     PARM '*VALID'  W0ACT   8
     C                     PARM           S3DATA
     C                     PARM           V#DATA
     C                     PARM           F3DATA
     C                     PARM           E#DATA
     C                     PARM           C#DATA
     C                     PARM           I3DATA
     C/COPY WNCPYSRC,FT0355C037
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    ORNE *BLANKS
     C                     MOVEL'FT0358  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 02 *
     C                     Z-ADD2         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *  Data Structure to pass data between programs
      *
      *
      *  Move back validated data
      *
      * Intermediary Bank
     C                     MOVELS3IBK1    #2INB1
     C                     MOVELS3IBK2    #2INB2
     C                     MOVELS3IBK3    #2INB3
     C                     MOVELS3IBK4    #2INB4
     C                     MOVELS3IBK5    #2INB5
      *  Details of Payment
     C                     MOVELS3PAY1    #2DTP1
     C                     MOVELS3PAY2    #2DTP2
     C                     MOVELS3PAY3    #2DTP3
     C                     MOVELS3PAY4    #2DTP4
      * Central Bank Reference
     C                     MOVELS3CBKR    #2DNBC
      * Related Reference
     C                     MOVELS3RLRF    #2RLPR
      **Details*of*Charge**********************************************   CFT014
     C***********          MOVELS3DETC    #2DTCH                          CFT014
      *                                                                   CFT014
      ** Transfer Commission Tariff                                       CFT014
      *                                                                   CFT014
     C                     MOVELS3TRCT    #2TRCT                          CFT014
      *                                                                   CFT014
      * Outgoing to be generated
     C                     MOVELS3OPIN    #2OPIN
      *
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********          MOVELS3TRCD    #2TRCD                          CFT014
      **Telex**********************************************************   CFT014
     C***********          MOVELS3TXCD    #2TXCD                          CFT014
      **Cheque*********************************************************   CFT014
     C***********          MOVELS3CQCD    #2CQCD                          CFT014
      **Advice*charge**************************************************   CFT014
     C***********          MOVELS3ADCD    #2ADCD                          CFT014
      **Telephone*charge***********************************************   CFT014
     C***********          MOVELS3TLCD    #2TLCD                          CFT014
      **Miscellaneous**************************************************   CFT014
     C***********          MOVELS3MSCD    #2MSCD                          CFT014
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission************************************* S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELS3CHCD    #2CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***V.A.T.*flags********************************************* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELS3VAT1    #2VAT1                   S01499 CFT014
     C***********          MOVELS3VAT2    #2VAT2                   S01499 CFT014
     C***********          MOVELS3VAT3    #2VAT3                   S01499 CFT014
     C***********          MOVELS3VAT4    #2VAT4                   S01499 CFT014
     C***********          MOVELS3VAT5    #2VAT5                   S01499 CFT014
     C***********          MOVELS3VAT6    #2VAT6                   S01499 CFT014
     C***********          MOVELS3VAT7    #2VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
      ** Enhancement CFT014 is on.                                        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Bank Operation Code                                              CFT014
      *                                                                   CFT014
     C                     MOVELS3BOCD    #2BOCD                          CFT014
      *                                                                   CFT014
      ** Transaction Type Code                                            CFT014
      *                                                                   CFT014
     C                     MOVELS3TTCD    #2TTCD                          CFT014
      *                                                                   CFT014
      ** Instruction Code                                                 CFT014
      *                                                                   CFT014
     C                     MOVELS3ICD1    #2ICD1                          CFT014
     C                     MOVELS3ICD2    #2ICD2                          CFT014
     C                     MOVELS3ICD3    #2ICD3                          CFT014
     C                     MOVELS3ICD4    #2ICD4                          CFT014
     C                     MOVELS3ICD5    #2ICD5                          CFT014
      *                                                                   CFT014
      ** Regulatory Reporting                                             CFT014
      *                                                                   CFT014
     C                     MOVELS3RRP1    #2RRP1                          CFT014
     C                     MOVELS3RRP2    #2RRP2                          CFT014
     C                     MOVELS3RRP3    #2RRP3                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      **Initialise*charges*********************************************   CFT014
     C***********          EXSR MFIZ#D                                    CFT014
      *
      *  Error indicators
      *
      * Re-send screen indicator
      *
     C           E#NOUP    IFNE *BLANKS
     C                     MOVEL'1'       *IN99
     C                     END
      *
     C           I3DATA    IFEQ *BLANKS
     C                     MOVEA*BLANKS   ERCD
     C                     GOTO EXFTS2
     C                     END
      * Intermediary Bank
     C           I3INBK    IFEQ 'Y     '
     C                     MOVEA'11111'   *IN,31
     C                     END
     C           I3INB1    IFNE *BLANKS
     C                     MOVEL'1'       *IN31
     C                     END
     C           I3INB2    IFNE *BLANKS
     C                     MOVEL'1'       *IN32
     C                     END
     C           I3INB3    IFNE *BLANKS
     C                     MOVEL'1'       *IN33
     C                     END
     C           I3INB4    IFNE *BLANKS
     C                     MOVEL'1'       *IN34
     C                     END
     C           I3INB5    IFNE *BLANKS
     C                     MOVEL'1'       *IN35
     C                     END
      * Details of Charge
     C           I3PAY     IFEQ 'Y    '
     C                     MOVEA'11111'   *IN,36
     C                     END
     C           I3PAY1    IFNE *BLANKS
     C                     MOVEL'1'       *IN36
     C                     END
     C           I3PAY2    IFNE *BLANKS
     C                     MOVEL'1'       *IN37
     C                     END
     C           I3PAY3    IFNE *BLANKS
     C                     MOVEL'1'       *IN38
     C                     END
     C           I3PAY4    IFNE *BLANKS
     C                     MOVEL'1'       *IN39
     C                     END
      * Central Bank Reference
     C           I3CBKR    IFNE *BLANKS
     C                     MOVEL'1'       *IN40
     C                     END
      * Related Reference
     C           I3RLRF    IFNE *BLANKS
     C                     MOVEL'1'       *IN41
     C                     END
      **Details*of*Charge**********************************************   CFT014
     C***********I3DETC    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN42                           CFT014
     C***********          END                                            CFT014
      *                                                                   CFT014
      ** Transfer Commission Tariff                                       CFT014
      *                                                                   CFT014
     C           I3TRCT    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN42                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      * Outgoing to be generated
     C           I3OPIN    IFNE *BLANKS
     C                     MOVEL'1'       *IN43
     C                     END
     C/COPY WNCPYSRC,FT0355C030
      *
      **Charges********************************************************   CFT014
      ***********                                                         CFT014
      **Transfer*and*Commission****************************************   CFT014
     C***********I3TRCM    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN44                           CFT014
     C***********          END                                            CFT014
      **Telex**********************************************************   CFT014
     C***********I3TXCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN45                           CFT014
     C***********          END                                            CFT014
      **Cheque*********************************************************   CFT014
     C***********I3CQCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN46                           CFT014
     C***********          END                                            CFT014
      **Advice*Charge**************************************************   CFT014
     C***********I3ADCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN47                           CFT014
     C***********          END                                            CFT014
      **Telephone*Charge***********************************************   CFT014
     C***********I3TLCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN48                           CFT014
     C***********          END                                            CFT014
      **Miscellaneous**************************************************   CFT014
     C***********I3MSCH    IFNE *BLANKS                                   CFT014
     C***********          MOVEL'1'       *IN49                           CFT014
     C***********          END                                            CFT014
     C***********                                                  S01494 CFT014
     C***FX/Change*Commission************************************* S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********I3CHCM    IFNE *BLANKS                            S01494 CFT014
     C***********          MOVEL'1'       *IN50                    S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***If*switchable*feature*S01499*is*switched*ON*check*error** S01499 CFT014
     C***V.A.T.*flags********************************************* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Transfer*Commission*V.A.T.*Flag************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT1    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN51                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telex*V.A.T.*Flag**************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT2    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN52                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Cheque*V.A.T.*Flag*************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT3    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN53                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Advice*V.A.T.*Flag*************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT4    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN54                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telephone*V.A.T.*Flag************************************ S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT5    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN55                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Miscellaneous*V.A.T.*Flag******************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT6    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN56                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***FX/Change*Commission*V.A.T.*Flag************************* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********I3VAT7    IFNE *BLANKS                            S01499 CFT014
     C***********          MOVEL'1'       *IN57                    S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          END                                     S01499 CFT014
      *                                                                   CFT014
      ** Enhancement CFT014 is on.                                        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Bank Operation Code                                              CFT014
      *                                                                   CFT014
     C           I3BOCD    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN44                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Transaction Type Code                                            CFT014
      *                                                                   CFT014
     C           I3TTCD    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN45                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Instruction Code                                                 CFT014
      *                                                                   CFT014
     C           I3ICDE    IFEQ 'Y     '                                  CFT014
     C                     MOVEA'11111'   *IN,46                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3ICD1    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN46                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3ICD2    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN47                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3ICD3    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN48                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3ICD4    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN49                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3ICD5    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN50                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Regulatory Reporting                                             CFT014
      *                                                                   CFT014
     C           I3RRPT    IFEQ 'Y   '                                    CFT014
     C                     MOVEA'111'     *IN,51                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3RRP1    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN51                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3RRP2    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN52                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I3RRP3    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN53                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
     C                     MOVEAC#ERCD    ERCD
      *
      *  If warning sent then delay confirm
      *
     C           E#WARN    IFEQ 'Y'
     C           E#RSND    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#RSND
     C                     MOVEL'1'       *IN99
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXFTS2    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRFTS3   : Validation of screen 3 details                    *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: DCVLDL                                            *   CFT014
      *                                                               *   CFT014
      *  CALLS    : FT0359                                            *   CFT014
      *             MFIZ#D                                            *   CFT014
      *             SRERR                                             *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     CSR         SRFTS3    BEGSR                                          CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRFTS3'  @STK,Q                          CFT014
      **********                                                          187056 193190
      ***Check*if*'charges to the debit of' has changed,                  187056 193190
      ***recalculated charges.                                            187056 193190
      **********                                                          187056 193190
     C**********           EXSR SRRCAL                                    187056 193190
      *                                                                   CFT014
      ** Move screen fields to S0DATA fields.                             CFT014
      *                                                                   CFT014
     C                     MOVEL#1ACTC    S0ACTD                          CFT014
     C                     MOVEL#1PREF    S0PREF                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of                                          CFT014
      *                                                                   CFT014
     C                     MOVEL#3CDRO    S0CDRO                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of Branch                                   CFT014
      *                                                                   CFT014
     C                     MOVEL#3CDBR    S0CDBR                          CFT014
      *                                                                   CFT014
      ** Details of Charges                                               CFT014
      *                                                                   CFT014
     C                     MOVEL#3DTCH    S0DETC                          CFT014
      *                                                                   CFT014
      ** Transfer Commission                                              CFT014
      *                                                                   CFT014
     C                     MOVEL#3TRCD    S0TRCD                          CFT014
      *                                                                   CFT014
      ** Telex Charge                                                     CFT014
      *                                                                   CFT014
     C                     MOVEL#3TXCD    S0TXCD                          CFT014
      *                                                                   CFT014
      ** Cheque Charge                                                    CFT014
      *                                                                   CFT014
     C                     MOVEL#3CQCD    S0CQCD                          CFT014
      *                                                                   CFT014
      ** Advice Charge                                                    CFT014
      *                                                                   CFT014
     C                     MOVEL#3ADCD    S0ADCD                          CFT014
      *                                                                   CFT014
      ** Telephone Charge                                                 CFT014
      *                                                                   CFT014
     C                     MOVEL#3TLCD    S0TLCD                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge                                             CFT014
      *                                                                   CFT014
     C                     MOVEL#3MSCD    S0MSCD                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission                                            CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVEL#3CHCD    S0CHCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM1CD      S0M1CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM2CD      S0M2CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM3CD      S0M3CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM4CD      S0M4CD                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C                     MOVELM5CD      S0M5CD                          CFT009
      *                                                                   CFT009
      ** charge codes for each charge                                     CFT009
      *                                                                   CFT009
     C                     MOVELTRCDE     S0CDE1                          CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELFXCDE     S0CDE2                          CFT009
     C                     ENDIF                                          CFT009
     C                     MOVELTXCDE     S0CDE3                          CFT009
     C                     MOVELCQCDE     S0CDE4                          CFT009
     C                     MOVELADCDE     S0CDE5                          CFT009
     C                     MOVELTPCDE     S0CDE6                          CFT009
     C                     MOVELMSCDE     S0CDE7                          CFT009
     C                     MOVELM1CDE     S0CDE8                          CFT009
     C                     MOVELM2CDE     S0CDE9                          CFT009
     C                     MOVELM3CDE     S0CD10                          CFT009
     C                     MOVELM4CDE     S0CD11                          CFT009
     C                     MOVELM5CDE     S0CD12                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer Commission VAT flag                                     CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT1    S0VAT1                          CFT014
      *                                                                   CFT014
      ** Telex Charge VAT flag                                            CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT2    S0VAT2                          CFT014
      *                                                                   CFT014
      ** Cheque Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT3    S0VAT3                          CFT014
      *                                                                   CFT014
      ** Advice Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT4    S0VAT4                          CFT014
      *                                                                   CFT014
      ** Telephone Charge VAT flag                                        CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT5    S0VAT5                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge VAT flag                                    CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT6    S0VAT6                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission VAT flag                                   CFT014
      *                                                                   CFT014
     C                     MOVEL#3VAT7    S0VAT7                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           CFT010    IFEQ 'Y'                                       CFT009
     C                     MOVELVAT9      S0VT9                           CFT009
     C                     MOVELVAT10     S0VT10                          CFT009
     C                     MOVELVAT11     S0VT11                          CFT009
     C                     MOVELVAT12     S0VT12                          CFT009
     C                     MOVELVAT13     S0VT13                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Receiver's Charges Remitted                                      CFT014
      *                                                                   CFT014
     C                     MOVEL#3RCRM    S0RCRM                          CFT014
      *                                                                   CFT014
      ** Sender's Charges Deducted                                        CFT014
      *                                                                   CFT014
     C                     MOVEL#3SCH1    S0SCH1                          CFT014
     C                     MOVEL#3SCH2    S0SCH2                          CFT014
     C                     MOVEL#3SCH3    S0SCH3                          CFT014
     C                     MOVEL#3SCH4    S0SCH4                          CFT014
     C                     MOVEL#3SCH5    S0SCH5                          CFT014
     C                     MOVEL#3SCC1    S0SCC1                          CFT014
     C                     MOVEL#3SCC2    S0SCC2                          CFT014
     C                     MOVEL#3SCC3    S0SCC3                          CFT014
     C                     MOVEL#3SCC4    S0SCC4                          CFT014
     C                     MOVEL#3SCC5    S0SCC5                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initilise DS for error processing.                               CFT014
      *                                                                   CFT014
      ** No update indicator                                              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#NOUP                          CFT014
      *                                                                   CFT014
      ** Warning message sent                                             CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#WARN                          CFT014
      *                                                                   CFT014
      ** Message sent via FTSNMS                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#MSGS                          CFT014
      *                                                                   CFT014
      ** Program to send messages                                         CFT014
      *                                                                   CFT014
     C                     MOVEL##PGM     E#CPGM                          CFT014
      *                                                                   CFT014
      ** Error indicators to highlight screen fields                      CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   I0DATA                          CFT014
      *                                                                   CFT014
      ** This is an interactive call to FT0349 therefore the STP          CFT009
      ** function is manual                                               CFT009
      *                                                                   CFT009
     C                     MOVE 'M'       STP                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           #1ACTC    ANDEQ'E'                                       CFT009
     C                     ELSE                                           CFT009
     C                     CALL 'FT0359'               9090               CFT014
     C                     PARM *BLANK    P@RTCD                          CFT014
     C                     PARM '*VALID'  P0ACT   8                       CFT014
     C                     PARM           P0RSET  1                       CFT014
     C                     PARM           V#DATA                          CFT014
     C                     PARM           S0DATA                          CFT014
     C                     PARM           F0DATA                          CFT014
     C                     PARM           I0DATA                          CFT014
     C                     PARM           E#DATA                          CFT014
     C                     PARM           STP     1                       CFT009
      *                                                                   CFT014
      ** Error on call                                                    CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C           P@RTCD    ORNE *BLANKS                                   CFT014
     C           P@RTCD    ANDNE'*RECAL '                                 CFT009
     C                     Z-ADD026       W0ERNB                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     MOVEL'FT0359  'W0FILE                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Move back data from S0DATA fields to screen fields.              CFT014
      *                                                                   CFT014
      ** Charges to the Debit of                                          CFT014
      *                                                                   CFT014
     C                     MOVELS0CDRO    #3CDRO                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of Branch                                   CFT014
      *                                                                   CFT014
     C                     MOVELS0CDBR    #3CDBR                          CFT014
      *                                                                   CFT014
      ** Details of Charges                                               CFT014
      *                                                                   CFT014
     C                     MOVELS0DETC    #3DTCH                          CFT014
      *                                                                   CFT014
      ** Transfer Commission                                              CFT014
      *                                                                   CFT014
     C                     MOVELS0TRCD    #3TRCD                          CFT014
      *                                                                   CFT014
      ** Telex Charge                                                     CFT014
      *                                                                   CFT014
     C                     MOVELS0TXCD    #3TXCD                          CFT014
      *                                                                   CFT014
      ** Cheque Charge                                                    CFT014
      *                                                                   CFT014
     C                     MOVELS0CQCD    #3CQCD                          CFT014
      *                                                                   CFT014
      ** Advice Charge                                                    CFT014
      *                                                                   CFT014
     C                     MOVELS0ADCD    #3ADCD                          CFT014
      *                                                                   CFT014
      ** Telephone Charge                                                 CFT014
      *                                                                   CFT014
     C                     MOVELS0TLCD    #3TLCD                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge                                             CFT014
      *                                                                   CFT014
     C                     MOVELS0MSCD    #3MSCD                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission                                            CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELS0CHCD    #3CHCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS0M1CD    M1CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS0M2CD    M2CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS0M3CD    M3CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS0M4CD    M4CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C                     MOVELS0M5CD    M5CD                            CFT009
      *                                                                   CFT009
      ** CHARGE CODES FOR  ALL FIELDS                                     CFT009
      *                                                                   CFT009
     C                     MOVELS0CDE1    TRCDE                           CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVELS0CDE2    FXCDE                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELS0CDE3    TXCDE                           CFT009
     C                     MOVELS0CDE4    CQCDE                           CFT009
     C                     MOVELS0CDE5    ADCDE                           CFT009
     C                     MOVELS0CDE6    TPCDE                           CFT009
     C                     MOVELS0CDE7    MSCDE                           CFT009
     C                     MOVELS0CDE8    M1CDE                           CFT009
     C                     MOVELS0CDE9    M2CDE                           CFT009
     C                     MOVELS0CD10    M3CDE                           CFT009
     C                     MOVELS0CD11    M4CDE                           CFT009
     C                     MOVELS0CD12    M5CDE                           CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer Commission VAT flag                                     CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT1    #3VAT1                          CFT014
      *                                                                   CFT014
      ** Telex Charge VAT flag                                            CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT2    #3VAT2                          CFT014
      *                                                                   CFT014
      ** Cheque Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT3    #3VAT3                          CFT014
      *                                                                   CFT014
      ** Advice Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT4    #3VAT4                          CFT014
      *                                                                   CFT014
      ** Telephone Charge VAT flag                                        CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT5    #3VAT5                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge VAT flag                                    CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT6    #3VAT6                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission VAT flag                                   CFT014
      *                                                                   CFT014
     C                     MOVELS0VAT7    #3VAT7                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** V.A.T. flags                                                     CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
     C                     MOVELS0VT9     VAT9                            CFT009
     C                     MOVELS0VT10    VAT10                           CFT009
     C                     MOVELS0VT11    VAT11                           CFT009
     C                     MOVELS0VT12    VAT12                           CFT009
     C                     MOVELS0VT13    VAT13                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Receiver's Charges Remitted                                      CFT014
      *                                                                   CFT014
     C                     MOVELS0RCRM    #3RCRM                          CFT014
      *                                                                   CFT014
      ** Sender's Charges Deducted                                        CFT014
      *                                                                   CFT014
     C                     MOVELS0SCH1    #3SCH1                          CFT014
     C                     MOVELS0SCH2    #3SCH2                          CFT014
     C                     MOVELS0SCH3    #3SCH3                          CFT014
     C                     MOVELS0SCH4    #3SCH4                          CFT014
     C                     MOVELS0SCH5    #3SCH5                          CFT014
     C                     MOVELS0SCC1    #3SCC1                          CFT014
     C                     MOVELS0SCC2    #3SCC2                          CFT014
     C                     MOVELS0SCC3    #3SCC3                          CFT014
     C                     MOVELS0SCC4    #3SCC4                          CFT014
     C                     MOVELS0SCC5    #3SCC5                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Initialise charges.                                              CFT014
      *                                                                   CFT014
     C           #1ACTC    IFNE 'E'                                       CFT009
     C                     EXSR MFIZ#D                                    CFT014
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Check if 'charges to the debit of' has changed.  Recalculate                         193190
      ** charges if no error in validation.                                                   193190
      *                                                                                       193190
     C           I0CDRT    IFEQ *BLANKS                                                       193190
     C           I0CDBR    ANDEQ*BLANKS                                                       193190
     C                     EXSR SRRCAL                                                        193190
     C                     ENDIF                                                              193190
      *                                                                                       193190
      ** Re-send screen indicator.                                        CFT014
      *                                                                   CFT014
     C           E#NOUP    IFNE *BLANKS                                   CFT014
     C           WREDSP    OREQ 'Y'                                       187056
     C           FT652     OREQ 'Y'                                       CFT009
     C           P@RTCD    OREQ '*RECAL'                                  CFT009
     C                     MOVE *ON       *IN99                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0DATA    IFEQ *BLANKS                                   CFT014
     C                     GOTO EXFTS3                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Seton screen error indicators based on the data from I0DATA.     CFT014
      *                                                                   CFT014
      ** Charges to the Debit of                                          CFT014
      *                                                                   CFT014
     C           I0CDRT    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN58                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of Branch                                   CFT014
      *                                                                   CFT014
     C           I0CDBR    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN59                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Details of Charges                                               CFT014
      *                                                                   CFT014
     C           I0DETC    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN42                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Transfer Commission                                              CFT014
      *                                                                   CFT014
     C           I0TRCM    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN44                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex Charge                                                     CFT014
      *                                                                   CFT014
     C           I0TXCH    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN45                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque Charge                                                    CFT014
      *                                                                   CFT014
     C           I0CQCH    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN46                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Advice Charge                                                    CFT014
      *                                                                   CFT014
     C           I0ADCH    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN47                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telephone Charge                                                 CFT014
      *                                                                   CFT014
     C           I0TLCH    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN48                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge                                             CFT014
      *                                                                   CFT014
     C           I0MSCH    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN49                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission                                            CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C           I0CHCM    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN50                           CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES)                                 CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C           I0M1CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN72                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C           I0M2CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN88                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C           I0M3CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN94                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C           I0M4CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN97                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C           I0M5CD    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN27                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** CODES FOR  ALL FIELDS                                            CFT009
      *                                                                   CFT009
     C           I0CDE1    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN64                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C           I0CDE2    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN65                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE3    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN66                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE4    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN67                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE5    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN68                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE6    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN69                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE7    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN70                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE8    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN71                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDE9    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN87                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CD10    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN93                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CD11    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN96                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CD12    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN26                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer Commission VAT flag                                     CFT014
      *                                                                   CFT014
     C           I0VAT1    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN51                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex Charge VAT flag                                            CFT014
      *                                                                   CFT014
     C           I0VAT2    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN52                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C           I0VAT3    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN53                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Advice Charge VAT flag                                           CFT014
      *                                                                   CFT014
     C           I0VAT4    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN54                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telephone Charge VAT flag                                        CFT014
      *                                                                   CFT014
     C           I0VAT5    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN55                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous Charge VAT flag                                    CFT014
      *                                                                   CFT014
     C           I0VAT6    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN56                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** F/X Change Commission VAT flag                                   CFT014
      *                                                                   CFT014
     C           I0VAT7    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN57                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** V.A.T. flags                                                     CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Miscellaneous 1 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I0VT9     IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN84                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 2 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I0VT10    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN92                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 3 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I0VT11    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN95                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 4 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I0VT12    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN43                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous 5 VAT flag                                         CFT009
      *                                                                   CFT009
     C           I0VT13    IFNE *BLANKS                                   CFT009
     C                     MOVE *ON       *IN28                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Enhancement CFT014 is on.                                        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Receiver's Charges Remitted                                      CFT014
      *                                                                   CFT014
     C           I0RCRM    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN31                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Sender's Charges Deducted                                        CFT014
      *                                                                   CFT014
     C           I0SCHG    IFEQ 'Y     '                                  CFT014
     C                     MOVEA'11111'   *IN,32                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCH1    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN32                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCH2    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN33                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCH3    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN34                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCH4    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN35                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCH5    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN36                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCCY    IFEQ 'Y     '                                  CFT014
     C                     MOVEA'11111'   *IN,37                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCC1    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN37                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCC2    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN38                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCC3    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN39                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCC4    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN40                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           I0SCC5    IFNE *BLANKS                                   CFT014
     C                     MOVEL'1'       *IN41                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If warning sent, then delay confirm.                             CFT014
      *                                                                   CFT014
     C           E#WARN    IFEQ 'Y'                                       CFT014
     C           E#RSND    ANDEQ*BLANKS                                   CFT014
     C                     MOVEL'Y'       E#RSND                          CFT014
     C                     MOVE *ON       *IN99                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C           EXFTS3    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      /EJECT                                                              CFT014
      *****************************************************************   187056
      *                                                               *   187056
      *  SRRCAL   : Recalculate charges due to change in Charges to   *   187056
      *             the Debit of.                                     *   187056
      *  CALLED BY: SRFTS3                                            *   187056
      *                                                               *   187056
      *  CALLS    : FT0359                                            *   187056
      *                                                               *   187056
      *****************************************************************   187056
     CSR         SRRCAL    BEGSR                                          187056
      *                                                                   187056
      ** Set up subroutine stack name.                                    187056
      *                                                                   187056
     C                     ADD  1         Q                               187056
     C                     MOVEL'SRRCAL'  @STK,Q                          187056
      *                                                                   187056
     C                     MOVE *BLANKS   W0FCUS                          187056
     C                     MOVE *BLANKS   W0SCUS                          187056
     C                     MOVE 'N'       WREDSP  1                       187056
      *                                                                   187056
      ** Perform the following only if core feature S01508 is             187056
      ** installed and core feature S01506 is NOT installed.              187056
      *                                                                   187056
     C           S01508    IFEQ 'Y'                                       187056
     C           S01506    ANDNE'Y'                                       187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (saved field)             187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           WCDRT     IFNE *BLANKS                                   187056
     C                     MOVE WCDRT     I#PT1                           187056
     C           WCDRO     CAT  WCDBR     I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0FCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (screen field)            187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           F0CDRT    IFNE *BLANKS                                   187056
     C                     MOVE F0CDRT    I#PT1                           187056
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0SCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Move this after the input and charge currencies have been                            222568
      ** updated.  They are needed in FT0359.                                                 222568
      *                                                                                       222568
     C********** #3CDRO    IFNE WCDRO                                                  187056 222568
     C********** #1ACTC    ANDNE'E'                                                    CFT009 222568
     C********** #3CDBR    ORNE WCDBR                                                  187056 222568
     C********** #1ACTC    ANDNE'E'                                                    CFT009 222568
     C********** W0FCUS    ORNE W0SCUS                                                 187056 222568
     C********** #1ACTC    ANDNE'E'                                                    CFT009 222568
      *                                                                   187056
     C**********           MOVEL#3CDRO    WCDRO                                        187056 222568
     C**********           MOVEL#3CDBR    WCDBR                                        187056 222568
     C**********           MOVELF0CDRT    WCDRT                                        187056 222568
      *                                                                   187056
     C                     SELEC                                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'B'                                       187056
     C           #3CDRO    ORNE *BLANKS                                   187056
     C           BTCHCY    ANDEQ'C'                                                           222568
     C                     MOVELV#BCCY    V#CCCY                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'L'                                       187056
     C                     MOVELV#LCCY    V#CCCY                          187056
      *                                                                   187056
     C           BTCHCY    WHEQ 'C'                                       187056
     C           V#ADDC    ANDEQ'A'                                       187056
     C                     MOVELSMCY      V#CCCY                          187056
      *                                                                   187056
     C                     OTHER                                          187056
     C                     MOVELPCCY      V#CCCY                          187056
      *                                                                   187056
     C                     ENDSL                                          187056
      *                                                                   187056
     C                     MOVELV#CCCY    #3CCY1                          187056
     C                     MOVELV#CCCY    #3CCY2                          187056
     C                     MOVELV#CCCY    #3CCY3                          187056
     C                     MOVELV#CCCY    #3CCY4                          187056
     C                     MOVELV#CCCY    #3CCY5                          187056
     C                     MOVELV#CCCY    #3CCY6                          187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVELV#CCCY    #3CCY7                          187056
     C                     ENDIF                                          187056
     C           S01499    IFEQ 'Y'                                       187056
     C                     MOVELV#CCCY    #3CCY8                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     SELEC                                          187056
      *                                                                   187056
     C           #3CDRO    WHNE *BLANKS                                   187056
     C                     MOVELV#BCCY    V#RCCY                          187056
      *                                                                   187056
     C           V#ADDC    WHEQ 'A'                                       187056
     C                     MOVELSMCY      V#RCCY                          187056
      *                                                                   187056
     C           SND1      IFEQ 'CASHIER'                                 187056
     C           PCCY      ANDEQV#BCCY                                    187056
     C                     MOVELPCCY      V#RCCY                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     OTHER                                          187056
     C                     MOVELPCCY      V#RCCY                          187056
      *                                                                   187056
     C                     ENDSL                                          187056
      *                                                                   187056
     C                     MOVELV#RCCY    #3RCY1                          187056
     C                     MOVELV#RCCY    #3RCY2                          187056
     C                     MOVELV#RCCY    #3RCY3                          187056
     C                     MOVELV#RCCY    #3RCY4                          187056
     C                     MOVELV#RCCY    #3RCY5                          187056
     C                     MOVELV#RCCY    #3RCY6                          187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVELV#RCCY    #3RCY7                          187056
     C                     ENDIF                                          187056
     C           S01499    IFEQ 'Y'                                       187056
     C                     MOVELV#RCCY    #3RCY8                          187056
     C                     ENDIF                                          187056
      *                                                                                       222568
     C           #3CDRO    IFNE WCDRO                                                         222568
     C           #1ACTC    ANDNE'E'                                                           222568
     C           #3CDBR    ORNE WCDBR                                                         222568
     C           #1ACTC    ANDNE'E'                                                           222568
     C           W0FCUS    ORNE W0SCUS                                                        222568
     C           #1ACTC    ANDNE'E'                                                           222568
      *                                                                                       222568
     C                     MOVEL#3CDRO    WCDRO                                               222568
     C                     MOVEL#3CDBR    WCDBR                                               222568
     C                     MOVELF0CDRT    WCDRT                                               222568
      *                                                                   187056
      ** Call routine to calculate defaults.                              187056
      *                                                                   187056
     C                     EXSR SRCDFT                                    187056
      *                                                                   187056
      ** Look field up on database.                                       187056
      *                                                                   187056
     C                     CALL 'AOCURRR0'             9090               187056
     C                     PARM *BLANKS   RTCD                            187056
     C                     PARM '*KEY   ' @OPTN                           187056
     C                     PARM V#CCCY    @K101                           187056
     C           SDCURR    PARM *BLANKS   DSSDY                           187056
      *                                                                   187056
      ** Error on call.                                                   187056
      *                                                                   187056
     C           *IN90     IFEQ '1'                                       187056
     C                     Z-ADD56        W0ERNB                          187056
     C                     MOVEL'*CALL'   W0KEY                           187056
     C                     MOVEL'AOCURRR0'W0FILE                          187056
     C                     MOVEL'MEM5003' W0MSGD                          187056
     C                     MOVEL'MIDAS  ' W0MSGF                          187056
     C                     EXSR SRERR                                     187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Save number of decimal places (input currency).                  187056
      *                                                                   187056
     C                     Z-ADDA6NBDP    V#CDCP  10                      187056
      *                                                                   187056
      ** Format Transfer Commission amount for screen.                    187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TRCD                          187056
     C           DUMA1     IFNE 0                                         187056
     C                     MOVE DUMA1     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TRCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Telex Charge amount for screen.                           187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TXCD                          187056
     C           DUMA2     IFNE 0                                         187056
     C                     MOVE DUMA2     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TXCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Cheque Charge amount for screen.                          187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CQCD                          187056
     C           DUMA3     IFNE 0                                         187056
     C                     MOVE DUMA3     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3CQCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Advice Charge amount for screen.                          187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3ADCD                          187056
     C           DUMA4     IFNE 0                                         187056
     C                     MOVE DUMA4     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3ADCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Telephone Charge amount for screen.                       187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TLCD                          187056
     C           DUMA5     IFNE 0                                         187056
     C                     MOVE DUMA5     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TLCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Miscellaneous Charge amount for screen.                   187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3MSCD                          187056
     C           DUMA6     IFNE 0                                         187056
     C                     MOVE DUMA6     ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3MSCD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format FX/Change Commission amount for screen.                   187056
      *                                                                   187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVEL*BLANKS   #3CHCD                          187056
     C           INDUM7    IFNE 0                                         187056
     C                     MOVE INDUM7    ZFIELD                          187056
     C*                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
     C*                                                                   187056
     C                     MOVE ZFIELD    #3CHCD                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Look field up on database.                                       187056
      *                                                                   187056
     C                     CALL 'AOCURRR0'             9090               187056
     C                     PARM *BLANKS   RTCD                            187056
     C                     PARM '*KEY   ' @OPTN                           187056
     C                     PARM V#RCCY    @K101                           187056
     C           SDCURR    PARM *BLANKS   DSSDY                           187056
      *                                                                   187056
      ** Error on call.                                                   187056
      *                                                                   187056
     C           *IN90     IFEQ '1'                                       187056
     C                     Z-ADD57        W0ERNB                          187056
     C                     MOVEL'*CALL'   W0KEY                           187056
     C                     MOVEL'AOCURRR0'W0FILE                          187056
     C                     MOVEL'MEM5003' W0MSGD                          187056
     C                     MOVEL'MIDAS  ' W0MSGF                          187056
     C                     EXSR SRERR                                     187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Save number of decimal places (charge currency).                 187056
      *                                                                   187056
     C                     Z-ADDA6NBDP    V#RDCP  10                      187056
      *                                                                   187056
      ** Format Transfer Commission amount for screen.                    187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TRCM                          187056
     C           TRCM      IFNE 0                                         187056
     C                     MOVE TRCM      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TRCM                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Telex Charge amount for screen.                           187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TXCH                          187056
     C           TXCH      IFNE 0                                         187056
     C                     MOVE TXCH      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TXCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Cheque Charge amount for screen.                          187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3CQCH                          187056
     C           CQCH      IFNE 0                                         187056
     C                     MOVE CQCH      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3CQCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Advice Charge amount for screen.                          187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3ADCH                          187056
     C           ADCH      IFNE 0                                         187056
     C                     MOVE ADCH      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3ADCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Telephone Charge amount for screen.                       187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3TLCH                          187056
     C           TLCH      IFNE 0                                         187056
     C                     MOVE TLCH      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3TLCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format Miscellaneous Charge amount for screen.                   187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3MSCH                          187056
     C           MSCH      IFNE 0                                         187056
     C                     MOVE MSCH      ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3MSCH                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format FX/Change Commission amount for screen.                   187056
      *                                                                   187056
     C           S01494    IFEQ 'Y'                                       187056
     C                     MOVEL*BLANKS   #3CHCM                          187056
     C           INCHCM    IFNE 0                                         187056
     C                     MOVE INCHCM    ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM A6NBDP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3CHCM                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** If switchable feature S01499 is switched ON, initialise          187056
      ** V.A.T. flags and total V.A.T. amount.                            187056
      *                                                                   187056
     C           S01499    IFEQ 'Y'                                       187056
      *                                                                   187056
      ** Transfer Commission V.A.T. flag.                                 187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT1                          187056
     C           INVAT1    IFNE *BLANK                                    187056
     C                     MOVELINVAT1    #3VAT1                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT1                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Telex V.A.T. flag.                                               187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT2                          187056
     C           INVAT2    IFNE *BLANK                                    187056
     C                     MOVELINVAT2    #3VAT2                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT2                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Cheque V.A.T. flag.                                              187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT3                          187056
     C           INVAT3    IFNE *BLANK                                    187056
     C                     MOVELINVAT3    #3VAT3                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT3                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Advice V.A.T. flag.                                              187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT4                          187056
     C           INVAT4    IFNE *BLANK                                    187056
     C                     MOVELINVAT4    #3VAT4                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT4                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Telephone V.A.T. flag.                                           187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT5                          187056
     C           INVAT5    IFNE *BLANK                                    187056
     C                     MOVELINVAT5    #3VAT5                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT5                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Miscellaneous V.A.T. flag.                                       187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT6                          187056
     C           INVAT6    IFNE *BLANK                                    187056
     C                     MOVELINVAT6    #3VAT6                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT6                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** FX/Change Commission V.A.T. flag.                                187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VAT7                          187056
     C           INVAT7    IFNE *BLANK                                    187056
     C                     MOVELINVAT7    #3VAT7                          187056
     C                     ELSE                                           187056
     C           #1ACTC    IFNE 'E'                                       187056
     C                     MOVELT#VATT    #3VAT7                          187056
     C                     ENDIF                                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Recalculate total V.A.T. amount.                                 187056
      *                                                                   187056
     C                     EXSR SRVATC                                    187056
      *                                                                   187056
      ** Format total V.A.T. amount for screen.                           187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VATD                          187056
     C           INDUM8    IFNE 0                                         187056
     C                     MOVE INDUM8    ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM V#CDCP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3VATD                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Format total V.A.T. amount for screen.                           187056
      *                                                                   187056
     C                     MOVEL*BLANKS   #3VATT                          187056
     C           INVATT    IFNE 0                                         187056
     C                     MOVE INVATT    ZFIELD                          187056
      *                                                                   187056
     C                     CALL 'ZEDIT'                9090               187056
     C                     PARM           ZFIELD                          187056
     C                     PARM V#RDCP    ZADEC                           187056
      *                                                                   187056
     C                     MOVE ZFIELD    #3VATT                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      **  Reset recalculation flag.                                       187056
      *                                                                   187056
     C                     MOVE 'N'       W0RCAL                          187056
      *                                                                   187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     MOVE 'Y'       WREDSP                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Unwind subroutine stack name.                                    187056
      *                                                                   187056
     C           EXRCAL    TAG                                            187056
     C                     MOVEA*BLANKS   @STK,Q                          187056
     C                     SUB  1         Q                               187056
      *                                                                   187056
     CSR                   ENDSR                                          187056
      /EJECT                                                              187056
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'EBPR##'  @STK,Q
      *================================================================
      *
      * Clear Update positions arrays
      *
     C                     EXSR SRCLR
      *
      * Process request
      *
     C           #1ACTC    CASEQ'I'       EECHRQ
     C           #1ACTC    CASEQ'A'       EECHRQ
     C                     END
      *
     C           W0RTN     IFNE *BLANK
      *
      * Error: ROLLBACK any DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     GOTO EBEXIT
     C                     ELSE
      *
      * Otherwise COMMIT any DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     COMIT
     C                     ENDIF                                                              CSC022
     C                     END
     C           W0RTN     IFEQ *BLANK
      *
      * USER: Process command keys
      * EDTRCD: Process cmds - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Process Command Keys
     C/COPY WNCPYSRC,FT0355DPCK
      *
     C           P3LINK    IFNE 'Y'
     C           P2PREF    ANDNE*BLANKS
      *
      * Exit after successful add
      *
     C                     MOVEL'R'       W0RPT
     C                     END
      *
      * Restart program for next record
      *
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EBEXIT    TAG
      *
      * Clear Update positions arrays
      *
     C                     EXSR SRCLR
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'EECHRQ'  @STK,Q
      *================================================================
      * USER: Change DBF record
      * Change object - Incoming Valid Messages  *
      *
     C                     EXSR SDCHRC
     C           W0RTN     IFNE *BLANK
      *
      * DBF update error
      * Reset screen fields if changed record
      *
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      *
      * Send message '*Record changed'
      *
     C                     MOVEL*BLANKS   #MSDTA
     C                     MOVELPREF      #MPREF
     C                     MOVEL#MSDTA    ZAMSDA
     C                     MOVEL'MIN0028' ZAMSID
     C                     MOVEL'MEMSG   'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         FACKPM    BEGSR
      *================================================================
      * Check passed parameters
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'FACKPM'  @STK,Q
      *
      * Set off command keys
      *
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
      *
      * Is full key present?
      *
     C           P2PREF    IFEQ *BLANK                     Reference
      *
      * Not every key field passed - loop program
      *
     C                     MOVEL'Y'       W0RPT   1
     C                     ELSE
      *
      * Full key passed, so single shot program
      *
      * Allow command F7
      *
     C                     MOVEL'N'       W0RPT
     C           P3LINK    IFEQ 'Y'
     C                     MOVEL'1'       *IN75
     C                     END
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           FAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'GADSAK'  @STK,Q
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      * If errors in #1ERR1 or #1ERR2 display
      *
     C                     MOVEL'0'       *IN76
     C                     MOVEAERCD,1    #1ERR1
     C                     MOVEAERCD,19   #1ERR2
     C           #1ERR1    IFNE *BLANKS
     C           #1ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           GAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'GBDSAD'  @STK,Q
      *
      * If enquiry or delete protect screen
      *
     C           #1ACTC    IFEQ 'E'
     C                     MOVEL'1'       *IN79
     C                     ELSE
     C                     MOVEL'0'       *IN79
     C                     END
      *
      * Originating branches used
      *
     C           BKOBRU    IFEQ 'Y'
     C                     MOVEL'1'       *IN77
     C                     ELSE
     C                     MOVEL'0'       *IN77
     C                     END
      *
      * Allow entry of all fields if add
      *
     C           #1ACTC    IFEQ 'A'
     C                     MOVEL'1'       *IN73
     C                     ELSE
     C                     MOVEL'0'       *IN73
     C                     END
      *
      * Enable F7 if linked
      *
     C           P3LINK    IFEQ 'Y'
     C                     MOVEL'1'       *IN75
     C                     ELSE
     C                     MOVEL'0'       *IN75
     C                     END
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      * If errors in #1ERR1 or #1ERR2 display
      *
     C                     MOVEL'0'       *IN76
     C           ##SCR     IFEQ 'SCR1'
     C                     MOVEAERCD,1    #1ERR1
     C                     MOVEAERCD,19   #1ERR2
     C           #1ERR1    IFNE *BLANKS
     C           #1ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
     C                     ELSE
      *                                                                   CFT014
     C           ##SCR     IFEQ 'SCR2'                                    CFT014
      *
      * If account with institution then allow OPIN input
      *
     C           ACBT      IFEQ *BLANKS                    Multi Branched ?
     C                     MOVEL'0'       *IN60
     C                     ELSE
     C                     MOVEL'1'       *IN60
     C                     END
      *
     C                     MOVEAERCD,1    #2ERR1
     C                     MOVEAERCD,19   #2ERR2 76
     C           #2ERR1    IFNE *BLANKS
     C           #2ERR2    ORNE *BLANKS
     C                     MOVEL'1'       *IN76
     C                     END
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     END
      *
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           GBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIZ#K'  @STK,Q
      *
      * Clear Warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      *
      * Clear screen fields
      *
      ***Transfer*Comission*tariff*************************************   CFT014
     C***********          MOVEL*BLANKS   #1TRCT                          CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVEL*BLANKS   #1CDBR                          CFT014
      *  Ordering Bank
     C                     MOVEL*BLANKS   #1OBK1
     C                     MOVEL*BLANKS   #1OBK2
     C                     MOVEL*BLANKS   #1OBK3
     C                     MOVEL*BLANKS   #1OBK4
     C                     MOVEL*BLANKS   #1OBK5
      *  Sender's Correspondent
     C                     MOVEL*BLANKS   #1SNC1
     C                     MOVEL*BLANKS   #1SNC2
     C                     MOVEL*BLANKS   #1SNC3
     C                     MOVEL*BLANKS   #1SNC4
     C                     MOVEL*BLANKS   #1SNC5
      *  Ordering Customer
     C                     MOVEL*BLANKS   #1ORC1
     C                     MOVEL*BLANKS   #1ORC2
     C                     MOVEL*BLANKS   #1ORC3
     C                     MOVEL*BLANKS   #1ORC4
     C                     MOVEL*BLANKS   #1ORC5
      *  Sender to Receiver information
     C                     MOVEL*BLANKS   #1BBI1
     C                     MOVEL*BLANKS   #1BBI2
     C                     MOVEL*BLANKS   #1BBI3
     C                     MOVEL*BLANKS   #1BBI4
     C                     MOVEL*BLANKS   #1BBI5
     C                     MOVEL*BLANKS   #1BBI6
      *
     C                     MOVEL*BLANKS   #1ACTC
     C                     MOVEL*BLANKS   #1PREF
      *
      ** If passed action code is not blank put this in #1ACTC
      *
     C           P1ACTC    IFNE *BLANKS
     C                     MOVELP1ACTC    #1ACTC
     C                     END
      *
      ** If passed reference is not blank use this if action not I
      *
     C           P2PREF    IFNE *BLANKS
     C                     MOVELP2PREF    #1PREF
     C                     END
      *
      * Fill Command lines and narrative text from messages
      *
     C                     SELEC
      *
      * Insert, Amendment or Enquiry screen
      *
     C           #1ACTC    WHEQ 'A'
     C           #1ACTC    OREQ 'E'
     C           #1ACTC    OREQ 'I'
     C           #1ACTC    OREQ ' '
      *
      * Function keys and Action codes
      *
     C                     MOVEL*BLANKS   W#ACTC  7
     C           P3LINK    IFNE 'Y'
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2626' W#FKEY                          CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2003' W#FKEY  7
     C                     ENDIF                                          CFT007
      *                                                                   CAC001
      **  If Analytical Accounting installed, include 'F19' text.         CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2627' W#FKY                           CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2552' W#FKY                           CAC001
     C                     ENDIF                                          CFT007
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ELSE
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2628' W#FKEY                          CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2006' W#FKEY
     C                     ENDIF                                          CFT007
      *                                                                   CAC001
      **  If Analytical Accounting installed, include 'F19' text.         CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CFT007
     C           CFT007    IFEQ 'CFT007'                                  CFT007
     C           #1ACTC    ANDNE'E'                                       CFT007
     C                     MOVEL'FTM2612' W#FKY                           CFT007
     C                     ELSE                                           CFT007
     C                     MOVEL'FTM2553' W#FKY   7                       CAC001
     C                     ENDIF                                          CFT007
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END
     C                     MOVEL'0'       *IN74
     C                     ENDSL
      *
      * Blank out action code and function key lines
      *
     C                     MOVEL*BLANKS   ##CMD1
     C                     MOVEL*BLANKS   ##CMD2
     C                     MOVEL*BLANKS   ##CMD3
     C                     MOVEL*BLANKS   ##CMD4
     C                     MOVEL*BLANKS   ##CMD5                          CFT014
     C                     MOVEL*BLANKS   ##CMD6                          CFT014
      *
      * Action codes
      *
     C           W#ACTC    IFNE *BLANKS
     C                     CALL 'MEC1150'              9090
     C                     PARM W#ACTC    #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    ##CMD1
     C                     MOVEL#MSTX1    ##CMD3
     C                     MOVEL#MSTX1    ##CMD5                          CFT014
     C                     END
      *
      * Function keys and allow delete key
      *
     C           W#FKEY    IFNE *BLANKS
     C                     CALL 'MEC1150'              9090
     C                     PARM W#FKEY    #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    ##CMD2
     C                     MOVEL#MSTX1    ##CMD4
     C                     MOVEL#MSTX1    ##CMD6                          CFT014
     C                     END
      *                                                                   CAC001
      ** If Analytical Accounting is installed, make 'F19' accessible     CAC001
      ** in CHARGES screen only.                                          CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           W#FKY     ANDNE*BLANKS                                   CAC001
     C***********          MOVE *BLANKS   ##CMD4                   CAC001 CFT014
     C                     MOVE *BLANKS   ##CMD6                          CFT014
     C                     CALL 'MEC1150'              9090               CAC001
     C                     PARM W#FKY     #MSGID                          CAC001
     C                     PARM 'FTUSRMSG'#MSGF                           CAC001
     C                     PARM           #MSDTA                          CAC001
     C                     PARM *BLANKS   #MSTX1                          CAC001
     C                     PARM *BLANKS   #MSTX2                          CAC001
      *                                                                   CAC001
     C***********          MOVEL#MSTX1    ##CMD4                   CAC001 CFT014
     C                     MOVEL#MSTX1    ##CMD6                          CFT014
     C                     END                                            CAC001
     C/COPY WNCPYSRC,FT0355C025
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MAEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @INPAYL1 fields to screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MBFL#1'  @STK,Q
      ***Transfer*Comission*tariff*************************************   CFT014
     C/COPY WNCPYSRC,FT0355C014
     C***********          MOVELTRCT      #1TRCT                          CFT014
     C/COPY WNCPYSRC,FT0355C015
      ***********                                                         CFT014
      ***Determine*branch*for*charge*defaults**************************   CFT014
      ***********                                                         CFT014
     C***********          SELEC                                          CFT014
      ***********                                                         CFT014
      ***If*single*branch*mode,*use*single*branch*code*from*SDBANKPD***   CFT014
      ***********                                                         CFT014
     C***********WUMBIN    WHNE 'Y'                                       CFT014
     C***********          MOVELV#SBRC    PYBR                            CFT014
      ***********                                                         CFT014
      ***Multibranched*and*originating*branches*used*******************   CFT014
      ***********                                                         CFT014
     C***********V#OBUV    WHEQ 'Y'                                       CFT014
     C***********          MOVELORBR      PYBR                            CFT014
      ***********                                                         CFT014
      ***Multibranched*and*originating*branches*not*used***************   CFT014
      ***********                                                         CFT014
     C***********          OTHER                                          CFT014
     C***********          MOVELBRCA      PYBR                            CFT014
      ***********                                                         CFT014
     C***********          ENDSL                                          CFT014
      ***********                                                         CFT014
      ***If*transfer*commission*blank*and*action*insert*default********   CFT014
      ***********                                                         CFT014
     C***********#1ACTC    IFEQ 'I'                                       CFT014
     C***********#1TRCT    ANDEQ*BLANKS                                   CFT014
      ***********                                                         CFT014
     C***********PYBR      CHAINPYCHGDB              90    Get defaults.  CFT014
      ***********                                                         CFT014
      ***No*record*found*-*DB*error*only*if*not*multibranched**********   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********WUMBIN    ANDNE'Y'                                       CFT014
     C***********          MOVEL'PYCHGDB 'W0FILE          *************** CFT014
     C***********          MOVELPYBR      W0KEY           * DB ERROR 03 * CFT014
     C***********          Z-ADD3         W0ERNB          *************** CFT014
     C***********          MOVEL'MEM5004' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***No*payment*charges*information********************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
      ***********                                                         CFT014
     C***********          MOVEL'1'       *IN31                           CFT014
     C***********          MOVELPYBR      ZAMSDA                          CFT014
     C***********          MOVEL'FTM2001' ZAMSID                          CFT014
     C***********          EXSR ZASNMS                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      ***Payment*charges*information***********************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '0'                                       CFT014
     C/COPY WNCPYSRC,FT0355C016
     C***********          MOVELDFTRCT    #1TRCT                          CFT014
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0355CISE                                           S01408
     C*                                                                   S01408
     C***********          END                                            CFT014
     C***********          END                                            CFT014
      ***Charges*to*the*debit*of***************************************   CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
      ***********                                                         CFT014
     C***********CDRT      IFNE *BLANKS                                   CFT014
     C************LIKE     DEFN #1CDRO    A#0012                          CFT014
     C***********          MOVELCDRO      A#0012                          CFT014
      ***********                                                         CFT014
     C***********          SELEC                                          CFT014
     C***********CDRT      WHEQ 'N'                                       CFT014
     C***********2         SUBSTA#0012:1  #1CDRO    P                     CFT014
     C***********CDRT      WHEQ 'R'                                       CFT014
     C***********10        SUBSTA#0012:1  #1CDRO    P                     CFT014
     C***********CDRT      WHEQ 'P'                                       CFT014
     C***********          MOVELCDRO      #1CDRO                          CFT014
     C***********          ENDSL                                          CFT014
     C/COPY WNCPYSRC,FT0355C003
      ***********                                                         CFT014
     C***********          ELSE                                           CFT014
     C***********          MOVEL*BLANKS   #1CDRO                          CFT014
     C***********          END                                            CFT014
     C/COPY WNCPYSRC,FT0355C020
      ***Charges*to*the*debit*of*branch********************************   CFT014
     C***********          MOVELCDBR      #1CDBR                          CFT014
      *                                                                   CFT014
      *  Ordering Bank
     C                     MOVELORB1      #1OBK1
     C                     MOVELORB2      #1OBK2
     C                     MOVELORB3      #1OBK3
     C                     MOVELORB4      #1OBK4
     C                     MOVELORB5      #1OBK5
      *  Sender's Correspondent
     C                     MOVELSNC1      #1SNC1
     C                     MOVELSNC2      #1SNC2
     C                     MOVELSNC3      #1SNC3
     C                     MOVELSNC4      #1SNC4
     C                     MOVELSNC5      #1SNC5
      *  Ordering Customer
     C                     MOVELORC1      #1ORC1
     C                     MOVELORC2      #1ORC2
     C                     MOVELORC3      #1ORC3
     C                     MOVELORC4      #1ORC4
     C**********           MOVEL*BLANKS   #1ORC5                                              CFT032
     C                     MOVELORC5      #1ORC5                                              CFT032
      *  Sender to Receiver information
     C                     MOVELBBI1      #1BBI1
     C                     MOVELBBI2      #1BBI2
     C                     MOVELBBI3      #1BBI3
     C                     MOVELBBI4      #1BBI4
     C                     MOVELBBI5      #1BBI5
     C                     MOVELBBI6      #1BBI6
      *                                                                   187056
      ** Save work previous value of Charges to the Debit of.             187056
      *                                                                   187056
     C**********           MOVEL*BLANKS   WCDRO  12                       187056       187056 CGL029
     C                     MOVEL*BLANKS   WCDRO  18                                           CGL029
     C                     MOVELCDBR      WCDBR   3                       187056
     C                     MOVELCDRT      WCDRT   1                       187056
      *                                                                   187056
     C           CDRT      IFNE *BLANKS                                   187056
     C                     MOVELCDRO      A#0012                          187056
     C                     SELEC                                          187056
     C           CDRT      WHEQ 'N'                                       187056
     C           2         SUBSTA#0012:1  WCDRO     P                     187056
     C           CDRT      WHEQ 'R'                                       187056
     C           10        SUBSTA#0012:1  WCDRO     P                     187056
     C           CDRT      WHEQ 'P'                                       187056
     C                     MOVELCDRO      WCDRO                           187056
     C                     ENDSL                                          187056
     C                     ENDIF                                          187056
      *
     C/COPY WNCPYSRC,FT0355C026
      * Set V# variables
      *
     C                     MOVEL*BLANKS   R#RCHK
     C                     MOVELSMCY      R#SMCY
     C                     MOVELPCCY      R#PCCY
     C                     Z-ADDSMAM      R#SMAM
     C                     Z-ADDPYAM      R#PYAM
     C                     Z-ADDRATE      R#RATE
     C                     MOVELOVRD      R#OVRD
     C                     MOVEL*BLANKS   R#STMT
     C                     MOVELR#RCHK    V#RCHK
     C                     MOVEL*BLANKS   V#RCO1
     C                     MOVEL*BLANKS   V#ACB1
     C                     MOVELBNC1      V#BNC1
     C                     MOVELADDC      V#ADDC
     C                     Z-ADDSLDT      V#SLDT
     C                     Z-ADDPVDT      V#PVDT
     C                     MOVELSWPC      V#SWPC                          CFT009
     C                     MOVEL*BLANKS   V#STMT
     C                     MOVEL*BLANKS   V#CCCY
     C                     MOVEL*BLANKS   V#RCCY
     C                     MOVELACBT      V#ACBT
     C                     MOVELCDRT      V#CDRT
     C                     Z-ADDSMAM      V#SMAM
     C                     Z-ADDPYAM      V#PYAM
     C                     MOVELINB1      V#INB1
     C                     MOVELORC1      V#ORC1
     C                     MOVELORB1      V#ORB1
     C                     MOVELSNC1      V#SNC1
     C                     MOVELTRCT      V#TRCT
     C                     MOVELSNCT      V#SNCT
     C                     MOVELSMCY      V#SMCY
     C                     MOVELPCCY      V#PCCY
     C                     MOVELINMTPY    V#MTPY
     C                     MOVELSND1      V#SND1                          CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     MOVE INTRIT    V#TRIT                          CFT014
     C                     MOVE NDCY      V#NDCY                          CFT014
     C                     Z-ADDNDAM      V#NDAM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CAC001
      **  If margin info parameters passed from FT0050 is blank,          CAC001
      **  retrieve margin info fields from file.                          CAC001
      *                                                                   CAC001
     C           P4PARM    IFNE '*BLANKS'                                 CAC001
     C                     Z-ADDP4FXMP    WOFXMP                          CAC001
     C                     Z-ADDP4FXMD    WOFXMD                          CAC001
     C                     MOVE P4MBSI    WOMBSI                          CAC001
     C                     MOVE P4MSIG    WOMSIG                          CAC001
     C                     Z-ADDP4MAMT    WOMAMT                          CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADDFXMP      WOFXMP                          CAC001
     C                     Z-ADDFXMD      WOFXMD                          CAC001
     C                     MOVE MBSI      WOMBSI                          CAC001
     C                     MOVE MSIG      WOMSIG                          CAC001
     C                     Z-ADDMAMT      WOMAMT                          CAC001
     C                     ENDIF                                          CAC001
      *
      * Format status if action code is Enquiry
      *
     C                     MOVEL*BLANKS   #1STAT
     C           #1ACTC    IFEQ 'E'
      *
     C                     SELEC
     C           RECI      WHEQ 'M'
     C                     MOVEL'FTM2308' #MSGID
     C           RECI      WHEQ 'D'
     C           AUIN      ANDEQ'Y'
     C                     MOVEL'FTM2309' #MSGID
     C           RECI      WHEQ 'D'
     C                     MOVEL'FTM2310' #MSGID
     C           RECI      WHEQ 'C'
     C                     MOVEL'FTM2311' #MSGID
     C                     ENDSL
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM           #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #1STAT
     C                     END
      *
      * Format status if action code is Enquiry
      *
     C           #1ACTC    IFEQ 'E'
     C                     EXSR SRENQ1
     C                     END
      *
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialise key screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MDIZ#K'  @STK,Q
      *
     C                     MOVEL*BLANKS   #1ACTC           Action Code
     C                     MOVEL*BLANKS   #1PREF           Reference
     C                     MOVELP1ACTC    #1ACTC           Action Code
     C                     MOVELP2PREF    #1PREF           Reference
     C                     MOVEL'0'       *IN76            Remove Err
      *
      * USER: Initialise key screen
      * EDTRCD: Init. key screen - R10 Copy source templates  *
      *
      * Action codes
      *
     C                     MOVEL*BLANKS   #KCMD1
     C           P1ACTC    IFEQ *BLANKS
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2009' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #KCMD1
     C                     END
      *
      * Function keys
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2003' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    #KCMD2
      *
     C*EDTRCD: Cpysrc Templates Initialise Key Screen
     C/COPY WNCPYSRC,FT0355DIKS
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRISC3   : Initialise Third details screen                   *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: CCDSPV                                            *   CFT014
      *             CFPRSC                                            *   CFT014
      *                                                               *   CFT014
      *  CALLS    : AOCURRR0                                          *   CFT014
      *             ZEDIT                                             *   CFT014
      *             SRCDFT                                            *   CFT014
      *             SRVATC                                            *   CFT014
      *             SRCURR                                            *   CFT014
      *             SRERR                                             *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     CSR         SRISC3    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRISC3'  @STK,Q                          CFT014
      *                                                                   CFT009
      ** Initialise error indicator fields                                CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   I0DATA                          CFT009
     C                     MOVEA'00000'   *IN,64                          CFT009
     C                     MOVEA'0000'    *IN,69                          CFT009
     C                     MOVEA'00'      *IN,87                          CFT009
     C                     MOVEA'00000'   *IN,92                          CFT009
     C                     MOVE '0'       *IN84                           CFT009
     C                     MOVE '0'       *IN97                           CFT009
     C                     MOVE '0'       *IN43                           CFT009
     C                     MOVEA'000'     *IN,25                          CFT009
      *                                                                   CFT014
      ** Reset warning array.                                             CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   E#WARA                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3CDRO                          CFT014
      *                                                                   CFT014
     C           CDRT      IFNE *BLANKS                                   CFT014
     C           *LIKE     DEFN #3CDRO    A#0012                          CFT014
     C                     MOVELCDRO      A#0012                          CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
     C           CDRT      WHEQ 'N'                                       CFT014
     C           2         SUBSTA#0012:1  #3CDRO    P                     CFT014
     C           CDRT      WHEQ 'R'                                       CFT014
     C           10        SUBSTA#0012:1  #3CDRO    P                     CFT014
     C           CDRT      WHEQ 'P'                                       CFT014
     C                     MOVELCDRO      #3CDRO                          CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   #3CDRO                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Charges to the Debit of Branch                                   CFT014
      *                                                                   CFT014
     C                     MOVELCDBR      #3CDBR                          CFT014
      *                                                                   CFT014
      ** Details of Charges                                               CFT014
      *                                                                   CFT014
     C           DTCH      IFNE *BLANKS                                   CFT014
     C                     MOVELDTCH      #3DTCH                          CFT014
     C                     ELSE                                           CFT014
      *                                                                                       219241
      ** If CFT014 is installed, retrieve the default value from the                          219241
      ** Message Management ICD                                                               219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
     C                     MOVELENDCHG    #3DTCH                                              219241
     C                     ELSE                                                               219241
     C                     MOVEL'BEN'     #3DTCH                          CFT014
     C/COPY WNCPYSRC,FT0355C048
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Charges                                                          CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'B'                                       CFT014
     C           #3CDRO    ORNE *BLANKS                                   CFT014
     C           BTCHCY    ANDEQ'C'                                                           222568
     C                     MOVELV#BCCY    V#CCCY                          CFT014
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'L'                                       CFT014
     C                     MOVELV#LCCY    V#CCCY                          CFT014
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'F'                                       CFT009
     C                     MOVELFCHCCY    V#CCCY                          CFT009
      *                                                                   CFT014
     C           BTCHCY    WHEQ 'C'                                       CFT014
     C           V#ADDC    ANDEQ'A'                                       CFT014
     C                     MOVELSMCY      V#CCCY                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELPCCY      V#CCCY                          CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
     C                     MOVELV#CCCY    #3CCY1                          CFT014
     C                     MOVELV#CCCY    #3CCY2                          CFT014
     C                     MOVELV#CCCY    #3CCY3                          CFT014
     C                     MOVELV#CCCY    #3CCY4                          CFT014
     C                     MOVELV#CCCY    #3CCY5                          CFT014
     C                     MOVELV#CCCY    #3CCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    CCY9                            CFT009
     C                     MOVELV#CCCY    CCY10                           CFT009
     C                     MOVELV#CCCY    CCY11                           CFT009
     C                     MOVELV#CCCY    CCY12                           CFT009
     C                     MOVELV#CCCY    CCY13                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
     C           #3CDRO    WHNE *BLANKS                                   CFT014
     C                     MOVELV#BCCY    V#RCCY                          CFT014
      *                                                                   CFT014
     C           V#ADDC    WHEQ 'A'                                       CFT014
     C                     MOVELSMCY      V#RCCY                          CFT014
      *                                                                   CFT014
     C           SND1      IFEQ 'CASHIER'                                 CFT014
     C           PCCY      ANDEQV#BCCY                                    CFT014
     C                     MOVELPCCY      V#RCCY                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELPCCY      V#RCCY                          CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT009
     C                     MOVE *BLANKS   W0FCUS  6                       187056
     C                     MOVE *BLANKS   W0SCUS  6                       187056
      *                                                                   187056
      ** Perform the following only if core feature S01508 is             187056
      ** installed and core feature S01506 is NOT installed.              187056
      *                                                                   187056
     C           S01508    IFEQ 'Y'                                       187056
     C           S01506    ANDNE'Y'                                       187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (saved field)             187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           WCDRT     IFNE *BLANKS                                   187056
     C                     MOVE WCDRT     I#PT1                           187056
     C           WCDRO     CAT  WCDBR     I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0FCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
      ** Get "Charges to the debit of" customer (screen field)            187056
      ** using FT0035                                                     187056
      *                                                                   187056
     C           CDRT      IFNE *BLANKS                                   187056
     C                     MOVE CDRT      I#PT1                           187056
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     187056
     C                     MOVE V#BCCY    I#CCY                           187056
      *                                                                   187056
     C                     CALL 'FT0035'                                  187056
     C                     PARM *BLANKS   W0RTN                           187056
     C                     PARM           W0DTA                           187056
     C                     PARM           W0MSG                           187056
      *                                                                   187056
     C                     MOVE O#CUST    W0SCUS                          187056
     C                     ENDIF                                          187056
      *                                                                   187056
     C                     ENDIF                                          187056
      *                                                                   CFT009
      ** Only calculate default charges if SAR CFT009 is off              CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *                                                                   CFT014
      ** If Commission type changed or Charges to the Debit of,           CFT014
      ** recalculate charges.                                             CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'                                       CFT014
     C********** #2TRCT    ORNE TRCT                                                   CFT014 202914
     C           TRANSC    OREQ 'Y'                                                           202914
     C           #3CDRO    ORNE WCDRO                                     187056
     C           #3CDBR    ORNE WCDBR                                     187056
     C           W0FCUS    ORNE W0SCUS                                    187056
     C                     EXSR SRCDFT                                    CFT014
     C                     MOVEL#3CDRO    WCDRO                           187056
     C                     MOVEL#3CDBR    WCDBR                           187056
     C                     MOVELCDRT      WCDRT                           187056
     C                     ENDIF                                          CFT014
      *                                                                   187056
     C                     ENDIF                                          187056
      *                                                                   CFT014
     C                     MOVELV#RCCY    #3RCY1                          CFT014
     C                     MOVELV#RCCY    #3RCY2                          CFT014
     C                     MOVELV#RCCY    #3RCY3                          CFT014
     C                     MOVELV#RCCY    #3RCY4                          CFT014
     C                     MOVELV#RCCY    #3RCY5                          CFT014
     C                     MOVELV#RCCY    #3RCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    RCY9                            CFT009
     C                     MOVELV#RCCY    RCY10                           CFT009
     C                     MOVELV#RCCY    RCY11                           CFT009
     C                     MOVELV#RCCY    RCY12                           CFT009
     C                     MOVELV#RCCY    RCY13                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Look field up on database.                                       CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD    7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM V#CCCY    @K101   3                       CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      ** Error on call.                                                   CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     Z-ADD004       W0ERNB                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     MOVEL'AOCURRR0'W0FILE                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Save number of decimal places (input currency).                  CFT014
      *                                                                   CFT014
     C                     Z-ADDA6NBDP    V#CDCP  10                      CFT014
      *                                                                   CFT014
      ** Format Transfer Commission amount for screen.                    CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3TRCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA1     IFNE 0                                         CFT014
     C                     MOVE DUMA1     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TRCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Telex Charge amount for screen.                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3TXCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA2     IFNE 0                                         CFT014
     C                     MOVE DUMA2     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TXCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Cheque Charge amount for screen.                          CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3CQCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA3     IFNE 0                                         CFT014
     C                     MOVE DUMA3     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3CQCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Advice Charge amount for screen.                          CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3ADCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA4     IFNE 0                                         CFT014
     C                     MOVE DUMA4     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3ADCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Telephone Charge amount for screen.                       CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3TLCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA5     IFNE 0                                         CFT014
     C                     MOVE DUMA5     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TLCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Miscellaneous Charge amount for screen.                   CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C********** FLAG12    IFNE 'Y'                                                    CFT009 202914
     C                     MOVEL*BLANKS   #3MSCD                          CFT014
     C**********           ENDIF                                                       CFT009 202914
     C           DUMA6     IFNE 0                                         CFT014
     C                     MOVE DUMA6     ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3MSCD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format FX/Change Commission amount for screen.                   CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C           FLAG12    IFNE 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3CHCD                          CFT014
     C                     ENDIF                                          CFT009
     C           INDUM7    IFNE 0                                         CFT014
     C                     MOVE INDUM7    ZFIELD                          CFT014
     C*                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
     C*                                                                   CFT014
     C                     MOVE ZFIELD    #3CHCD                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CD                            CFT009
      *                                                                   CFT009
     C           CMSC01    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC01    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M1CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CD                            CFT009
      *                                                                   CFT009
     C           CMSC02    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC02    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M2CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CD                            CFT009
      *                                                                   CFT009
     C           CMSC03    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC03    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M3CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CD                            CFT009
      *                                                                   CFT009
     C           CMSC04    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC04    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M4CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CD                            CFT009
      *                                                                   CFT009
     C           CMSC05    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC05    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Calculate levied charge currency equivalent                      CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   RTCD                            CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM V#CCCY    @K101                           CFT009
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6MDIN    FRMMD                           CFT009
     C           *LIKE     DEFN A6SPRT    CVTRAT                          CFT009
     C           *LIKE     DEFN A6NBDP    WKDP2                           CFT009
     C           *LIKE     DEFN A6NBDP    FRMDEC                          CFT009
     C                     MOVELA6NBDP    WKDP2                           CFT009
     C                     MOVELWKDP2     FRMDEC                          CFT009
     C                     MOVELV#CCCY    FRMCCY  3                       CFT009
     C                     Z-ADDINCHRT    CVTRAT                          CFT009
     C                     MOVELA6MDIN    FRMMD                           CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   RTCD                            CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM V#RCCY    @K101                           CFT009
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6NBDP    WKDP1                           CFT009
     C           *LIKE     DEFN A6NBDP    TODEC                           CFT009
     C                     MOVELA6NBDP    WKDP1                           CFT009
     C                     MOVELWKDP1     TODEC                           CFT009
     C                     MOVELV#RCCY    TOCCY   3                       CFT009
     C                     MOVELA6MDIN    TOMD    1                       CFT009
      *                                                                   CFT009
      ** Find multiply/divide indicator between ccys                      CFT009
      *                                                                   CFT009
     C           FRMCCY    IFEQ BJCYCD                                    CFT009
     C                     MOVE TOMD      FRMMD                           CFT009
     C                     ELSE                                           CFT009
     C           FRMMD     IFEQ TOMD                                      CFT009
     C                     MOVE 'M'       FRMMD                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'D'       FRMMD                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format amount for screen                                         CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CH                            CFT009
      *                                                                   CFT009
     C           MSC01     IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC01     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M1CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CH                            CFT009
      *                                                                   CFT009
     C           MSC02     IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC02     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M2CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CH                            CFT009
      *                                                                   CFT009
     C           MSC03     IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC03     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M3CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CH                            CFT009
      *                                                                   CFT009
     C           MSC04     IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC04     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M4CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CH                            CFT009
      *                                                                   CFT009
     C           MSC05     IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC05     ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M5CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** CODES FOR  ALL FIELDS                                            CFT009
      *                                                                   CFT009
     C                     MOVELTFCCCO    TRCDE                           CFT009
     C                     MOVELFXCHEC    FXCDE                           CFT009
     C                     MOVELTLCODE    TXCDE                           CFT009
     C                     MOVELCHCHCD    CQCDE                           CFT009
     C                     MOVELADCHCD    ADCDE                           CFT009
     C                     MOVELTLCHCD    TPCDE                           CFT009
     C                     MOVELMISCH     MSCDE                           CFT009
     C                     MOVELMSCH1     M1CDE                           CFT009
     C                     MOVELMSCH2     M2CDE                           CFT009
     C                     MOVELMSCH3     M3CDE                           CFT009
     C                     MOVELMSCH4     M4CDE                           CFT009
     C                     MOVELMSCH5     M5CDE                           CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** Look field up on database.                                       CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'             9090               CFT014
     C                     PARM *BLANKS   RTCD                            CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM V#RCCY    @K101                           CFT014
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT014
      *                                                                   CFT014
      ** Error on call.                                                   CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     Z-ADD005       W0ERNB                          CFT014
     C                     MOVEL'*CALL'   W0KEY                           CFT014
     C                     MOVEL'AOCURRR0'W0FILE                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Save number of decimal places (charge currency).                 CFT014
      *                                                                   CFT014
     C                     Z-ADDA6NBDP    V#RDCP  10                      CFT014
      *                                                                   CFT014
      ** Format Transfer Commission amount for screen.                    CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TRCM                          CFT014
     C           TRCM      IFNE 0                                         CFT014
     C                     MOVE TRCM      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TRCM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Telex Charge amount for screen.                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TXCH                          CFT014
     C           TXCH      IFNE 0                                         CFT014
     C                     MOVE TXCH      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TXCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Cheque Charge amount for screen.                          CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3CQCH                          CFT014
     C           CQCH      IFNE 0                                         CFT014
     C                     MOVE CQCH      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3CQCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Advice Charge amount for screen.                          CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3ADCH                          CFT014
     C           ADCH      IFNE 0                                         CFT014
     C                     MOVE ADCH      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3ADCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Telephone Charge amount for screen.                       CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TLCH                          CFT014
     C           TLCH      IFNE 0                                         CFT014
     C                     MOVE TLCH      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3TLCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Miscellaneous Charge amount for screen.                   CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3MSCH                          CFT014
     C           MSCH      IFNE 0                                         CFT014
     C                     MOVE MSCH      ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3MSCH                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format FX/Change Commission amount for screen.                   CFT014
      *                                                                   CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3CHCM                          CFT014
     C           INCHCM    IFNE 0                                         CFT014
     C                     MOVE INCHCM    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM A6NBDP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3CHCM                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      *                                                                   CFT014
      ** If switchable feature S01499 is switched ON, initialise          CFT014
      ** V.A.T. flags and total V.A.T. amount.                            CFT014
      *                                                                   CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C           CFT010    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Transfer Commission V.A.T. flag.                                 CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT1                          CFT014
     C           INVAT1    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT1    #3VAT1                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT1                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telex V.A.T. flag.                                               CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT2                          CFT014
     C           INVAT2    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT2    #3VAT2                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT2                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Cheque V.A.T. flag.                                              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT3                          CFT014
     C           INVAT3    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT3    #3VAT3                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT3                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Advice V.A.T. flag.                                              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT4                          CFT014
     C           INVAT4    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT4    #3VAT4                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT4                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Telephone V.A.T. flag.                                           CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT5                          CFT014
     C           INVAT5    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT5    #3VAT5                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT5                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Miscellaneous V.A.T. flag.                                       CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT6                          CFT014
     C           INVAT6    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT6    #3VAT6                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT6                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** FX/Change Commission V.A.T. flag.                                CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3VAT7                          CFT014
     C           INVAT7    IFNE *BLANK                                    CFT014
     C                     MOVELINVAT7    #3VAT7                          CFT014
     C                     ELSE                                           CFT014
     C           #1ACTC    IFNE 'E'                                       CFT014
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    #3VAT7                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 1 V.A.T. flag                               CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   VAT9                            CFT009
     C           VTMIC1    IFNE *BLANK                                    CFT009
     C                     MOVELVTMIC1    VAT9                            CFT009
     C                     ELSE                                           CFT009
     C           #1ACTC    IFNE 'E'                                       CFT009
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    VAT9                            CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 2 V.A.T. flag                               CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   VAT10                           CFT009
     C           VTMIC2    IFNE *BLANK                                    CFT009
     C                     MOVELVTMIC2    VAT10                           CFT009
     C                     ELSE                                           CFT009
     C           #1ACTC    IFNE 'E'                                       CFT009
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    VAT10                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 3 V.A.T. flag                               CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   VAT11                           CFT009
     C           VTMIC3    IFNE *BLANK                                    CFT009
     C                     MOVELVTMIC3    VAT11                           CFT009
     C                     ELSE                                           CFT009
     C           #1ACTC    IFNE 'E'                                       CFT009
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    VAT11                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 4 V.A.T. flag                               CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   VAT12                           CFT009
     C           VTMIC4    IFNE *BLANK                                    CFT009
     C                     MOVELVTMIC4    VAT12                           CFT009
     C                     ELSE                                           CFT009
     C           #1ACTC    IFNE 'E'                                       CFT009
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    VAT12                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge 5 V.A.T. flag                               CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   VAT13                           CFT009
     C           VTMIC5    IFNE *BLANK                                    CFT009
     C                     MOVELVTMIC5    VAT13                           CFT009
     C                     ELSE                                           CFT009
     C           #1ACTC    IFNE 'E'                                       CFT009
     C           CFT010    ANDEQ'N'                                       CFT009
     C                     MOVELT#VATT    VAT13                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** If charges are recalculated, then recalculate total V.A.T. amt.  CFT014
      *                                                                   CFT014
     C           W0RCAL    IFEQ 'Y'                                       CFT014
     C                     EXSR SRVATC                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format total V.A.T. amount for screen.                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3VATD                          CFT014
     C           INDUM8    IFNE 0                                         CFT014
     C                     MOVE INDUM8    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM V#CDCP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3VATD                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format total V.A.T. amount for screen.                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3VATT                          CFT014
     C           INVATT    IFNE 0                                         CFT014
     C                     MOVE INVATT    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16        B:Function Fld CFT014
     C                     PARM V#RDCP    ZADEC   10       I:No. of Dec.  CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3VATT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      **  Reset recalculation flag.                                       CFT014
      *                                                                   CFT014
     C                     MOVE 'N'       W0RCAL                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** CFT014 is on.                                                    CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Format Receiver's Charges Remitted amount for screen.            CFT014
      *                                                                   CFT014
     C           V#ADDC    IFEQ 'A'                                       CFT014
     C           INRCUS    IFEQ 'N'                                       CFT014
     C           INRCNW    ANDNE0                                         CFT014
      ** Fill receiver's charges with the one of Network.                 CFT014
     C                     EXSR FIRCCG                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVELSMCY      #3RCCY                          CFT014
     C                     MOVEL*BLANKS   #3RCRM                          CFT014
     C           INRCRM    IFNE 0                                         CFT014
     C                     MOVELSMCY      P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INRCRM    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM           ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3RCRM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Sender's Charges Deducted amount for screen.              CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SCH1                          CFT014
     C                     MOVELINSCY1    #3SCC1                          CFT014
     C           INSCY1    IFNE *BLANK                                    CFT014
     C                     MOVELINSCY1    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INSCH1    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD 16                       CFT014
     C                     PARM           ZADEC   10                      CFT014
     C                     MOVE ZFIELD    #3SCH1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SCH2                          CFT014
     C                     MOVELINSCY2    #3SCC2                          CFT014
     C           INSCY2    IFNE *BLANK                                    CFT014
     C                     MOVELINSCY2    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INSCH2    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SCH3                          CFT014
     C                     MOVELINSCY3    #3SCC3                          CFT014
     C           INSCY3    IFNE *BLANK                                    CFT014
     C                     MOVELINSCY3    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INSCH3    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SCH4                          CFT014
     C                     MOVELINSCY4    #3SCC4                          CFT014
     C           INSCY4    IFNE *BLANK                                    CFT014
     C                     MOVELINSCY4    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INSCH4    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH4                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVEL*BLANKS   #3SCH5                          CFT014
     C                     MOVELINSCY5    #3SCC5                          CFT014
     C           INSCY5    IFNE *BLANK                                    CFT014
     C                     MOVELINSCY5    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE INSCH5    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C           EXISC3    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     CSR                   ENDSR                                          CFT014
      *****************************************************************   CFT009
     C/EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/CONVRT                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  CONVRT - Convert file field to screen currency               *   CFT009
      *                                                               *   CFT009
      *  Called By: SRISC3 subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  ZCONVZ1                                                      *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           CONVRT    BEGSR                           *** CONVRT *** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'CONVRT'  @STK,Q                          CFT009
      *                                                                   CFT009
     C           FRMCCY    IFNE TOCCY                                     CFT009
     C                     CALL 'ZCONVZ1'                                 CFT009
     C                     PARM           INPAMT 150                      CFT009
     C                     PARM           CVTRAT                          CFT009
     C                     PARM           FRMMD                           CFT009
     C                     PARM           FRMCCY  3                       CFT009
     C                     PARM           TOCCY   3                       CFT009
     C                     PARM           FRMDEC                          CFT009
     C                     PARM           TODEC                           CFT009
     C                     PARM *ZEROS    OUTAMT 150                      CFT009
     C                     ELSE                                           CFT009
     C                     Z-ADDINPAMT    OUTAMT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVE OUTAMT    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM TODEC     ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      /EJECT                                                              CFT009
     CSR         MEIZ#D    BEGSR
      *================================================================
      * Initialise Second detail screen
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MEIZ#D'  @STK,Q
      *
      * Recheck record Payment reference must exist
      *
     C                     EXSR VBCKRL
      *
      * Reset warning array
      *
     C                     MOVEL*BLANKS   E#WARA
      *
     C                     MOVELINB1      #2INB1
     C                     MOVELINB2      #2INB2
     C                     MOVELINB3      #2INB3
     C                     MOVELINB4      #2INB4
     C                     MOVELINB5      #2INB5
     C                     MOVELDTP1      #2DTP1
     C                     MOVELDTP2      #2DTP2
     C                     MOVELDTP3      #2DTP3
     C                     MOVELDTP4      #2DTP4
     C/COPY WNCPYSRC,FT0355C023
     C           DNBC      IFNE 0
     C/COPY WNCPYSRC,FT0355C024
     C                     MOVELDNBC      #2DNBC
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0355CCP2                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C                     MOVEL*BLANKS   #2DNBC
     C                     END
     C                     MOVELRLPR      #2RLPR
      *
      ***Default*to*BEN*if*blank***************************************   CFT014
      ***********                                                         CFT014
     C***********DTCH      IFNE *BLANKS                                   CFT014
     C***********          MOVELDTCH      #2DTCH                          CFT014
     C***********          ELSE                                           CFT014
     C***********          MOVEL'BEN'     #2DTCH                          CFT014
     C***********          END                                            CFT014
      *                                                                   CFT014
      ** Transfer Comission Tariff                                        CFT014
      *                                                                   CFT014
     C                     MOVELTRCT      #2TRCT                          CFT014
      *                                                                   CFT014
      ** Determine branch for charge defaults.                            CFT014
      *                                                                   CFT014
     C                     SELEC                                          CFT014
      *                                                                   CFT014
      ** If single branch mode, use single branch code from SDBANKPD.     CFT014
      *                                                                   CFT014
     C           WUMBIN    WHNE 'Y'                                       CFT014
     C                     MOVELV#SBRC    PYBR                            CFT014
      *                                                                   CFT014
      ** Multibranched and originating branches used.                     CFT014
      *                                                                   CFT014
     C           V#OBUV    WHEQ 'Y'                                       CFT014
     C                     MOVELORBR      PYBR                            CFT014
      *                                                                   CFT014
      ** Multibranched and originating branches not used.                 CFT014
      *                                                                   CFT014
     C                     OTHER                                          CFT014
     C                     MOVELBRCA      PYBR                            CFT014
      *                                                                   CFT014
     C                     ENDSL                                          CFT014
      *                                                                   CFT014
      ** If Transfer Commission blank and action insert, default.         CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'                                       CFT014
     C           #2TRCT    ANDEQ*BLANKS                                   CFT014
     C           CFT009    ANDEQ'N'                                       CFT009
      *                                                                   CFT014
     C           PYBR      CHAINPYCHGDB              90    Get defaults.  CFT014
      *                                                                   CFT014
      ** No record found - DB error only if not multibranched.            CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C           WUMBIN    ANDNE'Y'                                       CFT014
     C                     Z-ADD003       W0ERNB                          CFT014
     C                     MOVELPYBR      W0KEY                           CFT014
     C                     MOVEL'PYCHGDB 'W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** No payment charges information.                                  CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'1'       *IN42                           CFT014
     C                     MOVELPYBR      ZAMSDA                          CFT014
     C                     MOVEL'FTM2001' ZAMSID                          CFT014
     C                     EXSR ZASNMS                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Payment charges information                                      CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '0'                                       CFT014
     C                     MOVELDFTRCT    #2TRCT                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'
     C                     MOVEL'N'       #2OPIN
     C                     ELSE
     C                     MOVELOPIN      #2OPIN
     C                     END
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C                     MOVELINBOCD    #2BOCD                          CFT014
     C                     MOVELINTTCD    #2TTCD                          CFT014
     C                     MOVELINICD1    #2ICD1                          CFT014
     C                     MOVELINICD2    #2ICD2                          CFT014
     C                     MOVELINICD3    #2ICD3                          CFT014
     C                     MOVELINICD4    #2ICD4                          CFT014
     C                     MOVELINICD5    #2ICD5                          CFT014
     C                     MOVELINRRP1    #2RRP1                          CFT014
     C                     MOVELINRRP2    #2RRP2                          CFT014
     C                     MOVELINRRP3    #2RRP3                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
     C***********          SELEC                                          CFT014
     C/COPY WNCPYSRC,FT0355C004
      ***********                                                         CFT014
     C***********BTCHCY    WHEQ 'B'                                       CFT014
     C***********#1CDRO    ORNE *BLANKS                                   CFT014
     C***********          MOVELV#BCCY    V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********BTCHCY    WHEQ 'L'                                       CFT014
     C***********          MOVELV#LCCY    V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********BTCHCY    WHEQ 'C'                                       CFT014
     C***********V#ADDC    ANDEQ'A'                                       CFT014
     C***********          MOVELSMCY      V#CCCY                          CFT014
      ***********                                                         CFT014
     C***********          OTHER                                          CFT014
     C***********          MOVELPCCY      V#CCCY                          CFT014
     C***********          ENDSL                                          CFT014
     C***********          MOVELV#CCCY    #2CCY1                          CFT014
     C***********          MOVELV#CCCY    #2CCY2                          CFT014
     C***********          MOVELV#CCCY    #2CCY3                          CFT014
     C***********          MOVELV#CCCY    #2CCY4                          CFT014
     C***********          MOVELV#CCCY    #2CCY5                          CFT014
     C***********          MOVELV#CCCY    #2CCY6                          CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELV#CCCY    #2CCY7                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELV#CCCY    #2CCY8                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      ***********                                                         CFT014
     C***********          SELEC                                          CFT014
      ***********                                                         CFT014
     C***********#1CDRO    WHNE *BLANKS                                   CFT014
     C***********          MOVELV#BCCY    V#RCCY                          CFT014
      ***********                                                         CFT014
     C***********V#ADDC    WHEQ 'A'                                       CFT014
     C***********          MOVELSMCY      V#RCCY                          CFT014
      ***********                                                  122060 CFT014
     C***********SND1      IFEQ 'CASHIER'                          122060 CFT014
     C***********PCCY      ANDEQV#BCCY                             122060 CFT014
     C***********          MOVELPCCY      V#RCCY                   122060 CFT014
     C***********          ENDIF                                   122060 CFT014
      ***********                                                         CFT014
     C***********          OTHER                                          CFT014
     C***********          MOVELPCCY      V#RCCY                          CFT014
     C***********          ENDSL                                          CFT014
     C***********                                                  S01508 CFT014
     C***********          MOVE *BLANKS   W0FCUS                   S01506 CFT014
     C***********          MOVE *BLANKS   W0SCUS                   S01506 CFT014
     C***********                                                  S01508 CFT014
     C****Perform*the*following*only*if*core*feature*S01508*is**** S01508 CFT014
     C****installed*and*core*feature*S01506*is*NOT*installed****** S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********S01508    IFEQ 'Y'                                S01508 CFT014
     C***********S01506    ANDNE'Y'                                S01506 CFT014
     C***********                                                  S01506 CFT014
     C****Get*"Charges*to*the*debit*of"*customer*(database*field)* S01506 CFT014
     C****using*FT0035******************************************** S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********CDRT      IFNE *BLANKS                            S01506 CFT014
     C***********          MOVE CDRT      I#PT1                    S01506 CFT014
     C***********          MOVELCDRO      W0FLD  12                S01506 CFT014
     C***********W0FLD     CAT  CDBR      I#PTY1    P              S01506 CFT014
     C***********          MOVE V#BCCY    I#CCY                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          CALL 'FT0035'                           S01506 CFT014
     C***********          PARM *BLANKS   W0RTN                    S01506 CFT014
     C***********          PARM           W0DTA                    S01506 CFT014
     C***********          PARM           W0MSG                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          MOVE O#CUST    W0FCUS  6                S01506 CFT014
     C***********          END                                     S01506 CFT014
     C***********                                                  S01506 CFT014
     C****Get*"Charges*to*the*debit*of"*customer*(screen*field)*** S01506 CFT014
     C****using*FT0035******************************************** S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********F2CDRT    IFNE *BLANKS                            S01506 CFT014
     C***********          MOVE F2CDRT    I#PT1                    S01506 CFT014
     C***********#1CDRO    CAT  #1CDBR    I#PTY1    P              S01506 CFT014
     C***********          MOVE V#BCCY    I#CCY                    S01506 CFT014
     C/COPY WNCPYSRC,FT0355C005
     C***********                                                  S01506 CFT014
     C***********          CALL 'FT0035'                           S01506 CFT014
     C***********          PARM *BLANKS   W0RTN                    S01506 CFT014
     C***********          PARM           W0DTA                    S01506 CFT014
     C***********          PARM           W0MSG                    S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          MOVE O#CUST    W0SCUS  6                S01506 CFT014
     C***********          END                                     S01506 CFT014
     C***********                                                  S01506 CFT014
     C***********          END                                     S01506 CFT014
      ***********                                                         CFT014
      ***If*Commission*type*changed*or*charges*to*the*debit*of*********   CFT014
      ***recalculate*charges*******************************************   CFT014
      ***********                                                         CFT014
     C***********#1ACTC    IFEQ 'I'                                       CFT014
     C***********#1ACTC    OREQ 'A'                                 100660133860
     C***********#1TRCT    ORNE TRCT                                      CFT014
     C***********#1CDRO    ORNE *BLANKS                                   CFT014
     C***********CDRO      ANDEQ0                                         CFT014
     C***********#1CDRO    OREQ *BLANKS                                   CFT014
     C***********CDRO      ANDNE0                                         CFT014
     C***********#1ACTC    OREQ 'A'                                S01506 CFT014
     C***********W0FCUS    ANDNEW0SCUS                             S01506 CFT014
     C***********          EXSR SRCDFT                                    CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
     C***********          MOVELV#RCCY    #2RCY1                          CFT014
     C***********          MOVELV#RCCY    #2RCY2                          CFT014
     C***********          MOVELV#RCCY    #2RCY3                          CFT014
     C***********          MOVELV#RCCY    #2RCY4                          CFT014
     C***********          MOVELV#RCCY    #2RCY5                          CFT014
     C***********          MOVELV#RCCY    #2RCY6                          CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVELV#RCCY    #2RCY7                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********          MOVELV#RCCY    #2RCY8                   S01499 CFT014
     C***********          END                                     S01499 CFT014
      ***********                                                         CFT014
      ***Look*field*up*on*database*************************************   CFT014
      ***********                                                         CFT014
     C***********          CALL 'AOCURRR0'             9090               CFT014
     C***********          PARM *BLANKS   RTCD    7                       CFT014
     C***********          PARM '*KEY   ' @OPTN   7                       CFT014
     C***********          PARM V#CCCY    @K101   3                       CFT014
     C***********SDCURR    PARM *BLANKS   DSSDY                           CFT014
      ***********                                                         CFT014
      ***If*error*on*call**********************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'AOCURRR0'W0FILE          *************** CFT014
     C***********          MOVEL'*CALL'   W0KEY           * DB ERROR 04 * CFT014
     C***********          Z-ADD4         W0ERNB          *************** CFT014
     C***********          MOVEL'MEM5003' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
     C***********                                                  S01499 CFT014
     C****Save*number*of*decimal*places*(input*currency)********** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          Z-ADDA6NBDP    V#CDCP  10               S01499 CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C/COPY WNCPYSRC,FT0355C027
     C***********          MOVEL*BLANKS   #2TRCD                          CFT014
     C***********DUMA1     IFNE 0                                         CFT014
     C***********          MOVE DUMA1     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TRCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TXCD                          CFT014
     C***********DUMA2     IFNE 0                                         CFT014
     C***********          MOVE DUMA2     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TXCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CQCD                          CFT014
     C***********DUMA3     IFNE 0                                         CFT014
     C***********          MOVE DUMA3     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CQCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2ADCD                          CFT014
     C***********DUMA4     IFNE 0                                         CFT014
     C***********          MOVE DUMA4     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2ADCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TLCD                          CFT014
     C***********DUMA5     IFNE 0                                         CFT014
     C***********          MOVE DUMA5     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TLCD                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2MSCD                          CFT014
     C***********DUMA6     IFNE 0                                         CFT014
     C***********          MOVE DUMA6     ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2MSCD                          CFT014
     C***********          END                                            CFT014
     C***********                                                  S01494 CFT014
     C***Format*amount*for*screen********************************* S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL*BLANKS   #2CHCD                   S01494 CFT014
     C***********INDUM7    IFNE 0                                  S01494 CFT014
     C***********          MOVE INDUM7    ZFIELD                   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          CALL 'ZEDIT'                9090        S01494 CFT014
     C***********          PARM           ZFIELD 16 B:FUNCTION FLD S01494 CFT014
     C***********          PARM A6NBDP    ZADEC   10 I:NO OF DEC   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          MOVE ZFIELD    #2CHCD                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
      ***********                                                         CFT014
      ***Look*field*up*on*database*************************************   CFT014
      ***********                                                         CFT014
     C***********          CALL 'AOCURRR0'             9090               CFT014
     C***********          PARM *BLANKS   RTCD                            CFT014
     C***********          PARM '*KEY   ' @OPTN                           CFT014
     C***********          PARM V#RCCY    @K101                           CFT014
     C***********SDCURR    PARM *BLANKS   DSSDY                           CFT014
      ***********                                                         CFT014
      ***If*error*on*call**********************************************   CFT014
      ***********                                                         CFT014
     C************IN90     IFEQ '1'                                       CFT014
     C***********          MOVEL'AOCURRR0'W0FILE          *************** CFT014
     C***********          MOVEL'*CALL'   W0KEY           * DB ERROR 05 * CFT014
     C***********          Z-ADD5         W0ERNB          *************** CFT014
     C***********          MOVEL'MEM5003' W0MSGD                          CFT014
     C***********          MOVEL'MIDAS  ' W0MSGF                          CFT014
     C***********          EXSR SRERR                                     CFT014
     C***********          END                                            CFT014
     C***********                                                  S01499 CFT014
     C****Save*number*of*decimal*places*(charge*currency)********* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          Z-ADDA6NBDP    V#RDCP  10               S01499 CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TRCM                          CFT014
     C***********TRCM      IFNE 0                                         CFT014
     C***********          MOVE TRCM      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TRCM                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TXCH                          CFT014
     C***********TXCH      IFNE 0                                         CFT014
     C***********          MOVE TXCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TXCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2CQCH                          CFT014
     C***********CQCH      IFNE 0                                         CFT014
     C***********          MOVE CQCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2CQCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2ADCH                          CFT014
     C***********ADCH      IFNE 0                                         CFT014
     C***********          MOVE ADCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2ADCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2TLCH                          CFT014
     C***********TLCH      IFNE 0                                         CFT014
     C***********          MOVE TLCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2TLCH                          CFT014
     C***********          END                                            CFT014
      ***********                                                         CFT014
      **Format*amount*for*screen***************************************   CFT014
      ***********                                                         CFT014
     C***********          MOVEL*BLANKS   #2MSCH                          CFT014
     C***********MSCH      IFNE 0                                         CFT014
     C***********          MOVE MSCH      ZFIELD                          CFT014
      ***********                                                         CFT014
     C***********          CALL 'ZEDIT'                9090               CFT014
     C***********          PARM           ZFIELD 16      B:FUNCTION FIELD CFT014
     C***********          PARM A6NBDP    ZADEC   10     I:NO OF DECIMALS CFT014
      ***********                                                         CFT014
     C***********          MOVE ZFIELD    #2MSCH                          CFT014
     C***********          END                                            CFT014
     C***********                                                  S01494 CFT014
     C***Format*amount*for*screen********************************* S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********S01494    IFEQ 'Y'                                S01494 CFT014
     C***********          MOVEL*BLANKS   #2CHCM                   S01494 CFT014
     C***********INCHCM    IFNE 0                                  S01494 CFT014
     C***********          MOVE INCHCM    ZFIELD                   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          CALL 'ZEDIT'                9090        S01494 CFT014
     C***********          PARM           ZFIELD 16 B:FUNCTION FLD S01494 CFT014
     C***********          PARM A6NBDP    ZADEC   10 I:NO OF DEC   S01494 CFT014
     C***********                                                  S01494 CFT014
     C***********          MOVE ZFIELD    #2CHCM                   S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********          END                                     S01494 CFT014
     C***********                                                  S01499 CFT014
     C***If*switchable*feature*S01499*is*switched*ON,*initialise** S01499 CFT014
     C***V.A.T.*flags*and*total*V.A.T.*amount.******************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********S01499    IFEQ 'Y'                                S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Transfer*commission*V.A.T.*flag************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT1                   S01499 CFT014
     C***********INVAT1    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT1    #2VAT1                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT1                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telex*V.A.T.*flag**************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT2                   S01499 CFT014
     C***********INVAT2    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT2    #2VAT2                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT2                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Cheque*V.A.T.*flag*************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT3                   S01499 CFT014
     C***********INVAT3    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT3    #2VAT3                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT3                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Advice*V.A.T.*flag*************************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT4                   S01499 CFT014
     C***********INVAT4    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT4    #2VAT4                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT4                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Telephone*V.A.T.*flag************************************ S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT5                   S01499 CFT014
     C***********INVAT5    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT5    #2VAT5                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT5                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Miscellaneous*V.A.T.*flag******************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT6                   S01499 CFT014
     C***********INVAT6    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT6    #2VAT6                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT6                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***FX/Change*commission*V.A.T.*flag************************* S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VAT7                   S01499 CFT014
     C***********INVAT7    IFNE *BLANK                             S01499 CFT014
     C***********          MOVELINVAT7    #2VAT7                   S01499 CFT014
     C***********          ELSE                                    S01499 CFT014
     C***********#1ACTC    IFNE 'E'                                S01499 CFT014
     C***********          MOVELT#VATT    #2VAT7                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***If*charges*are*recalculated,thenrecalculatetotalV.A.T.amt S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********W0RCAL    IFEQ 'Y'                                S01499 CFT014
     C***********          EXSR SRVATC                             S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Format*total*V.A.T.*amount*for*screen******************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VATD                   S01499 CFT014
     C***********INDUM8    IFNE 0                                  S01499 CFT014
     C***********          MOVE INDUM8    ZFIELD                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          CALL 'ZEDIT'                9090        S01499 CFT014
     C***********          PARM           ZFIELD 16 B:FUNCTION FLD S01499 CFT014
     C***********          PARM V#CDCP    ZADEC   10 I:NO OF DEC   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE ZFIELD    #2VATD                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***Format*total*V.A.T.*amount*for*screen******************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVEL*BLANKS   #2VATT                   S01499 CFT014
     C***********INVATT    IFNE 0                                  S01499 CFT014
     C***********          MOVE INVATT    ZFIELD                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          CALL 'ZEDIT'                9090        S01499 CFT014
     C***********          PARM           ZFIELD 16 B:FUNCTION FLD S01499 CFT014
     C***********          PARM V#RDCP    ZADEC   10 I:NO OF DEC   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE ZFIELD    #2VATT                   S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C****Reset*recalculation*flag******************************** S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          MOVE 'N'       W0RCAL                   S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********          END                                     S01499 CFT014
     C***********                                                  S01499 CFT014
     C***********                                                  S01494 CFT014
      *
      * Format status if action code is Enquiry
      *
     C           #1ACTC    IFEQ 'E'
     C                     EXSR SRENQ2
     C                     END
     C/COPY WNCPYSRC,FT0355C018
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MEEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         MFIZ#D    BEGSR
      *================================================================
      * Reset fields on screen                   *
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MFIZ#D'  @STK,Q
      *                                                                   CFT014
     C                     MOVELV#CCCY    #3CCY1                          CFT014
     C                     MOVELV#CCCY    #3CCY2                          CFT014
     C                     MOVELV#CCCY    #3CCY3                          CFT014
     C                     MOVELV#CCCY    #3CCY4                          CFT014
     C                     MOVELV#CCCY    #3CCY5                          CFT014
     C                     MOVELV#CCCY    #3CCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#CCCY    #3CCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#CCCY    CCY9                            CFT009
     C                     MOVELV#CCCY    CCY10                           CFT009
     C                     MOVELV#CCCY    CCY11                           CFT009
     C                     MOVELV#CCCY    CCY12                           CFT009
     C                     MOVELV#CCCY    CCY13                           CFT009
     C                     ENDIF                                          CFT009
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD    7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM V#CCCY    @K101   3
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 06 *
     C                     Z-ADD6         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                                       CFT009
      ** Save the number of decimal places, for later use with the                            CFT009
      ** VAT amounts.                                                                         CFT009
      *                                                                                       CFT009
     C                     Z-ADDA6NBDP    SAVEDP  10                                          CFT009
      *
      * Format amount for screen
      *
     C***********F3TRCD    IFNE 0                                         CFT014
     C***********I3TRCM    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F3TRCD    ZFIELD                          CFT014
      *
     C           F0TRCD    IFNE 0                                         CFT014
     C           I0TRCM    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0TRCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TRCD                          CFT014
     C                     MOVE ZFIELD    #3TRCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F3TXCD    IFNE 0                                         CFT014
     C***********I3TXCH    ANDEQ*BLANKS                                   CFT014
     C***********F3TXCD    MOVE F3TXCD    ZFIELD                          CFT014
      *
     C           F0TXCD    IFNE 0                                         CFT014
     C           I0TXCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0TXCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TXCD                          CFT014
     C                     MOVE ZFIELD    #3TXCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F3CQCD    IFNE 0                                         CFT014
     C***********I3CQCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F3CQCD    ZFIELD                          CFT014
      *
     C           F0CQCH    IFNE 0                                         CFT014
     C           I0CQCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0CQCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CQCD                          CFT014
     C                     MOVE ZFIELD    #3CQCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F3ADCD    IFNE 0                                         CFT014
     C***********I3ADCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F3ADCD    ZFIELD                          CFT014
      *
     C           F0ADCD    IFNE 0                                         CFT014
     C           I0ADCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0ADCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2ADCD                          CFT014
     C                     MOVE ZFIELD    #3ADCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F3TLCD    IFNE 0                                         CFT014
     C***********I3TLCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F3TLCD    ZFIELD                          CFT014
      *
     C           F0TLCD    IFNE 0                                         CFT014
     C           I0TLCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0TLCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TLCD                          CFT014
     C                     MOVE ZFIELD    #3TLCD                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********F3MSCD    IFNE 0                                         CFT014
     C***********I3MSCH    ANDEQ*BLANKS                                   CFT014
     C***********          MOVE F3MSCD    ZFIELD                          CFT014
      *
     C           F0MSCD    IFNE 0                                         CFT014
     C           I0MSCH    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0MSCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2MSCD                          CFT014
     C                     MOVE ZFIELD    #3MSCD                          CFT014
     C                     END
     C*                                                                   S01494
     C** Format amount for screen                                         S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C***********F3CHCD    IFNE 0                                  S01494 CFT014
     C***********I3CHCM    ANDEQ*BLANKS                            S01494 CFT014
     C***********          MOVE F3CHCD    ZFIELD                   S01494 CFT014
     C*                                                                   S01494
     C           F0CHCD    IFNE 0                                         CFT014
     C           I0CHCM    ANDEQ*BLANKS                                   CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0CHCD    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               S01494
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01494
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01494
     C*                                                                   S01494
     C***********          MOVE ZFIELD    #2CHCD                   S01494 CFT014
     C                     MOVE ZFIELD    #3CHCD                          CFT014
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   CFT009
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      * Format amount for screen                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C           F0M1CD    IFNE 0                                         CFT009
     C           I0M1CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M1CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M1CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M2CD    IFNE 0                                         CFT009
     C           I0M2CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M2CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M2CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M3CD    IFNE 0                                         CFT009
     C           I0M3CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE F0M3CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M3CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M4CD    IFNE 0                                         CFT009
     C           I0M4CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M4CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M4CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M5CD    IFNE 0                                         CFT009
     C           I0M5CD    ANDEQ*BLANKS                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M5CD    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
     C                     MOVE ZFIELD    M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
     C                     MOVELV#RCCY    #3RCY1                          CFT014
     C                     MOVELV#RCCY    #3RCY2                          CFT014
     C                     MOVELV#RCCY    #3RCY3                          CFT014
     C                     MOVELV#RCCY    #3RCY4                          CFT014
     C                     MOVELV#RCCY    #3RCY5                          CFT014
     C                     MOVELV#RCCY    #3RCY6                          CFT014
     C           S01494    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY7                          CFT014
     C                     ENDIF                                          CFT014
     C           S01499    IFEQ 'Y'                                       CFT014
     C                     MOVELV#RCCY    #3RCY8                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELV#RCCY    RCY9                            CFT009
     C                     MOVELV#RCCY    RCY10                           CFT009
     C                     MOVELV#RCCY    RCY11                           CFT009
     C                     MOVELV#RCCY    RCY12                           CFT009
     C                     MOVELV#RCCY    RCY13                           CFT009
     C                     ENDIF                                          CFT009
      *
      *  Look field up on database
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM V#RCCY    @K101
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      *  If error on call
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOCURRR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 07 *
     C                     Z-ADD7         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2TRCM                          CFT014
     C***********F3TRCM    IFNE 0                                         CFT014
     C***********          MOVE F3TRCM    ZFIELD                          CFT014
      *
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TRCM                          CFT014
     C           F0TRCM    IFNE 0                                         CFT014
     C                     MOVE F0TRCM    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TRCM                          CFT014
     C                     MOVE ZFIELD    #3TRCM                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2TXCH                          CFT014
     C***********F3TXCH    IFNE 0                                         CFT014
     C***********          MOVE F3TXCH    ZFIELD                          CFT014
      *
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TXCH                          CFT014
     C           F0TXCH    IFNE 0                                         CFT014
     C                     MOVE F0TXCH    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TXCH                          CFT014
     C                     MOVE ZFIELD    #3TXCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2CQCH                          CFT014
     C***********F3CQCH    IFNE 0                                         CFT014
     C***********          MOVE F3CQCH    ZFIELD                          CFT014
      *
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3CQCH                          CFT014
     C           F0CQCH    IFNE 0                                         CFT014
     C                     MOVE F0CQCH    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2CQCH                          CFT014
     C                     MOVE ZFIELD    #3CQCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2ADCH                          CFT014
     C***********F3ADCH    IFNE 0                                         CFT014
     C***********          MOVE F3ADCH    ZFIELD                          CFT014
      *
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3ADCH                          CFT014
     C           F0ADCH    IFNE 0                                         CFT014
     C                     MOVE F0ADCH    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2ADCH                          CFT014
     C                     MOVE ZFIELD    #3ADCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2TLCH                          CFT014
     C***********F3TLCH    IFNE 0                                         CFT014
     C***********          MOVE F3TLCH    ZFIELD                          CFT014
      *
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3TLCH                          CFT014
     C           F0TLCH    IFNE 0                                         CFT014
     C                     MOVE F0TLCH    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2TLCH                          CFT014
     C                     MOVE ZFIELD    #3TLCH                          CFT014
     C                     END
      *
      * Format amount for screen
      *
     C***********          MOVEL*BLANKS   #2MSCH                          CFT014
     C***********F3MSCH    IFNE 0                                         CFT014
     C***********          MOVE F3MSCH    ZFIELD                          CFT014
      *
     C                     MOVEL*BLANKS   #3MSCH                          CFT014
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C           F0MSCH    IFNE 0                                         CFT014
     C                     MOVE F0MSCH    ZFIELD                          CFT014
      *                                                                   CFT014
     C                     CALL 'ZEDIT'                9090
     C                     PARM           ZFIELD 16        B:FUNCTION FIELD
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DECIMALS
      *
     C***********          MOVE ZFIELD    #2MSCH                          CFT014
     C                     MOVE ZFIELD    #3MSCH                          CFT014
     C                     END
     C*                                                                   S01494
     C** Format amount for screen                                         S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          MOVEL*BLANKS   #2CHCM                   S01494 CFT014
     C***********F3CHCM    IFNE 0                                  S01494 CFT014
     C***********          MOVE F3CHCM    ZFIELD                   S01494 CFT014
     C*                                                                   S01494
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3CHCM                          CFT014
     C           F0CHCM    IFNE 0                                         CFT014
     C                     MOVE F0CHCM    ZFIELD                          CFT014
     C*                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               S01494
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01494
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01494
     C*                                                                   S01494
     C***********          MOVE ZFIELD    #2CHCM                   S01494 CFT014
     C                     MOVE ZFIELD    #3CHCM                          CFT014
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Format amount for screen                                         S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT010    OREQ 'Y'                                       CFT009
     C*                                                                   S01499
     C***********          MOVEL*BLANKS   #2VATD                   S01499 CFT014
     C***********F3VATD    IFNE 0                                  S01499 CFT014
     C***********          MOVE F3VATD    ZFIELD                   S01499 CFT014
     C*                                                                   S01499
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   #3VATD                          CFT014
     C           F0VATD    IFNE 0                                         CFT014
     C                     MOVE F0VATD    ZFIELD                          CFT014
     C*                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               S01499
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01499
     C***********          PARM A6NBDP    ZADEC   10       I:NO OF DEC                 S01499 CFT014
     C                     PARM SAVEDP    ZADEC                                               CFT014
     C*                                                                   S01499
     C***********          MOVE ZFIELD    #2VATD                   S01499 CFT014
     C                     MOVE ZFIELD    #3VATD                          CFT014
     C                     END                                            S01499
     C*                                                                   S01499
     C***********          MOVEL*BLANKS   #2VATT                   S01499 CFT014
     C***********F3VATT    IFNE 0                                  S01499 CFT014
     C***********          MOVE F3VATT    ZFIELD                   S01499 CFT014
     C*                                                                   S01499
     C                     MOVEL*BLANKS   #3VATT                          CFT014
     C           F0VATT    IFNE 0                                         CFT014
     C                     MOVE F0VATT    ZFIELD                          CFT014
     C*                                                                   CFT014
     C                     CALL 'ZEDIT'                9090               S01499
     C                     PARM           ZFIELD 16        B:FUNCTION FLD S01499
     C                     PARM A6NBDP    ZADEC   10       I:NO OF DEC    S01499
     C*                                                                   S01499
     C***********          MOVE ZFIELD    #2VATT                   S01499 CFT014
     C                     MOVE ZFIELD    #3VATT                          CFT014
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                                            S01499
      *                                                                   CFT014
      ** IF SAR CFT009 (FEES AND CHARGES) THEN DISPLAY EXTRA CHARGES      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CH                            CFT009
     C           F0M1CH    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M1CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M1CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CH                            CFT009
     C           F0M2CH    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M2CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M2CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CH                            CFT009
     C           F0M3CH    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M3CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M3CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CH                            CFT009
     C           F0M4CH    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M4CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M4CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CH                            CFT009
     C           F0M5CH    IFNE 0                                         CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE F0M5CH    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     MOVE ZFIELD    M5CH                            CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT014
      ** CFT014 is on.                                                    CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
      ** Format Receiver's Charges Remitted amount for screen.            CFT014
      *                                                                   CFT014
     C           I0RCRM    IFEQ *BLANK                                    CFT014
     C           #3DTCH    ANDEQ'OUR'                                     CFT014
     C                     MOVELSMCY      P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0RCRM    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                9090               CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
      *                                                                   CFT014
     C                     MOVE ZFIELD    #3RCRM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Sender's Charges Deducted amount for screen.              CFT014
      *                                                                   CFT014
     C                     MOVELI0SCCY    WSCCY   1                       CFT014
     C                     MOVELI0SCHG    WSCHG   1                       CFT014
     C           S0SCC1    IFNE *BLANK                                    CFT014
     C           I0SCC1    ANDEQ*BLANK                                    CFT014
     C           WSCCY     ANDEQ*BLANK                                    CFT014
     C           I0SCH1    ANDEQ*BLANK                                    CFT014
     C           WSCHG     ANDEQ*BLANK                                    CFT014
     C                     MOVELS0SCC1    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0SCH1    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           S0SCC2    IFNE *BLANK                                    CFT014
     C           I0SCC2    ANDEQ*BLANK                                    CFT014
     C           WSCCY     ANDEQ*BLANK                                    CFT014
     C           I0SCH2    ANDEQ*BLANK                                    CFT014
     C           WSCHG     ANDEQ*BLANK                                    CFT014
     C                     MOVELS0SCC2    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0SCH2    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           S0SCC3    IFNE *BLANK                                    CFT014
     C           I0SCC3    ANDEQ*BLANK                                    CFT014
     C           WSCCY     ANDEQ*BLANK                                    CFT014
     C           I0SCH3    ANDEQ*BLANK                                    CFT014
     C           WSCHG     ANDEQ*BLANK                                    CFT014
     C                     MOVELS0SCC3    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0SCH3    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           S0SCC4    IFNE *BLANK                                    CFT014
     C           I0SCC4    ANDEQ*BLANK                                    CFT014
     C           WSCCY     ANDEQ*BLANK                                    CFT014
     C           I0SCH4    ANDEQ*BLANK                                    CFT014
     C           WSCHG     ANDEQ*BLANK                                    CFT014
     C                     MOVELS0SCC4    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0SCH4    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH4                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           S0SCC5    IFNE *BLANK                                    CFT014
     C           I0SCC5    ANDEQ*BLANK                                    CFT014
     C           WSCCY     ANDEQ*BLANK                                    CFT014
     C           I0SCH5    ANDEQ*BLANK                                    CFT014
     C           WSCHG     ANDEQ*BLANK                                    CFT014
     C                     MOVELS0SCC5    P@CCY                           CFT014
     C                     EXSR SRCURR                                    CFT014
     C                     Z-ADDA6NBDP    ZADEC                           CFT014
     C                     MOVE F0SCH5    ZFIELD                          CFT014
     C                     CALL 'ZEDIT'                                   CFT014
     C                     PARM           ZFIELD                          CFT014
     C                     PARM           ZADEC                           CFT014
     C                     MOVE ZFIELD    #3SCH5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           MFEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Change Record - Incoming Paymenet        *
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SDCHRC'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      * Move key fields to @INPAYL0
      *
     C                     MOVEL#1PREF    PREF
     C           KPREF     CHAIN@INPAYL0             9091  *
     C/COPY WNCPYSRC,FT0355C006
      *
     C           *IN90     IFEQ '1'
     C                     Z-ADD8         W0ERNB           **************
     C                     MOVEL'INPAYL1 'W0FILE           *DB ERROR 08 *
     C                     MOVELPREF      W0KEY            **************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           *IN91     IFEQ '1'
      *
      * Record locked
      *
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     END
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
     C           KPREF     CHAININPAYXL0             9091                 CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C           *IN90     OREQ '0'                                       CFT014
     C           INRECI    ANDNE'D'                                       CFT014
     C                     Z-ADD027       W0ERNB                          CFT014
     C                     MOVELPREF      W0KEY                           CFT014
     C                     MOVEL'INPAYXL0'W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           *IN91     IFEQ '1'                                       CFT014
      *                                                                   CFT014
      ** Record locked.                                                   CFT014
      *                                                                   CFT014
     C                     MOVEL'Y2U0004' W0RTN                           CFT014
     C                     GOTO SDEXIT                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
      * Check for changed record
      *
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      *
      * Send message '*Update not accepted'
      *
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * Use SETLL to release record lock
      *
     C           KPREF     SETLL@INPAYL0             9091  *
     C                     GOTO SDEXIT
     C                     END                             FI #1DBRC
      *
      * If Account with Bank entered and OPIN changed
      * reverse movements, if OPIN now Y
      *
     C           ACBT      IFNE *BLANKS
     C           OPIN      ANDNE'Y'
     C           S3OPIN    ANDEQ'Y'
     C                     Z-SUBPYAM      ##PYAM
     C                     EXSR SRADD
     C                     END
      *                                                                   068320
      * Calculate charge amount (always debit)                            068320
      *                                                                   068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  ADCH      ##CHGS                          068320
     C                     ADD  TLCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     ##CHGS                          CFT009
     C                     ADD  MSC02     ##CHGS                          CFT009
     C                     ADD  MSC03     ##CHGS                          CFT009
     C                     ADD  MSC04     ##CHGS                          CFT009
     C                     ADD  MSC05     ##CHGS                          CFT009
     C                     ENDIF                                          CFT009
     C           S01494    IFEQ 'Y'                                       S01494
     C                     ADD  INCHCM    ##CHGS                          S01494
     C                     END                                            S01494
     C           S01499    IFEQ 'Y'                                       S01499
     C                     ADD  INVATT    ##CHGS                          S01499
     C                     END                                            S01499
      *                                                                   068320
     C           ##CHGS    IFNE 0                                         068320
     C           #1ACTC    ANDNE'I'                                       126281
     C           CFT009    OREQ 'Y'                                       CFT009
     C                     Z-SUB##CHGS    ##CHGS                          068320
     C                     EXSR SRSCHG                                    068320
     C/COPY WNCPYSRC,FT0355C047
     C                     END                                            068320
      *
      * Save OPIN for compare after update
      *
     C                     MOVELOPIN      SVOPIN
     C           *LIKE     DEFN OPIN      SVOPIN
      *
      * Move all fields to @INPAYL0
      *
     C                     EXSR SRMOVE
     C/COPY WNCPYSRC,FT0355C033
     C                     UPDAT@INPAYL0               91  *
     C*EDTRCD: Cpysrc Templates Update database
     C/COPY WNCPYSRC,FT0355UPDT
      *
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'SD008161'                                                    CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           *IN91     IFEQ '1'
      *
      * Change error detected
      *
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
     C                     UPDATINPAYXDF               91                 CFT014
     C           *IN91     IFEQ '1'                                       CFT014
     C                     MOVEL'Y2U0004' W0RTN                           CFT014
     C                     GOTO SDEXIT                                    CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *
      * If Account with Bank entered and OPIN changed
      * add movements, if OPIN now N
      *
     C           ACBT      IFNE *BLANKS
     C           SVOPIN    ANDEQ'Y'
     C           OPIN      ANDNE'Y'
     C                     Z-ADDPYAM      ##PYAM
     C                     EXSR SRADD
     C                     END
      *                                                                   068320
      * Calculate charge amount (always debit)                            068320
      *                                                                   068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  ADCH      ##CHGS                          068320
     C                     ADD  TLCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C           S01494    IFEQ 'Y'                                       S01494
     C                     ADD  INCHCM    ##CHGS                          S01494
     C                     END                                            S01494
     C           S01499    IFEQ 'Y'                                       S01499
     C                     ADD  INVATT    ##CHGS                          S01499
     C                     END                                            S01499
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MSC01     ##CHGS                          CFT009
     C                     ADD  MSC02     ##CHGS                          CFT009
     C                     ADD  MSC03     ##CHGS                          CFT009
     C                     ADD  MSC04     ##CHGS                          CFT009
     C                     ADD  MSC05     ##CHGS                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   068320
     C           ##CHGS    IFNE 0                                         068320
     C                     EXSR SRSCHG                                    068320
     C                     END                                            068320
      *
      * DBF change successful
      *
      * Update Incoming Message FT Transaction Status File record
      *
     C           INMSGR    IFNE 0
     C           #1ACTC    ANDEQ'I'
      *
     C                     MOVEL'MIN0034' W0LMSG  7
      *
     C                     EXSR SRLOG
      *
     C                     END
      *
      *  Update database with changes
      *
     C                     EXSR SRUPD
      *
      *
      * Update saved record image
      *
     C                     MOVEL@1DBRC    #1DBRC
     C                     END
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           SDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRENQ1   : Expand fields using FT0315                        *
      *                                                               *
      *  CALLED BY: MBFL#1 - Format data for screen                   *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRENQ1    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRENQ1'  @STK,Q
      *
      *  Set up general parameters
      *
     C                     CLEARW8FT
     C                     MOVEL*BLANKS   W8STMT
     C                     MOVEL##PGM     W8CPGM
     C                     MOVEL'*ENQ'    W8ACT
     C                     Z-ADD5         W8NLIN
      *
      *  Ordering Bank
      *
     C                     MOVELORBT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELORB1      ADCHK1
     C                     MOVELORB2      ADCHK2
     C                     MOVELORB3      ADCHK3
     C                     MOVELORB4      ADCHK4
     C                     MOVELORB5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1OBK1
     C                     MOVELADCHK2    #1OBK2
     C                     MOVELADCHK3    #1OBK3
     C                     MOVELADCHK4    #1OBK4
     C                     MOVELADCHK5    #1OBK5
      *
      *  Sender's Correspondent
      *
     C                     MOVELSNCT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELSNC1      ADCHK1
     C                     MOVELSNC2      ADCHK2
     C                     MOVELSNC3      ADCHK3
     C                     MOVELSNC4      ADCHK4
     C                     MOVELSNC5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1SNC1
     C                     MOVELADCHK2    #1SNC2
     C                     MOVELADCHK3    #1SNC3
     C                     MOVELADCHK4    #1SNC4
     C                     MOVELADCHK5    #1SNC5
      *
      *  Ordering Customer
      *
     C                     MOVELORCT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELORC1      ADCHK1
     C                     MOVELORC2      ADCHK2
     C                     MOVELORC3      ADCHK3
     C                     MOVELORC4      ADCHK4
     C**********           MOVEL*BLANKS   ADCHK5                                              CFT032
     C                     MOVELORC5      ADCHK5                                              CFT032
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #1ORC1
     C                     MOVELADCHK2    #1ORC2
     C                     MOVELADCHK3    #1ORC3
     C                     MOVELADCHK4    #1ORC4
     C                     MOVELADCHK5    #1ORC5
      *
      *  Unwind subroutine stack name
      *
     C           EXENQ1    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRENQ2   : Expand fields using FT0315                        *
      *                                                               *
      *  CALLED BY: MEFL#1 - Format data for screen                   *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRENQ2    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRENQ2'  @STK,Q
      *
      *  Set up general parameters
      *
     C                     CLEARW8FT
     C                     MOVEL*BLANKS   W8STMT
     C                     MOVEL##PGM     W8CPGM
     C                     MOVEL'*ENQ'    W8ACT
     C                     Z-ADD5         W8NLIN
      *
      *  Intermediary Bank
      *
     C                     MOVELINBT      W8TYPE
     C                     MOVEL*BLANKS   ADDRSS
     C                     MOVELINB1      ADCHK1
     C                     MOVELINB2      ADCHK2
     C                     MOVELINB3      ADCHK3
     C                     MOVELINB4      ADCHK4
     C                     MOVELINB5      ADCHK5
     C                     MOVELADDRSS    W8LINS
      *
      * Call expansion program
      *
     C                     CALL 'FT0315'
     C                     PARM           W8RTN   7
     C                     PARM           W8FT
     C                     PARM           W8LINS256
     C                     PARM           W8RPT 256
     C                     PARM           W8MSG 256
     C                     PARM           W8SCR 256
      *
     C                     MOVELW8SCR     ADDRSS
     C                     MOVELADCHK1    #2INB1
     C                     MOVELADCHK2    #2INB2
     C                     MOVELADCHK3    #2INB3
     C                     MOVELADCHK4    #2INB4
     C                     MOVELADCHK5    #2INB5
      *
      *  Unwind subroutine stack name
      *
     C           EXENQ2    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRCDFT   : Calculate defaults                                *
      *                                                               *
      *  CALLED BY: MEIZ#D - Initialise second screen                 *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRCDFT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCDFT'  @STK,Q
      *
      * Payment type and subtype
     C                     MOVELPYTP      W7PYTP
     C                     MOVELPYST      W7PYST
      *
      * Input currency and charge currency
     C                     MOVELV#CCCY    W7ICCY
     C                     MOVELV#RCCY    W7CCCY
      *
      * Settlement method
     C                     MOVEL*BLANKS   W7STMT
      *
      * Defaults required
     C                     MOVEL'Y'       W7DFRQ
      *
      * Charges branch
     C                     MOVELPYBR      W7BRCA
      *
      * Charge currency amount
      *
     C                     SELEC
      *
     C           V#ADDC    WHEQ 'A'
     C                     Z-ADDSMAM      W7CAMT
     C                     MOVELSMCY      W7PCCY
      *
     C                     OTHER
     C                     Z-ADDPYAM      W7CAMT
     C                     MOVELPCCY      W7PCCY
     C                     ENDSL
      *
      * Transfer Commission type
     C***********          MOVEL#1TRCT    W7TRCT                          CFT014
     C                     MOVEL#2TRCT    W7TRCT                          CFT014
      *
      * SWIFT priority code
     C           SWPC      IFEQ 1
     C                     MOVEL'U'       W7SWPC
     C                     ELSE
     C                     MOVEL'N'       W7SWPC
     C                     END
      *
      * Transfer Commission amount
     C                     Z-ADDDUMA1     W7TRCD
     C                     Z-ADDTRCM      W7TRCH
      *
      * Telex charge
     C                     Z-ADDDUMA2     W7TXCD
     C                     Z-ADDTXCH      W7TXCH
      *
      * Cheque Charge
     C                     Z-ADDDUMA3     W7CQCD
     C                     Z-ADDCQCH      W7CQCH
      *
      * Costs Abroad
     C                     Z-ADD0         W7CSTD
     C                     Z-ADD0         W7CSTA
      *
      * SWIFT Priority Charge
     C                     Z-ADD0         W7SPCD
     C                     Z-ADD0         W7SPCH
      *
      * Miscellaneous charge
     C                     Z-ADDDUMA6     W7MSCD
     C                     Z-ADDMSCH      W7MSCH
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     Z-ADDINDUM7    W7CHCD                          S01494
     C                     Z-ADDINCHCM    W7CHCM                          S01494
     C                     END                                            S01494
      *
      * Advice Charge
     C                     Z-ADDDUMA4     W7ADCD
     C                     Z-ADDADCH      W7ADCH
      *
      * Telephone Charge
     C                     Z-ADDDUMA5     W7TLCD
     C                     Z-ADDTLCH      W7TLCH
      *
      * Collection Charge
     C                     Z-ADD0         W7COLD
     C                     Z-ADD0         W7COLL
      *
     C                     MOVEL*BLANKS   W7ACT
     C                     MOVEL'IN'      W7ACT
     C*                                                                   S01506
     C**  Other currency                                                  S01506
     C                     SELEC                                          S01506
     C*                                                                   S01506
     C***********#1CDRO    WHNE *BLANK                             S01506 CFT014
     C           #3CDRO    WHNE *BLANK                                    CFT014
     C           SMCY      ANDNEPCCY                                      S01506
     C                     MOVE '***'     W7OCCY                          S01506
     C*                                                                   S01506
     C***********#1CDRO    WHNE *BLANK                             S01506 CFT014
     C           #3CDRO    WHNE *BLANK                                    CFT014
     C           SMCY      ANDEQPCCY                                      S01506
     C                     MOVE W7PCCY    W7OCCY                          S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'D'                                       S01506
     C                     MOVE SMCY      W7OCCY                          S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'A'                                       S01506
     C                     MOVE PCCY      W7OCCY                          S01506
     C*                                                                   S01506
     C                     ENDSL                                          S01506
     C*                                                                   S01508
     C**  If core feature S01508 is installed, set up parameters for      S01508
     C**  FT0035 to get the customer to be debited the charges            S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   W7CUST                          S01506
     C*                                                                   S01508
     C           S01508    IFEQ 'Y'                                       S01508
     C*                                                                   S01508
     C**  Initialise work fields                                          S01506
     C*                                                                   S01506
     C                     MOVE *BLANKS   I#PT1                           S01506
     C                     MOVE *BLANKS   I#PTY1                          S01506
     C                     MOVE *BLANKS   I#PT2                           S01506
     C                     MOVE *BLANKS   I#PTY2                          S01506
     C                     MOVE *BLANKS   I#CCY                           S01506
      *                                                                   CFT014
     C**********           MOVE *BLANKS   WIBTR  18                       CFT014       CFT014 CGL029
     C**********           MOVE *BLANKS   WIBRC  18                       CFT014       CFT014 CGL029
     C                     MOVE *BLANKS   WIBTR  24                                           CGL029
     C                     MOVE *BLANKS   WIBRC  24                                           CGL029
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Third Reimbursement Institution.                             CFT014
      *                                                                   CFT014
     C           INTRIT    IFEQ 'I'                                       CFT014
     C                     MOVELINTRIB    P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD028       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C                     MOVELWIACNT    WIBTR                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Receiver's Correspondent.                                    CFT014
      *                                                                   CFT014
     C           INRCRT    IFEQ 'I'                                       CFT014
     C           34        SUBSTINRCO1:2  P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD029       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C                     MOVELWIACNT    WIBRC                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   S01506
     C                     SELEC                                          S01506
     C*                                                                   S01506
     C           S01506    WHEQ 'Y'                                       S01506
     C                     MOVE BNCT      I#PT1                           S01506
     C                     MOVE BNC1      I#PTY1                          S01506
     C                     MOVE PCCY      I#CCY                           S01506
     C*                                                                   S01506
     C***********F2CDRT    WHNE *BLANKS                            S01506 CFT014
     C***********          MOVE F2CDRT    I#PT1                    S01506 CFT014
     C***********#1CDRO    CAT  #1CDBR    I#PTY1    P              S01506 CFT014
     C           CDRT      WHNE *BLANKS                                   CFT014
     C                     MOVE CDRT      I#PT1                           CFT014
     C           #3CDRO    CAT  #3CDBR    I#PTY1    P                     CFT014
     C                     MOVE V#BCCY    I#CCY                           S01506
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'A'                                       S01506
      *                                                                   CFT014
     C           INTRIT    IFEQ *BLANKS                                   CFT014
     C           CFT014    ORNE 'Y'                                       CFT014
      *                                                                   CFT014
     C                     MOVE SNTP      I#PT1                           S01506
     C                     MOVE SND1      I#PTY1                          S01506
     C                     MOVE SMCY      I#CCY                           S01506
     C***********          MOVE RCRT      I#PT2                    S01506 CFT014
     C***********RCCO      IFNE 0                                  S01506 CFT014
     C***********          MOVELRCCO      I#PTY2                   S01506 CFT014
     C           WIBRC     IFNE *BLANKS                                   CFT014
     C                     MOVEL'G'       I#PT2                           CFT014
     C                     MOVELWIBRC     I#PTY2                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINRCRT    I#PT2                           CFT014
     C                     MOVELINRCO1    I#PTY2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           WIBRC     IFNE *BLANKS                                   CFT014
     C                     MOVEL'G'       I#PT1                           CFT014
     C                     MOVELWIBRC     I#PTY1                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINRCRT    I#PT1                           CFT014
     C                     MOVELINRCO1    I#PTY1                          CFT014
     C                     ENDIF                                          CFT014
     C                     MOVELSMCY      I#CCY                           CFT014
     C           WIBTR     IFNE *BLANKS                                   CFT014
     C                     MOVEL'G'       I#PT2                           CFT014
     C                     MOVELWIBTR     I#PTY2                          CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINTRIT    I#PT2                           CFT014
     C                     MOVELINTRIB    I#PTY2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     END                                            S01506
     C/COPY WNCPYSRC,FT0355C034
     C*                                                                   S01506
     C           V#ADDC    WHEQ 'D'                                       S01506
     C                     MOVE BNCT      I#PT1                           S01506
     C                     MOVE BNC1      I#PTY1                          S01506
     C                     MOVE PCCY      I#CCY                           S01506
     C                     MOVE ACBT      I#PT2                           S01506
     C           ACBK      CAT  ACBB      I#PTY2    P                     S01506
     C*                                                                   S01506
     C                     ENDSL                                          S01506
     C/COPY WNCPYSRC,FT0355C007
     C*                                                                   S01506
     C**  Call FT0035 to get customer number to be debited the charges    S01506
     C*                                                                   S01506
     C                     CALL 'FT0035'               9090               S01506
     C                     PARM *BLANKS   W0RTN   7                       S01506
     C                     PARM           W0DTA                           S01506
     C                     PARM           W0MSG 256                       S01506
     C*                                                                   S01506
     C           *IN90     IFEQ '1'                                       S01506
     C           W0RTN     ORNE *BLANKS                                   S01506
     C                     MOVEL'FT0035  'W0FILE           ************   S01506
     C                     MOVEL'*CALL   'W0KEY            * DBERR 33 *   S01506
     C                     Z-ADD33        W0ERNB           ************   S01506
     C                     MOVEL'MEM5003' W0MSGD                          S01506
     C                     MOVEL'MIDAS  ' W0MSGF                          S01506
     C                     EXSR SRERR                                     S01506
     C                     END                                            S01506
     C*                                                                   S01506
     C                     MOVE O#CUST    W7CUST                          S01506
     C*                                                                   S01506
     C                     END                                            S01508
      *                                                                   CEU006
      * Set up EMU fields for default calculations                        CEU006
      *                                                                   CEU006
      * Settle Value Date                                                 CEU006
     C                     Z-ADDSLDT      W7SLDT                          CEU006
      *                                                                   CEU006
      * Pay Value Date                                                    CEU006
     C                     Z-ADDPVDT      W7PVDT                          CEU006
      *                                                                   CEU006
      * Add/Deduct Indicator                                              CEU006
     C                     MOVELADDC      W7ADDC                          CEU006
      *
      *  Call defaults program
      *
     C***********#1ACTC    IFEQ 'I'                                 100660133860
     C***********#1TRCT    ORNE TRCT                                100660133860
     C***********#1CDRO    ORNE *BLANKS                             100660133860
     C***********CDRO      ANDEQ0                                   100660133860
     C***********#1CDRO    OREQ *BLANKS                             100660133860
     C***********CDRO      ANDNE0                                   100660133860
     C***********#1ACTC    OREQ 'A'                                 100660133860
     C***********W0FCUS    ANDNEW0SCUS                              100660133860
      *                                                                   100660
     C                     CALL 'FT0320'               9090
     C                     PARM *BLANKS   W7RTN   7
     C                     PARM           W7ACT   8
     C                     PARM           W7DATA
      *                                                                   100660
     C***********          ENDIF                                    100660133860
      *                                                                   100660
     C           *IN90     IFEQ '1'
     C           W7RTN     ORNE *BLANKS
     C                     MOVEL'FT0320  'W0FILE           ***************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 08 *
     C                     Z-ADD23        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Transfer Commission amount
     C                     Z-ADDW7TRCD    DUMA1
     C                     Z-ADDW7TRCH    TRCM
      *
      * Telex charge
     C                     Z-ADDW7TXCD    DUMA2
     C                     Z-ADDW7TXCH    TXCH
      *
      * Cheque Charge
     C                     Z-ADDW7CQCD    DUMA3
     C                     Z-ADDW7CQCH    CQCH
      *
      * Advive charge
     C                     Z-ADDW7ADCD    DUMA4
     C                     Z-ADDW7ADCH    ADCH
      *
      * Telephone Charge
     C                     Z-ADDW7TLCD    DUMA5
     C                     Z-ADDW7TLCH    TLCH
      *
      * Miscellaneous charge
     C                     Z-ADDW7MSCD    DUMA6
     C                     Z-ADDW7MSCH    MSCH
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           S01494    IFEQ 'Y'                                       S01494
     C                     Z-ADDW7CHCD    INDUM7                          S01494
     C                     Z-ADDW7CHCM    INCHCM                          S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Set recalculation flag                                           S01499
     C*                                                                   S01499
     C                     MOVE 'Y'       W0RCAL  1                       S01499
      *                                                                   CFT009
      ** If recalculation is required, clear out screen values for new    CFT009
      ** misc fields                                                      CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVE *BLANKS   M1CD                            CFT009
     C                     MOVE *BLANKS   M2CD                            CFT009
     C                     MOVE *BLANKS   M3CD                            CFT009
     C                     MOVE *BLANKS   M4CD                            CFT009
     C                     MOVE *BLANKS   M5CD                            CFT009
     C                     ENDIF                                          CFT009
      *
      *  Unwind subroutine stack name
      *
     C           EXCDFT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRMOVE   : Move data to file fields                          *
      *                                                               *
      *  CALLED BY: SACRRC - Create record                            *
      *           : SCCHRC - Change record                            *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRMOVE    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *  Set fields
      *
     C                     MOVEL'D'       RECI
     C                     MOVEL#1PREF    PREF
     C                     MOVEL'Y'       INLVL2
      *  Transfer Comission tariff
     C***********          MOVEL#1TRCT    TRCT                            CFT014
     C                     MOVEL#2TRCT    TRCT                            CFT014
      *  Charges to the debit of
     C***********          MOVEL#1CDRO    CDRO                            CFT014
     C                     MOVEL#3CDRO    CDRO                            CFT014
     C/COPY WNCPYSRC,FT0355C008
     C***********          MOVELF2CDRT    CDRT                            CFT014
     C                     MOVELF0CDRT    CDRT                            CFT014
      *  Charges to the debit of branch
     C***********          MOVEL#1CDBR    CDBR                            CFT014
     C                     MOVEL#3CDBR    CDBR                            CFT014
     C/COPY WNCPYSRC,FT0355C021
      *  Ordering Bank
     C                     MOVELF2ORBT    ORBT
     C                     MOVEL#1OBK1    ORB1
     C                     MOVEL#1OBK2    ORB2
     C                     MOVEL#1OBK3    ORB3
     C                     MOVEL#1OBK4    ORB4
     C                     MOVEL#1OBK5    ORB5
      *  Sender's Correspondent
     C                     MOVELF2SNCT    SNCT
     C                     MOVEL#1SNC1    SNC1
     C                     MOVEL#1SNC2    SNC2
     C                     MOVEL#1SNC3    SNC3
     C                     MOVEL#1SNC4    SNC4
     C                     MOVEL#1SNC5    SNC5
      *  Ordering Customer
     C                     MOVELF2ORCT    ORCT
     C                     MOVEL#1ORC1    ORC1
     C                     MOVEL#1ORC2    ORC2
     C                     MOVEL#1ORC3    ORC3
     C                     MOVEL#1ORC4    ORC4
     C                     MOVEL#1ORC5    ORC5                                                CFT032
      *  Sender to Receiver information
     C                     MOVEL#1BBI1    BBI1
     C                     MOVEL#1BBI2    BBI2
     C                     MOVEL#1BBI3    BBI3
     C                     MOVEL#1BBI4    BBI4
     C                     MOVEL#1BBI5    BBI5
     C                     MOVEL#1BBI6    BBI6
      *  Intermediary Bank
     C                     MOVELF3INBT    INBT
     C                     MOVEL#2INB1    INB1
     C                     MOVEL#2INB2    INB2
     C                     MOVEL#2INB3    INB3
     C                     MOVEL#2INB4    INB4
     C                     MOVEL#2INB5    INB5
      *  Details of Payment
     C                     MOVEL#2DTP1    DTP1
     C                     MOVEL#2DTP2    DTP2
     C                     MOVEL#2DTP3    DTP3
     C                     MOVEL#2DTP4    DTP4
      *  Central Bank Reference
     C                     MOVEL#2DNBC    DNBC
      *  Related Payment reference
     C                     MOVEL#2RLPR    RLPR
      *  Details of Charges
     C***********          MOVEL#2DTCH    DTCH                            CFT014
     C                     MOVEL#3DTCH    DTCH                            CFT014
      *  Outgoing to be generated
     C                     MOVEL#2OPIN    OPIN
      *  Charges
     C***********          Z-ADDF3TRCD    DUMA1                           CFT014
     C***********          Z-ADDF3TXCD    DUMA2                           CFT014
     C***********          Z-ADDF3CQCD    DUMA3                           CFT014
     C***********          Z-ADDF3ADCD    DUMA4                           CFT014
     C***********          Z-ADDF3TLCD    DUMA5                           CFT014
     C***********          Z-ADDF3MSCD    DUMA6                           CFT014
     C                     Z-ADDF0TRCD    DUMA1                           CFT014
     C                     Z-ADDF0TXCD    DUMA2                           CFT014
     C                     Z-ADDF0CQCD    DUMA3                           CFT014
     C                     Z-ADDF0ADCD    DUMA4                           CFT014
     C                     Z-ADDF0TLCD    DUMA5                           CFT014
     C                     Z-ADDF0MSCD    DUMA6                           CFT014
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          Z-ADDF3CHCD    INDUM7                   S01494 CFT014
     C                     Z-ADDF0CHCD    INDUM7                          CFT014
     C                     END                                            S01494
     C***********          Z-ADDF3TRCM    TRCM                            CFT014
     C***********          Z-ADDF3TXCH    TXCH                            CFT014
     C***********          Z-ADDF3CQCH    CQCH                            CFT014
     C***********          Z-ADDF3ADCH    ADCH                            CFT014
     C***********          Z-ADDF3TLCH    TLCH                            CFT014
     C***********          Z-ADDF3MSCH    MSCH                            CFT014
     C                     Z-ADDF0TRCM    TRCM                            CFT014
     C                     Z-ADDF0TXCH    TXCH                            CFT014
     C                     Z-ADDF0CQCH    CQCH                            CFT014
     C                     Z-ADDF0ADCH    ADCH                            CFT014
     C                     Z-ADDF0TLCH    TLCH                            CFT014
     C                     Z-ADDF0MSCH    MSCH                            CFT014
     C           S01494    IFEQ 'Y'                                       S01494
     C***********          Z-ADDF3CHCM    INCHCM                   S01494 CFT014
     C                     Z-ADDF0CHCM    INCHCM                          CFT014
     C                     END                                            S01494
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     MOVELF0CHCY    INCHGC                          CFT009
     C                     Z-ADDF0CHXR    INCHRT                          CFT009
     C                     Z-ADDF0M1CD    CMSC01                          CFT009
     C                     Z-ADDF0M2CD    CMSC02                          CFT009
     C                     Z-ADDF0M3CD    CMSC03                          CFT009
     C                     Z-ADDF0M4CD    CMSC04                          CFT009
     C                     Z-ADDF0M5CD    CMSC05                          CFT009
     C                     Z-ADDF0M1CH    MSC01                           CFT009
     C                     Z-ADDF0M2CH    MSC02                           CFT009
     C                     Z-ADDF0M3CH    MSC03                           CFT009
     C                     Z-ADDF0M4CH    MSC04                           CFT009
     C                     Z-ADDF0M5CH    MSC05                           CFT009
      *                                                                   CFT009
      ** Charge Codes                                                     CFT009
      *                                                                   CFT009
     C                     MOVELTRCDE     TFCCCO                          CFT009
     C                     MOVELFXCDE     FXCHEC                          CFT009
     C                     MOVELTXCDE     TLCODE                          CFT009
     C                     MOVELADCDE     ADCHCD                          CFT009
     C                     MOVELTPCDE     TLCHCD                          CFT009
     C                     MOVELCQCDE     CHCHCD                          CFT009
     C                     MOVELMSCDE     MISCH                           CFT009
     C                     MOVELM1CDE     MSCH1                           CFT009
     C                     MOVELM2CDE     MSCH2                           CFT009
     C                     MOVELM3CDE     MSCH3                           CFT009
     C                     MOVELM4CDE     MSCH4                           CFT009
     C                     MOVELM5CDE     MSCH5                           CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01499
     C** If switchable feature S01499 is switched ON, set up V.A.T.       S01499
     C** details                                                          S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT010    OREQ 'Y'                                       CFT009
     C***********          Z-ADDF3VATD    INDUM8                   S01499 CFT014
     C***********          Z-ADDF3VATT    INVATT                   S01499 CFT014
     C***********          MOVEL#2VAT1    INVAT1                   S01499 CFT014
     C***********          MOVEL#2VAT2    INVAT2                   S01499 CFT014
     C***********          MOVEL#2VAT3    INVAT3                   S01499 CFT014
     C***********          MOVEL#2VAT4    INVAT4                   S01499 CFT014
     C***********          MOVEL#2VAT5    INVAT5                   S01499 CFT014
     C***********          MOVEL#2VAT6    INVAT6                   S01499 CFT014
     C***********          MOVEL#2VAT7    INVAT7                   S01499 CFT014
     C                     Z-ADDF0VATD    INDUM8                          CFT014
     C                     Z-ADDF0VATT    INVATT                          CFT014
     C                     MOVEL#3VAT1    INVAT1                          CFT014
     C                     MOVEL#3VAT2    INVAT2                          CFT014
     C                     MOVEL#3VAT3    INVAT3                          CFT014
     C                     MOVEL#3VAT4    INVAT4                          CFT014
     C                     MOVEL#3VAT5    INVAT5                          CFT014
     C                     MOVEL#3VAT6    INVAT6                          CFT014
     C                     MOVEL#3VAT7    INVAT7                          CFT014
      *                                                                   CFT009
      ** If switchable feature CFT010 is switched ON, set up V.A.T.       CFT009
      ** details                                                          CFT009
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
     C                     MOVELVAT9      VTMIC1                          CFT009
     C                     MOVELVAT10     VTMIC2                          CFT009
     C                     MOVELVAT11     VTMIC3                          CFT009
     C                     MOVELVAT12     VTMIC4                          CFT009
     C                     MOVELVAT13     VTMIC5                          CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01499
     C** Store V.A.T. rate if used                                        S01499
     C***********F3VATD    IFNE 0                                  S01499 CFT014
     C***********F3VATT    ORNE 0                                  S01499 CFT014
     C           F0VATD    IFNE 0                                         CFT014
     C           F0VATT    ORNE 0                                         CFT014
     C                     Z-ADDV#VATR    INVATR                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                                            S01499
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C                     MOVEL#2BOCD    INBOCD                          CFT014
     C                     MOVEL#2TTCD    INTTCD                          CFT014
     C                     MOVEL#2ICD1    INICD1                          CFT014
     C                     MOVEL#2ICD2    INICD2                          CFT014
     C                     MOVEL#2ICD3    INICD3                          CFT014
     C                     MOVEL#2ICD4    INICD4                          CFT014
     C                     MOVEL#2ICD5    INICD5                          CFT014
     C                     MOVEL#2RRP1    INRRP1                          CFT014
     C                     MOVEL#2RRP2    INRRP2                          CFT014
     C                     MOVEL#2RRP3    INRRP3                          CFT014
     C                     Z-ADDF0RCRM    INRCRM                          CFT014
     C                     Z-ADDF0SCH1    INSCH1                          CFT014
     C                     Z-ADDF0SCH2    INSCH2                          CFT014
     C                     Z-ADDF0SCH3    INSCH3                          CFT014
     C                     Z-ADDF0SCH4    INSCH4                          CFT014
     C                     Z-ADDF0SCH5    INSCH5                          CFT014
     C                     MOVEL#3SCC1    INSCY1                          CFT014
     C                     MOVEL#3SCC2    INSCY2                          CFT014
     C                     MOVEL#3SCC3    INSCY3                          CFT014
     C                     MOVEL#3SCC4    INSCY4                          CFT014
     C                     MOVEL#3SCC5    INSCY5                          CFT014
      *                                                                   CFT014
      ** To avoid using receiver's charges amount network a               CFT014
      ** second time                                                      CFT014
     C           INRCUS    IFEQ 'N'                                       CFT014
     C                     MOVEL'Y'       INRCUS                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CAC001
      ** If Analytical Accounting installed, set up margin info fields.   CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     Z-ADDWOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
     C                     ENDIF                                          CAC001
      *
      * If insert set up audit information
      *
     C           #1ACTC    IFEQ 'I'
     C                     TIME           LCHT
     C                     Z-ADDWURDNB    OEDT
     C                     MOVEL'I'       CHTP
     C                     Z-ADDWURDNB    LCD
     C                     MOVEL##USR     INUSR2
     C                     END
      *
      * If amend set up audit information
      *
     C           #1ACTC    IFEQ 'A'
     C                     TIME           LCHT
      *
     C           LCD       IFNE WURDNB
     C                     MOVEL'A'       CHTP
     C                     END
      *
     C                     MOVEL*BLANKS   AUP1
     C                     Z-ADDWURDNB    LCD
     C                     MOVEL##USR     INUSR2
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0355CBDU                                           S01408
     C*                                                                   S01408
      *
      *  Unwind subroutine stack name
      *
     C           EXMOVE    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all positions in store                      *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARQ#DTA
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*CLEAR  'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           ***************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 09 *
     C                     Z-ADD9         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0355C039
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRADD    : Add shadow positions to store                     *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRADD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRADD'   @STK,Q
      *
      *  Define settle and pay amounts
      *
     C           *LIKE     DEFN SMAM      ##SMAM
     C           *LIKE     DEFN PYAM      ##PYAM
      *
      *  Move fields to Q#DTA structure and call AOSPOSU0
      *
      *         S E T T L E    I N S T R U C T I O N S
      *
      *  Only execute if Outgoing Payment not generated
      *
      *  At present not used.
      *
     C           ##SK      IFEQ 'Y'
     C                     MOVEL'Y'       ##SK    1
     C                     CLEARQ#DTA
     C***********RCRT      IFNE *BLANKS                                   CFT014
     C***********          MOVELRCRT      Q#ATYP                          CFT014
     C***********          MOVELRCCO      Q#ACCT                          CFT014
      *                                                                   CFT014
     C           INTRIT    IFNE *BLANKS                                   CFT014
     C           CFT014    ANDEQ'Y'                                       CFT014
     C                     MOVELINTRIT    Q#ATYP                          CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Third Reimbursement Institution.                             CFT014
      *                                                                   CFT014
     C           INTRIT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C                     MOVELINTRIB    P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD034       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C**********           MOVELWIACNT    Q#ACCT                                       CFT014 CGL029
     C                     MOVELWIACNT    Q#ACCT 24                                           CGL029
     C           6         SUBSTQ#ACCT:1  W#CNU1  6                                           CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1 10                                           CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1  2                                           CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINTRIB    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           INRCRT    IFNE *BLANKS                                   CFT014
     C                     MOVELINRCRT    Q#ATYP                          CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Receiver's Correspondent.                                    CFT014
      *                                                                   CFT014
     C           INRCRT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C           34        SUBSTINRCO1:2  P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD035       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C                     MOVELWIACNT    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINRCO1    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE
     C                     MOVELSNTP      Q#ATYP
     C                     MOVELSND1      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     END
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C/COPY WNCPYSRC,FT0355C035
      *                                                                   CFT014
     C                     Z-ADDSLDT      Q#VDAT
      *
      * Set posting date according to FT Control Data
      *
     C           T#PDTI    IFEQ 'I'
     C                     Z-ADDBJRDNB    Q#PSTD
     C                     ELSE
     C           T#PDTI    IFEQ 'E'
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C           SLDT      IFLT PVDT
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C                     Z-ADDPVDT      Q#PSTD
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL'I'       Q#IO
     C                     MOVELSMCY      Q#CCY
     C                     MOVELPYTP      Q#TRYP
     C                     MOVELPREF      Q#PREF
     C                     Z-ADD##SMAM    Q#AMT
     C                     MOVEL'FT'      Q#MOD
     C                     MOVEL'01'      Q#OLRC
     C                     MOVEL##FTOV    Q#FTOV
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD10        Q#RPNB                          068347
     C                     MOVEL'D'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 10
     C                     Z-ADD10        W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0355C040
      *
     C                     END
      *
      *         P A Y          I N S T R U C T I O N S
      *
     C                     CLEARQ#DTA
     C           ACBT      IFNE *BLANKS
     C                     MOVELACBT      Q#ATYP
     C                     MOVELACBK      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELACBB      Q#BRCA
     C                     ELSE
     C                     MOVELBNCT      Q#ATYP
      * If not IBAN                                                       CFT004
     C           CFT004    IFNE 'Y'                                       CFT004
     C           CFT004    OREQ 'Y'                                       CFT004
     C           BNCT      ANDNE'I'                                       CFT004
     C                     MOVELBNC1      Q#ACCT
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ELSE                                           CFT004
     C           34        SUBSTBNC1:2    BIBAN  34                       CFT004
     C                     MOVE *BLANKS   DSSDY                           CFT004
     C                     CALL 'AOIBANR4'                                CFT004
     C                     PARM           P@RTCD                          CFT004
     C                     PARM '*KEY   ' P@OPTN                          CFT004
     C                     PARM BIBAN     P@IBAN 34                       CFT004
     C           P@ACCN    PARM           DSSDY                           CFT004
     C**********           Z-ADDCNUM      Q#CNU1                                       CFT004 CSD027
     C                     MOVE CNUM      Q#CNU1                                              CSD027
     C                     MOVE CCY       Q#CCY1                          CFT004
     C                     Z-ADDACOD      Q#ACO1                          CFT004
     C                     Z-ADDACSQ      Q#ACS1                          CFT004
     C                     MOVE IBBRCA    Q#BRC1                          CFT004
     C                     ENDIF                                          CFT004
     C                     END
     C                     Z-ADDPVDT      Q#VDAT
      *
      * Set posting date according to FT Control Data
      *
     C           T#PDTI    IFEQ 'I'
     C                     Z-ADDBJRDNB    Q#PSTD
     C                     ELSE
     C           T#PDTI    IFEQ 'E'
     C                     Z-ADDPVDT      Q#PSTD
     C                     ELSE
     C           SLDT      IFLT PVDT
     C                     Z-ADDSLDT      Q#PSTD
     C                     ELSE
     C                     Z-ADDPVDT      Q#PSTD
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL'O'       Q#IO
     C                     MOVELPCCY      Q#CCY
     C                     MOVELPYTP      Q#TRYP
     C                     MOVELPREF      Q#PREF
     C                     Z-SUB##PYAM    Q#AMT
     C                     MOVEL'FT'      Q#MOD
     C                     MOVEL'01'      Q#OLRC
     C                     MOVEL##FTOV    Q#FTOV
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD20        Q#RPNB                          068347
     C                     MOVEL'C'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 11
     C                     Z-ADD11        W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0355C041
      *
      *  Unwind subroutine stack name
      *
     C           EXADD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
     C/EJECT                                                              068320
      *****************************************************************   068320
      *                                                               *   068320
      *  SRSCHG   : Reverse charges from database                     *   068320
      *                                                               *   068320
      *  CALLED BY: UPDATE - Update Database                          *   068320
      *                                                               *   068320
      *  CALLS    : SRERR - Report errors                             *   068320
      *                                                               *   068320
      *****************************************************************   068320
     CSR         SRSCHG    BEGSR                                          068320
      *                                                                   068320
      *  Set up subroutine stack name                                     068320
      *                                                                   068320
     C                     ADD  1         Q                               068320
     C                     MOVEL'SRSCHG'  @STK,Q                          068320
      *                                                                   068320
      *  Move fields to Q#DTA structure and call AOSPOSU0                 068320
      *                                                                   068320
     C                     CLEARQ#DTA                                     068320
      *                                                                   068320
      *  If add use Receiver's Correspondent and Sender                   068320
      *                                                                   068320
     C                     SELEC                                          068320
     C           CDRT      WHNE *BLANKS                                   068320
     C                     MOVELCDRT      Q#ATYP                          068320
     C                     MOVELCDRO      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELCDBR      Q#BRCA                          068320
     C                     MOVELBJCYCD    Q#CCY                           068320
     C/COPY WNCPYSRC,FT0355C009
     C           ADDC      IFEQ 'A'                                       068320
     C                     Z-ADDSLDT      Q#VDAT                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#VDAT                          068320
     C                     END                                            068320
     C           ADDC      WHEQ 'A'                                       068320
     C                     MOVELSMCY      Q#CCY                           068320
     C***********RCRT      IFNE *BLANKS                            068320 CFT014
     C***********          MOVELRCRT      Q#ATYP                   068320 CFT014
     C***********          MOVELRCCO      Q#ACCT                   068320 CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           INTRIT    ANDNE*BLANK                                    CFT014
     C                     MOVE INTRIT    Q#ATYP                          CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Third Reimbursement Institution.                             CFT014
      *                                                                   CFT014
     C           INTRIT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C                     MOVELINTRIB    P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD036       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C                     MOVELWIACNT    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINTRIB    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           INRCRT    IFNE *BLANKS                                   CFT014
     C                     MOVELINRCRT    Q#ATYP                          CFT014
      *                                                                   CFT014
      ** Determine corresponding Midas account of IBAN account            CFT014
      ** for Receiver's Correspondent.                                    CFT014
      *                                                                   CFT014
     C           INRCRT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C           34        SUBSTINRCO1:2  P@IBAN                          CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@IBAN                          CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD037       W0ERNB                          CFT014
     C                     MOVELP@IBAN    W0KEY                           CFT014
     C                     MOVEL'ACCNTL6' W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C**********           Z-ADDCNUM      WICNUM                                       CFT014 CSD027
     C                     MOVE CNUM      WICNUM                                              CSD027
     C                     MOVE CCY       WICCY                           CFT014
     C                     Z-ADDACOD      WIACOD                          CFT014
     C                     Z-ADDACSQ      WIACSQ                          CFT014
     C                     MOVE IBBRCA    WIBRCA                          CFT014
     C                     MOVELWIACNT    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
      *                                                                   CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINRCO1    Q#ACCT                          CFT014
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           068320
     C                     MOVELSNTP      Q#ATYP                          068320
     C                     MOVELSND1      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     END                                            068320
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C/COPY WNCPYSRC,FT0355C036
     C                     Z-ADDSLDT      Q#VDAT                          068320
     C                     OTHER                                          068320
      *                                                                   068320
      *  If deduct use Account with Bank and Beneficiary                  068320
      *                                                                   068320
     C                     MOVELPCCY      Q#CCY                           068320
     C           ACBT      IFNE *BLANKS                                   068320
     C                     MOVELACBT      Q#ATYP                          068320
     C                     MOVELACBK      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     MOVELACBB      Q#BRCA                          068320
     C                     ELSE                                           068320
     C                     MOVELBNCT      Q#ATYP                          068320
      * If not IBAN                                                       CFT004
     C           CFT004    IFNE 'Y'                                       CFT004
     C           CFT004    OREQ 'Y'                                       CFT004
     C           BNCT      ANDNE'I'                                       CFT004
     C                     MOVELBNC1      Q#ACCT                          068320
     C           6         SUBSTQ#ACCT:1  W#CNU1                                              CGL029
     C           3         SUBSTQ#ACCT:7  Q#CCY1                                              CGL029
     C           10        SUBSTQ#ACCT:10 W#ACO1                                              CGL029
     C           2         SUBSTQ#ACCT:20 W#ACS1                                              CGL029
     C           3         SUBSTQ#ACCT:22 Q#BRC1                                              CGL029
     C                     MOVE W#CNU1    Q#CNU1                                              CGL029
     C                     MOVE W#ACO1    Q#ACO1                                              CGL029
     C                     MOVE W#ACS1    Q#ACS1                                              CGL029
     C                     ELSE                                           CFT004
     C           34        SUBSTBNC1:2    BIBAN  34                       CFT004
     C                     MOVE *BLANKS   DSSDY                           CFT004
     C                     CALL 'AOIBANR4'                                CFT004
     C                     PARM           P@RTCD                          CFT004
     C                     PARM '*KEY   ' P@OPTN                          CFT004
     C                     PARM BIBAN     P@IBAN 34                       CFT004
     C           P@ACCN    PARM           DSSDY                           CFT004
     C**********           Z-ADDCNUM      Q#CNU1                                       CFT004 CSD027
     C                     MOVE CNUM      Q#CNU1                                              CSD027
     C                     MOVE CCY       Q#CCY1                          CFT004
     C                     Z-ADDACOD      Q#ACO1                          CFT004
     C                     Z-ADDACSQ      Q#ACS1                          CFT004
     C                     MOVE IBBRCA    Q#BRC1                          CFT004
     C                     ENDIF                                          CFT004
     C                     END                                            068320
     C                     Z-ADDPVDT      Q#VDAT                          068320
     C                     END                                            068320
      *                                                                   068320
      * Set posting date according to FT Control Data                     068320
      *                                                                   068320
     C           T#PDTI    IFEQ 'I'                                       068320
     C                     Z-ADDBJRDNB    Q#PSTD                          068320
     C                     ELSE                                           068320
     C           T#PDTI    IFEQ 'E'                                       068320
     C           ADDC      IFEQ 'A'                                       068320
     C                     Z-ADDSLDT      Q#PSTD                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#PSTD                          068320
     C                     END                                            068320
     C                     ELSE                                           068320
     C           SLDT      IFLT PVDT                                      068320
     C                     Z-ADDSLDT      Q#PSTD                          068320
     C                     ELSE                                           068320
     C                     Z-ADDPVDT      Q#PSTD                          068320
     C                     END                                            068320
     C                     END                                            068320
     C                     END                                            068320
      *                                                                   068320
     C                     MOVEL'I'       Q#IO                            068320
     C                     MOVELPYTP      Q#TRYP                          068320
     C                     MOVELPREF      Q#PREF                          068320
     C                     MOVEL'FT'      Q#MOD                           068320
     C                     MOVEL'01'      Q#OLRC                          068320
     C                     MOVEL##FTOV    Q#FTOV                          068320
     C           *LIKE     DEFN Q#AMT     ##CHGS                          068320
     C                     Z-ADD##CHGS    Q#AMT                           068320
     C                     MOVEL'Y'       Q#RPST                          068347
     C                     Z-ADD30        Q#RPNB                          068347
     C                     MOVEL'D'       Q#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       Q#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FT0355C046
      *                                                                   068320
      *  Call AOSPOSU0                                                    068320
      *                                                                   068320
     C                     CALL 'AOSPOSU0'             9090               068320
     C           R#RTN     PARM *BLANKS   O#RTN   7                       068320
     C                     PARM '*ADD    'W0ACT   8                       068320
     C                     PARM Q#DTA     O#DTA 256                       068320
      *                                                                   068320
     C           *IN90     IFEQ '1'                                       068320
     C           R#RTN     ORNE *BLANKS                                   068320
     C                     MOVEL'AOSPOSU0'W0FILE           ************** 068320
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 511 068320
     C                     Z-ADD511       W0ERNB           ************** 068320
     C                     MOVEL'MEM5003' W0MSGD                          068320
     C                     MOVEL'MIDAS  ' W0MSGF                          068320
     C                     EXSR SRERR                                     068320
     C                     END                                            068320
     C/COPY WNCPYSRC,FT0355C042
      *                                                                   068320
      *  Unwind subroutine stack name                                     068320
      *                                                                   068320
     C           EXSCHG    TAG                                            068320
     C                     MOVEA*BLANKS   @STK,Q                          068320
     C                     SUB  1         Q                               068320
      *                                                                   068320
     CSR                   ENDSR                                          068320
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow positions             *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     CSR         SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *  Call AOSPOSU0 to update database
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM '*UPDATE 'W0ACT   8
     C                     PARM Q#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     MOVEL'AOSPOSU0'W0FILE           **************
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 12
     C                     Z-ADD12        W0ERNB           **************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C/COPY WNCPYSRC,FT0355C043
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRLOG    : Add Incoming Message Log File record              *
      *                                                               *
      *  CALLED BY: SDCHRC- Update Payment Record                     *
      *                                                               *
      *  CALLS    : SRERR - report error and close down program       *
      *                                                               *
      *****************************************************************
     CSR         SRLOG     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRLOG '  @STK,Q
      *
      *  Fill record format data structure with available data
      *
     C                     CLEARINLF
      *
     C                     Z-ADDINMSGR    LFMSGR           Unique Ref.
     C                     Z-ADDINKPRT    LFKPRT           Part No.
     C                     MOVELW0LMSG    LFMSID           Action - Msg ID
     C                     MOVELPREF      LFMSDT           Action Data
     C                     MOVEL*BLANKS   LFARSM           Action Result
     C                     MOVEL*BLANKS   LFARSD           Act Result Data
     C                     MOVEL##PGM     LFCPGM           Calling Process
     C                     MOVEL##PGM     LFRPGM           Called Process
      *
      *  N.B. Audit Stamp details are determined in called program
      *
      *
      *  Set up data to be passed using the rcd format data structure
      *
     C                     CALL 'ME1040'               90
     C                     PARM '*ADD    'W2ACT   8
     C                     PARM           INLF
     C                     PARM *BLANKS   W2RTN   7
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           W2RTN     OREQ '*ERROR*'
     C                     MOVEL'ME1040  'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 13 *
     C                     Z-ADD13        W0ERNB           ***************
     C                     EXSR SRERR
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXLOG     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q       50
      *
     CSR                   ENDSR
      /EJECT
     C*****************************************************************   S01499
     C*                                                               *   S01499
     C*  SRVATC   : V.A.T. Calculation                                *   S01499
     C*                                                               *   S01499
     C*  CALLED BY: MEIZ#D - Initialise second detail screen          *   S01499
     C*                                                               *   S01499
     C*  CALLS    :        -                                          *   S01499
     C*                                                               *   S01499
     C*****************************************************************   S01499
     CSR         SRVATC    BEGSR                                          S01499
     C*                                                                   S01499
     C*  Set up subroutine stack name                                     S01499
     C*                                                                   S01499
     C                     ADD  1         Q       50                      S01499
     C                     MOVEL'SRVATC'  @STK,Q                          S01499
     C*                                                                   S01499
     C                     Z-ADD0         INDUM8                          S01499
     C                     Z-ADD0         INVATT                          S01499
     C*                                                                   S01499
     C** If apply V.A.T. flag is 'Y', calculate V.A.T. charge             S01499
     C**                                                                  S01499
     C** .... Transfer commission                                         S01499
     C*                                                                   S01499
     C***********#2VAT1    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT1    IFEQ 'Y'                                       CFT014
     C***********DUMA1     MULT V#VATR    @TVATD 130 H              S01499CFT009
     C***********TRCM      MULT V#VATR    @TVATT 130 H              S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA1     INDUM8                          CFT009
     C                     ADD  TRCM      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Telex                                                       S01499
     C*                                                                   S01499
     C***********#2VAT2    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT2    IFEQ 'Y'                                       CFT014
     C***********DUMA2     MULT V#VATR    @TVATD H                  S01499CFT009
     C***********TXCH      MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA2     INDUM8                          CFT009
     C                     ADD  TXCH      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Cheque                                                      S01499
     C*                                                                   S01499
     C***********#2VAT3    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT3    IFEQ 'Y'                                       CFT014
     C***********DUMA3     MULT V#VATR    @TVATD H                  S01499CFT009
     C***********CQCH      MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA3     INDUM8                          CFT009
     C                     ADD  CQCH      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Advice                                                      S01499
     C*                                                                   S01499
     C***********#2VAT4    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT4    IFEQ 'Y'                                       CFT014
     C***********DUMA4     MULT V#VATR    @TVATD H                  S01499CFT009
     C***********ADCH      MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA4     INDUM8                          CFT009
     C                     ADD  ADCH      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Telephone                                                   S01499
     C*                                                                   S01499
     C***********#2VAT5    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT5    IFEQ 'Y'                                       CFT014
     C***********DUMA5     MULT V#VATR    @TVATD H                  S01499CFT009
     C***********TLCH      MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA5     INDUM8                          CFT009
     C                     ADD  TLCH      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... Miscellaneous                                               S01499
     C*                                                                   S01499
     C***********#2VAT6    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT6    IFEQ 'Y'                                       CFT014
     C***********DUMA6     MULT V#VATR    @TVATD H                  S01499CFT009
     C***********MSCH      MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  DUMA6     INDUM8                          CFT009
     C                     ADD  MSCH      INVATT                          CFT009
     C                     END                                            S01499
     C*                                                                   S01499
     C** .... FX/Change commission                                        S01499
     C*                                                                   S01499
     C***********#2VAT7    IFEQ 'Y'                                S01499 CFT014
     C           #3VAT7    IFEQ 'Y'                                       CFT014
     C           S01494    ANDEQ'Y'                                       S01499
     C***********INDUM7    MULT V#VATR    @TVATD H                  S01499CFT009
     C***********INCHCM    MULT V#VATR    @TVATT H                  S01499CFT009
     C***********          ADD  @TVATD    INDUM8                    S01499CFT009
     C***********          ADD  @TVATT    INVATT                    S01499CFT009
     C                     ADD  INDUM7    INDUM8                          CFT009
     C                     ADD  INCHCM    INVATT                          CFT009
     C                     END                                            S01499
      *                                                                   CFT009
     C           CFT010    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 1                                      CFT009
      *                                                                   CFT009
     C           VAT9      IFEQ 'Y'                                       CFT009
     C                     ADD  CMSC01    INDUM8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 2                                      CFT009
      *                                                                   CFT009
     C           VAT10     IFEQ 'Y'                                       CFT009
     C                     ADD  CMSC02    INDUM8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 3                                      CFT009
      *                                                                   CFT009
     C           VAT11     IFEQ 'Y'                                       CFT009
     C                     ADD  CMSC03    INDUM8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 4                                      CFT009
      *                                                                   CFT009
     C           VAT12     IFEQ 'Y'                                       CFT009
     C                     ADD  CMSC04    INDUM8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous Charge 5                                      CFT009
      *                                                                   CFT009
     C           VAT13     IFEQ 'Y'                                       CFT009
     C                     ADD  CMSC05    INDUM8                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Calculate VAT on total charge, to avoid rounding errors.         CFT009
      *                                                                   CFT009
     C           INDUM8    MULT V#VATR    INDUM8                          CFT009
     C           INVATT    MULT V#VATR    INVATT                          CFT009
      *                                                                   CFT009
     C*                                                                   S01499
     C** Unwind subroutine stack name                                     S01499
     C*                                                                   S01499
     C           EXVATC    TAG                                            S01499
     C                     MOVEA*BLANKS   @STK,Q                          S01499
     C                     SUB  1         Q                               S01499
     C*                                                                   S01499
     CSR                   ENDSR                                          S01499
      /EJECT                                                              S01499
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Midas Message Net
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'VBCKRL'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      *  Key list for INPAYL*
      *
     C           KPREF     KLIST
     C                     KFLD           PREF
      *
     C                     MOVEL#1PREF    PREF
      *
      *  Chain to INPAYL1 to find information
      *
     C           KPREF     CHAIN@INPAYL1             90
     C/COPY WNCPYSRC,FT0355C010
      *
      * If not found error
      *
     C           *IN90     IFEQ '1'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2323' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * Not enquiry and record not live
      *
     C           RECI      IFNE 'D'
     C           #1ACTC    ANDNE'E'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2324' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * If Insert/Amend then level 1 details must be complete
      *
     C           RECI      IFEQ 'D'
     C           #1ACTC    ANDEQ'A'
     C           INLVL1    ANDNE'Y'
     C           RECI      OREQ 'D'
     C           #1ACTC    ANDEQ'I'
     C           INLVL1    ANDNE'Y'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2328' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * If Amend then level 2 details must be complete
      *
     C           RECI      IFEQ 'D'
     C           #1ACTC    ANDEQ'A'
     C           INLVL2    ANDNE'Y'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2325' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * If insert then level 2 details must be incomplete
      *
     C           RECI      IFEQ 'D'
     C           #1ACTC    ANDEQ'I'
     C           INLVL2    ANDEQ'Y'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2326' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     GOTO VBEXIT
     C                     END
      *
      * Record authorised
      *
     C           RECI      IFEQ 'D'
     C           #1ACTC    ANDEQ'A'
     C           AUIN      ANDEQ'Y'
     C           RECI      OREQ 'D'
     C           #1ACTC    ANDEQ'I'
     C           AUIN      ANDEQ'Y'
     C                     MOVELPREF      ZAMSDA
     C                     MOVEL'FTM2327' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
     C                     END
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           CFT009    OREQ 'Y'                                       CFT009
      *                                                                   CFT014
      ** Retrieve extension record of Incoming Payment.                   CFT014
      *                                                                   CFT014
     C           KPREF     CHAININPAYXL2             90                   CFT014
      *                                                                   CFT014
      ** Error if not found.                                              CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     Z-ADD038       W0ERNB                          CFT014
     C                     MOVELPREF      W0KEY                           CFT014
     C                     MOVEL'INPAYXL2'W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Error if record not live for Insert or Amend.                    CFT014
      *                                                                   CFT014
     C           #1ACTC    IFEQ 'I'                                       CFT014
     C           INRECI    ANDNE'D'                                       CFT014
     C           #1ACTC    OREQ 'A'                                       CFT014
     C           INRECI    ANDNE'D'                                       CFT014
     C                     Z-ADD039       W0ERNB                          CFT014
     C                     MOVELPREF      W0KEY                           CFT014
     C                     MOVEL'INPAYXL2'W0FILE                          CFT014
     C                     MOVEL'MEM5004' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           VBEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Midas Message Typ
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'VCCKRL'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           VCEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check branch SPF actions
      *================================================================
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'VDCKRL'  @STK,Q
      *
     C                     MOVEL*BLANK    W0RTN   7
      *
      * Set up parameters
      *
     C                     CLEARW0DATA
     C                     MOVELBRCA      B#BRCA
     C                     MOVEL#1ACTC    O#ACTD
     C                     MOVEL##PGM     O#CPGM
     C*                                                                   096486
     C**  Skip validation if FT0355 is triggered through A/C Movements.   096486
     C*                                                                   096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     GOTO VDEXIT                                    096486
     C                     ENDIF                                          096486
      *
      * Check all valid actions
      *
     C                     CALL 'ME1190'               9090
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM '*ACTCODE'W0ACT   8
     C                     PARM           W0DATA
      *
      * Option ended in error
      *
     C           *IN90     IFEQ '1'                        *IF
     C                     MOVEL'MIN0019' P0RTN
     C                     MOVEL'MIN0019' ZAMSID
     C                     MOVEL'MEMSG  ' ZAMSGF
     C                     EXSR ZASNMS
     C                     SETON                     993132*
     C                     GOTO VDEXIT
     C                     END                             *FI
      *
      * Invalid action
      *
     C           W0RTN     IFNE *BLANKS                    *IF
     C                     SETON                     993231*
     C                     GOTO VDEXIT
     C                     END                             *FI
      *
      * Set up parameters
      *
     C                     CLEARW0DATA
     C                     MOVELBRCA      B#BRCA
     C                     MOVEL#1ACTC    O#ACTD
     C                     MOVEL##PGM     O#CPGM
      *
      * Check all valid actions
      *
     C                     CALL 'ME1190'               9090
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM '*ORGN   'W0ACT   8
     C                     PARM           W0DATA
      *
      * Option ended in error
      *
     C           *IN90     IFEQ '1'                        *IF
     C                     MOVEL'MIN0019' P0RTN
     C                     MOVEL'MIN0019' ZAMSID
     C                     MOVEL'MEMSG  ' ZAMSGF
     C                     EXSR ZASNMS
     C                     SETON                     993132*
     C                     END                             *FI
      *
      * Invalid action
      *
     C           W0RTN     IFNE *BLANKS                    *IF
     C                     SETON                     993231*
     C                     END                             *FI
      *
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           VDEXIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * EDTRCD: Exit program - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Exit Program Processing
     C/COPY WNCPYSRC,FT0355DEPP
      *
     C                     MOVEL*BLANK    P0RTN
      *
      * CASE: CTL.*CMD key is CF07
      *
     C           *IN07     IFEQ '1'                        *IF
     C                     MOVEL'FTM2005' P0RTN            *Return code
     C                     END                             *FI
      *
      * CASE: CTL.*CMD key is CF03
      *
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     END                             *FI
      *
      * CASE: CTL.*CMD key is CF12
      *
     C           *IN12     IFEQ '1'                        *IF
     C                     MOVEL'USR0790' P0RTN            *Return code
     C                     END                             *FI
      *
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      *
      * ROLLBACK any uncommitted DBF changes
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK                       90
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      * Copy any undisplayed messages back to caller
      *
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Exit program
      *
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *
      *  Set up copyright parameter
      *
     C                     MOVEACPY@      BIS@   80
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'ZZINIT'  @STK,Q
      *
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      *
      * Initialise indicators for re-entry
      *
     C                     MOVE '0'       *IN
      *
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      *
      * Update screen time
      *
     C                     TIME           ##TME   60
      *
      * Obtain default message file
      *
     C                     MOVEL'FTUSRMSG'ZADFMF 10
      *
      * Open files first time only
      *
     C           W0OPN     IFEQ *BLANK
      *
      * Begin commit control
      *
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
     C                     OPEN INPAYL0
      *
      * Signal that files are now open
      *
     C                     MOVE 'Y'       W0OPN   1
     C                     END
      *
      * Change mode
      *
     C                     MOVEL'CHG'     W0PMD
     C                     MOVEL*BLANK    W0GRP   1
      *
      * USER: Initialise program
      * Retrieve Midas Date - R10 Standard Functions  *
      *
      * Get Rundate - Rundate  *
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    ##MRDT  7        Midas Run date
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
      *
      * Get modules information
      *
     C                     CALL 'AOMMODR0'             9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDMMOD    PARM *BLANKS   DSFDY            O:Module Flg
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOMMODR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD14        W0ERNB           * DB ERROR 14 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                   CAC001
      **  If Analytical Accounting is installed, enable F19 for           CAC001
      **  Margin Information.                                             CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE '1'       *IN61                           CAC001
     C                     ELSE                                           CAC001
     C                     MOVE '0'       *IN61                           CAC001
     C                     END                                            CAC001
      *
      * Get default branch
      *
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
      *
      *  Extract bank details
      *
     C                     CALL 'AOBANKR0'             9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDBANK    PARM SDBANK    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD15        W0ERNB           * DB ERROR 15 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C** Extract general ledger details from SDGELRPD
     C*
     C**********           CALL 'AOGELRR0'             9090                                   CGL029
     C                     CALL 'AOGELRR1'             9090                                   CGL029
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOGELRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD16        W0ERNB           * DB ERROR 16 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   P@RTCD  7                       S01494
     C                     PARM '*VERIFY' P@OPTN  7                       S01494
     C                     PARM 'S01494'  P@SARD  6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C                     MOVE 'N'       S01494  1                       S01494
     C                     MOVE '0'       *IN80                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set a variable field to          S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           P@RTCD    IFEQ *BLANKS                                   S01494
     C                     MOVE 'Y'       S01494                          S01494
     C                     MOVE '1'       *IN80                           S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           P@RTCD    IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'W0FILE                          S01494
     C                     MOVEL'*CALL'   W0KEY            ***************S01494
     C                     Z-ADD21        W0ERNB           * DB ERROR 21 *S01494
     C                     MOVEL'MEM5003' W0MSGD           ***************S01494
     C                     MOVEL'MIDAS  ' W0MSGF                          S01494
     C                     EXSR SRERR                                     S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   P@RTCD  7                       S01499
     C                     PARM '*VERIFY' P@OPTN  7                       S01499
     C                     PARM 'S01499'  P@SARD  6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C                     MOVE 'N'       S01499  1                       S01499
     C                     MOVE 'N'       V#VATP                          S01499
     C                     MOVE '0'       *IN82                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set a variable field to          S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           P@RTCD    IFEQ *BLANKS                                   S01499
     C                     MOVE 'Y'       S01499                          S01499
     C                     MOVE '1'       *IN82                           S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           P@RTCD    IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD22        W0ERNB           * DB ERROR 22 *S01499
     C                     MOVEL'MEM5003' W0MSGD           ***************S01499
     C                     MOVEL'MIDAS  ' W0MSGF                          S01499
     C                     EXSR SRERR                                     S01499
     C                     END                                            S01499
     C                     END                                            S01499
      *                                                                   CFT009
      ** Access SAR details file to determine if CFT009 is switched ON.   CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   P@RTCD                          CFT009
     C                     PARM '*VERIFY' P@OPTN                          CFT009
     C                     PARM 'CFT009'  P@SARD                          CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
      ** If core feature is switched ON, set a variable field to          CFT009
      ** condition the rest of the processing                             CFT009
      *                                                                   CFT009
     C           P@RTCD    IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     MOVE *ON       *IN62                           CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C                     MOVE 'N'       CFT009                          CFT009
     C                     MOVE *OFF      *IN62                           CFT009
      *                                                                   CFT009
     C           P@RTCD    IFNE '*NRF   '                                 CFT009
     C                     Z-ADD041       W0ERNB                          CFT009
     C                     MOVEL'CFT009'  W0KEY                           CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Access SAR details file to determine if CFT010 is switched ON.   CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   P@RTCD                          CFT009
     C                     PARM '*VERIFY' P@OPTN                          CFT009
     C                     PARM 'CFT010'  P@SARD                          CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
      ** If core feature is switched ON, set a variable field to          CFT009
      ** condition the rest of the processing                             CFT009
      *                                                                   CFT009
     C           P@RTCD    IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT010  1                       CFT009
     C                     MOVE *ON       *IN63                           CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C                     MOVE 'N'       CFT010                          CFT009
     C                     MOVE *OFF      *IN63                           CFT009
      *                                                                   CFT009
     C           P@RTCD    IFNE '*NRF   '                                 CFT009
     C                     Z-ADD042       W0ERNB                          CFT009
     C                     MOVEL'CFT010'  W0KEY                           CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Access SAR details file to determine if CER049 is switched ON                        CER049
      *                                                                                       CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   P@RTCD                                              CER049
     C                     PARM '*VERIFY' P@OPTN                                              CER049
     C                     PARM 'CER049'  P@SARD                                              CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
     C           P@RTCD    IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** else, database error (return code other than *NRF)                                   CER049
      *                                                                                       CER049
     C           P@RTCD    IFNE '*NRF   '                                                     CER049
     C                     MOVEL'SCSARDPD'W0FILE                                              CER049
     C                     MOVEL'*CALL'   W0KEY                                               CER049
     C                     Z-ADD76        W0ERNB                                              CER049
     C                     MOVEL'MEM5003' W0MSGD                                              CER049
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C*                                                                   S01499
     C** Read V.A.T. details if S01499 switched ON                        S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C           CFT009    ANDEQ'N'                                       CFT009
     C           CFT009    OREQ 'Y'                                       CFT009
     C           CFT010    ANDEQ'Y'                                       CFT009
     C*                                                                   S01499
     C                     CALL 'AOVATR0'              9090               S01499
     C                     PARM '*MSG   ' P@RTCD  7        B:Return code  S01499
     C                     PARM '*FIRST ' P@OPTN  7        I:Option       S01499
     C                     PARM           VATDS                           S01499
     C*                                                                   S01499
     C** If return with an error (LR seton in called program) then        S01499
     C** process for database error.                                      S01499
     C*                                                                   S01499
     C           *IN90     IFEQ '1'                                       S01499
     C           P@RTCD    OREQ '*ERROR*'                                 S01499
     C                     MOVEL'AOVATR0 'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD24        W0ERNB           * DB ERROR 24 *S01499
     C                     MOVEL'MEM5003' W0MSGD           ***************S01499
     C                     MOVEL'MIDAS  ' W0MSGF                          S01499
     C                     EXSR SRERR                                     S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Store V.A.T. rate.  Set ON a variable field to be used later     S01499
     C** in FT0358 for validation.                                        S01499
     C*                                                                   S01499
     C                     Z-ADDO#VATR    V#VATR                          S01499
     C                     MOVEL'Y'       V#VATP                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Access SAR details file to determine if S01506 is switched ON    S01506
     C*                                                                   S01506
     C                     CALL 'AOSARDR0'                                S01506
     C                     PARM *BLANKS   P@RTCD                          S01506
     C                     PARM '*VERIFY' P@OPTN                          S01506
     C                     PARM 'S01506'  P@SARD                          S01506
     C           SCSARD    PARM SCSARD    DSFDY                           S01506
     C                     MOVE 'N'       S01506  1                       S01506
     C*                                                                   S01506
     C** If core feature is switched ON, set a variable field to          S01506
     C** condition the rest of the processing                             S01506
     C*                                                                   S01506
     C           P@RTCD    IFEQ *BLANKS                                   S01506
     C                     MOVE 'Y'       S01506                          S01506
     C                     ELSE                                           S01506
     C*                                                                   S01506
     C** else, database error (return code other than *NRF)               S01506
     C*                                                                   S01506
     C           P@RTCD    IFNE '*NRF   '                                 S01506
     C                     MOVEL'SCSARDPD'W0FILE                          S01506
     C                     MOVEL'*CALL'   W0KEY            ************   S01506
     C                     Z-ADD30        W0ERNB           * DBERR 30 *   S01506
     C                     MOVEL'MEM5003' W0MSGD           ************   S01506
     C                     MOVEL'MIDAS  ' W0MSGF                          S01506
     C                     EXSR SRERR                                     S01506
     C                     END                                            S01506
     C                     END                                            S01506
     C*                                                                   S01508
     C** Access SAR details file to determine if S01508 is switched ON    S01508
     C*                                                                   S01508
     C                     CALL 'AOSARDR0'                                S01508
     C                     PARM *BLANKS   P@RTCD                          S01508
     C                     PARM '*VERIFY' P@OPTN                          S01508
     C                     PARM 'S01508'  P@SARD                          S01508
     C           SCSARD    PARM SCSARD    DSFDY                           S01508
     C                     MOVE 'N'       S01508  1                       S01508
     C*                                                                   S01508
     C** If core feature is switched ON, set a variable field to          S01508
     C** condition the rest of the processing                             S01508
     C*                                                                   S01508
     C           P@RTCD    IFEQ *BLANKS                                   S01508
     C                     MOVE 'Y'       S01508                          S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C** else, database error (return code other than *NRF)               S01508
     C*                                                                   S01508
     C           P@RTCD    IFNE '*NRF   '                                 S01508
     C                     MOVEL'SCSARDPD'W0FILE                          S01508
     C                     MOVEL'*CALL'   W0KEY            ************   S01508
     C                     Z-ADD31        W0ERNB           * DBERR 31 *   S01508
     C                     MOVEL'MEM5003' W0MSGD           ************   S01508
     C                     MOVEL'MIDAS  ' W0MSGF                          S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   CFT004
     C** Access SAR details file to determine if CFT004 is switched ON    CFT004
     C*                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   P@RTCD                          CFT004
     C                     PARM '*VERIFY' P@OPTN                          CFT004
     C                     PARM 'CFT004'  P@SARD                          CFT004
     C           SCSARD    PARM SCSARD    DSFDY                           CFT004
     C                     MOVE 'N'       CFT004  1                       CFT004
     C*                                                                   CFT004
     C** If core feature is switched ON, set a variable field to          CFT004
     C** condition the rest of the processing                             CFT004
     C*                                                                   CFT004
     C           P@RTCD    IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004                          CFT004
     C                     ELSE                                           CFT004
     C*                                                                   CFT004
     C** else, database error (return code other than *NRF)               CFT004
     C*                                                                   CFT004
     C           P@RTCD    IFNE '*NRF   '                                 CFT004
     C                     MOVEL'SCSARDPD'W0FILE                          CFT004
     C                     MOVEL'*CALL'   W0KEY            ************   CFT004
     C                     Z-ADD32        W0ERNB           * DBERR 32 *   CFT004
     C                     MOVEL'MEM5003' W0MSGD           ************   CFT004
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT004
     C                     EXSR SRERR                                     CFT004
     C                     END                                            CFT004
     C                     END                                            CFT004
     C/COPY WNCPYSRC,FT0355C022
      *                                                                   CFT007
      *  Access SAR details file to see if CFT007 is installed.           CFT007
      *                                                                   CFT007
     C                     CALL 'AOSARDR0'                                CFT007
     C                     PARM *BLANKS   P@RTCD  7                       CFT007
     C                     PARM '*VERIFY' P@OPTN  7                       CFT007
     C                     PARM 'CFT007'  @SARD   6                       CFT007
     C           SCSARD    PARM *BLANKS   DSFDY                           CFT007
      *                                                                   CFT007
      *  Allow BIC Database Plus Integration                              CFT007
      *                                                                   CFT007
     C           P@RTCD    IFEQ *BLANKS                                   CFT007
     C                     MOVEL'CFT007'  CFT007  6                       CFT007
     C                     MOVE *ON       *IN85                           CFT007
     C                     ENDIF                                          CFT007
      *                                                                                       CFT050
      ** Access SAR file to determine if CFT050 (SWIFTRef Directories                         CFT050
      ** upload) is installed.                                                                CFT050
      *                                                                                       CFT050
     C                     CALL 'AOSARDR0'                                                    CFT050
     C                     PARM *BLANKS   PRTCD   7                                           CFT050
     C                     PARM '*VERIFY' POPTN   7                                           CFT050
     C                     PARM 'CFT050'  PSARD   6                                           CFT050
      *                                                                                       CFT050
      ** CFT007 process will take place when CFT050 is switched on                            CFT050
      *                                                                                       CFT050
     C           PRTCD     IFEQ *BLANKS                                                       CFT050
     C                     MOVEL'CFT007'  CFT007                                              CFT050
     C                     MOVE *ON       *IN85                                               CFT050
     C                     ENDIF                                                              CFT050
      *                                                                   CFT007
      ** Access SAR details file to determine if CFT014 is switched ON.   CFT014
      *                                                                   CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*VERIFY' P@OPTN                          CFT014
     C                     PARM 'CFT014'  P@SARD                          CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
      ** If core feature is switched ON, set a variable field to          CFT014
      ** condition the rest of the processing                             CFT014
      *                                                                   CFT014
     C           P@RTCD    IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014  1                       CFT014
     C                     MOVE *ON       *IN83                           CFT014
     C*****                OPEN INPAYXL0                            CFT014CFT009
     C*****                OPEN INPAYXL2                            CFT014CFT009
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE '*NRF   '                                 CFT014
     C                     Z-ADD040       W0ERNB                          CFT014
     C                     MOVEL'CFT014'  W0KEY                           CFT014
     C                     MOVEL'SCSARDPD'W0FILE                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CAP205
      *  Determine if SAR CAP205 is installed                                                 CAP205
      *                                                                                       CAP205
     C                     MOVEL'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   P@RTCD                                              CAP205
     C                     PARM '*VERIFY' P@OPTN                                              CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM *BLANKS   DSFDY                                               CAP205
      *                                                                                       CAP205
     C           P@RTCD    IFNE *BLANKS                                                       CAP205
     C           P@RTCD    ANDNE'*NRF   '                                                     CAP205
     C                     Z-ADD026       W0ERNB                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'MEM5003' W0MSGD                                              CAP205
     C                     MOVEL'MIDAS  ' W0MSGF                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C           P@RTCD    IFEQ *BLANKS                                                       CAP205
     C                     MOVEL'Y'       CAP205                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       219241
      ** If CFT014 is installed, read SDMGMEPD                                                219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
      *                                                                                       219241
     C                     CALL 'AOMGMER1'                                                    219241
     C                     PARM *BLANKS   P@RTCD                                              219241
     C                     PARM '*FIRST'  P@OPTN                                              219241
     C           SDMGME    PARM SDMGME    DSSDY                                               219241
      *                                                                                       219241
     C           P@RTCD    IFNE *BLANKS                                                       219241
     C                     MOVEL'SDMGMEPD'W0FILE                                              219241
     C                     MOVELP@OPTN    W0KEY                                               219241
     C                     Z-ADD43        W0ERNB                                              219241
     C                     MOVEL'MEM5003' W0MSGD                                              219241
     C                     MOVEL'MIDAS  ' W0MSGF                                              219241
     C                     EXSR SRERR                                                         219241
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           CFT014    OREQ 'Y'                                       CFT009
     C                     OPEN INPAYXL0                                  CFT009
     C                     OPEN INPAYXL2                                  CFT009
     C                     ENDIF                                          CFT009
      *
      ** Read SDFTFRPD
      *
     C                     CALL 'AOFTFRR0'             90
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDFTFR    PARM SDFTFR    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOFTFRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD17        W0ERNB           * DB ERROR 17 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE BTCHCY    V#CHCY                          CFT014
      *
      * Get data -branch indicator
      *
     C           BGRTBN    IFEQ 'Y'                        Full Retail
     C           BGIOAC    OREQ 'Y'                        Interest on Accounts
      *
      ** Read SDRETLPD for retail account nos. indicator
      *
     C                     CALL 'AORETLR0'             90
     C                     PARM *BLANKS   P@RTCD
     C                     PARM '*FIRST'  P@OPTN
     C           SDRETL    PARM SDRETL    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AORETLR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD18        W0ERNB           * DB ERROR 18 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     END
      *
      ** Read SDTRADPD for sterling currency code
      *
     C                     CALL 'AOTRADR0'             90
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOTRADR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD19        W0ERNB           * DB ERROR 19 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Access FT Control data
      *
     C                     CALL 'FT0005'               9090
     C                     PARM *BLANKS   P@RTCD
     C           T#CNTL    PARM           DSFDY
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'FT0005  'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD20        W0ERNB           * DB ERROR 20 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      * Set up FT override for General Ledger Balances
      *
     C           T#GLUI    IFEQ 'I'
     C                     MOVEL'Y'       ##FTOV  1
     C                     ELSE
     C                     MOVEL*BLANKS   ##FTOV
     C                     END
     C*                                                                   S01499
     C** Set up apply V.A.T. flag default value                           S01499
     C*                                                                   S01499
     C           S01499    IFEQ 'Y'                                       S01499
     C                     MOVELT#VATT    V#VATT                          S01499
     C                     END                                            S01499
      *
      * Calculate Back Value Date and set other V# values
      *
     C           BJRDNB    SUB  BJBVPD    V#BVLD
     C                     MOVELBKOBUV    V#OBUV
     C                     MOVELBJSBRC    V#SBRC
     C                     MOVELBJSLCD    V#SLCD
     C                     MOVELBMRANR    V#RANR
     C                     MOVELBJCYCD    V#BCCY
     C                     MOVELBJLCCY    V#LCCY
     C                     MOVELBKPRCU    V#PRCU
     C                     MOVELBKPCDU    V#PCDU
     C                     MOVELBLCYCD    V#GBP
     C                     MOVELBTPCRD    V#PCRD
      *
      * Obtain Midas run date in user format
      *
     C                     CALL 'ZDATE2'               9090Entry parameter
     C                     PARM WURDNB    ZDAYNO  50       Value date
     C                     PARM WUDFF     ZDATFM  1        Date format ind
     C                     PARM           ZDATE   60       Value date
     C                     PARM           ZADATE  7        Run-date in DDM
      *
     C                     MOVELZDATE     V#MRDT
      *
      * Set up payment reference r
      *
     C                     MOVEL*BLANKS   W#YMD   6
     C           WUDFF     IFEQ 'M'
     C                     MOVELZDATE     SWDT1   6
     C           2         SUBSTSWDT1:5   MM
     C           2         SUBSTSWDT1:3   YY
     C           2         SUBSTSWDT1:1   DD
     C                     MOVELSWDT2     W#YMD
     C                     ELSE
      *
      * DDMMYY format display
      *
     C                     MOVELZDATE     SWDT1
     C           2         SUBSTSWDT1:5   YY
     C           2         SUBSTSWDT1:3   MM
     C           2         SUBSTSWDT1:1   DD
     C                     MOVELSWDT2     W#YMD
     C                     END
      *
      * Set multi-branch indicator
      *
     C           WUMBIN    IFNE 'Y'                        Multi Branched ?
     C                     MOVEL'0'       *IN78
     C                     ELSE
     C                     MOVEL'1'       *IN78
     C                     END
      *
      ** If originating branch used flag = 'Y'
      *
     C           BKOBRU    IFEQ 'Y'
     C                     SETON                     78
     C                     END
      *
      * Reset global error indicator and clear error codes
      *
     C                     MOVEA*BLANKS   ERCD
     C                     Z-ADD0         X       50
     C                     SETON                     81
      * EDTRCD: Initialise prog - R10 Copy source templates  *
     C*EDTRCD: Cpysrc Templates Initialise Subroutine
     C/COPY WNCPYSRC,FT0355INIT
      *================================================================
      *
      *  Unwind subroutine stack name
      *
     C           EXINIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
     C/EJECT
     C*EDTRCD: Cpysrc Templates Initialise Program C-spec
     C/COPY WNCPYSRC,FT0355DCPG
     C/EJECT
      *================================================================   CAC001
      *                                                               *   CAC001
      *  SRMGIN  -  Control Window Processing for Margin Information  *   CAC001
      *                                                               *   CAC001
      *  Called By:  CADSDA - Display and Process key screen          *   CAC001
      *              CFPRSC - Validate record                         *   CAC001
      *                                                               *   CAC001
      *  Calls    :  ZASNMS - Send message to program's message queue *   CAC001
      *              ZYEXPG - Cancel and exit from key screen         *   CAC001
      *                                                               *   CAC001
      *================================================================   CAC001
     CSR         SRMGIN    BEGSR                                          CAC001
      *                                                                   CAC001
      *  Set up subroutine stack name                                     CAC001
      *                                                                   CAC001
     C                     ADD  1         Q                               CAC001
     C                     MOVEL'SRMGIN'  @STK,Q                          CAC001
      *                                                                   CAC001
      **  Check if window processing required.                            CAC001
      *                                                                   CAC001
     C           BGWDPR    IFEQ 'Y'                        B001           CAC001
      *                                                                   CAC001
      **  Check if Analytical Accounting installed.                       CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                        B002           CAC001
      *                                                                   CAC001
      **  Disallow F19 if pay and settle currencies are the same and      CAC001
      **  margin info details are blanks.                                 CAC001
      *                                                                   CAC001
     C           #1ACTC    IFEQ 'I'                        B003           CAC001
     C           #1ACTC    OREQ 'A'                                       CAC001
      *                                                                   CAC001
     C           WFRCI     IFEQ 'N'                        B004           CAC001
     C           PCCY      ANDEQSMCY                                      CAC001
     C           WOMBSI    ANDEQ*BLANKS                                   CAC001
     C           WOMSIG    ANDEQ*BLANKS                                   CAC001
     C                     MOVEL'FTM2554' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     99    *              CAC001
     C                     GOTO SMEXIT                                    CAC001
     C                     ENDIF                           E004           CAC001
     C                     ENDIF                           E003           CAC001
      *                                                                   CAC001
      **  Call MARGIN INFORMATION WINDOW:                                 CAC001
      **  If F19 pressed and DB and CR currencies are different...        CAC001
      **  Or F19 pressed and DB and CR currencies the same                CAC001
      **           and margin info are not blanks...                      CAC001
      **  Or Force ind. 'Y' (ENTER is pressed and margin info are not     CAC001
      **           blanks...                                              CAC001
      **  Or Action code is 'E' for Enquiry...                            CAC001
      *                                                                   CAC001
     C           WFRCI     IFEQ 'N'                        B003           CAC001
     C           PCCY      ANDNESMCY                                      CAC001
      *                                                                   CAC001
     C           WFRCI     OREQ 'N'                                       CAC001
     C           PCCY      ANDEQSMCY                                      CAC001
     C           WOMBSI    ANDNE*BLANKS                                   CAC001
     C           WOMSIG    ANDNE*BLANKS                                   CAC001
      *                                                                   CAC001
     C           #1ACTC    OREQ 'E'                                       CAC001
      *                                                                   CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE #1ACTC    ACTION                          CAC001
     C                     MOVE #1ACTC    WACTN                           CAC001
     C                     Z-ADDRATE      WRATE                           CAC001
     C                     MOVE 'S'       WPSIN                           CAC001
     C                     MOVE PCCY      WPCCY                           CAC001
     C                     MOVE SMCY      WSMCY                           CAC001
     C                     Z-ADDPYAM      WPYAM                           CAC001
     C                     Z-ADDSMAM      WSMAM                           CAC001
     C                     Z-ADDMDIN      WMDIN                           CAC001
     C                     Z-ADDWOFXMP    WFXMP                           CAC001
     C                     Z-ADDWOFXMD    WFXMD                           CAC001
     C                     MOVE WOMBSI    WMBSI                           CAC001
     C                     MOVE WOMSIG    WMSIG                           CAC001
     C                     Z-ADDWOMAMT    WMAMT                           CAC001
      *                                                                   CAC001
      ** If record id is not 'D', change value of action parameter        CAC001
      ** sent as 'E' as no changes are allowed for matured/authorised     CAC001
      ** deals.                                                           CAC001
      *                                                                   CAC001
     C           #1ACTC    IFEQ 'A'                                       CAC001
     C           RECI      ANDNE'D'                        B004           CAC001
     C                     MOVE 'E'       ACTION                          CAC001
     C                     ENDIF                           E004           CAC001
      *                                                                   CFT009
      ** Chain to payment charge defintion file to get miscellaneous cd   CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           ##SCR     ANDEQ'SCR3'                                    CFT009
     C           M1CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M1DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,1    M1DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M2CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M2DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,2    M2DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M3CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M3DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,3    M3DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M4CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M4DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,4    M4DESC                          CFT009
     C                     ENDIF                                          CFT009
     C           M5CDE     CHAINFTPCHGL0             90                   CFT009
     C           *IN90     IFEQ '0'                                       CFT009
     C                     MOVELCHDESC    M5DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELDESC,5    M5DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CAC001
      **  Write record format and message control so screen will          CAC001
      **  not blank out when option '?' is used                           CAC001
      *                                                                   CAC001
     C                     SETON                         86*              CAC001
     C                     WRITE#MSGCTL                                   CAC001
     C***********          WRITE#CMDTXT3                           CAC001 CFT014
     C***********          WRITE#RCDDTL2                           CAC001 CFT014
     C                     WRITE#CMDTXT4                                  CFT014
     C                     WRITE#RCDDTL3                                  CFT014
     C/COPY WNCPYSRC,FT0355C038
      *                                                                   CAC001
      **  Call window manager WN0010                                      CAC001
      *                                                                   CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'FT0345'  #PGM   10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM           ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           EXTRA 256                       CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C                     SELEC                           B004           CAC001
      *                                                                   CAC001
      * *Return code is *User QUIT requested                              CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'Y2U9999'                                 CAC001
     C                     MOVEL'Y2U9999' P0RTN                           CAC001
     C                     MOVEL'Y2U9999' ZAMSID                          CAC001
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     EXSR ZYEXPG                                    CAC001
      *                                                                   CAC001
      * *Return code is WN Window Error                                   CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0563'                                 CAC001
     C                     MOVEL'USR0563' ZAMSID                          CAC001
     C                     MOVEL'SDUSRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *DBF update error                                 CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0567'                                 CAC001
     C                     MOVEL'USR0567' ZAMSID                          CAC001
     C                     MOVEL'SDUSRMSG'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *Previous Screen                                  CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ 'USR0790'                                 CAC001
     C                     MOVEL'USR0790' ZAMSID                          CAC001
     C                     MOVEL'WNMSGF  'ZAMSGF                          CAC001
     C                     EXSR ZASNMS                                    CAC001
      *                                                                   CAC001
      * *Return code is *Blanks. Update margin info fields with           CAC001
      * new values from window program.                                   CAC001
      *                                                                   CAC001
     C           #RTRN     WHEQ *BLANKS                                   CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C                     Z-ADDWFXMP     WOFXMP                          CAC001
     C                     Z-ADDWFXMD     WOFXMD                          CAC001
     C                     MOVE WMBSI     WOMBSI                          CAC001
     C                     MOVE WMSIG     WOMSIG                          CAC001
     C                     Z-ADDWMAMT     WOMAMT                          CAC001
      *                                                                   CAC001
     C           P4PARM    IFNE '*BLANKS'                                 CAC001
     C                     Z-ADDWFXMP     P4FXMP                          CAC001
     C                     Z-ADDWFXMD     P4FXMD                          CAC001
     C                     MOVE WMBSI     P4MBSI                          CAC001
     C                     MOVE WMSIG     P4MSIG                          CAC001
     C                     Z-ADDWMAMT     P4MAMT                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDSL                           E004           CAC001
      *                                                                   CAC001
     C                     ENDIF                           E003           CAC001
     C                     ENDIF                           E002           CAC001
     C                     ENDIF                           E001           CAC001
      *================================================================   CAC001
      *                                                                   CAC001
      *  Unwind subroutine stack name                                     CAC001
      *                                                                   CAC001
     C           SMEXIT    TAG                                            CAC001
     C                     MOVEA*BLANKS   @STK,Q                          CAC001
     C                     SUB  1         Q                               CAC001
      *                                                                   CAC001
     C                     ENDSR                                          CAC001
     C/EJECT                                                              CAC001
     C*================================================================   CFT007
      *                                                               *   CFT007
      *  SRBICP  -  BIC Database Plus Integration                     *   CFT007
      *                                                               *   CFT007
      *  Called By:  CADSDA - Display and Process key screen          *   CFT007
      *                                                               *   CFT007
      *  Calls    :  ZASNMS - Send message to program's message queue *   CFT007
      *================================================================   CFT007
     CSR         SRBICP    BEGSR                                          CFT007
      *                                                                   CFT007
      *  Set up subroutine stack name                                     CFT007
      *                                                                   CFT007
     C                     ADD  1         Q                               CFT007
     C                     MOVEL'SRBICP'  @STK,Q                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
      *                                                                   CFT007
      * Determine whether cursor is on an allowed field                   CFT007
      *                                                                   CFT007
     C                     Z-ADD@#RWCL    WKSCPS  50                      CFT007
      *                                                                   CFT007
      * Note: If these screen fields move then these values will          CFT007
      *       need changing.                                              CFT007
      *                                                                   CFT007
      *       The value is cursor row number * 256 + column number        CFT007
      *                                                                   CFT007
      * Ordering institution line 1                                       CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1OI  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE1325                                      CFT007
     C           WKSCPS    ANDLE1359                                      CFT007
     C                     MOVE *ON       LIN1OI                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Ordering institution line 2                                       CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2OI  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE1538                                      CFT007
     C           WKSCPS    ANDLE1572                                      CFT007
     C                     MOVE *ON       LIN2OI                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Sender's correspondent line 1                                     CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1SC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE2349                                      CFT007
     C           WKSCPS    ANDLE2383                                      CFT007
     C                     MOVE *ON       LIN1SC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Sender's correspondent line 2                                     CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2SC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE2562                                      CFT007
     C           WKSCPS    ANDLE2596                                      CFT007
     C                     MOVE *ON       LIN2SC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Ordering Customer line 1                                          CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1OC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE3373                                      CFT007
     C           WKSCPS    ANDLE3407                                      CFT007
     C                     MOVE *ON       LIN1OC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Ordering Customer line 2                                          CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN2OC  1                       CFT007
     C           ##SCR     IFEQ 'SCR1'                                    CFT007
     C           WKSCPS    ANDGE3586                                      CFT007
     C           WKSCPS    ANDLE3620                                      CFT007
     C                     MOVE *ON       LIN2OC                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Intermediary institution line 1                                   CFT007
      *                                                                   CFT007
     C                     MOVE *OFF      LIN1II  1                       CFT007
     C           ##SCR     IFEQ 'SCR2'                                    CFT007
     C***********WKSCPS    ANDGE1069                               CFT007 CFT014
     C***********WKSCPS    ANDLE1103                               CFT007 CFT014
     C           WKSCPS    ANDGE1325                                      CFT014
     C           WKSCPS    ANDLE1359                                      CFT014
     C                     MOVE *ON       LIN1II                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C* Intermediary institution line 2                                   CFT007
     C*                                                                   CFT007
     C                     MOVE *OFF      LIN2II  1                       CFT007
     C           ##SCR     IFEQ 'SCR2'                                    CFT007
     C***********WKSCPS    ANDGE1282                               CFT007 CFT014
     C***********WKSCPS    ANDLE1316                               CFT007 CFT014
     C           WKSCPS    ANDGE1538                                      CFT014
     C           WKSCPS    ANDLE1572                                      CFT014
     C                     MOVE *ON       LIN2II                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C* If cursor is not on an allowed field, error                       CFT007
     C*                                                                   CFT007
     C           LIN1OI    IFNE *ON                                       CFT007
     C           LIN2OI    ANDNE*ON                                       CFT007
     C           LIN1SC    ANDNE*ON                                       CFT007
     C           LIN2SC    ANDNE*ON                                       CFT007
     C           LIN1OC    ANDNE*ON                                       CFT007
     C           LIN2OC    ANDNE*ON                                       CFT007
     C           LIN1II    ANDNE*ON                                       CFT007
     C           LIN2II    ANDNE*ON                                       CFT007
      *                                                                   CFT007
      * Error message:                                                    CFT007
     C                     MOVEL'FTM2613' ZAMSID                          CFT007
     C                     EXSR ZASNMS                                    CFT007
      *                                                                   CFT007
     C                     ELSE                                           CFT007
      * F4 and F16 are not allowed in Enquiry (and delete) mode           CFT007
     C           #1ACTC    IFEQ 'E'                                       CFT007
      * Error message:                                                    CFT007
     C                     MOVEL'FTM2619' ZAMSID                          CFT007
     C                     EXSR ZASNMS                                    CFT007
      *                                                                   CFT007
     C                     ELSE                                           CFT007
      * check indicators                                                  CFT007
      *                                                                   CFT007
      * In-line prompt or search mode, capture criteria from screen       CFT007
      *                                                                   CFT007
     C           *IN08     IFEQ *ON                                       CFT007
     C           *IN13     OREQ *ON                                       CFT007
      *                                                                   CFT007
     C           LIN1OI    IFEQ *ON                                       CFT007
     C                     MOVE #1OBK1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2OI    IFEQ *ON                                       CFT007
     C                     MOVE #1OBK2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1SC    IFEQ *ON                                       CFT007
     C                     MOVE #1SNC1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2SC    IFEQ *ON                                       CFT007
     C                     MOVE #1SNC2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1OC    IFEQ *ON                                       CFT007
     C                     MOVE #1ORC1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2OC    IFEQ *ON                                       CFT007
     C                     MOVE #1ORC2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN1II    IFEQ *ON                                       CFT007
     C                     MOVE #2INB1    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C           LIN2II    IFEQ *ON                                       CFT007
     C                     MOVE #2INB2    @ICRIT                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C* In-line prompt mode                                               CFT007
     C*                                                                   CFT007
     C           *IN08     IFEQ *ON                                       CFT007
     C                     MOVE 'P'       @IMODE                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C* In-line search mode                                               CFT007
     C*                                                                   CFT007
     C           *IN13     IFEQ *ON                                       CFT007
     C                     MOVE 'F'       @IMODE                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C* Call BIC Plus enquiry program                                     CFT007
     C*                                                                   CFT007
     C                     CALL 'FT0900'                                  CFT007
     C                     PARM           @IMODE  1                       CFT007
     C                     PARM           @ICRIT 35                       CFT007
     C                     PARM *BLANKS   @OADD 175                       CFT007
     C                     PARM *BLANKS   @OCHIP 10                       CFT007
     C                     PARM *BLANKS   @OUTCD  2                       CFT007
     C                     PARM *BLANKS   @RTCD   7                       CFT007
     C                     MOVEL*BLANKS   @ICRIT                          CFT007
      *                                                                   CFT007
      *  F3 pressed - exit program                                        CFT007
      *                                                                   CFT007
     C           @RTCD     IFEQ 'F3'                                      CFT007
     C                     MOVE *ON       *IN03                           CFT007
     C                     END                                            CFT007
      *                                                                   CFT007
     C           @RTCD     IFEQ *BLANKS                                   CFT007
      *                                                                   CFT007
      * If a CHIPS code exists and relevant currency is USD, replace      CFT007
      * clearing code with CHIPS code                                     CFT007
      *                                                                   CFT007
     C           @OCHIP    IFNE *BLANKS                                   CFT007
     C           @OUTCD    ANDNE'AC'                                      CFT007
      *                                                                   CFT007
      * Check payment currency against SDTRAD US dollar code              CFT007
      *                                                                   CFT007
     C           SMCY      IFEQ BLUSCY                                    CFT007
     C           LIN1OI    ANDEQ*ON                                       CFT007
     C           SMCY      OREQ BLUSCY                                    CFT007
     C           LIN1SC    ANDEQ*ON                                       CFT007
     C           SMCY      OREQ BLUSCY                                    CFT007
     C           LIN1OC    ANDEQ*ON                                       CFT007
     C           PCCY      OREQ BLUSCY                                    CFT007
     C           LIN1II    ANDEQ*ON                                       CFT007
      *                                                                   CFT007
      * If clearing code is not present, move details down to             CFT007
      * create space for CHIPS code                                       CFT007
      *                                                                   CFT007
     C           @OUTCD    IFNE 'BC'                                      CFT007
     C           @OUTCD    ANDNE'DC'                                      CFT007
     C                     MOVE @OADD     WKADD1210                       CFT007
     C                     MOVELWKADD1    @OADD                           CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C                     MOVEL*BLANKS   WKCOCH 14                       CFT007
     C                     MOVEL'//CH'    WKCOCH                          CFT007
     C                     MOVE @OCHIP    WKCOCH                          CFT007
     C                     MOVELWKCOCH    OADD1                           CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
      * If command key pressed on 2nd line, remove clearing               CFT007
      * code from details                                                 CFT007
     C*                                                                   CFT007
     C           LIN2OI    IFEQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'BC'                                      CFT007
     C           LIN2OI    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'DC'                                      CFT007
     C           LIN2SC    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'BC'                                      CFT007
     C           LIN2SC    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'DC'                                      CFT007
     C           LIN2OC    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'BC'                                      CFT007
     C           LIN2OC    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'DC'                                      CFT007
     C           LIN2II    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'BC'                                      CFT007
     C           LIN2II    OREQ *ON                                       CFT007
     C           @OUTCD    ANDEQ'DC'                                      CFT007
     C           @OUTCD    OREQ 'AC'                                      CFT007
     C                     MOVE @OADD     WKADD2140                       CFT007
     C                     MOVE *BLANKS   @OADD                           CFT007
     C                     MOVELWKADD2    @OADD                           CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
      * Move details to screen                                            CFT007
      *                                                                   CFT007
     C           LIN1OI    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1OBK1                          CFT007
     C                     MOVELOADD2     #1OBK2                          CFT007
     C                     MOVELOADD3     #1OBK3                          CFT007
     C                     MOVELOADD4     #1OBK4                          CFT007
     C                     MOVELOADD5     #1OBK5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN1SC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1SNC1                          CFT007
     C                     MOVELOADD2     #1SNC2                          CFT007
     C                     MOVELOADD3     #1SNC3                          CFT007
     C                     MOVELOADD4     #1SNC4                          CFT007
     C                     MOVELOADD5     #1SNC5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN1OC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1ORC1                          CFT007
     C                     MOVELOADD2     #1ORC2                          CFT007
     C                     MOVELOADD3     #1ORC3                          CFT007
     C                     MOVELOADD4     #1ORC4                          CFT007
     C***********          MOVELOADD5     #1ORC5                   CFT007 CFT014
     C                     MOVELOADD5     #1ORC5                                              CFT032
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN1II    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #2INB1                          CFT007
     C                     MOVELOADD2     #2INB2                          CFT007
     C                     MOVELOADD3     #2INB3                          CFT007
     C                     MOVELOADD4     #2INB4                          CFT007
     C                     MOVELOADD5     #2INB5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2OI    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1OBK2                          CFT007
     C                     MOVELOADD2     #1OBK3                          CFT007
     C                     MOVELOADD3     #1OBK4                          CFT007
     C                     MOVELOADD4     #1OBK5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2SC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1SNC2                          CFT007
     C                     MOVELOADD2     #1SNC3                          CFT007
     C                     MOVELOADD3     #1SNC4                          CFT007
     C                     MOVELOADD4     #1SNC5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2OC    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #1ORC2                          CFT007
     C                     MOVELOADD2     #1ORC3                          CFT007
     C                     MOVELOADD3     #1ORC4                          CFT007
     C***********          MOVELOADD4     #1ORC5                   CFT007 CFT014
     C                     MOVELOADD4     #1ORC5                                              CFT032
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C           LIN2II    IFEQ *ON                                       CFT007
     C                     MOVELOADD1     #2INB2                          CFT007
     C                     MOVELOADD2     #2INB3                          CFT007
     C                     MOVELOADD3     #2INB4                          CFT007
     C                     MOVELOADD4     #2INB5                          CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
     C*                                                                   CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
      *                                                                   CFT007
      *  Unwind subroutine stack name                                     CFT007
      *                                                                   CFT007
     C                     MOVEA*BLANKS   @STK,Q                          CFT007
     C                     SUB  1         Q                               CFT007
      *                                                                   CFT007
     C                     ENDSR                                          CFT007
      *                                                                   CFT007
      *================================================================   CFT007
     C/EJECT                                                              CFT007
      *================================================================
      *                                                               *
      *  SRWIND   : Control Window Processing                         *
      *                                                               *
      *================================================================
     CSR         SRWIND    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRWIND'  @STK,Q
      *
      * If window processing call WN0010
      *
     C           BGWDPR    IFEQ 'Y'
      *
      *    /copy to move data into the data structure fields passed
      *     as a parameter to the window controller
      *
      /COPY WNCPYSRC,FT0355MOV1
     C                     SELEC
     C           #1ACTC    WHEQ 'I'
      *
      *     Insert Processing
      *
      /COPY WNCPYSRC,FT0355MOV2
     C           #1ACTC    WHEQ 'A'
      *
      *     Amend Processing
      *
      /COPY WNCPYSRC,FT0355MOV3
     C           #1ACTC    WHEQ 'D'
      *
      *     Delete Processing
      *
      /COPY WNCPYSRC,FT0355MOV4
     C           #1ACTC    WHEQ 'E'
      *
      *     Enquire Processing
      *
      /COPY WNCPYSRC,FT0355MOV5
     C                     ENDSL
      *
     C                     CALL 'WN0010'
     C                     PARM ##PGM     O#PGM  10
     C                     PARM *BLANKS   O#CMD   2
     C                     PARM #1ACTC    O#ACTN  1
     C                     PARM           DATA
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM           EXTRA 256
      *
      *   /copy to move data back from the data structure fields passed
      *    as a parameter to the window controller and control user
      *    defined processing.
      *
      /COPY WNCPYSRC,FT0355MOV6
      *
     C           *LIKE     DEFN O#RTN     R#RTN
     C           R#RTN     CABEQ*BLANKS   EXWIND
      *
      *  Check return code and send message on action
      *  - set no update as some action has been specified.
      *
     C                     MOVEL'Y'       W0DCF
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
     C                     SELEC
      *
      * *Return code is *User QUIT requested
      *
     C           R#RTN     WHEQ 'Y2U9999'
     C                     MOVEL'Y2U9999' P0RTN
     C                     MOVEL'Y2U9999' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     EXSR ZYEXPG
      *
      * *Return code is WN Window Error
      *
     C           R#RTN     WHEQ 'USR0563'
     C                     MOVEL'USR0563' ZAMSID
     C                     MOVEL'SDUSRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * *Return code is *DBF update error
      *
     C           R#RTN     WHEQ 'USR0567'
     C                     MOVEL'USR0567' ZAMSID
     C                     MOVEL'SDUSRMSG'ZAMSGF
     C                     EXSR ZASNMS
      *
      * *Return code is *Previous Screen
      *
     C           R#RTN     WHEQ 'USR0790'
     C                     MOVEL'MIN0001' ZAMSID
     C                     MOVEL'MEMSG   'ZAMSGF
     C                     EXSR ZASNMS
     C                     ENDSL
      *
     C                     END
      *
      *  Unwind subroutine stack name
      *
     C           EXWIND    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      *================================================================
      /EJECT                                                              CFT014
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  SRCURR   : Access currency details                           *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: SRISC3                                            *   CFT014
      *             MFIZ#D                                            *   CFT014
      *                                                               *   CFT014
      *  CALLS    : AOCURRR0                                          *   CFT014
      *             SRERR                                             *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     C           SRCURR    BEGSR                                          CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'SRCURR'  @STK,Q                          CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM *BLANKS   P@RTCD                          CFT014
     C                     PARM '*KEY   ' P@OPTN                          CFT014
     C                     PARM           P@CCY   3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           P@RTCD    IFNE *BLANKS                                   CFT014
     C                     Z-ADD041       W0ERNB                          CFT014
     C                     MOVELP@CCY     W0KEY                           CFT014
     C                     MOVEL'SDCURRPD'W0FILE                          CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C           EXCURR    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      /EJECT                                                              CFT014
      *================================================================   CFT014
      *                                                               *   CFT014
      *  FIRCCG  -  Fill receiver's charges                           *   CFT014
      *                                                               *   CFT014
      *================================================================   CFT014
     C           FIRCCG    BEGSR                                          CFT014
      *                                                                   CFT014
      ** Set up subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C                     ADD  1         Q                               CFT014
     C                     MOVEL'FIRCCG'  @STK,Q                          CFT014
      *                                                                   CFT014
      ** Don't need to convert charges amount if ccy of :71G: is the      CFT014
      ** same as settlement currency                                      CFT014
     C           INRCCN    IFEQ SMCY                                      CFT014
     C                     Z-ADDINRCNW    INRCRM                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Calculate receiver's charges network in settlement currency      CFT014
     C                     CLEARP#0010                                    CFT014
     C                     Z-ADDSLDT      P#FRDT                          CFT014
     C                     Z-ADDSLDT      P#TODT                          CFT014
     C                     MOVELINRCCN    P#FRCY                          CFT014
     C                     Z-ADDINRCNW    P#FRAM                          CFT014
     C                     MOVELSMCY      P#TOCY                          CFT014
     C                     Z-ADD0         P#TOAM                          CFT014
     C                     Z-ADD0         P#RATE                          CFT014
     C                     CALL 'FT0010'                                  CFT014
     C                     PARM           P#0010                          CFT014
      *                                                                   CFT014
     C           P#RTCD    IFNE *BLANK                                    CFT014
     C                     MOVEL'FT0010  'W0FILE           ***************CFT014
     C                     MOVEL'*CALL  ' W0KEY            * DB ERROR 55 *CFT014
     C                     Z-ADD55        W0ERNB           ***************CFT014
     C                     MOVEL'MEM5003' W0MSGD                          CFT014
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT014
     C                     EXSR SRERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     Z-ADDP#TOAM    INRCRM                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Unwind subroutine stack name.                                    CFT014
      *                                                                   CFT014
     C           EXFIRC    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
      *                                                                   CFT014
     C                     ENDSR                                          CFT014
      /EJECT
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRCL#3   :  Clear screen fields for default charges          *   CFT009
      *                                                               *   CFT009
      *  CALLED BY:                                                   *   CFT009
      *                                                               *   CFT009
      *  CALLS    :                                                   *   CFT009
      *                                                               *   CFT009
      *                                                               *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
     CSR         SRCL#3    BEGSR                                          CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name.                                    CFT009
      *                                                                   CFT009
     C                     ADD  1         Q                               CFT009
     C                     MOVEL'SRCL#3'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Transfer Commission                                              CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3TRCD                          CFT009
      *                                                                   CFT009
      ** Telex Charge                                                     CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3TXCD                          CFT009
      *                                                                   CFT009
      ** Cheque Charge                                                    CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3CQCD                          CFT009
      *                                                                   CFT009
      ** Advice Charge                                                    CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3ADCD                          CFT009
      *                                                                   CFT009
      ** Telephone Charge                                                 CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3TLCD                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge                                             CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   #3MSCD                          CFT009
      *                                                                   CFT009
      ** F/X Change Commission                                            CFT009
      *                                                                   CFT009
     C           S01494    IFEQ 'Y'                                       CFT009
     C                     MOVEL*BLANKS   #3CHCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 1                                                  CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M1CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 2                                                  CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M2CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 3                                                  CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M3CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 4                                                  CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M4CD                            CFT009
      *                                                                   CFT009
      ** MISCELLANEOUS 5                                                  CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   M5CD                            CFT009
      *                                                                   CFT009
      ** Unwind subroutine stack name.                                    CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      /EJECT                                                              CFT014
      *****************************************************************   CFT014
     C/COPY WNCPYSRC,FT0355C019
     C/EJECT
     C*
     C* File and Program Error Processing
     C*
     C/COPY FTCPYSRC,SRERRC
     O*EDTRCD: Cpysrc Templates Initialise Program O-spec
     O/COPY WNCPYSRC,FT0355DOPG
**  DESC
Miscellaneous Charge 1                                                    CFT009
Miscellaneous Charge 2                                                    CFT009
Miscellaneous Charge 3                                                    CFT009
Miscellaneous Charge 4                                                    CFT009
Miscellaneous Charge 5                                                    CFT009
**  CPY@
(c) Finastra International Limited 2001
