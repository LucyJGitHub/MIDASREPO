     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Incoming payments valid. S2/Lvl 2')           *
      *****************************************************************
      *                                                               *
      *  Midas - Funds Transfer Module                                *
      *                                                               *
      *  FT0359 - Validate Incoming Payments - Screen 3, Level 2      *
      *                                                               *
      *  Function:  This program validates the level 2 screen 3       *
      *             input for Incoming Payments.                      *
      *                                                               *
      *  Called By: FT0355  - Incoming Payments Maintenance Level 2   *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CFT162             Date 08Sep17               *
      *  Prev Amend No. 222568             Date 24Jan13               *
      *                 CFT120             Date 28Sep12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 250600             Date 07Oct07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 200949             Date 05Oct06               *
      *                 CFT032             Date 11Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG433             Date 05Dec05               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 219241             Date 01Jul03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CFT017             Date 08Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 29Aug00               *
      *                 CFT014  *CREATE    Date 25May00               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CFT162 - MT900 and MT910 Message Generation (Recompile)      *
      *  222568 - In Charge details 2 tab, charges on the left and    *
      *           right hand side of the screen is incorrect          *
      *         - Applied for AR1080200                               *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *  250600 - Fix CFT032 and CSW207 (recompile)                   *
      *  200949 - Suppress FTM3051.  Applied core fix 197943.         *
      *  CFT032 - Account line in field 50k in MT103 (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG433 - Recompiled due to change in FTPCHGPD                *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value                                        *
      *  CFT017 - Multilateral Inter-bank Exchange Fee. (Recompiled)  *
      *  CFT009 - Fees and Charges Development                        *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *                                                               *
      *****************************************************************
      /EJECT
      *
      ** GL Accounts file
     FACCNT   IF  E           K        DISK         KINFSR SRFILE
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
      *
      ** FT Retail Accounts file
     FACNUMA  IF  E           K        DISK         KINFSR SRFILE
     F            ACCNTABF                          KRENAMEACNUMABF
      *                                                                   CFT009
     FINPAY   IF  E           K        DISK                               CFT009
     FINPAYXL2IF  E           K        DISK                               CFT009
     FFTPCHGL0IF  E           K        DISK                               CFT009
      *                                                                   CFT009
      /EJECT
      *
      ** Array containing Copyright Statement.
     E                    CPY@    1   1 80
      *
     E/COPY FTCPYSRC,SRERRE
      *
      ** Warning Indicators array
     E                    WRNA       40  1
      *
      ** Work arrays
      *
     E                    WA1         5 12
     E                    WA2         5  1
     E                    WA3         5 11 0
     E                    WA4         5  1
     E                    WCCY        5  3
      *                                                                   CFT009
     E                    PTIERC     13 11                                CFT009
      **  Charge on each tier                                             CFT009
      *                                                                   CFT009
     E                    PTIERA     13 11                                CFT009
      **  Chargeable Amount on each tier                                  CFT009
      *                                                                   CFT009
      /EJECT
      *
      ** DS for compilation - Copyright insertion
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     I/COPY FTCPYSRC,SRERRI
      *
      ** DS for GL ICD details
     ISDGELR    E DSSDGELRPD
      *
      ** DS for Nostro details
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      ** DS for Currency details
     ISDCURR    E DSSDCURRPD
      *
      ** DS for SAR details
     ISCSARD    E DSSCSARDPD
      *
      ** DS for funds Transfer details                                    CFT009
     ISDFTFR    E DSSDFTFRPD                                              CFT009
      *                                                                   CFT009
      * Bank details Structure *                                          CFT009
      *                                                                   CFT009
     ISDBANK    E DSSDBANKPD                                              CFT009
      *                                                                   CFT009
      ** External Data structure for Message Management ICD.                                  219241
     ISDMGME    E DSSDMGMEPD                                                                  219241
      *                                                                                       219241
      ** Short DS for access object retrieval
     IDSFDY     E DSDSFDY
      *
      ** Long DS for access object retrieval
     IDSSDY     E DSDSSDY
      *
      ** Define Rundat data area
     IRUNDTA    E DSRUNDAT
      *
     I/COPY FTCPYSRC,SFT0355S0
      *
     I/COPY FTCPYSRC,SFT0355F0
      *
     I/COPY FTCPYSRC,SFT0355I0
      *
     I/COPY FTCPYSRC,SFTVALDI
      *
     I/COPY FTCPYSRC,FT0010I001
      *
      ** DS for DB errors on ACCNT
     I***ACKYDS*     DS                             18                                        CGL029
     IACKYDS      DS                             24                                           CGL029
     I**********                              1   60KACNUM                                    CSD027
     I                                        1   6 KACNUM                                    CSD027
     I                                        1   6 KACNMA
     I                                        7   9 KACCCY
     I**********                             10  130KACCD                                     CGL029
     I**********                             10  13 KACCDA                                    CGL029
     I**********                             14  150KACSQ                                     CGL029
     I**********                             14  15 KACSQA                                    CGL029
     I**********                             16  18 KBRCA                                     CGL029
     I                                       10  190KACCD                                     CGL029
     I                                       10  19 KACCDA                                    CGL029
     I                                       20  210KACSQ                                     CGL029
     I                                       20  21 KACSQA                                    CGL029
     I                                       22  24 KBRCA                                     CGL029
      *
      ** DS for Currency Conversion
     ID#DTA       DS                            256
      *
      ** From Currency and Amount
     I                                        1   3 D#FCCY
     I                                    P   4  110D#FAMT
      *
      ** To Currency and Amount
     I                                       12  14 D#TCCY
     I                                    P  15  220D#TAMT
      *
      ** Rate and Multi/Div Indicator
     I                                       23  23 I#MDIN
     I                                    P  24  368I#RATE
      *
      ** Output Rate and Multi/Div Indicator if no In Rate
     I                                       37  37 O#MDIN
     I                                    P  38  508O#RATE
      *
      ** Define fields for Message Transalation
     IDSMTR       DS
     I                                        1 132 #MSDTA
     I                                       15  30 #MPREF
     I                                    P   1   20#MPART
     I                                      133 264 #MSTX1
      *
      ** DS for Message Transalation
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
      *
      ***Work*DS*for*Sender's*Charges*Currencies**************************                    CFT009
      ** Work DS for Sender's Charges                                                         CFT009
      *
     ISCC25       DS
     I                                        1   3 WSSCCA
     I                                        4   6 WSSCCB
     I                                        7   9 WSSCCC
     I                                       10  12 WSSCCD
      *
     ISCC35       DS
     I                                        1   3 WSSCCE
     I                                        4   6 WSSCCF
     I                                        7   9 WSSCCG
      *
     ISCC45       DS
     I                                        1   3 WSSCCH
     I                                        4   6 WSSCCI
      *                                                                   CFT009
     I/COPY FTCPYSRC,SFTVALCS
      /EJECT
      *
      *****************************************************************
      *                                                               *
      *  Main - Main processing                                       *
      *                                                               *
      *****************************************************************
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q       50
     C                     MOVEL'MAIN'    @STK,Q
      *
      ** Receive entry parameters.
      *
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P0ACT   8
     C                     PARM           P0RSET  1
     C                     PARM           V#DATA
     C                     PARM           S0DATA
     C                     PARM           F0DATA
     C                     PARM           I0DATA
     C                     PARM           E#DATA
     C                     PARM           STP     1                       CFT009
      *
      ** Set up Primary Reference.
      *
     C                     MOVELS0DATA    W0PREF
      *
      ** Perform initialisation routine.
      *
     C           WFIRST    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       WFIRST  1
     C                     ENDIF
      *
      ** If warning work fields needs to be reset.
      *
     C           P0RSET    IFEQ 'Y'
     C                     MOVE *BLANKS   SWRCRM
     C                     Z-ADD0         WWTCHG
     C                     MOVE 'N'       P0RSET
     C                     ENDIF
      *
     C                     SELEC
      *
     C           P0ACT     WHEQ '*VALID'
     C                     EXSR SRPROC
      *
     C                     OTHER
     C                     EXSR SRACT
      *
     C                     ENDSL
      *
      ** Unwind subroutine stack name.
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      ** Return to calling program.
      *
     C                     RETRN
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPROC - Validate all Detail fields entered                  *
      *           Seton appropriate indicators and set up the array   *
      *           of relevant error codes for display.                *
      *                                                               *
      *****************************************************************
     C           SRPROC    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPROC'  @STK,Q
      *
      ** Move warning array passed to WRNA and error indicators.
      *
     C                     MOVEAE#WARA    WRNA
     C                     CLEARI0DATA
     C                     Z-ADD0         X       50
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** codes will be validated (NOT FOR STP)                            CFT009
      ** Retrieve the saved file fields from the defaulted codes          CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           STP       ANDNE'S'                                       CFT009
      *                                                                   CFT009
     C           S0PREF    CHAININPAY                90                   CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ *ON                                       CFT009
     C                     MOVEL'INPAY   'W0FILE                          CFT009
     C                     MOVELW0PREF    W0KEY                           CFT009
     C                     Z-ADD24        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           S0PREF    CHAININPAYXL2             90                   CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ *ON                                       CFT009
     C                     MOVEL'INPAYXL2'W0FILE                          CFT009
     C                     MOVELW0PREF    W0KEY                           CFT009
     C                     Z-ADD25        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Save defaulted charge codes for comparison later                 CFT009
      *                                                                   CFT009
      * Transfer Commission Charge Code                                   CFT009
     C           *LIKE     DEFN TFCCCO    WTFCCD                          CFT009
     C                     MOVE TFCCCO    WTFCCD                          CFT009
      * FX/Change Charge Code                                             CFT009
     C           *LIKE     DEFN FXCHEC    WFXCHD                          CFT009
     C                     MOVE FXCHEC    WFXCHD                          CFT009
      * Telex Charge Code                                                 CFT009
     C           *LIKE     DEFN TLCODE    WTXCDE                          CFT009
     C                     MOVE TLCODE    WTXCDE                          CFT009
      * Cheque Charge Code                                                CFT009
     C           *LIKE     DEFN CHCHCD    WCHQCD                          CFT009
     C                     MOVE CHCHCD    WCHQCD                          CFT009
      * Advice Charge Code                                                CFT009
     C           *LIKE     DEFN ADCHCD    WADCCD                          CFT009
     C                     MOVE ADCHCD    WADCCD                          CFT009
      * Telephone Charge Code                                             CFT009
     C           *LIKE     DEFN TLCHCD    WTLCHD                          CFT009
     C                     MOVE TLCHCD    WTLCHD                          CFT009
      * Miscellaneous Charge Code                                         CFT009
     C           *LIKE     DEFN MISCH     WMISCH                          CFT009
     C                     MOVE MISCH     WMISCH                          CFT009
      * Miscellaneous Charge Code 1                                       CFT009
     C           *LIKE     DEFN MSCH1     WMSCH1                          CFT009
     C                     MOVE MSCH1     WMSCH1                          CFT009
      * Miscellaneous Charge Code 2                                       CFT009
     C           *LIKE     DEFN MSCH2     WMSCH2                          CFT009
     C                     MOVE MSCH2     WMSCH2                          CFT009
      * Miscellaneous Charge Code 3                                       CFT009
     C           *LIKE     DEFN MSCH3     WMSCH3                          CFT009
     C                     MOVE MSCH3     WMSCH3                          CFT009
      * Miscellaneous Charge Code 4                                       CFT009
     C           *LIKE     DEFN MSCH4     WMSCH4                          CFT009
     C                     MOVE MSCH4     WMSCH4                          CFT009
      * Miscellaneous Charge Code 5                                       CFT009
     C           *LIKE     DEFN MSCH5     WMSCH5                          CFT009
     C                     MOVE MSCH5     WMSCH5                          CFT009
     C                     ENDIF                                          CFT009
      *
      ** Validate Charges to the Debit of A/c.
      *
     C                     EXSR SRCDRO
      *
      ** Validate Details of Charges.
      *
     C                     EXSR SRDETC
      *
      ** Get currency information for charge amount validation.
      *
     C                     EXSR SRCCCY
      *
      ** Validate Charge code and amounts if CFT009 switched ON           CFT009
      ** against default values (NOT FOR STP)                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C           STP       ANDNE'S'                                       CFT009
     C                     EXSR DEFLT                                     CFT009
     C                     ENDIF                                          CFT009
      *
      ** Validate Transfer Commision.
      *
     C                     EXSR SRTRCM
      *
      ** Validate FX/Change Commission if S01494 is switched ON.
      *
     C           S01494    IFEQ 'Y'
     C                     EXSR SRCHCM
     C                     ENDIF
      *
      ** Validate Telex Charge.
      *
     C                     EXSR SRTXCH
      *
      ** Validate Cheque Charge.
      *
     C                     EXSR SRCQCH
      *
      ** Validate Advice Charge.
      *
     C                     EXSR SRADCH
      *
      ** Validate Telephone Charge.
      *
     C                     EXSR SRTLCH
      *
      ** Validate Miscellaneous Charge.
      *
     C                     EXSR SRMSCH
      *                                                                   CFT009
      ** If SAR CFT009 Validate additional charges                        CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Validate Miscellaneous Charge 1                                  CFT009
      *                                                                   CFT009
     C                     EXSR SRMSC1                                    CFT009
      *                                                                   CFT009
      ** Validate Miscellaneous Charge 2                                  CFT009
      *                                                                   CFT009
     C                     EXSR SRMSC2                                    CFT009
      *                                                                   CFT009
      ** Validate Miscellaneous Charge 3                                  CFT009
      *                                                                   CFT009
     C                     EXSR SRMSC3                                    CFT009
      *                                                                   CFT009
      ** Validate Miscellaneous Charge 4                                  CFT009
      *                                                                   CFT009
     C                     EXSR SRMSC4                                    CFT009
      *                                                                   CFT009
      ** Validate Miscellaneous Charge 5                                  CFT009
      *                                                                   CFT009
     C                     EXSR SRMSC5                                    CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *
      ** VAT processing is allowed.
      *
     C           V#VATP    IFEQ 'Y'
      *
      ** Validate VAT flags.
      *
     C                     EXSR SRVATT
      *
      ** Calculate VAT charge amounts.
      *
     C                     EXSR SRVATC
      *
     C                     ENDIF
      *
      ** Check that Total Charges do not exceed payment amount.
      *
     C                     EXSR SRTOT
      *
      ** CFT014 is on.
      *
     C           CFT014    IFEQ 'Y'
      *
      ** Validate Receiver's Charges Remitted.
      *
     C                     EXSR SRRCRM
      *
      ** Validate Sender's Charges Deducted.
      *
     C                     EXSR SRSCHG
      *
     C********** F0RCRM    IFNE *ZERO                                                         200949
     C********** S0SCC1    ORNE *BLANK                                                        200949
     C********** S0SCC2    ORNE *BLANK                                                        200949
     C********** S0SCC3    ORNE *BLANK                                                        200949
     C********** S0SCC4    ORNE *BLANK                                                        200949
     C********** S0SCC5    ORNE *BLANK                                                        200949
      **********                                                                              200949
      ***Entry*for*Receiver's*Charges*Remitted*or*Sender's*Charges                            200949
      ***Deducted*is*prohibited*if*Instucted*amount*has*not*been                              200949
      ***entered.                                                                             200949
      **********                                                                              200949
     C********** V#NDAM    IFEQ *ZERO                                                         200949
     C**********           MOVEL'Y'       E#MSGS                                              200949
     C**********           MOVEL'FTM5031' FTMSID                                              200949
     C**********           MOVELE#CPGM    FTPGMQ                                              200949
     C**********           EXSR FTSNMS                                                        200949
      **********                                                                              200949
     C********** F0RCRM    IFNE *ZERO                                                         200949
     C**********           MOVE 'Y'       I0RCRM                                              200949
     C**********           ENDIF                                                              200949
      **********                                                                              200949
     C********** S0SCC1    IFNE *BLANK                                                        200949
     C********** S0SCC2    ORNE *BLANK                                                        200949
     C********** S0SCC3    ORNE *BLANK                                                        200949
     C********** S0SCC4    ORNE *BLANK                                                        200949
     C********** S0SCC5    ORNE *BLANK                                                        200949
     C**********           MOVEL'Y'       I0SCC1                                              200949
     C**********           ENDIF                                                              200949
      **********                                                                              200949
     C**********           MOVEL'Y'       E#NOUP                                              200949
     C**********           ENDIF                                                              200949
      **********                                                                              200949
     C**********           ENDIF                                                              200949
     C                     ENDIF
      *
      ** If no validation errors exist, perform cross validations.
      *
     C           E#NOUP    IFEQ *BLANKS
     C                     EXSR SRXVAL
     C                     ENDIF
      *
      ** Pass back warnings and error codes.
      *
     C                     MOVEAWRNA      E#WARA
      *
      ** Unwind subroutine stack name.
      *
     C           EXPROC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCDRO - Validate Charges to the Debit of A/c and            *
      *           Branch                                              *
      *                                                               *
      *****************************************************************
     C           SRCDRO    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCDRO'  @STK,Q
      *
     C                     MOVEL*BLANKS   F0CDRT
      *
      ** Charges to the Debit of A/c is optional.
      ** 3 formats acceptable: Nostro, Retail A/c, A/c No.
      *
      ** Error if blank and Branch entered.
      *
     C           S0CDRO    IFEQ *BLANKS
     C           S0CDBR    ANDNE*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2056' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** Field is optional.  Exit if blank.
      *
     C           S0CDRO    IFEQ *BLANKS
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** Determine the number of digits in the field.
      *
      ** Check first two characters are numeric and rest is blank.
      *
     C                     MOVEL*BLANKS   I#FLD
     C                     MOVELS0CDRO    I#FLD  35
     C           DIGITS    CHECKI#FLD     Y#      30     90
      *
      ** 2, 10 and 12 digits allowed.
      *
     C           *IN90     IFEQ '1'
     C           Y#        ANDEQ3
     C           *IN90     OREQ '1'
     C           Y#        ANDEQ11
     C           *IN90     OREQ '1'
     C           Y#        ANDEQ13
     C           S0CDBR    ANDNE*BLANKS
     C           WUMBIN    ANDEQ'Y'
     C           *IN90     OREQ '1'
     C           Y#        ANDEQ13
     C           WUMBIN    ANDNE'Y'
     C                     MOVEL'0'       *IN90
     C                     ENDIF
      *
      ** Field is in invalid format.
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2057' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** If 10 digits and Retail accounts not used, error.
      *
     C           V#RANR    IFNE 'Y'
     C           Y#        ANDEQ11
     C           S0CDBR    ANDEQ*BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2058' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** Check if a 2 digit Nostro code has been entered - based on
      ** no. of blanks found in field.
      *
     C           Y#        IFEQ 3
     C           S0CDBR    ANDEQ*BLANKS
      *
      ** Validate Nostro Code.
      *
     C                     MOVELS0CDRO    TNOSN   2
      *
     C                     CALL 'AONOSTR0'             9090
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C                     PARM V#BCCY    @CYCD   3
     C**********           PARM *BLANKS   @ACCN   4                                           CGL029
     C                     PARM *BLANKS   @ACCN  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM TNOSN     @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
      ** Error on call.
      *
     C           *IN90     IFEQ '1'
     C                     Z-ADD001       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AONOSTR0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Erro if not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2059' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** Set up ACCNTAB fields.
      *
     C                     MOVE A7ACCD    ACOD
     C                     MOVE A7ACSN    ACSQ
     C                     MOVE A7CUST    CNUM
     C                     MOVE A7CYCD    CCY
     C                     MOVE A7BRCD    BRCA
      *
      ** Access Full Account details for later validation.
      *
     C                     MOVELA7CYCD    KACCCY
     C**********           Z-ADDCNUM      KACNUM                                              CSD027
     C                     MOVE CNUM      KACNUM                                              CSD027
     C                     Z-ADDACOD      KACCD
     C                     Z-ADDACSQ      KACSQ
     C                     MOVE BRCA      KBRCA
      *
     C           TACKEY    CHAINACCNTABF             90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD002       W0ERNB
     C                     MOVE V#BCCY    KACCCY
     C                     MOVELACKYDS    W0KEY
     C                     MOVEL'ACCNT'   W0FILE
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Check for Retail Account No. being entered
      ** only if Debit Customer reference is not entered OR
      ** multibranching is not active.
      *
     C           Y#        IFEQ 11
     C           S0CDBR    ANDEQ*BLANKS
      *
     C                     MOVELS0CDRO    TRENO  100
     C           TRENO     CHAINACNUMA               90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2060' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
      ** A/c Currency must be Base Currency.
      *
     C           CCY       IFNE V#BCCY
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2061' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     GOTO EXCDRO
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Validate for G/L Account No.
      *
      ** If 12 digits when combined with base currency must exist
      ** on PF/ACCNTAB.
      *
     C           Y#        IFEQ 13
     C           S0CDBR    ORNE *BLANKS
      *
     C**********           MOVELS0CDRO    KACNUM  60                                          CSD027
     C                     MOVELS0CDRO    KACNUM  6                                           CSD027
     C**********           MOVE S0CDRO    ACCS    6                                           CGL029
     C                     MOVE S0CDRO    ACCS   12                                           CGL029
     C**********           MOVELACCS      KACCD   40                                          CGL029
     C                     MOVELACCS      KACCD                                               CGL029
     C                     MOVE ACCS      KACSQ   20
      *
      ** If multibranched, use screen branch.  Else,
      ** use branch passed.
      *
     C           WUMBIN    IFEQ 'Y'
     C                     MOVELS0CDBR    KBRCA   3
     C                     ELSE
     C                     MOVELV#SBRC    KBRCA
     C                     ENDIF
      *
     C           TACKEY    KLIST
     C                     KFLD           KACNUM
     C                     KFLD           V#BCCY
     C                     KFLD           KACCD
     C                     KFLD           KACSQ
     C                     KFLD           KBRCA
      *
     C           TACKEY    CHAINACCNTABF             90
      *
     C           *IN90     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       E#MSGS
     C           S0CDRO    CAT  S0CDBR    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2062' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
      *
      ** Highlight branch if entered.
      *
     C           S0CDBR    IFNE *BLANK
     C                     MOVEL'Y'       I0CDBR
     C                     ENDIF
      *
     C                     GOTO EXCDRO
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If 'Charges to the Debit of' is entered, then
      ** check if date is in the future and if the account is
      ** closing today.
      *
     C           V#ADDC    IFEQ 'A'
     C                     Z-ADDV#SLDT    @DATE   50
     C                     ELSE
     C                     Z-ADDV#PVDT    @DATE
     C                     ENDIF
      *
     C           @DATE     IFGT WURDNB
     C           ACST      ANDEQ'C'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2063' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
      *
      ** Check not past backvalue period.
      *
     C           @DATE     IFLT V#BVLD
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2064' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
      *
      ** For Retail accounts only, check that the
      ** earlier of the two value dates is not before the Backvalue
      ** Limit Date nor before the account was opened.
      *
     C           ATYP      IFEQ 'R'
      *
     C           @DATE     IFLT DACO
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0CDRO    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2065' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CDRT
     C                     MOVEL'Y'       I0CDBR
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If no errors then set file fields.
      *
     C           I0CDRT    IFEQ *BLANKS
     C                     SELEC
     C           Y#        WHEQ 3
     C                     MOVEL'N'       F0CDRT
     C           Y#        WHEQ 11
     C                     MOVEL'R'       F0CDRT
     C           Y#        WHEQ 13
     C                     MOVEL'P'       F0CDRT
     C                     ENDSL
      *
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXCDRO    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRDETC - Validate Details of Charges                         *
      *                                                               *
      *****************************************************************
     C           SRDETC    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDETC'  @STK,Q
      *
      ** Details of Charges is optional.  Defaults to BEN.
      *
     C           S0DETC    IFEQ *BLANKS
      *                                                                                       219241
      ** If CFT014 is installed, use the default value from the                               219241
      ** Message Management ICD                                                               219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
     C                     MOVELENDCHG    S0DETC                                              219241
     C                     ELSE                                                               219241
     C                     MOVE 'BEN'     S0DETC
     C/COPY WNCPYSRC,FT0359C003
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ELSE
      *
     C                     MOVE 'N'       WSHA    1
     C           CFT014    IFEQ 'Y'
     C           S0DETC    ANDEQ'SHA'
     C                     MOVE 'Y'       WSHA
     C                     ENDIF
      *
      ** Valid entries are 'OUR' or 'BEN'.
      ** If CFT014 is on, accept 'SHA'
      *
     C           S0DETC    IFNE 'OUR'
     C           S0DETC    ANDNE'BEN'
     C           WSHA      ANDNE'Y'
     C                     MOVEL'Y'       E#MSGS
     C                     MOVELS0DETC    FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C           CFT014    IFEQ 'Y'
     C                     MOVEL'FTM5045' FTMSID
     C                     ELSE
     C                     MOVEL'FTM2078' FTMSID
     C                     ENDIF
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0DETC
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXDETC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCCCY - Get Currency information for Charge amount          *
      *           validation                                          *
      *                                                               *
      *****************************************************************
     C           SRCCCY    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCCCY'  @STK,Q
      *
      ** Reset Charges Currencies.
      *
     C           I0CDRT    IFEQ *BLANK
     C           I0CDBR    ANDEQ*BLANK
      *
     C                     MOVE *BLANKS   P0RTN                           CFT009
     C                     SELEC
     C           V#CHCY    WHEQ 'B'
     C           S0CDRO    ORNE *BLANKS
     C           V#CHCY    ANDEQ'C'                                                           222568
      * If charges to debit of is not blank, recalculate charges in       CFT009
      * base ccy (only if it was blank before)                            CFT009
      *                                                                   CFT009
     C           V#BCCY    IFEQ V#CCCY                                    CFT009
     C                     MOVE *BLANKS   RECAL   1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'Y'       RECAL                           CFT009
     C                     MOVEL'*RECAL'  P0RTN                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#BCCY    V#CCCY
      *
     C           V#CHCY    WHEQ 'L'
      *                                                                   CFT009
     C           V#LCCY    IFEQ V#CCCY                                    CFT009
     C                     MOVE *BLANKS   RECAL                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'Y'       RECAL                           CFT009
     C                     MOVEL'*RECAL'  P0RTN                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#LCCY    V#CCCY
     C           V#CHCY    WHEQ 'F'                                       CFT009
      *                                                                   CFT009
     C           FCHCCY    IFEQ V#CCCY                                    CFT009
     C                     MOVE *BLANKS   RECAL                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'Y'       RECAL                           CFT009
     C                     MOVEL'*RECAL'  P0RTN                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVE FCHCCY    V#CCCY                          CFT009
      *
     C           V#CHCY    WHEQ 'C'
     C           V#ADDC    ANDEQ'A'
      *                                                                   CFT009
     C           V#SMCY    IFEQ V#CCCY                                    CFT009
     C                     MOVE *BLANKS   RECAL                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'Y'       RECAL                           CFT009
     C                     MOVEL'*RECAL'  P0RTN                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#SMCY    V#CCCY
      *
     C                     OTHER
      *                                                                   CFT009
     C           V#PCCY    IFEQ V#CCCY                                    CFT009
     C                     MOVE *BLANKS   RECAL                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'Y'       RECAL                           CFT009
     C                     MOVEL'*RECAL'  P0RTN                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     MOVELV#PCCY    V#CCCY
      *
     C                     ENDSL
      *
     C                     MOVELV#CCCY    INCHGC                          CFT009
     C                     MOVELV#CCCY    F0CHCY                          CFT009
      *
     C                     SELEC
      *
     C           S0CDRO    WHNE *BLANKS
     C                     MOVELV#BCCY    V#RCCY
      *
     C           V#ADDC    WHEQ 'A'
     C                     MOVELV#SMCY    V#RCCY
      *
     C           V#SND1    IFEQ 'CASHIER'
     C           V#PCCY    ANDEQV#BCCY
     C                     MOVELV#PCCY    V#RCCY
     C                     ENDIF
      *
     C                     OTHER
     C                     MOVELV#PCCY    V#RCCY
      *
     C                     ENDSL
      *
      * Save LEVIED currency                                              CFT009
     C                     MOVELV#RCCY    LEVIED  3                       CFT009
      *                                                                   CFT009
      *
     C                     ENDIF
      *
      ** Access currency record.
      *
     C                     CALL 'AOCURRR0'             9090
     C                     PARM           @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM V#CCCY    @CCY    3
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      ** Option ended in error.
      *
     C           *IN90     IFEQ '1'
     C           @RTCD     ORNE *BLANKS
     C                     Z-ADD003       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCURRR0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXCCCY    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTRCM - Validate Transfer Commission Charge                 *
      *                                                               *
      *****************************************************************
      *
     C           SRTRCM    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRTRCM'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** Transfer Commission is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0TRCD
     C                     Z-ADD0         F0TRCM
      *
     C           S0TRCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0TRCD    ZFIELD
      *
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0TRCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2079' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0TRCM
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0TRCD
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD4         Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      ** & recalculate charges                                            CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE1    CHGCDE                          CFT009
     C           S0CDE1    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE1                          CFT009
     C                     ELSE                                           CFT009
     C           S0TRCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0TRCD                          CFT009
     C           S0VAT1    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT1                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT1                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           S0CDE1    IFNE WTFCCD                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE1    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3176' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE1                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Transfer Commission is optional.                                 CFT009
      *                                                                   CFT009
     C                     Z-ADD5         Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0TRCD                          CFT009
     C                     Z-ADD0         F0TRCM                          CFT009
      *                                                                   CFT009
      ** If entered and the file default is blank then send a warning     CFT009
      ** message                                                          CFT009
      *                                                                   CFT009
     C           S0TRCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Convert screen field to numeric value for comparison             CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6SPRT    CVTRAT                          CFT009
     C           *LIKE     DEFN A6NBDP    FRMDEC                          CFT009
     C           *LIKE     DEFN A6NBDP    TODEC                           CFT009
     C           *LIKE     DEFN A6MDIN    FRMMD                           CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0TRCD    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0TRCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2194' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TRCM                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0TRCD                          CFT009
     C                     MOVE ZFIELD    INPAMT 150                      CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0TRCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT 150                      CFT009
     C                     Z-ADDLCHG      F0TRCM                          CFT009
      *                                                                   CFT009
     C           F0TRCD    IFNE MTRCM                                     CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TRCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3158' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TRCM                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           MTRCM     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TRCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3158' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TRCM                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXTRCM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCHCM - Validate FX/Change Commission                       *
      *                                                               *
      *****************************************************************
     C           SRCHCM    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCHCM'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** FX/Change commission only allowed if Pay and Settle currencies
      ** are different.  If entered must be valid for charge currency
      ** details.
      *
     C                     Z-ADD0         F0CHCD
     C                     Z-ADD0         F0CHCM
      *
      ** If EMU FT Enhancement is switched on then
      ** save work date parameter for call to FT0010 as W#DT.
      *
     C           CEU006    IFEQ 'Y'
     C           *LIKE     DEFN V#SLDT    W#DT
     C           V#ADDC    IFEQ 'A'
     C                     Z-ADDV#SLDT    W#DT
     C                     ELSE
     C                     Z-ADDV#PVDT    W#DT
     C                     ENDIF
     C                     ENDIF
      *
     C           S0CHCD    IFNE *BLANKS
      *
     C           V#SMCY    IFNE V#PCCY
      *
      ** If EMU FT Enhancement is switched on
      ** and both Settle Ccy and Pay Ccy are either 'In' or Euros,
      ** then FX/Change Commission must be zero.
      *
     C           CEU006    IFEQ 'Y'
     C           #INCYS    ANDEQ'Y'
     C           #TPSDS    ANDLEW#DT
     C           V#PCCY    ANDEQBKEURO
     C           CEU006    OREQ 'Y'
     C           #INCYP    ANDEQ'Y'
     C           #TPSDP    ANDLEW#DT
     C           V#SMCY    ANDEQBKEURO
     C           CEU006    OREQ 'Y'
     C           #INCYS    ANDEQ'Y'
     C           #TPSDS    ANDLEW#DT
     C           #INCYP    ANDEQ'Y'
     C           #TPSDP    ANDLEW#DT
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL*BLANKS   FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2599' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CHCM
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0CHCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0CHCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2523' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CHCM
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0CHCD
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL*BLANKS   FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2521' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CHCM
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C           V#SMCY    IFEQ V#PCCY                                    CFT009
     C                     Z-ADD6         Z       30                      CFT009
     C           S0CDE2    IFNE *BLANKS                                   CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0CDE2    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3200' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE2                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     MOVEL' '       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     Z-ADD7         Z       30                      CFT009
     C                     Z-ADD0         F0CHCD                          CFT009
     C                     Z-ADD0         F0CHCM                          CFT009
     C           S0CHCD    IFNE *BLANKS                                   CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0CHCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3201' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     MOVEL' '       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
     C                     Z-ADD6         Z       30                      CFT009
     C                     MOVE S0CDE2    CHGCDE                          CFT009
     C           S0CDE2    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE2                          CFT009
     C                     ELSE                                           CFT009
     C           S0CHCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0CHCD                          CFT009
     C           S0VAT7    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT7                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT7                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE2    IFNE WFXCHD                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE2    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3177' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE2                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** FX/Change commission only allowed if Pay and Settle currencies   CFT009
      ** are different.  If entered must be valid for charge currency     CFT009
      ** details.                                                         CFT009
      *                                                                   CFT009
     C                     Z-ADD7         Z       30                      CFT009
     C                     Z-ADD0         F0CHCD                          CFT009
     C                     Z-ADD0         F0CHCM                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0CHCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
      ** If EMU FT Enhancement is switched on then                        CFT009
      ** save work date parameter for call to FT0010 as W#DT              CFT009
      *                                                                   CFT009
     C           CEU006    IFEQ 'Y'                                       CFT009
     C           V#ADDC    IFEQ 'A'                                       CFT009
     C                     Z-ADDV#SLDT    W#DT                            CFT009
     C                     ELSE                                           CFT009
     C                     Z-ADDV#PVDT    W#DT                            CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           V#SMCY    IFEQ V#PCCY                                    CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVEL*BLANKS   FTMSDT                          CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2521' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If EMU FT  Enhancement is switched on                            CFT009
      ** and both Settle Ccy and Pay Ccy are either 'In' or Euros,        CFT009
      ** then FX/Change Commission must be zero.                          CFT009
      *                                                                   CFT009
     C           CEU006    IFEQ 'Y'                                       CFT009
     C           #INCYS    ANDEQ'Y'                                       CFT009
     C           #TPSDS    ANDLEW#DT                                      CFT009
     C           V#PCCY    ANDEQBKEURO                                    CFT009
     C           CEU006    OREQ 'Y'                                       CFT009
     C           #INCYP    ANDEQ'Y'                                       CFT009
     C           #TPSDP    ANDLEW#DT                                      CFT009
     C           V#SMCY    ANDEQBKEURO                                    CFT009
     C           CEU006    OREQ 'Y'                                       CFT009
     C           #INCYS    ANDEQ'Y'                                       CFT009
     C           #TPSDS    ANDLEW#DT                                      CFT009
     C           #INCYP    ANDEQ'Y'                                       CFT009
     C           #TPSDP    ANDLEW#DT                                      CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVEL*BLANKS   FTMSDT                          CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2599' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0CHCD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0CHCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2520' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0CHCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0CHCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0CHCM                          CFT009
      *                                                                   CFT009
     C           MINCHM    IFNE F0CHCD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CHCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3159' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C           MINCHM    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CHCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3159' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CHCM                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXCHCM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTXCH - Validate Telex Charges                              *
      *                                                               *
      *****************************************************************
     C           SRTXCH    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRTXCH'  @STK,Q
      *
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *                                                                   CFT009
      ** Telex Charge is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0TXCD
     C                     Z-ADD0         F0TXCH
      *
     C           S0TXCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0TXCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0TXCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2102' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0TXCH
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0TXCD
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C                     Z-ADD8         Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE3    CHGCDE                          CFT009
     C           S0CDE3    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE3                          CFT009
     C                     ELSE                                           CFT009
     C           S0TXCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0TXCD                          CFT009
     C           S0VAT2    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT2                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT2                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE3    IFNE WTXCDE                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE3    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3178' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE3                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     Z-ADD9         Z       30                      CFT009
     C                     Z-ADD0         F0TXCD                          CFT009
     C                     Z-ADD0         F0TXCH                          CFT009
      *                                                                   CFT009
      ** Telex Charge is optional                                         CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0TXCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0TXCD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0TXCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2195' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TXCH                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0TXCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0TXCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0TXCH                          CFT009
      *                                                                   CFT009
     C           MTXCH     IFNE F0TXCD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TXCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3160' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TXCH                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
     C           MTXCH     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TXCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3160' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TXCH                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXTXCH    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCQCH - Validate Cheque Charges                             *
      *                                                               *
      *****************************************************************
     C           SRCQCH    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCQCH'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** Cheque Charge is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0CQCD
     C                     Z-ADD0         F0CQCH
      *
     C           S0CQCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0CQCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0CQCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2103' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0CQCH
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0CQCD
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD10        Z       30                      CFT009
     C                     Z-ADD0         F0CQCD                          CFT009
     C                     Z-ADD0         F0CQCH                          CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
     C                     Z-ADD10        Z       30                      CFT009
     C                     MOVE S0CDE4    CHGCDE                          CFT009
     C           S0CDE4    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE4                          CFT009
     C                     ELSE                                           CFT009
     C           S0CQCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0CQCD                          CFT009
     C           S0VAT3    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT3                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT3                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE4    IFNE WCHQCD                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE4    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3179' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE4                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Cheque Charge is optional.                                       CFT009
      *                                                                   CFT009
     C                     Z-ADD11        Z       30                      CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0CQCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0CQCD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0CQCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2197' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CQCH                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0CQCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0CQCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0CQCH                          CFT009
      *                                                                   CFT009
     C           F0CQCD    IFNE MCQCH                                     CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CQCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3161' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CQCH                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           MCQCH     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CQCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3161' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CQCH                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXCQCH    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRADCH - Validate Advice Charges                             *
      *                                                               *
      *****************************************************************
     C           SRADCH    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRADCH'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** Advice Charge is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0ADCD
     C                     Z-ADD0         F0ADCH
      *
     C           S0ADCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0ADCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0ADCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2104' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0ADCH
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0ADCD
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD12        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      ** & recalculate charges                                            CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE5    CHGCDE                          CFT009
     C           S0CDE5    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE5                          CFT009
     C                     ELSE                                           CFT009
     C           S0ADCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0ADCD                          CFT009
     C           S0VAT4    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT4                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT4                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           S0CDE5    IFNE WADCCD                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE5    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3202' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE5                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Advice charge is optional.                                       CFT009
      *                                                                   CFT009
     C                     Z-ADD13        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0ADCD                          CFT009
     C                     Z-ADD0         F0ADCH                          CFT009
      *                                                                   CFT009
      ** If entered and the file default is blank then send a warning     CFT009
      ** message                                                          CFT009
      *                                                                   CFT009
     C           S0ADCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Convert screen field to numeric value for comparison             CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0ADCD    ZFIELD                          CFT009
      *                                                                   CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0ADCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2104' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0ADCH                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0ADCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0ADCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0ADCH                          CFT009
      *                                                                   CFT009
     C           F0ADCD    IFNE MADCH                                     CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0ADCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3203' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0ADCH                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           MADCH     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0ADCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3203' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0ADCH                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXADCH    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTLCH - Validate Telephone Charge                           *
      *                                                               *
      *****************************************************************
     C           SRTLCH    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRTLCH'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** Telephone Charge is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0TLCD
     C                     Z-ADD0         F0TLCH
      *
     C           S0TLCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0TLCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0TLCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2105' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0TLCH
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0TLCD
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD14        Z       30                      CFT009
     C                     Z-ADD0         F0TLCD                          CFT009
     C                     Z-ADD0         F0TLCH                          CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code, then send a warning message                    CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Telephone Charge code is optional,                               CFT009
      *                                                                   CFT009
     C                     Z-ADD14        Z       30                      CFT009
     C                     MOVE S0CDE6    CHGCDE                          CFT009
     C           S0CDE6    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE6                          CFT009
     C                     ELSE                                           CFT009
     C           S0TLCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0TLCD                          CFT009
     C           S0VAT5    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT5                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT5                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE6    IFNE WTLCHD                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE6    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3204' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE6                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** TELEPHONE charge is optional.                                    CFT009
      *                                                                   CFT009
     C                     Z-ADD15        Z       30                      CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0TLCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0TLCD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0TLCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2105' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TLCH                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0TLCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0TLCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0TLCH                          CFT009
      *                                                                   CFT009
     C           MTLCH     IFNE F0TLCD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TLCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3205' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TLCH                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           MTLCH     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0TLCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3205' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0TLCH                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXTLCH    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRMSCH - Validate Miscellaneous Charges                      *
      *                                                               *
      *****************************************************************
     C           SRMSCH    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRMSCH'  @STK,Q
      *                                                                   CFT009
      ** If Core switchable feature CFT009 is on then the charge          CFT009
      ** code/amounts will be validated                                   CFT009
      *                                                                   CFT009
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      ** Miscellaneous Charge is optional.
      ** If entered must be valid for charge currency details.
      *
     C                     Z-ADD0         F0MSCD
     C                     Z-ADD0         F0MSCH
      *
     C           S0MSCD    IFNE *BLANKS
      *
     C           11        SUB  A6NBDP    ZADIG
     C                     Z-ADDA6NBDP    ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0MSCD    ZFIELD
     C                     EXSR SRALGN
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVEL'Y'       E#MSGS
     C           S0MSCD    CAT  V#CCCY    FTMSDT    P
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2106' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0MSCH
     C                     MOVEL'Y'       E#NOUP
     C                     ELSE
     C                     MOVE ZFIELD    F0MSCD
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD16        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code, then send a warning message                    CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE7    CHGCDE                          CFT009
     C           S0CDE7    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE7                          CFT009
     C                     ELSE                                           CFT009
     C           S0MSCD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0MSCD                          CFT009
     C           S0VAT6    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VAT6                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VAT6                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE7    IFNE WMISCH                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE7    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3182' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE7                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge is optional.                                CFT009
      *                                                                   CFT009
     C                     Z-ADD17        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0MSCD                          CFT009
     C                     Z-ADD0         F0MSCH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0MSCD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0MSCD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           V#CCCY    CAT  S0MSCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF2200' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0MSCH                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0MSCD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Get defaulted field ccy and then use it to convert from this     CFT009
      ** CCy to the screen ccy so that a comparison can be made of the    CFT009
      ** two amounts                                                      CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0MSCD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0MSCH                          CFT009
      *                                                                   CFT009
     C           MMSCH     IFNE F0MSCD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0MSCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3164' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0MSCH                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           MMSCH     IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0MSCD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3164' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0MSCH                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXMSCH    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/SRMSC1                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRMSC1 - Validate Miscellaneous Charge 1                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRPROC Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           SRMSC1    BEGSR                           *** SRMSC1**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'SRMSC1'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD18        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional.                           CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE8    CHGCDE                          CFT009
     C           S0CDE8    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE8                          CFT009
     C                     ELSE                                           CFT009
     C           S0M1CD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0M1CD                          CFT009
     C           S0VT9     IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VT9                           CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VT9                           CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE8    IFNE WMSCH1                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE8    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3184' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE8                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional                            CFT009
      *                                                                   CFT009
     C                     Z-ADD19        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0M1CD                          CFT009
     C                     Z-ADD0         F0M1CH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0M1CD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0M1CD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0M1CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3190' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M1CD                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0M1CD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0M1CD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0M1CH                          CFT009
      *                                                                   CFT009
     C           WMSC01    IFNE F0M1CD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M1CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3171' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M1CD                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           WMSC01    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M1CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3171' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M1CD                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXM1CH    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/SRMSC2                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRMSC2 - Validate Miscellaneous Charge 2                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRPROC Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           SRMSC2    BEGSR                           *** SRMSC2**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'SRMSC2'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD20        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional.                           CFT009
      *                                                                   CFT009
     C                     MOVE S0CDE9    CHGCDE                          CFT009
     C           S0CDE9    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CDE9                          CFT009
     C                     ELSE                                           CFT009
     C           S0M2CD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0M2CD                          CFT009
     C           S0VT10    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VT10                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VT10                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CDE9    IFNE WMSCH2                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CDE9    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3185' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CDE9                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional                            CFT009
      *                                                                   CFT009
     C                     Z-ADD21        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0M2CD                          CFT009
     C                     Z-ADD0         F0M2CH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0M2CD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Convert screen field to numeric value for comparison             CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0M2CD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0M2CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3191' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M2CD                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0M2CD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0M2CD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0M2CH                          CFT009
      *                                                                   CFT009
     C           WMSC02    IFNE F0M2CD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M2CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3172' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M2CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           WMSC02    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M2CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3172' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M2CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXM2CH    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/SRMSC3                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRMSC3 - Validate Miscellaneous Charge 3                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRPROC Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           SRMSC3    BEGSR                           *** SRMSC3**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'SRMSC3'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD22        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional.                           CFT009
      *                                                                   CFT009
     C                     MOVE S0CD10    CHGCDE                          CFT009
     C           S0CD10    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CD10                          CFT009
     C                     ELSE                                           CFT009
     C           S0M3CD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0M3CD                          CFT009
     C           S0VT11    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VT11                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VT11                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CD10    IFNE WMSCH3                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CD10    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3186' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CD10                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional                            CFT009
      *                                                                   CFT009
     C                     Z-ADD23        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0M3CD                          CFT009
     C                     Z-ADD0         F0M3CH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0M3CD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Convert screen field to numeric value for comparison             CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0M3CD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0M3CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3192' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M3CD                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0M3CD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0M3CD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0M3CH                          CFT009
      *                                                                   CFT009
     C           WMSC03    IFNE F0M3CD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M3CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3173' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M3CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           WMSC03    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M3CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3173' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M3CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXM3CH    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/SRMSC4                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRMSC4 - Validate Miscellaneous Charge 4                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRPROC Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           SRMSC4    BEGSR                           *** SRMSC4**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'SRMSC4'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD24        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional.                           CFT009
      *                                                                   CFT009
     C                     MOVE S0CD11    CHGCDE                          CFT009
     C           S0CD11    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CD11                          CFT009
     C                     ELSE                                           CFT009
     C           S0M4CD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0M4CD                          CFT009
     C           S0VT12    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VT12                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VT12                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CD11    IFNE WMSCH4                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CD11    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3187' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CD11                          CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional                            CFT009
      *                                                                   CFT009
     C                     Z-ADD25        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0M4CD                          CFT009
     C                     Z-ADD0         F0M4CH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0M4CD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0M4CD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0M4CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3193' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M4CD                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0M4CD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0M4CD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0M4CH                          CFT009
      *                                                                   CFT009
     C           WMSC04    IFNE F0M4CD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M4CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3174' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M4CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           WMSC04    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M4CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3174' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M4CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Unwind subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXM4CH    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/SRMSC5                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  SRMSC5 - Validate Miscellaneous Charge 5                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRPROC Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           SRMSC5    BEGSR                           *** SRMSC5**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'SRMSC5'  @STK,Q                          CFT009
      *                                                                   CFT009
      ** Charge Code/Amounts will be validated                            CFT009
      *                                                                   CFT009
     C                     Z-ADD26        Z       30                      CFT009
      *                                                                   CFT009
      ** If the screen charge code is not equal to the defaulted          CFT009
      ** file charge code,  then send a warning message                   CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional.                           CFT009
      *                                                                   CFT009
     C                     MOVE S0CD12    CHGCDE                          CFT009
     C           S0CD12    IFNE *BLANKS                                   CFT009
     C                     EXSR VALID                                     CFT009
     C           WI0CDE    IFEQ 'Y'                                       CFT009
     C                     MOVE 'Y'       I0CD12                          CFT009
     C                     ELSE                                           CFT009
     C           S0M5CD    IFEQ *BLANKS                                   CFT009
     C           RECAL     OREQ 'Y'                                       CFT009
     C                     EXSR RECALC                                    CFT009
     C                     MOVE ZFIELD    S0M5CD                          CFT009
     C           S0VT13    IFEQ *BLANK                                    CFT009
     C           VATLIN    IFEQ 'Y'                                       CFT009
     C                     MOVELVATLIN    S0VT13                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       S0VT13                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
     C           S0CD12    IFNE WMSCH5                                    CFT009
     C           WI0CDE    ANDNE'Y'                                       CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0CD12    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3188' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0CD12                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Miscellaneous Charge code is optional                            CFT009
      *                                                                   CFT009
     C                     Z-ADD27        Z       30                      CFT009
      *                                                                   CFT009
     C                     Z-ADD0         F0M5CD                          CFT009
     C                     Z-ADD0         F0M5CH                          CFT009
      *                                                                   CFT009
      ** If screen field is entered and the defaulted field is blank      CFT009
      ** then send a warning message to say field is not same as default  CFT009
      *                                                                   CFT009
     C           S0M5CD    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Call currency conversion subroutine                              CFT009
      *                                                                   CFT009
     C                     EXSR CCYCNV                                    CFT009
      *                                                                   CFT009
     C           11        SUB  FRMDEC    ZADIG                           CFT009
     C                     Z-ADDFRMDEC    ZADEC                           CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVELS0M5CD    ZFIELD                          CFT009
     C                     EXSR SRALGN                                    CFT009
      *                                                                   CFT009
     C           ZRTN      IFEQ '*ERROR*'                                 CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C           INCHGC    CAT  S0M5CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3194' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M5CD                          CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    F0M5CD                          CFT009
     C                     MOVE ZFIELD    INPAMT                          CFT009
      *                                                                   CFT009
      ** Convert file default using screen ccy for comparison of          CFT009
      ** entered field and defaulted                                      CFT009
      *                                                                   CFT009
      ** Set up charge amount and currencies for call to FT000985.        CFT009
      *                                                                   CFT009
     C                     Z-ADDF0M5CD    CHGA85                          CFT009
     C                     MOVELPCCY      PCCY85                          CFT009
     C                     MOVELSMCY      SCCY85                          CFT009
     C                     MOVELINCHGC    CCCY85                          CFT009
     C                     MOVELLEVIED    LCCY85                          CFT009
     C                     MOVELCVTRAT    RATE85                          CFT009
     C                     Z-ADD0         LCHG                            CFT009
     C                     MOVEL*BLANKS   LCHGF     P                     CFT009
      *                                                                   CFT009
     C                     CALL 'FT000985'                                CFT009
     C                     PARM           RET985 10                       CFT009
     C                     PARM           CHGA85 130                      CFT009
     C                     PARM           PCCY85  3                       CFT009
     C                     PARM           SCCY85  3                       CFT009
     C                     PARM           CCCY85  3                       CFT009
     C                     PARM           LCCY85  3                       CFT009
     C                     PARM           RATE85 138                      CFT009
     C                     PARM           LCHG   130                      CFT009
     C                     PARM           LCHGF  16                       CFT009
      *                                                                   CFT009
      ** Set up amounts                                                   CFT009
      *                                                                   CFT009
     C                     Z-ADDLCHG      OUTAMT                          CFT009
     C                     Z-ADDLCHG      F0M5CH                          CFT009
      *                                                                   CFT009
     C           WMSC05    IFNE F0M5CD                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M5CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3175' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M5CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If screen field is blank and file field default is not then      CFT009
      ** send warning message to say fields are not the same.             CFT009
      *                                                                   CFT009
     C           WMSC05    IFNE *ZEROS                                    CFT009
     C           WRNA,Z    IFEQ ' '                                       CFT009
     C           S0ACTD    ANDNE'E'                                       CFT009
     C                     MOVEL'Y'       E#WARN                          CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELS0M5CD    FTMSDT    P                     CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3175' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       I0M5CD                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   E#RSND                          CFT009
     C                     MOVEA'Y'       WRNA,Z                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C           EXM5CH    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/CCYCNV                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  CCYCNV - Currenct conversion                                 *   CFT009
      *                                                               *   CFT009
      *  Called By: SRTRCM Subroutine                                 *   CFT009
      *             SRCHCM Subroutine                                 *   CFT009
      *             SRTXCH Subroutine                                 *   CFT009
      *             SRCQCH Subroutine                                 *   CFT009
      *             SRCSTH Subroutine                                 *   CFT009
      *             SRSPCH Subroutine                                 *   CFT009
      *             SRMSCH Subroutine                                 *   CFT009
      *             SRM1CH Subroutine                                 *   CFT009
      *             SRM2CH Subroutine                                 *   CFT009
      *             SRM3CH Subroutine                                 *   CFT009
      *             SRM4CH Subroutine                                 *   CFT009
      *             SRM5CH Subroutine                                 *   CFT009
      *             SRSWST Subroutine                                 *   CFT009
      *  Calls:                                                       *   CFT009
      *  AOCURRRO                                                     *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           CCYCNV    BEGSR                           *** CCYCNV**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'CCYCNV'  @STK,Q                          CFT009
      *                                                                   CFT009
     C                     MOVE INCHRT    CVTRAT                          CFT009
      *                                                                   CFT009
     C                     MOVELINCHGC    FRMCCY  3                       CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM FRMCCY    WAJCD   3                       CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
     C                     MOVELA6NBDP    FRMDEC                          CFT009
     C                     MOVELA6MDIN    FRMMD                           CFT009
     C                     MOVELA6SPRT    FRMSPT 138                      CFT009
      *                                                                   CFT009
     C                     MOVELV#RCCY    TOCCY   3                       CFT009
      *                                                                   CFT009
      ** Calculate Charge currency equivalent                             CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM TOCCY     WAJCD   3                       CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
     C                     MOVELA6NBDP    TODEC                           CFT009
     C                     MOVELA6MDIN    TOMDI   1                       CFT009
     C                     MOVELA6SPRT    TOSPT  138                      CFT009
      *                                                                   CFT009
      ** Get the X-rate between from and to ccy.                          CFT009
      *                                                                   CFT009
     C                     MOVELFRMMD     ZMDI1   1                       CFT009
     C                     Z-ADDFRMSPT    ZRATE1 138                      CFT009
      *                                                                   CFT009
     C                     MOVELTOMDI     ZMDI2   1                       CFT009
     C                     Z-ADDTOSPT     ZRATE2 138                      CFT009
      *                                                                   CFT009
     C                     EXSR ZXRATE                                    CFT009
      *                                                                   CFT009
     C                     Z-ADDZRATEX    CHGRAT 138                      CFT009
     C                     Z-ADDZRATEX    CVTRAT                          CFT009
     C                     MOVE ZMDIX     CHGMDI  1                       CFT009
     C                     Z-ADDCVTRAT    F0CHXR                          CFT009
      *                                                                   CFT009
      * If use transaction exchange rate, add it in                       CFT009
     C           CHTRCY    IFEQ 'Y'                                       CFT009
     C                     Z-ADDRATE      CVTRAT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** UNWIND subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/VALID                                                     CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  VALID  - Validate charge codes                               *   CFT009
      *                                                               *   CFT009
      *  Called By: SRTRCM Subroutine                                 *   CFT009
      *             SRCHCM Subroutine                                 *   CFT009
      *             SRTXCH Subroutine                                 *   CFT009
      *             SRCQCH Subroutine                                 *   CFT009
      *             SRCSTH Subroutine                                 *   CFT009
      *             SRSPCH Subroutine                                 *   CFT009
      *             SRMSCH Subroutine                                 *   CFT009
      *             SRM1CH Subroutine                                 *   CFT009
      *             SRM2CH Subroutine                                 *   CFT009
      *             SRM3CH Subroutine                                 *   CFT009
      *             SRM4CH Subroutine                                 *   CFT009
      *             SRM5CH Subroutine                                 *   CFT009
      *             SRSWST Subroutine                                 *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           VALID     BEGSR                           *** VALID **** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'VALID '  @STK,Q                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
     C                     MOVEL*BLANKS   WI0CDE                          CFT009
      *                                                                   CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      ** Check that charge code exists if it does recalculate charges     CFT009
      *                                                                   CFT009
     C           CHGCDE    CHAINFTPCHGL0             90                   CFT009
      *                                                                   CFT009
     C           *IN90     IFEQ *ON                                       CFT009
     C                     MOVEL'Y'       E#MSGS                          CFT009
     C                     MOVELCHGCDE    FTMSDT                          CFT009
     C                     MOVELE#CPGM    FTPGMQ                          CFT009
     C                     MOVEL'FTF3189' FTMSID                          CFT009
     C                     EXSR FTSNMS                                    CFT009
     C                     MOVEL'Y'       WI0CDE  1                       CFT009
     C                     MOVEL'Y'       E#NOUP                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL' '       WI0CDE                          CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** UNWIND subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXVALI    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/DEFLT                                                     CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  DEFLT  - Check charge code defaults and amounts              *   CFT009
      *                                                               *   CFT009
      *  Called By: SRTRCM Subroutine                                 *   CFT009
      *                                                               *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           DEFLT     BEGSR                           *** DEFLT **** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'DEFLT '  @STK,Q                          CFT009
      *                                                                   CFT009
      * Transfer commission                                               CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0TRCD    MTRCM                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWTFCCD    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MTRCM                           CFT009
      *                                                                   CFT009
      * FX change                                                         CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0CHCD    MINCHM                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWFXCHD    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MINCHM                          CFT009
      *                                                                   CFT009
      * Telex                                                             CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0TXCD    MTXCH                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWTXCDE    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MTXCH                           CFT009
      *                                                                   CFT009
      * Cheque                                                            CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0CQCD    MCQCH                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWCHQCD    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MCQCH                           CFT009
      *                                                                   CFT009
      * Advice                                                            CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0ADCD    MADCH                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWADCCD    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MADCH                           CFT009
      *                                                                   CFT009
      * Telephone                                                         CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0TLCD    MTLCH                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWTLCHD    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MTLCH                           CFT009
      *                                                                   CFT009
      * Miscellaneous                                                     CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0MSCD    MMSCH                           CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMISCH    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    MMSCH                           CFT009
      *                                                                   CFT009
      * Miscellaneous 1                                                   CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0M1CD    WMSC01                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMSCH1    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    WMSC01                          CFT009
      *                                                                   CFT009
      * Miscellaneous 2                                                   CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0M2CD    WMSC02                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMSCH2    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    WMSC02                          CFT009
      *                                                                   CFT009
      * Miscellaneous 3                                                   CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0M3CD    WMSC03                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMSCH3    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    WMSC03                          CFT009
      *                                                                   CFT009
      * Miscellaneous 4                                                   CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0M4CD    WMSC04                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMSCH4    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    WMSC04                          CFT009
      *                                                                   CFT009
      * Miscellaneous 5                                                   CFT009
      *                                                                   CFT009
      * Get default value                                                 CFT009
     C           *LIKE     DEFN F0M5CD    WMSC05                          CFT009
     C                     Z-ADD*ZEROS    TOTCHG                          CFT009
     C                     MOVELWMSCH5    CHGCDE                          CFT009
     C                     EXSR RECALC                                    CFT009
     C                     Z-ADDTOTCHG    WMSC05                          CFT009
      *                                                                   CFT009
      ** UNWIND subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXDEFT    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************   CFT009
      /EJECT                                                              CFT009
      *****************************************************************   CFT009
      /TITLE SR/RECALC                                                    CFT009
      *****************************************************************   CFT009
      *                                                               *   CFT009
      *  RECALC - Recalculate chagre code amounts                     *   CFT009
      *                                                               *   CFT009
      *  Called By: SRTRCM Subroutine                                 *   CFT009
      *             SRCHCM Subroutine                                 *   CFT009
      *             SRTXCH Subroutine                                 *   CFT009
      *             SRCQCH Subroutine                                 *   CFT009
      *             SRCSTH Subroutine                                 *   CFT009
      *             SRSPCH Subroutine                                 *   CFT009
      *             SRMSCH Subroutine                                 *   CFT009
      *             SRM1CH Subroutine                                 *   CFT009
      *             SRM2CH Subroutine                                 *   CFT009
      *             SRM3CH Subroutine                                 *   CFT009
      *             SRM4CH Subroutine                                 *   CFT009
      *             SRM5CH Subroutine                                 *   CFT009
      *             SRSWST Subroutine                                 *   CFT009
      *  Calls:                                                       *   CFT009
      *  SRALGN    - Calls ZALIGN.                                    *   CFT009
      *  FTSNMS    - Send message to program message queue.           *   CFT009
      *                                                               *   CFT009
      *****************************************************************   CFT009
      *                                                                   CFT009
     C           RECALC    BEGSR                           *** RECALC**** CFT009
      *                                                                   CFT009
      ** Set up subroutine stack name                                     CFT009
      *                                                                   CFT009
     C                     ADD  1         Q       50                      CFT009
     C                     MOVEL'RECALC'  @STK,Q                          CFT009
      *                                                                   CFT009
     C                     MOVEL*BLANKS   ZFIELD                          CFT009
      *                                                                   CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
      *                                                                   CFT009
      * OUTPUTS:                                                          CFT009
      ** Return Code (10A)                                                CFT009
      ** Payment Amount (13,0)                                            CFT009
      ** Payment Currency (3A)                                            CFT009
      ** Charges Currency (3A)                                            CFT009
      ** Exchange Rate from transaction (13,8)                            CFT009
      ** STP flag (1A)                                                    CFT009
      ** Payment Charge Code (5A)                                         CFT009
      ** Settle Amount (13,0)                                                                 CFT120
      ** Charges to debit of account (12A)                                                    CFT120
      ** Add deduct indicator (1A)                                                            CFT120
      ** Charges to the DR of Currency (3A)                                                   CFT120
      *                                                                   CFT009
     C                     MOVELINCHGC    CHGCCY                          CFT009
     C                     Z-ADDPYAM      PAYAMT                          CFT009
     C                     MOVE PCCY      PAYCCY                          CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'             9090               CFT009
     C                     PARM           @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM CHGCCY    @CCY    3                       CFT009
     C           SDCURR    PARM *BLANKS   DSSDY                           CFT009
     C                     Z-ADDA6SPRT    CHGEXC                          CFT009
      *                                                                   CFT009
      * If use transaction exchange rate, add it in                       CFT009
     C           CHTRCY    IFEQ 'Y'                                       CFT009
     C                     Z-ADDRATE      CHGEXC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           I0CDRT    IFEQ *BLANKS                                   CFT009
     C           I0CDBR    ANDEQ*BLANKS                                   CFT009
     C                     MOVELS0CDRO    PCDRO                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     CALL 'FT000981'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM           PAYAMT 130                      CFT009
     C                     PARM           PAYCCY  3                       CFT009
     C                     PARM V#SMCY    SETCCY  3                       CFT009
     C                     PARM           CHGCCY  3                       CFT009
     C                     PARM           CHGEXC 138                      CFT009
     C                     PARM           STP     1                       CFT009
     C                     PARM           CHGCDE  5                       CFT009
     C                     PARM SMAM      PSMAM  130                      CFT009
     C**********           PARM           PCDRO  12                                    CFT009 CGL029
     C                     PARM           PCDRO  18                                           CGL029
     C                     PARM ADDC      PADDC   1                       CFT009
     C                     PARM *BLANKS   PCDRC   3                                           CFT120
      *                                                                   CFT009
      * RETURNS:                                                          CFT009
      ** Total Charge (13,0)                                              CFT009
      ** Chargeable Amount (13,0)                                         CFT009
      ** Charge per Tier (11 x 13A)                                       CFT009
      ** Amount being charged by Tier (11 x 13A)                          CFT009
     C                     PARM           TOTCHG 130                      CFT009
     C                     PARM           CHGAMT 130                      CFT009
     C                     PARM           PTIERC                          CFT009
     C                     PARM           PTIERA                          CFT009
      *                                                                   CFT009
     C           @RTCD     IFEQ *BLANKS                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM CHGCCY    WAJCD   3                       CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
      ** Database error                                                   CFT009
      *                                                                   CFT009
     C           @RTCD     IFNE *BLANK                                    CFT009
     C                     MOVEL'SDCURRPD'W0FILE                          CFT009
     C                     MOVELCHGCCY    W0KEY                           CFT009
     C                     Z-ADD26        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
     C                     MOVE TOTCHG    ZFIELD                          CFT009
     C                     CALL 'ZEDIT'                9090               CFT009
     C                     PARM           ZFIELD 16                       CFT009
     C                     PARM A6NBDP    ZADEC   10                      CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
     C                     MOVEL'FT000981'W0FILE                          CFT009
     C                     MOVELCHGCDE    W0KEY                           CFT009
     C                     Z-ADD27        W0ERNB                          CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** UNWIND subroutine stack name                                     CFT009
      *                                                                   CFT009
     C           EXRECA    TAG                                            CFT009
     C                     MOVEA*BLANKS   @STK,Q                          CFT009
     C                     SUB  1         Q                               CFT009
      *                                                                   CFT009
     CSR                   ENDSR                                          CFT009
      *                                                                   CFT009
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVATT - Validate VAT flags                                  *
      *                                                               *
      *****************************************************************
     C           SRVATT    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRVATT'  @STK,Q
      *
     C           CFT009    IFNE 'Y'                                       CFT009
      *
      *
      ** Apply VAT flag must be 'Y' or 'N' or blank.  If blank,
      ** default to value retrieved from program FT0005.
      *
     C                     MOVEL*BLANKS   @VCHG  20
     C                     MOVE WVAT1     @VCHG
     C           S0VAT1    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT1
     C                     ELSE
     C           S0VAT1    IFNE 'Y'
     C           S0VAT1    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT1    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT1
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT2     @VCHG
     C           S0VAT2    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT2
     C                     ELSE
     C           S0VAT2    IFNE 'Y'
     C           S0VAT2    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT2    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT2
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT3     @VCHG
     C           S0VAT3    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT3
     C                     ELSE
     C           S0VAT3    IFNE 'Y'
     C           S0VAT3    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT3    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT3
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT4     @VCHG
     C           S0VAT4    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT4
     C                     ELSE
     C           S0VAT4    IFNE 'Y'
     C           S0VAT4    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT4    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT4
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT5     @VCHG
     C           S0VAT5    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT5
     C                     ELSE
     C           S0VAT5    IFNE 'Y'
     C           S0VAT5    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT5    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT5
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT6     @VCHG
     C           S0VAT6    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT6
     C                     ELSE
     C           S0VAT6    IFNE 'Y'
     C           S0VAT6    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT6    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT6
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   @VCHG
     C                     MOVE WVAT7     @VCHG
     C           S0VAT7    IFEQ *BLANKS
     C                     MOVELV#VATT    S0VAT7
     C                     ELSE
     C           S0VAT7    IFNE 'Y'
     C           S0VAT7    ANDNE'N'
     C                     MOVEL'Y'       E#MSGS
     C           S0VAT7    CAT  @VCHG     FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2524' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0VAT7
     C                     MOVEL'Y'       E#NOUP
     C                     ENDIF
     C                     ENDIF
      *                                                                   CFT009
      ** If CFT009 active, default VAT flags to be blank                  CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      * Transfer Commission                                               CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE1    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT1    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT1                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * FX/ Change                                                        CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE2    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT7    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT7                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Telex                                                             CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE3    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT2    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT2                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Cheque                                                            CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE4    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT3    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT3                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Advice                                                            CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE5    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT4    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT4                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Telephone                                                         CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE6    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT5    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT5                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous                                                     CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE7    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VAT6    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VAT6                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous 1                                                   CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE8    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VT9     ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VT9                           CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous 2                                                   CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CDE9    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VT10    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VT10                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous 3                                                   CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CD10    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VT11    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VT11                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous 4                                                   CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CD11    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VT12    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VT12                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Miscellaneous 5                                                   CFT009
     C                     MOVE *BLANK    VATLIN                          CFT009
     C                     MOVE S0CD12    CHGCDE                          CFT009
     C           CHGCDE    IFNE *BLANKS                                   CFT009
     C           S0VT13    ANDEQ*BLANK                                    CFT009
     C                     EXSR VALID                                     CFT009
     C                     MOVELVATLIN    S0VT13                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXVATT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVATC - VAT Calculation                                     *
      *                                                               *
      *****************************************************************
     C           SRVATC    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRVATC'  @STK,Q
      *
     C                     Z-ADD0         F0VATD
     C                     Z-ADD0         F0VATT
      *                                                                   CFT009
      ** If CFT009 is not turned on, use original processing. Otherwise   CFT009
      ** use new VAT calculation process.                                 CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
      *
      ** If apply VAT flag is 'Y', calculate VAT charge.
      *
      ** .... Transfer commission
      *
     C           S0VAT1    IFEQ 'Y'
     C           F0TRCD    MULT V#VATR    @TVATD 130H
     C           F0TRCM    MULT V#VATR    @TVATT 130H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... Telex
      *
     C           S0VAT2    IFEQ 'Y'
     C           F0TXCD    MULT V#VATR    @TVATD    H
     C           F0TXCH    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... Cheque
      *
     C           S0VAT3    IFEQ 'Y'
     C           F0CQCD    MULT V#VATR    @TVATD    H
     C           F0CQCH    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... Advice
      *
     C           S0VAT4    IFEQ 'Y'
     C           F0ADCD    MULT V#VATR    @TVATD    H
     C           F0ADCH    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... Telephone
      *
     C           S0VAT5    IFEQ 'Y'
     C           F0TLCD    MULT V#VATR    @TVATD    H
     C           F0TLCH    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... Miscellaneous
      *
     C           S0VAT6    IFEQ 'Y'
     C           F0MSCD    MULT V#VATR    @TVATD    H
     C           F0MSCH    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
      ** .... FX/Change commission
      *
     C           S0VAT7    IFEQ 'Y'
     C           S01494    ANDEQ'Y'
     C           F0CHCD    MULT V#VATR    @TVATD    H
     C           F0CHCM    MULT V#VATR    @TVATT    H
     C                     ADD  @TVATD    F0VATD
     C                     ADD  @TVATT    F0VATT
     C                     ENDIF
      *
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 1                                      CFT009
      *                                                                   CFT009
     C           S0VT9     IFEQ 'Y'                                       CFT009
     C           F0M1CD    MULT V#VATR    @TVATD    H                     CFT009
     C           F0M1CH    MULT V#VATR    @TVATT    H                     CFT009
     C                     ADD  @TVATD    F0VATD                          CFT009
     C                     ADD  @TVATT    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 2                                      CFT009
      *                                                                   CFT009
     C           S0VT10    IFEQ 'Y'                                       CFT009
     C           F0M2CD    MULT V#VATR    @TVATD    H                     CFT009
     C           F0M2CH    MULT V#VATR    @TVATT    H                     CFT009
     C                     ADD  @TVATD    F0VATD                          CFT009
     C                     ADD  @TVATT    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 3                                      CFT009
      *                                                                   CFT009
     C           S0VT11    IFEQ 'Y'                                       CFT009
     C           F0M3CD    MULT V#VATR    @TVATD    H                     CFT009
     C           F0M3CH    MULT V#VATR    @TVATT    H                     CFT009
     C                     ADD  @TVATD    F0VATD                          CFT009
     C                     ADD  @TVATT    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 4                                      CFT009
      *                                                                   CFT009
     C           S0VT12    IFEQ 'Y'                                       CFT009
     C           F0M4CD    MULT V#VATR    @TVATD    H                     CFT009
     C           F0M4CH    MULT V#VATR    @TVATT    H                     CFT009
     C                     ADD  @TVATD    F0VATD                          CFT009
     C                     ADD  @TVATT    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 5                                      CFT009
      *                                                                   CFT009
     C           S0VT13    IFEQ 'Y'                                       CFT009
     C           F0M5CD    MULT V#VATR    @TVATD    H                     CFT009
     C           F0M5CH    MULT V#VATR    @TVATT    H                     CFT009
     C                     ADD  @TVATD    F0VATD                          CFT009
     C                     ADD  @TVATT    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** If CFT009 is turned on, calculate the VAT on the total           CFT009
      ** VAT liable charge, not on each separate charge.                  CFT009
      *                                                                   CFT009
     C                     ELSE                                           CFT009
      *                                                                   CFT009
      ** If apply VAT flag is 'Y', calculate VAT charge.                  CFT009
      *                                                                   CFT009
      ** .... Transfer commission                                         CFT009
      *                                                                   CFT009
     C           S0VAT1    IFEQ 'Y'                                       CFT009
     C                     ADD  F0TRCD    F0VATD                          CFT009
     C                     ADD  F0TRCM    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Telex                                                       CFT009
      *                                                                   CFT009
     C           S0VAT2    IFEQ 'Y'                                       CFT009
     C                     ADD  F0TXCD    F0VATD                          CFT009
     C                     ADD  F0TXCH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Cheque                                                      CFT009
      *                                                                   CFT009
     C           S0VAT3    IFEQ 'Y'                                       CFT009
     C                     ADD  F0CQCD    F0VATD                          CFT009
     C                     ADD  F0CQCH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Advice                                                      CFT009
      *                                                                   CFT009
     C           S0VAT4    IFEQ 'Y'                                       CFT009
     C                     ADD  F0ADCD    F0VATD                          CFT009
     C                     ADD  F0ADCH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Telephone                                                   CFT009
      *                                                                   CFT009
     C           S0VAT5    IFEQ 'Y'                                       CFT009
     C                     ADD  F0TLCD    F0VATD                          CFT009
     C                     ADD  F0TLCH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous                                               CFT009
      *                                                                   CFT009
     C           S0VAT6    IFEQ 'Y'                                       CFT009
     C                     ADD  F0MSCD    F0VATD                          CFT009
     C                     ADD  F0MSCH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... FX/Change commission                                        CFT009
      *                                                                   CFT009
     C           S0VAT7    IFEQ 'Y'                                       CFT009
     C           S01494    ANDEQ'Y'                                       CFT009
     C                     ADD  F0CHCD    F0VATD                          CFT009
     C                     ADD  F0CHCM    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 1                                      CFT009
      *                                                                   CFT009
     C           S0VT9     IFEQ 'Y'                                       CFT009
     C                     ADD  F0M1CD    F0VATD                          CFT009
     C                     ADD  F0M1CH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 2                                      CFT009
      *                                                                   CFT009
     C           S0VT10    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M2CD    F0VATD                          CFT009
     C                     ADD  F0M2CH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 3                                      CFT009
      *                                                                   CFT009
     C           S0VT11    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M3CD    F0VATD                          CFT009
     C                     ADD  F0M3CH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 4                                      CFT009
      *                                                                   CFT009
     C           S0VT12    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M4CD    F0VATD                          CFT009
     C                     ADD  F0M4CH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** .... Miscellaneous charge 5                                      CFT009
      *                                                                   CFT009
     C           S0VT13    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M5CD    F0VATD                          CFT009
     C                     ADD  F0M5CH    F0VATT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Multiply totals by VAT rate, to get VAT amount.                  CFT009
      *                                                                   CFT009
     C           F0VATD    MULT V#VATR    F0VATD    H                     CFT009
     C           F0VATT    MULT V#VATR    F0VATT    H                     CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
      ** Unwind subroutine stack name.
      *
     C           EXVATC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTOT - Check Total Charges do not exceed Payment Amount     *
      *                                                               *
      *****************************************************************
     C           SRTOT     BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRTOT '  @STK,Q
      *
      ** If EMU FT Enhancement is switched on then
      ** save work date parameter for call to FT0010 as W#DT.
      *
     C           CEU006    IFEQ 'Y'
     C           V#ADDC    IFEQ 'A'
     C                     Z-ADDV#SLDT    W#DT
     C                     ELSE
     C                     Z-ADDV#PVDT    W#DT
     C                     ENDIF
     C                     ENDIF
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
      *
      ** Transfer Commission Charge
      ** --------------------------
      *
     C           F0TRCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0TRCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0TRCM
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0TRCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN   7
     C                     PARM '*F*T*SPT'W0ACT   8
     C           D#DTA     PARM D#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD004       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0TRCM
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     Z-ADDF0TRCM    TTLCHG 130
      *
      ** Telex Charge
      ** ------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0TXCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0TXCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0TXCH
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0TXCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD005       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0TXCH
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0TXCH    TTLCHG
      *
      ** Cheque Charge
      ** -------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0CQCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0CQCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0CQCH
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0CQCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD006       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0CQCH
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0CQCH    TTLCHG
      *
      ** Advice Charge
      ** -------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0ADCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0ADCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0ADCH
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0ADCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD007       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0ADCH
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0ADCH    TTLCHG
      *
      ** Telephone Charge
      ** ----------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0TLCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0TLCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0TLCH
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0TLCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD008       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0TLCH
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0TLCH    TTLCHG
      *
      ** Miscellaneous Charge
      ** --------------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0MSCD    IFNE 0
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C           V#NWRK    IFEQ 'CASHV8'
     C                     MOVELV#RCCY    P#FRCY
     C                     MOVELV#CCCY    P#TOCY
     C                     ELSE
     C                     MOVELV#CCCY    P#FRCY
     C                     MOVELV#RCCY    P#TOCY
     C                     ENDIF
     C                     Z-ADDF0MSCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C           V#NWRK    IFEQ 'CASHV8'
     C                     Z-ADDF0MSCD    F0MSCH
     C                     Z-ADDP#TOAM    F0MSCD
     C                     ELSE
     C                     Z-ADDP#TOAM    F0MSCH
     C                     ENDIF
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0MSCD    D#FAMT
      *
     C           V#NWRK    IFEQ 'CASHV8'
     C                     MOVELV#RCCY    D#FCCY
     C                     MOVELV#CCCY    D#TCCY
     C                     ELSE
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
     C                     ENDIF
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD009       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C           V#NWRK    IFEQ 'CASHV8'
      *
     C                     Z-ADDF0MSCD    WRK110 110
     C                     Z-ADDD#TAMT    F0MSCD
     C                     Z-ADDWRK110    F0MSCH
      *
     C                     MOVELD#FCCY    WRK3    3
     C                     MOVELD#TCCY    D#FCCY
     C                     MOVELWRK3      D#TCCY
      *
     C                     ELSE
     C                     Z-ADDD#TAMT    F0MSCH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0MSCH    TTLCHG
      *
      ** FX/Change Commission
      ** --------------------
      *
      *                                                                   CFT009
      ** IF CFT009 ACTIVE, ALREADY CALCULATED                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'N'                                       CFT009
     C           F0CHCD    IFNE 0
     C           S01494    ANDEQ'Y'
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
      *
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0CHCD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0CHCM
      *
     C                     ELSE
      *
     C                     CLEARD#DTA
     C                     MOVE F0CHCD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD010       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0CHCM
      *
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF                                          CFT009
      *
     C                     ADD  F0CHCM    TTLCHG
      *
      ** Include VAT amount if VAT processing allowed.
      *
     C           V#VATP    IFEQ 'Y'
     C           F0VATD    ANDNE0
      *
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ELSE                                           CFT009
      *
     C           CEU006    IFEQ 'Y'
      *
      ** If EMU FT Enhancement is switched on then call FT0010.
      *
     C                     CLEARP#0010
     C                     MOVE V#CCCY    P#FRCY
     C                     Z-ADDF0VATD    P#FRAM
     C                     Z-ADDW#DT      P#FRDT
     C                     MOVE V#RCCY    P#TOCY
     C                     Z-ADDW#DT      P#TODT
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    F0VATT
     C*
     C                     ELSE
     C*
     C                     CLEARD#DTA
     C                     MOVE F0VATD    D#FAMT
     C                     MOVELV#CCCY    D#FCCY
     C                     MOVELV#RCCY    D#TCCY
      *
     C                     CALL 'AOCCYCV0'             9090
     C                     PARM *BLANKS   O#RTN
     C                     PARM '*F*T*SPT'W0ACT
     C           D#DTA     PARM D#DTA     O#DTA
      *
     C           *IN90     IFEQ '1'
     C           O#RTN     ORNE *BLANKS
     C                     Z-ADD011       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'AOCCYCV0'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDD#TAMT    F0VATT
      *
     C                     ENDIF
      *
     C                     ENDIF                                          CFT009
     C                     ENDIF
      *
     C                     ADD  F0VATT    TTLCHG
      *
      ** Check that total charges do not exceed payment amount if the
      ** add/deduct indicator is 'D' and 'Charges to the Debit of' has
      ** not been entered.
      *
     C           V#ADDC    IFEQ 'D'
     C           V#CDRT    ANDEQ*BLANKS
      *
      ** Check if total charges are greater than the payment value.
      *
     C           TTLCHG    IFGE V#PYAM
     C           TTLCHG    ANDGT*ZERO                                     CFT009
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL*BLANKS   FTMSDT
     C                     MOVELE#CPGM    FTPGMQ
     C                     MOVEL'FTM2107' FTMSID
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       E#NOUP
      *
      ** Reverse image the Charge fields with amounts in them.
      *
     C           F0TRCM    IFNE 0
     C                     MOVEL'Y'       I0TRCM
     C                     ENDIF
      *
     C           F0TXCH    IFNE 0
     C                     MOVEL'Y'       I0TXCH
     C                     ENDIF
      *
     C           F0CQCH    IFNE 0
     C                     MOVEL'Y'       I0CQCH
     C                     ENDIF
      *
     C           F0ADCH    IFNE 0
     C                     MOVEL'Y'       I0ADCH
     C                     ENDIF
      *
     C           F0TLCH    IFNE 0
     C                     MOVEL'Y'       I0TLCH
     C                     ENDIF
      *
     C           F0MSCH    IFNE 0
     C                     MOVEL'Y'       I0MSCH
     C                     ENDIF
      *
     C           F0CHCM    IFNE 0
     C           S01494    ANDEQ'Y'
     C                     MOVEL'Y'       I0CHCM
     C                     ENDIF
      *                                                                   CFT009
      ** If SAR CFT009 is active                                          CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C           F0M1CH    IFNE 0                                         CFT009
     C                     MOVEL'Y'       I0M1CD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M2CH    IFNE 0                                         CFT009
     C                     MOVEL'Y'       I0M2CD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M3CH    IFNE 0                                         CFT009
     C                     MOVEL'Y'       I0M3CD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M4CH    IFNE 0                                         CFT009
     C                     MOVEL'Y'       I0M4CD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           F0M5CH    IFNE 0                                         CFT009
     C                     MOVEL'Y'       I0M5CD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXTOT     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRRCRM - Validate Receiver's Charges Remitted                *
      *                                                               *
      *****************************************************************
     C           SRRCRM    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRSCHG'  @STK,Q
      *
     C                     Z-ADD0         F0RCRM
     C/COPY WNCPYSRC,FT0359C002
      *
      ** Bypass validation if Receiver's Charges Remitted is blank
      ** and details of charge is not 'OUR'.
      *
     C           S0RCRM    IFEQ *BLANKS
     C           S0DETC    IFNE 'OUR'
     C                     GOTO EXRCRM
     C                     ELSE
     C                     Z-ADDWNBDP2    ZADEC
     C                     MOVE F0RCRM    ZFIELD
     C                     CALL 'ZEDIT'
     C                     PARM           ZFIELD 16
     C                     PARM           ZADEC   10
     C                     MOVE ZFIELD    S0RCRM
     C                     ENDIF
     C                     ENDIF
      *
      ** Entry for Receiver's Charges Remitted is prohibited if
      ** Details of Charges is not 'OUR'.
      *
     C           S0DETC    IFNE 'OUR'
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5032' FTMSID
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       I0RCRM
     C                     MOVE 'Y'       E#NOUP
     C                     GOTO EXRCRM
     C                     ENDIF
      *
      ** Entry must be a valid amount in settle currency.
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELS0RCRM    ZFIELD
     C           11        SUB  WNBDP2    ZADIG
     C                     Z-ADDWNBDP2    ZADEC
      *
     C                     EXSR SRALGN
      *
      ** Send error message if amount is invalid in settle currency.
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5033' FTMSID
     C           S0RCRM    CAT  V#SMCY    FTMSDT    P
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       I0RCRM
     C                     MOVE 'Y'       E#NOUP
     C                     GOTO EXRCRM
     C                     ENDIF
      *
     C                     MOVE ZFIELD    F0RCRM
      *
      ** Send warning msg if Receiever's Charges Remitted is not
      ** equal to total charges.
      *
     C                     MOVE *BLANK    WWRNG   1
      *
     C                     SELEC
      *
     C           V#CCCY    WHEQ V#SMCY
     C                     Z-ADDF0TRCD    WTCHG  150
     C                     ADD  F0TXCD    WTCHG
     C                     ADD  F0CQCD    WTCHG
     C                     ADD  F0ADCD    WTCHG
     C                     ADD  F0TLCD    WTCHG
     C                     ADD  F0MSCD    WTCHG
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M1CD    WTCHG                           CFT009
     C                     ADD  F0M2CD    WTCHG                           CFT009
     C                     ADD  F0M3CD    WTCHG                           CFT009
     C                     ADD  F0M4CD    WTCHG                           CFT009
     C                     ADD  F0M5CD    WTCHG                           CFT009
     C                     ENDIF                                          CFT009
     C           S01494    IFEQ 'Y'
     C                     ADD  F0CHCD    WTCHG
     C                     ENDIF
     C           V#VATP    IFEQ 'Y'
     C                     ADD  F0VATD    WTCHG
     C                     ENDIF
     C           F0RCRM    IFNE WTCHG
     C                     MOVE 'Y'       WWRNG
     C                     ENDIF
      *
     C           V#RCCY    WHEQ V#SMCY
     C                     Z-ADDF0TRCM    WTCHG
     C                     ADD  F0TXCH    WTCHG
     C                     ADD  F0CQCH    WTCHG
     C                     ADD  F0ADCH    WTCHG
     C                     ADD  F0TLCH    WTCHG
     C                     ADD  F0MSCH    WTCHG
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  F0M1CH    WTCHG                           CFT009
     C                     ADD  F0M2CH    WTCHG                           CFT009
     C                     ADD  F0M3CH    WTCHG                           CFT009
     C                     ADD  F0M4CH    WTCHG                           CFT009
     C                     ADD  F0M5CH    WTCHG                           CFT009
     C                     ENDIF                                          CFT009
     C           S01494    IFEQ 'Y'
     C                     ADD  F0CHCM    WTCHG
     C                     ENDIF
     C           V#VATP    IFEQ 'Y'
     C                     ADD  F0VATT    WTCHG
     C                     ENDIF
     C           F0RCRM    IFNE WTCHG
     C                     MOVE 'Y'       WWRNG
     C                     ENDIF
      *
     C                     OTHER
     C                     Z-ADDF0TRCD    WTCHG
     C                     ADD  F0TXCD    WTCHG
     C                     ADD  F0CQCD    WTCHG
     C                     ADD  F0ADCD    WTCHG
     C                     ADD  F0TLCD    WTCHG
     C                     ADD  F0MSCD    WTCHG
     C           S01494    IFEQ 'Y'
     C                     ADD  F0CHCD    WTCHG
     C                     ENDIF
     C           V#VATP    IFEQ 'Y'
     C                     ADD  F0VATD    WTCHG
     C                     ENDIF
     C                     CLEARP#0010
     C                     Z-ADDWTCHG     P#FRAM
     C                     MOVE V#CCCY    P#FRCY
     C                     MOVE V#SMCY    P#TOCY
     C                     Z-ADD*ZERO     P#TOAM
     C                     EXSR SRFT10
     C                     Z-ADDP#TOAM    WTCHG
     C           F0RCRM    IFNE WTCHG
     C                     MOVE 'Y'       WWRNG
     C                     ENDIF
      *
     C                     ENDSL
      *
     C           WWRNG     IFEQ 'Y'
      *
     C           S0RCRM    IFNE SWRCRM
     C           WTCHG     ORNE WWTCHG
     C                     MOVEL'Y'       E#MSGS
     C                     MOVEL'FTM5041' FTMSID
     C                     MOVELE#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       I0RCRM
     C                     MOVEL'Y'       E#WARN
     C                     MOVEL*BLANKS   E#RSND
     C                     MOVEA'Y'       WRNA,1
     C                     MOVELS0RCRM    SWRCRM 12
     C                     Z-ADDWTCHG     WWTCHG 150
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXRCRM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSCHG - Validate Sender's Charges Deducted                  *
      *                                                               *
      *****************************************************************
     C           SRSCHG    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRSCHG'  @STK,Q
      *
     C                     Z-ADD0         F0SCH1
     C                     Z-ADD0         F0SCH2
     C                     Z-ADD0         F0SCH3
     C                     Z-ADD0         F0SCH4
     C                     Z-ADD0         F0SCH5
      *
      ** Go to Exit if no entry for Sender's Charges Deducted.
      *
     C           S0SCCY    IFEQ *BLANKS
     C           S0SCHG    ANDEQ*BLANKS
      *
      ** Default first ccy and amount to settle ccy and zero amount if
      ** details of charges is 'BEN'.
     C           S0DETC    IFEQ 'BEN'
     C*********************MOVE V#SMCY    S0SCC1                          CFT009
     C*********************MOVE 0         S0SCH1                          CFT009
     C                     ELSE
     C                     GOTO EXSCHG
     C                     ENDIF
     C                     ENDIF
      *
      ** Entry for Sender's Charges Deducted is prohibited if
      ** Details of Charges is 'OUR'.
      *
     C           S0DETC    IFEQ 'OUR'
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5034' FTMSID
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0SCCY
     C                     MOVEL'Y'       I0SCHG
     C                     MOVE 'Y'       E#NOUP
     C                     GOTO EXSCHG
     C                     ENDIF
      *
     C                     Z-ADD0         IX      30
     C                     MOVEA*BLANKS   WA1
     C                     MOVEA*BLANKS   WA2
     C                     MOVEA*BLANKS   WA4
     C                     MOVEA*BLANKS   WCCY
     C                     MOVEAS0SCHG    WA1
     C                     MOVEAS0SCCY    WCCY
     C                     MOVE I0SCHG    SCHERR
     C                     MOVEASCHERR    WA2
     C                     MOVE I0SCCY    SCHERR
     C                     MOVEASCHERR    WA4
     C                     Z-ADDF0SCH1    WA3,1
     C                     Z-ADDF0SCH2    WA3,2
     C                     Z-ADDF0SCH3    WA3,3
     C                     Z-ADDF0SCH4    WA3,4
     C                     Z-ADDF0SCH5    WA3,5
      *
     C                     MOVE *BLANK    WERRX   1
      *
      ** Validate currencies and amounts.
      *
     C           IX        DOWLT5
      *
     C                     ADD  1         IX
      *
     C                     Z-ADD*ZEROS    WNBDPX  10
      *
     C           WCCY,IX   IFNE *BLANKS
      *
      ** Access currency details.
      *
     C                     MOVELWCCY,IX   @CCY
     C                     CALL 'AOCURRR0'             9090
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @CCY
     C           SDCURR    PARM *BLANKS   DSSDY
      *
      ** Option ended in error.
      *
     C           *IN90     IFEQ *ON
     C           @RTCD     ORNE *BLANKS
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5042' FTMSID
     C                     MOVELWCCY,IX   FTMSDT    P
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       WA4,IX
     C                     MOVE 'Y'       E#NOUP
     C                     MOVE 'Y'       WERRX
     C                     ELSE
     C                     Z-ADDA6NBDP    WNBDPX
     C                     ENDIF
      *
     C           WA1,IX    IFEQ *BLANK
     C                     MOVE '0'       WA1,IX
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           WA1,IX    IFNE *BLANKS
      *
      ** Amount must only be present if currency is present.
      *
     C           WCCY,IX   IFEQ *BLANK
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5044' FTMSID
     C                     MOVEL*BLANK    FTMSDT
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       WA2,IX
     C                     MOVE 'Y'       E#NOUP
     C                     MOVE 'Y'       WERRX
     C                     ENDIF
      *
      ** Entry must be a valid amount in the currency.
      *
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELWA1,IX    ZFIELD
     C           11        SUB  WNBDPX    ZADIG
     C                     Z-ADDWNBDPX    ZADEC
      *
     C                     EXSR SRALGN
      *
      ** Send error message if amount is invalid in currency.
      *
     C           ZRTN      IFEQ '*ERROR*'
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5036' FTMSID
     C           WA1,IX    CAT  WCCY,IX   FTMSDT    P
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVE 'Y'       WA2,IX
     C                     MOVE 'Y'       E#NOUP
     C                     MOVE 'Y'       WERRX
     C                     ELSE
     C                     MOVE ZFIELD    WA3,IX
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     MOVEAWA2       SCHERR  5
     C                     MOVE SCHERR    I0SCHG
     C                     MOVEAWA4       SCHERR
     C                     MOVE SCHERR    I0SCCY
      *
     C                     Z-ADDWA3,1     F0SCH1
     C                     Z-ADDWA3,2     F0SCH2
     C                     Z-ADDWA3,3     F0SCH3
     C                     Z-ADDWA3,4     F0SCH4
     C                     Z-ADDWA3,5     F0SCH5
      *
     C           WERRX     IFEQ 'Y'
     C                     GOTO EXSCHG
     C                     ENDIF
      *
     C                     MOVELS0SCC2    WSSCCA
     C                     MOVELS0SCC3    WSSCCB
     C                     MOVELS0SCC4    WSSCCC
     C                     MOVELS0SCC5    WSSCCD
      *
     C                     MOVELS0SCC3    WSSCCE
     C                     MOVELS0SCC4    WSSCCF
     C                     MOVELS0SCC5    WSSCCG
      *
     C                     MOVELS0SCC4    WSSCCH
     C                     MOVELS0SCC5    WSSCCI
      *
      ** Check for embedded blank currencies.
      *
     C           S0SCC1    IFEQ *BLANKS
     C           SCC25     ANDNE*BLANKS
     C           S0SCC2    OREQ *BLANKS
     C           SCC35     ANDNE*BLANKS
     C           S0SCC3    OREQ *BLANKS
     C           SCC45     ANDNE*BLANKS
     C           S0SCC4    OREQ *BLANKS
     C           S0SCC5    ANDNE*BLANKS
     C                     MOVE 'Y'       E#MSGS
     C                     MOVEL'FTM5035' FTMSID
     C                     MOVE E#CPGM    FTPGMQ
     C                     EXSR FTSNMS
     C                     MOVEL'Y'       I0SCCY
     C                     MOVE 'Y'       E#NOUP
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXSCHG    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRXVAL - Cross validations                                   *
      *                                                               *
      *****************************************************************
     C           SRXVAL    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRXVAL'  @STK,Q
      *
      ** Unwind subroutine stack name.
      *
     C           EXXVAL    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRALGN - To call ZALIGN                                      *
      *                                                               *
      *****************************************************************
     C           SRALGN    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRALGN'  @STK,Q
      *
     C                     CALL 'ZALIGN'               90
     C                     PARM *BLANKS   ZRTN    7        B:Return Code
     C                     PARM           ZFIELD 16        B:Check Field
     C                     PARM           ZADEC   10       I:No Of Decs
     C                     PARM           ZADIG   20       I:No Of Digits
     C                     PARM *BLANKS   ZAFLD  16        O:Check Field
      *
      ** If return with an error (LR seton in called program) then
      ** process for database error.
      *
     C           *IN90     IFEQ '1'
     C                     Z-ADD012       W0ERNB
     C                     MOVEL'*CALL'   W0KEY
     C                     MOVEL'ZALIGN  'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXALGN    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFT10 - Calculates Currency Amounts for EMU                 *
      *           Converts P#FRAM in P#FRCY -> P#TOAM in P#TOCY.      *
      *                                                               *
      *****************************************************************
     C           SRFT10    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRFT10'  @STK,Q
      *
     C                     CALL 'FT0010'
     C                     PARM           P#0010
      *
      ** Check if database error occurred.
      *
     C           P#RTCD    IFNE *BLANKS
     C                     Z-ADD013       W0ERNB
     C                     MOVELP#TOCY    W0KEY
     C                     MOVEL'FT0010  'W0FILE
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Unwind subroutine stack name.
      *
     C           EXFT10    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRACT - Undefined action - error                             *
      *                                                               *
      *****************************************************************
     C           SRACT     BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRACT '  @STK,Q
      *
      ** Database error if undefined action.
      *
     C                     Z-ADD014       W0ERNB
     C                     MOVELW0ACT     W0KEY
     C                     MOVEL'*ACTION 'W0FILE
     C                     MOVEL'MEM5006' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
      *
      ** Unwind subroutine stack name.
      *
     C           EXACT     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT - Initialisation routine                              *
      *                                                               *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      ** Set up subroutine stack name.
      *
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      ** Set up Copyright Statement.
      *
     C                     MOVEACPY@      BIS@   80
      *
      ** Get Rundate information.
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
      *
      ** Access GL ICD details.
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      ** Database error
      *
     C           @RTCD     IFNE *BLANKS
     C                     Z-ADD015       W0ERNB
     C                     MOVEL'*FIRST'  W0KEY
     C                     MOVEL'SDGELRPD'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Access SAR details file to determine if S01494 is switched ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01494'  @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** If core feature is switched ON, set a variable field to
      ** condition the rest of the processing.
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01494  1
     C                     ELSE
      *
      ** Else, database error (return code other than *NRF).
      *
     C           @RTCD     IFNE '*NRF   '
     C                     Z-ADD016       W0ERNB
     C                     MOVEL'S01494'  W0KEY
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      ** Access SAR details file to determine if CEU006 is switched ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CEU006'  @SARD
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** If core feature is switched ON, set a variable field to
      ** condition the rest of the processing.
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CEU006  1
     C                     ELSE
      *
      ** Else, database error (return code other than *NRF).
      *
     C           @RTCD     IFNE '*NRF   '
     C                     Z-ADD017       W0ERNB
     C                     MOVEL'CEU006'  W0KEY
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      ** Access SAR details file to determine if CFT014 is switched ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY '@OPTN
     C                     PARM 'CFT014'  @SARD
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** If core feature is switched ON, set a variable field to
      ** condition the rest of the processing.
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CFT014  1
     C                     ELSE
      *
     C           @RTCD     IFNE '*NRF   '
     C                     Z-ADD018       W0ERNB
     C                     MOVEL'CFT014'  W0KEY
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*VERIFY '@OPTN                           CFT009
     C                     PARM 'CFT009'  @SARD   6                       CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
     C           @RTCD     IFNE *BLANKS                                   CFT009
     C           @RTCD     ANDNE'*NRF   '                                 CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     Z-ADD22        W0ERNB                          CFT009
     C                     MOVEL'CFT009'  W0KEY                           CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           @RTCD     IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT009                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*VERIFY '@OPTN                           CFT009
     C                     PARM 'CFT010'  @SARD                           CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
     C           @RTCD     IFNE *BLANKS                                   CFT009
     C           @RTCD     ANDNE'*NRF   '                                 CFT009
     C                     MOVEL'SCSARDPD'W0FILE                          CFT009
     C                     Z-ADD23        W0ERNB                          CFT009
     C                     MOVEL'CFT010'  W0KEY                           CFT009
     C                     MOVEL'MEM5003' W0MSGD                          CFT009
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT009
     C                     EXSR SRERR                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C           @RTCD     IFEQ *BLANKS                                   CFT009
     C                     MOVE 'Y'       CFT010  1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT010                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                                       219241
      ** If CFT014 is installed, read SDMGMEPD                                                219241
      *                                                                                       219241
     C           CFT014    IFEQ 'Y'                                                           219241
      *                                                                                       219241
     C                     CALL 'AOMGMER1'                                                    219241
     C                     PARM *BLANKS   P@RTCD                                              219241
     C                     PARM '*FIRST'  P@OPTN                                              219241
     C           SDMGME    PARM SDMGME    DSSDY                                               219241
      *                                                                                       219241
     C           P@RTCD    IFNE *BLANKS                                                       219241
     C                     MOVEL'SDMGMEPD'W0FILE                                              219241
     C                     MOVELP@OPTN    W0KEY                                               219241
     C                     Z-ADD28        W0ERNB                                              219241
     C                     MOVEL'MEM5003' W0MSGD                                              219241
     C                     MOVEL'MIDAS  ' W0MSGF                                              219241
     C                     EXSR SRERR                                                         219241
     C                     ENDIF                                                              219241
      *                                                                                       219241
     C                     ENDIF                                                              219241
      *                                                                   CFT009
      ** Funds Transfer Standing Data                                     CFT009
      *                                                                   CFT009
     C                     CALL 'AOFTFRR0'                                CFT009
     C                     PARM '*DBERR ' @RTCD   7                       CFT009
     C                     PARM '*FIRST ' @OPTN   7                       CFT009
     C           SDFTFR    PARM SDFTFR    DSFDY                           CFT009
      *                                                                   CFT009
      *  Extract bank details                                             CFT009
      *                                                                   CFT009
     C                     CALL 'AOBANKR0'             9090               CFT009
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CFT009
     C                     PARM '*FIRST ' P@OPTN  7        I:Option       CFT009
     C           SDBANK    PARM SDBANK    DSFDY                           CFT009
      *
      ** Access Currency details of Settlement Currency.
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM V#SMCY    @CCY
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** Database error
      *
     C           @RTCD     IFNE *BLANK
     C                     Z-ADD019       W0ERNB
     C                     MOVELV#SMCY    W0KEY
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Save In Ccy Indicator for Settlement Currency as #INCYS and
      ** save Transition Start Date for Settlement Currency as #TPSDS.
      ** Save also No. of Decimal Places for settle currency as WNBDP2.
      *
     C                     MOVE A6INCY    #INCYS  1
     C                     Z-ADDA6TPSD    #TPSDS  50
     C                     Z-ADDA6NBDP    WNBDP2  10
      *
      ** Access Currency details of Pay Currency.
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM V#PCCY    @CCY
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** Database error
      *
     C           @RTCD     IFNE *BLANK
     C                     Z-ADD020       W0ERNB
     C                     MOVELV#PCCY    W0KEY
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Save In Ccy Indicator for Pay Currency as #INCYP and
      ** save Transition Start Date for Pay Currency as #TPSDP.
      *
     C                     MOVE A6INCY    #INCYP  1
     C                     Z-ADDA6TPSD    #TPSDP  50
      *
      ** Retrieve the text for Transfer Commission using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2544' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT1  20
      *
      ** Retrieve the text for Telex Charge using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2545' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT2  20
      *
      ** Retrieve the text for Cheque Charge using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2546' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT3  20
      *
      ** Retrieve the text for Advice charge using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM5039' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT4  20
      *
      ** Retrieve the text for Telephone charge using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM5040' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT5  20
      *
      ** Retrieve the text for Miscellaneous Charge using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2549' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT6  20
      *
      ** Retrieve the text for FX/Change Commission using MEC1150.
      *
     C                     CALL 'MEC1150'              9090
     C                     PARM 'FTM2550' #MSGID
     C                     PARM 'FTUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    WVAT7  20
     C/COPY WNCPYSRC,FT0359C001
      ** Unwind subroutine stack name.
      *
     C           EXINIT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *
     C/COPY ZSRSRC,ZXRATEZ1                                               CFT009
     C/COPY FTCPYSRC,SRERRC
      *
     C/COPY FTCPYSRC,SFTSNMSC
      *
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
