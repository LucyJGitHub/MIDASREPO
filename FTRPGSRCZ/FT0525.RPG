     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Incoming payments unauthorised report')       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0525 - Incoming Payments Reporting                         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CFT120             Date 28Sep12               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG433             Date 05Dec05               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 19Jul00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU006             Date 01Apr98               *
      *                 074815             Date 19Jul94               *
      *                 S01499             Date 06Jun94               *
     F*                 S01494             DATE 25MAY94               *
     F*                 068172             DATE 18DEC93               *
     F*                 S01435             DATE 08SEP93               *
     F*                 055293             DATE 17MAY93               *
     F*                 S01414             DATE 29MAR93               *
     F*                 S01117             DATE 08/11/90              *
     F*                 S01194             DATE 08/11/90              *
     F*                 S01195             DATE 08/11/90              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature                            *
      *  CSW209 - SWIFT 2009 Changes                                  *
      *  CFT032 - Account Line in Field 50X in MT103                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG433 - Recompiled due to change in FTPCHGPD                *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFT009 - FT Fees and Charge Development - changes to         *
      *           processing and printer file to cope with new        *
      *           charges.                                            *
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *  CEU006 - EMU FT Payments and Settlement.                     *
     F*  074815 - Charge currency is sometimes incorrect              *
     F*           Fixed during development of S01494.                 *
     F*  S01499 - BLI V.A.T. Processing                               *
     F*  S01494 - BLI Funds Transfer Enhancements                     *
     F*  068172 - ADD 1 LINE TO SET XCCY TO SMCY BEFOR THE CALL TO    *
     F*           FT0315 FOR ORDERING CUSTOMER.  MOVE BACK PCCY TO    *
     F*           XCCY RIGHT AFTER THE CALL TO FT0315.                *
     F*  S01435 - Incoming Message Management.                        *
     F*  055293 - Include account with institution details and        *
     F*           Receivers Correspondent from Swift Message .        *
     F*  S01414 - Book Code and Profit Centre Incorporation.          *
     F*  S01117 - MULTI BRANCHING INCORPORATION , RCF PROCESSING      *
     F*  S01194 - DATABASE HANDLING                                   *
     F*  S01195 - HOLIDAYS PROCESSING                                 *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       20      FIRST CYCLE PROCESSING HAS BEEN DONE
     F*       21      THERE HAS BEEN OUTPUT
     F*       22      MULTI BRANCHING INDICATOR                           S01117
     F*       23      ORIGINATING BRANCH USED INDICATOR                   S01117
     F*       24      CHANGE OF BRANCH INDICATOR                          S01117
     F*       25      SYSTEM LEVEL INDICATOR                              S01117
     F*       26      ORIGINATING/BOOKING BRANCH INDICATOR (ON IF ORIG BR)S01117
     F*       27      CORE FEATURE S01494 IS SWITCHED ON                  S01494
     F*       28      CORE FEATURE S01499 IS SWITCHED ON                  S01499
     F*       29      Core feature CFT009 is switched on                  CFT009
     F*       30      DBERR - no record found on charges extension file   CFT009
      *  55    - Notified Delivery Amount is not zero.                    CEU006
     F*       70      Profit Centres In Use Flag                          S01414
     F*       77      Switchable feature CFT014 is installed.             CFT014
     F*       88      Switchable feature CEU006 is installed.             CFT014
     F*       89      GENERAL WORK INDICATOR
     F********98******ZSYSTM,*DATE*FORMAT*MMDDYY*IF*ON.*                  S01117
     F********99******ZSYSTM,*INSTALLATION*CONTROL*DATA*RECORD*NOT*FOUND.*S01117
     F*       98      SYSTEM, DATE FORMAT MMDDYY IF ON.                   S01117
     F*       99      SYSTEM, INSTALLATION CONTROL DATA RECORD NOT FOUND. S01117
     F**
     F*     U7 & U8   DATABASE ERROR, REQUIRED RECORDS NOT FOUND.
     F*     U8 ONLY   FILE CONTROL ERROR
     F*****************************************************************
     F/EJECT
     F*NINPY***IP**E***********K********DISK                              S01117
     FNINPYBB IP  E           K        DISK                               S01117
     F                                              KINFSR FILESR
     FINPAYXL2IF  E           K        DISK                           UC  CFT014
      * Incoming Payments Details Extension retrieval index               CFT014
      *                                                                   CFT014
     FINPAYXL0IF  E           K        DISK                               CFT009
     F                                              KINFSR FILESR         CFT009
     FTABFP   IF  E           K        DISK
     F                                              KINFSR FILESR
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F************TABLETJF                          KIGNORE               S01195
     F            TABLETPF                          KIGNORE
     FCLINT   IF  E           K        DISK
     F                                              KINFSR FILESR
     F            CLINTCAF                          KIGNORE
     F            CLINTCBF                          KIGNORE
     F*ACNUMA**IF  E           K        DISK                              S01435
     F*********                                     KINFSR FILESR         S01435
     F*********   ACCNTABF                          KRENAMEACNUMAR        S01435
      *
     FMUSER   IF  E           K        DISK                               S01435
     F*FT0525P2O***E********************PRINTER                           S01117
     FFT0525AUO   E                    PRINTER      KINFDS SPOOLU         S01117
     F                                              KINFSR FILESR         S01117
     F*FT0525P1O***E********************PRINTER                           S01117
     FFT0525P1O   E                    PRINTER      KINFDS SPOOL1     UC  S01117
     F                                              KINFSR FILESR         S01117
     F/COPY WNCPYSRC,FT0525F001
     FFTPCHGL0IF  E           K        DISK                               CFT009
     E                    CPY@    1   1 80
     E                    WA1        15  1               UGFRMT SR.ARRY
     E                    WA2        20  1               UGFRMT SR.ARRY
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
      *                                                                   CEU006
     E/COPY ZSRSRC,ZSEDITZ1                                               CEU006
     E/COPY ZSRSRC,ZEDITZ1                                                CFT009
     E                    DESC    1   5 30                                CFT009
      /EJECT
     I*                                                                   S01117
     I** RENAME OF INPAYDDF FORMAT IN NINPYBB TO AVOID CORRUPTION         S01117
     I** FROM ACNUMA                                                      S01117
     I*                                                                   S01117
     IINPAYDDF                                                            S01117
     I              BRCA                            BRCH                  S01117
      **************                                                      S01435
     I**************                                                S01414S01435
     I**Rename*of*ACNUMA Profit Centre to avoid overwriting         S01414S01435
     I**************                                                S01117S01435
     I*ACNUMAR******                                                S01117S01435
     I**************PRFC                            ACPRFC          S01414S01435
     I**************                                                S01414S01435
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I**  DATA AREA LDA - USED IN THE EVENT OF DATABASE ERRORS
     I*
     ILDA         DS                            256
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 177 DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 183 DBASE                 S01194
      *
      *     DATA AREA FOR PROGRAM STATUS DISK AREA
     IPSDS       SDS
     I                                      244 253 WID
     I                                      254 263 USRID
     I                                     *PROGRAM @PGM
     I                                      201 208 @FILE
      *
      *****************************************************************
      *  Data Structures for addresses.
      *
      ** OUT data structures (printout)
      *
      ** Senders .
     IP1SDDS      DS
     I                                        1  35 P1SND1
     I                                       36  70 P1SND2
     I                                       71 105 P1SND3
     I                                      106 140 P1SND4
     I                                      141 175 P1SND5
      *                                                                   CFT014
      ** Receiver's Correspondent                                         CFT014
      *                                                                   CFT014
     IRECODS      DS                                                      CFT014
     I                                        1  35 INRCO1                CFT014
     I                                       36  70 INRCO2                CFT014
     I                                       71 105 INRCO3                CFT014
     I                                      106 140 INRCO4                CFT014
     I                                      141 175 INRCO5                CFT014
      *
      ** Senders correspondent
     IP1SNDS      DS
     I                                        1  35 P1SNC1
     I                                       36  70 P1SNC2
     I                                       71 105 P1SNC3
     I                                      106 140 P1SNC4
     I                                      141 175 P1SNC5
      *
      ** Ordering Customer
     IORCDS       DS
     I                                        1  35 P1ORC1
     I                                       36  70 P1ORC2
     I                                       71 105 P1ORC3
     I                                      106 140 P1ORC4
     I                                      141 175 P1ORC5
      *
      ** Intermediary Bank
     IP1INDS      DS
     I                                        1  35 P1INB1
     I                                       36  70 P1INB2
     I                                       71 105 P1INB3
     I                                      106 140 P1INB4
     I                                      141 175 P1INB5
      *
      ** Ordering Bank
     IORBDS       DS
     I                                        1  35 P1ORB1
     I                                       36  70 P1ORB2
     I                                       71 105 P1ORB3
     I                                      106 140 P1ORB4
     I                                      141 175 P1ORB5
      *
      ** Beneficiary Customer
     IP1BNDS      DS
     I                                        1  35 P1BNC1
     I                                       36  70 P1BNC2
     I                                       71 105 P1BNC3
     I                                      106 140 P1BNC4
     I                                      141 175 P1BNC5
      *                                                                   S01435
      ** Account with Bank                                                S01435
     IP1ACDS      DS                                                      S01435
     I                                        1  35 P1ACB1                S01435
     I                                       36  70 P1ACB2                S01435
     I                                       71 105 P1ACB3                S01435
     I                                      106 140 P1ACB4                S01435
     I                                      141 175 P1ACB5                S01435
      *                                                                   S01435
      ** Receiver's Correspondent                                         S01435
     IP1RCDS      DS                                                      S01435
     I                                        1  35 P1RCO1                S01435
     I                                       36  70 P1RCO2                S01435
     I                                       71 105 P1RCO3                S01435
     I                                      106 140 P1RCO4                S01435
     I                                      141 175 P1RCO5                S01435
      *
      *
      ** IN data structures (file)
      *
      ** Senders .
     ISDINDS      DS
     I                                        1  35 SND1
     I                                       36  70 SND2
     I                                       71 105 SND3
     I                                      106 140 SND4
     I                                      141 175 SND5
      *
      ** Senders correspondent
     ISNINDS      DS
     I                                        1  35 SNC1
     I                                       36  70 SNC2
     I                                       71 105 SNC3
     I                                      106 140 SNC4
     I                                      141 175 SNC5
      *
      ** Ordering Customer
     IORCDSI      DS                            175
     I                                        1  35 ORC1
     I                                       36  70 ORC2
     I                                       71 105 ORC3
     I                                      106 140 ORC4
     I                                      141 175 ORC5                                      CFT032
      *
      *
      ** Intermediary Bank
     IININDS      DS
     I                                        1  35 INB1
     I                                       36  70 INB2
     I                                       71 105 INB3
     I                                      106 140 INB4
     I                                      141 175 INB5
      *
      ** Ordering Bank
     IORBDSI      DS
     I                                        1  35 ORB1
     I                                       36  70 ORB2
     I                                       71 105 ORB3
     I                                      106 140 ORB4
     I                                      141 175 ORB5
      *
      ** Beneficiary Customer
     IBNINDS      DS
     I                                        1  35 BNC1
     I                                       36  70 BNC2
     I                                       71 105 BNC3
     I                                      106 140 BNC4
     I                                      141 175 BNC5
      *****************************************************************
      *  Data Structure for GETADD.
      *
      *
      ** Client name & address
     ICLINTD      DS
     I                                        1  35 CNA1
     I                                       36  70 CNA2
     I                                       71 105 CNA3
     I                                      106 140 CNA4
      *
      ** Split name into components.
     IXNAMDS      DS                            175
     I**********                              1  12 XACCT                              S01435 CGL029
     I**********                             13  15 XBRCA                              S01435 CGL029
     I                                        1  18 XACCT                                     CGL029
     I                                       19  21 XBRCA                                     CGL029
     I                                        1  35 DS1T35
     I                                        1  100DS1T10
     I                                        1   60DS1T6
     I                                        1   5 DS1T5
      *
      **            address lines 2 - 5.
     I                                       36 175 XADDS
      *
      ** to define XTYPE.
     IXTYPE       DS                              1
      *
      *****************************************************************
      *****************************************************************
      *
      ** Table key (using CCY,Nostro).
     IKYTABL      DS                             12
     I                                        1   2 CONS70
     I** INFDS for P1 file .                                              S01117
     ISPOOL1      DS                                                      S01117
     I                                       83  90 SFIL1                 S01117
     I                                    B 123 1240SFNUM1                S01117
     I** INFDS for AU file                                                S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  90 SFILU                 S01117
     I                                    B 123 1240SFNUMU                S01117
     I*                                                                   S01117
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 CFT014
      ** 2ND DS for access program , long data structure                  CFT014
      *                                                                   CFT014
     ISDGELR    E DSSDGELRPD                                              S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     ISDFTFR    E DSSDFTFRPD                                              S01435
      *                                                                   S01435
      * Funds Transfer Details *                                          S01435
      *                                                                   S01435
     ISCSARD    E DSSCSARDPD                                              S01494
     I** External data structure for SAR file details                     S01494
     ISDCURR    E DSSDCURRPD                                              CFT014
      ** External Data structure for currencies file                      CFT014
      *                                                                   CFT014
      /EJECT                                                              S01435
     IW8FT        DS                            128                       S01435
      *                                                                   S01435
      * Address data structure                                            S01435
      *                                                                   S01435
      * Currency                                                          S01435
     I                                        1   3 W8CCY                 S01435
      * Settlement Type                                                   S01435
     I                                        4   5 W8STMT                S01435
      * Mandatory Text - convert BIC identifiers                          S01435
     I                                        6   6 W8MTXT                S01435
      * Message Tag                                                       S01435
     I                                        7  11 W8MTAG                S01435
      * Construct of data in field                                        S01435
     I                                       12  12 W8TYPE                S01435
      * Number of Lines available                                         S01435
     I                                       13  140W8NLIN                S01435
      * Network and Message Type                                          S01435
     I                                       15  20 W8NWRK                S01435
     I                                       21  23 W8MTPY                S01435
      * Calling Program                                                   S01435
     I                                       24  33 W8CPGM                S01435
      * Action *PRINT/*ENQ/*MSG GEN                                       S01435
     I                                       34  41 W8ACT                 S01435
      * Critical reporting - Database error if 'Y'                        S01435
      * If no BIC directory and BIC entered no error                      S01435
     I                                       42  42 W8CRIT                S01435
      * Force Midas Address - where possible                              S01435
     I                                       43  43 W8MADD                S01435
      * If Retail get first address from account                          S01435
     I                                       44  44 W8RTAD                S01435
      * Alternative Address                                               S01435
     I                                       45  45 W8ALTN                S01435
      * Address type selected in W0MSG                                    S01435
     I                                       46  46 W8ADTP                S01435
      *                                                                   S01435
     IDSMTR       DS                                                      S01435
      *                                                                   S01435
      *  Define fields for message transalation                           S01435
      *                                                                   S01435
     I                                        1 132 #MSDTA                S01435
     I                                       15  30 #MPREF                S01435
     I                                    P   1   20#MPART                S01435
     I                                      133 264 #MSTX1                S01435
     I#MSTX2      DS                                                      S01435
     I                                        1 256 #MSTXA                S01435
     I                                      257 512 #MSTXB                S01435
     I/COPY WNCPYSRC,FT0525I001
      *                                                                                       CSW209
      ** FT OUTGOING PAYMENTS EXTENSION FILE                                                  CSW209
      ** DS TO CHECK IF COVER FIELDS ARE EMPTY                                                CSW209
     IINPAYX    E DSINPAYXPD                                                                  CSW209
      *                                                                                       CSW209
     I                                      8521107 WMASP1                                    CSW209
     I                                     11081362 WMASP2                                    CSW209
     I                                     13631617 WMASP3                                    CSW209
     I                                     16181872 WMASP4                                    CSW209
     I                                     18732083 WMASP5                                    CSW209
     I                                     20842097 WMASP6                                    CSW209
      *                                                                                       CSW209
      *                                                                   CEU006
     I/COPY ZSRSRC,ZSEDITZ2                                               CEU006
      /EJECT
     C                     MOVEACPY@      BIS@   80
     C           *LIKE     DEFN DBKEY     @KEY
     C           *LIKE     DEFN DBASE     @ASE
     C*****************************************************************
     C*                 AA-MAINLINE-PROCESSING                        *
     C*                                                               *
     C*  FUNCTION : TO CONTROL THE PROCESSING OF EACH RECORD READ VIA *
     C*             THE LOGIC CYCLE.                                  *
     C*                                                               *
     C*  CALLS :    CAINIT                                            *
     C*             CCDETL                                            *
     C*             CELAST                                            *
     C*             GLZADD                                            *
     C*                                                               *
     C*  CALLED BY: NONE                                              *
     C*                                                               *
     C*****************************************************************
     C*
     C** SAVE FIELDS FROM INPUT FILES WHICH MAY BE OVERWRITTEN BY OTHER
     C** FILE ACCESSES
     C*
     C                     MOVELRECI      OTRECI
     C                     Z-ADDLCD       OTLCD
     C                     MOVELCHTP      OTCHTP
      *
      ** PERFORM INITIAL PROCESSING IF FIRST CYCLE **
      *
     C           *IN20     IFEQ '0'
     C                     EXSR CAINIT
     C                     END
      *                                                                   CFT009
      ** If FT fees and charges SAR, CFT009 on, chain off to get          CFT009
      ** extra fees information. If no record found, database error.      CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C           PREF      CHAININPAYXL0             30                   CFT009
      *                                                                   CFT009
     C           *IN30     IFEQ '1'                                       CFT009
     C                     MOVELPREF      WDBKEY           ***************CFT009
     C                     MOVEL'INPAYXL0'WDBFIL           * DB ERROR 43 *CFT009
     C                     MOVEL'043'     WDBASE           ***************CFT009
     C                     EXSR UEABRT                                    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * FX SPREAD SET CODE AND PAYMENT DATE OFFSET                        CFT009
     C                     MOVELFXSPSC    P1FXSP                          CFT009
     C                     MOVELINPDOF    P1PDOF                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01117
     C           *IN26     IFEQ '1'                                       S01117
     C                     MOVE ORBR      BRANCH  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCH      BRANCH                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   If multi branched , check branch code is valid.                S01117
     C**   If so , output branch name                                     S01117
     C*                                                                   S01117
     C           *IN22     IFEQ '1'                        B001           S01117
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM BRANCH    @BRCD   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                    B002           S01194
     C                     MOVELBRANCH    WDBKEY           ***************S01194
     C                     MOVEL'SDBRCHPD'WDBFIL           * DB ERROR 14 *S01194
     C                     MOVEL'014'     WDBASE           ***************S01194
     C                     EXSR UEABRT                                    S01194
     C                     ELSE                                           S01117
     C                     MOVE BRANCH    P1BRC1                          S01117
     C                     MOVE A8BRNM    P1BRNM                          S01117
     C*                                                                   S01117
     C** Set up 2nd branch fields with originating branch                 S01117
     C*                                                                   S01117
     C           *IN26     IFEQ '0'                        B003           S01117
     C           *IN23     IFEQ '1'                        B004           S01117
     C                     MOVE ORBR      KBRCH   3                       S01117
     C                     EXSR AOBRC2                                    S01117
     C                     MOVE KBRCH     P1BRC2                          S01117
     C                     MOVE A8BRNM    P1BNM2                          S01117
     C                     END                             E004           S01117
     C*                                                                   S01117
     C** Else , set up with booking branch                                S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCH      KBRCH                           S01117
     C                     EXSR AOBRC2                                    S01117
     C                     MOVE KBRCH     P1BRC2                          S01117
     C                     MOVE A8BRNM    P1BNM2                          S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C                     END                             E002           S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C** If single branch report requested and branch reading has         S01117
     C** changed to another,terminate program.                            S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'B'                                       S01117
     C           @RENT     ANDNE'ALL'                                     S01117
     C           BRANCH    ANDNE@RENT                                     S01117
     C                     SETON                     24                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN24     IFEQ '0'                                B01    S01117
     C           STBRCA    IFEQ *BLANKS                                   S01117
     C           @RLEV     OREQ 'B'                                       S01117
     C           STBRCA    ANDNEBRANCH                                    S01117
     C           @RENT     ANDEQ'ALL'                                     S01117
     C*                                                                   S01117
     C** Set up entity for call to ZSFILE                                 S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'S'                                       S01117
     C                     MOVE *BLANKS   ZSENT   3                       S01117
     C                     ELSE                                           S01117
     C           @RLEV     IFEQ 'B'                                       S01117
     C           @RENT     ANDEQ'ALL'                                     S01117
     C                     MOVE BRANCH    ZSENT                           S01117
     C                     ELSE                                           S01117
     C                     MOVE @RENT     ZSENT                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  If @RENT is 'ALL' and a change of branch is detected,           S01117
     C**  write record format ending report                               S01117
     C*                                                                   S01117
     C           BRANCH    IFNE STBRCA                                    S01117
     C           @RENT     ANDEQ'ALL'                                     S01117
     C           *IN21     ANDEQ'1'                                       S01117
     C                     WRITEP1EOR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** Generate new spool file                                          S01117
     C*                                                                   S01117
     C                     CLOSEFT0525P1                                  S01117
     C                     OPEN FT0525P1                                  S01117
     C                     Z-ADD0         PAGE                            S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ                           S01117
     C                     PARM           ZSENT                           S01117
     C                     PARM SFIL1     SFILP  10                       S01117
     C                     PARM SFNUM1    SPLNO   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C           ZERR      IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   LDA                                       S01194
     C                     MOVEL'FT0525'  DBPGM                           S01194
     C                     MOVEL'FT525P1' DBKEY            ***************S01194
     C                     MOVEL'ZSFILE'  DBFILE           * DB ERROR 12 *S01194
     C                     MOVEL'012'     DBASE            ***************S01194
     C                     OUT  LDA                                       S01194
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** Move new branch to store value                                   S01117
     C*                                                                   S01117
     C                     MOVE BRANCH    STBRCA  3                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C** FOR DETAIL RECORDS :
     C** WRITE A PAGE ON THE DETAIL REPORT IF REPORT TYPE IS 'LIST'
     C** OR REPORT TYPE IS 'AUDIT LIST' & LAST CHANGE DATE IS EQUAL
     C** TO THE SYSTEM DATE
     C*
     C           PARM1     IFNE 'A'                         -NOT AUDIT
     C                     EXSR CCDETL                       LIST.
     C                     ELSE
     C           OTLCD     IFEQ RUND                        -AUDIT LIST
     C                     EXSR CCDETL
     C                     END
     C                     END
     C*
     C** ACCUMULATE VALUES FOR CONTROL CHECK USING SYSTEM SUBROUTINE
     C** GLZADD
     C*
     C*********************ADD  1         P2CLNO                          S01194
     C                     ADD  1         AUCLNO                          S01194
     C                     MOVE SMAM      ZZAMT
     C                     EXSR GLZADD
     C*                                                                   S01117
     C                     END                             E01            S01117
     C*                                                                   S01117
     C           *IN24     IFEQ '1'                                       S01117
     C                     SETON                     LR                   S01117
     C                     END                                            S01117
     C*
     C** PERFORM CONTROL REPORT CHECKS IF TRAILER RECORD
     C*
     CLR                   EXSR CELAST
     C*
     C*          *****     ***
     C           AAEND     TAG
     C*          *****     ***
     C** END OF MAINLINE PROCESSING
     C*
     C/EJECT
     C           CAINIT    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 CA-INITIAL-PROCESSING                         *
     C*                                                               *
     C*  FUNCTION : TO PERFORM PROCESSING ONLY REQUIRED ONCE,ON FIRST *
     C*             CYCLE OF PROGRAM.                                 *
     C*                                                               *
     C*  CALLS :    UATBCN                                            *
     C*             UEABRT                                            *
     C**************ZSYSTM                                            *   S01117
     C*             SYSTEM                                            *   S01117
     C*                                                               *
     C*  CALLED BY: AAMAIN                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C** DECLARE ENTRY PARAMETER - REPORT TYPE
     C*
     C           *ENTRY    PLIST
     C                     PARM           PARM1   1
     C                     PARM           @RSEQ   5                       S01117
     C                     PARM           @RLEV   1                       S01117
     C                     PARM           @RENT   3                       S01117
     C*                                                                   S01117
     C** Set on indicator to display originating branch                   S01117
     C*                                                                   S01117
     C           PARM1     IFEQ 'O'                                       S01117
     C                     SETON                     26                   S01117
     C                     END                                            S01117
      *
      **    Initialize constants .
     C                     MOVE '70'      CONS70
      *
     C*
     C** SETUP REPORT HEADING
     C*
     C           PARM1     IFEQ 'A'
     C                     MOVEL'AUDIT'   P1HEAD
     C                     MOVE 'LIST'    P1HEAD
     C                     MOVEL'~~~~~'   P1DASH
     C                     MOVE '~~~~~'   P1DASH
     C                     ELSE
     C                     MOVEL'LIST'    P1HEAD
     C                     MOVEL'~~~~'    P1DASH
     C                     END
     C*
     C** DECLARE SIMILAR FIELDS
     C*
     C           *NAMVAR   DEFN           LDA
     C           *LIKE     DEFN DBFILE    WDBFIL
     C           *LIKE     DEFN DBKEY     WDBKEY
     C           *LIKE     DEFN DBASE     WDBASE
     C*
     C           *LIKE     DEFN RECI      OTRECI
     C           *LIKE     DEFN LCD       OTLCD
     C           *LIKE     DEFN CHTP      OTCHTP
     C*
     C***CALL*ZSYSTM*TO*ACCESS*I.C.D.R.*1*ON*TABLE*FILE*                  S01117
     C** CALL SYSTEM TO ACCESS I.C.D.R. 1 ON TABLE FILE                   S01117
     C*
     C*********************EXSR ZSYSTM                                    S01117
     C                     EXSR SYSTEM                                    S01117
     C*
     C** CHECK IF DATABASE ERROR OCCURRED
     C*
     C           *IN99     IFEQ '1'
     C                     MOVEL'TABLE'   WDBFIL
     C                     MOVELZTABKY    WDBKEY
     C                     MOVEL'01'      WDBASE
     C                     EXSR UEABRT                     *ABORT PGM*
     C                     END
     C*
     C** SETUP REPORT TITLES & RUN-DATES
     C*
     C                     MOVELTITL      P1TITL
     C*********************MOVELTITL      P2TITL                          S01194
     C                     MOVELTITL      AUTITL                          S01194
     C                     MOVELRUNA      P1DATE
     C*********************MOVELRUNA      P2DATE                          S01194
     C                     MOVELRUNA      AUDATE                          S01194
     C*
     C**********           MOVE *BLANKS   BLNK10 10                                           CGL029
     C**********           MOVE *BLANKS   BLNK2   2                                           CGL029
     C                     MOVE *BLANKS   BLNK10 16                                           CGL029
     C                     MOVE *BLANKS   BLNK2   8                                           CGL029
     C*
     C** CALL UATBCN TO ACCESS I.C.D.R. 2 ON TABLE FILE
     C*
     C                     MOVEL*BLANKS   ZTABKY
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '11'      ZTABKY
     C                     EXSR UATBCN
     C*
     C** CHECK IF DATABASE ERROR OCCURRED
     C*
     C           *IN89     IFEQ '1'
     C                     MOVEL'TABLE'   WDBFIL
     C                     MOVELZTABKY    WDBKEY
     C                     MOVEL'02'      WDBASE
     C                     EXSR UEABRT                     *ABORT PGM*
     C                     END
     C*                                                                   S01414
     C* Move the conditional IF so that AOGELRR0 is always called.        S01414
     C*                                                                   S01117
     C***If*multi*branched*set*on*indicator*for*branch*fields**     S01117S01414
     C*                                                             S01117S01414
     C***********MBIN      IFEQ 'Y'                        B001     S01117S01414
     C***********          SETON                     22             S01117S01414
     C*                                                                   S01117
     C**  Access SDGELRPD for originating branch used flag                S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG  '  P@RTCD  7                       S01194
     C                     PARM '*FIRST'  P@OPTN  7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDGELRPD'WDBFIL           ***************S01194
     C                     MOVELP@OPTN    WDBKEY           * DB ERROR 16 *S01194
     C                     MOVEL'16'      WDBASE           ***************S01194
     C                     EXSR UEABRT                                    S01194
     C                     END                                            S01194
     C*                                                             S01117S01414
     C**  If multi branched set on 22 to display branch fields      S01117S01414
     C*                                                             S01117S01414
     C           MBIN      IFEQ 'Y'                                 S01117S01414
     C                     SETON                     22             S01117S01414
     C*                                                                   S01117
     C**  If Originating Branch Used flag is on , set on *IN23            S01117
     C**  to display originating branch field on print file               S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                        B002           S01117
     C                     SETON                     23                   S01117
     C                     END                             E002           S01117
     C                     END                             E001           S01117
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
     C                     MOVE '1'       *IN70                           S01414
     C                     END                                            S01414
      *                                                                   S01435
      ** Read SDFTFRPD                                                    S01435
      *                                                                   S01435
     C                     CALL 'AOFTFRR0'             90                 S01435
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  S01435
     C                     PARM '*FIRST ' P@OPTN  7        I:Option       S01435
     C           SDFTFR    PARM SDFTFR    DSFDY                           S01435
      *                                                                   S01435
      *  If return with an error (LR seton in called program) then        S01435
      *  process for database error.                                      S01435
      *                                                                   S01435
     C           *IN90     IFEQ '1'                                       S01435
     C           P@RTCD    OREQ '*ERROR*'                                 S01435
     C                     MOVEL'SDFTFRPD'WDBFIL           ***************S01435
     C                     MOVELP@OPTN    WDBKEY           * DB ERROR 16 *S01435
     C                     MOVEL'50'      WDBASE           ***************S01435
     C                     EXSR UEABRT                                    S01435
     C                     END                                            S01435
      *                                                                   S01435
      * Get message text for Account with Bank field                      S01435
      *                                                                   S01435
     C                     CALL 'MEC1150'              9090               S01435
     C                     PARM 'FTM2350 '#MSGID  7                       S01435
     C                     PARM 'FTUSRMSG'#MSGF  10                       S01435
     C                     PARM           #MSDTA                          S01435
     C                     PARM *BLANKS   #MSTX1                          S01435
     C                     PARM *BLANKS   #MSTX2                          S01435
      *                                                                   S01435
     C                     MOVEL#MSTX1    #IMSG  35                       S01435
     C*
     C** CALL UATBCN TO ACCESS CURRENCY RECORD FOR BASE CURRENCY
     C*
     C                     MOVEL*BLANKS   ZTABKY
     C                     MOVEL'20'      ZTABKY
     C                     MOVELBCCY      WA4     4
     C                     MOVE '1'       WA4
     C                     MOVE WA4       ZTABKY
     C                     EXSR UATBCN
     C*
     C** CHECK IF DATABASE ERROR OCCURRED
     C*
     C           *IN89     IFEQ '1'
     C                     MOVEL'TABLE'   WDBFIL
     C                     MOVELZTABKY    WDBKEY
     C                     MOVEL'03'      WDBASE
     C                     EXSR UEABRT                     *ABORT PGM*
     C                     END
     C*
     C** STORE NUMBER OF DECIMAL PLACES FOR BASE CURRENCY
     C*
     C                     Z-ADDCDP       SVBCDP  10
      *                                                                   S01435
      ** Call UATBCN to Access local currency record                      S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   ZTABKY                          S01435
     C                     MOVEL'20'      ZTABKY                          S01435
     C                     MOVELLOCY      WA4                             S01435
     C                     MOVE '1'       WA4                             S01435
     C                     MOVE WA4       ZTABKY                          S01435
     C                     EXSR UATBCN                                    S01435
      *                                                                   S01435
      ** Check if database error occurred                                 S01435
      *                                                                   S01435
     C           *IN89     IFEQ '1'                                       S01435
     C                     MOVEL'TABLE'   WDBFIL                          S01435
     C                     MOVELZTABKY    WDBKEY                          S01435
     C                     MOVEL'51'      WDBASE                          S01435
     C                     EXSR UEABRT                     *ABORT PGM*    S01435
     C                     END                                            S01435
      *                                                                   S01435
      ** Store number of decimal places for base currency                 S01435
      *                                                                   S01435
     C                     Z-ADDCDP       SVLCDP  10                      S01435
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     MOVE '0'       *IN27                           S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   @RTCD   7                       S01494
     C                     PARM '*VERIFY' @OPTN   7                       S01494
     C                     PARM 'S01494'  @SARD   6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set a variable to                S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           @RTCD     IFEQ *BLANKS                                   S01494
     C                     MOVE '1'       *IN27                           S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           @RTCD     IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'WDBFIL                          S01494
     C                     MOVEL'*VERIFY' WDBKEY                          S01494
     C                     MOVEL'40'      WDBASE                          S01494
     C                     EXSR UEABRT                     *ABORT PGM*    S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     MOVE '0'       *IN28                           S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*VERIFY' @OPTN   7                       S01499
     C                     PARM 'S01499'  @SARD   6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set a variable to                S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           @RTCD     IFEQ *BLANKS                                   S01499
     C                     MOVE '1'       *IN28                           S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           @RTCD     IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'WDBFIL                          S01499
     C                     MOVEL'*VERIFY' WDBKEY                          S01499
     C                     MOVEL'41'      WDBASE                          S01499
     C                     EXSR UEABRT                     *ABORT PGM*    S01499
     C                     END                                            S01499
     C                     END                                            S01499
      *                                                                   CFT009
      ** Access SAR details file to determine if CFT009 is switched ON    CFT009
      *                                                                   CFT009
     C                     MOVE '0'       *IN29                           CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM *BLANKS   @RTCD   7                       CFT009
     C                     PARM '*VERIFY' @OPTN   7                       CFT009
     C                     PARM 'CFT009'  @SARD   6                       CFT009
     C           SCSARD    PARM SCSARD    DSFDY                           CFT009
      *                                                                   CFT009
      ** If core feature is switched ON, set a variable to                CFT009
      ** condition the rest of the processing                             CFT009
      *                                                                   CFT009
     C           @RTCD     IFEQ *BLANKS                                   CFT009
     C                     MOVE '1'       *IN29                           CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     ELSE                                           CFT009
     C*                                                                   CFT009
     C** else, database error (return code other than *NRF)               CFT009
     C*                                                                   CFT009
     C           @RTCD     IFNE '*NRF   '                                 CFT009
     C                     MOVEL'SCSARDPD'WDBFIL           ************   CFT009
     C                     MOVEL'*VERIFY' WDBKEY           * DBERR 42 *   CFT009
     C                     MOVEL'42'      WDBASE           ************   CFT009
     C                     EXSR UEABRT                     *ABORT PGM*    CFT009
     C                     END                                            CFT009
     C                     END                                            CFT009
      *                                                                   CFT014
      ** Access SAR details file to determine if CFT014 is switched ON    CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    CFT014  1                       CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM '*VERIFY' @OPTN                           CFT014
     C                     PARM 'CFT014'  @SARD                           CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014                          CFT014
     C                     MOVE *ON       *IN77                           CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE '*NRF   '                                 CFT014
     C                     MOVEL'SCSARDPD'WDBFIL                          CFT014
     C                     MOVEL'CFT014'  WDBKEY                          CFT014
     C                     MOVEL'20'      WDBASE                          CFT014
     C                     EXSR UEABRT                                    CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       CFT014                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** If switchable feature CFT014 is installed, open INPAYXL2.        CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     OPEN INPAYXL2                                  CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Access SAR details file to determine if CEU006 is switched ON    CFT014
      *                                                                   CFT014
     C                     MOVE *BLANK    CEU006  1                       CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM '*VERIFY' @OPTN                           CFT014
     C                     PARM 'CEU006'  @SARD                           CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CEU006                          CFT014
     C                     MOVE *ON       *IN88                           CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE '*NRF   '                                 CFT014
     C                     MOVEL'SCSARDPD'WDBFIL                          CFT014
     C                     MOVEL'CEU006'  WDBKEY                          CFT014
     C                     MOVEL'021'     WDBASE                          CFT014
     C                     EXSR UEABRT                                    CFT014
     C                     ELSE                                           CFT014
     C                     MOVE 'N'       CEU006                          CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CSW209
      ** CHECK IF SWIFT CHANGES 2009 (CSW209) IS INSTALLED                                    CSW209
      *                                                                                       CSW209
     C                     CALL 'SWIF2009'                                                    CSW209
     C                     PARM *BLANKS   @RTCD                                               CSW209
      *                                                                                       CSW209
     C           @RTCD     IFEQ 'CSW2009'                                                     CSW209
     C                     MOVE 'Y'       CSW209  1                                           CSW209
     C                     ELSE                                                               CSW209
     C                     MOVE 'N'       CSW209                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CER030
      ** Check the switchable feature CER031                                                  CER030
      *                                                                                       CER030
     C                     CALL 'AOSARDR0'                                                    CER030
     C                     PARM *BLANKS   PRTCD   7                                           CER030
     C                     PARM '*VERIFY' POPTN   7                                           CER030
     C                     PARM 'CER031'  PSARD   6                                           CER030
     C           SCSARD    PARM SCSARD    DSFDY                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFEQ *BLANKS                                                       CER030
     C                     MOVE 'Y'       CER031  1                                           CER030
     C                     MOVE *ON       *IN34                                               CER030
     C                     ELSE                                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFNE '*NRF   '                                                     CER030
     C                     MOVEL'SCSARDPD'WDBFIL                                              CER030
     C                     MOVEL'CER031'  WDBKEY                                              CER030
     C                     MOVEL'023'     WDBASE                                              CER030
     C                     EXSR UEABRT                                                        CER030
     C                     ELSE                                                               CER030
     C                     MOVE 'N'       CER031                                              CER030
     C                     MOVE *OFF      *IN34                                               CER030
     C                     ENDIF                                                              CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
      ** Check the switchable feature CER030                                                  CER030
      *                                                                                       CER030
     C                     CALL 'AOSARDR0'                                                    CER030
     C                     PARM *BLANKS   PRTCD                                               CER030
     C                     PARM '*VERIFY' POPTN                                               CER030
     C                     PARM 'CER030'  PSARD                                               CER030
     C           SCSARD    PARM SCSARD    DSFDY                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFEQ *BLANKS                                                       CER030
     C                     MOVE 'Y'       CER030  1                                           CER030
     C                     ELSE                                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFNE '*NRF   '                                                     CER030
     C                     MOVEL'SCSARDPD'WDBFIL                                              CER030
     C                     MOVEL'CER030'  WDBKEY                                              CER030
     C                     MOVEL'024'     WDBASE                                              CER030
     C                     EXSR UEABRT                                                        CER030
     C                     ELSE                                                               CER030
     C                     MOVE 'N'       CER030                                              CER030
     C                     ENDIF                                                              CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
      ** Check the switchable feature CGL013                                                  CER030
      *                                                                                       CER030
     C                     CALL 'AOSARDR0'                                                    CER030
     C                     PARM *BLANKS   PRTCD                                               CER030
     C                     PARM '*VERIFY' POPTN                                               CER030
     C                     PARM 'CGL013'  PSARD                                               CER030
     C           SCSARD    PARM SCSARD    DSFDY                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFEQ *BLANKS                                                       CER030
     C                     MOVE 'Y'       CGL013  1                                           CER030
     C                     ELSE                                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFNE '*NRF   '                                                     CER030
     C                     MOVEL'SCSARDPD'WDBFIL                                              CER030
     C                     MOVEL'CGL013'  WDBKEY                                              CER030
     C                     MOVEL'025'     WDBASE                                              CER030
     C                     EXSR UEABRT                                                        CER030
     C                     ELSE                                                               CER030
     C                     MOVE 'N'       CGL013                                              CER030
     C                     ENDIF                                                              CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C           CGL013    IFEQ 'Y'                                                           CER030
     C           CER030    OREQ 'Y'                                                           CER030
     C                     MOVE *ON       *IN35                                               CER030
     C                     ELSE                                                               CER030
     C                     MOVE *OFF      *IN35                                               CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CFT120
      ** Check the switchable feature CFT120                                                  CFT120
      *                                                                                       CFT120
     C                     CALL 'AOSARDR0'                                                    CFT120
     C                     PARM *BLANKS   PRTCD                                               CFT120
     C                     PARM '*VERIFY' POPTN                                               CFT120
     C                     PARM 'CFT120'  PSARD                                               CFT120
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT120
      *                                                                                       CFT120
     C           PRTCD     IFEQ *BLANKS                                                       CFT120
     C                     MOVE 'Y'       CFT120  1                                           CFT120
     C                     MOVE *ON       *IN59                                               CFT120
     C                     ELSE                                                               CFT120
      *                                                                                       CFT120
     C           PRTCD     IFNE '*NRF   '                                                     CFT120
     C                     MOVEL'SCSARDPD'WDBFIL                                              CFT120
     C                     MOVEL'CFT120'  WDBKEY                                              CFT120
     C                     MOVEL'026'     WDBASE                                              CFT120
     C                     EXSR UEABRT                                                        CFT120
     C                     ELSE                                                               CFT120
     C                     MOVE 'N'       CFT120                                              CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C*                                                                   S01117
     C** Set on system level indicator                                    S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'S'                                       S01117
     C                     SETON                     25                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Initialise store branch field                                   S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   STBRCA                          S01117
     C*
     C** SETON INDICATOR TO SHOW THAT INITIAL PROCESSING HAS BEEN DONE
     C*
     C                     SETON                     20
     C*
     C/COPY WNCPYSRC,FT0525C004
     C*          *****     *****
     C           CAEND     ENDSR
     C*          *****     *****
     C/EJECT
     C           CCDETL    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 CC-DETAIL-PROCESSING                          *
     C*                                                               *
     C*  FUNCTION : TO PRODUCE A PAGE ON THE DETAIL REPORT BASED ON   *
     C*             DATA FROM INPUT RECORD.                           *
     C*                                                               *
     C*  CALLS :    UATBCN                                            *
     C*             UCCLCN                                            *
     C*             UEABRT                                            *
     C*             UGFRMT                                            *
     C*             CHOPF                                             *
     C*             ZDATE2                                            *
     C*                                                               *
     C*  CALLED BY: AAMAIN                                            *
     C*                                                               *
     C*****************************************************************
      *                                                                   CFT014
      ** Access INPAYXL2 if switchable feature CFT014 is installed.       CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C           PREF      CHAININPAYXL2             90                   CFT014
      *                                                                   CFT014
      ** If record does not exist and switchable feature CFT014           CFT014
      ** is installed, do error routine.                                  CFT014
      *                                                                   CFT014
     C           *IN90     IFEQ '1'                                       CFT014
     C                     MOVEL'INPAYXL2'WDBFIL                          CFT014
     C                     MOVELPREF      WDBKEY                          CFT014
     C                     MOVEL'22'      WDBASE                          CFT014
     C                     EXSR UEABRT                                    CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*
     C** SETUP STATUS OF RECORD
     C*
     C           OTCHTP    IFEQ 'I'
     C                     MOVEL'* INSERT'P1STTS
     C                     MOVE 'ED *'    P1STTS
     C                     ELSE
     C           OTCHTP    IFEQ 'A'
     C                     MOVEL'* AMENDE'P1STTS
     C                     MOVE 'D * '    P1STTS
     C                     ELSE
     C                     MOVEL'* DELETE'P1STTS
     C                     MOVE 'D * '    P1STTS
     C                     END
     C                     END
     C*
     C** SETUP ADDRESS FIELDS,ACESSING CLINT AS APPROPRIATE
      *                                                                   055293
      * Clear Receiver's Correspondent and Account with bank prt flds     055293
      *                                                                   055293
     C                     MOVEL*BLANKS   P1ACBK                          055293
     C                     MOVEL*BLANKS   P1ACDS                          055293
     C                     MOVEL*BLANKS   P1RCDS                          055293
     C***********          MOVEL*BLANKS   P1RCCO                   055293 CFT014
      *                                                                   055293
      * Set up Account with Institution Details                           055293
      *                                                                   055293
     C           INACB1    IFNE *BLANKS                                   S01435
      *                                                                   S01435
      * If SWIFT type A translate else leave as on message                S01435
      *                                                                   S01435
     C                     MOVEL#IMSG     P1ACBK                          S01435
     C           INACBT    IFNE 'S'                                       S01435
     C                     MOVELINACB1    P1ACB1                          055293
     C                     MOVELINACB2    P1ACB2                          055293
     C                     MOVELINACB3    P1ACB3                          055293
     C                     MOVELINACB4    P1ACB4                          055293
     C                     MOVELINACB5    P1ACB5                          055293
     C                     ELSE                                           S01435
     C                     MOVEL'ACBT'    XCALL                           S01435
     C                     MOVELINACBT    XTYPE                           S01435
     C                     MOVEL*BLANKS   XNAMDS                          S01435
     C                     MOVELINACB1    ##001   1                       S01435
     C           ##001     IFEQ '/'                                       S01435
     C                     MOVELINACB2    XNAMDS                          S01435
     C                     ELSE                                           S01435
     C                     MOVELINACB1    XNAMDS                          S01435
     C                     END                                            S01435
     C                     EXSR GETADD                                    S01435
     C                     MOVELXNAMDS    P1ACDS                          S01435
     C                     END                                            S01435
     C                     END                                            S01435
      *                                                                   055293
      * Translate input account with bank                                 055293
      *                                                                   055293
     C           ACBT      IFNE *BLANKS                                   S01435
     C                     MOVEL'ACBT'    XCALL                           S01435
     C                     MOVELACBT      XTYPE                           S01435
     C                     MOVELPCCY      XCCY                            S01435
     C                     MOVEL*BLANKS   XNAMDS                          S01435
     C                     MOVELACBK      XNAMDS                          S01435
     C                     MOVE ACBB      XBRCA                           S01435
     C                     EXSR GETADD                                    S01435
     C           INACB1    IFEQ *BLANKS                                   S01435
     C                     MOVELXADDS     P1ACDS                          S01435
     C                     END                                            S01435
     C                     MOVELXNAMDS    P1ACBK                          S01435
     C                     END                                            S01435
      *                                                                   055293
      * Set up Receivers Correspondant Details                            055293
      *                                                                   055293
     C***********INRCO1    IFNE *BLANKS                            S01435 CFT014
      *                                                                   055293
      * If SWIFT type A translate else leave as on message                055293
      *                                                                   055293
     C***********          MOVEL#IMSG     P1RCCO                   S01435 CFT014
     C***********INRCRT    IFNE 'S'                                S01435 CFT014
     C***********          MOVELINRCO1    P1RCO1                   055293 CFT014
     C***********          MOVELINRCO2    P1RCO2                   055293 CFT014
     C***********          MOVELINRCO3    P1RCO3                   055293 CFT014
     C***********          MOVELINRCO4    P1RCO4                   055293 CFT014
     C***********          MOVELINRCO5    P1RCO5                   055293 CFT014
     C***********          ELSE                                    S01435 CFT014
     C***********          MOVEL'RCRT'    XCALL                    S01435 CFT014
     C***********          MOVELINRCRT    XTYPE                    S01435 CFT014
     C***********          MOVEL*BLANKS   XNAMDS                   S01435 CFT014
     C***********          MOVELINRCO1    ##001   1                S01435 CFT014
     C***********##001     IFEQ '/'                                S01435 CFT014
     C***********          MOVELINRCO2    XNAMDS                   S01435 CFT014
     C***********          ELSE                                    S01435 CFT014
     C***********          MOVELINRCO1    XNAMDS                   S01435 CFT014
     C***********          END                                     S01435 CFT014
     C***********          EXSR GETADD                             S01435 CFT014
     C***********          MOVELXNAMDS    P1RCDS                   S01435 CFT014
     C***********          END                                     S01435 CFT014
     C***********          END                                     S01435 CFT014
      *                                                                   055293
      * Translate as no message info                                      055293
      *                                                                   055293
     C***********RCRT      IFNE *BLANKS                            S01435 CFT014
     C***********          MOVEL'RCRT'    XCALL                    S01435 CFT014
     C***********          MOVELRCRT      XTYPE                    S01435 CFT014
     C***********          MOVELSMCY      XCCY                     S01435 CFT014
     C***********          MOVEL*BLANKS   XNAMDS                   S01435 CFT014
     C***********          MOVELRCCO      XNAMDS                   S01435 CFT014
     C***********          EXSR GETADD                             S01435 CFT014
     C***********INRCO1    IFEQ *BLANKS                            S01435 CFT014
     C***********          MOVELXADDS     P1RCDS                   S01435 CFT014
     C***********          END                                     S01435 CFT014
     C***********          MOVELXNAMDS    P1RCCO                   S01435 CFT014
     C***********          END                                     S01435 CFT014
     C*
     C** SENDER
     C*
     C                     MOVEL'SNTP'    XCALL   4
     C                     MOVELSNTP      XTYPE
     C                     MOVELSMCY      XCCY                            CFT014
     C                     MOVELSDINDS    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    P1SDDS
     C*                                                                   S01117
     C** If non multi branched and sender is full account                 S01117
     C** prevent branch from being written to printer file                S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C           SNTP      ANDEQ'G'                                       S01117
     C**********           MOVELSND1      WSND   15                                    S01117 CGL029
     C                     MOVELSND1      WSND   21                                           CGL029
     C                     MOVE *BLANKS   P1SND1                          S01117
     C                     MOVELWSND      P1SND1                          S01117
     C                     END                                            S01117
      *                                                                   CFT014
      ** Format of Receiver's Correspondent                               CFT014
      *                                                                   CFT014
     C                     MOVEL'RCRT'    XCALL                           CFT014
     C                     MOVELINRCRT    XTYPE                           CFT014
     C                     MOVELRECODS    XNAMDS                          CFT014
     C                     EXSR GETADD                                    CFT014
     C                     MOVELXNAMDS    P1RCDS                          CFT014
      *
     C*
     C** INTERMEDIARY BANK
     C*
     C                     MOVEL'INBT'    XCALL   4
     C                     MOVELINBT      XTYPE
     C                     MOVELININDS    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    P1INDS
      *
     C*
     C*
     C** SENDER'S CORRESPONDENT
     C*
     C                     MOVEL'SNCT'    XCALL   4
     C                     MOVELSNCT      XTYPE
     C                     MOVELSNINDS    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    P1SNDS
      *
     C*
     C** ORDERING BANK
     C*
     C                     MOVEL'ORBT'    XCALL   4
     C                     MOVELORBT      XTYPE
     C                     MOVELORBDSI    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    ORBDS
      *
     C*
     C** BENEFICIARY CUSTOMER
     C*
     C                     MOVEL'BNCT'    XCALL   4
     C                     MOVELBNCT      XTYPE
     C                     MOVELPCCY      XCCY                            068172
     C                     MOVELBNINDS    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    P1BNDS
     C*                                                                   S01117
     C** If non multi branched and beneficiary is partial account         S01117
     C** prevent branch from being written to printer file                S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C           BNCT      ANDEQ'P'                                       S01117
     C**********           MOVELBNC1      WBNC   12                                    S01117 CGL029
     C                     MOVELBNC1      WBNC   18                                           CGL029
     C                     MOVE *BLANKS   P1BNC1                          S01117
     C                     MOVELWBNC      P1BNC1                          S01117
     C                     END                                            S01117
      *
     C*
     C** ORDERING CUSTOMER
     C*
     C                     MOVEL'ORCT'    XCALL   4
     C                     MOVELORCT      XTYPE
     C                     MOVELORCDSI    XNAMDS
     C                     EXSR GETADD
     C                     MOVELXNAMDS    ORCDS
      *
     C                     MOVE *BLANKS   XCALL   4
      *
      ** Access currency record for chances to the DR of currency                             CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C                     MOVEL*BLANKS   ZTABKY                                              CFT120
     C                     MOVEL'20'      ZTABKY                                              CFT120
     C                     MOVELINCDRC    WA4                                                 CFT120
     C                     MOVE '1'       WA4                                                 CFT120
     C                     MOVE WA4       ZTABKY                                              CFT120
     C                     EXSR UATBCN                                                        CFT120
      *                                                                                       CFT120
      ** Check if database error occured                                                      CFT120
      *                                                                                       CFT120
     C           *IN89     IFEQ '1'                                                           CFT120
     C                     MOVEL'TABLE'   WDBFIL                                              CFT120
     C                     MOVELZTABKY    WDBKEY                                              CFT120
     C                     MOVEL'62'      WDBASE                                              CFT120
     C                     EXSR UEABRT                                                        CFT120
     C                     ELSE                                                               CFT120
      *                                                                                       CFT120
      ** Store number of decimal places for CDRC currency                                     CFT120
      *                                                                                       CFT120
     C                     Z-ADDCDP       SVCCDP  10                                          CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
     C*
     C** FORMAT PAY & SETTLE AMOUNTS
     C*
     C** CALL UATBCN TO ACCESS CURRENCY RECORD FOR SETTLE CURRENCY
     C*
     C                     MOVEL*BLANKS   ZTABKY
     C                     MOVEL'20'      ZTABKY
     C                     MOVELSMCY      WA4
     C                     MOVE '1'       WA4
     C                     MOVE WA4       ZTABKY
     C                     EXSR UATBCN
     C*
     C** CHECK IF DATABASE ERROR OCCURRED
     C*
     C           *IN89     IFEQ '1'
     C                     MOVEL'TABLE'   WDBFIL
     C                     MOVELZTABKY    WDBKEY
     C                     MOVEL'10'      WDBASE
     C                     EXSR UEABRT                     *ABORT PGM*
     C                     END
     C*
     C** STORE NUMBER OF DECIMAL PLACES FOR SETTLE CURRENCY
     C*
     C                     Z-ADDCDP       SVSCDP  10
     C*
     C** FORMAT SETTLE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN  15
     C                     MOVE SMAM      WFDIN
     C                     Z-ADDSVSCDP    WDEC    10
     C           13        SUB  SVSCDP    WDIG    20
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1SMAM
     C*
     C** CALL UATBCN TO ACCESS CURRENCY RECORD FOR PAY CURRENCY
     C*
     C                     MOVEL*BLANKS   ZTABKY
     C                     MOVEL'20'      ZTABKY
     C                     MOVELPCCY      WA4
     C                     MOVE '1'       WA4
     C                     MOVE WA4       ZTABKY
     C                     EXSR UATBCN
     C*
     C** CHECK IF DATABASE ERROR OCCURRED
     C*
     C           *IN89     IFEQ '1'
     C                     MOVEL'TABLE'   WDBFIL
     C                     MOVELZTABKY    WDBKEY
     C                     MOVEL'11'      WDBASE
     C                     EXSR UEABRT                     *ABORT PGM*
     C                     END
     C*
     C** STORE NUMBER OF DECIMAL PLACES FOR PAY CURRENCY
     C*
     C                     Z-ADDCDP       SVPCDP  10
     C*
     C** FORMAT PAY AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE PYAM      WFDIN
     C                     Z-ADDSVPCDP    WDEC
     C           13        SUB  SVPCDP    WDIG
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1PYAM
      *                                                                   CEU006
      **  Format Notified Delivery Amount.                                CEU006
      *                                                                   CEU006
     C***********NDAM      IFEQ 0                          B*1     CEU006 CFT014
     C***********          MOVE '0'       *IN55                    CEU006 CFT014
     C***********          ELSE                            X*1     CEU006 CFT014
     C***********          MOVE '1'       *IN55                    CEU006 CFT014
      *                                                                   CFT014
     C           CEU006    IFEQ 'Y'                                       CFT014
     C           CFT014    OREQ 'Y'                                       CFT014
      *                                                                   CFT014
     C                     MOVE *ON       *IN55                           CFT014
      *                                                                   CFT014
     C           NDAM      IFEQ 0                                         CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   RNDAMT                          CFT014
     C                     MOVE *BLANKS   RNDCCY                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CEU006
      **  Call SR/UATBCN to access currency record for Notified           CEU006
      **  Delivery Currency.                                              CEU006
      *                                                                   CEU006
     C                     MOVEL*BLANKS   ZTABKY                          CEU006
     C                     MOVEL'20'      ZTABKY                          CEU006
     C                     MOVELNDCY      WA4                             CEU006
     C                     MOVE '1'       WA4                             CEU006
     C                     MOVE WA4       ZTABKY                          CEU006
     C                     EXSR UATBCN                                    CEU006
      *                                                                   CEU006
      **  Check if database error occurred.                               CEU006
      *                                                                   CEU006
     C           *IN89     IFEQ '1'                        B*2            CEU006
     C                     MOVEL'TABLE'   WDBFIL                          CEU006
     C                     MOVELZTABKY    WDBKEY                          CEU006
     C                     MOVEL'053'     WDBASE                          CEU006
     C                     EXSR UEABRT                     *ABORT PGM*    CEU006
     C                     ENDIF                           E*2            CEU006
      *                                                                   CEU006
     C                     Z-ADDNDAM      ZFLD15                          CEU006
     C                     Z-ADDCDP       ZDECS                           CEU006
     C                     MOVE 'J'       ZECODE                          CEU006
     C                     EXSR ZSEDIT                                    CEU006
     C                     MOVE ZOUT21    WFLD18 18                       CEU006
     C                     MOVE WFLD18    RNDAMT                          CEU006
     C                     MOVE NDCY      RNDCCY                          CEU006
     C                     ENDIF                           E*1            CEU006
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C*
     C** FORMAT OTHER AMOUNTS & CURRENCIES
     C** IF CHARGES TO DEBIT A/C FIELD IS NON-ZERO USE BASE CURRENCY;
     C** OTHERWISE IF PAY PLUS CHARGES INDICATOR IS 'Y' USE SETTLE CCY;
     C** OTHERWISE USE PAY CURRENCY
     C*
     C***********CDRO      IFNE *ZERO                                                         CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
      *                                                                                       CFT120
     C                     MOVELBCCY      WCCY    3
     C                     Z-ADDSVBCDP    WDEC
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE INCDRC    WCCY                                                CFT120
     C                     Z-ADDSVCCDP    WDEC                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0525C001
     C                     ELSE
     C           ADDC      IFEQ 'A'
     C                     MOVELSMCY      WCCY
     C                     Z-ADDSVSCDP    WDEC
     C                     ELSE
     C                     MOVELPCCY      WCCY
     C                     Z-ADDSVPCDP    WDEC
     C                     END
     C                     END
     C*
     C           11        SUB  WDEC      WDIG
     C*
     C** SETUP CURRENCY NAMES
     C*
     C                     MOVELWCCY      P1TRCY
     C                     MOVELWCCY      P1TXCY
     C                     MOVELWCCY      P1CQCY
     C                     MOVELWCCY      P1TLCY
     C                     MOVELWCCY      P1ADCY
     C                     MOVELWCCY      P1MSCY
     C*                                                                   S01499
     C** Set up ccy for V.A.T. if S01499 feature is active                S01499
     C*                                                                   S01499
     C           *IN28     IFEQ '1'                                       S01499
     C                     MOVELWCCY      P1VTCY                          S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** Set up ccy for FX/Change if S01494 feature is active             S01494
     C*                                                                   S01494
     C           *IN27     IFEQ '1'                                       S01494
     C                     MOVELWCCY      P1CHCY                          S01494
     C                     END                                            S01494
     C*
     C** FORMAT TRANSFER COMMISSION AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE TRCM      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1TRCM
     C*
     C** FORMAT TELEX CHARGE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE TXCH      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1TXCH
     C*
     C** FORMAT CHEQUE CHARGE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE CQCH      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1CQCH
     C*
     C** FORMAT TELEPHONE CHARGE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE TLCH      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1TLCH
     C*
     C** FORMAT ADVICE CHARGE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE ADCH      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1ADCH
     C*
     C** FORMAT MISCELLANEOUS CHARGE AMOUNT
     C*
     C                     MOVEL*BLANKS   WFDIN
     C                     MOVE MSCH      WFDIN
     C                     EXSR UGFRMT
     C                     MOVE WFDOUT    P1MSCH
     C*                                                                   S01499
     C** Format the V.A.T. amount if S01499 is active                     S01499
     C*                                                                   S01499
     C           *IN28     IFEQ '1'                                       S01499
     C                     MOVE *BLANKS   WFDIN                           S01499
     C                     MOVE INVATT    WFDIN                           S01499
     C                     EXSR UGFRMT                                    S01499
     C                     MOVE WFDOUT    P1VATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** Format the FX/Change Commission amount if S01494 is active       S01494
     C*                                                                   S01494
     C           *IN27     IFEQ '1'                                       S01494
     C                     MOVE *BLANKS   WFDIN                           S01494
     C                     MOVE INCHCM    WFDIN                           S01494
     C                     EXSR UGFRMT                                    S01494
     C                     MOVE WFDOUT    P1CHCM                          S01494
     C                     END                                            S01494
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
      *                                                                   CFT014
     C           INOEXR    IFNE 0                                         CFT014
     C                     Z-ADDINOEXR    P1OEXR                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVELINTRIB    P1TRIB                          CFT014
     C                     MOVELINBOCD    P1BOCD                          CFT014
     C                     MOVELINTTCD    P1TTCD                          CFT014
     C                     MOVELINICD1    P1ICD1                          CFT014
     C                     MOVELINICD2    P1ICD2                          CFT014
     C                     MOVELINICD3    P1ICD3                          CFT014
     C                     MOVELINICD4    P1ICD4                          CFT014
     C                     MOVELINICD5    P1ICD5                          CFT014
     C                     MOVELINRRP1    P1RRP1                          CFT014
     C                     MOVELINRRP2    P1RRP2                          CFT014
     C                     MOVELINRRP3    P1RRP3                          CFT014
      *                                                                   CFT014
      ** Format Receiver's Charges                                        CFT014
      *                                                                   CFT014
     C           INRCRM    IFEQ 0                                         CFT014
     C                     MOVE *BLANKS   P1RCRM                          CFT014
     C                     MOVE *BLANKS   P1RCRY                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM SMCY      @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'70'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WSNBDP  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWSNBDP    WDEC    10                      CFT014
     C           11        SUB  WDEC      WDIG    20                      CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INRCRM    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1RCRM                          CFT014
     C                     MOVE SMCY      P1RCRY                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Format Sender's Charges                                          CFT014
      *                                                                   CFT014
     C           INSCY1    IFEQ *BLANKS                                   CFT014
     C                     MOVE *BLANKS   P1SCH1                          CFT014
     C                     MOVE *BLANKS   P1SCY1                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM INSCY1    @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'72'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WNBDP1  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWNBDP1    WDEC    10                      CFT014
     C           11        SUB  WDEC      WDIG    20                      CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INSCH1    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1SCH1                          CFT014
     C                     MOVE INSCY1    P1SCY1                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           INSCY2    IFEQ *BLANKS                                   CFT014
     C                     MOVE *BLANKS   P1SCH2                          CFT014
     C                     MOVE *BLANKS   P1SCY2                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM INSCY2    @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'73'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WNBDP2  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWNBDP2    WDEC                            CFT014
     C           11        SUB  WDEC      WDIG                            CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INSCH2    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1SCH2                          CFT014
     C                     MOVE INSCY2    P1SCY2                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           INSCY3    IFEQ *BLANKS                                   CFT014
     C                     MOVE *BLANKS   P1SCH3                          CFT014
     C                     MOVE *BLANKS   P1SCY3                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM INSCY3    @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'74'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WNBDP3  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWNBDP3    WDEC                            CFT014
     C           11        SUB  WDEC      WDIG                            CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INSCH3    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1SCH3                          CFT014
     C                     MOVE INSCY3    P1SCY3                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           INSCY4    IFEQ *BLANKS                                   CFT014
     C                     MOVE *BLANKS   P1SCH4                          CFT014
     C                     MOVE *BLANKS   P1SCY4                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM INSCY4    @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'75'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WNBDP4  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWNBDP4    WDEC                            CFT014
     C           11        SUB  WDEC      WDIG                            CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INSCH4    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1SCH4                          CFT014
     C                     MOVE INSCY4    P1SCY4                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C           INSCY5    IFEQ *BLANKS                                   CFT014
     C                     MOVE *BLANKS   P1SCH5                          CFT014
     C                     MOVE *BLANKS   P1SCY5                          CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOCURRR0'                                CFT014
     C                     PARM '*DBERR ' @RTCD   7                       CFT014
     C                     PARM '*KEY   ' @OPTN   7                       CFT014
     C                     PARM INSCY5    @CCY    3                       CFT014
     C           SDCURR    PARM SDCURR    DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   LDA                                       CFT014
     C                     MOVEL'SDCURRPD'DBFILE                          CFT014
     C                     MOVEL'*VERIFY' DBKEY                           CFT014
     C                     MOVEL'75'      DBASE                           CFT014
     C                     OUT  LDA                                       CFT014
     C                     SETON                     U7U8LR               CFT014
     C                     EXSR UEABRT                                    CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE A6NBDP    WNBDP5  10                      CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     Z-ADDWNBDP5    WDEC                            CFT014
     C           11        SUB  WDEC      WDIG                            CFT014
     C                     MOVEL*BLANKS   WFDIN                           CFT014
     C                     MOVE INSCH5    WFDIN                           CFT014
     C                     EXSR UGFRMT                                    CFT014
     C                     MOVE WFDOUT    P1SCH5                          CFT014
     C                     MOVE INSCY5    P1SCY5                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*
     C** FORMAT DATE FIELDS USING SYSTEM ROUTINE ZDATE2
     C*
     C** SETTLE VALUE DATE
     C*
     C                     Z-ADDSLDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    P1SLDT
     C*
     C** PAY VALUE DATE
     C*
     C                     Z-ADDPVDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    P1PYDT
     C*
     C** SETUP REMAINING REPORT FIELDS
     C*
     C                     MOVELPREF      P1PREF
     C                     MOVELRLPR      P1RLPR
     C                     MOVELPYTP      P1PYTP
     C                     MOVELPYST      P1PYST
     C                     MOVELSMCY      P1SMCY
     C                     Z-ADDRATE      P1RATE
     C                     MOVELPCCY      P1PCCY
     C                     MOVELBBI1      P1BBI1
     C                     MOVELBBI2      P1BBI2
     C                     MOVELBBI3      P1BBI3
     C                     MOVELBBI4      P1BBI4
     C                     MOVELBBI5      P1BBI5
     C                     MOVELBBI6      P1BBI6
     C                     MOVELDTP1      P1DTP1
     C                     MOVELDTP2      P1DTP2
     C                     MOVELDTP3      P1DTP3
     C                     MOVELDTP4      P1DTP4
     C/COPY WNCPYSRC,FT0525C005
     C           DNBC      IFNE *ZERO                                     S01435
     C/COPY WNCPYSRC,FT0525C006
     C                     MOVELDNBC      P1DNBC
     C                     ELSE                                           S01435
     C                     MOVEL*BLANKS   P1DNBC                          S01435
     C                     END                                            S01435
     C                     MOVELADDC      P1ADDC
     C                     MOVELDTCH      P1DTCH
     C                     MOVELTRCT      P1TRCT
     C*********************MOVELSWPC      P1SWPC                          S01117
     C           SWPC      IFEQ 1                          B001           S01117
     C                     MOVE 'U'       P1SWPC                          S01117
     C                     ELSE                            X001           S01117
     C           SWPC      IFEQ 2                          B002           S01117
     C                     MOVE 'N'       P1SWPC                          S01117
     C                     END                             E002           S01117
     C                     END                             E001           S01117
     C*
     C** EDIT  RCCO, ACBK AND CDRO  FOR OUTPUT
     C*
     C                     MOVE *BLANKS   P1OPIN                          S01435
     C           OPIN      IFEQ 'Y'                                       S01435
     C                     MOVEL'YES'     P1OPIN                          S01435
     C                     ELSE                                           S01435
     C                     MOVEL'NO '     P1OPIN                          S01435
     C                     END                                            S01435
      **********                                                          S01435
     C**********           MOVE RCRT      PRMTYP  1        ( RCCO )       S01435
     C**********           MOVE *ZEROS    PRMFLD 12                       S01435
     C**********           MOVELRCCO      PRMFLD                          S01435
     C**********           EXSR CHOPF                                     S01435
     C**********           MOVELPRMFLD    P1RCCO                          S01435
     C**********                                                          S01435
     C**********           MOVELACBK      P1ACBK                          S01435
     C**********           MOVELACBB      P1ACBB                    S01117S01435
     C**********           MOVE CDRT      PRMTYP           ( CDRO )       S01435
     C**********           MOVE *ZEROS    PRMFLD                          S01435
     C                     MOVE CDRT      PRMTYP  1        ( CDRO )
     C**********           MOVE *ZEROS    PRMFLD 12                                           CGL029
     C***********          MOVE *ZEROS    PRMFLD 18                                    CGL029 CSD027
     C                     MOVE *BLANKS   PRMFLD 18                                           CSD027
     C                     MOVELCDRO      PRMFLD
     C                     EXSR CHOPF
     C                     MOVELCDBR      P1CDBR                          S01117
     C                     MOVELPRMFLD    P1CDRO
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C           INCDRC    ANDNE*BLANKS                                                       CFT120
     C                     MOVELINCDRC    P1CDRC                                              CFT120
     C                     ELSE                                                               CFT120
     C                     MOVE *BLANKS   P1CDRC                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0525C002
      *                                                                   S01435
      * Format input users and first authorisation is available           S01435
      *                                                                   S01435
     C           INUSR1    IFNE *BLANKS                                   S01435
     C                     MOVE INUSR1    USRP                            S01435
     C                     EXSR UCMUSE                                    S01435
     C                     MOVE USER1     SIUSR1 25                       S01435
     C*                                                                   S01435
     C                     ELSE                                           S01435
     C*                                                                   S01435
     C** CLEAR OUTPUT FIELD                                               S01435
     C                     MOVE *BLANKS   SIUSR1                          S01435
     C*                                                                   S01435
     C                     END                                            S01435
      *                                                                   S01435
     C           INUSR2    IFNE *BLANKS                                   S01435
     C                     MOVE INUSR2    USRP                            S01435
     C                     EXSR UCMUSE                                    S01435
     C                     MOVE USER1     SIUSR2 25                       S01435
     C*                                                                   S01435
     C                     ELSE                                           S01435
     C*                                                                   S01435
     C** CLEAR OUTPUT FIELD                                               S01435
     C                     MOVE *BLANKS   SIUSR2                          S01435
     C*                                                                   S01435
     C                     END                                            S01435
      *                                                                   S01435
     C           AUP1      IFNE *BLANKS                                   S01435
     C                     MOVE AUP1      USRP                            S01435
     C                     EXSR UCMUSE                                    S01435
     C                     MOVE USER1     SAUP1  25                       S01435
     C*                                                                   S01435
     C                     ELSE                                           S01435
     C*                                                                   S01435
     C** CLEAR OUTPUT FIELD                                               S01435
     C                     MOVE *BLANKS   SAUP1                           S01435
     C*                                                                   S01435
     C                     END                                            S01435
      *                                                                   S01435
      * Format Override indicator                                         S01435
      *                                                                   S01435
     C                     MOVE *BLANKS   P1OVRD                          S01435
     C           OVRD      IFEQ 'Y'                                       S01435
     C                     MOVE 'YES'     P1OVRD                          S01435
     C                     ELSE                                           S01435
     C                     MOVE 'NO '     P1OVRD                          S01435
     C                     END                                            S01435
      *                                                                   S01435
      * Format Entered Currency                                           S01435
      *                                                                   S01435
     C                     SELEC                                          S01435
      *                                                                   S01435
     C***********CDRO      WHNE *ZERO                                                  S01435 CSD027
     C           CDRO      WHNE *BLANKS                                                       CSD027
     C           BTCHCY    OREQ 'B'                                       074815
     C           CFT120    ANDNE'Y'                                                           CFT120
     C                     MOVELBCCY      WCCY                            S01435
     C                     Z-ADDSVBCDP    WDEC                            S01435
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVELINCDRC    WCCY                                                CFT120
     C                     Z-ADDSVCCDP    WDEC                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0525C003
      *                                                                   S01435
     C           BTCHCY    WHEQ 'L'                                       S01435
     C                     MOVELLOCY      WCCY                            S01435
     C                     Z-ADDSVLCDP    WDEC                            S01435
      *                                                                   S01435
     C           BTCHCY    WHEQ 'C'                                       S01435
     C           ADDC      ANDEQ'A'                                       S01435
     C                     MOVELSMCY      WCCY                            S01435
     C                     Z-ADDSVSCDP    WDEC                            S01435
      *                                                                   S01435
     C                     OTHER                                          S01435
     C                     MOVELPCCY      WCCY                            S01435
     C                     Z-ADDSVPCDP    WDEC                            S01435
     C                     ENDSL                                          S01435
      *                                                                   CFT009
      ** If CFT009 SAR is turned on set up extra charges currency         CFT009
      ** fields.                                                          CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVELWCCY      P2M1EC                          CFT009
     C                     MOVELWCCY      P2M2EC                          CFT009
     C                     MOVELWCCY      P2M3EC                          CFT009
     C                     MOVELWCCY      P2M4EC                          CFT009
     C                     MOVELWCCY      P2M5EC                          CFT009
      *                                                                   CFT009
      ** Get decimals for LEVIED currency                                 CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM           WCCY                            CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
     C           @RTCD     IFNE *BLANKS                                   CFT009
     C                     MOVEL'SDCURRPD'WDBFIL                          CFT009
     C                     MOVELWCCY      WDBKEY                          CFT009
     C                     MOVEL'54'      WDBASE                          CFT009
     C                     EXSR UEABRT                     *ABORT PGM*    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Save decimal positions                                            CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6NBDP    SVLEVD                          CFT009
     C                     Z-ADDA6NBDP    SVLEVD                          CFT009
      *                                                                   CFT009
      ** Also set up the charge codes fields if CFT009 is turned on.      CFT009
      *                                                                   CFT009
     C                     MOVELTFCCCO    P2TRCD                          CFT009
     C                     MOVELTLCODE    P2TXCD                          CFT009
     C                     MOVELCHCHCD    P2CQCD                          CFT009
     C                     MOVELTLCHCD    P2TLCD                          CFT009
     C                     MOVELADCHCD    P2ADCD                          CFT009
     C                     MOVELMISCH     P2MSCD                          CFT009
     C                     MOVELMSCH1     P2M1CD                          CFT009
     C                     MOVELMSCH2     P2M2CD                          CFT009
     C                     MOVELMSCH3     P2M3CD                          CFT009
     C                     MOVELMSCH4     P2M4CD                          CFT009
     C                     MOVELMSCH5     P2M5CD                          CFT009
      *                                                                   CFT009
      ** Set up FX/Change commission code if feature is turned on         CFT009
      *                                                                   CFT009
     C           *IN27     IFEQ '1'                                       CFT009
     C                     MOVELFXCHEC    P2CHCD                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Set charges currency                                             CFT009
      *                                                                   CFT009
     C                     MOVELINCHGC    P2TXCC                          CFT009
     C                     MOVELINCHGC    P2CCCC                          CFT009
     C                     MOVELINCHGC    P2ADCC                          CFT009
     C                     MOVELINCHGC    P2TCCC                          CFT009
     C                     MOVELINCHGC    P2TLCC                          CFT009
     C                     MOVELINCHGC    P2MSCC                          CFT009
     C                     MOVELINCHGC    P2M1CC                          CFT009
     C                     MOVELINCHGC    P2M2CC                          CFT009
     C                     MOVELINCHGC    P2M3CC                          CFT009
     C                     MOVELINCHGC    P2M4CC                          CFT009
     C                     MOVELINCHGC    P2M5CC                          CFT009
     C                     MOVELINCHGC    P2CHCC                          CFT009
      *                                                                   CFT009
      ** Get decimals for charges currency                                CFT009
      *                                                                   CFT009
     C                     CALL 'AOCURRR0'                                CFT009
     C                     PARM *BLANKS   @RTCD                           CFT009
     C                     PARM '*KEY   ' @OPTN                           CFT009
     C                     PARM           INCHGC                          CFT009
     C           SDCURR    PARM SDCURR    DSSDY                           CFT009
      *                                                                   CFT009
     C           @RTCD     IFNE *BLANKS                                   CFT009
     C                     MOVEL'SDCURRPD'WDBFIL                          CFT009
     C                     MOVELINCHGC    WDBKEY                          CFT009
     C                     MOVEL'52'      WDBASE                          CFT009
     C                     EXSR UEABRT                     *ABORT PGM*    CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Save decimal positions                                            CFT009
      *                                                                   CFT009
     C           *LIKE     DEFN A6NBDP    SVCHGD                          CFT009
     C                     Z-ADDA6NBDP    SVCHGD                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   S01435
     C                     MOVELWCCY      P1TREC                          S01435
     C                     MOVELWCCY      P1TXEC                          S01435
     C                     MOVELWCCY      P1CQEC                          S01435
     C                     MOVELWCCY      P1TLEC                          S01435
     C                     MOVELWCCY      P1ADEC                          S01435
     C                     MOVELWCCY      P1MSEC                          S01435
     C*                                                                   S01499
     C** Set up ccy for V.A.T. only if S01499 feature is active           S01499
     C*                                                                   S01499
     C           *IN28     IFEQ '1'                                       S01499
     C                     MOVELWCCY      P1VTEC                          S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** Set up ccy for FX/Change only if S01494 feature is active        S01494
     C*                                                                   S01494
     C           *IN27     IFEQ '1'                                       S01494
     C                     MOVELWCCY      P1CHEC                          S01494
     C                     END                                            S01494
      *                                                                   S01435
      *  Format Entered Amounts                                           S01435
      *                                                                   S01435
     C           11        SUB  WDEC      WDIG                            S01435
      *                                                                   S01435
      ***Format*Transfer*Commission*Amount************************* S01435CFT009
      ***********                                                         S01435
     C*********************MOVEL*BLANKS   WFDIN                     S01435CFT009
     C*********************MOVE DUMA1     WFDIN                     S01435CFT009
     C*********************EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1TREA                    S01435CFT009
      **********                                                    S01435CFT009
      ***Format*Telex*Charge*Amount******************************** S01435CFT009
      **********                                                    S01435CFT009
     C**********           MOVEL*BLANKS   WFDIN                     S01435CFT009
     C**********           MOVE DUMA2     WFDIN                     S01435CFT009
     C**********           EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1TXEA                    S01435CFT009
      **********                                                    S01435CFT009
      ***Format*Cheque*Charge*Amount******************************* S01435CFT009
      **********                                                    S01435CFT009
     C**********           MOVEL*BLANKS   WFDIN                     S01435CFT009
     C**********           MOVE DUMA3     WFDIN                     S01435CFT009
     C**********           EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1CQEA                    S01435CFT009
     C**********                                                    S01435CFT009
     C***Format*Telephone*Charge*Amount**************************** S01435CFT009
     C**********                                                    S01435CFT009
     C**********           MOVEL*BLANKS   WFDIN                     S01435CFT009
     C**********           MOVE DUMA4     WFDIN                     S01435CFT009
     C**********           EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1TLEA                    S01435CFT009
     C**********                                                    S01435CFT009
     C***Format*Advice*Charge*Amount******************************* S01435CFT009
     C**********           MOVEL*BLANKS   WFDIN                     S01435CFT009
     C**********           MOVE DUMA5     WFDIN                     S01435CFT009
     C**********           EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1ADEA                    S01435CFT009
     C**********                                                    S01435CFT009
     C***Format*Miscellaneous*Charge*Amount************************ S01435CFT009
     C**********                                                    S01435CFT009
     C**********           MOVEL*BLANKS   WFDIN                     S01435CFT009
     C**********           MOVE DUMA6     WFDIN                     S01435CFT009
     C**********           EXSR UGFRMT                              S01435CFT009
     C**********           MOVE WFDOUT    P1MSEA                    S01435CFT009
      *                                                                   CFT009
      ** Format Transfer Commission Amount (LEVIED)                       CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE TRCM      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2TREA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1TREA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format transfer commission amount in charges ccy                 CFT009
      *                                                                   CFT009
     C                     Z-ADDDUMA1     TOTTOT 180                      CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA1     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2TCCA                          CFT009
      *                                                                   CFT009
      ** Format Telex Charge Amount (LEVIED)                              CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE TXCH      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2TXEA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1TXEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format Telex Charge in charges ccy                               CFT009
      *                                                                   CFT009
     C                     ADD  DUMA2     TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA2     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2TXCA                          CFT009
      *                                                                   CFT009
      ** Format Cheque Charge Amount (LEVIED)                             CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CQCH      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2CQEA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1CQEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format Cheque charge in charges ccy                              CFT009
      *                                                                   CFT009
     C                     ADD  DUMA3     TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA3     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2CCCA                          CFT009
     C*                                                                   CFT009
     C** Format Telephone Charge Amount (LEVIED)                          CFT009
     C*                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE TLCH      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2TLEA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1TLEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format Telephone charge in charges ccy                           CFT009
      *                                                                   CFT009
     C                     ADD  DUMA5     TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA5     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2TLCA                          CFT009
     C*                                                                   S01435
     C** Format Advice Charge Amount (LEVIED)                             CFT009
     C*                                                                   S01435
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE ADCH      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2ADEA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1ADEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format Advice  charge in charges ccy                             CFT009
      *                                                                   CFT009
     C                     ADD  DUMA4     TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA4     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2ADCA                          CFT009
     C*                                                                   S01435
     C** Format Miscellaneous Charge Amount (LEVIED)                      S01435
     C*                                                                   S01435
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSCH      ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2MSEA                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVE ZFIELD    P1MSEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous Charge Amount in charge ccy                 CFT009
      *                                                                   CFT009
     C                     ADD  DUMA6     TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE DUMA6     ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2MSCA                          CFT009
     C*                                                                   S01499
     C** Format the V.A.T. amount if S01499 is active                     S01499
     C*                                                                   S01499
     C           *IN28     IFEQ '1'                                       S01499
     C                     MOVE *BLANKS   WFDIN                           S01499
     C                     MOVE INDUM8    WFDIN                           S01499
     C                     EXSR UGFRMT                                    S01499
     C                     MOVE WFDOUT    P1VAEA                          S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** Format the FX/Change Commission amount if S01494 is active       S01494
     C** (LEVIED)                                                         CFT009
     C*                                                                   S01494
     C           *IN27     IFEQ '1'                                       S01494
     C*********************MOVE *BLANKS   WFDIN                     S01494CFT009
     C*********************MOVE INDUM7    WFDIN                     S01494CFT009
     C*********************EXSR UGFRMT                              S01494CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE INCHCM    ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
      *                                                                   CFT009
      ** If CFT009 SAR is turned on, use the new printer format.          CFT009
      ** ELSE use the original format.                                    CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE ZFIELD    P2CHEA                          CFT009
     C                     ELSE                                           CFT009
     C*********************MOVE WFDOUT    P1CHEA                    S01494CFT009
     C                     MOVE ZFIELD    P1CHEA                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Format FX/Change Commission Amount in charge ccy                 CFT009
      *                                                                   CFT009
     C                     ADD  INDUM7    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE INDUM7    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2CHCA                          CFT009
      *                                                                   CFT009
     C                     END                                            S01494
      *                                                                   CFT009
      ** Format the miscellaneous charge amounts if CFT009 is turned      CFT009
      ** on.                                                              CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
      *                                                                   CFT009
      ** Misc charge one.                                                 CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   CHDESC                          CFT009
     C           MSCH1     CHAINFTPCHGL0             97                   CFT009
     C           CHDESC    IFEQ *BLANK                                    CFT009
     C                     MOVEADESC,1    M1DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCHDESC    M1DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 1 in LEVIED ccy                      CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC01     ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M1EA                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 1 in charge ccy                      CFT009
      *                                                                   CFT009
     C                     ADD  CMSC01    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC01    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M1CA                          CFT009
      *                                                                   CFT009
      ** Misc charge two.                                                 CFT009
      *                                                                   CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   CHDESC                          CFT009
     C           MSCH2     CHAINFTPCHGL0             97                   CFT009
     C           CHDESC    IFEQ *BLANK                                    CFT009
     C                     MOVEADESC,2    M2DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCHDESC    M2DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 2 in LEVIED ccy                      CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC02     ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M2EA                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 2 in charge ccy                      CFT009
      *                                                                   CFT009
     C                     ADD  CMSC02    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC02    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M2CA                          CFT009
      *                                                                   CFT009
      ** Misc charge three.                                               CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   CHDESC                          CFT009
     C           MSCH3     CHAINFTPCHGL0             97                   CFT009
     C           CHDESC    IFEQ *BLANK                                    CFT009
     C                     MOVEADESC,3    M3DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCHDESC    M3DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 3 in LEVIED ccy                      CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC03     ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M3EA                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 3 in charge ccy                      CFT009
      *                                                                   CFT009
     C                     ADD  CMSC03    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC03    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M3CA                          CFT009
      *                                                                   CFT009
      ** Misc charge four.                                                CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   CHDESC                          CFT009
     C           MSCH4     CHAINFTPCHGL0             97                   CFT009
     C           CHDESC    IFEQ *BLANK                                    CFT009
     C                     MOVEADESC,4    M4DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCHDESC    M4DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 4 in LEVIED ccy                      CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC04     ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M4EA                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 4 in charge ccy                      CFT009
      *                                                                   CFT009
     C                     ADD  CMSC04    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC04    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M4CA                          CFT009
      *                                                                   CFT009
      ** Misc charge five.                                                CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   CHDESC                          CFT009
     C           MSCH5     CHAINFTPCHGL0             97                   CFT009
     C           CHDESC    IFEQ *BLANK                                    CFT009
     C                     MOVEADESC,5    M5DESC                          CFT009
     C                     ELSE                                           CFT009
     C                     MOVELCHDESC    M5DESC                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 5 in LEVIED ccy                      CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE MSC05     ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M5EA                          CFT009
      *                                                                   CFT009
      ** Format Miscellaneous charge 5 in charge ccy                      CFT009
      *                                                                   CFT009
     C                     ADD  CMSC05    TOTTOT                          CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CMSC05    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2M5CA                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
     C*                                                                   S01499
     C** Set up the V.A.T. flags of all charges if S01499 is active       S01499
     C*                                                                   S01499
     C           *IN28     IFEQ '1'                                       S01499
     C                     MOVE INVAT1    P1TRVF                          S01499
     C                     MOVE INVAT2    P1TXVF                          S01499
     C                     MOVE INVAT3    P1CQVF                          S01499
     C                     MOVE INVAT4    P1ADVF                          S01499
     C                     MOVE INVAT5    P1TLVF                          S01499
     C                     MOVE INVAT6    P1MSVF                          S01499
     C                     MOVE INVAT7    P1CHVF                          S01499
      *                                                                   CFT009
      ** Set up the V.A.T. flags for the extra charges introduced by      CFT009
      ** CFT009, if this module is turned on.                             CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
     C                     MOVE VTMIC1    P2M1VF                          CFT009
     C                     MOVE VTMIC2    P2M2VF                          CFT009
     C                     MOVE VTMIC3    P2M3VF                          CFT009
     C                     MOVE VTMIC4    P2M4VF                          CFT009
     C                     MOVE VTMIC5    P2M5VF                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C                     END                                            S01499
      *                                                                   CFT009
      ** Calculate total for the charge amounts, if SAR CFT009 is         CFT009
      ** turned on.                                                       CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '1'                                       CFT009
      *                                                                   CFT009
      ** Move amounts in the output fields to numeric fields, so          CFT009
      ** that they can be added.                                          CFT009
      *                                                                   CFT009
      ** Transfer commission                                              CFT009
     C                     Z-ADDTRCM      NUMA1  130                      CFT009
      ** Telex charge                                                     CFT009
     C                     Z-ADDTXCH      NUMA2  130                      CFT009
      ** Cheque charge total                                              CFT009
     C                     Z-ADDCQCH      NUMA3  130                      CFT009
      ** Telephone charge total                                           CFT009
     C                     Z-ADDTLCH      NUMA4  130                      CFT009
      ** Advice charge total                                              CFT009
     C                     Z-ADDADCH      NUMA5  130                      CFT009
      ** Miscellaneous charge total                                       CFT009
     C                     Z-ADDMSCH      NUMA6  130                      CFT009
      ** FX/Change Commission total if S01494 is active                   CFT009
     C           *IN27     IFEQ '1'                                       CFT009
     C                     Z-ADDINCHCM    NUMA7  130                      CFT009
     C                     ENDIF                                          CFT009
      ** Misc charge one total                                            CFT009
     C                     Z-ADDMSC01     NUMA8  130                      CFT009
      ** Misc charge two total                                            CFT009
     C                     Z-ADDMSC02     NUMA9  130                      CFT009
      ** Misc charge three total                                          CFT009
     C                     Z-ADDMSC03     NUMA10 130                      CFT009
      ** Misc charge four total                                           CFT009
     C                     Z-ADDMSC04     NUMA11 130                      CFT009
      ** Misc charge five total                                           CFT009
     C                     Z-ADDMSC05     NUMA12 130                      CFT009
      *                                                                   CFT009
      ** Add the amounts together                                         CFT009
      *                                                                   CFT009
     C                     Z-ADDNUMA1     CHGTOT 150                      CFT009
     C                     ADD  NUMA2     CHGTOT                          CFT009
     C                     ADD  NUMA3     CHGTOT                          CFT009
     C                     ADD  NUMA4     CHGTOT                          CFT009
     C                     ADD  NUMA5     CHGTOT                          CFT009
     C                     ADD  NUMA6     CHGTOT                          CFT009
     C                     ADD  NUMA7     CHGTOT                          CFT009
     C                     ADD  NUMA8     CHGTOT                          CFT009
     C                     ADD  NUMA9     CHGTOT                          CFT009
     C                     ADD  NUMA10    CHGTOT                          CFT009
     C                     ADD  NUMA11    CHGTOT                          CFT009
     C                     ADD  NUMA12    CHGTOT                          CFT009
      *                                                                   CFT009
      ** Format all running total amounts                                 CFT009
      *                                                                   CFT009
      ** Charges running total (LEVIED)                                   CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE CHGTOT    ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2CHGT                          CFT009
      *                                                                   CFT009
      ** V.A.T. running total, if V.A.T. feature turned on. (LEVIED)      CFT009
      *                                                                   CFT009
     C           *IN28     IFEQ '1'                                       CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE INVATT    ZFIELD                          CFT009
     C                     Z-ADDSVLEVD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2VATT                          CFT009
      *                                                                   CFT009
      ** Total VAT in charges currency                                    CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE INDUM8    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2VATC                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Total charges in charges currency                                CFT009
      *                                                                   CFT009
     C                     MOVE *BLANKS   ZFIELD                          CFT009
     C                     MOVE TOTTOT    ZFIELD                          CFT009
     C                     Z-ADDSVCHGD    ZADEC                           CFT009
     C                     EXSR ZEDIT                                     CFT009
     C                     MOVE ZFIELD    P2TOTT                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C*
     C** OUTPUT PAGE TO REPORT
     C*
     C                     WRITEP1HD
     C                     WRITEP1DETL
      *                                                                   CFT009
      ** If SAR CFT009 turned off, write out original format.             CFT009
      ** Otherwise, write out the new charges structure.                  CFT009
      *                                                                   CFT009
     C           *IN29     IFEQ '0'                                       CFT009
     C                     WRITECHRG1                                     CFT009
     C                     ELSE                                           CFT009
     C                     WRITECHRG2                                     CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Network, Message type and Validation flags                                           CSW209
      *                                                                                       CSW209
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVE INNWRK    P3NWRK                                              CSW209
     C                     MOVE INMTPY    P3MTPY                                              CSW209
     C                     MOVE INVALF    P3VALF                                              CSW209
      *                                                                                       CSW209
     C                     WRITEP3DETL                                                        CSW209
      *                                                                                       CSW209
      ** Prints cover-related fields                                                          CSW209
      *                                                                                       CSW209
     C           INVALF    IFEQ 'COV'                                                         CSW209
      *                                                                                       CSW209
      ** Print only if cover fields not empty                                                 CSW209
      *                                                                                       CSW209
     C           WMASP1    IFNE *BLANK                                                        CSW209
     C           WMASP2    ORNE *BLANK                                                        CSW209
     C           WMASP3    ORNE *BLANK                                                        CSW209
     C           WMASP4    ORNE *BLANK                                                        CSW209
     C           WMASP5    ORNE *BLANK                                                        CSW209
     C           WMASP6    ORNE *ZEROS                                                        CSW209
     C                     MOVELINCOC1    P4COC1                                              CSW209
     C                     MOVELINCOC2    P4COC2                                              CSW209
     C                     MOVELINCOC3    P4COC3                                              CSW209
     C                     MOVELINCOC4    P4COC4                                              CSW209
     C                     MOVELINCOC5    P4COC5                                              CSW209
     C                     MOVELINCOB1    P4COB1                                              CSW209
     C                     MOVELINCOB2    P4COB2                                              CSW209
     C                     MOVELINCOB3    P4COB3                                              CSW209
     C                     MOVELINCOB4    P4COB4                                              CSW209
     C                     MOVELINCOB5    P4COB5                                              CSW209
     C                     MOVELINCIB1    P4CIB1                                              CSW209
     C                     MOVELINCIB2    P4CIB2                                              CSW209
     C                     MOVELINCIB3    P4CIB3                                              CSW209
     C                     MOVELINCIB4    P4CIB4                                              CSW209
     C                     MOVELINCIB5    P4CIB5                                              CSW209
     C                     MOVELINCAB1    P4CAB1                                              CSW209
     C                     MOVELINCAB2    P4CAB2                                              CSW209
     C                     MOVELINCAB3    P4CAB3                                              CSW209
     C                     MOVELINCAB4    P4CAB4                                              CSW209
     C                     MOVELINCAB5    P4CAB5                                              CSW209
     C                     MOVELINCBC1    P4CBC1                                              CSW209
     C                     MOVELINCBC2    P4CBC2                                              CSW209
     C                     MOVELINCBC3    P4CBC3                                              CSW209
     C                     MOVELINCBC4    P4CBC4                                              CSW209
     C                     MOVELINCBC5    P4CBC5                                              CSW209
     C                     MOVELINCBB1    P4CBB1                                              CSW209
     C                     MOVELINCBB2    P4CBB2                                              CSW209
     C                     MOVELINCBB3    P4CBB3                                              CSW209
     C                     MOVELINCBB4    P4CBB4                                              CSW209
     C                     MOVELINCBB5    P4CBB5                                              CSW209
     C                     MOVELINCBB6    P4CBB6                                              CSW209
     C                     MOVELINCDP1    P4CDP1                                              CSW209
     C                     MOVELINCDP2    P4CDP2                                              CSW209
     C                     MOVELINCDP3    P4CDP3                                              CSW209
     C                     MOVELINCDP4    P4CDP4                                              CSW209
     C                     MOVELINCICY    P4CICY                                              CSW209
     C                     MOVEL*BLANKS   P4CIAM                                              CSW209
      *                                                                                       CSW209
      ** Access AOCURR0 to get the currency's decimal places                                  CSW209
      *                                                                                       CSW209
     C           INCICY    IFNE *BLANKS                                                       CSW209
      *                                                                                       CSW209
     C                     CALL 'AOCURRR0'                                                    CSW209
     C                     PARM *BLANKS   @RTCD                                               CSW209
     C                     PARM '*KEY   ' @OPTN                                               CSW209
     C                     PARM           INCICY                                              CSW209
     C           SDCURR    PARM SDCURR    DSSDY                                               CSW209
      *                                                                                       CSW209
     C           @RTCD     IFNE *BLANKS                                                       CSW209
     C                     MOVEL'55'      WDBASE                                              CSW209
     C                     MOVELINCICY    WDBKEY                                              CSW209
     C                     MOVEL'SDCURRPD'WDBFIL                                              CSW209
     C                     SETON                     U7U8LR                                   CSW209
     C                     EXSR UEABRT                                                        CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     Z-ADDA6NBDP    W4CIAM  10                                          CSW209
      *                                                                                       CSW209
      ** Format Instructed Currency Amount                                                    CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   WFDIN                                               CSW209
     C                     MOVE INCIAM    WFDIN                                               CSW209
     C                     Z-ADDW4CIAM    WDEC                                                CSW209
     C           13        SUB  W4CIAM    WDIG                                                CSW209
     C                     EXSR UGFRMT                                                        CSW209
     C                     MOVE WFDOUT    P4CIAM                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     WRITEP4DETL                                                        CSW209
     C                     ENDIF                                                              CSW209
     C                     ENDIF                                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           CER031    IFEQ 'Y'                                                           CER030
     C                     MOVE IEXT1     P2EXT1                                              CER030
     C                     MOVE IEXT2     P2EXT2                                              CER030
     C                     MOVE IEXT3     P2EXT3                                              CER030
     C                     MOVE IEXT4     P2EXT4                                              CER030
     C                     MOVE IEXT5     P2EXT5                                              CER030
     C                     MOVE IEXT6     P2EXT6                                              CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C           CGL013    IFEQ 'Y'                                                           CER030
     C           CER030    OREQ 'Y'                                                           CER030
     C                     MOVE IRTTY     P2TRTP                                              CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C           CGL013    IFEQ 'Y'                                                           CER030
     C           CER030    OREQ 'Y'                                                           CER030
     C           CER031    OREQ 'Y'                                                           CER030
     C                     WRITEP1EXNR                                                        CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C                     MOVE '1'       *IN21            'OUTPUT, YES
     C*
     C*          *****     *****
     C           CCEND     ENDSR
     C*          *****     *****
     C/EJECT
     C           UCMUSE    BEGSR                                          S01435
     C*          ******    *****                                          S01435
     C*                                                                   S01435
     C*****************************************************************   S01435
     C*                 UC-CHAIN-USER-FILE                            *   S01435
     C*                                                               *   S01435
     C*  FUNCTION : TO ATTEMPT TO ACCESS THE RECORD FROM THE USER     *   S01435
     C*             FILE.                                             *   S01435
     C*                                                               *   S01435
     C*  CALLS :    NONE                                              *   S01435
     C*                                                               *   S01435
     C*  CALLED BY: CCDETL                                            *   S01435
     C*                                                               *   S01435
     C*****************************************************************   S01435
     C*                                                                   S01435
     C           USRP      CHAINMUSERDDF             89                   S01435
     C*                                                                   S01435
     C  N89      RECI      COMP 'D'                  8989                 S01435
      *                                                                   S01435
     C           *IN89     IFEQ '1'                                       S01435
     C                     MOVELUSRP      USER1                           S01435
     C                     END                                            S01435
     C*                                                                   S01435
     C*                    *****                                          S01435
     C                     ENDSR                                          S01435
     C*                    *****                                          S01435
      /EJECT
      *****************************************************************
      **
      **    Get name for Type.
      **
      **    CALLED FROM:  anywhere
      **    CALLS:
      **
      **
     C           GETADD    BEGSR
      ************                                                        S01435
      ************  Translation now performed through standard pgm        S01435
      ************                                                        S01435
      ************                                                        S01435
      ***Type*A=*Address leave as on file ..                              S01435
      ************                                                        S01435
      ***Type*blank ...                                                   S01435
      ************...  set to blanks.                                     S01435
     C***********XTYPE     IFEQ ' '                                       S01435
     C************         MOVE *BLANKS   XNAMDS                          S01435
     C************         END                                            S01435
      ************                                                        S01435
      ***Type*F=*Full Nostro                                              S01435
     C***********XTYPE     IFEQ 'F'                                       S01435
      ***Get*account key from Table using 5 chars.                        S01435
     C************         MOVE '05'      @ASE                            S01435
     C************         MOVE DS1T5     KYTABL                          S01435
     C***********KYTABL    CHAINTABLETLF             99                   S01435
      ************                                                        S01435
      ***DB*Error*if no record found or "deleted".                        S01435
     C************IN99     IFEQ '1'                                       S01435
     C***********RECI      ORNE 'D'                                       S01435
     C************         MOVEL'TABFP'   @FILE                           S01435
     C************         MOVELKYTABL    @KEY                            S01435
     C************         EXSR *PSSR                                     S01435
     C************         END                                            S01435
      ************                                                        S01435
     C************         MOVE '06'      @ASE                            S01435
     C***********CNUM      CHAINCLINTCCF             99                   S01435
      ************                                                        S01435
      ***DB*Error*if no record found or "deleted".                        S01435
     C************IN99     IFEQ '1'                                       S01435
     C***********RECI      ORNE 'D'                                       S01435
     C************         MOVEL'CLINT'   @FILE                           S01435
     C************         MOVELCNUM      @KEY                            S01435
     C************         EXSR *PSSR                                     S01435
     C************         END                                            S01435
      ************                                                        S01435
     C************         MOVELCLINTD    XADDS                           S01435
     C************         END                                            S01435
      ************                                                        S01435
      ***Type*R=*Retail .                                                 S01435
     C***********XTYPE     IFEQ 'R'                                       S01435
      ***Get*account key from ACNUMA using 10 chars.                      S01435
     C************         MOVE '07'      @ASE                            S01435
     C***********DS1T10    CHAINACNUMA               99                   S01435
      ************                                                        S01435
      ***DB*Error*if no record found.                                     S01435
     C************IN99     IFEQ '1'                                       S01435
     C***********RECI      ORNE 'D'                                       S01435
     C************         MOVEL'ACCNT'   @FILE                           S01435
     C************         MOVELDS1T10    @KEY                            S01435
     C************         EXSR *PSSR                                     S01435
     C************         END                                            S01435
      ************                                                        S01435
     C************         MOVE '08'      @ASE                            S01435
     C***********CNUM      CHAINCLINTCCF             99                   S01435
      ************                                                        S01435
      ***DB*Error*if no record found or "deleted".                        S01435
     C************IN99     IFEQ '1'                                       S01435
     C***********RECI      ORNE 'D'                                       S01435
     C************         MOVEL'CLINT'   @FILE                           S01435
     C************         MOVELCNUM      @KEY                            S01435
     C************         EXSR *PSSR                                     S01435
     C************         END                                            S01435
      ************                                                        S01435
     C************         MOVELCLINTD    XADDS                           S01435
     C************         END                                            S01435
      ************                                                        S01435
      ***If*Full(G) Customer(C) or Partial(P)..                           S01435
      *******...get name from Client file.                                S01435
     C***********XTYPE     IFEQ 'P'                                       S01435
     C***********XTYPE     OREQ 'G'                                       S01435
     C***********XTYPE     OREQ 'C'                                       S01435
     C************         MOVE '09'      @ASE                            S01435
     C***********DS1T6     CHAINCLINTCCF             99                   S01435
      ************                                                        S01435
      ***DB*Error*if no record found or "deleted".                        S01435
     C************IN99     IFEQ '1'                                       S01435
     C***********RECI      ORNE 'D'                                       S01435
     C************         MOVEL'CLINT'   @FILE                           S01435
     C************         MOVELDS1T6     @KEY                            S01435
     C************         EXSR *PSSR                                     S01435
     C************         END                                            S01435
      ************                                                        S01435
     C************         MOVELCLINTD    XADDS                           S01435
     C************         END                                            S01435
      *
      *                                                                   S01435
      *  Set up general parameters                                        S01435
      *                                                                   S01435
     C           *LIKE     DEFN BCCY      XCCY                            S01435
      *                                                                   S01435
     C                     CLEARW8FT                                      S01435
     C                     MOVEL*BLANKS   W8STMT                          S01435
     C                     MOVELXCCY      W8CCY                           S01435
     C                     MOVEL@PGM      W8CPGM                          S01435
     C                     MOVEL'*PRINT'  W8ACT                           S01435
     C                     Z-ADD5         W8NLIN                          S01435
      *                                                                   S01435
      *  Receivers Correspomdent                                          S01435
      *                                                                   S01435
     C                     MOVELXTYPE     W8TYPE                          S01435
     C                     MOVEL*BLANKS   W8LINS                          S01435
     C                     MOVELXNAMDS    W8LINS                          S01435
      *                                                                   S01435
      * Call expansion program                                            S01435
      *                                                                   S01435
     C                     CALL 'FT0315'               8989               S01435
     C                     PARM           W8RTN   7                       S01435
     C                     PARM           W8FT                            S01435
     C                     PARM           W8LINS256                       S01435
     C                     PARM           W8RPT 256                       S01435
     C                     PARM           W8MSG 256                       S01435
     C                     PARM           W8SCR 256                       S01435
      *                                                                   S01435
      ** Check if database error occurred                                 S01435
      *                                                                   S01435
     C           *IN89     IFEQ '1'                                       S01435
     C           W8RTN     ORNE *BLANKS                                   S01435
     C                     MOVEL'FT0315'  WDBFIL                          S01435
     C                     MOVEL'*CALL'   WDBKEY                          S01435
     C                     MOVEL'52'      WDBASE                          S01435
     C                     EXSR UEABRT                     *ABORT PGM*    S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     MOVELW8RPT     XNAMDS                          S01435
      *                                                                   S01435
     C                     ENDSR
     C           CHOPF     BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 CHOP FIELD PROCESSING                         *
     C*                                                               *
     C***FUNCTION*:*TO*EDIT**RCCO,*ACBK,*CDRO**FOR*OUTPUT.*           *
     C*  FUNCTION : TO EDIT  RCCO, CDRO  FOR OUTPUT.                  *
     C*             IF PRMFLD IS ZERO THEN OUTPUT BLANKS.             *
     C*             IF PRMTYP IS 'N',OUTPUT FIRST TWO CHARS.          *
     C*             IF PRMTYP ID 'R',OUTPUT FIRST TEN CHARS.          *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: CCDETL                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRMFLD    IFEQ *ZEROS
     C                     MOVE *BLANKS   PRMFLD
     C                     ELSE
     C*
     C           PRMTYP    IFEQ 'N'
     C                     MOVE BLNK10    PRMFLD
     C                     ELSE
     C*
     C           PRMTYP    IFEQ 'R'
     C                     MOVE BLNK2     PRMFLD
     C*
     C                     END
     C                     END
     C                     END
     C*
     C*                    *****
     C                     ENDSR
     C*                    *****
     C/EJECT
     C           CELAST    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 CE-LAST-RECORD-PROCESSING                     *
     C*                                                               *
     C*  FUNCTION : TO PERFORM CONTROL CHECKS WHEN THE TRAILER        *
     C*             RECORD IS READ.                                   *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: AAMAIN                                            *
     C*                                                               *
     C*****************************************************************
      *
      ** PERFORM INITIAL PROCESSING IF FIRST CYCLE **
      *
     C           *IN20     IFEQ '0'
     C                     EXSR CAINIT
     C                     END
     C*                                                                   S01117
     C** Set up SBRA                                                      S01117
     C*                                                                   S01117
     C           @RLEV     IFNE 'S'                                       S01117
     C           *IN22     ANDEQ'1'                                       S01117
     C           @RENT     ANDNE'ALL'                                     S01117
     C                     MOVEL@RENT     KBRCH                           S01117
     C                     EXSR AOBRC2                                    S01117
     C                     MOVE @RENT     SBRA                            S01117
     C                     MOVE A8BRNM    PBRNM                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** Move 'ALL' into SBRA                                             S01117
     C*                                                                   S01117
     C           @RENT     IFEQ 'ALL'                                     S01117
     C                     MOVE @RENT     SBRA                            S01117
     C                     MOVE *BLANKS   PBRNM                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If records exist for branch but have been cancelled              S01117
     C** set up branch field for audit report                             S01117
     C*                                                                   S01117
     C           SBRA      IFEQ *BLANKS                                   S01117
     C           *IN22     ANDEQ'1'                                       S01117
     C           @RLEV     ANDNE'S'                                       S01117
     C                     MOVEL@RENT     KBRCH                           S01117
     C                     EXSR AOBRC2                                    S01117
     C                     MOVE @RENT     SBRA                            S01117
     C                     MOVE A8BRNM    PBRNM                           S01117
     C                     END                                            S01117
     C*
     C** CHECK CONTROL TOTALS
     C*
     C*********************Z-ADDZZTOTI    P2CLWN                          S01194
     C*********************Z-ADDZZTOTD    P2CLDC                          S01194
     C                     Z-ADDZZTOTI    AUCLWN                          S01194
     C                     Z-ADDZZTOTD    AUCLDC                          S01194
     C*
     C*
     C           *IN21     IFEQ '0'                        NO DETAIL
     C*********************WRITEP1HD                       ON THE         S01117
     C*********************WRITEP1NODT                     REPORT         S01117
     C*********************END                                            S01117
     C                     WRITEAUHEAD                                    S01117
     C                     WRITEAUNODT                                    S01117
     C                     WRITEAUEOR                                     S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** OUTPUT CONTROL REPORT                                            S01117
      *                                                                   S01117
     C                     WRITEAUHEAD                                    S01117
     C                     WRITEAUCNTL                                    S01117
     C                     WRITEAUEOR                                     S01117
     C                     END                                            S01117
     C*---------------------------------------------------------------
     C*********************                                               S01117
     C***OUTPUT*CONTROL*REPORT*                                           S01117
     C*********************                                               S01117
     C*********************WRITEP2HEAD                                    S01117
     C*********************WRITEP2CNTL                                    S01117
     C*********************WRITEP2EOR                                     S01117
     C*
     C** OUTPUT END-OF-REPORT MESSAGE TO DETAIL REPORT
     C*
     C           *IN21     IFEQ '1'                                       S01117
     C                     WRITEP1EOR
     C                     END                                            S01117
     C*
     C** TERMINATE PROGRAM
     C*
     C                     SETON                     LR
     C*
     C*          *****     *****
     C           CEEND     ENDSR
     C*          *****     *****
      /EJECT                                                              S01194
      *          ******    *****                                          S01194
     C           AOBRC2    BEGSR                                          S01194
      *          ******    *****                                          S01194
      *                                                                   S01194
      *****************************************************************   S01194
      *                 READ SDBRCHPD-FILE                            *   S01194
      *                                                               *   S01194
      *  FUNCTION : TO ACCESS A REQUESTED RECORD FROM THE BRANCH FILE *   S01194
      *                                                               *   S01194
      *  CALLS :    NONE                                              *   S01194
      *                                                               *   S01194
      *  CALLED BY: MAIN , CELAST                                     *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM KBRCH     @BRCD   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVELKBRCH     WDBKEY           ***************S01194
     C                     MOVEL'SDBRCHPD'WDBFIL           * DB ERROR 15 *S01194
     C                     MOVEL'015'     WDBASE           ***************S01194
     C                     EXSR UEABRT                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C/EJECT
     C           UATBCN    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 UA-CHAIN-TABLE-FILE                           *
     C*                                                               *
     C*  FUNCTION : TO ATTEMPT TO ACCESS A REQUESTED RECORD FROM THE  *
     C*             TABLE FILE.                                       *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: AAMAIN                                            *
     C*             ECINST                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZTABKY    CHAINTABFP                89
     C*
     C  N89      RECI      COMP 'D'                  8989
     C*
     C*          *****     *****
     C           UAEND     ENDSR
     C*          *****     *****
     C/EJECT
     C           UCCLCN    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 UC-CHAIN-PAYMENT-CHARGES-FILE                 *
     C*                                                               *
     C*  FUNCTION : TO ATTEMPT TO ACCESS THE RECORD FROM THE PAYMENT  *
     C*             CHARGES FILE.                                     *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: CADETL                                            *
     C*             EEAMND                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           WCLKEY    KLIST
     C**********           KFLD           WCLNUM  60                                          CSD027
     C                     KFLD           WCLNUM  6                                           CSD027
     C                     KFLD           WCLRCT  1
     C*
     C           WCLKEY    CHAINCLINT                89
     C*
     C  N89      RECI      COMP 'D'                  8989
     C*
     C*          *****     *****
     C           UCEND     ENDSR
     C*          *****     *****
     C/EJECT
     C           UGFRMT    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*             UG-FORMAT-FIELD-FOR-OUTPUT-TO-REPORT              *
     C*                                                               *
     C*  FUNCTION : TO FORMAT A NUMERIC FIELD FROM THE PAYMENT        *
     C*             CHARGES FILE FOR OUTPUT TO THE DETAIL SCREEN.     *
     C*             IT REMOVES LEADING ZEROES & INSERTS A DECIMAL     *
     C*             POINT IN THE APPROPRIATE POSITION.                *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: CADETL                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C                     MOVEAWFDIN     WA1,1
     C*
     C** REPLACE LEADING ZEROES (IF LEFT OF DECIMAL POINT) WITH SPACES
     C*
     C                     SETOF                     89
     C           15        SUB  WDIG      I       30        -START
     C                     SUB  WDEC      I                  POS.
     C*
     C           14        SUB  WDEC      I1      30
     C*
     C           *IN89     DOUEQ'1'
     C                     ADD  1         I
     C           I         IFGT 15                          -CHECK FOR
     C                     SETON                     89      ARRAY END
     C                     ELSE
     C           WA1,I     IFNE '0'                         -CHECK FOR
     C                     SETON                     89      NON-ZERO
     C                     ELSE                              DIGIT.
     C           I         IFLE I1
     C                     MOVEL' '       WA1,I
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C** MOVE DIGITS TO RIGHT OF DECIMAL POINT(IF ANY) TO OUTPUT ARRAY
     C** & INSERT A DECIMAL POINT
     C*
     C                     MOVEL*BLANKS   WA2
     C*
     C           16        SUB  WDEC      I
     C           21        SUB  WDEC      I1
     C*
     C           I         IFLE 15
     C                     MOVEAWA1,I     WA2,I1
     C                     SUB  1         I1
     C                     MOVEL'.'       WA2,I1
     C                     END
     C*
     C** INSERT A COMMA AFTER EVERY 3 DIGITS TO LEFT OF DECIMAL POINT
     C*
     C                     SUB  1         I
     C                     SUB  1         I1
     C                     Z-ADD*ZERO     I2      30
     C*
     C           WA1,I     DOUEQ' '
     C           I         OREQ *ZERO
     C*
     C           I2        IFEQ 3
     C                     MOVEL','       WA2,I1
     C                     SUB  1         I1
     C                     Z-ADD*ZERO     I2
     C                     END
     C*
     C                     MOVE WA1,I     WA2,I1
     C                     SUB  1         I
     C                     SUB  1         I1
     C                     ADD  1         I2
     C                     END
     C*
     C                     MOVEAWA2,1     WFDOUT 20
     C*
     C*          *****     *****
     C           UGEND     ENDSR
     C*          *****     *****
     C/EJECT
     C**
     C**
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C/EJECT
     C*
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C/EJECT
     C**
     C**
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C/EJECT
     C**
     C********************************************************************
     C**
     C**
     C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD.*  S01117
     C**   SYSTEM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01117
     C**
     C***********ZSYSTM    BEGSR                           *** ZSYSTEM ***S01117
     C           SYSTEM    BEGSR                           *** SYSTEM  ***S01117
     C*                                                                   S01117
     C** CALL ZSFILE TO LOG SPOOL FILE DETAILS                            S01117
     C*                                                                   S01117
     C                     Z-ADD1         PPAGE                           S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ                           S01117
     C                     PARM *BLANKS   ZSENT                           S01117
     C                     PARM SFILU     SFILP                           S01117
     C                     PARM SFNUMU    SPLNO                           S01117
     C                     PARM *BLANKS   ZERR                            S01117
     C*                                                                   S01117
     C           ZERR      IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'FT0525'  DBPGM                           S01117
     C                     MOVEL'FT525AU' DBKEY            ***************S01117
     C                     MOVEL'ZSFILE'  DBFILE           * DB ERROR 13 *S01117
     C                     MOVEL'013'     DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C**
     C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.
     C                     MOVEL'01      'ZTABKY 12
     C                     MOVE '  10'    ZTABKY
     C**
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
     C**
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C**
     C                     ENDSR
     C**
      /EJECT
     C           UEABRT    BEGSR
      *          ******    *****
      *
      *****************************************************************
      *                 UE-ABORT-PROGRAM                              *
      *                                                               *
      *  FUNCTION : TO ABORT THE PROGRAM IN THE EVENT OF A DATABASE   *
      *             ERROR. ALSO TO SETUP THE RELEVANT FIELDS IN THE   *
      *             DATA AREA LDA FOR THIS ERROR.                     *
      *                                                               *
      *  CALLS :    NONE                                              *
      *                                                               *
      *  CALLED BY: AAMAIN                                            *
      *             ECINST                                            *
      *             EEAMND                                            *
      *                                                               *
      *****************************************************************
      *
      ** UPDATE DATA AREA LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL@PGM      DBPGM
     C                     MOVELWDBFIL    DBFILE
     C                     MOVELWDBKEY    DBKEY
     C                     MOVELWDBASE    DBASE
     C                     OUT  LDA
      *
      ** SETON INDICATORS TO INDICATE DATABASE ERRORS
      *
     C                     SETON                     U7U8LR
      *
      ** REPORT DATABASE ERROR
      *
     C           *IN22     IFEQ '1'                                       S01117
     C                     MOVE @RENT     SBRA                            S01117
     C           @RENT     IFEQ 'ALL'                                     S01117
     C                     MOVE *BLANKS   PBRNM                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*********************WRITEP2HEAD                                    S01117
     C                     WRITEAUHEAD                                    S01117
      *
     C*********************MOVELWDBASE    P2DBAS                          S01194
     C*********************MOVELWDBFIL    P2DBFL                          S01194
     C*********************MOVELWDBKEY    P2DBKY                          S01194
     C                     MOVELWDBASE    DBASE                           S01194
     C                     MOVELWDBFIL    DBFILE                          S01194
     C                     MOVELWDBKEY    DBKEY                           S01194
      *
     C*********************WRITEP2DBER                                    S01117
     C                     WRITEAUDBER                                    S01117
      *
      ** PRODUCE PROGRAM DUMP
      *
     C                     DUMP
      *
      ** END PROGRAM
      *
     C                     RETRN
      *
      *          *****     *****
     C           UEEND     ENDSR
      *          *****     *****
      /EJECT
      *****************************************************************
      **
      **
      **    FILE ERROR HANDLING
      **
      **    CALLED FROM:  anywhere
      **    CALLS:        *PSSR
      **
     C           FILESR    BEGSR                                       ***
     C                     SETON                         U8
     C                     MOVEL@FILE     @FILE
     C                     EXSR *PSSR
      **
     C                     ENDSR
      *****************************************************************
      **
      **
      **    DEFAULT ERROR HANDLING
      **
      **    CALLED FROM:  anywhere,FILESR
      **    CALLS:        returns.
      **
     C           *PSSR     BEGSR                                       ***
     C           WERROR    IFNE 'Y'
     C                     MOVE 'Y'       WERROR  1
     C                     DUMP
     C        NU8          SETON                       U7U8
     C           *LOCK     IN   LDA
     C                     MOVEL@PGM      DBPGM
     C                     MOVEL@KEY      DBKEY
     C                     MOVEL@FILE     DBFILE
     C                     MOVEL@ASE      DBASE
     C                     OUT  LDA
      *
      ** Print message on report.
     C                     WRITEAUHEAD                                    S01194
     C*********************WRITEP2DBER                                    S01194
     C                     WRITEAUDBER                                    S01194
     C                     END
      *
     C                     SETON                         LR
     C                     RETRN
      **
     C                     ENDSR
      **
      /EJECT                                                              CEU006
     C/COPY ZSRSRC,ZSEDITZ3                                               CEU006
     C/COPY ZSRSRC,ZEDITZ2                                                CFT009
      *                                                                   CEU006
      /EJECT                                                              CEU006
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  DESC
Miscellaneous Charge 1                                                    CFT009
Miscellaneous Charge 2                                                    CFT009
Miscellaneous Charge 3                                                    CFT009
Miscellaneous Charge 4                                                    CFT009
Miscellaneous Charge 5                                                    CFT009
