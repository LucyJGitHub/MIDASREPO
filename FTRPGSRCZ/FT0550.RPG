     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Cheques To Be Paid Audit & Report')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                            *
     F*                                                               *
     F*  FT0550 - Audit/Full List of Cheques to be Paid.              *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG7985            Date 07Jul05               *
      *                 CER001             Date 25Apr05               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187494             Date 19Mar01               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU006             Date 01Apr98               *
      *                 099217             Date 04FEB98               *
      *                 S01408             Date 04SEP95               *
     F*                 084523             DATE 10MAR95               *
     F*                 081204             DATE 08MAR95               *
     F*                 S01499             DATE 06JUN94               *
     F*                 S01494             DATE 25MAY94               *
     F*                 S01414             DATE 29MAR93               *
     F*                 S01414             DATE 29MAR93               *
     F*                 E25125             DATE 03JUN91               *
     F*                 E25273             DATE 30MAY91               *
     F*                 E32860             DATE 21MAY91               *
     F*                 E32879             DATE 21MAY91               *
     F*                 S01117             DATE 27SEP90               *
     F*                 S01194             DATE 27SEP90               *
     F*                 E23054             DATE 06AUG90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG7985- Several components failed due to accessing TABLETR  *
      *  CER001 - LUX Upgrade to MidasPlus
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  187494 - Recompiled due to changes done in PRTF/FT0550P1.    *
      *  CEU006 - EMU FT Payments and Settlement.                     *
     F*  099217 - Report doesn't show clearly how Net Debit Amount is *
     F*           calculated. Amend report to show settlement amount  *
     F*           before charges AND settlement amount net of charges.*
     F*  S01408 - Addition of hooks FT0550CCP1                        *  *
     F*                             FT0550CCP2                        *  *
     F*                             FT0550CCP3                        *  *
     F*                             FT0550EEP1                        *  *
     F*                             FT0550IIP1                        *  *
     F*  084523 - NO DBERROR IF RECORD NOT FOUND FOR USER             *
     F*                                                               *
     F*  081204 - In Audit Mode, pgm should only list today's input - *
     F*           set up IF condition correctly.                      *
     F*  S01499 - BLI V.A.T. Processing                               *
     F*  S01494 - BLI Funds Transfer Enhancements                     *
     F*  S01414 - Book Code and Profit Centre Incorporation.          *
     F*  E25125 - DELETED DEBIT PARTIES ARE NOT HIGHLIGHTED           *
     F*  E25273 - Print debit details if credit details have          *
     F*           changed, not just credit details                    *
     F*  E32860 - Print debit currency equivalent in settlements      *
     F*  E32879 - Show override on the report                         *
     F*  S01117 - RELEASE 10 MULTIBRANCHING CHANGES                   *
     F*  S01194 - STANDING DATA CHANGES                               *
     F*  E23054 - NON AUTHORIZED TRANSACTIONS SHOW AUTHORIZING        *
     F*           OFFICERS                                            *
     F*                                                               *
     F*****************************************************************
     F*CQPAC***IP**E***********K********DISK                              S01117
     FCQPACBB IP  E           K        DISK                               S01117
     F*CQPACZZ*IS**E***********K        DISK                              S01117
     F*CQPADZZ*IS**E***********K        DISK                              S01117
     FCQPACZZ IF  E           K        DISK                               S01117
     FCQPADZZ IF  E           K        DISK                               S01117
     FTABFP   IF  E           K        DISK
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F************TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABLETHF                          KIGNORE               S01117
     F            TABTE10F                          KIGNORE               S01117
     F            TABTG40F                          KIGNORE               S01117
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCBF                          KIGNORE
     F            CLINTSEF                          KIGNORE               S01117
     F            CLINTC1F                          KIGNORE               S01117
     F/COPY WNCPYSRC,FT0550F002
     FMUSER   IF  E           K        DISK
     F/COPY WNCPYSRC,FT0550F003
     F*FT0550P2O***E********************PRINTER                           S01117
     F*FT0550P1O***E********************PRINTER                           S01117
     FFT0550AUO   E                    PRINTER      KINFDS SPOOL2         S01117
     FFT0550P1O   E                    PRINTER      KINFDS SPOOL1     UC  S01117
     F/COPY WNCPYSRC,FT0550F001
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*                                                                  *
     F*       10      MULTIBRANCHING INDICATOR                            S01117
     F*       11      SYSTEM LEVEL INDICATOR                              S01117
     F*       12      DIRECT COB INDICATOR (ON IF NOT COB)                S01117
     F*       14      BOOKING/ORIGINATING BRANCH INDICATOR (ON IF ORIG.BR)S01117
     F*       20      NOT THE FIRST CYCLE
     F*       21      PRINT HEADINGS, IF NOT ALREADY PRINTED
     F*      30/33    DECIMAL POSITIONS ' 0 TO 3 '.
     F********34******TO DISTINGUISH BETWEEN THE TWO TRAILER RECORDS      S01117
     F*      40/43    DECIMAL POSITIONS ' 0 TO 3 '.
      *  46    - Pay Delivery Amount is not zero.                     *   CEU006
      *  47    - Notified Delivery Amount is not zero.                *   CEU006
      *  48    - Chain indicator for TABFP                            *   CEU006
     F*       50      VALID CURRENCY.
     F*       51      AUDIT REPORT INDICATOR
     F*       60      JUST GONE INTO PAGE OVERFLOW.
     F*       70-73   Used in DEBIT Subroutine
     F*       75      DEBIT PARTY DETAIL RECORD DELETED                   E25125
     F*       76      Profit Centres In Use Flag                          S01414
     F*       77      THERE IS SOME DETAIL ON THE REPORT.
     F*                                                                  *
     F*      U7/U8    DATABASE ERRORS.                                   *
     F*                                                                  *
     E                    CPY@    1   1 80
     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    CCYA      150  3               * CURRENCY CODES
     E                    CDPA      150  1 0             * CCY DEC. PLACES
     E                    @P      1   7  7 3                              E32860
     E*                                                                   S01408
     E/COPY WNCPYSRC,FT0550EEP1                                           S01408
     E                    IUL         7132                                                    CER001
     E*                                                                   S01408
     E/COPY ZSRSRC,ZSEDITZ1                                               CEU006
     I***
     I***   DETAIL RECORDS                                             I
     I***
     ICQPACDDF
     I              RECI                            RECICQ
     I              LCD                             ILCD
     I              CHTP                            ICHTP
     I                                              PREF  L1
     I***
     ICQPADDDF
     I              RECI                            RECICQ
     I************* LCD                             ILCD                  E25273
     I              LCD                             ILCDX                 E25273
     I              CHTP                            ICHTP
     I***
     I***   TRAILER RECORDS                                            I
     I***
     ICQPACZZF
     I              RECI                            RECICQ
     I***
     ICQPADZZF
     I              RECI                            RECICQ
     I***
     ITABTB10F
     I***
     I***   STANDING DATA FILE DETAIL  - PF/TABTB10  ICD 1
     I***
     I              RECI                            RECITB
     ITABTB11F
     I***
     I***   STANDING DATA FILE DETAIL  - PF/TABTB11  ICD 2
     I***
     I              RECI                            RECITB
     I***
     ITABTG10F
     I***
     I***   STANDING DATA FILE DETAIL  - PF/TABTG10  CURRENCIES
     I***
     I              RECI                            RECITB
     ICLINTCCF
     I***
     I***   RECORD FROM CLINT WITH NAME + ADDRESS
     I***
     I              RECI                            RECICL
     I***
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     IDLDA        DS                            256
     I***
     I***   LOCAL DATA AREA  -  DATABASE ERRORS
     I***
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I***
     I***   DATA STRUCTURE TO SUB DIVIDE TABLE KEY FIELD
     I***
     I            DS                             12
     I                                        1  12 KEY
     I                                        1   2 RECTTB
     I                                        9  11 CCYTB
     I                                       12  12 SRECTB
     I*                                                                   S01117
     I** Data structure for Remmitting Branch field                       S01117
     ICBANK1      DS                             35                       S01117
     I                                       16  18 RBKBR                 S01117
     I*                                                                   S01117
     ICLNTKY      DS                             35
     I***
     I***   DATA STRUCTURE FOR CLINT KEY
     I***
     I                                        1  35 RBK1
     I**********                              1   60CUSTN                                     CSD027
     I                                        1   6 CUSTN                                     CSD027
     ISPOOL1      DS                                                      S01117
     I***                                                                 S01117
     I*** INFDS  FOR PRINTER FILE.                                        S01117
     I***                                                                 S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     ISPOOL2      DS                                                      S01117
     I***                                                                 S01117
     I*** INFDS  FOR AU PRINTER FILE                                      S01117
     I***                                                                 S01117
     I                                       83  92 SFILE2                S01117
     I                                    B 123 1240SFNUM2                S01117
      *                                                                   E32860
     I            DS                                                      E32860
     I                                        1  110@OUT0                 E32860
     I                                        1  111@OUT1                 E32860
     I                                        1  112@OUT2                 E32860
     I                                        1  113@OUT3                 E32860
      *                                                                   E32860
     I            DS                                                      099217
     I                                        1  110@NET0                 099217
     I                                        1  111@NET1                 099217
     I                                        1  112@NET2                 099217
     I                                        1  113@NET3                 099217
     I*                                                                   S01117
     ISDGELR    E DSSDGELRPD                                              S01194
     I*External data structure for General Ledger Details                 S01194
     I*                                                                   S01494
     ISCSARD    E DSSCSARDPD                                              S01494
     I** External data structure for SAR File details                     S01494
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*1st DS for access program , short data structure                   S01194
     I*                                                                   S01194
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0550IIP1                                           S01408
     ISDMMOD    E DSSDMMODPD                                                                  CER001
      *                                                                                       CER001
      ** Dummy record formats for access to Midas modules details                             CER001
      *                                                                                       CER001
     ISDBRCH    E DSSDBRCHPD                                                                 BUG7985
      *                                                                                      BUG7985
      ** Midas SD Branch Codes                                                               BUG7985
      *                                                                                      BUG7985
     IILLINE      DS                            396                                           CER001
      *                                                                                       CER001
      ** Extended informations from IBLC 2002                                                 CER001
      *                                                                                       CER001
     I                                        1 132 ILLIN1                                    CER001
     I                                      133 264 ILLIN2                                    CER001
     I                                      265 396 ILLIN3                                    CER001
     I*                                                                   S01408
     I/COPY ZSRSRC,ZSEDITZ2                                               CEU006
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C                     MOVEACPY@      BIS@   80
     C                     MOVEL*BLANKS   RRLINE132                                           CER001
     C*
     C/EJECT
     C********************************************************************
     C***
     C***    KLIST FOR KEY TO  - PF/CLINTCC
     C***
     C           CLIKEY    KLIST
     C                     KFLD           CUSTN
     C                     KFLD           B
     C*
     C********************************************************************
     C***
     C***    F I R S T   C Y C L E    C A L C ' S
     C***
     C********************************************************************
     C           *IN20     IFEQ '0'                        ### B001
     C                     SETON                     20
     C*
     C*********************MOVEL'01    '  ZTABKY 12                       S01117
     C*********************MOVE '    10'  ZTABKY                          S01117
     C*********************Z-ADD*ZEROS    ZERO15 150                      S01117
     C*********************MOVE *BLANKS   BLNK35 35                       S01117
     C*********************MOVE 'B'       B       1                       S01117
     C*********************MOVE 'YES'     YES     3                       S01117
     C*********************MOVE 'NO '     NO      3                       S01117
     C*********************                                               S01117
     C***********ZTABKY****CHAINTABFP                99    ON NOT THERE   S01117
     C*********************                                               S01117
     C************IN99*****IFEQ '1'                        ### B002       S01117
     C***********RECITB****ORNE 'D'                                       S01117
     C*********************MOVE 'TABFP'   WBFILE  5        ***************S01117
     C*********************MOVELZTABKY    WBKEY  28        ** DBERR  01 **S01117
     C*********************Z-ADD01        WBASE   20       ***************S01117
     C*********************EXSR ABORT                                     S01117
     C*********************END                             ### E002       S01117
     C*                                                                   S01117
     C** READ TABTB10, TABTB11, AND SET UP MULTIBRANCHING DETAILS         S01117
     C*                                                                   S01117
     C                     EXSR MBINIT                                    S01117
     C*                                                                   S01117
     C*  USED IN SUBROUTINE 'CHOPF'
     C**********           MOVE *BLANKS   BLNK10 10                                           CGL029
     C**********           MOVE *BLANKS   BLNK2   2                                           CGL029
     C                     MOVE *BLANKS   BLNK10 16                                           CGL029
     C                     MOVE *BLANKS   BLNK2   8                                           CGL029
     C*
     C** SETUP REPORT HEADING + STATUS OF RECORD FOR 'AUDIT LIST.
     C*
     C           PARM1     IFEQ 'A'
     C                     MOVEL'* INSERT'INSERT 12
     C                     MOVE 'ED *'    INSERT
     C                     MOVEL'* AMENDE'AMEND  12
     C                     MOVE 'D * '    AMEND
     C                     MOVEL'* DELETE'DELETE 12
     C                     MOVE 'D * '    DELETE
     C                     MOVEL'AUDIT'   P1HEAD
     C                     MOVE 'LIST'    P1HEAD
     C                     MOVEL'--------'P1DASH 11
     C                     MOVE '---'     P1DASH
     C                     ELSE
     C                     MOVEL'LIST'    P1HEAD
     C                     MOVEL'----'    P1DASH
     C                     END
     C*
     C*********************WRITEP1HEDT                     -HEADINGS---   S01117
     C*
     C           DATF      COMP 'M'                      98 'DATE
     C**                                                    'FORMAT
     C*********************MOVE '11'      ZTABKY                          S01117
     C***********ZTABKY****CHAINTABFP                99    ON NOT THERE   S01117
     C*********************                                               S01117
     C************IN99*****IFEQ '1'                        ### B002       S01117
     C***********RECITB****ORNE 'D'                                       S01117
     C*********************MOVE 'TABFP'   WBFILE           ***************S01117
     C*********************MOVELZTABKY    WBKEY            ** DBERR  02 **S01117
     C*********************Z-ADD02        WBASE            ***************S01117
     C*********************EXSR ABORT                                     S01117
     C*********************END                             ### E002       S01117
     C**
     C**   BUILD UP CURRENCIES/DEC. POSITIONS ARRAYS
     C**
     C                     MOVEL'20    '  ZTABKY
     C                     MOVE '      '  ZTABKY
     C                     Z-ADD1         Z       30
     C*
     C           ZTABKY    SETLLTABFP
     C*
     C           *IN89     DOWEQ'0'                        ### B002
     C                     READ TABFP                    89
     C           RECITB    IFEQ 'D'                        ### B003
     C           RECTTB    IFNE '20'                       ### B004
     C                     SETON                         89
     C                     ELSE                            ### X004
     C*
     C           SRECTB    IFEQ '1'                        ### B005
     C                     MOVE CCYTB     CCYA,Z
     C                     Z-ADDCDP       CDPA,Z
     C                     ADD  1         Z
     C           Z         IFGT 150                        ### B006
     C                     SETON                     89
     C                     END                             ### E006
     C                     END                             ### E005
     C                     END                             ### E004
     C*
     C                     END                             ### E003
     C                     END                             ### E002
     C*
     C** DECIMAL POSITIONS FOR 'BASE' CURRENCY
     C*
     C                     MOVE BCCY      CRNCY
     C                     EXSR CCYSR
     C                     MOVE CDPA,Z    BCDP    10
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0550CCP1                                           S01408
     C*                                                                   S01408
     C                     CALL 'AOMMODR0'                                                    CER001
     C                     PARM '*MSG    '@RTCD   7                                           CER001
     C                     PARM '*FIRST  '@OPTN   7                                           CER001
     C           SDMMOD    PARM SDMMOD    DSFDY                                               CER001
     C*                                                                                       CER001
     C           @RTCD     IFNE *BLANKS                                                       CER001
     C                     MOVE 'N'       BGNWST                                              CER001
     C                     ENDIF                                                              CER001
     C*
     C** DECLARE ENTRY PARAMETER - REPORT TYPE
     C*
     C           *ENTRY    PLIST
     C                     PARM           @PSEQ   5                       S01117
     C                     PARM           @PLEV   1                       S01117
     C                     PARM           @PENT   3                       S01117
     C                     PARM           PARM1   1
     C*
     C                     MOVEL'*** DIFF'DIFFXX 16
     C                     MOVE 'ERENCE *'DIFFXX
     C*
     C                     END                             ### E001
     C*
     C/EJECT
     C********************************************************************
     C***
     C***   D E T A I L    P R O C E S S I N G
     C***
     C********************************************************************
     C*                                                                   S01117
     C** SETON LR IF CHANGE OF BRANCH AND @PLEV='B'                       S01117
     C*                                                                   S01117
     C           @PLEV     IFEQ 'B'                                       S01117
     C           @PENT     ANDNE'ALL'                                     S01117
     C           *IN14     IFEQ '0'                                       S01117
     C           BRCA      ANDNE@PENT                                     S01117
     C           *IN14     OREQ '1'                                       S01117
     C           ORBR      ANDNE@PENT                                     S01117
     C                     SETON                       LR                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C**    PROCESS A DETAIL RECORD OR A TRAILER.
     C*
     C***********RECICQ    IFNE 'Z'                                       S01117
     C           *INLR     IFNE '1'                                       S01117
     C                     EXSR DETAIL
     C*********************ELSE                                           S01117
     C*********************EXSR TRAILR                                    S01117
     C                     END
     C*                                                                   S01117
     CLR                   EXSR TRAILR                                    S01117
     C*
     C********************************************************************
     C**
     C**    THE PROCESSING OF A DETAIL RECORD  .
     C**
     C           DETAIL    BEGSR                           ** DETAIL **
     C*
     C                     EXSR HASH
     C*
     C           PARM1     IFEQ 'A'                        ### B001
     C           RUND      ANDEQILCD
     C***********PARM1     OREQ 'A'                                 E25273081204
     C***********RUND      ANDEQILCDX                               E25273081204
     C           RUND      IFEQ ILCD                                      081204
     C           RUND      ANDEQILCDX                                     081204
     C*
     C           *INL1     IFEQ '1'                        ### B002
     C*
     C** SETUP STATUS OF RECORD
     C*
     C                     MOVE *BLANKS   P1STTS
     C           ICHTP     IFEQ 'I'
     C                     MOVE INSERT    P1STTS
     C                     END
     C           ICHTP     IFEQ 'A'
     C                     MOVE AMEND     P1STTS
     C                     END
     C           ICHTP     IFEQ 'D'
     C                     MOVE DELETE    P1STTS
     C                     END
     C*
     C                     EXSR CREDIT
     C*
     C                     ELSE                            ### X002
     C                     EXSR DEBIT
     C*
     C                     END                             ### E002
     C*
     C                     END                             ### E001 -X    081204
     C*********************END                             ### E001 -X    S01117
     C***********--------------------------*                              S01117
     C*********************                                               S01117
     C***********PARM1*****IFEQ 'L'                        ### B001 -X    S01117
     C                     ELSE                            ### X001       S01117
     C***********RECICQ****ANDEQ'D'                                       S01117
     C           RECICQ    IFEQ 'D'                                       S01117
     C*
     C           *INL1     IFEQ '1'                        ### B002
     C*
     C                     EXSR CREDIT
     C*
     C                     ELSE                            ### X002
     C                     EXSR DEBIT
     C*
     C                     END                             ### E002
     C*
     C                     END                                            S01117
     C                     END                             ### E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0550CCP2                                           S01408
     C*                                                                   S01408
     C*
     C           *IN60     IFEQ *ON                                                           CER001
     C                     WRITEP1HEDT                 60                                     CER001
     C                     ENDIF                                                              CER001
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   TO LOOK-UP THE CCY AND FIND DEC. POSITIONS
     C**
     C           CCYSR     BEGSR                           ** CCYARR **
     C                     Z-ADD001       Z
     C           CRNCY     LOKUPCCYA,Z                   50
     C                     MOVE CDPA,Z    CDP
     C*
     C           *IN50     IFEQ '0'
     C*********************MOVE 'TABFP'   WBFILE                          S01194
     C                     MOVEL'TABFP'   WBFILE                          S01194
     C                     MOVE *BLANKS   KEY
     C                     MOVE '1'       SRECTB
     C                     MOVE CRNCY     CCYTB
     C                     MOVE '20'      RECTTB           ***************
     C                     MOVELKEY       WBKEY            ** DBERR  03 **
     C                     Z-ADD03        WBASE            ***************
     C                     EXSR ABORT
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C**
     C**   CREATE A SEPERATE SET OF HASH TOTALS FOR EACH RECORD.
     C**
     C           HASH      BEGSR                           ** HASH   **
     C*
     C                     MOVE ZERO15    ZZAMT
     C                     MOVE ZERO15    ZZTOTI
     C                     MOVE ZERO15    ZZTOTD
     C*
     C           *INL1     IFEQ '1'
     C*
     C                     ADD  1         TNCR#            'SET UP
     C                     MOVE PRRM      ZZAMT            'CREDIT
     C                     MOVE TICR#     ZZTOTI           'HASH TOTALS
     C                     MOVE TDCR#     ZZTOTD
     C                     EXSR GLZADD
     C                     MOVE ZZTOTI    TICR#
     C                     MOVE ZZTOTD    TDCR#
     C*
     C                     ELSE
     C*
     C                     ADD  1         TNDB#            'SET UP DEBIT
     C                     MOVE CQAM      ZZAMT            'HASH TOTALS
     C                     MOVE TIDB#     ZZTOTI
     C                     MOVE TDDB#     ZZTOTD
     C                     EXSR GLZADD
     C                     MOVE ZZTOTI    TIDB#
     C                     MOVE ZZTOTD    TDDB#
     C                     END
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C           CHOPF     BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 CHOP FIELD PROCESSING                         *
     C*                                                               *
     C*  FUNCTION : TO EDIT  SNCO, ORBK, CDRO  FOR OUTPUT.            *
     C*             IF PRMFLD IS ZERO THEN OUTPUT BLANKS.             *
     C*             IF PRMTYP IS 'N',OUTPUT FIRST TWO CHARS.          *
     C*             IF PRMTYP ID 'R',OUTPUT FIRST TEN CHARS.          *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: DEBIT                                             *
     C*             CREDIT                                            *
     C*****************************************************************
     C*
     C           PRMFLD    IFEQ *ZEROS
     C                     MOVE *BLANKS   PRMFLD
     C                     ELSE
     C*
     C           PRMTYP    IFEQ 'N'
     C                     MOVE BLNK10    PRMFLD
     C                     ELSE
     C*
     C           PRMTYP    IFEQ 'R'
     C                     MOVE BLNK2     PRMFLD
     C*
     C                     END
     C                     END
     C                     END
     C*
     C*                    *****
     C                     ENDSR
     C*                    *****
     C/EJECT
     C********************************************************************
     C**
     C**   CREDIT PROCESSING
     C**
     C           CREDIT    BEGSR                           ** CREDIT **
     C*                                                                   S01117
     C* IF @PENT NE 'ALL'                                                 S01117
     C* CALL ROUTINE FOR ZSFILE ONCE ONLY IF BRANCH NE 'ALL'              S01117
     C*                                                                   S01117
     C           @PENT     IFNE 'ALL'                                     S01117
     C           *IN77     ANDEQ'0'                                       S01117
     C                     EXSR ZSFLP1                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF CHANGE OF BRANCH DETECTED                                      S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                        B001           S01117
     C           *IN14     IFEQ '0'                        B002           S01117
     C           BRCA      ANDNESBRA                                      S01117
     C           *IN14     OREQ '1'                                       S01117
     C           ORBR      ANDNESBRA                                      S01117
     C*                                                                   S01117
     C* @PENT IFEQ 'ALL' AND CHANGE OF BRANCH,                            S01117
     C* WRITE FORMAT ENDING REPORT, CLOSE AND OPEN PRINTER FILE           S01117
     C*                                                                   S01117
     C           @PENT     IFEQ 'ALL'                      B003           S01117
     C           *IN77     IFEQ '1'                        B004           S01117
     C                     WRITEP1EOR                                     S01117
     C                     END                             E004           S01117
     C                     EXSR ZSFLP1                                    S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C* IF BRANCH CHANGED MOVE BRCA/ORBR INTO WORKFIELD                   S01117
     C*                                                                   S01117
     C           *IN14     IFEQ '0'                        B004           S01117
     C                     MOVE BRCA      SBRA                            S01117
     C                     ELSE                                           S01117
     C                     MOVE ORBR      SBRA                            S01117
     C                     END                             E004           S01117
     C                     EXSR TABTR                                     S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C* SET UP OTHER BRANCH FIELD ON DETAIL REPORT.                       S01117
     C*                                                                   S01117
     C           *IN14     IFEQ '0'                        B002           S01117
     C           *IN15     ANDEQ'1'                                       S01117
     C                     MOVE ORBR      SBRO    3                       S01117
     C                     EXSR TABTR2                                    S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      SBRO                            S01117
     C                     EXSR TABTR2                                    S01117
     C                     END                             E002           S01117
     C                     END                             E001           S01117
     C*
     C************IN21*****IFEQ '1'                        'PRINT,BUT     S01117
     C                     WRITEP1HEDT                 60  'NOT THE
     C*********************END                             'FIRST TIME    S01117
     C*
     C                     SETON                     21
     C                     MOVE 00        TOTCRD
     C/COPY WNCPYSRC,FT0550C002
     C*
     C                     MOVE RBK1      CBANK1
     C                     MOVE RBK2      CBANK2
     C                     MOVE RBK3      CBANK3
     C                     MOVE RBK4      CBANK4
     C*
     C           RBKT      IFEQ 'C'                        ### B001
     C*
     C           CLIKEY    CHAINCLINT                99
     C           *IN99     IFEQ '1'                        ### B002
     C           RECICL    ORNE 'D'
     C                     MOVEL'CLINT'   WBFILE                          S01194
     C*********************MOVE 'CLINT'   WBFILE           ***************S01194
     C                     MOVELCUSTN     CUSOUT  7        ** DBERR  04 **
     C                     MOVE B         CUSOUT           ***************
     C                     MOVELCUSOUT    WBKEY
     C                     Z-ADD04        WBASE
     C                     EXSR ABORT
     C                     END                             ### E002
     C*
     C                     MOVE CNA1      CBANK1
     C                     MOVE CNA2      CBANK2
     C                     MOVE CNA3      CBANK3
     C                     MOVE CNA4      CBANK4
     C*
     C                     END                             ### E001
     C*                                                                   S01117
     C** IF NONMULTIBRANCHING, DONT DISPLAY BRCH CODE FOR FULL ACCOUNT    S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C           RBKT      ANDEQ'G'                                       S01117
     C                     MOVEL*BLANKS   RBKBR                           S01117
     C                     END                                            S01117
     C*
     C*  FORMAT SWIFT PRIORITY CODE                                       S01117
     C*                                                                   S01117
     C           SWPC      IFEQ 1                                         S01117
     C                     MOVE 'U'       P1SWPC                          S01117
     C                     ELSE                                           S01117
     C           SWPC      IFEQ 2                                         S01117
     C                     MOVE 'N'       P1SWPC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           SNMT      IFEQ 'Y'
     C                     MOVE YES       DECIS
     C                     ELSE
     C                     MOVE NO        DECIS
     C                     END
     C*
     C                     Z-ADDPVDT      ZDAYNO           'FORMAT DATE
     C                     EXSR ZDATE2                     'TO DDMMMYY
     C                     MOVE ZADATE    VDATO   7
     C*
     C                     MOVE PCCY      CRNCY
     C                     MOVE PCCY      OCCY
     C                     MOVE PCCY      OCCY1
     C*                                                                   S01499
     C** If S01499 is switched on, format VAT currencies                  S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCCY      VCOCY                           S01499
     C                     MOVE PCCY      VDECY                           S01499
     C                     END                                            S01499
     C                     EXSR CCYSR
     C           CDP       COMP 2                    33  32
     C           CDP       COMP 1                      3031
     C                     SETOF                     25
     C           DIFF      IFNE 0
     C                     SETON                     25
     C                     MOVE ' '       DIFFSN
     C                     Z-ADDDIFF      WDIFF  130
     C           WDIFF     IFLT 0
     C                     Z-SUBWDIFF     WDIFF
     C                     MOVE '-'       DIFFSN
     C                     END
     C                     END
     C           *IN30     IFEQ '1'
     C                     MOVE TOTD      AMTA0
     C                     MOVE TOTR      AMTB0
     C                     MOVE COCH      AMTC0
     C                     MOVE DEDS      AMTD0
     C*                                                                   S01499
     C** If core feature S01499 is active, format V.A.T. amount           S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCVATC    VCAM0                           S01499
     C                     MOVE PCVATD    VDAM0                           S01499
     C                     END                                            S01499
     C                     MOVE PRRM      AMTG0
     C                     MOVE WDIFF     AMTH0
     C                     END
     C           *IN31     IFEQ '1'
     C                     MOVE TOTD      AMTA1
     C                     MOVE TOTR      AMTB1
     C                     MOVE COCH      AMTC1
     C                     MOVE DEDS      AMTD1
     C                     MOVE PRRM      AMTG1
     C*                                                                   S01499
     C** If core feature S01499 is active, format V.A.T. amount           S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCVATC    VCAM1                           S01499
     C                     MOVE PCVATD    VDAM1                           S01499
     C                     END                                            S01499
     C                     MOVE WDIFF     AMTH1
     C                     END
     C           *IN32     IFEQ '1'
     C                     MOVE TOTD      AMTA2
     C                     MOVE TOTR      AMTB2
     C                     MOVE COCH      AMTC2
     C                     MOVE DEDS      AMTD2
     C                     MOVE PRRM      AMTG2
     C                     MOVE WDIFF     AMTH2
     C*                                                                   S01499
     C** If core feature S01499 is active, format V.A.T. amount           S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCVATC    VCAM2                           S01499
     C                     MOVE PCVATD    VDAM2                           S01499
     C                     END                                            S01499
     C                     END
     C           *IN33     IFEQ '1'
     C                     MOVE TOTD      AMTA3
     C                     MOVE TOTR      AMTB3
     C                     MOVE COCH      AMTC3
     C                     MOVE DEDS      AMTD3
     C                     MOVE PRRM      AMTG3
     C                     MOVE WDIFF     AMTH3
     C*                                                                   S01499
     C** If core feature S01499 is active, format V.A.T. amount           S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCVATC    VCAM3                           S01499
     C                     MOVE PCVATD    VDAM3                           S01499
     C                     END                                            S01499
     C                     END
     C*  FORMAT 'SNCO' FOR OUTPUT
     C                     MOVE SNCT      PRMTYP  1        ( SNCO )
     C**********           MOVE *ZEROS    PRMFLD 12                                           CGL029
     C                     MOVE *ZEROS    PRMFLD 18                                           CGL029
     C                     MOVELSNCO      PRMFLD
     C                     EXSR CHOPF
     C                     MOVELPRMFLD    P1SNCO
     C*                                                                   S01499
     C** Set up V.A.T. flags if S01499 is active                          S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PCVAT1    RCVT1                           S01499
     C                     MOVE PCVAT2    RCVT2                           S01499
     C                     END                                            S01499
     C*
     C** SET UP USER FIELDS FROM MUSERDD
     C*
     C                     SETOF                     51
     C*
     C           PARM1     IFEQ 'A'
     C*
     C                     SETON                     51
     C*
     C           INUSR1    IFNE *BLANKS
     C                     MOVE INUSR1    USRP
     C                     EXSR UCMUSE
      *
     C                     MOVE USER1     SIUSR1 25
     C*
     C                     ELSE                                     E23054
     C*                                                             E23054
     C** CLEAR OUTPUT FIELD                                         E23054
     C*                                                             E23054
     C                     MOVE *BLANKS   SIUSR1                    E23054
     C*                                                             E23054
     C                     END
     C*
     C                     END
     C*
     C           PDAM      IFEQ 0                                         CEU006
     C                     MOVE '0'       *IN46                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE '1'       *IN46                           CEU006
      *                                                                   CEU006
     C                     MOVEL*BLANKS   ZTABKY                          CEU006
     C                     MOVEL'20'      ZTABKY                          CEU006
     C                     MOVELPDCY      WA4     4                       CEU006
     C                     MOVE '1'       WA4                             CEU006
     C                     MOVE WA4       ZTABKY                          CEU006
      *                                                                   CEU006
     C           ZTABKY    CHAINTABFP                48                   CEU006
      *                                                                   CEU006
      **  Check if database error occurred                                CEU006
      *                                                                   CEU006
     C           *IN48     IFEQ '1'                                       CEU006
     C           RECITB    ORNE 'D'                                       CEU006
     C                     MOVEL'TABLE'   WBFILE  8                       CEU006
     C                     MOVELZTABKY    WBKEY  29                       CEU006
     C                     Z-ADD21        WBASE   30                      CEU006
     C                     EXSR ABORT                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE PDAM      ZFLD15                          CEU006
     C                     Z-ADDCDP       ZDECS                           CEU006
     C                     MOVE 'J'       ZECODE                          CEU006
     C                     EXSR ZSEDIT                                    CEU006
     C                     MOVE ZOUT21    RPADEL                          CEU006
     C                     MOVE PDCY      RPACCY                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     WRITEP1CRED                 60
     C                     MOVE '1'       *IN77
     C/COPY WNCPYSRC,FT0550C003
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**    DEBIT  PROCESSING
     C**
     C           DEBIT     BEGSR                           ** DEBIT  **
     C*
     C* ONE RECORD OUTPUT ON THE FIRST PAGE,
     C* THREE  RECORDS OUTPUT ON SUBSEQUENT PAGES.
     C*
     C                     ADD  1         TOTCRD
     C/COPY WNCPYSRC,FT0550C004
     C           TOTCRD    DIV  3         TEST    22
     C/COPY WNCPYSRC,FT0550C005
     C*
     C           TEST      IFEQ 0.66                                      S01117
     C                     WRITEP1HEDT                 60
     C                     END                                            S01117
     C*
     C                     MOVE PCCY      CRNCY
     C                     EXSR CCYSR
     C           CDP       COMP 2                    43  42
     C           CDP       COMP 1                      4041
     C                     Z-ADDCDP       @PD     10                      E32860
     C*
     C***********CDRO      IFEQ *ZEROS                                                        CSD027
     C           CDRO      IFEQ *BLANKS                                                       CSD027
     C                     MOVE DRCY      CRNCY
     C                     MOVE DRCY      OCCY
     C                     MOVE DRCY      OCCY1
     C                     MOVE DRCY      OCCY2
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission currency        S01494
     C*                                                                   S01494
     C           *IN44     IFEQ '1'                                       S01494
     C                     MOVE DRCY      CHCY                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. currency                      S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE DRCY      VTCY                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     EXSR CCYSR
     C                     ELSE
     C                     MOVE BCCY      CRNCY
     C                     MOVE BCCY      OCCY
     C                     MOVE BCCY      OCCY1
     C                     MOVE BCCY      OCCY2
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission currency        S01494
     C*                                                                   S01494
     C           *IN44     IFEQ '1'                                       S01494
     C                     MOVE BCCY      CHCY                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. currency                      S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE BCCY      VTCY                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     MOVE BCDP      CDP
     C                     END
     C*
     C                     Z-ADDDRVD      ZDAYNO           'FORMAT DATE
     C                     EXSR ZDATE2                     'TO DDMMMYY
     C                     MOVE ZADATE    VDATO   7
     C*
     C           CDP       COMP 2                    33  32
     C           CDP       COMP 1                      3031
     C*
     C      40             MOVE CQAM      AMTC0
     C      30             MOVE TRCM      AMTD0
     C      30             MOVE COLL      AMTE0
     C      30             MOVE CSTA      AMTF0
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission amount          S01494
     C*                                                                   S01494
     C      30 44          MOVE PDCHCM    CHAM0                           S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. amount                        S01499
     C*                                                                   S01499
     C      30 45          MOVE PDVATT    VTAM0                           S01499
     C*
     C      41             MOVE CQAM      AMTC1
     C      31             MOVE TRCM      AMTD1
     C      31             MOVE COLL      AMTE1
     C      31             MOVE CSTA      AMTF1
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission amount          S01494
     C*                                                                   S01494
     C      31 44          MOVE PDCHCM    CHAM1                           S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. amount                        S01499
     C*                                                                   S01499
     C      31 45          MOVE PDVATT    VTAM1                           S01499
     C*
     C      42             MOVE CQAM      AMTC2
     C      32             MOVE TRCM      AMTD2
     C      32             MOVE COLL      AMTE2
     C      32             MOVE CSTA      AMTF2
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission amount          S01494
     C*                                                                   S01494
     C      32 44          MOVE PDCHCM    CHAM2                           S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. amount                        S01499
     C*                                                                   S01499
     C      32 45          MOVE PDVATT    VTAM2                           S01499
     C*
     C      43             MOVE CQAM      AMTC3
     C      33             MOVE TRCM      AMTD3
     C      33             MOVE COLL      AMTE3
     C      33             MOVE CSTA      AMTF3
     C*                                                                   S01494
     C** If S01494 is active, format FX/Change commission amount          S01494
     C*                                                                   S01494
     C      33 44          MOVE PDCHCM    CHAM3                           S01494
     C*                                                                   S01499
     C** If S01499 is active, format V.A.T. amount                        S01499
     C*                                                                   S01499
     C      33 45          MOVE PDVATT    VTAM3                           S01499
     C*
      *                                                                   E32860
     C                     MOVE DRCY      CRNCY                           E32860
     C                     EXSR CCYSR                                     E32860
     C                     Z-ADDCDP       @DD     10                      E32860
     C           @DD       ADD  70        @D      20                      E32860
     C                     MOVEA'0000'    *IN,70                          E32860
     C                     MOVEA'1'       *IN,@D                          E32860
      *                                                                   E32860
      *   Subtract debit decimals from pay decimals to give correction    E32860
      *  factor                                                           E32860
     C           @PD       SUB  @DD       @DD                             E32860
     C                     ADD  4         @DD                             E32860
      *   Cheque amount mult by correction factor                         E32860
     C           CQAM      MULT @P,@DD    @RES   309                      E32860
      *   Mult or div by rate                                             E32860
     C           MDIN      IFEQ 1                                         E32860
     C           @RES      MULT RATE      @OUT0     H                     E32860
     C                     ELSE                                           E32860
     C           @RES      DIV  RATE      @OUT0     H                     E32860
     C                     END                                            E32860
      *                                                                   E32860
     C                     Z-ADD@OUT0     @NET0                           099217
     C***********CDRO      IFEQ *ZEROS                                                 E32860 CSD027
     C           CDRO      IFEQ *BLANKS                                                       CSD027
      *  If no charges to the debit of, then add charges on for CP,       E32860
     C***********@OUT0     ADD  TRCM      @OUT0                     E32860099217
     C***********@OUT0     ADD  COLL      @OUT0                     E32860099217
     C***********@OUT0     ADD  CSTA      @OUT0                     E32860099217
     C                     ADD  TRCM      @NET0                           099217
     C                     ADD  COLL      @NET0                           099217
     C                     ADD  CSTA      @NET0                           099217
     C*                                                                   S01494
     C** If S01494 is active, process FX/Change Commission                S01494
     C*                                                                   S01494
     C           *IN44     IFEQ '1'                                       S01494
     C           @OUT0     ADD  PDCHCM    @OUT0                           S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** If S01499 is active, process V.A.T.                              S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C           @OUT0     ADD  PDVATT    @OUT0                           S01499
     C                     END                                            S01499
     C                     END                                            E32860
      *                                                                   E32879
     C           OVRD      IFEQ 'Y'                                       E32879
     C                     MOVEL'YES'     @OVR    3                       E32879
     C                     ELSE                                           E32879
     C                     MOVEL'NO '     @OVR                            E32879
     C                     END                                            E32879
      *                                                                   E32879
     C** FORMAT 'DRPY' + 'CDRO' FOR OUTPUT
     C*
     C                     MOVE DRPT      PRMTYP           ( DRPY )
     C***********          MOVE *ZEROS    PRMFLD                                              CSD027
     C                     MOVE *BLANKS   PRMFLD                                              CSD027
     C                     MOVELDRPY      PRMFLD
     C                     EXSR CHOPF
     C                     MOVELPRMFLD    P1DRPY
     C           MBIN      IFEQ 'Y'                                       S01117
     C           DRPT      IFEQ 'P'                                       S01117
     C                     MOVELDRBR      P1DRBR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   P1DRBR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C                     MOVE CDRT      PRMTYP           ( CDRO )
     C                     MOVE *ZEROS    PRMFLD
     C                     MOVELCDRO      PRMFLD
     C                     EXSR CHOPF
     C                     MOVELPRMFLD    P1CDRO
     C/COPY WNCPYSRC,FT0550C007
     C           MBIN      IFEQ 'Y'                                       S01117
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVELCDBR      P1CDBR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   P1CDBR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C** SET UP USER FIELDS FROM MUSERDD
     C*
     C                     SETOF                     51
     C*
     C           PARM1     IFEQ 'A'
     C*
     C** OUTPUT STATUS IF RECORD DELETED                                  E25125
     C*                                                                   E25125
     C                     SETOF                     75                   E25125
     C           RECICQ    IFEQ 'C'                                       E25125
     C                     MOVE DELETE    P2STTS 12                       E25125
     C                     SETON                     75                   E25125
     C                     END                                            E25125
     C*                                                                   E25125
     C                     SETON                     51
     C*
     C           INUSR2    IFNE *BLANKS
     C                     MOVE INUSR2    USRP
     C                     EXSR UCMUSE
      *
     C                     MOVE USER1     SIUSR2 25
     C*
     C                     ELSE                                     E23054
     C*                                                             E23054
     C** CLEAR OUTPUT FIELD                                         E23054
     C*                                                             E23054
     C                     MOVE *BLANKS   SIUSR2                    E23054
     C*                                                             E23054
     C                     END
      *
     C           AUP1      IFNE *BLANKS
     C                     MOVE AUP1      USRP
     C                     EXSR UCMUSE
      *
     C                     MOVE USER1     SAUP1  25
     C*
     C                     ELSE                                     E23054
     C*                                                             E23054
     C** CLEAR OUTPUT FIELD                                         E23054
     C*                                                             E23054
     C                     MOVE *BLANKS   SAUP1                     E23054
     C*                                                             E23054
     C                     END
      *
     C           AUP2      IFNE *BLANKS
     C                     MOVE AUP2      USRP
     C                     EXSR UCMUSE
      *
     C                     MOVE USER1     SAUP2  25
     C*
     C                     ELSE                                     E23054
     C*                                                             E23054
     C** CLEAR OUTPUT FIELD                                         E23054
     C*                                                             E23054
     C                     MOVE *BLANKS   SAUP2                     E23054
     C*                                                             E23054
     C                     END
     C*
     C                     END
     C*                                                                   S01499
     C** Set up V.A.T. flags of all charges if S01499 is active           S01499
     C*                                                                   S01499
     C           *IN45     IFEQ '1'                                       S01499
     C                     MOVE PDVAT1    RDVT1                           S01499
     C                     MOVE PDVAT2    RDVT2                           S01499
     C                     MOVE PDVAT3    RDVT3                           S01499
     C                     MOVE PDVAT4    RDVT4                           S01499
     C                     END                                            S01499
     C/COPY WNCPYSRC,FT0550C010
      *
     C*
     C           DNBC      IFEQ *ZERO
     C/COPY WNCPYSRC,FT0550C011
     C                     MOVE *BLANKS   FDNBC
     C                     ELSE
     C                     MOVELDNBC      FDNBC
     C                     END
     C*
     C**  Set up 1st branch field on detail file with booking or          S01117
     C**  originating branch                                              S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                        B001           S01117
     C           *IN14     IFEQ '0'                        B002           S01117
     C                     MOVE BRCA      SBRA                            S01117
     C                     ELSE                                           S01117
     C                     MOVE ORBR      SBRA                            S01117
     C                     END                             E002           S01117
     C                     EXSR TABTR                                     S01117
     C*                                                                   S01117
     C**  Set up 2nd branch field on detail file                          S01117
     C*                                                                   S01117
     C           *IN14     IFEQ '0'                        B002           S01117
     C           *IN15     ANDEQ'1'                                       S01117
     C                     MOVE ORBR      SBRO    3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      SBRO                            S01117
     C                     END                             E002           S01117
     C                     EXSR TABTR2                                    S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C           NDAM      IFEQ 0                                         CEU006
     C/COPY WNCPYSRC,FT0550C001
     C                     MOVE '0'       *IN47                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE '1'       *IN47                           CEU006
      *                                                                   CEU006
     C                     MOVEL*BLANKS   ZTABKY                          CEU006
     C                     MOVEL'20'      ZTABKY                          CEU006
     C                     MOVELNDCY      WA4                             CEU006
     C                     MOVE '1'       WA4                             CEU006
     C                     MOVE WA4       ZTABKY                          CEU006
      *                                                                   CEU006
     C           ZTABKY    CHAINTABFP                48                   CEU006
      *                                                                   CEU006
      **  Check if database error occurred                                CEU006
      *                                                                   CEU006
     C           *IN48     IFEQ '1'                                       CEU006
     C           RECITB    ORNE 'D'                                       CEU006
     C                     MOVEL'TABLE'   WBFILE  8                       CEU006
     C                     MOVELZTABKY    WBKEY  29                       CEU006
     C                     Z-ADD20        WBASE   30                      CEU006
     C                     EXSR ABORT                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE NDAM      ZFLD15                          CEU006
     C                     Z-ADDCDP       ZDECS                           CEU006
     C                     MOVE 'J'       ZECODE                          CEU006
     C                     EXSR ZSEDIT                                    CEU006
     C                     MOVE ZOUT21    RSEDEL                          CEU006
     C                     MOVE NDCY      RSECCY                          CEU006
     C                     ENDIF                                          CEU006
     C/COPY WNCPYSRC,FT0550C009
      *                                                                   CEU006
     C                     WRITEP1DEBT                 60
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0550CCP3                                           S01408
     C*                                                                   S01408
     C           BGNWST    IFEQ 'Y'                        Lux Returns                        CER001
     C           ULX043    ANDEQ'Y'                         IBLC 2002                         CER001
      *                                                                                       CER001
     C                     CALL 'IL0460'                                                      CER001
     C                     PARM PREF      PPREF  15                                           CER001
     C                     PARM CQSQ      PCQSQ   20                                          CER001
     C                     PARM *BLANKS   ILLINE                                              CER001
     C                     PARM *BLANK    PFAIL   1                                           CER001
      *                                                                                       CER001
     C           PFAIL     IFNE '1'                                                           CER001
      *                                                                                       CER001
      ** Set up IBLC lines array                                                              CER001
      *                                                                                       CER001
     C                     MOVEAILLINE    IUL                                                 CER001
      *                                                                                       CER001
      ** If something to Print for IBLC 2002, write out                                       CER001
      *                                                                                       CER001
     C                     DO   3         UL      10                                          CER001
     C           IUL,UL    IFNE *BLANKS                                                       CER001
     C                     MOVELIUL,UL    RRLINE                                              CER001
      *                                                                                       CER001
      ** Manage overflow                                                                      CER001
      *                                                                                       CER001
     C           *IN60     IFEQ *ON                                                           CER001
     C                     WRITEP1HEDT                 60                                     CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     WRITEZZEXIBLC               60                                     CER001
     C                     ENDIF                                                              CER001
     C                     ENDDO                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                           PFAIL                              CER001
     C                     ENDIF                           BGNWST/ULX043                      CER001
     C*
     C                     ENDSR
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C**   READ BRANCH NAME FROM TABLETR                                  S01117
     C*                                                                   S01117
     C           TABTR     BEGSR                                          S01117
     C*          *****     *****                                          S01117
     C*                                                                   S01117
     C**  SET UP KEY AND ACCESS INST. CONTROL REC BRANCH CODE (TABLETR)   S01117
     C*                                                                   S01117
     C**********           MOVE *BLANKS   ZTABKY                          S01117             BUG7985
     C**********           MOVEL'10    '  ZTABKY                          S01117             BUG7985
     C**********           MOVE SBRA      ZTABKY                          S01117             BUG7985
     C           SBRA      IFNE 'ALL'                                     S01117
     C*                                                                   S01117
     C********** ZTABKY    CHAINTABLETRF             99                   S01117             BUG7985
     C********** *IN99     IFEQ '0'                                       S01117             BUG7985
     C********** RECI      COMP 'D'                  9999  ON , DELETED   S01117             BUG7985
     C**********           END                                            S01117             BUG7985
      *                                                                                      BUG7985
     C                     CALL 'AOBRCHR1'                                                   BUG7985
     C                     PARM *BLANKS   PRTCD   7                                          BUG7985
     C                     PARM '*KEY   ' POPTN   7                                          BUG7985
     C                     PARM SBRA      PBRCH   3                                          BUG7985
     C           SDBRCH    PARM SDBRCH    DSSDY                                              BUG7985
     C*                                                                   S01117
     C**   DB ERROR IF NO RECORD FOUND.                                   S01117
     C*                                                                   S01117
     C           PRTCD     IFNE *BLANKS                                                      BUG7985
     C********** *IN99     IFEQ '1'                                       S01117             BUG7985
     C**********           MOVEL'TABLE'   WBFILE           ***************S01117             BUG7985
     C**********           MOVELZTABKY    WBKEY            ** DBERR  06 **S01117             BUG7985
     C                     MOVEL'SDBRCHPD'WBFILE                                             BUG7985
     C                     MOVELSBRA      WBKEY                                              BUG7985
     C                     Z-ADD06        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     ELSE                                           S01117
     C**********           MOVELBRNM      PBRNM                           S01117             BUG7985
     C                     MOVELA8BRNM    PBRNM                           S01117             BUG7985
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                    *****                                          S01117
     C                     ENDSR                                          S01117
     C*                    *****                                          S01117
     C*                                                                   S01117
     C/EJECT                                                              S01117
     C           TABTR2    BEGSR                                          S01117
     C*          ******    *****                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C*             TABLETR CHAIN TO RETRIEVE BRANCH NAME             *   S01117
     C*                                                               *   S01117
     C*  FUNCTION : TO ACCESS BRANCH NAME BRNM FROM TABLETR           *   S01117
     C*             FOR OTHER BRANCH FIELD ON DETAIL RECORD           *   S01117
     C*                                                               *   S01117
     C*  CALLS :    NONE                                              *   S01117
     C*                                                               *   S01117
     C*  CALLED BY: MAIN SUBROUTINE                                   *   S01117
     C*                                                               *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C**  SET UP KEY AND ACCESS INST. CONTROL REC BRANCH CODE (TABLETR)   S01117
     C*                                                                   S01117
     C**********           MOVE *BLANKS   ZTABKY                          S01117             BUG7985
     C**********           MOVEL'10    '  ZTABKY                          S01117             BUG7985
     C**********           MOVE SBRO      ZTABKY                          S01117             BUG7985
     C*                                                                   S01117
     C********** ZTABKY    CHAINTABLETRF             89                   S01117             BUG7985
     C********** *IN89     IFEQ '0'                                       S01117             BUG7985
     C********** RECI      COMP 'D'                  8989  ON , DELETED   S01117             BUG7985
     C**********           END                                            S01117             BUG7985
      *                                                                                      BUG7985
     C                     CALL 'AOBRCHR1'                                                   BUG7985
     C                     PARM *BLANKS   PRTCD   7                                          BUG7985
     C                     PARM '*KEY   ' POPTN   7                                          BUG7985
     C                     PARM SBRO      PBRCH   3                                          BUG7985
     C           SDBRCH    PARM SDBRCH    DSSDY                                              BUG7985
     C*                                                                   S01117
     C** DB ERROR IF NO RECORD FOUND.                                     S01117
     C*                                                                   S01117
     C           PRTCD     IFNE *BLANKS                                                      BUG7985
     C********** *IN89     IFEQ '1'                                       S01117             BUG7985
     C**********           MOVEL'TABLE'   WBFILE           ***************S01117             BUG7985
     C**********           MOVELZTABKY    WBKEY            ** DBERR  10 **S01117             BUG7985
     C                     MOVEL'SDBRCHPD'WBFILE           ***************S01117             BUG7985
     C                     MOVELSBRO      WBKEY            ** DBERR  10 **S01117             BUG7985
     C                     Z-ADD10        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     ELSE                                           S01117
     C**********           MOVELBRNM      PBRNO                           S01117             BUG7985
     C                     MOVELA8BRNM    PBRNO                           S01117             BUG7985
     C                     END                                            S01117
     C*                                                                   S01117
     C*                    *****                                          S01117
     C                     ENDSR                                          S01117
     C*                    *****                                          S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C**   ZSFILE P1 PROCESSING                                           S01117
     C**   CLOSE AND OPEN P1 PRINTER FILE AND CALL ZSFILE                 S01117
     C*                                                                   S01117
     C           ZSFLP1    BEGSR                                          S01117
     C*          ******    *****                                          S01117
     C*                                                                   S01117
     C** SETUP SPOOL FILE DETAILS                                         S01117
     C*                                                                   S01117
     C           *IN11     IFEQ '0'                        NOT SYSTEM     S01117
     C           *IN14     IFEQ '0'                                       S01117
     C                     MOVE BRCA      ZENT             BOOKING        S01117
     C                     ELSE                                           S01117
     C                     MOVE ORBR      ZENT             ORIGINATING    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CLOSE AND OPEN PRINTER FILE                                      S01117
     C*                                                                   S01117
     C                     CLOSEFT0550P1                                  S01117
     C                     OPEN FT0550P1                                  S01117
     C                     Z-ADD0         PAGE                            S01117
     C*                                                                   S01117
     C** CALL'ZSFILE' TO LOG SPOOL FILE DETAILS                           S01117
     C*                                                                   S01117
     C                     MOVELSFILE1    ZSFLNA                          S01117
     C                     Z-ADDSFNUM1    ZSSLNO                          S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @PSEQ   5                       S01117
     C                     PARM           ZENT    3                       S01117
     C                     PARM           ZSFLNA 10                       S01117
     C                     PARM           ZSSLNO  60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C** ABORT PROGRAM IF ZERR IS NOT BLANK                               S01117
     C*                                                                   S01117
     C           ZERR      IFNE *BLANK                                    S01117
     C                     SETON                     U7U8                 S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0550'  DBPGM                           S01194
     C                     MOVEL'FT530P1' DBKEY            ***************S01194
     C                     MOVEL'ZSFILE'  DBFILE           ** DBERR  11 **S01194
     C                     MOVEL'011'     DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                    *****                                          S01117
     C                     ENDSR                                          S01117
     C*                    *****                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C/EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           UCMUSE    BEGSR
     C*          ******    *****
     C*
     C*****************************************************************
     C*                 UC-CHAIN-USER-FILE                            *
     C*                                                               *
     C*  FUNCTION : TO ATTEMPT TO ACCESS THE RECORD FROM THE USER     *
     C*             FILE.                                             *
     C*                                                               *
     C*  CALLS :    NONE                                              *
     C*                                                               *
     C*  CALLED BY: DEBIT                                             *
     C*             CREDIT                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           USRP      CHAINMUSERDDF             99
     C*
     C  N99      RECI      COMP 'D'                  9999
      *
     C** Remove DBERROR processing as user may not exist after a migration084523
     C*                                                                   084523
     C******     *IN99     IFEQ '1'                                       084523
     C******               MOVEL'MUSER'   WBFILE           **********     084523
     C******               MOVELUSRP      WBKEY            *DBERR 05*     084523
     C******               MOVEL'5'       WBASE            **********     084523
     C******               EXSR ABORT                                     084523
     C******               END                                            084523
     C*
     C*                    *****
     C                     ENDSR
     C*                    *****
     C/EJECT
0760 C********************************************************************
0761 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0762 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0763 C*
0764 C           GLZADD    BEGSR                           *** GLZADD ****
0765 C*
0766 C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0767 C   91                GOTO ZZAEND                     AMT = 0.BYPASS
0768 C*
0769 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0770 C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0771 C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0772 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0773 C*
0774 C                     EXSR GLZSUM
0775 C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C/EJECT
0776 C*
0777 C********************************************************************
0778 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0779 C*                        GLZADD, GLZSUB, GLZCMP.
0780 C*          PARAMETERS PASSED -
0781 C*                     I/P ZZAMTI ZZAMTD
0782 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0783 C*
0784 C           GLZSUM    BEGSR                           *** GLZSUM ****
0785 C*
0786 C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0787 C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0788 C                     SETOF                     919293
0789 C                     SETOF                     949599
0790 C*
0791 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0792 C           ZZAMTI    COMP 0                      9293
0793 C   93      ZZAMTD    COMP 0                      9293
0794 C   93                GOTO ZZSEND                     ZERO BYPASS
0795 C*
0796 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0797 C           ZZTOTI    COMP 0                      9193
0798 C   93      ZZTOTD    COMP 0                      9193
0799 C*
0800 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0801 C   93                Z-ADDZZAMTI    ZZTOTI
0802 C   93                Z-ADDZZAMTD    ZZTOTD
0803 C   93                GOTO ZZSEND                     ZERO BYPASS
0804 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0805 C   91N92
0806 CORN91 92             GOTO ZZOFPS
0807 C*
0808 C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0809 C           ZZWK2     COMP 999                  93    '93' = CARRY
0810 C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
0811 C*
0812 C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0813 C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0814 C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
0815 C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0816 C*
0817 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0818 C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0819 C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0820 C  N99                Z-ADDZZWK2     ZZTOTD
0821 C  N99                Z-ADDZZWK3     ZZTOTI
0822 C*
0823 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0824 C   99                Z-ADD0         ZZAMT  153
0825 C                     GOTO ZZSEND
0826 C*
0827 C* THE 'SIGNS' ARE DIFFERENT
0828 C           ZZOFPS    TAG                             ** ZZOFPS TAG**
0829 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0830 C*
0831 C   92                Z-SUBZZAMTI    ZZAMTI 150
0832 C   92                Z-SUBZZAMTD    ZZAMTD  30
0833 C*
0834 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0835 C*
0836 C   91                Z-SUBZZTOTI    ZZTOTI
0837 C   91                Z-SUBZZTOTD    ZZTOTD
0838 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0839 C*
0840 C           ZZTOTI    COMP ZZAMTI               93  95
0841 C   95      ZZTOTD    COMP ZZAMTD               93  95
0842 C*
0843 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0844 C   95                Z-ADD0         ZZTOTI
0845 C   95                Z-ADD0         ZZTOTD
0846 C   95                GOTO ZZSEND
0847 C*
0848 C* IF ZZTOT GT. ZZAMT.
0849 C   93      ZZAMTD    COMP ZZTOTD               94
0850 C   93 94   ZZTOTI    SUB  1         ZZTOTI
0851 C   93 94   ZZTOTD    ADD  1000      ZZWK2
0852 C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0853 C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0854 C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0855 C*
0856 C*
0857 C* IF ZZAMT GT. ZZTOT.
0858 C  N93      ZZTOTD    COMP ZZAMTD               94
0859 C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
0860 C  N93 94   ZZAMTD    ADD  1000      ZZWK2
0861 C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0862 C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0863 C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0864 C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0865 C*
0866 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0867 C                     SETOF                     94
0868 C   93 91
0869 CORN93 92             SETON                     94
0870 C   94                Z-SUBZZTOTI    ZZTOTI
0871 C   94                Z-SUBZZTOTD    ZZTOTD
0872 C**
0873 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0874 C   92                Z-SUBZZAMTI    ZZAMTI
0875 C   92                Z-SUBZZAMTD    ZZAMTD
0876 C           ZZSEND    TAG                             ** ZZSEND TAG *
0877 C**
0878 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0879 C                     SETOF                     96
0880 C           ZZTOTD    COMP 0                        91
0881 C   91      ZZTOTI    COMP 0                      96
0882 C   96                MOVE '.000-'   ZZNEGD  5
0883 C                     ENDSR                             ** ENDSR **
3806 C********************************************************************
     C/EJECT
3806 C********************************************************************
4843 C**
4844 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
4845 C**
4846 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
4847 C**
4848 C           ZDATE2    BEGSR                           *** ZDATE2 ***
4849 C**
4850 C**   CLEAR DATE FIELDS.
4851 C                     Z-ADD0         ZDATE   60
4852 C                     MOVEL'       ' ZADATE  7
4853 C**
4854 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
4855 C                     Z-ADDZDAYNO    ZDAYNO  50
4856 C**
4857 C**   DETERMINE YEAR NUMBER.
4858 C**
4859 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
4860 C           ZDAYNO    SUB  1         ZDAYN1  50   99
4861 C   99                GOTO ZDEND2
4862 C**
4863 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
4864 C           ZDAYN1    DIV  1461      ZLYR    20
4865 C                     MVR            ZDAYN1           SAVE REMAINING
4866 C**                                                   DAYS
4867 C**   CALCULATE NUMBER OF REMAINING YEARS.
4868 C                     Z-ADD1         ZWRK2   20
4869 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
4870 C           ZDAYN1    COMP ZYDY,ZWRK2             90
4871 C  N90      ZWRK2     ADD  1         ZWRK2
4872 C  N90                GOTO ZDTAG1
4873 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
4874 C**
4875 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
4876 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
4877 C**
4878 C**   CALCULATE ACTUAL YEAR NUMBER.
4879 C           ZLYR      MULT 4         ZWRK3   30
4880 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
4881 C                     Z-ADDZWRK3     ZYEAR   20
4882 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
4883 C**
4884 C**   DETERMINE MONTH NUMBER.
4885 C**
4886 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
4887 C                     SETOF                     9293
4888 C   91      ZDAYN1    COMP 59                     9293
4889 C   91N92   ZDAYN1    SUB  1         ZDAYN1
4890 C**
4891 C**   CALCULATE MONTH NUMBER.
4892 C                     Z-ADD2         ZWRK2
4893 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
4894 C           ZDAYN1    COMP ZMDY,ZWRK2             94
4895 C  N94      ZWRK2     ADD  1         ZWRK2
4896 C  N94                GOTO ZDTAG2
4897 C           ZWRK2     SUB  1         ZWRK2
4898 C**
4899 C                     Z-ADDZWRK2     ZMTH    20       MONTH
4900 C**
4901 C**   DETERMINE DAY OF MONTH.
4902 C**
4903 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
4904 C           ZDAYN1    ADD  1         ZDAYN1
4905 C**
4906 C**   CALCULATE DAY OF MONTH.
4907 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
4908 C**
4909 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
4910 C   93      ZDAY      ADD  1         ZDAY
4911 C**
4912 C**   FORMAT DATE, DDMMYY OR MMDDYY.
4913 C  N98                MOVELZDAY      ZWRK4   40
4914 C   98                MOVE ZDAY      ZWRK4
4915 C  N98                MOVE ZMTH      ZWRK4
4916 C   98                MOVELZMTH      ZWRK4
4917 C                     MOVELZWRK4     ZDATE
4918 C                     MOVE ZYEAR     ZDATE
4919 C**
4920 C**   FORMAT ALPHA DATE, DDMMMYY.
4921 C           ZDAY      COMP 10                     95
4922 C                     MOVELZDAY      ZWRK5   5
4923 C   95                MOVEL' '       ZWRK5
4924 C                     MOVE ZMNM,ZMTH ZWRK5
4925 C                     MOVELZWRK5     ZADATE
4926 C                     MOVE ZYEAR     ZADATE
4927 C**
4928 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
4929 C**
3903 C********************************************************************
     C/EJECT
3903 C********************************************************************
     C*
     C*  TRAILR   : TO PERFORM CONTROL CHECKS WHEN THE TRAILER
     C*             RECORD IS READ.
     C*
     C           TRAILR    BEGSR                           ** TRAILR **
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     EXSR MBINIT                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  ACCESS CQPACZZ- TRAILER FOR CHEQUES TO BE PAID CREDITS          S01117
     C*                                                                   S01117
     C                     READ CQPACZZ                  99               S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                                       S01117
     C                     MOVEL'CQPACZZ' WBFILE           ***************S01117
     C                     MOVEL*BLANKS   WBKEY            ** DBERR  07 **S01117
     C                     Z-ADD07        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     END                                            S01117
     C*
     C************IN34*****IFEQ '0'                        ### B001       S01117
     C                     Z-ADDNORE1     TNCR
     C                     Z-ADDHRWN      TICR
     C                     Z-ADDHRDC      TDCR
     C*********************SETON                     34                   S01117
     C*
     C           @PLEV     IFEQ 'S'                                       S01117
     C           TNCR      IFNE TNCR#                      ### B002
     C           TICR      ORNE TICR#
     C           TDCR      ORNE TDCR#
     C                     SETON                     U8
     C                     MOVE DIFFXX    DIFFCR
     C                     END                             ### E002
     C                     END                                            S01117
     C*
     C*********************ELSE                            ### X001       S01117
     C*                                                                   S01117
     C** ACCESS CQPADZZ- TRAILER FOR CHEQUES TO BE PAID DEBIT             S01117
     C*                                                                   S01117
     C                     READ CQPADZZ                  99               S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                                       S01117
     C                     MOVEL'CQPADZZ' WBFILE           ***************S01117
     C                     MOVEL*BLANKS   WBKEY            ** DBERR  08 **S01117
     C                     Z-ADD08        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     END                                            S01117
     C*
     C                     Z-ADDNORE1     TNDB
     C                     Z-ADDHRWN      TIDB
     C                     Z-ADDHRDC      TDDB
     C*
     C           @PLEV     IFEQ 'S'                                       S01117
     C           TNDB      IFNE TNDB#                      ### B002
     C           TIDB      ORNE TIDB#
     C           TDDB      ORNE TDDB#
     C                     SETON                     U8
     C                     MOVE DIFFXX    DIFFDB
     C                     END                             ### E002
     C                     END                                            S01117
     C*
     C** OUTPUT CONTROL REPORT
     C*
     C* SET UP SBRA                                                       S01117
     C           *IN20     IFEQ '0'                                       S01117
     C           @PLEV     IFNE 'S'                                       S01117
     C           *IN10     ANDEQ'1'                                       S01117
     C                     MOVEL@PENT     SBRA                            S01117
     C                     EXSR TABTR                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* MOVE 'ALL' INTO SBRA                                              S01117
     C           @PENT     IFEQ 'ALL'                                     S01117
     C                     MOVE @PENT     SBRA                            S01117
     C                     MOVE *BLANKS   PBRNM                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*********************WRITEP2HEDT                                    S01194
     C                     Z-ADD0         PAGE                            S01194
     C                     WRITEAUHEDT                                    S01194
     C*
     C** OUTPUT END-OF-REPORT MESSAGE TO DETAIL REPORT
     C*
     C           *IN77     IFEQ '1'                                       S01117
     C                     WRITEP1EOR                  60
     C                     END                                            S01117
     C*
     C*********************END                             ### E001       S01117
     C*
     C           CEEND     ENDSR
3903 C********************************************************************
     C/EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C**  MBINIT   : TO READ TABTB10, TABTB11                             S01117
     C*              AND SET UP MULTIBRANCHING DETAILS                    S01117
     C*                                                                   S01117
     C           MBINIT    BEGSR                           ** MBINIT **   S01117
     C*                                                                   S01194
     C** CALL ZSFILE TO LOG SPOOL FILE DETAILS                            S01194
     C*                                                                   S01194
     C                     MOVELSFILE2    ZSFLAU                          S01194
     C                     Z-ADDSFNUM2    ZSNOAU                          S01194
     C*                                                                   S01194
     C                     CALL 'ZSFILE'                                  S01194
     C                     PARM           @PSEQ   5                       S01194
     C                     PARM *BLANKS   ZENTAU  3                       S01194
     C                     PARM           ZSFLAU 10                       S01194
     C                     PARM           ZSNOAU  60                      S01194
     C                     PARM *BLANKS   ZERR    1                       S01194
     C*                                                                   S01194
     C** ABORT PROGRAM IF ZERR IS NOT BLANK                               S01194
     C*                                                                   S01194
     C           ZERR      IFNE *BLANK                                    S01194
     C                     SETON                     U7U8                 S01194
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0550'  DBPGM                           S01194
     C                     MOVEL'FT550AU' DBKEY            ***************S01194
     C                     MOVEL'ZSFILE'  DBFILE           ** DBERR  13 **S01194
     C                     MOVEL'013'     DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     RETRN                                          S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C** READ TABTB10                                                     S01117
     C*                                                                   S01117
     C                     MOVEL'01    '  ZTABKY 12                       S01117
     C                     MOVE '    10'  ZTABKY                          S01117
     C                     Z-ADD*ZEROS    ZERO15 150                      S01117
     C                     MOVE *BLANKS   BLNK35 35                       S01117
     C                     MOVE 'B'       B       1                       S01117
     C                     MOVE 'YES'     YES     3                       S01117
     C                     MOVE 'NO '     NO      3                       S01117
     C**                                                                  S01117
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE   S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                        ### B002       S01117
     C           RECITB    ORNE 'D'                                       S01117
     C                     MOVEL'TABFP'   WBFILE  8        ***************S01117
     C                     MOVELZTABKY    WBKEY  29        ** DBERR  01 **S01117
     C                     Z-ADD01        WBASE   30       ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     END                             ### E002       S01117
     C*                                                                   S01117
     C** READ TABTB11                                                     S01117
     C*                                                                   S01117
     C                     MOVEL'01    '  ZTABKY                          S01117
     C                     MOVE '    11'  ZTABKY                          S01117
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE   S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                        ### B002       S01117
     C           RECITB    ORNE 'D'                                       S01117
     C                     MOVEL'TABLE'   WBFILE           ***************S01117
     C                     MOVELZTABKY    WBKEY            ** DBERR  02 **S01117
     C                     Z-ADD02        WBASE            ***************S01117
     C                     EXSR ABORT                                     S01117
     C                     END                             ### E002       S01117
     C*                                                                   S01414
     C* Move the conditional IF so that AOGELRR0 is always called.        S01414
     C*                                                                   S01414
     C***SETON*MULTIBRANCHING INDICATOR***************************  S01117S01414
     C***********                                                   S01117S01414
     C***********MBIN      IFEQ 'Y'                                 S01117S01414
     C***********          SETON                     10             S01117S01414
     C*                                                                   S01117
     C** Call to General Ledger access pgm                                S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDGELRPD'WBFILE           ***************S01194
     C                     MOVEL@OPTN     WBKEY            ** DBERR  12 **S01194
     C                     Z-ADD12        WBASE            ***************S01194
     C                     EXSR ABORT                                     S01194
     C                     ELSE                                           S01194
     C*                                                             S01117S01414
     C**  If multi branched set on 10 to display branch fields      S01117S01414
     C*                                                             S01117S01414
     C           MBIN      IFEQ 'Y'                                 S01117S01414
     C                     SETON                     10             S01117S01414
     C*                                                                   S01414
     C           BKOBRU    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN15                           S01194
     C                     END                                            S01194
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
     C                     MOVE '1'       *IN76                           S01414
     C                     END                                            S01414
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     MOVE '0'       *IN44                           S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   @RTCD   7                       S01494
     C                     PARM '*VERIFY' @OPTN   7                       S01494
     C                     PARM 'S01494'  @SARD   6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set a variable to condition      S01494
     C** the rest of the processing                                       S01494
     C*                                                                   S01494
     C           @RTCD     IFEQ *BLANKS                                   S01494
     C                     MOVE '1'       *IN44                           S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           @RTCD     IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'WBFILE           ************   S01494
     C                     MOVEL'*VERIFY' WBKEY            * DBERR 015*   S01494
     C                     MOVEL'15'      WBASE            ************   S01494
     C                     EXSR ABORT                      *ABORT PGM*    S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     MOVE '0'       *IN45                           S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*VERIFY' @OPTN   7                       S01499
     C                     PARM 'S01499'  @SARD   6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set a variable to                S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           @RTCD     IFEQ *BLANKS                                   S01499
     C                     MOVE '1'       *IN45                           S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           @RTCD     IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'WBFILE           ************   S01499
     C                     MOVEL'*VERIFY' WBKEY            * DBERR 016*   S01499
     C                     MOVEL'16'      WBASE            ************   S01499
     C                     EXSR ABORT                      *ABORT PGM*    S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C/COPY WNCPYSRC,FT0550C006
     C                     MOVE 'N'       ULX043  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX043'  @SARD                                               CER001
      *                                                                                       CER001
     C           @RTCD     IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX043                                              CER001
     C                     ENDIF                                                              CER001
     C*                                                                                       CER001
     C** else, database error (return code other than *NRF)                                   CER001
     C*                                                                                       CER001
     C           @RTCD     IFNE '*NRF   '                                                     CER001
     C           @RTCD     ANDNE*BLANKS                                                       CER001
     C                     MOVEL'SCSARDPD'WBFILE           ************                       CER001
     C                     MOVEL'*VERIFY' WBKEY            * DBERR 017*                       CER001
     C                     MOVE 017       WBASE            ************                       CER001
     C                     EXSR ABORT                      *ABORT PGM*                        CER001
     C                     END                                                                CER001
     C*                                                                   S01117
     C* SETON SYSTEM LEVEL INDICATOR                                      S01117
     C*                                                                   S01117
     C           @PLEV     IFEQ 'S'                                       S01117
     C                     SETON                     11                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* SETON DIRECT COB INDICATOR                                        S01117
     C           PARM1     IFEQ 'A'                                       S01117
     C                     SETON                     12                   S01117
     C                     ELSE                                           S01117
     C* SETON ORIGINATING/BOOKING BRANCH INDICATOR                        S01117
     C           PARM1     IFEQ 'O'                                       S01117
     C                     SETON                     14                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FT0550C008
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
3903 C********************************************************************
     C*
     C*  FUNCTION : TO ABORT THE PROGRAM IN THE EVENT OF A DATABASE
     C*             ERROR.
     C*
     C           ABORT     BEGSR
     C*
     C** SETON INDICATORS TO INDICATE DATABASE ERRORS
     C*
     C                     SETON                     U7U8LR
     C*
     C           *NAMVAR   DEFN LDA       DLDA
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0550'  DBPGM
     C                     MOVELWBKEY     DBKEY
     C                     MOVELWBFILE    DBFILE
     C                     MOVELWBASE     DBASE
     C                     OUT  DLDA
     C*
     C** REPORT DATABASE ERROR
     C*
     C                     Z-ADD0         PAGE                            S01194
     C           *IN10     IFEQ '1'                                       S01117
     C                     MOVE @PENT     SBRA                            S01117
     C           @PENT     IFEQ 'ALL'                                     S01117
     C                     MOVE *BLANKS   PBRNM                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*********************WRITEP2HEDT                                    S01194
     C                     WRITEAUHEDT                                    S01194
     C*
     C*********************MOVELDBASE     P2DBAS                          S01194
     C*********************MOVELDBFILE    P2DBFL                          S01194
     C*********************MOVELDBKEY     P2DBKY                          S01194
     C                     MOVELDBASE     AUDBAS                          S01194
     C                     MOVELDBFILE    AUDBFL                          S01194
     C                     MOVELDBKEY     AUDBKY                          S01194
     C*********************WRITEP2DBER                                    S01194
     C                     WRITEAUDBER                                    S01194
     C*
     C** PRODUCE PROGRAM DUMP
     C*
     C                     DUMP
     C*
     C** END PROGRAM
     C*
     C                     RETRN
     C*
     C           UEEND     ENDSR
3903 C********************************************************************
     C/COPY ZSRSRC,ZSEDITZ3                                               CEU006
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @P                                                                     E32860
1000000                                                                   E32860
0100000                                                                   E32860
0010000                                                                   E32860
0001000                                                                   E32860
0000100                                                                   E32860
0000010                                                                   E32860
0000001                                                                   E32860
