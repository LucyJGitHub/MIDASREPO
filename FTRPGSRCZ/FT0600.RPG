     H        1   D
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT UNCLEARED CHEQUES REPORT')
     F*****************************************************************
     F*                                                               *
     F*  Midas - FUNDS TRANSFER MODULE
     F*                                                               *
     F*  FT0600 - LIST OF UNCLEARED CHEQUES IN REGISTER               *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD027             Date 09Dec05               *
      *  Prev Amend No. CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 E29903             Date 02Apr91               *
      *                 E29901             Date 02Apr91               *
     F*       AMEND NO. S01117             DATE 26MAR91               *   S01117
     F*       AMEND NO. S01194             DATE 26MAR91               *   S01194
     F*                                                               *
     F*****************************************************************
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  E29903 -  ACCESS TO ICD FILE CODED INCORRECT                 *   E29903
     F*  E29901 -  COMMITMENT TEXT DATA STRUCTURE IS REDUNDANT AS NO  *   E29901
     F*            FILES IN PGM ARE UNDER COMMITMENT CONTROL          *   E29901
     F*  S01117 -  RELEASE 10 MULTIBRANCHING CHANGES                  *   S01117
     F*  S01194 -  STANDING DATA CHANGES                              *   S01194
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*UNCHQ***IP**E********************DISK                              S01117
     F*FT0600P2O***E********************PRINTER                           S01117
     F*FT0600P1O***E********************PRINTER                           S01117
     FUNCHQBB IP  E           K        DISK                               S01117
     FFT0600AUO   E                    PRINTER      KINFDS SPOOLU         S01117
     FFT0600P1O   E                    PRINTER      KINFDS SPOOL1     UC  S01117
     FTABFP   IF  E           K        DISK
     F************TABTB11F                          KIGNORE               S01117
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F************TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLET5F                          KIGNORE
     F*
     F/EJECT
     F*
     F****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F****************************************************************
     F*       01        CHEQUE AMOUNT HAS 0 D.P.                     *
     F*       02        CHEQUE AMOUNT HAS 1 D.P.                     *
     F*       03        CHEQUE AMOUNT HAS 2 D.P.                     *
     F*       04        CHEQUE AMOUNT HAS 3 D.P.                     *
     F*                                                              *
     F********10********FIRST CYCLE.                                 *    E29903
     F********20********NOT FIRST CYCLE.                             *    E29903
     F*       20        FIRST CYCLE.                                 *    E29903
     F********25********OVERFLOW ON FT0600P1.                        *    S01117
     F*       30        MULTIBRANCHING INDICATOR                     *    S01117
     F*       31        ORIGINATING BRANCH USED INDICATOR            *    S01117
     F*       32        SYSTEM LEVEL INDICATOR                       *    S01117
     F*       33        BOOKING/ORIG.BRANCH INDICATOR (ON IF ORIG.)  *    S01117
     F*    70 71 73     WORKING INDICATORS                           *    S01117
     F*                                                              *
     F*       78        ) DATA                                       *
     F*       U7        ) BASE                                       *
     F*       U8        ) ERROR.                                     *
     F*             LR  LAST RECORD (TERMINATE PROGRAM).             *
     F*                                                              *
     F*  N.B:- 90-99    STANDARD SUBROUTINE INDICATORS.              *
     F****************************************************************
     F*
     F/EJECT
     E                    CPY@    1   1 80
     E*
     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E/EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     IDLDA        DS                            256
     I*
     I**********************************************
     I*       DATA STRUCTURE USED IN THE EVENT     *
     I*                    OF DATABASE ERRORS.     *
     I**********************************************
     I*
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 177 DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*
     I*CMTTXT******DS************************    160                      E29901
     I***************************************                             E29901
     I*********************************************
     I********DATA*STRUCTURE*TO*PROVIDE*TEXT*     *                       E29901
     I*************ON*COMIT*ENTRY*IN*JOURNAL.*    *                       E29901
     I*********************************************
     I***************************************                             E29901
     I*************************************** 1   50NATN                  E29901
     I*************************************** 6   7 MDID                  E29901
     I*************************************** 8  15 PGMN                  E29901
     I***************************************16  18 WSIDX                 E29901
     I***************************************19  240MTIME                 E29901
     I***************************************25  25 ACTION                E29901
     I***************************************26  35 USRIDX                E29901
     I***************************************51  590CQNM                  E29901
     I***************************************60  74 PREF                  E29901
     I***************************************75  76 PYTP                  E29901
     I***************************************77  78 PYST                  E29901
     I***************************************79  81 CQCY                  E29901
     I***************************************82  940CQAM                  E29901
     I***************************************95  990CQDT                  E29901
     I**************************************100 134 PYE1                  E29901
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     ISPOOL1      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I* EXTERNAL DS FOR SDGELRPD DETAILS                                  S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* DATA STRUCTURE FOR ACCESS PROGRAM                                 S01194
     I/EJECT
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C                     MOVEACPY@      BIS@   80                       S01117
     C*
     C*************************
     C*    SET INDICATORS.    *
     C*************************
     C*
     C                     SETOF                     010203
     C*********************SETOF                     0410                 E29903
     C                     SETOF                     04                   E29903
     C*
     C           *IN20     IFEQ '0'
     C                     SETON                     20                   E29903
     C                     EXSR ZSYSTM
     C*
     C************IN99*****IFEQ '1'                         ))))))))))))))S01117
     C*********************MOVE 'TABFP'   DBFNAM  5         )))  DATA  )))S01194
     C*********************MOVELZTABKY    DBERKY 39         )))  BASE  )))S01194
     C*********************MOVE '01'      DBERR#  2         ))) ERROR  )))S01194
     C*********************EXSR DBERR                       )))   01   )))S01117
     C*********************END                              ))))))))))))))S01117
     C*
     C                     Z-ADD0         UCOUNT  50
     C                     Z-ADD0         UAMT   150
     C*********************SETON                     1020                 E29903
     C*********************Z-ADD1         PPAGE   40                      S01117
     C                     END                             END N*IN20
     C*
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C* SET UP BRANCH WORKFIELD                                           S01117
     C*                                                                   S01117
     C           *IN33     IFEQ '0'                                       S01117
     C                     MOVE BRCA      SBRA                            S01117
     C                     ELSE                                           S01117
     C                     MOVE ORBR      SBRA                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF CHANGE OF BRANCH DETECTED AND @RENT NOT 'ALL',TERMINATE PGM    S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'B'                                       S01117
     C           @RENT     ANDNE'ALL'                                     S01117
     C           SBRA      ANDNE@RENT                                     S01117
     C                     SETON                     LR                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* IF @RENT NOT 'ALL' AND FIRST RECORD, OPEN DETAIL REPORT AND       S01117
     C*  CALL ZSFILE                                                      S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'B'                                       S01117
     C           @RENT     ANDNE'ALL'                                     S01117
     C           SBRA      ANDEQ@RENT                                     S01117
     C           *IN71     IFEQ '0'                                       S01117
     C                     EXSR ZSFSUB                                    S01117
     C                     EXSR TABTR                                     S01117
     C*                                                                   S01117
     C* WRITER HEADER FOR DETAIL REPORT                                   S01117
     C*                                                                   S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     SETON                     71                   S01117
     C                     END                                            S01117
     C                     EXSR EXTRA                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF @RENT 'ALL' OR SYSTEM LEVEL SELECTED AND FIRST RECORD, OPEN    S01117
     C* DETAIL REPORT AND CALL ZSFILE                                     S01117
     C*                                                                   S01117
     C           @RENT     IFEQ 'ALL'                                     S01117
     C           @RLEV     OREQ 'S'                                       S01117
     C           SBRA      IFNE SBRA1                                     S01117
     C*                                                                   S01117
     C* IF CHANGE OF BRANCH AND @RENT 'ALL' WRITE DETAIL ENDING REPORT    S01117
     C*                                                                   S01117
     C           *IN32     IFEQ '0'                                       S01117
     C           SBRA1     ANDNE*BLANKS                                   S01117
     C                     WRITEP1ENDR                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN70     IFEQ '0'                                       S01117
     C                     EXSR ZSFSUB                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WRITER HEADER FOR DETAIL REPORT                                   S01117
     C*                                                                   S01117
     C                     EXSR TABTR                                     S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C*                                                                   S01117
     C* IF SYSTEM LEVEL SELECTED AND BRANCH CHANGED, CALL ZSFILE ONCE     S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'S'                                       S01117
     C                     SETON                     70                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     EXSR EXTRA                                     S01117
     C*                                                                   S01117
     C* MOVE CURRENT BRANCH CODE TO WORKING FIELD                         S01117
     C*                                                                   S01117
     C                     MOVE SBRA      SBRA1   3                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF MULTIBRANCHING INDICATOR SETOF, AND FIRST RECORD READ          S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C           *IN73     IFEQ '0'                                       S01117
     C                     EXSR ZSFSUB                                    S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     SETON                     73                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C           *INLR     IFEQ '0'                         LR            S01117
     C*                                                                   S01117
     C***************************************
     C*     SET UP KEY AND CHAIN TO         *
     C*     CURRENCY RECORD (TABTG10).      *
     C***************************************
     C*
     C                     MOVEL'20'      KEY1   11
     C                     MOVE CQCY      KEY1
     C                     MOVELKEY1      ZTABKY
     C                     MOVE '1'       ZTABKY
     C*
     C           ZTABKY    CHAINTABFP                99     NOT FOUND
     C  N99      RECI      COMP 'D'                  9999   DELETED
     C*
     C           *IN99     IFEQ '1'
     C*********************MOVE 'TABFP'   DBFNAM            ))))))))))))))S01194
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01194
     C                     MOVELZTABKY    DBERKY            )))  BASE  )))
     C*********************MOVE '03'      DBERR#            ))) ERROR  )))S01194
     C                     Z-ADD3         DBERR#            )))   03   )))S01194
     C                     EXSR DBERR                       ))))))))))))))
     C                     END
     C*
     C                     Z-ADDCQDT      ZDAYNO
     C                     EXSR ZDATE2
     C           CDP       ADD  1         X       10
     C                     MOVE '1'       *IN,X
     C   02                MOVE CQAM      CQAM1  131
     C   03                MOVE CQAM      CQAM2  132
     C   04                MOVE CQAM      CQAM3  133
     C                     MOVE CQAM      ZZAMT
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    ZZAMT
     C                     MOVE ZZTOTD    ZZAMT
     C                     MOVE ZZAMT     UAMT
     C           UCOUNT    ADD  1         UCOUNT
     C                     Z-ADD0         ZZAMT
     C*                                                                   S01117
     C* CHECK THAT ENOUGH ROOM FOR 'END OF REPORT' FORMAT                 S01117
     C* IF NOT WRITE NEW HEADER ON NEXT PAGE                              S01117
     C*                                                                   S01117
     C* IF MULTIBRANCHING INDICATOR SETON                                 S01117
     C* AND ORIGINATING BRANCH USED INDICATOR SETON - ALLOW 15 RECORDS    S01117
     C* TO BE PRINTED ON EACH PAGE OF DETAIL REPORT                       S01117
     C*                                                                   S01117
     C           *IN30     IFEQ '1'                                       S01117
     C           *IN33     IFEQ '0'                                       S01117
     C           *IN31     IFEQ '1'                                       S01117
     C           RECNR     IFGT 14                                        S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* IF ORIGINATING BRANCH USED INDICATOR SETOFF - ALLOW 45 RECORDS    S01117
     C* TO BE PRINTED ON EACH PAGE OF DETAIL REPORT                       S01117
     C*                                                                   S01117
     C           RECNR     IFGT 44                                        S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* IF BOOKING/ORIG.BRANCH INDICATOR SETON - ALLOW 15 RECORDS TO BE   S01117
     C* PRINTED ON EACH PAGE OF DETAIL REPORT                             S01117
     C*                                                                   S01117
     C           RECNR     IFGT 14                                        S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF MULTIBRANCHING INDICATOR SETOF                                 S01117
     C* - ALLOW 46 RECORDS TO BE PRINTED ON EACH PAGE OF DETAIL REPORT    S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C           RECNR     IFGT 45                                        S01117
     C                     WRITEP1HEAD                                    S01117
     C                     Z-ADD0         RECNR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C***10****************                                               S01117
     C*OR*25****************WRITEP1HEAD                                   S01117
     C***20****************WRITEP1DETL                 25                 S01117
     C                     WRITEP1DETL                                    S01117
     C                     ADD  1         RECNR   20                      S01117
     C                     END                              ENDLR         S01117
     C***25******PPAGE*****ADD  1         PPAGE                           S01117
     C*LR*********PPAGE*****ADD  1         PPAGE                          S01117
     C*LR**********IN10*****IFEQ '0'                         LRN10        E29903
     CLR         *IN20     IFEQ '0'                         LRN20         E29903
     CLR                   EXSR ZSYSTM
     C*
     C*R**********IN99*****IFEQ '1'                         ))))))))))))))S01117
     C*R*******************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01117
     C*R*******************MOVELZTABKY    DBERKY            )))  BASE  )))S01117
     C*R*******************MOVE '02'      DBERR#            ))) ERROR  )))S01117
     C*R*******************EXSR DBERR                       )))   02   )))S01117
     C*R*******************END                              ))))))))))))))S01117
     C*
     C*LR*******************END                              END LRN10    E29903
     CLR                   END                              END LRN20     E29903
     CLR         *IN20     IFEQ '1'                                       S01117
     CLR                   WRITEP1ENDR                                    S01117
     CLR                   END                                            S01117
     C*
     C*LR*******************WRITEP2HEAD                                   S01117
     CLR                   Z-ADD0         PAGE                            S01117
     CLR                   WRITEAUHEAD                                    S01117
     C*
     C/EJECT
     C*
     C********************************************************************
     C*    *     SUBROUTINE TO ACCESS INSTALLATION     *    *** ZSYSTM ***
     C*    *                CONTROL DATA RECORD.       *    *** ZSYSTM ***
     C*    *        AND PERFORM INITIAL PROCESSING     *    *** ZSYSTM ***S01117
     C********************************************************* ZSYSTM ***
     C           ZSYSTM    BEGSR                            *** ZSYSTM ***
     C*                                                     **************
     C*                                                                   S01117
     C* PARAMETER RECIEVED FROM CALLING PROGRAM                           S01117
     C*                                                                   S01117
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           @RSEQ   5                       S01117
     C                     PARM           @RLEV   1                       S01117
     C                     PARM           @RENT   3                       S01117
     C                     PARM           PARM1   1                       S01117
     C*                                                                   S01117
     C* CALL ZSFILE TO LOG SPOOL FILE DETAILS FOR AUDIT REPORT            S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU                          S01117
     C                     MOVELSFILEU    ZSNAMU                          S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ                           S01117
     C                     PARM *BLANKS   ZENTAU  3                       S01117
     C                     PARM           ZSNAMU 10                       S01117
     C                     PARM           ZSNUMU  60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0600'  DBPGM            ***************S01117
     C                     MOVEL'FT0600AU'DBKEY            * DB ERROR 06 *S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD6         DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
1492 C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.
1493 C                     MOVEL'01      'ZTABKY 12
1494 C                     MOVE '  10'    ZTABKY
1495 C**
1496 C           ZTABKY    CHAINTABFP                99    ON NOT THERE
1497 C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
1498 C**
1499 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
1500 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C           *IN99     IFEQ '1'                                       S01194
     C                     MOVEL'TABFP'   DBFNAM           ***************S01194
     C                     MOVELZTABKY    DBERKY           * DB ERROR 01 *S01194
     C                     Z-ADD1         DBERR#           ***************S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* READ TABTB11 TO RETRIVE MULTIBRANCHING INDICATOR                  S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ZTABKY                          S01117
     C                     MOVEL'01'      ZTABKY                          S01117
     C                     MOVE '11'      ZTABKY                          S01117
     C*                                                                   S01117
     C           ZTABKY    CHAINTABFP                99                   S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'                                       S01117
     C           RECI      ANDNE'D'                                       S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                                       S01117
     C                     MOVEL'TABFP'   DBFNAM           ***************S01117
     C                     MOVELZTABKY    DBERKY           * DB ERROR 04 *S01117
     C                     Z-ADD4         DBERR#           ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     30                   S01117
     C*                                                                   S01117
     C* ACCESS SDGELRPD FOR ORIGINATING BRANCH USED FLAG                  S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG  '  @RTCD   7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDGELRPD'DBFNAM           ***************S01194
     C                     MOVEL'*FIRST'  DBERKY           * DB ERROR 05 *S01194
     C                     Z-ADD5         DBERR#           ***************S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**  IF ORIGINATING BRANCH USED FLAG IS ON , SET ON *IN31            S01194
     C**  TO DISPLAY ORIGINATING BRANCH FIELD ON PRINT FILE               S01194
     C*                                                                   S01194
     C           BKOBRU    IFEQ 'Y'                                       S01194
     C                     SETON                     31                   S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C**  IF SELECTION IN ORIGINATING BRANCH ORDER SETON 33               S01194
     C           PARM1     IFEQ 'O'                                       S01117
     C                     SETON                     33                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** SETON SYSTEM LEVEL INDICATOR                                     S01117
     C*                                                                   S01117
     C           @RLEV     IFEQ 'S'                                       S01117
     C                     SETON                     32                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** SETUP FIELDS FOR AUDIT REPORT                                    S01117
     C*                                                                   S01117
     C           *IN30     IFEQ '1'                                       S01117
     C           *IN32     IFEQ '0'                                       S01117
     C                     MOVE @RENT     ABRA                            S01117
     C           @RENT     IFEQ 'ALL'                                     S01117
     C                     MOVE *BLANKS   ABRNM                           S01117
     C                     ELSE                                           S01117
     C                     MOVE @RENT     SBRA                            S01117
     C                     EXSR TABTR                                     S01117
     C                     MOVELPBRNM     ABRNM                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                     **************
1502 C                     ENDSR                            *** ZSYSTM ***
     C********************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C* SUBROUTINE EXTRA: TO SET UP OTHER FIELD ON DETAIL REPORT          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           EXTRA     BEGSR                                          S01117
     C*                                                                   S01117
     C           *IN33     IFEQ '0'                                       S01117
     C           *IN31     ANDEQ'1'                                       S01117
     C                     MOVE ORBR      SBRO    3                       S01117
     C                     EXSR TABTR2                                    S01117
     C                     ELSE                                           S01117
     C           *IN33     IFEQ '1'                                       S01117
     C                     MOVE BRCA      SBRO                            S01117
     C                     EXSR TABTR2                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*  SUBROUTINE ZSFSUB   : TO CLOSE AND OPEN FT0600P1 PRINTER FILE    S01117
     C*                        AND CALL ZSFILE                            S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           ZSFSUB    BEGSR                                          S01117
     C*                                                                   S01117
     C** SETUP SPOOL FILE DETAILS                                         S01117
     C** IF MULTIBRANCHING 'YES' AND NOT SYSTEM LEVEL SET UP ENTITY       S01117
     C*                                                                   S01117
     C           *IN30     IFEQ '1'                                       S01117
     C           *IN32     ANDEQ'0'                                       S01117
     C                     MOVE SBRA      ZENT                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CLOSE AND OPEN PRINTER FILE                                      S01117
     C*                                                                   S01117
     C                     CLOSEFT0600P1                                  S01117
     C                     OPEN FT0600P1                                  S01117
     C*                                                                   S01117
     C                     Z-ADD0         PAGE                            S01117
     C                     MOVELSFILE1    ZSNAM                           S01117
     C                     Z-ADDSFNUM1    ZSNUM                           S01117
     C*                                                                   S01117
     C** CALL'ZSFILE' TO LOG SPOOL FILE DETAILS                           S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ                           S01117
     C                     PARM           ZENT    3                       S01117
     C                     PARM           ZSNAM  10                       S01117
     C                     PARM           ZSNUM   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0600'  DBPGM            ***************S01117
     C                     MOVEL'FT0600P1'DBKEY            * DB ERROR 07 *S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD7         DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*  TABTR    : TO ACCESS BRANCH NAME BRNM FROM TABLETR               S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           TABTR     BEGSR                                          S01117
     C*                                                                   S01117
     C**  SET UP KEY AND ACCESS INST. CONTROL REC BRANCH CODE (TABLETR)   S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ZTABKY                          S01117
     C                     MOVEL'10    '  ZTABKY                          S01117
     C                     MOVE SBRA      ZTABKY                          S01117
     C*                                                                   S01117
     C           ZTABKY    CHAINTABFP                99                   S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'                                       S01117
     C           RECI      ANDNE'D'                                       S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                                       S01117
     C                     MOVEL'TABFP'   DBFNAM           ***************S01117
     C                     MOVELZTABKY    DBERKY           * DB ERROR 08 *S01117
     C                     Z-ADD8         DBERR#           ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     ELSE                                           S01117
     C                     MOVELBRNM      PBRNM                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*  TABTR2   : TO ACCESS BRANCH NAME BRNM FROM TABLETR               S01117
     C*             FOR OTHER BRANCH FIELD ON DETAIL RECORD               S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           TABTR2    BEGSR                                          S01117
     C*                                                                   S01117
     C* SET UP KEY AND ACCESS INST. CONTROL REC BRANCH CODE (TABLETR)     S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ZTABKY                          S01117
     C                     MOVEL'10    '  ZTABKY                          S01117
     C                     MOVE SBRO      ZTABKY                          S01117
     C*                                                                   S01117
     C           ZTABKY    CHAINTABFP                99                   S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '0'                                       S01117
     C           RECI      ANDNE'D'                                       S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN99     IFEQ '1'                                       S01117
     C                     MOVEL'TABFP'   DBFNAM           ***************S01117
     C                     MOVELZTABKY    DBERKY           * DB ERROR 08 *S01117
     C                     Z-ADD8         DBERR#           ***************S01117
     C                     EXSR DBERR                                     S01117
     C                     ELSE                                           S01117
     C                     MOVELBRNM      PBRNO                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     SUBROUTINE TO SPLIT A 15.3 FIELD INTO A 15.0    *** GLZADD ***
     C*                'INTEGER' & A 3.0 'DECIMAL' FIELD.   *** GLZADD ***
     C********************************************************* GLZADD ***
     C           GLZADD    BEGSR                            *** GLZADD ***
     C*                                                     **************
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C*                                                     **************
     C           ZZAEND    ENDSR                            *** GLZADD ***
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*         SUBROUTINE TO CARRY OUT THE ADDITION        *** GLZSUM ***
     C*                    FOR GLZADD & GLZSUB.             *** GLZSUM ***
     C*         PARAMETERS PASSED:-                         *** GLZSUM ***
     C*                    IN :- ZZAMTI & ZZAMTD.           *** GLZSUM ***
     C*                    OUT:- ZZTOTI, ZZTOTD, ZZNEGD     *** GLZSUM ***
     C*                          *IN96 & *IN99.             *** GLZSUM ***
     C********************************************************* GLZSUM ***
     C           GLZSUM    BEGSR                            *** GLZSUM ***
     C*                                                     **************
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C*                                                     **************
     C                     ENDSR                            *** GLZSUM ***
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     *         SUBROUTINE TO CONVERT A DAY           *** ZDATE2 ***
     C*     *              NUMBER TO DATE FORMATS.          *** ZDATE2 ***
     C*     *                                               *** ZDATE2 ***
     C*     *   N.B.:- 2000, BEING DIVISIBLE BY 400         *** ZDATE2 ***
     C*     *          IS A LEAP YEAR.                      *** ZDATE2 ***
     C********************************************************* ZDATE2 ***
     C           ZDATE2    BEGSR                            *** ZDATE2 ***
     C*                                                     **************
3813 C**
3814 C**   CLEAR DATE FIELDS.
3815 C                     Z-ADD0         ZDATE   60
3816 C                     MOVEL'       ' ZADATE  7
3817 C**
3818 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
3819 C                     Z-ADDZDAYNO    ZDAYNO  50
3820 C**
3821 C**   DETERMINE YEAR NUMBER.
3822 C**
3823 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
3824 C           ZDAYNO    SUB  1         ZDAYN1  50   99
3825 C   99                GOTO ZDEND2
3826 C**
3827 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
3828 C           ZDAYN1    DIV  1461      ZLYR    20
3829 C                     MVR            ZDAYN1           SAVE REMAINING
3830 C**                                                   DAYS
3831 C**   CALCULATE NUMBER OF REMAINING YEARS.
3832 C                     Z-ADD1         ZWRK2   20
3833 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
3834 C           ZDAYN1    COMP ZYDY,ZWRK2             90
3835 C  N90      ZWRK2     ADD  1         ZWRK2
3836 C  N90                GOTO ZDTAG1
3837 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
3838 C**
3839 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
3840 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
3841 C**
3842 C**   CALCULATE ACTUAL YEAR NUMBER.
3843 C           ZLYR      MULT 4         ZWRK3   30
3844 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
3845 C                     Z-ADDZWRK3     ZYEAR   20
3846 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
3847 C**
3848 C**   DETERMINE MONTH NUMBER.
3849 C**
3850 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
3851 C                     SETOF                     9293
3852 C   91      ZDAYN1    COMP 59                     9293
3853 C   91N92   ZDAYN1    SUB  1         ZDAYN1
3854 C**
3855 C**   CALCULATE MONTH NUMBER.
3856 C                     Z-ADD2         ZWRK2
3857 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
3858 C           ZDAYN1    COMP ZMDY,ZWRK2             94
3859 C  N94      ZWRK2     ADD  1         ZWRK2
3860 C  N94                GOTO ZDTAG2
3861 C           ZWRK2     SUB  1         ZWRK2
3862 C**
3863 C                     Z-ADDZWRK2     ZMTH    20       MONTH
3864 C**
3865 C**   DETERMINE DAY OF MONTH.
3866 C**
3867 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
3868 C           ZDAYN1    ADD  1         ZDAYN1
3869 C**
3870 C**   CALCULATE DAY OF MONTH.
3871 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
3872 C**
3873 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
3874 C   93      ZDAY      ADD  1         ZDAY
3875 C**
3876 C**   FORMAT DATE, DDMMYY OR MMDDYY.
3877 C  N98                MOVELZDAY      ZWRK4   40
3878 C   98                MOVE ZDAY      ZWRK4
3879 C  N98                MOVE ZMTH      ZWRK4
3880 C   98                MOVELZMTH      ZWRK4
3881 C                     MOVELZWRK4     ZDATE
3882 C                     MOVE ZYEAR     ZDATE
3883 C**
3884 C**   FORMAT ALPHA DATE, DDMMMYY.
3885 C           ZDAY      COMP 10                     95
3886 C                     MOVELZDAY      ZWRK5   5
3887 C   95                MOVEL' '       ZWRK5
3888 C                     MOVE ZMNM,ZMTH ZWRK5
3889 C                     MOVELZWRK5     ZADATE
3890 C                     MOVE ZYEAR     ZADATE
     C*                                                     **************
3892 C           ZDEND2    ENDSR                            *** ZDATE2 ***
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*    *     SUBROUTINE TO SET UP DATA STRUCTURE   *     *** DBERR ***
     C*    *                FOR DATABASE ERRORS.       *     *** DBERR ***
     C********************************************************** DBERR ***
     C*    ERROR     CAUSE                                   *** DBERR ***
     C*       01     VALID I.C.R.-1 RECORD NOT FOUND (IC).   *** DBERR ***
     C*       02     VALID I.C.R.-1 RECORD NOT FOUND (LR).   *** DBERR ***
     C*       03     VALID CURRENCY RECORD NOT FOUND.        *** DBERR ***
     C********************************************************** DBERR ***
     C           DBERR     BEGSR                             *** DBERR ***
     C*                                                      *************
     C           *NAMVAR   DEFN LDA       DLDA
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0600'  DBPGM            ) SET-UP
     C                     MOVE DBFNAM    DBFILE           ) DATA BASE
     C                     MOVELDBERKY    DBKEY            ) ERROR
     C                     MOVE DBERR#    DBASE            ) FIELDS
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     SETON                     78
     C*********************MOVE 'FT0600'  DBPROG  6                       S01117
     C                     EXSR TIMESR
     C                     Z-ADD0         PAGE                            S01117
     C*********************WRITEP2HEAD                                    S01117
     C                     WRITEAUHEAD                                    S01117
     C                     DUMP
     C                     RETRN
     C*                                                      *************
     C                     ENDSR                             *** DBERR ***
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*          *    SUBROUTINE TO ACCESS TIME OF DAY.     *** TIMESR ***
     C********************************************************* TIMESR ***
     C           TIMESR    BEGSR                            *** TIMESR ***
     C*                                                     **************
     C                     TIME           TIME    60
     C*                                                     **************
     C                     ENDSR                            *** TIMESR ***
     C********************************************************************
     C*
     C/EJECT
     O*
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
