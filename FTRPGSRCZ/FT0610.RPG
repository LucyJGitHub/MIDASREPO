     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Events generation')                           *
      *****************************************************************
      *                                                               *
      *  Midas - FUNDS TRANSFER MODULE                                *
      *                                                               *
      *  FT0610 - EVENTS GENERATION                                   *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. ERZ248             Date 18Nov19               *
      *  Prev Amend No. MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL184             Date 07Dec16               *
      *                 MD039343           Date 27Jul16               *
      *                 CAP212             Date 15Sep14               *
      *                 CFT120             Date 28Sep12               *
      *                 AR821872           Date 05Sep11               *
      *                 CER049             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 AR664109           Date 02Nov10               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15297           Date 12Nov07               *
      *                 BUG15230           Date 06Nov07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 177552             Date 06Jun06               *
      *                 159283             Date 06Jun06               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8927            Date  8Nov05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG3812            Date 26Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 221761             Date 13Apr04               *
      *                 TDA110             Date 01Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 200439             Date 23Sep02               *
      *                 198372             Date 27Mar02               *
      *                 172901             Date 12Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 20Dec01               *
      *                 195520             Date 09Jul01               *
      *                 190167             Date 28Jun01               *
      *                 151104             Date 14Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 01Jun00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187215             Date 21Nov00               *
      *                 185107             Date 17Oct00               *
      *                 184060             Date 22Sep00               *
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CFT006             DATE 07DEC99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT004             DATE 27Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130995             DATE 11OCT98               *
      *                 CEU011             DATE 11MAR98               *
      *                 106357             Date 19Feb98               *
      *                 CAC002             Date 15SEP96               *
      *                 S01408             Date 12FEB96               *
      *                 082484             Date 19APR95               *
      *                 S01408             DATE 10MAR95               *
      *                 S01486             DATE 16AUG94               *
      *                 S01499             DATE 06JUN94               *
      *                 S01494             DATE 25MAY94               *
      *                 068320             DATE 17MAR94               *
      *                 068094             DATE 20JAN94               *
      *                 068095             DATE 24OCT93               *
      *                 062394             DATE 24OCT93               *
      *                 S01435             DATE 08SEP93               *
      *                 046303             DATE 16JAN94               *
      *                 S01414             DATE 16APR93               *
      *                 053989             DATE 16APR93               *
      *                 034118             DATE 18SEP91               *
      *                 027286             DATE 10AUG91               *
      *                 050984             DATE 30MAY90               *
      *                 E38323             DATE 30JUL92               *   E35101
      *                 E35101             DATE 31MAY91               *   E35101
      *                 E35098             DATE 31MAY91               *   E35095
      *                 E35097             DATE 29MAY91               *   E35097
      *                 E35095             DATE 24MAY91               *   E35095
      *                 E35088             DATE 23MAY91               *   E35088
      *                 S01117             DATE 08MAY91               *   S01117
      *                 S01194             DATE 08MAY91               *   S01194
      *                 S01195             DATE 08MAY91               *   S01195
      *                 E23905             DATE 30MAY90               *   E23905
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  ERZ248 - SWIFT UETR via OPAY API (Recompile)                 *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD039343 - Need to increment trailer totals excluding RPs    *
      *             also when processing Stamp Tax events.            *
      *  CAP212 - FT Nostro Transfer API (Recompile)                  *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *  AR821872 - Component FTC0610 00001 failed                    *
      *  CER049 - Stamp Tax                                           *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  AR664109 - FTC0610 00001 failed                              *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  BUG15297 - IBAN is not validated if it starts with '/'       *
      *             before it calls access object AOIBANR4            *
      *  BUG15230 - IBAN not being set up for Outgoing payment prior  *
      *           to call to access object                            *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CFT032 - Account line in field 50X in MT103                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  177552 - Incomplete information in rpt GL0540.               *
      *  159283 - Amount posted to credit account different from the  *
      *           actual credit ccy amount entered. Do not recompute  *
      *           credit ccy amount to avoid rounding error. Applied  *
      *           fix 133707.                                         *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8927 - Prevent processing of matured payments due to      *
      *            RECI being overwritten                             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG3812 - Error in first cycle loading currencies            *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  221761 - Recompiled due to change made in PF/FT101HPD.       *
      *  TDA110 - Include book code for FT transactions for reval.    *
      *           Recompiled only since BOKC field for FPVNTDD same   *
      *           as the from the input fies                          *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  200439 - Prevent database error if a closed retail account   *
      *           has an outstanding FT transaction.                  *
      *  198372 - Dbase 044. IBAN not being set up for IP's prior to  *
      *           call to access object.                              *
      *  172901 - Change management of FPRTN by mgmt. of SDNOSTPD.    *
      *  CPK014 - Release 4 alphasite:                                *
      *           - Add missing switchability for CFT009 at DBERR45   *
      *             and DBERR46.                                      *
      *  195520 - Database error on TABLETF                           *
      *  190167 - If Accrual for Non-working days indicator is 2 then *
      *           the following checking is needed.  If the Accrual/  *
      *           Profit Date is less than or equal to Date of Next   *
      *           Working Day minus 1, then the Event Control Date    *
      *           should be the Accrual/Profit Date.  Otherwise,      *
      *           Event Control Date should be Run Date. Applied fix  *
      *           181912.                                             *
      *  151104 - Allow up to 900 branches.                           *
      *  CFT009 - FT Fees and Charges Development                     *
      *  187215 - If outgoing to be generated then no account         *
      *  185107 - Mapping of details from swift message - Recompile   *
      *  184060 - No transaction type code in detail screen -Recompile*
      *  CFT014 - Straight-through Processing Phase 2 MT103 Messages  *
      *           Generation for FT.                                  *
      *  CFT006 - Swift messages MT101/MT102                          *
      *  CFT004 - International Bank Account Number                   *
      *           New Account Type 'I' (IBAN)                         *
      *  130995 - Avoid Divide by 0 error due to half-adjust of a     *
      *           very small amount.                                  *
      *  CEU011 - Position/Risk Reporting.                            *
      *  106357 - RECORD WRITTEN IN FPVNTDD WITH WRONG RECI (FE WHEN  *
      *           ACCOUNT CLOSED)                                     *
      *         - AVOID DATA BASE IN ERROR IF ACCOUNT CLOSED          *
      *  CAC002 - Profit Centre Accounting Development:               *
      *           Recompiled due to change in FPVNTDD (so as to       *
      *           output profit centre to the events file).           *
      *  S01408 - Addition of core hooks  FT0610IIP1                  *
      *  082484 - Funds transfer; When generating events from 'RP'    *
      *           from OTPAYDD do not generated one where the payment *
      *           date equals the next working day.                   *
      *           This is because there will be an 'OP' generated     *
      *           in input cycle initiation for the next working      *
      *           day. Any projected account movements etc. for that  *
      *           payment will be created at that time.               *
      *         - Output correct pgm name if error on call to FT0210. *
      *  S01408 - Addition of core hooks  FT0610FFPG                  *
      *                                   FT0610EEPG                  *
      *                                   FT0610IIPG                  *
      *                                   FT0610CCPG                  *
      *                                   FT0610CCP1                  *
      *                                   FT0610CCP2                  *
      *                                   FT0610CCP3                  *
      *                                   FT0610CCP4                  *
      *                                   FT0610CCP5                  *
      *  S01486 - Private Banking Upgrade                             *
      *  S01499 - BLI V.A.T. Processing                               *
      *  S01494 - BLI Funds Transfer Enhancements                     *
      *  068320 - Process charges for Incoming and Outgoing Trans.    *
      *  068094 - Reverse fix E35088                                  *
      *  068095 - Correct event processing for INPAYDD                *
      *           If not ACBK and INPAYDD first four events created.  *
      *  062394 - Use FT0310 to calculate dates                       *
      *  S01435 - Incoming Message Management.                        *
      *  046303 - /COPY source subr. ZFWDT amended to prevent array   *
      *           error if no holiday record found - fixed by S01434. *
      *           Program recompiled.                                 *
      *  S01414 - Book Code and Profit Centre Incorporation.          *
      *           Rename of profit centre field on ACCNTABF           *
      *  053989 - Correct 050984                                      *
      *           Create only the first event for Regular Payments    *
      *           Some clients might want more in which case a period *
      *           must be specified (not coded).                      *
      *           Apply Release 3 fix PHILC3 point 1 which corrects   *
      *           the calculation of rates in SRREG1                  *
      *  034118 - Rate for credit party of CP is shown as 0.00000000  *
      *           (event '91P5') but 1.00000000 is more realistic     *
      *           Likewise for '91P3' for CCs                         *
      *  027286 - Event amount for Cheques to be paid is less charges *
      *           Charges should be added for CP.                     *
      *  050984 - TO OUTPUT EVENTS FOR RP ONLY FOR THE OUTGOING       *
      *           PAYMENTS                                            *
      *  E38323 - Recompiled due to a change in copy source ZFWDT     *   E35101
      *           subroutine                                          *   E35101
      *     E35101 - FIELD RECI FROM MAINTENANCE FILE OVERWRITTEN BY  *   E35101
      *              INITIAL PROCESSING                               *   E35101
      *     E35098 - INCORRECT SET UP OF DBPGM DBASE ERROR FIELD      *   E35098
      *     E35097 - FOR REGULAR PAYMENT FIELDS : PYSR, OTCY AND CUNR *   E35097
      *              ARE NOT UPDATED FOR SUBSEQUENT SET OF EVENTS     *   E35097
      *     E35095 - HOLIDAYS PROCESSING CODING INCORRECT             *   E35095
      *     E35088 - INCOMING/OUTGOING INDICATOR SET INCORRECTLY      *   E35088
      *     S01117 - RELEASE 10 MULTIBRANCHING CHANGES                *   S01117
      *     S01194 - STANDING DATA CHANGES                            *   S01194
      *     S01195 - HOLIDAYS PROCESSING                              *   S01195
      *     E23905 - INPAY GENERATE 2 X CHARGES EVENTS                *   E23905
      *****************************************************************
      * ID F  C  H  L    FUNCTION OF INDICATORS
      *
      *                  RECORD IDENTIFYING INDICATORS :
      * 01               INPAYDD
      * 02               OTPAYDD
      * 03               CQCODDD
      * 04               CQCOCDD
      * 05               CQPACDD
      * 06               CQPADDD
      * 07               NTRANDD
      * 08               INPAYZZ
      * 09               OTPAYZZ
      * 10               CQCODZZ
      * 11               CQCOCZZ
      * 12               CQPACZZ
      * 13               CQPADZZ
      * 14               NTRANZZ
      * 15               FT101HPD                                         CFT006
      * 16               FT102HPD                                         CFT006
      *
      *       20         CHAIN FAIL : TABLE
      *       21         WRITE FAIL
      *       22         CCY NOT FOUND ON ARRAY
      *
      *       23         CALCULATED TOTALS <> TRAILER TOTALS
      *       24         WORK IND.
      *       25         1ST CYCLE IND.
      *       26         READE                                            CFT006
      *
      * U7 U8            DATABASE ERROR INDS.
      *
      ********************************************************************
     F/EJECT
      ********************************************************************
      *                                                                   S01408
     F/COPY WNCPYSRC,FT0610FFPG                                           S01408
     F*                                                                   S01408
     FINPAYDD IP  E           K        DISK
     FINPAYXL0IF  E           K        DISK                               CFT009
     FOTPAYDD IS  E           K        DISK
     FOTPAYXL0IF  E           K        DISK                               CFT009
     FCQPAC   IS  E           K        DISK
     FCQCOD   IS  E           K        DISK
     FNTRANDD IS  E           K        DISK
     FINPAYZZ IS  E                    DISK
     FOTPAYZZ IS  E                    DISK
     FCQPACZZ IS  E                    DISK
     FCQPADZZ IS  E                    DISK
     FCQCOCZZ IS  E                    DISK
     FCQCODZZ IS  E                    DISK
     FNTRANZZ IS  E                    DISK
     FFT101HPDIS  E                    DISK                               CFT006
     FFT102HPDIS  E                    DISK                               CFT006
     FACNUMA  IF  E           K        DISK
     FFT101DL2IF  E           K        DISK                               CFT006
     FFT102DL1IF  E           K        DISK                               CFT006
     FINPAYQL0IF  E           K        DISK                                                   CER049
     FOTPAYQL0IF  E           K        DISK                                                   CER049
     FCQCOCQL0IF  E           K        DISK                                                   CER049
     FCQPACQL0IF  E           K        DISK                                                   CER049
     F*FPRTN***IF**E           K        DISK                              172901
     F************TABLETLF                          KRENAMEFPRTNF         172901
     FSDNOSTL4IF  E           K        DISK                               172901
     F*
     FTABFP   IF  E           K        DISK
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABLETHF                          KIGNORE
     FSDBRCHPDIF  E                    DISK                               S01194
      *                                                                   CEU011
     FSDCURRL1IF  E           K        DISK                               CEU011
      *                                                                   CEU011
      ** Currencies Logical File                                          CEU011
      *                                                                   CEU011
     FTABLETL IF  E           K        DISK                               S01195
     F            TABLETLF                          KRENAMETABLETLL       S01195
      *                                                                   CFT014
      ** Incoming Payments Details Extension retrieval index              CFT014
      *                                                                   CFT014
     FINPAYXL2IF  E           K        DISK                           UC  CFT014
      *                                                                   CFT014
      ** Outgoing Payments Details Extension retrieval index              CFT014
      *                                                                   CFT014
     FOTPAYXL2IF  E           K        DISK                           UC  CFT014
      *                                                                   CFT014
     FFPVNTDD O   E           K        DISK
     FFPVNTZZ O   E           K        DISK
     F*
     F/COPY WNCPYSRC,FT0610F001
     F*FT0610P1O***E********************PRINTER                        UC S01194
     FFT0610AUO   E                    PRINTER                        UC  S01194
     FFT0610P2O   E             26     PRINTER                        UC  106357
     F*
     F********************************************************************
     E                    CPY@    1   1 80
     E                    CCYA      150  3  A            CURRENCY CODES
     E                    CDPA      150  1 0             CCY DEC. POSITIONS
     E                    SPTA      150 13 8             SPOT RATES
     E                    MDA       150  1 0             MUL/DIV INDS.
     E                    BSRA      150 13 8             BUY SPREAD RATES
     E                    BSSA      150  1               BUY SPREAD SIGNS
     E                    SSRA      150 13 8             SELL SPREAD RATES
     E                    SSSA      150  1               SELL SPREAD SIGNS
     E                    INTA        9 15 0             INTEGER HASH TOT
     E                    DECA        9  3 0             DECIMAL HASH TOT
     E                    RECA        8  5 0             RECORDS HASH TOTAL
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR.ARRAY
     E********************ZHC        50  3               ZFREQB SR.ARRAY  S01195
     E********************ZFMD   12  12  2               ZFREQB SR.ARRAY  S01195
     E********************HCCYA      25  3                                S01195
     E**  STD CODE FOR LOADING ARRAY OF BRANCH & COMPANY CODES            S01117
     E***********         BR        100  3               BRANCH CO S01117 151104
     E***********         CO        100  3               COMPANY CDS01117 151104
     E***********         IC        100  6               INTRNL CUSS01117 151104
     E                    BR        900  3               BRANCH CO        151104
     E                    CO        900  3               COMPANY CDS      151104
     E                    IC        900  6               INTRNL CUST NO   151104
     E                    CUR       200  3                                CEU011
     E                    SRT       200  2 0                              CEU011
      *                                                                   CEU011
      ** Array for Currency and Sort Sequence number                      CEU011
      *                                                                   CEU011
      /COPY ZSRSRC,ZHOLE                                                  S01195
     **/COPY ZSRSRC,ZFREQBZ1                                        S01195062394
     E                    POWER   1   7  7 3             POWERS TABLE
     E*                                                                   S01408
     E/COPY WNCPYSRC,FT0610EEPG                                           S01408
     E*                                                                   S01408
     E********************************************************************
     I/EJECT
     I********************************************************************
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0610IIP1                                           S01408
     i*                                                                   S01408
     I*
     I** DEFINE RECORD IDENTIFYING INDICATORS
     I*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     I*
     IINPAYDDF    01
     I              OEDT                            UMOEDI                                    CFT120
     IINPAYXDF    01                                                      CFT009
     IOTPAYDDF    02
     I              OEDT                            UMOEDO                                    CFT120
     IOTPAYXDF    02                                                      CFT009
     I/COPY WNCPYSRC,FT0610I001
     ICQCODDDF    03
     ICQCOCDDF    04
     ICQPACDDF    05
     ICQPADDDF    06
     INTRANDDF    07
     IINPAYZZF    08
     IOTPAYZZF    09
     ICQCODZZF    10
     ICQCOCZZF    11
     ICQPACZZF    12
     ICQPADZZF    13
     INTRANZZF    14
     IFT101HD0    15                                                      CFT006
     I              RFTID                           HRFTID                CFT006
     I              SINST                           HSINST                CFT006
     IFT102HD0    16                                                      CFT006
     I              CCTID                           HCCTID                CFT006
     I              DBTVDT                          C#DVDT                CFT006
     I              BRCA                            C#BRCA                CFT006
     I              CCTAMT                          C#TAMT                CFT006
     I              CCTCCY                          C#TCCY                CFT006
     I              TOCUS1                          C#CUS1                CFT006
     I              TOCUS2                          C#CUS2                CFT006
     I              TOCUS3                          C#CUS3                CFT006
     I              TOCUS4                          C#CUS4                CFT006
     I              ORDITP                          C#ORDT                CFT006
     I*                                                                   CFT006
     IFT102DD0                                                            CFT006
     I              CRDVDT                          C#CVDT                CFT006
     I*                                                                   CFT006
     I* RENAME RECI IN TABFP FORMAT: TABTB10F, TABTB11F, TABTG10F,        E35101
     I* TABTG40F, TABTE10F TO PREVENT OVERITING OF RECI FROM MAINTE-      E35101
     I* NANCE FILE                                                        E35101
     I*                                                                   E35101
     ITABTB10F                                                            E35101
     I              RECI                            RECITB                E35101
     ITABTB11F                                                            E35101
     I              RECI                            RECITB                E35101
     ITABTG10F                                                            E35101
     I              RECI                            RECITB                E35101
     ITABTG40F                                                            E35101
     I              RECI                            RECITB                E35101
     ITABTE10F                                                            E35101
     I              RECI                            RECITB                E35101
     I*                                                                   S01117
     I** RENAME THE BRANCH FIELD BRCA IN TABFP FORMAT TABLETLF, ACNUMA,   S01117
     I** FPRTN TO AVOID CORRUPTION OF BRCA FIELD ON THE EVENTS FILE -     S01117
     I** FPVNTDD                                                          S01117
     I*                                                                   S01117
     ITABLETLF                                                            S01117
     I              BRCA                            BRCH                  S01117
     I*                                                                   S01117
     I* Rename of Profit Centre to avoid overwriting                      S01414
     I*                                                                   S01414
     IACCNTABF                                                            S01117
     I              BRCA                            BRCH                  S01117
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01117
     I***FPRTNF*****                                               S01117 172901
     I**************BRCA                            BRAC           S01117 172901
     I*                                                                   S01117
     ITABLETLL                                                            S01195
     I              BRCA                            BRCH                  S01195
     I*                                                                   S01195
      *  Data Structure for AOIBANR4                                      CFT004
      *                                                                   CFT004
     IP@ACCN    E DSACCNTAB                                               CFT004
     I              BRCA                            BRCI                  CFT004
     I              PRFC                            PRFCI                 CFT004
     I              LCD                             LCDI                  CFT004
      *                                                                   CFT004
     IDLDA        DS                            256
     I*
     I** DATA AREA LDA - USED IN THE EVENT OF DATABASE ERRORS
     I*
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 177 DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*
     I**    DATA STRUCTURE TO SUB DIVIDE KEY FIELDS ON - TABTG10 + TABTG20
     I*
     I            DS                             12
     I                                        1  12 KEY
     I                                        1   2 DRECT
     I                                        9  11 DSCCY
     I                                       12  12 DSREC
     I***************************************                             S01194
     I***DATA*STRUCTURE*FOR*'TABLETJ'*TO*IDENTIFY*HOLIDAY*CCY*ARRAY*      S01194
     I***************************************                             S01194
     I************DS*************************                             S01194
     I***************************************15  89 HCCY                  S01194
     I***************************************15  89 HCCYA                 S01194
     I*
     I*     DATA AREA TO REDEFINE ACCOUNTS FOR  NOSTRO FIELD
     I*
     IWPTY        DS
     I**********                              1   60CNUMN                                     CSD027
     I                                        1   6 CNUMN                                     CSD027
     I                                        1  100ACNON
     I                                        7   9 CCYN
     I**********                              7  100ACODNP                                    CGL029
     I**********                             11  120ACSQNP                                    CGL029
     I**********                             10  130ACODN                                     CGL029
     I**********                             14  150ACSQN                                     CGL029
     I**********                             13  15 BRCANP                             S01117 CGL029
     I**********                             16  18 BRCAN                              S01117 CGL029
     I                                        7  160ACODNP                                    CGL029
     I                                       17  180ACSQNP                                    CGL029
     I                                       10  190ACODN                                     CGL029
     I                                       20  210ACSQN                                     CGL029
     I                                       19  21 BRCANP                                    CGL029
     I                                       22  24 BRCAN                                     CGL029
     I*
     ISDBRCH    E DSSDBRCHPD                                              106357
     I** Branch details                                                   106357
     I*                                                                   106357
     ISCSARD    E DSSCSARDPD                                              CEU011
      ** Switchable Features File                                         CEU011
      *                                                                   CEU011
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      /COPY ZSRSRC,ZHOLI                                                  S01195
      /COPY ZSRSRC,ZHOLDS                                                 S01195
      /COPY ZSRSRC,ZAOZ1                                                  S01195
      /COPY ZSRSRC,ZAOZ2                                                  S01195
     I*                                                                   S01408
     I/COPY WNCPYSRC,FT0610IIPG                                           S01408
      *                                                                                       CFT120
     ISDCUHS    E DSSDCUHSPD                                                                  CFT120
      *                                                                                       CFT120
      ** SDCUHSD0 - Historic Exchange rates record format data structure                      CFT120
      *                                                                                       CFT120
     I*                                                                   CFT006
     INEWFMT      DS                                                      CFT006
     I**********                              1  18 NEWFLD                             CFT006 CGL029
     I                                        1  24 NEWFLD                                    CGL029
     I                                        1   3 XBRCA                 CFT006
     I                                        4   9 XCNUM                 CFT006
     I*                                      10  13 XACC                  CFT006
     I*                                      14  16 XCCY                  CFT006
     I                                       10  12 XCCY                  CFT006
     I**********                             13  16 XACC                               CFT006 CGL029
     I**********                             17  18 XSEQ                               CFT006 CGL029
     I                                       13  22 XACC                                      CGL029
     I                                       23  24 XSEQ                                      CGL029
     IOLDFMT      DS                                                      CFT006
     I**********                              1  18 OLDFLD                             CFT006 CGL029
     I                                        1  24 OLDFLD                                    CGL029
     I                                        1   6 YCNUM                 CFT006
     I                                        7   9 YCCY                  CFT006
     I**********                             10  13 YACC                               CFT006 CGL029
     I**********                             14  15 YSEQ                               CFT006 CGL029
     I**********                             16  18 YBRCA                              CFT006 CGL029
     I                                       10  19 YACC                                      CGL029
     I                                       20  21 YSEQ                                      CGL029
     I                                       22  24 YBRCA                                     CGL029
     IFLD19       DS                                                      CFT006
     I                                        1   1 FST1                  CFT006
     I**********                              2  19 SND18                              CFT006 CGL029
     I**********                              1  18 FST18                              CFT006 CGL029
     I                                        2  25 SND18                                     CGL029
     I                                        1  24 FST18                                     CGL029
     I*                                                                   CFT006
     I********************************************************************
     I/EJECT
     C                     MOVEACPY@      BIS@   80
      *                                                                                      BUG8927
      ** Save RECI                                                                           BUG8927
      *                                                                                      BUG8927
     C                     MOVE RECI      RECISV  1                                          BUG8927
     C*
     C***********AKEY      KLIST                                          172901
     C***********          KFLD           CNUM                            172901
     C***********          KFLD           CCY                             172901
     C***********          KFLD           ACOD                            172901
     C***********          KFLD           ACSQ                            172901
     C***********          KFLD           BRCH                     S01117 172901
     C           NOKEY     KLIST                                          172901
     C                     KFLD           KCUST   6                       172901
     C                     KFLD           ECCY    3                       172901
     C**********           KFLD           KACCD   4                                    172901 CGL029
     C                     KFLD           KACCD  10                                           CGL029
     C                     KFLD           KACSN   20                      172901
     C                     KFLD           KBRCH   3                       172901
     C*                                                                   S01117
     C           TKEY      KLIST                                          S01195
     C                     KFLD           TCCY    3                       S01195
     C                     KFLD           TNOS    20                      S01195
      *                                                                                       CER049
     C           QCKEY     KLIST                                                              CER049
     C                     KFLD           PREF                                                CER049
     C                     KFLD           CQSQ                                                CER049
      *                                                                                       CER049
     C           QPKEY     KLIST                                                              CER049
     C                     KFLD           PREF                                                CER049
     C                     KFLD           CQSQ                                                CER049
     C********************************************************************
     C*
     C**  FIRST CYCLE PROCESSING
     C*   ~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           *IN25     IFNE '1'                        * BEG 1ST *
     C/COPY WNCPYSRC,FT0610C016
     C*
     C                     MOVE '1'       *IN25
     C/COPY WNCPYSRC,FT0610C007
     C*
     C** SETUP DATABASE ERROR CONDITIONS
     C*
     C           *NAMVAR   DEFN LDA       DLDA
     C*********************MOVEL'FT0610'  DBPGM                           E35098
     C*
     C** ACCESS TABTB10 (I.C.D.R.1) ON TABFP FOR : TITL,RUND AND DATF
     C*
     C**   SET UP KEY FOR INSTALLATION CONTROL RECORD 1
     C                     MOVEL'01      'ZTABKY 12
     C                     MOVE '  10'    ZTABKY
     C*
     C           ZTABKY    CHAINTABFP                20    ON NOT THERE
     C**N20******RECI******COMP 'D'                  2020  ON, IS DELETED E35101
     C  N20      RECITB    COMP 'D'                  2020  ON, IS DELETED E35101
     C*
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C  N20      DATF      COMP 'M'                      98MMDDYY, 98 ON
     C*
     C*
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVELZTABKY    DBKEY            ***************
     C*********************MOVE 'TABFP'   DBFILE           * DB ERROR 01 *S01194
     C                     MOVEL'TABTB10 'DBFILE           ***************S01194
     C                     MOVE '01'      DBASE            ***************
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C***ACCESS*TABTB11*(I.C.D.R.2)*ON*TABFP*FOR*:*DNWD*FTDB*             S01117
     C** ACCESS TABTB11 (I.C.D.R.2) ON TABFP FOR : DNWD,MBIN              S01117
     C*
     C**   SET UP KEY FOR INSTALLATION CONTROL RECORD 2
     C*
     C                     MOVE '  11'    ZTABKY
     C*
     C           ZTABKY    CHAINTABFP                20    ON NOT THERE
     C**N20******RECI******COMP 'D'                  2020  ON, IS DELETED E35101
     C  N20      RECITB    COMP 'D'                  2020  ON, IS DELETED E35101
     C*
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVELZTABKY    DBKEY            ***************
     C*********************MOVE 'TABFP'   DBFILE           * DB ERROR 02 *S01194
     C                     MOVEL'TABTB11 'DBFILE           ***************S01194
     C                     MOVE '02'      DBASE            ***************
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C** SETUP EVENT CONTROL DATE (ECDAT)
     C*
      ** For Accrual for Non-working Days Processing Types 0 and 1,                           190167
      ** Event Control Date is DNWD - 1.                                                      190167
      *                                                                                       190167
     C           DNWD      SUB  1         ECDAT   50
     C*
      ** If Accrual for Non-working days indicator is equal 2, then                           190167
      ** if the Accrual/Profit Date is less than or equal to Date of                          190167
      ** Next Working Day minus 1, the Event Control Date should be                           190167
      ** the Accrual/Profit Date.  Otherwise, it should be Run Date.                          190167
      ** This is because Processing Type 2 processes non-working days                         190167
      ** retrospectively and will only generate events up to today,                           190167
      ** unless the next accrual day is before the next working day, in                       190167
      ** which case it will generate events to accrual day.                                   190167
      *                                                                                       190167
     C           ANWI      IFEQ '2'                                                           190167
     C           APDA      IFLE ECDAT                                                         190167
     C                     Z-ADDAPDA      ECDAT                                               190167
     C                     ELSE                                                               190167
     C                     Z-ADDRUND      ECDAT                                               190167
     C                     ENDIF                                                              190167
     C                     ENDIF                                                              190167
     C*
     C** BUILD UP ARRAYS FOR THE FOLLOWING : CCY / D.P. / SPOT RATE /
     C** MULT-DIV IND. / BUY SPREAD RATE & SIGN / SELL SPREAD RATE & SIGN
     C*
     C                     MOVEL'20    '  ZTABKY
     C                     MOVE '      '  ZTABKY
     C                     Z-ADD1         Z       30
     C*
     C           ZTABKY    SETLLTABFP
     C*
     C           *IN89     DOWEQ'0'                        * BEG 01 *
     C                     READ TABFP                    89
      *                                                                                      BUG3812
      ** Only continue to load arrays if end of file was not reached.                        BUG3812
      *                                                                                      BUG3812
     C           *IN89     IFEQ *OFF                                                         BUG3812
     C***********RECI******IFEQ 'D'                        * BEG 02 *     E35101
     C           RECITB    IFEQ 'D'                        * BEG 02 *     E35101
     C           DRECT     IFNE '20'                       * BEG 03 *
     C                     SETON                         89
     C*
     C                     ELSE                            * XXX 03 *
     C*
     C           DSREC     IFEQ '1'                        * BEG 04 *
     C                     MOVE DSCCY     CCYA,Z
     C                     Z-ADDCDP       CDPA,Z
     C                     Z-ADDSPOT      SPTA,Z
     C                     MOVE MDIN      MDA,Z
     C                     END                             * END 04 *
     C*
     C           DSREC     IFEQ '4'                        * BEG 05 *
     C           DSCCY     IFEQ CCYA,Z                     * BEG 06 *
     C                     Z-ADDBSPR      BSRA,Z
     C                     MOVE BSSG      BSSA,Z
     C                     Z-ADDSSPR      SSRA,Z
     C                     MOVE SSSG      SSSA,Z
     C*
     C                     ADD  1         Z
     C*
     C                     ELSE                            * XXX 06 *
     C*
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVEL'CCY REC 'KEY08   8
     C                     MOVEL'2 - '    KEY07   7        ***************
     C                     MOVE DSCCY     KEY07            * DB ERROR 03 *
     C                     MOVELKEY08     KEY15  15        ***************
     C                     MOVE KEY07     KEY15  15
     C                     MOVELKEY15     DBKEY
     C*********************MOVE 'TABFP'   DBFILE                          S01194
     C                     MOVEL'TABFP   'DBFILE                          S01194
     C                     MOVE '03'      DBASE
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END                             * END 06 *
     C                     END                             * END 05 *
     C*
     C           Z         IFGT 150                        * BEG 07 *
     C                     SETON                     89
     C                     END                             * END 07 *
     C*
     C*
     C                     END                             * END 03 *
     C                     END                             * END 02 *
     C*
     C                     ENDIF                                                             BUG3812
     C                     END                             * END 01 *
     C*
     C** SET UP CONTROL REPORT FIELD 'DIFFXX'
     C*
     C                     MOVEL'** DIFFE'DIFFXX 16
     C                     MOVE 'RENCE **'DIFFXX
     C*
     C* LOAD ARRAY OF BRANCH AND COMPANY CODES FROM SDBRCHPD              S01194
     C*                                                                   S01194
     C           1         SETLLSDBRCHPD                                  S01194
     C                     READ SDBRCHPD                 80               S01194
     C                     Z-ADD1         X       30                      S01194
     C*                                                                   S01194
     C           *IN80     DOWEQ'0'                                       S01194
     C*                                                                   S01194
     C           A8CMCD    IFEQ *BLANKS                                   S01194
     C           A8BICN    OREQ *BLANKS                                   S01194
     C*                                                                   S01194
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVE *BLANKS   DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 08 *S01194
     C                     Z-ADD8         DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     MOVE A8BRCD    BR,X                            S01194
     C                     MOVE A8CMCD    CO,X                            S01194
     C                     MOVE A8BICN    IC,X                            S01194
     C                     ADD  1         X                               S01194
     C*                                                                   S01194
     C                     READ SDBRCHPD                 80               S01194
     C*                                                                   S01194
     C                     END                                            S01194
     C*                                                                   106357
     C                     EXSR AOGELR                                    106357
     C**                                                                  106357
     C           @RTCD     IFEQ *BLANKS                    B002           106357
     C**********           MOVE BKACCD    FTCD2   40                                   106357 CGL029
     C                     MOVE BKACCD    FTCD2  100                                          CGL029
     C                     END                             E002           106357
     C*                                                                   S01194
     C* SET UP BRANCH, COMPANY AND SYSTEM ENTITY LEVEL                    S01117
     C*                                                                   S01117
     C                     MOVE 'B'       ELVB                            S01117
     C                     MOVE 'C'       ELVC                            S01117
     C                     MOVE 'S'       ELVS                            S01117
     C*                                                                   S01117
      *** Check if CFT004 is switched on                                  CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM '       ' @RTCD   7                       CFT004
     C                     PARM '*VERIFY' @OPTN                           CFT004
     C                     PARM 'CFT004'  @SARD   6                       CFT004
      *                                                                   CFT004
     C           @RTCD     IFEQ *BLANK                                    CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      *** Check if CFT009 is switched on                                  CFT009
      *                                                                   CFT009
     C                     CALL 'AOSARDR0'                                CFT009
     C                     PARM '       ' @RTCD                           CFT009
     C                     PARM '*VERIFY' @OPTN                           CFT009
     C                     PARM 'CFT009'  @SARD                           CFT009
      *                                                                   CFT009
     C           @RTCD     IFEQ *BLANK                                    CFT009
     C                     MOVE 'Y'       CFT009  1                       CFT009
     C                     ELSE                                           CFT009
     C                     MOVE 'N'       CFT009                          CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      ** Check if Position/Risk Enquiries & Reports feature (CEU011)      CEU011
     C/COPY WNCPYSRC,FT0610C009
      ** is on.                                                           CEU011
      *                                                                   CEU011
     C                     CALL 'AOSARDR0'                                CEU011
     C                     PARM *BLANKS   @RTCD   7                       CEU011
     C                     PARM '*VERIFY' @OPTN   7                       CEU011
     C                     PARM 'CEU011'  @SARD   6                       CEU011
     C           SCSARD    PARM SCSARD    DSFDY                           CEU011
      *                                                                   CEU011
     C                     MOVE 'N'       CEU011                          CEU011
     C           @RTCD     IFEQ *BLANK                                    CEU011
     C                     MOVE 'Y'       CEU011  1                       CEU011
     C                     ELSE                                           CEU011
      *                                                                   CEU011
      ** database error (return code other than *NRF)                     CEU011
      *                                                                   CEU011
     C           @RTCD     IFNE *BLANKS                                   CEU011
     C           @RTCD     ANDNE'*NRF   '                                 CEU011
     C           *LOCK     IN   DLDA                                      CEU011
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU011
     C                     Z-ADD16        DBASE            * DBERR 16 *   CEU011
     C                     MOVEL'CEU011 ' DBKEY            ************   CEU011
     C                     OUT  DLDA                                      CEU011
     C                     EXSR DBERR                                     CEU011
     C                     ENDIF                                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CFT014
      ** Check if CFT014 is on.                                           CFT014
      *                                                                   CFT014
     C                     CALL 'AOSARDR0'                                CFT014
     C                     PARM *BLANKS   @RTCD                           CFT014
     C                     PARM '*VERIFY' @OPTN                           CFT014
     C                     PARM 'CFT014'  @SARD                           CFT014
     C           SCSARD    PARM SCSARD    DSFDY                           CFT014
      *                                                                   CFT014
     C                     MOVE 'N'       CFT014  1                       CFT014
     C           @RTCD     IFEQ *BLANKS                                   CFT014
     C                     MOVE 'Y'       CFT014                          CFT014
     C                     OPEN INPAYXL2                                  CFT014
     C                     OPEN OTPAYXL2                                  CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
      ** Database error if return code other than *NRF.                   CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           @RTCD     ANDNE'*NRF   '                                 CFT014
     C           *LOCK     IN   DLDA                                      CFT014
     C                     Z-ADD040       DBASE                           CFT014
     C                     MOVEL'CFT014 ' DBKEY                           CFT014
     C                     MOVEL'SCSARDPD'DBFILE                          CFT014
     C                     MOVEL'FT0610  'DBPGM                           CFT014
     C                     OUT  DLDA                                      CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                          CFT014
      *                                                                                       CER049
      ** Determine if CER049 enhancement is installed                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  @SARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
     C                     MOVE 'N'       CER049  1                                           CER049
      *                                                                                       CER049
      ** If feature is on, set up SAR work flag                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CFT120
      ** Check if CFT120 is on.                                                               CFT120
      *                                                                                       CFT120
     C                     CALL 'AOSARDR0'                                                    CFT120
     C                     PARM *BLANKS   @RTCD                                               CFT120
     C                     PARM '*VERIFY' @OPTN                                               CFT120
     C                     PARM 'CFT120'  @SARD                                               CFT120
     C           SCSARD    PARM SCSARD    DSFDY                                               CFT120
      *                                                                                       CFT120
     C                     MOVE 'N'       CFT120  1                                           CFT120
     C           @RTCD     IFEQ *BLANKS                                                       CFT120
     C                     MOVE 'Y'       CFT120                                              CFT120
     C                     ELSE                                                               CFT120
      *                                                                                       CFT120
      ** Database error if return code other than *NRF.                                       CFT120
      *                                                                                       CFT120
     C           @RTCD     IFNE *BLANKS                                                       CFT120
     C           @RTCD     ANDNE'*NRF   '                                                     CFT120
     C           *LOCK     IN   DLDA                                                          CFT120
     C                     Z-ADD041       DBASE                                               CFT120
     C                     MOVEL'CFT120 ' DBKEY                                               CFT120
     C                     MOVEL'SCSARDPD'DBFILE                                              CFT120
     C                     MOVEL'FT0610  'DBPGM                                               CFT120
     C                     OUT  DLDA                                                          CFT120
     C                     EXSR DBERR                                                         CFT120
     C                     ENDIF                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                   CEU011
      ** Retrieve Ccy sort sequence no and store into array               CEU011
      ** to be used when writing record to PF/BPEVED.                     CEU011
      *                                                                   CEU011
     C********** CEU011    IFEQ 'Y'                                                    CEU011 177552
     C                     Z-ADD1         S       30                      CEU011
     C           *LOVAL    SETLLSDCURRL1                                  CEU011
     C           *IN42     DOUEQ'1'                                       CEU011
     C                     READ SDCURRL1                 42               CEU011
     C           *IN42     IFEQ '0'                                       CEU011
     C                     MOVE A6CYCD    CUR,S                           CEU011
     C                     MOVE A6SSNB    SRT,S                           CEU011
     C                     ADD  1         S                               CEU011
     C                     ENDIF                                          CEU011
     C                     ENDDO                                          CEU011
     C**********           ENDIF                                                       CEU011 177552
     C/COPY WNCPYSRC,FT0610C025
      *                                                                   CEU011
     C                     END                             * END 1ST *
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**  DETAIL  PROCESSING
     C*   ~~~~~~~~~~~~~~~~~~
     C/COPY WNCPYSRC,FT0610C015
     C*
     C   01                EXSR INPAYD
     C*
     C   02      PYTP      CASEQ'OP'      OSPROD
     C   02      PYTP      CASEQ'RP'      RSPROD
     C                     END
     C*
     C   03                EXSR CQCODD
     C   04                EXSR CQCOCD
     C   05                EXSR CQPACD
     C   06                EXSR CQPADD
     C   07                EXSR NTRAND
     C   08                EXSR INPAYZ
     C   09                EXSR OTPAYZ
     C   10                EXSR CQCODZ
     C   11                EXSR CQCOCZ
     C   12                EXSR CQPACZ
     C   13                EXSR CQPADZ
     C   14                EXSR NTRANZ
     C   15                EXSR FT101H                                    CFT006
     C   16                EXSR FT102H                                    CFT006
     C*
     C*-------------------------------------------------------------------
     C*
     C**  FINAL  PROCESSING
     C*   ~~~~~~~~~~~~~~~~~
     C*
     CLR                   EXSR PRTP1
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** INPAYD SR. TO PROCESS A RECORD FROM INPAYDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           INPAYD    BEGSR
     C*                                                                   S01486
     C           CFT009    IFEQ 'Y'                                                           CPK014
     C           PREF      CHAININPAYXL0             20                   CFT009
     C           *IN20     IFEQ *ON                                       CFT009
     C                     MOVEL'FT0610  'DBPGM                           CFT009
     C                     MOVE PREF      DBKEY            ***************CFT009
     C                     MOVEL'INPAYXPD'DBFILE           * DB ERROR 45 *CFT009
     C                     Z-ADD45        DBASE            ***************CFT009
     C                     EXSR DBERR                                     CFT009
     C                     END                                            CFT009
     C                     ENDIF                                                              CPK014
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           PREF      CHAININPAYQL0             21                                       CER049
     C           *IN21     IFEQ *ON                                                           CER049
     C                     MOVEL'FT0610  'DBPGM                                               CER049
     C                     MOVE PREF      DBKEY                                               CER049
     C                     MOVEL'INPAYDQD'DBFILE                                              CER049
     C                     Z-ADD47        DBASE                                               CER049
     C                     EXSR DBERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   CFT009
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'PYAM'
     C*
     C                     ADD  1         RECA,1
     C*
     C                     MOVE SMAM      ZZAMT
     C                     Z-ADDINTA,1    ZZTOTI
     C                     Z-ADDDECA,1    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,1
     C                     Z-ADDZZTOTD    DECA,1
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR AUT IND IS BLANK
     C*
     C***********RECI******IFNE 'D'                                                          BUG8927
     C           RECISV    IFNE 'D'                                                          BUG8927
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS01
     C                     END
      *                                                                   CFT014
      ** Retrieve Incoming Payment extension record.                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           PREF      CHAININPAYXL2             20                   CFT014
      *                                                                   CFT014
     C           *IN20     IFEQ *ON                                       CFT014
     C           *IN20     OREQ *OFF                                      CFT014
     C           INRECI    ANDNE'D'                                       CFT014
     C           *LOCK     IN   DLDA                                      CFT014
     C                     Z-ADD041       DBASE                           CFT014
     C                     MOVELPREF      DBKEY                           CFT014
     C                     MOVEL'INPAYXL2'DBFILE                          CFT014
     C                     MOVEL'FT0610  'DBPGM                           CFT014
     C                     OUT  DLDA                                      CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCPG                                           S01408
     C*                                                                   S01408
     C*
     C**   BYPASS IF PYDT <= ECDAT OR PYAM = ZERO :
     C*
     C           PVDT      IFLE ECDAT
     C           PYAM      OREQ *ZERO
     C                     GOTO TAG01
     C                     END
     C/COPY WNCPYSRC,FT0610C008
     C*
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********ACBK      IFNE *ZEROS                                    068095
     C           ACBT      IFNE *BLANKS                                   068095
     C                     MOVELACBK      WPTY
     C                     MOVE ACBT      WTYPE   1
     C                     MOVE PCCY      WCCY    3
     C           ACBT      IFEQ 'P'                                       S01117
     C                     MOVE ACBB      BRCANP                          S01117
     C                     END                                            S01117
     C                     ELSE
     C                     MOVELBNC1      WPTY
     C                     MOVE BNCT      WTYPE
     C                     MOVE PCCY      WCCY
     C           34        SUBSTBNC1:2    WPTY2                                               198372
     C                     END
     C*
     C                     EXSR NOSTRO
     C*
     C**   SET UP REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P1'    ETYP
     C                     MOVE PVDT      EDAT
     C                     Z-ADDPYAM      EAMT
      *                                                                   068320
      * Change event amount depending on charges                          068320
      *                                                                   068320
     C           ADDC      IFEQ 'D'                                       068320
     C           CDRT      ANDEQ*BLANKS                                   068320
      *                                                                   068320
      * Sum charges                                                       068320
      *                                                                   068320
     C           *LIKE     DEFN EAMT      ##CHGS                          068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  ADCH      ##CHGS                          068320
     C                     ADD  TLCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  INCHCM    ##CHGS                          S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  INVATT    ##CHGS                          S01499
      *                                                                   068320
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
      ** Access extension file                                            CFT009
     C                     ADD  MSC01     ##CHGS                          CFT009
     C                     ADD  MSC02     ##CHGS                          CFT009
     C                     ADD  MSC03     ##CHGS                          CFT009
     C                     ADD  MSC04     ##CHGS                          CFT009
     C                     ADD  MSC05     ##CHGS                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Subtract charges from event amount                                068320
      *                                                                   068320
     C                     SUB  ##CHGS    EAMT                            068320
      *                                                                   068320
     C                     END                                            068320
      *
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           PBCQ      DIV  PYAM      TBRAT  138H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE PCCY      ECCY
     C                     MOVE SLDT      OTHD
     C                     MOVE 'O'       INOI
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'I'       PYSR
     C                     MOVE SMCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE PCCY      CCCY
     C                     MOVE ACBT      PRT1T
     C                     MOVELACBK      PRT1
     C                     MOVE BNCT      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELBNC1      PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C017
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* MOVED AS NOW WITH PAY VALUE DATED
     C** MAKE A CHARGES EVENT
     C***********CDRO      IFNE 0                                                             CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C           TXCH      ADD  CQCH      EAMT
     C                     ADD  ADCH      EAMT
     C                     ADD  TLCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  INCHCM    EAMT                            S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  INVATT    EAMT                            S01499
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDEAMT      DBCE
     C                     MOVELCDRO      WPTY
     C                     MOVE CDRT      WTYPE
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVE CDBR      BRCANP                          S01117
     C                     END                                            S01117
      *                                                                                       CFT120
      ** Charges to the DR of Currency                                                        CFT120
      *                                                                                       CFT120
     C                     MOVE BCCY      WCCY
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE INCDRC    WCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0610C001
     C                     EXSR NOSTRO
      *                                                                                       CFT120
     C                     MOVE BCCY      ECCY
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE INCDRC    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE BCCY      CCCY
     C           INCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE INCDRC    CCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVE CDRT      PRT1T
     C                     MOVELCDRO      PRT1
     C/COPY WNCPYSRC,FT0610C002
      *                                                                                       CFT120
      ** Calculate base currency equivalent of charges event.                                 CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     SELEC                                                              CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ BCCY                                                          CFT120
     C                     Z-ADDEAMT      DBCE                                                CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ PCCY                                                          CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ SMCY                                                          CFT120
     C           SBCQ      DIV  SMAM      TBRAT     H                                         CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C                     OTHER                                                              CFT120
     C           *LIKE     DEFN UMOEDI    UMDAT                                               CFT120
     C           *LIKE     DEFN ECCY      UMCUR                                               CFT120
      *                                                                                       CFT120
      ** Get rate according to the date it was inserted.                                      CFT120
      *                                                                                       CFT120
     C                     CALL 'AOCUHSR0'                                                    CFT120
     C                     PARM '*MSG   ' UMRTCD  7                                           CFT120
     C                     PARM '*KEY   ' UMOPTN  7                                           CFT120
     C                     PARM UMOEDI    UMDAT                                               CFT120
     C                     PARM ECCY      UMCUR                                               CFT120
     C           SDCUHS    PARM SDCUHS    DSSDY                                               CFT120
      *                                                                                       CFT120
      ** If error in access program, exit via DBERR subroutine                                CFT120
      *                                                                                       CFT120
     C           UMRTCD    IFNE *BLANKS                                                       CFT120
     C           *LOCK     IN   DLDA                                                          CFT120
     C                     MOVELUMCUR     DBKEY     P                                         CFT120
     C                     MOVE 'SDCUHSPD'DBFILE                                              CFT120
     C                     MOVE '23'      DBASE     P                                         CFT120
     C                     OUT  DLDA                                                          CFT120
     C                     EXSR DBERR                                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C           G2MDIN    IFEQ 'M'                                                           CFT120
     C           EAMT      MULT G2SPRT    DBCE      H                                         CFT120
     C                     ELSE                                                               CFT120
     C           EAMT      DIV  G2SPRT    DBCE      H                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C                     ENDSL                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C* SET UP REMAINING FIELDS                                           S01117
     C*                                                                   S01117
     C                     MOVE 'I'       INOI                            E35088
     C*                                                                   S01117
     C                     EXSR CHGEV                                     S01117
     C*                                                                   S01117
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C                     END
     C*                                                    *************
     C           TAG01     TAG                             * TAG01 TAG *
     C*                                                    *************
     C**   BYPASS IF PVDT <= ECDAT OR PYAM = ZERO :
     C*
     C           SLDT      IFLE ECDAT
     C           SMAM      OREQ *ZERO
     C                     GOTO FINS01
     C                     END
     C*
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********RCCO      IFNE *ZEROS                                    CFT014
     C***********          MOVELRCCO      WPTY                            CFT014
     C***********          MOVE RCRT      WTYPE                           CFT014
     C                     MOVE SMCY      WCCY
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           INTRIT    ANDNE*BLANKS                                   CFT014
      *                                                                   CFT014
     C           INTRIT    IFNE 'I'                                       CFT014
     C                     MOVELINTRIB    WPTY                            CFT014
     C                     ELSE                                           CFT014
     C                     MOVE INTRIB    WPTY2  34                       CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVE INTRIT    WTYPE                           CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C           INRCRT    IFNE *BLANKS                                   CFT014
      *                                                                   CFT014
     C           INRCRT    IFNE 'I'                                       CFT014
     C                     MOVELINRCO1    WPTY                            CFT014
     C                     ELSE                                           CFT014
     C                     MOVE INRCO1    WPTY2                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVE INRCRT    WTYPE                           CFT014
      *                                                                   CFT014
     C                     ELSE
     C                     MOVELSND1      WPTY
     C                     MOVE SNTP      WTYPE
     C                     MOVE SMCY      WCCY
     C                     END
     C/COPY WNCPYSRC,FT0610C028
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*
     C                     EXSR NOSTRO
     C*
     C**   SET UP REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P2'    ETYP
     C                     MOVE SLDT      EDAT
     C                     Z-ADDSMAM      EAMT
      *                                                                   068320
      * Change event amount depending on charges                          068320
      *                                                                   068320
     C           ADDC      IFEQ 'A'                                       068320
     C           CDRT      ANDEQ*BLANKS                                   068320
      *                                                                   068320
      * Sum charges                                                       068320
      *                                                                   068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  ADCH      ##CHGS                          068320
     C                     ADD  TLCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  INCHCM    ##CHGS                          S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  INVATT    ##CHGS                          S01499
      *                                                                   068320
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     ADD  MSC01     ##CHGS                          CFT009
     C                     ADD  MSC02     ##CHGS                          CFT009
     C                     ADD  MSC03     ##CHGS                          CFT009
     C                     ADD  MSC04     ##CHGS                          CFT009
     C                     ADD  MSC05     ##CHGS                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      * Subtract charges from event amount                                068320
      *                                                                   068320
     C                     ADD  ##CHGS    EAMT                            068320
      *                                                                   068320
     C                     END                                            068320
      *
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           SBCQ      DIV  SMAM      TBRAT     H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE SMCY      ECCY
     C                     MOVE PVDT      OTHD
     C                     MOVE 'I'       INOI
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'I'       PYSR
     C                     MOVE PCCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE SMCY      CCCY
     C***********          MOVE RCRT      PRT1T                           CFT014
     C***********          MOVELRCCO      PRT1                            CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           INTRIT    ANDNE*BLANKS                                   CFT014
      *                                                                   CFT014
     C                     MOVE INTRIT    PRT1T                           CFT014
      *                                                                   CFT014
     C           INTRIT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C                     MOVELINTRIB    P@IBN                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINTRIB    PRT1                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ELSE                                           CFT014
      *                                                                   CFT014
     C                     MOVE INRCRT    PRT1T                           CFT014
      *                                                                   CFT014
     C           INRCRT    IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C                     MOVE INRCO1    P@IBN                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVELINRCO1    PRT1                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C/COPY WNCPYSRC,FT0610C029
     C                     MOVE SNTP      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELSND1      PRT2
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
      ** Account is in IBAN format.                                       CFT014
      *                                                                   CFT014
     C           PRT1T     IFEQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
      *                                                                   CFT014
      ** Determine Customer of IBAN.                                      CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM           @RTCD                           CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM           P@IBN                           CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   DLDA                                      CFT014
     C                     Z-ADD043       DBASE                           CFT014
     C                     MOVELP@IBN     DBKEY                           CFT014
     C                     MOVEL'ACCNTL6 'DBFILE                          CFT014
     C                     MOVEL'FT0610  'DBPGM                           CFT014
     C                     OUT  DLDA                                      CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ELSE                                           CFT014
     C                     MOVELCNUM      PRT1                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C*                                                                **
     C***MAKE*A*CHARGES*EVENT*                                            E23905
     C***********CDRO******IFNE 0                                         E23905
     C***********TXCH******ADD  CQCH      EAMT                            E23905
     C*********************ADD  ADCH      EAMT                            E23905
     C*********************ADD  TLCH      EAMT                            E23905
     C*********************ADD  MSCH      EAMT                            E23905
     C*********************ADD  TRCM      EAMT                            E23905
     C*********************MOVELCDRO      WPTY                            E23905
     C*********************MOVE CDRT      WTYPE                           E23905
     C*********************MOVE BCCY      WCCY                            E23905
     C*********************EXSR NOSTRO                                    E23905
     C*********************MOVE BCCY      ECCY                            E23905
     C*********************EXSR RECWRT                                    E23905
     C*********************END                                            E23905
     C           FINS01    ENDSR                           * FINS01 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** OPPAYD SR. TO PROCESS A RECORD FROM OTPAYDD -
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C** PAYMENT TYPE = 'OP'
     C*  ~~~~~~~~~~~~~~~~~~~
     C*
     C           OSPROD    BEGSR
     C*                                                                   S01486
      ** Access extension file                                            CFT009
     C           CFT009    IFEQ 'Y'                                                           CPK014
     C           PREF      CHAINOTPAYXL0             20                   CFT009
     C           *IN20     IFEQ *ON                                       CFT009
     C                     MOVEL'FT0610  'DBPGM                           CFT009
     C                     MOVE PREF      DBKEY            ***************CFT009
     C                     MOVEL'OTPAYXPD'DBFILE           * DB ERROR 46 *CFT009
     C                     Z-ADD46        DBASE            ***************CFT009
     C                     EXSR DBERR                                     CFT009
     C                     END                                            CFT009
     C                     ENDIF                                                              CPK014
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           PREF      CHAINOTPAYQL0             21                                       CER049
     C           *IN21     IFEQ *ON                                                           CER049
     C                     MOVEL'FT0610  'DBPGM                                               CER049
     C                     MOVE PREF      DBKEY                                               CER049
     C                     MOVEL'OTPAYDQD'DBFILE                                              CER049
     C                     Z-ADD48        DBASE                                               CER049
     C                     EXSR DBERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   CFT009
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'PYAM'
     C*
     C                     ADD  1         RECA,2
     C*                                                                   050984
     C                     MOVE 'N'       GEND    1                       050984
     C*
     C                     MOVE SMAM      ZZAMT
     C                     Z-ADDINTA,2    ZZTOTI
     C                     Z-ADDDECA,2    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,2
     C                     Z-ADDZZTOTD    DECA,2
     C*
     C***   BYPASS PROCESSING IF RECI <> 'D' OR AUTH IND IS BLANK
     C**
     C***********RECI******IFNE 'D'                                                          BUG8927
     C           RECISV    IFNE 'D'                                                          BUG8927
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS02
     C                     END
      *                                                                   CFT014
      ** Retrieve Outgoing Payment extension record.                      CFT014
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           PREF      CHAINOTPAYXL2             20                   CFT014
      *                                                                   CFT014
     C           *IN20     IFEQ *ON                                       CFT014
     C           *IN20     OREQ *OFF                                      CFT014
     C           OPRECI    ANDNE'D'                                       CFT014
     C           *LOCK     IN   DLDA                                      CFT014
     C                     Z-ADD042       DBASE                           CFT014
     C                     MOVELPREF      DBKEY                           CFT014
     C                     MOVEL'OTPAYXL2'DBFILE                          CFT014
     C                     MOVEL'FT0610  'DBPGM                           CFT014
     C                     OUT  DLDA                                      CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCP1                                           S01408
     C*                                                                   S01408
     C*
     C**   BYPASS IF PVDT <= ECDAT OR PYAM = ZERO :
     C*
     C           SLDT      IFLE ECDAT
     C           SMAM      OREQ *ZERO
     C                     GOTO TAG02
     C                     END
     C*
     C/COPY WNCPYSRC,FT0610C026
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********ORBK      IFNE *ZEROS                                                        CSD027
     C           ORBK      IFNE *BLANKS                                                       CSD027
     C                     MOVELORBK      WPTY
     C                     MOVE ORBT      WTYPE
     C                     MOVE SMCY      WCCY
     C           ORBT      IFEQ 'P'                                       S01117
     C                     MOVE ORBB      BRCANP                          S01117
     C                     END                                            S01117
     C                     ELSE
     C                     MOVELORC1      WPTY
      *                                                                                       CFT032
      ** Override default move of ORC1 to WPTY (above) if necessary...                        CFT032
      ** Check if slash is the first character.                                               CFT032
      **   1. If yes, and ORCT is 'R' or 'P' remove the slash.                                CFT032
      *    2. If no, and ORCT is 'I' prefix with a slash.                                     CFT032
      *                                                                                       CFT032
     C           1         SUBSTORC1:1    SLS     1                                           CFT032
     C           SLS       IFEQ '/'                                                           CFT032
     C           ORCT      IFEQ 'P'                                                           CFT032
     C           ORCT      OREQ 'R'                                                           CFT032
     C                     SUBSTORC1:2    WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ELSE                                                               CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C           '/'       CAT  ORC1      WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C           SLS       IFEQ '/'                                                         BUG15230
     C           34        SUBSTORC1:2    WPTY2                                             BUG15230
     C                     ELSE                                                             BUG15230
     C                     MOVELORC1      WPTY2                                             BUG15230
     C                     ENDIF                                                            BUG15230
      *                                                                                     BUG15230
     C                     MOVE ORCT      WTYPE
     C                     MOVE SMCY      WCCY
     C                     END
     C/COPY WNCPYSRC,FT0610C030
     C*
     C                     EXSR NOSTRO
     C*
     C**   SET UP REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P2'    ETYP
     C                     MOVE SLDT      EDAT
     C                     Z-ADDSMAM      EAMT
      *                                                                   068320
      * Change event amount depending on charges                          068320
      *                                                                   068320
     C           ADDC      IFEQ 'A'                                       068320
     C           CDRT      ANDEQ*BLANKS                                   068320
      *                                                                   068320
      * Sum charges                                                       068320
      *                                                                   068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  CSTA      ##CHGS                          068320
     C                     ADD  SPCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  OPCHCM    ##CHGS                          S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  OPVATT    ##CHGS                          S01499
      *                                                                   068320
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     ADD  MISC01    ##CHGS                          CFT009
     C                     ADD  MISC02    ##CHGS                          CFT009
     C                     ADD  MISC03    ##CHGS                          CFT009
     C                     ADD  MISC04    ##CHGS                          CFT009
     C                     ADD  MISC05    ##CHGS                          CFT009
     C                     ADD  SWSCHG    ##CHGS                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
      *                                                                   CFT009
      * Subtract charges from event amount                                068320
      *                                                                   068320
     C                     ADD  ##CHGS    EAMT                            068320
      *                                                                   068320
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCSC    EAMT                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     END                                            068320
      *
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           SBCQ      DIV  SMAM      TBRAT     H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE SMCY      ECCY
     C                     MOVE PVDT      OTHD
     C/COPY WNCPYSRC,FT0610C024
     C                     MOVE 'I'       INOI
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'O'       PYSR
     C                     MOVE PCCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE SMCY      CCCY
     C                     MOVE ORBT      PRT1T
     C                     MOVELORBK      PRT1
     C/COPY WNCPYSRC,FT0610C031
     C                     MOVE ORCT      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELORC1      PRT2
      *                                                                                       CFT032
      ** Override default move of ORC1 to PRT2 (above) if necessary...                        CFT032
      ** Check if slash is the first character.                                               CFT032
      **   1. If yes, and ORCT is 'C', 'S' or 'A' use ORC2 instead of ORC1                    CFT032
      *       to move to PRT2                                                                 CFT032
      *    2. If yes, and ORCT is not 'C', 'S', or 'A', start from                            CFT032
      *       2nd character of ORC1 to move to PRT2                                           CFT032
      *    3. If no, and ORCT is 'I' move '/'+ORC1 to WPTY.                                   CFT032
      *                                                                                       CFT032
     C           1         SUBSTORC1:1    SLS                                                 CFT032
     C           SLS       IFEQ '/'                                                           CFT032
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C           ORCT      IFEQ 'C'                                                           CFT032
     C           ORCT      OREQ 'S'                                                           CFT032
     C           ORCT      OREQ 'A'                                                           CFT032
     C                     MOVELORC2      PRT2                                                CFT032
     C                     ELSE                                                               CFT032
     C                     SUBSTORC1:2    PRT2                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ELSE                                                               CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C           '/'       CAT  ORC1      WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C018
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** MAKE A CHARGES EVENT
     C***********CDRO      IFNE 0                                                             CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C           TXCH      ADD  CQCH      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  SPCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  OPCHCM    EAMT                            S01494
     C*                                                                   S01499
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  OPVATT    EAMT                            S01499
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C           ADDC      ANDEQ'A'                                       CFT014
     C                     ADD  OPRCSQ    EAMT                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDEAMT      DBCE
     C                     MOVELCDRO      WPTY
     C                     MOVE CDRT      WTYPE
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVE CDBR      BRCANP                          S01117
     C                     END                                            S01117
      *                                                                                       CFT120
      ** Charges to the DR of Currency                                                        CFT120
      *                                                                                       CFT120
     C                     MOVE BCCY      WCCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    WCCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C/COPY WNCPYSRC,FT0610C003
     C                     EXSR NOSTRO
     C                     MOVE BCCY      ECCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE BCCY      CCCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    CCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVE CDRT      PRT1T
     C                     MOVELCDRO      PRT1
      *                                                                                       CFT120
      ** Calculate base currency equivalent of charges event.                                 CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     SELEC                                                              CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ BCCY                                                          CFT120
     C                     Z-ADDEAMT      DBCE                                                CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ SMCY                                                          CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ PCCY                                                          CFT120
     C           PBCQ      DIV  PYAM      TBRAT     H                                         CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C                     OTHER                                                              CFT120
     C                     CALL 'AOCUHSR0'                                                    CFT120
     C                     PARM '*MSG   ' UMRTCD  7                                           CFT120
     C                     PARM '*KEY   ' UMOPTN  7                                           CFT120
     C                     PARM UMOEDO    UMDAT                                               CFT120
     C                     PARM ECCY      UMCUR                                               CFT120
     C           SDCUHS    PARM SDCUHS    DSSDY                                               CFT120
      *                                                                                       CFT120
      ** If error in access program, exit via DBERR subroutine                                CFT120
      *                                                                                       CFT120
     C           UMRTCD    IFNE *BLANKS                                                       CFT120
     C           *LOCK     IN   DLDA                                                          CFT120
     C                     MOVELUMCUR     DBKEY     P                                         CFT120
     C                     MOVE 'SDCUHSPD'DBFILE                                              CFT120
     C                     MOVE '24'      DBASE                                               CFT120
     C                     OUT  DLDA                                                          CFT120
     C                     EXSR DBERR                                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C           G2MDIN    IFEQ 'M'                                                           CFT120
     C           EAMT      MULT G2SPRT    DBCE      H                                         CFT120
     C                     ELSE                                                               CFT120
     C           EAMT      DIV  G2SPRT    DBCE      H                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C                     ENDSL                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0610C004
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C* SET UP REMAINING FIELDS                                           S01117
     C*                                                                   S01117
     C                     EXSR CHGEV                                     S01117
     C*                                                                   S01117
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C                     END
     C*                                                    *************
     C           TAG02     TAG                             * TAG02 TAG *
     C*                                                    *************
     C**   BYPASS IF PYDT <= ECDAT AND PYAM = ZERO :
     C*
     C           PVDT      IFLE ECDAT
     C           PYAM      OREQ *ZERO
     C                     GOTO FINS02
     C                     END
     C*
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********SNCO      IFNE *ZEROS                                                        CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSNCO      WPTY
     C                     MOVE SNCT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     ELSE
     C                     MOVELDST1      WPTY
     C                     MOVE DSTT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     END
     C/COPY WNCPYSRC,FT0610C032
     C*
     C                     EXSR NOSTRO
     C*
     C**   SET UP REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P1'    ETYP
     C                     MOVE PVDT      EDAT
     C                     Z-ADDPYAM      EAMT
      *                                                                   CFT014
     C           CFT014    IFEQ 'Y'                                       CFT014
     C                     ADD  OPRCRM    EAMT                            CFT014
     C                     ENDIF                                          CFT014
      *                                                                   068320
      * Change event amount depending on charges                          068320
      *                                                                   068320
     C           ADDC      IFEQ 'D'                                       068320
     C           CDRT      ANDEQ*BLANKS                                   068320
      *                                                                   068320
      * Sum charges                                                       068320
      *                                                                   068320
     C           TXCH      ADD  CQCH      ##CHGS                          068320
     C                     ADD  CSTA      ##CHGS                          068320
     C                     ADD  SPCH      ##CHGS                          068320
     C                     ADD  MSCH      ##CHGS                          068320
     C                     ADD  TRCM      ##CHGS                          068320
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  OPCHCM    ##CHGS                          S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  OPVATT    ##CHGS                          S01499
      *                                                                   CFT009
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
      *                                                                   CFT009
     C                     ADD  MISC01    ##CHGS                          CFT009
     C                     ADD  MISC02    ##CHGS                          CFT009
     C                     ADD  MISC03    ##CHGS                          CFT009
     C                     ADD  MISC04    ##CHGS                          CFT009
     C                     ADD  MISC05    ##CHGS                          CFT009
     C                     ADD  SWSCHG    ##CHGS                          CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   068320
      * Subtract charges from event amount                                068320
      *                                                                   068320
     C                     SUB  ##CHGS    EAMT                            068320
      *                                                                   068320
     C                     END                                            068320
      *
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           PBCQ      DIV  PYAM      TBRAT     H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE PCCY      ECCY
     C                     MOVE SLDT      OTHD
     C                     MOVE 'O'       INOI
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'O'       PYSR
     C                     MOVE SMCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE PCCY      CCCY
     C                     MOVE SNCT      PRT1T
     C                     MOVELSNCO      PRT1
     C/COPY WNCPYSRC,FT0610C033
     C                     MOVE DSTT      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELDST1      PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                    **************
     C           FINS02    ENDSR                           * FINS02 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** RPPAYD SR. TO PROCESS A RECORD FROM OTPAYDD -
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C** PAYMENT TYPE = 'RP'
     C*  ~~~~~~~~~~~~~~~~~~~
     C*
     C           RSPROD    BEGSR
     C*                                                                   S01486
      ** Access extension file                                            CFT009
     C           PREF      CHAINOTPAYXL0             20                   CFT009
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           PREF      CHAINOTPAYQL0             21                                       CER049
     C           *IN21     IFEQ *ON                                                           CER049
     C                     MOVEL'FT0610  'DBPGM                                               CER049
     C                     MOVE PREF      DBKEY                                               CER049
     C                     MOVEL'OTPAYDQD'DBFILE                                              CER049
     C                     Z-ADD48        DBASE                                               CER049
     C                     EXSR DBERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                   CFT009
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'PYAM'
     C*
     C                     ADD  1         RECA,2
     C*
     C                     MOVE SMAM      ZZAMT
     C                     Z-ADDINTA,2    ZZTOTI
     C                     Z-ADDDECA,2    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,2
     C                     Z-ADDZZTOTD    DECA,2
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR FDAT < ECDAT
     C**                                    OR AUTH IND IS BLANK
     C*
     C           RECI      IFNE 'D'
     C           FDAT      ORLT ECDAT
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS03
     C                     END
     C/COPY WNCPYSRC,FT0610C034
      *                                                                   053989
      * Initialise GEND to N to show no event created                     053989
      *                                                                   053989
     C                     MOVEL'N'       GEND                            053989
     C*
     C**   SETOF WORK INDICATOR
     C*
     C                     MOVE '0'       *IN24
     C*
     C*****GENERATE*FIRST*SET*OF*EVENTS*IF*NPDT*>*ECDAT*:*****************082484
     C**   GENERATE FIRST SET OF EVENTS IF NPDT > NEXT WORKING DAY.       082484
     C*
     C********** NPDT      IFGT ECDAT                      **BEG*01**     082484
     C           NPDT      IFGT DNWD                       * BEG 01 *     082484
      *                                                                   050984
     C                     MOVE 'Y'       GEND                            050984
     C*
     C                     EXSR SRREG1                     * 1ST REGULAR *
     C*
     C**   SET UP FIELDS FOR FPVNTDD : SETTLE SIDE
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P8'    ETYP
     C                     MOVE NPDT      EDAT
      *                                                                   062394
      * If frequency is + or - find first working day in local            062394
      * currency                                                          062394
      *                                                                   062394
     C           ZFREQ     IFEQ '+'                                       062394
     C                     Z-ADD0         ZNRDYS                          062394
     C                     Z-ADDEDAT      ZDAYNO                          062394
     C                     EXSR ZFWDT                                     062394
     C                     Z-ADDZDYNBR    EDAT                            062394
     C                     END                                            062394
      *                                                                   062394
     C           ZFREQ     IFEQ '-'                                       062394
     C                     Z-ADD0         ZNRDYS                          062394
     C                     Z-ADDEDAT      ZDAYNO                          062394
     C           ZDYNBR    DOULEEDAT                                      062394
     C                     EXSR ZFWDT                                     062394
     C                     SUB  1         ZDAYNO                          062394
     C                     END                                            062394
     C                     Z-ADDZDYNBR    EDAT                            062394
     C                     END                                            062394
      *                                                                   062394
     C                     Z-ADDSMAM      EAMT
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           SBCQ      DIV  SMAM      TBRAT     H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE SMCY      ECCY
     C                     MOVE 'I'       INOI
     C                     MOVE WPSTNI    STNI
     C                     MOVE WPNOSA    NOSA
     C*
     C**   SET UP OTHER (PAY VALUE) DATE
     C*
     C*********************MOVE PCCY      ZCCY                            S01195
     C*********************MOVE SMCY      LOCY    3                       S01195
     C                     Z-ADDPRBD      ZNRDYS
     C                     Z-ADDNPDT      ZDAYNO
     C*
     C*********************EXSR ZTXDAY                                    S01195
     C*
     C* IF PAY PARTY IS A NOSTRO, USE PAY CURRENCY AND PAY NOSTRO         S01195
     C* LOCATION ELSE USE SYSTEM LOCATION AND LOCAL CURRENCY              S01195
     C*                                                                   S01195
     C           WRSTNI    IFEQ 'Y'                                       S01195
     C                     MOVE PCCY      ZCCY                            S01195
     C                     MOVE PAYLOC    ZLOC                            S01195
     C                     ELSE                                           S01195
     C                     MOVE LOCY      ZCCY                            S01195
     C                     MOVE SLOC      ZLOC                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     EXSR ZFWDT                                     S01195
     C*                                                                   S01195
     C                     Z-ADDZDYNBR    OTHD
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'O'       PYSR
     C                     MOVE PCCY      OTCY
     C*********************                                               E35097
     C**FIND*CNUM*FOR*OUTPUT*                                             E35097
     C*********************                                               E35097
     C*********************MOVE SMCY      CCCY                            E35097
     C*********************MOVE ORBT      PRT1T                           E35097
     C*********************MOVELORBK      PRT1                            E35097
     C*********************MOVE ORCT      PRT2T                           E35097
     C*********************MOVELORC1      PRT2                            E35097
     C*********************EXSR CLIENT                                    E35097
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C                     MOVE BRCH1     BRCPTY                          S01117
     C                     MOVE CUNR1     CUNR                            E35097
     C                     EXSR MAINEV                                    S01117
     C*
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C019
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** MAKE A CHARGES EVENT
     C***********CDRO      IFNE 0                                                             CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C           TXCH      ADD  CQCH      EAMT
     C                     ADD  CSTA      EAMT
     C                     ADD  SPCH      EAMT
     C                     ADD  MSCH      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  OPCHCM    EAMT                            S01494
     C*                                                                   S01499
      ** If CFT009 is on, add in new charges.                             CFT009
      *                                                                   CFT009
     C           CFT009    IFEQ 'Y'                                       CFT009
     C                     ADD  MISC01    EAMT                            CFT009
     C                     ADD  MISC02    EAMT                            CFT009
     C                     ADD  MISC03    EAMT                            CFT009
     C                     ADD  MISC04    EAMT                            CFT009
     C                     ADD  MISC05    EAMT                            CFT009
     C                     ADD  SWSCHG    EAMT                            CFT009
      *                                                                   CFT009
     C                     ENDIF                                          CFT009
      *                                                                   CFT009
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  OPVATT    EAMT                            S01499
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDEAMT      DBCE
     C                     MOVELCDRO      WPTY
     C                     MOVE CDRT      WTYPE
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVE CDBR      BRCANP                          S01117
     C                     END                                            S01117
      *                                                                                       CFT120
      ** Charges to the DR of Currency                                                        CFT120
      *                                                                                       CFT120
     C                     MOVE BCCY      WCCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    WCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0610C005
     C                     EXSR NOSTRO
      *                                                                                       CFT120
     C                     MOVE BCCY      ECCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    ECCY                                                CFT120
     C                     ENDIF                                                              CFT120
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE BCCY      CCCY
     C           OPCDRC    IFNE *BLANKS                                                       CFT120
     C           CFT120    ANDEQ'Y'                                                           CFT120
     C                     MOVE OPCDRC    CCCY                                                CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C                     MOVE CDRT      PRT1T
     C                     MOVELCDRO      PRT1
      *                                                                                       CFT120
      ** Calculate base currency equivalent of charges event.                                 CFT120
      *                                                                                       CFT120
     C           CFT120    IFEQ 'Y'                                                           CFT120
     C                     SELEC                                                              CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ BCCY                                                          CFT120
     C                     Z-ADDEAMT      DBCE                                                CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ SMCY                                                          CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C           ECCY      WHEQ PCCY                                                          CFT120
     C           PBCQ      DIV  PYAM      TBRAT     H                                         CFT120
     C           EAMT      MULT TBRAT     DBCE      H                                         CFT120
      *                                                                                       CFT120
     C                     OTHER                                                              CFT120
     C                     CALL 'AOCUHSR0'                                                    CFT120
     C                     PARM '*MSG   ' UMRTCD  7                                           CFT120
     C                     PARM '*KEY   ' UMOPTN  7                                           CFT120
     C                     PARM UMOEDO    UMDAT                                               CFT120
     C                     PARM ECCY      UMCUR                                               CFT120
     C           SDCUHS    PARM SDCUHS    DSSDY                                               CFT120
      *                                                                                       CFT120
      ** If error in access program, exit via DBERR subroutine                                CFT120
      *                                                                                       CFT120
     C           UMRTCD    IFNE *BLANKS                                                       CFT120
     C           *LOCK     IN   DLDA                                                          CFT120
     C                     MOVELUMCUR     DBKEY     P                                         CFT120
     C                     MOVE 'SDCUHSPD'DBFILE                                              CFT120
     C                     MOVE '25'      DBASE                                               CFT120
     C                     OUT  DLDA                                                          CFT120
     C                     EXSR DBERR                                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C           G2MDIN    IFEQ 'M'                                                           CFT120
     C           EAMT      MULT G2SPRT    DBCE      H                                         CFT120
     C                     ELSE                                                               CFT120
     C           EAMT      DIV  G2SPRT    DBCE      H                                         CFT120
     C                     END                                                                CFT120
      *                                                                                       CFT120
     C                     ENDSL                                                              CFT120
     C                     ENDIF                                                              CFT120
      *                                                                                       CFT120
     C/COPY WNCPYSRC,FT0610C006
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C* SET UP REMAINING FIELDS                                           S01117
     C*                                                                   S01117
     C                     EXSR CHGEV                                     S01117
     C*                                                                   S01117
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C                     END
     C*
     C**   SET UP FIELDS FOR FPVNTDD : PAY SIDE
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P9'    ETYP
     C*********************MOVE NPDT      EDAT                            E35095
     C                     MOVE OTHD      EDAT                            E35095
     C                     Z-ADDPYAM      EAMT
     C* CALCULATE BASE EQUIV OF NET
     C*
     C           PBCQ      DIV  PYAM      TBRAT     H      TO BASE RATE
     C           EAMT      MULT TBRAT     DBCE      H
     C                     MOVE PCCY      ECCY
     C                     MOVE 'O'       INOI
     C                     MOVE WRSTNI    STNI
     C                     MOVE WRNOSA    NOSA
     C*
     C**   SET UP OTHER (PAY VALUE) DATE
     C*
     C*********************MOVE SMCY      ZCCY                            E35095
     C*********************MOVE PCCY      LOCY                            E35095
     C*********************Z-ADDPRBD      ZNRDYS                          E35095
     C*********************Z-ADDNPDT      ZDAYNO                          E35095
     C*********************                                               E35095
     C*********************EXSR ZTXDAY                                    E35095
     C*********************                                               E35095
     C*********************Z-ADDZDYNBR    OTHD                            E35095
     C                     MOVE NPDT      OTHD                            E35095
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'O'       PYSR
     C                     MOVE SMCY      OTCY
     C*********************                                               E35097
     C**FIND*CNUM*FOR*OUTPUT*                                             E35097
     C*********************                                               E35097
     C*********************MOVE PCCY      CCCY                            E35097
     C*********************MOVE SNCT      PRT1T                           E35097
     C*********************MOVELSNCO      PRT1                            E35097
     C*********************MOVE DSTT      PRT2T                           E35097
     C*********************MOVELDST1      PRT2                            E35097
     C*********************EXSR CLIENT                                    E35097
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C                     MOVE BRCH2     BRCPTY                          S01117
     C                     MOVE CUNR2     CUNR                            E35097
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C                     END                             * END 01 *
     C*
     C**   WHILE  NPDT < FDAT GENERATE SUBSEQUENT SET OF EVENTS :
     C*
     C           NPDT      DOWLTFDAT
     C***********GEND      ANDEQ'Y'                                 050984053989
     C           GEND      ANDEQ'N'                                       053989
     C                     EXSR SRNREG                     * NEXT REGULAR*
     C                     END
     C*                                                    **************
     C           FINS03    ENDSR                           * FINS03 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** CQCODD SR. TO PROCESS A RECORD FROM CQCODDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           CQCODD    BEGSR
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'TOCL'
     C*
     C                     ADD  1         RECA,3
     C*
     C                     MOVE TOCL      ZZAMT
     C                     Z-ADDINTA,3    ZZTOTI
     C                     Z-ADDDECA,3    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,3
     C                     Z-ADDZZTOTD    DECA,3
     C*
     C**   STORE CRITICAL FIELDS FOR USE LATER
     C*
     C                     MOVE PYTP      WPYTP   2
     C                     MOVE PYST      WPYST   2
     C                     MOVE SMCY      WSMCY   3
     C                     MOVE SLDT      WSLDT   50
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR PVDT <= ECDAT OR
     C**   TOCL = ZERO OR AUTH IND IS BLANK
     C**
     C           RECI      IFNE 'D'
     C           SLDT      ORLE ECDAT
     C           TOCL      OREQ *ZEROS
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS04
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCP2                                           S01408
     C*                                                                   S01408
     C*
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********RCCO      IFNE *ZEROS                                                        CSD027
     C           RCCO      IFNE *BLANKS                                                       CSD027
     C                     MOVELRCCO      WPTY
     C                     MOVE RCRT      WTYPE
     C                     MOVE SMCY      WCCY
     C                     ELSE
     C                     MOVELCOB1      WPTY
     C                     MOVE COBT      WTYPE
     C                     MOVE SMCY      WCCY
     C                     END
     C*
     C                     EXSR NOSTRO
     C*
     C**   SETUP REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P3'    ETYP
     C                     MOVE SLDT      EDAT
     C                     Z-ADDTOCL      EAMT
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDSBCQ      DBCE
     C                     MOVE SMCY      ECCY
     C                     MOVE 'I'       INOI
     C                     Z-ADD*ZEROS    OTHD
     C*********************Z-ADD*ZEROS    RATE                            034118
     C                     Z-ADD1         RATE                            034118
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'C'       PYSR
     C                     MOVE *BLANK    OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE SMCY      CCCY
     C                     MOVE RCRT      PRT1T
     C                     MOVELRCCO      PRT1
     C                     MOVE COBT      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELCOB1      PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*                                                                   050984
     C           FDAT      ADD  1         NPDT                            050984
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                    **************
     C           FINS04    ENDSR                           * FINS04 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** CQCOCD SR. TO PROCESS A RECORD FROM CQCOCDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           CQCOCD    BEGSR
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           QCKEY     CHAINCQCOCQL0             21                                       CER049
     C           *IN21     IFEQ *ON                                                           CER049
     C                     MOVEL'FT0610  'DBPGM                                               CER049
     C                     MOVE PREF      DBKEY                                               CER049
     C                     MOVEL'CQCOCQL0'DBFILE                                              CER049
     C                     Z-ADD49        DBASE                                               CER049
     C                     EXSR DBERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'CQAM'
     C*
     C                     ADD  1         RECA,4
     C*
     C                     MOVE CQAM      ZZAMT
     C                     Z-ADDINTA,4    ZZTOTI
     C                     Z-ADDDECA,4    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,4
     C                     Z-ADDZZTOTD    DECA,4
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR CRVD <= ECDAT OR
     C**   CQAM = ZERO
     C*
     C           RECI      IFNE 'D'
     C           CRVD      ORLE ECDAT
     C           CQAM      OREQ *ZEROS
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS05
     C                     END
     C*
     C**   IF CRCY = WPCCY (SAVED FROM CQCODD SR.) SET EVENT AMNT TO
     C**   CHEQUE AMNT
     C*
     C           CRCY      IFEQ WSMCY
     C                     Z-ADDCQAM      EAMT
     C                     ELSE                                           159283
     C                     Z-ADDCCYAM     EAMT                            159283
     C                     END
     C*****************************************************************   159283
     C*****IF*CRCY*<>*WPCCY*(SAVED*FROM*CQCODD*SR.)*:******************   159283
     C*****************************************************************   159283
     C***********CRCY      IFNE WSMCY                      * BEG 01 *     159283
     C*****************************************************************   159283
     C*****DETERMINE*SETTLE*CURRENCY*D.P.*(WSMCY)*FROM*ARRAYS*SET*UP***   159283
     C*****************************************************************   159283
     C***********          MOVE WSMCY     SCCY    3                       159283
     C***********          EXSR SRCCY                                     159283
     C*****************************************************************   159283
     C***********          Z-ADDCDPA,Z    WPCDP   10                      159283
     C*****************************************************************   159283
     C*****DETERMINE*CREDIT*CURRENCY*D.P.*FROM*ARRAYS*SET*UP***********   159283
     C*****************************************************************   159283
     C***********          MOVE CRCY      SCCY                            159283
     C***********          EXSR SRCCY                                     159283
     C*****************************************************************   159283
     C***********          Z-ADDCDPA,Z    WCCDP   10                      159283
     C*****************************************************************   159283
     C*****SET*UP*DIVISOR*DEPENDING*ON*D.P.*FOR*SETTLE*CCY*************   159283
     C*****************************************************************   159283
     C***********WPCDP     IFEQ *ZERO                                     159283
     C***********          Z-ADD1         WPDIV   40                      159283
     C***********          ELSE                                           159283
     C***********WPCDP     IFEQ 1                                         159283
     C***********          Z-ADD10        WPDIV                           159283
     C***********          ELSE                                           159283
     C***********WPCDP     IFEQ 2                                         159283
     C***********          Z-ADD100       WPDIV                           159283
     C***********          ELSE                                           159283
     C***********          Z-ADD1000      WPDIV                           159283
     C***********          END                                            159283
     C***********          END                                            159283
     C***********          END                                            159283
     C*****************************************************************   159283
     C*****SET*UP*DIVISOR*DEPENDING*ON*D.P.*FOR*CREDIT*CCY*************   159283
     C*****************************************************************   159283
     C***********WCCDP     IFEQ *ZERO                                     159283
     C***********          Z-ADD1         WCDIV   40                      159283
     C***********          ELSE                                           159283
     C***********WCCDP     IFEQ 1                                         159283
     C***********          Z-ADD10        WCDIV                           159283
     C***********          ELSE                                           159283
     C***********WCCDP     IFEQ 2                                         159283
     C***********          Z-ADD100       WCDIV                           159283
     C***********          ELSE                                           159283
     C***********          Z-ADD1000      WCDIV                           159283
     C***********          END                                            159283
     C***********          END                                            159283
     C***********          END                                            159283
     C*****************************************************************   159283
     C******CONVERT*CHEQUE*AMOUNT*TO*CREDIT*CURRENCY*******************   159283
     C******(CQAM/WPDIV)*RATE*WCDIV*=*EAMT*****************************   159283
     C*****************************************************************   159283
     C***********          Z-ADD*ZEROS    WEAMT  130                      159283
     C***********          Z-ADD*ZEROS    WDIV    73                      159283
     C*****************************************************************   159283
     C***********WCDIV     DIV  WPDIV     WDIV                            159283
     C*****************************************************************   159283
     C**IF*WDIV*IS*MORE*THAN*1*THEN*ADJUST*CQAM*FOR*THIS*BEFORE********   159283
     C**MULTIPLY/DIVIDE*ADJUSTMENT(TAKES*CARE*OF*ROUNDING*ERROR)*******   159283
     C***********WDIV      IFGT 1                                         159283
     C***********CQAM      MULT WDIV      WEAMT     H                     159283
     C*****************************************************************   159283
     C**ENSURE*THAT*MDIN*IS*TAKEN*ACCOUNT*OF***************************   159283
     C*****************************************************************   159283
     C***********MDIN      IFEQ 0                                         159283
     C***********WEAMT     DIV  RATE      WEAMT     H                     159283
     C***********          ELSE                                           159283
     C***********WEAMT     MULT RATE      WEAMT     H                     159283
     C***********          END                                            159283
     C*****************************************************************   159283
     C***********          ELSE                                           159283
     C*****************************************************************   159283
     C**IF*WDIV*NOT*TO*RAISE*CQAM*VALUE*THEN*ADJUST*FOR*MDIN*FIRST*****   159283
     C*****************************************************************   159283
     C**ENSURE*THAT*MDIN*IS*TAKEN*ACCOUNT*OF***************************   159283
     C*****************************************************************   159283
     C***********MDIN      IFEQ 0                                         159283
     C***********CQAM      DIV  RATE      WEAMT     H                     159283
     C***********          ELSE                                           159283
     C***********CQAM      MULT RATE      WEAMT     H                     159283
     C***********          END                                            159283
     C*****************************************************************   159283
     C***********WEAMT     MULT WDIV      WEAMT     H                     159283
     C*****************************************************************   159283
     C***********          END                                            159283
     C*****************************************************************   159283
     C*****************************************************************   159283
     C***********          Z-ADDWEAMT     EAMT                            159283
      ***********                                                  130995 159283
      ***AVOID*DIVIDE BY ZERO ERROR BY SETTING EAMT TO 1 IF NECESS 130995 159283
      ***********                                                  130995 159283
     C***********EAMT      IFEQ 0                                  130995 159283
     C***********          Z-ADD1         EAMT                     130995 159283
     C***********          END                                     130995 159283
     C***********                                                         159283
     C***********          END                             * END 01 *     159283
     C*
     C* Calculate rate to convert to base ccy
     C*
     C           PBCQ      DIV  EAMT      TBRAT     H      TO BASE RATE
     C*
     C** WRITE NET AMOUNT
     C***********CDRO      IFEQ 0                                                             CSD027
     C           CDRO      IFEQ *BLANKS                                                       CSD027
     C                     SUB  TXCH      EAMT
     C                     SUB  CSTA      EAMT
     C                     SUB  COLL      EAMT
     C                     SUB  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     SUB  CCCHCM    EAMT                            S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     SUB  CCVATT    EAMT                            S01499
     C                     END
      *
      **  Calculate base equivalent of net amount
     C           EAMT      MULT TBRAT     DBCE      H                     E15983
     C*
     C*
     C**   DETERMINE STNI & NOSA
     C*
     C                     MOVELCRPY      WPTY
     C                     MOVE CRPT      WTYPE
     C                     MOVE CRCY      WCCY
     C           CRPT      IFEQ 'P'                                       S01117
     C                     MOVE CRBR      BRCANP                          S01117
     C                     END                                            S01117
     C                     EXSR NOSTRO
     C*
     C**   SET UP THE REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P4'    ETYP
     C                     MOVE CRVD      EDAT
     C                     MOVE CRCY      ECCY
     C                     MOVE WPYTP     PYTP
     C                     MOVE WPYST     PYST
     C                     MOVE WSLDT     OTHD
     C                     MOVE 'O'       INOI
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'D'       PYSR
     C                     MOVE SMCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE CRCY      CCCY
     C                     MOVE CRPT      PRT1T
     C                     MOVELCRPY      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C020
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                    **************
     C** MAKE A CHARGES EVENT
     C***********CDRO      IFNE 0                                                             CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C           TXCH      ADD  CSTA      EAMT
     C                     ADD  COLL      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  CCCHCM    EAMT                            S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  CCVATT    EAMT                            S01499
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDEAMT      DBCE
     C                     MOVELCDRO      WPTY
     C                     MOVE CDRT      WTYPE
     C                     MOVE BCCY      WCCY
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVE CDBR      BRCANP                          S01117
     C                     END                                            S01117
     C                     EXSR NOSTRO
     C                     MOVE BCCY      ECCY
     C                     MOVE SLDT      EDAT
     C                     MOVE '91P3'    ETYP
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE BCCY      CCCY
     C                     MOVE CDRT      PRT1T
     C                     MOVELCDRO      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C* SET UP REMAINING FIELDS                                           S01117
     C*                                                                   S01117
     C                     MOVE 'I'       INOI                            E35088
     C*                                                                   S01117
     C                     EXSR CHGEV                                     S01117
     C*                                                                   S01117
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C                     END
     C*                                                    **************
     C           FINS05    ENDSR                           * FINS05 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** CQPACD SR. TO PROCESS A RECORD FROM CQPACDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           CQPACD    BEGSR
      *                                                                              CER049 AR821872
     C********** CER049    IFEQ 'Y'                                                  CER049 AR821872
     C********** QPKEY     CHAINCQPACQL0             21                              CER049 AR821872
     C********** *IN21     IFEQ *ON                                                  CER049 AR821872
     C**********           MOVEL'FT0610  'DBPGM                                      CER049 AR821872
     C**********           MOVE PREF      DBKEY                                      CER049 AR821872
     C**********           MOVEL'CQPACQL0'DBFILE                                     CER049 AR821872
     C**********           Z-ADD50        DBASE                                      CER049 AR821872
     C**********           EXSR DBERR                                                CER049 AR821872
     C**********           ENDIF                                                     CER049 AR821872
     C**********           ENDIF                                                     CER049 AR821872
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'TOCL'
     C*
     C                     ADD  1         RECA,5
     C*
     C                     MOVE PRRM      ZZAMT
     C                     Z-ADDINTA,5    ZZTOTI
     C                     Z-ADDDECA,5    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,5
     C                     Z-ADDZZTOTD    DECA,5
     C*
     C**   STORE CRITICAL FIELDS FOR USE LATER
     C*
     C                     MOVE PYTP      WPYTP   2
     C                     MOVE PYST      WPYST   2
     C                     MOVE PCCY      WPCCY   3
     C                     MOVE PVDT      WPYDT   50
     C**
     C***  BYPASS PROCESSING IF RECI <> 'D' OR PYDT <= ECDAT OR
     C**   TOTR = ZERO  OR AUTG IND IS BLANK
     C**
     C           RECI      IFNE 'D'
     C           PVDT      ORLE ECDAT
     C           PRRM      OREQ *ZEROS
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS06
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCP3                                           S01408
     C*                                                                   S01408
     C*
     C**      DETERMINE THE SETTLE THROUGH NOSTRO INDICATOR AND THE NOSTRO
     C**      NUMBER
     C*
     C***********SNCO      IFNE *ZEROS                                                        CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSNCO      WPTY
     C                     MOVE SNCT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     ELSE
     C                     MOVELRBK1      WPTY
     C                     MOVE RBKT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     END
     C*
     C                     EXSR NOSTRO
     C*
     C**   SET UP THE REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P5'    ETYP
     C                     MOVE PVDT      EDAT
     C                     Z-ADDPRRM      EAMT
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDPBCQ      DBCE
     C                     MOVE PCCY      ECCY
     C                     MOVE 'O'       INOI
     C                     Z-ADD*ZEROS    OTHD
     C*********************Z-ADD*ZEROS    RATE                            034118
     C                     Z-ADD1         RATE                            034118
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'C'       PYSR
     C                     MOVE *BLANK    OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE PCCY      CCCY
     C                     MOVE SNCT      PRT1T
     C                     MOVELSNCO      PRT1
     C/COPY WNCPYSRC,FT0610C035
     C                     MOVE RBKT      PRT2T
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELRBK1      PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
      **********                                                                     CER049 AR821872
     C********** CER049    IFEQ 'Y'                                                  CER049 AR821872
     C**********           EXSR SRSTAX                                               CER049 AR821872
     C**********           ENDIF                                                     CER049 AR821872
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
     C*                                                    **************
     C           FINS06    ENDSR                           * FINS06 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** CQPADD SR. TO PROCESS A RECORD FROM CQPADDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           CQPADD    BEGSR
      *                                                                                     AR821872
     C           CER049    IFEQ 'Y'                                                         AR821872
     C           QPKEY     CHAINCQPACQL0             21                                     AR821872
     C           *IN21     IFEQ *ON                                                         AR821872
     C                     MOVEL'FT0610  'DBPGM                                             AR821872
     C                     MOVE PREF      DBKEY                                             AR821872
     C                     MOVEL'CQPACQL0'DBFILE                                            AR821872
     C                     Z-ADD50        DBASE                                             AR821872
     C                     EXSR DBERR                                                       AR821872
     C                     ENDIF                                                            AR821872
     C                     ENDIF                                                            AR821872
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'CQAM'
     C*
     C                     ADD  1         RECA,6
     C*
     C                     MOVE CQAM      ZZAMT
     C                     Z-ADDINTA,6    ZZTOTI
     C                     Z-ADDDECA,6    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,6
     C                     Z-ADDZZTOTD    DECA,6
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR DRVD <= ECDAT OR
     C**   CQAM = ZERO
     C*
     C           RECI      IFNE 'D'
     C           DRVD      ORLE ECDAT
     C           CQAM      OREQ *ZEROS
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS07
     C                     END
     C*
     C**   IF DRCY = WPCCY (SAVED FROM CQPACD SR.) SET EVENT AMNT TO
     C**   CHEQUE AMNT
     C*
     C           DRCY      IFEQ WPCCY
     C                     Z-ADDCQAM      EAMT
     C                     END
     C*
     C**   IF DRCY <> WPCCY (SAVED FROM CQPACD SR.) :
     C*
     C           DRCY      IFNE WPCCY                      * BEG 01 *
     C*
     C**   DETERMINE PAY CCY D.P. (WPCCY) FROM ARRAYS SET UP
     C*
     C**********           MOVE WPCCY     SCCY                            159283
     C                     MOVE WPCCY     SCCY    3                       159283
     C                     EXSR SRCCY
     C*
     C                     Z-ADDCDPA,Z    WRCDP   10
     C*
     C**   DETERMINE DEBIT CURRENCY D.P. FROM ARRAYS SET UP
     C*
     C                     MOVE DRCY      SCCY
     C                     EXSR SRCCY
     C*
     C                     Z-ADDCDPA,Z    WDCDP   10
     C*
     C**   SET UP DIVISOR DEPENDING ON D.P. FOR PAY CCY
     C*
     C           WRCDP     IFEQ *ZERO
     C                     Z-ADD1         WRDIV   40
     C                     ELSE
     C           WRCDP     IFEQ 1
     C                     Z-ADD10        WRDIV
     C                     ELSE
     C           WRCDP     IFEQ 2
     C                     Z-ADD100       WRDIV
     C                     ELSE
     C                     Z-ADD1000      WRDIV
     C                     END
     C                     END
     C                     END
     C*
     C**   SET UP DIVISOR DEPENDING ON D.P. FOR DEBIT CCY
     C*
     C           WDCDP     IFEQ *ZERO
     C                     Z-ADD1         WDDIV   40
     C                     ELSE
     C           WDCDP     IFEQ 1
     C                     Z-ADD10        WDDIV
     C                     ELSE
     C           WDCDP     IFEQ 2
     C                     Z-ADD100       WDDIV
     C                     ELSE
     C                     Z-ADD1000      WDDIV
     C                     END
     C                     END
     C                     END
     C*
     C**    CONVERT CHEQUE AMOUNT TO DEBIT CURRENCY
     C**    (WDDIV/WRDIV)*CQAM*RATE = EAMT
     C*
     C                     Z-ADD*ZEROS    WEAMT  130
     C**********           Z-ADD*ZEROS    WDIV                            159283
     C                     Z-ADD*ZEROS    WDIV    73                      159283
     C*
     C           WDDIV     DIV  WRDIV     WDIV
     C           WEAMT     MULT WDIV      WEAMT     H
     C*
     C* IF WDIV IS MORE THAN 1 THEN ADJUST CQAM FOR THIS BEFORE
     C* MULTIPLY/DIVIDE ADJUSTMENT(TAKES CARE OF ROUNDING ERROR)
     C*
     C           WDIV      IFGT 1
     C           CQAM      MULT WDIV      WEAMT     H
     C*
     C* ENSURE THAT MDIN IS TAKEN ACCOUNT OF
     C*
     C           MDIN      IFEQ 0
     C           WEAMT     DIV  RATE      WEAMT     H
     C                     ELSE
     C           WEAMT     MULT RATE      WEAMT     H
     C                     END
     C*
     C                     ELSE
     C*
     C* IF WDIV NOT TO RAISE CQAM VALUE THEN ADJUST FOR MDIN FIRST
     C*
     C* ENSURE THAT MDIN IS TAKEN ACCOUNT OF
     C*
     C           MDIN      IFEQ 0
     C           CQAM      DIV  RATE      WEAMT     H
     C                     ELSE
     C           CQAM      MULT RATE      WEAMT     H
     C                     END
     C*
     C           WEAMT     MULT WDIV      WEAMT     H
     C*
     C                     END
     C*
     C                     Z-ADDWEAMT     EAMT
     C*
      *                                                                   130995
      ** Avoid Divide by zero error by setting EAMT to 1 if necessary.    130995
      *                                                                   130995
     C           EAMT      IFEQ 0                                         130995
     C                     Z-ADD1         EAMT                            130995
     C                     END                                            130995
     C*
     C                     END                             * END 01 *
     C* Calculate rate to convert to base ccy
     C*
     C           SBCQ      DIV  EAMT      TBRAT     H      TO BASE RATE
     C*
     C** WRITE NET AMOUNT
     C***********CDRO      IFEQ 0                                                             CSD027
     C           CDRO      IFEQ *BLANKS                                                       CSD027
     C*  For Cheques to be Paid, charges are added.                       027286
     C***********          SUB  CSTA      EAMT                            027286
     C***********          SUB  COLL      EAMT                            027286
     C***********          SUB  TRCM      EAMT                            027286
     C                     ADD  CSTA      EAMT                            027286
     C                     ADD  COLL      EAMT                            027286
     C                     ADD  TRCM      EAMT                            027286
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  PDCHCM    EAMT                            S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  PDVATT    EAMT                            S01499
     C                     END
      *
      **  Calculate base equivalent of net amount
     C           EAMT      MULT TBRAT     DBCE      H
     C*
     C**   DETERMINE STNI & NOSA
     C*
     C                     MOVELDRPY      WPTY
     C                     MOVE DRPT      WTYPE
     C                     MOVE DRCY      WCCY
     C           DRPT      IFEQ 'P'                                       S01117
     C                     MOVE DRBR      BRCANP                          S01117
     C                     END                                            S01117
     C                     EXSR NOSTRO
     C*
     C**   SET UP THE REMAINING FIELDS FOR FPVNTDD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P6'    ETYP
     C                     MOVE DRVD      EDAT
     C                     MOVE DRCY      ECCY
     C                     MOVE WPYTP     PYTP
     C                     MOVE WPYST     PYST
     C                     MOVE WPYDT     OTHD
     C                     MOVE 'I'       INOI
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE 'D'       PYSR
     C                     MOVE PCCY      OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE DRCY      CCCY
     C                     MOVE DRPT      PRT1T
     C                     MOVELDRPY      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C021
      *                                                                                     AR821872
     C           CER049    IFEQ 'Y'                                                         AR821872
     C                     EXSR SRSTAX                                                      AR821872
     C                     ENDIF                                                            AR821872
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C** MAKE A CHARGES EVENT                                             E
     C***********CDRO      IFNE 0                                                             CSD027
     C           CDRO      IFNE *BLANKS                                                       CSD027
     C           COLL      ADD  CSTA      EAMT
     C                     ADD  TRCM      EAMT
     C*                                                                   S01494
     C** Add FX/Change Commission                                         S01494
     C*                                                                   S01494
     C                     ADD  PDCHCM    EAMT                            S01494
     C*                                                                   S01499
     C** Add V.A.T.                                                       S01499
     C*                                                                   S01499
     C                     ADD  PDVATT    EAMT                            S01499
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDEAMT      DBCE
     C                     MOVELCDRO      WPTY
     C                     MOVE CDRT      WTYPE
     C                     MOVE BCCY      WCCY
     C           CDRT      IFEQ 'P'                                       S01117
     C                     MOVE CDBR      BRCANP                          S01117
     C                     END                                            S01117
     C                     EXSR NOSTRO
     C                     MOVE BCCY      ECCY
     C                     MOVE PVDT      EDAT
     C                     MOVE '91P5'    ETYP
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE BCCY      CCCY
     C                     MOVE CDRT      PRT1T
     C                     MOVELCDRO      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C*                                                                   S01117
     C* SET UP REMAINING FIELDS                                           S01117
     C*                                                                   S01117
     C                     EXSR CHGEV                                     S01117
     C*                                                                   S01117
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C                     END
     C*                                                    **************
     C           FINS07    ENDSR                           * FINS07 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** NTRAND SR. TO PROCESS A RECORD FROM NTRANDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           NTRAND    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C*
     C**   KEEP TOTAL OF RECORDS READ AND A HASH TOTAL OF 'AMNT'
     C*
     C                     ADD  1         RECA,7
     C*
     C                     MOVE AMNT      ZZAMT
     C                     Z-ADDINTA,7    ZZTOTI
     C                     Z-ADDDECA,7    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,7
     C                     Z-ADDZZTOTD    DECA,7
     C*
     C**   BYPASS PROCESSING IF RECI <> 'D' OR VDAT <= ECDAT OR
     C**   AMNT = ZERO  OR AUTH IND IS BLANK
     C*
     C           RECI      IFNE 'D'
     C           VDAT      ORLE ECDAT
     C           AMNT      OREQ *ZEROS
     C           AUIN      OREQ *BLANK
     C                     GOTO FINS08
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCP4                                           S01408
     C*                                                                   S01408
     C*
     C**   SET UP THE 'INCOMING' FIELDS FOR FPVNTDD
     C*
     C                     MOVE TFRF      PREF
     C                     MOVE 'D'       RECI
     C                     MOVE '91P7'    ETYP
     C                     MOVE VDAT      EDAT
     C                     MOVE AMNT      EAMT
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDSBCQ      DBCE
     C                     MOVE CCY       ECCY
     C                     MOVE *ZEROS    OTHD
     C                     MOVE 'Y'       STNI
     C                     MOVE DEST      NOSA
     C*********************MOVE 'O'       INOI                            E35088
     C*********************MOVE 'I'       INOI                      E35088068094
     C                     MOVEL'O'       INOI                            068094
     C                     Z-ADD*ZEROS    RATE
     C*
     C* FIELDS USED FOR OLPOS UPDATE
     C                     MOVE ' '       PYSR
     C                     MOVE *BLANK    OTCY
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE CCY       CCCY
     C                     MOVE 'N'       PRT1T
     C                     MOVELDEST      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*
     C*
     C**   SET UP THE 'OUTGOING' FIELDS FOR FPVNTDD
     C*
     C                     MOVE ACBN      NOSA
     C*********************MOVE 'I'       INOI                            E35088
     C*********************MOVEL'O'       INOI                      E35088068094
     C                     MOVEL'I'       INOI                            068094
     C*
     C* FIND CNUM FOR OUTPUT
     C*
     C                     MOVE CCY       CCCY
     C                     MOVE 'N'       PRT1T
     C                     MOVELACBN      PRT1
     C                     MOVE *BLANK    PRT2T
     C                     MOVEL*BLANK    PRT2
     C                     EXSR CLIENT
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     EXSR RECWRT
     C*                                                    **************
     C           FINS08    ENDSR                           * FINS08 TAG *
     C*                                                    **************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** NOSTRO SR. TO SET THE 'SETTLE THROUGH NOSTRO IND.' AND 'NOSTRO -
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C** NUMBER' FIELDS.
     C*  ~~~~~~~~~~~~~~
     C*  PARAMETERS : WPTY & WTYPE
4934 C*
     C           NOSTRO    BEGSR
     C*
     C           WTYPE     IFEQ 'N'                                       S01195
     C           WTYPE     OREQ 'F'                                       S01195
     C*                                                                   S01195
     C           WTYPE     IFEQ 'N'
     C                     MOVE 'Y'       STNI
     C                     MOVELWPTY      NOSA
     C                     MOVELNOSA      TNOS                            S01195
     C                     MOVE NOSA      WFLD05                          S01195
     C                     MOVELWCCY      WFLD05                          S01195
     C                     MOVELWCCY      TCCY                            S01195
     C                     END
     C*
     C           WTYPE     IFEQ 'F'
     C                     MOVE 'Y'       STNI
     C                     MOVELWPTY      WFLD05  5
     C                     MOVE WFLD05    NOSA
     C                     MOVELWFLD05    TCCY                            S01195
     C                     MOVE WFLD05    TNOS                            S01195
     C                     END
     C*                                                                   S01195
     C* CHAIN TO TABLETL TO ACCESS CUSTOMER SHORTNAME CSNM                S01195
     C*                                                                   S01195
     C           TKEY      CHAINTABLETLL             20                   S01195
     C*                                                                   S01195
     C           *IN20     IFEQ '0'                                       S01195
     C           RECI      COMP 'D'                  2020                 S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           *IN20     IFEQ '1'                                       S01195
     C           *LOCK     IN   DLDA                                      S01195
     C                     MOVEL'FT0610  'DBPGM                           S01195
     C                     MOVELWFLD05    DBKEY            ***************S01195
     C                     MOVEL'TABLETL' DBFILE           * DB ERROR 09 *S01195
     C                     Z-ADD9         DBASE            ***************S01195
     C                     OUT  DLDA                                      S01195
     C                     EXSR DBERR                                     S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* SET UP THE NOSTRO LOCATION CODE FROM THE LAST 3 CHARACTERS OF     S01195
     C* THE CUSTOMER SHORTNAME                                            S01195
     C*                                                                   S01195
     C                     MOVE CSNM      NLOC    3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*
     C* IF RETAIL NUMBER READ ACNUMA TO GET ACCOUNT DETAILS
     C           WTYPE     IFEQ 'R'
     C                     Z-ADDACNON     ACNO
     C           ACNO      CHAINACNUMA               88
     C  N88      RECI      COMP 'D'                  8888
     C   88                DO
     C**         *LOCK     IN   DLDA                                      106357
     C**                   MOVE 'FT0610  'DBPGM                           106357
     C**                   MOVE *BLANK    DBKEY                           106357
     C*********************MOVE 'ACNUM'   DBFILE           ********S01194*106357
     C*********************MOVEL'ACNUMA  'DBFILE           ********S01194*106357
     C**                   MOVE '32'      DBASE            * DB ERROR 32 *106357
     C**                   MOVELACNO      DBKEY            ***************106357
     C**                   OUT  DLDA                                      106357
     C**                   EXSR DBERR                                     106357
     C                     EXSR ACNERR                                    106357
     C                     END
     C                     MOVE CNUM      KCUST                           172901
     C                     MOVE CCY       ECCY                            172901
     C                     MOVE ACOD      KACCD                           172901
     C                     Z-ADDACSQ      KACSN                           172901
     C                     MOVE BRCH      KBRCH                           172901
     C                     END
     C* IF PARTIAL ACCOUNT FORMAT ACCOUNT NUMBER
     C           WTYPE     IFEQ 'P'
     C**********           Z-ADDCNUMN     CNUM                                                CSD027
     C                     MOVE CNUMN     CNUM                                                CSD027
     C                     MOVE WCCY      CCY
     C                     Z-ADDACODNP    ACOD
     C                     Z-ADDACSQNP    ACSQ
     C                     MOVE BRCANP    BRCH                            S01117
     C                     MOVE CNUMN     KCUST                           172901
     C                     MOVE WCCY      ECCY                            172901
     C                     MOVE ACODNP    KACCD                           172901
     C                     Z-ADDACSQNP    KACSN                           172901
     C                     MOVE BRCANP    KBRCH                           172901
     C                     END
     C* IF FULL ACCOUNT FORMAT ACCOUNT NUMBER
     C           WTYPE     IFEQ 'G'
     C**********           Z-ADDCNUMN     CNUM                                                CSD027
     C                     MOVE CNUMN     CNUM                                                CSD027
     C                     MOVE CCYN      CCY
     C                     Z-ADDACODN     ACOD
     C                     Z-ADDACSQN     ACSQ
     C                     MOVE BRCAN     BRCH                            S01117
     C                     MOVE CNUMN     KCUST                           172901
     C                     MOVE CCYN      ECCY                            172901
     C                     MOVE ACODN     KACCD                           172901
     C                     Z-ADDACSQN     KACSN                           172901
     C                     MOVE BRCAN     KBRCH                           172901
     C                     END
      *                                                                   CFT014
      ** Determine account of IBAN.                                       CFT014
      *                                                                   CFT014
     C           CFT004    IFEQ 'Y'                                       CFT014
     C           WTYPE     ANDEQ'I'                                       CFT014
     C                     MOVE WPTY2     P@IBN                           CFT014
      *                                                                   CFT014
     C                     MOVE *BLANKS   DSSDY                           CFT014
     C                     CALL 'AOIBANR4'                                CFT014
     C                     PARM           @RTCD                           CFT014
     C                     PARM '*KEY   ' @OPTN                           CFT014
     C                     PARM           P@IBN                           CFT014
     C           P@ACCN    PARM           DSSDY                           CFT014
      *                                                                   CFT014
     C           @RTCD     IFNE *BLANKS                                   CFT014
     C           *LOCK     IN   DLDA                                      CFT014
     C                     Z-ADD044       DBASE                           CFT014
     C                     MOVELP@IBN     DBKEY                           CFT014
     C                     MOVEL'ACCNTL6 'DBFILE                          CFT014
     C                     MOVEL'FT0610  'DBPGM                           CFT014
     C                     OUT  DLDA                                      CFT014
     C                     EXSR DBERR                                     CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVELBRCI      BRCH                            CFT014
      *                                                                   CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C* READ TABLETL TO SEE IF A NOSTRO
     C           WTYPE     IFEQ 'R'
     C           WTYPE     OREQ 'P'
     C           WTYPE     OREQ 'G'
     C           WTYPE     OREQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C***********AKEY      CHAINFPRTNF               88                   172901
     C           NOKEY     CHAINSDNOSTL4             88                   172901
     C**N88******RECI      COMP 'D'                  8888                 172901
     C  N88      A7TYLC    COMP 'D'                      88               172901
     C           *IN88     IFEQ '0'
     C                     MOVE 'Y'       STNI
     C***********          MOVE NOSN      NOSA                            172901
     C                     MOVE A7NONB    NOSA                            172901
     C*                                                                   S01195
     C* SET UP THE NOSTRO LOCATION CODE FROM THE LAST 3 CHARACTERS OF     S01195
     C* THE CUSTOMER SHORTNAME                                            S01195
     C*                                                                   S01195
     C***********          MOVE CSNM      NLOC                     S01195 172901
     C                     MOVE A7NOSN    NLOC                            172901
     C*                                                                   S01195
     C                     ELSE
     C                     MOVE 'N'       STNI
     C                     MOVE '00'      NOSA
     C                     END
     C                     END
     C*
     C           WTYPE     IFNE 'N'
     C           WTYPE     ANDNE'F'
     C           WTYPE     ANDNE'R'
     C           WTYPE     ANDNE'P'
     C           WTYPE     ANDNE'G'
     C           WTYPE     ANDNE'I'                                       CFT014
     C           WTYPE     OREQ 'I'                                       CFT014
     C           CFT004    ANDNE'Y'                                       CFT014
     C                     MOVE 'N'       STNI
     C                     MOVE '00'      NOSA
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C** MAINEV SR.TO SET UP REMAINING FIELDS ON THE EVENTS FILE FPVNTDD  S01117
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  S01117
     C*                                                                   S01117
     C           MAINEV    BEGSR                                          S01117
     C*                                                                   S01117
     C* SET EVENT BRANCH, INTERBRANCH AND INTERCOMPANY EVENT FLAGS        S01117
     C*                                                                   S01117
     C                     MOVE BRCA      EBRC                            S01117
     C                     MOVE 'N'       IBRE                            S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C*                                                                   S01117
     C* SET COMPANY OF BOOKING BRANCH AND COMPANY OF EVENT BRANCH         S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCA      LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      COBB                            S01117
     C                     MOVE CO,X      ECPY                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELBRCA      DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 10 *S01194
     C                     Z-ADD10        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* SET COMPANY OF ORIGINATING BRANCH                                 S01117
     C*                                                                   S01117
     C           BRCA      IFNE ORBR                                      S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           ORBR      LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      COOB                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELORBR      DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 11 *S01194
     C                     Z-ADD11        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     MOVE COBB      COOB                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* SET OUR SETTLEMENT BRANCH                                         S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     MOVE BRCPTY    OSBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      OSBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C           ACNERR    BEGSR                                          106357
     C           *IN27     IFEQ '0'                        B001           106357
     C                     SETON                         27               106357
     C                     OPEN FT0610P2                                  106357
     C                     WRITEHEDERR                                    106357
     C                     Z-ADD1         P2PAGE                          106357
     C                     MOVE TITL      P2TITL                          106357
     C                     MOVE RUNA      P2DATE                          106357
     C                     MOVE BRCA      @DSNB                           106357
     C                     EXSR AOBRCH                                    106357
     C           @RTCD     IFEQ *BLANKS                    B002           106357
     C**********           MOVE A8BICN    BICN    60                                   106357 CSD027
     C                     MOVE A8BICN    BICN    6                                           CSD027
     C                     END                             E002           106357
     C                     END                             E001           106357
     C**********           Z-ADDBICN      CNUM                                         106357 CSD027
     C                     MOVE BICN      CNUM                                                CSD027
     C                     MOVE WCCY      CCY                             106357
     C                     Z-ADDFTCD2     ACOD                            106357
     C                     Z-ADD1         ACSQ                            106357
     C                     MOVELPREF      P2PREF                          106357
     C                     MOVELACNO      P2ACNO                          106357
     C                     MOVELCNUM      P2CNUM                          106357
     C                     MOVELACOD      P2ACOD                          106357
     C                     MOVELCCY       P2CCY                           106357
     C                     MOVELACSQ      P2ACSQ                          106357
     C           *IN26     IFEQ '1'                        B001           106357
     C                     SETOF                     26                   106357
     C                     ADD  1         P2PAGE                          106357
     C                     WRITEHEDERR                                    106357
     C                     END                             E001           106357
     C                     WRITEDETERR                                    106357
     C                     ENDSR                                          106357
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C** NEWEV1 SR. TO GENERATE NEW SETTLE AND PAY EVENTS TYPE A          S01117
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          S01117
     C*                                                                   S01117
     C           NEWEV1    BEGSR                                          S01117
     C*                                                                   S01117
     C* SETTLE EVENT A                                                    S01117
     C* ~~~~~~~~~~~~~~                                                    S01117
     C* SET EVENT BRANCH, INPUT/OUTPUT INDICATOR AND INTERBRANCH          S01117
     C* EVENT FLAG                                                        S01117
     C                     MOVE BRCPTY    EBRC                            S01117
     C                     MOVE 'I'       INOI                            S01117
     C                     MOVE 'Y'       IBRE                            S01117
     C*                                                                   S01117
     C* SET COMPANY OF EVENT BRANCH                                       S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCPTY    LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      ECPY                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELBRCPTY    DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 12 *S01194
     C                     Z-ADD12        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* SET INTERCOMPANY EVENT FLAG                                       S01117
     C*                                                                   S01117
     C           ECPY      IFEQ COBB                                      S01117
     C                     MOVE 'N'       ICYE                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WRITE A RECORD TO FPVNTDD                                         S01117
     C*                                                                   S01117
     C                     EXSR RECWRT                                    S01117
     C*                                                                   S01117
     C* PAY EVENT A                                                       S01117
     C* ~~~~~~~~~~~                                                       S01117
     C* SET INPUT/OUTPUT INDICATOR                                        S01117
     C*                                                                   S01117
     C                     MOVE 'O'       INOI                            S01117
     C*                                                                   S01117
     C* SET BRANCH INTERNAL CUSTOMER NUMBER OF THE BOOKING BRANCH         S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCA      LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE IC,X      CUNR                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELBRCA      DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 13 *S01194
     C                     Z-ADD13        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* WRITE A RECORD TO FPVNTDD                                         S01117
     C*                                                                   S01117
     C                     EXSR RECWRT                                    S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C** NEWEV2 SR. TO GENERATE NEW SETTLE AND PAY EVENTS TYPE B          S01117
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          S01117
     C*                                                                   S01117
     C           NEWEV2    BEGSR                                          S01117
     C*                                                                   S01117
     C* PAY EVENT B                                                       S01117
     C* ~~~~~~~~~~~                                                       S01117
     C* SET EVENT BRANCH, INPUT/OUTPUT INDICATOR AND INTERBRANCH          S01117
     C* EVENT FLAG                                                        S01117
     C                     MOVE BRCPTY    EBRC                            S01117
     C                     MOVE 'O'       INOI                            S01117
     C                     MOVE 'Y'       IBRE                            S01117
     C*                                                                   S01117
     C* SET COMPANY OF EVENT BRANCH                                       S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCPTY    LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      ECPY                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELBRCPTY    DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 14 *S01194
     C                     Z-ADD14        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* SET INTERCOMPANY EVENT FLAG                                       S01117
     C*                                                                   S01117
     C           ECPY      IFEQ COBB                                      S01117
     C                     MOVE 'N'       ICYE                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* WRITE A RECORD TO FPVNTDD                                         S01117
     C*                                                                   S01117
     C                     EXSR RECWRT                                    S01117
     C*                                                                   S01117
     C* SETTLE EVENT B                                                    S01117
     C* ~~~~~~~~~~~~~~                                                    S01117
     C* SET INPUT/OUTPUT INDICATOR                                        S01117
     C*                                                                   S01117
     C                     MOVE 'I'       INOI                            S01117
     C*                                                                   S01117
     C* SET BRANCH INTERNAL CUSTOMER NUMBER OF THE BOOKING BRANCH         S01117
     C*                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCA      LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE IC,X      CUNR                            S01117
     C                     ELSE                                           S01117
     C           *LOCK     IN   DLDA                                      S01194
     C                     MOVEL'FT0610  'DBPGM                           S01194
     C                     MOVELBRCA      DBKEY            ***************S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 15 *S01194
     C                     Z-ADD15        DBASE            ***************S01194
     C                     OUT  DLDA                                      S01194
     C                     EXSR DBERR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C* WRITE A RECORD TO FPVNTDD                                         S01117
     C*                                                                   S01117
     C                     EXSR RECWRT                                    S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C** CHGEV SR. TO SETUP REMAINING FIELDS FOR CHARGES EVENT            S01117
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~            S01117
     C*                                                                   S01117
     C           CHGEV     BEGSR                                          S01117
     C*                                                                   S01117
     C                     MOVE BRCA      EBRC                            S01117
     C                     MOVE 'N'       IBRE                            S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C                     MOVE COBB      ECPY                            S01117
     C                     MOVE 'I'       INOI                            S01117
     C*                                                                   S01117
     C* SET OUR SETTLEMENT BRANCH                                         S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCPTY                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCPTY                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     MOVE BRCPTY    OSBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      OSBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************
     C*
     C** RECWRT SR. TO WRITE A RECORD TO FPVNTDD
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
4934 C*
     C           RECWRT    BEGSR
     C*
     C* ENSURE RECI = 'D' FOR WRITE IN FPVNTDD                            106357
     C                     MOVE 'D'       RECI                            106357
     C*                                                                   106357
     C* IF AMOUNT NEGATIVE CHANGE I/O IND AND MAKE AMOUNT POSITIVE
     C*
     C           EAMT      IFLT 0                          B001
     C                     Z-SUBEAMT      EAMT
     C***********INOI******IFLT 'O'                        B002           E23905
     C           INOI      IFEQ 'O'                        B002           E23905
     C                     MOVE 'I'       INOI
     C                     ELSE                            X002
     C                     MOVE 'O'       INOI
     C                     END                             E002
     C                     END                             E001
      *                                                                   CEU011
      ** Get corresponding 'In' ccy Sort Sequnce no                       CEU011
      ** from PF/SDCURRPD.                                                CEU011
      *                                                                   CEU011
     C********** CEU011    IFEQ 'Y'                                                    CEU011 177552
     C                     Z-ADD1         S                               CEU011
     C           ECCY      LOKUPCUR,S                    41               CEU011
     C           *IN41     IFEQ *ON                                       CEU011
     C                     MOVE SRT,S     ECSS                            CEU011
     C                     ELSE                                           CEU011
     C           *LOCK     IN   DLDA                                      CEU011
     C                     MOVEL'FT0610  'DBPGM                           CEU011
     C                     MOVELECCY      DBKEY            ************   CEU011
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 17 *   CEU011
     C                     Z-ADD17        DBASE            ************   CEU011
     C                     OUT  DLDA                                      CEU011
     C                     EXSR DBERR                                     CEU011
     C                     ENDIF                                          CEU011
     C**********           ENDIF                                                       CEU011 177552
     C*
     C**   WRITE A RECORD TO FPVNTDD
     C*
     C                     WRITEFPVNTDDF               21  * WRITE FAIL *
     C*
     C           *IN21     IFEQ '1'
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVEL'WRITE '  KEY10  10        ***************
     C                     MOVE 'FAIL'    KEY10            * DB ERROR 04 *
     C                     MOVELKEY10     DBKEY            ***************
     C*********************MOVE 'FPVNT'   DBFILE                          S01194
     C                     MOVEL'FPVNTDD 'DBFILE                          S01194
     C                     MOVE '04'      DBASE
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C**   KEEP TOTAL OF RECORDS WRITTEN AND A HASH TOTAL OF THE EVENT
     C**   AMOUNTS
     C*
     C                     ADD  1         RECA,8
     C*
     C                     MOVE EAMT      ZZAMT
     C                     Z-ADDINTA,8    ZZTOTI
     C                     Z-ADDDECA,8    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,8
     C                     Z-ADDZZTOTD    DECA,8
     C*
     C**   ALSO KEEP TOTAL OF RECORDS WRITTEN EXCLUDING REGULAR
     C**   PAYMENT AMOUNTS.
     C*
     C           PYTP      IFNE 'RP'
     C                     MOVE EAMT      ZZAMT
     C                     Z-ADDINTA,9    ZZTOTI
     C                     Z-ADDDECA,9    ZZTOTD
     C*
     C                     EXSR GLZADD
     C*
     C                     Z-ADDZZTOTI    INTA,9
     C                     Z-ADDZZTOTD    DECA,9
     C                     END
     C*
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**   SRREG1 SR. TO GENERATE THE 1ST SET OF EVENTS
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           SRREG1    BEGSR
     C*
     C**   SETON AN INDICATOR TO NOTE THAT THIS PROCESS HAS BEEN PERFORMED
     C*
     C                     SETON                     24
     C/COPY WNCPYSRC,FT0610C010
     C*
     C**   DETERMINE SETTLE CURRENCY DETAILS FROM ARRAYS SET UP
     C*
     C                     MOVE SMCY      SCCY
     C                     EXSR SRCCY
     C*
     C                     MOVE SMCY      WSMCY   3
     C                     Z-ADDCDPA,Z    WPCDP   10
     C                     Z-ADDSPTA,Z    WPSPOT 138
     C                     Z-ADDMDA,Z     WPMDIN  10
     C/COPY WNCPYSRC,FT0610C011
     C                     Z-ADDBSRA,Z    WPBSPR 138
     C                     MOVE BSSA,Z    WPBSSG  1
     C                     Z-ADDSSRA,Z    WPSSPR 138
     C                     MOVE SSSA,Z    WPSSSG  1
     C/COPY WNCPYSRC,FT0610C012
     C**CHANGE*SPOT RATE BY BUY SPREAD                                    053989
     C***********BSSG      IFEQ '+'                        B001           053989
     C***********SPOT      ADD  BSPR      PBRAT  138                      053989
     C***********          ELSE                            X001           053989
     C***********SPOT      SUB  BSPR      PBRAT                           053989
     C***********          END                             E001           053989
     C**CHANGE*SPOT RATE BY SELL SPREAD                                   053989
     C***********SSSG      IFEQ '+'                        B001           053989
     C***********SPOT      ADD  SSPR      PSRAT  138                      053989
     C***********          ELSE                            X001           053989
     C***********SPOT      SUB  SSPR      PSRAT                           053989
     C***********          END                             E001           053989
     C* CHANGE SPOT RATE BY BUY SPREAD                                    053989
     C           WPBSSG    IFEQ '+'                        B001           053989
     C           WPSPOT    ADD  WPBSPR    PBRAT  138                      053989
     C                     ELSE                            X001           053989
     C           WPSPOT    SUB  WPBSPR    PBRAT                           053989
     C                     END                             E001           053989
     C* CHANGE SPOT RATE BY SELL SPREAD                                   053989
     C           WPSSSG    IFEQ '+'                        B001           053989
     C           WPSPOT    ADD  WPSSPR    PSRAT  138                      053989
     C                     ELSE                            X001           053989
     C           WPSPOT    SUB  WPSSPR    PSRAT                           053989
     C                     END                             E001           053989
     C*
     C**   DETERMINE PAY CURRENCY DETAILS FROM ARRAYS SET UP
     C*
     C                     MOVE PCCY      SCCY
     C                     EXSR SRCCY
     C*
     C                     MOVE PCCY      WRCCY   3
     C                     Z-ADDCDPA,Z    WRCDP   10
     C                     Z-ADDSPTA,Z    WRSPOT 138
     C                     Z-ADDMDA,Z     WRMDIN  10
     C/COPY WNCPYSRC,FT0610C013
     C                     Z-ADDBSRA,Z    WRBSPR 138
     C                     MOVE BSSA,Z    WRBSSG  1
     C                     Z-ADDSSRA,Z    WRSSPR 138
     C                     MOVE SSSA,Z    WRSSSG  1
     C/COPY WNCPYSRC,FT0610C014
     C**CHANGE*SPOT RATE BY SELL SPREAD                                   053989
     C***********SSSG      IFEQ '+'                        B001           053989
     C***********SPOT      ADD  SSPR      RSRAT  138                      053989
     C************         ELSE                            X001           053989
     C***********SPOT      SUB  SSPR      RSRAT                           053989
     C************         END                             E001           053989
     C**CHANGE*SPOT RATE BY BUY SPREAD                                    053989
     C***********BSSG      IFEQ '+'                        B001           053989
     C***********SPOT      ADD  BSPR      RBRAT  138                      053989
     C************         ELSE                            X001           053989
     C***********SPOT      SUB  BSPR      RBRAT                           053989
     C************         END                             E001           053989
     C* CHANGE SPOT RATE BY SELL SPREAD
     C           WRSSSG    IFEQ '+'                        B001           053989
     C           WRSPOT    ADD  WRSSPR    RSRAT  138                      053989
     C                     ELSE                            X001           053989
     C           WRSPOT    SUB  WRSSPR    RSRAT                           053989
     C                     END                             E001           053989
     C* CHANGE SPOT RATE BY BUY SPREAD                                    053989
     C           WRBSSG    IFEQ '+'                        B001           053989
     C           WRSPOT    ADD  WRBSPR    RBRAT  138                      053989
     C                     ELSE                            X001           053989
     C           WRSPOT    SUB  WRBSPR    RBRAT                           053989
     C                     END                             E001           053989
     C*
     C**   SET UP DIVISOR FOR SETTLE AMOUNT DEPENDING ON D.P. FOR SETTLE CCY
     C*
     C           WPCDP     IFEQ *ZERO
     C                     Z-ADD1         WPDIV   40
     C                     ELSE
     C           WPCDP     IFEQ 1
     C                     Z-ADD10        WPDIV
     C                     ELSE
     C           WPCDP     IFEQ 2
     C                     Z-ADD100       WPDIV
     C                     ELSE
     C                     Z-ADD1000      WPDIV
     C                     END
     C                     END
     C                     END
     C*
     C**   SET UP DIV FOR PAY AMNT DEPENDING ON D.P. FOR PAY CCY
     C*
     C           WRCDP     IFEQ *ZERO
     C                     Z-ADD1         WRDIV   40
     C                     ELSE
     C           WRCDP     IFEQ 1
     C                     Z-ADD10        WRDIV
     C                     ELSE
     C           WRCDP     IFEQ 2
     C                     Z-ADD100       WRDIV
     C                     ELSE
     C                     Z-ADD1000      WRDIV
     C                     END
     C                     END
     C                     END
     C* SETUP TO AND FROM RATES
     C           FAIN      IFEQ 'R'                        B001
     C                     MOVE SMCY      TCCY    3
     C                     MOVE PCCY      FCCY    3
     C                     Z-ADDPSRAT     TSRAT  138
     C                     Z-ADDWPMDIN    TMDIN   10
     C                     Z-ADDWPCDP     TCDP    10
     C                     Z-ADDRBRAT     FBRAT  138
     C                     Z-ADDWRMDIN    FMDIN   10
     C                     Z-ADDRSRAT     FSRAT  138
     C                     Z-ADDWRCDP     FCDP    10
     C                     ELSE                            X001
     C                     MOVE SMCY      FCCY
     C                     MOVE PCCY      TCCY
     C                     Z-ADDPBRAT     FBRAT  138
     C                     Z-ADDWPMDIN    FMDIN
     C                     Z-ADDWPCDP     FCDP    10
     C                     Z-ADDPSRAT     FSRAT
     C                     Z-ADDRSRAT     TSRAT  138
     C                     Z-ADDWRMDIN    TMDIN
     C                     Z-ADDWRCDP     TCDP    10
     C                     END                             E001
     C* IF CURRENCIES EQUAL RATE IS 1.0
     C           FCCY      IFEQ TCCY                       B001
     C                     Z-ADD1         DRATE  138
     C                     Z-ADD0         DMDIN   10
     C                     ELSE                            X001
     C**IF FROM*CURRENCY*IS*BASE*RATE*IS*TO*CURRENCY***
     C* IF FROM CURRENCY IS BASE, RATE IS TO CURRENCY
     C           FCCY      IFEQ BCCY                       B002
     C                     Z-ADDTSRAT     DRATE
     C           1         SUB  TMDIN     DMDIN
     C                     ELSE                            X002
     C* IF TO CURRENCY IS BASE, RATE IS FROM CURRENCY
     C           TCCY      IFEQ BCCY                       B003
     C                     Z-ADDFSRAT     DRATE
     C                     Z-ADDFMDIN     DMDIN
     C                     ELSE                            X003
     C* IF NEITHER CURRENCY IS BASE
     C* IF BOTH DIVIDE CURRENCIES
     C           FMDIN     IFEQ 0                          B004
     C           TMDIN     IFEQ 0                          B005
     C* RATE IS TO SELL RATE DIVIDE BY FROM BUY RATE
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     ELSE                            X005
     C           FBRAT     MULT TSRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD1         DMDIN
     C                     END                             E006
     C                     END                             E005
     C                     ELSE                            X004
     C           TMDIN     IFEQ 0                          B005
     C           TSRAT     MULT FBRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     ELSE                            X005
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C           DRATE     IFLT 1                          B006
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C                     END                             E005
     C                     END                             E004
     C           FAIN      IFEQ 'R'                        B004
     C           1         SUB  DMDIN     DMDIN
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C* UNENTERED VALUE CALCULATION
     C*
     C* IF ONE CURRENCY IS BASE
     C           SMCY      IFEQ BCCY                       B001
     C           PCCY      OREQ BCCY
     C           FCDP      SUB  TCDP      N       10
     C                     ADD  4         N
     C           FAIN      IFEQ 'R'                        B002
     C                     Z-ADDPYAM      FAMNT  130
     C                     ELSE                            X002
     C                     Z-ADDSMAM      FAMNT
     C                     END                             E002
     C           DMDIN     IFEQ 0                          B003
     C           DRATE     MULT POWER,N   WK159     H
     C           FAMNT     DIV  WK159     TAMNT  130H
     C                     ELSE                            X003
     C           DRATE     DIV  POWER,N   WK159  159H
     C           FAMNT     MULT WK159     TAMNT  130H
     C                     END                             E003
     C           FAIN      IFEQ 'R'                        B002
     C                     Z-ADDTAMNT     SMAM
     C                     ELSE                            X002
     C                     Z-ADDTAMNT     PYAM
     C                     END                             E002
     C                     ELSE                            X001
     C           FAIN      IFEQ 'R'                        B002
     C           WRCDP     SUB  WPCDP     N       10
     C                     ADD  4         N
     C           DMDIN     IFEQ 0                          B003
     C           DRATE     DIV  POWER,N   WK159  159H
     C           PYAM      MULT WK159     SMAM      H
     C                     ELSE                            X003
     C           DRATE     MULT POWER,N   WK159     H
     C           PYAM      DIV  WK159     SMAM      H
     C                     END                             E003
     C                     ELSE                            X002
     C           WPCDP     SUB  WRCDP     N       10
     C                     ADD  4         N
     C           DMDIN     IFEQ 1                          B003
     C           DRATE     DIV  POWER,N   WK159  159H
     C           SMAM      MULT WK159     PYAM      H
     C                     ELSE                            X003
     C           DRATE     MULT POWER,N   WK159     H
     C           SMAM      DIV  WK159     PYAM      H
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C                     Z-ADDDRATE     RATE
     C                     MOVE DMDIN     MDIN
     C*
     C/COPY WNCPYSRC,FT0610C027
     C**      DETERMINE THE SETTLE THROUGH NOSTRO IND. AND NOSTRO NUMBER
     C*
     C***********ORBK      IFNE *ZEROS                                                        CSD027
     C           ORBK      IFNE *BLANKS                                                       CSD027
     C                     MOVELORBK      WPTY
     C                     MOVE ORBT      WTYPE
     C                     MOVE SMCY      WCCY
     C           ORBT      IFEQ 'P'                                       S01117
     C                     MOVE ORBB      BRCANP                          S01117
     C                     END                                            S01117
     C                     ELSE
     C                     MOVELORC1      WPTY
      *                                                                                       CFT032
      ** Override default move of ORC1 to WPTY (above) if necessary...                        CFT032
      ** Check if slash is the first character.                                               CFT032
      **   1. If yes, and ORCT is 'R' or 'P' remove the slash.                                CFT032
      *    2. If no, and ORCT is 'I' prefix with a slash.                                     CFT032
      *                                                                                       CFT032
     C           1         SUBSTORC1:1    SLS                                                 CFT032
     C           SLS       IFEQ '/'                                                           CFT032
     C           ORCT      IFEQ 'P'                                                           CFT032
     C           ORCT      OREQ 'R'                                                           CFT032
     C                     SUBSTORC1:2    WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ELSE                                                               CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C           '/'       CAT  ORC1      WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     MOVE ORCT      WTYPE
     C                     MOVE SMCY      WCCY
     C                     END
     C/COPY WNCPYSRC,FT0610C036
     C*
     C                     EXSR NOSTRO
     C*
     C                     MOVE STNI      WPSTNI  1
     C                     MOVE NOSA      WPNOSA  20
     C*                                                                   E35097
     C* FIND CNUM FOR OUTPUT                                              E35097
     C*                                                                   E35097
     C                     MOVE SMCY      CCCY                            E35097
     C                     MOVE ORBT      PRT1T                           E35097
     C                     MOVELORBK      PRT1                            E35097
     C/COPY WNCPYSRC,FT0610C037
     C                     MOVE ORCT      PRT2T                           E35097
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELORC1      PRT2                            E35097
      *                                                                                       CFT032
      ** Override default move of ORC1 to PRT2 (above) if necessary...                        CFT032
      ** Check if slash is the first character.                                               CFT032
      **   1. If yes, and ORCT is 'C', 'S' or 'A' use ORC2 instead of ORC1                    CFT032
      *       to move to PRT2                                                                 CFT032
      *    2. If yes, and ORCT is not 'C', 'S', or 'A', start from                            CFT032
      *       2nd character of ORC1 to move to PRT2                                           CFT032
      *    3. If no, and ORCT is 'I' move '/'+ORC1 to WPTY.                                   CFT032
      *                                                                                       CFT032
     C           1         SUBSTORC1:1    SLS                                                 CFT032
     C           SLS       IFEQ '/'                                                           CFT032
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C           ORCT      IFEQ 'C'                                                           CFT032
     C           ORCT      OREQ 'S'                                                           CFT032
     C           ORCT      OREQ 'A'                                                           CFT032
     C                     MOVELORC2      PRT2                                                CFT032
     C                     ELSE                                                               CFT032
     C                     SUBSTORC1:2    PRT2                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ELSE                                                               CFT032
     C           ORCT      IFEQ 'I'                                                           CFT032
     C           '/'       CAT  ORC1      WPTY                                                CFT032
     C                     ENDIF                                                              CFT032
     C                     ENDIF                                                              CFT032
      *                                                                                       CFT032
     C                     EXSR CLIENT                                    E35097
     C**********           MOVE CUNR      CUNR1   60                                   E35097 CSD027
     C                     MOVE CUNR      CUNR1   6                                           CSD027
     C*                                                                   S01117
     C* IF MBIN INDICATOR ON, SAVE THE PARTY BRANCH                       S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCH1   3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCH1                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           WPSTNI    IFEQ 'Y'                                       S01195
     C                     MOVE NLOC      SETLOC  3                       S01195
     C                     END                                            S01195
     C*
     C***********SNCO      IFNE *ZEROS                                                        CSD027
     C           SNCO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSNCO      WPTY
     C                     MOVE SNCT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     ELSE
     C                     MOVELDST1      WPTY
     C                     MOVE DSTT      WTYPE
     C                     MOVE PCCY      WCCY
     C                     END
     C/COPY WNCPYSRC,FT0610C038
     C*
     C                     EXSR NOSTRO
     C*
     C                     MOVE STNI      WRSTNI  1
     C                     MOVE NOSA      WRNOSA  20
     C*                                                                   E35007
     C* FIND CNUM FOR OUTPUT                                              E35097
     C*                                                                   E35097
     C                     MOVE PCCY      CCCY                            E35097
     C                     MOVE SNCT      PRT1T                           E35097
     C                     MOVELSNCO      PRT1                            E35097
     C/COPY WNCPYSRC,FT0610C039
     C                     MOVE DSTT      PRT2T                           E35097
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELDST1      PRT2                            E35097
     C                     EXSR CLIENT                                    E35097
     C**********           MOVE CUNR      CUNR2   60                                   E35097 CSD027
     C                     MOVE CUNR      CUNR2   6                                           CSD027
     C*                                                                   S01117
     C* IF MBIN INDICATOR ON, SAVE THE PARTY BRANCH                       S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE BRCH      BRCH2   3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE BRCA      BRCH2                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           WPSTNI    IFEQ 'Y'                                       S01195
     C                     MOVE NLOC      PAYLOC  3                       S01195
     C                     END                                            S01195
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**   SRNREG SR. TO GENERATE THE SUBSEQUENT SET OF EVENTS
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           SRNREG    BEGSR
     C*
     C**   SETUP THE NEXT PAYMENT DATE
     C*
     C                     MOVE NPDT      ZDAYNO
     C*********************MOVE SMCY      ZCCY                            S01195
     C*                                                                   S01195
     C* IF SETTLE PARTY IS A NOSTRO                                       S01195
     C*                                                                   S01195
     C           WPSTNI    IFEQ 'Y'                                       S01195
     C                     MOVE SETLOC    ZLOC                            S01195
     C                     MOVE SMCY      ZCCY                            S01195
     C                     ELSE                                           S01195
     C                     MOVE SLOC      ZLOC                            S01195
     C                     MOVE LOCY      ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C***********          MOVE PAYF      ZFREQ                           S01435
     C***********          MOVE DYIM      ZMDAY                           S01435
     C                     MOVE PAYF      ZFREQ   1                       S01435
     C                     MOVE DYIM      ZMDAY   20                      S01435
     C*
     C***********          EXSR ZFREQB                                    062394
      *                                                                   062394
      * Call FT0310 to calculate new date                                 062394
      *                                                                   062394
     C                     CALL 'FT0310'               9090               062394
     C                     PARM *BLANKS   ZZERR@  7                       062394
     C                     PARM '*NEWDATE'W0ACT   8                       062394
     C                     PARM ZFREQ     W0FREQ  1                       062394
     C           ZDAYNO    PARM ZDAYNO    W0RDNB  50                      062394
     C                     PARM ZMDAY     W0MDAY  20                      062394
     C                     PARM ZCCY      W0CCY   3                       062394
     C                     PARM ZLOC      W0LOC   3                       062394
      *                                                                   062394
      *  If error on call                                                 062394
      *                                                                   062394
     C           ZZERR@    IFNE *BLANKS                                   062394
     C           *IN90     OREQ '1'                                       062394
     C           *LOCK     IN   DLDA                                      062394
     C************         MOVEL'FT0205'  DBPGM                     062394082484
     C                     MOVEL'FT0610'  DBPGM                           082484
     C                     MOVEL'*CALL'   DBKEY                           062394
     C                     MOVE 'FT0310 ' DBFILE                          062394
     C                     MOVE '801'     DBASE                           062394
     C                     OUT  DLDA                                      062394
     C                     EXSR DBERR                                     062394
     C                     END                                            062394
     C*
     C**   IF THE 'NEW' NEXT PAYMENT DATE IS LESS THAN OR EQUAL TO THE
     C**   'OLD'  NEXT PAYMENT DATE - ERROR
     C*
     C           ZDAYNO    IFLE NPDT
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVEL'NEXT PAY'KEY16  16
     C                     MOVE 'MENT DAT'KEY16            ***************
     C                     MOVEL'E IN ERR'KEY10  10        * DB ERROR 05 *
     C                     MOVE 'OR'      KEY10            ***************
     C                     MOVELKEY16     KEY26  26
     C                     MOVE KEY10     KEY26
     C                     MOVELKEY26     DBKEY
     C*********************MOVE 'OTPAY'   DBFILE                          S01194
     C                     MOVEL'OTPAYDD 'DBFILE                          S01194
     C                     MOVE '05'      DBASE
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C           ZDAYNO    IFGT FDAT
     C                     Z-ADDFDAT      NPDT
     C                     ELSE
     C                     Z-ADDZDAYNO    NPDT
     C                     END
     C*
     C**   IF SRREG1 HAS NOT BEEN PERFORMED FOR THIS REG. PAYMENT :
     C*
     C           *IN24     IFEQ '0'
     C                     EXSR SRREG1
     C                     END
     C*
     C**   SET UP FIELDS FOR FPVNTDD : SETTLE SIDE
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P8'    ETYP
     C                     MOVE NPDT      EDAT
      *                                                                   062394
      * If frequency is + or - find first working day in local            062394
      * currency                                                          062394
      *                                                                   062394
     C           ZFREQ     IFEQ '+'                                       062394
     C                     Z-ADD0         ZNRDYS                          062394
     C                     Z-ADDEDAT      ZDAYNO                          062394
     C                     EXSR ZFWDT                                     062394
     C                     Z-ADDZDYNBR    EDAT                            062394
     C                     END                                            062394
      *                                                                   062394
     C           ZFREQ     IFEQ '-'                                       062394
     C                     Z-ADD1         ZNRDYS                          062394
     C                     Z-ADDEDAT      ZDAYNO                          062394
     C           ZDYNBR    DOULEEDAT                                      062394
     C                     SUB  1         ZDAYNO                          062394
     C                     EXSR ZFWDT                                     062394
     C                     END                                            062394
     C                     Z-ADDZDYNBR    EDAT                            062394
     C                     END                                            062394
      *                                                                   062394
     C                     Z-ADDSMAM      EAMT
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDSBCQ      DBCE
     C                     MOVE SMCY      ECCY
     C                     MOVE 'I'       INOI
     C                     MOVE WPSTNI    STNI
     C                     MOVE WPNOSA    NOSA
     C*
     C**   SET UP OTHER (PAY VALUE) DATE
     C*
     C*********************MOVE PCCY      ZCCY                            S01195
     C*********************MOVE SMCY      LOCY    3                       S01195
     C                     Z-ADDPRBD      ZNRDYS
     C                     Z-ADDNPDT      ZDAYNO
     C*
     C*********************EXSR ZTXDAY                                    S01195
     C*
     C* IF PAY PARTY IS A NOSTRO, USE PAY CURRENCY AND PAY NOSTRO         S01195
     C* LOCATION ELSE USE SYSTEM LOCATION AND LOCAL CURRENCY              S01195
     C*                                                                   S01195
     C           WRSTNI    IFEQ 'Y'                                       S01195
     C                     MOVE PCCY      ZCCY                            S01195
     C                     MOVE PAYLOC    ZLOC                            S01195
     C                     ELSE                                           S01195
     C                     MOVE LOCY      ZCCY                            S01195
     C                     MOVE SLOC      ZLOC                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     EXSR ZFWDT                                     S01195
     C*                                                                   S01195
     C                     Z-ADDZDYNBR    OTHD
     C                     MOVE CUNR1     CUNR                            E35097
     C* FIELDS USED FOR OLPOS UPDATE                                      E35097
     C                     MOVE 'O'       PYSR                            E35097
     C                     MOVE PCCY      OTCY                            E35097
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C                     MOVE BRCH1     BRCPTY                          S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C                     EXSR RECWRT
     C/COPY WNCPYSRC,FT0610C022
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV1                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C**   SET UP FIELDS FOR FPVNTDD : PAY SIDE
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE '91P9'    ETYP
     C*********************MOVE NPDT      EDAT                            E35095
     C                     MOVE OTHD      EDAT                            E35095
     C                     Z-ADDPYAM      EAMT
     C* MOVE BASE CURRENCY EQUIV
     C                     Z-ADDPBCQ      DBCE
     C                     MOVE PCCY      ECCY
     C                     MOVE 'O'       INOI
     C                     MOVE WRSTNI    STNI
     C                     MOVE WRNOSA    NOSA
     C*
     C**   SET UP OTHER (PAY VALUE) DATE
     C*
     C*********************MOVE SMCY      ZCCY                            E35095
     C*********************MOVE PCCY      LOCY                            E35095
     C*********************Z-ADDPRBD      ZNRDYS                          E35095
     C*********************Z-ADDNPDT      ZDAYNO                          E35095
     C*********************                                               E35095
     C*********************EXSR ZTXDAY                                    E35095
     C*********************                                               E35095
     C*********************Z-ADDZDYNBR    OTHD                            E35095
     C                     MOVE NPDT      OTHD                            E35095
     C                     MOVE CUNR2     CUNR                            E35097
     C* FIELDS USED FOR OLPOS UPDATE                                      E35097
     C                     MOVE 'O'       PYSR                            E35097
     C                     MOVE SMCY      OTCY                            E35097
     C* SET UP REMAINING FIELDS FOR FPVNTDD                               S01117
     C*                                                                   S01117
     C                     MOVE BRCH2     BRCPTY                          S01117
     C                     EXSR MAINEV                                    S01117
     C*
     C                     EXSR RECWRT
     C*                                                                   S01117
     C* IF THE PARTY BRANCH NOT EQUAL TO BOOKING BRANCH, GENERATE NEW     S01117
     C* SETTLE AND PAY EVENTS                                             S01117
     C*                                                                   S01117
     C           BRCPTY    IFNE BRCA                                      S01117
     C                     EXSR NEWEV2                                    S01117
     C                     END                                            S01117
      *                                                                   053989
      * Set event generated to Y                                          053989
      *                                                                   053989
     C                     MOVEL'Y'       GEND                            053989
     C*
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**   SRCCY SR. TO ACCESS THE CCY ARRAY TO DETERMINE THE ARRAY INDEX
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C**   FOR OBTAINING THE CCY DETAILS HELD ON ARRAYS
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           SRCCY     BEGSR
     C*
     C                     Z-ADD1         Z
     C                     MOVE '0'       *IN22
     C           SCCY      LOKUPCCYA,Z                   22
     C*
     C           *IN22     IFEQ '0'                        * NOT FOUND *
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVE *BLANKS   KEY
     C                     MOVE '1'       DSREC
     C                     MOVE SCCY      DSCCY
     C                     MOVE '20'      DRECT            ***************
     C                     MOVELKEY       DBKEY            * DB ERROR 06 *
     C*********************MOVE 'TABFP'   DBFILE           ***************S01194
     C                     MOVE 'TABTG10 'DBFILE                          S01194
     C                     MOVE '06'      DBASE
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C** TRAILR SR.TO COMPARE TRAILER TOTALS WITH CALCULATED TOTALS
0882 C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0882 C*
     C           TRAILR    BEGSR
     C*
     C                     MOVE '0'       *IN23
     C           NORE1     IFNE RECA,H
     C           HRWN      ORNE INTA,H
     C           HRDC      ORNE DECA,H
     C                     SETON                     23
     C  NU8                SETON                     U8
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   INPAYZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           INPAYZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD1         H       10
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ01
     C                     Z-ADDHRWN      INTZ01
     C                     Z-ADDHRDC      DECZ01
     C                     Z-ADDRECA,1    RECA01
     C                     Z-ADDINTA,1    INTA01
     C                     Z-ADDDECA,1    DECA01
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF01
     C                     ELSE
     C                     MOVE *BLANKS   DIFF01
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   OTPAYZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           OTPAYZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD2         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ02
     C                     Z-ADDHRWN      INTZ02
     C                     Z-ADDHRDC      DECZ02
     C                     Z-ADDRECA,2    RECA02
     C                     Z-ADDINTA,2    INTA02
     C                     Z-ADDDECA,2    DECA02
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF02
     C                     ELSE
     C                     MOVE *BLANKS   DIFF02
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   CQCODZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           CQCODZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD3         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ03
     C                     Z-ADDHRWN      INTZ03
     C                     Z-ADDHRDC      DECZ03
     C                     Z-ADDRECA,3    RECA03
     C                     Z-ADDINTA,3    INTA03
     C                     Z-ADDDECA,3    DECA03
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF03
     C                     ELSE
     C                     MOVE *BLANKS   DIFF03
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   CQCOCZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           CQCOCZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD4         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ04
     C                     Z-ADDHRWN      INTZ04
     C                     Z-ADDHRDC      DECZ04
     C                     Z-ADDRECA,4    RECA04
     C                     Z-ADDINTA,4    INTA04
     C                     Z-ADDDECA,4    DECA04
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF04
     C                     ELSE
     C                     MOVE *BLANKS   DIFF04
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   CQPACZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           CQPACZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD5         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ05
     C                     Z-ADDHRWN      INTZ05
     C                     Z-ADDHRDC      DECZ05
     C                     Z-ADDRECA,5    RECA05
     C                     Z-ADDINTA,5    INTA05
     C                     Z-ADDDECA,5    DECA05
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF05
     C                     ELSE
     C                     MOVE *BLANKS   DIFF05
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   CQPADZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           CQPADZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD6         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ06
     C                     Z-ADDHRWN      INTZ06
     C                     Z-ADDHRDC      DECZ06
     C                     Z-ADDRECA,6    RECA06
     C                     Z-ADDINTA,6    INTA06
     C                     Z-ADDDECA,6    DECA06
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF06
     C                     ELSE
     C                     MOVE *BLANKS   DIFF06
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
0882 C*
0883 C**   NTRANZ SR. TO SET-UP FIELDS FOR THE 'CONTROL REPORT'
0882 C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0884 C*
     C           NTRANZ    BEGSR
     C*                                                                   S01486
     C**  ZEROISE CHEQUE SEQUENCE                                         S01486
     C*                                                                   S01486
     C                     Z-ADD*ZEROS    CQSQ                            S01486
     C*
     C                     Z-ADD7         H
     C                     EXSR TRAILR
     C*
     C                     Z-ADDNORE1     RECZ07
     C                     Z-ADDHRWN      INTZ07
     C                     Z-ADDHRDC      DECZ07
     C                     Z-ADDRECA,7    RECA07
     C                     Z-ADDINTA,7    INTA07
     C                     Z-ADDDECA,7    DECA07
     C*
     C**   IF TRAILER TOTAL DOES NOT EQUAL CALCULATED TOTAL
     C*
     C           *IN23     IFEQ '1'
     C                     MOVE DIFFXX    DIFF07
     C                     ELSE
     C                     MOVE *BLANKS   DIFF07
     C                     END
     C*
     C                     ENDSR
     C*
4931 C********************************************************************
     C/EJECT
4931 C********************************************************************
     C*                                                                   CFT006
     C** FT101H SR. TO PROCESS A RECORD FROM FT101HPD (and therefore      CFT006
     C** ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      CFT006
     C** many records from FT101DPD)                                      CFT006
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~                                      CFT006
     C*                                                                   CFT006
     C           FT101H    BEGSR                                          CFT006
     C*                                                                   CFT006
     C**  Zeroise cheque sequence                                         CFT006
     C*                                                                   CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C*                                                                   CFT006
     C**  Bypass processing if Authorised Ind. is blank                   CFT006
     C*                                                                   CFT006
     C           AUIN      IFEQ *BLANK                                    CFT006
     C                     GOTO ENDRFT                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  If this is an Outgoing RFT generate an event if there are any   CFT006
     C**  handling charges.  Bypass all other processing.                 CFT006
     C*                                                                   CFT006
     C           PYTP      IFEQ 'RO'                                      CFT006
     C           HANDCG    IFNE *ZEROS                                    CFT006
     C*                                                                   CFT006
     C**   Bypass if Debit Value Date <= ECDAT                            CFT006
     C*                                                                   CFT006
     C           DBTVDT    IFLE ECDAT                                     CFT006
     C                     GOTO ENDRFT                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**   Determine the Settle Through Nostro Indicator and the Nostro   CFT006
     C**   number (From Handling Charges A/c to be debited).              CFT006
     C*                                                                   CFT006
     C                     MOVELHANDAC    WPTY                            CFT006
     C                     MOVE 'G'       WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     MOVE HANDCY    WCCY                            CFT006
     C*                                                                   CFT006
     C                     EXSR NOSTRO                                    CFT006
     C*                                                                   CFT006
     C**  Set up remaining fields for FPVNTDD                             CFT006
     C*                                                                   CFT006
     C                     MOVE 'D'       RECI                            CFT006
     C                     MOVELHRFTID    PREF                            CFT006
     C                     MOVE DBTVDT    EDAT                            CFT006
     C                     Z-ADDHANDCG    EAMT                            CFT006
     C                     MOVE '91P1'    ETYP                            CFT006
     C*                                                                   CFT006
     C* Calculate base equivalent of net - first need to find transfer    CFT006
     C* currency to base currency exchange rate.                          CFT006
     C*                                                                   CFT006
     C           HANDCY    CHAINSDCURRL1             20                   CFT006
     C*                                                                   CFT006
     C           *IN20     IFEQ *ON                                       CFT006
     C           *LOCK     IN   DLDA                                      CFT006
     C                     MOVEL'FT0610  'DBPGM                           CFT006
     C                     MOVELHANDCY    DBKEY            ************   CFT006
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 20 *   CFT006
     C                     Z-ADD20        DBASE            ************   CFT006
     C                     OUT  DLDA                                      CFT006
     C                     EXSR DBERR                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           A6MDIN    IFEQ 'M'                                       CFT006
     C           EAMT      MULT A6SPRT    DBCE      H                     CFT006
     C                     ELSE                                           CFT006
     C           EAMT      DIV  A6SPRT    DBCE      H                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVE HANDCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OTHD                            CFT006
     C                     MOVE 'O'       INOI                            CFT006
     C                     MOVE 'O'       PYSR                            CFT006
     C                     MOVE BCCY      OTCY                            CFT006
     C                     Z-ADDA6SPRT    RATE                            CFT006
     C*                                                                   CFT006
     C* Find CNUM for output                                              CFT006
     C                     MOVELHANDAC    PRT1                            CFT006
     C                     MOVE 'G'       PRT1T                           CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     EXSR CLIENT                                    CFT006
     C*                                                                   CFT006
     C           MBIN      IFEQ 'Y'                                       CFT006
     C                     MOVE BRCH      BRCPTY                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVE BRCA      BRCPTY                          CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     EXSR MAINEV                                    CFT006
     C*                                                                   CFT006
     C**   Write a record to Events File - FPVNTDD                        CFT006
     C*                                                                   CFT006
     C                     EXSR RECWRT                                    CFT006
     C*                                                                   CFT006
     C* If the party branch not equal to booking branch, generate new     CFT006
     C* settle and pay events                                             CFT006
     C*                                                                   CFT006
     C           BRCA      IFNE BRCPTY                                    CFT006
     C                     EXSR NEWEV2                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                *  CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     GOTO ENDRFT                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C*                                                                   CFT006
     C** Incoming RFT - Read through all detail records for this header   CFT006
     C*                                                                   CFT006
     C           HRFTID    SETLLFT101DD0                                  CFT006
     C           HRFTID    READEFT101DD0                 26               CFT006
     C           *IN26     DOWEQ*OFF                                      CFT006
     C*                                                                   CFT006
     C**   Bypass if Credit Value Date <= ECDAT                           CFT006
     C*                                                                   CFT006
     C           CRDVDT    IFLE ECDAT                                     CFT006
     C                     GOTO TAG03                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**   Determine the Settle Through Nostro Indicator and the Nostro   CFT006
     C**   number (From one of Beneficiary, A/c with Inst. or Intermed)   CFT006
     C*                                                                   CFT006
     C                     SELEC                                          CFT006
     C           BENTTP    WHNE *BLANKS                                   CFT006
     C           GOPFLG    ANDEQ*BLANKS                                   187215
     C                     MOVELTBNA35    WPTY                            CFT006
     C                     MOVE PAYCCY    WCCY    3                       CFT006
     C                     MOVE BENTTP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           AWITTP    WHNE *BLANKS                                   CFT006
     C           GOPFLG    ANDEQ*BLANKS                                   187215
     C                     MOVELTACA35    WPTY                            CFT006
     C                     MOVE PAYCCY    WCCY                            CFT006
     C                     MOVE AWITTP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           INTTTP    WHNE *BLANKS                                   CFT006
     C           GOPFLG    ANDEQ*BLANKS                                   187215
     C                     MOVELTINST1    WPTY                            CFT006
     C                     MOVE PAYCCY    WCCY                            CFT006
     C                     MOVE INTTTP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     OTHER                                          CFT006
     C                     MOVEL*BLANKS   WPTY                            CFT006
     C                     MOVE *BLANKS   WTYPE                           CFT006
     C                     MOVE *BLANKS   WCCY                            CFT006
     C                     ENDSL                                          CFT006
     C*                                                                   CFT006
     C           WCCY      IFNE *BLANKS                                   CFT006
     C                     EXSR NOSTRO                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  Set up remaining fields for FPVNTDD                             CFT006
     C*                                                                   CFT006
     C                     MOVE 'D'       RECI                            CFT006
     C                     MOVELHRFTID    PREF                            CFT006
     C                     MOVE CRDVDT    EDAT                            CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
     C                     MOVE '91P1'    ETYP                            CFT006
     C*                                                                   CFT006
     C** Change event amount depending on charges type                    CFT006
     C*                                                                   CFT006
     C           TDCHGS    IFEQ 'BEN'                                     CFT006
     C*                                                                   CFT006
     C* Subtract charges from event amount                                CFT006
     C*                                                                   CFT006
     C                     SUB  RCPCHG    EAMT                            CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C* Calculate base equivalent of net - first need to find transfer    CFT006
     C* currency to base currency exchange rate.                          CFT006
     C*                                                                   CFT006
     C           PAYCCY    CHAINSDCURRL1             20                   CFT006
     C*                                                                   CFT006
     C           *IN20     IFEQ *ON                                       CFT006
     C           *LOCK     IN   DLDA                                      CFT006
     C                     MOVEL'FT0610  'DBPGM                           CFT006
     C                     MOVELPAYCCY    DBKEY            ************   CFT006
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 18 *   CFT006
     C                     Z-ADD18        DBASE            ************   CFT006
     C                     OUT  DLDA                                      CFT006
     C                     EXSR DBERR                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           A6MDIN    IFEQ 'M'                                       CFT006
     C           EAMT      MULT A6SPRT    DBCE      H                     CFT006
     C                     ELSE                                           CFT006
     C           EAMT      DIV  A6SPRT    DBCE      H                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVE PAYCCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OTHD                            CFT006
     C                     MOVE 'I'       INOI                            CFT006
     C*                                                                   CFT006
     C* Fields used for OLPOS update                                      CFT006
     C                     MOVE 'I'       PYSR                            CFT006
     C                     MOVE BCCY      OTCY                            CFT006
     C                     Z-ADDA6SPRT    RATE                            CFT006
     C*                                                                   CFT006
     C* Find CNUM for output                                              CFT006
     C*                                                                   CFT006
     C                     MOVE PAYCCY    CCCY                            CFT006
     C                     SELEC                                          CFT006
     C*                                                                   CFT006
     C           AWITTP    WHNE *BLANKS                                   CFT006
     C                     MOVELTACA35    PRT1                            CFT006
     C                     MOVE AWITTP    PRT1T                           CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           INTTTP    WHNE *BLANKS                                   CFT006
     C                     MOVELTINST1    PRT1                            CFT006
     C                     MOVE INTTTP    PRT1T                           CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     OTHER                                          CFT006
     C                     MOVE *BLANKS   PRT1                            CFT006
     C                     MOVE *BLANKS   PRT1T                           CFT006
     C*                                                                   CFT006
     C                     ENDSL                                          CFT006
     C*                                                                   CFT006
     C           GOPFLG    IFEQ *BLANKS                                   187215
     C                     MOVE BENTTP    PRT2T                           CFT006
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELTBNA35    PRT2                            CFT006
     C                     MOVEL'2'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     EXSR CLIENT                                    CFT006
     C                     ELSE                                           187215
     C                     MOVEL'C'       PRT1T                           187215
     C                     MOVEL*BLANKS   PRT1                            187215
     C                     Z-ADD1         X                               187215
     C           BRCA      LOKUPBR,X                     55               187215
     C                     MOVELIC,X      PRT1                            187215
     C                     MOVEL'1'       XYTYPE  1                       187215
     C                     EXSR FMTACC                                    187215
     C                     EXSR CLIENT                                    187215
     C                     ENDIF                                          187215
     C*                                                                   CFT006
     C                     MOVE BRCA      BRCPTY                          CFT006
     C*                                                                   CFT006
     C                     EXSR MAINEV                                    CFT006
     C*                                                                   CFT006
     C**   Write a record to Events File - FPVNTDD                        CFT006
     C*                                                                   CFT006
     C                     EXSR RECWRT                                    CFT006
     C*                                                                   CFT006
     C* If the party branch not equal to booking branch, generate new     CFT006
     C* settle and pay events                                             CFT006
     C*                                                                   CFT006
     C           BRCPTY    IFNE BRCA                                      CFT006
     C                     EXSR NEWEV2                                    CFT006
     C                     END                                            CFT006
     C*                                                    *************  CFT006
     C           TAG03     TAG                             * TAG03 TAG *  CFT006
     C*                                                    *************  CFT006
     C** Check 'RI' Debit to write to FPVNTDD                             CFT006
     C** ************************************                             CFT006
     C*                                                                   CFT006
     C**   Bypass if Debit Value Date <= ECDAT                            CFT006
     C*                                                                   CFT006
     C           DBTVDT    IFLE ECDAT                                     CFT006
     C                     GOTO TAG05                                     CFT006
     C                     ELSE                                           CFT006
     C*                                                                   CFT006
     C**   Determine the Settle Through Nostro Indicator and the Nostro   CFT006
     C**   number (From one of the header or detail ordering customer)    CFT006
     C*                                                                   CFT006
     C                     SELEC                                          CFT006
     C           CUSTTP    WHNE *BLANKS                                   CFT006
     C                     MOVELHOCUS1    WPTY                            CFT006
     C                     MOVE TRNCCY    WCCY                            CFT006
     C                     MOVE CUSTTP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           DCUSTP    WHNE *BLANKS                                   CFT006
     C                     MOVELTOCUS1    WPTY                            CFT006
     C                     MOVE TRNCCY    WCCY                            CFT006
     C                     MOVE DCUSTP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     OTHER                                          CFT006
     C                     MOVEL*BLANKS   WPTY                            CFT006
     C                     MOVE *BLANKS   WTYPE                           CFT006
     C                     MOVE *BLANKS   WCCY                            CFT006
     C                     ENDSL                                          CFT006
     C*                                                                   CFT006
     C           WCCY      IFNE *BLANKS                                   CFT006
     C                     EXSR NOSTRO                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  Set up remaining fields for FPVNTDD - N.B. The Event Amount     CFT006
     C**  is set to the Transfer Amount.                                  CFT006
     C*                                                                   CFT006
     C                     MOVE 'D'       RECI                            CFT006
     C                     MOVELHRFTID    PREF                            CFT006
     C                     MOVELPYTP      PYTP                            CFT006
     C                     MOVELPYST      PYST                            CFT006
     C                     MOVE DBTVDT    EDAT                            CFT006
     C                     Z-ADDTRNAMT    EAMT                            CFT006
     C                     MOVE '91P1'    ETYP                            CFT006
     C*                                                                   CFT006
     C** Calculate base equivalent of net - first need to find transfer   CFT006
     C** currency to base currency exchange rate.                         CFT006
     C*                                                                   CFT006
     C           TRNCCY    CHAINSDCURRL1             20                   CFT006
     C*                                                                   CFT006
     C           *IN20     IFEQ *ON                                       CFT006
     C           *LOCK     IN   DLDA                                      CFT006
     C                     MOVEL'FT0610  'DBPGM                           CFT006
     C                     MOVELTRNCCY    DBKEY            ************   CFT006
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 21 *   CFT006
     C                     Z-ADD21        DBASE            ************   CFT006
     C                     OUT  DLDA                                      CFT006
     C                     EXSR DBERR                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           A6MDIN    IFEQ 'M'                                       CFT006
     C           EAMT      MULT A6SPRT    DBCE      H                     CFT006
     C                     ELSE                                           CFT006
     C           EAMT      DIV  A6SPRT    DBCE      H                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVE TRNCCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OTHD                            CFT006
     C                     MOVE 'I'       INOI                            CFT006
     C*                                                                   CFT006
     C* Fields used for OLPOS update                                      CFT006
     C                     MOVE 'O'       PYSR                            CFT006
     C                     MOVE BCCY      OTCY                            CFT006
     C                     Z-ADDA6SPRT    RATE                            CFT006
     C*                                                                   CFT006
     C* Find CNUM for output                                              CFT006
     C*                                                                   CFT006
     C                     MOVE TRNCCY    CCCY                            CFT006
     C                     SELEC                                          CFT006
     C           CUSTTP    WHNE *BLANKS                                   CFT006
     C                     MOVE CUSTTP    PRT1T                           CFT006
     C                     MOVELHOCUS1    PRT1                            CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C           DCUSTP    WHNE *BLANKS                                   CFT006
     C                     MOVE DCUSTP    PRT1T                           CFT006
     C                     MOVELTOCUS1    PRT1                            CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     OTHER                                          CFT006
     C                     MOVE *BLANKS   PRT1                            CFT006
     C                     MOVE *BLANKS   PRT1T                           CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     ENDSL                                          CFT006
     C                     EXSR CLIENT                                    CFT006
     C                     MOVE BRCA      BRCPTY                          CFT006
     C*                    END                                            CFT006
     C*                                                                   CFT006
     C                     EXSR MAINEV                                    CFT006
     C*                                                                   CFT006
     C**   Write a record to Events File - FPVNTDD                        CFT006
     C*                                                                   CFT006
     C                     EXSR RECWRT                                    CFT006
     C*                                                                   CFT006
     C* If the party branch not equal to booking branch, generate new     CFT006
     C* settle and pay events                                             CFT006
     C*                                                                   CFT006
     C           BRCPTY    IFNE BRCA                                      CFT006
     C                     EXSR NEWEV2                                    CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
     C*                                                    *************  CFT006
     C           TAG05     TAG                             * TAG05 TAG *  CFT006
     C*                                                    *************  CFT006
     C**   Read next detail record for this header                        CFT006
     C*                                                                   CFT006
     C           HRFTID    READEFT101DD0                 26               CFT006
     C                     ENDDO                                          CFT006
     C*                                                    ************** CFT006
     C           ENDRFT    ENDSR                           * ENDRFT TAG * CFT006
     C*                                                    ************** CFT006
     C********************************************************************CFT006
     C/EJECT                                                              CFT006
     C********************************************************************CFT006
     C*                                                                   CFT006
     C** FT102H SR. TO PROCESS A RECORD FROM FT102HPD (and therefore      CFT006
     C** ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~      CFT006
     C** many records from FT102DPD)                                      CFT006
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~                                      CFT006
     C*                                                                   CFT006
     C           FT102H    BEGSR                                          CFT006
     C*                                                                   CFT006
     C**  Zeroise cheque sequence                                         CFT006
     C*                                                                   CFT006
     C                     Z-ADD*ZEROS    CQSQ                            CFT006
     C*                                                                   CFT006
     C**  Bypass processing if Authorised Ind. is blank                   CFT006
     C*                                                                   CFT006
     C           AUIN      IFEQ *BLANK                                    CFT006
     C                     GOTO ENDCCT                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  If this is an Outgoing CCT bypass event generation              CFT006
     C*                                                                   CFT006
     C           CCTTYP    IFEQ 'BO'                                      CFT006
     C                     GOTO ENDCCT                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C** Incoming RFT - Read through all detail records for this header   CFT006
     C*                                                                   CFT006
     C           HCCTID    SETLLFT102DD0                                  CFT006
     C           HCCTID    READEFT102DD0                 26               CFT006
     C           *IN26     DOWEQ*OFF                                      CFT006
     C*                                                                   S01408
     C**   Bypass if Credit Value Date <= ECDAT                           CFT006
     C*                                                                   CFT006
     C           C#CVDT    IFLE ECDAT                                     CFT006
     C                     GOTO TAG04                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**   Determine the Settle Through Nostro Indicator and the Nostro   CFT006
     C**   number (From one of Beneficiary or A/c with Institution).      CFT006
     C*                                                                   CFT006
     C                     SELEC                                          CFT006
     C           BENTTD    WHNE *BLANKS                                   CFT006
     C           GOPFLG    ANDEQ*BLANKS                                   187215
     C                     MOVELBENF1     WPTY                            CFT006
     C                     MOVE PAYCCY    WCCY                            CFT006
     C                     MOVE BENTTD    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           AWITP     WHNE *BLANKS                                   CFT006
     C           GOPFLG    ANDEQ*BLANKS                                   187215
     C                     MOVELACCI35    WPTY                            CFT006
     C                     MOVE PAYCCY    WCCY                            CFT006
     C                     MOVE AWITP     WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     OTHER                                          CFT006
     C                     MOVEL*BLANKS   WPTY                            CFT006
     C                     MOVE *BLANKS   WTYPE                           CFT006
     C                     MOVE *BLANKS   WCCY                            CFT006
     C                     ENDSL                                          CFT006
     C*                                                                   CFT006
     C           WCCY      IFNE *BLANKS                                   CFT006
      *                                                                                     AR664109
      ** If IBAN, Setup IBAN work field                                                     AR664109
      *                                                                                     AR664109
     C           WTYPE     IFEQ 'I'                                                         AR664109
     C           1         SUBSTWPTY:1    SLS                                               AR664109
      *                                                                                     AR664109
     C           SLS       IFEQ '/'                                                         AR664109
     C                     SUBSTWPTY:2    WPTY2                                             AR664109
     C                     ELSE                                                             AR664109
     C                     MOVELWPTY      WPTY2                                             AR664109
     C                     ENDIF                                                            AR664109
     C                     ENDIF                                                            AR664109
      *                                                                                     AR664109
     C                     EXSR NOSTRO                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  Set up remaining fields for FPVNTDD - N.B. The Event Amount     CFT006
     C**  is set to the Payment Amount and NOT the Transfer Amount.       CFT006
     C**  This is because the Payment Amount is the Transfer Amount       CFT006
     C**  less any charges.                                               CFT006
     C*                                                                   CFT006
     C                     MOVE 'D'       RECI                            CFT006
     C                     MOVELHCCTID    PREF                            CFT006
     C                     MOVELCCTTYP    PYTP                            CFT006
     C                     MOVELCCTTST    PYST                            CFT006
     C                     MOVE C#CVDT    EDAT                            CFT006
     C                     Z-ADDPAYAMT    EAMT                            CFT006
     C                     MOVE '91P1'    ETYP                            CFT006
     C*                                                                   CFT006
     C* Calculate base equivalent of net - first need to find transfer    CFT006
     C* currency to base currency exchange rate.                          CFT006
     C*                                                                   CFT006
     C           PAYCCY    CHAINSDCURRL1             20                   CFT006
     C*                                                                   CFT006
     C           *IN20     IFEQ *ON                                       CFT006
     C           *LOCK     IN   DLDA                                      CFT006
     C                     MOVEL'FT0610  'DBPGM                           CFT006
     C                     MOVELPAYCCY    DBKEY            ************   CFT006
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 19 *   CFT006
     C                     Z-ADD19        DBASE            ************   CFT006
     C                     OUT  DLDA                                      CFT006
     C                     EXSR DBERR                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           A6MDIN    IFEQ 'M'                                       CFT006
     C           EAMT      MULT A6SPRT    DBCE      H                     CFT006
     C                     ELSE                                           CFT006
     C           EAMT      DIV  A6SPRT    DBCE      H                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVE PAYCCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OTHD                            CFT006
     C                     MOVE 'I'       INOI                            CFT006
     C*                                                                   CFT006
     C* Fields used for OLPOS update                                      CFT006
     C                     MOVE 'I'       PYSR                            CFT006
     C                     MOVE BCCY      OTCY                            CFT006
     C                     Z-ADDA6SPRT    RATE                            CFT006
     C*                                                                   CFT006
     C* Find CNUM for output                                              CFT006
     C*                                                                   CFT006
     C           GOPFLG    IFEQ *BLANKS                                   187215
     C                     MOVE PAYCCY    CCCY                            CFT006
     C                     MOVE AWITP     PRT1T                           CFT006
     C                     MOVELACCI35    PRT1                            CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     MOVE BENTTD    PRT2T                           CFT006
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELBENF1     PRT2                            CFT006
     C                     MOVEL'2'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     EXSR CLIENT                                    CFT006
     C                     ELSE                                           187215
     C                     MOVEL'C'       PRT1T                           187215
     C                     MOVEL*BLANKS   PRT1                            187215
     C                     Z-ADD1         X                               187215
     C           BRCA      LOKUPBR,X                     55               187215
     C                     MOVELIC,X      PRT1                            187215
     C                     MOVEL'1'       XYTYPE  1                       187215
     C                     EXSR FMTACC                                    187215
     C                     EXSR CLIENT                                    187215
     C                     ENDIF                                          187215
     C*                                                                   CFT006
     C                     MOVE C#BRCA    BRCPTY                          CFT006
     C*                    END                                            CFT006
     C*                                                                   CFT006
     C                     EXSR MAINEV                                    CFT006
     C*                                                                   CFT006
     C**   Write a record to Events File - FPVNTDD                        CFT006
     C*                                                                   CFT006
     C                     EXSR RECWRT                                    CFT006
     C*                                                                   CFT006
     C* If the party branch not equal to booking branch, generate new     CFT006
     C* settle and pay events                                             CFT006
     C*                                                                   CFT006
     C           BRCPTY    IFNE C#BRCA                                    CFT006
     C                     EXSR NEWEV2                                    CFT006
     C                     END                                            CFT006
     C*                                                    *************  CFT006
     C           TAG04     TAG                             * TAG04 TAG *  CFT006
     C*                                                    *************  CFT006
     C*                                                                   CFT006
     C** Check 'BI' Debit to write to FPVNTDD                             CFT006
     C** ************************************                             CFT006
     C*                                                                   CFT006
     C**   Bypass if Debit Value Date <= ECDAT                            CFT006
     C*                                                                   CFT006
     C           C#DVDT    IFLE ECDAT                                     CFT006
     C                     GOTO TAG06                                     CFT006
     C                     ELSE                                           CFT006
     C*                                                                   CFT006
     C**   Determine the Settle Through Nostro Indicator and the Nostro   CFT006
     C**   number (From one of the header or detail ordering customer)    CFT006
     C*                                                                   CFT006
     C                     SELEC                                          CFT006
     C           CUSTTH    WHNE *BLANKS                                   CFT006
     C                     MOVELC#CUS1    WPTY                            CFT006
     C                     MOVE CCTCCY    WCCY                            CFT006
     C                     MOVE CUSTTH    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           CUSTTD    WHNE *BLANKS                                   CFT006
     C                     MOVELORDCU1    WPTY                            CFT006
     C                     MOVE CCTCCY    WCCY                            CFT006
     C                     MOVE CUSTTD    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           C#ORDT    WHNE *BLANKS                                   CFT006
     C                     MOVELOINST3    WPTY                            CFT006
     C                     MOVE CCTCCY    WCCY                            CFT006
     C                     MOVE C#ORDT    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C           ORDITP    WHNE *BLANKS                                   CFT006
     C                     MOVELORDI35    WPTY                            CFT006
     C                     MOVE CCTCCY    WCCY                            CFT006
     C                     MOVE ORDITP    WTYPE                           CFT006
     C                     MOVEL'3'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C*                                                                   CFT006
     C                     OTHER                                          CFT006
     C                     MOVEL*BLANKS   WPTY                            CFT006
     C                     MOVE *BLANKS   WTYPE                           CFT006
     C                     MOVE *BLANKS   WCCY                            CFT006
     C                     ENDSL                                          CFT006
     C*                                                                   CFT006
     C           WCCY      IFNE *BLANKS                                   CFT006
     C                     EXSR NOSTRO                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C**  Set up remaining fields for FPVNTDD - N.B. The Event Amount     CFT006
     C**  is set to the Transfer Amount.                                  CFT006
     C*                                                                   CFT006
     C                     MOVE 'D'       RECI                            CFT006
     C                     MOVELHCCTID    PREF                            CFT006
     C                     MOVELCCTTYP    PYTP                            CFT006
     C                     MOVELCCTTST    PYST                            CFT006
     C                     MOVE C#DVDT    EDAT                            CFT006
     C                     Z-ADDCCTAMT    EAMT                            CFT006
     C                     MOVE '91P1'    ETYP                            CFT006
     C*                                                                   CFT006
     C** Calculate base equivalent of net - first need to find transfer   CFT006
     C** currency to base currency exchange rate.                         CFT006
     C*                                                                   CFT006
     C           CCTCCY    CHAINSDCURRL1             20                   CFT006
     C*                                                                   CFT006
     C           *IN20     IFEQ *ON                                       CFT006
     C           *LOCK     IN   DLDA                                      CFT006
     C                     MOVEL'FT0610  'DBPGM                           CFT006
     C                     MOVELCCTCCY    DBKEY            ************   CFT006
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 22 *   CFT006
     C                     Z-ADD22        DBASE            ************   CFT006
     C                     OUT  DLDA                                      CFT006
     C                     EXSR DBERR                                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           A6MDIN    IFEQ 'M'                                       CFT006
     C           EAMT      MULT A6SPRT    DBCE      H                     CFT006
     C                     ELSE                                           CFT006
     C           EAMT      DIV  A6SPRT    DBCE      H                     CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVE CCTCCY    ECCY                            CFT006
     C                     Z-ADD*ZEROS    OTHD                            CFT006
     C                     MOVE 'I'       INOI                            CFT006
     C*                                                                   CFT006
     C* Fields used for OLPOS update                                      CFT006
     C                     MOVE 'O'       PYSR                            CFT006
     C                     MOVE BCCY      OTCY                            CFT006
     C                     Z-ADDA6SPRT    RATE                            CFT006
     C*                                                                   CFT006
     C* Find CNUM for output                                              CFT006
     C*                                                                   CFT006
     C                     MOVE CCTCCY    CCCY                            CFT006
     C                     SELEC                                          CFT006
     C           C#ORDT    WHNE *BLANKS                                   CFT006
     C                     MOVE C#ORDT    PRT1T                           CFT006
     C                     MOVELOINST3    PRT1                            CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C           ORDITP    WHNE *BLANKS                                   CFT006
     C                     MOVE ORDITP    PRT1T                           CFT006
     C                     MOVELORDI35    PRT1                            CFT006
     C                     MOVEL'1'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     OTHER                                          CFT006
     C                     MOVE *BLANKS   PRT1T                           CFT006
     C                     MOVEL*BLANKS   PRT1                            CFT006
     C                     ENDSL                                          CFT006
     C           CUSTTH    IFNE *BLANKS                                   CFT006
     C                     MOVE CUSTTH    PRT2T                           CFT006
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELC#CUS1    PRT2                            CFT006
     C                     MOVEL'2'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     ELSE                                           CFT006
     C                     MOVE CUSTTD    PRT2T                           CFT006
     C                     MOVEL*BLANKS   PRT2                                              BUG15297
     C                     MOVELORDCU1    PRT2                            CFT006
     C                     MOVEL'2'       XYTYPE  1                       CFT006
     C                     EXSR FMTACC                                    CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     EXSR CLIENT                                    CFT006
     C                     MOVE C#BRCA    BRCPTY                          CFT006
     C*                    END                                            CFT006
     C*                                                                   CFT006
     C                     EXSR MAINEV                                    CFT006
     C*                                                                   CFT006
     C**   Write a record to Events File - FPVNTDD                        CFT006
     C*                                                                   CFT006
     C                     EXSR RECWRT                                    CFT006
     C*                                                                   CFT006
     C* If the party branch not equal to booking branch, generate new     CFT006
     C* settle and pay events                                             CFT006
     C*                                                                   CFT006
     C           BRCPTY    IFNE C#BRCA                                    CFT006
     C                     EXSR NEWEV2                                    CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                           ***********    CFT006
     C           TAG06     TAG                             * TAG06 TAG *  CFT006
     C*                                                                *  CFT006
     C**   Read next detail record for this header                        CFT006
     C*                                                                   CFT006
     C           CCTID     READEFT102DD0                 26               CFT006
     C                     ENDDO                                          CFT006
     C*                                                    ************** CFT006
     C           ENDCCT    ENDSR                           * ENDCCT TAG * CFT006
     C*                                                    ************** CFT006
     C********************************************************************CFT006
     C/EJECT                                                              CFT006
     C********************************************************************CFT006
     C*                                                                   CFT006
     C** FMTACC SR TO FORMAT ACCOUNTS FOR MT101 AND MT102                 CFT006
     C*                                                                   CFT006
     C           FMTACC    BEGSR                                          CFT006
     C*                                                                   CFT006
     C                     MOVEL*BLANKS   OLDFLD                          CFT006
     C                     MOVEL*BLANKS   NEWFLD                          CFT006
     C*                                                                   CFT006
     C           XYTYPE    IFEQ '1'                                       CFT006
     C                     MOVELPRT1      FLD19                           CFT006
     C                     MOVELPRT1T     XYGL    1                       CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           XYTYPE    IFEQ '2'                                       CFT006
     C                     MOVELPRT2      FLD19                           CFT006
     C                     MOVELPRT2T     XYGL    1                       CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           XYTYPE    IFEQ '3'                                       CFT006
     C                     MOVELWPTY      FLD19                           CFT006
     C                     MOVELWTYPE     XYGL                            CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           XYGL      IFEQ 'G'                                       CFT006
     C* Account was in format                                             CFT006
     C*  000018gbp140501dom (Cust/ccy/acc/seq/brch                        CFT006
     C* Now in format                                                     CFT006
     C* dom000018GBP140501 (brch/cust/CCY/ACC/seq                         CFT006
     C*                                                                   CFT006
     C* Field PRT1 in old format.  Format to new                          CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     NEWFLD                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     NEWFLD                          CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C                     MOVELXCNUM     YCNUM                           CFT006
     C                     MOVELXACC      YACC                            CFT006
     C                     MOVELXCCY      YCCY                            CFT006
     C                     MOVELXBRCA     YBRCA                           CFT006
     C                     MOVELXSEQ      YSEQ                            CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           XYGL      IFEQ 'F'                                       CFT006
     C           FST1      IFEQ '/'                                       CFT006
     C                     MOVELSND18     OLDFLD                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELFST18     OLDFLD                          CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
     C*                                                                   CFT006
     C           XYGL      IFEQ 'F'                                                           195520
     C           XYGL      OREQ 'G'                                                           195520
     C           XYTYPE    IFEQ '1'                                       CFT006
     C                     MOVELOLDFLD    PRT1                            CFT006
     C                     ENDIF                                          CFT006
     C           XYTYPE    IFEQ '3'                                       CFT006
     C                     MOVELOLDFLD    WPTY                            CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                                              195520
     C*                                                                   CFT006
     C                     ENDSR                                          CFT006
     C********************************************************************CFT006
     C/EJECT                                                              CFT006
     C********************************************************************CFT006
     C*
     C** DBERR SR.TO ABORT THE PROGRAM IN THE EVENT OF A DATABASE ERROR
0882 C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*
     C           DBERR     BEGSR
     C*
     C** SETON INDICATORS TO INDICATE DATABASE ERRORS
     C*
     C                     SETON                     U7U8LR
     C*
     C** WRITE TOTALS TO THE TRAILER
     C*
     C                     MOVE 'Z'       RECI
     C                     Z-ADDRECA,8    NORE1
     C                     Z-ADDINTA,8    HRWN
     C                     Z-ADDDECA,8    HRDC
     C*
     C                     WRITEFPVNTZZF
     C*
     C** SET UP CONTROL REPORT FIELDS
     C*
     C*********************MOVELDBASE     P1DBAS                          S01194
     C*********************MOVELDBFILE    P1DBFL                          S01194
     C*********************MOVELDBKEY     P1DBKY                          S01194
     C                     MOVELDBASE     AUDBAS                          S01194
     C                     MOVELDBFILE    AUDBFL                          S01194
     C                     MOVELDBKEY     AUDBKY                          S01194
     C*
     C** WRITE CONTROL REPORT
     C*
     C*********************OPEN FT0610P1                                  S01194
     C                     OPEN FT0610AU                                  S01194
     C*
     C*********************WRITEP1CONT                                    S01194
     C*********************WRITEP1DBER                                    S01194
     C                     WRITEAUCONT                                    S01194
     C                     WRITEAUDBER                                    S01194
     C           *IN27     IFEQ '1'                                       106357
     C                     WRITEP2EOR                  27                 106357
     C                     END                                            106357
     C*
     C** PRODUCE PROGRAM DUMP
     C*
     C                     DUMP
     C*
     C** END PROGRAM
     C*
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** PRTP1 SR. TO WRITE THE CONTROL REPORT AND THE TRAILER
     C*
     C           PRTP1     BEGSR
     C*
     C** SET UP HASH TOTALS FOR THE TRAILER
     C*
     C                     Z-ADDRECA,8    NORE1
     C                     Z-ADDINTA,8    HRWN
     C                     Z-ADDDECA,8    HRDC
     C*
     C** SET UP HASH TOTALS EXCLUDING REGULAR PAYMENTS FOR THE TRAILER
     C                     Z-ADDINTA,9    HWNX
     C                     Z-ADDDECA,9    HDCX
     C*-------------------------------------------------------------------
     C** INCREASE TRAILER TOTAL BY 1 TO ACCOMMODATE SUBSEQUENT EVENTS
     C** REPORTING PROGRAMS
     C*
     C                     ADD  1         NORE1
     C*-------------------------------------------------------------------
     C*
     C                     WRITEFPVNTZZF
     C*
     C** SET UP HASH TOTALS FOR THE CONTROL REPORT
     C*
     C                     Z-ADDRECA,8    RECA08
     C                     Z-ADDINTA,8    INTA08
     C                     Z-ADDDECA,8    DECA08
     C*
     C* GET SYSTEM TITLE IF FIRST CYCLE NOT PERFORMED
     C*
     C  N25                DO
     C*********************MOVEL'FT0610'  DBPGM                           E35098
     C*
     C** ACCESS TABTB10 (I.C.D.R.1) ON TABFP FOR : TITL,RUND AND DATF
     C*
     C**   SET UP KEY FOR INSTALLATION CONTROL RECORD 1
     C                     MOVEL'01      'ZTABKY 12
     C                     MOVE '  10'    ZTABKY
     C*
     C           ZTABKY    CHAINTABFP                20    ON NOT THERE
     C**N20******RECI******COMP 'D'                  2020  ON, IS DELETED E35101
     C  N20      RECITB    COMP 'D'                  2020  ON, IS DELETED E35101
     C*
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C  N20      DATF      COMP 'M'                      98MMDDYY, 98 ON
     C*
     C*
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVELZTABKY    DBKEY            ***************
     C*********************MOVE 'TABFP'   DBFILE           * DB ERROR 07 *S01194
     C                     MOVEL'TABTB10 'DBFILE           ***************S01194
     C                     MOVE '07'      DBASE            ***************
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END
     C*
     C                     END
     C*
     C*********************OPEN FT0610P1                                  S01194
     C                     OPEN FT0610AU                                  S01194
     C*
     C*********************WRITEP1CONT                                    S01194
     C*********************WRITEP1EOR                                     S01194
     C                     WRITEAUCONT                                    S01194
     C                     WRITEAUEOR                                     S01194
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C************************************************************
     C* CLIENT SR.
     C* TO FIND CORRECT CNUM FROM ACCOUNTS
     C*
     C           CLIENT    BEGSR
     C*
     C* DEFINE FIELDS
     C                     MOVE PRT1T     PRT1T   1
     C**********           MOVE PRT1      PRT1   10                                         BUG15230
     C                     MOVE PRT1      PRT1   34                                         BUG15230
     C                     MOVE PRT2T     PRT2T   1
     C**********           MOVE PRT2      PRT2   10                                         BUG15230
     C                     MOVE PRT2      PRT2   34                                         BUG15230
     C                     MOVE CCCY      CCCY    3
     C*
     C* IF PARTY 1 ENTERED AND NOT SWIFT OR AN ADDRESS
     C           PRT1T     IFNE *BLANK                     B001
     C           PRT1T     ANDNE'A'
     C           PRT1T     ANDNE'S'
     C*
     C* IF PARTIAL OR FULL ACCOUNT CNUM FIRST 6 CHARACTERS
     C           PRT1T     IFEQ 'P'                        B002
     C           PRT1T     OREQ 'G'
     C           PRT1T     OREQ 'C'
     C           PRT1T     OREQ 'I'                                       CFT014
     C           CFT004    ANDEQ'Y'                                       CFT014
     C*********************MOVELPRT1      CNUM                            S01117
     C                     MOVELPRT1      CUNR                            S01117
     C                     ELSE                            X002
     C*
     C* IF RETAIL CHAIN TO ACNUMA
     C           PRT1T     IFEQ 'R'                        B003
     C                     MOVELPRT1      ACNO
     C           ACNO      CHAINACNUMA               20
     C  N20      RECI      COMP 'D'                  2020
     C   20                DO                              B004
     C********** *LOCK     IN   DLDA                                                          200439
     C**********           MOVEL'FT0610  'DBPGM                           E35098              200439
     C**********           MOVELACNO      DBKEY            ***************                    200439
     C*********************MOVE 'ACNUM'   DBFILE           * DB ERROR 50 *S01194
     C**********           MOVEL'ACNUMA  'DBFILE           ***************S01194              200439
     C**********           MOVE '50'      DBASE            ***************                    200439
     C**********           OUT  DLDA                                                          200439
     C**********           EXSR DBERR                                                         200439
     C                     EXSR ACNERR                                                        200439
     C                     END                             E004
     C                     MOVE CNUM      CUNR                            S01117
     C                     ELSE                            X003
     C*
     C* IS NOSTRO FULL OR NUMBER
     C* IF FULL NOSTRO
     C           PRT1T     IFEQ 'F'                        B004
     C                     MOVELPRT1      NOSX    5
     C                     ELSE                            X004
     C*
     C* IS A NOSTRO NUMBER
     C                     MOVELCCCY      NOSX
     C                     MOVELPRT1      NO      2
     C                     MOVE NO        NOSX
     C                     END                             E004
     C*
     C* CHAIN TO TABLETL
     C                     MOVE *BLANK    KEY
     C                     MOVEL'70'      KEY
     C                     MOVE NOSX      KEY
     C           KEY       CHAINTABLETLF             20
     C  N20      RECI      COMP 'D'                  2020
     C   20                DO                              B005
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVELKEY       DBKEY            ***************
     C*********************MOVE 'TABFP'   DBFILE           * DB ERROR 51 *S01194
     C                     MOVEL'TABLETL 'DBFILE           ***************S01194
     C                     MOVE '51'      DBASE            ***************
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END                             E004
     C                     MOVE CNUM      CUNR                            S01117
     C                     END                             E003
     C                     END                             E002
     C                     ELSE                            X001
     C*
     C* NOW TRY PARTY 2
     C*
     C* IF PARTY 2 ENTERED AND NOT SWIFT OR AN ADDRESS
     C           PRT2T     IFNE *BLANK                     B002
     C           PRT2T     ANDNE'A'
     C           PRT2T     ANDNE'S'
     C*
     C* IF PARTIAL OR FULL ACCOUNT CNUM FIRST 6 CHARACTERS
     C           PRT2T     IFEQ 'P'                        B003
     C           PRT2T     OREQ 'G'
     C           PRT2T     OREQ 'C'
     C*********************MOVELPRT2      CNUM                            S01117
     C                     MOVELPRT2      CUNR                            S01117
     C                     ELSE                            X003
     C*
     C* IF RETAIL CHAIN TO ACNUMA
     C           PRT2T     IFEQ 'R'                        B004
     C                     MOVELPRT2      ACNO
     C           ACNO      CHAINACNUMA               20
     C  N20      RECI      COMP 'D'                  2020
     C   20                DO                              B005
     C********** *LOCK     IN   DLDA                                                          200439
     C**********           MOVEL'FT0610  'DBPGM                           E35098              200439
     C**********           MOVELACNO      DBKEY            ***************                    200439
     C*********************MOVE 'ACNUM'   DBFILE           * DB ERROR 52 *S01194
     C**********           MOVEL'ACNUMA  'DBFILE           ***************S01194              200439
     C**********           MOVE '52'      DBASE            ***************                    200439
     C**********           OUT  DLDA                                                          200439
     C**********           EXSR DBERR                                                         200439
     C                     EXSR ACNERR                                                        200439
     C                     END                             E005
     C                     MOVE CNUM      CUNR                            S01117
     C                     ELSE                            X004
     C*
     C* If International Bank Account Number is active                    CFT004
     C           CFT004    IFEQ 'Y'                        B004A          CFT004
     C           PRT2T     ANDEQ'I'                                       CFT004
     C********** 34        SUBSTBNC1:2    P@IBN  34                                  CFT004 BUG15230
     C**********           MOVELPRT2      P@IBN  34                                BUG15230 BUG15297
     C           1         SUBSTPRT2:1    SLS                                               BUG15297
     C           SLS       IFEQ '/'                                                         BUG15297
     C                     SUBSTPRT2:2    P@IBN  34                                         BUG15297
     C                     ELSE                                                             BUG15297
     C                     MOVELPRT2      P@IBN                                             BUG15297
     C                     ENDIF                                                            BUG15297
     C                     MOVE *BLANKS   DSSDY                           CFT004
     C                     CALL 'AOIBANR4'                                CFT004
     C                     PARM           @RTCD                           CFT004
     C                     PARM '*KEY   ' @OPTN   7                       CFT004
     C                     PARM           P@IBN                           CFT004
     C           P@ACCN    PARM           DSSDY                           CFT004
     C           @RTCD     IFNE *BLANKS                                   CFT004
     C                     MOVE *BLANKS   DBKEY                           CFT004
     C                     Z-ADD18        DBASE            ***************CFT004
     C                     MOVEL'ACCNTL6' DBFILE           * DB ERROR 18 *CFT004
     C                     MOVELP@IBN     DBKEY            ***************CFT004
     C                     EXSR DBERR                                     CFT004
     C                     ENDIF                                          CFT004
     C                     ELSE                            X00A4          CFT004
      *                                                                   CFT004
     C* IS NOSTRO FULL OR NUMBER
     C* IF FULL NOSTRO
     C           PRT2T     IFEQ 'F'                        B005
     C                     MOVELPRT2      NOSX    5
     C                     ELSE                            X005
     C*
     C* IS A NOSTRO NUMBER
     C                     MOVELCCCY      NOSX
     C                     MOVELPRT2      NO      2
     C                     MOVE NO        NOSX
     C                     END                             E005
     C*
     C* CHAIN TO TABLETL
     C                     MOVE *BLANK    KEY
     C                     MOVEL'70'      KEY
     C                     MOVE NOSX      KEY
     C           KEY       CHAINTABLETLF             20
     C  N20      RECI      COMP 'D'                  2020
     C   20                DO                              B006
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0610  'DBPGM                           E35098
     C                     MOVELKEY       DBKEY            ***************
     C*********************MOVE 'TABFP'   DBFILE           * DB ERROR 53 *S01194
     C                     MOVEL'TABLETL 'DBFILE           ***************S01194
     C                     MOVE '53'      DBASE            ***************
     C                     OUT  DLDA
     C                     EXSR DBERR
     C                     END                             E005
     C                     ENDIF                           E004A          CFT004
     C                     MOVE CNUM      CUNR                            S01117
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*********************                                               S01117
     C**MOVE*DEFAULT*BRANCH*CODE*TO*BRANCH*CODE*                          S01117
     C*********************Z-ADDFTDB      BRCD                            S01117
     C*
     C                     ENDSR
     C*
     C************************************************************
     C* END OF SUBROUTINE TO FIND CNUM
     C************************************************************
     C/EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0610CCP5                                           S01408
     C*                                                                   S01408
     C********************************************************************
4934 C*
4932 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
4933 C*   IND '99' IS SET BY AN OVERFLOW ERROR
4934 C*
4935 CSR         GLZADD    BEGSR                           *** GLZADD ****
4936 C*
4937 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
4938 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
4939 C*
4940 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
4941 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
4942 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
4943 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
4944 C*
4945 CSR                   EXSR GLZSUM
4946 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
4947 C*
4948 C********************************************************************
4949 C* SUBROUTINE TO SUBTRACT AN AMOUNT (ZZAMT) FROM THE TOTAL
4950 C*                                                   (ZZTOTI,ZZTOTD)
4951 C*  IND '99' IS SET BY AN OVERFLOW ERROR
4952 CSR         GLZSUB    BEGSR                           *** GLZSUB ****
4953 C* PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
4954 CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
4955 CSR                   EXSR GLZADD                       AND 'ADD'
4956 CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
4957 CSR                   ENDSR
4958 C********************************************************************
4959 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
4960 C*                        GLZADD, GLZSUB, GLZCMP.
4961 C*          PARAMETERS PASSED -
4962 C*                     I/P ZZAMTI ZZAMTD
4963 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
4964 C*
4965 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
4966 C*
4967 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
4968 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
4969 CSR                   SETOF                     919293
4970 CSR                   SETOF                     949599
4971 C*
4972 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
4973 CSR         ZZAMTI    COMP 0                      9293
4974 CSR 93      ZZAMTD    COMP 0                      9293
4975 CSR 93                GOTO ZZSEND                     ZERO BYPASS
4976 C*
4977 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
4978 CSR         ZZTOTI    COMP 0                      9193
4979 CSR 93      ZZTOTD    COMP 0                      9193
4980 C*
4981 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
4982 CSR 93                Z-ADDZZAMTI    ZZTOTI
4983 CSR 93                Z-ADDZZAMTD    ZZTOTD
4984 CSR 93                GOTO ZZSEND                     ZERO BYPASS
4985 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
4986 CSR 91N92
4987 CORN91 92             GOTO ZZOFPS
4988 C*
4989 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
4990 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
4991 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
4992 C*
4993 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
4994 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
4995 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
4996 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
4997 C*
4998 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
4999 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
5000 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
5001 CSRN99                Z-ADDZZWK2     ZZTOTD
5002 CSRN99                Z-ADDZZWK3     ZZTOTI
5003 C*
5004 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
5005 CSR 99                Z-ADD0         ZZAMT  153
5006 CSR                   GOTO ZZSEND
5007 C*
5008 C* THE 'SIGNS' ARE DIFFERENT
5009 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
5010 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
5011 C*
5012 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
5013 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
5014 C*
5015 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
5016 C*
5017 CSR 91                Z-SUBZZTOTI    ZZTOTI
5018 CSR 91                Z-SUBZZTOTD    ZZTOTD
5019 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
5020 C*
5021 CSR         ZZTOTI    COMP ZZAMTI               93  95
5022 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
5023 C*
5024 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
5025 CSR 95                Z-ADD0         ZZTOTI
5026 CSR 95                Z-ADD0         ZZTOTD
5027 CSR 95                GOTO ZZSEND
5028 C*
5029 C* IF ZZTOT GT. ZZAMT.
5030 CSR 93      ZZAMTD    COMP ZZTOTD               94
5031 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
5032 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
5033 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
5034 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
5035 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
5036 C*
5037 C*
5038 C* IF ZZAMT GT. ZZTOT.
5039 CSRN93      ZZTOTD    COMP ZZAMTD               94
5040 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
5041 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
5042 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
5043 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
5044 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
5045 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
5046 C*
5047 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
5048 CSR                   SETOF                     94
5049 CSR 93 91
5050 CORN93 92             SETON                     94
5051 CSR 94                Z-SUBZZTOTI    ZZTOTI
5052 CSR 94                Z-SUBZZTOTD    ZZTOTD
5053 C**
5054 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
5055 CSR 92                Z-SUBZZAMTI    ZZAMTI
5056 CSR 92                Z-SUBZZAMTD    ZZAMTD
5057 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
5058 C**
5059 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
5060 CSR                   SETOF                     96
5061 CSR         ZZTOTD    COMP 0                        91
5062 CSR 91      ZZTOTI    COMP 0                      96
5063 CSR 96                MOVE '.000-'   ZZNEGD  5
5064 CSR                   ENDSR                             ** ENDSR **
5065 C********************************************************************
4632 C/EJECT
4631 C********************************************************************
4632 C**
4633 C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
4634 C**              CONVERT TO A NUMBER OF DAYS.
4635 C**
4636 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
4637 C**
4638 C           ZDATE1    BEGSR                           *** ZDATE1 ***
4639 C**
4640 C**   CLEAR DAY NUMBER.
4641 C                     Z-ADD0         ZDAYNO  50
4642 C**
4643 C**   CALCULATION TO DEFINE INPUT DATE FIELD.
4644 C                     Z-ADDZDATE     ZDATE   60
4645 C**
4646 C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
4647 C                     MOVE ZDATE     ZYEAR   20
4648 C  N98                MOVELZDATE     ZDAY    20
4649 C   98                MOVELZDATE     ZMTH    20
4650 C                     MOVE ZDATE     ZWRK4   40
4651 C  N98                MOVELZWRK4     ZMTH
4652 C   98                MOVELZWRK4     ZDAY
4653 C**
4654 C**   ENSURE MONTH IS VALID.
4655 C           ZMTH      COMP 0                      9999
4656 C  N99      ZMTH      COMP 12                   99
4657 C   99                GOTO ZDEND1                     BYPASS IF ERROR
4658 C**
4659 C**   CHECK FOR 30 DAY MONTHS.
4660 C           ZMTH      COMP 4                        90IF 90 ON, 30
4661 C  N90      ZMTH      COMP 6                        90DAY MONTH.
4662 C  N90      ZMTH      COMP 9                        90
4663 C  N90      ZMTH      COMP 11                       90
4664 C**
4665 C**   ENSURE DAY IS VALID.
4666 C           ZDAY      COMP 0                      9999
4667 C   90N99   ZDAY      COMP 30                   99
4668 C  N90N99   ZDAY      COMP 31                   99
4669 C   99                GOTO ZDEND1                     BYPASS IF ERROR
4670 C**
4671 C**   CHECK FOR LEAP YEAR AND FEBRUARY.
4672 C           ZYEAR     ADD  28        ZYEAR
4673 C           ZYEAR     DIV  4         ZLYR    20
4674 C                     MVR            ZLY     10     91LEAP YR, 91 ON
4675 C           ZMTH      COMP 2                    93  92FEB., 92 ON
4676 C**                                                   PAST FEB, 93 ON
4677 C**   IF FEBUARY FURTHER VALIDATE DAY.
4678 C  N91 92   ZDAY      COMP 28                   99
4679 C   91 92   ZDAY      COMP 29                   99
4680 C   99                GOTO ZDEND1                     BYPASS IF ERROR
4681 C**
4682 C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
4683 C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
4684 C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
4685 C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
4686 C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
4687 C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
4688 C**
4689 C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
4690 C**
4691 C**
4692 C********************************************************************
3807 C/EJECT
3806 C********************************************************************
3807 C**
3808 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
3809 C**
3810 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
3811 C**
3812 C           ZDATE2    BEGSR                           *** ZDATE2 ***
3813 C**
3814 C**   CLEAR DATE FIELDS.
3815 C                     Z-ADD0         ZDATE   60
3816 C                     MOVEL'       ' ZADATE  7
3817 C**
3818 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
3819 C                     Z-ADDZDAYNO    ZDAYNO  50
3820 C**
3821 C**   DETERMINE YEAR NUMBER.
3822 C**
3823 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
3824 C           ZDAYNO    SUB  1         ZDAYN1  50   99
3825 C   99                GOTO ZDEND2
3826 C**
3827 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
3828 C           ZDAYN1    DIV  1461      ZLYR    20
3829 C                     MVR            ZDAYN1           SAVE REMAINING
3830 C**                                                   DAYS
3831 C**   CALCULATE NUMBER OF REMAINING YEARS.
3832 C                     Z-ADD1         ZWRK2   20
3833 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
3834 C           ZDAYN1    COMP ZYDY,ZWRK2             90
3835 C  N90      ZWRK2     ADD  1         ZWRK2
3836 C  N90                GOTO ZDTAG1
3837 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
3838 C**
3839 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
3840 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
3841 C**
3842 C**   CALCULATE ACTUAL YEAR NUMBER.
3843 C           ZLYR      MULT 4         ZWRK3   30
3844 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
3845 C                     Z-ADDZWRK3     ZYEAR   20
3846 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
3847 C**
3848 C**   DETERMINE MONTH NUMBER.
3849 C**
3850 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
3851 C                     SETOF                     9293
3852 C   91      ZDAYN1    COMP 59                     9293
3853 C   91N92   ZDAYN1    SUB  1         ZDAYN1
3854 C**
3855 C**   CALCULATE MONTH NUMBER.
3856 C                     Z-ADD2         ZWRK2
3857 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
3858 C           ZDAYN1    COMP ZMDY,ZWRK2             94
3859 C  N94      ZWRK2     ADD  1         ZWRK2
3860 C  N94                GOTO ZDTAG2
3861 C           ZWRK2     SUB  1         ZWRK2
3862 C**
3863 C                     Z-ADDZWRK2     ZMTH    20       MONTH
3864 C**
3865 C**   DETERMINE DAY OF MONTH.
3866 C**
3867 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
3868 C           ZDAYN1    ADD  1         ZDAYN1
3869 C**
3870 C**   CALCULATE DAY OF MONTH.
3871 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
3872 C**
3873 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
3874 C   93      ZDAY      ADD  1         ZDAY
3875 C**
3876 C**   FORMAT DATE, DDMMYY OR MMDDYY.
3877 C  N98                MOVELZDAY      ZWRK4   40
3878 C   98                MOVE ZDAY      ZWRK4
3879 C  N98                MOVE ZMTH      ZWRK4
3880 C   98                MOVELZMTH      ZWRK4
3881 C                     MOVELZWRK4     ZDATE
3882 C                     MOVE ZYEAR     ZDATE
3883 C**
3884 C**   FORMAT ALPHA DATE, DDMMMYY.
3885 C           ZDAY      COMP 10                     95
3886 C                     MOVELZDAY      ZWRK5   5
3887 C   95                MOVEL' '       ZWRK5
3888 C                     MOVE ZMNM,ZMTH ZWRK5
3889 C                     MOVELZWRK5     ZADATE
3890 C                     MOVE ZYEAR     ZADATE
3891 C**
3892 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
3893 C********************************************************************
2586 C/EJECT
2585 C********************************************************************
     C*                                                                   106357
     C* AOBRCH - Subroutine to call access object : Branch details        106357
     C*                                                                   106357
     C           AOBRCH    BEGSR                           ** AOBRCH **   106357
     C*                                                                   106357
     C**********           CALL 'AOBRCHR0'                                106357              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM           @RTCD   7                       106357
     C                     PARM '*KEY   ' @OPTN   7                       106357
     C                     PARM           @DSNB   3                       106357
     C********** SDBRCH    PARM SDBRCH    DSFDY                           106357              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   106357
     C                     ENDSR                                          106357
     C********************************************************************106357
     C*                                                                   106357
     C* AOGELR - Subroutine to call access object : General Ledger        106357
     C*                                                                   106357
     C           AOGELR    BEGSR                           ** AOGELR **   106357
     C*                                                                   106357
     C**********           CALL 'AOGELRR0'                                106357              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       106357
     C                     PARM '*FIRST ' @OPTN   7                       106357
     C********** SDGELR    PARM SDGELR    DSFDY                           106357              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   106357
     C                     ENDSR                                          106357
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SRSTAX - Generate Stamp tax event type 49ST                  *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C                     MOVE 'N'       STAX    1                                           CER049
     C           *IN01     IFEQ *ON                                                           CER049
     C           IPTAX     ANDEQ'Y'                                                           CER049
     C                     MOVE 'Y'       STAX                                                CER049
     C                     MOVE IPSTAF    EAMT                                                CER049
     C                     ELSE                                                               CER049
     C           *IN02     IFEQ *ON                                                           CER049
     C           OTTAX     ANDEQ'Y'                                                           CER049
     C                     MOVE 'Y'       STAX                                                CER049
     C                     MOVE OTSTAF    EAMT                                                CER049
     C                     ELSE                                                               CER049
     C           *IN04     IFEQ *ON                                                           CER049
     C           QCTAX     ANDEQ'Y'                                                           CER049
     C                     MOVE 'Y'       STAX                                                CER049
     C                     MOVE QCSTAF    EAMT                                                CER049
     C                     ELSE                                                               CER049
     C           *IN05     IFEQ *ON                                                           CER049
     C           QPTAX     ANDEQ'Y'                                                           CER049
     C                     MOVE 'Y'       STAX                                                CER049
     C                     MOVE QPSTAF    EAMT                                                CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           STAX      IFEQ 'Y'                                                           CER049
     C                     MOVEL'49ST'    ETYP                                                CER049
     C                     MOVE 'O'       INOI                                                CER049
     C                     MOVE 'N'       IBRE                                                CER049
     C                     WRITEFPVNTDDF                                                      CER049
      *                                                                                       CER049
     C                     ADD  1         RECA,8                                              CER049
     C                     MOVE EAMT      ZZAMT                                               CER049
     C                     Z-ADDINTA,8    ZZTOTI                                              CER049
     C                     Z-ADDDECA,8    ZZTOTD                                              CER049
     C*                                                                                       CER049
     C                     EXSR GLZADD                                                        CER049
     C*                                                                                       CER049
     C                     Z-ADDZZTOTI    INTA,8                                              CER049
     C                     Z-ADDZZTOTD    DECA,8                                              CER049
      *                                                                                       CER049
      ** Also keep total of records written excluding regular payments amounts              MD039343
     C*                                                                                     MD039343
     C           PYTP      IFNE 'RP'                                                        MD039343
     C                     MOVE EAMT      ZZAMT                                             MD039343
     C                     Z-ADDINTA,9    ZZTOTI                                            MD039343
     C                     Z-ADDDECA,9    ZZTOTD                                            MD039343
     C*                                                                                     MD039343
     C                     EXSR GLZADD                                                      MD039343
     C*                                                                                     MD039343
     C                     Z-ADDZZTOTI    INTA,9                                            MD039343
     C                     Z-ADDZZTOTD    DECA,9                                            MD039343
     C                     END                                                              MD039343
     C*                                                                                     MD039343
      ** Generate inter branch events                                                         CER049
      *                                                                                       CER049
     C           BRCPTY    IFNE BRCA                                                          CER049
     C                     MOVE 'Y'       IBRE                                                CER049
     C                     WRITEFPVNTDDF                                                      CER049
      *                                                                                       CER049
     C                     ADD  1         RECA,8                                              CER049
     C                     MOVE EAMT      ZZAMT                                               CER049
     C                     Z-ADDINTA,8    ZZTOTI                                              CER049
     C                     Z-ADDDECA,8    ZZTOTD                                              CER049
     C                     EXSR GLZADD                                                        CER049
     C                     Z-ADDZZTOTI    INTA,8                                              CER049
     C                     Z-ADDZZTOTD    DECA,8                                              CER049
     C                     WRITEFPVNTDDF                                                      CER049
      *                                                                                       CER049
     C                     ADD  1         RECA,8                                              CER049
     C                     MOVE EAMT      ZZAMT                                               CER049
     C                     Z-ADDINTA,8    ZZTOTI                                              CER049
     C                     Z-ADDDECA,8    ZZTOTD                                              CER049
     C                     EXSR GLZADD                                                        CER049
     C                     Z-ADDZZTOTI    INTA,8                                              CER049
     C                     Z-ADDZZTOTD    DECA,8                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *                                                                                       CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
     C/COPY WNCPYSRC,FT0610C023
     C********************************************************************106357
2586 C*********************                                               S01195
2587 C*****ZFREQB-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A*                S01195
2588 C***************PERIOD*VALUE*DETERMINED*BY*A*CODE.*                  S01195
2589 C*********************                                               S01195
2590 C***********ZFREQB****BEGSR                           *** ZFREQB *** S01195
2591 C*********************                                               S01195
     C*****=====================================                          S01195
     C*****THIS*IS*NOT*A*STANDARD*SR*DO*NOT*COPY*                         S01195
     C*****=====================================                          S01195
     C*********************                                               S01195
2592 C*****CALCULATIONS*TO*DEFINE/CLEAR*FIELDS.*                          S01195
2593 C*********************MOVE ZFREQ     ZFREQ   1                       S01195
2594 C*********************Z-ADDZDAYNO    ZDAYNO  50                      S01195
2595 C*********************Z-ADDZMDAY     ZMDAY   20                      S01195
2596 C*********************MOVE ZCCY      ZCCY    3                       S01195
     C**LUX19**************                                               S01195
     C***********ZBEGIN****TAG                                            S01195
     C**LUX19**************                                               S01195
2597 C*********************                                               S01195
2598 C*********************MOVE '   '     ZHC                             S01195
2599 C*********************MOVE ' '       ZTABKY 12                       S01195
2600 C*********************                                               S01195
2601 C*************FIELDS*USED*FOR*PERIOD*CODES*M,T,Q,X,Y*                S01195
2602 C*********************                                               S01195
2603 C*********************MOVE '  '      ZINDE   2                       S01195
2604 C*********************Z-ADD0         ZINTO   20                      S01195
2605 C*********************                                               S01195
2606 C*****CONVERT*DAY*NUMBER*TO*DATE.*                                   S01195
2607 C*********************EXSR ZDATE2                                    S01195
2608 C*********************SETOF                     90                   S01195
2609 C*********************                                               S01195
2610 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*D-DAILY-WORKING*DAY.*         S01195
2611 C***********ZFREQ*****COMP 'D'                      91               S01195
2612 C***91******ZDAYNO****ADD  1         ZDAYNO                          S01195
2613 C***91****************GOTO ZFHCHK                                    S01195
2614 C*********************                                               S01195
2615 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*W-WEEKLY.*                    S01195
2616 C***********ZFREQ*****COMP 'W'                      91               S01195
2617 C***91******ZDAYNO****ADD  7         ZDAYNO                          S01195
2618 C***91****************GOTO ZFEND                                     S01195
2619 C*********************                                               S01195
2620 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*F-FORTNIGHTLY.*               S01195
2621 C***********ZFREQ*****COMP 'F'                      91               S01195
2622 C***91******ZDAYNO****ADD  14        ZDAYNO                          S01195
2623 C***91****************GOTO ZFEND                                     S01195
2624 C*********************                                               S01195
2625 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*S-SEMI-MONTHLY.*              S01195
2626 C***********ZFREQ*****COMP 'S'                      91               S01195
2627 C***91******ZDAY******COMP 15                   939292               S01195
2628 C***91*92*************Z-ADD31        ZDAY                            S01195
2629 C***91*93*************Z-ADD15        ZDAY                            S01195
2630 C***91*93***ZMTH******ADD  1         ZMTH                            S01195
2631 C***91****************GOTO ZFDATE                                    S01195
2632 C*********************                                               S01195
2633 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*M-MONTHLY.*                   S01195
2634 C***********ZFREQ*****COMP 'M'                      91               S01195
2635 C***91****************MOVE 'IN'      ZINDE                           S01195
2636 C***91****************Z-ADDZMDAY     ZDAY                            S01195
2637 C***91******ZMTH******ADD  1         ZMTH                            S01195
2638 C***91****************GOTO ZFDATE                                    S01195
2639 C*********************                                               S01195
2640 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*R-SIX*DAYS*BEFORE*END*OF*MONTHS01195
2641 C***********ZFREQ*****COMP 'R'                      91               S01195
2642 C***91****************Z-ADD31        ZDAY                            S01195
2643 C***91******ZMTH******ADD  1         ZMTH                            S01195
2644 C***91****************GOTO ZFDATE                                    S01195
2645 C*********************                                               S01195
2646 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*T-BIMONTHLY.*                 S01195
2647 C***********ZFREQ*****COMP 'T'                      91               S01195
2648 C***91****************MOVE 'IN'      ZINDE                           S01195
2649 C***91****************Z-ADDZMDAY     ZDAY                            S01195
2650 C***91******ZMTH******ADD  2         ZMTH                            S01195
2651 C***91****************GOTO ZFDATE                                    S01195
2652 C*********************                                               S01195
2653 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*Q-QUARTERLY.*                 S01195
2654 C***********ZFREQ*****COMP 'Q'                      91               S01195
2655 C***91****************MOVE 'IN'      ZINDE                           S01195
2656 C***91****************Z-ADDZMDAY     ZDAY                            S01195
2657 C***91******ZMTH******ADD  3         ZMTH                            S01195
2658 C***91****************GOTO ZFDATE                                    S01195
2659 C*********************                                               S01195
2660 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*X-SIX*MONTHLY.*               S01195
2661 C***********ZFREQ*****COMP 'X'                      91               S01195
2662 C***91****************MOVE 'IN'      ZINDE                           S01195
2663 C***91****************Z-ADDZMDAY     ZDAY                            S01195
2664 C***91******ZMTH******ADD  6         ZMTH                            S01195
2665 C***91****************GOTO ZFDATE                                    S01195
2666 C*********************                                               S01195
2667 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*Y-YEARLY.*                    S01195
2668 C***********ZFREQ*****COMP 'Y'                      91               S01195
2669 C***91****************MOVE 'IN'      ZINDE                           S01195
2663 C***91****************Z-ADDZMDAY     ZDAY                            S01195
2670 C***91******ZYEAR*****ADD  1         ZYEAR                           S01195
2671 C***91****************GOTO ZFDATE                                    S01195
2672 C*********************                                               S01195
2673 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*L-LAST*CALENDAR*DAY*OF*MONTH.*S01195
2674 C***********ZFREQ*****COMP 'L'                      91               S01195
2675 C***91****************Z-ADD31        ZDAY                            S01195
2676 C***91******ZMTH******ADD  1         ZMTH                            S01195
2677 C***91****************GOTO ZFDATE                                    S01195
2678 C*********************                                               S01195
2679 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*B-LAST*WORKING*DAY*OF*MONTH.* S01195
2680 C***********ZFREQ*****COMP 'B'                      91               S01195
2681 C***91****************Z-ADD31        ZDAY                            S01195
2682 C***91******ZMTH******ADD  1         ZMTH                            S01195
2683 C***91****************GOTO ZFDATE                                    S01195
2684 C*********************                                               S01195
2685 C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*A-MONTHLY*ACCRUAL/PROFIT*DATE.S01195
2686 C***********ZFREQ*****COMP 'A'                      91               S01195
2687 C*********************MOVEL'01    '  ZTABKY                          S01195
2687 C***91****************MOVEL'01    '  ZTABKY                          S01195
2688 C***91****************MOVE '    11'  ZTABKY                          S01195
2689 C***91******ZTABKY****CHAINTABFP                99    ON NOT THERE   S01195
2690 C**N99******RECI******COMP '*'                      99               S01195
     C**LUX19**************                                               S01195
     C***91N99***APDA******IFLE ZDAYNO                                    S01195
     C*********************MOVE APFQ      ZFREQ                           S01195
     C*********************Z-ADDFDAY      ZMDAY                           S01195
     C*********************GOTO ZBEGIN                     ** ZBEGIN TAG**S01195
     C*********************END                                            S01195
     C**LUX19**************                                               S01195
2691 C***91N99*************Z-ADDAPDA      ZDAYNO                          S01195
2692 C*********************                                               S01195
2693 C*****BYPASS*IF*ZFREQ*IS*'A'*OR*ANY*OTHER*VALUE*                     S01195
2694 C*********************GOTO ZFEND                                     S01195
2695 C*********************                                               S01195
2696 C*********************                                               S01195
2697 C*****REFORMAT*DATE*AND*ENSURE*VALID.*                               S01195
2698 C***********ZFDATE****TAG                             ** ZFDATE TAG* S01195
2699 C*********************                                               S01195
2700 C*****VALIDATE*MONTH.*                                               S01195
2701 C***********ZMTH******COMP 12                   91                   S01195
2702 C***91******ZMTH******SUB  12        ZMTH                            S01195
2703 C***91******ZYEAR*****ADD  1         ZYEAR                           S01195
2704 C*********************                                               S01195
2705 C*****CHECK*FOR*LEAP*YEAR.*                                          S01195
2706 C***********ZYEAR*****DIV  4         ZLYR    20                      S01195
2707 C*********************MVR            ZLY     10     92LEAP YEAR-92 ONS01195
2708 C*********************                                               S01195
2709 C*****VALIDATE*DAY*NUMBER.*                                          S01195
2710 C*********************MOVE ZFMD,ZMTH ZWRK2   20                      S01195
2711 C***********ZMTH******COMP 2                        93               S01195
2712 C***92*93*************Z-ADD29        ZWRK2                           S01195
2713 C*********************                                               S01195
2714 C***********ZDAY******COMP ZWRK2                94                   S01195
2715 C***94****************Z-ADDZWRK2     ZDAY                            S01195
2716 C*********************                                               S01195
2717 C*****CHECK*IF*CODE*R,*TO*SUBTRACT*6*DAYS.*                          S01195
2718 C***********ZFREQ*****COMP 'R'                      91               S01195
2719 C***91******ZDAY******SUB  6         ZDAY                            S01195
2720 C*********************                                               S01195
2721 C*****REFORMAT*DATE,*DDMMYY*OR*MMDDYY,*AND*CONVERT*TO*DAY*NUMBER.*   S01195
2722 C*********************MOVELZDAY      ZWRK4   40                      S01195
2723 C*********************MOVE ZMTH      ZWRK4                           S01195
2724 C***98****************MOVELZMTH      ZWRK4                           S01195
2725 C***98****************MOVE ZDAY      ZWRK4                           S01195
2726 C*********************MOVELZWRK4     ZDATE                           S01195
2727 C*********************MOVE ZYEAR     ZDATE                           S01195
2728 C*********************EXSR ZDATE1                                    S01195
2729 C*********************                                               S01195
2730 C*****CHECK*IF*CODE*B,*OR*M,T,Q,X,Y*TO*BE*CHECKED*FOR*HOLIDAY.*      S01195
2731 C***********ZFREQ*****COMP 'B'                      91               S01195
2732 C***********ZINDE*****COMP 'IN'                     92               S01195
2733 C***92N99*************                                               S01195
2734 C*OR*91N99*************GOTO ZFHCHK                                   S01195
2735 C*********************                                               S01195
2736 C*********************GOTO ZFEND                                     S01195
2737 C*********************                                               S01195
2738 C*****CHECK*IF*DAY*NUMBER*IS*A*HOLIDAY.*                             S01195
2739 C*********************                                               S01195
2740 C***********ZFHCHK****TAG                             ** ZFHCHK TAG *S01195
2741 C*********************SETOF                     94                   S01195
2742 C***********ZFREQ*****COMP 'D'                      91               S01195
2743 C***********ZFREQ*****COMP 'B'                      92               S01195
2744 C***91****************                                               S01195
2745 C*OR*92****************GOTO ZSETK                                    S01195
2746 C*********************                                               S01195
2747 C****FOR*CODES*M,T,Q,X,Y,*CHECK*ZINDE*-*'IN'*TO*INCREMENT,*          S01195
2748 C*************************************-*'DE'*TO*DECREMENT*           S01195
2749 C*********************                                               S01195
2750 C***********ZINDE*****COMP 'IN'                     90               S01195
2751 C***********ZINDE*****COMP 'IN'                     91               S01195
2752 C***********ZINDE*****COMP 'DE'                     92               S01195
2753 C*********************                                               S01195
2754 C*****SET*KEY*FOR*FIRST*HOLIDAY*RECORD.*                             S01195
2755 C***********ZSETK*****TAG                             ** ZSETK TAG **S01195
2756 C*********************MOVEL'22    '  ZTABKY                          S01195
2757 C*********************MOVELZDAYNO    ZWRK6   6                       S01195
2758 C*********************MOVE 1         ZWRK6                           S01195
2759 C*********************MOVE ZWRK6     ZTABKY                          S01195
2760 C*********************                                               S01195
2761 C*****GET*HOLIDAY*RECORD.*                                           S01195
2762 C***********ZFHCHN****TAG                             ** ZFHCHN TAG* S01195
2763 C***********ZTABKY****CHAINTABFP                93    ON NOT THERE   S01195
2764 C**N93******RECI******COMP '*'                      93               S01195
     C**N94****************MOVE '   '     ZHC                             S01195
2765 C*********************                                               S01195
2766 C*****STORE*CURRENCIES*IF*RECORD*FOUND.*                             S01195
2767 C**N94N93*************MOVEAHCCY      ZHC,1                           S01195
2768 C***94N93*************MOVEAHCCY      ZHC,26                          S01195
2769 C*********************                                               S01195
2770 C*****GET*SECOND*RECORD,*IF*NOT*ALREADY*DONE.*                       S01195
2771 C*********************MOVE ZTABKY    ZWRK1N  10                      S01195
2772 C***********ZWRK1N****COMP 1                        94               S01195
2773 C*********************MOVE '2'       ZTABKY                          S01195
2774 C***94N93*************GOTO ZFHCHN                                    S01195
2775 C*********************                                               S01195
2776 C*****BYPASS*TO*END*IF*NO*FIRST*RECORD*FOUND.*                       S01195
2777 C***93*94*************GOTO ZFEND                                     S01195
2778 C*********************                                               S01195
2779 C*****DETERMINE*HOLIDAY*RECORD*TYPE.*                                S01195
2780 C***********INEX******COMP 'E'                      95               S01195
2781 C***********INEX******COMP 'I'                      96               S01195
2782 C*********************                                               S01195
2783 C*****CHECK*IF*CURRENCY*ON*HOLIDAY.*                                 S01195
2784 C***********ZCCY******LOKUPZHC                      97               S01195
2785 C*********************                                               S01195
2786 C*****BYPASS*IF*NOT*HOLIDAY*FOR*CURRENCY.*                           S01195
2787 C***95*97*************                                EXCLUDE FOUND  S01195
2788 C*R*96N97*************GOTO ZFEND                      INCL. NOT FOUNDS01195
2789 C*********************                                               S01195
2790 C*********************                                               S01195
2791 C***92****************GOTO ZDECR                                     S01195
2792 C*********************                                               S01195
2793 C*****INCREMENT*OR*DECREMENT*DAY*NUMBER*AS*REQUIRED.*                S01195
2794 C***91******ZDAYNO****ADD  1         ZDAYNO                          S01195
2795 C*********************                                               S01195
2796 C*****ONLY*FOR*PERIOD*CODE*=*M,T,Q,X*OR*Y,*IF*INCREMENTATION*        S01195
2797 C*****TAKES*THE*OUTPUT*DATE*INTO*THE*FOLLOWING*MONTH,*RETURN*TO*     S01195
2798 C*****THE*INPUT*DATE*AND*DECREMENT*-*92*ON.*                         S01195
2799 C*********************                                               S01195
2800 C***90*91***ZINTO*****ADD  1         ZINTO                           S01195
2801 C***90*91***ZINTO*****ADD  ZDAY      ZINTOT  20                      S01195
2802 C***90*91*************MOVE ZINTOT    ZINTOA  2                       S01195
     C**TO*ALLOW*29*FEB*ON*LEAP*YEARS*TO*PASS*                            S01195
     C*********************SETOF                     93                   S01195
     C***90*91***ZYEAR*****DIV  4         ZLYR                            S01195
     C***90*91*************MVR            ZLY            92               S01195
     C***90*91*92ZMTH******COMP 2                        93               S01195
     C***93******ZINTOA****COMP '29'                 92                   S01195
     C***90*91N93ZINTOA****COMP ZFMD,ZMTH            92                   S01195
2803 C***90*91***ZINTOA****COMP ZFMD,ZMTH            92                   S01195
2804 C***90*91*92ZDAYNO****SUB  ZINTO     ZDAYNO                          S01195
2805 C***90*91*92**********MOVE 'DE'      ZINDE                           S01195
2806 C*********************                                               S01195
2807 C***********ZDECR*****TAG                             ** ZDECR TAG **S01195
2808 C***92*95N97**********                                EXCL. NOT FOUNDS01195
2809 C*R*92*96*97ZDAYNO****SUB  1         ZDAYNO           INCLUDE FOUND  S01195
2810 C*********************GOTO ZFHCHK                                    S01195
2811 C*********************                                               S01195
2812 C*********************                                               S01195
2813 C***********ZFEND*****ENDSR                           * ZFEND ENDSR *S01195
2814 C*********************                                               S01195
2815 C********************************************************************
4551 C*********************                                               S01195
4552 C*****ZTXDAY*SR.*TO*CALCULATE*ANY*NUMBER*OF*DAYS*FORWARD*THAT*ARE*   S01195
4553 C****************WORKING*DAYS*IN*BOTH*THE*LOCAL*CURRENCY*AND*ANY*    S01195
4554 C****************SPECIFIED*CURRENCY.*                                S01195
4555 C*********************                                               S01195
4556 C*********THIS*SR.*CAN*BE*USED*WHEN*THE*INPUT*CYCLE*IS*RUNNING*AS*   S01195
4557 C*********HOLIDAY*RECORDS*ARE*ACCESSED*BY*CHAIN.*THEREFORE*NEWLY*    S01195
4558 C*********ADDED*RECORDS*IN*THE*OVERFLOW*AREA*CAN*ALSO*BE*ACCESSED.*  S01195
4559 C*********************                                               S01195
4560 C***********ZTXDAY****BEGSR                           *** ZTXDAY *** S01195
4561 C*********************                                               S01195
4562 C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.*                          S01195
4563 C*********************Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  S01195
4564 C*********************MOVE ZCCY      ZCCY    3        DATE CURRENCY  S01195
4565 C*********************Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING S01195
4566 C*****LOCY*DEFINED*ON*TABLE,TB-11;**AND*SHOULD*ALREADY*HAVE*         S01195
4567 C*****BEEN*INPUT.*****                                               S01195
4568 C*********************                                DAYS FORWARD   S01195
4569 C*****CLEAR*COUNT*OF*NBR*OF*DAYS*ADDED,*&*DEFINE*ZDYNBR.*            S01195
4570 C*********************Z-ADD0         ZDCNT   20                      S01195
4571 C*********************Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C******SEE*MANUAL*ON*SYSTEM*SUBROUTINES*                             S01195
     C******IF*ZNRDYS*IS*INPUT*AS*ZERO*IT*WILL*NOW*BE*TREATED*AS*ZERO.*   S01195
     C******FIRST*CHECK*FOR*ZERO*NOTICE*DAYS*                             S01195
     C***********ZNRDYS****COMP 0                        95       T1973   S01195
     C***95****************GOTO ZTXEND                                    S01195
4572 C*********************                                               S01195
4573 C*****LOOP*TO*INCREMENT*DAY*NUMBER*AND*CHECK*FOR*HOLIDAY.*           S01195
4574 C***********ZTLOP1****TAG                             ** ZTLOP1 TAG *S01195
4575 C*********************                                               S01195
4576 C*********************SETOF                     9596                 S01195
4577 C***********ZDYNBR****ADD  1         ZDYNBR                          S01195
4578 C*********************                                               S01195
4579 C*****SET*KEY*FOR*FIRST*HOLIDAY*RECORD.*                             S01195
4580 C*********************MOVEL'22    '  ZDHKEY 12                       S01195
4581 C*********************MOVELZDYNBR    ZWRK6   6                       S01195
4582 C*********************MOVE '1'       ZWRK6                           S01195
4583 C*********************MOVE ZWRK6     ZDHKEY                          S01195
4584 C*********************                                               S01195
4585 C*****CHAIN*FOR*HOLIDAY*RECORD,*RECORD*1*OR*2*                       S01195
4586 C***********ZTHCHN****TAG                             ** ZTHCHN TAG *S01195
4587 C*********************                                               S01195
4588 C***********ZDHKEY****CHAINTABFP                90    ON NOT THERE   S01195
4589 C**N90******RECI******COMP 'D'                  9090  DELETED        S01195
4590 C*********************                                               S01195
4591 C*****NO*RECORD*1*FOUND,*IS*NOT*A*HOLIDAY*                           S01195
4592 C***90N95*************GOTO ZTOAGN                                    S01195
4593 C*********************                                               S01195
4594 C*****NO*RECORD*2*FOUND*                                             S01195
4595 C***90*95*96**********GOTO ZTLOP1                     EXC. NOT FOUND S01195
4596 C***90*95N96**********GOTO ZTOAGN                     INC. NOT FOUND S01195
4597 C*********************                                               S01195
4598 C*****DETERMINE*TYPE*FOUND,*INCLUDE*OR*EXCLUDE*                      S01195
4599 C***********INEX******COMP 'E'                  92  91               S01195
4600 C*********************                                               S01195
4601 C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.*                         S01195
4602 C***********ZCCY******LOKUPHCCYA                    93               S01195
4603 C**N93******LOCY******LOKUPHCCYA                    93               S01195
4604 C***91*93*************GOTO ZTOAGN                     EXCLUDE FOUND  S01195
4605 C***92*93*************GOTO ZTLOP1                     INCLUDE FOUND  S01195
4606 C*********************                                               S01195
4607 C*****IF*EXCLUDE*OR*INCLUDE*NOT*FOUND*CHECK*                         S01195
4608 C*****FOR*SECOND*HOLIDAY*RECORD,*IF*REQUIRED.*                       S01195
4609 C***********'***'*****LOKUPHCCYA                    94ON IF NO RCD.2 S01195
4610 C*********************MOVE ZDHKEY    ZWRK1   1                       S01195
4611 C***********ZWRK1*****COMP '1'                      95               S01195
4612 C***91*95*************SETON                     96                   S01195
4613 C***95N94*************MOVE '2'       ZDHKEY                          S01195
4614 C***95N94*************GOTO ZTHCHN                     GET SECOND REC S01195
4615 C*********************                                               S01195
4616 C***91****************GOTO ZTLOP1                     EXC. NOT FOUND S01195
4617 C***92****************GOTO ZTOAGN                     INC. NOT FOUND S01195
4618 C*********************                                               S01195
4619 C*****INCREMENT*COUNT*AND*CHECK*IF*REQUIRED*NUMBER*OF*DAYS*          S01195
4620 C*****HAVE*BEEN*ADDED.*IF*NOT,*GO*THROUGH*LOOP1*AGAIN.*              S01195
4621 C***********ZTOAGN****TAG                             ** ZTOAGN TAG *S01195
4622 C*********************                                               S01195
4623 C***********ZDCNT*****ADD  1         ZDCNT                           S01195
4624 C***********ZDCNT*****COMP ZNRDYS                 97                 S01195
4625 C***97****************GOTO ZTLOP1                                    S01195
4626 C*********************                                               S01195
4627 C***********ZTXEND****ENDSR                            *** ZTXEND ***S01195
4628 C*********************                                               S01195
4629 C*********************                                               S01195
4630 C********************************************************************
     C/COPY ZSRSRC,ZACCH                                                  S01195
*******C/COPY ZSRSRC,ZCHKH                                          S01195062394
     C/COPY ZSRSRC,ZFWDT                                                  S01195
*******C/COPY ZSRSRC,ZFREQBZ2                                       S01195062394
2814 C/EJECT
     C*
     O**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                           062394
     O**312831303130313130313031                                          062394
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
