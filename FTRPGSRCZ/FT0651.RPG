     H        1   D                       F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Advice of payment - non input cycle')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Funds Transfer Module                                *
     F*                                                               *
     F*  FT0651 - Advice of Payments - End of Day                     *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 AR1014574          Date 03Dec12               *
      *                 260987A            Date 09Nov12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG7985            Date 17Aug05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 222385             Date 23Oct03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 138077             Date 22Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 01Jun00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSW020            DATE  11JAN00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 164663             DATE 25AUG99               *
     F*                 151235             DATE 21DEC98               *
     F*                 149197             DATE 08DEC98               *
     F*                 CEU006             DATE 07APR98               *
     F*                 113352             DATE 29JAN97               *
     F*                 S01408             DATE 18NOV96               *
     F*                 CSW096             DATE 03JUN96               *
     F*                 S01408             DATE 10JAN96               *
     F*                 094278             DATE 17OCT95               *
     F*                 088545             DATE 21JUN95               *
     F*                 S01499             DATE 06JUN94               *
     F*                 068367             DATE 18MAR94               *
     F*                 068242             DATE 16MAR94               *
     F*                 064393             DATE 08DEC93               *
     F*                 S01414             DATE 29MAR93               *
     F*                 050198             DATE 03FEB93               *
     F*                 S01310             DATE 17MAY91               *
     F*                 S01194             DATE 12SEP90               *
     F*                 S01117             DATE 12SEP90               *
     F*                 E22406             DATE 10JUL90               *
     F*                 E21461             DATE 30APR90               *
     F*                 E21286             DATE 01MAR90               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  AR1014574 - Pattern 244833 to update NWRK and MGSG for RBKT= *
      *              A. Update MGST to PRTD for RBKT=A.               *
      *              (Child: AR1014575)                               *
      *  260987A - Destination not always displayed on the report.    *
      *            Fields omitted on write to MGOREFPD. Wrong Sender  *
      *            address when network is Paper.                     *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG7985 - Do not access TABLETR instead access AOBRCHR1.     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  138077 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *         - Allow messages to have expansion even if it starts  *
      *           with "/".                                           *
     F*  CFT009 - FT Fees and Charge Development-Recompiled           *
      *   CDL008 - Continuous Linked Settlement (Recompiled MGOREFPD) *
     F*  CSW020 - SWIFT Decimal Places                                *
     F*           Adjust the amount if the Swift decimal places       *
     F*           differs from the currency decimal places            *
     F*  164663 - Extension of fix 141572 to setup CINDV (Century     *
     F*           indicator for Value Date) for Y2K display problem.  *
     F*  151235 - Extend fix 149197 to cater for /CHGS/ swiftcode.    *
     F*           Format field 72:/CHGS/xxxxxxx, swiftcode line with a*
     F*           final '/'.                                          *
     F*  149197 - Format field 72:/OCMT/xxxnnnn, swiftcode line with a*
     F*           final '/'.                                          *
     F*  CEU006 - EMU Settlement Details. Include /OCMT/ on Bank      *
     F*           to Bank Info where necessary                        *
     F*     113352 - Set-up CIND (Century Flag) to correct year 2000  *
     F*              display problem.                                 *
     F*  S01408 - Addition of core hook FT0651CCP4                    *
     F*           Addition of core hook FT0651CCP3                    *
     F*           Addition of core hook FT0651CCP2                    *
     F*           Addition of core hook FT0651CCP1                    *
     F*  CSW096 - SWIFT changes 1996                                  *
     F*  S01408 - Core hook FT0651OOP1 added                          *
     F*  094278 - Allow SWIFT address in Remitting Bank               *
     F*  088545 - If there is no message status default for that      *
     F*           message type for the involved customer,             *
     F*           default the message status with the ICD.            *
     F*  S01499 - BLI V.A.T. Processing                               *
     F*  068367 - Ensure Priority and Delivery Notification fields    *
     F*           are a valid combination.                            *
     F*  068242 - Remove COMIT on MG files                            *
     F*  064393 - GET SENDERS TID FROM BRANCH NOT CUSTOMER.           *
     F*  S01414 - Book Code and Profit Centre Incorporation.          *
     F*           Rename of profit centre field on ACCNTABF           *
     F*  050198 - Swift MT400 messages were being generated instead of*
     F*           a Telex Advice when an alpha address was entered for*
     F*           the Remitting Bank - due to no code provided for a  *
     F*           Remitting Bank Type of 'A'. Also include code for   *
     F*           Remitting Bank Type of 'G'.                         *
     F*  S01310 - SWIFT RATIONALISATION.                              *
     F*  S01194 - NEW DATABASE ERROR HANDLING                         *
     F*  S01117 - REPORT CONTROL FACILITY                             *
     F*  S01117 - FUNDS TRANSFER DEFAULT BRANCH REMOVAL AND           *
     F*           CHANGE OF INTERBRANCH ENTRIES                       *
     F*  E22406 - TERMINAL IDENTIFICATION REMOVAL.                    *
     F*  E21461 - FIELD :32B: OUTPUT TO MSMSOPF WITH BLANKS BEFORE    *
     F*           CCY SUBFIELD.                                       *
     F*  E21286 - OUTPUT FILE CONTROLS TO FTFCTL INSTEAD OF           *
     F*           MSFCTL.                                             *
     F*           (THIS IS THE RE-APPLICATION OF E17216 WHICH WAS     *
     F*           OVERWRITTEN)                                        *
     F*****************************************************************
     FPRFP3   IP  E           K        DISK
     F*CLINT***IF**E***********K********DISK                              S01310
     F************CLINTCAF**************************KIGNORE               S01310
     F************CLINTC1F**************************KIGNORE               S01310
     FACNUMA  IF  E           K        DISK
     F*MSIXOPF*O***E********************DISK**********************A       S01310
     F*MSMSOPF*O***E***********K********DISK**********************A       S01310
     F*MGOREFPDO***E*                   DISK         KCOMIT       A S01310068242
     F*MGOMSGPDO***E*          K        DISK         KCOMIT       A S01310068242
     FMGOEXTPDO   E                    DISK                               138077
     FMGOREFPDO   E                    DISK                      A        068242
     FMGOMSGPDO   E           K        DISK                      A        068242
     F*
     F*FT0651P3O***E********************PRINTER                           S01117
     F*FT0651P1O***E********************PRINTER                           S01117
     F*FT0651P2O***E********************PRINTER                           S01117
     FFT0651AUO   E                    PRINTER      KINFDS SPOOLU         S01117
     FFT0651P1O   E                    PRINTER      KINFDS SPOOL1         S01117
     FFT0651P2O   E                    PRINTER      KINFDS SPOOL2         S01117
     FSDBRCHL5IF  E           K        DISK                               E22406
     FTABFP   IF  E           K        DISK
     F            TABTB20F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F************TABLETJF                          KIGNORE               S01117
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F*
     F/EJECT
     F*
     F****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F****************************************************************
     F*                                                              *
     F*       09        UNSUCCESSFUL CHAIN TO SDBRCHL5.              *    E22406
     F*       10        UNSUCCESSFUL CHAIN TO TABFP.                 *
     F*       11        UNSUCESSFUL CHAIN TO ACNUMA                  *
     F********12********UNSUCESSFUL CHAIN TO CLINT                        S01310
     F*       13        INPUT CYCLE.                                 *
     F*       14        CHANGE OF CURRENCY.                          *
     F*       15        CHANGE OF DATE.                              *
     F*       16        LOKUP operation searching array (DFS)        *    S01310
     F*       17        LOKUP operation searching array (DFS)        *    S01310
     F*       18        LOKUP operation searching array (DFS)        *    S01310
     F*       20        CALL OF SR01 FOR DESTINATION OF MESSAGE      *
     F********25********DONT UPDATE MSFCTL FOR TELEX MESSGAE         *    S01310
     F*       30-33     DECIMAL PLACES ON AMOUNT>                    *
     F*       40        FIRST CYCLE COMPLETED.                       *
     F********41********UNSUCESSFUL*WRITE*MSIXOPFF                   *    S01310
     F********42********UNSUCESSFUL*WRITE*MSMSOPFF                   *    S01310
     F*       41        UNSUCESSFUL WRITE MGOREFPD                   *    S01310
     F*       42        UNSUCESSFUL WRITE MGOMSGPD                   *    S01310
     F*       50        MULTIBRANCH INDICATOR ACTIVE                 *    S01117
     F*       80        GENERAL ERROR INDICATOR.                     *
     F*                                                              *
     F*       U7        ) DATA BASE                                  *
     F*       U8        ) ERROR.                                     *
     F*             LR  LAST RECORD (TERMINATE PROGRAM).             *
     F*                                                              *
     F*  N.B:- 90-99    STANDARD SUBROUTINE INDICATORS.              *
     F****************************************************************
     F*
     F/EJECT
     E                    CPY@    1   1 80
     E*
     E                    MTH    12  12  3               MONTH  SR. ARRAY
     E                    AMT        13  1               AMOUNT ARRAY
     E                    AM         14  1               EDITED AMOUNT ARR
     E                    AR         14  1               ED AMNT ARR L-ADJ
     E                    ADDR        6 35               NAME/ADDRESS  ARR
     E                    DFS        15  3               default status   S01310
     E                    @STR       24  1               String formatting149197
      *
     E/EJECT
     I*CLINTCBF****70                                                     S01310
     I**************SWTX                            SWTXRN                S01310
     I*                                                                   S01414
     I* Rename of ACCNT/ACNUMA Profit Centre to avoid overwriting         S01414
     I*                                                                   S01414
     IACCNTABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01414
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   CEU006
      * Field :72: data structure - Original Currency & Amount            CEU006
     IOCMT        DS                             35                       CEU006
     I I            '/OCMT/'                  1   6 O#CDWD                CEU006
     I                                        7   9 O#CCY                 CEU006
     I                                       10  24 O#AMNT                CEU006
     I                                        1  24 O#OCMT                149197
      *                                                                   CEU006
      * Field :72: data structure - Charges                               CEU006
     ICHGS        DS                             35                       CEU006
     I I            '/CHGS/'                  1   6 C#CDWD                CEU006
     I                                        7   9 C#CCY                 CEU006
     I                                       10  24 C#AMNT                CEU006
     I                                        1  24 C#CHGS                151235
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     ISPOOL1      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     ISPOOL2      DS                                                      S01117
     I* FILE INFORMATION DATA STRUCTURE                                   S01117
     I                                       83  92 SFILE2                S01117
     I                                    B 123 1240SFNUM2                S01117
     I*                                                                   S01117
     IRUNDAT      DS                             13                       S01117
     I* DATA STRUCTURE TO RETRIEVE MULTIBRANCH INDICATOR                  S01117
     I                                       13  13 MBIN                  S01117
     IEXTN        DS                         45                           138077
     I                                        1   20MPSN                  138077
     I                                        3   7 MTG                   138077
     I                                        8  15 MCSI                  138077
      *                                                                   138077
      **  Multiple occurrence data structure for extension file           138077
      *                                                                   138077
     I            DS                                                      138077
     I                                        1   5 @MTG                  138077
     I                                        2   2 FLDTYP                138077
     I                                        4   4 FLDTAG                138077
      *                                                                   138077
      **  Field tag data structure                                        138077
      *                                                                   138077
     I*
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-1   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4001                S01310
     I************                            1   1 M1HEAD                S01310
     I************                            2   3 M1CRL1                S01310
     I************                            4  15 M1OTID                S01310
     I************                           22  23 M1CRL2                S01310
     I************                           24  26 M1MSGT                S01310
     I************                           28  29 M1MSGP                S01310
     I************                           30  31 M1CRL3                S01310
     I************                           32  43 M1RADD                S01310
     I************                           44  45 M1CRL4                S01310
     I************                           46  49 M1TG15                S01310
     I************                           66  67 M1CRL5                S01310
     I************                           68  71 M1TG20                S01310
     I************                           72  87 M1TREF                S01310
     I************                           88  89 M1CRL6                S01310
     I************                           90  93 M1TG21                S01310
     I************                           94 109 RBKR1                 S01310
     I************                          110 111 M1CRL7                S01310
     I************                          112 116 M1TG32                S01310
     I**********                            123 125 M1RCCY          E21461S01310
     I**********                            126 140 M1AMT2          E21461S01310
     I************                          117 119 M1RCCY          E21461S01310
     I************                          120 134 M1AMT2          E21461S01310
     I************                          141 142 M1CR7A                S01310
     I************                          143 147 M1TG33                S01310
     I************                          148 153 M1VDT2                S01310
     I************                          154 156 M1RCY2                S01310
     I************                          157 171 M1AMNT                S01310
     I************                          172 173 M1CRL8                S01310
     I************                          174 176 M1TG53                S01310
     I************                          177 177 M1SCTT                S01310
     I************                          178 178 M1COLN                S01310
     I************                          179 215 M1SCR1                S01310
     I************                          216 217 M1CRL9                S01310
     I************                          218 252 M1SCR2                S01310
     I************                          253 254 M1CRLA                S01310
     I************                                                        S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-2   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4002                S01310
     I************                            1  35 M2SCR3                S01310
     I************                           36  37 M2CRL1                S01310
     I************                           38  72 M2SCR4                S01310
     I************                           73  74 M2CRL2                S01310
     I************                           75 109 M2SCR5                S01310
     I************                          110 111 M2CRL3                S01310
     I************                          112 114 M2TG54                S01310
     I************                          115 115 M2RCTT                S01310
     I************                          116 116 M2COLN                S01310
     I************                          117 153 M2RCR1                S01310
     I************                          154 155 M2CRL4                S01310
     I************                          156 190 M2RCR2                S01310
     I************                          191 192 M2CRL5                S01310
     I************                          193 227 M2RCR3                S01310
     I************                          228 229 M2CRL6                S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-3   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4003                S01310
     I************                            1  35 M3RCR4                S01310
     I************                           36  37 M3CRL1                S01310
     I************                           38  72 M3RCR5                S01310
     I************                           73  74 M3CRL2                S01310
     I************                           75  77 M3TG57                S01310
     I************                           78  78 M3ABTT                S01310
     I************                           79  79 M3COLN                S01310
     I************                           80 116 M3AWB1                S01310
     I************                          117 118 M3CRL3                S01310
     I************                          119 153 M3AWB2                S01310
     I************                          154 155 M3CRL4                S01310
     I************                          156 190 M3AWB3                S01310
     I************                          191 192 M3CRL5                S01310
     I************                          193 227 M3AWB4                S01310
     I************                          228 229 M3CRL6                S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-4   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4004                S01310
     I************                            1  35 M4AWB5                S01310
     I************                           36  37 M4CRL1                S01310
     I************                           38  41 M4TG71                S01310
     I************                           42  76 DCH1A                 S01310
     I************                           77  78 M4CRL2                S01310
     I************                           79 113 DCH2A                 S01310
     I************                          114 115 M4CRL3                S01310
     I************                          116 150 DCH3A                 S01310
     I************                          151 152 M4CRL4                S01310
     I************                          153 187 DCH4A                 S01310
     I************                          188 189 M4CRL5                S01310
     I************                          190 224 DCH5A                 S01310
     I************                          225 226 M4CRL6                S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-5   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4005                S01310
     I************                            1  35 DCH6A                 S01310
     I************                           36  37 M5CRL1                S01310
     I************                           38  41 M5TG72                S01310
     I************                           42  76 BBI1A                 S01310
     I************                           77  78 M5CRL2                S01310
     I************                           79 113 BBI2A                 S01310
     I************                          114 115 M5CRL3                S01310
     I************                          116 150 BBI3A                 S01310
     I************                          151 152 M5CRL4                S01310
     I************                          153 187 BBI4A                 S01310
     I************                          188 189 M5CRL5                S01310
     I************                          190 224 BBI5A                 S01310
     I************                          225 226 M5CRL6                S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-6   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4006                S01310
     I************                            1  35 BBI6A                 S01310
     I************                           36  37 M6CRL1                S01310
     I************                           38  41 M6TG73                S01310
     I************                           42  76 DAA1A                 S01310
     I************                           77  78 M6CRL2                S01310
     I************                           79 113 DAA2A                 S01310
     I************                          114 115 M6CRL3                S01310
     I************                          116 150 DAA3A                 S01310
     I************                          151 152 M6CRL4                S01310
     I************                          153 187 DAA4A                 S01310
     I************                          188 189 M6CRL5                S01310
     I************                          190 224 DAA5A                 S01310
     I************                          225 226 M6CRL6                S01310
     I************                                                        S01310
     I************DS                                                      S01310
     I********************************************************            S01310
     I********DATA*STRUCTURE*TO*BUILD*BANK*TRANSFER          *            S01310
     I*********RECORDS*OUTGOING*SWIFT*MESSAGE*TYPE*MT400-7   *            S01310
     I********************************************************            S01310
     I************                            1 256 MT4007                S01310
     I************                            1  35 DAA6A                 S01310
     I************                           36  37 M7CRL1                S01310
     I************                           38  38 M7HYPH                S01310
     I************                           39  39 M7ETX                 S01310
      *                                                                   CSW096
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for output parameter                              CSW096
      *                                                                   CSW096
     I*
     I            DS
     I*
     I**********************************************
     I*       DATA STRUCTURE TO SAVE FIELDS FROM   *
     I*        INSTALLATION CONTROL DATA AREA.     *
     I**********************************************
     I*
     I****************************************1   30SDFBR                 S01117
     I                                        4  15 SCSID
     I                                       12  12 CSID9
     I                                       13  13 CSID10
     I                                       14  14 CSID11
     I                                       15  15 CSID12
     I*
     I*
     I**********************************************
     I*   DATA STRUCTURE TO HANDLE THE CONVERSION  *
     I*   OF DATE FORMAT YYMMDD TO DDMMMYY.        *
     I**********************************************
     I            DS
     I                                        1   60SDATE
     I                                        1   2 SYY
     I                                        3   40SMM
     I                                        5   6 SDD
     I            DS
     I                                        1   7 WDATE
     I                                        1   2 WDD
     I                                        3   5 WMM
     I                                        6   7 WYY
     I*
     I**********************************************
     I*   DATA STRUCTURE TO MANIPULATE AMOUNT      *
     I**********************************************
     I            DS
     I                                        1  130WAMNT
     I                                        1  13 RAMNT
     I* FOR EDITING ON THE REPORT
     I                                        1  130P2AMT0
     I                                        1  130P2AMT1
     I                                        1  130P2AMT2
     I                                        1  130P2AMT3
     I*
     I**********************************************
     I*   DATA STRUCTURE TO ELIMINATE BLANK LINES  *
     I**********************************************
     IOFSPT       DS                            210
     I                                        1  35 OFSPT1
     I                                       36  70 OFSPT2
     I                                       71 105 OFSPT3
     I                                      106 140 OFSPT4
     I                                      141 175 OFSPT5
     I                                      176 210 OFSPT6
     I*
     I*
     I**********************************************
     I*       DATA STRUCTURE USED IN THE EVENT     *
     I*                    OF DATABASE ERRORS.     *
     I**********************************************
     I*
     IDLDA        DS                            256
     I**************************************134 138 DBFILE                S01194
     I**************************************139 167 DBKEY                 S01194
     I**************************************168 175 DBPGM                 S01194
     I**************************************176 177 DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*
     I**********************************************
     I****DATA*STRUCTURE*USED*IN*UPDATING*OTHER    *                      S01310
     I****MESSAGES*COUNT*IN*DATA*AREA*MSFCTL*.************************    E21286
     I****MESSAGES*COUNT*IN*DATA*AREA*FTFCTL*.     *                E21286S01310
     I**********************************************                      S01310
     I**********                                                          S01310
     I*FCTL       DS                            256                       S01310
     I**********                          P  91  930DFOMC                 S01310
     I**********                          P  94  960DFOTL                 S01310
     I*
     I**********************************************
     I*       DATA STRUCTURE - PROGRAM STATUS      *
     I**********************************************
     I*
     I/COPY WNCPYSRC,FT0651I001
     IPSDS       SDS
     I                                      254 263 USRID
     I/COPY WNCPYSRC,FT0651I002
     I*********************************************
     I********DATA*STRUCTURE*TO*CONTAIN           *                       S01310
     I*************HEX*FIELDS                     *                       S01310
     I*********************************************
     I*
     I************DS                                                      S01310
     I************                        B   1   20B0D                   S01310
     I************                            2   2 X0D                   S01310
     I************                        B   3   40B25                   S01310
     I************                            4   4 X25                   S01310
     I************                        B   5   60B01                   S01310
     I************                            6   6 X01                   S01310
     I************                        B   7   80B03                   S01310
     I************                            8   8 X03                   S01310
     I************                            9  10 X0D25                 S01310
      *                                                                   S01310
     I            DS                                                      S01310
     I                                        1  24 DS32                  S01310
     I                                        1   3 M1RCCY                S01310
     I                                        4  18 M1AMT2                S01310
      **  Data structure for field 32 - currency/amount field             S01310
      *                                                                   S01310
     I            DS                                                      S01310
     I                                        1  24 DS33                  S01310
     I                                        1   6 M1VDT2                S01310
     I                                        7   9 M1RCY2                S01310
     I                                       10  24 M1AMNT                S01310
      **  Data structure for field 33 - date/currency/amount field        S01310
      *                                                                   S01310
     I            DS                                                      S01310
     I                                        1  12 CSID                  S01310
     I                                        9  11 @BIC                  S01310
      **  Data structure to test for BIC code                             S01310
      *                                                                   S01310
     IMULT        DS                         95                           S01310
     I                                        1   5 MTAG                  S01310
     I                                        6  55 MFLD                  S01310
      **  Multiple occurrence data structure for message                  S01310
      *                                                                   S01310
     I@MTAG       DS                          5                           S01310
     I                                        4   4 TAG                   S01310
     I                                        5   5 COLON                 S01310
      **  Data structure constructing message field tag                   S01310
      *                                                                   S01310
     ISDCUST    E DSSDCUSTPD                                              S01310
      **  External Data structure for customer details.                   S01310
      *                                                                   S01310
     ISDMMOD    E DSSDMMODPD                                              S01310
      **  External Data structure for module ICD file.                    S01310
      *                                                                   S01310
     ISDMGME    E DSSDMGMEPD                                              S01310
      **  Data structure for MESSAGE MANAGEMENT file                      S01310
      *                                                                   S01310
     ISDCURR    E DSSDCURRPD                                              S01117
      **  Data structure for CURRENCIES file                              S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                                                 BUG7985
     I              A8BRCD                          WYBRCD                                   BUG7985
     I              A8BRNM                          WYBRNM                                   BUG7985
     I              A8BICN                          WYBICN                                   BUG7985
     I              A8BTID                          WYBTID                                   BUG7985
     I              A8TYLC                          WYTYLC                                   BUG7985
     I              QQDFAC                          WYDFAC                                   BUG7985
      **  Data structure for Branch file                                                     BUG7985
      *                                                                                      BUG7985
     IDSFDY     E DSDSFDY                                                 S01310
      **  Short data structure for access programs                        S01310
      *                                                                   S01310
     IDSSDY     E DSDSSDY                                                 S01310
      **  Long data structure for access programs                         S01310
     I*
     ISDCNST    E DSSDCNSTPD                                              094278
      *                                                                   094278
      *  Calling parameter data structure for ME1400                      094278
      *                                                                   094278
     IMEBICD    E DSMEBICDPD                                              094278
      *                                                                   094278
      *  Calling parameter data structure for ME1400                      094278
      *                                                                   094278
     IMEBEIS    E DSMEBEISPD                                                                  CSW202
      ** Data Structure for Business Entity Identifier file                                   CSW202
      *                                                                                       CSW202
      * External data structure - SAR details                             CEU006
     ISCSARD    E DSSCSARDPD                                              CEU006
      *                                                                   CEU006
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** DS For Watch List Transaction Details File                                           CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     I/EJECT
     C                     MOVEACPY@      BIS@   80
     C           *LIKE     DEFN OPPARM    IPPARM
     C******************************
     C*    KEY LIST     PARAMETERS *
     C******************************
     C***********CUSKEY****KLIST                                          S01310
     C*********************KFLD           KCUSNO                          S01310
     C*********************KFLD           KEYA                            S01310
     C*
     C*
     C******************************
     C*    INPUT OUTPUT PARAMETERS *
     C******************************
     C           *ENTRY    PLIST
     C                     PARM           IPPARM
     C                     PARM           OPPARM
     C                     PARM           RSEQ                            S01117
     C*
     C***********************
     C*    FIRST CYCLE.     *
     C***********************
     C*
     C  N40                EXSR FIRST
     C/EJECT
     C*
     C****************************
     C*    DETAIL PROCESSING.    *
     C****************************
     C*
     C                     MOVELCHTP      @CHG    1                                           CSW025
      *                                                                                       CSW025
     C                     EXSR INTF                                      S01310
     C                     EXSR BRANCH                                    S01117
     C*
     C*  KEEP TALLY OF NUMBER OF RECORDS READ FROM LF/PRFP2
     C*********************ADD  1         P3NO1                           S01117
     C                     ADD  1         AUNO1                           S01117
     C***SET*OFF*TELEX*MESSAGE*INDICATORS                                 S01310
     C**********           SETOF                     25                   S01310
     C*
     C*  SETUP PARAMETERS  AND EXECUTE SR01 TO
     C** DETERMINE SWIFT ADDRESS OF DESTINATION OF MESSAGE
     C*
     C           RBKT      IFEQ 'F'                        B001
     C           RBKT      OREQ 'R'
     C           RBKT      OREQ 'C'
     C           RBKT      OREQ 'G'                                       050198
     C           RBKT      OREQ 'S'                                       094278
     C           RBKT      OREQ 'A'                                                          260987A
     C                     MOVELRBKT      ISPTP   1
     C                     MOVE RBK1      ISPTY1 35
     C                     MOVE RBK2      ISPTY2 35
     C                     MOVE RBK3      ISPTY3 35
     C                     MOVE RBK4      ISPTY4 35
     C                     MOVE *BLANKS   ISPTY5 35
     C                     END                             E001
      *
     C                     MOVE PCCY      ISCCY   3
     C                     MOVE 'A'       IVTAG1  1
     C                     MOVE ' '       IVTAG2  1
      *                                                                                      260987A
     C           RBKT      IFEQ 'A'                                                          260987A
     C                     MOVE 'D'       IVTAG3  1                                          260987A
     C                     ELSE                                                              260987A
     C                     MOVE ' '       IVTAG3  1
     C                     ENDIF                                                             260987A
     C*                                                                   050198
     C* If Remitting Bank is a full alpha address then set Swift User     050198
     C* Flag to ensure that a telex advice prints only.                   050198
     C*                                                                   050198
     C           RBKT      IFEQ 'A'                        B001           050198
     C                     MOVE 'N'       OSUFLG                          050198
     C                     MOVEL'PAPER'   NWRK                                             AR1014574
     C                     MOVE '3'       MGSG                                             AR1014574
     C                     MOVE 'PRTD'    MGST                                             AR1014574
     C**********           ELSE                                                       050198 260987A
     C                     ENDIF                                                             260987A
     C*
     C* SETON INDICATOR FOR SUBSEQUENT BLOCK OF SWFT CALL FOR
     C* DETAIL FIELD ADDRESSES(RATHER THAN DESTINATION ADDRESS)
     C*
     C                     SETON                     20
     C*
     C                     EXSR SR01
     C* ** MOVE FORMATTED                  FIELDS INTO DATA STRUCTURE**
     C* ****** PARAMETERS OFSPT1 SHOULD BE MOVED TO            ****
     C* ****** FIELD RECIPIENT ADDRESS OF SWIFT DATA STRUCTURE ****
     C* ****** SAVE IT AS IT WILL BE USED IN SUBROUTINE 10 & 4.****
      *
     C                     MOVELOFSPT1    RECADD 12
      *
     C* ****** SAVE CUSTOMER FIELDS TO BE USED IN SUBROUTINE 8.****
      *
     C**********           MOVE CUSTNO    SCUSNO  60                                          CSD027
     C                     MOVE CUSTNO    SCUSNO  6                                           CSD027
      *
     C*********************MOVE CTWN      SCTWN  10                       S01310
     C*********************MOVE CRNM      SCRNM  20                       S01310
     C*********************MOVE SWTX      SWTWRK  1                       S01310
     C*
     C***USE*SWIFT*OR*TELEX*ADDRESS*FOR*SENDERS*TID*DEPENDING*ON*THE***                      260987A
     C***ROUTING*INDICATOR*********************************************                      260987A
     C********** SWTX      IFEQ 'T'                                                          260987A
     C**********           MOVE MXOTLX    MXOTID 12                                          260987A
     C**********           SETON                     25                   S01310
     C**********           ELSE                                                              260987A
     C**********           MOVE MXOSFT    MXOTID                                             260987A
     C**********           END                                                               260987A
      *                                                                                      260987A
      ** Sender's address on printout to be same as output to MGOREFPD.                      260987A
      *                                                                                      260987A
     C                     MOVELNWSN      MXOTID 12                                          260987A
     C*                                                                   050198
     C**********           END                                                        050198 260987A
     C*
     C** FIELD :21: SHOULD CONTAIN REMITTING BANK REFERENCE - NOT THE
     C** PAYMENT REFERENCE
     C*
     C*
     C                     MOVELRBKR      M1RREF
     C*
     C***IF*THE*SWIFT*USER*FLAG*=*'N'*FROM*SUBROUTINE*SR01                S01310
     C***THEN*THE*MESSAGE*MUST*BE*SENT*VIA*TELEX                          S01310
     C*
      ** Only do this processing if default network is 'PAPER'            S01310
      *                                                                   S01310
     C           OSUFLG    IFEQ 'N'
     C*                                                                   S01117
     C* IF MULTIBRANCHING INDICATOR ACTIVE,MOVE BOOKING BRANCH AND        S01117
     C* BRANCH NAME TO THE RELATIVE FIELDS SET UP WITHIN THE PRINTER FILE S01117
     C*                                                                   S01117
     C           *IN50     IFEQ '1'                                       S01117
     C                     MOVE BRCAA     P2BRCA                          S01117
     C                     MOVELBRNM      P2BRNM                          S01117
     C                     END                                            S01117
     C*
     C**DETAILS INTO DESTINATION FIELDS ON REPORT.
     C*
     C*
     C* ****** FORMAT REMITTING BANK   ******
     C                     MOVELRBKT      ISPTP
     C                     MOVELRBK1      ISPTY1
     C                     MOVELRBK2      ISPTY2
     C                     MOVELRBK3      ISPTY3
     C                     MOVELRBK4      ISPTY4
     C                     EXSR SR05
     C*
     C* ****** MOVE FORMATTED REMITTING BANK FIELDS INTO **
     C* ****** DESTINATION FIELD PRINT LINE                **
     C                     MOVELOFSPT1    P2DST1
     C                     MOVELOFSPT2    P2DST2
     C                     MOVELOFSPT3    P2DST3
     C                     MOVELOFSPT4    P2DST4
     C                     MOVELOFSPT5    P2DST5
     C*
     C* ****** FORMAT SENDER'S CORRESPONDENT        ******
     C                     MOVELSNCT      ISPTP
     C                     MOVELSNCO      ISPTY1
     C                     MOVEL*BLANKS   ISPTY2
     C                     MOVEL*BLANKS   ISPTY3
     C                     MOVEL*BLANKS   ISPTY4
     C                     MOVEL*BLANKS   ISPTY5
     C                     EXSR SR05
     C* ****** MOVE FORMATTED SENDER'S CORR. FIELDS INTO PRINT LINE**
     C                     MOVELOFSPT1    P2SNC1
     C                     MOVELOFSPT2    P2SNC2
     C                     MOVELOFSPT3    P2SNC3
     C                     MOVELOFSPT4    P2SNC4
     C                     MOVELOFSPT5    P2SNC5
     C*
     C* ****** FORMAT RECEIVERS CORRESPONDENT        ******
     C                     MOVELRCRT      ISPTP
     C                     MOVELRCO1      ISPTY1
     C                     MOVELRCO2      ISPTY2
     C                     MOVELRCO3      ISPTY3
     C                     MOVELRCO4      ISPTY4
     C                     MOVELRCO5      ISPTY5
     C                     EXSR SR05
     C* ****** MOVE FORMATTED RECEIVERS CORR. FIELDS INTO PRINT LINE**
     C                     MOVELOFSPT1    P2RCR1
     C                     MOVELOFSPT2    P2RCR2
     C                     MOVELOFSPT3    P2RCR3
     C                     MOVELOFSPT4    P2RCR4
     C                     MOVELOFSPT5    P2RCR5
     C*
     C* ****** FORMAT ACCOUNT WITH BANK              ******
     C                     MOVELACBT      ISPTP
     C                     MOVELACB1      ISPTY1
     C                     MOVELACB2      ISPTY2
     C                     MOVELACB3      ISPTY3
     C                     MOVELACB4      ISPTY4
     C                     MOVELACB5      ISPTY5
     C                     EXSR SR05
     C* ****** MOVE FORMATTED ACCNT WITH BANK FIELDS INTO PRINT LINE**
     C                     MOVELOFSPT1    P2AWB1
     C                     MOVELOFSPT2    P2AWB2
     C                     MOVELOFSPT3    P2AWB3
     C                     MOVELOFSPT4    P2AWB4
     C                     MOVELOFSPT5    P2AWB5
     C*
     C**         PRRM      ADD  COCH      WAMNT
     C           TOTR      ADD  COCH      WAMNT
     C                     SUB  DEDS      WAMNT
     C*                                                                   S01499
     C**  Total V.A.T. Charges                                            S01499
     C                     ADD  PCVATC    WAMNT                           S01499
     C                     SUB  PCVATD    WAMNT                           S01499
     C                     EXSR SR07                       FORMAT AMOUNT
     C                     EXSR SRP2                       PRT TELX REPORT
     C*********************ELSE                            SWFT UND FLG=Y S01310
     C                     END                                            S01310
     C*
     C*  INTIALISE AND PRESET FIELDS IN DATA STRUCTURE
     C*  FOR SWIFT MESSAGES TYPE RECORDS
     C                     EXSR SR10
      *                                                                   S01310
      ** Set up field :32B: (date/currency/amount)                        S01310
      *                                                                   S01310
     C                     EXSR FLD32                                     S01310
      *                                                                   CEU006
      * Reset /OCMT/ AND /CHGS/ fields                                    CEU006
     C                     MOVE *BLANKS   O#CCY                           CEU006
     C                     MOVE *BLANKS   O#AMNT                          CEU006
     C                     MOVE *BLANKS   C#CCY                           CEU006
     C                     MOVE *BLANKS   C#AMNT                          CEU006
      *                                                                   CEU006
      * Set up Original Currency/Amount and Charges fields for            CEU006
      * field :72: if EMU Settlement on and Pay Delivery Amount           CEU006
      * entered                                                           CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           PDAM      ANDNE0                                         CEU006
     C                     EXSR ERI                                       CEU006
     C                     ENDIF                                          CEU006
     C*
     C*  SETUP PARAMETERS AND EXECUTE SR01 TO
     C*  FORMAT THE SENDERS CORRESPONDENT
     C                     MOVELSNCT      ISPTP
     C                     MOVELSNCO      ISPTY1
     C                     MOVE *BLANKS   ISPTY2
     C                     MOVE *BLANKS   ISPTY3
     C                     MOVE *BLANKS   ISPTY4
     C                     MOVE *BLANKS   ISPTY5
     C                     MOVE PCCY      ISCCY
     C                     MOVE 'A'       IVTAG1           TAG IND 1
     C                     MOVE 'B'       IVTAG2           TAG IND 2
     C                     MOVE 'D'       IVTAG3           TAG IND 3
     C*
     C* SET OFF INDICATOR FOR BLOCK OF SWFT CALL FOR DETAIL
     C* FIELD ADDRESS(RATHER THAN DESTINATION ADDRESS)
     C*
     C                     SETOF                     20
     C*
     C                     MOVE 'Y'       W201IN  1                                           CSW201
     C                     EXSR SR01
     C                     MOVE 'N'       W201IN                                              CSW201
      *                                                                   S01310
      **  Set up field :53: (senders correspondent)                       S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C           OFSPT2    ORNE *BLANK                                    S01310
     C           OFSPT3    ORNE *BLANK                                    S01310
     C           OFSPT4    ORNE *BLANK                                    S01310
     C           OFSPT5    ORNE *BLANK                                    S01310
     C                     MOVEL':53'     @MTAG   5                       S01310
     C                     EXSR PARTY                                     S01310
     C                     END                                            S01310
     C*****MOVE*FORMATTED*SENDERS*CORR.*FIELDS*INTO*DATA*STRUCTURE**      S01310
      *                                                                   S01310
      ** Set up senders correspondent field on print file                 S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    M1SCR1
     C                     MOVELOFSPT2    M1SCR2
     C                     MOVELOFSPT3    M2SCR3
     C                     MOVELOFSPT4    M2SCR4
     C                     MOVELOFSPT5    M2SCR5
     C                     MOVE OSTAG     M1SCTT                          S01310
     C***********M1SCR1****IFNE *BLANK                                    S01310
     C***********M1SCR2****ORNE *BLANK                                    S01310
     C***********M2SCR3****ORNE *BLANK                                    S01310
     C***********M2SCR4****ORNE *BLANK                                    S01310
     C***********M2SCR5****ORNE *BLANK                                    S01310
     C*********************END                                            S01310
     C*********************MOVE OSTAG     M1SCTT                          S01310
     C*********************MOVE ':53'     M1TG53                          S01310
     C*********************MOVE ':'       M1COLN                          S01310
     C*********************MOVE X0D25     M1CRL9                          S01310
     C*********************END                                            S01310
     C***********M1SCR2****IFNE *BLANK                                    S01310
     C***********M2SCR3****ORNE *BLANK                                    S01310
     C***********M2SCR4****ORNE *BLANK                                    S01310
     C***********M2SCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M1CRLA                          S01310
     C*********************END                                            S01310
     C***********M2SCR3****IFNE *BLANK                                    S01310
     C***********M2SCR4****ORNE *BLANK                                    S01310
     C***********M2SCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M2CRL1                          S01310
     C*********************END                                            S01310
     C***********M2SCR4****IFNE *BLANK                                    S01310
     C***********M2SCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M2CRL2                          S01310
     C*********************END                                            S01310
     C***********M2SCR5****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M2CRL3                          S01310
     C*********************END                                            S01310
     C*
     C*  SETUP PARAMETERS AND EXECUTE SR01 TO
     C*  FORMAT THE RECEIVERS CORRESPONDENT
     C                     MOVELRCRT      ISPTP
     C                     MOVELRCO1      ISPTY1
     C                     MOVELRCO2      ISPTY2
     C                     MOVELRCO3      ISPTY3
     C                     MOVELRCO4      ISPTY4
     C                     MOVELRCO5      ISPTY5
     C                     MOVE PCCY      ISCCY
     C                     MOVE 'A'       IVTAG1           TAG IND 1
     C                     MOVE 'B'       IVTAG2           TAG IND 2
     C                     MOVE 'D'       IVTAG3           TAG IND 3
     C*
     C* SET OFF INDICATOR FOR BLOCK OF SWFT CALL FOR DETAIL
     C* FIELD ADDRESS(RATHER THAN DESTINATION ADDRESS)
     C*
     C                     SETOF                     20
     C*
     C                     MOVE 'Y'       W201IN                                              CSW201
     C                     EXSR SR01
     C                     MOVE 'N'       W201IN                                              CSW201
      *                                                                   S01310
      **  Set up field :54: (receivers correpondent)                      S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C           OFSPT2    ORNE *BLANK                                    S01310
     C           OFSPT3    ORNE *BLANK                                    S01310
     C           OFSPT4    ORNE *BLANK                                    S01310
     C           OFSPT5    ORNE *BLANK                                    S01310
     C                     MOVEL':54'     @MTAG                           S01310
     C                     EXSR PARTY                                     S01310
     C                     END                                            S01310
     C*****MOVE*FORMATTED*RECEIVERS CORR. FIELDS INTO DATA STRUCTURE**    S01310
      *                                                                   S01310
      ** Set up receivers correspondent field on print file               S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    M2RCR1
     C                     MOVELOFSPT2    M2RCR2
     C                     MOVELOFSPT3    M2RCR3
     C                     MOVELOFSPT4    M3RCR4
     C                     MOVELOFSPT5    M3RCR5
     C                     MOVE OSTAG     M2RCTT                          S01310
     C***********M2RCR1****IFNE *BLANK                                    S01310
     C***********M2RCR2****ORNE *BLANK                                    S01310
     C***********M2RCR3****ORNE *BLANK                                    S01310
     C***********M3RCR4****ORNE *BLANK                                    S01310
     C***********M3RCR5****ORNE *BLANK                                    S01310
     C*********************MOVE OSTAG     M2RCTT                          S01310
     C*********************MOVE ':54'     M2TG54                          S01310
     C*********************MOVE ':'       M2COLN                          S01310
     C*********************MOVE X0D25     M2CRL4                          S01310
     C*********************END                                            S01310
     C***********M2RCR2****IFNE *BLANK                                    S01310
     C***********M2RCR3****ORNE *BLANK                                    S01310
     C***********M3RCR4****ORNE *BLANK                                    S01310
     C***********M3RCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M2CRL5                          S01310
     C*********************END                                            S01310
     C***********M2RCR3****IFNE *BLANK                                    S01310
     C***********M3RCR4****ORNE *BLANK                                    S01310
     C***********M3RCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M2CRL6                          S01310
     C*********************END                                            S01310
     C***********M3RCR4****IFNE *BLANK                                    S01310
     C***********M3RCR5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M3CRL1                          S01310
     C*********************END                                            S01310
     C***********M3RCR5****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M3CRL2                          S01310
     C*********************END                                            S01310
     C*
     C*  SETUP PARAMETERS AND EXECUTE SR01 TO
     C*  FORMAT THE ACCOUNT WITH BANK
     C                     MOVELACBT      ISPTP
     C                     MOVELACB1      ISPTY1
     C                     MOVELACB2      ISPTY2
     C                     MOVELACB3      ISPTY3
     C                     MOVELACB4      ISPTY4
     C                     MOVELACB5      ISPTY5
     C                     MOVE PCCY      ISCCY
     C                     MOVE 'A'       IVTAG1           TAG IND 1
     C                     MOVE 'B'       IVTAG2           TAG IND 2
     C                     MOVE 'D'       IVTAG3           TAG IND 3
     C                     MOVE 'Y'       W201IN                                              CSW201
     C                     EXSR SR01
     C                     MOVE 'N'       W201IN                                              CSW201
      *                                                                   S01310
      **  Set up field :57: (account/with bank)                           S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C           OFSPT2    ORNE *BLANK                                    S01310
     C           OFSPT3    ORNE *BLANK                                    S01310
     C           OFSPT4    ORNE *BLANK                                    S01310
     C           OFSPT5    ORNE *BLANK                                    S01310
     C                     MOVEL':57'     @MTAG                           S01310
     C                     EXSR PARTY                                     S01310
     C                     END                                            S01310
     C*****MOVE*FORMATTED*ACCNT*WITH*BANK*FIELDS*INTO*DATA*STRUCTURE**    S01310
     C                     MOVE OSTAG     M3ABTT                          S01310
      *                                                                   S01310
      ** Set up account with bank field on print file                     S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    M3AWB1                          S01310
     C                     MOVELOFSPT2    M3AWB2                          S01310
     C                     MOVELOFSPT3    M3AWB3                          S01310
     C                     MOVELOFSPT4    M3AWB4                          S01310
     C                     MOVELOFSPT5    M4AWB5                          S01310
     C***********M3AWB1****IFNE *BLANK                                    S01310
     C***********M3AWB2****ORNE *BLANK                                    S01310
     C***********M3AWB3****ORNE *BLANK                                    S01310
     C***********M3AWB4****ORNE *BLANK                                    S01310
     C***********M4AWB5****ORNE *BLANK                                    S01310
     C*********************MOVE ':57'     M3TG57                          S01310
     C*********************MOVE ':'       M3COLN                          S01310
     C*********************MOVE X0D25     M3CRL3                          S01310
     C*********************END                                            S01310
     C***********M3AWB2****IFNE *BLANK                                    S01310
     C***********M3AWB3****ORNE *BLANK                                    S01310
     C***********M3AWB4****ORNE *BLANK                                    S01310
     C***********M4AWB5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M3CRL4                          S01310
     C*********************END                                            S01310
     C***********M3AWB3****IFNE *BLANK                                    S01310
     C***********M3AWB4****ORNE *BLANK                                    S01310
     C***********M4AWB5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M3CRL5                          S01310
     C*********************END                                            S01310
     C***********M3AWB4****IFNE *BLANK                                    S01310
     C***********M4AWB5****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M3CRL6                          S01310
     C*********************END                                            S01310
     C***********M4AWB5****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M4CRL1                          S01310
     C*********************END                                            S01310
     C*********************                                               S01310
     C*****MOVE*BANK*TO*BANK INFOS INTO DATA STRUCTURE **                 S01310
     C*********************MOVE *BLANKS   OFSPT                           S01310
     C*********************MOVE BBI1      OFSPT1                          S01310
     C*********************MOVE BBI2      OFSPT2                          S01310
     C*********************MOVE BBI3      OFSPT3                          S01310
     C*********************MOVE BBI4      OFSPT4                          S01310
     C*********************MOVE BBI5      OFSPT5                          S01310
     C*********************MOVE BBI6      OFSPT6                          S01310
     C*********************EXSR EMBLK                                     S01310
     C*********************MOVELOFSPT1    BBI1A                           S01310
     C*********************MOVELOFSPT2    BBI2A                           S01310
     C*********************MOVELOFSPT3    BBI3A                           S01310
     C*********************MOVELOFSPT4    BBI4A                           S01310
     C*********************MOVELOFSPT5    BBI5A                           S01310
     C*********************MOVELOFSPT6    BBI6A                           S01310
     C***********BBI1A*****IFNE *BLANK                                    S01310
     C***********BBI2A*****ORNE *BLANK                                    S01310
     C***********BBI3A*****ORNE *BLANK                                    S01310
     C***********BBI4A*****ORNE *BLANK                                    S01310
     C***********BBI5A*****ORNE *BLANK                                    S01310
     C***********BBI6A*****ORNE *BLANK                                    S01310
     C*********************MOVE ':72:'    M5TG72                          S01310
     C*********************MOVE X0D25     M5CRL2                          S01310
     C*********************END                                            S01310
     C***********BBI2A*****IFNE *BLANK                                    S01310
     C***********BBI3A*****ORNE *BLANK                                    S01310
     C***********BBI4A*****ORNE *BLANK                                    S01310
     C***********BBI5A*****ORNE *BLANK                                    S01310
     C***********BBI6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M5CRL3                          S01310
     C*********************END                                            S01310
     C***********BBI3A*****IFNE *BLANK                                    S01310
     C***********BBI4A*****ORNE *BLANK                                    S01310
     C***********BBI5A*****ORNE *BLANK                                    S01310
     C***********BBI6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M5CRL4                          S01310
     C*********************END                                            S01310
     C***********BBI4A*****IFNE *BLANK                                    S01310
     C***********BBI5A*****ORNE *BLANK                                    S01310
     C***********BBI6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M5CRL5                          S01310
     C*********************END                                            S01310
     C***********BBI5A*****IFNE *BLANK                                    S01310
     C***********BBI6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M5CRL6                          S01310
     C*********************END                                            S01310
     C***********BBI6A*****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M6CRL1                          S01310
     C*********************END                                            S01310
     C*
     C* ** MOVE DETAILS CHARGES INFOS INTO DATA STRUCTURE **
     C                     MOVE *BLANKS   OFSPT
     C                     MOVE DCH1      OFSPT1
     C                     MOVE DCH2      OFSPT2
     C                     MOVE DCH3      OFSPT3
     C                     MOVE DCH4      OFSPT4
     C                     MOVE DCH5      OFSPT5
     C                     MOVE DCH6      OFSPT6
     C                     EXSR EMBLK
      *                                                                   S01310
      ** Set up details of charges field on print file                    S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    DCH1A
     C                     MOVELOFSPT2    DCH2A
     C                     MOVELOFSPT3    DCH3A
     C                     MOVELOFSPT4    DCH4A
     C                     MOVELOFSPT5    DCH5A
     C                     MOVELOFSPT6    DCH6A
      *                                                                   S01310
      ** Set up field :71: (Details of charges (deductions) )             S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C           OFSPT2    ORNE *BLANK                                    S01310
     C           OFSPT3    ORNE *BLANK                                    S01310
     C           OFSPT4    ORNE *BLANK                                    S01310
     C           OFSPT5    ORNE *BLANK                                    S01310
     C           OFSPT6    ORNE *BLANK                                    S01310
     C                     MOVEL':71B:'   @MTAG                           S01310
     C                     EXSR DETAIL                                    S01310
     C                     END                                            S01310
     C*
     C* ** MOVE BANK TO BANK INFOS INTO DATA STRUCTURE **
     C                     MOVE *BLANKS   OFSPT
     C                     MOVE BBI1      OFSPT1
     C                     MOVE BBI2      OFSPT2
     C                     MOVE BBI3      OFSPT3
     C                     MOVE BBI4      OFSPT4
     C                     MOVE BBI5      OFSPT5
     C                     MOVE BBI6      OFSPT6
     C***********          EXSR EMBLK                                     CEU006
      *                                                                   CEU006
      * If /OCMT/ information is present, the Bank To Bank lines          CEU006
      * must be shifted down to accomodate it                             CEU006
     C           O#CCY     IFNE *BLANKS                                   CEU006
     C                     MOVE OFSPT5    OFSPT6                          CEU006
     C                     MOVE OFSPT4    OFSPT5                          CEU006
     C                     MOVE OFSPT3    OFSPT4                          CEU006
     C                     MOVE OFSPT2    OFSPT3                          CEU006
     C                     MOVE OFSPT1    OFSPT2                          CEU006
     C                     MOVE OCMT      OFSPT1                          CEU006
      *                                                                   CEU006
      * likewise for /CHGS/ (goes below /OCMT/)                           CEU006
     C           C#CCY     IFNE *BLANKS                                   CEU006
     C                     MOVE OFSPT5    OFSPT6                          CEU006
     C                     MOVE OFSPT4    OFSPT5                          CEU006
     C                     MOVE OFSPT3    OFSPT4                          CEU006
     C                     MOVE OFSPT2    OFSPT3                          CEU006
     C                     MOVE CHGS      OFSPT2                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     EXSR EMBLK                                     CEU006
      *                                                                   S01310
      ** Set up bank to bank information field on print file              S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    BBI1A
     C                     MOVELOFSPT2    BBI2A
     C                     MOVELOFSPT3    BBI3A
     C                     MOVELOFSPT4    BBI4A
     C                     MOVELOFSPT5    BBI5A
     C                     MOVELOFSPT6    BBI6A
      *                                                                   S01310
      ** Set up field :72: (sender to receiver information)               S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANKS                                   S01310
     C           OFSPT2    ORNE *BLANKS                                   S01310
     C           OFSPT3    ORNE *BLANKS                                   S01310
     C           OFSPT4    ORNE *BLANKS                                   S01310
     C           OFSPT5    ORNE *BLANKS                                   S01310
     C           OFSPT6    ORNE *BLANKS                                   S01310
     C                     MOVEL':72: '   @MTAG                           S01310
     C                     EXSR DETAIL                                    S01310
     C                     END                                            S01310
     C***********DCH1A*****IFNE *BLANK                                    S01310
     C***********DCH2A*****ORNE *BLANK                                    S01310
     C***********DCH3A*****ORNE *BLANK                                    S01310
     C***********DCH4A*****ORNE *BLANK                                    S01310
     C***********DCH5A*****ORNE *BLANK                                    S01310
     C***********DCH6A*****ORNE *BLANK                                    S01310
     C*********************MOVE ':71:'    M4TG71                          S01310
     C*********************MOVE X0D25     M4CRL2                          S01310
     C*********************END                                            S01310
     C***********DCH2A*****IFNE *BLANK                                    S01310
     C***********DCH3A*****ORNE *BLANK                                    S01310
     C***********DCH4A*****ORNE *BLANK                                    S01310
     C***********DCH5A*****ORNE *BLANK                                    S01310
     C***********DCH6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M4CRL3                          S01310
     C*********************END                                            S01310
     C***********DCH3A*****IFNE *BLANK                                    S01310
     C***********DCH4A*****ORNE *BLANK                                    S01310
     C***********DCH5A*****ORNE *BLANK                                    S01310
     C***********DCH6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M4CRL4                          S01310
     C*********************END                                            S01310
     C***********DCH4A*****IFNE *BLANK                                    S01310
     C***********DCH5A*****ORNE *BLANK                                    S01310
     C***********DCH6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M4CRL5                          S01310
     C*********************END                                            S01310
     C***********DCH5A*****IFNE *BLANK                                    S01310
     C***********DCH6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M4CRL6                          S01310
     C*********************END                                            S01310
     C***********DCH6A*****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M5CRL1                          S01310
     C*********************END                                            S01310
     C*
     C* ** MOVE AMOUNTS ADDED INFOS INTO DATA STRUCTURE **
     C                     MOVE *BLANKS   OFSPT
     C                     MOVE DAA1      OFSPT1
     C                     MOVE DAA2      OFSPT2
     C                     MOVE DAA3      OFSPT3
     C                     MOVE DAA4      OFSPT4
     C                     MOVE DAA5      OFSPT5
     C                     MOVE DAA6      OFSPT6
     C                     EXSR EMBLK
      *                                                                   S01310
      ** Set up field :73: (Details of amounts added)                     S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C           OFSPT2    ORNE *BLANK                                    S01310
     C           OFSPT3    ORNE *BLANK                                    S01310
     C           OFSPT4    ORNE *BLANK                                    S01310
     C           OFSPT5    ORNE *BLANK                                    S01310
     C           OFSPT6    ORNE *BLANK                                    S01310
     C                     MOVEL':73: '   @MTAG                           S01310
     C                     EXSR DETAIL                                    S01310
     C                     END                                            S01310
      *                                                                   S01310
      *                                                                   S01310
      ** Set up details of charges field on print file                    S01310
      *                                                                   S01310
     C                     MOVELOFSPT1    DAA1A
     C                     MOVELOFSPT2    DAA2A
     C                     MOVELOFSPT3    DAA3A
     C                     MOVELOFSPT4    DAA4A
     C                     MOVELOFSPT5    DAA5A
     C                     MOVELOFSPT6    DAA6A
     C***********DAA1A*****IFNE *BLANK                                    S01310
     C***********DAA2A*****ORNE *BLANK                                    S01310
     C***********DAA3A*****ORNE *BLANK                                    S01310
     C***********DAA4A*****ORNE *BLANK                                    S01310
     C***********DAA5A*****ORNE *BLANK                                    S01310
     C***********DAA6A*****ORNE *BLANK                                    S01310
     C*********************MOVE ':73:'    M6TG73                          S01310
     C*********************MOVE X0D25     M6CRL2                          S01310
     C*********************END                                            S01310
     C***********DAA2A*****IFNE *BLANK                                    S01310
     C***********DAA3A*****ORNE *BLANK                                    S01310
     C***********DAA4A*****ORNE *BLANK                                    S01310
     C***********DAA5A*****ORNE *BLANK                                    S01310
     C***********DAA6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M6CRL3                          S01310
     C*********************END                                            S01310
     C***********DAA3A*****IFNE *BLANK                                    S01310
     C***********DAA4A*****ORNE *BLANK                                    S01310
     C***********DAA5A*****ORNE *BLANK                                    S01310
     C***********DAA6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M6CRL4                          S01310
     C*********************END                                            S01310
     C***********DAA4A*****IFNE *BLANK                                    S01310
     C***********DAA5A*****ORNE *BLANK                                    S01310
     C***********DAA6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M6CRL5                          S01310
     C*********************END                                            S01310
     C***********DAA5A*****IFNE *BLANK                                    S01310
     C***********DAA6A*****ORNE *BLANK                                    S01310
     C*********************MOVE X0D25     M6CRL6                          S01310
     C*********************END                                            S01310
     C***********DAA6A*****IFNE *BLANK                                    S01310
     C*********************MOVE X0D25     M7CRL1                          S01310
     C*********************END                                            S01310
     C*********************                                               S01310
     C*********************                                               S01310
     C****AMOUNT*=*'PROCEEDS*REMITTED'*+*'CORRESPONDENTS*CHARGES'      ***S01310
     C*********************************-*'DEDUCTIONS'                  ***S01310
     C*********************                                            ***S01310
     C***********TOTR******ADD  COCH      WAMNT                           S01310
     C*********************SUB  DEDS      WAMNT                           S01310
     C*********************                                            ***S01310
     C*********************                                               S01310
     C***FORMAT*THE*AMOUNT*                                               S01310
     C*********************EXSR SR07                                      S01310
     C*********************Z-ADD1         X       20                      S01310
     C*********************Z-ADD1         Y                               S01310
     C*********************MOVE *BLANKS   SAM                             S01310
     C*********************MOVEA*BLANKS   AR                              S01310
     C*********************DO   14                         B001           S01310
     C***********AM,Y******IFNE ' '                        B002           S01310
     C*********************MOVEAAM,Y      AR,X                            S01310
     C*********************ADD  1         X                               S01310
     C*********************END                             E002           S01310
     C*********************ADD  1         Y                               S01310
     C*********************END                             E001           S01310
     C*********************MOVEAAR        AMX                             S01310
     C*********************MOVELAMX       SAM                             S01310
     C*********************MOVE SAM       M1AMNT                          S01310
     C*********************                                               S01310
     C*********************Z-ADDTOTR      WAMNT                           S01310
     C***FORMAT*THE*AMOUNT*                                               S01310
     C*********************EXSR SR07                                      S01310
     C*********************Z-ADD1         X       20                      S01310
     C*********************Z-ADD1         Y                               S01310
     C*********************MOVE *BLANKS   SAM                             S01310
     C*********************MOVEA*BLANKS   AR                              S01310
     C*********************DO   14                         B001           S01310
     C***********AM,Y******IFNE ' '                        B002           S01310
     C*********************MOVEAAM,Y      AR,X                            S01310
     C*********************ADD  1         X                               S01310
     C*********************END                             E002           S01310
     C*********************ADD  1         Y                               S01310
     C*********************END                             E001           S01310
     C*********************MOVEAAR        AMX                             S01310
     C*********************MOVELAMX       SAM                             S01310
     C*********************MOVE SAM       M1AMT2                          S01310
     C*********************                                               S01310
     C***OUTPUT*SEVEN*RECORDS*TO*THE*OUTGOING*SWIFT*MESSAGES              S01310
     C***FILE*(PF/MSMSOPF)*AND*ONE*RECORD*TO*(PF/MSIXOPF)                 S01310
     C*********************EXSR SR09                                      S01310
      *                                                                   S01310
      ** Output correctly generated message to PF/MGOMSGPD and write      S01310
      ** reference record to PF/MGOREFPD.                                 S01310
      *                                                                   S01310
     C                     EXSR OMSG                                      S01310
     C*
     C*  OUTPUT AN ENTRY TO THE SWIFT MESSAGE REPORT PRTF/FT0651P1
     C*  INCLUDE NARRATIVE 'RECOVERY' IF ROLLBACK INDICATOR
     C*  HAS BEEN SETON IN SUBROUTINE SR09
     C*  **** FIZ SEE RESULT CONTENT SHEET 12*********
     C                     ADD  1         PAGEP1
     C                     WRITEP1H1                   80
     C   80                DO                              B001
     C*                                                    ))))))))))))))
     C                     MOVE 'FT0651P1'DBFNAM           )))  DATA  )))
     C                     MOVEL'1'       DBERKY           )))  BASE  )))
     C                     MOVE 17        DBERR#           ))) ERROR  )))
     C                     EXSR DBERR                      )))   17   )))
     C*                                                    ))))))))))))))
     C                     END                             E001
     C*
     C*  COMIT OR ROLLBACK CHANGES
     C           *IN41     IFEQ '0'
     C                     MOVE 'Y'       OPPARM           MSG PROD FLAG
     C*****INCREMENT*MESSAGES*COUNT*FIELD*IN*DATAAREA*MSFCTL******
     C************NAMVAR   DEFN MSFCTL    DFCTL
     C*****INCREMENT*MESSAGES*COUNT*FIELD*IN*DATAAREA*FTFCTL              S01310
     C************NAMVAR   DEFN MSTCTL    DTCTL                           E21286
     C************NAMVAR   DEFN FTFCTL    DFCTL                     E21286S01310
     C************IN25     IFEQ '0'                                       S01310
     C************LOCK     IN   DFCTL                                     S01310
     C************         ADD  1         DFOMC                           S01310
     C************         ADD  1         DFOTL                           S01310
     C************         OUT  DFCTL                                     S01310
     C************         END                                            S01310
     C                     END
     C*********************END                                            S01310
     C*
     C/EJECT
     C*
     C**********************************
     C*    LAST RECORD PROCESSING.     *
     C**********************************
     C*
     C**  OUTPUT A RUN CONTROL REPORT
     CLRN40                EXSR FIRST
     C*LR*******************ADD  1         PAGEP3                         S01117
     CLR                   ADD  1         PAGEAU                          S01117
     C*LR*******************WRITEP3H1                   80                S01117
     CLR                   WRITEAUH1                   80                 S01117
     CLR 80                DO                              B001
     C*                                                    ))))))))))))))
     C*R*******************MOVE 'FT0651P3'DBFNAM           )))  DATA  ))) S01117
     CLR                   MOVEL'FT0651AU'DBFNAM           )))        ))) S01117
     CLR                   MOVEL'3'       DBERKY           )))  BASE  ))) S01117
     C*LR*******************MOVE 18        DBERR#          ))) ERROR  ))) S01117
     CLR                   MOVE '18'      DBERR#           )))        ))) S01117
     CLR                   EXSR DBERR                      )))   18   )))
     C*                                                    ))))))))))))))
     CLR                   END                             E001
     CLR                   RETRN
     C*
     C/EJECT                                                              CEU006
     C*****************************************************************   CEU006
     C*   ERI - Format Field :72: ERI information                     *   CEU006
     C*   Called by - main process.                                   *   CEU006
     C*   Calls     -                                                 *   CEU006
     C*****************************************************************   CEU006
     C*                                                                   CEU006
     C           ERI       BEGSR                                          CEU006
     C*                                                                   CSW020
     C** Perform Old Processing if CSW020 is not switched on.             CSW020
     C           CSW020    IFNE 'Y'                                       CSW020
      *                                                                   CEU006
      * Retrieve currency details for Pay Delivery Currency to get        CEU006
      * SWIFT currency code (TABTG10)                                     CEU006
     C                     MOVEL'20'      TABTGK                          CEU006
     C                     MOVELPDCY      TGCCSR                          CEU006
     C                     MOVE '1'       TGCCSR                          CEU006
     C                     MOVE TGCCSR    TABTGK                          CEU006
     C           TABTGK    CHAINTABFP                10                   CEU006
     C*                                                                   CEU006
     C           *IN10     IFEQ '1'                                       CEU006
     C                     MOVEL'TABFP'   DBFNAM            ************  CEU006
     C                     MOVELTABTGK    DBERKY            * DBERR 32 *  CEU006
     C                     MOVE '32'      DBERR#            ************  CEU006
     C                     EXSR DBERR                                     CEU006
     C                     END                                            CEU006
      *                                                                   CEU006
     C                     MOVELCCYS      O#CCY                           CEU006
      *                                                                   CEU006
      * Format Pay Delivery Amount (per SR07)                             CEU006
     C                     MOVE PDAM      APDAM  13                       CEU006
      *                                                                   CEU006
     C*    DETERMINE DECIMAL POSITION (FOR REPORT)                        CEU006
     C           CDP       COMP 2                    33  32               CEU006
     C           CDP       COMP 1                      3031               CEU006
     C*                                                                   CEU006
     C*    DETERMINE DECIMAL POSITION                                     CEU006
     C           14        SUB  CDP       X       20                      CEU006
     C*    IF 0 DECIMAL PLACES DON'T EDIT                                 CEU006
     C           CDP       IFEQ 0                          B001           CEU006
     C                     MOVE *BLANK    AMT                             CEU006
     C                     MOVE *ZEROS    AM                              CEU006
     C                     MOVEAAPDAM     AMT,2                           CEU006
     C                     MOVEAAPDAM     AM,1                            CEU006
     C                     Z-ADD13        W                               CEU006
     C                     MOVE ','       AM,X                            CEU006
     C                     ELSE                            E001           CEU006
     C*    MOVE AMOUNT INTO ARRAY                                         CEU006
     C                     MOVEAAPDAM     AMT,1                           CEU006
     C*    DETERMINE POSITION OF DECIMAL DIGITS IN 2ND ARRAY              CEU006
     C           X         ADD  1         Y       20                      CEU006
     C*    MOVE DECIMAL DIGITS INTO 2ND ARRAY FIELD                       CEU006
     C                     MOVEAAMT,X     AM,Y                            CEU006
     C*    DETERMINE POSITION & MOVE COMMA                                CEU006
     C                     SUB  1         Y                               CEU006
     C                     MOVE ','       AM,Y                            CEU006
     C*    DETERMINE POSITION OF DIGIT B4  COMMA                          CEU006
     C                     SUB  1         Y                               CEU006
     C*    SAVE POSITION OF DIGIT B4  COMMA                               CEU006
     C                     Z-ADDY         W       20                      CEU006
     C*    DETERMINE POSITION OF DIGIT TO BE MOVED B4  COMMA              CEU006
     C                     SUB  1         X                               CEU006
     C                     Z-ADDX         Z       20                      CEU006
     C*    DO OPERATIONS MOVING CHARACTERS ONE AT A TIME                  CEU006
     C*    FROM RIGHT TO LEFT                                             CEU006
     C                     DO   X                                         CEU006
     C                     MOVE AMT,Z     AM,Y                            CEU006
     C                     SUB  1         Z                               CEU006
     C                     SUB  1         Y                               CEU006
     C                     END                                            CEU006
     C                     END                             E001           CEU006
     C*    SET INDEX TO 1                                                 CEU006
     C                     Z-ADD1         Y                               CEU006
     C*    REPLACE LEADING ZEROS WITH BLANK                               CEU006
     C           AM,Y      DOWEQ'0'                                       CEU006
     C           Y         CABEQW         ERITAG                          CEU006
     C                     MOVE ' '       AM,Y                            CEU006
     C                     ADD  1         Y                               CEU006
     C                     END                                            CEU006
     C*  ** SAVE FIELD FROM ARRAY                                      ***CEU006
     C           ERITAG    TAG                                            CEU006
     C                     MOVEAAM        AMX    14                       CEU006
     C                     MOVE AMX       SAM    15                       CEU006
     C                     Z-ADD1         X       20                      CEU006
     C                     Z-ADD1         Y                               CEU006
     C                     MOVE *BLANKS   SAM                             CEU006
     C                     MOVEA*BLANKS   AR                              CEU006
     C                     DO   14                         B001           CEU006
     C           AM,Y      IFNE ' '                        B002           CEU006
     C                     MOVEAAM,Y      AR,X                            CEU006
     C                     ADD  1         X                               CEU006
     C                     END                             E002           CEU006
     C                     ADD  1         Y                               CEU006
     C                     END                             E001           CEU006
     C                     MOVEAAR        AMX                             CEU006
     C                     MOVELAMX       SAM                             CEU006
     C                     MOVE SAM       O#AMNT                          CEU006
     C*                                                                   CSW020
     C** If CSW020 is switched on perform Swift Decimal Places processing CSW020
     C                     ELSE                                           CSW020
     C*                                                                   CSW020
     C                     CALL 'ZM0040'                                  CSW020
     C                     PARM PDAM      ZAMNT  130                      CSW020
     C                     PARM PDCY      ZCCY    3                       CSW020
     C                     PARM *BLANKS   ZSAMNT 15                       CSW020
     C                     PARM *BLANKS   ZSCCY   3                       CSW020
     C                     PARM *BLANKS   ZERR    1                       CSW020
     C*                                                                   CSW020
     C** Handle Database Error                                            CSW020
     C           ZERR      IFEQ '1'                                       CSW020
     C                     MOVEL'ZM0040  'DBFNAM           ************   CSW020
     C                     MOVELPCCY      DBERKY           * DBERR 34 *   CSW020
     C                     MOVE '34'      DBERR#           ************   CSW020
     C                     EXSR DBERR                                     CSW020
     C*                                                                   CSW020
     C                     ELSE                                           CSW020
     C                     MOVE ZSAMNT    O#AMNT                          CSW020
     C                     MOVE ZSCCY     O#CCY                           CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
     C** Place ending '/' for field 72.                                   149197
     C                     MOVEA*BLANKS   @STR                            149197
     C                     Z-ADD1         N       20                      149197
     C                     MOVEAO#OCMT    @STR                            149197
     C           ' '       LOKUP@STR,N                   60               149197
     C                     MOVEA'/'       @STR,N                          149197
     C                     MOVEA@STR      O#OCMT                          149197
     C**                                                                  149197
      *                                                                   CEU006
      * Format /CHGS/ line if total charges > 0                           CEU006
     C           W#CHGS    IFGT 0                                         CEU006
     C*                                                                   CSW020
     C** Perform Old Processing if CSW020 is not switched on.             CSW020
     C           CSW020    IFNE 'Y'                                       CSW020
      *                                                                   CEU006
      * Set charges currency to SWIFT currency code of Pay Currency       CEU006
      * (currency and decimal places saved in SR/SR07)                    CEU006
     C                     MOVELWCCYS     C#CCY                           CEU006
      *                                                                   CEU006
      * Reformat charge amount for SWIFT  -                               CEU006
     C                     MOVE W#CHGS    A#CHGS 13                       CEU006
      *                                                                   CEU006
     C*    DETERMINE DECIMAL POSITION (FOR REPORT)                        CEU006
     C***********CDP       COMP 2                    33  32               CEU006
     C***********CDP       COMP 1                      3031               CEU006
     C           WCDP      COMP 2                    33  32               CEU006
     C           WCDP      COMP 1                      3031               CEU006
     C*                                                                   CEU006
     C*    DETERMINE DECIMAL POSITION                                     CEU006
     C***********14        SUB  CDP       X       20                      CEU006
     C           14        SUB  WCDP      X       20                      CEU006
     C*    IF 0 DECIMAL PLACES DON'T EDIT                                 CEU006
     C***********CDP       IFEQ 0                          B001           CEU006
     C           WCDP      IFEQ 0                          B001           CEU006
     C                     MOVE *BLANK    AMT                             CEU006
     C                     MOVE *ZEROS    AM                              CEU006
     C                     MOVEAA#CHGS    AMT,2                           CEU006
     C                     MOVEAA#CHGS    AM,1                            CEU006
     C                     Z-ADD13        W                               CEU006
     C                     MOVE ','       AM,X                            CEU006
     C                     ELSE                            E001           CEU006
     C*    MOVE AMOUNT INTO ARRAY                                         CEU006
     C                     MOVEAA#CHGS    AMT,1                           CEU006
     C*    DETERMINE POSITION OF DECIMAL DIGITS IN 2ND ARRAY              CEU006
     C           X         ADD  1         Y       20                      CEU006
     C*    MOVE DECIMAL DIGITS INTO 2ND ARRAY FIELD                       CEU006
     C                     MOVEAAMT,X     AM,Y                            CEU006
     C*    DETERMINE POSITION & MOVE COMMA                                CEU006
     C                     SUB  1         Y                               CEU006
     C                     MOVE ','       AM,Y                            CEU006
     C*    DETERMINE POSITION OF DIGIT B4  COMMA                          CEU006
     C                     SUB  1         Y                               CEU006
     C*    SAVE POSITION OF DIGIT B4  COMMA                               CEU006
     C                     Z-ADDY         W       20                      CEU006
     C*    DETERMINE POSITION OF DIGIT TO BE MOVED B4  COMMA              CEU006
     C                     SUB  1         X                               CEU006
     C                     Z-ADDX         Z       20                      CEU006
     C*    DO OPERATIONS MOVING CHARACTERS ONE AT A TIME                  CEU006
     C*    FROM RIGHT TO LEFT                                             CEU006
     C                     DO   X                                         CEU006
     C                     MOVE AMT,Z     AM,Y                            CEU006
     C                     SUB  1         Z                               CEU006
     C                     SUB  1         Y                               CEU006
     C                     END                                            CEU006
     C                     END                             E001           CEU006
     C*    SET INDEX TO 1                                                 CEU006
     C                     Z-ADD1         Y                               CEU006
     C*    REPLACE LEADING ZEROS WITH BLANK                               CEU006
     C           AM,Y      DOWEQ'0'                                       CEU006
     C           Y         CABEQW         ERITG2                          CEU006
     C                     MOVE ' '       AM,Y                            CEU006
     C                     ADD  1         Y                               CEU006
     C                     END                                            CEU006
     C*  ** SAVE FIELD FROM ARRAY                                      ***CEU006
     C           ERITG2    TAG                                            CEU006
     C                     MOVEAAM        AMX    14                       CEU006
     C                     MOVE AMX       SAM    15                       CEU006
     C                     Z-ADD1         X       20                      CEU006
     C                     Z-ADD1         Y                               CEU006
     C                     MOVE *BLANKS   SAM                             CEU006
     C                     MOVEA*BLANKS   AR                              CEU006
     C                     DO   14                         B001           CEU006
     C           AM,Y      IFNE ' '                        B002           CEU006
     C                     MOVEAAM,Y      AR,X                            CEU006
     C                     ADD  1         X                               CEU006
     C                     END                             E002           CEU006
     C                     ADD  1         Y                               CEU006
     C                     END                             E001           CEU006
     C                     MOVEAAR        AMX                             CEU006
     C                     MOVELAMX       SAM                             CEU006
     C                     MOVE SAM       C#AMNT                          CEU006
     C*                                                                   CSW020
     C** If CSW020 is switched on perform Swift Decimal Places processing CSW020
     C                     ELSE                                           CSW020
     C*                                                                   CSW020
     C                     CALL 'ZM0040'                                  CSW020
     C                     PARM W#CHGS    ZAMNT                           CSW020
     C                     PARM PCCY      ZCCY                            CSW020
     C                     PARM *BLANKS   ZSAMNT                          CSW020
     C                     PARM *BLANKS   ZSCCY                           CSW020
     C                     PARM *BLANKS   ZERR                            CSW020
     C*                                                                   CSW020
     C** Handle Database Error                                            CSW020
     C           ZERR      IFEQ '1'                                       CSW020
     C                     MOVEL'ZM0040  'DBFNAM           ************   CSW020
     C                     MOVELPCCY      DBERKY           * DBERR 34 *   CSW020
     C                     MOVE '35'      DBERR#           ************   CSW020
     C                     EXSR DBERR                                     CSW020
     C*                                                                   CSW020
     C                     ELSE                                           CSW020
     C                     MOVE ZSAMNT    C#AMNT                          CSW020
     C                     MOVE ZSCCY     C#CCY                           CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
     C** Place ending '/' for field 72.                                   151235
     C                     MOVEA*BLANKS   @STR                            151235
     C                     Z-ADD1         N                               151235
     C                     MOVEAC#CHGS    @STR                            151235
     C           ' '       LOKUP@STR,N                   60               151235
     C                     MOVEA'/'       @STR,N                          151235
     C                     MOVEA@STR      C#CHGS                          151235
     C**                                                                  151235
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDSR                                          CEU006
     C*****************************************************************   CEU006
     C/EJECT
     C************************************************************
     C*  FIRST SR.
     C* PERFORMS FIRST CYCLE PROCESSING
     C*
     C           FIRST     BEGSR
     C*
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C                     IN   RUNDAT                                    S01117
     C*                                                                   S01117
     C* IF MULTIBRANCH INDICATOR IS ACTIVE FROM RUNDAT                    S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN50                           S01117
     C                     END                                            S01117
     C* MOVE REPORT NAME AND SPOOL FILE NBR TO ZSFILE AND CALL ZSFILE     S01117
     C                     Z-ADDSFNUM1    SPLNO                           S01117
     C                     MOVELSFILE1    SFILP                           S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           RSEQ    5                       S01117
     C                     PARM *BLANKS   RENT    3                       S01117
     C                     PARM           SFILP  10                       S01117
     C                     PARM           SPLNO   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0651'  DBPGM            ***************S01117
     C                     MOVEL'FT0651P1'DBKEY            ** DBERR  20 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD20        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* MOVE REPORT NAME AND SPOOL FILE NBR TO ZSFILE AND CALL ZSFILE     S01117
     C                     Z-ADDSFNUM2    SPLNO                           S01117
     C                     MOVELSFILE2    SFILP                           S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           RSEQ    5                       S01117
     C                     PARM *BLANKS   RENT    3                       S01117
     C                     PARM           SFILP  10                       S01117
     C                     PARM           SPLNO   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0651'  DBPGM            ***************S01117
     C                     MOVEL'FT0651P2'DBKEY            ** DBERR  21 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD21        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* MOVE AUDIT REPORT NAME AND SPOOL FILE NBR TO ZSFILE AND           S01117
     C* CALL ZSFILE                                                       S01117
     C                     Z-ADDSFNUMU    SPLNO                           S01117
     C                     MOVELSFILEU    SFILP                           S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           RSEQ    5                       S01117
     C                     PARM *BLANKS   RENT    3                       S01117
     C                     PARM           SFILP  10                       S01117
     C                     PARM           SPLNO   60                      S01117
     C                     PARM *BLANKS   ZERR    1                       S01117
     C*                                                                   S01117
     C* IF ERROR PERFORM DATABASE ERROR HANDLING AND EXIT PROGRAM         S01117
     C*                                                                   S01117
     C           ZERR      IFEQ 'Y'                                       S01117
     C           *LOCK     IN   DLDA                                      S01117
     C                     MOVEL'FT0651'  DBPGM            ***************S01117
     C                     MOVEL'FT0651AU'DBKEY            ** DBERR  27 **S01117
     C                     MOVEL'ZSFILE'  DBFILE           ***************S01117
     C                     Z-ADD27        DBASE                           S01117
     C                     OUT  DLDA                                      S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*    INITIALISE RECORD COUNTERS                                  ***
     C*********************Z-ADD0         P3NO1                           S01117
     C                     Z-ADD0         AUNO1                           S01117
     C*********************Z-ADD0         P3NO2                           S01117
     C*********************Z-ADD0         AUNO2                     S01117S01310
     C*********************Z-ADD0         P3NO3                           S01117
     C*********************Z-ADD0         AUNO3                     S01117S01310
     C                     Z-ADD0         PAGEP1
     C                     Z-ADD0         PAGEP2
     C*********************Z-ADD0         PAGEP3                          S01117
     C                     Z-ADD0         PAGEAU                          S01117
     C                     TIME           TIME    60
     C*                                                     **************
     C**   SET UP KEY AND ACCESS INSTALLATION CONTROL RECORD (TABTB10F)
     C                     MOVEL'01      'ZTABKY 12
     C                     MOVE '  10'    ZTABKY
     C**
     C           ZTABKY    CHAINTABFP                99    ON NOT THERE
     C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
     C*
     C           *IN99     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM  5         )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM  8         )))  DATA  )))S01310
     C                     MOVELZTABKY    DBERKY 39         )))  BASE  )))
     C                     MOVE '01'      DBERR#  2         ))) ERROR  )))
     C                     EXSR DBERR                       )))   01   )))
     C                     END                              ))))))))))))))
     C*
     C**   INSTALLATION CONTROL RECORD FOUND SO SAVE FIELDS
     C                     MOVE RUNA      SRUNA   7        SAVE ALPHA DATE
     C                     MOVE TITL      STITL  53        SAVE TITLE
     C*
     C**   SET UP KEY AND ACCESS INSTALLATION CONTROL RECORD (TABTB11F)
     C*
     C                     MOVE *BLANKS   ZTABKY
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '11'      ZTABKY
     C           ZTABKY    CHAINTABFP                10
     C  N10      RECI      COMP 'D'                  1010
     C*
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELZTABKY    DBERKY            )))  BASE  )))
     C                     MOVE '02'      DBERR#            ))) ERROR  )))
     C                     EXSR DBERR                       )))   02   )))
     C                     END                              ))))))))))))))
     C*
     C**   INST. CONTROL RECORD FOUND SO SAVE CUST. NO. OF HEAD OFFICE
     C**********           Z-ADDHEAD      SHEAD   60       SAVE CUST NO OF                    CSD027
     C                     MOVE HEAD      SHEAD   6        SAVE CUST NO OF                    CSD027
     C*********************Z-ADDFTDB      SDFBR            SAVE BRANCH NUMS01117
     C*
     C****SET*UP*KEY*AND*ACCESS*INST.*CONTROL*REC*BRANCH*CODE*(TABLETR)*  S01117
     C*********************                                               S01117
     C*********************MOVEL'10    '  ZTABKY                          S01117
     C*********************MOVE SDFBR     ZTABKY                          S01117
     C***********ZTABKY****CHAINTABFP                10                   S01117
     C**N10******RECI******COMP 'D'                  1010  ON , DELETED   S01117
     C*********************                                               S01117
     C************IN10*****IFEQ '1'                         ))))))))))))))S01117
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01117
     C*********************MOVELZTABKY    DBERKY            )))  BASE  )))S01117
     C*********************MOVE '03'      DBERR#            ))) ERROR  )))S01117
     C*********************EXSR DBERR                       )))   03   )))S01117
     C*********************END                              ))))))))))))))S01117
     C***SAVE*BRANCH*INTERNAL*CUSTOMER*NO.*                               S01117
     C*********************MOVE BICN      SBICN   60                      S01117
     C***SET*UP*KEY*TO*ACCESS*CLIENT*FILE.*                               S01117
     C*********************MOVE BICN      KCUSNO  60                      S01117
     C*********************MOVE 'A'       KEYA    1                       S01117
     C*********************                                               S01117
     C***ACCESS*CLIENT*FILE*                                              S01117
     C***********CUSKEY****CHAINCLINTCBF             80                   S01117
     C*********************                                               S01117
     C************IN80*****IFEQ '1'                         ))))))))))))))S01117
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01117
     C*********************MOVEL'      A' DBERKY            )))  BASE  )))S01117
     C*********************MOVELKCUSNO    DBERKY            )))  BASE  )))S01117
     C*********************MOVE '04'      DBERR#            ))) ERROR  )))S01117
     C*********************EXSR DBERR                       )))   04   )))S01117
     C*********************END                              ))))))))))))))S01117
     C*********************                                               S01117
     C**************************************
     C*****REMOVE*TERMINAL*ID*             *                              S01117
     C**************************************
     C*********************                                               S01117
     C***MOVE*SWIFT*ADDRESS*IN*DATA*STRUCTURE*                            S01117
     C*********************MOVE CSID      SCSID                           S01117
     C***SAVE***'OUR*TID'*FIELD*IN*WORK*AREA*                             S01117
     C*********************MOVE SCSID     MXOSFT 12                       S01117
     C*********************MOVE TELX      MXOTLX 12                       S01117
     C***ACCESS*TO*SDBRCHL5*                                        E22406S01310
     C*********************MOVE BICN      WWBICN  6                 E22406S01310
     C***********WWBICN****CHAINSDBRCHL5             09             E22406S01310
     C**N09******A8TYLC****COMP 'D'                      09         E22406S01310
     C*********************                                         E22406S01310
     C************IN09*****IFEQ '1'                         ))))))))E22406S01310
     C*********************MOVE 'SDBR5'   DBFNAM            )))  DATE22406S01310
     C*********************MOVELA8BICN    DBERKY            )))  BASE22406S01310
     C*********************MOVE '22'      DBERR#            ))) ERROE22406S01310
     C*********************EXSR DBERR                       )))   22E22406S01310
     C*********************END                              ))))))))E22406S01310
     C*********************                                         E22406S01310
     C*********************MOVE A8BTID    SCSID                     E22406S01310
     C*********************MOVE SCSID     MXOSFT 12                 E22406S01310
     C*  CHECK TYPE OF RUN
     C           IPPARM    IFEQ 'I'
     C                     SETON                     13
     C                     END
     C*  SET MESSAGE PRODUCTION PARAMETER
     C                     MOVE 'N'       OPPARM  1
      *                                                                   S01310
      **  Access SDMMODPD for networks available.                         S01310
      *                                                                   S01310
     C                     CALL 'AOMMODR0'                                S01310
     C                     PARM '*MSG   ' @RTCD                           S01310
     C                     PARM '*FIRST ' @OPTN                           S01310
     C           SDMMOD    PARM SDMMOD    DSSDY                           S01310
      *                                                                   S01310
      ** If no record is found on sdmmodpd.                               S01310
      *                                                                   S01310
     C           @RTCD     IFNE *BLANKS                                   S01310
     C                     MOVE '003'     DBERR#             * * * * * * *S01310
     C                     MOVEL'FIRST'   DBERKY             * DBERR 003 *S01310
     C                     MOVEL'SDMMODPD'DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
      *                                                                   S01310
      **  Access SDMGMEPD for drop SWIFT msg. no. days                    S01310
      *                                                                   S01310
     C                     CALL 'AOMGMER0'                                S01310
     C                     PARM '*MSG   ' @RTCD   7                       S01310
     C                     PARM '*FIRST ' @OPTN   7                       S01310
     C           SDMGME    PARM SDMGME    DSFDY                           S01310
      *                                                                   S01310
      ** If no record is found on SDMGMEPD.                               S01310
      *                                                                   S01310
     C           @RTCD     IFNE *BLANKS                                   S01310
     C                     MOVE '25'      DBERR#             * * * * * * *S01310
     C                     MOVEL'FIRST'   DBERKY             * DBERR 025 *S01310
     C                     MOVEL'SDMGMEPD'DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
      *                                                                   S01310
      **  Convert history retention date to YYMMDD                        S01310
      *                                                                   S01310
     C           RUND      ADD  ENDSMN    ZMDAY                           S01310
     C                     CALL 'ZM0060'               15                 S01310
     C                     PARM           ZMDAY                           S01310
     C                     PARM           ZMDATE                          S01310
      *                                                                   S01310
      ** If the program ends in error.                                    S01310
      *                                                                   S01310
     C           *IN15     IFEQ '1'                                       S01310
     C                     MOVE '26'      DBERR#             * * * * * * *S01310
     C                     MOVEL'       ' DBERKY             * DBERR 026 *S01310
     C                     MOVEL'ZM0060'  DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
     C                     MOVE ZMDATE    @HRDT   6                       S01310
      *                                                                   S01310
      **  Initialise constant fields                                      S01310
      *                                                                   S01310
     C                     MOVE *LOVAL    CR      1                       S01310
     C                     BITON'457'     CR                              S01310
     C                     MOVE *LOVAL    LF      1                       S01310
     C                     BITON'257'     LF                              S01310
     C                     MOVELCR        CRLF    2                       S01310
     C                     MOVE LF        CRLF                            S01310
      *                                                                   S01310
      **  CRLF Control Character for message data records                 S01310
      *                                                                   S01310
     C                     MOVE CRLF      CTRC                            S01310
     C***SET*UP*HEXADECIMAL*VALUE*OF*X'0D25'                              S01310
     C*********************Z-ADD13        B0D                             S01310
     C*********************Z-ADD37        B25                             S01310
     C*********************MOVELX0D       X0D25                           S01310
     C*********************MOVE X25       X0D25                           S01310
      *                                                                   CEU006
      * Access SAR details to determine if EMU Settlement Details         CEU006
      * switched on (CEU006)                                              CEU006
     C                     CALL 'AOSARDR0'                                CEU006
     C                     PARM *BLANKS   @RTCD                           CEU006
     C                     PARM '*VERIFY' @OPTN                           CEU006
     C                     PARM 'CEU006'  @SARD   6                       CEU006
     C           SCSARD    PARM SCSARD    DSFDY                           CEU006
     C*                                                                   CEU006
     C** If core feature is switched ON, set a variable field to          CEU006
     C** condition the rest of the processing                             CEU006
     C*                                                                   CEU006
     C           @RTCD     IFEQ *BLANKS                                   CEU006
     C                     MOVE 'Y'       CEU006  1                       CEU006
     C                     ELSE                                           CEU006
     C*                                                                   CEU006
     C** else, database error (return code other than *NRF)               CEU006
     C*                                                                   CEU006
     C           @RTCD     IFNE '*NRF   '                                 CEU006
     C                     MOVEL'SCSARDPD'DBFNAM           ************   CEU006
     C                     MOVEL'*VERIFY' DBERKY           * DBERR 31 *   CEU006
     C                     MOVE '31'      DBERR#           ************   CEU006
     C                     EXSR DBERR                                     CEU006
     C                     END                                            CEU006
     C                     END                                            CEU006
      *                                                                   CEU006
      * Access SAR details to determine if SWIFT Decimal Places is        CSW020
      * switched on (CSW020)                                              CSW020
     C                     CALL 'AOSARDR0'                                CSW020
     C                     PARM *BLANKS   @RTCD                           CSW020
     C                     PARM '*VERIFY' @OPTN                           CSW020
     C                     PARM 'CSW020'  @SARD   6                       CSW020
     C           SCSARD    PARM SCSARD    DSFDY                           CSW020
     C*                                                                   CSW020
     C** If core feature is switched ON, set a variable field to          CSW020
     C** condition the rest of the processing                             CSW020
     C*                                                                   CSW020
     C           @RTCD     IFEQ *BLANKS                                   CSW020
     C                     MOVE 'Y'       CSW020  1                       CSW020
     C                     ELSE                                           CSW020
     C*                                                                   CSW020
     C** else, database error (return code other than *NRF)               CSW020
     C*                                                                   CSW020
     C           @RTCD     IFNE '*NRF   '                                 CSW020
     C                     MOVEL'SCSARDPD'DBFNAM           ************   CSW020
     C                     MOVEL'*VERIFY' DBERKY           * DBERR 38 *   CSW020
     C                     MOVE '38'      DBERR#           ************   CSW020
     C                     EXSR DBERR                                     CSW020
     C                     END                                            CSW020
     C                     END                                            CSW020
      *                                                                   CSW020
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   PRTCD   7                                           CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Check if switchable feature CSW202 is switched on                                    CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Access SAR file to determine if Compliance Watch                                     CSD015
      ** (CSD015) is installed.                                                               CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** An NRF (No Record Found) return code is valid.                                       CSD015
      ** Issue database error only for error return codes.                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'DBFNAM                                              CSD015
     C                     MOVEL'*VERIFY' DBERKY                                              CSD015
     C                     MOVE '39'      DBERR#                                              CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVEL'Y'       CSD015  1                                           CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   PRTCD                                               222385
     C                     PARM '*KEY'    POPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           PRTCD     IFNE *BLANKS                                                       222385
     C           PRTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFNAM                                              222385
     C                     MOVELPFUNC     DBERKY                                              222385
     C                     MOVEL'32'      DBERR#                                              222385
     C                     EXSR DBERR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       CSD015                                              CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if switchable feature CSW025 is switched on.                                   CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database error                                                                       CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'CSW025'  DBERKY                                              CSD015
     C                     MOVEL'SCSARDPD'DBFNAM                                              CSD015
     C                     MOVE '40'      DBERR#                                              CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVEL'Y'       CSW025  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       CSW025                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     SETON                     40     1ST CYCLE DONE
     C                     ENDSR
     C*
     C************************************************************
     C* END OF FIRST CYCLE PROCESSING
     C************************************************************
      /EJECT                                                              138077
      *****************************************************************   138077
      *                                                               *   138077
      *   SEXTN - Store customer with SWIFT address to data structure *   138077
      *                                                               *   138077
      *****************************************************************   138077
      *                                                                   138077
     C           SEXTN     BEGSR                                          138077
      *                                                                   138077
     C                     MOVELMTAG      @MTG                            138077
     C           FLDTYP    IFEQ '5'                                       138077
     C           FLDTAG    ANDEQ'A'                                       138077
     C                     ADD  1         V                               138077
     C           V         OCUR EXTN                                      138077
     C                     Z-ADDM         MPSN                            138077
     C                     MOVEL@MTG      MTG                             138077
     C                     MOVELBBCUST    MCSI                            138077
     C                     ENDIF                                          138077
      *                                                                   138077
     C           SEXT9     ENDSR                                          138077
     C/EJECT                                                              S01117
      *****************************************************************   S01310
      *   INTF - Initalise non-constant fields                        *   S01310
      *   Called by - main process                                    *   S01310
      *   Calls     -                                                 *   S01310
      *****************************************************************   S01310
      *                                                                   S01310
     C           INTF      BEGSR                                          S01310
      *                                                                   S01310
     C                     MOVE PREF      TRNO                            S01310
     C                     MOVEL'FT'      TRNO
     C                     MOVE '      '  NWRK                            S01310
     C**********           Z-ADD0         SECN                                         S01310 CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN                            S01310
     C**********           Z-ADD0         DECN                                         S01310 CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS                            S01310
     C                     MOVE '1'       MGSG                            S01310
     C***********          MOVE 'CRTD'    MGST                     S01310 088545
     C                     MOVE *BLANKS   MGST                            088545
     C                     Z-ADD0         MGTM                            S01310
     C                     Z-ADD0         LATM                            S01310
     C                     MOVE *BLANKS   RELD                            S01310
     C                     Z-ADD0         RELT                            S01310
     C                     MOVE *BLANKS   AMTS                            S01310
     C                     MOVE *BLANKS   SVDT                            S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   SNCSID 12                       S01310
     C                     MOVE *BLANKS   STELX  10                       S01310
     C                     MOVE *BLANKS   SSTTX  12                       S01310
     C                     MOVE *BLANKS   SCRNM  20                       S01310
      *                                                                   S01310
      **  Clear multiple occurrence data structure                        S01310
      *                                                                   S01310
     C                     Z-ADD1         M       20                      S01310
     C           M         OCUR MULT                                      S01310
      *                                                                   S01310
     C           M         DOWLE40                                        S01310
     C           MULT      ANDNE*BLANKS                                   S01310
     C                     MOVE *BLANKS   MULT                            S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     END                                            S01310
      *                                                                   138077
      ** Clear multiple occurrence DS for the extension file.             138077
      *                                                                   138077
     C                     Z-ADD1         V       20                      138077
     C           V         OCUR EXTN                                      138077
     C           V         DOWLE20                                        138077
     C           MCSI      ANDNE*BLANKS                                   138077
     C                     Z-ADD*ZEROS    MPSN                            138077
     C                     MOVE *BLANKS   MTG                             138077
     C                     MOVE *BLANKS   MCSI                            138077
     C                     ADD  1         V                               138077
     C           V         OCUR EXTN                                      138077
     C                     ENDDO                                          138077
     C                     Z-ADD0         V                               138077
      *                                                                   S01310
     C                     ENDSR                                          S01310
      *                                                                   S01310
     C/EJECT                                                              S01310
     C*****************************************************************   S01117
     C*   SUBROUTINE BRANCH                                   *           S01117
     C*     TO VALIDATE EACH BOOKING BRANCH FOR EVERY RECORD  *           S01117
     C*     CALLED BY MAIN PROCESSING                         *           S01117
     C*********************************************************           S01117
     C*                                                                   S01117
     C           BRANCH    BEGSR                                          S01117
     C*   SAVE BOOKING BRANCH (BRCA) READ FROM CQPACDD FILE               S01117
     C                     MOVE BRCA      BRCAA   3                       S01117
     C*   SET UP KEY AND ACCESS INST. CONTROL REC BRANCH CODE (TABLETR)   S01117
     C*                                                                   S01117
     C**********           MOVEL'10    '  ZTABKY                                      S01117 BUG7985
     C**********           MOVE BRCA      ZTABKY                                      S01117 BUG7985
     C********** ZTABKY    CHAINTABFP                10                               S01117 BUG7985
     C**N10***** RECI      COMP 'D'                  1010  ON , DELETED               S01117 BUG7985
     C*                                                                   S01117
     C********** *IN10     IFEQ '1'                         ))))))))))))))            S01117 BUG7985
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATS01117S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATS01117S01310
     C                     MOVELZTABKY    DBERKY            )))  BASE  )))S01117
     C                     CALL 'AOBRCHR1'                                                   BUG7985
     C                     PARM *BLANKS   PRTCD   7                                          BUG7985
     C                     PARM '*KEY   ' POPTN   7                                          BUG7985
     C                     PARM BRCA      PBRCH   3                                          BUG7985
     C           SDBRCH    PARM SDBRCH    DSSDY                                              BUG7985
      *                                                                                      BUG7985
     C           PRTCD     IFNE *BLANKS                                                      BUG7985
     C                     MOVE 'SDBRCHPD'DBFILE                                             BUG7985
     C                     MOVELBRCA      DBKEY                                              BUG7985
     C                     MOVE '03'      DBERR#            ))) ERROR  )))S01117
     C                     EXSR DBERR                       )))   03   )))S01117
     C                     END                              ))))))))))))))S01117
     C*                                                                   S01117
     C*  SAVE BRANCH INTERNAL CUSTOMER NO.                                S01117
     C**********           MOVE BICN      SBICN   60                                  S01117 BUG7985
     C**********           MOVE WYBICN    SBICN   60                           S01117 BUG7985 CSD027
     C                     MOVE WYBICN    SBICN   6                                           CSD027
     C***SET*UP*KEY*TO*ACCESS*CLIENT*FILE.                          S01117S01310
     C*********************MOVE BICN      KCUSNO  60                S01117S01310
     C*********************MOVE 'A'       KEYA    1                 S01117S01310
     C*********************                                         S01117S01310
     C***ACCESS*CLIENT*FILE                                         S01117S01310
     C***********BICN******CHAINCLINTCBF             80             S01117S01310
     C*********************                                         S01117S01310
     C************IN80*****IFEQ '1'                         ))))))))S01117S01310
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATS01117S01310
     C*********************MOVEL'      A' DBERKY            )))  BASS01117S01310
     C*********************MOVELBICN      DBERKY            )))  BASS01117S01310
     C*********************MOVE '04'      DBERR#            ))) ERROS01117S01310
     C*********************EXSR DBERR                       )))   04S01117S01310
     C*********************END                              ))))))))S01117S01310
      *                                                                   S01310
      **  Access SDCUSTPD using branch internal customer number           S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   @KEY1                           S01310
     C**********           MOVELBICN      @KEY1                                       S01310 BUG7985
     C                     MOVELWYBICN    @KEY1                                       S01310 BUG7985
     C                     CALL 'AOCUSTR0'                                S01310
     C                     PARM '*MSG   ' @RTCD                           S01310
     C                     PARM '*KEY   ' @OPTN                           S01310
     C                     PARM           @KEY1  10                       S01310
     C                     PARM *BLANKS   @KYST   7                       S01310
     C           SDCUST    PARM SDCUST    DSSDY                           S01310
      *                                                                   S01310
      ** Customer record not found - Error                                S01310
      *                                                                   S01310
     C           @RTCD     IFNE *BLANKS                                   S01310
     C                     MOVE '025'     DBERR#             * * * * * * *S01310
     C                     MOVEL@KEY1     DBERKY             * DBERR 025 *S01310
     C                     MOVEL'SDCUSTPD'DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
      *                                                                   S01310
      ** Move new field names to old to ensure pgm continuity.            S01310
      *                                                                   S01310
     C                     MOVE BBTXA1    TELX   10                       S01310
      *                                                                   S01310
      **  Save sender's addresses & parent customer number                S01310
      *                                                                   S01310
     C                     MOVE BBCSID    CSID                            S01310
     C                     MOVE BBTXA1    STELX  10                       S01310
     C                     MOVE BBSTAD    SSTTX  12                       S01310
     C                     MOVE BBCRNM    SCRNM  20                       S01310
     C*                                                                   S01117
     C**************************************                              S01117
     C*    REMOVE TERMINAL ID              *                              S01117
     C**************************************                              S01117
     C*                                                                   S01117
     C*  SAVE   'OUR TID' FIELD IN WORK AREA                              S01117
     C                     MOVE TELX      MXOTLX 12                       S01117
     C** ACCESS TO SDBRCHL5                                               S01310
     C**********           MOVE BICN      WWBICN  6                                   S01310 BUG7985
     C                     MOVE WYBICN    WWBICN  6                                   S01310 BUG7985
     C           WWBICN    CHAINSDBRCHL5             09                   S01310
     C  N09      A8TYLC    COMP 'D'                      09               S01310
     C*                                                                   S01310
     C           *IN09     IFEQ '1'                         ))))))))))))))S01310
     C                     MOVEL'SDBRCHL5'DBFNAM            )))  DATA  )))S01310
     C                     MOVELA8BICN    DBERKY            )))  BASE  )))S01310
     C                     MOVE '22'      DBERR#            ))) ERROR  )))S01310
     C                     EXSR DBERR                       )))   22   )))S01310
     C                     END                              ))))))))))))))S01310
     C*                                                                   S01310
     C                     MOVE A8BTID    SNCSID                          064393
     C                     MOVE A8BTID    SCSID                           S01310
     C                     MOVE SCSID     MXOSFT 12                       S01310
      *                                                                   S01310
      **  Save swift address of sender                                    S01310
      *                                                                   S01310
     C                     MOVE BBCSID    SCSID                           S01310
     C                     ENDSR                                          S01117
     C/EJECT
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     *         SUBROUTINE 01                         ***        ***
     C*     *   TO FORMAT SETTLEMENT PARTY TO SWIFT FORMAT  ***        ***
     C*     *                                               ***        ***
     C*********************************************************        ***
     C           SR01      BEGSR                            ***        ***
     C*   INITIALISE OUTPUT PARAMETER FIELDS                           ***
     C                     MOVE *BLANKS   OFSPT1 35
     C                     MOVE *BLANKS   OFSPT2 35
     C                     MOVE *BLANKS   OFSPT3 35
     C                     MOVE *BLANKS   OFSPT4 35
     C                     MOVE *BLANKS   OFSPT5 35
     C                     MOVE *BLANKS   OSTAG   1
     C*********************MOVE 'N'       OSUFLG  1                       S01310
     C                     MOVE *BLANKS   CSID
     C**********           Z-ADD0         CPAR                                                CSD027
     C                     MOVE *BLANKS   CPAR                                                CSD027
     C*                                                                ***
     C*   FULL NOSTRO PROCESSING - APPEND THE PAY CURRENCY TO THE      ***
     C*   FIRST SETTLEMENT PARTY FIELD TO ACCESS NOSTRO DET FROM
     C*   PF/TABLETL TO OBTAIN CUST NO.                                ***
     C           ISPTP     IFEQ 'F'
     C                     MOVELISPTY1    TLCCNN  5        BUILD
     C                     MOVEL'70'      TABTLK 12           KEY
     C                     MOVE TLCCNN    TABTLK 12            KEY
     C           TABTLK    CHAINTABFP                10    ON, DELETED
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM  5         )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELTABTLK    DBERKY 39         )))  BASE  )))
     C                     MOVE '06'      DBERR#  2         ))) ERROR  )))
     C                     EXSR DBERR                       )))   06   )))
     C                     END                              ))))))))))))))
     C**********           MOVE CNUM      CUSTNO  60                                          CSD027
     C                     MOVE CNUM      CUSTNO  6                                           CSD027
     C                     END
     C*                                                                ***
     C*   NOSTRO NO. PROCESSING - APPEND THE PAY CURRENCY TO THE       ***
     C*   FIRST 2 CHARS OF THE 1ST SETL PTY FIELD TO ACCESS NOSTRO DET
     C*   FROM PF/TABLETL TO OBTAIN CUST NO.                           ***
     C           ISPTP     IFEQ 'N'
     C                     MOVELISPTY1    TLNN    2        BUILD
     C                     MOVELPCCY      TLCCNN             KEY
     C                     MOVE TLNN      TLCCNN              KEY
     C                     MOVEL'70'      TABTLK                KEY
     C                     MOVE TLCCNN    TABTLK 12              KEY
     C           TABTLK    CHAINTABFP                10    ON, DELETED
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM  5         )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELTABTLK    DBERKY 39         )))  BASE  )))
     C                     MOVE '07'      DBERR#  2         ))) ERROR  )))
     C                     EXSR DBERR                       )))   07   )))
     C                     END                              ))))))))))))))
     C**********           MOVE CNUM      CUSTNO  60                                          CSD027
     C                     MOVE CNUM      CUSTNO  6                                           CSD027
     C                     END
     C*                                                                ***
     C*   RETAIL ACCNT PROCESSING -                                    ***
     C*   USE 1ST 10 CHARS OF THE 1ST SETL PTY FIELD TO ACCESS
     C*   THE ACCOUNT DETAILS FROM LF/ACNUMA TO OBTAIN CUST NO.        ***
     C           ISPTP     IFEQ 'R'
     C                     MOVELISPTY1    ACNUMK 100
     C           ACNUMK    CHAINACNUMA               11    ON, DELETED
     C           *IN11     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'ACNUMA'  DBFNAM  5         )))  DATA  )))S01310
     C                     MOVEL'ACNUMA'  DBFNAM            )))  DATA  )))S01310
     C                     MOVELACNUMK    DBERKY 39         )))  BASE  )))
     C                     MOVE '08'      DBERR#  2         ))) ERROR  )))
     C                     EXSR DBERR                       )))   08   )))
     C                     END                              ))))))))))))))
     C**********           MOVE CNUM      CUSTNO  60                                          CSD027
     C                     MOVE CNUM      CUSTNO  6                                           CSD027
     C                     END
     C*                                                                ***
     C*   FULL ACCOUNT/PARTIAL ACCOUNT/CUSTOMER PROCESSING - CUST NO.  ***
     C*   IS 1ST 6 CHARS OF THE 1ST SETL PTY FIELD.
     C           ISPTP     IFEQ 'G'
     C           ISPTP     OREQ 'P'
     C           ISPTP     OREQ 'C'
     C                     MOVELISPTY1    CUSTNO
     C                     END
      *                                                                   094278
      * If SWIFT identifier then use ME1400 to check details              094278
      *                                                                   094278
     C           ISPTP     IFEQ 'S'                                       094278
      *                                                                   094278
      *  Call Access object to validate identifier                        094278
      *                                                                   094278
     C                     MOVELISPTY1    ##001   1                       094278
     C           ##001     IFEQ '/'                                       094278
     C                     MOVELISPTY2    W9BICC                          094278
     C           3         SUBSTISPTY2:9  W9BICB                          094278
     C                     ELSE                                           094278
     C                     MOVELISPTY1    W9BICC                          094278
     C           3         SUBSTISPTY1:9  W9BICB                          094278
     C                     END                                            094278
      *                                                                   094278
     C                     CALL 'ME1400'                                  094278
     C                     PARM *BLANKS   W9RTN   7                       094278
     C                     PARM           W9BICC  8                       094278
     C                     PARM           W9BICB  3                       094278
     C                     PARM           SDCUST                          094278
     C                     PARM           SDCNST                          094278
     C                     PARM           MEBICD                          094278
     C                     PARM *BLANKS   W9CUST  1                       094278
     C                     PARM *BLANKS   W9CNST  1                       094278
     C                     PARM *BLANKS   W9BICD  1                       094278
      *                                                                   094278
      * If customer details exist then set up CUSTNO                      094278
      *                                                                   094278
     C           W9CUST    IFEQ 'Y'                                       094278
     C                     MOVELBBCUST    CUSTNO                          094278
      *                                                                   094278
     C                     ELSE                                           094278
     C**********           Z-ADD0         CUSTNO                                       094278 CSD027
     C                     MOVE *BLANKS   CUSTNO                                              CSD027
      *                                                                   094278
     C                     END                                            094278
      *                                                                   094278
     C                     END                                            094278
      *                                                                   094278
     C****ACCESS*FULL*CUSTOMER*DETAILS*FROM*LF/CLINT                   ***S01310
      *                                                                   S01310
      ** Access full customer details from SDCUSTPD                       S01310
      *                                                                   S01310
     C           ISPTP     IFEQ 'G'
     C           ISPTP     OREQ 'P'
     C           ISPTP     OREQ 'C'
     C           ISPTP     OREQ 'F'
     C           ISPTP     OREQ 'N'
     C           ISPTP     OREQ 'R'
     C           W9CUST    OREQ 'Y'                                       094278
     C           ISPTP     ANDEQ'S'                                       094278
     C***SET*UP*CUSTOMER*KEY                                              S01310
     C*********************MOVELCUSTNO    KCUSNO  60                      S01310
     C*********************MOVE 'A'       KEYA    1                       S01310
     C***********CUSKEY****CHAINCLINTCBF             12    ON, DELETED    S01310
     C************IN12*****IFEQ '1'                         ))))))))))))))S01310
     C*********************MOVE 'CLINT'   DBFNAM  5         )))  DATA  )))S01310
     C*********************MOVEL'      A' DBERKY            )))  BASE  )))S01310
     C*********************MOVELKCUSNO    DBERKY            )))  BASE  )))S01310
     C*********************MOVE '09'      DBERR#  2         ))) ERROR  )))S01310
     C*********************EXSR DBERR                       )))   09   )))S01310
     C*********************END                              ))))))))))))))S01310
      *                                                                   S01310
      **  Access SDCUSTPD using customer number                           S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   @KEY1                           S01310
     C                     MOVELCUSTNO    @KEY1                           S01310
     C                     CALL 'AOCUSTR0'                                S01310
     C                     PARM '*MSG   ' @RTCD                           S01310
     C                     PARM '*KEY   ' @OPTN                           S01310
     C                     PARM           @KEY1  10                       S01310
     C                     PARM *BLANKS   @KYST   7                       S01310
     C           SDCUST    PARM SDCUST    DSSDY                           S01310
      *                                                                   S01310
      ** Customer record not found - Error                                S01310
      *                                                                   S01310
     C           @RTCD     IFNE *BLANKS                                   S01310
     C                     MOVE '026'     DBERR#             * * * * * * *S01310
     C                     MOVEL@KEY1     DBERKY             * DBERR 026 *S01310
     C                     MOVEL'SDCUSTPD'DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
      *                                                                   S01310
      ** Move old field names to new to retain pgm continuity.            S01310
      *                                                                   S01310
     C**********           MOVELBBPCNB    CPAR    60                                   S01310 CSD027
     C                     MOVELBBPCNB    CPAR    6                                           CSD027
     C                     MOVELBBCRNM    CRNM   20                       S01310
     C                     MOVELBBCRTN    CTWN   10                       S01310
     C                     MOVELBBCSID    CSID                            S01310
     C                     MOVE BBTXA1    TELX   10                       S01310
     C                     MOVE BBSTAD    STTX   12                       S01310
     C*
     C**ACCESS*DESTINATION*ADDRESS*DETAILS*VIA*SWFT*SUBROUTINE            S01310
     C**(20*ONLY*SET*ON*FOR*DESTINATION)                                  S01310
     C*
      ** Obtain destination address details using subroutine NWAD or      S01310
      ** PRAD (20 only set on for destination)                            S01310
      *                                                                   S01310
     C           *IN20     IFEQ '1'
     C*
     C*********************EXSR SWFT                                      S01310
      *                                                                   S01310
      **  Initialise networking fields                                    S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   NWSN                            S01310
     C                     MOVE *BLANKS   NWDS                            S01310
     C                     MOVE *BLANKS   NWRK                            S01310
      ***********                                                  S01310 CSW096
      ***If*the*destination*has*a*default*address*(BBDNW4)*use*it*,S01310 CSW096
      ***else*use*the*priority*network*address.********************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********BBDNW4    IFNE *BLANKS                            S01310 CSW096
     C***********          EXSR NWAD                               S01310 CSW096
     C***********          ELSE                                    S01310 CSW096
     C***********          EXSR PRAD                               S01310 CSW096
     C***********          END                                     S01310 CSW096
      ***********                                                  S01310 CSW096
      ****Fill*up*the*appropriate*array*information*from*PF/SDCUSTPS01310 CSW096
     C***********          EXSR FILL                               S01310 CSW096
      ***********                                                  S01310 CSW096
      ****If*message*status*blank,*determine*value.****************S01310 CSW096
      ****Is*default*status*for*MT400*messages*released*?**********S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********MGST      IFEQ *BLANKS                            S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********'400'     LOKUPDFS                      16        S01310 CSW096
     C***********'40*'     LOKUPDFS                      17        S01310 CSW096
     C***********'4**'     LOKUPDFS                      18        S01310 CSW096
      ***********                                                  S01310 CSW096
     C************IN16     IFEQ '1'                                S01310 CSW096
     C************IN17     OREQ '1'                                S01310 CSW096
     C************IN18     OREQ '1'                                S01310 CSW096
     C***********          MOVE 'RSND'    MGST                     S01310 CSW096
     C***********          MOVE '2'       MGSG                     S01310 CSW096
     C***********          ELSE                                    S01310 CSW096
     C***********                                                  088545 CSW096
     C****If*there*is*no*default*for*that*type*of*message*for*that*088545 CSW096
     C****customer,*setup*the*message*status*whith*the*ICD*default.088545 CSW096
     C***********                                                  088545 CSW096
     C***********FTCS      IFEQ 'R'                                088545 CSW096
     C***********          MOVE 'RSND'    MGST                     088545 CSW096
     C***********          MOVE '2'       MGSG                     088545 CSW096
     C***********          ELSE                                    088545 CSW096
     C***********          MOVE 'CRTD'    MGST                     S01310 CSW096
     C***********          MOVE '1'       MGSG                     S01310 CSW096
     C***********          END                                     088545 CSW096
     C***********          END                                     S01310 CSW096
     C***********          END                                     S01310 CSW096
      *                                                                   CSW096
     C                     EXSR SRROUT                                    CSW096
      *                                                                   S01310
     C***********CSID******IFEQ *BLANKS                                   S01310
     C*********************MOVE 'N'       OSUFLG                          S01310
     C*********************END                                            S01310
     C                     END
     C                     GOTO SR01A
     C                     END
      *                                                                   094278
      * If SWIFT identifier and destination of message set up             094278
      * routing data                                                      094278
      *                                                                   094278
     C           ISPTP     IFEQ 'S'                                       094278
     C           *IN20     ANDEQ'1'                                       094278
     C                     MOVEL'Y'       OSUFLG                          094278
     C**********           Z-ADD0         CPAR                                         094278 CSD027
     C                     MOVE *BLANKS   CPAR                                                CSD027
     C                     MOVELISPTY1    CRNM                            094278
     C                     MOVELSNCSID    NWSN                            094278
     C                     MOVELISPTY1    NWDS                            094278
     C                     MOVEL'SWIFT'   NWRK                            094278
     C                     MOVEL*BLANKS   CTWN                            094278
     C                     MOVELISPTY1    CSID                            094278
     C*                                                                   094278
     C*  Default the message status whith the ICD.                        094278
     C*                                                                   094278
     C           FTCS      IFEQ 'R'                                       094278
     C                     MOVE 'RSND'    MGST                            094278
     C                     MOVE '2'       MGSG                            094278
     C                     ELSE                                           094278
     C                     MOVE 'CRTD'    MGST                            094278
     C                     MOVE '1'       MGSG                            094278
     C                     END                                            094278
     C                     END                                            094278
     C*                                                                ***
     C*   SWIFT ADDRESS AND AT LEAST ONE VALID TAG FIELDS = 'A'        ***
     C           ISPTP     IFEQ 'S'
     C           IVTAG1    ANDEQ'A'
     C                     MOVELISPTY1    SP12   12        1ST 12 CHARS
     C                     MOVELSP12      SCSID            1ST 12 CHARS
     C                     MOVELSCSID     OFSPT1
     C                     MOVE 'A'       OSTAG
     C*********************MOVE 'Y'       OSUFLG                          S01310
     C                     GOTO SR01N
     C                     END
     C*                                                                ***
     C*   SWIFT ADDRESS AND AT LEAST ONE VALID TAG FIELDS = 'D'        ***
     C           ISPTP     IFEQ 'S'
     C           IVTAG3    ANDEQ'D'
     C                     MOVELISPTY1    SP12   12        1ST 12 CHARS
     C                     MOVELSP12      OFSPT1           1ST 12 CHARS
     C                     MOVE 'D'       OSTAG
     C*********************MOVE 'Y'       OSUFLG                          S01310
     C                     GOTO SR01N
     C                     END
     C*                                                                ***
     C*   FULL ADDRESS AND AT LEAST ONE VALID TAG FIELDS = 'D'         ***
     C           ISPTP     IFEQ 'A'
     C           IVTAG3    ANDEQ'D'
     C                     MOVELISPTY1    OFSPT1
     C                     MOVELISPTY2    OFSPT2
     C                     MOVELISPTY3    OFSPT3
     C                     MOVELISPTY4    OFSPT4
     C                     MOVELISPTY5    OFSPT5
     C                     MOVE 'D'       OSTAG
     C*********************MOVE 'N'       OSUFLG                          S01310
      *                                                                                      260987A
      ** Ensure fields for MGOREFPD set up correctly (if destination).                       260987A
      *                                                                                      260987A
     C           *IN20     IFEQ '1'                                                          260987A
     C                     MOVEL'PAPER'   NWRK                                               260987A
     C                     MOVELSBICN     NWSN                                               260987A
     C                     MOVELSBICN     SECN                                               260987A
     C                     MOVELISPTY1    NWDS                                               260987A
     C                     MOVEL*BLANKS   BBCUST                                             260987A
     C                     ENDIF                                                             260987A
      *                                                                                      260987A
      ** Default the message status with the ICD.                                            260987A
      *                                                                                      260987A
     C           FTCS      IFEQ 'R'                                                          260987A
     C                     MOVE 'RSND'    MGST                                               260987A
     C                     MOVE '2'       MGSG                                               260987A
     C                     ELSE                                                              260987A
     C                     MOVE 'CRTD'    MGST                                               260987A
     C                     MOVE '1'       MGSG                                               260987A
     C                     ENDIF                                                             260987A
      *                                                                                      260987A
     C                     GOTO SR01N
     C                     END
     C*
     C           SR01A     TAG
     C*                                                                ***
     C****VALID*TAG*FIELD*=*'D'*AND*THE*SWIFT*ADDRESS*ON*LF/CLINT*IS   ***S01310
     C****NON*BLANK                                                    ***S01310
      *                                                                   S01310
      ** Valid tag field = 'D' & SWIFT address on SDCUSTPD non-blank      S01310
      *                                                                   S01310
     C           IVTAG1    IFEQ 'A'
     C           CSID      ANDNE*BLANK
     C                     MOVELCSID      SCSID
     C                     MOVELSCSID     OFSPT1
     C                     MOVE 'A'       OSTAG
     C*********************MOVE 'Y'       OSUFLG                          S01310
     C                     GOTO SR01N
     C                     END
     C*                                                                ***
     C****VALID*TAG*FIELD*=*'B'*AND*THE*CUSTOMER*PARENT*NUMBER*FROM    ***S01310
     C***LF/CLINT*IS*NON*ZERO*AND*EQUAL*TO*THE*CUST.*NO.*OF*HEAD*OFFICE***S01310
      *                                                                   S01310
      ** Valid tag field = 'B' & customer parent number from SDCUSTPD     S01310
      ** is non-zero and equal to customer no. of head office             S01310
      *                                                                   S01310
     C           IVTAG2    IFEQ 'B'
     C********** CPAR      ANDNE*ZERO                                                         CSD027
     C           CPAR      ANDNE*BLANKS                                                       CSD027
     C           CPAR      ANDEQSHEAD                      SAVE 1ST CYCLE
     C                     MOVELCTWN      OFSPT1
     C                     MOVE 'B'       OSTAG
     C*********************MOVE 'N'       OSUFLG                          S01310
     C                     GOTO SR01N
     C                     END
     C*                                                                ***
     C*   VALID TAG FIELD = 'D'                                        ***
     C           IVTAG3    IFEQ 'D'
     C           ISPTP     ANDNE' '
     C*********************MOVE 'B'       KEYA                            S01310
     C***********CUSKEY****CHAINCLINTCCF             12    ON, DELETED    S01310
     C************IN12*****IFEQ '1'                         ))))))))))))))S01310
     C*********************MOVE 'CLINT'   DBFNAM  5         )))  DATA  )))S01310
     C*********************MOVEL'      B' DBERKY            )))  BASE  )))S01310
     C*********************MOVELKCUSNO    DBERKY            )))  BASE  )))S01310
     C*********************MOVE '14'      DBERR#  2         ))) ERROR  )))S01310
     C*********************EXSR DBERR                       )))   14   )))S01310
     C*********************END                              ))))))))))))))S01310
     C*********************MOVELCNA1      OFSPT1                          S01310
     C*********************MOVELCNA2      OFSPT2                          S01310
     C*********************MOVELCNA3      OFSPT3                          S01310
     C*********************MOVELCNA4      OFSPT4                          S01310
     C                     MOVE BBCNA1    OFSPT1                          S01310
     C                     MOVE BBCNA2    OFSPT2                          S01310
     C                     MOVE BBCNA3    OFSPT3                          S01310
     C                     MOVE BBCNA4    OFSPT4                          S01310
     C                     MOVE 'D'       OSTAG
     C*********************MOVE 'N'       OSUFLG                          S01310
     C                     END
     C*                                                                ***
     C           SR01N     TAG
      *                                                                                       CSW201
      ** If CSW201 is installed, check if swift id is a BEI.                                  CSW201
      ** If yes, format with option 'D'.                                                      CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           OSTAG     ANDEQ'A'                                                           CSW201
     C           W201IN    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVELSCSID     W9BICC                                              CSW201
     C           3         SUBSTSCSID:9   W9BICB                                              CSW201
      *                                                                                       CSW201
     C                     CALL 'ME1400'                                                      CSW201
     C                     PARM *BLANKS   W9RTN                                               CSW201
     C                     PARM           W9BICC                                              CSW201
     C                     PARM           W9BICB                                              CSW201
     C                     PARM           SDCUST                                              CSW201
     C                     PARM           SDCNST                                              CSW201
     C                     PARM           MEBICD                                              CSW201
     C                     PARM *BLANKS   W9CUST                                              CSW201
     C                     PARM *BLANKS   W9CNST                                              CSW201
     C                     PARM *BLANKS   W9BICD                                              CSW201
      *                                                                                       CSW201
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           W9BICD    ANDEQ'Y'                                                           CSW202
     C                     CALL 'AOBEISR0'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM '*VERIFY' POPTN   7                                           CSW202
     C                     PARM BDSUBT    PBIC    4                                           CSW202
     C           MEBEIS    PARM MEBEIS    DSFDY                                               CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C           W9RTN     IFEQ *BLANKS                                                       CSW201
     C           W9BICD    ANDEQ'Y'                                                           CSW201
     C           BDSUBT    ANDEQ'BEID'                                                        CSW201
      *                                                                                       CSW201
     C           W9RTN     OREQ *BLANKS                                                       CSW201
     C           W9BICD    ANDEQ'Y'                                                           CSW201
     C           BDSUBT    ANDEQ'TRCO'                                                        CSW201
      *                                                                                       CSW201
     C           W9BICD    OREQ 'Y'                                                           CSW202
     C           CSW202    ANDEQ'Y'                                                           CSW202
     C           PRTCD     ANDEQ*BLANKS                                                       CSW202
      *                                                                                       CSW202
     C                     MOVEL'D'       OSTAG                                               CSW201
      *                                                                                       CSW201
     C           W9CNST    IFEQ 'Y'                                                           CSW201
     C                     MOVELAWCPNM    OFSPT1                                              CSW201
     C                     MOVELAWCNTN    OFSPT2                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           W9CUST    IFEQ 'Y'                                                           CSW201
     C                     MOVELBBCNA1    OFSPT1                                              CSW201
     C                     MOVELBBCNA2    OFSPT2                                              CSW201
     C                     MOVELBBCNA3    OFSPT3                                              CSW201
     C                     MOVELBBCNA4    OFSPT4                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     EXSR EMBLK
     C                     ENDSR
     C/EJECT
     C********************************************************************
      *   FLD32 - set up field 32A  &32B                              *   S01310
      *   Called by - main process                                    *   S01310
      *   Calls - SR07                                                *   S01310
      *****************************************************************   S01310
      *                                                                   S01310
     C           FLD32     BEGSR                                          S01310
     C*                                                                   S01310
     C                     Z-ADDTOTR      WAMNT                           S01310
      *                                                                   S01310
      ** Format & left adjust the amount                                  S01310
      *                                                                   S01310
     C                     EXSR SR07                                      S01310
     C*                                                                   CSW020
     C** Perform Old Processing if CSW020 is not switched on.             CSW020
     C           CSW020    IFNE 'Y'                                       CSW020
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0651CCP1                                           S01408
     C*                                                                   S01408
     C                     Z-ADD1         X       20                      S01310
     C                     Z-ADD1         Y                               S01310
     C                     MOVE *BLANKS   SAM                             S01310
     C                     MOVEA*BLANKS   AR                              S01310
     C                     DO   14                         B001           S01310
     C           AM,Y      IFNE ' '                        B002           S01310
     C                     MOVEAAM,Y      AR,X                            S01310
     C                     ADD  1         X                               S01310
     C                     END                             E002           S01310
     C                     ADD  1         Y                               S01310
     C                     END                             E001           S01310
     C                     MOVEAAR        AMX                             S01310
     C                     MOVELAMX       SAM                             S01310
     C                     ENDIF                                          CSW020
     C                     MOVE SAM       M1AMT2                          S01310
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0651CCP2                                           S01408
     C*                                                                   S01408
      *                                                                   S01310
      ** Set up field 32 in multiple occurence data structure             S01310
      *                                                                   S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVEL':32B:'   MTAG                            S01310
     C                     MOVELDS32      MFLD                            S01310
      *                                                                   S01310
      **  Amount = proceeds remitted + correspondents charges             S01310
      **                             - deductions                         S01310
      *                                                                   S01310
     C           TOTR      ADD  COCH      WAMNT                           S01310
     C                     SUB  DEDS      WAMNT                           S01310
     C*                                                                   S01499
     C**  Total V.A.T. charges                                            S01499
     C                     ADD  PCVATC    WAMNT                           S01499
     C                     SUB  PCVATD    WAMNT                           S01499
      *                                                                   S01310
      ** Format & left adjust the amount                                  S01310
      *                                                                   S01310
     C                     EXSR SR07                                      S01310
     C*                                                                   CSW020
     C** Perform Old Processing if CSW020 is not switched on.             CSW020
     C           CSW020    IFNE 'Y'                                       CSW020
     C                     Z-ADD1         X       20                      S01310
     C                     Z-ADD1         Y                               S01310
     C                     MOVE *BLANKS   SAM                             S01310
     C                     MOVEA*BLANKS   AR                              S01310
     C                     DO   14                         B001           S01310
     C           AM,Y      IFNE ' '                        B002           S01310
     C                     MOVEAAM,Y      AR,X                            S01310
     C                     ADD  1         X                               S01310
     C                     END                             E002           S01310
     C                     ADD  1         Y                               S01310
     C                     END                             E001           S01310
     C                     MOVEAAR        AMX                             S01310
     C                     MOVELAMX       SAM                             S01310
     C                     ENDIF                                          CSW020
     C                     MOVE SAM       M1AMNT                          S01310
      *                                                                   S01310
      ** Set up field 33 in multiple occurence data structure             S01310
      *                                                                   S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVEL':33A:'   MTAG                            S01310
     C                     MOVELDS33      MFLD                            S01310
      *                                                                   CEU006
      * Set up total charges work field for /CHGS/ line                   CEU006
     C           DEDS      ADD  PCVATD    W#CHGS 130                      CEU006
      *                                                                   CEU006
      *                                                                   S01310
     C                     ENDSR                                          S01310
     C/EJECT                                                              S01310
      *****************************************************************   S01310
      *   PARTY - set up fieldS 53 , 54 , 57                          *   S01310
      *   Called by - main process                                    *   S01310
      *   Calls -  none                                               *   S01310
      *****************************************************************   S01310
      *                                                                   S01310
     C           PARTY     BEGSR                                          S01310
      *                                                                   S01310
      **  Set up swift tag                                                S01310
      *                                                                   S01310
     C                     MOVE OSTAG     TAG                             S01310
     C                     MOVE ':'       COLON                           S01310
      *                                                                   S01310
      **  Fill up MULT data structure                                     S01310
      *                                                                   S01310
     C           OFSPT1    IFNE *BLANK                                    S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVE @MTAG     MTAG                            S01310
     C                     MOVELOFSPT1    MFLD                            S01310
     C                     EXSR SEXTN                                     138077
     C                     END                                            S01310
      *                                                                   S01310
     C           OFSPT2    IFNE *BLANK                                    S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVELOFSPT2    MFLD                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C           OFSPT3    IFNE *BLANK                                    S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVELOFSPT3    MFLD                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C           OFSPT4    IFNE *BLANK                                    S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVELOFSPT4    MFLD                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C           OFSPT5    IFNE *BLANK                                    S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVELOFSPT5    MFLD                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     ENDSR                                          S01310
     C/EJECT                                                              S01310
      *****************************************************************   S01310
      *   DETAIL - set up field 71,72,73                              *   S01310
      *   Called by - main process                                    *   S01310
      *   Calls - none                                                *   S01310
      *****************************************************************   S01310
     C           DETAIL    BEGSR                                       ***S01310
      *                                                                   S01310
      **  Fill up MULT data structure from ADDR array (fields  71-73      S01310
      **  can be up to six lines long)                                    S01310
      *                                                                   S01310
     C                     Z-ADD1         A                               S01310
      *                                                                   S01310
     C           A         DOWLT7                                         S01310
     C           ADDR,A    ANDNE*BLANKS                                   S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
      *                                                                   S01310
     C           A         IFEQ 1                                         S01310
     C                     MOVE @MTAG     MTAG                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     MOVEAADDR,A    WRK35  35                       S01310
     C                     MOVELWRK35     MFLD                            S01310
     C                     ADD  1         A                               S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     ENDSR                                          S01310
     C/EJECT                                                              S01310
     C********************************************************************S01310
      *   OMSG - output correctly generated messages                  *   S01310
      *   Called by - main process                                    *   S01310
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *   S01310
      *****************************************************************   S01310
      *                                                                   S01310
     C           OMSG      BEGSR                                          S01310
      *                                                                   S01310
      **  Write reference record to PF/MGOREFPD.                          S01310
      *                                                                   S01310
     C                     EXSR WREF                                      S01310
      *                                                                   S01310
      **  Write multiple occurrence data structure to MGOMSGPD            S01310
     C                     Z-ADD1         M       20                      S01310
     C           M         OCUR MULT                                      S01310
      *                                                                   S01310
     C           M         DOWLE40                                        S01310
     C           MFLD      ANDNE*BLANKS                                   S01310
     C                     WRITEMGOMSGD0               42                 S01310
      *                                                                   S01310
      **  Error on write to PF/MGOMSGPD (message data file)               S01310
      *                                                                   S01310
     C           *IN42     IFEQ '1'                                       S01310
     C                     MOVE '012'     DBERR#           * * * * * * * *S01310
     C                     MOVEL'       ' DBERKY           *  DBERR 012  *S01310
     C                     MOVEL'MGOMSGPD'DBFNAM           * * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     END                                            S01310
      *                                                                   138077
      **  Write multiple occurrence data structure to MGOEXTPD            138077
      *                                                                   138077
     C                     Z-ADD1         V       20                      138077
     C           V         OCUR EXTN                                      138077
     C           V         DOWLE20                                        138077
     C           MCSI      ANDNE*BLANKS                                   138077
     C                     WRITEMGOEXTD0               43                 138077
      *                                                                   138077
      **  Error on write to PF/MGOEXTPD (message data extension file)     138077
      *                                                                   138077
     C           *IN43     IFEQ '1'                                       138077
     C                     MOVE '043'     DBERR#           * * * * * * * *138077
     C                     MOVEL'        'DBERKY           *  DBERR 043  *138077
     C                     MOVEL'MGOEXTPD'DBFNAM           * * * * * * * *138077
     C                     EXSR DBERR                                     138077
     C                     END                                            138077
     C                     ADD  1         V                               138077
     C           V         OCUR EXTN                                      138077
     C                     ENDDO                                          138077
      *                                                                   S01310
     C                     ENDSR                                          S01310
     C/EJECT                                                              S01310
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Re-determine Message Status                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Initialise parameters for compliance engine program.                                 CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Set up parameter for compliance engine program                                       CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVELBRCAA     W4BRCH                                              CSD015
     C                     MOVEL'MGOREF  'W4FUNT                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDRUND      W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ** Send transaction to compliance engine program                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           WLTDS                                               CSD015
     C                     PARM *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *                                                                                       CSD015
      *****************************************************************   S01310
      *   WREF - Write reference record to PF/MGOREFPD                *   S01310
      *   Called by - OMSG  output message PF/MGOMSGPD                *   S01310
      *   Calls - none                                                *   S01310
      *****************************************************************   S01310
      *                                                                   S01310
     C           WREF      BEGSR                                          S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   SYTM                            S01310
     C                     MOVEL'FT'      MODI                            S01310
     C                     MOVE *BLANKS   TRNF                            S01310
     C                     MOVE *BLANKS   TRNM                            S01310
     C                     MOVELPREF      MTRN                            S01310
     C                     MOVE PYTP      TNTP                            S01310
     C                     MOVE PYST      SBTP                            S01310
     C                     MOVE *BLANKS   EVTP                            S01310
     C                     MOVE SBICN     SECN                            S01310
     C                     MOVE SCUSNO    DECN                            S01310
     C                     MOVE *BLANKS   NWBN                            S01310
     C                     MOVE '400'     MTPY                            S01310
     C*********************MOVE 'N'       MPRY                      S01310S01117
     C*  FORMAT SWIFT PRIORITY CODE                                       S01117
     C*                                                                   S01117
     C           SWPC      IFEQ 1                                         S01117
     C                     MOVE 'U'       MPRY                            S01117
     C                     ELSE                                           S01117
     C           SWPC      IFEQ 2                                         S01117
     C                     MOVE 'N'       MPRY                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE *BLANKS   LSCC                            S01310
     C                     MOVE *BLANKS   PTST                            S01310
     C                     MOVE *BLANKS   CARQ                            S01310
     C                     MOVE *BLANKS   MPDE                            S01310
     C                     TIME           MGTM                            S01310
     C                     MOVE RUNA      LADT                            S01310
     C                     MOVE MGTM      LATM                            S01310
     C                     MOVE @HRDT     HRDT                            S01310
      *                                                                   S01310
      **  Convert run date to YYMMDD                                      S01310
      *                                                                   S01310
     C                     CALL 'ZM0060'                                  S01310
     C                     PARM RUND      ZMDAY   50                      S01310
     C                     PARM           ZMDATE  6                       S01310
     C                     MOVE ZMDATE    MGDE                            S01310
      *                                                                                       CSD015
      ** If Watch List Checking is Applied and CSW025 is off,                                 CSD015
      ** do watch processing.                                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   S01310
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
      *                                                                   S01310
     C           MGST      IFEQ 'RSND'                                    S01310
     C                     MOVE SRUNA     RELD                            S01310
     C                     MOVE LATM      RELT                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C           AUP2      IFNE *BLANK                                    S01310
     C                     MOVE AUP2      RUSR                            S01310
     C                     ELSE                                           S01310
     C                     MOVE AUP1      RUSR                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   RWSN                            S01310
     C                     MOVELM1AMNT    AMTS                            S01310
     C*********************MOVE *BLANKS   AMTX                      S01310S01117
     C                     MOVELM1AMNT    AMTX                            S01117
     C                     MOVE PVDTD3    SVDT                            164663
      *                                                                   164663
      ** Setup century indicator CINDV for value date SVDT                164663
      *                                                                   164663
     C           SVDT      IFEQ *BLANK                                    164663
     C                     MOVE *BLANK    CINDV                           164663
     C                     ELSE                                           164663
     C                     MOVELSVDT      YY      20                      164663
     C           YY        IFLT 72                                        164663
     C                     MOVE '2'       CINDV                           164663
     C                     ELSE                                           164663
     C                     MOVE '1'       CINDV                           164663
     C                     ENDIF                                          164663
     C                     ENDIF                                          164663
      *                                                                   164663
      *                                                                   S01310
     C***********RBKT******IFEQ 'F'                                 S01310S01117
     C*********************MOVELRBK1      RBNK5   5                 S01310S01117
     C*********************MOVE RBNK5     NSNO                      S01310S01117
     C*********************END                                      S01310S01117
      *                                                                   S01310
     C***********RBKT******IFEQ 'C'                                 S01310S01117
     C***********RBKT******OREQ 'A'                                 S01310S01117
     C***********SNCT******IFEQ 'N'                                 S01310S01117
     C*********************MOVELSNCO      NSNO                      S01310S01117
     C*********************MOVE PCCY      CCY                       S01310S01117
     C*********************END                                      S01310S01117
     C*********************END                                      S01310S01117
      *                                                                   S01310
     C                     MOVE *BLANKS   SACN                            S01310
     C                     MOVE *BLANKS   AORR                            S01310
     C                     MOVE *BLANKS   DESI                            S01310
      *                                                                   S01310
      **  Branch details                                                  S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   RCBR                            S01310
      *                                                                   S01310
     C                     MOVE BRCAA     BRCA                            S01310
     C* IF MULTIBRANCH INDICATOR FROM RUNDAT ACTIVE                       S01310
     C           *IN50     IFEQ '1'                                       S01310
     C           BRCAA     IFNE ORBR                                      S01310
     C                     MOVE ORBR      OTHB                            S01310
     C* MOVE "ORIGINATING BRANCH" TO 'OTHER BRANCH TYPE'(OTHT)            S01310
     C                     MOVE ' BRANCH"'FLD1   20                       S01310
     C                     MOVEL'"ORIGINA'FLD2   12                       S01310
     C                     MOVE 'TING'    FLD2                            S01310
     C                     MOVELFLD2      FLD1                            S01310
     C                     MOVE FLD1      OTHT                            S01310
     C*                                                                   S01310
     C                     ELSE                                           S01310
     C                     MOVE *BLANKS   OTHB                            S01310
     C                     MOVE *BLANKS   OTHT                            S01310
     C                     END                                            S01310
     C* IF MULTIBRANCH INDICATOR FROM RUNDAT NOT ACTIVE                   S01310
     C                     ELSE                                           S01310
     C                     MOVE *BLANKS   OTHB                            S01310
     C                     MOVE *BLANKS   OTHT                            S01310
     C                     END                                            S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   NETI                            S01310
     C*********************MOVE *BLANKS   DELC                      S01310S01117
     C*                                                                   S01117
     C*   READ SDCURRPD FOR DELIVERY NOTIFICATION AND NON-DELIVERY        S01117
     C*     WARNING FLAGS                                                 S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM PCCY      @CCY    3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '30'      DBERR#             *************S01117
     C                     MOVEL@CCY      DBERKY             * DBERR 030 *S01117
     C                     MOVEL'SDCURRPD'DBFNAM             *************S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           A6NDWR    IFEQ 'Y'                                       S01117
     C           A6DNOR    ANDEQ'Y'                                       S01117
     C                     MOVE '3'       DELC                            S01117
     C                     END                                            S01117
     C           A6NDWR    IFNE 'Y'                                       S01117
     C           A6DNOR    ANDEQ'Y'                                       S01117
     C                     MOVE '2'       DELC                            S01117
     C                     END                                            S01117
     C           A6NDWR    IFEQ 'Y'                                       S01117
     C           A6DNOR    ANDNE'Y'                                       S01117
     C                     MOVE '1'       DELC                            S01117
     C                     END                                            S01117
     C           A6NDWR    IFNE 'Y'                                       S01117
     C           A6DNOR    ANDNE'Y'                                       S01117
     C***********          MOVE '0'       DELC                      S01117068367
     C                     MOVEL*BLANKS   DELC                            068367
     C                     END                                            S01117
      *                                                                   068367
      * Ensure that message priority and delivery notification are        068367
      * valid combination :                                               068367
      * 1. for MPRY = 'U' DELC must be '1' or '3',                        068367
      * 2. for MPRY = 'N' DELC must be ' ' or '2'.                        068367
      *                                                                   068367
     C           MPRY      IFEQ 'U'                                       068367
     C           DELC      ANDEQ' '                                       068367
     C           MPRY      OREQ 'U'                                       068367
     C           DELC      ANDEQ'2'                                       068367
     C                     MOVEL'1'       DELC                            068367
     C                     END                                            068367
      *                                                                   068367
     C           MPRY      IFEQ 'N'                                       068367
     C           DELC      ANDEQ'1'                                       068367
     C           MPRY      OREQ 'N'                                       068367
     C           DELC      ANDEQ'3'                                       068367
     C                     MOVEL'2'       DELC                            068367
     C                     END                                            068367
     C*                                                                   S01117
     C                     MOVE *BLANKS   DYST                            S01310
     C                     MOVE *BLANKS   RSID                            S01310
     C                     MOVE *BLANKS   MSE1                            S01310
     C                     MOVE *BLANKS   ELIN                            S01310
     C                     MOVE *BLANKS   SSAC                            S01310
     C                     MOVE *BLANKS   MIR                             S01310
     C                     MOVE *BLANKS   TSKS                            S01310
     C                     MOVE *BLANKS   TSKY                            S01310
     C/COPY WNCPYSRC,FT0651C001
      *                                                                   S01310
     C                     MOVEL@CHG      AORR                                                CSW025
     C                     WRITEMGOREFD0               41                 S01310
      *                                                                   S01310
      **  Error on write to PF/MGOREFPD (message reference file)          S01310
      *                                                                   S01310
     C           *IN41     IFEQ '1'                                       S01310
     C                     MOVE '014'     DBERR#           * * * * * * * *S01310
     C                     MOVEL'       ' DBERKY           *  DBERR 014  *S01310
     C                     MOVEL'MGOREFPD'DBFNAM           * * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
     C                     ENDSR                                          S01310
      *                                                                   S01310
     C/EJECT                                                              S01310
     C********************************************************************
     C*               SUBROUTINE EMBLK                                 ***
     C*                                                                ***
     C*     TO ELIMINATE BLANK LINES ON NAME AND ADDRESS FIELDS        ***
     C*                                                                ***
     C*      CALLED BY: MAIN PROCESSING
     C*                 SR01
     C********************************************************************
     C           EMBLK     BEGSR                                       ***
     C                     MOVEA*BLANKS   ADDR
     C                     Z-ADD1         A       10
     C*
     C           OFSPT1    IFNE *BLANK
     C                     MOVE OFSPT1    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C           OFSPT2    IFNE *BLANK
     C                     MOVE OFSPT2    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C           OFSPT3    IFNE *BLANK
     C                     MOVE OFSPT3    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C           OFSPT4    IFNE *BLANK
     C                     MOVE OFSPT4    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C           OFSPT5    IFNE *BLANK
     C                     MOVE OFSPT5    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C           OFSPT6    IFNE *BLANK
     C                     MOVE OFSPT6    ADDR,A
     C                     ADD  1         A
     C                     END
     C*
     C                     MOVEAADDR      OFSPT
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*     *         SUBROUTINE 05                         ***        ***
     C*     *                                               ***        ***
     C*     *  FORMAT SETTLEMENT PARTY FOR TELEX REPORT     ***        ***
     C*     *                                               ***        ***
     C*     *                                               ***        ***
     C*********************************************************        ***
     C           SR05      BEGSR                            ***        ***
     C*     INTIALISE O/P PARAMETERS FROM THIS SUBROUTINE
     C                     MOVE *BLANKS   OFSPT1 35
     C                     MOVE *BLANKS   OFSPT2 35
     C                     MOVE *BLANKS   OFSPT3 35
     C                     MOVE *BLANKS   OFSPT4 35
     C                     MOVE *BLANKS   OFSPT5 35
     C*                                                                ***
     C* ** FULL NOSTRO - PROCESSING                         **         ***
     C           ISPTP     IFEQ 'F'
     C* ** SETUP AND ACCESS PF/TABLETL                                 ***
     C                     MOVELISPTY1    TLCCNN  5        BUILD
     C                     MOVEL'70'      TABTLK 12          KEY
     C                     MOVE TLCCNN    TABTLK               KEY
     C           TABTLK    CHAINTABFP                10
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELTABTLK    DBERKY            )))  BASE  )))
     C                     MOVE '10'      DBERR#            ))) ERROR  )))
     C                     EXSR DBERR                       )))   10   )))
     C                     END                              ))))))))))))))
     C                     MOVE CNUM      CUSTNO
     C                     MOVELTLCCNN    OFSPT1
     C                     GOTO NADD
     C                     END
     C*                                                                ***
     C* ** NOSTRO NUMBER - PROCESSING                         **       ***
     C           ISPTP     IFEQ 'N'
     C* ** SETUP AND ACCESS PF/TABLETL                                 ***
     C                     MOVELISPTY1    TLNN    2        BUILD
     C                     MOVELISCCY     TLCCNN             KEY
     C                     MOVE TLNN      TLCCNN             KEY
     C                     MOVEL'70'      TABTLK 12          KEY
     C                     MOVE TLCCNN    TABTLK               KEY
     C           TABTLK    CHAINTABFP                10
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELTABTLK    DBERKY            )))  BASE  )))
     C                     MOVE '11'      DBERR#            ))) ERROR  )))
     C                     EXSR DBERR                       )))   11   )))
     C                     END                              ))))))))))))))
     C                     MOVE CNUM      CUSTNO
     C                     MOVELTLNN      OFSPT1
     C                     GOTO NADD
     C                     END
     C*                                                                ***
     C* ** RETAIL ACCOUNT - PROCESSING                         **      ***
     C           ISPTP     IFEQ 'R'
     C* ** SETUP AND ACCESS ACCOUNT NUMBER FILE                        ***
     C                     MOVELISPTY1    ACNUMK
     C           ACNUMK    CHAINACNUMA               11    ON, DELETED
     C           *IN11     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'ACNUMA'  DBFNAM  5         )))  DATA  )))S01310
     C                     MOVEL'ACNUMA'  DBFNAM            )))  DATA  )))S01310
     C                     MOVELACNUMK    DBERKY 39         )))  BASE  )))
     C                     MOVE '12'      DBERR#  2         ))) ERROR  )))
     C                     EXSR DBERR                       )))   12   )))
     C                     END                              ))))))))))))))
     C                     MOVE CNUM      CUSTNO
     C                     MOVELACNUMK    OFSPT1
     C                     GOTO NADD
     C                     END
     C*                                                                ***
     C* ** FULL/PARTIAL ACCOUNT/CUSTOMER  - PROCESSING                 ***
     C           ISPTP     IFEQ 'G'
     C           ISPTP     OREQ 'P'
     C           ISPTP     OREQ 'C'
     C                     MOVELISPTY1    CUSTNO
     C                     MOVELISPTY1    OFSPT1
     C                     GOTO NADD
     C                     END
     C*                                                                ***
     C* ** SETTLEMENT PARTY  - PROCESSING                              ***
     C           ISPTP     IFEQ 'S'
     C           ISPTP     OREQ 'A'
     C                     MOVELISPTY1    OFSPT1
     C                     MOVELISPTY2    OFSPT2
     C                     MOVELISPTY3    OFSPT3
     C                     MOVELISPTY4    OFSPT4
     C                     MOVELISPTY5    OFSPT5
     C                     GOTO SR05N
     C                     END
     C*                                                                ***
     C           NADD      TAG
     C           ISPTP     IFEQ ' '                        B001
     C                     GOTO SR05N
     C                     END                             E001
     C***SET*UP*CUSTOMER*KEY                                              S01310
     C*********************MOVELCUSTNO    KCUSNO                          S01310
     C*********************MOVE 'B'       KEYA                            S01310
     C***ACCESS*CLIENT*FILE                                               S01310
     C***********CUSKEY****CHAINCLINTCCF             80                   S01310
     C*********************                                               S01310
     C************IN80*****IFEQ '1'                         ))))))))))))))S01310
     C*********************MOVE 'CLINT'   DBFNAM            )))  DATA  )))S01310
     C*********************MOVEL'      B' DBERKY            )))  BASE  )))S01310
     C*********************MOVELKCUSNO    DBERKY            )))  BASE  )))S01310
     C*********************MOVE '16'      DBERR#            ))) ERROR  )))S01310
     C*********************EXSR DBERR                       )))   16   )))S01310
     C*********************END                              ))))))))))))))S01310
     C*********************MOVE CNA1      OFSPT2                          S01310
     C*********************MOVE CNA2      OFSPT3                          S01310
     C*********************MOVE CNA3      OFSPT4                          S01310
     C*********************MOVE CNA4      OFSPT5                          S01310
      *                                                                   S01310
      ** Access SDCUSTPD with the customer number.                        S01310
      *                                                                   S01310
     C                     MOVE *BLANKS   @KEY1                           S01310
     C                     MOVELCUSTNO    @KEY1                           S01310
     C                     CALL 'AOCUSTR0'                                S01310
     C                     PARM '*MSG   ' @RTCD   7                       S01310
     C                     PARM '*KEY   ' @OPTN   7                       S01310
     C                     PARM           @KEY1  10                       S01310
     C                     PARM *BLANKS   @KYST   7                       S01310
     C           SDCUST    PARM SDCUST    DSSDY                           S01310
      *                                                                   S01310
      ** Customer record not found - Error                                S01310
      *                                                                   S01310
     C           @RTCD     IFNE *BLANKS                                   S01310
     C                     MOVE '029'     DBERR#             * * * * * * *S01310
     C                     MOVEL@KEY1     DBERKY             * DBERR 029 *S01310
     C                     MOVEL'SDCUSTPD'DBFNAM             * * * * * * *S01310
     C                     EXSR DBERR                                     S01310
     C                     END                                            S01310
     C                     MOVELBBCNA1    OFSPT2                          S01310
     C                     MOVELBBCNA2    OFSPT3                          S01310
     C                     MOVELBBCNA3    OFSPT4                          S01310
     C                     MOVELBBCNA4    OFSPT5                          S01310
     C*                                                                ***
     C*                                                                ***
     C           SR05N     ENDSR                           END SR05
     C/EJECT
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     *         SUBROUTINE 07                         ***        ***
     C*     *                                               ***        ***
     C*     *  DETERMINE AND FORMAT AMOUNT FOR              ***        ***
     C*     *  CHEQUES TO BE PAID                           ***        ***
     C*     *                                               ***        ***
     C*********************************************************        ***
     C           SR07      BEGSR                            ***        ***
     C*                                                                   CSW020
     C** Perform Old Processing if CSW020 is not switched on.             CSW020
     C           CSW020    IFNE 'Y'                                       CSW020
     C*                                                                ***
     C*   CHAIN TO TABLETG TO FIND DECIMAL POSITION                    ***
     C                     MOVEL'20'      TABTGK 12
     C                     MOVELPCCY      TGCCSR  4
     C                     MOVE '1'       TGCCSR
     C                     MOVE TGCCSR    TABTGK
     C           TABTGK    CHAINTABFP                10
     C*
     C           *IN10     IFEQ '1'                         ))))))))))))))
     C*********************MOVE 'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVEL'TABFP'   DBFNAM            )))  DATA  )))S01310
     C                     MOVELTABTGK    DBERKY            )))  BASE  )))
     C                     MOVE '15'      DBERR#            ))) ERROR  )))
     C                     EXSR DBERR                       )))   15   )))
     C                     END                              ))))))))))))))
     C*
     C** USE THE SWIFT CURRENCY FROM TABLE ON THE SWIFT MESSAGES
     C*          =====
     C                     MOVE CCYS      M1RCCY
      *                                                                   CEU006
      * Save SWIFT currency code and decimal places for SR/ERI            CEU006
     C                     MOVELCCYS      WCCYS   3                       CEU006
     C                     Z-ADDCDP       WCDP    10                      CEU006
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0651CCP3                                           S01408
     C*                                                                   S01408
     C                     MOVE CCYS      M1RCY2
     C*
     C*    DETERMINE DECIMAL POSITION (FOR REPORT)
     C           CDP       COMP 2                    33  32
     C           CDP       COMP 1                      3031
     C*
     C*    DETERMINE DECIMAL POSITION
     C           14        SUB  CDP       X       20
     C*    IF 0 DECIMAL PLACES DON'T EDIT
     C           CDP       IFEQ 0                          B001
     C                     MOVE *BLANK    AMT
     C                     MOVE *ZEROS    AM
     C                     MOVEARAMNT     AMT,2
     C                     MOVEARAMNT     AM,1
     C                     Z-ADD13        W
     C                     MOVE ','       AM,X
     C                     ELSE                            E001
     C*    MOVE AMOUNT INTO ARRAY
     C                     MOVEARAMNT     AMT,1
     C*    DETERMINE POSITION OF DECIMAL DIGITS IN 2ND ARRAY
     C           X         ADD  1         Y       20
     C*    MOVE DECIMAL DIGITS INTO 2ND ARRAY FIELD
     C                     MOVEAAMT,X     AM,Y
     C*    DETERMINE POSITION & MOVE COMMA
     C                     SUB  1         Y
     C                     MOVE ','       AM,Y
     C*    DETERMINE POSITION OF DIGIT B4  COMMA
     C                     SUB  1         Y
     C*    SAVE POSITION OF DIGIT B4  COMMA
     C                     Z-ADDY         W       20
     C*    DETERMINE POSITION OF DIGIT TO BE MOVED B4  COMMA
     C                     SUB  1         X
     C                     Z-ADDX         Z       20
     C*    DO OPERATIONS MOVING CHARACTERS ONE AT A TIME
     C*    FROM RIGHT TO LEFT
     C                     DO   X
     C                     MOVE AMT,Z     AM,Y
     C                     SUB  1         Z
     C                     SUB  1         Y
     C                     END
     C                     END                             E001
     C*    SET INDEX TO 1
     C                     Z-ADD1         Y
     C*    REPLACE LEADING ZEROS WITH BLANK
     C           AM,Y      DOWEQ'0'
     C           Y         CABEQW         SR03A
     C                     MOVE ' '       AM,Y
     C                     ADD  1         Y
     C                     END
     C*  ** SAVE FIELD FROM ARRAY                                      ***
     C           SR03A     TAG
     C                     MOVEAAM        AMX    14
     C                     MOVE AMX       SAM    15
     C*                                                                ***
     C*                                                                   S01408
     C/COPY WNCPYSRC,FT0651CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   CSW020
     C                     ELSE                                           CSW020
     C*                                                                   CSW020
     C** If CSW020 is switched on perform decimal places prosessing       CSW020
     C                     CALL 'ZM0040'                                  CSW020
     C                     PARM WAMNT     ZAMNT                           CSW020
     C                     PARM PCCY      ZCCY                            CSW020
     C                     PARM *BLANKS   ZSAMNT                          CSW020
     C                     PARM *BLANKS   ZSCCY                           CSW020
     C                     PARM *BLANKS   ZERR                            CSW020
     C*                                                                   CSW020
     C** Handle Database Error                                            CSW020
     C           ZERR      IFEQ '1'                                       CSW020
     C                     MOVEL'ZM0040  'DBFNAM           ************   CSW020
     C                     MOVELPCCY      DBERKY           * DBERR 33 *   CSW020
     C                     MOVE '33'      DBERR#           ************   CSW020
     C                     EXSR DBERR                                     CSW020
     C*                                                                   CSW020
     C                     ELSE                                           CSW020
     C                     MOVE ZSAMNT    SAM                             CSW020
     C                     MOVE ZSCCY     M1RCCY                          CSW020
     C                     MOVE ZSCCY     M1RCY2                          CSW020
     C*                                                                   CSW020
     C**    Access Currency Details                                       CSW020
     C                     CALL 'AOCURRR0'                                CSW020
     C                     PARM '*MSG   ' @RTCD   7                       CSW020
     C                     PARM '*KEY   ' @OPTN   7                       CSW020
     C                     PARM PCCY      @CCY    3                       CSW020
     C           SDCURR    PARM SDCURR    DSSDY                           CSW020
     C*                                                                   CSW020
     C                     MOVE A6CYNM    CCNM                            CSW020
     C           A6NBDP    COMP 2                    33  32               CSW020
     C           A6NBDP    COMP 1                      3031               CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
     C                     ENDIF                                          CSW020
     C                     ENDSR                           END SR07
     C/EJECT
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C****************SUBROUTINE*09                         ***        ***S01310
     C**********OUTPUT*7*RECORDS*TO*THE*OUTGOING*SWIFT      ***        ***S01310
     C**********MESSAGES*FILE*(PF/MSMSOPF).                 ***        ***S01310
     C**********OUTPUT*A*RECORD*TO*THE*SWIFT*REFERENCE      ***        ***S01310
     C**********FILE*(PF/MSIXOPF).                          ***        ***S01310
     C*********************************************************        ***S01310
     C***********SR09******BEGSR                                       ***S01310
     C*********************                                            ***S01310
     C****FIELDS*COMMON*TO*RECORDS*TO*BE*OUTPUTTED                     ***S01310
     C*********************MOVE 'P'       MSMI                         ***S01310
     C*********************MOVE PREF      PREFS  14                    ***S01310
     C*********************MOVELPREFS     TNRF                         ***S01310
     C*********************MOVE *BLANK    PTDL                         ***S01310
     C*********************                                            ***S01310
     C****FIRST*RECORD*****                                            ***S01310
     C*********************MOVELMT4001    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****SECOND*RECORD****                                            ***S01310
     C*********************MOVELMT4002    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****THIRD*RECORD*****                                            ***S01310
     C*********************MOVELMT4003    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****FOURTH*RECORD****                                            ***S01310
     C*********************MOVELMT4004    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****FIFTH*RECORD*****                                            ***S01310
     C*********************MOVELMT4005    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****SIXTH*RECORD*****                                            ***S01310
     C*********************MOVELMT4006    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************                                            ***S01310
     C****SEVENTH*RECORD***                                            ***S01310
     C*********************MOVELMT4007    MDTA                         ***S01310
     C*********************WRITEMSMSOPFF               42  ON, D/B ERROR  S01310
     C************IN42*****CABEQ'1'       WRTER                           S01310
     C*********************ADD  7         P3NO2                     S01117S01310
     C*********************ADD  7         AUNO2                     S01117S01310
     C*********************                                            ***S01310
     C*********************                                            ***S01310
     C***FORMAT*AND*OUTPUT*A*RECORD*TO*THE*SWIFT                       ***S01310
     C***REFERENCE*FILE*(PF/MSIXOPF)                                   ***S01310
     C*********************MOVE 'D'       RECI                            S01310
     C*********************MOVE 'P'       MSMI                            S01310
     C*********************MOVE PREF      PREFS                           S01310
     C*********************MOVELPREFS     TNRF                            S01310
     C*********************MOVE FTCS      MSTS                            S01310
     C*********************MOVE RUNA      LADT                            S01310
     C*********************TIME           LATM                            S01310
     C*********************MOVE PYTP      TNTP                            S01310
     C*********************MOVE PYST      SBTP                            S01310
     C*********************MOVE '400'     MTPY                            S01310
     C*********************MOVE SWPC      MSGP                            S01310
     C*********************MOVE SCRNM     RPNM                            S01310
     C*********************MOVE SCTWN     RPTN                            S01310
     C*********************TIME           MGTM                            S01310
     C*********************MOVE RUNA      MGDT                            S01310
     C*********************MOVE MXOTID    STID                            S01310
     C*********************MOVE RECADD    DTID                            S01310
     C*********************MOVE SBICN     SECN                            S01310
     C*********************MOVE SCUSNO    DECN                            S01310
     C*********************MOVE SWTWRK    SWTX                            S01310
     C***********AUP2******IFNE *BLANK                                    S01310
     C*********************MOVE AUP2      RUSR                            S01310
     C*********************ELSE                                           S01310
     C*********************MOVE AUP1      RUSR                            S01310
     C*********************END                                            S01310
     C*********************MOVE SRUNA     RELD                            S01310
     C*********************MOVE LCHT      RELT                            S01310
     C*********************MOVE BRCAA     BRCA                      S01117S01310
     C**IF*MULTIBRANCH*INDICATOR*FROM*RUNDAT*ACTIVE                 S01117S01310
     C************IN50*****IFEQ '1'                                 S01117S01310
     C***********BRCAA*****IFNE ORBR                                S01117S01310
     C*********************MOVE ORBR      OTHB                      S01117S01310
     C**MOVE*"ORIGINATING*BRANCH"*TO*'OTHER BRANCH*TYPE'(OTHT)      S01117S01310
     C*********************MOVE ' BRANCH"'FLD1   20                 S01117S01310
     C*********************MOVEL'"ORIGINA'FLD2   12                 S01117S01310
     C*********************MOVE 'TING'    FLD2                      S01117S01310
     C*********************MOVELFLD2      FLD1                      S01117S01310
     C*********************MOVE FLD1      OTHT                      S01117S01310
     C*********************                                         S01117S01310
     C*********************ELSE                                     S01117S01310
     C*********************MOVE *BLANKS   OTHB                      S01117S01310
     C*********************MOVE *BLANKS   OTHT                      S01117S01310
     C*********************END                                      S01117S01310
     C**IF*MULTIBRANCH*INDICATOR*FROM*RUNDAT*NOT*ACTIVE             S01117S01310
     C*********************ELSE                                     S01117S01310
     C*********************MOVE *BLANKS   OTHB                      S01117S01310
     C*********************MOVE *BLANKS   OTHT                      S01117S01310
     C*********************END                                      S01117S01310
     C*********************WRITEMSIXOPFF               41  ON, D/B ES01117S01310
     C**N41****************ADD  1         P3NO3                     S01117S01310
     C**N41****************ADD  1         AUNO3                     S01117S01310
     C*********************GOTO SR09N                                     S01310
     C*********************                                            ***S01310
     C***********WRTER*****TAG                              ))))))))))))))S01310
     C*********************MOVE 'MSMSOPFF'DBFNAM            )))  DATA  )))S01310
     C*********************MOVELMXTREF    DBERKY            )))  BASE  )))S01310
     C*********************MOVE '13'      DBERR#            ))) ERROR  )))S01310
     C*********************EXSR DBERR                       )))   13   )))S01310
     C*********************                                 ))))))))))))))S01310
     C*********************                                            ***S01310
     C***********SR09N*****ENDSR                           END SR09       S01310
     C*/EJECT                                                             S01310
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     *         SUBROUTINE 10                         ***        ***
     C*     *                                               ***        ***
     C*     *  TO INITIALISE FIELDS IN DATA STRUCTURE       ***        ***
     C*     *  FOR FORMATTING SWIFT RECORDS                 ***        ***
     C*     *                                               ***        ***
     C*********************************************************        ***
     C           SR10      BEGSR                                       ***
     C*                                                                ***
     C*********************MOVE *BLANKS   MT4001                          S01310
     C*********************MOVE *BLANKS   MT4002                          S01310
     C*********************MOVE *BLANKS   MT4003                          S01310
     C*********************MOVE *BLANKS   MT4004                          S01310
     C*********************MOVE *BLANKS   MT4005                          S01310
     C*********************MOVE *BLANKS   MT4006                          S01310
     C*********************MOVE *BLANKS   MT4007                          S01310
     C*    SET 'OUR TID'                                               ***
     C**********           MOVE MXOTID    M1OTID                                             260987A
      *                                                                                      260987A
      ** TID should be set the same as MGOREFPD.                                             260987A
      *                                                                                      260987A
     C                     MOVELNWSN      M1OTID                                             260987A
     C*********************Z-ADD1         B01                             S01310
     C*********************MOVE X01       M1HEAD                          S01310
     C*********************MOVE X0D25     M1CRL1                          S01310
     C*********************MOVE X0D25     M1CRL2                          S01310
     C*********************MOVE X0D25     M1CRL3                          S01310
     C*********************MOVE X0D25     M1CRL4                          S01310
     C*********************MOVE X0D25     M1CRL6                          S01310
     C*********************MOVE X0D25     M1CRL7                          S01310
     C*********************MOVE X0D25     M1CR7A                          S01310
     C*********************MOVE X0D25     M1CRL8                          S01310
     C*********************MOVE PREF      PREFS                           S01310
     C*********************MOVELPREFS     MXTREF                          S01310
     C*********************MOVE '400'     M1MSGT                          S01310
     C*********************MOVE SWPC      M1MSGP                          S01117
     C*  FORMAT SWIFT PRIORITY CODE                                       S01117
     C*                                                                   S01117
     C           SWPC      IFEQ 1                                         S01117
     C                     MOVE 'U'       M1MSGP                          S01117
     C                     ELSE                                           S01117
     C           SWPC      IFEQ 2                                         S01117
     C                     MOVE 'N'       M1MSGP                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE RECADD    M1RADD
     C                     MOVELPREF      MXTREF                          S01310
      *                                                                   S01310
      ** Set up field 20 - Transaction reference number                   S01310
      *                                                                   S01310
     C                     Z-ADD1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVEL':20: '   MTAG                            S01310
     C                     MOVELTRNO      MFLD                            S01310
      *                                                                   S01310
     C*********************MOVE ':20:'    M1TG20                          S01310
     C*********************MOVELPREF      M1TREF                          S01310
     C                     MOVELTRNO      M1TREF                          S01310
      *                                                                   S01310
      ** Set up field 21 - Related reference number                       S01310
      *                                                                   S01310
     C                     ADD  1         M                               S01310
     C           M         OCUR MULT                                      S01310
     C                     MOVEL':21: '   MTAG                            S01310
     C                     MOVELRBKR      MFLD                            S01310
      *                                                                   S01310
     C*********************MOVE ':21:'    M1TG21                          S01310
     C                     MOVE RBKR      M1RREF
     C*********************MOVE ':32B:'   M1TG32                          S01310
     C*********************MOVE ':33A:'   M1TG33                          S01310
     C                     MOVE PVDTD3    M1VDT2
     C*********************MOVE '-'       M7HYPH                          S01310
     C*********************Z-ADD3         B03                             S01310
     C*********************MOVE X03       M7ETX                           S01310
     C*                                                                ***
     C                     ENDSR                           END SR10
     C/EJECT
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*     *         SUBROUTINE P2                         ***        ***
     C*     *                                               ***        ***
     C*     *  TO HANDLE TELEX REPORT                       ***        ***
     C*     *                                               ***        ***
     C*     *                                               ***        ***
     C*********************************************************        ***
     C           SRP2      BEGSR                                       ***
     C*                                                                ***
     C*                                                                ***
     C*  ** CHANGE OF CURRENCY, THEN PRINT ELS SUPPRESS CURRENCY       ***
     C*  ** 'CCNM' IS FROM TABLETG ACESS IN SR03 VIA SR06/SR07         ***
     C           P2CCY     IFNE CCNM
     C                     SETON                     14
     C                     Z-ADD0         MREC    10
     C                     MOVE CCNM      P2CCY
     C                     ELSE
     C                     ADD  1         MREC
     C                     SETOF                     14
     C                     END
     C*
     C           MREC      IFGT 1
     C                     SETON                     14
     C                     Z-ADD0         MREC
     C                     END
     C*                                                                ***
     C*  ** CONVERT PAY VALUE DATE FROM 'YYMMDD' TO 'DDMMMYY'          ***
     C                     MOVE PVDTD3    SDATE
     C                     MOVE MTH,SMM   WMM
     C                     MOVE SDD       WDD
     C                     MOVE SYY       WYY
     C*                                                                ***
     C*  ** CHANGE DATE THEN PRINT ELSE SUPRESS DATE PRINTING          ***
     C           WDATE     IFNE P2VAL
     C                     SETON                     15
     C                     Z-ADD0         DREC    10
     C                     MOVELWDATE     P2VAL
     C                     ELSE
     C                     ADD  1         DREC
     C                     SETOF                     15
     C                     END
     C*                                                                ***
     C           DREC      IFGT 1
     C                     SETON                     15
     C                     Z-ADD0         DREC
     C                     END
     C*                                                                ***
     C*********************MOVELPREF      P2REF                           S01310
     C                     MOVE PREF      TRNO                            S01310
     C                     MOVEL'FT'      TRNO                            S01310
     C                     MOVELTRNO      P2REF                           S01310
     C*                                                                ***
     C* ** FORMAT BANK TO BANK INFORMATIONS                            ***
     C                     MOVE BBI1      P2BTB1                       ***
     C                     MOVE BBI2      P2BTB2                       ***
     C                     MOVE BBI3      P2BTB3                       ***
     C                     MOVE BBI4      P2BTB4                       ***
     C                     MOVE BBI5      P2BTB5                       ***
     C                     MOVE BBI6      P2BTB6                       ***
     C*                                                                ***
     C*  ** PRINT TELEX MESSAGE                                        ***
     C                     ADD  1         PAGEP2
     C                     WRITEP2H1                   80
     C   80                DO                              B001
     C*                                                    ))))))))))))))
     C                     MOVE 'FT0651P2'DBFNAM           )))  DATA  )))
     C                     MOVEL'2'       DBERKY           )))  BASE  )))
     C                     MOVE 19        DBERR#           ))) ERROR  )))
     C                     EXSR DBERR                      )))   19   )))
     C*                                                    ))))))))))))))
     C                     END                             E001
     C                     WRITEP2H2                                   ***
     C*                                                                ***
     C*                                                                ***
     C                     ENDSR                           END SRP2
     C/EJECT
     C*****************************************************************   S01310
     C****NWAD*-*determine*default*network*addresses***************S01310 CSW096
     C****Called*by*-*SR01*****************************************S01310 CSW096
     C****Calls*-*none*********************************************S01310 CSW096
     C*************************************************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********NWAD      BEGSR                                   S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Initialise*networking*fields*****************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********          MOVE *BLANKS   NWSN                     S01310 CSW096
     C***********          MOVE *BLANKS   NWDS                     S01310 CSW096
     C***********          MOVE *BLANKS   NWRK                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Default*is*SWIFT*****************************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********BBDNW4    IFEQ 'SWIFT'                            S01310 CSW096
     C***********BBCSID    ANDNE*BLANKS                            S01310 CSW096
     C***********@BIC      ANDNE'BIC'                              S01310 CSW096
     C***********BGMSDL    ANDEQ'Y'                                S01310 CSW096
     C***********          MOVELSCSID     NWSN                      S01310064393
     C***********          MOVELSNCSID    NWSN                     064393 CSW096
     C***********          MOVELBBCSID    NWDS                     S01310 CSW096
     C***********          MOVELBBDNW4    NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Default*is*TELEX*****************************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********BBDNW4    IFEQ 'TELEX'                            S01310 CSW096
     C***********BBTXA1    ANDNE*BLANKS                            S01310 CSW096
     C***********BGMTMI    ANDEQ'Y'                                S01310 CSW096
     C***********          MOVELSTELX     NWSN                     S01310 CSW096
     C***********          MOVELBBTXA1    NWDS                     S01310 CSW096
     C***********          MOVELBBDNW4    NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Default*is*STTX******************************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********BBDNW4    IFEQ 'STTX'                             S01310 CSW096
     C***********BBSTAD    ANDNE*BLANKS                            S01310 CSW096
     C***********BGMSDL    ANDEQ'Y'                                S01310 CSW096
     C***********          MOVELSSTTX     NWSN                     S01310 CSW096
     C***********          MOVELBBSTAD    NWDS                     S01310 CSW096
     C***********          MOVELBBDNW4    NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Default*is*PAPER*****************************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********BBDNW4    IFEQ 'PAPER'                            S01310 CSW096
     C***********          MOVELSCRNM     NWSN                     S01310 CSW096
     C***********          MOVELBBCRNM    NWDS                     S01310 CSW096
     C***********          MOVELBBDNW4    NWRK                     S01310 CSW096
     C***********          MOVE 'RSND'    MGST                     S01310 CSW096
     C***********          MOVE '2'       MGSG                     S01310 CSW096
     C***********          MOVE 'N'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C****Found*to*be*unroutable***********************************S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********NWRK      IFEQ *BLANKS                            S01310 CSW096
     C***********NWDS      OREQ *BLANKS                            S01310 CSW096
     C***********NWSN      OREQ *BLANKS                            S01310 CSW096
     C***********          MOVELSCRNM     NWSN                     S01310 CSW096
     C***********          MOVELBBCRNM    NWDS                     S01310 CSW096
     C***********          MOVEL'UNROUT'  NWRK                     S01310 CSW096
     C***********          MOVE 'CRTD'    MGST                     S01310 CSW096
     C***********          MOVE '1'       MGSG                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                  S01310 CSW096
     C***********          ENDSR                                   S01310 CSW096
     C/EJECT                                                              S01310
     C************************************************************
     C**SWFT*SR.***********                                               S01310
     C**TO*DETERMINE*ROUTE*FOR*SWIFT*MESSAGE*GENERATION                   S01310
     C************************************************************        S01310
     C**SEE*BELOW*FOR*DETAILS*OF*DECISION                                 S01310
     C*********************                                               S01310
     C***********SWFT******BEGSR                                          S01310
     C****PROCESSING*TO*DETERMINE*WHETHER*THE*MESSAGE                     S01310
     C****DESTINATION*IS*SWIFT,*TELEX*OR*STTX                             S01310
      *****************************************************************   S01310
      ****PRAD*-*determine*settlement*network*address**************S01310 CSW096
      ****Called*by*-*SR01*****************************************S01310 CSW096
      ****Calls*-*none*********************************************S01310 CSW096
      *************************************************************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********PRAD      BEGSR                                   S01310 CSW096
      ***********                                                  S01310 CSW096
      ****Set*up*priority*sender,*destination*&*network************S01310 CSW096
      ***********                                                  S01310 CSW096
      ****'S'*=*SWIFT;*'T'*=*TELEX;*'X'*=*STTX*********************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********                                                         CSW096
     C*******************(1)**(2)**(3)**(4)**(5)**(6)**(7)*********S01310 CSW096
     C****-------------------------------------------------***************CSW096
     C****SWIFT*ADDRESS  Y   N   N   Y   Y   Y   Y ***************CSW096
     C****TELEX*ADDRESS  N   Y   N   Y   Y   N   N ***************CSW096
     C****STTX*ADDRESS*  N   N   Y   N   N   Y   Y ***************CSW096
     C****SETT.*TYPE***             01  08  01  08 ***************CSW096
     C****-------------------------------------------------***************CSW096
     C****DESTN*=*CSID*  X               X       X ***************CSW096
     C****DESTN*=*TELX*      X       X             ***************CSW096
     C****DESTN*=*STTX*          X           X     ***************CSW096
     C****-------------------------------------------------***************CSW096
     C****MESSAGE*ROUTE                            ***************CSW096
     C****CODE*(SWTX)**  S   T   X   T   S   X   S ***************CSW096
     C***********                                                         CSW096
      ***********                                                  S01310 CSW096
      ****New*field*names*already*moved*to*old*********************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********          MOVE BBCSID    CSID                     S01310 CSW096
     C***********          MOVE BBTXA1    TELX                     S01310 CSW096
     C***********          MOVE BBGSFM    GSFM    1                S01310 CSW096
     C***********          MOVE BBSTAD    STTX   12                S01310 CSW096
      ****SWIFT*?**************************************************S01310 CSW096
     C****(1)*************************************************************CSW096
     C***********          MOVE CSID      CSBIC   4                       CSW096
     C***********GSFM      IFEQ 'Y'                                       S01310
     C***********BGMSDL    IFEQ 'Y'                                S01310 CSW096
     C***********CSBIC     ANDNE'BIC '                                    CSW096
     C***********CSID      IFNE *BLANKS                                   CSW096
     C***********TELX      ANDEQ*BLANKS                                   CSW096
     C***********STTX      ANDEQ*BLANKS                                   CSW096
     C****(5)*************************************************************CSW096
     C***********CSID      ORNE *BLANKS                                   CSW096
     C***********TELX      ANDNE*BLANKS                                   CSW096
     C***********STTX      ANDEQ*BLANKS                                   CSW096
     C***********STMT      ANDEQ08                                        CSW096
     C****(7)*************************************************************CSW096
     C***********CSID      ORNE *BLANKS                                   CSW096
     C***********TELX      ANDEQ*BLANKS                                   CSW096
     C***********STTX      ANDNE*BLANKS                                   CSW096
     C***********STMT      ANDEQ08                                        CSW096
     C***********                                                         CSW096
     C***********          MOVE CSID      CSID   12                       CSW096
     C***********          MOVE 'S'       SWTX    1                       CSW096
     C***********          MOVELSCSID     NWSN                      S01310064393
     C***********          MOVELSNCSID    NWSN                     064393 CSW096
     C***********          MOVELCSID      NWDS                     S01310 CSW096
     C***********          MOVEL'SWIFT'   NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG  1                S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********          END                                            CSW096
     C****(2)*************************************************************CSW096
     C***********BGMTMI    IFEQ 'Y'                                S01310 CSW096
     C***********CSID      IFEQ *BLANKS                                   CSW096
     C***********TELX      ANDNE*BLANKS                                   CSW096
     C***********STTX      ANDEQ*BLANKS                                   CSW096
     C****(4)*************************************************************CSW096
     C***********CSID      ORNE *BLANKS                                   CSW096
     C***********TELX      ANDNE*BLANKS                                   CSW096
     C***********STTX      ANDEQ*BLANKS                                   CSW096
     C***********STMT      ANDEQ01                                        CSW096
     C***********                                                         CSW096
     C*********************MOVE TELX      CSID                            S01310
     C***********          MOVE 'T'       SWTX                            CSW096
     C***********          MOVELSTELX     NWSN                     S01310 CSW096
     C***********          MOVELTELX      NWDS                     S01310 CSW096
     C***********          MOVEL'TELEX'   NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                            CSW096
     C***********          END                                     S01310 CSW096
     C****(3)**********************************************************   CSW096
      ***********                                                  S01310 CSW096
      ****STTX*network*available*?*********************************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********BGMSDL    IFEQ 'Y'                                S01310 CSW096
     C***********CSID      IFEQ *BLANKS                                   CSW096
     C***********TELX      ANDEQ*BLANKS                                   CSW096
     C***********STTX      ANDNE*BLANKS                                   CSW096
     C****(6)**********************************************************   CSW096
     C***********CSID      ORNE *BLANKS                                   CSW096
     C***********TELX      ANDEQ*BLANKS                                   CSW096
     C***********STTX      ANDNE*BLANKS                                   CSW096
     C***********STMT      ANDEQ01                                        CSW096
     C***********                                                         CSW096
     C*********************MOVE STTX      CSID                            S01310
     C***********          MOVE 'X'       SWTX                            CSW096
     C***********          MOVELSSTTX     NWSN                     S01310 CSW096
     C***********          MOVELSTTX      NWDS                     S01310 CSW096
     C***********          MOVEL'STTX'    NWRK                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                            CSW096
     C*********************ELSE                                           S01310
     C*********************MOVE *BLANKS   CSID                            S01310
     C*********************MOVE *BLANKS   SWTX                            S01310
     C***********          END                                            CSW096
      ***********                                                  S01310 CSW096
      ***Found*to*be*unroutable.***********************************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********NWRK      IFEQ *BLANKS                            S01310 CSW096
     C***********NWSN      OREQ *BLANKS                            S01310 CSW096
     C***********          MOVELSCRNM     NWSN                     S01310 CSW096
     C***********          MOVELCRNM      NWDS                     S01310 CSW096
     C***********          MOVEL'UNROUT'  NWRK                     S01310 CSW096
     C***********          MOVE 'CRTD'    MGST                     S01310 CSW096
     C***********          MOVE '1'       MGSG                     S01310 CSW096
     C***********          MOVE 'Y'       OSUFLG                   S01310 CSW096
     C***********          END                                     S01310 CSW096
     C***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C***********                                                         CSW096
     C*/EJECT****                                                  S01310 CSW096
      *************************************************************S01310 CSW096
      ****FILL*-*Fill*up*array**DFS********************************S01310 CSW096
      ****Called*by***-*SR01.**************************************S01310 CSW096
      ****Calls*-*none*********************************************S01310 CSW096
      *************************************************************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********FILL      BEGSR                                   S01310 CSW096
      ***********                                                  S01310 CSW096
      ****Is*message*to*be*generated*as*released*?*****************S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********          MOVE BBDS01    DFS,1                    S01310 CSW096
     C***********          MOVE BBDS02    DFS,2                    S01310 CSW096
     C***********          MOVE BBDS03    DFS,3                    S01310 CSW096
     C***********          MOVE BBDS04    DFS,4                    S01310 CSW096
     C***********          MOVE BBDS05    DFS,5                    S01310 CSW096
     C***********          MOVE BBDS06    DFS,6                    S01310 CSW096
     C***********          MOVE BBDS07    DFS,7                    S01310 CSW096
     C***********          MOVE BBDS08    DFS,8                    S01310 CSW096
     C***********          MOVE BBDS09    DFS,9                    S01310 CSW096
     C***********          MOVE BBDS10    DFS,10                   S01310 CSW096
     C***********          MOVE BBDS11    DFS,11                   S01310 CSW096
     C***********          MOVE BBDS12    DFS,12                   S01310 CSW096
     C***********          MOVE BBDS13    DFS,13                   S01310 CSW096
     C***********          MOVE BBDS14    DFS,14                   S01310 CSW096
     C***********          MOVE BBDS15    DFS,15                   S01310 CSW096
      ***********                                                  S01310 CSW096
     C***********          ENDSR                                   S01310 CSW096
     C/EJECT                                                              S01310
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - SR01                                            *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C                     MOVE BRCA      I@SNBR                          CSW096
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE CUSTNO    I@DSCN                          CSW096
     C                     MOVE '400'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDSTMT      I@SETT                          CSW096
     C                     MOVE FTCS      I@FTCS                          CSW096
     C                     MOVE MODI      I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900FTCL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900FTCL                                          #CSW096
     C/COPY WNCPYSRC,FT0651ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C                     MOVE '92'      DBERR#             * * * * * * *CSW096
     C                     MOVEL'*CALL'   DBERKY             * DBERR 920 *CSW096
     C                     MOVEL'MG9900  'DBFNAM             * * * * * * *CSW096
     C                     EXSR DBERR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C                     MOVE O@NWSN    NWSN                            CSW096
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE O@PCNB    CPAR                            CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C           BBDNW4    IFEQ *BLANKS                                   CSW096
     C           NWRK      IFEQ 'SWIFT'                                   CSW096
     C                     MOVE 'S'       SWTX    1                       CSW096
     C                     END                                            CSW096
     C           NWRK      IFEQ 'TELEX'                                   CSW096
     C                     MOVE 'T'       SWTX                            CSW096
     C                     END                                            CSW096
     C           NWRK      IFEQ 'STTX'                                    CSW096
     C                     MOVE 'X'       SWTX                            CSW096
     C                     END                                            CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C           NWRK      IFNE 'PAPER'                                   CSW096
     C                     MOVE 'Y'       OSUFLG  1                       CSW096
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       OSUFLG                          CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
     C************************************************************
     C* END OF SWIFT TELEX SUBROUTINE
     C************************************************************
     C/EJECT
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C********************************************************************
     C*    *     SUBROUTINE TO SET UP DATA STRUCTURE   *     *** DBERR ***
     C*    *                FOR DATABASE ERRORS.       *     *** DBERR ***
     C********************************************************** DBERR ***
     C*    ERROR     CAUSE                                   *** DBERR ***
     C*       01     VALID I.C.R.-1 RECORD NOT FOUND.        *** DBERR ***
     C*       02     VALID I.C.R.-2 RECORD NOT FOUND.        *** DBERR ***
     C*       03     VALID CURRENCY RECORD NOT FOUND.        *** DBERR ***
     C*       04     UNSUCCESSFUL CHAIN TO LF/OTPAY.         *** DBERR ***
     C*       05     UNSUCCESSFUL CHAIN TO LF/CQPAC.         *** DBERR ***
     C*       06     UNSUCCESSFUL CHAIN TO LF/NTRAN.         *** DBERR ***
     C********************************************************** DBERR ***
     C           DBERR     BEGSR                             *** DBERR ***
     C*                                                      *************
     C           *NAMVAR   DEFN LDA       DLDA
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0651'  DBPGM            ) SET UP
     C*********************MOVE DBFNAM    DBFILE           ) DATA BASE    S01117
     C                     MOVELDBFNAM    DBFILE           ) DATA BASE    S01117
     C                     MOVELDBERKY    DBKEY            ) ERROR
     C                     MOVE *BLANKS   DBASE                           S01310
     C                     MOVE DBERR#    DBASE            ) FIELDS
     C                     OUT  DLDA
     C                     SETON                     78                   S01117
     C                     Z-ADD1         PAGEAU                          S01117
     C                     WRITEAUH1                                      S01310
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
     C*                                                      *************
     C                     ENDSR                             *** DBERR ***
     C/EJECT
     O*
      *                                                                   S01408
     O/COPY WNCPYSRC,FT0651OOP1                                           S01408
      *                                                                   S01408
** FILE TRANS. SPEC. PRINT MSGS AS THEY WILL BE AFTER MS0200 (NO INV.CHRS)
*EQUATE FT0651P1
*EQUATE 4E504B5E7D7F4DC05DD060CD6F5A6F5B6F4A6F6C6F5C6F4C6F7E6F6E6F7C6FE0D57B6FA6
*EQUATE 6F4F6F5F7D7960A1606D
     X/COPY WNCPYSRC,FT0651X001
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
