000100200529     H DEBUG
000110200529     H COPYRIGHT('(c) Finastra International Limited 2002')
000120200529      *****************************************************************
000130200529/*STD *  RPGBASEMOD                                                   *
000140200529/*EXI *  TEXT('Midas FT Incoming payments input')                     *
000150200529      *****************************************************************
000160200529      *                                                               *
000170200529      *  Midas - Funds Transfer Module                                *
000180200529      *                                                               *
000190200529      *  FTIPAYSIN - Incoming Payments Input                          *
000200200529      *                                                               *
000210200529      *  Function: This is the main module for the screen input       *
000220200529      *            function for Incoming Payments.                    *
000230200529      *                                                               *
000240200529      *  Component of: FTIPAYSIN                                      *
000250200529      *                                                               *
000260200529      *  (c) Finastra International Limited 2001                      *
000270200529      *                                                               *
000280200604      *  Last Amend No. 252696             Date 22May20               *
000290200529      *  Prev Amend No. MD047369A          Date 24Jan18               *
000300200529      *                 MD046248           Date 27Oct17               *
000310200529      *                 MD036089           Date 23Oct15               *
000320200529      *                 AR1090283          Date 10Aug16               *
000330200529      *                 MD025111           Date 10May14               *
000340200529      *                 CFT151             Date 21Mar14               *
000350200529      *                 MD022652           Date 07Oct13               *
000360200529      *                 MD023247           Date 03Dec13               *
000370200529      *                 MD022428           Date 17Sep13               *
000380200529      *                 257125             Date 28Sep12               *
000390200529      *                 CFT120             Date 28Sep12               *
000400200529      *                 CAP211             Date 28Sep12               *
000410200529      *                 261468             Date 10Aug12               *
000420200529      *                 CSC054             Date 23Feb12               *
000430200529      *                 CSF011A            Date 28Nov11               *
000440200529      *                 CRE075             Date 06Dec10               *
000450200529      *                 CER059             Date 19Jul10               *
000460200529      *                 CER030             Date 09Jul08               *
000470200529      *                 CER043             Date 19May08               *
000480200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
000490200529      *                 260326             Date 18Jun09               *
000500200529      *                 BUG24998           Date 17Jul09               *
000510200529      *                 CSW209             Date 01Apr09               *
000520200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
000530200529      *                 257665             Date 14Nov08               *
000540200529      *                 256256             Date 04Sep08               *
000550200529      *                 256117             Date 18Aug08               *
000560200529      *                 255350             Date 25Jul08               *
000570200529      *                 250600             Date 30Sep07               *
000580200529      *                 247142             Date 01Jun07               *
000590200529      *                 248631             Date 23Jun07               *
000600200529      *                 247665             Date 17May07               *
000610200529      *                 BUG14494A          Date 09Aug07               *
000620200529      * Midas Plus 1.4 Base ------------------------------------------*
000630200529      *                 GBO015             Date 06Sep06               *
000640200529      * Midas Plus 1.3 ----------- Base ------------------------------*
000650200529      *                 CFT032             Date 11Sep06               *
000660200529      *                 CSD031             Date 10Apr06               *
000670200529      *                 241002             Date 18Jul06               *
000680200529      *                 CDL049             Date 06Jul06               *
000690200529      *                 226917             Date 06Jun06               *
000700200529      *                 225169             Date 06Jun06               *
000710200529      *                 226722             Date 06Jun06               *
000720200529      *                 216351             Date 06Jun06               *
000730200529      *                 219728             Date 06Jun06               *
000740200529      *                 220180             Date 06Jun06               *
000750200529      *                 237914             Date 18Apr06               *
000760200529      *                 237415             Date 21Feb06               *
000770200529      *                 237413             Date 08Feb06               *
000780200529      *                 CSD027             Date 09Dec05               *
000790200529      *                 CER001             Date 25Apr05               *
000800200529      *                 BUG7101            Date 06Jul05               *
000810200529      *                 CSC024             Date 07Feb05               *
000820200529      *                 BUG4776            Date 15Nov04               *
000830200529      *                 CFT115             Date 01Jul04               *
000840200529      *                 CGL014             Date 20Oct03               *
000850200529      *                 CLE025             Date 20Oct03               *
000860200529      *                 TDA006             Date 16Mar04               *
000870200529      *                 CSC022             Date 24Feb04               *
000880200529      *                 CGL029             Date 01Sep03               *
000890200529      *                 CGP001             Date 09Dec03               *
000900200529      *                 CAP084             Date 25Aug03               *
000910200529      *                 CSD015             Date 14Oct02               *
000920200529      * Midas Release 4.01.03 ----------------------------------------*
000930200529      *                 210733             Date 11Dec02               *
000940200529      * Midas Release 4.01.02 ----------------------------------------*
000950200529      *                 209067             Date 09Sep02               *
000960200529      *                 207211             Date 16Jul02               *
000970200529      *                 204152             Date 10Apr02               *
000980200529      * Midas Release 4.01 -------------------------------------------*
000990200529      *                 202322             Date 30Jan02               *
001000200529      *                 CSC011             Date 18Sep01               *
001010200529      *                 193883             Date 20Nov01               *
001020200529      * Midas Release 4 --------------- Base -------------------------*
001030200529      *                 195545             Date 13Jul01               *
001040200529      *                 195063             Date 05Jul01               *
001050200529      * Midas DBA 3.05 -----------------------------------------------*
001060200529      *                 CFT009             Date 28Feb01               *
001070200529      * Midas DBA 3.04 -----------------------------------------------*
001080200529      *                 187056             Date 01Dec00               *
001090200529      *                 CSD009             Date 10Oct00               *
001100200529      *                 CFT014             Date 25May00               *
001110200529      * Midas DBA 3.03 -----------------------------------------------*
001120200529      *                 CAP136  *CREATE    Date 15Nov99               *
001130200529      *                                                               *
001140200529      *---------------------------------------------------------------*
001150200529      *                                                               *
001160200529      *  252696 - Ensure that field Swift Reference field is save in  *
001170200529      *           in INPAYDD file for MidasPlus as well as other      *
001180200529      *           needed fields.                                      *
001190200529      *  MD047369A - Funds transfter does not check block Dr flag on  *
001200200529      *              beneficary customer account.                     *
001210200529      *  MD046248 - Finastra Rebranding                               *
001220200529      *  MD036089 - Incorrect values appeared in FT IPN1              *
001230200529      *  AR1090283 - Customer details not visible for enquire.        *
001240200529      *              (Child: AR1090284)                               *
001250200529      *            - Applied for MD-39986.                            *
001260200529      *  MD025111 - Incoming payment without charges is not allowed   *
001270200529      *             if the account is blocked for DR                  *
001280200529      *  CFT151 - FT IN/OP Alphanumeric sequence                      *
001290200529      *  MD022652 - Excluded Phase Processing                         *
001300200529      *  MD023247 - Dbase Error in Incoming payments for a sender     *
001310200529      *  MD022428 - CAR CFT120 - points instead of currency           *
001320200529      *  257125 - CAR CFT120 Charge display error                     *
001330200529      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
001340200529      *  CAP211 - FT IN_OP APIs - Auto-Authorization of Payment       *
001350200529      *  261468 - Disable F7, F8 and F15 from screens 2, 3 and 4 to   *
001360200529      *           be consistent with Outgoing payments input screen.  *
001370200529      *           Also de-allocate payment reference numbers when     *
001380200529      *           browse functions keys are taken after an F12 in the *
001390200529      *           2nd, 3rd and 4th settlement/charges screen          *
001400200529      *  CSC054 - Period End Adjustments                              *
001410200529      *  CSF011A - CCR015: Display Order in Confirmation Pages        *
001420200529      *            (Recompile)                                        *
001430200529      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
001440200529      *  CER059 - German Feature Upgrade to Delhi                     *
001450200529      *  CER030 - Multicash German Feature                            *
001460200529      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
001470200529      *           (Recompile)                                         *
001480200529      *  260326 - Incorrect restoration of canceled ref seq number.   *
001490200529      *  BUG24998 - Bank operation code is missing (Recompile)        *
001500200529      *  CSW209 - SWIFT 2009 Changes                                  *
001510200529      *  257665 - Applied fix 247833. Process field 20 of the         *
001520200529      *           incoming message to related pay ref for MT103.      *
001530200529      *  256256 - Redisplay Level 2 Screen 3 if the value of          *
001540200529      *           'Charges to the debit of a/c' has been changed      *
001550200529      *  256117 - Error on charges screen not shown due to validations*
001560200529      *           setting screen to 'F' when warning counter is zero. *
001570200529      *  255350 - Patterned after 247833 and 220800.                  *
001580200529      *           Process field 20 of the incoming message            *
001590200529      *           to related pay reference number for MT202           *
001600200529      *  250600 - Fix to CFT032                                       *
001610200529      *  247142 - Funds Transfer allows payments over Blocked &       *
001620200529      *           Reffered Accounts without warning. Apply fix 232151.*
001630200529      *  232151 - Warning message for the first screen appears on the *
001640200529      *           second screen.                                      *
001650200529      *  248631 - No warning message for outbound FT on a holiday.    *
001660200529      *           Patterned fix after 223018 which resets the error   *
001670200529      *           messages after displaying.                          *
001680200529      *  247665 - Payment reference validation was removed in order   *
001690200529      *           to update the value of INLVL1 to "Y".               *
001700200529      *  BUG14494A - Incoming Payment not working                     *
001710200529      *  GBO015 - Incoming Payments Beneficiary Validation            *
001720200529      *           Added hook FTIPAYS015                               *
001730200529      *  CFT032 - Account line in field 50X in MT103                  *
001740200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
001750200529      *  241002 - Cannot amend booking branch. Applied 227458.        *
001760200529      *           This fix has already been catered by 220180.        *
001770200529      *  227458 - Allow booking branch to be amendable. Applied part  *
001780200529      *           of 219713.                                          *
001790200529      *  CDL049 - Addition of a Reference Rate field (recompile)      *
001800200529      *  226917 - 225169 should not perform database error processing *
001810200529      *           if a currency is not found.                         *
001820200529      *  225169 - When routed payment contains SWIFT currency code,   *
001830200529      *           translate it to Midas currency code.                *
001840200529      *  226722 - Transfer Commission Tariff code is redefaulted when *
001850200529      *           F12 is pressed in first screen. Applied fix 228749. *
001860200529      *           When F12 is pressed, data that was previously       *
001870200529      *           entered will be retained.                           *
001880200529      *  216351 - Re-initialise warning message array to blank before *
001890200529      *           showing 2nd level screen for IPN1 menu.             *
001900200529      *  219728 - Initial screen should be redisplayed after insert   *
001910200529      *           also when program called from linked function,      *
001920200529      *           otherwise user does not receive new payment         *
001930200529      *           reference.                                          *
001940200529      *  220180 - Make booking branch amendable.                      *
001950200529      *  237914 - Receivers's and Sender's Correspondents should be   *
001960200529      *           translated to 5 char Nostro Id, not to two digit    *
001970200529      *           Nostro Code. Add the missing translation processing *
001980200529      *           for P55 (Third Reimbursement Part). Also add the    *
001990200529      *           missing processing for IBAN in SrTran.              *
002000200529      *  237415 - Add a condition that when called from a link, the   *
002010200529      *           charges will not be overwritten if it is not blank. *
002020200529      *  237413 - Increase length of DS LFLT due to changes in CGL029.*
002030200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
002040200529      *  CER001 - LUX Upgrade to MidasPlus                            *
002050200529      *  BUG7101 - DB error in AOSPOSU0 due to blank INTRIT. Ensure   *
002060200529      *            fields are properly initialised.  Applied core fix *
002070200529      *            216842.                                            *
002080200529      *  CSC024 - Open Month End                                      *
002090200529      *  BUG4776- Correct skipping of transaction reference.          *
002100200529      *  CFT115 - Core changes for GBO015.                            *
002110200529      *         - Incoming Payments Beneficiary Validation            *
002120200529      *         - Upgrade to Midasplus                                *
002130200529      *           Core hooks amended:FTIPAYS002,FTIPAYSC11,FTIPAYSC02 *
002140200529      *  CGL014 - Collaterals Processing                              *
002150200529      *  CLE025 - Credit Lines (Recompile)                            *
002160200529      *  TDA006 - Correct 10-digit full account processing.           *
002170200529      *  CSC022 - Commitment Control Changes for MidasPlus            *
002180200529      *  CGL029 - Increase Account Code to 10 digits                  *
002190200529      *  CGP001 - Recompiled due to change in FTV2OPYPD               *
002200200529      *  CAP084 - Thin Client API Wrappers                            *
002210200529      *           Recompiled over changed FTIPY6PD.                   *
002220200529      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
002230200529      *  210733 - Transaction reference not displayed if SWIFT        *
002240200529      *           payments are routed to incoming payments or         *
002250200529      *           outgoing payments.                                  *
002260200529      *           Pass inserted reference and an 'I return code to    *
002270200529      *           display the transaction reference via ME1060        *
002280200529      *           program.  Apply fix 197712.                         *
002290200529      *  209067 - Amend 204152 to ensure payment number is decremented*
002300200529      *           only if a new payment was generated.                *
002310200529      *  207211 - invalid date not detected                           *
002320200529      *  204152 - Move SR to set up PREF to before window call        *
002330200529      *  202322 - FTIPAYSIN decimal data error in FTVITCHG            *
002340200529      *           (recompile)                                         *
002350200529      *  CSC011 - 24x7 Midas Availability                             *
002360200529      *  193883 - Recompile over changed FTIPAYUPD.                   *
002370200529      *  195545 - Cannot go through warning message FTM2070.          *
002380200529      *  195063 - Book Code defaults to 'FT' when transaction is      *
002390200529      *           coming from an Electronic Message.                  *
002400200529      *  CFT009 - Funds Transfer Fees and Charges                     *
002410200529      *  187056 - IP and OP do not recalculate screen charges if      *
002420200529      *           'Charges to the Debit of a/c' has been changed      *
002430200529      *           from blank to non-blank.                            *
002440200529      *  CSD009 - Profit Centre Accounting Default Matrix Enhancement *
002450200529      *           Re-compiled due to changes in module AOPRFMR0.      *
002460200529      *  CFT014 - Straight-through Processing Phase 2 MT103           *
002470200529      *           Messages Generation for FT.                         *
002480200529      *  CAP136 - Conversion of FT Incoming Payment inputs into       *
002490200529      *           modular structure to use as APIs.                   *
002500200529      *                                                               *
002510200529      *****************************************************************
002520200529      *
002530200529      ** +--------------------------------------+
002540200529      ** ¦ F-specs                              ¦
002550200529      ** ¦ =======                              ¦
002560200529      ** +--------------------------------------+
002570200529      *
002580200529      ** GL Accounts file
002590200529     FACCNT     IF   E           K DISK    INFSR(*PSSR)
002600200529     F                                     IGNORE(ACCNTAAF)
002610200529     F                                     IGNORE(ACCNTACF)
002620200529      *
002630200529      ** Payment Charges file
002640200529     FPYCHGDB   IF   E           K DISK    INFSR(*PSSR)
002650200529     F                                     PREFIX(PY)
002660200529     F*FTPREFL1**IF***E***********K*DISK***                                           BUG4776 260326
002670200529      *                                                                                       CER001
002680200529     FFTIPX1L0  IF   E           K DISK    COMMIT                                             CER001
002690200529     F                                     RENAME(INPAYDDL:RTVIDX)                            CER001
002700200529     F                                     USROPN                                             CER001
002710200529     F                                     INFSR(*PSSR)                                       CER001
002720200529                                                                                              CER001
002730200529     FSDCURRLD  IF   E           K DISK    INFSR(*PSSR)                                       225169
002740200529     FMEINMPL1  IF   E           K DISK    INFSR(*PSSR)                                       252696
002750200529      *
002760200529      ** Hook to enable non-core files to be included
002770200529      /COPY WNCPYSRC,FTIPAYS001
002780200529      *
002790200529      *****************************************************************
002800200529      /EJECT
002810200529      *****************************************************************
002820200529      *
002830200529      ** +--------------------------------------+
002840200529      ** ¦ Automatically included D-specs       ¦
002850200529      ** ¦ ==============================       ¦
002860200529      ** +--------------------------------------+
002870200529      *
002880200529      ** Standard D-specs
002890200529      ** ================
002900200529      **
002910200529      ** The following /COPY line includes the LDA layout,
002920200529      ** the copyright array definition,
002930200529      ** and the following named constants:
002940200529      **    True       logical = *on (for indicator processing)
002950200529      **    False      logical = *off (for indicator processing)
002960200529      **    DBErrCtl   10A     = 'DBERRCTL' (the name of the database error
002970200529      **                                    handler)
002980200529      ** and the following variables:
002990200529      **    RunBefore  1A (for the PSSR)
003000200529      *
003010200529      /COPY ZACPYSRC,STD_D_SPEC
003020200529      *
003030200529      ** Program Status Data Structure
003040200529      ** =============================
003050200529      ** The following /COPY line includes all the defined fields in the
003060200529      ** PSDS.  They have meaningful names, prefixed by 'PS'.
003070200529      *
003080200529      /COPY ZACPYSRC,PSDS
003090200529      *
003100200529      ** The following /COPY line includes the definitions for error and
003110200529      ** warning message arrays.
003120200529      *
003130200529      /COPY ZACPYSRC,ERR_ARRAYS
003140200529      *                                                                                       CER030
003150200529      ** The following /COPY line includes all the definitions of the                         CER030
003160200529      ** appended error arrays, including the named constant giving the size                  CER030
003170200529      ** of the arrays.                                                                       CER030
003180200529      *                                                                                       CER030
003190200529      /COPY ZACPYSRC,ERR_XARRYS                                                               CER030
003200200529      *
003210200529      ** +--------------------------------------+
003220200529      ** ¦ End of automatically included D-specs¦
003230200529      ** ¦ =====================================¦
003240200529      ** +--------------------------------------+
003250200529      *
003260200529      *****************************************************************
003270200529      /EJECT
003280200529      *****************************************************************
003290200529      *
003300200529      ** +--------------------------------------+
003310200529      ** ¦ Manually included D-specs            ¦
003320200529      ** ¦ =========================            ¦
003330200529      ** +--------------------------------------+
003340200529      *
003350200529      ** +--------------------------------------+
003360200529      ** ¦ Named constants                      ¦
003370200529      ** ¦ ===============                      ¦
003380200529      ** +--------------------------------------+
003390200529                                                                                              CSC024
003400200529      ** System Values Array                                                                  CSC024
003410200529     D*SysValOME       C                   CONST('OMEIndicator')                       CSC024 CSC054
003420200529     D SysValPEA       C                   CONST('PEAIndicator')                              CSC054
003430200529      *
003440200529      ** +--------------------------------------+
003450200529      ** ¦ Arrays and Data Structures           ¦
003460200529      ** ¦ ==========================           ¦
003470200529      ** +--------------------------------------+
003480200529      *
003490200529      ** Narrative for Sender
003500200529     D PSNAR           S             35    DIM(1) CTDATA PERRCD(1)
003510200529                                                                                              CSC024
003520200529      *
003530200529      ** Work array for warning message Ids
003540200529     D WPrvWarnAr      S                   Dim(ArrayMax)
003550200529     D                                     Like(WMsgIDArr)
003560200529      *
003570200529      ** Work array for setting up new Payment Reference
003580200529     D WYA2            S              1    DIM(18)
003590200529      *
003600200529      ** Work array for Amount for FONTIS processing
003610200529     D WYA1            S              1    DIM(15)
003620200529      *
003630200529      ** Work array
003640200529     D WA              S              1    DIM(15)
003650200529      *
003660200529      ** Work array used in SR CWVAL to store content of tag
003670200529     D W@CW            S              1    DIM(256)
003680200529      *
003690200529      ** Work array used in SR CWVAL to store value extracted
003700200529     D W@VL            S              1    DIM(256)
003710200529      ** Commitment Control Job Array                                                         CSC022
003720200529     D WJobs           S             10A   Dim(10)                                            CSC022
003730200529      **                                                                                      CSC022
003740200529      *
003750200529      ** Incoming Payments Lvl 1 Scrn details from incoming  transaction
003760200529      ** - screen format
003770200529     D NwIP1ScnFmt   E DS                  EXTNAME(FTIPY1PD)
003780200529     D***NwDetailScrn          20    480                                                    MD036089
003790200529     D  NwDetailScrn          20    706                                                     MD036089
003800200529      *
003810200529      ** Incoming Payments Lvl 2 Scrn 1/1 details from incoming  transaction
003820200529      ** - screen format
003830200529     D NwIP2ScnFmt   E DS                  EXTNAME(FTIPY2PD)
003840200529      *
003850200529      ** Incoming Payments Lvl 2 Scrn 1/2 details from incoming  transaction
003860200529      ** - screen format
003870200529     D NwIP3ScnFmt   E DS                  EXTNAME(FTIPY3PD)
003880200529      *
003890200529      ** Incoming Payments Lvl 2 Scrn 2 details from incoming  transaction
003900200529      ** - screen format
003910200529     D NwIP4ScnFmt   E DS                  EXTNAME(FTIPY4PD)
003920200529      *
003930200529      ** Previous Incoming Payments Lvl 1 Scrn details                                        207211
003940200529     D PrvIP1ScnFmt  E DS                  EXTNAME(FTIPY1PD)                                  207211
003950200529     D                                     PREFIX(@P)                                         207211
003960200529      *                                                                                       207211
003970200529      ** Incoming Payments for file update - file format
003980200529     D NwIPFilFmt    E DS                  EXTNAME(FTVIPAYPD)
003990200529     D/COPY WNCPYSRC,FTH00156
004000200529      *
004010200529      ** Incoming Payments Lvl 1 Scrn details retrieved from file
004020200529      ** - screen format
004030200529     D CrIP1ScnFmt   E DS                  EXTNAME(FTIPY1PD)
004040200529     D                                     PREFIX(O)
004050200529      *
004060200529      ** Incoming Payments Lvl 2 Scrn 1/1 details retrieved from file
004070200529      ** - screen format
004080200529     D CrIP2ScnFmt   E DS                  EXTNAME(FTIPY2PD)
004090200529     D                                     PREFIX(O)
004100200529      *
004110200529      ** Incoming Payments Lvl 2 Scrn 1/2 details retrieved from file
004120200529      ** - screen format
004130200529     D CrIP3ScnFmt   E DS                  EXTNAME(FTIPY3PD)
004140200529     D                                     PREFIX(O)
004150200529      *
004160200529      ** Incoming Payments Lvl 2 Scrn 2 details retrieved from file
004170200529      ** - screen format
004180200529     D CrIP4ScnFmt   E DS                  EXTNAME(FTIPY4PD)
004190200529     D                                     PREFIX(O)
004200200529      *
004210200529      ** Incoming Payments retrieved from file - file format
004220200529     D CrIPFilFmt    E DS                  EXTNAME(INPAYDD)
004230200529      *                                                                         CFT009
004240200529      ** Valid Incoming Payments Extension File (default)                       CFT009
004250200529     D DefValidX     E DS                  EXTNAME(FTVIPY2PD)                   CFT009
004260200529     D                                     PREFIX(D#)                           CFT009
004270200529      *                                                                         CFT009
004280200529      ** Valid Payments layout (default)                                        CFT009
004290200529     D DefValid      E DS                  EXTNAME(FTVIPAYPD)                   CFT009
004300200529     D                                     PREFIX(D#)                           CFT009
004310200529      *
004320200529      ** Incoming Payments Lvl 1 Scrn error indicators
004330200529     D FTEIPY1       E DS                  EXTNAME(FTEIPY1PD)
004340200529      *
004350200529      ** Incoming Payments Lvl 2 Scrn 1 error indicators
004360200529     D FTEIPY2       E DS                  EXTNAME(FTEIPY2PD)
004370200529      *
004380200529      ** Incoming Payments Lvl 2 Scrn 2 error indicators
004390200529     D FTEIPY3       E DS                  EXTNAME(FTEIPY3PD)
004400200529      *
004410200529      ** Incoming Payments extra data
004420200529     D PExtData      E DS                  EXTNAME(FTIPEXPD)
004430200529      *                                                                         CFT014
004440200529      ** Incoming Payments (additional details) for file update - file fmt      CFT014
004450200529     D NwIP2FilFmt   E DS                  EXTNAME(FTVIPY2PD)                   CFT014
004460200529      *                                                                         CFT014
004470200529      ** Incoming Payments Lvl 1 Scrn 1/2 from transaction - screen fmt         CFT014
004480200529     D NwIP1AScnFmt  E DS                  EXTNAME(FTIPY1APD)                   CFT014
004490200529      *                                                                         CFT014
004500200529      ** Incoming Payments Lvl 2 Scrn 2/2 from transaction - screen fmt         CFT014
004510200529     D NwIP4AScnFmt  E DS                  EXTNAME(FTIPY4APD)                   CFT014
004520200529      *                                                                         CFT014
004530200529      ** Incoming Payments Lvl 2 Scrn 3 from transaction - screen fmt           CFT014
004540200529     D NwIP5ScnFmt   E DS                  EXTNAME(FTIPY5PD)                    CFT014
004550200529      *                                                                         CFT014
004560200529      ** Incoming Payments Margin info dtls from transaction - scrn fmt         CFT014
004570200529     D NwIP6ScnFmt   E DS                  EXTNAME(FTIPY6PD)                    CFT014
004580200529     D SDDSWTN       E                     EXTFLD(DDSWTN)                                     CAP084
004590200529     D SDDSEQNO      E                     EXTFLD(DDSEQNO)                                    CAP084
004600200529      *                                                                                       CSW209
004610200529      ** Incoming Payments Lvl 2 Scrn 7 from transaction - screen fmt                         CSW209
004620200529     D NwIP7ScnFmt   E DS                  EXTNAME(FTIPY7PD)                                  CSW209
004630200529      *                                                                                       CSW209
004640200529      ** Incoming Payments Lvl 2 Scrn 8 from transaction - screen fmt                         CSW209
004650200529     D NwIP8ScnFmt   E DS                  EXTNAME(FTIPY8PD)                                  CSW209
004660200529      *                                                                                       CER030
004670200529      ** Incoming Payments Extended Narratives from transaction                               CER030
004680200529      ** - scrn fmt                                                                           CER030
004690200529      *                                                                                       CER030
004700200529     D NwIP6AScnFmt  E DS                  EXTNAME(FTIPY6APD)                                 CER030
004710200529      *                                                                         CFT014
004720200529      ** Incoming Payments (additional details) from file - file fmt            CFT014
004730200529     D CrIP2FilFmt   E DS                  EXTNAME(INPAYXPD)                    CFT014
004740200529      *                                                                         CFT014
004750200529      ** Incoming Payments Lvl 1 Scrn 1/2 from file - screen format             CFT014
004760200529     D CrIP1AScnFmt  E DS                  EXTNAME(FTIPY1APD)                   CFT014
004770200529     D                                     PREFIX(O)                            CFT014
004780200529      *                                                                         CFT014
004790200529      ** Incoming Payments Lvl 2 Scrn 2/2 from file - screen format             CFT014
004800200529     D CrIP4AScnFmt  E DS                  EXTNAME(FTIPY4APD)                   CFT014
004810200529     D                                     PREFIX(O)                            CFT014
004820200529      *                                                                         CFT014
004830200529      ** Incoming Payments Lvl 2 Scrn 3 from file - screen format               CFT014
004840200529     D CrIP5ScnFmt   E DS                  EXTNAME(FTIPY5PD)                    CFT014
004850200529     D                                     PREFIX(O)                            CFT014
004860200529      *                                                                         CFT014
004870200529      ** Incoming Payments Margin info details from file - screen fmt           CFT014
004880200529     D CrIP6ScnFmt   E DS                  EXTNAME(FTIPY6PD)                    CFT014
004890200529     D                                     PREFIX(O)                            CFT014
004900200529      *                                                                                       CSW209
004910200529      ** Incoming Payments Lvl 2 Scrn 7 from file - screen format                             CSW209
004920200529     D CrIP7ScnFmt   E DS                  EXTNAME(FTIPY7PD)                                  CSW209
004930200529     D                                     PREFIX(O)                                          CSW209
004940200529      *                                                                                       CSW209
004950200529      ** Incoming Payments Lvl 2 Scrn 8 from file - screen format                             CSW209
004960200529     D CrIP8ScnFmt   E DS                  EXTNAME(FTIPY8PD)                                  CSW209
004970200529     D                                     PREFIX(O)                                          CSW209
004980200529      *                                                                                       CER030
004990200529      ** Incoming Payments Extended Narratives from file                                      CER030
005000200529      ** - screen fmt                                                                         CER030
005010200529      *                                                                                       CER030
005020200529     D CrIP6AScnFmt  E DS                  EXTNAME(FTIPY6APD)                                 CER030
005030200529     D                                     PREFIX(O)                                          CER030
005040200529      *                                                                         CFT014
005050200529      ** Incoming Payments Lvl 2 Scrn 3 error indicators                        CFT014
005060200529     D FTEIPY4       E DS                  EXTNAME(FTEIPY4PD)                   CFT014
005070200529      *                                                                         CFT014
005080200529      ** Incoming Payments Margin info error indicators                         CFT014
005090200529     D FTEIPY5       E DS                  EXTNAME(FTEIPY5PD)                   CFT014
005100200529      *                                                                                       CSW209
005110200529      ** Incoming Payments Lvl 2 Scrn 7 error indicators                                      CSW209
005120200529     D FTEIPY7       E DS                  EXTNAME(FTEIPY7PD)                                 CSW209
005130200529      *                                                                                       CSW209
005140200529      ** Incoming Payments Lvl 2 Scrn 8 error indicators                                      CSW209
005150200529     D FTEIPY8       E DS                  EXTNAME(FTEIPY8PD)                                 CSW209
005160200529      *                                                                                       CER030
005170200529      ** External DS for Retail Transaction Types Details                                     CER030
005180200529      *                                                                                       CER030
005190200529     D SDRETR        E DS                  EXTNAME(SDRETRPD)                                  CER030
005200200529      *
005210200529      ** Externally described DS for Bank details
005220200529     D SDBANK        E DS                  EXTNAME(SDBANKPD)
005230200529      *
005240200529      ** Externally described DS for General Ledger ICD details
005250200529     D SDGELR        E DS                  EXTNAME(SDGELRPD)
005260200529      *
005270200529      ** Externally described DS for Midas Modules details
005280200529     D SDMMOD        E DS                  EXTNAME(SDMMODPD)
005290200529      *
005300200529      ** Externally described DS for Funds Transfer ICD details
005310200529     D SDFTFR        E DS                  EXTNAME(SDFTFRPD)
005320200529      *
005330200529      ** Externally described DS for Retail ICD details
005340200529     D SDRETL        E DS                  EXTNAME(SDRETLPD)
005350200529     D  QQACC1       E                     EXTFLD(QQACCD)                                     CGL029
005360200529      *
005370200529      ** Externally described DS for SAR details
005380200529     D SCSARD        E DS                  EXTNAME(SCSARDPD)
005390200529     D SLCD          E                     EXTFLD(LCD)
005400200529      *
005410200529      ** Externally described DS for Currency details
005420200529     D SDCURR        E DS                  EXTNAME(SDCURRPD)
005430200529      *
005440200529      ** Externally described DS for Branch details
005450200529     D SDBRCH        E DS                  EXTNAME(SDBRCHPD)
005460200529      *
005470200529      ** Externally described DS for FONTIS details
005480200529     D SDFONT        E DS                  EXTNAME(SDFONTPD)
005490200529      *
005500200529      ** Externally described DS for Account details
005510200529     D SDACCT        E DS                  EXTNAME(ACCNTAB)
005520200529     D                                     PREFIX(IF)
005530200529      *
005540200529      ** Externally described DS for Nostro details
005550200529     D SDNOST        E DS                  EXTNAME(SDNOSTPD)
005560200529     D  QQACC2       E                     EXTFLD(QQACCD)                                     CGL029
005570200529      *
005580200529      ** External DS for Profit Centres
005590200529     D SDPRFC        E DS                  EXTNAME(SDPRFCPD)
005600200529      *
005610200529      ** Externally described DS trading ICD data
005620200529     D SDTRAD        E DS                  EXTNAME(SDTRADPD)
005630200529     D  QQACC3       E                     EXTFLD(QQACCD)                                     CGL029
005640200529      *
005650200529      ** DS for Access Objects - short data structure
005660200529     D DSFDY         E DS                  EXTNAME(DSFDY)
005670200529      *
005680200529      ** DS for Access Objects - long data structure
005690200529     D DSSDY         E DS                  EXTNAME(DSSDY)
005700200529     D RegData       E DS                  EXTNAME(FTIPRXPD)                                  CER001
005710200529     D CrDlFilFmt    E DS                  EXTNAME(FTIPX1PD)                                  CER001
005720200529     D  INPREF1      E                     EXTFLD(INPREF)                                     CER001
005730200529     D NwDlFilFmt    E DS                  EXTNAME(FTVIPLX1PD)                                CER001
005740200529                                                                                              CSC011
005750200529      ** 24X7 Status DataArea Layout                                                          CSC011
005760200529     D SC24X7        E DS                  EXTNAME(SC24X7) DTAARA(SC24X7)                     CSC011
005770200529     D  WPRDTE                 5      9  0                                                    CSC011
005780200529                                                                                              CSC011
005790200529      ** SD Status DataArea Layout                                                            CSC011
005800200529     D SDSTAT        E DS                  EXTNAME(SDSTAT) DTAARA(SDSTAT)                     CSC011
005810200529      ** SCCMTJOB DataArea Layout                                                             CSC022
005820200529     D SCCMTJOB      E DS                  EXTNAME(SCCMTJOB) DTAARA(SCCMTJOB)                 CSC022
005830200529     D  WDSJobs                4    103A                                                      CSC022
005840200529      **                                                                                      CSC022
005850200529      *
005860200529      ** FT Control Data
005870200529     D PCNTRL          DS           256
005880200529     D  PGLUI                  4      4
005890200529     D  PVATT                  6      6
005900200529      *
005910200529      ** DS for VAT details
005920200529     D PVATDS          DS
005930200529     D  PVATR                 10     12P 4
005940200529      *
005950200529      ** DS for ZMUSER details
005960200529     D ZMUSER          DS            17
005970200529     D  PUSRID                 1     10
005980200529     D  PDBRN                 11     13
005990200529     D  PDPPT                 14     16
006000200529      *
006010200529      ** DS for CASH details
006020200529     D***PCSHDTA         DS           512                                                     CGL029
006030200529     D***WDACACD               21     24  0                                                   CGL029
006040200529     D PCSHDTA         DS           522                                                       CGL029
006050200529     D  WDACACD              513    522  0                                                    CGL029
006060200529      *
006070200529      ** DS for next Incoming Payment Reference Number
006080200529     D WINPAY          DS             4
006090200529     D  WINSQ                  1      4  0
006100200529      *
006110200529      ** DS to split Message Reference when maintenance is called
006120200529      ** by linked maintenance/enquiry
006130200529     D WMsgRefDS       DS
006140200529     D  WRefMsg                1      8  0
006150200529     D  WRefPrt                9     11  0
006160200529      *
006170200529      **  DS for Date change
006180200529     D WWDT            DS             6
006190200529     D  WD1                    1      2
006200200529     D  WD2                    3      4
006210200529     D  WD3                    5      6
006220200529      *
006230200529      ** DS for Account key
006240200529     D***WACKYDS         DS            18                                                     CGL029
006250200529     D WACKYDS         DS            24                                                       CGL029
006260200529     D**KACNUM**               1      6  0                                                    CSD027
006270200529     D  KACNUM                 1      6                                                       CSD027
006280200529     D  KACCCY                 7      9
006290200529     D  KACCD                 10     19  0                                                    CGL029
006300200529     D  KACSQ                 20     21  0                                                    CGL029
006310200529     D  KBRCA                 22     24                                                       CGL029
006320200529     D***KACCD**               10     13  0                                                   CGL029
006330200529     D***KACSQ**               14     15  0                                                   CGL029
006340200529     D***KBRCA**               16     18                                                      CGL029
006350200529      *
006360200529      ** DS for IBANs full account
006370200529     D PIBANAcc        DS
006380200529     D**IBCNUM**               1      6  0                                                    CSD027
006390200529     D  IBCNUM                 1      6                                                       CSD027
006400200529     D  IBCCY                  7      9
006410200529     D  IBACOD                10     19  0                                                    CGL029
006420200529     D  IBACSQ                20     21  0                                                    CGL029
006430200529     D  IBBRCA                22     24                                                       CGL029
006440200529     D***IBACOD*               10     13  0                                                   CGL029
006450200529     D***IBACSQ*               14     15  0                                                   CGL029
006460200529     D***IBBRCA*               16     18                                                      CGL029
006470200529      *
006480200529      ** DS to format P53
006490200529     D                 DS
006500200529     D  WWP53                  1     35
006510200529     D  WWP53A                 1      1
006520200529     D  WWP53B                 2     35
006530200529      *
006540200529      ** DS to format P59
006550200529     D                 DS
006560200529     D  WWP59                  1     35
006570200529     D  WWP59A                 1      1
006580200529     D  WWP59B                 2     35
006590200529      *
006600200529      ** DS to format work variable of Beneficiary
006610200529     D                 DS
006620200529     D  WWBNC1                 1     35
006630200529     D  WWCUS1                 1      6
006640200529     D  WWACD1                 7     16                                                       CGL029
006650200529     D  WWSQN1                17     18                                                       CGL029
006660200529     D  WWBCH1                19     21                                                       CGL029
006670200529     D***WWACD1*                7     10                                                      CGL029
006680200529     D***WWSQN1*               11     12                                                      CGL029
006690200529     D***WWBCH1*               13     15                                                      CGL029
006700200529      *
006710200529      ** DS for obtaining Rate
006720200529     D WR1             DS
006730200529     D  WSR                    1     13
006740200529     D                                     DIM(13)
006750200529      *
006760200529      ** DS for obtaining Rate (SRRATE36)
006770200529     D WWR1            DS
006780200529     D  W@R1                   1     13
006790200529     D                                     DIM(13)
006800200529      *                                                                         CFT014
006810200529      ** Work array - Multiple lines of First Line of Pxx fields                CFT014
006820200529     D                 DS                                                       CFT014
006830200529     D  LFLT                   1    355    DIM(5)                                             237413
006840200529     D  BG1                    1     30                                                       237413
006850200529     D  TV1                   31     71                                                       237413
006860200529     D  BG2                   72    101                                                       237413
006870200529     D  TV2                  102    142                                                       237413
006880200529     D  BG3                  143    172                                                       237413
006890200529     D  TV3                  173    213                                                       237413
006900200529     D  BG4                  214    243                                                       237413
006910200529     D  TV4                  244    284                                                       237413
006920200529     D  BG5                  285    314                                                       237413
006930200529     D  TV5                  315    355                                                       237413
006940200529      *                                                                                       237413
006950200529     D**LFLT****               1    295    DIM(5)                                      CFT014 237413
006960200529     D**BG1*****               1     24                                                CFT014 237413
006970200529     D**TV1*****              25     59                                                CFT014 237413
006980200529     D**BG2*****              60     83                                                CFT014 237413
006990200529     D**TV2*****              84    118                                                CFT014 237413
007000200529     D**BG3*****             119    142                                                CFT014 237413
007010200529     D**TV3*****             143    177                                                CFT014 237413
007020200529     D**BG4*****             178    201                                                CFT014 237413
007030200529     D**TV4*****             202    236                                                CFT014 237413
007040200529     D**BG5*****             237    260                                                CFT014 237413
007050200529     D**TV5*****             261    295                                                CFT014 237413
007060200529      *                                                                         CFT014
007070200529      ** Data structure used for FT0010                                         CFT014
007080200529     D P#0010          DS           256                                         CFT014
007090200529     D  P#NDCY                 1      3                                         CFT014
007100200529     D  P#NDAM                 4     10P 0                                      CFT014
007110200529     D  P#DBCY                11     13                                         CFT014
007120200529     D  P#DBAM                14     20P 0                                      CFT014
007130200529     D  P#DBDT                21     23P 0                                      CFT014
007140200529     D  P#CRCY                24     26                                         CFT014
007150200529     D  P#CRAM                27     33P 0                                      CFT014
007160200529     D  P#PDCY                34     36                                         CFT014
007170200529     D  P#PDAM                37     43P 0                                      CFT014
007180200529     D  P#CRDT                44     46P 0                                      CFT014
007190200529     D  P#RATE                47     53P 8                                      CFT014
007200200529     D  P#MDIN                54     54  0                                      CFT014
007210200529     D  P#OVRT                55     55                                         CFT014
007220200529     D  P#SDIN                56     56                                         CFT014
007230200529     D  P#RTDS                57     59P 4                                      CFT014
007240200529      *                                                                         CFT014
007250200529     D  P#FRCY                11     13                                         CFT014
007260200529     D  P#FRAM                14     20P 0                                      CFT014
007270200529     D  P#FRDT                21     23P 0                                      CFT014
007280200529     D  P#TOCY                24     26                                         CFT014
007290200529     D  P#TOAM                27     33P 0                                      CFT014
007300200529     D  P#TODT                44     46P 0                                      CFT014
007310200529      *                                                                         CFT014
007320200529     D  P#PMSQ                60     69                                         CFT014
007330200529     D  P#INDC                70     74                                         CFT014
007340200529     D  P#RTCD                75     81                                         CFT014
007350200529     D  P#INTC                82     99  3                                      CFT014
007360200529     D  P#INTD               100    117  3                                      CFT014
007370200529      *
007380200529      ** Break down MIDAS equivalent
007390200529     D WRCDE2          DS
007400200529     D  WRCNUM                 1      6
007410200529     D  WRCYCD                 7      9
007420200529     D  WRACOD                10     19                                                       CGL029
007430200529     D  WRACSQ                20     21                                                       CGL029
007440200529     D  WRBRCD                22     24                                                       CGL029
007450200529     D  WRCDSQ                10     21                                                       CGL029
007460200529     D  WRCSB                 10     24                                                       CGL029
007470200529     D***WRACOD*               10     13                                                      CGL029
007480200529     D***WRACSQ*               14     15                                                      CGL029
007490200529     D***WRBRCD*               16     18                                                      CGL029
007500200529     D***WRCDSQ*               10     15                                                      CGL029
007510200529     D***WRCSB**               10     18                                                      CGL029
007520200529      *
007530200529      ** DS to hold G/L account number
007540200529     D WDSGLDG         DS
007550200529     D  WGLCST                 1      6
007560200529     D  WGLCCY                 7      9
007570200529     D  WGLACD                10     19                                                       CGL029
007580200529     D  WGLSQN                20     21                                                       CGL029
007590200529     D  WGLBCH                22     24                                                       CGL029
007600200529     D***WGLACD*               10     13                                                      CGL029
007610200529     D***WGLSQN*               14     15                                                      CGL029
007620200529     D***WGLBCH*               16     18                                                      CGL029
007630200529      *
007640200529      ** Output Data Structure for reformatted address
007650200529     D POADD           DS           175
007660200529     D  OADD1                  1     35
007670200529     D  OADD2                 36     70
007680200529     D  OADD3                 71    105
007690200529     D  OADD4                106    140
007700200529     D  OADD5                141    175
007710200529      *
007720200529      ** DS for Additional Info details
007730200529     D PAddInfm        DS           196
007740200529      *
007750200529      ** DS for Default Charge Amounts
007760200529     D*PCharges*       DS           108                                         CFT009
007770200529     D PCharges        DS           196                                         CFT009
007780200529      *
007790200529      ** DS for Default Charge Currencies
007800200529     D PChgCcy         DS            48
007810200529      *                                                                                       187056
007820200529      ** Calling parameter DS for FT0035                                                      187056
007830200529     D P0DTA           DS           256                                                       187056
007840200529     D  WIPT1                  1      1                                                       187056
007850200529     D  WIPTY1                 2     36                                                       187056
007860200529     D  WIPT2                 37     37                                                       187056
007870200529     D  WIPTY2                38     72                                                       187056
007880200529     D  WICCY                 73     75                                                       187056
007890200529     D  WOCUST                76     81                                                       187056
007900200529      *                                                                         CFT009
007910200529      ** Warning message work inds for charges screen                           CFT009
007920200529     D PChgWarn        DS            24                                         CFT009
007930200529     D  WFTF3176               1      1                                         CFT009
007940200529     D  WFTF3177               2      2                                         CFT009
007950200529     D  WFTF3178               3      3                                         CFT009
007960200529     D  WFTF3179               4      4                                         CFT009
007970200529     D  WFTF3202               5      5                                         CFT009
007980200529     D  WFTF3204               6      6                                         CFT009
007990200529     D  WFTF3182               7      7                                         CFT009
008000200529     D  WFTF3184               8      8                                         CFT009
008010200529     D  WFTF3185               9      9                                         CFT009
008020200529     D  WFTF3186              10     10                                         CFT009
008030200529     D  WFTF3187              11     11                                         CFT009
008040200529     D  WFTF3188              12     12                                         CFT009
008050200529     D  WFTF3158              13     13                                         CFT009
008060200529     D  WFTF3159              14     14                                         CFT009
008070200529     D  WFTF3160              15     15                                         CFT009
008080200529     D  WFTF3161              16     16                                         CFT009
008090200529     D  WFTF3203              17     17                                         CFT009
008100200529     D  WFTF3205              18     18                                         CFT009
008110200529     D  WFTF3164              19     19                                         CFT009
008120200529     D  WFTF3171              20     20                                         CFT009
008130200529     D  WFTF3172              21     21                                         CFT009
008140200529     D  WFTF3173              22     22                                         CFT009
008150200529     D  WFTF3174              23     23                                         CFT009
008160200529     D  WFTF3175              24     24                                         CFT009
008170200529      *                                                                         CFT014
008180200529     D**********       DS                                                             BUG4776 260326
008190200529      ******WIPREF*Work*field*Data*Structure***************************               BUG4776 260326
008200200529     D**WIPREF**               1     13                                               BUG4776 260326
008210200529     D**WPRNUM**               8     11  0                                            BUG4776 260326
008220200529      *****************************************************************               BUG4776 260326
008230200529     D W@CHK           C                   CONST('0123456789.')                 CFT014
008240200529     D/COPY WNCPYSRC,FTH00268
008250200529      *
008260200529      ** +--------------------------------------+
008270200529      ** ¦ Declared variables                   ¦
008280200529      ** ¦ ==================                   ¦
008290200529      ** +--------------------------------------+
008300200529      *
008310200529      ** Index for arrays of error messages
008320200529     D IDx             S              3P 0
008330200529      *
008340200529      ** Index for arrays of warning messages
008350200529     D WIDx            S              3P 0
008360200529      *
008370200529      ** Work index
008380200529     D WIx             S              3P 0
008390200529      *
008400200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
008410200529      ** Mode = '      ' (Not Front Office Transaction Interface)
008420200529      ** Mode = '*RPR  ' (Repair Function)
008430200529      ** Mode = '*SIN  ' (Screen Input Function)
008440200529     D PMode           S              6A   INZ('*SIN  ')
008450200529      *
008460200529      ** Response Mode, passed as a constant parameter to the VAL module
008470200529      ** This is always 'S' for Synchronous.
008480200529     D PResponse       S              1A   INZ('S')
008490200529      *
008500200529      ** Cursor position
008510200529     D PRowCol         S              4B 0
008520200529                                                                                              CSC011
008530200529      ** 24X7 Midas Availability switchable field                                             CSC011
008540200529     D CSC011          S              1A                                                      CSC011
008550200529                                                                                              CSC011
008560200529      ** Processing Date                                                                      CSC011
008570200529     D PPROCDTE        S              5  0                                                    CSC011
008580200529     D PPRDATE         S              6  0                                                    CSC011
008590200529     D PPRADATE        S              7                                                       CSC011
008600200529                                                                                              CSW209
008610200529      ** SWIFT 2009 flag                                                                      CSW209
008620200529     D CSW209          S              1A                                                      CSW209
008630200529                                                                                              CSD015
008640200529      ** Switchable features                                                                  CSD015
008650200529     D CSD015          S              1A                                                      CSD015
008660200529                                                                                              CSD015
008670200529      ** Compliance Watch switchable field                                                    CSD015
008680200529     D CCF001          S              1A                                                      CSD015
008690200529      ** CSC022 switchable field                                                              CSC022
008700200529     D CSC022          S              1A                                                      CSC022
008710200529      **                                                                                      CSC022
008720200529                                                                                              CGL029
008730200529      ** Account Code Parameters                                                              CGL029
008740200529     D PACCD           S             10A                                                      CGL029
008750200529     D PPACCD          S             10A                                                      CGL029
008760200529                                                                                              CGL029
008770200529      ** FTIPAY3DT CDRO Parameter                                                             CGL029
008780200529     D PPrvCDRO        S             18A                                                      CGL029
008790200529      ** CSC022 work fields                                                                   CSC022
008800200529     D WArrPtr         S              3S 0                                                    CSC022
008810200529     D WSkpComtRolbk   S              1A                                                      CSC022
008820200529                                                                                              CGL014
008830200529     D CGL014          S              1                                                       CGL014
008840200529     D WFIND           S              1A                                                      CER001
008850200529     D WWERR           S              1A                                                      CER001
008860200529     D #RTRN           S              7A                                                      CER001
008870200529     D SPAREW          S            256A                                                      CER001
008880200529     D #PGM            S             10A                                                      CER001
008890200529     D FKEY            S              2A                                                      CER001
008900200529     D ACTION          S              1A                                                      CER001
008910200529     D ULX043          S              1A                                                      CER001
008920200529     D WWINSQ          S              4  0                                                    CER001
008930200529     D WN2             S              2  0                                                    CER001
008940200529     D WA4             S              4                                                       CER001
008950200529     D WA2             S              2                                                       CER001
008960200529     D WA2A            S              2                                                       CER001
008970200529     D WA6             S              6                                                       CER001
008980200529     D IA              S              2  0                                                    CER001
008990200529     D WAlloc          S              1                                                       CER001
009000200529     D WAllPref        S              1                                                       CER001
009010200529                                                                                              CGL014
009020200529     D PRtty           S              5A                                                      CER030
009030200529     D PTtcd           S             10A                                                      CER030
009040200529     D CER030          S              1A                                                      CER030
009050200529     D CER031          S              1A                                                      CER030
009060200529     D CGL013          S              1A                                                      CER030
009070200529     D Wk              S              3P 0                                                    CER030
009080200529      *                                                                                       CER030
009090200529      ** CFT120 switchable field                                                              CFT120
009100200529      *                                                                                       CFT120
009110200529     D CFT120          S              1A                                                      CFT120
009120200529      *                                                                                       CFT120
009130200529     D PPrvCDRC        S              3A                                                    MD023247
009140200529      *                                                                                     MD023247
009150200529      /COPY WNCPYSRC,FTIPAYS015
009160200529      **                                                                                      CSC022
009170200529      *
009180200529      ** +--------------------------------------+
009190200529      ** ¦ /COPYs                               ¦
009200200529      ** ¦ ======                               ¦
009210200529      ** +--------------------------------------+
009220200529      *
009230200529      /COPY MECPYSRC,ME1100_ILE
009240200529      *
009250200529      /COPY QWINDSRC,FTIPAYDTA
009260200529     D DATALUX         DS          1024                                                       CER001
009270200529     D  #1FLD1                 1      6  0                                                    CER001
009280200529     D  PREF1                  7     21                                                       CER001
009290200529     D  #1FOTR                22     41                                                       CER001
009300200529     D  #1TMST                42     67Z                                                      CER001
009310200529     D  #1ACBT                68     68                                                       CER001
009320200529     D  #1ACBK                69     80                                                       CER001
009330200529     D  #1BNC1                81    115                                                       CER001
009340200529     D  #1PCCY               116    118                                                       CER001
009350200529     D  #1BNCT               119    119                                                       CER001
009360200529     D  #1SMAM               120    132P 0                                                    CER001
009370200529     D  #1RCRT               133    133                                                       CER001
009380200529     D  #1RCCO               134    143  0                                                    CER001
009390200529     D  #1SNTP               144    144                                                       CER001
009400200529     D  #1SND1               145    179                                                       CER001
009410200529     D CSC054          S              1A                                                      CSC054
009420200529      *                                                                                       CSC054
009430200529      *
009440200529      ** +----------------------------------------+
009450200529      ** ¦ Hook for non-core D-specs (all types)  ¦
009460200529      ** ¦ also any I-specs (if necessary)        ¦
009470200529      ** ¦ =====================================  ¦
009480200529      ** +----------------------------------------+
009490200529      *
009500200529      /COPY WNCPYSRC,FTIPAYS002
009510200529      *
009520200529      ** +--------------------------------------+
009530200529      ** ¦ End of D-specs                       ¦
009540200529      ** ¦ ==============                       ¦
009550200529      ** +--------------------------------------+
009560200529      *
009570200529      *****************************************************************
009580200529      /EJECT
009590200529      *****************************************************************
009600200529      *
009610200529      ** +--- Start of Main processing -------------------------------+
009620200529      ** ¦                                                            ¦
009630200529      ** ¦ *INZSR is executed at program activation.                  ¦
009640200529      ** ¦                                                            ¦
009650200529      ** +------------------------------------------------------------+
009660200529      *
009670200529      /COPY WNCPYSRC,FTIPAYS003
009680200529      *
009690200529      ** Read Next Browse Subfile record.
009700200529      *
009710200529     C     WScrn         IFEQ      'R'
009720200529     C                   EXSR      SRRdNBrw
009730200529     C                   ENDIF
009740200529      *
009750200529      /COPY WNCPYSRC,FTIPAYS004
009760200529      *
009770200529      ** DO WHILE: Process Initial screen.
009780200529      *
009790200529     C     WScrn         DOWEQ     'I'
009800200529     C                   EXSR      SRScrn_I
009810200529     C                   ENDDO
009820200529      *
009830200529      /COPY WNCPYSRC,FTIPAYS005
009840200529      *
009850200529      ** DO WHILE: Process Level 1 screen.
009860200529      *
009870200529     C     WScrn         DOWEQ     'P'
009880200529     C                   EXSR      SRScrn_P
009890200529     C                   ENDDO
009900200529      *
009910200529      /COPY WNCPYSRC,FTIPAYS006
009920200529      *
009930200529      ** DO WHILE: Process Level 2 screen 1.
009940200529      *
009950200529     C     WScrn         DOWEQ     'S'
009960200529     C                   EXSR      SRScrn_S
009970200529     C/COPY WNCPYSRC,FTIPAYSC39
009980200529     C                   ENDDO
009990200529      *
010000200529      /COPY WNCPYSRC,FTIPAYS007
010010200529      *
010020200529      ** DO WHILE: Process Level 2 screen 2.
010030200529      *
010040200529     C     WScrn         DOWEQ     'C'
010050200529     C                   EXSR      SRScrn_C
010060200529     C                   ENDDO
010070200529      *                                                                         CFT014
010080200529      ** DO WHILE: Process Level 2 screen 3.                                    CFT014
010090200529      *                                                                         CFT014
010100200529     C     WScrn         DOWEQ     'D'                                          CFT014
010110200529     C                   EXSR      SRScrn_D                                     CFT014
010120200529     C/COPY WNCPYSRC,FTH00275
010130200529     C                   ENDDO                                                  CFT014
010140200529      *                                                                         CFT014
010150200529      ** DO WHILE: Process Margin information                                   CFT014
010160200529      *                                                                         CFT014
010170200529     C     WScrn         DOWEQ     'M'                                          CFT014
010180200529     C                   EXSR      SRScrn_M                                     CFT014
010190200529     C                   ENDDO                                                  CFT014
010200200529      *                                                                                       CSW209
010210200529      ** Display Cover Message if SWIFT 2009 is ON                                            CSW209
010220200529      *                                                                                       CSW209
010230200529     C                   IF        CSW209 = 'Y'                                               CSW209
010240200529      *                                                                                       CSW209
010250200529      ** DO WHILE: Cover Message Screen 1                                                     CSW209
010260200529      *                                                                                       CSW209
010270200529     C     WScrn         DOWEQ     'N'                                                        CSW209
010280200529     C                   EXSR      SRScrn_N                                                   CSW209
010290200529     C                   ENDDO                                                                CSW209
010300200529      *                                                                                       CSW209
010310200529      ** DO WHILE: Cover Message Screen 2                                                     CSW209
010320200529      *                                                                                       CSW209
010330200529     C     WScrn         DOWEQ     'O'                                                        CSW209
010340200529     C                   EXSR      SRScrn_O                                                   CSW209
010350200529     C                   ENDDO                                                                CSW209
010360200529      *                                                                                       CSW209
010370200529     C                   ENDIF                                                                CSW209
010380200529      *
010390200529      /COPY WNCPYSRC,FTIPAYS008
010400200529      *
010410200529      ** Process Window screen.
010420200529      *
010430200529     C     WScrn         IFEQ      'W'
010440200529     C/COPY WNCPYSRC,FTH00269
010450200529     C                   EXSR      SRScrn_W
010460200529     C                   ENDIF
010470200529      *
010480200529      /COPY WNCPYSRC,FTIPAYS009
010490200529      *
010500200529      ** Process Confirmation screen.
010510200529      *
010520200529     C     WScrn         IFEQ      'F'
010530200529     C                   EXSR      SRScrn_F
010540200529     C                   ENDIF
010550200529      *
010560200529      /COPY WNCPYSRC,FTIPAYS010
010570200529      *
010580200529      ** Process Additional Information screen.
010590200529      *
010600200529     C     WScrn         IFEQ      'A'
010610200529     C                   EXSR      SRScrn_A
010620200529     C                   ENDIF
010630200529      *
010640200529      /COPY WNCPYSRC,FTIPAYS011
010650200529      *
010660200529      ** Update files.
010670200529      *
010680200529     C     WScrn         IFEQ      'U'
010690200529     C                   EXSR      SRUpdate
010700200529      *                                                                                       204152
010710200529      * Reset First Time through Flag                                                         204152
010720200529     C                   EVAL      FirstTime = 'Y'                                            204152
010730200529      *                                                                                       204152
010740200529     C                   ENDIF
010750200529      *
010760200529      /COPY WNCPYSRC,FTIPAYS012
010770200529      *                                                                                       CER001
010780200529     C                   IF        WScrn = 'L'                                                CER001
010790200529     C                   EXSR      SREXT                                                      CER001
010800200529     C                   ENDIF                                                                CER001
010810200529      *
010820200529      ** Terminate program.
010830200529      *
010840200529     C     WScrn         IFEQ      'T'
010850200529     C                   IF        ULX043 = 'Y'                                               CER001
010860200529     C                   CLOSE     FTIPX1L0                                                   CER001
010870200529     C                   ENDIF                                                                CER001
010880200529     C                   EVAL      *INLR = *ON
010890200529     C                   ENDIF
010900200529      *
010910200529      *****************************************************************
010920200529      /EJECT
010930200529      *****************************************************************
010940200529      *
010950200529      ** Hook to enable non-core subroutines to be included
010960200529      *
010970200529      /COPY WNCPYSRC,FTIPAYS013
010980200529      *****************************************************************                       CER001
010990200529      /EJECT                                                                                  CER001
011000200529      *****************************************************************                       CER001
011010200529      * WINDOWI - Call window manager in insertion                    *                       CER001
011020200529      *****************************************************************                       CER001
011030200529     C     WINDOWI       BEGSR                                                                CER001
011040200529      *                                                                                       CER001
011050200529      ** Using Same Details but Call with 2Part validated                                     CER001
011060200529      *                                                                                       CER001
011070200529     C/COPY WNCPYSRC,FTIPAYMV2                                                                CER001
011080200529      *                                                                                       CER001
011090200529     C                   CALL      'WN0010'                                                   CER001
011100200529     C                   PARM      'FTIPAYSNL'   #PGM                                         CER001
011110200529     C                   PARM                    FKEY                                         CER001
011120200529     C                   PARM      DDACTN        ACTION                                       CER001
011130200529     C                   PARM                    DATA                                         CER001
011140200529     C                   PARM      *BLANKS       #RTRN                                        CER001
011150200529     C                   PARM                    SPAREW                                       CER001
011160200529      *                                                                                       CER001
011170200529     C                   SELECT                                                               CER001
011180200529      *                                                                                       CER001
011190200529      ** F3 - end program.                                                                    CER001
011200200529      *                                                                                       CER001
011210200529     C                   WHEN      #RTRN = 'Y2U9999'                                          CER001
011220200529     C                   EXSR      SREndP                                                     CER001
011230200529      *                                                                                       CER001
011240200529      ** F12 - cancel.  Display Level 2 screen 3                                              CER001
011250200529      *                                                                                       CER001
011260200529     C                   WHEN      #RTRN = 'USR0790'                                          CER001
011270200529     C                   EVAL      WScrn = 'D'                                                CER001
011280200529      *                                                                                       CER001
011290200529      ** Enter key was pressed.                                                               CER001
011300200529      *                                                                                       CER001
011310200529     C                   OTHER                                                                CER001
011320200529      *                                                                                       CER001
011330200529     C                   ENDSL                                                                CER001
011340200529      *                                                                                       CER001
011350200529     C     WINDI         ENDSR                                                                CER001
011360200529      *****************************************************************                       CER001
011370200529      /EJECT                                                                                  CER001
011380200529      *****************************************************************                       CER001
011390200529      *                                                               *                       CER001
011400200529      * SREXT - Call FTIPAY2SN                                        *                       CER001
011410200529      *                                                               *                       CER001
011420200529      *****************************************************************                       CER001
011430200529     C     SREXT         BEGSR                                                                CER001
011440200529      *                                                                                       CER001
011450200529      ** Using Same Details but Call with 2Part validated                                     CER001
011460200529      *                                                                                       CER001
011470200529      *                                                                                       CER001
011480200529      ** If Payment reference still blank when window is called                               CER001
011490200529      ** allocate payment reference                                                           CER001
011500200529      *                                                                                       CER001
011510200529     C                   EVAL      WAlloc = 'N'                                               CER001
011520200529     C                   EVAL      WAllPref = *BLANKS                                         CER001
011530200529      *                                                                                       CER001
011540200529      ** Action is Insert.                                                                    CER001
011550200529      *                                                                                       CER001
011560200529     C                   IF        DDACTN = 'I'                                               CER001
011570200529     C**********                   and IPPREF = *BLANKS                                CER001 247665
011580200529      *                                                                                       CER001
011590200529      ** Entry point is Level 1.                                                              CER001
011600200529      *                                                                                       CER001
011610200529     C                   IF        PParmLevel = '1'                                           CER001
011620200529      *                                                                                       CER001
011630200529      ** Update Incoming Payments data area with next                                         CER001
011640200529      ** Sequence Number.                                                                     CER001
011650200529      *                                                                                       CER001
011660200529     C                   IF        CFT151 = 'N'                                               CFT151
011670200529     C     *LOCK         IN        WINPAY                                                     CER001
011680200529     C                   Z-ADD     WINSQ         WWINSQ                                       CER001
011690200529     C                   ADD       1             WINSQ                                        CER001
011700200529     C                   OUT       WINPAY                                                     CER001
011710200529     C                   ELSE                                                                 CFT151
011720200529     C                   CALL      'FT000328'                                                 CFT151
011730200529     C                   PARM                    PRTCD                                        CFT151
011740200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
011750200529     C                   PARM      'A'           WCALC             1                          CFT151
011760200529     C                   PARM      'Y'           WUPD              1                          CFT151
011770200529     C                   PARM                    WWINSQT           4                          CFT151
011780200529     C                   PARM                    WNEWSQ            4                          CFT151
011790200529     C                   END                                                                  CFT151
011800200529      *                                                                                       CER001
011810200529      ** Record Id.                                                                           CER001
011820200529      *                                                                                       CER001
011830200529     C                   EVAL      IPRECI = 'D'                                               CER001
011840200529      *                                                                                       CER001
011850200529      ** Payment Type.                                                                        CER001
011860200529      *                                                                                       CER001
011870200529     C                   EVAL      IPPYTP = 'IN'                                              CER001
011880200529      *                                                                                       CER001
011890200529      ** Original Entry Dates.                                                                CER001
011900200529      *                                                                                       CER001
011910200529     C                   Z-ADD     BJRDNB        PDayNo                                       CER001
011920200529      *                                                                                       CER001
011930200529     C                   CALLB     'ZDATE2'                                                   CER001
011940200529     C                   PARM                    PDayNo                                       CER001
011950200529     C                   PARM      BJDFIN        PFMT                                         CER001
011960200529     C                   PARM      *ZERO         PDate                                        CER001
011970200529     C                   PARM      *BLANKS       PADate                                       CER001
011980200529      *                                                                                       CER001
011990200529     C                   Z-ADD     BJRDNB        IPOEDT                                       CER001
012000200529     C                   Z-ADD     PDate         IPOEDTD1                                     CER001
012010200529      *                                                                                       CER001
012020200529     C                   MOVE      PDate         WN2                                          CER001
012030200529     C                   IF        WN2 < 72                                                   CER001
012040200529     C                   Z-ADD     20            IPOEDTD2                                     CER001
012050200529     C                   ELSE                                                                 CER001
012060200529     C                   Z-ADD     19            IPOEDTD2                                     CER001
012070200529     C                   ENDIF                                                                CER001
012080200529      *                                                                                       CER001
012090200529     C                   MOVEL     PDate         WA4                                          CER001
012100200529     C                   IF        BJDFIN <> 'M'                                              CER001
012110200529     C                   MOVEL     WA4           WA2                                          CER001
012120200529     C                   MOVE      WA4           WA2A                                         CER001
012130200529     C                   MOVEL     WA2A          WA4                                          CER001
012140200529     C                   MOVE      WA2           WA4                                          CER001
012150200529     C                   ENDIF                                                                CER001
012160200529      *                                                                                       CER001
012170200529     C                   MOVE      PDate         WA2                                          CER001
012180200529     C                   MOVEL     WA2           PDate                                        CER001
012190200529     C                   MOVE      WA4           PDate                                        CER001
012200200529     C                   Z-ADD     PDate         IPOEDTD3                                     CER001
012210200529      *                                                                                       CER001
012220200529      ** New Payment Reference.                                                               CER001
012230200529      *                                                                                       CER001
012240200529     C                   MOVE      PDate         WA6                                          CER001
012250200529     C                   IF        CFT151  = 'N'                                              CFT151
012260200529     C                   MOVE      WWINSQ        WA4                                          CER001
012270200529     C                   ELSE                                                                 CFT151
012280200529     C                   MOVE      WWINSQT       WA4                                          CFT151
012290200529     C                   END                                                                  CFT151
012300200529     C                   MOVE      'P'           WYA2(1)                                      CER001
012310200529     C                   MOVEA     WA6           WYA2(2)                                      CER001
012320200529     C                   MOVEA     WA4           WYA2(8)                                      CER001
012330200529     C                   MOVEA     IPPYTP        WYA2(12)                                     CER001
012340200529     C                   MOVEA     '00'          WYA2(14)                                     CER001
012350200529      *                                                                                       CER001
012360200529     C     1             DO        15            IA                                           CER001
012370200529     C                   IF        WYA2(IA) = ' '                                             CER001
012380200529     C                   MOVEL     '0'           WYA2(IA)                                     CER001
012390200529     C                   ENDIF                                                                CER001
012400200529     C                   ENDDO                                                                CER001
012410200529      *                                                                                       CER001
012420200529     C                   MOVEA     WYA2(1)       IPPREF                                       CER001
012430200529     C                   MOVEA     WYA2(1)       WPREFI                                       CER001
012440200529     C                   EVAL      WInsert = 'Y'                                              CER001
012450200529      *                                                                                       CER001
012460200529      ** Level 1 Valid Indicator.                                                             CER001
012470200529      *                                                                                       CER001
012480200529     C                   EVAL      IPINLVL1 = 'Y'                                             CER001
012490200529      *                                                                                       CER001
012500200529     C                   EVAL      WAlloc = 'Y'                                               CER001
012510200529     C                   MOVEA     WYA2(1)       WAllPref                                     CER001
012520200529      *                                                                                       CER001
012530200529     C                   ENDIF                                                                CER001
012540200529      *                                                                                       CER001
012550200529     C                   ENDIF                                                                CER001
012560200529      *                                                                                       CER001
012570200529      ** Populate fields that will be required by the display program.                        CER001
012580200529      *                                                                                       CER001
012590200529     C                   IF        DDACTN <> 'I'                                              CER001
012600200529      *                                                                                       CER001
012610200529     C     DDPREF        CHAIN     RTVIDX                             85                      CER001
012620200529     C                   IF        *IN85 = *OFF                                               CER001
012630200529     C                   EVAL      INPREF1  = INPREF                                          CER001
012640200529     C                   EVAL      LLLXORTY = INORTY                                          CER001
012650200529     C                   EVAL      LLLXBETY = INBETY                                          CER001
012660200529     C                   EVAL      LLLXOPCO = INOPCO                                          CER001
012670200529     C                   EVAL      LLLXCOCO = INCOCO                                          CER001
012680200529     C                   EVAL      LLLXIDCO = INIDCO                                          CER001
012690200529     C                   EVAL      LLLXIDEN = INIDEN                                          CER001
012700200529     C                   ELSE                                                                 CER001
012710200529     C     *LOCK         IN        LDA                                                        CER001
012720200529     C                   EVAL      DBKEY = DDPREF                                             CER001
012730200529     C                   EVAL      DBFILE = 'FTIPX1L0'                                        CER001
012740200529     C                   EVAL      DBASE = 042                                                CER001
012750200529     C                   EXSR      *PSSR                                                      CER001
012760200529     C                   ENDIF                                                                CER001
012770200529      *                                                                                       CER001
012780200529     C                   ELSE                                                                 CER001
012790200529     C                   EVAL      LLLXORTY = *BLANKS                                         CER001
012800200529     C                   EVAL      LLLXBETY = *BLANKS                                         CER001
012810200529     C                   EVAL      LLLXOPCO = *BLANKS                                         CER001
012820200529     C                   EVAL      LLLXCOCO = *BLANKS                                         CER001
012830200529     C                   EVAL      LLLXIDCO = *BLANKS                                         CER001
012840200529     C                   EVAL      LLLXIDEN = *BLANKS                                         CER001
012850200529      *                                                                                       CER001
012860200529     C                   ENDIF                                                                CER001
012870200529      *                                                                                       CER001
012880200529      ** Populate fields that will be required by the called programs.                        CER001
012890200529      ** This is the DATALUX.                                                                 CER001
012900200529      *                                                                                       CER001
012910200529     C                   MOVEL     IPPREF        PREF1                                        CER001
012920200529     C                   MOVEL     IPFRNT        #1FOTR                                       CER001
012930200529     C                   MOVEL     IPTMST        #1TMST                                       CER001
012940200529     C                   MOVEL     IPACBT        #1ACBT                                       CER001
012950200529     C                   MOVEL     IPACBK        #1ACBK                                       CER001
012960200529     C                   MOVEL     IPBNC1        #1BNC1                                       CER001
012970200529     C                   MOVEL     IPPCCY        #1PCCY                                       CER001
012980200529     C                   MOVEL     IPBNCT        #1BNCT                                       CER001
012990200529     C                   Z-ADD     IPSMAM        #1SMAM                                       CER001
013000200529     C                   MOVEL     IPRCRT        #1RCRT                                       CER001
013010200529     C                   MOVEL     IPRCCO        #1RCCO                                       CER001
013020200529     C                   MOVEL     IPSNTP        #1SNTP                                       CER001
013030200529     C                   MOVEL     IPSND1        #1SND1                                       CER001
013040200529      *                                                                                       CER001
013050200529     C                   CALL      'FTIPAY2SN'                                                CER001
013060200529     C                   PARM      DDACTN        ACTION                                       CER001
013070200529     C                   PARM                    DATALUX                                      CER001
013080200529     C                   PARM      *BLANKS       #RTRN                                        CER001
013090200529     C                   PARM                    RegData                                      CER001
013100200529     C                   PARM                    NwDlFilFmt                                   CER001
013110200529      *                                                                                       CER001
013120200529     C                   SELECT                                                               CER001
013130200529      *                                                                                       CER001
013140200529      ** F3 - end program.                                                                    CER001
013150200529      *                                                                                       CER001
013160200529     C                   WHEN      #RTRN = 'Y2U9999'                                          CER001
013170200529     C                   EXSR      SREndP                                                     CER001
013180200529      *                                                                                       CER001
013190200529      ** F12 - cancel.  Display Level 2 screen 3                                              CER001
013200200529      *                                                                                       CER001
013210200529     C                   WHEN      #RTRN = 'USR0790'                                          CER001
013220200529     C                   EVAL      WScrn = 'D'                                                CER001
013230200529      *                                                                                       CER001
013240200529      ** Enter key was pressed.                                                               CER001
013250200529      *                                                                                       CER001
013260200529     C                   OTHER                                                                CER001
013270200529     C                   IF        DDACTN = 'E'                                               CER001
013280200529     C                   EVAL      WScrn = 'R'                                                CER001
013290200529     C                   ELSE                                                                 CER001
013300200529     C                   EVAL      WScrn = 'F'                                                CER001
013310200529     C                   ENDIF                                                                CER001
013320200529      *                                                                                       CER001
013330200529     C                   ENDSL                                                                CER001
013340200529      *                                                                                       CER001
013350200529     C                   ENDSR                                                                CER001
013360200529      *****************************************************************                       CER001
013370200529      *
013380200529      *****************************************************************
013390200529      /EJECT
013400200529      *****************************************************************
013410200529      *                                                               *
013420200529      *  SRCWVAL - Retrieve FONTIS alphanumeric field identified by   *
013430200529      *            presence of codework /XXXX/                        *
013440200529      *                                                               *
013450200529      *****************************************************************
013460200529      *
013470200529     C     SRCWVAL       BEGSR
013480200529      *
013490200529      ** Inputs
013500200529      ** ------
013510200529      ** Code work lines
013520200529      **                                  WCWLIN
013530200529      ** Code work
013540200529      **                                  WCW
013550200529      ** Code work length
013560200529      **                                  WCWLEN
013570200529      ** Outputs
013580200529      ** -------
013590200529      *
013600200529      ** Reset temporary variables
013610200529     C                   MOVEL     *BLANK        W@CW
013620200529     C                   MOVEL     *BLANK        W@VL
013630200529     C                   MOVEL     *BLANK        WCWVAL          256
013640200529     C                   Z-ADD     0             WLn               2 0
013650200529     C                   Z-ADD     0             WVL               3 0
013660200529     C                   Z-ADD     0             WTagI             3 0
013670200529     C                   Z-ADD     0             WLnCW             3 0
013680200529      *
013690200529      ** Length of tag containing the code works
013700200529     C     ' '           CHECKR    WCWLIN        WLnCW
013710200529      *
013720200529      ** Length of search argument
013730200529     C     ' '           CHECKR    WCW           WLn
013740200529
013750200529     C     WCW:WLn       SCAN      WCWLIN:1      WVL                      81
013760200529     C     *IN81         IFEQ      *ON
013770200529     C                   MOVEA     WCWLIN        W@CW
013780200529     C     WVL           ADD       WLn           WVL
013790200529      *
013800200529      ** We start to extract the value right after the code work
013810200529      ** (so we need to know the length of the code work)
013820200529      ** We stop extracting when
013830200529      ** - another / (and therefore another code work) has been found
013840200529      ** - we reached the length to extract
013850200529      ** - we reached the length of the tag
013860200529     C     WTagI         DOWLT     WCWLEN
013870200529     C     WVL           ANDLE     WLnCW
013880200529     C     W@CW(WVL)     ANDNE     '/'
013890200529     C                   ADD       1             WTagI
013900200529     C                   MOVEL     W@CW(WVL)     W@VL(WTagI)
013910200529     C                   ADD       1             WVL
013920200529     C                   ENDDO
013930200529     C                   MOVEA     W@VL          WCWVAL
013940200529     C                   ENDIF
013950200529      *
013960200529      ** Reset input variables
013970200529     C                   MOVEL     *BLANKS       WCWLIN
013980200529     C                   MOVEL     *BLANKS       WCW
013990200529     C                   Z-ADD     0             WCWLEN            3 0
014000200529
014010200529     C                   ENDSR
014020200529      *
014030200529      *****************************************************************
014040200529      /EJECT
014050200529      *****************************************************************
014060200529      *                                                               *
014070200529      *  SRBIC1 - Level 1 BIC processing                              *
014080200529      *                                                               *
014090200529      *****************************************************************
014100200529      *
014110200529     C     SRBIC1        BEGSR
014120200529      *
014130200529      ** Determine whether cursor is on an allowed field
014140200529      *
014150200529     C                   Z-ADD     PRowCol       WKSCPS            5 0
014160200529      *
014170200529      ** Note: If these screen fields move then these values will
014180200529      **       need changing.
014190200529      *
014200200529      **       The value is cursor row number * 256 + column number
014210200529      *
014220200529      *
014230200529      ** Sender line 1
014240200529      *
014250200529     C                   MOVE      *OFF          LINE1S            1
014260200529     C*****WKSCPS        IFGE      2050                                         CFT014
014270200529     C*****WKSCPS        ANDLE     2084                                         CFT014
014280200529     C     WKSCPS        IFGE      1801                                         CFT014
014290200529     C     WKSCPS        ANDLE     1835                                         CFT014
014300200529     C                   MOVE      *ON           LINE1S
014310200529     C                   ENDIF
014320200529      *
014330200529      ** Sender line 2
014340200529      *
014350200529     C                   MOVE      *OFF          LINE2S            1
014360200529     C*****WKSCPS        IFGE      2093                                         CFT014
014370200529     C*****WKSCPS        ANDLE     2127                                         CFT014
014380200529     C     WKSCPS        IFGE      1837                                         CFT014
014390200529     C     WKSCPS        ANDLE     1871                                         CFT014
014400200529     C                   MOVE      *ON           LINE2S
014410200529     C                   ENDIF
014420200529      *
014430200529      ** Beneficiary line 1
014440200529      *
014450200529     C                   MOVE      *OFF          LINE1B            1
014460200529     C*****WKSCPS        IFGE      3117                                         CFT014
014470200529     C*****WKSCPS        ANDLE     3151                                         CFT014
014480200529     C     WKSCPS        IFGE      3373                                         CFT014
014490200529     C     WKSCPS        ANDLE     3407                                         CFT014
014500200529     C                   MOVE      *ON           LINE1B
014510200529     C                   ENDIF
014520200529      *
014530200529      ** Beneficiary line 2
014540200529      *
014550200529     C                   MOVE      *OFF          LINE2B            1
014560200529     C*****WKSCPS        IFGE      3330                                         CFT014
014570200529     C*****WKSCPS        ANDLE     3364                                         CFT014
014580200529     C     WKSCPS        IFGE      3593                                         CFT014
014590200529     C     WKSCPS        ANDLE     3627                                         CFT014
014600200529     C                   MOVE      *ON           LINE2B
014610200529     C                   ENDIF
014620200529      *                                                                         CFT014
014630200529      ** Receiver's Correspondent Line 1                                        CFT014
014640200529      *                                                                         CFT014
014650200529     C                   MOVE      *OFF          LINE1R            1            CFT014
014660200529     C     WKSCPS        IFGE      2349                                         CFT014
014670200529     C     WKSCPS        ANDLE     2383                                         CFT014
014680200529     C     CFT014        ANDEQ     'Y'                                          CFT014
014690200529     C                   MOVE      *ON           LINE1R                         CFT014
014700200529     C                   ENDIF                                                  CFT014
014710200529      *                                                                         CFT014
014720200529      ** Receiver's Correspondent Line 2                                        CFT014
014730200529      *                                                                         CFT014
014740200529     C                   MOVE      *OFF          LINE2R            1            CFT014
014750200529     C     WKSCPS        IFGE      2569                                         CFT014
014760200529     C     WKSCPS        ANDLE     2603                                         CFT014
014770200529     C     CFT014        ANDEQ     'Y'                                          CFT014
014780200529     C                   MOVE      *ON           LINE2R                         CFT014
014790200529     C                   ENDIF                                                  CFT014
014800200529      *
014810200529      ** If cursor is not on an allowed field, error
014820200529      *
014830200529     C     LINE1S        IFNE      *ON
014840200529     C     LINE2S        ANDNE     *ON
014850200529     C     LINE1B        ANDNE     *ON
014860200529     C     LINE2B        ANDNE     *ON
014870200529     C     LINE1R        ANDNE     *ON                                          CFT014
014880200529     C     LINE2R        ANDNE     *ON                                          CFT014
014890200529
014900200529     C                   MOVE      '*ANY'        FldNameArr(1)
014910200529     C                   MOVEL     'FTM2625'     MsgIdArr(1)
014920200529
014930200529     C                   ELSE
014940200529      *
014950200529      ** In-line prompt mode, capture search criteria from screen field
014960200529      *
014970200529     C     PINKD         IFEQ      *ON
014980200529     C                   MOVE      'P'           PIMODE
014990200529
015000200529     C     LINE1S        IFEQ      *ON
015010200529     C                   MOVE      DDSND1        PICRIT
015020200529     C                   ENDIF
015030200529
015040200529     C     LINE2S        IFEQ      *ON
015050200529     C                   MOVE      DDSND2        PICRIT
015060200529     C                   ENDIF
015070200529
015080200529     C     LINE1B        IFEQ      *ON
015090200529     C                   MOVE      DDBNC1        PICRIT
015100200529     C                   ENDIF
015110200529
015120200529     C     LINE2B        IFEQ      *ON
015130200529     C                   MOVE      DDBNC2        PICRIT
015140200529     C                   ENDIF
015150200529      *                                                                         CFT014
015160200529     C     LINE1R        IFEQ      *ON                                          CFT014
015170200529     C                   MOVE      DDRCO1        PICRIT                         CFT014
015180200529     C                   ENDIF                                                  CFT014
015190200529      *                                                                         CFT014
015200200529     C     LINE2R        IFEQ      *ON                                          CFT014
015210200529     C                   MOVE      DDRCO2        PICRIT                         CFT014
015220200529     C                   ENDIF                                                  CFT014
015230200529
015240200529     C                   ENDIF
015250200529      *
015260200529      ** In-line search mode, capture search criteria from screen field
015270200529      *
015280200529     C     PINKQ         IFEQ      *ON
015290200529     C                   MOVE      'F'           PIMODE
015300200529
015310200529     C     LINE1S        IFEQ      *ON
015320200529     C                   MOVE      DDSND1        PICRIT
015330200529     C                   ENDIF
015340200529
015350200529     C     LINE2S        IFEQ      *ON
015360200529     C                   MOVE      DDSND2        PICRIT
015370200529     C                   ENDIF
015380200529
015390200529     C     LINE1B        IFEQ      *ON
015400200529     C                   MOVE      DDBNC1        PICRIT
015410200529     C                   ENDIF
015420200529
015430200529     C     LINE2B        IFEQ      *ON
015440200529     C                   MOVE      DDBNC2        PICRIT
015450200529     C                   ENDIF
015460200529      *                                                                         CFT014
015470200529     C     LINE1R        IFEQ      *ON                                          CFT014
015480200529     C                   MOVE      DDRCO1        PICRIT                         CFT014
015490200529     C                   ENDIF                                                  CFT014
015500200529      *                                                                         CFT014
015510200529     C     LINE2R        IFEQ      *ON                                          CFT014
015520200529     C                   MOVE      DDRCO2        PICRIT                         CFT014
015530200529     C                   ENDIF                                                  CFT014
015540200529
015550200529     C                   ENDIF
015560200529      *
015570200529      ** Call BIC Plus enquiry program
015580200529      *
015590200529     C                   CALL      'FT0900'
015600200529     C                   PARM                    PIMODE            1
015610200529     C                   PARM                    PICRIT           35
015620200529     C                   PARM      *BLANKS       POADD           175
015630200529     C                   PARM      *BLANKS       POCHIP           10
015640200529     C                   PARM      *BLANKS       POUTCD            2
015650200529     C                   PARM      *BLANKS       PRTCD
015660200529     C                   MOVEL     *BLANKS       PICRIT
015670200529      *
015680200529      ** F3 pressed - exit program
015690200529      *
015700200529     C     PRTCD         IFEQ      'F3'
015710200529     C                   EXSR      SREndP
015720200529     C                   ENDIF
015730200529
015740200529     C     PRTCD         IFEQ      *BLANKS
015750200529      *
015760200529      ** If a CHIPS code exists and relevant currency is USD, replace
015770200529      ** clearing code with CHIPS code
015780200529      *
015790200529     C     POCHIP        IFNE      *BLANKS
015800200529     C     POUTCD        ANDNE     'AC'
015810200529      *
015820200529     C     DDSMCY        IFEQ      BLUSCY
015830200529     C     LINE1S        ANDEQ     *ON
015840200529     C     DDSMCY        OREQ      BLUSCY                                       CFT014
015850200529     C     LINE1R        ANDEQ     *ON                                          CFT014
015860200529     C     DDPCCY        OREQ      BLUSCY
015870200529     C     LINE1B        ANDEQ     *ON
015880200529      *
015890200529      ** If clearing code is not present, move details down to
015900200529      ** create space for CHIPS code
015910200529      *
015920200529     C     POUTCD        IFNE      'BC'
015930200529     C     POUTCD        ANDNE     'DC'
015940200529     C                   MOVE      POADD         WKADD1          210
015950200529     C                   MOVEL     WKADD1        POADD
015960200529     C                   ENDIF
015970200529
015980200529     C                   MOVEL     *BLANKS       WKCOCH           14
015990200529     C                   MOVEL     *BLANKS       OADD1
016000200529     C                   MOVEL     '//CH'        WKCOCH
016010200529     C                   MOVE      POCHIP        WKCOCH
016020200529     C                   MOVEL     WKCOCH        OADD1
016030200529     C                   ENDIF
016040200529
016050200529     C                   ENDIF
016060200529      *
016070200529      ** If command key pressed on 2nd line, remove clearing
016080200529      ** code from details
016090200529      *
016100200529     C     LINE2S        IFEQ      *ON
016110200529     C     POUTCD        ANDEQ     'BC'
016120200529     C     LINE2S        OREQ      *ON
016130200529     C     POUTCD        ANDEQ     'DC'
016140200529     C     LINE2R        OREQ      *ON                                          CFT014
016150200529     C     POUTCD        ANDEQ     'BC'                                         CFT014
016160200529     C     LINE2R        OREQ      *ON                                          CFT014
016170200529     C     POUTCD        ANDEQ     'DC'                                         CFT014
016180200529     C     LINE2B        OREQ      *ON
016190200529     C     POUTCD        ANDEQ     'BC'
016200200529     C     LINE2B        OREQ      *ON
016210200529     C     POUTCD        ANDEQ     'DC'
016220200529     C     POUTCD        OREQ      'AC'
016230200529     C                   MOVE      POADD         WKADD2          140
016240200529     C                   MOVE      *BLANKS       POADD
016250200529     C                   MOVEL     WKADD2        POADD
016260200529     C                   ENDIF
016270200529      *
016280200529      ** Move details to screen
016290200529      *
016300200529     C     LINE1S        IFEQ      *ON
016310200529     C                   MOVEL     OADD1         DDSND1
016320200529     C                   MOVEL     OADD2         DDSND2
016330200529     C                   MOVEL     OADD3         DDSND3
016340200529     C                   MOVEL     OADD4         DDSND4
016350200529     C                   ENDIF
016360200529      *                                                                         CFT014
016370200529     C     LINE1R        IFEQ      *ON                                          CFT014
016380200529     C                   MOVEL     OADD1         DDRCO1                         CFT014
016390200529     C                   MOVEL     OADD2         DDRCO2                         CFT014
016400200529     C                   MOVEL     OADD3         DDRCO3                         CFT014
016410200529     C                   MOVEL     OADD4         DDRCO4                         CFT014
016420200529     C                   MOVEL     OADD5         DDRCO5                         CFT014
016430200529     C                   ENDIF                                                  CFT014
016440200529
016450200529     C     LINE1B        IFEQ      *ON
016460200529     C                   MOVEL     OADD1         DDBNC1
016470200529     C                   MOVEL     OADD2         DDBNC2
016480200529     C                   MOVEL     OADD3         DDBNC3
016490200529     C                   MOVEL     OADD4         DDBNC4
016500200529     C                   MOVEL     OADD5         DDBNC5
016510200529     C                   ENDIF
016520200529
016530200529     C     LINE2S        IFEQ      *ON
016540200529     C                   MOVEL     OADD1         DDSND2
016550200529     C                   MOVEL     OADD2         DDSND3
016560200529     C                   MOVEL     OADD3         DDSND4
016570200529     C                   ENDIF
016580200529      *                                                                         CFT014
016590200529     C     LINE2R        IFEQ      *ON                                          CFT014
016600200529     C                   MOVEL     OADD1         DDRCO2                         CFT014
016610200529     C                   MOVEL     OADD2         DDRCO3                         CFT014
016620200529     C                   MOVEL     OADD3         DDRCO4                         CFT014
016630200529     C                   MOVEL     OADD4         DDRCO5                         CFT014
016640200529     C                   ENDIF                                                  CFT014
016650200529
016660200529     C     LINE2B        IFEQ      *ON
016670200529     C                   MOVEL     OADD1         DDBNC2
016680200529     C                   MOVEL     OADD2         DDBNC3
016690200529     C                   MOVEL     OADD3         DDBNC4
016700200529     C                   MOVEL     OADD4         DDBNC5
016710200529     C                   ENDIF
016720200529
016730200529     C                   ENDIF
016740200529
016750200529     C                   ENDIF
016760200529
016770200529     C                   ENDSR
016780200529      *
016790200529      *****************************************************************
016800200529      /EJECT
016810200529      *****************************************************************
016820200529      *                                                               *
016830200529      *  SRBIC2 - Level 2 BIC processing                              *
016840200529      *                                                               *
016850200529      *****************************************************************
016860200529      *
016870200529     C     SRBIC2        BEGSR
016880200529      *
016890200529      ** Determine whether cursor is on an allowed field
016900200529      *
016910200529     C                   Z-ADD     PRowCol       WKSCPS
016920200529      *
016930200529      ** Note: If these screen fields move then these values will
016940200529      **       need changing.
016950200529      *
016960200529      **       The value is cursor row number * 256 + column number
016970200529      *
016980200529      ** Ordering institution line 1
016990200529      *
017000200529     C                   MOVE      *OFF          LIN1OI            1
017010200529     C     WScrn         IFEQ      'S'
017020200529     C     WKSCPS        ANDGE     1325
017030200529     C     WKSCPS        ANDLE     1359
017040200529     C                   MOVE      *ON           LIN1OI
017050200529     C                   ENDIF
017060200529      *
017070200529      ** Ordering institution line 2
017080200529      *
017090200529     C                   MOVE      *OFF          LIN2OI            1
017100200529     C     WScrn         IFEQ      'S'
017110200529     C     WKSCPS        ANDGE     1538
017120200529     C     WKSCPS        ANDLE     1572
017130200529     C                   MOVE      *ON           LIN2OI
017140200529     C                   ENDIF
017150200529      *
017160200529      ** Sender's correspondent line 1
017170200529      *
017180200529     C                   MOVE      *OFF          LIN1SC            1
017190200529     C     WScrn         IFEQ      'S'
017200200529     C     WKSCPS        ANDGE     2349
017210200529     C     WKSCPS        ANDLE     2383
017220200529     C                   MOVE      *ON           LIN1SC
017230200529     C                   ENDIF
017240200529      *
017250200529      ** Sender's correspondent line 2
017260200529      *
017270200529     C                   MOVE      *OFF          LIN2SC            1
017280200529     C     WScrn         IFEQ      'S'
017290200529     C     WKSCPS        ANDGE     2562
017300200529     C     WKSCPS        ANDLE     2596
017310200529     C                   MOVE      *ON           LIN2SC
017320200529     C                   ENDIF
017330200529      *
017340200529      ** Ordering Customer line 1
017350200529      *
017360200529     C                   MOVE      *OFF          LIN1OC            1
017370200529     C     WScrn         IFEQ      'S'
017380200529     C     WKSCPS        ANDGE     3373
017390200529     C     WKSCPS        ANDLE     3407
017400200529     C                   MOVE      *ON           LIN1OC
017410200529     C                   ENDIF
017420200529      *
017430200529      ** Ordering Customer line 2
017440200529      *
017450200529     C                   MOVE      *OFF          LIN2OC            1
017460200529     C     WScrn         IFEQ      'S'
017470200529     C     WKSCPS        ANDGE     3586
017480200529     C     WKSCPS        ANDLE     3620
017490200529     C                   MOVE      *ON           LIN2OC
017500200529     C                   ENDIF
017510200529      *
017520200529      ** Intermediary institution line 1
017530200529      *
017540200529     C                   MOVE      *OFF          LIN1II            1
017550200529     C     WScrn         IFEQ      'C'
017560200529     C*****WKSCPS        ANDGE     1069                                         CFT014
017570200529     C*****WKSCPS        ANDLE     1103                                         CFT014
017580200529     C     WKSCPS        ANDGE     1325                                         CFT014
017590200529     C     WKSCPS        ANDLE     1359                                         CFT014
017600200529     C                   MOVE      *ON           LIN1II
017610200529     C                   ENDIF
017620200529      *
017630200529      ** Intermediary institution line 2
017640200529      *
017650200529     C                   MOVE      *OFF          LIN2II            1
017660200529     C     WScrn         IFEQ      'C'
017670200529     C*****WKSCPS        ANDGE     1282                                         CFT014
017680200529     C*****WKSCPS        ANDLE     1316                                         CFT014
017690200529     C     WKSCPS        ANDGE     1538                                         CFT014
017700200529     C     WKSCPS        ANDLE     1572                                         CFT014
017710200529     C                   MOVE      *ON           LIN2II
017720200529     C                   ENDIF
017730200529      *
017740200529      ** If cursor is not on an allowed field, error
017750200529      *
017760200529     C     LIN1OI        IFNE      *ON
017770200529     C     LIN2OI        ANDNE     *ON
017780200529     C     LIN1SC        ANDNE     *ON
017790200529     C     LIN2SC        ANDNE     *ON
017800200529     C     LIN1OC        ANDNE     *ON
017810200529     C     LIN2OC        ANDNE     *ON
017820200529     C     LIN1II        ANDNE     *ON
017830200529     C     LIN2II        ANDNE     *ON
017840200529
017850200529     C                   MOVE      '*ANY'        FldNameArr(1)
017860200529     C                   MOVEL     'FTM2613'     MsgIdArr(1)
017870200529
017880200529     C                   ELSE
017890200529      *
017900200529      ** F4 and F16 are not allowed in Enquiry (and delete) mode
017910200529     C     DDACTN        IFEQ      'E'
017920200529
017930200529     C                   MOVE      '*ANY'        FldNameArr(1)
017940200529     C                   MOVEL     'FTM2619'     MsgIdArr(1)
017950200529
017960200529     C                   ELSE
017970200529      ** check indicators
017980200529      *
017990200529      ** In-line prompt or search mode, capture criteria from screen
018000200529      *
018010200529     C                   IF        PINKD = *ON OR PINKQ = *ON
018020200529
018030200529     C     LIN1OI        IFEQ      *ON
018040200529     C                   MOVE      DDOBK1        PICRIT
018050200529     C                   ENDIF
018060200529
018070200529     C     LIN2OI        IFEQ      *ON
018080200529     C                   MOVE      DDOBK2        PICRIT
018090200529     C                   ENDIF
018100200529
018110200529     C     LIN1SC        IFEQ      *ON
018120200529     C                   MOVE      DDSNC1        PICRIT
018130200529     C                   ENDIF
018140200529
018150200529     C     LIN2SC        IFEQ      *ON
018160200529     C                   MOVE      DDSNC2        PICRIT
018170200529     C                   ENDIF
018180200529
018190200529     C     LIN1OC        IFEQ      *ON
018200200529     C                   MOVE      DDORC1        PICRIT
018210200529     C                   ENDIF
018220200529
018230200529     C     LIN2OC        IFEQ      *ON
018240200529     C                   MOVE      DDORC2        PICRIT
018250200529     C                   ENDIF
018260200529
018270200529     C     LIN1II        IFEQ      *ON
018280200529     C                   MOVE      DDINB1        PICRIT
018290200529     C                   ENDIF
018300200529
018310200529     C     LIN2II        IFEQ      *ON
018320200529     C                   MOVE      DDINB2        PICRIT
018330200529     C                   ENDIF
018340200529      *
018350200529      ** In-line prompt mode
018360200529      *
018370200529     C                   IF        PINKD = *ON
018380200529     C                   MOVE      'P'           PIMODE
018390200529     C                   ENDIF
018400200529      *
018410200529      ** In-line search mode
018420200529      *
018430200529     C                   IF        PINKQ = *ON
018440200529     C                   MOVE      'F'           PIMODE
018450200529     C                   ENDIF
018460200529
018470200529     C                   ENDIF
018480200529      *
018490200529      ** Call BIC Plus enquiry program
018500200529      *
018510200529     C                   CALL      'FT0900'
018520200529     C                   PARM                    PIMODE
018530200529     C                   PARM                    PICRIT
018540200529     C                   PARM      *BLANKS       POADD
018550200529     C                   PARM      *BLANKS       POCHIP
018560200529     C                   PARM      *BLANKS       POUTCD
018570200529     C                   PARM      *BLANKS       PRTCD
018580200529     C                   MOVEL     *BLANKS       PICRIT
018590200529      *
018600200529      ** F3 pressed - exit program
018610200529      *
018620200529     C     PRTCD         IFEQ      'F3'
018630200529     C                   EXSR      SREndP
018640200529     C                   END
018650200529
018660200529     C     PRTCD         IFEQ      *BLANKS
018670200529      *
018680200529      ** If a CHIPS code exists and relevant currency is USD, replace
018690200529      ** clearing code with CHIPS code
018700200529      *
018710200529     C     POCHIP        IFNE      *BLANKS
018720200529     C     POUTCD        ANDNE     'AC'
018730200529      *
018740200529      ** Check payment currency against SDTRAD US dollar code
018750200529      *
018760200529     C     DDSMCY        IFEQ      BLUSCY
018770200529     C     LIN1OI        ANDEQ     *ON
018780200529     C     DDSMCY        OREQ      BLUSCY
018790200529     C     LIN1SC        ANDEQ     *ON
018800200529     C     DDSMCY        OREQ      BLUSCY
018810200529     C     LIN1OC        ANDEQ     *ON
018820200529     C     DDPCCY        OREQ      BLUSCY
018830200529     C     LIN1II        ANDEQ     *ON
018840200529      *
018850200529      ** If clearing code is not present, move details down to
018860200529      ** create space for CHIPS code
018870200529      *
018880200529     C     POUTCD        IFNE      'BC'
018890200529     C     POUTCD        ANDNE     'DC'
018900200529     C                   MOVE      POADD         WKADD1          210
018910200529     C                   MOVEL     WKADD1        POADD
018920200529     C                   ENDIF
018930200529
018940200529     C                   MOVEL     *BLANKS       WKCOCH           14
018950200529     C                   MOVEL     '//CH'        WKCOCH
018960200529     C                   MOVE      POCHIP        WKCOCH
018970200529     C                   MOVEL     WKCOCH        OADD1
018980200529     C                   ENDIF
018990200529
019000200529     C                   ENDIF
019010200529      *
019020200529      ** If command key pressed on 2nd line, remove clearing
019030200529      ** code from details
019040200529      *
019050200529     C     LIN2OI        IFEQ      *ON
019060200529     C     POUTCD        ANDEQ     'BC'
019070200529     C     LIN2OI        OREQ      *ON
019080200529     C     POUTCD        ANDEQ     'DC'
019090200529     C     LIN2SC        OREQ      *ON
019100200529     C     POUTCD        ANDEQ     'BC'
019110200529     C     LIN2SC        OREQ      *ON
019120200529     C     POUTCD        ANDEQ     'DC'
019130200529     C     LIN2OC        OREQ      *ON
019140200529     C     POUTCD        ANDEQ     'BC'
019150200529     C     LIN2OC        OREQ      *ON
019160200529     C     POUTCD        ANDEQ     'DC'
019170200529     C     LIN2II        OREQ      *ON
019180200529     C     POUTCD        ANDEQ     'BC'
019190200529     C     LIN2II        OREQ      *ON
019200200529     C     POUTCD        ANDEQ     'DC'
019210200529     C     POUTCD        OREQ      'AC'
019220200529     C                   MOVE      POADD         WKADD2          140
019230200529     C                   MOVE      *BLANKS       POADD
019240200529     C                   MOVEL     WKADD2        POADD
019250200529     C                   ENDIF
019260200529      *
019270200529      ** Move details to screen
019280200529      *
019290200529     C     LIN1OI        IFEQ      *ON
019300200529     C                   MOVEL     OADD1         DDOBK1
019310200529     C                   MOVEL     OADD2         DDOBK2
019320200529     C                   MOVEL     OADD3         DDOBK3
019330200529     C                   MOVEL     OADD4         DDOBK4
019340200529     C                   MOVEL     OADD5         DDOBK5
019350200529     C                   ENDIF
019360200529
019370200529     C     LIN1SC        IFEQ      *ON
019380200529     C                   MOVEL     OADD1         DDSNC1
019390200529     C                   MOVEL     OADD2         DDSNC2
019400200529     C                   MOVEL     OADD3         DDSNC3
019410200529     C                   MOVEL     OADD4         DDSNC4
019420200529     C                   MOVEL     OADD5         DDSNC5
019430200529     C                   ENDIF
019440200529
019450200529     C     LIN1OC        IFEQ      *ON
019460200529     C                   MOVEL     OADD1         DDORC1
019470200529     C                   MOVEL     OADD2         DDORC2
019480200529     C                   MOVEL     OADD3         DDORC3
019490200529     C                   MOVEL     OADD4         DDORC4
019500200529     C*****              MOVEL     OADD5         DDORC5                         CFT014
019510200529     C                   EVAL      DDORC5 = OADD5                                             CFT032
019520200529     C                   ENDIF
019530200529
019540200529     C     LIN1II        IFEQ      *ON
019550200529     C                   MOVEL     OADD1         DDINB1
019560200529     C                   MOVEL     OADD2         DDINB2
019570200529     C                   MOVEL     OADD3         DDINB3
019580200529     C                   MOVEL     OADD4         DDINB4
019590200529     C                   MOVEL     OADD5         DDINB5
019600200529     C                   ENDIF
019610200529
019620200529     C     LIN2OI        IFEQ      *ON
019630200529     C                   MOVEL     OADD1         DDOBK2
019640200529     C                   MOVEL     OADD2         DDOBK3
019650200529     C                   MOVEL     OADD3         DDOBK4
019660200529     C                   MOVEL     OADD4         DDOBK5
019670200529     C                   ENDIF
019680200529
019690200529     C     LIN2SC        IFEQ      *ON
019700200529     C                   MOVEL     OADD1         DDSNC2
019710200529     C                   MOVEL     OADD2         DDSNC3
019720200529     C                   MOVEL     OADD3         DDSNC4
019730200529     C                   MOVEL     OADD4         DDSNC5
019740200529     C                   ENDIF
019750200529
019760200529     C     LIN2OC        IFEQ      *ON
019770200529     C                   MOVEL     OADD1         DDORC2
019780200529     C                   MOVEL     OADD2         DDORC3
019790200529     C                   MOVEL     OADD3         DDORC4
019800200529     C*****              MOVEL     OADD4         DDORC5                         CFT014
019810200529     C                   EVAL      DDORC5 = OADD4                                             CFT032
019820200529     C                   ENDIF
019830200529
019840200529     C     LIN2II        IFEQ      *ON
019850200529     C                   MOVEL     OADD1         DDINB2
019860200529     C                   MOVEL     OADD2         DDINB3
019870200529     C                   MOVEL     OADD3         DDINB4
019880200529     C                   MOVEL     OADD4         DDINB5
019890200529     C                   ENDIF
019900200529
019910200529     C                   ENDIF
019920200529
019930200529     C                   ENDIF
019940200529
019950200529     C                   ENDIF
019960200529
019970200529     C                   ENDSR
019980200529      *
019990200529      *****************************************************************
020000200529      /EJECT
020010200529      *****************************************************************
020020200529      *                                                               *
020030200529      *  SRScrn_I - Process Initial Screen                            *
020040200529      *                                                               *
020050200529      *****************************************************************
020060200529      *
020070200529     C     SRScrn_I      BEGSR
020080200529     C/COPY WNCPYSRC,FTIPAYSC21
020090200529      *
020100200529      ** If Windows processing is on, clear any possible updates
020110200529      ** in Window function.
020120200529      *
020130200529     C     BGWDPR        IFEQ      'Y'
020140200529      **                                                                                      CSC022
020150200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
020160200529      **   job is not currently running in batch mode                                         CSC022
020170200529      **                                                                                      CSC022
020180200529     C                   If        CSC022 = 'N'                                               CSC022
020190200529     C                   ROLBK
020200200529     C                   Else                                                                 CSC022
020210200529     C                   If        WSkpComtRolbk = 'N'                                        CSC022
020220200529     C                   RolBk                                                                CSC022
020230200529     C                   Else                                                                 CSC022
020240200529     C                   SetOn                                        U7U8                    CSC022
020250200529     C                   EndIf                                                                CSC022
020260200529     C                   EndIf                                                                CSC022
020270200529     C                   ENDIF
020280200529      *
020290200529      ** Incoming Payments Maintenance has been called by linked
020300200529      ** maintenance/enquiry.
020310200529      *
020320200529     C     PParmLink     IFEQ      'Y'
020330200529      *
020340200529      ** Protect screen fields.  Also, disable F7=Read Previous,
020350200529      ** F8=Read Next and F15=Browse.
020360200529      *
020370200529     C                   MOVEL     'N'           PEDTKEY
020380200529     C                   MOVEL     'N'           PEINKG
020390200529     C                   MOVEL     'N'           PEINKH
020400200529     C                   MOVEL     'N'           PEINKP
020410200529      *
020420200529      ** If Incoming Payments Maintenance has been called from a Subfile
020430200529      ** program, enable F18=Next Payment.
020440200529      *
020450200529     C     PLinkPgm      IFNE      'GL4442    '
020460200529     C     PLinkPgm      ANDNE     'GL0090    '
020470200529     C                   MOVEL     'Y'           PEINKS
020480200529     C                   ELSE
020490200529     C                   MOVEL     'N'           PEINKS
020500200529     C                   ENDIF
020510200529      *
020520200529     C                   ELSE
020530200529      *
020540200529     C                   MOVEL     'Y'           PEDTKEY
020550200529     C                   MOVEL     'Y'           PEINKG
020560200529     C                   MOVEL     'Y'           PEINKH
020570200529     C                   MOVEL     'Y'           PEINKP
020580200529     C                   MOVEL     'N'           PEINKS
020590200529      *
020600200529     C                   ENDIF
020610200529      *
020620200529      ** Display Initial screen.
020630200529      *
020640200529     C     PParmLevel    IFEQ      '1'
020650200529      *
020660200529      ** Entry is Level 1 Maintenance.
020670200529      *
020680200529     C                   CALLB     'FTIPAYIDP'
020690200529      *                             =========
020700200529      ** INPUT
020710200529      ** =====
020720200529      *
020730200529      ** Return Code
020740200529     C                   PARM      *BLANKS       RetCodeOut
020750200529      *
020760200529      ** Action Code
020770200529     C                   PARM                    DDACTN
020780200529      *
020790200529      ** Payment Reference
020800200529     C                   PARM                    DDPREF
020810200529      *
020820200529      ** Booking Branch
020830200529     C                   PARM                    DDBRCA
020840200529      *
020850200529      ** SWIFT Reference
020860200529     C                   PARM                    DDSWTN           28
020870200529      *
020880200529      ** Sequence Number
020890200529     C                   PARM                    DDSEQNO           2
020900200529      *
020910200529      ** Enable Screen Fields
020920200529     C                   PARM                    PEDTKEY           1
020930200529      *
020940200529      ** Enable Function Keys
020950200529      ** KG = Command Key 07 = Read Previous
020960200529      ** KH = Command Key 08 = Read Next
020970200529      ** KP = Command Key 15 = Browse
020980200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
020990200529     C                   PARM                    PEINKG            1
021000200529     C                   PARM                    PEINKH            1
021010200529     C                   PARM                    PEINKP            1
021020200529     C                   PARM                    PEINKS            1
021030200529      *
021040200529      ** OK Action Code
021050200529     C                   PARM                    OKACTN
021060200529      *
021070200529      ** OK Payment Reference
021080200529     C                   PARM                    OKPREF
021090200529      *
021100200529      ** OK Branch Code
021110200529     C                   PARM                    OKBRCA
021120200529      *
021130200529      ** OK SWIFT Reference
021140200529     C                   PARM                    OKSWTN            1
021150200529      *
021160200529      ** OK Sequence Number
021170200529     C                   PARM                    OKSEQNO           1
021180200529      *
021190200529      ** Error fields/message IDs/message data (arrays) from/to caller
021200200529     C                   PARM                    FldNameArr
021210200529     C                   PARM                    MsgIdArr
021220200529     C                   PARM                    MsgDtaArr
021230200529      *
021240200529      ** Warning fields/message Ids/message data (arrays) from/to
021250200529      ** caller
021260200529     C                   PARM                    WFldNamArr
021270200529     C                   PARM                    WMsgIdArr
021280200529     C                   PARM                    WMsgDtaArr
021290200529      *
021300200529      ** STANDING DATA
021310200529      ** =============
021320200529      *
021330200529      ** SDBANK - System Runday
021340200529     C                   PARM                    BJMRDT
021350200529      *
021360200529      ** SDBANK - Single Branch Code
021370200529     C                   PARM                    BJSBRC
021380200529      *
021390200529      ** OUTPUT
021400200529      ** ======
021410200529      *
021420200529      ** Function Keys Enabled
021430200529      ** KC = Command Key 03 = Exit
021440200529      ** KG = Command Key 07 = Read Previous
021450200529      ** KH = Command Key 08 = Read Next
021460200529      ** KL = Command Key 12 = Cancel
021470200529      ** KP = Command Key 15 = Browse
021480200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
021490200529     C                   PARM                    PINKC
021500200529     C                   PARM                    PINKG
021510200529     C                   PARM                    PINKH
021520200529     C                   PARM                    PINKL
021530200529     C                   PARM                    PINKP
021540200529     C                   PARM                    PINKS
021550200529      *
021560200529     C                   ELSE
021570200529      *
021580200529      ** Entry is Level 2 Maintenance.
021590200529      *
021600200529     C                   CALLB     'FTIPAYSDP'
021610200529      *                             =========
021620200529      ** INPUT
021630200529      ** =====
021640200529      *
021650200529      ** Return Code
021660200529     C                   PARM      *BLANKS       RetCodeOut
021670200529      *
021680200529      ** Action Code
021690200529     C                   PARM                    DDACTN
021700200529      *
021710200529      ** Payment Reference
021720200529     C                   PARM                    DDPREF
021730200529      *
021740200529      ** Enable Screen Fields
021750200529     C                   PARM                    PEDTKEY
021760200529      *
021770200529      ** Enable Function Keys
021780200529      ** KG = Command Key 07 = Read Previous
021790200529      ** KH = Command Key 08 = Read Next
021800200529      ** KP = Command Key 15 = Browse
021810200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
021820200529     C                   PARM                    PEINKG
021830200529     C                   PARM                    PEINKH
021840200529     C                   PARM                    PEINKP
021850200529     C                   PARM                    PEINKS
021860200529      *
021870200529      ** OK Action Code
021880200529     C                   PARM                    OKACTN
021890200529      *
021900200529      ** OK Payment Reference
021910200529     C                   PARM                    OKPREF
021920200529      *
021930200529      ** Error fields/message IDs/message data (arrays) from/to caller
021940200529     C                   PARM                    FldNameArr
021950200529     C                   PARM                    MsgIdArr
021960200529     C                   PARM                    MsgDtaArr
021970200529      *
021980200529      ** Warning fields/message Ids/message data (arrays) from/to
021990200529      ** caller
022000200529     C                   PARM                    WFldNamArr
022010200529     C                   PARM                    WMsgIdArr
022020200529     C                   PARM                    WMsgDtaArr
022030200529      *
022040200529      ** STANDING DATA
022050200529      ** =============
022060200529      *
022070200529      ** SDBANK - System Runday
022080200529     C                   PARM                    BJMRDT
022090200529      *
022100200529      ** OUTPUT
022110200529      ** ======
022120200529      *
022130200529      ** Function Keys Enabled
022140200529      ** KC = Command Key 03 = Exit
022150200529      ** KG = Command Key 07 = Read Previous
022160200529      ** KH = Command Key 08 = Read Next
022170200529      ** KL = Command Key 12 = Cancel
022180200529      ** KP = Command Key 15 = Browse
022190200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
022200200529     C                   PARM                    PINKC
022210200529     C                   PARM                    PINKG
022220200529     C                   PARM                    PINKH
022230200529     C                   PARM                    PINKL
022240200529     C                   PARM                    PINKP
022250200529     C                   PARM                    PINKS
022260200529      *
022270200529     C                   ENDIF
022280200529      *
022290200529      ** Reset error fields.
022300200529      *
022310200529     C                   EXSR      SRResetErr
022320200529     C                   MOVEL     *BLANKS       WTRCT                                        226722
022330200529      *
022340200529     C                   SELECT
022350200529      *
022360200529      ** F3 - end program.
022370200529      *
022380200529     C     PINKC         WHENEQ    *ON
022390200529     C                   EXSR      SREndP
022400200529      *
022410200529      ** F7 - roll backwards.
022420200529      *
022430200529     C     PINKG         WHENEQ    *ON
022440200529     C                   EXSR      SRRoll
022450200529      *
022460200529      ** F8 - roll forwards.
022470200529      *
022480200529     C     PINKH         WHENEQ    *ON
022490200529     C                   EXSR      SRRoll
022500200529      *
022510200529      ** F12 - cancel.
022520200529      *
022530200529     C     PINKL         WHENEQ    *ON
022540200529      *
022550200529      ** If Incoming Payments Maintenance has been called by
022560200529      ** linked maintenance/enquiry, terminate program.
022570200529      *
022580200529     C     PParmLink     IFEQ      'Y'
022590200529      *
022600200529     C                   MOVEL     '5'           PParmRtcd
022610200529     C                   MOVEL     'T'           WScrn
022620200529      *
022630200529     C                   ELSE
022640200529      *
022650200529      ** Otherwise, display Initial screen with blank fields.
022660200529      ** Release all electronic messages that are reserved for
022670200529      ** this job and reset Read Next Browse Subfile Record
022680200529      ** indicator.
022690200529      *
022700200529     C     WEMSG         IFEQ      'Y'
022710200529     C                   EXSR      SRMsgEnd
022720200529     C                   ENDIF
022730200529      *
022740200529     C                   MOVEL     *BLANK        PRDNB
022750200529     C                   MOVEL     *BLANKS       DDACTN
022760200529     C                   MOVEL     *BLANKS       DDPREF
022770200529     C                   MOVEL     *BLANKS       DDSWTN
022780200529     C                   MOVEL     *BLANKS       DDSEQNO
022790200529     C                   MOVEL     *BLANKS       DDBRCA
022800200529     C                   MOVEL     'I'           WScrn
022810200529      *                                                                                       261468
022820200529      ** Call CL program to deallocate this reference to a dataarea                           261468
022830200529      *                                                                                       261468
022840200529     C                   EVAL      C#RTCD = *Blanks                                           261468
022850200529     C                   EVAL      @MODLE = 'FT'                                              261468
022860200529     C                   EVAL      @TREF  = *Blanks                                           261468
022870200529     C                   EVAL      @RTINF = *Blanks                                           261468
022880200529      *                                                                                       261468
022890200529     C                   CALL      'AOC8000'                                                  261468
022900200529     C                   PARM                    C#RTCD            7                          261468
022910200529     C                   PARM                    @MODLE            2                          261468
022920200529     C                   PARM                    @TREF            15                          261468
022930200529     C                   PARM                    @RTINF           80                          261468
022940200529      *                                                                                       261468
022950200529      ** Reduce PREF sequence number if it was incremented.                                   261468
022960200529      *                                                                                       261468
022970200529     C                   IF        FirstTime <> 'Y'                                           261468
022980200529      *                                                                                       261468
022990200529      ** Reduce Sequence number in DTAARA as number is not being used                         261468
023000200529      *                                                                                       261468
023010200529     C     *LOCK         IN        WINPAY                                                     261468
023020200529     C                   IF        CFT151 = 'N'                                               CFT151
023030200529      *                                                                                       261468
023040200529      ** Check to see if another pref has been generated by another                           261468
023050200529      ** function                                                                             261468
023060200529      *                                                                                       261468
023070200529     C                   Z-ADD     WWINSQ        svnum             4 0                        261468
023080200529     C                   EVAL      svnum = svnum + 1                                          261468
023090200529     C                   IF        svnum = WINSQ                                              261468
023100200529      *                                                                                       261468
023110200529      ** No new reference has been generated - so reduce sequence                             261468
023120200529      ** number on data area                                                                  261468
023130200529      *                                                                                       261468
023140200529     C                   SUB       1             WINSQ                                        261468
023150200529      *                                                                                       261468
023160200529      ** Ensure PREF is generated again if entering a new payment after                       261468
023170200529      ** cancel                                                                               261468
023180200529      *                                                                                       261468
023190200529     C                   EVAL      FirstTime = 'Y'                                            261468
023200200529     C                   ELSE                                                                 261468
023210200529      *                                                                                       261468
023220200529      ** If another number has been generated, the current payment                            261468
023230200529      ** reference only if the program is exited, otherwise the pref is                       261468
023240200529      ** re-used.                                                                             261468
023250200529      *                                                                                       261468
023260200529     C                   ENDIF                                                                261468
023270200529     C                   OUT       WINPAY                                                     261468
023280200529     C                   ELSE                                                                 CFT151
023290200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
023300200529     C                   CALL      'FT000328'                                                 CFT151
023310200529     C                   PARM                    PRTCD                                        CFT151
023320200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
023330200529     C                   PARM      'A'           WCALC                                        CFT151
023340200529     C                   PARM      'N'           WUPD              1                          CFT151
023350200529     C                   PARM                    svalph                                       CFT151
023360200529     C                   PARM                    WNEWSQ                                       CFT151
023370200529     C                   if        WNEWSQ = WINPAY                                            CFT151
023380200529     C                   CALL      'FT000328'                                                 CFT151
023390200529     C                   PARM                    PRTCD                                        CFT151
023400200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
023410200529     C                   PARM      'S'           WCALC                                        CFT151
023420200529     C                   PARM      'Y'           WUPD                                         CFT151
023430200529     C                   PARM                    svalph                                       CFT151
023440200529     C                   PARM                    WNEWSQ                                       CFT151
023450200529     C                   ENDIF                                                                CFT151
023460200529     C                   ENDIF                                                                CFT151
023470200529      *                                                                                       261468
023480200529      ** Reset FirstTime field so new pref is generated if required.                          261468
023490200529      *                                                                                       261468
023500200529     C                   EVAL      FirstTime = 'Y'                                            261468
023510200529     C                   ENDIF                                                                261468
023520200529      *
023530200529     C                   ENDIF
023540200529      *
023550200529      ** F15 - build Browse.
023560200529      *
023570200529     C     PINKP         WHENEQ    *ON
023580200529     C                   EXSR      SRBldBrw
023590200529      *
023600200529      ** F18 - next Payment.  Read next subfile record in linked
023610200529      ** maintenance/enquiry.
023620200529      *
023630200529     C     PINKS         WHENEQ    *ON
023640200529     C                   MOVEL     '7'           PParmRtcd
023650200529     C                   MOVEL     'T'           WScrn
023660200529      *
023670200529      ** Enter key was pressed.  Validate input to Initial screen.
023680200529      *
023690200529     C                   OTHER
023700200529     C                   EXSR      SRVal_I
023710200529      *
023720200529     C                   ENDSL
023730200529      *
023740200529     C                   ENDSR
023750200529      *
023760200529      *****************************************************************
023770200529      /EJECT
023780200529      *****************************************************************
023790200529      *                                                               *
023800200529      *  SRVal_I - Validate input to Initial screen                   *
023810200529      *                                                               *
023820200529      *****************************************************************
023830200529      *
023840200529     C     SRVal_I       BEGSR
023850200529      *
023860200529      ** Validate key fields and retrieve Incoming Payment details.
023870200529      *
023880200529     C                   EXSR      SRRtvPref
023890200529      *
023900200529      ** If Incoming Payments Maintenance has been called from
023910200529      ** Account Movements Enquiry or from Account Postings
023920200529      ** Enquiry, and no record was read from Incoming Payments
023930200529      ** file, terminate program with error.
023940200529      *
023950200529     C     PLinkPgm      IFEQ      'GL4442    '
023960200529     C     RECI          ANDEQ     *BLANK
023970200529     C     PLinkPgm      OREQ      'GL0090    '
023980200529     C     RECI          ANDEQ     *BLANK
023990200529      *
024000200529     C                   MOVEL     'E'           PParmRtcd
024010200529     C                   MOVEL     'T'           WScrn
024020200529     C                   GOTO      EVal_I
024030200529      *
024040200529     C                   ENDIF
024050200529      *
024060200529      ** Move Incoming Payment details retrieved from the master
024070200529      ** database file into the update file record.  If no
024080200529      ** record has been retrieved (like in Insert), fields
024090200529      ** contain initial values.
024100200529      *
024110200529     C                   MOVEL     CrIPFilFmt    NwIPFilFmt
024120200529     C                   IF        (CFT003 = 'Y')                               CFT014
024130200529     C                             OR (CFT014 = 'Y')                            CFT014
024140200529     C                             OR CFT009 = 'Y'                              CFT009
024150200529     C                   MOVEL     CrIP2FilFmt   NwIP2FilFmt                    CFT014
024160200529     C                   ELSE                                                                BUG7101
024170200529     C                   CLEAR                   NwIP2FilFmt                                 BUG7101
024180200529     C                   ENDIF                                                  CFT014
024190200529      *
024200200529      ** If entry point is Level 1 Maintenance, validate non-key
024210200529      ** fields on Initial screen.
024220200529      *
024230200529     C     PParmLevel    IFEQ      '1'
024240200529      *
024250200529     C                   CALLB     'FTIPAYIVL'
024260200529      *                             =========
024270200529      ** INPUT
024280200529      ** =====
024290200529      *
024300200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
024310200529      ** Mode = '      ' (Not Front Office Transaction Interface)
024320200529      ** Mode = '*RPR  ' (Repair Function)
024330200529      ** Mode = '*SIN  ' (Screen Input Function)
024340200529     C                   PARM                    PMode
024350200529      *
024360200529      ** Response Mode
024370200529     C                   PARM                    PResponse
024380200529      *
024390200529      ** SWIFT Reference
024400200529     C                   PARM                    DDSWTN
024410200529      *
024420200529      ** Sequence Number
024430200529     C                   PARM                    DDSEQNO
024440200529      *
024450200529      ** Booking Branch
024460200529     C                   PARM                    DDBRCA
024470200529      *
024480200529      ** Action Code
024490200529     C                   PARM                    DDACTN
024500200529      *
024510200529      ** OK Payment Reference
024520200529     C                   PARM                    OKPREF
024530200529      *
024540200529      ** Linked Program
024550200529     C                   PARM                    PLinkPgm
024560200529      *
024570200529      ** Incoming Payments retrieved from file - file format
024580200529     C                   PARM                    CrIPFilFmt
024590200529      *
024600200529      ** Incoming Payments extra data
024610200529     C                   PARM                    PExtData
024620200529     C/COPY WNCPYSRC,FTH00362
024630200529      *
024640200529      ** STANDING DATA
024650200529      ** =============
024660200529      *
024670200529      ** SDBANK - Single Branch Code
024680200529     C                   PARM                    BJSBRC
024690200529      *
024700200529      ** SDMMOD - Multibranch Indicator
024710200529     C                   PARM                    BGMBIN
024720200529      *
024730200529      ** ZMUSER - Default Branch
024740200529     C                   PARM                    PDBRN
024750200529      *
024760200529      ** OUTPUT
024770200529      ** ======
024780200529      *
024790200529      ** Error fields/message IDs/message data (arrays) from/to caller
024800200529     C                   PARM                    FldNameArr
024810200529     C                   PARM                    MsgIdArr
024820200529     C                   PARM                    MsgDtaArr
024830200529      *
024840200529      ** Array index (3P0) from/to caller
024850200529     C                   PARM                    IDx
024860200529      *
024870200529      ** Warning flds/message IDs/message data (arrays) from/to caller
024880200529     C                   PARM                    WFldNamArr
024890200529     C                   PARM                    WMsgIdArr
024900200529     C                   PARM                    WMsgDtaArr
024910200529      *
024920200529      ** Array index (3P0) from/to caller
024930200529     C                   PARM                    WIDx
024940200529      *
024950200529      ** OK Action Code
024960200529     C                   PARM                    OKACTN
024970200529      *
024980200529      ** OK SWIFT Reference
024990200529     C                   PARM                    OKSWTN
025000200529      *
025010200529      ** OK Sequence No.
025020200529     C                   PARM                    OKSEQNO
025030200529      *
025040200529      ** OK Booking Branch
025050200529     C                   PARM                    OKBRCA
025060200529      *
025070200529      ** Incoming Payments for file update - file format
025080200529     C                   PARM                    NwIPFilFmt
025090200529      *
025100200529     C                   ENDIF
025110200529      *
025120200529      ** Errors occurred during retrieval of Incoming Payment details
025130200529      ** and in the validation of Initial screen fields.
025140200529      *
025150200529     C     IDx           IFNE      *ZERO
025160200529     C                   GOTO      EVal_I
025170200529     C                   ENDIF
025180200529      *
025190200529      ** Action Code is Insert and entry point is Level 1
025200200529      ** Maintenance.
025210200529      *
025220200529     C     DDACTN        IFEQ      'I'
025230200529     C     PParmLevel    ANDEQ     '1'
025240200529      *
025250200529      ** Initialise screen formats.
025260200529      *
025270200529     C                   EXSR      SRInScn
025280200529      *
025290200529      ** Load SWIFT details to the screen if SWIFT Reference has
025300200529      ** been entered or SWIFT Reference has been passed from
025310200529      ** linked maintenance/enquiry.
025320200529      *
025330200529     C     DDSWTN        IFNE      *BLANKS
025340200529     C     PParmPref     ORNE      *BLANKS
025350200529      *
025360200529     C     WNOCLEAR      IFNE      'Y'
025370200529     C                   MOVE      *BLANK        WEMSG             1
025380200529     C                   ENDIF
025390200529     C                   MOVE      ' '           WNOCLEAR
025400200529      *
025410200529     C                   EXSR      SREISwft
025420200529      *
025430200529      ** If there are errors in SWIFT validation, redisplay
025440200529      ** Initial screen, or terminate program if F3 has been
025450200529      ** pressed.
025460200529      *
025470200529     C     WEMSG         IFNE      'Y'
025480200529     C                   MOVEL     'I'           WScrn
025490200529     C                   GOTO      EVal_I
025500200529     C                   ENDIF
025510200529      *
025520200529     C                   ENDIF
025530200529      *
025540200529      ** Process Level 1 screen.
025550200529      *
025560200529     C                   MOVEL     'P'           WScrn
025570200529      *
025580200529      ** Else, Action is not Insert or entry point is Level 2.
025590200529      *
025600200529     C                   ELSE
025610200529      *
025620200529      ** Put Incoming Payment details on the screen.
025630200529      *
025640200529     C                   EXSR      SRPutRef
025650200529      *
025660200529      ** If entry point is Level 1 Maintenance, process Level 1
025670200529      ** screen.  Otherwise, process Level 2 screen 1.
025680200529      *
025690200529     C     PParmLevel    IFEQ      '1'
025700200529      *
025710200529     C                   MOVE      'P'           WScrn
025720200529      *
025730200529     C                   ELSE
025740200529      *
025750200529     C                   MOVE      'S'           WScrn
025760200529      *
025770200529      ** Set up Charges Branch.
025780200529      *
025790200529     C     BJSBRC        IFNE      *BLANKS
025800200529     C                   EVAL      PPYBR = BJSBRC
025810200529     C                   ELSE
025820200529     C     BKOBRU        IFEQ      'Y'
025830200529     C                   EVAL      PPYBR = IPORBR
025840200529     C                   ELSE
025850200529     C                   EVAL      PPYBR = IPBRCA
025860200529     C                   ENDIF
025870200529     C                   ENDIF
025880200529      *
025890200529      ** If Action is Insert, or Action is Amend and Level 2
025900200529      ** details have not been entered, default Transfer
025910200529      ** Commission Tariff based on Charges Branch.
025920200529      *
025930200529     C     DDACTN        IFEQ      'I'
025940200529     C     DDACTN        OREQ      'A'
025950200529     C     INLVL2        ANDNE     'Y'
025960200529     C     PPYBR         CHAIN     PYCHGDB                            01
025970200529     C     *IN01         IFEQ      *OFF
025980200529     C                   EVAL      DDTRCT = PYDFTRCT
025990200529     C     WTRCT         IFNE      *BLANKS                                                    226722
026000200529     C                   EVAL      DDTRCT = WTRCT                                             226722
026010200529     C                   ENDIF                                                                226722
026020200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
026030200529     C                   ENDIF
026040200529     C                   ENDIF
026050200529      *
026060200529     C                   ENDIF
026070200529      *
026080200529     C                   ENDIF
026090200529      *
026100200529     C     EVal_I        ENDSR
026110200529      *
026120200529      *****************************************************************
026130200529      /EJECT
026140200529      *****************************************************************
026150200529      *                                                               *
026160200529      *  SRScrn_P - Process Level 1 screen                            *
026170200529      *                                                               *
026180200529      *****************************************************************
026190200529      *
026200200529     C     SRScrn_P      BEGSR
026210200529      *
026220200529      ** Windows processing is on.
026230200529      *
026240200529     C     BGWDPR        IFEQ      'Y'
026250200529      *
026260200529      ** If Action Code and Payment Reference have changed,
026270200529      ** clear any possible updates in Window function.
026280200529      *
026290200529     C     DDACTN        IFNE      WDDACTN
026300200529     C     DDPREF        ORNE      WDDPREF
026310200529      **                                                                                      CSC022
026320200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
026330200529      **   job is not currently running in batch mode                                         CSC022
026340200529      **                                                                                      CSC022
026350200529     C                   If        CSC022 = 'N'                                               CSC022
026360200529     C                   ROLBK
026370200529     C                   Else                                                                 CSC022
026380200529     C                   If        WSkpComtRolbk = 'N'                                        CSC022
026390200529     C                   Rolbk                                                                CSC022
026400200529     C                   Else                                                                 CSC022
026410200529     C                   SetOn                                        U7U8                    CSC022
026420200529     C                   EndIf                                                                CSC022
026430200529     C                   EndIf                                                                CSC022
026440200529     C                   ENDIF
026450200529      *
026460200529      ** Save Action Code and Payment Reference.
026470200529      *
026480200529     C                   MOVEL     DDACTN        WDDACTN           1
026490200529     C                   MOVEL     DDPREF        WDDPREF          15
026500200529      *
026510200529     C                   ENDIF
026520200529      *
026530200529      ** If Action Code is Insert or Amend, enable Detail
026540200529      ** fields on Level 1 screen (all fields on Level 1
026550200529      ** screen except Initial screen fields: Action Code,
026560200529      ** Payment Reference, SWIFT Reference, Sequence Number
026570200529      ** and Booking Branch).  Also, enable F5=Refresh.
026580200529      *
026590200529     C     DDACTN        IFEQ      'I'
026600200529     C     DDACTN        OREQ      'A'
026610200529     C                   MOVEL     'Y'           PEDTFLD
026620200529     C                   MOVEL     'Y'           PEINKE
026630200529     C                   ELSE
026640200529     C                   MOVEL     'N'           PEDTFLD
026650200529     C                   MOVEL     'N'           PEINKE
026660200529     C                   ENDIF
026670200529      *
026680200529      ** Incoming Payments Maintenance has been called by linked
026690200529      ** maintenance/enquiry.
026700200529      *
026710200529     C     PParmLink     IFEQ      'Y'
026720200529      *
026730200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.
026740200529      *
026750200529     C                   MOVEL     'N'           PEINKG
026760200529     C                   MOVEL     'N'           PEINKH
026770200529     C                   MOVEL     'N'           PEINKP
026780200529      *
026790200529      ** If Incoming Payments Maintenance has been called from a Subfile
026800200529      ** program, enable F18=Next Payment.
026810200529      *
026820200529     C     PLinkPgm      IFNE      'GL4442    '
026830200529     C     PLinkPgm      ANDNE     'GL0090    '
026840200529     C                   MOVEL     'Y'           PEINKS
026850200529     C                   ELSE
026860200529     C                   MOVEL     'N'           PEINKS
026870200529     C                   ENDIF
026880200529      *
026890200529     C                   ELSE
026900200529      *
026910200529     C                   MOVEL     'Y'           PEINKG
026920200529     C                   MOVEL     'Y'           PEINKH
026930200529     C                   MOVEL     'Y'           PEINKP
026940200529     C                   MOVEL     'N'           PEINKS
026950200529      *
026960200529     C                   ENDIF
026970200529      *
026980200529      ** If Action is Delete, enable F10=Delete.
026990200529      *
027000200529     C     DDACTN        IFEQ      'D'
027010200529     C                   MOVE      'Y'           PEINKJ
027020200529     C                   ELSE
027030200529     C                   MOVE      'N'           PEINKJ
027040200529     C                   ENDIF
027050200529      *
027060200529      ** If Action is Enquire, enable F21=Additional Information.
027070200529      *
027080200529     C     DDACTN        IFEQ      'E'
027090200529     C                   MOVE      'Y'           PEINKV
027100200529     C                   ELSE
027110200529     C                   MOVE      'N'           PEINKV
027120200529     C                   ENDIF
027130200529      *
027140200529      ** If feature CFT007 is switched on and action is Insert or Amend,
027150200529      ** enable F4=Prompt and F16=Search
027160200529      *
027170200529     C                   IF        CFT007 = 'Y' AND
027180200529     C                             (DDACTN = 'I' OR DDACTN = 'A')
027190200529     C                   EVAL      PEINKD = 'Y'
027200200529     C                   EVAL      PEINKQ = 'Y'
027210200529     C                   ELSE
027220200529     C                   EVAL      PEINKD = 'N'
027230200529     C                   EVAL      PEINKQ = 'N'
027240200529     C                   ENDIF
027250200529      *
027260200529      ** Display Level 1 screen.
027270200529      *
027280200529     C                   CALLB     'FTIPAY1DP'
027290200529      *                             =========
027300200529      ** INPUT
027310200529      ** =====
027320200529      *
027330200529      ** Return Code
027340200529     C                   PARM      *BLANKS       RetCodeOut
027350200529      *
027360200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
027370200529      ** Mode = '      ' (Not Front Office Transaction Interface)
027380200529      ** Mode = '*RPR  ' (Repair Function)
027390200529      ** Mode = '*SIN  ' (Screen Input Function)
027400200529     C                   PARM                    PMode
027410200529      *
027420200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
027430200529      ** - screen format
027440200529     C                   PARM                    NwIP1ScnFmt
027450200529      *                                                                         CFT014
027460200529      ** Incoming Payments Lvl 1 Scrn 1/2 details from incoming trans.          CFT014
027470200529      ** - screen format                                                        CFT014
027480200529     C                   PARM                    NwIP1aScnFmt                   CFT014
027490200529      *
027500200529      ** DS for Additional Information details
027510200529     C                   PARM                    PAddInfm
027520200529      *
027530200529      ** SWIFT Reference
027540200529     C                   PARM                    DDSWTN
027550200529      *
027560200529      ** Sequence No.
027570200529     C                   PARM                    DDSEQNO
027580200529      *
027590200529      ** Incoming Payment Status
027600200529     C                   PARM                    PStatus
027610200529      *
027620200529      ** Payment Type
027630200529     C                   PARM                    PPYTP
027640200529      *
027650200529      ** Display Additional Information Screen Indicator
027660200529     C                   PARM      'N'           PAddInfo          1
027670200529      *
027680200529      ** Enable Detail Fields Indicator
027690200529     C                   PARM                    PEDTFLD           1
027700200529      *
027710200529      ** Enable Function Keys
027720200529      ** KD = Command Key 04 = Prompt
027730200529      ** KE = Command Key 05 = Refresh
027740200529      ** KG = Command Key 07 = Read Previous
027750200529      ** KH = Command Key 08 = Read Next
027760200529      ** KJ = Command Key 10 = Delete
027770200529      ** KP = Command Key 15 = Browse
027780200529      ** KQ = Command Key 16 = Search
027790200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
027800200529      ** KV = Command Key 21 = Additional Information Window
027810200529     C                   PARM                    PEINKD            1
027820200529     C                   PARM                    PEINKE            1
027830200529     C                   PARM                    PEINKG            1
027840200529     C                   PARM                    PEINKH            1
027850200529     C                   PARM                    PEINKJ            1
027860200529     C                   PARM                    PEINKP            1
027870200529     C                   PARM                    PEINKQ            1
027880200529     C                   PARM                    PEINKS            1
027890200529     C                   PARM                    PEINKV            1
027900200529      *
027910200529      ** Incoming Payments Lvl 1 Scrn error indicators
027920200529     C                   PARM                    FTEIPY1
027930200529      *
027940200529      ** Error fields/message IDs/message data (arrays) from/to caller
027950200529     C                   PARM                    FldNameArr
027960200529     C                   PARM                    MsgIdArr
027970200529     C                   PARM                    MsgDtaArr
027980200529      *
027990200529      ** Warning fields/message Ids/message data (arrays) from/to
028000200529      ** caller
028010200529     C                   PARM                    WFldNamArr
028020200529     C                   PARM                    WMsgIdArr
028030200529     C                   PARM                    WMsgDtaArr
028040200529      *
028050200529      ** Write Screen with No Read Indicator
028060200529     C                   PARM      'N'           PWriteOnly        1
028070200529      *
028080200529      ** STANDING DATA
028090200529      ** =============
028100200529      *
028110200529      ** SDBANK - System Runday
028120200529     C                   PARM                    BJMRDT
028130200529      *
028140200529      ** SDBANK - Single Branch Code
028150200529     C                   PARM                    BJSBRC
028160200529      *
028170200529      ** SDGELR - Profit Centre Used
028180200529     C                   PARM                    BKPRCU
028190200529      *
028200200529      ** SDGELR - Originating Branch Used
028210200529     C                   PARM                    BKOBRU
028220200529      *
028230200529      ** SWITCHABLE FEATURES
028240200529      ** ===================
028250200529      *
028260200529      ** EMU FT Settlement Currency Conversion
028270200529     C                   PARM                    CEU006
028280200529      *
028290200529      ** BIC database plus
028300200529     C                   PARM                    CFT007
028310200529      *
028320200529      ** Electronic Banking Interface IATs and TPPs
028330200529     C                   PARM                    CGL009
028340200529      *                                                                         CFT014
028350200529      ** STP Phase 2 MT103 Messages Generation for FT.                          CFT014
028360200529     C                   PARM                    CFT014                         CFT014
028370200529     C/COPY WNCPYSRC,FTIPAYSC22
028380200529      *                                                                         CFT009
028390200529      ** Fees & Charges                                                         CFT009
028400200529     C                   PARM                    CFT009                         CFT009
028410200529     C/COPY WNCPYSRC,FTIPAYSC04
028420200529      *
028430200529      ** OUTPUT
028440200529      ** ======
028450200529      *
028460200529      ** Function Keys Enabled
028470200529      ** KC = Command Key 03 = Exit
028480200529      ** KD = Command Key 04 = Prompt
028490200529      ** KE = Command Key 05 = Refresh
028500200529      ** KG = Command Key 07 = Read Previous
028510200529      ** KH = Command Key 08 = Read Next
028520200529      ** KJ = Command Key 10 = Delete
028530200529      ** KL = Command Key 12 = Cancel
028540200529      ** KP = Command Key 15 = Browse
028550200529      ** KQ = Command Key 16 = Search
028560200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
028570200529      ** KV = Command Key 21 = Additional Information Window
028580200529     C                   PARM                    PINKC             1
028590200529     C                   PARM                    PINKD             1
028600200529     C                   PARM                    PINKE             1
028610200529     C                   PARM                    PINKG             1
028620200529     C                   PARM                    PINKH             1
028630200529     C                   PARM                    PINKJ             1
028640200529     C                   PARM                    PINKL             1
028650200529     C                   PARM                    PINKP             1
028660200529     C                   PARM                    PINKQ             1
028670200529     C                   PARM                    PINKS             1
028680200529     C                   PARM                    PINKV             1
028690200529      *
028700200529      ** Cursor position
028710200529     C                   PARM                    PRowCol
028720200529     C/COPY WNCPYSRC,FTIPAYSC01
028730200529      *
028740200529      ** Save Warning Message Ids array of Level 1 screen.
028750200529      *
028760200529     C                   MOVEA     WMsgIDArr     WPrvWarnAr
028770200529      *
028780200529      ** Reset error fields.
028790200529      *
028800200529     C                   EXSR      SRResetErr
028810200529
028820200529     C                   SELECT
028830200529      *
028840200529      ** F3 - end program.
028850200529      *
028860200529     C     PINKC         WHENEQ    *ON
028870200529     C                   EXSR      SREndP
028880200529      *
028890200529      ** F4 or F16 - BIC processing
028900200529      *
028910200529     C     PINKD         WHENEQ    *ON
028920200529     C     PINKQ         OREQ      *ON
028930200529     C                   EXSR      SRBIC1
028940200529      *
028950200529      ** F5 - refresh Level 1 screen.
028960200529      *
028970200529     C     PINKE         WHENEQ    *ON
028980200529     C                   MOVEL     CrIP1ScnFmt   NwIP1ScnFmt
028990200529     C                   MOVEL     CrIP1AScnFmt  NwIP1AScnFmt                   CFT014
029000200529      *
029010200529      ** F7 - roll backwards.
029020200529      *
029030200529     C     PINKG         WHENEQ    *ON
029040200529      *                                                                                       261468
029050200529      ** Call CL program to deallocate this reference to a dataarea                           261468
029060200529      *                                                                                       261468
029070200529     C                   EVAL      C#RTCD = *Blanks                                           261468
029080200529     C                   EVAL      @MODLE = 'FT'                                              261468
029090200529     C                   EVAL      @TREF  = *Blanks                                           261468
029100200529     C                   EVAL      @RTINF = *Blanks                                           261468
029110200529      *                                                                                       261468
029120200529     C                   CALL      'AOC8000'                                                  261468
029130200529     C                   PARM                    C#RTCD            7                          261468
029140200529     C                   PARM                    @MODLE            2                          261468
029150200529     C                   PARM                    @TREF            15                          261468
029160200529     C                   PARM                    @RTINF           80                          261468
029170200529      *                                                                                       261468
029180200529      ** Reduce PREF sequence number if it was incremented.                                   261468
029190200529      *                                                                                       261468
029200200529     C                   IF        FirstTime <> 'Y'                                           261468
029210200529      *                                                                                       261468
029220200529      ** Reduce Sequence number in DTAARA as number is not being used                         261468
029230200529      *                                                                                       261468
029240200529     C     *LOCK         IN        WINPAY                                                     261468
029250200529     C                   IF        CFT151 = 'N'                                               CFT151
029260200529      *                                                                                       261468
029270200529      ** Check to see if another pref has been generated by another                           261468
029280200529      ** function                                                                             261468
029290200529      *                                                                                       261468
029300200529     C                   Z-ADD     WWINSQ        svnum             4 0                        261468
029310200529     C                   EVAL      svnum = svnum + 1                                          261468
029320200529     C                   IF        svnum = WINSQ                                              261468
029330200529      *                                                                                       261468
029340200529      ** No new reference has been generated - so reduce sequence                             261468
029350200529      ** number on data area                                                                  261468
029360200529      *                                                                                       261468
029370200529     C                   SUB       1             WINSQ                                        261468
029380200529      *                                                                                       261468
029390200529      ** Ensure PREF is generated again if entering a new payment after                       261468
029400200529      ** cancel                                                                               261468
029410200529      *                                                                                       261468
029420200529     C                   EVAL      FirstTime = 'Y'                                            261468
029430200529     C                   ELSE                                                                 261468
029440200529      *                                                                                       261468
029450200529      ** if another number has been generated, the current payment                            261468
029460200529      ** reference only if the program is exited, otherwise the pref is                       261468
029470200529      ** re-used.                                                                             261468
029480200529      *                                                                                       261468
029490200529     C                   ENDIF                                                                261468
029500200529     C                   OUT       WINPAY                                                     261468
029510200529     C                   else                                                                 CFT151
029520200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
029530200529     C                   CALL      'FT000328'                                                 CFT151
029540200529     C                   PARM                    PRTCD                                        CFT151
029550200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
029560200529     C                   PARM      'A'           WCALC                                        CFT151
029570200529     C                   PARM      'N'           WUPD              1                          CFT151
029580200529     C                   PARM                    svalph                                       CFT151
029590200529     C                   PARM                    WNEWSQ                                       CFT151
029600200529     C                   if        WNEWSQ = WINPAY                                            CFT151
029610200529     C                   CALL      'FT000328'                                                 CFT151
029620200529     C                   PARM                    PRTCD                                        CFT151
029630200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
029640200529     C                   PARM      'S'           WCALC                                        CFT151
029650200529     C                   PARM      'Y'           WUPD                                         CFT151
029660200529     C                   PARM                    svalph                                       CFT151
029670200529     C                   PARM                    WNEWSQ                                       CFT151
029680200529     C                   ENDIF                                                                CFT151
029690200529     C                   ENDIF                                                                CFT151
029700200529      *                                                                                       261468
029710200529      ** Reset FirstTime field so new pref is generated if required.                          261468
029720200529      *                                                                                       261468
029730200529     C                   Eval      FirstTime = 'Y'                                            261468
029740200529     C                   ENDIF                                                                261468
029750200529      *                                                                                       261468
029760200529     C                   EXSR      SRRoll
029770200529      *
029780200529      ** F8 - roll forwards.
029790200529      *
029800200529     C     PINKH         WHENEQ    *ON
029810200529      *                                                                                       261468
029820200529      ** Call CL program to deallocate this reference to a dataarea                           261468
029830200529      *                                                                                       261468
029840200529     C                   EVAL      C#RTCD = *Blanks                                           261468
029850200529     C                   EVAL      @MODLE = 'FT'                                              261468
029860200529     C                   EVAL      @TREF  = *Blanks                                           261468
029870200529     C                   EVAL      @RTINF = *Blanks                                           261468
029880200529      *                                                                                       261468
029890200529     C                   CALL      'AOC8000'                                                  261468
029900200529     C                   PARM                    C#RTCD            7                          261468
029910200529     C                   PARM                    @MODLE            2                          261468
029920200529     C                   PARM                    @TREF            15                          261468
029930200529     C                   PARM                    @RTINF           80                          261468
029940200529      *                                                                                       261468
029950200529      ** Reduce PREF sequence number if it was incremented.                                   261468
029960200529      *                                                                                       261468
029970200529     C                   IF        FirstTime <> 'Y'                                           261468
029980200529      *                                                                                       261468
029990200529      ** Reduce Sequence number in DTAARA as number is not being used                         261468
030000200529      *                                                                                       261468
030010200529     C     *LOCK         IN        WINPAY                                                     261468
030020200529     C                   IF        CFT151 = 'N'                                               CFT151
030030200529      *                                                                                       261468
030040200529      ** Check to see if another pref has been generated by another                           261468
030050200529      ** function                                                                             261468
030060200529      *                                                                                       261468
030070200529     C                   z-add     WWINSQ        svnum             4 0                        261468
030080200529     C                   eval      svnum = svnum + 1                                          261468
030090200529     C                   if        svnum = WINSQ                                              261468
030100200529      *                                                                                       261468
030110200529      ** No new reference has been generated - so reduce sequence                             261468
030120200529      ** number on data area                                                                  261468
030130200529      *                                                                                       261468
030140200529     C                   SUB       1             WINSQ                                        261468
030150200529      *                                                                                       261468
030160200529      ** Ensure PREF is generated again if entering a new payment after                       261468
030170200529      ** cancel                                                                               261468
030180200529      *                                                                                       261468
030190200529     C                   eval      FirstTime = 'Y'                                            261468
030200200529     C                   else                                                                 261468
030210200529      *                                                                                       261468
030220200529      ** if another number has been generated, the current payment                            261468
030230200529      ** reference only if the program is exited, otherwise the pref is                       261468
030240200529      ** re-used.                                                                             261468
030250200529      *                                                                                       261468
030260200529     C                   endif                                                                261468
030270200529     C                   OUT       WINPAY                                                     261468
030280200529     C                   else                                                                 CFT151
030290200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
030300200529     C                   CALL      'FT000328'                                                 CFT151
030310200529     C                   PARM                    PRTCD                                        CFT151
030320200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
030330200529     C                   PARM      'A'           WCALC                                        CFT151
030340200529     C                   PARM      'N'           WUPD              1                          CFT151
030350200529     C                   PARM                    svalph                                       CFT151
030360200529     C                   PARM                    WNEWSQ                                       CFT151
030370200529     C                   if        WNEWSQ = WINPAY                                            CFT151
030380200529     C                   CALL      'FT000328'                                                 CFT151
030390200529     C                   PARM                    PRTCD                                        CFT151
030400200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
030410200529     C                   PARM      'S'           WCALC                                        CFT151
030420200529     C                   PARM      'Y'           WUPD                                         CFT151
030430200529     C                   PARM                    svalph                                       CFT151
030440200529     C                   PARM                    WNEWSQ                                       CFT151
030450200529     C                   ENDIF                                                                CFT151
030460200529     C                   endif                                                                CFT151
030470200529      *                                                                                       261468
030480200529      ** Reset FirstTime field so new pref is generated if required.                          261468
030490200529      *                                                                                       261468
030500200529     C                   Eval      FirstTime = 'Y'                                            261468
030510200529     C                   ENDIF                                                                261468
030520200529      *                                                                                       261468
030530200529     C                   EXSR      SRRoll
030540200529      *
030550200529      ** F10 - delete record.  Proceed to update of files.
030560200529      *
030570200529     C     PINKJ         WHENEQ    *ON
030580200529     C                   MOVEL     'U'           WScrn
030590200529      *
030600200529      ** F12 - cancel.
030610200529      *
030620200529     C     PINKL         WHENEQ    *ON
030630200529      *
030640200529      ** If Incoming Payments Maintenance has been called by
030650200529      ** linked maintenance/enquiry, terminate program.
030660200529      *
030670200529     C     PParmLink     IFEQ      'Y'
030680200529      *
030690200529     C                   MOVEL     '5'           PParmRtcd
030700200529     C                   MOVEL     'T'           WScrn
030710200529      *
030720200529     C                   ELSE
030730200529      *
030740200529      ** Otherwise, display Initial screen with blank fields.
030750200529      ** Release all electronic messages that are reserved for
030760200529      ** this job and reset Read Next Browse Subfile Record
030770200529      ** indicator.
030780200529      *
030790200529     C     WEMSG         IFEQ      'Y'
030800200529     C                   EXSR      SRMsgEnd
030810200529     C                   ENDIF
030820200529      *
030830200529     C                   MOVEL     *BLANK        PRDNB
030840200529     C                   MOVEL     *BLANKS       DDACTN
030850200529     C                   MOVEL     *BLANKS       DDPREF
030860200529     C                   MOVEL     *BLANKS       DDSWTN
030870200529     C                   MOVEL     *BLANKS       DDSEQNO
030880200529     C                   MOVEL     *BLANKS       DDBRCA
030890200529     C                   MOVEL     'I'           WScrn
030900200529      *
030910200529      * Reduce PREF sequence number if it was incremented.                                    209067
030920200529     C                   IF        FirstTime <> 'Y'                                           209067
030930200529      * Reduce Sequence number in DTAARA as number is not being used                          209067
030940200529     C     *LOCK         IN        WINPAY                                                     209067
030950200529     C                   IF        CFT151 = 'N'                                               CFT151
030960200529      *                                                                                       209067
030970200529      * Check to see if another pref has been generated by another function                   209067
030980200529      *                                                                                       209067
030990200529     C                   z-add     WWINSQ        svnum             4 0                        209067
031000200529     C                   eval      svnum = svnum + 1                                          209067
031010200529     C**********         if        svnum = WINSQ                                      209067 BUG4776
031020200529     C*****SVNUM         IFLE      WINSQ                                              BUG4776 260326
031030200529     C                   if        svnum = WINSQ                                              260326
031040200529      * No new reference has been generated - so reduce sequence number on data area          209067
031050200529     C**********         SUB       1             WINSQ                                209067 BUG4776
031060200529     C**********         EVAL      WINSQ = WWINSQ                                     BUG4776 260326
031070200529     C                   SUB       1             WINSQ                                        260326
031080200529      * Ensure PREF is generated again if entering a new payment after cancel                 209067
031090200529     C                   eval      FirstTime = 'Y'                                            209067
031100200529     C**********         else                                                         209067 BUG4776
031110200529     C                   else                                                                 260326
031120200529      * if another number has been generated, the current payment reference                   209067
031130200529      *  only if the program is exited, otherwise the pref is re-used.                        209067
031140200529     C                   endif                                                                209067
031150200529     C                   OUT       WINPAY                                                     209067
031160200529     C                   else                                                                 CFT151
031170200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
031180200529     C                   CALL      'FT000328'                                                 CFT151
031190200529     C                   PARM                    PRTCD                                        CFT151
031200200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
031210200529     C                   PARM      'A'           WCALC                                        CFT151
031220200529     C                   PARM      'N'           WUPD              1                          CFT151
031230200529     C                   PARM                    svalph                                       CFT151
031240200529     C                   PARM                    WNEWSQ                                       CFT151
031250200529     C                   if        WNEWSQ = WINPAY                                            CFT151
031260200529     C                   CALL      'FT000328'                                                 CFT151
031270200529     C                   PARM                    PRTCD                                        CFT151
031280200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
031290200529     C                   PARM      'S'           WCALC                                        CFT151
031300200529     C                   PARM      'Y'           WUPD                                         CFT151
031310200529     C                   PARM                    svalph                                       CFT151
031320200529     C                   PARM                    WNEWSQ                                       CFT151
031330200529     C                   ENDIF                                                                CFT151
031340200529     C                   endif                                                                CFT151
031350200529      * Reset FirstTime field so new pref is generated if required.                           209067
031360200529     C                   Eval      FirstTime = 'Y'                                            209067
031370200529     C                   ENDIF                                                                209067
031380200529      *                                                                                       209067
031390200529     C                   ENDIF
031400200529      *
031410200529      ** F15 - build Browse.
031420200529      *
031430200529     C     PINKP         WHENEQ    *ON
031440200529      *                                                                                       261468
031450200529      ** Call CL program to deallocate this reference to a dataarea                           261468
031460200529      *                                                                                       261468
031470200529     C                   EVAL      C#RTCD = *Blanks                                           261468
031480200529     C                   EVAL      @MODLE = 'FT'                                              261468
031490200529     C                   EVAL      @TREF  = *Blanks                                           261468
031500200529     C                   EVAL      @RTINF = *Blanks                                           261468
031510200529      *                                                                                       261468
031520200529     C                   CALL      'AOC8000'                                                  261468
031530200529     C                   PARM                    C#RTCD            7                          261468
031540200529     C                   PARM                    @MODLE            2                          261468
031550200529     C                   PARM                    @TREF            15                          261468
031560200529     C                   PARM                    @RTINF           80                          261468
031570200529      *                                                                                       261468
031580200529      ** Reduce PREF sequence number if it was incremented.                                   261468
031590200529      *                                                                                       261468
031600200529     C                   IF        FirstTime <> 'Y'                                           261468
031610200529      *                                                                                       261468
031620200529      ** Reduce Sequence number in DTAARA as number is not being used                         261468
031630200529      *                                                                                       261468
031640200529     C     *LOCK         IN        WINPAY                                                     261468
031650200529     C                   IF        CFT151 = 'N'                                               CFT151
031660200529      *                                                                                       261468
031670200529      ** Check to see if another pref has been generated by another                           261468
031680200529      ** function                                                                             261468
031690200529      *                                                                                       261468
031700200529     C                   z-add     WWINSQ        svnum             4 0                        261468
031710200529     C                   eval      svnum = svnum + 1                                          261468
031720200529     C                   if        svnum = WINSQ                                              261468
031730200529      *                                                                                       261468
031740200529      ** No new reference has been generated - so reduce sequence                             261468
031750200529      ** number on data area                                                                  261468
031760200529      *                                                                                       261468
031770200529     C                   SUB       1             WINSQ                                        261468
031780200529      *                                                                                       261468
031790200529      ** Ensure PREF is generated again if entering a new payment after                       261468
031800200529      ** cancel                                                                               261468
031810200529      *                                                                                       261468
031820200529     C                   eval      FirstTime = 'Y'                                            261468
031830200529     C                   else                                                                 261468
031840200529      *                                                                                       261468
031850200529      ** if another number has been generated, the current payment                            261468
031860200529      ** reference only if the program is exited, otherwise the pref                          261468
031870200529      ** is re-used.                                                                          261468
031880200529      *                                                                                       261468
031890200529     C                   endif                                                                261468
031900200529     C                   OUT       WINPAY                                                     261468
031910200529     C                   else                                                                 CFT151
031920200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
031930200529     C                   CALL      'FT000328'                                                 CFT151
031940200529     C                   PARM                    PRTCD                                        CFT151
031950200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
031960200529     C                   PARM      'A'           WCALC                                        CFT151
031970200529     C                   PARM      'N'           WUPD              1                          CFT151
031980200529     C                   PARM                    svalph                                       CFT151
031990200529     C                   PARM                    WNEWSQ                                       CFT151
032000200529     C                   if        WNEWSQ = WINPAY                                            CFT151
032010200529     C                   CALL      'FT000328'                                                 CFT151
032020200529     C                   PARM                    PRTCD                                        CFT151
032030200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
032040200529     C                   PARM      'S'           WCALC                                        CFT151
032050200529     C                   PARM      'Y'           WUPD                                         CFT151
032060200529     C                   PARM                    svalph                                       CFT151
032070200529     C                   PARM                    WNEWSQ                                       CFT151
032080200529     C                   ENDIF                                                                CFT151
032090200529     C                   endif                                                                CFT151
032100200529      *                                                                                       261468
032110200529      ** Reset FirstTime field so new pref is generated if required.                          261468
032120200529      *                                                                                       261468
032130200529     C                   Eval      FirstTime = 'Y'                                            261468
032140200529     C                   ENDIF                                                                261468
032150200529      *                                                                                       261468
032160200529     C                   EXSR      SRBldBrw
032170200529      *
032180200529      ** F18 - next Payment.  Read next subfile record in linked
032190200529      ** maintenance/enquiry.
032200200529      *
032210200529     C     PINKS         WHENEQ    *ON
032220200529     C                   MOVEL     '7'           PParmRtcd
032230200529     C                   MOVEL     'T'           WScrn
032240200529      *
032250200529      ** F21 - display Additional Information Window.
032260200529      *
032270200529     C     PINKV         WHENEQ    *ON
032280200529     C                   MOVEL     'A'           WScrn
032290200529      *
032300200529      ** Enter key was pressed.
032310200529      *
032320200529     C                   OTHER
032330200529      *
032340200529      ** If Action is Insert or Amend, validate input to
032350200529      ** Level 1 screen.
032360200529      *
032370200529     C     DDACTN        IFEQ      'I'
032380200529     C     DDACTN        OREQ      'A'
032390200529     C                   EXSR      SRVal_P
032400200529     C                   GOTO      EScrn_P
032410200529     C                   ENDIF
032420200529      *
032430200529      ** Action is Enquire.
032440200529      *
032450200529     C     DDACTN        IFEQ      'E'
032460200529      *
032470200529      ** Set up Charges Branch.
032480200529      *
032490200529     C     BJSBRC        IFNE      *BLANKS
032500200529     C                   EVAL      PPYBR = BJSBRC
032510200529     C                   ELSE
032520200529     C     BKOBRU        IFEQ      'Y'
032530200529     C                   EVAL      PPYBR = IPORBR
032540200529     C                   ELSE
032550200529     C                   EVAL      PPYBR = IPBRCA
032560200529     C                   ENDIF
032570200529     C                   ENDIF
032580200529      *
032590200529      ** If Windows processing is on, display Window screen.
032600200529      *
032610200529     C     BGWDPR        IFEQ      'Y'
032620200529     C                   MOVEL     'W'           WScrn
032630200529     C                   GOTO      EScrn_P
032640200529     C                   ENDIF
032650200529      *
032660200529      ** If Level 1 is linked with Level 2 or Incoming Payments
032670200529      ** Maintenance is called from linked maintenance/enquiry,
032680200529      ** display Level 2 screen 1.
032690200529      *
032700200529     C     BTLVJN        IFEQ      'Y'
032710200529     C     PParmLink     OREQ      'Y'
032720200529     C                   MOVEL     'S'           WScrn
032730200529     C                   GOTO      EScrn_P
032740200529     C                   ENDIF
032750200529      *
032760200529      ** Read Next Browse Subfile record.
032770200529      *
032780200529     C     PRDNB         IFEQ      'Y'
032790200529     C                   MOVEL     'R'           WScrn
032800200529     C                   GOTO      EScrn_P
032810200529     C                   ENDIF
032820200529      *
032830200529      ** Redisplay Initial screen with blank screen fields.
032840200529      *
032850200529     C                   MOVEL     *BLANKS       DDACTN
032860200529     C                   MOVEL     *BLANKS       DDPREF
032870200529     C                   MOVEL     *BLANKS       DDSWTN
032880200529     C                   MOVEL     *BLANKS       DDSEQNO
032890200529     C                   MOVEL     *BLANKS       DDBRCA
032900200529     C                   MOVEL     'I'           WScrn
032910200529      *
032920200529     C                   ENDIF
032930200529      *
032940200529     C                   ENDSL
032950200529      *
032960200529     C     EScrn_P       ENDSR
032970200529      *
032980200529      *****************************************************************
032990200529      /EJECT
033000200529      *****************************************************************
033010200529      *                                                               *
033020200529      *  SRVal_P - Validate input to Level 1 screen                   *
033030200529      *                                                               *
033040200529      *****************************************************************
033050200529      *
033060200529     C     SRVal_P       BEGSR
033070200529      *
033080200529      ** If Action is Amend, validate whether non-amendable fields
033090200529      ** have been amended.
033100200529      *
033110200529     C     DDACTN        IFEQ      'A'
033120200529      *
033130200529     C                   CALLB     'FTIPAYAMD'
033140200529      *                             =========
033150200529      ** INPUT
033160200529      ** =====
033170200529      *
033180200529      ** Return Code
033190200529     C                   PARM      *BLANKS       RetCodeOut
033200200529      *
033210200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
033220200529      ** - screen format
033230200529     C                   PARM                    NwIP1ScnFmt
033240200529      *
033250200529      ** Incoming Payments Lvl 1 Scrn details retrieved from file
033260200529      ** - screen format
033270200529     C                   PARM                    CrIP1ScnFmt
033280200529      *
033290200529      ** Reset of Fields in Error Required (Y/N)
033300200529     C                   PARM      'Y'           PResetFld         1
033310200529      *
033320200529      ** STANDING DATA
033330200529      ** =============
033340200529      *
033350200529      ** SDMMOD - Multibranch Indicator
033360200529     C                   PARM                    BGMBIN
033370200529      *
033380200529      ** SDGELR - Profit Centre Used
033390200529     C                   PARM                    BKPRCU
033400200529      *
033410200529      ** SDGELR - Profit Centre Amendable
033420200529     C                   PARM                    BKPRCA
033430200529      *
033440200529      ** OUTPUT
033450200529      ** ======
033460200529      *
033470200529      ** Error fields/message IDs/message data (arrays) from/to caller
033480200529     C                   PARM                    FldNameArr
033490200529     C                   PARM                    MsgIdArr
033500200529     C                   PARM                    MsgDtaArr
033510200529      *
033520200529      ** Array index (3P0) from/to caller
033530200529     C                   PARM                    IDx
033540200529      *
033550200529      ** Incoming Payments Lvl 1 Scrn error indicators
033560200529     C                   PARM                    FTEIPY1
033570200529      *
033580200529      ** OK Amendments field
033590200529     C                   PARM                    PAmendOK          1
033600200529      *
033610200529     C                   ENDIF
033620200529      *
033630200529      ** Validate Detail fields on Level 1 screen.
033640200529      *
033650200529     C                   CALLB     'FTIPAY1VL'
033660200529      *                             =========
033670200529      ** INPUT
033680200529      ** =====
033690200529      *
033700200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
033710200529      ** Mode = '      ' (Not Front Office Transaction Interface)
033720200529      ** Mode = '*RPR  ' (Repair Function)
033730200529      ** Mode = '*SIN  ' (Screen Input Function)
033740200529     C                   PARM                    PMode
033750200529      *
033760200529      ** Response Mode
033770200529     C                   PARM                    PResponse
033780200529      *
033790200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
033800200529      ** - screen format
033810200529     C                   PARM                    NwIP1ScnFmt
033820200529      *                                                                         CFT014
033830200529      ** Incoming Payments Lvl 1 Scrn 1/2 details from Incoming trans.          CFT014
033840200529     C                   PARM                    NwIP1aScnFmt                   CFT014
033850200529      *                                                                         CFT009
033860200529      ** Incoming Payments Lvl 2 Scrn 3 details from incoming transaction       CFT009
033870200529      ** - screen format                                                        CFT009
033880200529     C                   PARM                    NwIP5ScnFmt                    CFT009
033890200529      *                                                                         CFT014
033900200529      ** Third Reimbursement Institution (previous)                             CFT014
033910200529     C                   PARM                    PPrvTRI          34            CFT014
033920200529      *                                                                         CFT014
033930200529      ** Previous Instructed Amount                                             CFT014
033940200529     C                   PARM                    PPrvNDAM         14            CFT014
033950200529      *
033960200529      ** Base Currency No. of Decimal Places
033970200529     C                   PARM                    PBCDP
033980200529      *
033990200529      ** Payment Type
034000200529     C                   PARM                    PPYTP
034010200529      *
034020200529      ** Incoming Payments Lvl 1 Scrn details retrieved from file
034030200529      ** - screen format
034040200529     C                   PARM                    CrIP1ScnFmt
034050200529      *
034060200529      ** Incoming Payments extra data
034070200529     C                   PARM                    PExtData
034080200529      *
034090200529      ** STANDING DATA
034100200529      ** =============
034110200529      *
034120200529      ** SDBANK - Base Currency Code
034130200529     C                   PARM                    BJCYCD
034140200529      *
034150200529      ** SDBANK - Midas Run Date
034160200529     C**********         PARM                    BJRDNB                                       CSC011
034170200529     C                   PARM                    PPROCDTE                                     CSC011
034180200529      *
034190200529      ** SDBANK - Local Currency Code
034200200529     C                   PARM                    BJLCCY
034210200529      *
034220200529      ** SDBANK - Location Code
034230200529     C                   PARM                    BJSLCD
034240200529      *
034250200529      ** SDBANK - Single Branch Code
034260200529     C                   PARM                    BJSBRC
034270200529      *
034280200529      ** SDBANK - Back Value Period in Days
034290200529     C                   PARM                    BJBVPD
034300200529      *
034310200529      ** SDBANK - Date Format Indicator
034320200529     C                   PARM                    BJDFIN
034330200529      *
034340200529      ** SDGELR - Currency Code for Euro
034350200529     C                   PARM                    BKEURO
034360200529      *
034370200529      ** SDGELR - Profit Centre Default Used
034380200529     C                   PARM                    BKPCDU
034390200529      *
034400200529      ** SDGELR - Profit Centre Used
034410200529     C                   PARM                    BKPRCU
034420200529      *
034430200529      ** SDGELR - Originating Branch Used
034440200529     C                   PARM                    BKOBRU
034450200529      *
034460200529      ** SDGELR - Originating Branch/User Vald Req.
034470200529     C                   PARM                    BKOBUV
034480200529      *
034490200529      ** SDMMOD - Retail Banking
034500200529     C                   PARM                    BGRTBN
034510200529      *
034520200529      ** SDMMOD - Multibranch Indicator
034530200529     C                   PARM                    BGMBIN
034540200529      *
034550200529      ** SDMMOD - Analytical Accounting
034560200529     C                   PARM                    BGN0ST
034570200529      *
034580200529      ** SDMMOD - Dealing Foreign Exchange
034590200529     C                   PARM                    BGDLFX
034600200529      *
034610200529      ** SDMMOD - Dealing Money Market
034620200529     C                   PARM                    BGDLMM
034630200529      *
034640200529      ** SDRETL - Retail A/c Number Required?
034650200529     C                   PARM                    BMRANR
034660200529      *                                                                         CFT014
034670200529      ** SDFTFR - Level Join indicator                                          CFT014
034680200529     C                   PARM                    BTLVJN                         CFT014
034690200529      ** SDFTFR - Percent Rate Discrepancy                                      CFT014
034700200529     C                   PARM      BTPCRD        PBTPCRD           5 2          CFT014
034710200529      *                                                                         CFT014
034720200529      ** SDMMOD - Interest on Accrual                                           CFT014
034730200529     C                   PARM                    BGIOAC                         CFT014
034740200529      *
034750200529      ** ZMUSER - Department Code
034760200529     C                   PARM                    PDPPT
034770200529      *
034780200529      ** ZMUSER - User Id
034790200529     C                   PARM                    PUSRID
034800200529      *                                                                         CFT009
034810200529      ** SDFTFR - Charges Currency                                              CFT009
034820200529     C                   PARM                    BTCHCY                         CFT009
034830200529      *                                                                         CFT009
034840200529      ** SDFTFR - Fixed Charge Currency                                         CFT009
034850200529     C                   PARM                    FCHCCY                         CFT009
034860200529      *                                                                         CFT009
034870200529      ** SDFTFR - Charges calculated in transaction ccy                         CFT009
034880200529     C                   PARM                    CHTRCY                         CFT009
034890200529      *                                                                         CFT009
034900200529      ** VAT Rate                                                               CFT009
034910200529     C                   PARM                    PVATR                          CFT009
034920200529      *
034930200529      ** SWITCHABLE FEATURES
034940200529      ** ===================
034950200529      *
034960200529      ** EMU FT Settlement Currency Conversion
034970200529     C                   PARM                    CEU006
034980200529      *
034990200529      ** Electronic Banking Interface IATs and TPPs
035000200529     C                   PARM                    CGL009
035010200529      *
035020200529      ** IBAN numbers
035030200529     C                   PARM                    CFT004
035040200529      *                                                                         CFT014
035050200529      ** Straight Through processing Phase 2                                    CFT014
035060200529     C                   PARM                    CFT014                         CFT014
035070200529     C/COPY WNCPYSRC,FTIPAYSC23
035080200529      *                                                                         CFT009
035090200529      ** Fees & Charges                                                         CFT009
035100200529     C                   PARM                    CFT009                         CFT009
035110200529     C                   PARM                    CFT010                         CFT009
035120200529      *                                                                         CFT009
035130200529      ** BLI FT Enhancements Feature                                            CFT009
035140200529     C                   PARM                    S01494                         CFT009
035150200529                                                                                              CGL014
035160200529      ** Collaterals Processing                                                               CGL014
035170200529                                                                                              CGL014
035180200529     C                   PARM                    CGL014                                       CGL014
035190200529     C/COPY WNCPYSRC,FTIPAYSC05
035200200529      *
035210200529      ** OUTPUT
035220200529      ** ======
035230200529      *
035240200529      ** Error fields/message IDs/message data (arrays) from/to caller
035250200529     C                   PARM                    FldNameArr
035260200529     C                   PARM                    MsgIdArr
035270200529     C                   PARM                    MsgDtaArr
035280200529      *
035290200529      ** Array index (3P0) from/to caller
035300200529     C                   PARM                    IDx
035310200529      *
035320200529      ** Warning flds/message IDs/message data (arrays) from/to caller
035330200529     C                   PARM                    WFldNamArr
035340200529     C                   PARM                    WMsgIdArr
035350200529     C                   PARM                    WMsgDtaArr
035360200529      *
035370200529      ** Array index (3P0) from/to caller
035380200529     C                   PARM                    WIDx
035390200529      *
035400200529      ** Incoming Payments Lvl 1 Scrn error indicators
035410200529     C                   PARM                    FTEIPY1
035420200529      *
035430200529      ** Incoming Payments for file update - file format
035440200529     C                   PARM                    NwIPFilFmt
035450200529      *                                                                         CFT014
035460200529      ** Incoming Payments (additional details) for file update                 CFT014
035470200529     C                   PARM                    NwIP2FilFmt                    CFT014
035480200529      *
035490200529      ** Charges Branch
035500200529     C                   PARM                    PPYBR
035510200529      *
035520200529      ** Account with Bank's full account
035530200529     C**********         PARM                    PACBDS           18                          TDA006
035540200529     C                   PARM                    PACBDS           24                          TDA006
035550200529      *
035560200529      ** Sender's full account
035570200529     C**********         PARM                    PSNDDS           18                          TDA006
035580200529     C                   PARM                    PSNDDS           24                          TDA006
035590200529      *
035600200529      ** Receiver Correspondence's full account
035610200529     C**********         PARM                    PRCCDS           18                          TDA006
035620200529     C                   PARM                    PRCCDS           24                          TDA006
035630200529      *                                                                                       250600
035640200529      ** Third Reimbursemnt Party  full account                                               250600
035650200529     C                   PARM                    PTRBDS           24                          250600
035660200529      *
035670200529      ** Beneficiary's full account
035680200529     C**********         PARM                    PBNCDS           18                          TDA006
035690200529     C                   PARM                    PBNCDS           24                          TDA006
035700200529      *
035710200529      ** IBANs full account
035720200529     C                   PARM                    PIBANAcc
035730200529      *
035740200529      ** Settlement In Currency Indicator
035750200529     C                   PARM                    PSetInCy          1 0
035760200529      *
035770200529      ** Settlement EMU Transaction Period Start Date
035780200529     C                   PARM                    PSetTPSD          5 0
035790200529      *
035800200529      ** Payment In Currency Indicator
035810200529     C                   PARM                    PPayInCy          1 0
035820200529      *
035830200529      ** Payment EMU Transaction Period Start Date
035840200529     C                   PARM                    PPayTPSD          5 0
035850200529     C/COPY WNCPYSRC,FTIPAYSC24
035860200529      *                                                                         CFT009
035870200529      ** DS for Default Charge Amounts                                          CFT009
035880200529     C                   PARM                    PCharges                       CFT009
035890200529      *                                                                         CFT009
035900200529      ** Input Charge Currency                                                  CFT009
035910200529     C                   PARM                    PICCY                          CFT009
035920200529      *                                                                         CFT009
035930200529      ** Output Charge Currency                                                 CFT009
035940200529     C                   PARM                    POCCY                          CFT009
035950200529      *                                                                         CFT009
035960200529      ** Input Charge Currency No. of Decimal Places                            CFT009
035970200529     C                   PARM                    PINBDP                         CFT009
035980200529      *                                                                         CFT009
035990200529      ** Output Charge Currency No. of Decimal Places                           CFT009
036000200529     C                   PARM                    PONBDP                         CFT009
036010200529      *                                                                         CFT009
036020200529      ** Saved default charges                                                  CFT009
036030200529     C                   PARM                    DefValid                       CFT009
036040200529     C                   PARM                    DefValidX                      CFT009
036050200529     C                   PARM                    BENEDrBlck        1                        MD025111
036060200529     C                   PARM                    BENEDrRefd        1                       MD047369A
036070200529     C/COPY WNCPYSRC,FTIPAYSC11
036080200529      *
036090200529     C                   SELECT                                                               250600
036100200529     C                   WHEN      PTRBDS <> *BLANKS                                          250600
036110200529     C                   EVAL      PDBACT = PTRBDS                                            250600
036120200529     C                   WHEN      PRCCDS <> *BLANKS                                          250600
036130200529     C                   EVAL      PDBACT = PRCCDS                                            250600
036140200529     C                   WHEN      PSNDDS <> *BLANKS                                          250600
036150200529     C                   EVAL      PDBACT = PSNDDS                                            250600
036160200529     C                   ENDSL                                                                250600
036170200529      *                                                                                       250600
036180200529     C                   SELECT                                                               250600
036190200529     C                   WHEN      PACBDS <> *BLANKS                                          250600
036200200529     C                   EVAL      PCDACT = PACBDS                                            250600
036210200529     C                   WHEN      PBNCDS <> *BLANKS                                          250600
036220200529     C                   EVAL      PCDACT = PBNCDS                                            250600
036230200529     C                   ENDSL                                                                250600
036240200529      *                                                                         CFT014
036250200529      ** Save value of Third Reimbursement Institution and Instructed Amount.   CFT014
036260200529     C                   IF        CFT014 = 'Y'                                 CFT014
036270200529     C                   MOVE      DDTRIB        PPrvTRI                        CFT014
036280200529     C                   MOVE      DDNDAM        PPrvNDAM                       CFT014
036290200529     C                   ENDIF                                                  CFT014
036300200529      *
036310200529     C                   MOVEL     *BLANK        WRedisplay        1
036320200529      *
036330200529      ** If no errors occurred during validation of fields on Level 1
036340200529      ** screen, check if there are warnings which have not been
036350200529      ** displayed yet.
036360200529      *
036370200529     C                   IF        IDx = 0
036380200529      *
036390200529     C                   Z-ADD     1             WIx               3 0
036400200529      *
036410200529      * Force redisplay if details have changed                                               207211
036420200529     C     WIDx          IFNE      0                                                          207211
036430200529     C     NwIP1ScnFmt   ANDNE     PrvIP1ScnFmt                                               207211
036440200529     C                   EVAL      WRedisplay = 'Y'                                           207211
036450200529     C                   ENDIF                                                                207211
036460200529     C*                                                                                       207211
036470200529     C     WIx           DOWLE     WIDx
036480200529     C     WRedisplay    ANDEQ     *BLANK
036490200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)
036500200529     C                   EVAL      WRedisplay = 'Y'
036510200529     C                   ELSE
036520200529     C                   MOVEL     *BLANKS       WMsgIdArr(WIx)                               216351
036530200529     C                   EVAL      WIx =WIx + 1
036540200529     C                   ENDIF
036550200529     C                   ENDDO
036560200529      *
036570200529     C                   ENDIF
036580200529      *
036590200529      ** Redisplay Level 1 screen if there are errors or if there
036600200529      ** are warnings which have not been displayed yet.
036610200529      *
036620200529     C                   IF        IDx <> 0 or
036630200529     C                             WRedisplay = 'Y'
036640200529     C                   MOVEL     NwIP1ScnFmt   PrvIP1ScnFmt                                 207211
036650200529     C                   GOTO      EVal_P
036660200529     C                   ENDIF
036670200529     C
036680200529      *                                                                                       237415
036690200529      ** Save values of Details of Charges, Receiver's Charges Remitted,                      237415
036700200529      ** Sender's Charges Currency and Sender's Charges                                       237415
036710200529      *                                                                                       237415
036720200529     C                   MOVEL     ODDDTCH       WDDTCH            3                          237415
036730200529     C                   MOVEL     ODDRCRM       WDRCRM           12                          237415
036740200529     C                   MOVEL     ODDSCC1       WDSCC1            3                          237415
036750200529     C                   MOVEL     ODDSCH1       WDSCH1           12                          237415
036760200529     C                   MOVEL     ODDSCC2       WDSCC2            3                          237415
036770200529     C                   MOVEL     ODDSCH2       WDSCH2           12                          237415
036780200529     C                   MOVEL     ODDSCC3       WDSCC3            3                          237415
036790200529     C                   MOVEL     ODDSCH3       WDSCH3           12                          237415
036800200529     C                   MOVEL     ODDSCC4       WDSCC4            3                          237415
036810200529     C                   MOVEL     ODDSCH4       WDSCH4           12                          237415
036820200529     C                   MOVEL     ODDSCC5       WDSCC5            3                          237415
036830200529     C                   MOVEL     ODDSCH5       WDSCH5           12                          237415
036840200529      *                                                                                       232151
036850200529      ** Clear any warning messages                                                           232151
036860200529      *                                                                                       232151
036870200529     C                   MOVE      *ALL'Y'       FTEIPY1                                      232151
036880200529     C                   MOVE      *ALL'Y'       FTEIPY2                                      232151
036890200529     C                   MOVEL     *BLANK        WFldNamArr                                   232151
036900200529     C                   MOVEL     *BLANK        WMsgIdArr                                    232151
036910200529     C                   MOVEL     *BLANK        WMsgDtaArr                                   232151
036920200529      *                                                                         CFT009
036930200529      ** If CFT009 is on and action code is insert, save defaulted              CFT009
036940200529      ** charges.                                                               CFT009
036950200529      *                                                                         CFT009
036960200529     C                   IF        CFT009 = 'Y' AND DDACTN = 'I'                CFT009
036970200529     C                   MOVEL     PCharges      WICharges                      CFT009
036980200529     C                   MOVEL     NwIP5ScnFmt   CrIP5ScnFmt                    CFT009
036990200529     C                   MOVEL     DDTRCD        WDTRCD                         CFT009
037000200529     C                   MOVEL     DDTXCD        WDTXCD                         CFT009
037010200529     C                   MOVEL     DDCQCD        WDCQCD                         CFT009
037020200529     C                   MOVEL     DDADCD        WDADCD                         CFT009
037030200529     C                   MOVEL     DDTLCD        WDTLCD                         CFT009
037040200529     C                   MOVEL     DDMSCD        WDMSCD                         CFT009
037050200529     C                   MOVEL     DDCHCD        WDCHCD                         CFT009
037060200529     C                   MOVEL     M1CD          WM1CD                          CFT009
037070200529     C                   MOVEL     M2CD          WM2CD                          CFT009
037080200529     C                   MOVEL     M3CD          WM3CD                          CFT009
037090200529     C                   MOVEL     M4CD          WM4CD                          CFT009
037100200529     C                   MOVEL     M5CD          WM5CD                          CFT009
037110200529      *                                                                                       237415
037120200529     C                   IF        PParmLink = 'Y' and CrIP5ScnFmt <> *Blanks                 237415
037130200529      *                                                                                       237415
037140200529     C                   IF        WDDTCH <> *Blanks                                          237415
037150200529     C                   MOVEL     WDDTCH        DDDTCH                                       237415
037160200529     C                   MOVEL     WDDTCH        ODDDTCH                                      237415
037170200529     C                   ENDIF                                                                237415
037180200529      *                                                                                       237415
037190200529     C                   IF        WDRCRM <> *Blanks                                          237415
037200200529     C                   MOVEL     WDRCRM        DDRCRM                                       237415
037210200529     C                   MOVEL     WDRCRM        ODDRCRM                                      237415
037220200529     C                   ENDIF                                                                237415
037230200529      *                                                                                       237415
037240200529     C                   IF        WDSCC1 <> *Blanks                                          237415
037250200529     C                   MOVEL     WDSCC1        DDSCC1                                       237415
037260200529     C                   MOVEL     WDSCC1        ODDSCC1                                      237415
037270200529     C                   ENDIF                                                                237415
037280200529      *                                                                                       237415
037290200529     C                   IF        WDSCH1 <> *Blanks                                          237415
037300200529     C                   MOVEL     WDSCH1        DDSCH1                                       237415
037310200529     C                   MOVEL     WDSCH1        ODDSCH1                                      237415
037320200529     C                   ENDIF                                                                237415
037330200529      *                                                                                       237415
037340200529     C                   IF        WDSCC2 <> *Blanks                                          237415
037350200529     C                   MOVEL     WDSCC2        DDSCC2                                       237415
037360200529     C                   MOVEL     WDSCC2        ODDSCC2                                      237415
037370200529     C                   ENDIF                                                                237415
037380200529      *                                                                                       237415
037390200529     C                   IF        WDSCH2 <> *Blanks                                          237415
037400200529     C                   MOVEL     WDSCH2        DDSCH2                                       237415
037410200529     C                   MOVEL     WDSCH2        ODDSCH2                                      237415
037420200529     C                   ENDIF                                                                237415
037430200529      *                                                                                       237415
037440200529     C                   IF        WDSCC3 <> *Blanks                                          237415
037450200529     C                   MOVEL     WDSCC3        DDSCC3                                       237415
037460200529     C                   MOVEL     WDSCC3        ODDSCC3                                      237415
037470200529     C                   ENDIF                                                                237415
037480200529      *                                                                                       237415
037490200529     C                   IF        WDSCH3 <> *Blanks                                          237415
037500200529     C                   MOVEL     WDSCH3        DDSCH3                                       237415
037510200529     C                   MOVEL     WDSCH3        ODDSCH3                                      237415
037520200529     C                   ENDIF                                                                237415
037530200529      *                                                                                       237415
037540200529     C                   IF        WDSCC4 <> *Blanks                                          237415
037550200529     C                   MOVEL     WDSCC4        DDSCC4                                       237415
037560200529     C                   MOVEL     WDSCC4        ODDSCC4                                      237415
037570200529     C                   ENDIF                                                                237415
037580200529      *                                                                                       237415
037590200529     C                   IF        WDSCH4 <> *Blanks                                          237415
037600200529     C                   MOVEL     WDSCH4        DDSCH4                                       237415
037610200529     C                   MOVEL     WDSCH4        ODDSCH4                                      237415
037620200529     C                   ENDIF                                                                237415
037630200529      *                                                                                       237415
037640200529     C                   IF        WDSCC5 <> *Blanks                                          237415
037650200529     C                   MOVEL     WDSCC5        DDSCC5                                       237415
037660200529     C                   MOVEL     WDSCC5        ODDSCC5                                      237415
037670200529     C                   ENDIF                                                                237415
037680200529      *                                                                                       237415
037690200529     C                   IF        WDSCH5 <> *Blanks                                          237415
037700200529     C                   MOVEL     WDSCH5        DDSCH5                                       237415
037710200529     C                   MOVEL     WDSCH5        ODDSCH5                                      237415
037720200529     C                   ENDIF                                                                237415
037730200529      *                                                                                       237415
037740200529     C                   ENDIF                                                                237415
037750200529      *                                                                                       237415
037760200529     C                   ENDIF                                                  CFT009
037770200529      *                                                                         CFT009
037780200529     C                   SELECT
037790200529      *
037800200529      ** If Windows processing is on, display Window screen.
037810200529      *
037820200529     C     BGWDPR        WHENEQ    'Y'
037830200529     C                   MOVEL     'W'           WScrn
037840200529      *
037850200529      ** If Level 1 is linked with Level 2 or Incoming Payments
037860200529      ** Maintenance is called from linked maintenance/enquiry,
037870200529      ** process Level 2 screen 1.
037880200529      *
037890200529     C     BTLVJN        WHENEQ    'Y'
037900200529     C     PParmLink     OREQ      'Y'
037910200529      *
037920200529     C                   MOVEL     'S'           WScrn
037930200529      *
037940200529      ** If Action is Insert, or Action is Amend and Level 2
037950200529      ** details have not been entered, default Transfer
037960200529      ** Commission Tariff based on Charges Branch.
037970200529      *
037980200529     C     DDACTN        IFEQ      'I'
037990200529     C     DDACTN        OREQ      'A'
038000200529     C     INLVL2        ANDNE     'Y'
038010200529     C     PPYBR         CHAIN     PYCHGDB                            01
038020200529     C     *IN01         IFEQ      *OFF
038030200529     C                   EVAL      DDTRCT = PYDFTRCT
038040200529     C     WTRCT         IFNE      *BLANKS                                                    226722
038050200529     C                   EVAL      DDTRCT = WTRCT                                             226722
038060200529     C                   ENDIF                                                                226722
038070200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
038080200529     C                   ENDIF
038090200529     C                   ENDIF
038100200529      *
038110200529      ** Compute Charges and Commissions, and Total VAT Amounts
038120200529      ** based on Level 1 details, and display Confirmation
038130200529      ** screen.
038140200529      *
038150200529     C                   OTHER
038160200529     C                   IF        CFT009 = 'N'                                 CFT009
038170200529     C                   EXSR      SRCCVatL1
038180200529     C                   ENDIF                                                  CFT009
038190200529     C                   MOVEL     'F'           WScrn
038200200529      *
038210200529     C                   ENDSL
038220200529      *
038230200529     C     EVal_P        ENDSR
038240200529      *
038250200529      *****************************************************************
038260200529      /EJECT
038270200529      *****************************************************************
038280200529      *                                                               *
038290200529      *  SRScrn_S - Process Level 2 screen 1                          *
038300200529      *                                                               *
038310200529      *****************************************************************
038320200529      *
038330200529     C     SRScrn_S      BEGSR
038340200529      *
038350200529      ** Entry point is Level 2 Maintenance and Windows processing
038360200529      ** is on.
038370200529      *
038380200529     C     PParmLevel    IFEQ      '2'
038390200529     C     BGWDPR        ANDEQ     'Y'
038400200529      *
038410200529      ** If Action Code and Payment Reference have changed,
038420200529      ** clear any possible updates in Window function.
038430200529      *
038440200529     C     DDACTN        IFNE      WDDACTN
038450200529     C     DDPREF        ORNE      WDDPREF
038460200529      **                                                                                      CSC022
038470200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
038480200529      **   job is not currently running in batch mode                                         CSC022
038490200529      **                                                                                      CSC022
038500200529     C                   If        CSC022 = 'N'                                               CSC022
038510200529     C                   ROLBK
038520200529     C                   Else                                                                 CSC022
038530200529     C                   If        WSkpComtRolbk = 'N'                                        CSC022
038540200529     C                   Rolbk                                                                CSC022
038550200529     C                   Else                                                                 CSC022
038560200529     C                   SetOn                                        U7U8                    CSC022
038570200529     C                   EndIf                                                                CSC022
038580200529     C                   EndIf                                                                CSC022
038590200529     C                   ENDIF
038600200529      *
038610200529      ** Save Action Code and Payment Reference.
038620200529      *
038630200529     C                   MOVEL     DDACTN        WDDACTN
038640200529     C                   MOVEL     DDACTN        WDDPREF
038650200529      *
038660200529     C                   ENDIF
038670200529      *
038680200529      ** If Action Code is Insert or Amend, enable Detail
038690200529      ** fields on Level 2 screen 1 (all fields on Level 2
038700200529      ** screen 1 except Action Code and Payment Reference).
038710200529      ** Also, enable F5=Refresh.
038720200529      *
038730200529     C     DDACTN        IFEQ      'I'
038740200529     C     DDACTN        OREQ      'A'
038750200529     C                   MOVEL     'Y'           PEDTFLD
038760200529     C                   MOVEL     'Y'           PEINKE
038770200529     C                   ELSE
038780200529     C                   MOVEL     'N'           PEDTFLD
038790200529     C                   MOVEL     'N'           PEINKE
038800200529     C                   ENDIF
038810200529      *
038820200529      ** Incoming Payments Maintenance has been called by linked
038830200529      ** maintenance/enquiry.
038840200529      *
038850200529     C     PParmLink     IFEQ      'Y'
038860200529      *
038870200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.
038880200529      *
038890200529     C                   MOVEL     'N'           PEINKG
038900200529     C                   MOVEL     'N'           PEINKH
038910200529     C                   MOVEL     'N'           PEINKP
038920200529      *
038930200529      ** If Incoming Payments Maintenance has been called from a Subfile
038940200529      ** program, enable F18=Next Payment.
038950200529      *
038960200529     C     PLinkPgm      IFNE      'GL4442    '
038970200529     C     PLinkPgm      ANDNE     'GL0090    '
038980200529     C                   MOVEL     'Y'           PEINKS
038990200529     C                   ELSE
039000200529     C                   MOVEL     'N'           PEINKS
039010200529     C                   ENDIF
039020200529      *
039030200529     C                   ELSE
039040200529      *
039050200529     C     PParmLevel    IFEQ      '1'                                                        261468
039060200529      *                                                                                       261468
039070200529     C                   MOVEL     'N'           PEINKG                                       261468
039080200529     C                   MOVEL     'N'           PEINKH                                       261468
039090200529     C                   MOVEL     'N'           PEINKP                                       261468
039100200529     C                   MOVEL     'N'           PEINKS                                       261468
039110200529      *                                                                                       261468
039120200529     C                   ELSE                                                                 261468
039130200529      *                                                                                       261468
039140200529     C                   MOVEL     'Y'           PEINKG
039150200529     C                   MOVEL     'Y'           PEINKH
039160200529     C                   MOVEL     'Y'           PEINKP
039170200529     C                   MOVEL     'N'           PEINKS
039180200529      *                                                                                       261468
039190200529     C                   ENDIF                                                                261468
039200200529      *
039210200529     C                   ENDIF
039220200529      *
039230200529      ** If feature CFT007 is switched on and action is Insert or Amend,
039240200529      ** enable F4=Prompt and F16=Search
039250200529      *
039260200529     C                   IF        CFT007 = 'Y' AND
039270200529     C                             (DDACTN = 'I' OR DDACTN = 'A')
039280200529     C                   EVAL      PEINKD = 'Y'
039290200529     C                   EVAL      PEINKQ = 'Y'
039300200529     C                   ELSE
039310200529     C                   EVAL      PEINKD = 'N'
039320200529     C                   EVAL      PEINKQ = 'N'
039330200529     C                   ENDIF
039340200529      *
039350200529      ** Display Level 2 screen 1.
039360200529      *
039370200529     C                   CALLB     'FTIPAY2DP'
039380200529      *                             =========
039390200529      ** INPUT
039400200529      ** =====
039410200529      *
039420200529      ** Return Code
039430200529     C                   PARM      *BLANKS       RetCodeOut
039440200529      *
039450200529      ** Action Code
039460200529     C                   PARM                    DDACTN
039470200529      *
039480200529      ** Payment Reference
039490200529     C                   PARM                    DDPREF
039500200529      *
039510200529      ** Incoming Payments Lvl 2 Scrn 1/1 details from incoming transaction
039520200529      ** - screen format
039530200529     C                   PARM                    NwIP2ScnFmt
039540200529      *
039550200529      ** Incoming Payments Lvl 2 Scrn 1/2 details from incoming transaction
039560200529      ** - screen format
039570200529     C                   PARM                    NwIP3ScnFmt
039580200529      *
039590200529      ** Incoming Payment Status
039600200529     C                   PARM                    PStatus
039610200529      *
039620200529      ** Enable Detail Fields
039630200529     C                   PARM                    PEDTFLD
039640200529      *
039650200529      ** Enable Function Keys
039660200529      ** KD = Command Key 04 = Prompt
039670200529      ** KE = Command Key 05 = Refresh
039680200529      ** KG = Command Key 07 = Read Previous
039690200529      ** KH = Command Key 08 = Read Next
039700200529      ** KP = Command Key 15 = Browse
039710200529      ** KQ = Command Key 16 = Search
039720200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
039730200529     C                   PARM                    PEINKD
039740200529     C                   PARM                    PEINKE
039750200529     C                   PARM                    PEINKG
039760200529     C                   PARM                    PEINKH
039770200529     C                   PARM                    PEINKP
039780200529     C                   PARM                    PEINKQ
039790200529     C                   PARM                    PEINKS
039800200529      *
039810200529      ** Incoming Payments Lvl 2 Scrn 1 error indicators
039820200529     C                   PARM                    FTEIPY2
039830200529      *
039840200529      ** Error fields/message IDs/message data (arrays) from/to caller
039850200529     C                   PARM                    FldNameArr
039860200529     C                   PARM                    MsgIdArr
039870200529     C                   PARM                    MsgDtaArr
039880200529      *
039890200529      ** Warning fields/message Ids/message data (arrays) from/to
039900200529      ** caller
039910200529     C                   PARM                    WFldNamArr
039920200529     C                   PARM                    WMsgIdArr
039930200529     C                   PARM                    WMsgDtaArr
039940200529      *
039950200529      ** Write Screen with No Read Indicator
039960200529     C                   PARM      'N'           PWriteOnly
039970200529      *
039980200529      ** STANDING DATA
039990200529      ** =============
040000200529      *
040010200529      ** SDBANK - System Runday
040020200529     C                   PARM                    BJMRDT
040030200529      *
040040200529      ** SDBANK - Single Branch Code
040050200529     C                   PARM                    BJSBRC
040060200529      *
040070200529      ** SWITCHABLE FEATURES
040080200529      ** ===================
040090200529      *
040100200529      ** BIC database plus
040110200529     C                   PARM                    CFT007
040120200529      *
040130200529      ** OUTPUT
040140200529      ** ======
040150200529      *
040160200529      ** Function Keys Enabled
040170200529      ** KC = Command Key 03 = Exit
040180200529      ** KD = Command Key 04 = Prompt
040190200529      ** KE = Command Key 05 = Refresh
040200200529      ** KG = Command Key 07 = Read Previous
040210200529      ** KH = Command Key 08 = Read Next
040220200529      ** KL = Command Key 12 = Cancel
040230200529      ** KP = Command Key 15 = Browse
040240200529      ** KQ = Command Key 16 = Search
040250200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
040260200529     C                   PARM                    PINKC
040270200529     C                   PARM                    PINKD
040280200529     C                   PARM                    PINKE
040290200529     C                   PARM                    PINKG
040300200529     C                   PARM                    PINKH
040310200529     C                   PARM                    PINKL
040320200529     C                   PARM                    PINKP
040330200529     C                   PARM                    PINKQ
040340200529     C                   PARM                    PINKS
040350200529      *
040360200529      ** Cursor position
040370200529     C                   PARM                    PRowCol
040380200529      *
040390200529      ** Save Warning Message Ids array of Level 2 screen 1.
040400200529      *
040410200529     C                   MOVEL     WMsgIDArr     WPrvWarnAr
040420200529      *
040430200529      ** Reset error fields.
040440200529      *
040450200529     C                   EXSR      SRResetErr
040460200529
040470200529     C                   SELECT
040480200529      *
040490200529      ** F3 - end program.
040500200529      *
040510200529     C     PINKC         WHENEQ    *ON
040520200529     C                   EXSR      SREndP
040530200529      *
040540200529      ** F4 or F16 - BIC processing
040550200529      *
040560200529     C     PINKD         WHENEQ    *ON
040570200529     C     PINKQ         OREQ      *ON
040580200529     C                   EXSR      SRBIC2
040590200529      *
040600200529      ** F5 - refresh Level 2 screen 1.
040610200529      *
040620200529     C     PINKE         WHENEQ    *ON
040630200529     C                   MOVEL     CrIP2ScnFmt   NwIP2ScnFmt
040640200529     C                   MOVEL     CrIP3ScnFmt   NwIP3ScnFmt
040650200529      *
040660200529      ** F7 - roll backwards.
040670200529      *
040680200529     C     PINKG         WHENEQ    *ON
040690200529      *                                                                                       261468
040700200529      ** Call CL program to deallocate this reference to a dataarea                           261468
040710200529      *                                                                                       261468
040720200529     C     PParmLevel    IFEQ      '2'                                                        261468
040730200529      *                                                                                       261468
040740200529     C                   EVAL      C#RTCD = *Blanks                                           261468
040750200529     C                   EVAL      @MODLE = 'FT'                                              261468
040760200529     C                   EVAL      @TREF  = *Blanks                                           261468
040770200529     C                   EVAL      @RTINF = *Blanks                                           261468
040780200529      *                                                                                       261468
040790200529     C                   CALL      'AOC8000'                                                  261468
040800200529     C                   PARM                    C#RTCD            7                          261468
040810200529     C                   PARM                    @MODLE            2                          261468
040820200529     C                   PARM                    @TREF            15                          261468
040830200529     C                   PARM                    @RTINF           80                          261468
040840200529      *                                                                                       261468
040850200529     C                   MOVEL     *BLANKS       PRDNB                                        261468
040860200529     C                   MOVEL     *BLANKS       DDACTN                                       261468
040870200529     C                   MOVEL     *BLANKS       DDPREF                                       261468
040880200529     C                   MOVEL     *BLANKS       DDSWTN                                       261468
040890200529     C                   MOVEL     *BLANKS       DDSEQNO                                      261468
040900200529     C                   MOVEL     *BLANKS       DDBRCA                                       261468
040910200529      *                                                                                       261468
040920200529     C                   EXSR      SRRoll
040930200529      *                                                                                       261468
040940200529     C                   ENDIF                                                                261468
040950200529      *
040960200529      ** F8 - roll forwards.
040970200529      *
040980200529     C     PINKH         WHENEQ    *ON
040990200529      *                                                                                       261468
041000200529      ** Call CL program to deallocate this reference to a dataarea                           261468
041010200529      *                                                                                       261468
041020200529     C     PParmLevel    IFEQ      '2'                                                        261468
041030200529      *                                                                                       261468
041040200529     C                   EVAL      C#RTCD = *Blanks                                           261468
041050200529     C                   EVAL      @MODLE = 'FT'                                              261468
041060200529     C                   EVAL      @TREF  = *Blanks                                           261468
041070200529     C                   EVAL      @RTINF = *Blanks                                           261468
041080200529      *                                                                                       261468
041090200529     C                   CALL      'AOC8000'                                                  261468
041100200529     C                   PARM                    C#RTCD            7                          261468
041110200529     C                   PARM                    @MODLE            2                          261468
041120200529     C                   PARM                    @TREF            15                          261468
041130200529     C                   PARM                    @RTINF           80                          261468
041140200529      *                                                                                       261468
041150200529     C                   MOVEL     *BLANKS       PRDNB                                        261468
041160200529     C                   MOVEL     *BLANKS       DDACTN                                       261468
041170200529     C                   MOVEL     *BLANKS       DDPREF                                       261468
041180200529     C                   MOVEL     *BLANKS       DDSWTN                                       261468
041190200529     C                   MOVEL     *BLANKS       DDSEQNO                                      261468
041200200529     C                   MOVEL     *BLANKS       DDBRCA                                       261468
041210200529      *                                                                                       261468
041220200529     C                   EXSR      SRRoll
041230200529      *                                                                                       261468
041240200529     C                   ENDIF                                                                261468
041250200529      *
041260200529      ** F12 - cancel.
041270200529      *
041280200529     C     PINKL         WHENEQ    *ON
041290200529      *
041300200529      ** If entry point is Level 1, refresh Level 2 screen 1
041310200529      ** and redisplay Level 1 screen.
041320200529      *
041330200529     C     PParmLevel    IFEQ      '1'
041340200529      *
041350200529     C**********         MOVEL     CrIP2ScnFmt   NwIP2ScnFmt                                  226722
041360200529     C**********         MOVEL     CrIP3ScnFmt   NwIP3ScnFmt                                  226722
041370200529     C                   MOVEL     'P'           WScrn
041380200529      *
041390200529      ** Entry point is Level 2.
041400200529      *
041410200529     C                   ELSE
041420200529      *
041430200529      ** If Incoming Payments Maintenance has been called by
041440200529      ** linked maintenance/enquiry, terminate program.
041450200529      *
041460200529     C     PParmLink     IFEQ      'Y'
041470200529      *
041480200529     C                   MOVEL     '5'           PParmRtcd
041490200529     C                   MOVEL     'T'           WScrn
041500200529      *
041510200529     C                   ELSE
041520200529      *                                                                                       261468
041530200529      ** Call CL program to deallocate this reference to a dataarea                           261468
041540200529      *                                                                                       261468
041550200529     C                   EVAL      C#RTCD = *Blanks                                           261468
041560200529     C                   EVAL      @MODLE = 'FT'                                              261468
041570200529     C                   EVAL      @TREF  = *Blanks                                           261468
041580200529     C                   EVAL      @RTINF = *Blanks                                           261468
041590200529      *                                                                                       261468
041600200529     C                   CALL      'AOC8000'                                                  261468
041610200529     C                   PARM                    C#RTCD            7                          261468
041620200529     C                   PARM                    @MODLE            2                          261468
041630200529     C                   PARM                    @TREF            15                          261468
041640200529     C                   PARM                    @RTINF           80                          261468
041650200529      *
041660200529      ** Otherwise, display Initial screen with blank fields.
041670200529      ** Reset Read Next Browse Subfile Record indicator.
041680200529      *
041690200529     C                   MOVEL     *BLANK        PRDNB
041700200529     C                   MOVEL     *BLANKS       DDACTN
041710200529     C                   MOVEL     *BLANKS       DDPREF
041720200529     C                   MOVEL     *BLANKS       DDSWTN
041730200529     C                   MOVEL     *BLANKS       DDSEQNO
041740200529     C                   MOVEL     *BLANKS       DDBRCA
041750200529     C                   MOVEL     'I'           WScrn
041760200529      *
041770200529     C                   ENDIF
041780200529      *
041790200529     C                   ENDIF
041800200529      *
041810200529      ** F15 - build Browse.
041820200529      *
041830200529     C     PINKP         WHENEQ    *ON
041840200529      *                                                                                       261468
041850200529      ** Call CL program to deallocate this reference to a dataarea                           261468
041860200529      *                                                                                       261468
041870200529     C     PParmLevel    IFEQ      '2'                                                        261468
041880200529      *                                                                                       261468
041890200529     C                   EVAL      C#RTCD = *Blanks                                           261468
041900200529     C                   EVAL      @MODLE = 'FT'                                              261468
041910200529     C                   EVAL      @TREF  = *Blanks                                           261468
041920200529     C                   EVAL      @RTINF = *Blanks                                           261468
041930200529      *                                                                                       261468
041940200529     C                   CALL      'AOC8000'                                                  261468
041950200529     C                   PARM                    C#RTCD            7                          261468
041960200529     C                   PARM                    @MODLE            2                          261468
041970200529     C                   PARM                    @TREF            15                          261468
041980200529     C                   PARM                    @RTINF           80                          261468
041990200529      *                                                                                       261468
042000200529     C                   MOVEL     *BLANKS       PRDNB                                        261468
042010200529     C                   MOVEL     *BLANKS       DDACTN                                       261468
042020200529     C                   MOVEL     *BLANKS       DDPREF                                       261468
042030200529     C                   MOVEL     *BLANKS       DDSWTN                                       261468
042040200529     C                   MOVEL     *BLANKS       DDSEQNO                                      261468
042050200529     C                   MOVEL     *BLANKS       DDBRCA                                       261468
042060200529      *                                                                                       261468
042070200529     C                   EXSR      SRBldBrw
042080200529      *                                                                                       261468
042090200529     C                   ENDIF                                                                261468
042100200529      *
042110200529      ** F18 - next Payment.  Read next subfile record in linked
042120200529      ** maintenance/enquiry.
042130200529      *
042140200529     C     PINKS         WHENEQ    *ON
042150200529     C                   MOVEL     '7'           PParmRtcd
042160200529     C                   MOVEL     'T'           WScrn
042170200529      *
042180200529      ** Enter key was pressed.
042190200529      *
042200200529     C                   OTHER
042210200529      *
042220200529      ** If Action is Insert or Amend, validate input to
042230200529      ** Level 2 screen 1.
042240200529      *
042250200529     C     DDACTN        IFEQ      'I'
042260200529     C     DDACTN        OREQ      'A'
042270200529      *
042280200529     C                   EXSR      SRVal_S
042290200529     C     WScrn         IFEQ      'C'                                                        226722
042300200529     C     DDTRCT        IFEQ      *BLANKS                                                    226722
042310200529     C     WTRCT         IFNE      *BLANKS                                                    226722
042320200529     C                   MOVE      WTRCT         DDTRCT                                       226722
042330200529     C                   ELSE                                                                 226722
042340200529     C                   MOVE      PYDFTRCT      DDTRCT                                       226722
042350200529     C                   ENDIF                                                                226722
042360200529     C                   ENDIF                                                                226722
042370200529     C                   ENDIF                                                                226722
042380200529      *
042390200529     C                   ELSE
042400200529      *
042410200529      ** If entry point is Level 2 and Windows processing is on,
042420200529      ** display Window screen.
042430200529      *
042440200529     C     PParmLevel    IFEQ      '2'
042450200529     C     BGWDPR        ANDEQ     'Y'
042460200529      *
042470200529     C                   MOVEL     'W'           WScrn
042480200529      *
042490200529     C                   ELSE
042500200529      *
042510200529      ***Compute*Charges*and*Commissions,*and*Total*VAT*Amounts*based*on        CFT014
042520200529      ***Level*1*details.**********************************************         CFT014
042530200529      *****************************************************************         CFT014
042540200529     C*****              EXSR      SRCCVatL1                                    CFT014
042550200529      *****************************************************************         CFT014
042560200529      ***Do*defaulting*of*Charges*and*Commission*details*on*Level*2****         CFT014
042570200529      ***screen*2.*****************************************************         CFT014
042580200529      *****************************************************************         CFT014
042590200529     C*****              EXSR      SRCDefault                                   CFT014
042600200529      *
042610200529      ** Display Level 2 Screen 2.
042620200529      *
042630200529     C                   MOVEL     'C'           WScrn
042640200529      *
042650200529     C                   ENDIF
042660200529      *
042670200529     C                   ENDIF
042680200529      *
042690200529     C                   ENDSL
042700200529      *
042710200529     C                   ENDSR
042720200529      *
042730200529      *****************************************************************
042740200529      /EJECT
042750200529      *****************************************************************
042760200529      *                                                               *
042770200529      *  SRVal_S - Validate input to Level 2 Screen 1                 *
042780200529      *                                                               *
042790200529      *****************************************************************
042800200529      *
042810200529     C     SRVal_S       BEGSR
042820200529      *
042830200529     C                   CALLB     'FTIPAY2VL'
042840200529      *                             =========
042850200529      ** INPUT
042860200529      ** =====
042870200529      *
042880200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
042890200529      ** Mode = '      ' (Not Front Office Transaction Interface)
042900200529      ** Mode = '*RPR  ' (Repair Function)
042910200529      ** Mode = '*SIN  ' (Screen Input Function)
042920200529     C                   PARM                    PMode
042930200529      *
042940200529      ** Response Mode
042950200529     C                   PARM                    PResponse
042960200529      *                                                                         CFT014
042970200529      ** Incoming Payments Lvl 1 Scrn format definition file 2                  CFT014
042980200529     C                   PARM                    NwIP1AScnFmt                   CFT014
042990200529      *
043000200529      ** Incoming Payments Lvl 2 Scrn 1/1 details from incoming transaction
043010200529      ** - screen format
043020200529     C                   PARM                    NwIP2ScnFmt
043030200529      *
043040200529      ** Incoming Payments Lvl 2 Scrn 1/2 details from incoming transaction
043050200529      ** - screen format
043060200529     C                   PARM                    NwIP3ScnFmt
043070200529      *
043080200529      ** Incoming Payments extra data
043090200529     C                   PARM                    PExtData
043100200529      *
043110200529      ** Charges Branch
043120200529     C                   PARM                    PPYBR             3
043130200529      *
043140200529      ** STANDING DATA
043150200529      ** =============
043160200529      *
043170200529      ** SDBANK - Base Currency Code
043180200529     C                   PARM                    BJCYCD
043190200529      *
043200200529      ** SDBANK - Midas Run Date
043210200529     C**********         PARM                    BJRDNB                                       CSC011
043220200529     C                   PARM                    PPROCDTE                                     CSC011
043230200529      *
043240200529      ** SDBANK - Back Value Period in Days
043250200529     C                   PARM                    BJBVPD
043260200529      *
043270200529      ** SDBANK - Single Branch Code
043280200529     C                   PARM                    BJSBRC
043290200529      *
043300200529      ** SDMMOD - Multibranch Indicator
043310200529     C                   PARM                    BGMBIN            1
043320200529      *
043330200529      ** SDMMOD - Retail Banking
043340200529     C                   PARM                    BGRTBN            1
043350200529      *
043360200529      ** SDRETL - Retail A/c Number Required?
043370200529     C                   PARM                    BMRANR
043380200529      *                                                                         CFT014
043390200529      ** MT103 Messages Generation for FT                                       CFT014
043400200529     C                   PARM                    CFT014                         CFT014
043410200529      *                                                                                       250600
043420200529      ** Debit Account                                                                        250600
043430200529     C                   PARM                    PDBACT           24                          250600
043440200529      *                                                                                       250600
043450200529      ** Credit Account                                                                       250600
043460200529     C                   PARM                    PCDACT           24                          250600
043470200529      *                                                                                       250600
043480200529      ** Network                                                                              250600
043490200529     C                   PARM                    PNWRK                                        250600
043500200529      *
043510200529      ** OUTPUT
043520200529      ** ======
043530200529      *
043540200529      ** Error fields/message IDs/message data (arrays) from/to caller
043550200529     C                   PARM                    FldNameArr
043560200529     C                   PARM                    MsgIdArr
043570200529     C                   PARM                    MsgDtaArr
043580200529      *
043590200529      ** Array index (3P0) from/to caller
043600200529     C                   PARM                    IDx
043610200529      *
043620200529      ** Warning flds/message IDs/message data (arrays) from/to caller
043630200529     C                   PARM                    WFldNamArr
043640200529     C                   PARM                    WMsgIdArr
043650200529     C                   PARM                    WMsgDtaArr
043660200529      *
043670200529      ** Array index (3P0) from/to caller
043680200529     C                   PARM                    WIDx
043690200529      *
043700200529      ** Incoming Payments Lvl 2 Scrn 1 error indicators
043710200529     C                   PARM                    FTEIPY2
043720200529      *
043730200529      ** Incoming Payments for file update - file format
043740200529     C                   PARM                    NwIPFilFmt
043750200529      *
043760200529     C                   MOVEL     *BLANK        WRedisplay
043770200529      *
043780200529      ** If no errors occurred during validation of fields on Level 2
043790200529      ** screen 1, check if there are warnings which have not been
043800200529      ** displayed yet.
043810200529      *
043820200529     C                   IF        IDx = 0
043830200529      *
043840200529     C                   Z-ADD     1             WIx
043850200529      *
043860200529     C     WIx           DOWLE     WIDx
043870200529     C     WRedisplay    ANDEQ     *BLANK
043880200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)
043890200529     C                   EVAL      WRedisplay = 'Y'
043900200529     C                   ELSE
043910200529     C                   EVAL      WIx =WIx + 1
043920200529     C                   ENDIF
043930200529     C                   ENDDO
043940200529      *
043950200529     C                   ENDIF
043960200529      *
043970200529      ** Redisplay Level 2 screen 1 if there are errors or if there
043980200529      ** are warnings which have not been displayed yet.
043990200529      *
044000200529     C                   IF        IDx <> 0 or
044010200529     C                             WRedisplay = 'Y'
044020200529     C                   GOTO      EVal_S
044030200529     C                   ENDIF
044040200529      *
044050200529      ** If entry is Level 2 and Windows processing in on,
044060200529      ** display Window screen.
044070200529      *
044080200529     C     PParmLevel    IFEQ      '2'
044090200529     C     BGWDPR        ANDEQ     'Y'
044100200529      *
044110200529     C                   MOVEL     'W'           WScrn
044120200529      *
044130200529     C                   ELSE
044140200529      *
044150200529      ***Compute*Charges*and*Commissions,*and*Total*VAT*Amounts*based*on        CFT014
044160200529      ***Level*1*details.**********************************************         CFT014
044170200529      *****************************************************************         CFT014
044180200529     C*****              EXSR      SRCCVatL1                                    CFT014
044190200529      *****************************************************************         CFT014
044200200529      ***Do*defaulting*of*Charges*and*Commission*details*on*Level*2****         CFT014
044210200529      ***screen*2.*****************************************************         CFT014
044220200529      *****************************************************************         CFT014
044230200529     C*****              EXSR      SRCDefault                                   CFT014
044240200529      *
044250200529     C     WIDx          IFNE      0                                                          195545
044260200529     C     Idx           ANDEQ     0                                                          195545
044270200529     C                   CLEAR                   WFldNamArr                                   195545
044280200529     C                   CLEAR                   WMsgIdArr                                    195545
044290200529     C                   CLEAR                   WMsgDtaArr                                   195545
044300200529     C                   CLEAR                   WIDx                                         195545
044310200529     C                   END                                                                  195545
044320200529      *                                                                                       195545
044330200529      ** Display Level 2 Screen 2.
044340200529      *
044350200529     C                   MOVEL     'C'           WScrn
044360200529      *
044370200529     C                   ENDIF
044380200529      *
044390200529     C     EVal_S        ENDSR
044400200529      *
044410200529      *****************************************************************
044420200529      /EJECT
044430200529      *****************************************************************
044440200529      *                                                               *
044450200529      *  SRCCVatL1 - Compute Charges and Commissions, and Total VAT   *
044460200529      *              Amounts based on Level 1 Details                 *
044470200529      *                                                               *
044480200529      *****************************************************************
044490200529      *
044500200529     C     SRCCVatL1     BEGSR
044510200529      *
044520200529     C                   CALLB     'FTIPAY1CH'
044530200529      *                             =========
044540200529      ** INPUT
044550200529      ** =====
044560200529      *
044570200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
044580200529      ** - screen format
044590200529     C                   PARM                    NwIP1ScnFmt
044600200529      *
044610200529      ** Incoming Payments retrieved from file - file format
044620200529     C                   PARM                    CrIPFilFmt
044630200529      *                                                                         CFT014
044640200529      ** Incoming Payments (extension) retrieved from file - file fmt           CFT014
044650200529     C                   PARM                    CrIP2FilFmt                    CFT014
044660200529      *                                                                         CFT014
044670200529      ** Incoming Payments (extension) for file update - file format            CFT014
044680200529     C                   PARM                    NwIP2FilFmt                    CFT014
044690200529      *
044700200529      ** Charges Branch
044710200529     C                   PARM                    PPYBR
044720200529      *
044730200529      ** Base Currency No. of Decimal Places
044740200529     C                   PARM                    PBCDP
044750200529      *
044760200529      ** Local Currency No. of Decimal Places
044770200529     C                   PARM                    PLCDP
044780200529      *
044790200529      ** Local Currency Multiply/Divide Indicator
044800200529     C                   PARM                    PLMDIN
044810200529      *
044820200529      ** Local Currency Spot Rate
044830200529     C                   PARM                    PLSPOT
044840200529      *
044850200529      ** Entry Point
044860200529     C                   PARM                    PParmLevel
044870200529      *
044880200529      ** STANDING DATA
044890200529      ** =============
044900200529      *
044910200529      ** SDBANK - Base Currency Code
044920200529     C                   PARM                    BJCYCD
044930200529      *
044940200529      ** SDBANK - Local Currency Code
044950200529     C                   PARM                    BJLCCY
044960200529      *
044970200529      ** SDFTFR - Charges Currency
044980200529     C                   PARM                    BTCHCY
044990200529      *
045000200529      ** VAT Rate
045010200529     C                   PARM                    PVATR
045020200529      *
045030200529      ** SWITCHABLE FEATURES
045040200529      ** ===================
045050200529      *
045060200529      ** BLI FT Enhancements Feature
045070200529     C                   PARM                    S01494
045080200529      *
045090200529      ** BLI VAT Processing Feature
045100200529     C                   PARM                    S01499
045110200529      *
045120200529      ** BLI Payment Charges Enhancements
045130200529     C                   PARM                    S01506
045140200529      *
045150200529      ** BLI Extended Payment Charges
045160200529     C                   PARM                    S01508
045170200529      *                                                                         CFT014
045180200529      ** FT Batch Authorization and Credit Advices                              CFT014
045190200529     C                   PARM                    CFT004                         CFT014
045200200529      *                                                                         CFT014
045210200529      ** STP Phase 2 MT103                                                      CFT014
045220200529     C                   PARM                    CFT014                         CFT014
045230200529      *
045240200529      ** OUTPUT
045250200529      ** ======
045260200529      *
045270200529      ** Incoming Payments for file update - file format
045280200529     C                   PARM                    NwIPFilFmt
045290200529      *
045300200529     C                   ENDSR
045310200529      *
045320200529      *****************************************************************
045330200529      /EJECT
045340200529      *****************************************************************
045350200529      *                                                               *
045360200529      *  SRCDEFAULT - Defaulting of Charges and Commission            *
045370200529      *                                                               *
045380200529      *****************************************************************
045390200529      *
045400200529     C     SRCDefault    BEGSR
045410200529      *
045420200529     C                   CALLB     'FTIPAY3DT'
045430200529      *                             =========
045440200529      ** INPUT
045450200529      ** =====
045460200529      *
045470200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
045480200529      ** - screen format
045490200529     C                   PARM                    NwIP1ScnFmt
045500200529      *
045510200529      ***Incoming*Payments*Lvl*2*Scrn*2*details*from*incoming*transaction       CFT014
045520200529      ***-*screen*format***********************************************         CFT014
045530200529     C*****              PARM                    NwIP4ScnFmt                    CFT014
045540200529      ** Incoming Payments Lvl 2 Scrn 3 details from incoming transaction       CFT014
045550200529      ** - screen format                                                        CFT014
045560200529     C                   PARM                    NwIP5ScnFmt                    CFT014
045570200529      *                                                                         CFT014
045580200529      ** Incoming Payments (additional info) for file update                    CFT014
045590200529      ** - file format                                                          CFT014
045600200529     C                   PARM                    NwIP2FilFmt                    CFT014
045610200529      *
045620200529      ** Incoming Payments retrieved from file - file format
045630200529     C                   PARM                    CrIPFilFmt
045640200529      *
045650200529      ** Payment Type
045660200529     C                   PARM                    PPYTP
045670200529      *
045680200529      ** Charges Branch
045690200529     C                   PARM                    PPYBR
045700200529      *
045710200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
045720200529      ** Mode = '      ' (Not Front Office Transaction Interface)
045730200529      ** Mode = '*RPR  ' (Repair Function)
045740200529      ** Mode = '*SIN  ' (Screen Input Function)
045750200529     C                   PARM                    PMode
045760200529      *                                                                                       187056
045770200529      ** Previous values of 'Charges to the Debit of a/c'                                     187056
045780200529     C                   PARM                    PPrvCDRT          1                          187056
045790200529     C**********         PARM                    PPrvCDRO         12                   187056 CGL029
045800200529     C                   PARM                    PPrvCDRO                                     CGL029
045810200529     C                   PARM                    PPrvCDBR          3                          187056
045820200529      *                                                                                     MD023247
045830200529     C                   PARM                    PPrvCDRC                                   MD023247
045840200529      *                                                                                       187056
045850200529      ** Recalcution flag.                                                                    187056
045860200529     C                   PARM                    PReCalc           1                          187056
045870200529      *
045880200529      ** STANDING DATA
045890200529      ** =============
045900200529      *
045910200529      ** SDBANK - Base Currency Code
045920200529     C                   PARM                    BJCYCD
045930200529      *
045940200529      ** SDBANK - Local Currency Code
045950200529     C                   PARM                    BJLCCY
045960200529      *
045970200529      ** SDFTFR - Charges Currency
045980200529     C                   PARM                    BTCHCY
045990200529      *
046000200529      ** VAT Default Flag
046010200529     C                   PARM                    PVATT
046020200529      *
046030200529      ** VAT Rate
046040200529     C                   PARM                    PVATR
046050200529      *
046060200529      ** SWITCHABLE FEATURES
046070200529      ** ===================
046080200529      *
046090200529      ** BLI FT Enhancements Feature
046100200529     C                   PARM                    S01494
046110200529      *
046120200529      ** BLI VAT Processing Feature
046130200529     C                   PARM                    S01499
046140200529      *
046150200529      ** BLI Payment Charges Enhancements
046160200529     C                   PARM                    S01506
046170200529      *
046180200529      ** BLI Extended Payment Charges
046190200529     C                   PARM                    S01508
046200200529      *                                                                         CFT014
046210200529      ** FT Batch Authorization and Credit Advices                              CFT014
046220200529     C                   PARM                    CFT004                         CFT014
046230200529      *                                                                         CFT014
046240200529      ** MT103 Messages Generation for FT                                       CFT014
046250200529     C                   PARM                    CFT014                         CFT014
046260200529      *                                                                                       CFT120
046270200529      ** FT IN/OP - Charges on DR of Account Ccy                                              CFT120
046280200529      *                                                                                       CFT120
046290200529     C                   PARM                    CFT120                                       CFT120
046300200529      *
046310200529      ** OUTPUT
046320200529      ** ======
046330200529      *
046340200529      ** Input Charge Currency
046350200529     C                   PARM                    PICCY             3
046360200529      *
046370200529      ** Input Charge Currency In Currency Flag
046380200529     C                   PARM                    PIINCY            1
046390200529      *
046400200529      ** Input Charge Currency No. of Decimal Places
046410200529     C                   PARM                    PINBDP            1 0
046420200529      *
046430200529      ** Input Charge Currency EMU Transmission Period Start Date
046440200529     C                   PARM                    PITPSD            5 0
046450200529      *
046460200529      ** Output Charge Currency
046470200529     C                   PARM                    POCCY             3
046480200529      *
046490200529      ** Output Charge Currency In Currency Flag
046500200529     C                   PARM                    POINCY            1
046510200529      *
046520200529      ** Output Charge Currency No. of Decimal Places
046530200529     C                   PARM                    PONBDP            1 0
046540200529      *
046550200529      ** DS for Default Charge Amounts
046560200529     C                   PARM                    PCharges
046570200529      *
046580200529      ** DS for Default Charge Currencies
046590200529     C                   PARM                    PChgCcy
046600200529      *
046610200529      ** Incoming Payments for file update - file format
046620200529     C                   PARM                    NwIPFilFmt
046630200529      *
046640200529      ** Save recalculated Charges.
046650200529      *
046660200529     C*****              MOVEL     NwIP4ScnFmt   CrIP4ScnFmt                    CFT014
046670200529     C                   MOVEL     NwIP5ScnFmt   CrIP5ScnFmt                    CFT014
046680200529     C*******************MOVEL     PCharges      WICharges       108            CFT009
046690200529     C*******************MOVEL     DDTRCD        WDTRCD           12            CFT009
046700200529     C*******************MOVEL     DDTXCD        WDTXCD           12            CFT009
046710200529     C*******************MOVEL     DDCQCD        WDCQCD           12            CFT009
046720200529     C*******************MOVEL     DDADCD        WDADCD           12            CFT009
046730200529     C*******************MOVEL     DDTLCD        WDTLCD           12            CFT009
046740200529     C*******************MOVEL     DDMSCD        WDMSCD           12            CFT009
046750200529     C*******************MOVEL     DDCHCD        WDCHCD           12            CFT009
046760200529      *                                                                         CFT009
046770200529     C                   MOVEL     PCharges      WICharges       196            CFT009
046780200529     C                   MOVEL     DDTRCD        WDTRCD                         CFT009
046790200529     C                   MOVEL     DDTXCD        WDTXCD                         CFT009
046800200529     C                   MOVEL     DDCQCD        WDCQCD                         CFT009
046810200529     C                   MOVEL     DDADCD        WDADCD                         CFT009
046820200529     C                   MOVEL     DDTLCD        WDTLCD                         CFT009
046830200529     C                   MOVEL     DDMSCD        WDMSCD                         CFT009
046840200529     C                   MOVEL     DDCHCD        WDCHCD                         CFT009
046850200529      *
046860200529     C                   ENDSR
046870200529      *
046880200529      *****************************************************************
046890200529      /EJECT
046900200529      *****************************************************************
046910200529      *                                                               *
046920200529      *  SRScrn_C - Process Level 2 screen 2                          *
046930200529      *                                                               *
046940200529      *****************************************************************
046950200529      *
046960200529     C     SRScrn_C      BEGSR
046970200529      *
046980200529      ** If Action Code is Insert or Amend, enable Detail
046990200529      ** fields on Level 2 screen 2 (all fields on Level 2
047000200529      ** screen 2 except Action Code and Payment Reference).
047010200529      ** Also, enable F5=Refresh.
047020200529      *
047030200529     C     DDACTN        IFEQ      'I'
047040200529     C     DDACTN        OREQ      'A'
047050200529     C                   MOVEL     'Y'           PEDTFLD
047060200529     C                   MOVEL     'Y'           PEINKE
047070200529     C                   ELSE
047080200529     C                   MOVEL     'N'           PEDTFLD
047090200529     C                   MOVEL     'N'           PEINKE
047100200529     C                   ENDIF
047110200529     C     *LIKE         DEFINE    DDTRCT        WTRCT                                        226722
047120200529     C                   MOVEL     *BLANKS       WTRCT                                        226722
047130200529      *
047140200529      ** Incoming Payments Maintenance has been called by linked
047150200529      ** maintenance/enquiry.
047160200529      *
047170200529     C     PParmLink     IFEQ      'Y'
047180200529      *
047190200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.
047200200529      *
047210200529     C                   MOVEL     'N'           PEINKG
047220200529     C                   MOVEL     'N'           PEINKH
047230200529     C                   MOVEL     'N'           PEINKP
047240200529      *
047250200529      ** If Incoming Payments Maintenance has been called from a Subfile
047260200529      ** program, enable F18=Next Payment.
047270200529      *
047280200529     C     PLinkPgm      IFNE      'GL4442    '
047290200529     C     PLinkPgm      ANDNE     'GL0090    '
047300200529     C                   MOVEL     'Y'           PEINKS
047310200529     C                   ELSE
047320200529     C                   MOVEL     'N'           PEINKS
047330200529     C                   ENDIF
047340200529      *
047350200529     C                   ELSE
047360200529      *
047370200529     C**********         MOVEL     'Y'           PEINKG                                       261468
047380200529     C**********         MOVEL     'Y'           PEINKH                                       261468
047390200529     C**********         MOVEL     'Y'           PEINKP                                       261468
047400200529     C                   MOVEL     'N'           PEINKG                                       261468
047410200529     C                   MOVEL     'N'           PEINKH                                       261468
047420200529     C                   MOVEL     'N'           PEINKP                                       261468
047430200529     C                   MOVEL     'N'           PEINKS
047440200529      *
047450200529     C                   ENDIF
047460200529      *
047470200529      ** If feature CFT007 is switched on and action is Insert or Amend,
047480200529      ** enable F4=Prompt and F16=Search
047490200529      *
047500200529     C                   IF        CFT007 = 'Y' AND
047510200529     C                             DDACTN = 'I' OR DDACTN = 'A'
047520200529     C                   EVAL      PEINKD = 'Y'
047530200529     C                   EVAL      PEINKQ = 'Y'
047540200529     C                   ELSE
047550200529     C                   EVAL      PEINKD = 'N'
047560200529     C                   EVAL      PEINKQ = 'N'
047570200529     C                   ENDIF
047580200529      *
047590200529      ** Display Level 2 screen 2.
047600200529      *
047610200529     C                   CALLB     'FTIPAY3DP'
047620200529      *                             =========
047630200529      ** INPUT
047640200529      ** =====
047650200529      *
047660200529      ** Return Code
047670200529     C                   PARM      *BLANKS       RetCodeOut
047680200529      *
047690200529      ** Action Code
047700200529     C                   PARM                    DDACTN
047710200529      *
047720200529      ** Payment Reference
047730200529     C                   PARM                    DDPREF
047740200529      *
047750200529      ** Incoming Payments Lvl 2 Scrn 2 details from incoming transaction
047760200529      ** - screen format
047770200529     C                   PARM                    NwIP4ScnFmt
047780200529      *                                                                         CFT014
047790200529      ** Incoming Payments Lvl 2 Scrn 2/2 from transaction - screen fmt         CFT014
047800200529     C                   PARM                    NwIP4aScnFmt                   CFT014
047810200529      *****************************************************************         CFT014
047820200529      ***DS*for*default*Charge*Amounts*********************************         CFT014
047830200529     C*****              PARM                    PCharges                       CFT014
047840200529      *****************************************************************         CFT014
047850200529      ***DS*for*default*Charge*Currencies******************************         CFT014
047860200529     C*****              PARM                    PChgCcy                        CFT014
047870200529      *
047880200529      ** Incoming Payment Status
047890200529     C                   PARM                    PStatus
047900200529      *
047910200529      ** Incoming Payments for file update - file format
047920200529     C                   PARM                    NwIPFilFmt
047930200529      *
047940200529      ** Enable Detail Fields
047950200529     C                   PARM                    PEDTFLD
047960200529      *
047970200529      ** Enable Function Keys
047980200529      ** KD = Command Key 04 = Prompt
047990200529      ** KE = Command Key 05 = Refresh
048000200529      ** KG = Command Key 07 = Read Previous
048010200529      ** KH = Command Key 08 = Read Next
048020200529      ** KP = Command Key 15 = Browse
048030200529      ** KQ = Command Key 16 = Search
048040200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
048050200529     C                   PARM                    PEINKD
048060200529     C                   PARM                    PEINKE
048070200529     C                   PARM                    PEINKG
048080200529     C                   PARM                    PEINKH
048090200529     C                   PARM                    PEINKP
048100200529     C                   PARM                    PEINKQ
048110200529     C                   PARM                    PEINKS
048120200529      *
048130200529      ** Incoming Payments Lvl 2 Scrn 2 error indicators
048140200529     C                   PARM                    FTEIPY3
048150200529      *
048160200529      ** Error fields/message IDs/message data (arrays) from/to caller
048170200529     C                   PARM                    FldNameArr
048180200529     C                   PARM                    MsgIdArr
048190200529     C                   PARM                    MsgDtaArr
048200200529      *
048210200529      ** Warning fields/message Ids/message data (arrays) from/to
048220200529      ** caller
048230200529     C                   PARM                    WFldNamArr
048240200529     C                   PARM                    WMsgIdArr
048250200529     C                   PARM                    WMsgDtaArr
048260200529      *
048270200529      ** Write Screen with No Read Indicator
048280200529     C                   PARM      'N'           PWriteOnly
048290200529      *
048300200529      ** STANDING DATA
048310200529      ** =============
048320200529      *
048330200529      ** SDBANK - System Runday
048340200529     C                   PARM                    BJMRDT
048350200529      *
048360200529      ** SDMMOD - Analytical Accounting
048370200529     C                   PARM                    BGN0ST
048380200529      *
048390200529      ** SWITCHABLE FEATURES
048400200529      ** ===================
048410200529      *
048420200529      ** BLI FT Enhancements Feature
048430200529     C                   PARM                    S01494
048440200529      *
048450200529      ** BLI VAT Processing Feature
048460200529     C                   PARM                    S01499
048470200529      *
048480200529      ** BIC database plus
048490200529     C                   PARM                    CFT007
048500200529      *                                                                         CFT014
048510200529      ** STP Phase 2 MT103 Messages Generation for FT.                          CFT014
048520200529     C                   PARM                    CFT014                         CFT014
048530200529      *                                                                         CFT009
048540200529      ** Fees & Charges                                                         CFT009
048550200529     C                   PARM                    CFT009                         CFT009
048560200529      *
048570200529      ** OUTPUT
048580200529      ** ======
048590200529      *
048600200529      ** Function Keys Enabled
048610200529      ** KC = Command Key 03 = Exit
048620200529      ** KD = Command Key 04 = Prompt
048630200529      ** KE = Command Key 05 = Refresh
048640200529      ** KG = Command Key 07 = Read Previous
048650200529      ** KH = Command Key 08 = Read Next
048660200529      ** KL = Command Key 12 = Cancel
048670200529      ** KP = Command Key 15 = Browse
048680200529      ** KQ = Command Key 16 = Search
048690200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
048700200529     C                   PARM                    PINKC
048710200529     C                   PARM                    PINKD
048720200529     C                   PARM                    PINKE
048730200529     C                   PARM                    PINKG
048740200529     C                   PARM                    PINKH
048750200529     C                   PARM                    PINKL
048760200529     C                   PARM                    PINKP
048770200529     C                   PARM                    PINKQ
048780200529     C                   PARM                    PINKS
048790200529      *
048800200529      ** Cursor position
048810200529     C                   PARM                    PRowCol
048820200529      *
048830200529      ** Save Warning Message Ids array of Level 2 screen 2.
048840200529      *
048850200529     C                   MOVEL     WMsgIDArr     WPrvWarnAr
048860200529     C                   MOVEL     DDTRCT        WTRCT                                        226722
048870200529      *
048880200529      ** Reset error fields.
048890200529      *
048900200529     C                   EXSR      SRResetErr
048910200529      *
048920200529     C                   SELECT
048930200529      *
048940200529      ** F3 - end program.
048950200529      *
048960200529     C     PINKC         WHENEQ    *ON
048970200529     C                   EXSR      SREndP
048980200529      *
048990200529      ** F4 or F16 - BIC processing
049000200529      *
049010200529     C     PINKD         WHENEQ    *ON
049020200529     C     PINKQ         OREQ      *ON
049030200529     C                   EXSR      SRBIC2
049040200529      *
049050200529      ** F5 - refresh Level 2 screen 2.
049060200529      *
049070200529     C     PINKE         WHENEQ    *ON
049080200529     C                   MOVEL     CrIP4ScnFmt   NwIP4ScnFmt
049090200529     C                   MOVEL     CrIP4AScnFmt  NwIP4AScnFmt                   CFT014
049100200529     C*****              MOVEL     WICharges     PCharges                       CFT014
049110200529     C*****              MOVEL     WDTRCD        DDTRCD                         CFT014
049120200529     C*****              MOVEL     WDTXCD        DDTXCD                         CFT014
049130200529     C*****              MOVEL     WDCQCD        DDCQCD                         CFT014
049140200529     C*****              MOVEL     WDADCD        DDADCD                         CFT014
049150200529     C*****              MOVEL     WDTLCD        DDTLCD                         CFT014
049160200529     C*****              MOVEL     WDMSCD        DDMSCD                         CFT014
049170200529     C*****              MOVEL     WDCHCD        DDCHCD                         CFT014
049180200529      *****************************************************************                       261468
049190200529      ***F7*-*roll*backwards.******************************************                       261468
049200200529      *****************************************************************                       261468
049210200529     C*****PINKG         WHENEQ    *ON                                                        261468
049220200529     C**********         EXSR      SRRoll                                                     261468
049230200529      *****************************************************************                       261468
049240200529      ***F8*-*roll*forwards.*******************************************                       261468
049250200529      *****************************************************************                       261468
049260200529     C*****PINKH         WHENEQ    *ON                                                        261468
049270200529     C**********         EXSR      SRRoll                                                     261468
049280200529      *
049290200529      ** F12 - cancel.  Refresh Level 2 screen 2 and redisplay
049300200529      ** Level 2 screen 1.
049310200529      *
049320200529     C     PINKL         WHENEQ    *ON
049330200529     C**********         MOVEL     CrIP4ScnFmt   NwIP4ScnFmt                                  226722
049340200529     C**********         MOVEL     CrIP4AScnFmt  NwIP4AScnFmt                   CFT014        226722
049350200529     C                   MOVEL     'S'           WScrn
049360200529      *****************************************************************                       261468
049370200529      ***F15*-*build*Browse.*******************************************                       261468
049380200529      *****************************************************************                       261468
049390200529     C*****PINKP         WHENEQ    *ON                                                        261468
049400200529     C**********         EXSR      SRBldBrw                                                   261468
049410200529      *
049420200529      ** F18 - next Payment.  Read next subfile record in linked
049430200529      ** maintenance/enquiry.
049440200529      *
049450200529     C     PINKS         WHENEQ    *ON
049460200529     C                   MOVEL     '7'           PParmRtcd
049470200529     C                   MOVEL     'T'           WScrn
049480200529      *
049490200529      ** Enter key was pressed.
049500200529      *
049510200529     C                   OTHER
049520200529      *
049530200529      ** If Action is Insert or Amend, validate input to
049540200529      ** Level 2 screen 2.
049550200529      *
049560200529     C     DDACTN        IFEQ      'I'
049570200529     C     DDACTN        OREQ      'A'
049580200529     C                   EXSR      SRVal_C
049590200529     C                   GOTO      EScrn_C
049600200529      *                                                                         CFT014
049610200529     C                   ELSE                                                   CFT014
049620200529     C                   IF        CFT009 = 'N'                                 CFT009
049630200529      ** Compute Charges and Commissions, and Total VAT Amounts based on        CFT014
049640200529      ** Level 1 details.                                                       CFT014
049650200529     C                   EXSR      SRCCVatL1                                    CFT014
049660200529      ** Do defaulting of Charges and Commission details                        CFT014
049670200529     C                   EXSR      SRCDefault                                   CFT014
049680200529     C                   ENDIF                                                  CFT009
049690200529     C                   ENDIF
049700200529      *
049710200529      ***If*Incoming*Payments*Maintenance*has*been*called*by***********         CFT014
049720200529      ***linked*maintenance/enquiry,*terminate*program.****************         CFT014
049730200529      *****************************************************************         CFT014
049740200529     C*****PParmLink     IFEQ      'Y'                                          CFT014
049750200529     C*****              MOVEL     *BLANK        PParmRtcd                      CFT014
049760200529     C*****              MOVEL     'T'           WScrn                          CFT014
049770200529     C*****              GOTO      EScrn_C                                      CFT014
049780200529     C*****              ENDIF                                                  CFT014
049790200529      *****************************************************************         CFT014
049800200529      ***Read*Next*Browse*Subfile*record.******************************         CFT014
049810200529      *****************************************************************         CFT014
049820200529     C*****PRDNB         IFEQ      'Y'                                          CFT014
049830200529     C*****              MOVEL     'R'           WScrn                          CFT014
049840200529     C*****              GOTO      EScrn_C                                      CFT014
049850200529     C*****              ENDIF                                                  CFT014
049860200529      *****************************************************************         CFT014
049870200529      *****************************************************************         CFT014
049880200529      ***Otherwise,*display*Initial*screen*with*blank*fields.**********         CFT014
049890200529      *****************************************************************         CFT014
049900200529     C*****              MOVEL     *BLANKS       DDACTN                         CFT014
049910200529     C*****              MOVEL     *BLANKS       DDPREF                         CFT014
049920200529     C*****              MOVEL     *BLANKS       DDSWTN                         CFT014
049930200529     C*****              MOVEL     *BLANKS       DDSEQNO                        CFT014
049940200529     C*****              MOVEL     *BLANKS       DDBRCA                         CFT014
049950200529     C*****              MOVEL     'I'           WScrn                          CFT014
049960200529      *                                                                         CFT014
049970200529      ** Process Level 2 Screen 3 details                                       CFT014
049980200529      *                                                                         CFT014
049990200529     C                   MOVEL     'D'           WScrn                          CFT014
050000200529      *                                                                         CFT014
050010200529      ** Reset work variables for 4th screen.                                   CFT014
050020200529      *                                                                         CFT014
050030200529     C                   IF        CFT014 = 'Y'                                 CFT014
050040200529     C                   EVAL      PPrvDDRCRM = *BLANKS                         CFT014
050050200529     C                   EVAL      PPrvTOTCHG = *Zero                           CFT014
050060200529     C                   ENDIF                                                  CFT014
050070200529      *
050080200529     C                   ENDSL
050090200529      *
050100200529     C     EScrn_C       ENDSR
050110200529      *
050120200529      *****************************************************************
050130200529      /EJECT
050140200529      *****************************************************************
050150200529      *                                                               *
050160200529      *  SRVal_C - Validate input to Level 2 screen 2                 *
050170200529      *                                                               *
050180200529      *****************************************************************
050190200529      *
050200200529     C     SRVal_C       BEGSR
050210200529      *
050220200529     C                   CALLB     'FTIPAY3VL'
050230200529      *                             =========
050240200529      ** INPUT
050250200529      ** =====
050260200529      *
050270200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
050280200529      ** Mode = '      ' (Not Front Office Transaction Interface)
050290200529      ** Mode = '*RPR  ' (Repair Function)
050300200529      ** Mode = '*SIN  ' (Screen Input Function)
050310200529     C                   PARM                    PMode
050320200529      *
050330200529      ** Response Mode
050340200529     C                   PARM                    PResponse
050350200529      *
050360200529      ***Incoming*Payments*Lvl*1*Scrn*details*from*incoming*transaction
050370200529      ***-*screen*format***********************************************
050380200529     C*****              PARM                    NwIP1ScnFmt
050390200529      *
050400200529      ** Incoming Payments Lvl 2 Scrn 2 details from incoming transaction
050410200529      ** - screen format
050420200529     C                   PARM                    NwIP4ScnFmt
050430200529      *                                                                         CFT014
050440200529      ** Incoming Payments Lvl 2 Scrn 2 file 2 from incoming transaction        CFT014
050450200529      ** - screen format                                                        CFT014
050460200529     C                   PARM                    NwIP4AScnFmt                   CFT014
050470200529      *
050480200529      ** Settlement In Currency Indicator
050490200529     C                   PARM                    PSetInCy
050500200529      *
050510200529      ** Settlement EMU Transaction Period Start Date
050520200529     C                   PARM                    PSetTPSD
050530200529      *
050540200529      ** Payment In Currency Indicator
050550200529     C                   PARM                    PPayInCy
050560200529      *
050570200529      ** Payment EMU Transaction Period Start Date
050580200529     C                   PARM                    PPayTPSD
050590200529      *
050600200529      ** Input Charge Currency
050610200529     C                   PARM                    PICCY
050620200529      *
050630200529      ** Input Charge Currency No. of Decimal Places
050640200529     C                   PARM                    PINBDP
050650200529      *
050660200529      ** Output Charge Currency
050670200529     C                   PARM                    POCCY
050680200529      *
050690200529      ** Output Charge Currency No. of Decimal Places
050700200529     C                   PARM                    PONBDP
050710200529      *
050720200529      ** Incoming Payments extra data
050730200529     C                   PARM                    PExtData
050740200529      *                                                                         CFT014
050750200529      ** Charges Branch                                                         CFT014
050760200529     C                   PARM                    PPYBR             3            CFT014
050770200529      *
050780200529      ** STANDING DATA
050790200529      ** =============
050800200529      *
050810200529      ** SDGELR - Currency Code for Euro
050820200529     C                   PARM                    BKEURO
050830200529      *
050840200529      ** SDMMOD - Analytical Accounting
050850200529     C                   PARM                    BGN0ST
050860200529      *
050870200529      ** VAT Default Flag
050880200529     C                   PARM                    PVATT
050890200529      *
050900200529      ** VAT Rate
050910200529     C                   PARM                    PVATR
050920200529      *
050930200529      ** SWITCHABLE FEATURES
050940200529      ** ===================
050950200529      *
050960200529      ** EMU FT Settlement Currency Conversion
050970200529     C                   PARM                    CEU006
050980200529      *
050990200529      ** BLI FT Enhancements Feature
051000200529     C                   PARM                    S01494
051010200529      *
051020200529      ** BLI VAT Processing Feature
051030200529     C                   PARM                    S01499
051040200529      *                                                                         CFT014
051050200529      ** MT103 Messages Generation for FT                                       CFT014
051060200529     C                   PARM                    CFT014            1            CFT014
051070200529      *                                                                         CFT009
051080200529      ** Fees & Charges                                                         CFT009
051090200529     C                   PARM                    CFT009                         CFT009
051100200529      *
051110200529      ** OUTPUT
051120200529      ** ======
051130200529      *
051140200529      ** Error fields/message IDs/message data (arrays) from/to caller
051150200529     C                   PARM                    FldNameArr
051160200529     C                   PARM                    MsgIdArr
051170200529     C                   PARM                    MsgDtaArr
051180200529      *
051190200529      ** Array index (3P0) from/to caller
051200200529     C                   PARM                    IDx
051210200529      *
051220200529      ** Warning flds/message IDs/message data (arrays) from/to caller
051230200529     C                   PARM                    WFldNamArr
051240200529     C                   PARM                    WMsgIdArr
051250200529     C                   PARM                    WMsgDtaArr
051260200529      *
051270200529      ** Array index (3P0) from/to caller
051280200529     C                   PARM                    WIDx
051290200529      *
051300200529      ** Incoming Payments Lvl 2 Scrn 2 error indicators
051310200529     C                   PARM                    FTEIPY3
051320200529      *
051330200529      ** Incoming Payments for file update - file format
051340200529     C                   PARM                    NwIPFilFmt
051350200529      *                                                                         CFT014
051360200529      ** Incoming Payments (additional details) for file update                 CFT014
051370200529     C                   PARM                    NwIP2FilFmt                    CFT014
051380200529      ***********                                                               CFT014
051390200529      ** DS*for*Default*Charge*Amounts*********************************         CFT014
051400200529     C***********        PARM                    PCharges                       CFT014
051410200529      *
051420200529     C                   MOVEL     *BLANK        WRedisplay
051430200529      *
051440200529      ** If no errors occurred during validation of fields on Level 2
051450200529      ** screen 2, check if there are warnings which have not been
051460200529      ** displayed yet.
051470200529      *
051480200529     C                   IF        IDx = 0
051490200529      *
051500200529     C                   Z-ADD     1             WIx
051510200529      *
051520200529     C     WIx           DOWLE     WIDx
051530200529     C     WRedisplay    ANDEQ     *BLANK
051540200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)
051550200529     C                   EVAL      WRedisplay = 'Y'
051560200529     C                   ELSE
051570200529     C                   EVAL      WIx =WIx + 1
051580200529     C                   ENDIF
051590200529     C                   ENDDO
051600200529      *
051610200529     C                   ENDIF
051620200529      *
051630200529      ** If no errors occurred during validation of Level 2
051640200529      ** screen 2 and if there are no warnings which have not been
051650200529      ** displayed, display Confirmation screen.
051660200529      *
051670200529     C     IDx           IFEQ      *ZERO
051680200529     C     WRedisplay    ANDEQ     *BLANK
051690200529     C*****              MOVEL     'F'           WScrn                          CFT014
051700200529                                                                                CFT009
051710200529     C                   IF        CFT009 = 'N'                                 CFT009
051720200529      *                                                                         CFT014
051730200529      ** Compute Charges and Commissions, and Total VAT Amounts based on        CFT014
051740200529      ** Level 1 details.                                                       CFT014
051750200529      *                                                                         CFT014
051760200529     C                   EXSR      SRCCVatL1                                    CFT014
051770200529      *                                                                         CFT014
051780200529      ** Do defaulting of Charges and Commission details                        CFT014
051790200529      *                                                                         CFT014
051800200529     C                   EXSR      SRCDefault                                   CFT014
051810200529                                                                                CFT009
051820200529     C                   ENDIF                                                  CFT009
051830200529      *                                                                         CFT014
051840200529      ** Display Level 2 Screen 3.                                              CFT014
051850200529      *                                                                         CFT014
051860200529     C                   MOVEL     'D'           WScrn                          CFT014
051870200529      *                                                                         CFT014
051880200529      ** Reset work variables for 4th screen.                                   CFT014
051890200529      *                                                                         CFT014
051900200529     C                   IF        CFT014 = 'Y'                                 CFT014
051910200529     C                   EVAL      PPrvDDRCRM = *BLANKS                         CFT014
051920200529     C                   EVAL      PPrvTOTCHG = *Zero                           CFT014
051930200529     C                   ENDIF                                                  CFT014
051940200529      *                                                                         CFT014
051950200529     C                   ENDIF
051960200529      *
051970200529     C                   ENDSR
051980200529      *
051990200529      *****************************************************************
052000200529      /EJECT                                                                    CFT014
052010200529      *****************************************************************         CFT014
052020200529      *                                                               *         CFT014
052030200529      *  SRScrn_D - Process Level 2 screen 3                          *         CFT014
052040200529      *                                                               *         CFT014
052050200529      *****************************************************************         CFT014
052060200529      *                                                                         CFT014
052070200529     C     SRScrn_D      BEGSR                                                  CFT014
052080200529      *                                                                         CFT014
052090200529      ** If Action Code is Insert or Amend, enable Detail                       CFT014
052100200529      ** fields on Level 2 screen 3 (all fields on Level 2                      CFT014
052110200529      ** screen 3 except Action Code and Payment Reference).                    CFT014
052120200529      ** Also, enable F5=Refresh.                                               CFT014
052130200529      *                                                                         CFT014
052140200529     C     DDACTN        IFEQ      'I'                                          CFT014
052150200529     C     DDACTN        OREQ      'A'                                          CFT014
052160200529     C                   MOVEL     'Y'           PEDTFLD                        CFT014
052170200529     C                   MOVEL     'Y'           PEINKE                         CFT014
052180200529     C                   ELSE                                                   CFT014
052190200529     C                   MOVEL     'N'           PEDTFLD                        CFT014
052200200529     C                   MOVEL     'N'           PEINKE                         CFT014
052210200529     C                   ENDIF                                                  CFT014
052220200529      *                                                                         CFT014
052230200529      ** Incoming Payments Maintenance has been called by linked                CFT014
052240200529      ** maintenance/enquiry.                                                   CFT014
052250200529      *                                                                         CFT014
052260200529     C     PParmLink     IFEQ      'Y'                                          CFT014
052270200529      *                                                                         CFT014
052280200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.                 CFT014
052290200529      *                                                                         CFT014
052300200529     C                   MOVEL     'N'           PEINKG                         CFT014
052310200529     C                   MOVEL     'N'           PEINKH                         CFT014
052320200529     C                   MOVEL     'N'           PEINKP                         CFT014
052330200529      *                                                                         CFT014
052340200529      ** If Incoming Payments Maintenance has been called from a Subfile        CFT014
052350200529      ** program, enable F18=Next Payment.                                      CFT014
052360200529      *                                                                         CFT014
052370200529     C     PLinkPgm      IFNE      'GL4442    '                                 CFT014
052380200529     C     PLinkPgm      ANDNE     'GL0090    '                                 CFT014
052390200529     C                   MOVEL     'Y'           PEINKS                         CFT014
052400200529     C                   ELSE                                                   CFT014
052410200529     C                   MOVEL     'N'           PEINKS                         CFT014
052420200529     C                   ENDIF                                                  CFT014
052430200529      *                                                                         CFT014
052440200529     C                   ELSE                                                   CFT014
052450200529      *                                                                         CFT014
052460200529     C**********         MOVEL     'Y'           PEINKG                                CFT014 261468
052470200529     C**********         MOVEL     'Y'           PEINKH                                CFT014 261468
052480200529     C**********         MOVEL     'Y'           PEINKP                                CFT014 261468
052490200529     C                   MOVEL     'N'           PEINKG                                       261468
052500200529     C                   MOVEL     'N'           PEINKH                                       261468
052510200529     C                   MOVEL     'N'           PEINKP                                       261468
052520200529     C                   MOVEL     'N'           PEINKS                         CFT014
052530200529      *                                                                         CFT014
052540200529     C                   ENDIF                                                  CFT014
052550200529      *                                                                         CFT014
052560200529      ** If feature CFT007 is switched on and action is Insert or Amend,        CFT014
052570200529      ** enable F4=Prompt and F16=Search                                        CFT014
052580200529      *                                                                         CFT014
052590200529     C                   IF        CFT007 = 'Y' AND                             CFT014
052600200529     C                             DDACTN = 'I' OR DDACTN = 'A'                 CFT014
052610200529     C                   EVAL      PEINKD = 'Y'                                 CFT014
052620200529     C                   EVAL      PEINKQ = 'Y'                                 CFT014
052630200529     C                   ELSE                                                   CFT014
052640200529     C                   EVAL      PEINKD = 'N'                                 CFT014
052650200529     C                   EVAL      PEINKQ = 'N'                                 CFT014
052660200529     C                   ENDIF                                                  CFT014
052670200529     C/COPY WNCPYSRC,FTIPAYSC25
052680200529      *                                                                         CFT014
052690200529      ** Display Level 2 screen 3.                                              CFT014
052700200529      *                                                                         CFT014
052710200529     C                   CALLB     'FTIPAY4DP'                                  CFT014
052720200529      *                                                                         CFT014
052730200529      ** INPUT                                                                  CFT014
052740200529      ** =====                                                                  CFT014
052750200529      *                                                                         CFT014
052760200529      ** Return Code                                                            CFT014
052770200529     C                   PARM      *BLANKS       RetCodeOut                     CFT014
052780200529      *                                                                         CFT014
052790200529      ** Action Code                                                            CFT014
052800200529     C                   PARM                    DDACTN                         CFT014
052810200529      *                                                                         CFT014
052820200529      ** Payment Reference                                                      CFT014
052830200529     C                   PARM                    DDPREF                         CFT014
052840200529      *                                                                         CFT014
052850200529      ** Settle Currency                                                        CFT014
052860200529     C                   PARM                    DDSMCY                         CFT014
052870200529      *                                                                         CFT014
052880200529      ** Incoming Payments Lvl 2 Scrn 3 details from incoming transaction       CFT014
052890200529      ** - screen format                                                        CFT014
052900200529     C                   PARM                    NwIP5ScnFmt                    CFT014
052910200529      *                                                                         CFT009
052920200529      ** Incoming Payments for file update - file format                        CFT009
052930200529     C                   PARM                    NwIPFilFmt                     CFT009
052940200529      *                                                                         CFT014
052950200529      ** DS for default Charge Amounts                                          CFT014
052960200529     C                   PARM                    PCharges                       CFT014
052970200529      *                                                                         CFT014
052980200529      ** DS for default Charge Currencies                                       CFT014
052990200529     C                   PARM                    PChgCcy                        CFT014
053000200529      *                                                                         CFT014
053010200529      ** Incoming Payment Status                                                CFT014
053020200529     C                   PARM                    PStatus                        CFT014
053030200529      *                                                                         CFT014
053040200529      ** Enable Detail Fields                                                   CFT014
053050200529     C                   PARM                    PEDTFLD                        CFT014
053060200529      *                                                                         CFT014
053070200529      ** Enable Function Keys                                                   CFT014
053080200529      ** KE = Command Key 05 = Refresh                                          CFT014
053090200529      ** KG = Command Key 07 = Read Previous                                    CFT014
053100200529      ** KH = Command Key 08 = Read Next                                        CFT014
053110200529      ** KP = Command Key 15 = Browse                                           CFT014
053120200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)               CFT014
053130200529      ** KT = Command Key 19 = Margin Info                                      CFT014
053140200529     C                   PARM                    PEINKE                         CFT014
053150200529     C                   PARM                    PEINKG                         CFT014
053160200529     C                   PARM                    PEINKH                         CFT014
053170200529     C                   PARM                    PEINKP                         CFT014
053180200529     C                   PARM                    PEINKS                         CFT014
053190200529     C                   PARM      'Y'           PEINKT            1            CFT014
053200200529      *                                                                         CFT014
053210200529      ** Incoming Payments Lvl 2 Scrn 3 error indicators                        CFT014
053220200529     C                   PARM                    FTEIPY4                        CFT014
053230200529      *                                                                         CFT014
053240200529      ** Error fields/message IDs/message data (arrays) from/to caller          CFT014
053250200529     C                   PARM                    FldNameArr                     CFT014
053260200529     C                   PARM                    MsgIdArr                       CFT014
053270200529     C                   PARM                    MsgDtaArr                      CFT014
053280200529      *                                                                         CFT014
053290200529      ** Warning fields/message Ids/message data (arrays) from/to               CFT014
053300200529      ** caller                                                                 CFT014
053310200529     C                   PARM                    WFldNamArr                     CFT014
053320200529     C                   PARM                    WMsgIdArr                      CFT014
053330200529     C                   PARM                    WMsgDtaArr                     CFT014
053340200529      *                                                                         CFT014
053350200529      ** Write Screen with No Read Indicator                                    CFT014
053360200529     C                   PARM      'N'           PWriteOnly                     CFT014
053370200529      *                                                                         CFT014
053380200529      ** STANDING DATA                                                          CFT014
053390200529      ** =============                                                          CFT014
053400200529      *                                                                         CFT014
053410200529      ** SDBANK - System Runday                                                 CFT014
053420200529     C                   PARM                    BJMRDT                         CFT014
053430200529      *                                                                         CFT014
053440200529      ** SDBANK - Default branch code                                           CFT014
053450200529     C                   PARM                    BJSBRC                         CFT014
053460200529      *                                                                         CFT014
053470200529      ** SDMMOD - Analytical Accounting                                         CFT014
053480200529     C                   PARM                    BGN0ST                         CFT014
053490200529      *                                                                         CFT014
053500200529      ** SWITCHABLE FEATURES                                                    CFT014
053510200529      ** ===================                                                    CFT014
053520200529      *                                                                         CFT014
053530200529      ** BLI FT Enhancements Feature                                            CFT014
053540200529     C                   PARM                    S01494                         CFT014
053550200529      *                                                                         CFT014
053560200529      ** BLI VAT Processing Feature                                             CFT014
053570200529     C                   PARM                    S01499                         CFT014
053580200529      *                                                                         CFT014
053590200529      ** BIC database plus                                                      CFT014
053600200529     C                   PARM                    CFT007                         CFT014
053610200529      *                                                                         CFT014
053620200529      ** MT103 Messages Generation for FT                                       CFT014
053630200529     C                   PARM                    CFT014                         CFT014
053640200529     C/COPY WNCPYSRC,FTIPAYSC26
053650200529      *                                                                         CFT009
053660200529      ** Fees & Charges                                                         CFT009
053670200529     C                   PARM                    CFT009                         CFT009
053680200529     C                   PARM                    CFT010                         CFT009
053690200529      *                                                                         CFT014
053700200529      ** OUTPUT                                                                 CFT014
053710200529      ** ======                                                                 CFT014
053720200529      *                                                                         CFT014
053730200529      ** Function Keys Enabled                                                  CFT014
053740200529      ** KC = Command Key 03 = Exit                                             CFT014
053750200529      ** KE = Command Key 05 = Refresh                                          CFT014
053760200529      ** KG = Command Key 07 = Read Previous                                    CFT014
053770200529      ** KH = Command Key 08 = Read Next                                        CFT014
053780200529      ** KL = Command Key 12 = Cancel                                           CFT014
053790200529      ** KP = Command Key 15 = Browse                                           CFT014
053800200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)               CFT014
053810200529      ** KT = Command Key 19 = Margin Info                                      CFT014
053820200529     C                   PARM                    PINKC                          CFT014
053830200529     C                   PARM                    PINKE                          CFT014
053840200529     C                   PARM                    PINKG                          CFT014
053850200529     C                   PARM                    PINKH                          CFT014
053860200529     C                   PARM                    PINKL                          CFT014
053870200529     C                   PARM                    PINKP                          CFT014
053880200529     C                   PARM                    PINKS                          CFT014
053890200529     C                   PARM                    PINKT             1            CFT014
053900200529      *                                                                         CFT014
053910200529      ** Cursor position                                                        CFT014
053920200529     C                   PARM                    PRowCol                        CFT014
053930200529      *                                                                         CFT009
053940200529      ** Input Charge Currency                                                  CFT009
053950200529     C                   PARM                    PICCY                          CFT009
053960200529      *                                                                         CFT009
053970200529      ** Output Charge Currency                                                 CFT009
053980200529     C                   PARM                    POCCY                          CFT009
053990200529      *                                                                         CFT009
054000200529      ** Charges to the debit of - field changed (Y or blank)                   CFT009
054010200529     C                   PARM                    PCDROCHG          1            CFT009
054020200529      *                                                                                       CFT120
054030200529      ** Control re-display of screen if CDRO is modified                                     CFT120
054040200529      *                                                                                       CFT120
054050200529     C                   IF        CFT120 = 'Y'                                               CFT120
054060200529     C                   MOVEL     PCDROCHG      CDROCHGD          1                          257125
054070200529     C                   ENDIF                                                                CFT120
054080200529      *                                                                         CFT009
054090200529      ** Clear warning message work inds for charges screen                     CFT009
054100200529      *                                                                         CFT009
054110200529     C                   IF        PINKL = *ON                                  CFT009
054120200529     C                   EVAL      PChgWarn = *BLANKS                           CFT009
054130200529     C                   ENDIF                                                  CFT009
054140200529      *
054150200529      ** Save Warning Message Ids array of Level 2 screen 3.
054160200529      *
054170200529     C                   MOVEL     WMsgIDArr     WPrvWarnAr
054180200529      *                                                                         CFT014
054190200529      ** Reset error fields.                                                    CFT014
054200200529      *                                                                         CFT014
054210200529     C                   EXSR      SRResetErr                                   CFT014
054220200529      *                                                                         CFT014
054230200529     C                   SELECT                                                 CFT014
054240200529      *                                                                         CFT014
054250200529      ** F3 - end program.                                                      CFT014
054260200529      *                                                                         CFT014
054270200529     C     PINKC         WHENEQ    *ON                                          CFT014
054280200529     C                   EXSR      SREndP                                       CFT014
054290200529      *                                                                         CFT014
054300200529      ** F5 - refresh Level 2 screen 3.                                         CFT014
054310200529      *                                                                         CFT014
054320200529     C     PINKE         WHENEQ    *ON                                          CFT014
054330200529     C                   MOVEL     CrIP5ScnFmt   NwIP5ScnFmt                    CFT014
054340200529     C                   MOVEL     WICharges     PCharges                       CFT014
054350200529     C                   MOVEL     WDTRCD        DDTRCD                         CFT014
054360200529     C                   MOVEL     WDTXCD        DDTXCD                         CFT014
054370200529     C                   MOVEL     WDCQCD        DDCQCD                         CFT014
054380200529     C                   MOVEL     WDADCD        DDADCD                         CFT014
054390200529     C                   MOVEL     WDTLCD        DDTLCD                         CFT014
054400200529     C                   MOVEL     WDMSCD        DDMSCD                         CFT014
054410200529     C                   MOVEL     WDCHCD        DDCHCD                         CFT014
054420200529      *****************************************************************                CFT014 261468
054430200529      ***F7*-*roll*backwards.******************************************                CFT014 261468
054440200529      *****************************************************************                CFT014 261468
054450200529     C*****PINKG         WHENEQ    *ON                                                 CFT014 261468
054460200529     C**********         EXSR      SRRoll                                              CFT014 261468
054470200529      *****************************************************************                CFT014 261468
054480200529      ***F8*-*roll*forwards.*******************************************                CFT014 261468
054490200529      *****************************************************************                CFT014 261468
054500200529     C*****PINKH         WHENEQ    *ON                                                 CFT014 261468
054510200529     C**********         EXSR      SRRoll                                              CFT014 261468
054520200529      *                                                                         CFT014
054530200529      ** F12 - cancel.  Refresh Level 2 screen 3 and redisplay                  CFT014
054540200529      ** Level 2 screen 2.                                                      CFT014
054550200529      *                                                                         CFT014
054560200529     C     PINKL         WHENEQ    *ON                                          CFT014
054570200529     C                   MOVEL     CrIP5ScnFmt   NwIP5ScnFmt                    CFT014
054580200529     C                   MOVEL     'C'           WScrn                          CFT014
054590200529      *****************************************************************                CFT014 261468
054600200529      ***F15*-*build*Browse.*******************************************                CFT014 261468
054610200529      *****************************************************************                CFT014 261468
054620200529     C*****PINKP         WHENEQ    *ON                                                 CFT014 261468
054630200529     C**********         EXSR      SRBldBrw                                            CFT014 261468
054640200529      *                                                                         CFT014
054650200529      ** F18 - next Payment.  Read next subfile record in linked                CFT014
054660200529      ** maintenance/enquiry.                                                   CFT014
054670200529      *                                                                         CFT014
054680200529     C     PINKS         WHENEQ    *ON                                          CFT014
054690200529     C                   MOVEL     '7'           PParmRtcd                      CFT014
054700200529     C                   MOVEL     'T'           WScrn                          CFT014
054710200529      *                                                                         CFT014
054720200529      ** F19 - Margin Information                                               CFT014
054730200529      *                                                                         CFT014
054740200529     C     PINKT         WHENEQ    *ON                                          CFT014
054750200529      *                                                                                       CER030
054760200529      ** F19 - Margin Information /Extended Narratives                                        CER030
054770200529      *                                                                                       CER030
054780200529     C                   IF        (CER030 = 'Y') OR                                          CER030
054790200529     C                             (CER031 = 'Y') OR                                          CER030
054800200529     C                             (CGL013 = 'Y')                                             CER030
054810200529     C                   MOVEL     'M'           WScrn                                        CER030
054820200529     C                   ELSE                                                                 CER030
054830200529      *                                                                                       CER030
054840200529     C                   IF        (BGN0ST = 'Y')                               CFT014
054850200529     C                   IF        (DDSMCY = DDPCCY)                            CFT014
054860200529     C                             AND (DDMBSI = *BLANK)                        CFT014
054870200529     C                             AND (DDMSIG = *BLANK)                        CFT014
054880200529     C                   ADD       1             Idx                            CFT014
054890200529     C                   Eval      FldNameArr(Idx) = '*ANY'                     CFT014
054900200529     C                   Eval      MsgIdArr(Idx) = 'FTM2554'                    CFT014
054910200529     C                   ELSE                                                   CFT014
054920200529     C                   MOVEL     'M'           WScrn                          CFT014
054930200529     C                   ENDIF                                                  CFT014
054940200529     C                   ENDIF                                                  CFT014
054950200529      *                                                                                       CER030
054960200529     C                   ENDIF                                                                CER030
054970200529      *                                                                         CFT014
054980200529      ** Enter key was pressed.                                                 CFT014
054990200529      *                                                                         CFT014
055000200529     C                   OTHER                                                  CFT014
055010200529      *                                                                         CFT014
055020200529      ** If Action is Insert or Amend, validate input to                        CFT014
055030200529      ** Level 2 screen 3.                                                      CFT014
055040200529      *                                                                         CFT014
055050200529     C     DDACTN        IFEQ      'I'                                          CFT014
055060200529     C     DDACTN        OREQ      'A'                                          CFT014
055070200529     C                   IF        CFT009 = 'N'                                 CFT009
055080200529      *                                                                                       187056
055090200529      ** Perform recalculation of charges if 'charges to the debit of a/c'                    187056
055100200529      ** has been changed.                                                                    187056
055110200529     C                   EXSR      SRReCalc                                                   187056
055120200529      *                                                                                       187056
055130200529     C                   ENDIF                                                  CFT009
055140200529      *                                                                         CFT009
055150200529     C                   EXSR      SRVal_D                                      CFT014
055160200529     C/COPY WNCPYSRC,FTIPAYSC15
055170200529     C                   IF        WIDx = 0                                                   250600
055180200529     C                             And Idx = 0                                                256117
055190200529     C                             And PCDROCHG = *Blanks                                     256256
055200200529     C                             AND CFT120 = 'N'                                           CFT120
055210200529     C                             OR WIDx = 0                                                CFT120
055220200529     C                             And Idx = 0                                                CFT120
055230200529     C                             AND CDROCHGD = *BLANKS                                     257125
055240200529     C                             AND CFT120 = 'Y'                                           CFT120
055250200529     C                   EVAL      WScrn = 'F'                                                250600
055260200529      *                                                                                       CSW209
055270200529      ** Display Cover message if SWIFT 2009 is ON                                            CSW209
055280200529      *                                                                                       CSW209
055290200529     C                   IF        CSW209 = 'Y'                                               CSW209
055300200529     C                   EVAL      WScrn = 'N'                                                CSW209
055310200529      *                                                                                       CSW209
055320200529      ** Reset error fields.                                                                  CSW209
055330200529      *                                                                                       CSW209
055340200529     C                   EXSR      SRResetErr                                                 CSW209
055350200529     C                   ENDIF                                                                CSW209
055360200529     C                   ENDIF                                                                250600
055370200529      *                                                                                       CER001
055380200529      ** ULX611 - window processing                                                           CER001
055390200529      *                                                                                       CER001
055400200529     C                   IF        ULX043 = 'Y'                                               CER001
055410200529     C                             and  BTLVJN = 'Y'                                          CER001
055420200529     C                             or ULX043 = 'Y'                                            CER001
055430200529     C                             and  PParmLevel = '2'                                      CER001
055440200529      *                                                                                       CER001
055450200529      ** New window processing                                                                CER001
055460200529      *                                                                                       CER001
055470200529     C                   EXSR      WINDOWI                                                    CER001
055480200529     C                   ENDIF                                                                CER001
055490200529      *                                                                                       CER001
055500200529     C                   IF        ULX043 = 'Y'                                               CER001
055510200529     C                   EVAL      WScrn = 'L'                                                CER001
055520200529     C                   LEAVESR                                                              CER001
055530200529     C                   ENDIF                                                                CER001
055540200529     C                   IF        WIDx = 0                                                BUG14494A
055550200529     C                             And Idx = 0                                                256117
055560200529     C                             And PCDROCHG = *Blanks                                     256256
055570200529     C                             AND CFT120 = 'N'                                           CFT120
055580200529     C                             OR WIDx = 0                                                CFT120
055590200529     C                             And Idx = 0                                                CFT120
055600200529     C                             AND CDROCHGD = *BLANKS                                     257125
055610200529     C                             AND CFT120 = 'Y'                                           CFT120
055620200529     C                   EVAL      WScrn = 'F'                                             BUG14494A
055630200529     C                   ENDIF                                                             BUG14494A
055640200529      *                                                                                       CER001
055650200529     C                   GOTO      EScrn_D                                      CFT014
055660200529     C                   ENDIF                                                  CFT014
055670200529      *                                                                                       CSW209
055680200529      ** Display Cover message if SWIFT 2009 is ON                                            CSW209
055690200529      ** for Action code not equal to 'I' and 'A'                                             CSW209
055700200529      *                                                                                       CSW209
055710200529     C                   IF        CSW209 = 'Y'                                               CSW209
055720200529     C                   EVAL      WScrn = 'N'                                                CSW209
055730200529     C                   LEAVESR                                                              CSW209
055740200529     C                   ENDIF                                                                CSW209
055750200529     C/COPY WNCPYSRC,FTIPAYSC16
055760200529      *                                                                                       CER001
055770200529      ** Window processing                                                                    CER001
055780200529      *                                                                                       CER001
055790200529     C                   IF        ULX043 = 'Y'                                               CER001
055800200529     C                             and  BTLVJN = 'Y'                                          CER001
055810200529     C                             or ULX043 = 'Y'                                            CER001
055820200529     C                             and  PParmLevel = '2'                                      CER001
055830200529      *                                                                                       CER001
055840200529      ** New window processing                                                                CER001
055850200529      *                                                                                       CER001
055860200529     C                   EXSR      WINDOWI                                                    CER001
055870200529      *                                                                                       CER001
055880200529      **  If F3 or F12 pressed on window, make sure that the Primary or                       CER001
055890200529      **  secondary screen or the subfile is displayed and not initial                        CER001
055900200529      **  screen                                                                              CER001
055910200529      *                                                                                       CER001
055920200529     C                   IF        #RTRN = 'Y2U9999'                                          CER001
055930200529     C                             or #RTRN = 'USR0790'                                       CER001
055940200529     C                   GOTO      EScrn_D                                                    CER001
055950200529     C                   ENDIF                                                                CER001
055960200529      *                                                                                       CER001
055970200529     C                   IF        ULX043 = 'Y'                                               CER001
055980200529     C                   EVAL      WScrn = 'L'                                                CER001
055990200529     C                   LEAVESR                                                              CER001
056000200529     C                   ENDIF                                                                CER001
056010200529      *                                                                                       CER001
056020200529     C                   ENDIF                                                                CER001
056030200529      *                                                                         CFT014
056040200529      ** If Incoming Payments Maintenance has been called by                    CFT014
056050200529      ** linked maintenance/enquiry, terminate program.                         CFT014
056060200529      *                                                                         CFT014
056070200529     C     PParmLink     IFEQ      'Y'                                          CFT014
056080200529     C                   MOVEL     *BLANK        PParmRtcd                      CFT014
056090200529     C                   MOVEL     'T'           WScrn                          CFT014
056100200529     C                   GOTO      EScrn_D                                      CFT014
056110200529     C                   ENDIF                                                  CFT014
056120200529      *                                                                         CFT014
056130200529      ** Read Next Browse Subfile record.                                       CFT014
056140200529      *                                                                         CFT014
056150200529     C     PRDNB         IFEQ      'Y'                                          CFT014
056160200529     C                   MOVEL     'R'           WScrn                          CFT014
056170200529     C                   GOTO      EScrn_D                                      CFT014
056180200529     C                   ENDIF                                                  CFT014
056190200529     C/COPY WNCPYSRC,FTIPAYSC27
056200200529      *                                                                         CFT014
056210200529      ** Otherwise, display Initial screen with blank fields.                   CFT014
056220200529      *                                                                         CFT014
056230200529     C                   MOVEL     *BLANKS       DDACTN                         CFT014
056240200529     C                   MOVEL     *BLANKS       DDPREF                         CFT014
056250200529     C                   MOVEL     *BLANKS       DDSWTN                         CFT014
056260200529     C                   MOVEL     *BLANKS       DDSEQNO                        CFT014
056270200529     C                   MOVEL     *BLANKS       DDBRCA                         CFT014
056280200529     C                   MOVEL     'I'           WScrn                          CFT014
056290200529     C/COPY WNCPYSRC,FTIPAYSC28
056300200529      *                                                                         CFT014
056310200529     C                   ENDSL                                                  CFT014
056320200529      *                                                                         CFT014
056330200529     C     EScrn_D       ENDSR                                                  CFT014
056340200529      *****************************************************************         CFT014
056350200529      /EJECT                                                                    CFT014
056360200529      *****************************************************************         CFT014
056370200529      *                                                               *         CFT014
056380200529      *  SRVal_D - Validate input to Level 2 screen 3                 *         CFT014
056390200529      *                                                               *         CFT014
056400200529      *****************************************************************         CFT014
056410200529      *                                                                         CFT014
056420200529     C     SRVal_D       BEGSR                                                  CFT014
056430200529      *                                                                         CFT014
056440200529     C                   CALLB     'FTIPAY4VL'                                  CFT014
056450200529      *                             =========                                   CFT014
056460200529      *                                                                         CFT014
056470200529      ** INPUT                                                                  CFT014
056480200529      ** =====                                                                  CFT014
056490200529      *                                                                         CFT014
056500200529      ** Mode = '*FRONT' (Front Office Transaction Interface)                   CFT014
056510200529      ** Mode = '      ' (Not Front Office Transaction Interface)               CFT014
056520200529      ** Mode = '*RPR  ' (Repair Function)                                      CFT014
056530200529      ** Mode = '*SIN  ' (Screen Input Function)                                CFT014
056540200529     C                   PARM                    PMode                          CFT014
056550200529      *                                                                         CFT014
056560200529      ** Response Mode                                                          CFT014
056570200529     C                   PARM                    PResponse                      CFT014
056580200529      *                                                                         CFT014
056590200529      ** Incoming Payments Lvl 1 details                                        CFT014
056600200529     C                   PARM                    NwIP1ScnFmt                    CFT014
056610200529      *                                                                         CFT014
056620200529      ** Incoming Payments Lvl 2 Scrn 3 details from incoming transaction       CFT014
056630200529      ** - screen format                                                        CFT014
056640200529     C                   PARM                    NwIP5ScnFmt                    CFT014
056650200529      *                                                                         CFT014
056660200529      ** Settlement In Currency Indicator                                       CFT014
056670200529     C                   PARM                    PSetInCy                       CFT014
056680200529      *                                                                         CFT014
056690200529      ** Settlement EMU Transaction Period Start Date                           CFT014
056700200529     C                   PARM                    PSetTPSD                       CFT014
056710200529      *                                                                         CFT014
056720200529      ** Payment In Currency Indicator                                          CFT014
056730200529     C                   PARM                    PPayInCy                       CFT014
056740200529      *                                                                         CFT014
056750200529      ** Payment EMU Transaction Period Start Date                              CFT014
056760200529     C                   PARM                    PPayTPSD                       CFT014
056770200529      *                                                                         CFT014
056780200529      ** Input Charge Currency                                                  CFT014
056790200529     C                   PARM                    PICCY                          CFT014
056800200529      *                                                                         CFT014
056810200529      ** Input Charge Currency No. of Decimal Places                            CFT014
056820200529     C                   PARM                    PINBDP                         CFT014
056830200529      *                                                                         CFT014
056840200529      ** Output Charge Currency                                                 CFT014
056850200529     C                   PARM                    POCCY                          CFT014
056860200529      *                                                                         CFT014
056870200529      ** Output Charge Currency No. of Decimal Places                           CFT014
056880200529     C                   PARM                    PONBDP                         CFT014
056890200529      *                                                                         CFT009
056900200529      ** Saved default charges                                                  CFT009
056910200529     C                   PARM                    DefValid                       CFT009
056920200529     C                   PARM                    DefValidX                      CFT009
056930200529      *                                                                         CFT014
056940200529      ** STANDING DATA                                                          CFT014
056950200529      ** =============                                                          CFT014
056960200529      *                                                                         CFT014
056970200529      ** SDBANK - Base Currency Code                                            CFT014
056980200529     C                   PARM                    BJCYCD                         CFT014
056990200529      *                                                                         CFT014
057000200529      ** SDBANK - Midas Run Date                                                CFT014
057010200529     C**********         PARM                    BJRDNB                                CFT014 CSC011
057020200529     C                   PARM                    PPROCDTE                                     CSC011
057030200529      *                                                                         CFT014
057040200529      ** SDBANK - Back Value Period in Days                                     CFT014
057050200529     C                   PARM                    BJBVPD                         CFT014
057060200529      *                                                                         CFT014
057070200529      ** SDBANK - Single Branch Code                                            CFT014
057080200529     C                   PARM                    BJSBRC                         CFT014
057090200529      *                                                                         CFT009
057100200529      ** SDBANK - Local currency code                                           CFT009
057110200529     C                   PARM                    BJLCCY                         CFT009
057120200529      *                                                                         CFT014
057130200529      ** SDMMOD - Multibranch Indicator                                         CFT014
057140200529     C                   PARM                    BGMBIN                         CFT014
057150200529      *                                                                         CFT014
057160200529      ** SDMMOD - Retail Banking                                                CFT014
057170200529     C                   PARM                    BGRTBN                         CFT014
057180200529      *                                                                         CFT014
057190200529      ** SDRETL - Retail A/c Number Required?                                   CFT014
057200200529     C                   PARM                    BMRANR                         CFT014
057210200529      *                                                                         CFT014
057220200529      ** SDGELR - Currency Code for Euro                                        CFT014
057230200529     C                   PARM                    BKEURO                         CFT014
057240200529      *                                                                         CFT014
057250200529      ** SDMMOD - Analytical Accounting                                         CFT014
057260200529     C                   PARM                    BGN0ST                         CFT014
057270200529      *                                                                         CFT014
057280200529      ** VAT Default Flag                                                       CFT014
057290200529     C                   PARM                    PVATT                          CFT014
057300200529      *                                                                         CFT014
057310200529      ** VAT Rate                                                               CFT014
057320200529     C                   PARM                    PVATR                          CFT014
057330200529      *                                                                         CFT009
057340200529      ** SDFTFR - Charges calculated in transaction ccy                         CFT009
057350200529     C                   PARM                    CHTRCY                         CFT009
057360200529      *                                                                         CFT009
057370200529      ** SDFTFR - Charges currency indicator                                    CFT009
057380200529     C                   PARM                    BTCHCY                         CFT009
057390200529      *                                                                         CFT009
057400200529      ** SDFTFR - Fixed charge currency                                         CFT009
057410200529     C                   PARM                    FCHCCY                         CFT009
057420200529      *                                                                         CFT014
057430200529      ** SWITCHABLE FEATURES                                                    CFT014
057440200529      ** ===================                                                    CFT014
057450200529      *                                                                         CFT014
057460200529      ** EMU FT Settlement Currency Conversion                                  CFT014
057470200529     C                   PARM                    CEU006                         CFT014
057480200529      *                                                                         CFT014
057490200529      ** BLI FT Enhancements Feature                                            CFT014
057500200529     C                   PARM                    S01494                         CFT014
057510200529      *                                                                         CFT014
057520200529      ** BLI VAT Processing Feature                                             CFT014
057530200529     C                   PARM                    S01499                         CFT014
057540200529      *                                                                         CFT014
057550200529      ** MT103 Messages Generation for FT                                       CFT014
057560200529     C                   PARM                    CFT014                         CFT014
057570200529      *                                                                         CFT009
057580200529      ** Fees & Charges                                                         CFT009
057590200529     C                   PARM                    CFT009                         CFT009
057600200529     C                   PARM                    CFT010                         CFT009
057610200529      *                                                                                       CFT120
057620200529      ** FT IN/OP - Charges on DR of Account Ccy                                              CFT120
057630200529      *                                                                                       CFT120
057640200529     C                   PARM                    CFT120                                       CFT120
057650200529      *                                                                         CFT014
057660200529      ** OUTPUT                                                                 CFT014
057670200529      ** ======                                                                 CFT014
057680200529      *                                                                         CFT014
057690200529      ** Error fields/message IDs/message data (arrays) from/to caller          CFT014
057700200529     C                   PARM                    FldNameArr                     CFT014
057710200529     C                   PARM                    MsgIdArr                       CFT014
057720200529     C                   PARM                    MsgDtaArr                      CFT014
057730200529      *                                                                         CFT014
057740200529      ** Array index (3P0) from/to caller                                       CFT014
057750200529     C                   PARM                    IDx                            CFT014
057760200529      *                                                                         CFT014
057770200529      ** Warning flds/message IDs/message data (arrays) from/to caller          CFT014
057780200529     C                   PARM                    WFldNamArr                     CFT014
057790200529     C                   PARM                    WMsgIdArr                      CFT014
057800200529     C                   PARM                    WMsgDtaArr                     CFT014
057810200529      *                                                                         CFT014
057820200529      ** Array index (3P0) from/to caller                                       CFT014
057830200529     C                   PARM                    WIDx                           CFT014
057840200529      *                                                                         CFT014
057850200529      ** Incoming Payments Lvl 2 Scrn 3 error indicators                        CFT014
057860200529     C                   PARM                    FTEIPY4                        CFT014
057870200529      *                                                                         CFT014
057880200529      ** Incoming Payments for file update - file format                        CFT014
057890200529     C                   PARM                    NwIPFilFmt                     CFT014
057900200529      *                                                                         CFT014
057910200529      ** Incoming Payments (extension) for file update - file format            CFT014
057920200529     C                   PARM                    NwIP2FilFmt                    CFT014
057930200529      *                                                                         CFT014
057940200529      ** DS for Default Charge Amounts                                          CFT014
057950200529     C                   PARM                    PCharges                       CFT014
057960200529      *                                                                         CFT014
057970200529      ** Force redisplay                                                        CFT014
057980200529     C                   PARM      *BLANK        PFrcReDisplay     1            CFT014
057990200529      *                                                                         CFT014
058000200529      ** I/O: Previous Receiver's charges remitted input                        CFT014
058010200529      **      Its value is maintained in FTVIRCRM                               CFT014
058020200529     C                   PARM                    PPrvDDRCRM       12            CFT014
058030200529      *                                                                         CFT014
058040200529      ** I/O: Previous Total charges calculated                                 CFT014
058050200529      **      Its value is maintained in FTVIRCRM                               CFT014
058060200529     C                   PARM                    PPrvTOTCHG       15 0          CFT014
058070200529      *                                                                         CFT009
058080200529      ** Charges to the debit of - field changed (Y or blank)                   CFT009
058090200529     C                   PARM                    PCDROCHG          1            CFT009
058100200529      *                                                                         CFT009
058110200529      ** Previous warning messages array                                        CFT009
058120200529     C                   PARM                    WPrvWarnAr                     CFT009
058130200529      *                                                                         CFT009
058140200529      ** Warning message work inds for charges screen                           CFT009
058150200529     C                   PARM                    PChgWarn                       CFT009
058160200529     C                   PARM                    BENEDrBlck                                 MD025111
058170200529     C                   PARM                    BENEDrRefd                                MD047369A
058180200529      *                                                                         CFT014
058190200529     C                   MOVE      PFrcReDisplay WRedisplay                     CFT014
058200200529      *                                                                         CFT014
058210200529      ** If no errors occurred during validation of fields on Level 2           CFT014
058220200529      ** screen 3, check if there are warnings which have not been              CFT014
058230200529      ** displayed yet.                                                         CFT014
058240200529      *                                                                         CFT014
058250200529     C*******************IF        IDx = 0                                CFT014CFT009
058260200529      *                                                                         CFT014
058270200529     C                   Z-ADD     1             WIx                            CFT014
058280200529     C                   EVAL      WRedisplay = ' '                                         MD022428
058290200529      *                                                                         CFT014
058300200529     C     WIx           DOWLE     WIDx                                         CFT014
058310200529     C     WRedisplay    ANDEQ     *BLANK                                       CFT014
058320200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)            CFT014
058330200529     C                   EVAL      WRedisplay = 'Y'                             CFT014
058340200529     C                   ELSE                                                   CFT014
058350200529     C                   EVAL      WIx =WIx + 1                                 CFT014
058360200529     C                   ENDIF                                                  CFT014
058370200529     C                   ENDDO                                                  CFT014
058380200529      *                                                                         CFT014
058390200529     C**********         ENDIF                                                  CFT014
058400200529                                                                                            MD022428
058410200529     C                   IF        WRedisplay = ' '                                         MD022428
058420200529     C                   CLEAR                   WIDx                                       MD022428
058430200529     C                   IF        IDx = 0                                                  MD025111
058440200529     C                   MOVE      *ALL'Y'       FTEIPY4                                    MD022428
058450200529     C                   ENDIF                                                              MD025111
058460200529     C                   CLEAR                   WfldNamArr                                 MD022428
058470200529     C                   CLEAR                   WMsgIdarr                                  MD022428
058480200529     C                   CLEAR                   WMsgDtaArr                                 MD022428
058490200529     C                   ENDIF                                                              MD022428
058500200529      *                                                                         CFT009
058510200529      ** If no warnings which haven't been displayed then replace               CFT009
058520200529      ** any previous warnings (W) with ok (Y).                                 CFT009
058530200529      *                                                                         CFT009
058540200529     C                   IF        WRedisplay <> 'Y'                            CFT009
058550200529     C                   EVAL      *IN81 = *ON                                  CFT009
058560200529                                                                                CFT009
058570200529     C                   DOW       *IN81 = *ON                                  CFT009
058580200529     C     'W'           SCAN      FTEIPY4:1     @p                3 0    81    CFT009
058590200529                                                                                CFT009
058600200529     C     *IN81         IFEQ      *ON                                          CFT009
058610200529     C                   EVAL      %SUBST(FTEIPY4: @P: 1) = 'Y'                 CFT009
058620200529     C/COPY WNCPYSRC,FTH00514
058630200529     C                   ENDIF                                                  CFT009
058640200529                                                                                CFT009
058650200529     C                   ENDDO                                                  CFT009
058660200529                                                                                CFT009
058670200529     C                   ENDIF                                                  CFT009
058680200529      *                                                                         CFT009
058690200529     C*******************ENDIF                                            CFT014CFT009
058700200529      *                                                                         CFT014
058710200529      ** If no errors occurred during validation of Level 2                     CFT014
058720200529      ** screen 3 and if there are no warnings which have not been              CFT014
058730200529      ** displayed, display Confirmation screen.                                CFT014
058740200529      *                                                                         CFT014
058750200529     C     IDx           IFEQ      *ZERO                                        CFT014
058760200529     C     WRedisplay    ANDEQ     *BLANK                                       CFT014
058770200529     C*****WReDspChg     ANDEQ     'N'                                                  187056CFT009
058780200529     C     WReDspChg     ANDNE     'Y'                                                        CFT009
058790200529      *                                                                                       CER030
058800200529     C                   IF        (CER030 = 'Y') OR                                          CER030
058810200529     C                             (CGL013 = 'Y') OR                                          CER030
058820200529     C                             (BGN0ST = 'Y')                                             CER030
058830200529      *                                                                         CFT014
058840200529      ** If Analytical Accounting is installed, settle and pay currency are     CFT014
058850200529      ** the same and Margin info details is not blank.                         CFT014
058860200529      *                                                                         CFT014
058870200529     C                   IF        (BGN0ST = 'Y') AND                           CFT014
058880200529     C                             DDSMCY = DDPCCY AND                          CFT014
058890200529     C                             DDMBSI <> *BLANK AND                         CFT014
058900200529     C                             DDMSIG <> *BLANK                             CFT014
058910200529     C                   MOVEL     'M'           WScrn                          CFT014
058920200529     C                   EVAL      OKFXMP = 'N'                                 CFT014
058930200529     C                   EVAL      OKMBSI = 'N'                                 CFT014
058940200529     C                   EVAL      OKMSIG = 'N'                                 CFT014
058950200529     C                   Eval      FldNameArr(1) = '*ALL'                       CFT014
058960200529     C                   Eval      MsgIdArr(1) = 'AAM0008'                      CFT014
058970200529      *                                                                                       CER030
058980200529     C                   ENDIF                                                                CER030
058990200529      *                                                                                       CER030
059000200529      ** If transaction type is not linked to transaction code                                CER030
059010200529      ** display screen                                                                       CER030
059020200529      *                                                                                       CER030
059030200529     C                   IF        (CER030 = 'Y') OR                                          CER030
059040200529     C                             (CGL013 = 'Y') OR                                          CER030
059050200529     C                             (CER031 = 'Y')                                             CER030
059060200529      *                                                                                       CER030
059070200529     C                   MOVEA     FldNameArr    FldNamXar                                    CER030
059080200529     C                   MOVEA     MsgIdArr      MsgIDXAr                                     CER030
059090200529      *                                                                                       CER030
059100200529     C                   CALLB     'FTIPAY5VL'                                                CER030
059110200529      *                                                                                       CER030
059120200529      ** INPUT                                                                                CER030
059130200529      *                                                                                       CER030
059140200529      ** Mode = '*FRONT' (Front Office Transaction Interface)                                 CER030
059150200529      ** Mode = '      ' (Not Front Office Transaction Interface)                             CER030
059160200529      ** Mode = '*RPR  ' (Repair Function)                                                    CER030
059170200529      ** Mode = '*SIN  ' (Screen Input Function)                                              CER030
059180200529     C                   PARM                    PMode                                        CER030
059190200529      *                                                                                       CER030
059200200529      ** Response Mode                                                                        CER030
059210200529     C                   PARM                    PResponse                                    CER030
059220200529      *                                                                                       CER030
059230200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction                       CER030
059240200529      ** - screen format                                                                      CER030
059250200529     C                   PARM                    NwIP1ScnFmt                                  CER030
059260200529      *                                                                                       CER030
059270200529      ** Incoming Payments Margin info from incoming transaction                              CER030
059280200529      ** - screen format                                                                      CER030
059290200529     C                   PARM                    NwIP6ScnFmt                                  CER030
059300200529      *                                                                                       CER030
059310200529      ** Incoming Payments Extended Narratives incoming transaction                           CER030
059320200529      ** - screen format                                                                      CER030
059330200529      *                                                                                       CER030
059340200529     C                   PARM                    NwIP6AScnFmt                                 CER030
059350200529      *                                                                                       CER030
059360200529      ** Incoming Payments Transaction Code from screen 2 level 2 for                         CER030
059370200529      ** defaulting value of Retail Transaction Type                                          CER030
059380200529      *                                                                                       CER030
059390200529     C                   PARM                    DDTTCD                                       CER030
059400200529      *                                                                                       CER030
059410200529      ** STANDING DATA                                                                        CER030
059420200529      *                                                                                       CER030
059430200529      ** SDMMOD - Analytical Accounting                                                       CER030
059440200529     C                   PARM                    BGN0ST                                       CER030
059450200529      *                                                                                       CER030
059460200529      ** OUTPUT                                                                               CER030
059470200529      ** ======                                                                               CER030
059480200529      *                                                                                       CER030
059490200529      ** Error fields/message IDs/message data (arrays) from/to caller                        CER030
059500200529     C                   PARM                    FldNameArr                                   CER030
059510200529     C                   PARM                    MsgIdArr                                     CER030
059520200529     C                   PARM                    MsgDtaArr                                    CER030
059530200529      *                                                                                       CER030
059540200529      ** Array index (3P0) from/to caller                                                     CER030
059550200529     C                   PARM                    IDx                                          CER030
059560200529      *                                                                                       CER030
059570200529      ** Warning flds/message IDs/message data (arrays) from/to caller                        CER030
059580200529     C                   PARM                    WFldNamArr                                   CER030
059590200529     C                   PARM                    WMsgIdArr                                    CER030
059600200529     C                   PARM                    WMsgDtaArr                                   CER030
059610200529      *                                                                                       CER030
059620200529      ** Array index (3P0) from/to caller                                                     CER030
059630200529     C                   PARM                    WIDx                                         CER030
059640200529      *                                                                                       CER030
059650200529      ** Incoming Payments Margin info error indicators                                       CER030
059660200529     C                   PARM                    FTEIPY5                                      CER030
059670200529      *                                                                                       CER030
059680200529      ** Incoming Payments for file update - file format                                      CER030
059690200529     C                   PARM                    NwIPFilFmt                                   CER030
059700200529      *                                                                                       CER030
059710200529      ** Extension Valid File Value for Transaction code                                      CER030
059720200529      *                                                                                       CER030
059730200529     C                   PARM                    I2INTTCD                                     CER030
059740200529      *                                                                                       CER030
059750200529      ** Update error information.                                                            CER030
059760200529      *                                                                                       CER030
059770200529     C                   IF        IDx <> *ZEROS                                              CER030
059780200529      *                                                                                       CER030
059790200529     C                   MOVEL     'M'           WScrn                                        CER030
059800200529      *                                                                                       CER030
059810200529     C                   EVAL      Wk = 1                                                     CER030
059820200529     C     *BLANKS       LOOKUP    FldNameArr(Wk)                         92                  CER030
059830200529      *                                                                                       CER030
059840200529     C                   IF        *IN92 = *ON                                                CER030
059850200529     C                   MOVEA     FldNamXar     FldNameArr(Wk)                               CER030
059860200529     C                   MOVEA     MsgIDXAr      MsgIdArr(Wk)                                 CER030
059870200529     C                   ENDIF                                                                CER030
059880200529     C                   ENDIF                                                                CER030
059890200529      *                                                                                       CER030
059900200529     C                   ENDIF                                                                CER030
059910200529      *                                                                                       CER030
059920200529     C     WScrn         DOWEQ     'M'                                          CFT014
059930200529     C                   EXSR      SRScrn_M                                     CFT014
059940200529     C                   ENDDO                                                  CFT014
059950200529      *                                                                         CFT014
059960200529     C                   ELSE
059970200529     C/COPY WNCPYSRC,FTIPAYSC29
059980200529     C                   MOVEL     'F'           WScrn                          CFT014
059990200529      *                                                                                       CSW209
060000200529      ** Display Cover message if SWIFT 2009 is ON                                            CSW209
060010200529      *                                                                                       CSW209
060020200529     C                   IF        CSW209 = 'Y'                                               CSW209
060030200529     C                   EVAL      WScrn = 'N'                                                CSW209
060040200529     C                   ENDIF                                                                CSW209
060050200529     C/COPY WNCPYSRC,FTIPAYSC30
060060200529     C                   ENDIF                                                  CFT014
060070200529      *                                                                         CFT014
060080200529     C                   ELSE                                                                 256117
060090200529     C                   If        Idx > 0                                                    256117
060100200529     C                   Eval      WRedisplay = 'Y'                                           256117
060110200529     C                   endif                                                                256117
060120200529     C                   ENDIF                                                  CFT014
060130200529      *                                                                         CFT014
060140200529     C                   ENDSR                                                  CFT014
060150200529      *                                                                         CFT014
060160200529      *****************************************************************         CFT014
060170200529      /EJECT                                                                    CFT014
060180200529      *****************************************************************         CFT014
060190200529      *                                                               *         CFT014
060200200529      *  SRScrn_M - Process Margin information                        *         CFT014
060210200529      *                                                               *         CFT014
060220200529      *****************************************************************         CFT014
060230200529      *                                                                         CFT014
060240200529     C     SRScrn_M      BEGSR                                                  CFT014
060250200529      *                                                                         CFT014
060260200529      ** If Action Code is Insert or Amend, enable Detail                       CFT014
060270200529      ** fields on Margin info screen                                           CFT014
060280200529      ** Also, enable F5=Refresh.                                               CFT014
060290200529      *                                                                         CFT014
060300200529     C     DDACTN        IFEQ      'I'                                          CFT014
060310200529     C     DDACTN        OREQ      'A'                                          CFT014
060320200529     C                   MOVEL     'Y'           PEDTFLD                        CFT014
060330200529     C                   MOVEL     'Y'           PEINKE                         CFT014
060340200529     C                   ELSE                                                   CFT014
060350200529     C                   MOVEL     'N'           PEDTFLD                        CFT014
060360200529     C                   MOVEL     'N'           PEINKE                         CFT014
060370200529     C                   ENDIF                                                  CFT014
060380200529      *                                                                         CFT014
060390200529      ** Display Margin information screen                                      CFT014
060400200529      *                                                                         CFT014
060410200529     C                   CALLB     'FTIPAY5DP'                                  CFT014
060420200529     C                   Parm      *BLANKS       RetCodeOut                     CFT014
060430200529     C                   PARM                    NwIP1ScnFmt                    CFT014
060440200529     C                   PARM                    NwIP6ScnFmt                    CFT014
060450200529     C                   PARM                    NwIP6AScnFmt                                 CER030
060460200529     C                   PARM                    FTEIPY5                        CFT014
060470200529     C                   PARM                    FldNameArr                     CFT014
060480200529     C                   PARM                    MsgIdArr                       CFT014
060490200529     C                   PARM                    MsgDtaArr                      CFT014
060500200529     C                   PARM                    WFldNamArr                     CFT014
060510200529     C                   PARM                    WMsgIdArr                      CFT014
060520200529     C                   PARM                    WMsgDtaArr                     CFT014
060530200529     C                   PARM                    PEDTFLD                        CFT014
060540200529     C                   PARM                    PINKC                          CFT014
060550200529     C                   PARM                    PINKL                          CFT014
060560200529     C                   PARM                    PINKE                          CFT014
060570200529     C                   PARM      'N'           PWriteOnly                     CFT014
060580200529     C                   PARM                    PRowCol                        CFT014
060590200529      *                                                                         CFT014
060600200529      ** Reset error fields.                                                    CFT014
060610200529      *                                                                         CFT014
060620200529     C                   EXSR      SRResetErr                                   CFT014
060630200529      *                                                                         CFT014
060640200529     C                   SELECT                                                 CFT014
060650200529      *                                                                         CFT014
060660200529      ** F3 - end program.                                                      CFT014
060670200529      *                                                                         CFT014
060680200529     C     PINKC         WHENEQ    *ON                                          CFT014
060690200529     C                   EXSR      SREndP                                       CFT014
060700200529      *                                                                         CFT014
060710200529      ** F5 - refresh Margin info                                               CFT014
060720200529      *                                                                         CFT014
060730200529     C     PINKE         WHENEQ    *ON                                          CFT014
060740200529     C                   MOVEL     CrIP6ScnFmt   NwIP6ScnFmt                    CFT014
060750200529     C                   MOVEL     CrIP6AScnFmt  NwIP6AScnFmt                                 CER030
060760200529      *                                                                         CFT014
060770200529      ** F12 - cancel.  Refresh Margin info  and redisplay                      CFT014
060780200529      ** Level 2 screen 3.                                                      CFT014
060790200529      *                                                                         CFT014
060800200529     C     PINKL         WHENEQ    *ON                                          CFT014
060810200529     C                   MOVEL     CrIP6ScnFmt   NwIP6ScnFmt                    CFT014
060820200529     C                   MOVEL     CrIP6AScnFmt  NwIP6AScnFmt                                 CER030
060830200529     C                   MOVEL     'D'           WScrn                          CFT014
060840200529      *                                                                         CFT014
060850200529      ** Enter key was pressed.                                                 CFT014
060860200529      *                                                                         CFT014
060870200529     C                   OTHER                                                  CFT014
060880200529      *                                                                         CFT014
060890200529      ** If Action is Insert or Amend, validate input to                        CFT014
060900200529      ** Margin information screen.                                             CFT014
060910200529      *                                                                         CFT014
060920200529     C     DDACTN        IFEQ      'I'                                          CFT014
060930200529     C     DDACTN        OREQ      'A'                                          CFT014
060940200529     C                   EXSR      SRVal_M                                      CFT014
060950200529     C                   GOTO      EScrn_M                                      CFT014
060960200529     C                   ENDIF                                                  CFT014
060970200529      *                                                                         CFT014
060980200529     C                   ENDSL                                                  CFT014
060990200529      *                                                                         CFT014
061000200529     C     EScrn_M       ENDSR                                                  CFT014
061010200529      *****************************************************************         CFT014
061020200529      /EJECT                                                                    CFT014
061030200529      *****************************************************************         CFT014
061040200529      *                                                               *         CFT014
061050200529      *  SRVal_M - Validate Margin information                        *         CFT014
061060200529      *                                                               *         CFT014
061070200529      *****************************************************************         CFT014
061080200529      *                                                                         CFT014
061090200529     C     SRVal_M       BEGSR                                                  CFT014
061100200529      *                                                                         CFT014
061110200529     C                   MOVEL     *BLANK        WRedisplay                     CFT014
061120200529      *                                                                         CFT014
061130200529     C                   CALLB     'FTIPAY5VL'                                  CFT014
061140200529      *                             =========                                   CFT014
061150200529      ** INPUT                                                                  CFT014
061160200529      ** =====                                                                  CFT014
061170200529      *                                                                         CFT014
061180200529      ** Mode = '*FRONT' (Front Office Transaction Interface)                   CFT014
061190200529      ** Mode = '      ' (Not Front Office Transaction Interface)               CFT014
061200200529      ** Mode = '*RPR  ' (Repair Function)                                      CFT014
061210200529      ** Mode = '*SIN  ' (Screen Input Function)                                CFT014
061220200529     C                   PARM                    PMode                          CFT014
061230200529      *                                                                         CFT014
061240200529      ** Response Mode                                                          CFT014
061250200529     C                   PARM                    PResponse                      CFT014
061260200529      *                                                                         CFT014
061270200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction         CFT014
061280200529      ** - screen format                                                        CFT014
061290200529     C                   PARM                    NwIP1ScnFmt                    CFT014
061300200529      *                                                                         CFT014
061310200529      ** Incoming Payments Margin info from incoming transaction                CFT014
061320200529      ** - screen format                                                        CFT014
061330200529     C                   PARM                    NwIP6ScnFmt                    CFT014
061340200529      *                                                                                       CER030
061350200529      ** Incoming Payments Extended Narratives incoming transaction                           CER030
061360200529      ** - screen format                                                                      CER030
061370200529      *                                                                                       CER030
061380200529     C                   PARM                    NwIP6AScnFmt                                 CER030
061390200529      *                                                                                       CER030
061400200529      ** Incoming Payments Transaction Code from screen 2 level 2 for                         CER030
061410200529      ** defaulting value of Retail Transaction Type                                          CER030
061420200529      *                                                                                       CER030
061430200529     C                   PARM                    DDTTCD                                       CER030
061440200529      *                                                                         CFT014
061450200529      ** STANDING DATA                                                          CFT014
061460200529      ** =============                                                          CFT014
061470200529      *                                                                         CFT014
061480200529      ** SDMMOD - Analytical Accounting                                         CFT014
061490200529     C                   PARM                    BGN0ST                         CFT014
061500200529      *                                                                         CFT014
061510200529      ** OUTPUT                                                                 CFT014
061520200529      ** ======                                                                 CFT014
061530200529      *                                                                         CFT014
061540200529      ** Error fields/message IDs/message data (arrays) from/to caller          CFT014
061550200529     C                   PARM                    FldNameArr                     CFT014
061560200529     C                   PARM                    MsgIdArr                       CFT014
061570200529     C                   PARM                    MsgDtaArr                      CFT014
061580200529      *                                                                         CFT014
061590200529      ** Array index (3P0) from/to caller                                       CFT014
061600200529     C                   PARM                    IDx                            CFT014
061610200529      *                                                                         CFT014
061620200529      ** Warning flds/message IDs/message data (arrays) from/to caller          CFT014
061630200529     C                   PARM                    WFldNamArr                     CFT014
061640200529     C                   PARM                    WMsgIdArr                      CFT014
061650200529     C                   PARM                    WMsgDtaArr                     CFT014
061660200529      *                                                                         CFT014
061670200529      ** Array index (3P0) from/to caller                                       CFT014
061680200529     C                   PARM                    WIDx                           CFT014
061690200529      *                                                                         CFT014
061700200529      ** Incoming Payments Margin info error indicators                         CFT014
061710200529     C                   PARM                    FTEIPY5                        CFT014
061720200529      *                                                                         CFT014
061730200529      ** Incoming Payments for file update - file format                        CFT014
061740200529     C                   PARM                    NwIPFilFmt                     CFT014
061750200529      *                                                                                       CER030
061760200529      ** Extension Valid File Value for Transaction code                                      CER030
061770200529      *                                                                                       CER030
061780200529     C                   PARM                    I2INTTCD                                     CER030
061790200529      *                                                                         CFT014
061800200529      ** If no errors occurred during validation of fields on Margin            CFT014
061810200529      ** info, check if there are warnings which have not been                  CFT014
061820200529      ** displayed yet.                                                         CFT014
061830200529      *                                                                         CFT014
061840200529     C                   IF        IDx = 0                                      CFT014
061850200529      *                                                                         CFT014
061860200529     C                   Z-ADD     1             WIx                            CFT014
061870200529      *                                                                         CFT014
061880200529     C     WIx           DOWLE     WIDx                                         CFT014
061890200529     C     WRedisplay    ANDEQ     *BLANK                                       CFT014
061900200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)            CFT014
061910200529     C                   EVAL      WRedisplay = 'Y'                             CFT014
061920200529     C                   ELSE                                                   CFT014
061930200529     C                   EVAL      WIx =WIx + 1                                 CFT014
061940200529     C                   ENDIF                                                  CFT014
061950200529     C                   ENDDO                                                  CFT014
061960200529      *                                                                         CFT014
061970200529     C                   ENDIF                                                  CFT014
061980200529      *                                                                         CFT014
061990200529      ** If no errors occurred during validation of Margin info                 CFT014
062000200529      ** and if there are no warnings which have not been                       CFT014
062010200529      ** displayed, redisplay Level 2 Screen 3.                                 CFT014
062020200529      *                                                                         CFT014
062030200529     C     IDx           IFEQ      *ZERO                                        CFT014
062040200529     C     WRedisplay    ANDEQ     *BLANK                                       CFT014
062050200529     C                   MOVEL     'D'           WScrn                          CFT014
062060200529     C                   ENDIF                                                  CFT014
062070200529      *                                                                         CFT014
062080200529     C                   ENDSR                                                  CFT014
062090200529      *                                                                         CFT014
062100200529      *****************************************************************         CFT014
062110200529      /EJECT
062120200529      *****************************************************************
062130200529      *                                                               *
062140200529      *  SRScrn_W - Process Window screen                             *
062150200529      *                                                               *
062160200529      *****************************************************************
062170200529      *
062180200529     C     SRScrn_W      BEGSR
062190200529     C/COPY WNCPYSRC,FTIPAYSC31
062200200529      *
062210200529      ** If entry point is Level 1, display Level 1 screen
062220200529      ** without error messages.
062230200529      *
062240200529     C     PParmLevel    IFEQ      '1'
062250200529                                                                                CFT009
062260200529     C                   IF        CFT009 = 'Y'                                 CFT009
062270200529     C                   MOVE      *ALL'Y'       FTEIPY1                        CFT009
062280200529     C                   MOVE      *BLANKS       FldNameArr                     CFT009
062290200529     C                   MOVE      *BLANKS       MsgIdArr                       CFT009
062300200529     C                   MOVE      *BLANKS       MsgDtaArr                      CFT009
062310200529     C                   MOVE      *BLANKS       WFldNamArr                     CFT009
062320200529     C                   MOVE      *BLANKS       WMsgIdArr                      CFT009
062330200529     C                   MOVE      *BLANKS       WMsgDtaArr                     CFT009
062340200529     C                   ENDIF                                                  CFT009
062350200529      *
062360200529     C                   CALLB     'FTIPAY1DP'
062370200529      *                             =========
062380200529      ** INPUT
062390200529      ** =====
062400200529      *
062410200529      ** Return Code
062420200529     C                   PARM      *BLANKS       RetCodeOut
062430200529      *
062440200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
062450200529      ** Mode = '      ' (Not Front Office Transaction Interface)
062460200529      ** Mode = '*RPR  ' (Repair Function)
062470200529      ** Mode = '*SIN  ' (Screen Input Function)
062480200529     C                   PARM                    PMode
062490200529      *
062500200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
062510200529      ** - screen format
062520200529     C                   PARM                    NwIP1ScnFmt
062530200529      *                                                                         CFT014
062540200529      ** Incoming Payments Lvl 1 Scrn 1/2 details from incoming trans.          CFT014
062550200529      ** - screen format                                                        CFT014
062560200529     C                   PARM                    NwIP1aScnFmt                   CFT014
062570200529      *
062580200529      ** DS for Additional Information details
062590200529     C                   PARM                    PAddInfm
062600200529      *
062610200529      ** SWIFT Reference
062620200529     C                   PARM                    DDSWTN
062630200529      *
062640200529      ** Sequence No.
062650200529     C                   PARM                    DDSEQNO
062660200529      *
062670200529      ** Incoming Payment Status
062680200529     C                   PARM                    PStatus
062690200529      *
062700200529      ** Payment Type
062710200529     C                   PARM                    PPYTP
062720200529      *
062730200529      ** Display Additional Information Screen Indicator
062740200529     C                   PARM      'N'           PAddInfo
062750200529      *
062760200529      ** Enable Detail Fields Indicator
062770200529     C                   PARM                    PEDTFLD
062780200529      *
062790200529      ** Enable Function Keys
062800200529      ** KD = Command Key 04 = Prompt
062810200529      ** KE = Command Key 05 = Refresh
062820200529      ** KG = Command Key 07 = Read Previous
062830200529      ** KH = Command Key 08 = Read Next
062840200529      ** KJ = Command Key 10 = Delete
062850200529      ** KP = Command Key 15 = Browse
062860200529      ** KQ = Command Key 16 = Search
062870200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
062880200529      ** KV = Command Key 21 = Additional Information Window
062890200529     C                   PARM                    PEINKD
062900200529     C                   PARM                    PEINKE
062910200529     C                   PARM                    PEINKG
062920200529     C                   PARM                    PEINKH
062930200529     C                   PARM                    PEINKJ
062940200529     C                   PARM                    PEINKP
062950200529     C                   PARM                    PEINKQ
062960200529     C                   PARM                    PEINKS
062970200529     C                   PARM                    PEINKV
062980200529      *
062990200529      ** Incoming Payments Lvl 1 Scrn error indicators
063000200529     C                   PARM                    FTEIPY1
063010200529      *
063020200529      ** Error fields/message IDs/message data (arrays) from/to caller
063030200529     C                   PARM                    FldNameArr
063040200529     C                   PARM                    MsgIdArr
063050200529     C                   PARM                    MsgDtaArr
063060200529      *
063070200529      ** Warning fields/message Ids/message data (arrays) from/to
063080200529      ** caller
063090200529     C                   PARM                    WFldNamArr
063100200529     C                   PARM                    WMsgIdArr
063110200529     C                   PARM                    WMsgDtaArr
063120200529      *
063130200529      ** Write Screen with No Read Indicator
063140200529     C                   PARM      'Y'           PWriteOnly
063150200529      *
063160200529      ** STANDING DATA
063170200529      ** =============
063180200529      *
063190200529      ** SDBANK - System Runday
063200200529     C                   PARM                    BJMRDT
063210200529      *
063220200529      ** SDBANK - Single Branch Code
063230200529     C                   PARM                    BJSBRC
063240200529      *
063250200529      ** SDGELR - Profit Centre Used
063260200529     C                   PARM                    BKPRCU
063270200529      *
063280200529      ** SDGELR - Originating Branch Used
063290200529     C                   PARM                    BKOBRU
063300200529      *
063310200529      ** SWITCHABLE FEATURES
063320200529      ** ===================
063330200529      *
063340200529      ** EMU FT Settlement Currency Conversion
063350200529     C                   PARM                    CEU006
063360200529      *
063370200529      ** BIC database plus
063380200529     C                   PARM                    CFT007
063390200529      *
063400200529      ** Electronic Banking Interface IATs and TPPs
063410200529     C                   PARM                    CGL009
063420200529      *                                                                         CFT014
063430200529      ** STP Phase 2 MT103 Messages Generation for FT.                          CFT014
063440200529     C                   PARM                    CFT014                         CFT014
063450200529     C/COPY WNCPYSRC,FTIPAYSC32
063460200529      *                                                                         CFT009
063470200529      ** Fees & Charges                                                         CFT009
063480200529     C                   PARM                    CFT009                         CFT009
063490200529     C/COPY WNCPYSRC,FTIPAYSC06
063500200529      *
063510200529      ** OUTPUT
063520200529      ** ======
063530200529      *
063540200529      ** Function Keys Enabled
063550200529      ** KC = Command Key 03 = Exit
063560200529      ** KD = Command Key 04 = Prompt
063570200529      ** KE = Command Key 05 = Refresh
063580200529      ** KG = Command Key 07 = Read Previous
063590200529      ** KH = Command Key 08 = Read Next
063600200529      ** KJ = Command Key 10 = Delete
063610200529      ** KL = Command Key 12 = Cancel
063620200529      ** KP = Command Key 15 = Browse
063630200529      ** KQ = Command Key 16 = Search
063640200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
063650200529      ** KV = Command Key 21 = Additional Information Window
063660200529     C                   PARM                    PINKC
063670200529     C                   PARM                    PINKD
063680200529     C                   PARM                    PINKE
063690200529     C                   PARM                    PINKG
063700200529     C                   PARM                    PINKH
063710200529     C                   PARM                    PINKJ
063720200529     C                   PARM                    PINKL
063730200529     C                   PARM                    PINKP
063740200529     C                   PARM                    PINKQ
063750200529     C                   PARM                    PINKS
063760200529     C                   PARM                    PINKV
063770200529      *
063780200529      ** Cursor position
063790200529     C                   PARM                    PRowCol
063800200529     C                   EXSR      SRResetErr                                                 248631
063810200529      *
063820200529     C                   ELSE
063830200529      *
063840200529      ** Else, if entry point is Level 2, display Level 2 screen 1
063850200529      ** without error messages.
063860200529      *
063870200529     C                   CALLB     'FTIPAY2DP'
063880200529      *                             =========
063890200529      ** INPUT
063900200529      ** =====
063910200529      *
063920200529      ** Return Code
063930200529     C                   PARM      *BLANKS       RetCodeOut
063940200529      *
063950200529      ** Action Code
063960200529     C                   PARM                    DDACTN
063970200529      *
063980200529      ** Payment Reference
063990200529     C                   PARM                    DDPREF
064000200529      *
064010200529      ** Incoming Payments Lvl 2 Scrn 1/1 details from incoming transaction
064020200529      ** - screen format
064030200529     C                   PARM                    NwIP2ScnFmt
064040200529      *
064050200529      ** Incoming Payments Lvl 2 Scrn 1/2 details from incoming transaction
064060200529      ** - screen format
064070200529     C                   PARM                    NwIP3ScnFmt
064080200529      *
064090200529      ** Incoming Payment Status
064100200529     C                   PARM                    PStatus
064110200529      *
064120200529      ** Enable Detail Fields
064130200529     C                   PARM                    PEDTFLD
064140200529      *
064150200529      ** Enable Function Keys
064160200529      ** KD = Command Key 04 = Prompt
064170200529      ** KE = Command Key 05 = Refresh
064180200529      ** KG = Command Key 07 = Read Previous
064190200529      ** KH = Command Key 08 = Read Next
064200200529      ** KP = Command Key 15 = Browse
064210200529      ** KQ = Command Key 16 = Search
064220200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
064230200529     C                   PARM                    PEINKD
064240200529     C                   PARM                    PEINKE
064250200529     C                   PARM                    PEINKG
064260200529     C                   PARM                    PEINKH
064270200529     C                   PARM                    PEINKP
064280200529     C                   PARM                    PEINKQ
064290200529     C                   PARM                    PEINKS
064300200529      *
064310200529      ** Incoming Payments Lvl 2 Scrn 1 error indicators
064320200529     C                   PARM                    FTEIPY2
064330200529      *
064340200529      ** Error fields/message IDs/message data (arrays) from/to caller
064350200529     C                   PARM                    FldNameArr
064360200529     C                   PARM                    MsgIdArr
064370200529     C                   PARM                    MsgDtaArr
064380200529      *
064390200529      ** Warning fields/message Ids/message data (arrays) from/to
064400200529      ** caller
064410200529     C                   PARM                    WFldNamArr
064420200529     C                   PARM                    WMsgIdArr
064430200529     C                   PARM                    WMsgDtaArr
064440200529      *
064450200529      ** Write Screen with No Read Indicator
064460200529     C                   PARM      'Y'           PWriteOnly
064470200529      *
064480200529      ** STANDING DATA
064490200529      ** =============
064500200529      *
064510200529      ** SDBANK - System Runday
064520200529     C                   PARM                    BJMRDT
064530200529      *
064540200529      ** SDBANK - Single Branch Code
064550200529     C                   PARM                    BJSBRC
064560200529      *
064570200529      ** SWITCHABLE FEATURES
064580200529      ** ===================
064590200529      *
064600200529      ** BIC database plus
064610200529     C                   PARM                    CFT007
064620200529      *
064630200529      ** OUTPUT
064640200529      ** ======
064650200529      *
064660200529      ** Function Keys Enabled
064670200529      ** KC = Command Key 03 = Exit
064680200529      ** KD = Command Key 04 = Prompt
064690200529      ** KE = Command Key 05 = Refresh
064700200529      ** KG = Command Key 07 = Read Previous
064710200529      ** KH = Command Key 08 = Read Next
064720200529      ** KL = Command Key 12 = Cancel
064730200529      ** KP = Command Key 15 = Browse
064740200529      ** KQ = Command Key 16 = Search
064750200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
064760200529     C                   PARM                    PINKC
064770200529     C                   PARM                    PINKD
064780200529     C                   PARM                    PINKE
064790200529     C                   PARM                    PINKG
064800200529     C                   PARM                    PINKH
064810200529     C                   PARM                    PINKL
064820200529     C                   PARM                    PINKP
064830200529     C                   PARM                    PINKQ
064840200529     C                   PARM                    PINKS
064850200529      *
064860200529      ** Cursor position
064870200529     C                   PARM                    PRowCol
064880200529      *
064890200529     C                   ENDIF
064900200529      *
064910200529      * Set up Payment Reference                                                              204152
064920200529     C     DDACTN        IFEQ      'I'                                                        204152
064930200529     C     FirstTime     ANDEQ     'Y'                                                        204152
064940200529     C                   EVAL      FirstTime = 'N'                                            204152
064950200529     C                   EXSR      SETPAYREF                                                  204152
064960200529     C                   ENDIF                                                                204152
064970200529      *                                                                                       204152
064980200529      /COPY WNCPYSRC,FTIPAYMV1
064990200529      *
065000200529      ** Call Window Manager.
065010200529      *
065020200529     C                   CALL      'WN0010'
065030200529     C                   PARM      'FTIPAYSIN'   PWPgm            10
065040200529     C                   PARM                    PWKey             2
065050200529     C                   PARM      DDACTN        PWAction          1
065060200529     C                   PARM                    Data
065070200529     C                   PARM      *BLANKS       PWRtn             7
065080200529     C                   PARM                    PWSpare         256
065090200529      *
065100200529     C/COPY WNCPYSRC,FTIPAYSC17
065110200529     C                   SELECT
065120200529      *
065130200529      ** F3 - end program.
065140200529      *
065150200529     C     PWRtn         WHENEQ    'Y2U9999'
065160200529     C                   EXSR      SREndP
065170200529      *
065180200529      ** F12 - cancel.  Display Level 1 screen or Level 2 screen 1.
065190200529      *
065200200529     C     PWRtn         WHENEQ    'USR0790'
065210200529     C     PParmLevel    IFEQ      '1'
065220200529     C                   MOVEL     'P'           WScrn
065230200529     C                   ELSE
065240200529     C                   MOVEL     'S'           WScrn
065250200529     C                   ENDIF
065260200529      *
065270200529      ** Enter key was pressed.
065280200529      *
065290200529     C                   OTHER
065300200529      *
065310200529      ** Action is Insert or Amend.
065320200529      *
065330200529     C     DDACTN        IFEQ      'I'
065340200529     C     DDACTN        OREQ      'A'
065350200529      *
065360200529      ** Entry point is Level 1.
065370200529      *
065380200529     C     PParmLevel    IFEQ      '1'
065390200529      *
065400200529      ** If Level 1 is linked with Level 2 or Incoming Payments
065410200529      ** Maintenance is called from linked maintenance/enquiry,
065420200529      ** display Level 2 screen 1.
065430200529      *
065440200529     C     BTLVJN        IFEQ      'Y'
065450200529     C     PParmLink     OREQ      'Y'
065460200529      *
065470200529     C                   MOVEL     'S'           WScrn
065480200529      *
065490200529      ** If Action is Insert, or Action is Amend and Level 2
065500200529      ** details have not been entered, default Transfer
065510200529      ** Commission Tariff based on Charges Branch.
065520200529      *
065530200529     C     DDACTN        IFEQ      'I'
065540200529     C     DDACTN        OREQ      'A'
065550200529     C     INLVL2        ANDNE     'Y'
065560200529     C     PPYBR         CHAIN     PYCHGDB                            01
065570200529     C     *IN01         IFEQ      *OFF
065580200529     C                   EVAL      DDTRCT = PYDFTRCT
065590200529     C     WTRCT         IFNE      *BLANKS                                                    226722
065600200529     C                   EVAL      DDTRCT = WTRCT                                             226722
065610200529     C                   ENDIF                                                                226722
065620200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
065630200529     C                   ENDIF
065640200529     C                   ENDIF
065650200529      *
065660200529     C                   ELSE
065670200529      *
065680200529      ** Otherwise, compute Charges and Commissions, and Total
065690200529      ** VAT Amounts based on Level 1 details, and display
065700200529      ** Confirmation screen.
065710200529      *
065720200529     C                   IF        CFT009 = 'N'                                 CFT009
065730200529     C                   EXSR      SRCCVatL1
065740200529     C                   ENDIF                                                  CFT009
065750200529      *                                                                         CFT009
065760200529     C                   MOVEL     'F'           WScrn
065770200529      *
065780200529     C                   ENDIF
065790200529      *
065800200529      ** Entry point is Level 2.
065810200529      *
065820200529     C                   ELSE
065830200529     C                   IF        CFT009 = 'N'                                 CFT009
065840200529      *
065850200529      ** Compute Charges and Commissions, and Total VAT Amounts based on
065860200529      ** Level 1 details.
065870200529      *
065880200529     C                   EXSR      SRCCVatL1
065890200529      *
065900200529      ** Do defaulting of Charges and Commission details on Level 2
065910200529      ** screen 2.
065920200529      *
065930200529     C                   EXSR      SRCDefault
065940200529                                                                                CFT009
065950200529     C                   ENDIF                                                  CFT009
065960200529      *
065970200529      ** Display Level 2 screen 2.
065980200529      *
065990200529     C                   MOVEL     'C'           WScrn
066000200529      *
066010200529     C                   ENDIF
066020200529      *
066030200529     C                   ENDIF
066040200529      *
066050200529      ** Action is Enquire.
066060200529      *
066070200529     C     DDACTN        IFEQ      'E'
066080200529      *
066090200529      ** Entry point is Level 1.
066100200529      *
066110200529     C     PParmlevel    IFEQ      '1'
066120200529      *
066130200529      ** If Level 1 is linked with Level 2 or Incoming Payments
066140200529      ** Maintenance is called from linked maintenance/enquiry,
066150200529      ** display Level 2 screen 1.
066160200529      *
066170200529     C     BTLVJN        IFEQ      'Y'
066180200529     C     PParmLink     OREQ      'Y'
066190200529      *
066200200529     C                   MOVEL     'S'           WScrn
066210200529      *
066220200529     C                   ELSE
066230200529      *
066240200529      ** Otherwise, read Next Browse Subfile record or
066250200529      ** display Initial screen with blank fields.
066260200529      *
066270200529     C     PRDNB         IFEQ      'Y'
066280200529     C                   MOVEL     'R'           WScrn
066290200529     C                   ELSE
066300200529     C                   MOVEL     *BLANKS       DDACTN
066310200529     C                   MOVEL     *BLANKS       DDPREF
066320200529     C                   MOVEL     *BLANKS       DDSWTN
066330200529     C                   MOVEL     *BLANKS       DDSEQNO
066340200529     C                   MOVEL     *BLANKS       DDBRCA
066350200529     C                   MOVEL     'I'           WScrn
066360200529     C                   ENDIF
066370200529      *
066380200529     C                   ENDIF
066390200529      *
066400200529      ** Entry point is Level 2.
066410200529      *
066420200529     C                   ELSE
066430200529
066440200529     C                   IF        CFT009 = 'N'                                  CFT009
066450200529      *
066460200529      ** Compute Charges and Commissions, and Total VAT Amounts based on
066470200529      ** Level 1 details.
066480200529      *
066490200529     C                   EXSR      SRCCVatL1
066500200529      *
066510200529      ** Do defaulting of Charges and Commission details on Level 2
066520200529      ** screen 2.
066530200529      *
066540200529     C                   EXSR      SRCDefault
066550200529
066560200529     C                   ENDIF                                                   CFT009
066570200529      *
066580200529      ** Display Level 2 screen 2.
066590200529      *
066600200529     C                   MOVEL     'C'           WScrn
066610200529      *
066620200529     C                   ENDIF
066630200529      *
066640200529     C                   ENDIF
066650200529      *
066660200529     C                   ENDSL
066670200529      *
066680200529     C                   ENDSR
066690200529      *
066700200529      *****************************************************************
066710200529      /EJECT
066720200529      *****************************************************************
066730200529      *                                                               *
066740200529      *  SRScrn_F - Process Confirmation screen                       *
066750200529      *                                                               *
066760200529      *****************************************************************
066770200529      *
066780200529     C     SRScrn_F      BEGSR
066790200529      *
066800200529      ** Reset error fields, specifically arrays for warning messages.
066810200529      *
066820200529     C                   EXSR      SRResetErr
066830200529      *
066840200529      ** Entries are valid or only warnings exist.  Output message
066850200529      ** "Press ENTER to apply transaction to database or F12 to change.".
066860200529      *
066870200529     C                   MOVE      '*ANY'        WFldNamArr(1)
066880200529     C                   MOVE      'FTA0119'     WMsgIdArr(1)
066890200529      *
066900200529      ** If entry point is Level 1, display Level 1 screen.
066910200529      *
066920200529     C     PParmLevel    IFEQ      '1'
066930200529      *
066940200529     C                   CALLB     'FTIPAY1DP'
066950200529      *                             =========
066960200529      ** INPUT
066970200529      ** =====
066980200529      *
066990200529      ** Return Code
067000200529     C                   PARM      *BLANKS       RetCodeOut
067010200529      *
067020200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
067030200529      ** Mode = '      ' (Not Front Office Transaction Interface)
067040200529      ** Mode = '*RPR  ' (Repair Function)
067050200529      ** Mode = '*SIN  ' (Screen Input Function)
067060200529     C                   PARM                    PMode
067070200529      *
067080200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
067090200529      ** - screen format
067100200529     C                   PARM                    NwIP1ScnFmt
067110200529      *                                                                         CFT014
067120200529      ** Incoming Payments Lvl 1 Scrn 1/2 details from incoming trans.          CFT014
067130200529      ** - screen format                                                        CFT014
067140200529     C                   PARM                    NwIP1aScnFmt                   CFT014
067150200529      *
067160200529      ** DS for Additional Information details
067170200529     C                   PARM                    PAddInfm
067180200529      *
067190200529      ** SWIFT Reference
067200200529     C                   PARM                    DDSWTN
067210200529      *
067220200529      ** Sequence No.
067230200529     C                   PARM                    DDSEQNO
067240200529      *
067250200529      ** Incoming Payment Status
067260200529     C                   PARM                    PStatus
067270200529      *
067280200529      ** Payment Type
067290200529     C                   PARM                    PPYTP
067300200529      *
067310200529      ** Display Additional Information Screen Indicator
067320200529     C                   PARM      'N'           PAddInfo
067330200529      *
067340200529      ** Enable Detail Fields Indicator
067350200529     C                   PARM      'N'           PEDTFLD
067360200529      *
067370200529      ** Enable Function Keys
067380200529      ** KD = Command Key 04 = Prompt
067390200529      ** KE = Command Key 05 = Refresh
067400200529      ** KG = Command Key 07 = Read Previous
067410200529      ** KH = Command Key 08 = Read Next
067420200529      ** KJ = Command Key 10 = Delete
067430200529      ** KP = Command Key 15 = Browse
067440200529      ** KQ = Command Key 16 = Search
067450200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
067460200529      ** KV = Command Key 21 = Additional Information Window
067470200529     C                   PARM      'N'           PEINKD
067480200529     C                   PARM      'N'           PEINKE
067490200529     C                   PARM      'N'           PEINKG
067500200529     C                   PARM      'N'           PEINKH
067510200529     C                   PARM      'N'           PEINKJ
067520200529     C                   PARM      'N'           PEINKP
067530200529     C                   PARM      'N'           PEINKQ
067540200529     C                   PARM      'N'           PEINKS
067550200529     C                   PARM      'N'           PEINKV
067560200529      *
067570200529      ** Incoming Payments Lvl 1 Scrn error indicators
067580200529     C                   PARM                    FTEIPY1
067590200529      *
067600200529      ** Error fields/message IDs/message data (arrays) from/to caller
067610200529     C                   PARM                    FldNameArr
067620200529     C                   PARM                    MsgIdArr
067630200529     C                   PARM                    MsgDtaArr
067640200529      *
067650200529      ** Warning fields/message Ids/message data (arrays) from/to
067660200529      ** caller
067670200529     C                   PARM                    WFldNamArr
067680200529     C                   PARM                    WMsgIdArr
067690200529     C                   PARM                    WMsgDtaArr
067700200529      *
067710200529      ** Write Screen with No Read Indicator
067720200529     C                   PARM      'N'           PWriteOnly
067730200529      *
067740200529      ** STANDING DATA
067750200529      ** =============
067760200529      *
067770200529      ** SDBANK - System Runday
067780200529     C                   PARM                    BJMRDT
067790200529      *
067800200529      ** SDBANK - Single Branch Code
067810200529     C                   PARM                    BJSBRC
067820200529      *
067830200529      ** SDGELR - Profit Centre Used
067840200529     C                   PARM                    BKPRCU
067850200529      *
067860200529      ** SDGELR - Originating Branch Used
067870200529     C                   PARM                    BKOBRU
067880200529      *
067890200529      ** SWITCHABLE FEATURES
067900200529      ** ===================
067910200529      *
067920200529      ** EMU FT Settlement Currency Conversion
067930200529     C                   PARM                    CEU006
067940200529      *
067950200529      ** BIC database plus
067960200529     C                   PARM                    CFT007
067970200529      *
067980200529      ** Electronic Banking Interface IATs and TPPs
067990200529     C                   PARM                    CGL009
068000200529      *                                                                         CFT014
068010200529      ** STP Phase 2 MT103 Messages Generation for FT.                          CFT014
068020200529     C                   PARM                    CFT014                         CFT014
068030200529     C/COPY WNCPYSRC,FTIPAYSC33
068040200529      *                                                                         CFT009
068050200529      ** Fees & Charges                                                         CFT009
068060200529     C                   PARM                    CFT009                         CFT009
068070200529     C/COPY WNCPYSRC,FTIPAYSC07
068080200529      *
068090200529      ** OUTPUT
068100200529      ** ======
068110200529      *
068120200529      ** Function Keys Enabled
068130200529      ** KC = Command Key 03 = Exit
068140200529      ** KD = Command Key 04 = Prompt
068150200529      ** KE = Command Key 05 = Refresh
068160200529      ** KG = Command Key 07 = Read Previous
068170200529      ** KH = Command Key 08 = Read Next
068180200529      ** KJ = Command Key 10 = Delete
068190200529      ** KL = Command Key 12 = Cancel
068200200529      ** KP = Command Key 15 = Browse
068210200529      ** KQ = Command Key 16 = Search
068220200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
068230200529      ** KV = Command Key 21 = Additional Information Window
068240200529     C                   PARM                    PINKC
068250200529     C                   PARM                    PINKD
068260200529     C                   PARM                    PINKE
068270200529     C                   PARM                    PINKG
068280200529     C                   PARM                    PINKH
068290200529     C                   PARM                    PINKJ
068300200529     C                   PARM                    PINKL
068310200529     C                   PARM                    PINKP
068320200529     C                   PARM                    PINKQ
068330200529     C                   PARM                    PINKS
068340200529     C                   PARM                    PINKV
068350200529      *
068360200529      ** Cursor position
068370200529     C                   PARM                    PRowCol
068380200529      *
068390200529      ** Else, if entry point is Level 2, display Level 2
068400200529      ** screen 1.
068410200529      *
068420200529     C                   ELSE
068430200529      *
068440200529     C                   CALLB     'FTIPAY2DP'
068450200529      *                             =========
068460200529      ** INPUT
068470200529      ** =====
068480200529      *
068490200529      ** Return Code
068500200529     C                   PARM      *BLANKS       RetCodeOut
068510200529      *
068520200529      ** Action Code
068530200529     C                   PARM                    DDACTN
068540200529      *
068550200529      ** Payment Reference
068560200529     C                   PARM                    DDPREF
068570200529      *
068580200529      ** Incoming Payments Lvl 2 Scrn 1/1 details from incoming transaction
068590200529      ** - screen format
068600200529     C                   PARM                    NwIP2ScnFmt
068610200529      *
068620200529      ** Incoming Payments Lvl 2 Scrn 1/2 details from incoming transaction
068630200529      ** - screen format
068640200529     C                   PARM                    NwIP3ScnFmt
068650200529      *
068660200529      ** Incoming Payment Status
068670200529     C                   PARM                    PStatus
068680200529      *
068690200529      ** Enable Detail Fields
068700200529     C                   PARM      'N'           PEDTFLD
068710200529      *
068720200529      ** Enable Function Keys
068730200529      ** KD = Command Key 04 = Prompt
068740200529      ** KE = Command Key 05 = Refresh
068750200529      ** KG = Command Key 07 = Read Previous
068760200529      ** KH = Command Key 08 = Read Next
068770200529      ** KP = Command Key 15 = Browse
068780200529      ** KQ = Command Key 16 = Search
068790200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
068800200529     C                   PARM      'N'           PEINKD
068810200529     C                   PARM      'N'           PEINKE
068820200529     C                   PARM      'N'           PEINKG
068830200529     C                   PARM      'N'           PEINKH
068840200529     C                   PARM      'N'           PEINKP
068850200529     C                   PARM      'N'           PEINKQ
068860200529     C                   PARM      'N'           PEINKS
068870200529      *
068880200529      ** Incoming Payments Lvl 2 Scrn 1 error indicators
068890200529     C                   PARM                    FTEIPY2
068900200529      *
068910200529      ** Error fields/message IDs/message data (arrays) from/to caller
068920200529     C                   PARM                    FldNameArr
068930200529     C                   PARM                    MsgIdArr
068940200529     C                   PARM                    MsgDtaArr
068950200529      *
068960200529      ** Warning fields/message Ids/message data (arrays) from/to
068970200529      ** caller
068980200529     C                   PARM                    WFldNamArr
068990200529     C                   PARM                    WMsgIdArr
069000200529     C                   PARM                    WMsgDtaArr
069010200529      *
069020200529      ** Write Screen with No Read Indicator
069030200529     C                   PARM      'N'           PWriteOnly
069040200529      *
069050200529      ** STANDING DATA
069060200529      ** =============
069070200529      *
069080200529      ** SDBANK - System Runday
069090200529     C                   PARM                    BJMRDT
069100200529      *
069110200529      ** SDBANK - Single Branch Code
069120200529     C                   PARM                    BJSBRC
069130200529      *
069140200529      ** SWITCHABLE FEATURES
069150200529      ** ===================
069160200529      *
069170200529      ** BIC database plus
069180200529     C                   PARM                    CFT007
069190200529      *
069200200529      ** OUTPUT
069210200529      ** ======
069220200529      *
069230200529      ** Function Keys Enabled
069240200529      ** KC = Command Key 03 = Exit
069250200529      ** KD = Command Key 04 = Prompt
069260200529      ** KE = Command Key 05 = Refresh
069270200529      ** KG = Command Key 07 = Read Previous
069280200529      ** KH = Command Key 08 = Read Next
069290200529      ** KL = Command Key 12 = Cancel
069300200529      ** KP = Command Key 15 = Browse
069310200529      ** KQ = Command Key 16 = Search
069320200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
069330200529     C                   PARM                    PINKC
069340200529     C                   PARM                    PINKD
069350200529     C                   PARM                    PINKE
069360200529     C                   PARM                    PINKG
069370200529     C                   PARM                    PINKH
069380200529     C                   PARM                    PINKL
069390200529     C                   PARM                    PINKP
069400200529     C                   PARM                    PINKQ
069410200529     C                   PARM                    PINKS
069420200529      *
069430200529      ** Cursor position
069440200529     C                   PARM                    PRowCol
069450200529      *
069460200529     C                   ENDIF
069470200529      *                                                                         CFT009
069480200529      ** Clear warning message work inds for charges screen                     CFT009
069490200529      *                                                                         CFT009
069500200529     C                   IF        PINKL = *ON                                  CFT009
069510200529     C                   EVAL      PChgWarn = *BLANKS                           CFT009
069520200529     C                   ENDIF                                                  CFT009
069530200529      *
069540200529      ** Reset error fields.
069550200529      *
069560200529     C                   EXSR      SRResetErr
069570200529      *
069580200529     C                   SELECT
069590200529      *
069600200529      ** F3 - end program.
069610200529      *
069620200529     C     PINKC         WHENEQ    *ON
069630200529     C                   EXSR      SREndP
069640200529      *
069650200529      ** F12 - cancel.  Display Level 1 screen or Level 2
069660200529      ** screen 1.
069670200529      *
069680200529     C     PINKL         WHENEQ    *ON
069690200529     C     PParmLevel    IFEQ      '1'
069700200529     C                   MOVEL     'P'           WScrn
069710200529     C                   ELSE
069720200529     C                   MOVEL     'S'           WScrn
069730200529     C                   ENDIF
069740200529      *
069750200529      ** Enter key was pressed.  Update files.
069760200529      *
069770200529     C                   OTHER
069780200529     C                   MOVEL     'U'           WScrn
069790200529      *
069800200529     C                   ENDSL
069810200529      *
069820200529     C                   ENDSR
069830200529      *
069840200529      *****************************************************************
069850200529      /EJECT
069860200529      *****************************************************************
069870200529      *                                                               *
069880200529      *  SRScrn_A - Process Additional Information screen             *
069890200529      *                                                               *
069900200529      *****************************************************************
069910200529      *
069920200529      ** Display Level 1 screen without error messages.
069930200529      *
069940200529     C     SRScrn_A      BEGSR
069950200529      *
069960200529     C                   CALLB     'FTIPAY1DP'
069970200529      *                             =========
069980200529      ** INPUT
069990200529      ** =====
070000200529      *
070010200529      ** Return Code
070020200529     C                   PARM      *BLANKS       RetCodeOut
070030200529      *
070040200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
070050200529      ** Mode = '      ' (Not Front Office Transaction Interface)
070060200529      ** Mode = '*RPR  ' (Repair Function)
070070200529      ** Mode = '*SIN  ' (Screen Input Function)
070080200529     C                   PARM                    PMode
070090200529      *
070100200529      ** Incoming Payments Lvl 1 Scrn details from incoming transaction
070110200529      ** - screen format
070120200529     C                   PARM                    NwIP1ScnFmt
070130200529      *                                                                         CFT014
070140200529      ** Incoming Payments Lvl 1 Scrn 1/2 details from incoming trans.          CFT014
070150200529      ** - screen format                                                        CFT014
070160200529     C                   PARM                    NwIP1aScnFmt                   CFT014
070170200529      *
070180200529      ** DS for Additional Information details
070190200529     C                   PARM                    PAddInfm
070200200529      *
070210200529      ** SWIFT Reference
070220200529     C                   PARM                    DDSWTN
070230200529      *
070240200529      ** Sequence No.
070250200529     C                   PARM                    DDSEQNO
070260200529      *
070270200529      ** Incoming Payment Status
070280200529     C                   PARM                    PStatus
070290200529      *
070300200529      ** Payment Type
070310200529     C                   PARM                    PPYTP
070320200529      *
070330200529      ** Display Additional Information Screen Indicator
070340200529     C                   PARM      'Y'           PAddInfo
070350200529      *
070360200529      ** Enable Detail Fields Indicator
070370200529     C                   PARM                    PEDTFLD
070380200529      *
070390200529      ** Enable Function Keys
070400200529      ** KD = Command Key 04 = Prompt
070410200529      ** KE = Command Key 05 = Refresh
070420200529      ** KG = Command Key 07 = Read Previous
070430200529      ** KH = Command Key 08 = Read Next
070440200529      ** KJ = Command Key 10 = Delete
070450200529      ** KP = Command Key 15 = Browse
070460200529      ** KQ = Command Key 16 = Search
070470200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
070480200529      ** KV = Command Key 21 = Additional Information Window
070490200529     C                   PARM                    PEINKD
070500200529     C                   PARM                    PEINKE
070510200529     C                   PARM                    PEINKG
070520200529     C                   PARM                    PEINKH
070530200529     C                   PARM                    PEINKJ
070540200529     C                   PARM                    PEINKP
070550200529     C                   PARM                    PEINKQ
070560200529     C                   PARM                    PEINKS
070570200529     C                   PARM                    PEINKV
070580200529      *
070590200529      ** Incoming Payments Lvl 1 Scrn error indicators
070600200529     C                   PARM                    FTEIPY1
070610200529      *
070620200529      ** Error fields/message IDs/message data (arrays) from/to caller
070630200529     C                   PARM                    FldNameArr
070640200529     C                   PARM                    MsgIdArr
070650200529     C                   PARM                    MsgDtaArr
070660200529      *
070670200529      ** Warning fields/message Ids/message data (arrays) from/to
070680200529      ** caller
070690200529     C                   PARM                    WFldNamArr
070700200529     C                   PARM                    WMsgIdArr
070710200529     C                   PARM                    WMsgDtaArr
070720200529      *
070730200529      ** Write Screen with No Read Indicator
070740200529     C                   PARM      'Y'           PWriteOnly
070750200529      *
070760200529      ** STANDING DATA
070770200529      ** =============
070780200529      *
070790200529      ** SDBANK - System Runday
070800200529     C                   PARM                    BJMRDT
070810200529      *
070820200529      ** SDBANK - Single Branch Code
070830200529     C                   PARM                    BJSBRC
070840200529      *
070850200529      ** SDGELR - Profit Centre Used
070860200529     C                   PARM                    BKPRCU
070870200529      *
070880200529      ** SDGELR - Originating Branch Used
070890200529     C                   PARM                    BKOBRU
070900200529      *
070910200529      ** SWITCHABLE FEATURES
070920200529      ** ===================
070930200529      *
070940200529      ** EMU FT Settlement Currency Conversion
070950200529     C                   PARM                    CEU006
070960200529      *
070970200529      ** BIC database plus
070980200529     C                   PARM                    CFT007
070990200529      *
071000200529      ** Electronic Banking Interface IATs and TPPs
071010200529     C                   PARM                    CGL009
071020200529      *                                                                         CFT014
071030200529      ** STP Phase 2 MT103 Messages Generation for FT.                          CFT014
071040200529     C                   PARM                    CFT014                         CFT014
071050200529     C/COPY WNCPYSRC,FTIPAYSC34
071060200529      *                                                                         CFT009
071070200529      ** Fees & Charges                                                         CFT009
071080200529     C                   PARM                    CFT009                         CFT009
071090200529     C/COPY WNCPYSRC,FTIPAYSC08
071100200529      *
071110200529      ** OUTPUT
071120200529      ** ======
071130200529      *
071140200529      ** Function Keys Enabled
071150200529      ** KC = Command Key 03 = Exit
071160200529      ** KD = Command Key 04 = Prompt
071170200529      ** KE = Command Key 05 = Refresh
071180200529      ** KG = Command Key 07 = Read Previous
071190200529      ** KH = Command Key 08 = Read Next
071200200529      ** KJ = Command Key 10 = Delete
071210200529      ** KL = Command Key 12 = Cancel
071220200529      ** KP = Command Key 15 = Browse
071230200529      ** KQ = Command Key 16 = Search
071240200529      ** KS = Command Key 18 = Next Payment (from linked enquiry)
071250200529      ** KV = Command Key 21 = Additional Information Window
071260200529     C                   PARM                    PINKC
071270200529     C                   PARM                    PINKD
071280200529     C                   PARM                    PINKE
071290200529     C                   PARM                    PINKG
071300200529     C                   PARM                    PINKH
071310200529     C                   PARM                    PINKJ
071320200529     C                   PARM                    PINKL
071330200529     C                   PARM                    PINKP
071340200529     C                   PARM                    PINKQ
071350200529     C                   PARM                    PINKS
071360200529     C                   PARM                    PINKV
071370200529      *
071380200529      ** Cursor position
071390200529     C                   PARM                    PRowCol
071400200529      *
071410200529     C                   SELECT
071420200529      *
071430200529      ** F3 - end program.
071440200529      *
071450200529     C     PINKC         WHENEQ    *ON
071460200529     C                   EXSR      SREndP
071470200529      *
071480200529      ** F12 - cancel.  Return to Level 1 screen.
071490200529      *
071500200529     C     PINKL         WHENEQ    *ON
071510200529     C                   MOVEL     'P'           WScrn
071520200529      *
071530200529      ** Enter key was pressed.  Return to Level 1 screen.
071540200529      *
071550200529     C                   OTHER
071560200529     C                   MOVEL     'P'           WScrn
071570200529      *
071580200529     C                   ENDSL
071590200529      *
071600200529     C                   ENDSR
071610200529      *
071620200529      *****************************************************************
071630200529      /EJECT                                                                                  CSW209
071640200529      *****************************************************************                       CSW209
071650200529      *                                                               *                       CSW209
071660200529      *  SRScrn_N - Process Level 2 screen 7                          *                       CSW209
071670200529      *                                                               *                       CSW209
071680200529      *****************************************************************                       CSW209
071690200529      *                                                                                       CSW209
071700200529     C     SRScrn_N      BEGSR                                                                CSW209
071710200529      *                                                                                       CSW209
071720200529      ** If Action Code is Insert or Amend, enable Detail                                     CSW209
071730200529      ** fields on Level 2 screen 7 (all fields on Level 2                                    CSW209
071740200529      ** screen 7 except Action Code and Payment Reference).                                  CSW209
071750200529      *                                                                                       CSW209
071760200529     C                   IF        DDACTN = 'I' OR                                            CSW209
071770200529     C                             DDACTN = 'A'                                               CSW209
071780200529     C                   EVAL      PEDTFLD = 'Y'                                              CSW209
071790200529     C                   ELSE                                                                 CSW209
071800200529     C                   EVAL      PEDTFLD = 'N'                                              CSW209
071810200529     C                   ENDIF                                                                CSW209
071820200529      *                                                                                       CSW209
071830200529      ** Incoming Payments Maintenance has been called by linked                              CSW209
071840200529      ** maintenance/enquiry.                                                                 CSW209
071850200529      *                                                                                       CSW209
071860200529     C                   IF        PParmLink = 'Y'                                            CSW209
071870200529      *                                                                                       CSW209
071880200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.                               CSW209
071890200529      *                                                                                       CSW209
071900200529     C                   EVAL      PEINKG = 'N'                                               CSW209
071910200529     C                   EVAL      PEINKH = 'N'                                               CSW209
071920200529     C                   EVAL      PEINKP = 'N'                                               CSW209
071930200529      *                                                                                       CSW209
071940200529     C                   ELSE                                                                 CSW209
071950200529      *                                                                                       CSW209
071960200529     C                   EVAL      PEINKG = 'Y'                                               CSW209
071970200529     C                   EVAL      PEINKH = 'Y'                                               CSW209
071980200529     C                   EVAL      PEINKP = 'Y'                                               CSW209
071990200529      *                                                                                       CSW209
072000200529     C                   ENDIF                                                                CSW209
072010200529      *                                                                                       CSW209
072020200529      ** Display Level 2 screen 7.                                                            CSW209
072030200529      *                                                                                       CSW209
072040200529     C                   CALL      'FTIPAY7DP'                                                CSW209
072050200529      *                                                                                       CSW209
072060200529      ** INPUT                                                                                CSW209
072070200529      ** =====                                                                                CSW209
072080200529      *                                                                                       CSW209
072090200529      ** Return Code                                                                          CSW209
072100200529     C                   PARM      *BLANKS       RetCodeOut                                   CSW209
072110200529      *                                                                                       CSW209
072120200529      ** Action Code                                                                          CSW209
072130200529     C                   PARM                    DDACTN                                       CSW209
072140200529      *                                                                                       CSW209
072150200529      ** Payment Reference                                                                    CSW209
072160200529     C                   PARM                    DDPREF                                       CSW209
072170200529      *                                                                                       CSW209
072180200529      ** Incoming Payments Lvl 2 Scrn 7 from transaction - screen format                      CSW209
072190200529     C                   PARM                    NwIP7ScnFmt                                  CSW209
072200200529      *                                                                                       CSW209
072210200529      ** Incoming Payments for file update - file format                                      CSW209
072220200529     C                   PARM                    NwIPFilFmt                                   CSW209
072230200529      *                                                                                       CSW209
072240200529      ** Incoming Payment Status                                                              CSW209
072250200529     C                   PARM                    PStatus                                      CSW209
072260200529      *                                                                                       CSW209
072270200529      ** Enable Detail Fields                                                                 CSW209
072280200529     C                   PARM                    PEDTFLD                                      CSW209
072290200529      *                                                                                       CSW209
072300200529      ** Enable Function Keys                                                                 CSW209
072310200529      ** KG = Command Key 07 = Read Previous                                                  CSW209
072320200529      ** KH = Command Key 08 = Read Next                                                      CSW209
072330200529      ** KP = Command Key 15 = Browse                                                         CSW209
072340200529     C                   PARM                    PEINKG                                       CSW209
072350200529     C                   PARM                    PEINKH                                       CSW209
072360200529     C                   PARM                    PEINKP                                       CSW209
072370200529      *                                                                                       CSW209
072380200529      ** Incoming Payments Lvl 2 Scrn 7 error indicators                                      CSW209
072390200529     C                   PARM                    FTEIPY7                                      CSW209
072400200529      *                                                                                       CSW209
072410200529      ** Error fields/message IDs/message data (arrays) from/to caller                        CSW209
072420200529     C                   PARM                    FldNameArr                                   CSW209
072430200529     C                   PARM                    MsgIdArr                                     CSW209
072440200529     C                   PARM                    MsgDtaArr                                    CSW209
072450200529      *                                                                                       CSW209
072460200529      ** Warning fields/message Ids/message data (arrays) from/to                             CSW209
072470200529      ** caller                                                                               CSW209
072480200529     C                   PARM                    WFldNamArr                                   CSW209
072490200529     C                   PARM                    WMsgIdArr                                    CSW209
072500200529     C                   PARM                    WMsgDtaArr                                   CSW209
072510200529      *                                                                                       CSW209
072520200529      ** Write Screen with No Read Indicator                                                  CSW209
072530200529     C                   PARM      'N'           PWriteOnly                                   CSW209
072540200529      *                                                                                       CSW209
072550200529      ** STANDING DATA                                                                        CSW209
072560200529      ** =============                                                                        CSW209
072570200529      *                                                                                       CSW209
072580200529      ** SDBANK - System Runday                                                               CSW209
072590200529     C                   PARM                    BJMRDT                                       CSW209
072600200529      *                                                                                       CSW209
072610200529      ** SDBANK - Default branch code                                                         CSW209
072620200529     C                   PARM                    BJSBRC                                       CSW209
072630200529      *                                                                                       CSW209
072640200529      ** OUTPUT                                                                               CSW209
072650200529      ** ======                                                                               CSW209
072660200529      *                                                                                       CSW209
072670200529      ** Function Keys Enabled                                                                CSW209
072680200529      ** KC = Command Key 03 = Exit                                                           CSW209
072690200529      ** KG = Command Key 07 = Read Previous                                                  CSW209
072700200529      ** KH = Command Key 08 = Read Next                                                      CSW209
072710200529      ** KL = Command Key 12 = Cancel                                                         CSW209
072720200529      ** KP = Command Key 15 = Browse                                                         CSW209
072730200529     C                   PARM                    PINKC                                        CSW209
072740200529     C                   PARM                    PINKG                                        CSW209
072750200529     C                   PARM                    PINKH                                        CSW209
072760200529     C                   PARM                    PINKL                                        CSW209
072770200529     C                   PARM                    PINKP                                        CSW209
072780200529      *                                                                                       CSW209
072790200529      ** Save Warning Message Ids array of Level 2 screen 7.                                  CSW209
072800200529      *                                                                                       CSW209
072810200529     C                   MOVEL     WMsgIDArr     WPrvWarnAr                                   CSW209
072820200529      *                                                                                       CSW209
072830200529      ** Reset error fields.                                                                  CSW209
072840200529      *                                                                                       CSW209
072850200529     C                   EXSR      SRResetErr                                                 CSW209
072860200529      *                                                                                       CSW209
072870200529     C                   SELECT                                                               CSW209
072880200529      *                                                                                       CSW209
072890200529      ** F3 - end program.                                                                    CSW209
072900200529      *                                                                                       CSW209
072910200529     C     PINKC         WHENEQ    *ON                                                        CSW209
072920200529     C                   EXSR      SREndP                                                     CSW209
072930200529      *                                                                                       CSW209
072940200529      ** F7 - roll backwards.                                                                 CSW209
072950200529      *                                                                                       CSW209
072960200529     C     PINKG         WHENEQ    *ON                                                        CSW209
072970200529     C                   EXSR      SRRoll                                                     CSW209
072980200529      *                                                                                       CSW209
072990200529      ** F8 - roll forwards.                                                                  CSW209
073000200529      *                                                                                       CSW209
073010200529     C     PINKH         WHENEQ    *ON                                                        CSW209
073020200529     C                   EXSR      SRRoll                                                     CSW209
073030200529      *                                                                                       CSW209
073040200529      ** F12 - cancel.  Refresh Level 2 screen 7 and redisplay                                CSW209
073050200529      ** Level 2 screen 4.                                                                    CSW209
073060200529      *                                                                                       CSW209
073070200529     C     PINKL         WHENEQ    *ON                                                        CSW209
073080200529     C                   MOVEL     CrIP7ScnFmt   NwIP7ScnFmt                                  CSW209
073090200529     C                   MOVEL     'D'           WScrn                                        CSW209
073100200529      *                                                                                       CSW209
073110200529      ** F15 - build Browse.                                                                  CSW209
073120200529      *                                                                                       CSW209
073130200529     C     PINKP         WHENEQ    *ON                                                        CSW209
073140200529     C                   EXSR      SRBldBrw                                                   CSW209
073150200529      *                                                                                       CSW209
073160200529      ** Enter key was pressed.                                                               CSW209
073170200529      *                                                                                       CSW209
073180200529     C                   OTHER                                                                CSW209
073190200529      *                                                                                       CSW209
073200200529      ** If Action is Insert or Amend, validate input to                                      CSW209
073210200529      ** Level 2 screen 7.                                                                    CSW209
073220200529      *                                                                                       CSW209
073230200529     C                   IF        DDACTN = 'I' OR                                            CSW209
073240200529     C                             DDACTN = 'A'                                               CSW209
073250200529      *                                                                                       CSW209
073260200529     C                   EXSR      SRVal_N                                                    CSW209
073270200529      *                                                                                       CSW209
073280200529     C                   ELSE                                                                 CSW209
073290200529     C                   EVAL      WScrn = 'O'                                                CSW209
073300200529      *                                                                                       CSW209
073310200529     C                   ENDIF                                                                CSW209
073320200529      *                                                                                       CSW209
073330200529     C                   ENDSL                                                                CSW209
073340200529      *                                                                                       CSW209
073350200529     C                   ENDSR                                                                CSW209
073360200529      *****************************************************************                       CSW209
073370200529      /EJECT                                                                                  CSW209
073380200529      *****************************************************************                       CSW209
073390200529      *                                                               *                       CSW209
073400200529      *  SRScrn_O - Process Level 2 screen 8                          *                       CSW209
073410200529      *                                                               *                       CSW209
073420200529      *****************************************************************                       CSW209
073430200529      *                                                                                       CSW209
073440200529     C     SRScrn_O      BEGSR                                                                CSW209
073450200529      *                                                                                       CSW209
073460200529      ** If Action Code is Insert or Amend, enable Detail                                     CSW209
073470200529      ** fields on Level 2 screen 8 (all fields on Level 2                                    CSW209
073480200529      ** screen 8 except Action Code and Payment Reference).                                  CSW209
073490200529      *                                                                                       CSW209
073500200529     C                   IF        DDACTN = 'I' OR                                            CSW209
073510200529     C                             DDACTN = 'A'                                               CSW209
073520200529     C                   EVAL      PEDTFLD = 'Y'                                              CSW209
073530200529     C                   ELSE                                                                 CSW209
073540200529     C                   EVAL      PEDTFLD = 'N'                                              CSW209
073550200529     C                   ENDIF                                                                CSW209
073560200529      *                                                                                       CSW209
073570200529      ** Incoming Payments Maintenance has been called by linked                              CSW209
073580200529      ** maintenance/enquiry.                                                                 CSW209
073590200529      *                                                                                       CSW209
073600200529     C                   IF        PParmLink = 'Y'                                            CSW209
073610200529      *                                                                                       CSW209
073620200529      ** Disable F7=Read Previous, F8=Read Next and F15=Browse.                               CSW209
073630200529      *                                                                                       CSW209
073640200529     C                   EVAL      PEINKG = 'N'                                               CSW209
073650200529     C                   EVAL      PEINKH = 'N'                                               CSW209
073660200529     C                   EVAL      PEINKP = 'N'                                               CSW209
073670200529      *                                                                                       CSW209
073680200529     C                   ELSE                                                                 CSW209
073690200529      *                                                                                       CSW209
073700200529     C                   EVAL      PEINKG = 'Y'                                               CSW209
073710200529     C                   EVAL      PEINKH = 'Y'                                               CSW209
073720200529     C                   EVAL      PEINKP = 'Y'                                               CSW209
073730200529      *                                                                                       CSW209
073740200529     C                   ENDIF                                                                CSW209
073750200529      *                                                                                       CSW209
073760200529      ** Display Level 2 screen 8.                                                            CSW209
073770200529      *                                                                                       CSW209
073780200529     C                   CALL      'FTIPAY8DP'                                                CSW209
073790200529      *                                                                                       CSW209
073800200529      ** INPUT                                                                                CSW209
073810200529      ** =====                                                                                CSW209
073820200529      *                                                                                       CSW209
073830200529      ** Return Code                                                                          CSW209
073840200529     C                   PARM      *BLANKS       RetCodeOut                                   CSW209
073850200529      *                                                                                       CSW209
073860200529      ** Action Code                                                                          CSW209
073870200529     C                   PARM                    DDACTN                                       CSW209
073880200529      *                                                                                       CSW209
073890200529      ** Payment Reference                                                                    CSW209
073900200529     C                   PARM                    DDPREF                                       CSW209
073910200529      *                                                                                       CSW209
073920200529      ** Incoming Payments Lvl 2 Scrn 8 from transaction - screen format                      CSW209
073930200529     C                   PARM                    NwIP8ScnFmt                                  CSW209
073940200529      *                                                                                       CSW209
073950200529      ** Incoming Payments for file update - file format                                      CSW209
073960200529     C                   PARM                    NwIPFilFmt                                   CSW209
073970200529      *                                                                                       CSW209
073980200529      ** Incoming Payment Status                                                              CSW209
073990200529     C                   PARM                    PStatus                                      CSW209
074000200529      *                                                                                       CSW209
074010200529      ** Enable Detail Fields                                                                 CSW209
074020200529     C                   PARM                    PEDTFLD                                      CSW209
074030200529      *                                                                                       CSW209
074040200529      ** Enable Function Keys                                                                 CSW209
074050200529      ** KG = Command Key 07 = Read Previous                                                  CSW209
074060200529      ** KH = Command Key 08 = Read Next                                                      CSW209
074070200529      ** KP = Command Key 15 = Browse                                                         CSW209
074080200529     C                   PARM                    PEINKG                                       CSW209
074090200529     C                   PARM                    PEINKH                                       CSW209
074100200529     C                   PARM                    PEINKP                                       CSW209
074110200529      *                                                                                       CSW209
074120200529      ** Incoming Payments Lvl 2 Scrn 8 error indicators                                      CSW209
074130200529     C                   PARM                    FTEIPY8                                      CSW209
074140200529      *                                                                                       CSW209
074150200529      ** Error fields/message IDs/message data (arrays) from/to caller                        CSW209
074160200529     C                   PARM                    FldNameArr                                   CSW209
074170200529     C                   PARM                    MsgIdArr                                     CSW209
074180200529     C                   PARM                    MsgDtaArr                                    CSW209
074190200529      *                                                                                       CSW209
074200200529      ** Warning fields/message Ids/message data (arrays) from/to                             CSW209
074210200529      ** caller                                                                               CSW209
074220200529     C                   PARM                    WFldNamArr                                   CSW209
074230200529     C                   PARM                    WMsgIdArr                                    CSW209
074240200529     C                   PARM                    WMsgDtaArr                                   CSW209
074250200529      *                                                                                       CSW209
074260200529      ** Write Screen with No Read Indicator                                                  CSW209
074270200529     C                   PARM      'N'           PWriteOnly                                   CSW209
074280200529      *                                                                                       CSW209
074290200529      ** STANDING DATA                                                                        CSW209
074300200529      ** =============                                                                        CSW209
074310200529      *                                                                                       CSW209
074320200529      ** SDBANK - System Runday                                                               CSW209
074330200529     C                   PARM                    BJMRDT                                       CSW209
074340200529      *                                                                                       CSW209
074350200529      ** SDBANK - Default branch code                                                         CSW209
074360200529     C                   PARM                    BJSBRC                                       CSW209
074370200529      *                                                                                       CSW209
074380200529      ** OUTPUT                                                                               CSW209
074390200529      ** ======                                                                               CSW209
074400200529      *                                                                                       CSW209
074410200529      ** Function Keys Enabled                                                                CSW209
074420200529      ** KC = Command Key 03 = Exit                                                           CSW209
074430200529      ** KG = Command Key 07 = Read Previous                                                  CSW209
074440200529      ** KH = Command Key 08 = Read Next                                                      CSW209
074450200529      ** KL = Command Key 12 = Cancel                                                         CSW209
074460200529      ** KP = Command Key 15 = Browse                                                         CSW209
074470200529     C                   PARM                    PINKC                                        CSW209
074480200529     C                   PARM                    PINKG                                        CSW209
074490200529     C                   PARM                    PINKH                                        CSW209
074500200529     C                   PARM                    PINKL                                        CSW209
074510200529     C                   PARM                    PINKP                                        CSW209
074520200529      *                                                                                       CSW209
074530200529      ** Save Warning Message Ids array of Level 2 screen 8.                                  CSW209
074540200529      *                                                                                       CSW209
074550200529     C                   MOVEL     WMsgIDArr     WPrvWarnAr                                   CSW209
074560200529      *                                                                                       CSW209
074570200529      ** Reset error fields.                                                                  CSW209
074580200529      *                                                                                       CSW209
074590200529     C                   EXSR      SRResetErr                                                 CSW209
074600200529      *                                                                                       CSW209
074610200529     C                   SELECT                                                               CSW209
074620200529      *                                                                                       CSW209
074630200529      ** F3 - end program.                                                                    CSW209
074640200529      *                                                                                       CSW209
074650200529     C     PINKC         WHENEQ    *ON                                                        CSW209
074660200529     C                   EXSR      SREndP                                                     CSW209
074670200529      *                                                                                       CSW209
074680200529      ** F7 - roll backwards.                                                                 CSW209
074690200529      *                                                                                       CSW209
074700200529     C     PINKG         WHENEQ    *ON                                                        CSW209
074710200529     C                   EXSR      SRRoll                                                     CSW209
074720200529      *                                                                                       CSW209
074730200529      ** F8 - roll forwards.                                                                  CSW209
074740200529      *                                                                                       CSW209
074750200529     C     PINKH         WHENEQ    *ON                                                        CSW209
074760200529     C                   EXSR      SRRoll                                                     CSW209
074770200529      *                                                                                       CSW209
074780200529      ** F12 - cancel.  Refresh Level 2 screen 8 and redisplay                                CSW209
074790200529      ** Level 2 screen 7.                                                                    CSW209
074800200529      *                                                                                       CSW209
074810200529     C     PINKL         WHENEQ    *ON                                                        CSW209
074820200529     C                   MOVEL     CrIP8ScnFmt   NwIP8ScnFmt                                  CSW209
074830200529     C                   MOVEL     'N'           WScrn                                        CSW209
074840200529      *                                                                                       CSW209
074850200529      ** F15 - build Browse.                                                                  CSW209
074860200529      *                                                                                       CSW209
074870200529     C     PINKP         WHENEQ    *ON                                                        CSW209
074880200529     C                   EXSR      SRBldBrw                                                   CSW209
074890200529      *                                                                                       CSW209
074900200529      ** Enter key was pressed.                                                               CSW209
074910200529      *                                                                                       CSW209
074920200529     C                   OTHER                                                                CSW209
074930200529      *                                                                                       CSW209
074940200529      ** If Action is Insert or Amend, validate input to                                      CSW209
074950200529      ** Level 2 screen 8.                                                                    CSW209
074960200529      *                                                                                       CSW209
074970200529     C                   IF        DDACTN = 'I' OR                                            CSW209
074980200529     C                             DDACTN = 'A'                                               CSW209
074990200529      *                                                                                       CSW209
075000200529     C                   EXSR      SRVal_O                                                    CSW209
075010200529     C                   LEAVESR                                                              CSW209
075020200529      *                                                                                       CSW209
075030200529     C                   ELSE                                                                 CSW209
075040200529     C                   EVAL      WScrn = 'F'                                                CSW209
075050200529      *                                                                                       CSW209
075060200529     C                   ENDIF                                                                CSW209
075070200529      *                                                                                       CSW209
075080200529      ** If Incoming Payments Maintenance has been called by                                  CSW209
075090200529      ** linked maintenance/enquiry, terminate program.                                       CSW209
075100200529      *                                                                                       CSW209
075110200529     C                   IF        PParmLink = 'Y'                                            CSW209
075120200529     C                   MOVEL     *BLANK        PParmRtcd                                    CSW209
075130200529     C                   MOVEL     'T'           WScrn                                        CSW209
075140200529     C                   LEAVESR                                                              CSW209
075150200529     C                   ENDIF                                                                CSW209
075160200529      *                                                                                       CSW209
075170200529      ** Read Next Browse Subfile record.                                                     CSW209
075180200529      *                                                                                       CSW209
075190200529     C                   IF        PRDNB = 'Y'                                                CSW209
075200200529     C                   MOVEL     'R'           WScrn                                        CSW209
075210200529     C                   LEAVESR                                                              CSW209
075220200529     C                   ENDIF                                                                CSW209
075230200529      *                                                                                       CSW209
075240200529      ** Otherwise, display Initial screen with blank fields.                                 CSW209
075250200529      *                                                                                       CSW209
075260200529     C                   MOVEL     *BLANKS       DDACTN                                       CSW209
075270200529     C                   MOVEL     *BLANKS       DDPREF                                       CSW209
075280200529     C                   MOVEL     *BLANKS       DDSWTN                                       CSW209
075290200529     C                   MOVEL     *BLANKS       DDSEQNO                                      CSW209
075300200529     C                   MOVEL     *BLANKS       DDBRCA                                       CSW209
075310200529     C                   MOVEL     'I'           WScrn                                        CSW209
075320200529      *                                                                                       CSW209
075330200529     C                   ENDSL                                                                CSW209
075340200529      *                                                                                       CSW209
075350200529     C                   ENDSR                                                                CSW209
075360200529      *****************************************************************                       CSW209
075370200529      /EJECT                                                                                  CSW209
075380200529      *****************************************************************                       CSW209
075390200529      *                                                               *                       CSW209
075400200529      *  SRVal_N - Validate input to Level 2 screen 7                 *                       CSW209
075410200529      *                                                               *                       CSW209
075420200529      *****************************************************************                       CSW209
075430200529      *                                                                                       CSW209
075440200529     C     SRVal_N       BEGSR                                                                CSW209
075450200529      *                                                                                       CSW209
075460200529     C                   CALLB     'FTIPAY7VL'                                                CSW209
075470200529      *                             =========                                                 CSW209
075480200529      ** INPUT                                                                                CSW209
075490200529      ** =====                                                                                CSW209
075500200529      *                                                                                       CSW209
075510200529      ** Mode = '*FRONT' (Front Office Transaction Interface)                                 CSW209
075520200529      ** Mode = '      ' (Not Front Office Transaction Interface)                             CSW209
075530200529      ** Mode = '*RPR  ' (Repair Function)                                                    CSW209
075540200529      ** Mode = '*SIN  ' (Screen Input Function)                                              CSW209
075550200529     C                   PARM                    PMode                                        CSW209
075560200529      *                                                                                       CSW209
075570200529      ** Incoming Payments details from incoming transaction                                  CSW209
075580200529      ** - screen format                                                                      CSW209
075590200529     C                   PARM                    NwIPFilFmt                                   CSW209
075600200529     C                   PARM                    NwIP2ScnFmt                                  CSW209
075610200529     C                   PARM                    NwIP4ScnFmt                                  CSW209
075620200529     C                   PARM                    NwIP7ScnFmt                                  CSW209
075630200529      *                                                                                       CSW209
075640200529      ** OUTPUT                                                                               CSW209
075650200529      ** ======                                                                               CSW209
075660200529      *                                                                                       CSW209
075670200529      ** Error fields/message IDs/message data (arrays) from/to caller                        CSW209
075680200529     C                   PARM                    FldNameArr                                   CSW209
075690200529     C                   PARM                    MsgIdArr                                     CSW209
075700200529     C                   PARM                    MsgDtaArr                                    CSW209
075710200529      *                                                                                       CSW209
075720200529      ** Array index (3P0) from/to caller                                                     CSW209
075730200529     C                   PARM                    Idx                                          CSW209
075740200529      *                                                                                       CSW209
075750200529      ** Warning flds/message IDs/message data (arrays) from/to caller                        CSW209
075760200529     C                   PARM                    WFldNamArr                                   CSW209
075770200529     C                   PARM                    WMsgIdArr                                    CSW209
075780200529     C                   PARM                    WMsgDtaArr                                   CSW209
075790200529      *                                                                                       CSW209
075800200529      ** Array index (3P0) from/to caller                                                     CSW209
075810200529     C                   PARM                    WIDx                                         CSW209
075820200529      *                                                                                       CSW209
075830200529      ** Incoming Payments Lvl 2 Scrn 7 error indicators                                      CSW209
075840200529     C                   PARM                    FTEIPY7                                      CSW209
075850200529      *                                                                                       CSW209
075860200529      ** Incoming Payments (additional details) for file update                               CSW209
075870200529     C                   PARM                    NwIP2FilFmt                                  CSW209
075880200529      *                                                                                       CSW209
075890200529      ** If no errors occurred during validation of fields on Level 2                         CSW209
075900200529      ** screen 7, check if there are warnings which have not been                            CSW209
075910200529      ** displayed yet.                                                                       CSW209
075920200529      *                                                                                       CSW209
075930200529     C                   EVAL      WRedisplay = ' '                                           CSW209
075940200529     C                   Z-ADD     1             WIx                                          CSW209
075950200529      *                                                                                       CSW209
075960200529     C     WIx           DOWLE     WIDx                                                       CSW209
075970200529     C     WRedisplay    ANDEQ     *BLANK                                                     CSW209
075980200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)                          CSW209
075990200529     C                   EVAL      WRedisplay = 'Y'                                           CSW209
076000200529     C                   ELSE                                                                 CSW209
076010200529     C                   EVAL      WIx =WIx + 1                                               CSW209
076020200529     C                   ENDIF                                                                CSW209
076030200529     C                   ENDDO                                                                CSW209
076040200529      *                                                                                       CSW209
076050200529      ** If no warnings which haven't been displayed then replace                             CSW209
076060200529      ** any previous warnings (W) with ok (Y).                                               CSW209
076070200529      *                                                                                       CSW209
076080200529     C                   IF        WRedisplay <> 'Y'                                          CSW209
076090200529     C                   EVAL      *IN81 = *ON                                                CSW209
076100200529                                                                                              CSW209
076110200529     C                   DOW       *IN81 = *ON                                                CSW209
076120200529     C     'W'           SCAN      FTEIPY7:1     @P                3 0    81                  CSW209
076130200529                                                                                              CSW209
076140200529     C     *IN81         IFEQ      *ON                                                        CSW209
076150200529     C                   EVAL      %SUBST(FTEIPY7:@P:1) = 'Y'                                 CSW209
076160200529     C                   ENDIF                                                                CSW209
076170200529                                                                                              CSW209
076180200529     C                   ENDDO                                                                CSW209
076190200529                                                                                              CSW209
076200200529      ** Clear warnings so it will not be displayed on the next screen                        CSW209
076210200529     C                   EVAL      WMsgIdArr = *BLANKS                                        CSW209
076220200529                                                                                              CSW209
076230200529     C                   ENDIF                                                                CSW209
076240200529      *                                                                                       CSW209
076250200529      ** If no errors occurred during validation of Level 2                                   CSW209
076260200529      ** screen 7 and if there are no warnings which have not been                            CSW209
076270200529      ** displayed, display Cover Message screen 2.                                           CSW209
076280200529      *                                                                                       CSW209
076290200529     C     IDx           IFEQ      *ZERO                                                      CSW209
076300200529     C     WRedisplay    ANDEQ     *BLANK                                                     CSW209
076310200529     C                   MOVEL     'O'           WScrn                                        CSW209
076320200529     C                   ENDIF                                                                CSW209
076330200529      *                                                                                       CSW209
076340200529     C                   ENDSR                                                                CSW209
076350200529      *                                                                                       CSW209
076360200529      *****************************************************************                       CSW209
076370200529      /EJECT                                                                                  CSW209
076380200529      *****************************************************************                       CSW209
076390200529      *                                                               *                       CSW209
076400200529      *  SRVal_O - Validate input to Level 2 screen 8                 *                       CSW209
076410200529      *                                                               *                       CSW209
076420200529      *****************************************************************                       CSW209
076430200529      *                                                                                       CSW209
076440200529     C     SRVal_O       BEGSR                                                                CSW209
076450200529      *                                                                                       CSW209
076460200529     C                   CALLB     'FTIPAY8VL'                                                CSW209
076470200529      *                             =========                                                 CSW209
076480200529      ** INPUT                                                                                CSW209
076490200529      ** =====                                                                                CSW209
076500200529      *                                                                                       CSW209
076510200529      ** Mode = '*FRONT' (Front Office Transaction Interface)                                 CSW209
076520200529      ** Mode = '      ' (Not Front Office Transaction Interface)                             CSW209
076530200529      ** Mode = '*RPR  ' (Repair Function)                                                    CSW209
076540200529      ** Mode = '*SIN  ' (Screen Input Function)                                              CSW209
076550200529     C                   PARM                    PMode                                        CSW209
076560200529      *                                                                                       CSW209
076570200529      ** Incoming Payments details from incoming transaction                                  CSW209
076580200529      ** - screen format                                                                      CSW209
076590200529     C                   PARM                    NwIP7ScnFmt                                  CSW209
076600200529     C                   PARM                    NwIP8ScnFmt                                  CSW209
076610200529      *                                                                                       CSW209
076620200529      ** OUTPUT                                                                               CSW209
076630200529      ** ======                                                                               CSW209
076640200529      *                                                                                       CSW209
076650200529      ** Error fields/message IDs/message data (arrays) from/to caller                        CSW209
076660200529     C                   PARM                    FldNameArr                                   CSW209
076670200529     C                   PARM                    MsgIdArr                                     CSW209
076680200529     C                   PARM                    MsgDtaArr                                    CSW209
076690200529      *                                                                                       CSW209
076700200529      ** Array index (3P0) from/to caller                                                     CSW209
076710200529     C                   PARM                    Idx                                          CSW209
076720200529      *                                                                                       CSW209
076730200529      ** Warning flds/message IDs/message data (arrays) from/to caller                        CSW209
076740200529     C                   PARM                    WFldNamArr                                   CSW209
076750200529     C                   PARM                    WMsgIdArr                                    CSW209
076760200529     C                   PARM                    WMsgDtaArr                                   CSW209
076770200529      *                                                                                       CSW209
076780200529      ** Array index (3P0) from/to caller                                                     CSW209
076790200529     C                   PARM                    WIDx                                         CSW209
076800200529      *                                                                                       CSW209
076810200529      ** Incoming Payments Lvl 2 Scrn 7 error indicators                                      CSW209
076820200529     C                   PARM                    FTEIPY8                                      CSW209
076830200529      *                                                                                       CSW209
076840200529      ** Incoming Payments (additional details) for file update                               CSW209
076850200529     C                   PARM                    NwIP2FilFmt                                  CSW209
076860200529      *                                                                                       CSW209
076870200529      ** If no errors occurred during validation of fields on Level 2                         CSW209
076880200529      ** screen 7, check if there are warnings which have not been                            CSW209
076890200529      ** displayed yet.                                                                       CSW209
076900200529      *                                                                                       CSW209
076910200529      *                                                                                       CSW209
076920200529     C                   EVAL      WRedisplay = ' '                                           CSW209
076930200529     C                   Z-ADD     1             WIx                                          CSW209
076940200529      *                                                                                       CSW209
076950200529     C     WIx           DOWLE     WIDx                                                       CSW209
076960200529     C     WRedisplay    ANDEQ     *BLANK                                                     CSW209
076970200529     C                   IF        WMsgIdArr(WIx) <> WPrvWarnAr(WIx)                          CSW209
076980200529     C                   EVAL      WRedisplay = 'Y'                                           CSW209
076990200529     C                   ELSE                                                                 CSW209
077000200529     C                   EVAL      WIx =WIx + 1                                               CSW209
077010200529     C                   ENDIF                                                                CSW209
077020200529     C                   ENDDO                                                                CSW209
077030200529      *                                                                                       CSW209
077040200529      ** If no warnings which haven't been displayed then replace                             CSW209
077050200529      ** any previous warnings (W) with ok (Y).                                               CSW209
077060200529      *                                                                                       CSW209
077070200529     C                   IF        WRedisplay <> 'Y'                                          CSW209
077080200529     C                   EVAL      *IN81 = *ON                                                CSW209
077090200529                                                                                              CSW209
077100200529     C                   DOW       *IN81 = *ON                                                CSW209
077110200529     C     'W'           SCAN      FTEIPY8:1     @P                3 0    81                  CSW209
077120200529                                                                                              CSW209
077130200529     C     *IN81         IFEQ      *ON                                                        CSW209
077140200529     C                   EVAL      %SUBST(FTEIPY8:@P:1) = 'Y'                                 CSW209
077150200529     C                   ENDIF                                                                CSW209
077160200529                                                                                              CSW209
077170200529     C                   ENDDO                                                                CSW209
077180200529                                                                                              CSW209
077190200529     C                   ENDIF                                                                CSW209
077200200529      *                                                                                       CSW209
077210200529      ** If no errors occurred during validation of Level 2                                   CSW209
077220200529      ** screen 8 and if there are no warnings which have not been                            CSW209
077230200529      ** displayed, display Confirmation screen.                                              CSW209
077240200529      *                                                                                       CSW209
077250200529     C     IDx           IFEQ      *ZERO                                                      CSW209
077260200529     C     WRedisplay    ANDEQ     *BLANK                                                     CSW209
077270200529     C                   MOVEL     'F'           WScrn                                        CSW209
077280200529     C                   ENDIF                                                                CSW209
077290200529      *                                                                                       CSW209
077300200529     C                   ENDSR                                                                CSW209
077310200529      *                                                                                       CSW209
077320200529      *****************************************************************                       CSW209
077330200529      /EJECT                                                                                  204152
077340200529      *****************************************************************                       204152
077350200529      *                                                               *                       204152
077360200529      *  SETPAYREF - Set up Payment Reference                         *                       204152
077370200529      *                                                               *                       204152
077380200529      *****************************************************************                       204152
077390200529      *                                                                                       204152
077400200529     C     SETPAYREF     BEGSR                                                                204152
077410200529      *                                                                                       204152
077420200529      ** Initialise variables used in determining successful                                  204152
077430200529      ** insert of an Incoming Payment.                                                       204152
077440200529      *                                                                                       204152
077450200529     C                   MOVE      *BLANKS       WPREFI           15                          204152
077460200529     C                   MOVE      *BLANK        WInsert           1                          204152
077470200529      *                                                                                       204152
077480200529      ** Update Incoming Payments data area with next                                         204152
077490200529      ** Sequence Number.                                                                     204152
077500200529      *                                                                                       204152
077510200529     C                   IF        CFT151 = 'N'                                               CFT151
077520200529     C     *DTAARA       DEFINE    INPAYDA       WINPAY                                       204152
077530200529     C     *LOCK         IN        WINPAY                                                     204152
077540200529     C                   Z-ADD     WINSQ         WWINSQ            4 0                        204152
077550200529     C**********         ADD       1             WINSQ                                204152 BUG4776
077560200529     C                   ADD       1             WINSQ                                        260326
077570200529     C                   OUT       WINPAY                                                     204152
077580200529     C                   ELSE                                                                 CFT151
077590200529     C                   CALL      'FT000328'                                                 CFT151
077600200529     C                   PARM                    PRTCD                                        CFT151
077610200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
077620200529     C                   PARM      'A'           WCALC                                        CFT151
077630200529     C                   PARM      'Y'           WUPD              1                          CFT151
077640200529     C                   PARM                    WWINSQT           4                          CFT151
077650200529     C                   PARM                    WNEWSQ                                       CFT151
077660200529     C                   END                                                                  CFT151
077670200529      *                                                                                       204152
077680200529      ** Record Id.                                                                           204152
077690200529      *                                                                                       204152
077700200529     C                   MOVEL     'D'           IPRECI                                       204152
077710200529      *                                                                                       204152
077720200529      ** Payment Type.                                                                        204152
077730200529      *                                                                                       204152
077740200529     C                   EVAL      IPPYTP = 'IN'                                              204152
077750200529      *                                                                                       204152
077760200529      ** Original Entry Dates.                                                                204152
077770200529      *                                                                                       204152
077780200529     C                   Z-ADD     BJRDNB        PDayNo                                       204152
077790200529      *                                                                                       204152
077800200529     C                   CALLB     'ZDATE2'                                                   204152
077810200529     C                   PARM                    PDayNo                                       204152
077820200529     C                   PARM      BJDFIN        PFMT                                         204152
077830200529     C                   PARM      *ZERO         PDate                                        204152
077840200529     C                   PARM      *BLANKS       PADate                                       204152
077850200529      *                                                                                       204152
077860200529     C                   Z-ADD     BJRDNB        IPOEDT                                       204152
077870200529     C                   Z-ADD     PDate         IPOEDTD1                                     204152
077880200529      *                                                                                       204152
077890200529     C                   MOVE      PDate         WN2               2 0                        204152
077900200529     C     WN2           IFLT      72                                                         204152
077910200529     C                   Z-ADD     20            IPOEDTD2                                     204152
077920200529     C                   ELSE                                                                 204152
077930200529     C                   Z-ADD     19            IPOEDTD2                                     204152
077940200529     C                   ENDIF                                                                204152
077950200529      *                                                                                       204152
077960200529     C                   MOVEL     PDate         WA4               4                          204152
077970200529     C     BJDFIN        IFNE      'M'                                                        204152
077980200529     C                   MOVEL     WA4           WA2               2                          204152
077990200529     C                   MOVE      WA4           WA2A              2                          204152
078000200529     C                   MOVEL     WA2A          WA4                                          204152
078010200529     C                   MOVE      WA2           WA4                                          204152
078020200529     C                   ENDIF                                                                204152
078030200529      *                                                                                       204152
078040200529     C                   MOVE      PDate         WA2                                          204152
078050200529     C                   MOVEL     WA2           PDate                                        204152
078060200529     C                   MOVE      WA4           PDate                                        204152
078070200529     C                   Z-ADD     PDate         IPOEDTD3                                     204152
078080200529      *                                                                                       204152
078090200529      ** New Payment Reference.                                                               204152
078100200529      *                                                                                       204152
078110200529     C                   IF        (CSC011 = 'Y') AND (LIBR = S1SUPP)                         204152
078120200529     C                   Z-ADD     WPRDTE        PDAYNO                                       204152
078130200529     C                   CALLB     'ZDATE2'                                                   204152
078140200529     C                   PARM                    PDAYNO                                       204152
078150200529     C                   PARM      BJDFIN        PFMT                                         204152
078160200529     C                   PARM      *ZERO         PPRDATE                                      204152
078170200529     C                   PARM      *BLANKS       PPRADATE                                     204152
078180200529      *                                                                                       204152
078190200529     C                   MOVEL     PPRDATE       WA4                                          204152
078200200529     C     BJDFIN        IFNE      'M'                                                        204152
078210200529     C                   MOVEL     WA4           WA2                                          204152
078220200529     C                   MOVE      WA4           WA2A                                         204152
078230200529     C                   MOVEL     WA2A          WA4                                          204152
078240200529     C                   MOVE      WA2           WA4                                          204152
078250200529     C                   ENDIF                                                                204152
078260200529      *                                                                                       204152
078270200529     C                   MOVE      PPRDATE       WA2                                          204152
078280200529     C                   MOVEL     WA2           PPRDATE                                      204152
078290200529     C                   MOVE      WA4           PPRDATE                                      204152
078300200529     C                   MOVE      PPRDATE       WA6                                          204152
078310200529     C                   ELSE                                                                 204152
078320200529     C                   MOVE      PDate         WA6               6                          204152
078330200529     C                   ENDIF                                                                204152
078340200529     C                   IF        CFT151  = 'N'                                              CFT151
078350200529     C                   MOVE      WWINSQ        WA4                                          204152
078360200529     C                   ELSE                                                                 CFT151
078370200529     C                   MOVE      WWINSQT       WA4                                          CFT151
078380200529     C                   END                                                                  CFT151
078390200529     C                   MOVE      'P'           WYA2(1)                                      204152
078400200529     C                   MOVEA     WA6           WYA2(2)                                      204152
078410200529     C                   MOVEA     WA4           WYA2(8)                                      204152
078420200529     C                   MOVEA     IPPYTP        WYA2(12)                                     204152
078430200529     C                   MOVEA     '00'          WYA2(14)                                     204152
078440200529      *                                                                                       204152
078450200529     C     1             DO        15            IA                2 0                        204152
078460200529     C     WYA2(IA)      IFEQ      ' '                                                        204152
078470200529     C                   MOVEL     '0'           WYA2(IA)                                     204152
078480200529     C                   ENDIF                                                                204152
078490200529     C                   ENDDO                                                                204152
078500200529      *                                                                                       204152
078510200529      ***Suppress*new*payment*reference*generation*if*CSC024*is                        CSC024 CSC054
078520200529      ***switched*on*and*this*is*running*on*OME*system.                                CSC024 CSC054
078530200529      ** Suppress new payment reference generation if CSC054 is                               CSC024
078540200529      ** switched on and this is running on PEA system.                                       CSC024
078550200529                                                                                              CSC024
078560200529     C                   IF        GENPREF = 'Y'                                              CSC024
078570200529     C                   MOVEA     WYA2(1)       IPPREF                                       204152
078580200529     C                   MOVEL     IPPREF        DDPREF                                       210733
078590200529     C**********         MOVEL     IPPREF        WIPREF                               BUG4776 260326
078600200529     C******LOCK         IN        WINPAY                                             BUG4776 260326
078610200529     C**********         ADD       1             WINSQ                                BUG4776 260326
078620200529     C**********         EVAL      WPRNUM = WINSQ                                     BUG4776 260326
078630200529     C**********         EXSR      SETPREFSQ                                          BUG4776 260326
078640200529     C**********         OUT       WINPAY                                             BUG4776 260326
078650200529     C                   ELSE                                                                 CSC024
078660200529     C                   EVAL      IPPREF = DDPREF                                            CSC024
078670200529     C                   ENDIF                                                                CSC024
078680200529      *                                                                                       204152
078690200529     C                   ENDSR                                                                204152
078700200529      *****************************************************************                       204152
078710200529      /EJECT
078720200529      *****************************************************************               BUG4776 260326
078730200529      **SETPPREFSQ*Set*up*Next*Payment*Reference*sequence**************               BUG4776 260326
078740200529      *****************************************************************               BUG4776 260326
078750200529     C*****SETPREFSQ     BEGSR                                                        BUG4776 260326
078760200529      *****************************************************************               BUG4776 260326
078770200529     C**********         MOVE      'N'           WUREF1            1                  BUG4776 260326
078780200529     C*****WUREF1        DOWEQ     'N'                                                BUG4776 260326
078790200529      *****************************************************************               BUG4776 260326
078800200529     C*****WIPREF        CHAIN     FTPREFL1                           83              BUG4776 260326
078810200529      *****************************************************************               BUG4776 260326
078820200529      ****If*Payment*Reference*is*found,*increment*WINSQ*by*1.*********               BUG4776 260326
078830200529      *****************************************************************               BUG4776 260326
078840200529     C******IN83         IFEQ      '0'                                                BUG4776 260326
078850200529     C**********         EVAL      WINSQ = WINSQ + 1                                  BUG4776 260326
078860200529     C**********         EVAL      WPRNUM = WINSQ                                     BUG4776 260326
078870200529      *****************************************************************               BUG4776 260326
078880200529     C**********         ELSE                                                         BUG4776 260326
078890200529      *****************************************************************               BUG4776 260326
078900200529      ****Else*move*'Y'*to*WUREF*to*stop*the*loop.*********************               BUG4776 260326
078910200529      *****************************************************************               BUG4776 260326
078920200529     C**********         MOVE      'Y'           WUREF1                               BUG4776 260326
078930200529     C**********         ENDIF                                                        BUG4776 260326
078940200529      *****************************************************************               BUG4776 260326
078950200529     C**********         ENDDO                                                        BUG4776 260326
078960200529      *****************************************************************               BUG4776 260326
078970200529     C**********         ENDSR                                                        BUG4776 260326
078980200529      *****************************************************************               BUG4776 260326
078990200529      ***/EJECT                                                                       BUG4776 260326
079000200529      *****************************************************************
079010200529      *                                                               *
079020200529      *  SRUpdate - Update files                                      *
079030200529      *                                                               *
079040200529      *****************************************************************
079050200529      *
079060200529     C     SRUpdate      BEGSR
079070200529      *
079080200529      ** Initialise Originally Insert from Level 2 Entry flag.
079090200529      *
079100200529     C                   MOVE      *BLANK        POrigACTN
079110200529      *
079120200529      ** Initialise variables used in determining successful
079130200529      ** insert of an Incoming Payment.
079140200529      *
079150200529     C                   MOVE      *BLANKS       WPREFI           15
079160200529     C                   MOVE      *BLANK        WInsert           1
079170200529      *
079180200529      ** Action is Insert.
079190200529      *
079200200529     C     DDACTN        IFEQ      'I'
079210200529     C/COPY WNCPYSRC,FTIPAYSC12
079220200529      **********                                                                       CER001 247665
079230200529      **********                                                                       CER001 247665
079240200529      ***check*if*already*allocated*in*window                                          CER001 247665
079250200529      **********                                                                       CER001 247665
079260200529     C*****IPPREF        ANDEQ     *BLANKS                                             CER001 247665
079270200529      **********                                                                       CER001 247665
079280200529      *
079290200529      ** Entry point is Level 1.
079300200529      *
079310200529     C     PParmLevel    IFEQ      '1'
079320200529     C/COPY WNCPYSRC,FTIPAYSC18
079330200529      *
079340200529      ***Update*Incoming Payments data area with next                                         204152
079350200529      ***Sequence*Number.                                                                     204152
079360200529      **********                                                                              204152
079370200529     C**** *DTAARA       DEFINE    INPAYDA       WINPAY                                       204152
079380200529     C**** *LOCK         IN        WINPAY                                                     204152
079390200529     C**********         Z-ADD     WINSQ         WWINSQ            4 0                        204152
079400200529     C**********         ADD       1             WINSQ                                        204152
079410200529     C**********         OUT       WINPAY                                                     204152
079420200529      **********                                                                              204152
079430200529      ***Record*Id.                                                                           204152
079440200529      **********                                                                              204152
079450200529     C**********         MOVEL     'D'           IPRECI                                       204152
079460200529      **********                                                                              204152
079470200529      ***Payment Type.                                                                        204152
079480200529      **********                                                                              204152
079490200529     C**********         EVAL      IPPYTP = 'IN'                                              204152
079500200529      **********                                                                              204152
079510200529      ***Original Entry Dates.                                                                204152
079520200529      **********                                                                              204152
079530200529     C**********         Z-ADD     BJRDNB        PDayNo                                       204152
079540200529      **********                                                                              204152
079550200529     C**********         CALLB     'ZDATE2'                                                   204152
079560200529     C**********         PARM                    PDayNo                                       204152
079570200529     C**********         PARM      BJDFIN        PFMT                                         204152
079580200529     C**********         PARM      *ZERO         PDate                                        204152
079590200529     C**********         PARM      *BLANKS       PADate                                       204152
079600200529      **********                                                                              204152
079610200529     C**********         Z-ADD     BJRDNB        IPOEDT                                       204152
079620200529     C**********         Z-ADD     PDate         IPOEDTD1                                     204152
079630200529      **********                                                                              204152
079640200529     C**********         MOVE      PDate         WN2               2 0                        204152
079650200529     C*****WN2**         IFLT      72                                                         204152
079660200529     C**********         Z-ADD     20            IPOEDTD2                                     204152
079670200529     C**********         ELSE                                                                 204152
079680200529     C**********         Z-ADD     19            IPOEDTD2                                     204152
079690200529     C**********         ENDIF                                                                204152
079700200529      **********                                                                              204152
079710200529     C**********         MOVEL     PDate         WA4               4                          204152
079720200529     C*****BJDFIN        IFNE      'M'                                                        204152
079730200529     C**********         MOVEL     WA4           WA2               2                          204152
079740200529     C**********         MOVE      WA4           WA2A              2                          204152
079750200529     C**********         MOVEL     WA2A          WA4                                          204152
079760200529     C**********         MOVE      WA2           WA4                                          204152
079770200529     C**********         ENDIF                                                                204152
079780200529      **********                                                                              204152
079790200529     C**********         MOVE      PDate         WA2                                          204152
079800200529     C**********         MOVEL     WA2           PDate                                        204152
079810200529     C**********         MOVE      WA4           PDate                                        204152
079820200529     C**********         Z-ADD     PDate         IPOEDTD3                                     204152
079830200529      **********                                                                              204152
079840200529      ***New*Payment Reference.                                                               204152
079850200529      **********                                                                              204152
079860200529     C**********         IF        (CSC011 = 'Y') AND (LIBR = S1SUPP)                  CSC011 204152
079870200529     C**********         Z-ADD     WPRDTE        PDAYNO                                CSC011 204152
079880200529     C**********         CALLB     'ZDATE2'                                            CSC011 204152
079890200529     C**********         PARM                    PDAYNO                                CSC011 204152
079900200529     C**********         PARM      BJDFIN        PFMT                                  CSC011 204152
079910200529     C**********         PARM      *ZERO         PPRDATE                               CSC011 204152
079920200529     C**********         PARM      *BLANKS       PPRADATE                              CSC011 204152
079930200529      **********                                                                       CSC011 204152
079940200529     C**********         MOVEL     PPRDATE       WA4                                   CSC011 204152
079950200529     C*****BJDFIN        IFNE      'M'                                                 CSC011 204152
079960200529     C**********         MOVEL     WA4           WA2                                   CSC011 204152
079970200529     C**********         MOVE      WA4           WA2A                                  CSC011 204152
079980200529     C**********         MOVEL     WA2A          WA4                                   CSC011 204152
079990200529     C**********         MOVE      WA2           WA4                                   CSC011 204152
080000200529     C**********         ENDIF                                                         CSC011 204152
080010200529      **********                                                                       CSC011 204152
080020200529     C**********         MOVE      PPRDATE       WA2                                   CSC011 204152
080030200529     C**********         MOVEL     WA2           PPRDATE                               CSC011 204152
080040200529     C**********         MOVE      WA4           PPRDATE                               CSC011 204152
080050200529     C**********         MOVE      PPRDATE       WA6                                   CSC011 204152
080060200529     C**********         ELSE                                                          CSC011 204152
080070200529     C**********         MOVE      PDate         WA6               6                          204152
080080200529     C**********         ENDIF                                                         CSC011 204152
080090200529     C**********         MOVE      WWINSQ        WA4                                          204152
080100200529     C**********         MOVE      'P'           WYA2(1)                                      204152
080110200529     C**********         MOVEA     WA6           WYA2(2)                                      204152
080120200529     C**********         MOVEA     WA4           WYA2(8)                                      204152
080130200529     C**********         MOVEA     IPPYTP        WYA2(12)                                     204152
080140200529     C**********         MOVEA     '00'          WYA2(14)                                     204152
080150200529      **********                                                                              204152
080160200529     C*****1****         DO        15            IA                2 0                        204152
080170200529     C*****WYA2(IA)      IFEQ      ' '                                                        204152
080180200529     C**********         MOVEL     '0'           WYA2(IA)                                     204152
080190200529     C**********         ENDIF                                                                204152
080200200529     C**********         ENDDO                                                                204152
080210200529      **********                                                                              204152
080220200529     C**********         MOVEA     WYA2(1)       IPPREF                                       204152
080230200529     C**********         MOVEA     WYA2(1)       WPREFI                                       204152
080240200529     C                   MOVE      IPPREF        WPREFI                                       204152
080250200529     C/COPY WNCPYSRC,FTIPAYSC19
080260200529     C                   MOVE      'Y'           WInsert
080270200529      *
080280200529      ** Level 1 Valid Indicator.
080290200529      *
080300200529     C/COPY WNCPYSRC,FTIPAYSC35
080310200529     C                   EVAL      IPINLVL1 = 'Y'
080320200529      *
080330200529      ** Entry point is Level 2.
080340200529      *
080350200529     C                   ELSE
080360200529      *
080370200529      ** Save original Action Code.
080380200529      *
080390200529     C                   EVAL      POrigACTN = DDACTN
080400200529      *
080410200529      ** Change Action Code to 'A' (Amend).
080420200529      *
080430200529     C                   MOVEL     'A'           DDACTN
080440200529      *
080450200529     C                   ENDIF
080460200529     C/COPY WNCPYSRC,FTIPAYSC13
080470200529      *
080480200529     C                   ENDIF
080490200529      *
080500200529      ** Insert or Amend.
080510200529      *
080520200529     C                   IF        DDACTN = 'I' or
080530200529     C                             DDACTN = 'A'
080540200529      *
080550200529      ** Input Officer 1.
080560200529      *
080570200529     C                   EVAL      IPINUSR1 = PSUser
080580200529      *
080590200529      ** If entry point is Level 1 and Level 1 is linked with
080600200529      ** Level 2, or entry point is Level 1 and Incoming Payments
080610200529      ** Maintenance is called from linked maintenance/enquiry,
080620200529      ** or entry point is Level 2, update Level 2 fields.
080630200529      *
080640200529     C     PParmLevel    IFEQ      '1'
080650200529     C     BTLVJN        ANDEQ     'Y'
080660200529     C     PParmLevel    OREQ      '1'
080670200529     C     PParmLink     ANDEQ     'Y'
080680200529     C     PParmLevel    OREQ      '2'
080690200529      *
080700200529      ** Input Officer 2.
080710200529      *
080720200529     C                   EVAL      IPINUSR2 = PSUser
080730200529      *
080740200529      ** Level 2 Valid Indicator.
080750200529      *
080760200529     C                   EVAL      IPINLVL2 = 'Y'
080770200529      *
080780200529     C                   ENDIF
080790200529      *
080800200529     C                   ENDIF
080810200529      *
080820200529      ** Delete.
080830200529      *
080840200529     C     DDACTN        IFEQ      'D'
080850200529      *
080860200529      ** Record Id - update to 'C'.
080870200529      *
080880200529     C                   EVAL      IPRECI = 'C'
080890200529      *
080900200529     C                   ENDIF
080910200529      *
080920200529      ** Last Change Type, Date and Time.
080930200529      *
080940200529     C                   MOVEL     DDACTN        IPCHTP
080950200529     C                   Z-ADD     BJRDNB        IPLCD
080960200529     C                   TIME                    IPLCHT
080970200529      *                                                                         N
080980200529      ** If entry 1 is not linked with Level 2 and entry point is               N
080990200529      ** Level 1 Maintenance and Pay currency is the same as                    N
081000200529      ** Settle Currency, clear Margin fields.                                  N
081010200529      *                                                                         N
081020200529     C     BTLVJN        IFNE      'Y'                                          N
081030200529     C     PParmLevel    ANDEQ     '1'                                          N
081040200529     C     IPPCCY        ANDEQ     IPSMCY                                       N
081050200529     C                   CLEAR                   IPMBSI                         N
081060200529     C                   CLEAR                   IPMSIG                         N
081070200529     C                   Z-ADD     *ZERO         IPMAMT                         N
081080200529     C                   ENDIF                                                  N
081090200529      *
081100200529      *                                                                                       252696
081110200529     C     IPMIR         IFEQ      *BLANKS                                                    252696
081120200529     C     DDSWTN        ANDNE     *BLANKS                                                    252696
081130200529     C                   MOVEL     DDSWTN        IPMIR                                        252696
081140200529      *                                                                                       252696
081150200529     C     KEYMP         CHAIN     MEINMPL1                           94                      252696
081160200529     C                   IF        *IN94 = '0'                                                252696
081170200529     C                   MOVEL     MPTRNO        IPINTRNO                                     252696
081180200529     C                   ENDIF                                                                252696
081190200529     C                   ENDIF                                                                252696
081200200529      ** Update files.
081210200529      *
081220200529     C                   CALLB     'FTIPAYUPD'
081230200529      *                             =========
081240200529      ** INPUT
081250200529      ** =====
081260200529      *
081270200529      ** Return Code
081280200529     C                   PARM      *BLANKS       RetCodeOut
081290200529      *
081300200529      ** Incoming Payments for file update - file format
081310200529     C                   PARM                    NwIPFilFmt
081320200529      *                                                                         CFT014
081330200529      ** Incoming Payments (additional details) for file update                 CFT014
081340200529     C                   PARM                    NwIP2FilFmt                    CFT014
081350200529      *
081360200529      ** IBANs full account
081370200529     C                   PARM                    PIBANAcc
081380200529      *
081390200529      ** Originally Insert from Level 2 Entry
081400200529     C                   PARM                    POrigACTN         1
081410200529      *
081420200529      ** FT Override for GL Balances
081430200529     C                   PARM                    PFTOV
081440200529      *
081450200529      ** FT Control Data
081460200529     C                   PARM                    PCNTRL
081470200529      *
081480200529      ** Network
081490200529     C                   PARM                    PNWRK
081500200529      *
081510200529      ** Entry Point
081520200529     C                   PARM                    PParmLevel
081530200529      *
081540200529      ** STANDING DATA
081550200529      ** =============
081560200529      *
081570200529      ** SDBANK - Base Currency Code
081580200529     C                   PARM                    BJCYCD
081590200529      *
081600200529      ** SDBANK - Midas Run Date
081610200529     C                   PARM                    BJRDNB
081620200529      *
081630200529      ** SDBANK - Single Branch Code
081640200529     C                   PARM                    BJSBRC
081650200529      *
081660200529      ** SDGELR - Originating Branch/User Vald Req.
081670200529     C                   PARM                    BKOBUV
081680200529      *
081690200529      ** ZMUSER - Default Branch
081700200529     C                   PARM                    PDBRN
081710200529      *
081720200529      ** SWITCHABLE FEATURES
081730200529      ** ===================
081740200529      *
081750200529      ** Batch Authorisation
081760200529     C                   PARM                    CFT003
081770200529      *
081780200529      ** IBAN numbers
081790200529     C                   PARM                    CFT004
081800200529      *
081810200529      ** BLI FT Enhancements Feature
081820200529     C                   PARM                    S01494
081830200529      *
081840200529      ** BLI VAT Processing Feature
081850200529     C                   PARM                    S01499
081860200529      *                                                                         CFT014
081870200529      ** STP Phase 2 MT103                                                      CFT014
081880200529     C                   PARM                    CFT014                         CFT014
081890200529      *                                                                         CFT009
081900200529      ** Fees & Charges                                                         CFT009
081910200529     C                   PARM                    CFT009                         CFT009
081920200529     C                   PARM                    CFT010                         CFT009
081930200529     C                   PARM                    CSC011                                       CSC011
081940200529     C                   PARM                    CSD015                                       CSD015
081950200529     C                   PARM                    CCF001                                       CSD015
081960200529      *                                                                                       CAP211
081970200529     C                   PARM                    PAuth             1                          CAP211
081980200529     C                   PARM                    PUser            10                          CAP211
081990200529      *                                                                                       CAP211
082000200529     C/COPY WNCPYSRC,FTIPAYSC02
082010200529      *                                                                                       CER001
082020200529      ** Action is Delete                                                                     CER001
082030200529      *                                                                                       CER001
082040200529     C                   IF        DDACTN = 'D'                                               CER001
082050200529      *                                                                                       CER001
082060200529     C                   IF        ULX043 = 'Y'                                               CER001
082070200529     C                             and  BTLVJN = 'Y'                                          CER001
082080200529     C                             or ULX043 = 'Y'                                            CER001
082090200529     C                             and  PParmLevel = '2'                                      CER001
082100200529      *                                                                                       CER001
082110200529      ** New window processing                                                                CER001
082120200529      *                                                                                       CER001
082130200529     C                   EXSR      WINDOWI                                                    CER001
082140200529      *                                                                                       CER001
082150200529      ** If errors occurred on update, rollback uncommitted file                              CER001
082160200529      ** changes.                                                                             CER001
082170200529      *                                                                                       CER001
082180200529     C                   IF        #RTRN <> *BLANKS                                           CER001
082190200529     C                   ROLBK                                                                CER001
082200200529     C                   EXSR      *PSSR                                                      CER001
082210200529     C                   ENDIF                                                                CER001
082220200529      *                                                                                       CER001
082230200529     C                   ENDIF                                                                CER001
082240200529      *                                                                                       CER001
082250200529     C                   ENDIF                                                                CER001
082260200529      *                                                                                       CER001
082270200529      ** Case when IPPREF allocated by the window                                             CER001
082280200529      ** Update of last transaction is a successful Insert, display                           CER001
082290200529      ** corresponding message on screen.                                                     CER001
082300200529      *                                                                                       CER001
082310200529     C                   IF        RetCodeOut = *BLANKS and                                   CER001
082320200529     C                             WAlloc = 'Y'                                               CER001
082330200529     C                   Z-ADD     1             Idx                                          CER001
082340200529     C                   EVAL      FldNameArr(Idx) = '*ANY'                                   CER001
082350200529     C                   EVAL      MsgIdArr(Idx) = 'FTA0121'                                  CER001
082360200529     C                   EVAL      MsgDtaArr(Idx) = WAllPref                                  CER001
082370200529     C                   ENDIF                                                                CER001
082380200529      *                                                                                       CER001
082390200529     C                   IF        ULX043 = 'Y' and RetcodeOut = *BLANKS                      CER001
082400200529     C                             and DDACTN <> 'D'                                          CER001
082410200529     C                   EXSR      SRUPDAT                                                    CER001
082420200529     C                   ENDIF                                                                CER001
082430200529      *
082440200529      ** If errors occurred on update, rollback uncommitted file
082450200529      ** changes.
082460200529      *
082470200529     C                   IF        RetCodeOut <> *BLANKS and
082480200529     C                             RetCodeOut <> '*RECUPD'
082490200529      **                                                                                      CSC022
082500200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
082510200529      **   job is not currently running in batch mode                                         CSC022
082520200529      **                                                                                      CSC022
082530200529     C                   If        CSC022 = 'N'                                               CSC022
082540200529     C                             Or (CSC022 = 'Y' and WSkpComtRolbk = 'N')                  CSC022
082550200529     C                   ROLBK
082560200529     C                   EndIf                                                                CSC022
082570200529     C                   EXSR      *PSSR
082580200529     C                   ELSE
082590200529     C                   IF        RetCodeOut = '*RECUPD'
082600200529      **                                                                                      CSC022
082610200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
082620200529      **   job is not currently running in batch mode                                         CSC022
082630200529      **                                                                                      CSC022
082640200529     C                   If        CSC022 = 'N'                                               CSC022
082650200529     C                   ROLBK
082660200529     C                   Else                                                                 CSC022
082670200529     C                   If        WSkpComtRolbk = 'N'                                        CSC022
082680200529     C                   RolBk                                                                CSC022
082690200529     C                   Else                                                                 CSC022
082700200529     C                   SetOn                                        U7U8                    CSC022
082710200529     C                   EndIf                                                                CSC022
082720200529     C                   EndIf                                                                CSC022
082730200529     C                   ELSE
082740200529      **                                                                                      CSC022
082750200529      ** Execute commit if SAR CSC022 is not enrolled or                                      CSC022
082760200529      **   job is not currently running in batch mode                                         CSC022
082770200529      **                                                                                      CSC022
082780200529     C                   If        CSC022 = 'N'                                               CSC022
082790200529     C                             Or (CSC022 = 'Y' and WSkpComtRolbk = 'N')                  CSC022
082800200529     C                   COMMIT
082810200529     C                   EndIf                                                                CSC022
082820200529     C                   ENDIF
082830200529     C                   ENDIF
082840200529      *
082850200529      ** If update not done due to record being updated by another
082860200529      ** workstation, display message "The last transaction was not
082870200529      ** applied to the database." to the next screen.
082880200529      *
082890200529     C                   IF        RetCodeOut = '*RECUPD'
082900200529     C                   Z-ADD     1             Idx
082910200529     C                   Eval      FldNameArr(Idx) = '*ANY'
082920200529     C                   Eval      MsgIdArr(Idx) = 'FTA0120'
082930200529     C                   ENDIF
082940200529      *
082950200529      ** Update of last transaction is a successful Insert, display
082960200529      ** corresponding message on screen.
082970200529      *
082980200529     C                   IF        RetCodeOut = *BLANKS and
082990200529     C                             WInsert = 'Y'
083000200529     C                   Z-ADD     1             Idx
083010200529     C                   Eval      FldNameArr(Idx) = '*ANY'
083020200529     C                   Eval      MsgIdArr(Idx) = 'FTA0121'
083030200529     C                   Eval      MsgDtaArr(Idx) = WPREFI
083040200529     C/COPY WNCPYSRC,FTH00265
083050200529                                                                                              219728
083060200529     C     PParmLink     IFEQ      'Y'                                                        219728
083070200529     C     PParmLevel    OREQ      '1'                                                        219728
083080200529     C     WEMSG         ANDEQ     'Y'                                                        219728
083090200529      *                                                                                       219728
083100200529      ** Display Initial screen in order to output new payment message reference              219728
083110200529     C                   CALLB     'FTIPAYIDP'                                                219728
083120200529     C                   PARM      *BLANKS       RetCodeOut                                   219728
083130200529     C                   PARM                    DDACTN                                       219728
083140200529     C                   PARM                    DDPREF                                       219728
083150200529     C                   PARM                    DDBRCA                                       219728
083160200529     C                   PARM                    DDSWTN           28                          219728
083170200529     C                   PARM                    DDSEQNO           2                          219728
083180200529     C                   PARM      'N'           PEDTKEY                                      219728
083190200529     C                   PARM      'N'           PEINKG                                       219728
083200200529     C                   PARM      'N'           PEINKH                                       219728
083210200529     C                   PARM      'N'           PEINKP                                       219728
083220200529     C                   PARM      'N'           PEINKS                                       219728
083230200529     C                   PARM                    OKACTN                                       219728
083240200529     C                   PARM                    OKPREF                                       219728
083250200529     C                   PARM                    OKBRCA                                       219728
083260200529     C                   PARM                    OKSWTN                                       219728
083270200529     C                   PARM                    OKSEQNO                                      219728
083280200529     C                   PARM                    FldNameArr                                   219728
083290200529     C                   PARM                    MsgIdArr                                     219728
083300200529     C                   PARM                    MsgDtaArr                                    219728
083310200529     C                   PARM                    WFldNamArr                                   219728
083320200529     C                   PARM                    WMsgIdArr                                    219728
083330200529     C                   PARM                    WMsgDtaArr                                   219728
083340200529     C                   PARM                    BJMRDT                                       219728
083350200529     C                   PARM                    BJSBRC                                       219728
083360200529     C                   PARM                    PINKC                                        219728
083370200529     C                   PARM                    PINKG                                        219728
083380200529     C                   PARM                    PINKH                                        219728
083390200529     C                   PARM                    PINKL                                        219728
083400200529     C                   PARM                    PINKP                                        219728
083410200529     C                   PARM                    PINKS                                        219728
083420200529      *                                                                                       219728
083430200529      * Disable any function key return codes                                                 219728
083440200529     C                   MOVE      'N'           PINKC                                        219728
083450200529     C                   MOVE      'N'           PINKG                                        219728
083460200529     C                   MOVE      'N'           PINKH                                        219728
083470200529     C                   MOVE      'N'           PINKL                                        219728
083480200529     C                   MOVE      'N'           PINKP                                        219728
083490200529     C                   MOVE      'N'           PINKS                                        219728
083500200529      *                                                                                       219728
083510200529      * Reset screen error information                                                        219728
083520200529     C                   EXSR      SRResetErr                                                 219728
083530200529     C                   ENDIF                                                                219728
083540200529      *                                                                                       219728
083550200529     C                   ENDIF
083560200529      *
083570200529      ** If Incoming Payments Maintenance has been called by
083580200529      ** linked maintenance/enquiry, terminate program.
083590200529      *
083600200529     C     PParmLink     IFEQ      'Y'
083610200529     C                   MOVEL     *BLANK        PParmRtcd
083620200529     C                   MOVEL     'T'           WScrn
083630200529      *                                                                                       210733
083640200529     C     WInsert       IFEQ      'Y'                                                        210733
083650200529     C                   MOVE      WPREFI        PParmPRef                                    210733
083660200529     C                   MOVE      'I'           PParmRtcd                                    210733
083670200529     C                   ENDIF                                                                210733
083680200529      *                                                                                       210733
083690200529     C                   GOTO      EUpdate
083700200529     C                   ENDIF
083710200529      *
083720200529      ** If entry point is Level 1 and there are reserved
083730200529      ** electronic messages present, load details of the
083740200529      ** next reserved electronic message to the screen.
083750200529      *
083760200529     C     PParmLevel    IFEQ      '1'
083770200529     C     WEMSG         ANDEQ     'Y'
083780200529      *
083790200529      ** Check if there is still reserved electronic message
083800200529      ** to be processed.
083810200529      *
083820200529     C                   EXSR      SRMsgNxt
083830200529      *
083840200529      ** If there are no reserved electronic messages to
083850200529      ** process, display Initial screen with blank screen
083860200529      ** fields.
083870200529      *
083880200529     C     WEMSG         IFNE      'Y'
083890200529      *
083900200529     C                   MOVEL     'I'           WScrn
083910200529     C                   MOVEL     *BLANKS       DDACTN
083920200529     C                   MOVEL     *BLANKS       DDPREF
083930200529     C                   MOVEL     *BLANKS       DDSWTN
083940200529     C                   MOVEL     *BLANKS       DDSEQNO
083950200529     C                   MOVEL     *BLANKS       DDBRCA
083960200529      *
083970200529     C                   ELSE
083980200529      *
083990200529      ** Load details of the next reserved electronic message
084000200529      ** to Level 1 screen.
084010200529      *
084020200529     C                   MOVE      'Y'           WNOCLEAR          1
084030200529     C                   EXSR      SRVal_I
084040200529      *
084050200529     C                   ENDIF
084060200529      *
084070200529     C                   GOTO      EUpdate
084080200529      *
084090200529     C                   ENDIF
084100200529      *
084110200529      ** Read Next Browse Subfile record.
084120200529      *
084130200529     C     PRDNB         IFEQ      'Y'
084140200529     C                   MOVEL     'R'           WScrn
084150200529     C                   GOTO      EUpdate
084160200529     C                   ENDIF
084170200529      *
084180200529      ** Display Initial screen with blank screen fields.
084190200529      *
084200200529     C                   MOVEL     *BLANKS       DDACTN
084210200529     C                   MOVEL     *BLANKS       DDPREF
084220200529     C                   MOVEL     *BLANKS       DDSWTN
084230200529     C                   MOVEL     *BLANKS       DDSEQNO
084240200529     C                   MOVEL     *BLANKS       DDBRCA
084250200529     C                   MOVEL     'I'           WScrn
084260200529      *
084270200529     C     EUpdate       ENDSR
084280200529      *
084290200529      *****************************************************************
084300200529      /EJECT
084310200529      *****************************************************************
084320200529      *                                                               *
084330200529      *  SRRdNBrw - Read next Browse Subfile record                   *
084340200529      *                                                               *
084350200529      *****************************************************************
084360200529      *
084370200529     C     SRRdNBrw      BEGSR
084380200529      *
084390200529     C                   CALLB     'FTIPAYBRW'
084400200529      *                             =========
084410200529      ** INPUT
084420200529      ** =====
084430200529      *
084440200529     C                   PARM      *BLANKS       RetCodeOut
084450200529      *
084460200529      ** Payment Reference (Pointer)
084470200529     C                   PARM      *BLANKS       DDPREF
084480200529      *
084490200529      ** Build Subfile
084500200529     C                   PARM      *BLANK        PBDSFL            1
084510200529      *
084520200529      ** Read Subfile Record
084530200529     C                   PARM      'Y'           PRDSFL            1
084540200529      *
084550200529      ** Entry Point
084560200529     C                   PARM                    PParmLevel
084570200529      *
084580200529      ** STANDING DATA
084590200529      ** =============
084600200529      *
084610200529      ** SDBANK - System Runday
084620200529     C                   PARM                    BJMRDT
084630200529      *
084640200529      ** SDBANK - Single Branch Code
084650200529     C                   PARM                    BJSBRC
084660200529      *
084670200529      ** OUTPUT
084680200529      ** ======
084690200529      *
084700200529      ** Error Message
084710200529     C                   PARM                    PErrMs            7
084720200529      *
084730200529      ** Option Selected
084740200529     C                   PARM                    PopSel            1
084750200529      *
084760200529      ** Payment Reference Selected
084770200529     C                   PARM                    PPRefSel         15
084780200529      *
084790200529      ** Function Key Enabled - F3
084800200529     C                   PARM                    PINKC
084810200529      *
084820200529      ** Function Key Enabled - F12
084830200529     C                   PARM                    PINKL
084840200529      *
084850200529      ** If no Incoming Payment selected from subfile, reset
084860200529      ** Read Next Browse Subfile Record indicator and then
084870200529      ** display Initial screen with blank screen fields.
084880200529      *
084890200529     C     POPSEL        IFEQ      *BLANK
084900200529     C                   MOVEL     *BLANK        PRDNB
084910200529     C                   MOVEL     *BLANKS       DDACTN
084920200529     C                   MOVEL     *BLANKS       DDPREF
084930200529     C                   MOVEL     *BLANKS       DDSWTN
084940200529     C                   MOVEL     *BLANKS       DDSEQNO
084950200529     C                   MOVEL     *BLANKS       DDBRCA
084960200529     C                   MOVEL     'I'           WScrn
084970200529     C                   GOTO      ERdNBrw
084980200529     C                   ENDIF
084990200529      *
085000200529      ** Update Action Code with Option selected.
085010200529      *
085020200529     C                   MOVEL     POPSEL        DDACTN
085030200529      *
085040200529      ** Default Action to Enquiry if entry is invalid.  Valid
085050200529      ** entries are A(Amend), D(Delete) and E(Enquire).
085060200529      ** I(Insert) is also a valid Action Code if entry point
085070200529      ** is Level 2.
085080200529      *
085090200529     C     DDACTN        IFNE      'A'
085100200529     C     DDACTN        ANDNE     'D'
085110200529     C     DDACTN        ANDNE     'E'
085120200529      *
085130200529     C     PParmlevel    IFNE      '2'
085140200529     C     DDACTN        ORNE      'I'
085150200529     C                   MOVE      'E'           DDACTN
085160200529     C                   ENDIF
085170200529      *
085180200529     C                   ENDIF
085190200529      *
085200200529      ** Retrieve Incoming Payment details.
085210200529      *
085220200529     C                   MOVEL     PPREFSEL      DDPREF
085230200529     C                   EXSR      SRRtvPref
085240200529      *
085250200529      ** If errors occurred in the retrieval of Incoming
085260200529      ** Payment details, display error messages on the
085270200529      ** Initial screen.
085280200529      *
085290200529     C     IDx           IFGT      1
085300200529     C     IDx           OREQ      1
085310200529     C     MsgIdArr(1)   ANDNE     'FTA0120'
085320200529     C     MsgIdArr(1)   ANDNE     'FTA0121'
085330200529     C                   MOVEL     'I'           WScrn
085340200529     C                   GOTO      ERdNBrw
085350200529     C                   ENDIF
085360200529      *
085370200529      ** Move Incoming Payment details retrieved from the master
085380200529      ** database file into the update file record.
085390200529      *
085400200529     C                   MOVEL     CrIPFilFmt    NwIPFilFmt
085410200529     C                   IF        (CFT003 = 'Y')                               CFT014
085420200529     C                             OR (CFT014 = 'Y')                            CFT014
085430200529     C                             OR CFT009 = 'Y'                              CFT009
085440200529     C                   MOVEL     CrIP2FilFmt   NwIP2FilFmt                    CFT014
085450200529     C                   ELSE                                                                BUG7101
085460200529     C                   CLEAR                   NwIP2FilFmt                                 BUG7101
085470200529     C                   ENDIF                                                  CFT014
085480200529      *
085490200529      ** Put Incoming Payment details on the screen.
085500200529      *
085510200529     C                   EXSR      SRPutRef
085520200529      *
085530200529      ** If entry point is Level 1 Maintenance, process Level 1
085540200529      ** screen.  Otherwise, process Level 2 screen 1.
085550200529      *
085560200529     C     PParmLevel    IFEQ      '1'
085570200529      *
085580200529     C                   MOVE      'P'           WScrn
085590200529      *
085600200529     C                   ELSE
085610200529      *
085620200529     C                   MOVE      'S'           WScrn
085630200529      *
085640200529      ** Set up Charges Branch.
085650200529      *
085660200529     C     BJSBRC        IFNE      *BLANKS
085670200529     C                   EVAL      PPYBR = BJSBRC
085680200529     C                   ELSE
085690200529     C     BKOBRU        IFEQ      'Y'
085700200529     C                   EVAL      PPYBR = IPORBR
085710200529     C                   ELSE
085720200529     C                   EVAL      PPYBR = IPBRCA
085730200529     C                   ENDIF
085740200529     C                   ENDIF
085750200529      *
085760200529      ** If Action is Insert, or Action is Amend and Level 2
085770200529      ** details have not been entered, default Transfer
085780200529      ** Commission Tariff based on Charges Branch.
085790200529      *
085800200529     C     DDACTN        IFEQ      'I'
085810200529     C     DDACTN        OREQ      'A'
085820200529     C     INLVL2        ANDNE     'Y'
085830200529     C     PPYBR         CHAIN     PYCHGDB                            01
085840200529     C     WTRCT         IFNE      *BLANKS                                                    226722
085850200529     C                   EVAL      DDTRCT = WTRCT                                             226722
085860200529     C                   ENDIF                                                                226722
085870200529     C     *IN01         IFEQ      *OFF
085880200529     C                   EVAL      DDTRCT = PYDFTRCT
085890200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
085900200529     C                   ENDIF
085910200529     C                   ENDIF
085920200529      *
085930200529     C                   ENDIF
085940200529      *
085950200529     C     ERdNBrw       ENDSR
085960200529      *
085970200529      *****************************************************************
085980200529      /EJECT
085990200529      *****************************************************************
086000200529      *                                                               *
086010200529      *  SRBldBrw - Build Browse screen                               *
086020200529      *                                                               *
086030200529      *****************************************************************
086040200529      *
086050200529     C     SRBldBrw      BEGSR
086060200529      *
086070200529      ** Release all reserved electronic messages for the job.
086080200529      *
086090200529     C     WEMSG         IFEQ      'Y'
086100200529     C                   EXSR      SRMsgEnd
086110200529     C                   ENDIF
086120200529      *
086130200529      ** Reset Read Next Browse Subfile Record indicator.
086140200529      *
086150200529     C                   MOVEL     *BLANK        PRDNB             1
086160200529      *
086170200529      ** Display Browse screen.
086180200529      *
086190200529     C                   CALLB     'FTIPAYBRW'
086200200529      *                             =========
086210200529      ** INPUT
086220200529      ** =====
086230200529      *
086240200529      ** Return Code
086250200529     C                   PARM      *BLANKS       RetCodeOut
086260200529      *
086270200529      ** Payment Reference (pointer)
086280200529     C                   PARM      *BLANKS       DDPREF
086290200529      *
086300200529      ** Build Subfile
086310200529     C                   PARM      'Y'           PBDSFL
086320200529      *
086330200529      ** Read Subfile Record
086340200529     C                   PARM      *BLANK        PRDSFL
086350200529      *
086360200529      ** Entry Point
086370200529     C                   PARM                    PParmLevel
086380200529      *
086390200529      ** STANDING DATA
086400200529      ** =============
086410200529      *
086420200529      ** SDBANK - System Runday
086430200529     C                   PARM                    BJMRDT
086440200529      *
086450200529      ** SDBANK - Single Branch Code
086460200529     C                   PARM                    BJSBRC
086470200529      *
086480200529      ** OUTPUT
086490200529      ** ======
086500200529      *
086510200529      ** Error Message
086520200529     C                   PARM                    PErrMs
086530200529      *
086540200529      ** Option Selected
086550200529     C                   PARM                    PopSel
086560200529      *
086570200529      ** Payment Reference Selected
086580200529     C                   PARM                    PPRefSel
086590200529      *
086600200529      ** Function Key Enabled - F3
086610200529     C                   PARM                    PINKC
086620200529      *
086630200529      ** Function Key Enabled - F12
086640200529     C                   PARM                    PINKL
086650200529      *
086660200529     C                   SELECT
086670200529      *
086680200529      ** F3 - end program.
086690200529      *
086700200529     C     PINKC         WHENEQ    *ON
086710200529     C                   EXSR      SREndP
086720200529      *
086730200529      ** Send error message returned from Browse screen.
086740200529      *
086750200529     C     PErrMs        WHENNE    *BLANKS
086760200529     C                   EXSR      SRSndM
086770200529      *
086780200529      ** F12 not pressed.  Read selected Browse Subfile record.
086790200529      *
086800200529     C                   OTHER
086810200529     C     PINKL         IFNE      *ON
086820200529     C                   MOVE      'Y'           PRDNB
086830200529     C                   MOVEL     'R'           WScrn
086840200529     C                   ENDIF
086850200529      *
086860200529     C                   ENDSL
086870200529      *
086880200529     C                   ENDSR
086890200529      *
086900200529      *****************************************************************
086910200529      /EJECT
086920200529      *****************************************************************
086930200529      *                                                               *
086940200529      *  SRRoll - Roll backwards or forwards through the Incoming     *
086950200529      *           Payments file                                       *
086960200529      *                                                               *
086970200529      *****************************************************************
086980200529      *
086990200529     C     SRRoll        BEGSR
087000200529      *
087010200529      ** Release all reserved electronic messages for the job.
087020200529      *
087030200529     C     WEMSG         IFEQ      'Y'
087040200529     C                   EXSR      SRMsgEnd
087050200529     C                   ENDIF
087060200529      *
087070200529      ** Read previous or next record in Incoming Payments file
087080200529      ** according to Function Key taken (F7=INKG or F8=INKH).
087090200529      *
087100200529     C     PINKG         IFEQ      *ON
087110200529     C                   MOVEL     'Y'           PRdBck
087120200529     C                   MOVEL     *BLANK        PRdFwd
087130200529     C                   ELSE
087140200529     C                   MOVEL     *BLANK        PRdBck
087150200529     C                   MOVEL     'Y'           PRdFwd
087160200529     C                   ENDIF
087170200529      *
087180200529      ** Read previous or next record in Incoming Payments file.
087190200529      *
087200200529     C                   CALLB     'FTIPAYRED'
087210200529      *                             =========
087220200529      ** INPUT
087230200529      ** =====
087240200529      *
087250200529      ** Return Code
087260200529     C                   PARM      *BLANKS       RetCodeOut
087270200529      *
087280200529      ** Payment Reference (file pointer)
087290200529     C                   PARM                    DDPREF
087300200529      *
087310200529      ** Read backwards
087320200529     C                   PARM                    PRdBck            1
087330200529      *
087340200529      ** Read forwards
087350200529     C                   PARM                    PRdFwd            1
087360200529      *
087370200529      ** STANDING DATA
087380200529      ** =============
087390200529      *
087400200529      ** SDBANK - Single Branch Code
087410200529     C                   PARM                    BJSBRC
087420200529      *
087430200529      ** OUTPUT
087440200529      ** ======
087450200529      *
087460200529      ** Error message
087470200529     C                   PARM                    PErrMs
087480200529      *
087490200529      ** Payment Reference read
087500200529     C                   PARM                    PPrefSel
087510200529      *
087520200529      ** If error message returned from Read, send it to screen.
087530200529      *
087540200529     C     PErrMs        IFNE      *BLANKS
087550200529     C                   EXSR      SRSndM
087560200529     C                   GOTO      ERoll
087570200529     C                   ENDIF
087580200529      *
087590200529      ** Default Action to Enquiry if entry is invalid.  Valid
087600200529      ** entries are A(Amend), D(Delete) and E(Enquire).
087610200529      ** I(Insert) is also a valid Action Code if entry point
087620200529      ** is Level 2.
087630200529      *
087640200529     C     DDACTN        IFNE      'A'
087650200529     C     DDACTN        ANDNE     'D'
087660200529     C     DDACTN        ANDNE     'E'
087670200529      *
087680200529     C     PParmlevel    IFNE      '2'
087690200529     C     DDACTN        ORNE      'I'
087700200529     C                   MOVE      'E'           DDACTN
087710200529     C                   ENDIF
087720200529      *
087730200529     C                   ENDIF
087740200529      *
087750200529      ** Retrieve Incoming Payment details.
087760200529      *
087770200529     C                   MOVE      PPRefSel      DDPREF
087780200529     C                   EXSR      SRRtvPref
087790200529      *
087800200529      ** If errors occurred in the retrieval of Incoming
087810200529      ** Payment details, display error messages on the
087820200529      ** Initial screen.
087830200529      *
087840200529     C     Idx           IFNE      *ZERO
087850200529     C                   MOVEL     'I'           WScrn
087860200529     C                   GOTO      ERoll
087870200529     C                   ENDIF
087880200529      *
087890200529      ** Move Incoming Payment details retrieved from the master
087900200529      ** database file into the update file record.
087910200529      *
087920200529     C                   MOVEL     CrIPFilFmt    NwIPFilFmt
087930200529     C                   IF        (CFT003 = 'Y')                               CFT014
087940200529     C                             OR (CFT014 = 'Y')                            CFT014
087950200529     C                   MOVEL     CrIP2FilFmt   NwIP2FilFmt                    CFT014
087960200529     C                   ELSE                                                                BUG7101
087970200529     C                   CLEAR                   NwIP2FilFmt                                 BUG7101
087980200529     C                   ENDIF                                                  CFT014
087990200529      *
088000200529      ** Put Incoming Payment details on the screen.
088010200529      *
088020200529     C                   EXSR      SRPutRef
088030200529      *
088040200529      ** If entry point is Level 1 Maintenance, process Level 1
088050200529      ** screen.  Otherwise, process Level 2 screen 1.
088060200529      *
088070200529     C     PParmLevel    IFEQ      '1'
088080200529      *
088090200529     C                   MOVE      'P'           WScrn
088100200529      *
088110200529     C                   ELSE
088120200529      *
088130200529     C                   MOVE      'S'           WScrn
088140200529      *
088150200529      ** Set up Charges Branch.
088160200529      *
088170200529     C     BJSBRC        IFNE      *BLANKS
088180200529     C                   EVAL      PPYBR = BJSBRC
088190200529     C                   ELSE
088200200529     C     BKOBRU        IFEQ      'Y'
088210200529     C                   EVAL      PPYBR = IPORBR
088220200529     C                   ELSE
088230200529     C                   EVAL      PPYBR = IPBRCA
088240200529     C                   ENDIF
088250200529     C                   ENDIF
088260200529      *
088270200529      ** If Action is Insert, or Action is Amend and Level 2
088280200529      ** details have not been entered, default Transfer
088290200529      ** Commission Tariff based on Charges Branch.
088300200529      *
088310200529     C     DDACTN        IFEQ      'I'
088320200529     C     DDACTN        OREQ      'A'
088330200529     C     INLVL2        ANDNE     'Y'
088340200529     C     PPYBR         CHAIN     PYCHGDB                            01
088350200529     C     *IN01         IFEQ      *OFF
088360200529     C                   EVAL      DDTRCT = PYDFTRCT
088370200529     C     WTRCT         IFNE      *BLANKS                                                    226722
088380200529     C                   EVAL      DDTRCT = WTRCT                                             226722
088390200529     C                   ENDIF                                                                226722
088400200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
088410200529     C                   ENDIF
088420200529     C                   ENDIF
088430200529      *
088440200529     C                   ENDIF
088450200529      *
088460200529     C     ERoll         ENDSR
088470200529      *
088480200529      *****************************************************************
088490200529      /EJECT
088500200529      *****************************************************************
088510200529      *                                                               *
088520200529      *  SRRtvPref - Retrieve Incoming Payment details                *
088530200529      *                                                               *
088540200529      *****************************************************************
088550200529      *
088560200529     C     SRRtvPref     BEGSR
088570200529      *
088580200529     C                   CALLB     'FTIPAYRTV'
088590200529      *                             =========
088600200529      ** INPUT
088610200529      ** =====
088620200529      *
088630200529      ** Return Code
088640200529     C                   PARM      *BLANKS       RetCodeOut
088650200529      *
088660200529      ** Mode = '*FRONT' (Front Office Transaction Interface)
088670200529      ** Mode = '      ' (Not Front Office Transaction Interface)
088680200529      ** Mode = '*RPR  ' (Repair Function)
088690200529      ** Mode = '*SIN  ' (Screen Input Function)
088700200529     C                   PARM                    PMode
088710200529      *
088720200529      ** Response Mode
088730200529     C                   PARM                    PResponse
088740200529      *
088750200529      ** Action Code
088760200529     C                   PARM                    DDACTN
088770200529      *
088780200529      ** Front Office Transaction Id
088790200529     C                   PARM      *BLANKS       FOTRID           20
088800200529      *
088810200529      ** Payment Reference
088820200529     C                   PARM                    DDPREF
088830200529      *
088840200529      ** Booking Branch
088850200529     C                   PARM                    DDBRCA
088860200529      *
088870200529      ** SWIFT Reference
088880200529     C                   PARM                    DDSWTN
088890200529      *
088900200529      ** Entry Point
088910200529     C                   PARM                    PParmLevel
088920200529      *
088930200529      ** Linked Program
088940200529     C                   PARM                    PLinkPgm
088950200529      *
088960200529      ** Validate Payment Reference for Insert
088970200529     C                   PARM      'Y'           PPrefInsert       1
088980200529      *
088990200529      ** STANDING DATA
089000200529      ** =============
089010200529      *
089020200529      ** SDBANK - Single Branch Code
089030200529     C                   PARM                    BJSBRC
089040200529      *
089050200529      ** SDGELR - Originating Branch/User Vald Req.
089060200529     C                   PARM                    BKOBUV
089070200529      *
089080200529      ** ZMUSER - Default Branch
089090200529     C                   PARM                    PDBRN
089100200529      *
089110200529      ** SWITCHABLE FEATURES
089120200529      ** ===================
089130200529      *
089140200529      ** BLI FT Enhancements Feature
089150200529     C                   PARM                    S01494
089160200529      *
089170200529      ** BLI VAT Processing Feature
089180200529     C                   PARM                    S01499
089190200529      *                                                                         CFT014
089200200529      ** FT Batch Auth and Credit Advices                                       CFT014
089210200529     C                   PARM                    CFT003                         CFT014
089220200529      *                                                                         CFT014
089230200529      ** STP Phase 2 MT103                                                      CFT014
089240200529     C                   PARM                    CFT014                         CFT014
089250200529      *                                                                         CFT009
089260200529      ** Fees & Charges                                                         CFT009
089270200529     C                   PARM                    CFT009                         CFT009
089280200529      *
089290200529      ** OUTPUT
089300200529      ** ======
089310200529      *
089320200529      ** Error fields/message IDs/message data (arrays) from/to caller
089330200529     C                   PARM                    FldNameArr
089340200529     C                   PARM                    MsgIdArr
089350200529     C                   PARM                    MsgDtaArr
089360200529      *
089370200529      ** Array index (3P0) from/to caller
089380200529     C                   PARM                    IDx
089390200529      *
089400200529      ** OK Action Code
089410200529     C                   PARM                    OKACTN
089420200529      *
089430200529      ** OK Payment Reference
089440200529     C                   PARM                    OKPREF
089450200529      *
089460200529      ** OK Booking Branch
089470200529     C                   PARM                    OKBRCA
089480200529      *
089490200529      ** Incoming Payments retrieved from file - file format
089500200529     C                   PARM                    CrIPFilFmt
089510200529      *                                                                         CFT014
089520200529      ** Incoming Payments (additional) retrieved from file-file format         CFT014
089530200529     C                   PARM                    CrIP2FilFmt                    CFT014
089540200529     C/COPY WNCPYSRC,FTIPAYSC03
089550200529      *
089560200529     C                   ENDSR
089570200529      *
089580200529      *****************************************************************
089590200529      /EJECT
089600200529      *****************************************************************
089610200529      *                                                               *
089620200529      *  SRPutRef - Convert Incoming Payment details to screen        *
089630200529      *             format                                            *
089640200529      *                                                               *
089650200529      *****************************************************************
089660200529      *
089670200529     C     SRPutRef      BEGSR
089680200529      *
089690200529     C                   CALLB     'FTIPAYCVT'
089700200529      *                             =========
089710200529      ** INPUT
089720200529      ** =====
089730200529      *
089740200529      ** Return Code
089750200529     C                   PARM      *BLANKS       RetCodeOut
089760200529      *
089770200529      ** Incoming Payments retrieved from file - file format
089780200529     C                   PARM                    CrIPFilFmt
089790200529      *                                                                         CFT014
089800200529      ** Incoming Payments (additional) retrieved from file-file format         CFT014
089810200529     C                   PARM                    CrIP2FilFmt                    CFT014
089820200529      *
089830200529      ** Action Code
089840200529     C                   PARM                    DDACTN
089850200529      *
089860200529      ** STANDING DATA
089870200529      ** =============
089880200529      *
089890200529      ** SDBANK - Single Branch Code
089900200529     C                   PARM                    BJSBRC
089910200529      *
089920200529      ** SDBANK - Date Format Indicator
089930200529     C                   PARM                    BJDFIN
089940200529      *
089950200529      ** SDBANK - Base Currency Code
089960200529     C                   PARM                    BJCYCD
089970200529      *
089980200529      ** SDBANK - Local Currency Code
089990200529     C                   PARM                    BJLCCY
090000200529      *
090010200529      ** SDGELR - Profit Centre Used
090020200529     C                   PARM                    BKPRCU
090030200529      *
090040200529      ** SDGELR - Originating Branch Used
090050200529     C                   PARM                    BKOBRU
090060200529      *
090070200529      ** SDMMOD - Analytical Accounting
090080200529     C                   PARM                    BGN0ST
090090200529      *
090100200529      ** SDFTFR - Charges Currency
090110200529     C                   PARM                    BTCHCY
090120200529      *                                                                         CFT009
090130200529      ** SDFTFR - Fixed Charge Currency                                         CFT009
090140200529     C                   PARM                    FCHCCY                         CFT009
090150200529      *
090160200529      ** SWITCHABLE FEATURES
090170200529      ** ===================
090180200529      *
090190200529      ** EMU FT Settlement Currency Conversion
090200200529     C                   PARM                    CEU006
090210200529      *
090220200529      ** BLI FT Enhancements Feature
090230200529     C                   PARM                    S01494
090240200529      *
090250200529      ** BLI VAT Processing Feature
090260200529     C                   PARM                    S01499
090270200529      *
090280200529      ** Electronic Banking Interface IATs and TPPs
090290200529     C                   PARM                    CGL009
090300200529      *                                                                         CFT014
090310200529      ** STP Phase 2 MT103                                                      CFT014
090320200529     C                   PARM                    CFT014                         CFT014
090330200529     C/COPY WNCPYSRC,FTIPAYSC38
090340200529      *                                                                         CFT009
090350200529      ** Fees & Charges                                                         CFT009
090360200529     C                   PARM                    CFT009                         CFT009
090370200529     C                   PARM                    CFT010                         CFT009
090380200529     C/COPY WNCPYSRC,FTIPAYSC09
090390200529      *
090400200529      ** OUTPUT
090410200529      ** ======
090420200529      *
090430200529      ** Incoming Payments Lvl 1 Scrn details retrieved from file
090440200529      ** - screen format
090450200529     C                   PARM                    CrIP1ScnFmt
090460200529      *                                                                         CFT014
090470200529     C                   PARM                    CrIP1aScnFmt                   CFT014
090480200529      *
090490200529      ** Incoming Payments Lvl 2 Scrn 1/1 details retrieved from file
090500200529      ** - screen format
090510200529     C                   PARM                    CrIP2ScnFmt
090520200529      *
090530200529      ** Incoming Payments Lvl 2 Scrn 1/2 details retrieved from file
090540200529      ** - screen format
090550200529     C                   PARM                    CrIP3ScnFmt
090560200529      *
090570200529      ** Incoming Payments Lvl 2 Scrn 2 details retrieved from file
090580200529      ** - screen format
090590200529     C                   PARM                    CrIP4ScnFmt
090600200529      *                                                                         CFT014
090610200529     C                   PARM                    CrIP4aScnFmt                   CFT014
090620200529      *                                                                         CFT014
090630200529      ** Incoming Payments Lvl 2 Scrn 3 details retrieved from file             CFT014
090640200529      ** - screen format                                                        CFT014
090650200529     C                   PARM                    CrIP5ScnFmt                    CFT014
090660200529      *                                                                         CFT014
090670200529      ** Incoming Payments Margin Info details retrieved from file              CFT014
090680200529      ** - screen format                                                        CFT014
090690200529     C                   PARM                    CrIP6ScnFmt                    CFT014
090700200529      *                                                                                       CSW209
090710200529      ** Incoming Payments Lvl 2 Scrn 7 details retrieved from file                           CSW209
090720200529      ** - screen format                                                                      CSW209
090730200529     C                   PARM                    CrIP7ScnFmt                                  CSW209
090740200529      *                                                                                       CSW209
090750200529      ** Incoming Payments Lvl 2 Scrn 8 details retrieved from file                           CSW209
090760200529      ** - screen format                                                                      CSW209
090770200529     C                   PARM                    CrIP8ScnFmt                                  CSW209
090780200529      *                                                                                       CER030
090790200529      ** Incoming Payments Extended Narratives retrieved from file                            CER030
090800200529      ** - screen format                                                                      CER030
090810200529      *                                                                                       CER030
090820200529     C                   PARM                    CrIP6AScnFmt                                 CER030
090830200529      *
090840200529      ** DS for Additional Information details
090850200529     C                   PARM                    PAddInfm
090860200529      *
090870200529      ** SWIFT Reference
090880200529     C                   PARM                    DDSWTN           28
090890200529      *
090900200529      ** Sequence No.
090910200529     C                   PARM                    DDSEQNO           2
090920200529      *
090930200529      ** Incoming Payment Status
090940200529     C                   PARM                    PStatus          10
090950200529      *
090960200529      ** Payment Type
090970200529     C                   PARM                    PPYTP             2
090980200529      *                                                                          CFT009
090990200529      ** DS for Default Charge Amounts                                           CFT009
091000200529     C                   PARM                    PCharges                        CFT009
091010200529      *                                                                          CFT009
091020200529      ** Input Charge Currency                                                   CFT009
091030200529     C                   PARM                    PICCY                           CFT009
091040200529      *                                                                          CFT009
091050200529      ** Output Charge Currency                                                  CFT009
091060200529     C                   PARM                    POCCY                           CFT009
091070200529      *                                                                          CFT009
091080200529      ** Input Charge Currency No. of Decimal Places                             CFT009
091090200529     C                   PARM                    PINBDP                          CFT009
091100200529      *                                                                          CFT009
091110200529      ** Output Charge Currency No. of Decimal Places                            CFT009
091120200529     C                   PARM                    PONBDP                          CFT009
091130200529     C                   PARM      *BLANKS       BtnPressed       10                       AR1090283
091140200529      *
091150200529      ** Initialise screen fields with values from file.
091160200529      *
091170200529     C                   MOVEL     CrIP1ScnFmt   NwIP1ScnFmt
091180200529     C                   MOVEL     CrIP1AScnFmt  NwIP1AScnFmt                    CFT014
091190200529     C                   MOVEL     CrIP2ScnFmt   NwIP2ScnFmt
091200200529     C                   MOVEL     CrIP3ScnFmt   NwIP3ScnFmt
091210200529     C                   MOVEL     CrIP4ScnFmt   NwIP4ScnFmt
091220200529     C                   MOVEL     CrIP4AScnFmt  NwIP4AScnFmt                    CFT014
091230200529     C                   MOVEL     CrIP5ScnFmt   NwIP5ScnFmt                     CFT014
091240200529     C                   MOVEL     CrIP6ScnFmt   NwIP6ScnFmt                     CFT014
091250200529     C                   MOVEL     CrIP6AScnFmt  NwIP6AScnFmt                                 CER030
091260200529      *                                                                                       CER030
091270200529     C                   IF        CSW209 = 'Y'                                               CSW209
091280200529     C                   MOVEL     CrIP7ScnFmt   NwIP7ScnFmt                                  CSW209
091290200529     C                   MOVEL     CrIP8ScnFmt   NwIP8ScnFmt                                  CSW209
091300200529     C                   ENDIF                                                                CSW209
091310200529      *
091320200529      *                                                                                       187056
091330200529      ** Save previous value of 'Charges to the Debit of a/c'.                                187056
091340200529      *                                                                                       187056
091350200529     C                   EVAL      PPrvCDRO = DDCDRO                                          187056
091360200529     C                   EVAL      PPrvCDBR = DDCDBR                                          187056
091370200529     C                   EVAL      PPrvCDRT = CDRT                                            187056
091380200529      *                                                                         CFT009
091390200529      ** If CFT009 is on and action code <> 'I', save formatted charges         CFT009
091400200529      *                                                                         CFT009
091410200529     C                   IF        CFT009 = 'Y' AND DDACTN <> 'I'               CFT009
091420200529     C                   MOVEL     PCharges      WICharges                      CFT009
091430200529     C                   MOVEL     DDTRCD        WDTRCD           14            CFT009
091440200529     C                   MOVEL     DDTXCD        WDTXCD           14            CFT009
091450200529     C                   MOVEL     DDCQCD        WDCQCD           14            CFT009
091460200529     C                   MOVEL     DDADCD        WDADCD           14            CFT009
091470200529     C                   MOVEL     DDTLCD        WDTLCD           14            CFT009
091480200529     C                   MOVEL     DDMSCD        WDMSCD           14            CFT009
091490200529     C                   MOVEL     DDCHCD        WDCHCD           14            CFT009
091500200529     C                   MOVEL     M1CD          WM1CD            14            CFT009
091510200529     C                   MOVEL     M2CD          WM2CD            14            CFT009
091520200529     C                   MOVEL     M3CD          WM3CD            14            CFT009
091530200529     C                   MOVEL     M4CD          WM4CD            14            CFT009
091540200529     C                   MOVEL     M5CD          WM5CD            14            CFT009
091550200529     C                   ENDIF                                                  CFT009
091560200529      *
091570200529     C                   ENDSR
091580200529      *
091590200529      *****************************************************************
091600200529      /EJECT
091610200529      *****************************************************************
091620200529      *                                                               *
091630200529      *  SREISwft - Process Electronic Message                        *
091640200529      *                                                               *
091650200529      *****************************************************************
091660200529      *
091670200529     C     SREISwft      BEGSR
091680200529      *
091690200529     C                   MOVE      *BLANK        WErr              1
091700200529      *
091710200529      ** Incoming Payments Maintenance has been called by linked
091720200529      ** maintenance/enquiry.
091730200529      *
091740200529     C     PParmPref     IFEQ      *BLANKS
091750200529      *
091760200529      ** If Electronic Message Processing is not active, then
091770200529      ** determine if a '?' or a SWIFT Reference has been entered.
091780200529      *
091790200529     C     WEMSG         ANDEQ     *BLANK
091800200529      *
091810200529     C                   EXSR      SRMKey
091820200529      *
091830200529      ** If a '?' was entered and an electronic message was selected,
091840200529      ** or a valid SWIFT Reference was entered, then continue with the
091850200529      ** validation of the SWIFT Reference.
091860200529      *
091870200529      ** BUT, if a message was not selected or the entered SWIFT
091880200529      ** Reference is not available for use, then bypass SWIFT
091890200529      ** Reference validation and redisplay the Initial screen.
091900200529      *
091910200529      ** If the keyed SWIFT Reference was not found or invalid, then the
091920200529      ** condition will be picked up in the validation section of this
091930200529      ** subroutine.
091940200529      *
091950200529      ** Terminate program if F3 has been pressed.
091960200529      *
091970200529      ** Redispplay Initial screen if F12 has been pressed.
091980200529      *
091990200529     C     WErr          IFNE      *BLANK
092000200529     C                   GOTO      EEISwft
092010200529     C                   ENDIF
092020200529      *
092030200529     C                   ENDIF
092040200529      *
092050200529      ** Incoming Payments Maintenance has been called by linked
092060200529      ** maintenance/enquiry.
092070200529      *
092080200529     C     PParmPref     IFEQ      *BLANKS
092090200529      *
092100200529      ** If the SWIFT Reference is valid, then reserve it on file.
092110200529      ** A reserved message may not be selected by any other work
092120200529      ** station.
092130200529      *
092140200529      ** If Electronic Message Processing is active, then a
092150200529      ** reservation does not need to be made as it was done
092160200529      ** when the message was initially selected.
092170200529      *
092180200529     C     WEMSG         ANDEQ     *BLANK
092190200529      *
092200200529     C                   EXSR      SRMsgRsv
092210200529      *
092220200529      ** If the SWIFT Reference is already allocated to another job,
092230200529      ** then redisplay initial screen.
092240200529      *
092250200529     C     WErr          IFNE      *BLANK
092260200529     C                   GOTO      EEISwft
092270200529     C                   ENDIF
092280200529      *
092290200529     C                   ENDIF
092300200529      *
092310200529      ** Call ME1100 to translate the data of the messages for FT
092320200529      ** fields.
092330200529      *
092340200529     C                   CALL      'ME1100'                             0101
092350200529     C                   PARM      '*TRANS  '    PACTD             8
092360200529     C                   PARM                    PHEAD
092370200529     C                   PARM      *BLANKS       PDATA
092380200529     C                   PARM      *BLANKS       PDAT2                                        CSW209
092390200529     C                   PARM      *BLANKS       PRTN
092400200529      *
092410200529      ** If call to program resulted in an error, then end program.
092420200529      *
092430200529     C     PRTN          IFEQ      '*ERROR*'
092440200529     C     *IN01         ANDEQ     *ON
092450200529     C                   MOVEL     '*CALL'       DBKEY
092460200529     C                   MOVEL     'ME1100'      DBFILE
092470200529     C                   Z-ADD     019           DBASE
092480200529     C                   EXSR      *PSSR
092490200529     C                   ENDIF
092500200529      *
092510200529      ** Set up the Detail screen fields from the message.
092520200529      *
092530200529      ** Sender.
092540200529      *
092550200529     C                   MOVEL     PSNDR         ODDSND1
092560200529      *
092570200529     C     PSN           IFNE      *BLANKS
092580200529     C                   MOVEL     PSN           DSTRAN
092590200529     C     PSNDR         IFEQ      'CASHIER'
092600200529     C                   MOVEL     PSNAR(1)      TMLIN2
092610200529     C                   ENDIF
092620200529     C                   MOVEL     TMLIN1        ODDSND1
092630200529     C                   MOVEL     TMLIN2        ODDSND2
092640200529     C                   MOVEL     TMLIN3        ODDSND3
092650200529     C                   MOVEL     TMLIN4        ODDSND4
092660200529     C                   ENDIF
092670200529      *
092680200529      ** Message Type.
092690200529      *
092700200529     C                   MOVE      PMTPY         IPINMTPY
092710200529      *
092720200529      ** Msg Unique Reference.
092730200529      *
092740200529     C                   Z-ADD     PHMSGR        IPINMSGR
092750200529      *
092760200529      ** SWIFT Reference.
092770200529      *
092780200529     C                   MOVEL     PHMIR         DDSWTN
092790200529      *
092800200529      ** Part Number.
092810200529      *
092820200529     C                   MOVE      PHPART        DDSEQNO
092830200529     C                   Z-ADD     PHPART        IPINKPRT
092840200529      *
092850200529      ** SWIFT Priority Code.
092860200529      *
092870200529     C                   MOVE      PMPRY         ODDSWPC
092880200529      *
092890200529      ** Branch Code.
092900200529      *
092910200529     C     PBRCA         IFNE      *BLANKS
092920200529     C                   MOVEL     PBRCA         ODDBRCA
092930200529     C                   MOVEL     PBRCA         IPBRCA                                       220180
092940200529     C                   ENDIF
092950200529      *
092960200529      ** Transaction Reference No.
092970200529      *
092980200529     C     P20           IFNE      *BLANKS
092990200529     C                   MOVEL     P20           DSTRAN
093000200529     C                   MOVEL     TTREF         IPINTRNO
093010200529     C                   ELSE
093020200529     C                   MOVEL     *BLANKS       IPINTRNO
093030200529     C                   ENDIF
093040200529      *
093050200529      ** Related Reference.
093060200529      *
093070200529     C     P21           IFNE      *BLANKS
093080200529     C                   MOVEL     P21           DSTRAN
093090200529     C                   MOVEL     TTREF         IPRLPR
093100200529     C                   MOVEL     TTREF         ODDRLPR
093110200529     C                   ELSE
093120200529     C                   MOVEL     *BLANKS       IPRLPR
093130200529     C                   ENDIF
093140200529      *                                                                                       255350
093150200529     C     PMTPY         IFEQ      '202'                                                      255350
093160200529     C     P20           ANDNE     *BLANKS                                                    255350
093170200529     C     PMTPY         OREQ      '103'                                                      257665
093180200529     C     P20           ANDNE     *BLANKS                                                    257665
093190200529     C                   MOVEL     P20           DSTRAN                                       255350
093200200529     C                   MOVEL     TTREF         IPRLPR                                       255350
093210200529     C                   MOVEL     TTREF         ODDRLPR                                      255350
093220200529     C                   ENDIF                                                                255350
093230200529                                                                                CFT014
093240200529     C     CFT014        IFEQ      'Y'                                          CFT014
093250200529                                                                                CFT014
093260200529      ** Sender's Charge fields                                                 CFT014
093270200529                                                                                CFT014
093280200529     C     P71FX         IFNE      *BLANKS                                      CFT014
093290200529                                                                                CFT014
093300200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
093310200529     C                   MOVEL     P71FX         DSTRAN                         CFT014
093320200529     C                   Z-ADD     1             L                 2 0          CFT014
093330200529     C                   MOVEL     TMLIN1        TV1                            CFT014
093340200529     C                   MOVEL     TMLIN2        TV2                            CFT014
093350200529     C                   MOVEL     TMLIN3        TV3                            CFT014
093360200529     C                   MOVEL     TMLIN4        TV4                            CFT014
093370200529     C                   MOVEL     TMLIN5        TV5                            CFT014
093380200529                                                                                CFT014
093390200529     C     L             DOWLE     5                                            CFT014
093400200529     C     LFLT(L)       ANDNE     *BLANK                                       CFT014
093410200529                                                                                CFT014
093420200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
093430200529     C                   MOVEL     LFLT(L)       DSTRAN                         CFT014
093440200529     C                   EXSR      SRCYAM33B                                    CFT014
093450200529                                                                                CFT014
093460200529     C                   SELECT                                                 CFT014
093470200529     C                   WHEN      (L = 1)                                      CFT014
093480200529     C                   MOVEL     WCAAM         ODDSCH1                        CFT014
093490200529     C                   MOVEL     WCACY         ODDSCC1                        CFT014
093500200529     C                   WHEN      (L = 2)                                      CFT014
093510200529     C                   MOVEL     WCAAM         ODDSCH2                        CFT014
093520200529     C                   MOVEL     WCACY         ODDSCC2                        CFT014
093530200529     C                   WHEN      (L = 3)                                      CFT014
093540200529     C                   MOVEL     WCAAM         ODDSCH3                        CFT014
093550200529     C                   MOVEL     WCACY         ODDSCC3                        CFT014
093560200529     C                   WHEN      (L = 4)                                      CFT014
093570200529     C                   MOVEL     WCAAM         ODDSCH4                        CFT014
093580200529     C                   MOVEL     WCACY         ODDSCC4                        CFT014
093590200529     C                   WHEN      (L = 5)                                      CFT014
093600200529     C                   MOVEL     WCAAM         ODDSCH5                        CFT014
093610200529     C                   MOVEL     WCACY         ODDSCC5                        CFT014
093620200529     C                   ENDSL                                                  CFT014
093630200529                                                                                CFT014
093640200529     C                   ADD       1             L                              CFT014
093650200529                                                                                CFT014
093660200529     C                   ENDDO                                                  CFT014
093670200529                                                                                CFT014
093680200529     C                   ENDIF                                                  CFT014
093690200529                                                                                CFT014
093700200529      ** Receiver's Charge field                                                CFT014
093710200529                                                                                CFT014
093720200529     C     P71G          IFNE      *BLANKS                                      CFT014
093730200529                                                                                CFT014
093740200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
093750200529     C                   MOVEL     'N'           I2INRCUS                       CFT014
093760200529     C                   MOVEL     P71G          DSTRAN                         CFT014
093770200529     C                   EXSR      SRCYAM33B                                    CFT014
093780200529                                                                                CFT014
093790200529     C     *LIKE         DEFINE    DDSMCY        WRCHCY                         CFT014
093800200529     C     *LIKE         DEFINE    DDSMAM        WRCHAM                         CFT014
093810200529      ** Save receiver's charges info for input to SR/SROV32AM                  CFT014
093820200529     C                   MOVEL     WCACY         WRCHCY                         CFT014
093830200529     C                   MOVEL     WCAAM         WRCHAM                         CFT014
093840200529                                                                                CFT014
093850200529     C                   CALL      'AOCURRR0'                           8080    CFT014
093860200529     C                   PARM      *BLANKS       @RTCD                          CFT014
093870200529     C                   PARM      '*KEY   '     @OPTN                          CFT014
093880200529     C                   PARM      WCACY         @CHR03            3            CFT014
093890200529     C     SDCURR        PARM      *BLANKS       DSSDY                          CFT014
093900200529     C     @RTCD         IFEQ      *BLANKS                                      CFT014
093910200529     C     *IN80         ANDEQ     *OFF                                         CFT014
093920200529     C                   MOVE      *BLANK        ZFIELD                         CFT014
093930200529     C                   MOVE      WCAAM         ZFIELD                         CFT014
093940200529     C     13            SUB       A6NBDP        ZADIG                          CFT014
093950200529     C                   Z-ADD     A6NBDP        ZADEC                          CFT014
093960200529     C                   Z-ADD     A6NBDP        WRCRMNDP          1 0          CFT014
093970200529                                                                                CFT014
093980200529     C                   CALLB     'ZALIGN'                                     CFT014
093990200529     C                   PARM                    ZalignOK                       CFT014
094000200529     C                   PARM                    ZFIELD                         CFT014
094010200529     C                   PARM                    ZADEC                          CFT014
094020200529     C                   PARM                    ZADIG                          CFT014
094030200529                                                                                CFT014
094040200529     C     ZAlignOK      IFEQ      'Y'                                          CFT014
094050200529     C                   MOVE      ZFIELD        I2INRCNW                       CFT014
094060200529     C                   MOVEL     WCACY         I2INRCCN                       CFT014
094070200529     C                   ENDIF                                                  CFT014
094080200529                                                                                CFT014
094090200529      ** Default receiver's charges screen field                                CFT014
094100200529     C                   MOVEL     WCAAM         ODDRCRM                        CFT014
094110200529                                                                                CFT014
094120200529     C                   ENDIF                                                  CFT014
094130200529                                                                                CFT014
094140200529     C                   ENDIF                                                  CFT014
094150200529                                                                                CFT014
094160200529     C                   ENDIF                                                  CFT014
094170200529      *
094180200529      ** Settlement Value Date/Currency/Amount.
094190200529      *
094200200529     C     PDCA          IFNE      *BLANKS
094210200529      *
094220200529     C                   MOVEL     PDCA          DSTRAN
094230200529      *
094240200529      ** Settlement Value Date.
094250200529      *
094260200529     C                   MOVEL     TVVDAT        WWDT
094270200529      *
094280200529      ** MMDDYY format display.
094290200529      *
094300200529     C     BJDFIN        IFEQ      'M'
094310200529      *
094320200529     C                   EVAL      ODDSLDT = WD2 + WD3 + WD1
094330200529      *
094340200529     C                   ELSE
094350200529      *
094360200529      ** DDMMYY format display.
094370200529      *
094380200529     C                   EVAL      ODDSLDT = WD3 + WD2 + WD1
094390200529      *
094400200529     C                   ENDIF
094410200529      *
094420200529      ** Settlement Currency.
094430200529      *
094440200529      ** Translate currency to Midas currency if it is a different                            225169
094450200529      ** SWIFT currency code.                                                                 225169
094460200529      *                                                                                       225169
094470200529     C                   MOVE      TVCCY         W_CCY                                        225169
094480200529     C                   EXSR      WTRNCY                                                     225169
094490200529     C                   MOVE      W_CCY         TVCCY                                        225169
094500200529      *                                                                                       225169
094510200529     C                   MOVEL     TVCCY         ODDSMCY
094520200529      *
094530200529      ** Settlement Amount.
094540200529      *
094550200529     C     PNWRK         IFNE      'FONTIS'
094560200529      *
094570200529      ** Format amount field (change ',' decimal point to '.').
094580200529      *
094590200529     C                   MOVEA     *BLANKS       WYA1
094600200529     C                   MOVEA     TVAMT         WYA1
094610200529     C                   Z-ADD     1             Cx                3 0
094620200529      *
094630200529     C     Cx            DOUGT     15
094640200529     C     WYA1(Cx)      IFEQ      ','
094650200529     C                   MOVE      '.'           WYA1(Cx)
094660200529     C                   Z-ADD     16            Cx
094670200529     C                   ELSE
094680200529     C                   ADD       1             Cx
094690200529     C                   ENDIF
094700200529     C                   ENDDO
094710200529      *
094720200529     C                   MOVEA     WYA1          WAMT             15
094730200529     C     CFT014        IFEQ      'Y'                                          CFT014
094740200529     C     P71G          ANDNE     *BLANKS                                      CFT014
094750200529     C                   MOVEL     ODDSLDT       ZDateIn                        CFT014
094760200529     C                   CALLB     'ZDATE1'                                     CFT014
094770200529     C                   PARM                    ZDateIn           6            CFT014
094780200529     C                   PARM      0             ZDateOut          5 0          CFT014
094790200529     C                   PARM      BJDFIN        ZDateFmt          1            CFT014
094800200529     C                   PARM      *BLANK        ZDate1OK          1            CFT014
094810200529     C                   Z-ADD     ZDateOut      WOVVLD            5 0          CFT014
094820200529     C                   Z-ADD     ZDateOut      WSLDT             5 0          CFT014
094830200529     C                   MOVE      ODDSMCY       WOVICY                         CFT014
094840200529     C                   MOVEL     WAMT          WOVIAM                         CFT014
094850200529     C                   MOVEL     WRCHCY        WOVRCY                         CFT014
094860200529     C                   MOVEL     WRCHAM        WOVRAM                         CFT014
094870200529     C                   MOVEL     '*SUB'        WOVOPR                         CFT014
094880200529     C                   EXSR      SROV32AM                                     CFT014
094890200529     C                   MOVEL     WOVAMT        ODDSMAM                        CFT014
094900200529     C                   ELSE                                                   CFT014
094910200529     C                   MOVEL     WAMT          ODDSMAM
094920200529     C                   ENDIF                                                  CFT014
094930200529      *
094940200529     C                   ENDIF
094950200529      *
094960200529     C                   ENDIF
094970200529      *
094980200529      ** Ordering Customer.
094990200529      *
095000200529     C     P50           IFNE      *BLANKS
095010200529     C                   MOVEL     P50           DSTRAN
095020200529     C                   MOVEL     TMLIN1        ODDORC1
095030200529     C                   MOVEL     TMLIN2        ODDORC2
095040200529     C                   MOVEL     TMLIN3        ODDORC3
095050200529     C                   MOVEL     TMLIN4        ODDORC4
095060200529     C                   EVAL      ODDORC5 = TMLIN5                                           CFT032
095070200529     C                   ENDIF
095080200529      *
095090200529      ** Ordering Institution.
095100200529      *
095110200529     C     P52           IFNE      *BLANKS
095120200529     C                   MOVEL     P52           DSTRAN
095130200529     C                   MOVEL     TMLIN1        ODDOBK1
095140200529     C                   MOVEL     TMLIN2        ODDOBK2
095150200529     C                   MOVEL     TMLIN3        ODDOBK3
095160200529     C                   MOVEL     TMLIN4        ODDOBK4
095170200529     C                   MOVEL     TMLIN5        ODDOBK5
095180200529     C                   ENDIF
095190200529      *
095200200529      ** Sender's Correspondent.
095210200529      *
095220200529     C     P53           IFNE      *BLANKS
095230200529     C                   MOVEL     P53           DSTRAN
095240200529     C                   MOVEL     TMLIN1        ODDSNC1
095250200529     C                   MOVEL     TMLIN2        ODDSNC2
095260200529     C                   MOVEL     TMLIN3        ODDSNC3
095270200529     C                   MOVEL     TMLIN4        ODDSNC4
095280200529     C                   MOVEL     TMLIN5        ODDSNC5
095290200529     C                   ENDIF
095300200529      *
095310200529      ** Receiver's Correspondent.
095320200529      *
095330200529     C     P54           IFNE      *BLANKS
095340200529      *
095350200529     C                   MOVEL     P54           DSTRAN
095360200529     C*****              MOVEL     TMLIN1        ODDRCCO                        CFT014
095370200529     C                   MOVEL     TMLIN1        ODDRCO1                        CFT014
095380200529     C                   MOVEL     TMLIN2        ODDRCO2                        CFT014
095390200529     C                   MOVEL     TMLIN3        ODDRCO3                        CFT014
095400200529     C                   MOVEL     TMLIN4        ODDRCO4                        CFT014
095410200529     C                   MOVEL     TMLIN5        ODDRCO5                        CFT014
095420200529     C                   MOVEL     TMLIN1        IPINRCO1
095430200529     C                   MOVEL     TMLIN2        IPINRCO2
095440200529     C                   MOVEL     TMLIN3        IPINRCO3
095450200529     C                   MOVEL     TMLIN4        IPINRCO4
095460200529     C                   MOVEL     TMLIN5        IPINRCO5
095470200529      *
095480200529      ** If Network is SWIFT, find field type.
095490200529      ** Otherwise, default it to 'U'.
095500200529      *
095510200529     C     PNWRK         IFEQ      'SWIFT '
095520200529      *
095530200529      ** Set up field type, if A->S, B->T, D->U.
095540200529      *
095550200529     C     1             SUBST     TRTAG:4       WWK1              1
095560200529      *
095570200529     C                   SELECT
095580200529     C     WWK1          WHENEQ    'A'
095590200529     C                   MOVEL     'S'           IPINRCRT
095600200529     C     WWK1          WHENEQ    'B'
095610200529     C                   MOVEL     'T'           IPINRCRT
095620200529     C                   OTHER
095630200529     C                   MOVEL     'U'           IPINRCRT
095640200529     C                   ENDSL
095650200529      *
095660200529     C                   ELSE
095670200529      *
095680200529      ** Network is not SWIFT.
095690200529      *
095700200529     C                   MOVEL     'U'           IPINRCRT
095710200529      *
095720200529     C                   ENDIF
095730200529      *
095740200529     C                   ELSE
095750200529      *
095760200529     C                   MOVEL     *BLANKS       IPINRCRT
095770200529     C                   MOVEL     *BLANKS       IPINRCO1
095780200529     C                   MOVEL     *BLANKS       IPINRCO2
095790200529     C                   MOVEL     *BLANKS       IPINRCO3
095800200529     C                   MOVEL     *BLANKS       IPINRCO4
095810200529     C                   MOVEL     *BLANKS       IPINRCO5
095820200529      *
095830200529     C                   ENDIF
095840200529      *
095850200529      ** Intermediary.
095860200529      *
095870200529     C     P56           IFNE      *BLANKS
095880200529     C                   MOVEL     P56           DSTRAN
095890200529     C                   MOVEL     TMLIN1        ODDINB1
095900200529     C                   MOVEL     TMLIN2        ODDINB2
095910200529     C                   MOVEL     TMLIN3        ODDINB3
095920200529     C                   MOVEL     TMLIN4        ODDINB4
095930200529     C                   MOVEL     TMLIN5        ODDINB5
095940200529     C                   ENDIF
095950200529      *
095960200529      ** Account with Institution.
095970200529      *
095980200529     C     P57           IFNE      *BLANKS
095990200529      *
096000200529     C                   MOVEL     P57           DSTRAN
096010200529     C                   MOVEL     TMLIN1        ODDACBK
096020200529     C                   MOVEL     TMLIN1        IPINACB1
096030200529     C                   MOVEL     TMLIN2        IPINACB2
096040200529     C                   MOVEL     TMLIN3        IPINACB3
096050200529     C                   MOVEL     TMLIN4        IPINACB4
096060200529     C                   MOVEL     TMLIN5        IPINACB5
096070200529      *
096080200529      ** If Network is SWIFT, find field type.
096090200529      ** Otherwise, default it to 'U'.
096100200529      *
096110200529     C     PNWRK         IFEQ      'SWIFT '
096120200529      *
096130200529      ** Set up field type, if A->S, B->T, D->U.
096140200529      *
096150200529     C     1             SUBST     TRTAG:4       WWK1
096160200529      *
096170200529     C                   SELECT
096180200529     C     WWK1          WHENEQ    'A'
096190200529     C                   MOVEL     'S'           IPINACBT
096200200529     C     WWK1          WHENEQ    'B'
096210200529     C                   MOVEL     'T'           IPINACBT
096220200529     C                   OTHER
096230200529     C                   MOVEL     'U'           IPINACBT
096240200529     C                   ENDSL
096250200529      *
096260200529     C                   ELSE
096270200529      *
096280200529      ** Network is not SWIFT.
096290200529      *
096300200529     C                   MOVEL     'U'           IPINACBT
096310200529      *
096320200529     C                   ENDIF
096330200529      *
096340200529      ** P57 equals blanks.
096350200529      *
096360200529     C                   ELSE
096370200529      *
096380200529     C                   MOVEL     *BLANKS       IPINACBT
096390200529     C                   MOVEL     *BLANKS       IPINACB1
096400200529     C                   MOVEL     *BLANKS       IPINACB2
096410200529     C                   MOVEL     *BLANKS       IPINACB3
096420200529     C                   MOVEL     *BLANKS       IPINACB4
096430200529     C                   MOVEL     *BLANKS       IPINACB5
096440200529      *
096450200529     C                   ENDIF
096460200529      *
096470200529      ** Beneficiary Institution/ Beneficiary Customer.
096480200529      *
096490200529     C     P58           IFNE      *BLANKS
096500200529     C                   MOVEL     P58           DSTRAN
096510200529     C                   MOVEL     TMLIN1        ODDBNC1
096520200529     C                   MOVEL     TMLIN2        ODDBNC2
096530200529     C                   MOVEL     TMLIN3        ODDBNC3
096540200529     C                   MOVEL     TMLIN4        ODDBNC4
096550200529     C                   MOVEL     TMLIN5        ODDBNC5
096560200529     C                   ENDIF
096570200529      *
096580200529     C     P59           IFNE      *BLANKS
096590200529     C                   MOVEL     P59           DSTRAN
096600200529     C                   MOVEL     TMLIN1        ODDBNC1
096610200529     C                   MOVEL     TMLIN2        ODDBNC2
096620200529     C                   MOVEL     TMLIN3        ODDBNC3
096630200529     C                   MOVEL     TMLIN4        ODDBNC4
096640200529     C                   MOVEL     TMLIN5        ODDBNC5
096650200529     C                   ENDIF
096660200529      *
096670200529      ** Details of Payment.
096680200529      *
096690200529     C     P70           IFNE      *BLANKS
096700200529     C                   MOVEL     P70           DSTRAN
096710200529     C                   MOVEL     TMLIN1        ODDDTP1
096720200529     C                   MOVEL     TMLIN2        ODDDTP2
096730200529     C                   MOVEL     TMLIN3        ODDDTP3
096740200529     C                   MOVEL     TMLIN4        ODDDTP4
096750200529     C                   ENDIF
096760200529      *                                                                                       CER030
096770200529      ** Details of Extended narrative                                                        CER030
096780200529      *                                                                                       CER030
096790200529     C     PEXN          IFNE      *BLANKS                                                    CER030
096800200529     C                   MOVEL     PEXN          DSTRAN                                       CER030
096810200529     C                   MOVEL     TMLIN1        ODDEXT1                                      CER030
096820200529     C                   MOVEL     TMLIN2        ODDEXT2                                      CER030
096830200529     C                   MOVEL     TMLIN3        ODDEXT3                                      CER030
096840200529     C                   MOVEL     TMLIN4        ODDEXT4                                      CER030
096850200529     C                   MOVEL     TMLIN5        ODDEXT5                                      CER030
096860200529     C                   MOVEL     TMLIN6        ODDEXT6                                      CER030
096870200529     C                   ENDIF                                                                CER030
096880200529      *
096890200529      ** Details of Charges.
096900200529      *
096910200529     C     P71           IFNE      *BLANKS
096920200529     C                   MOVEL     P71           DSTRAN
096930200529     C                   MOVEL     TTREF         ODDDTCH
096940200529     C     CFT014        IFEQ      'Y'                                          CFT014
096950200529      *                                                                         CFT014
096960200529     C     TTREF         IFEQ      'OUR'                                        CFT014
096970200529     C                   MOVE      'A'           ODDADDC                        CFT014
096980200529     C                   ELSE                                                   CFT014
096990200529     C                   MOVE      'D'           ODDADDC                        CFT014
097000200529     C                   ENDIF                                                  CFT014
097010200529      *                                                                         CFT014
097020200529      ** Check if receiver's charges screen field needs to be changed           CFT014
097030200529     C     ODDADDC       IFEQ      'A'                                          CFT014
097040200529     C     ODDSMCY       ANDNE     I2INRCCN                                     CFT014
097050200529     C     I2INRCNW      ANDNE     0                                            CFT014
097060200529      ** Calculate receiver's charges network in settlement currency            CFT014
097070200529     C                   CLEAR                   P#0010                         CFT014
097080200529     C                   Z-ADD     WSLDT         P#FRDT                         CFT014
097090200529     C                   Z-ADD     WSLDT         P#TODT                         CFT014
097100200529     C                   MOVEL     I2INRCCN      P#FRCY                         CFT014
097110200529     C                   Z-ADD     I2INRCNW      P#FRAM                         CFT014
097120200529     C                   MOVEL     ODDSMCY       P#TOCY                         CFT014
097130200529     C                   Z-ADD     0             P#TOAM                         CFT014
097140200529     C                   Z-ADD     0             P#RATE                         CFT014
097150200529     C                   CALL      'FT0010'                                     CFT014
097160200529     C                   PARM                    P#0010                         CFT014
097170200529     C     P#RTCD        IFNE      *BLANKS                                      CFT014
097180200529     C                   Z-ADD     35            DBASE                          CFT014
097190200529     C                   MOVEL     'FT0010'      DBFILE                         CFT014
097200200529     C                   MOVEL     '*CALL '      DBKEY                          CFT014
097210200529     C                   EXSR      *PSSR                                        CFT014
097220200529     C                   ELSE                                                   CFT014
097230200529     C                   MOVE      *BLANKS       ZFIELD                         CFT014
097240200529     C                   MOVE      P#TOAM        ZFIELD                         CFT014
097250200529     C                   CALLB     'ZEDIT'                                      CFT014
097260200529     C                   PARM                    ZFIELD                         CFT014
097270200529     C                   PARM      WRCRMNDP      ZADEC                          CFT014
097280200529     C                   MOVE      ZFIELD        ODDRCRM                        CFT014
097290200529      ** Left-justify the amount                                                CFT014
097300200529     C                   Z-ADD     1             CX                             CFT014
097310200529     C                   MOVE      *BLANKS       WYA1                           CFT014
097320200529     C                   MOVEA     ODDRCRM       WYA1(1)                        CFT014
097330200529     C     WYA1(CX)      DOWEQ     *BLANK                                       CFT014
097340200529     C     CX            ANDLT     12                                           CFT014
097350200529     C                   ADD       1             CX                             CFT014
097360200529     C                   ENDDO                                                  CFT014
097370200529     C                   MOVE      *BLANKS       ODDRCRM                        CFT014
097380200529     C     CX            IFLE      12                                           CFT014
097390200529     C                   MOVEA     WYA1(CX)      ODDRCRM                        CFT014
097400200529     C                   ENDIF                                                  CFT014
097410200529     C                   ENDIF                                                  CFT014
097420200529     C                   ENDIF                                                  CFT014
097430200529      *                                                                         CFT014
097440200529     C                   ENDIF                                                  CFT014
097450200529     C                   ENDIF
097460200529      *
097470200529      ** Bank to Bank Information.
097480200529      *
097490200529      ** Access Settlement Currency details.
097500200529      *
097510200529     C                   CALLB     'AOCURRR0'
097520200529     C                   PARM      '       '     PRTCD
097530200529     C                   PARM      '*KEY   '     POPTN
097540200529     C                   PARM      ODDSMCY       PCCY
097550200529     C     SDCURR        PARM      SDCURR        DSSDY
097560200529      *
097570200529     C     P72           IFNE      *BLANKS
097580200529      *
097590200529     C                   MOVEL     P72           DSTRAN
097600200529     C                   MOVEL     TMLIN1        ODDBBI1
097610200529     C                   MOVEL     TMLIN2        ODDBBI2
097620200529     C                   MOVEL     TMLIN3        ODDBBI3
097630200529     C                   MOVEL     TMLIN4        ODDBBI4
097640200529     C                   MOVEL     TMLIN5        ODDBBI5
097650200529     C                   MOVEL     TMLIN6        ODDBBI6
097660200529      *                                                                         CFT014
097670200529     C     P33B          IFEQ      *BLANKS                                      CFT014
097680200529      *
097690200529     C     '/OCMT/'      SCAN      P72           WOCMT             3 0
097700200529      *
097710200529     C     WOCMT         IFNE      0
097720200529     C                   MOVEL     '/OCMT'       WCW
097730200529     C                   MOVEL     P72           WCWLIN
097740200529     C                   EXSR      SRFOCmt2
097750200529     C                   MOVEL     WCWCY         ODDNDCY
097760200529     C                   MOVEL     WCWAM         ODDNDAM
097770200529     C                   ENDIF
097780200529      *                                                                         CFT014
097790200529     C                   ENDIF                                                  CFT014
097800200529      *
097810200529     C                   ENDIF
097820200529      *
097830200529      ** Additional Mapping for CASHIER.
097840200529      *
097850200529      ** Pay Value Date/Currency/Amount.
097860200529      *
097870200529     C     SDCA          IFNE      *BLANKS
097880200529      *
097890200529     C                   Z-ADD     0             TVVDAT
097900200529     C                   MOVEL     SDCA          DSTRAN
097910200529      *
097920200529      ** Pay Value Date.
097930200529      *
097940200529     C     TVVDAT        IFNE      0
097950200529      *
097960200529     C                   MOVEL     TVVDAT        WWDT
097970200529      *
097980200529      ** MMDDYY format display.
097990200529      *
098000200529     C     BJDFIN        IFEQ      'M'
098010200529      *
098020200529     C                   EVAL      ODDPYDT = WD2 + WD3 + WD1
098030200529      *
098040200529     C                   ELSE
098050200529      *
098060200529      ** DDMMYY format display.
098070200529      *
098080200529     C                   EVAL      ODDPYDT = WD3 + WD2 + WD1
098090200529      *
098100200529     C                   ENDIF
098110200529      *
098120200529     C                   ENDIF
098130200529      *
098140200529      ** Pay Currency.
098150200529      *
098160200529      ** Translate currency to Midas currency if it is a different                            225169
098170200529      ** SWIFT currency code.                                                                 225169
098180200529      *                                                                                       225169
098190200529     C                   MOVE      TVCCY         W_CCY                                        225169
098200200529     C                   EXSR      WTRNCY                                                     225169
098210200529     C                   MOVE      W_CCY         TVCCY                                        225169
098220200529      *                                                                                       225169
098230200529     C                   MOVEL     TVCCY         ODDPCCY
098240200529      *
098250200529      ** Pay Amount.
098260200529      *
098270200529      ** Format amount field (change ',' decimal point to '.').
098280200529      *
098290200529     C                   MOVEA     *BLANKS       WYA1
098300200529     C                   MOVEA     TVAMT         WYA1
098310200529     C                   Z-ADD     1             Cx
098320200529      *
098330200529     C     Cx            DOUGT     15
098340200529     C     WYA1(Cx)      IFEQ      ','
098350200529     C                   MOVE      '.'           WYA1(Cx)
098360200529     C                   Z-ADD     16            Cx
098370200529     C                   ELSE
098380200529     C                   ADD       1             Cx
098390200529     C                   ENDIF
098400200529     C                   ENDDO
098410200529      *
098420200529     C                   MOVEA     WYA1          WAMT
098430200529     C                   MOVEL     WAMT          ODDPYAM
098440200529      *
098450200529     C                   ENDIF
098460200529      *
098470200529      ** Funding Currency/Funding Amount.
098480200529      *
098490200529     C     PDC2          IFNE      *BLANKS
098500200529      *
098510200529     C                   Z-ADD     0             TVVDAT
098520200529     C                   MOVEL     PDC2          DSTRAN
098530200529      *
098540200529      ** Settlement Value Date.
098550200529      *
098560200529     C     TVVDAT        IFNE      0
098570200529      *
098580200529     C                   MOVEL     TVVDAT        WWDT
098590200529      *
098600200529      ** MMDDYY format display.
098610200529      *
098620200529     C     BJDFIN        IFEQ      'M'
098630200529      *
098640200529     C                   EVAL      ODDSLDT = WD2 + WD3 + WD1
098650200529      *
098660200529     C                   ELSE
098670200529      *
098680200529      ** DDMMYY format display.
098690200529      *
098700200529     C                   EVAL      ODDSLDT = WD3 + WD2 + WD1
098710200529      *
098720200529     C                   ENDIF
098730200529      *
098740200529     C                   ENDIF
098750200529      *
098760200529      ** Settlement Currency.
098770200529      *
098780200529      ** Translate currency to Midas currency if it is a different                            225169
098790200529      ** SWIFT currency code.                                                                 225169
098800200529      *                                                                                       225169
098810200529     C                   MOVE      TVCCY         W_CCY                                        225169
098820200529     C                   EXSR      WTRNCY                                                     225169
098830200529     C                   MOVE      W_CCY         TVCCY                                        225169
098840200529      *                                                                                       225169
098850200529     C                   MOVEL     TVCCY         ODDSMCY
098860200529      *
098870200529      ** Settlement AMount.
098880200529      *
098890200529      ** Format amount field (change ',' decimal point to '.').
098900200529      *
098910200529     C                   MOVEA     *BLANKS       WYA1
098920200529     C                   MOVEA     TVAMT         WYA1
098930200529     C                   Z-ADD     1             Cx
098940200529      *
098950200529     C     Cx            DOUGT     15
098960200529     C     WYA1(Cx)      IFEQ      ','
098970200529     C                   MOVE      '.'           WYA1(Cx)
098980200529     C                   Z-ADD     16            Cx
098990200529     C                   ELSE
099000200529     C                   ADD       1             Cx
099010200529     C                   ENDIF
099020200529     C                   ENDDO
099030200529      *
099040200529     C                   MOVEA     WYA1          WAMT
099050200529     C                   MOVEL     WAMT          ODDSMAM
099060200529      *
099070200529     C                   ENDIF
099080200529      *
099090200529      ** Rate.
099100200529      *
099110200529     C     ODDPYAM       IFNE      *BLANKS
099120200529     C     ODDSMAM       ANDNE     *BLANKS
099130200529      *
099140200529      ** Get the numeric value of DDPYAM.
099150200529      *
099160200529     C                   CALLB     'AOCURRR0'
099170200529     C                   PARM      *BLANKS       PRTCD
099180200529     C                   PARM      '*KEY   '     POPTN
099190200529     C                   PARM      ODDPCCY       PCCY
099200200529     C     SDCURR        PARM      SDCURR        DSSDY
099210200529      *
099220200529     C     PRTCD         IFNE      *BLANKS
099230200529     C                   MOVEL     ODDPCCY       DBKEY
099240200529     C                   MOVEL     'SDCURRPD'    DBFILE
099250200529     C                   Z-ADD     020           DBASE
099260200529     C                   EXSR      *PSSR
099270200529     C                   ENDIF
099280200529      *
099290200529     C                   Z-ADD     A6NBDP        WPCYD             1 0
099300200529      *
099310200529      ** Align amount.
099320200529      *
099330200529     C                   Z-ADD     WPCYD         ZADEC
099340200529     C     11            SUB       WPCYD         ZADIG
099350200529     C                   MOVEL     *BLANKS       ZFIELD
099360200529     C                   MOVE      ODDPYAM       ZFIELD
099370200529      *
099380200529     C                   CALLB     'ZALIGN'
099390200529     C                   PARM                    ZalignOk          1
099400200529     C                   PARM                    ZField           16
099410200529     C                   PARM                    ZADec             1 0
099420200529     C                   PARM                    ZADig             2 0
099430200529      *
099440200529     C     ZalignOK      IFEQ      'Y'
099450200529     C                   MOVE      ZFIELD        W1PYA            11 0
099460200529     C                   ENDIF
099470200529      *
099480200529      ** Get the numeric value of ODDSMAM.
099490200529      *
099500200529     C                   CALLB     'AOCURRR0'
099510200529     C                   PARM      *BLANKS       PRTCD
099520200529     C                   PARM      '*KEY   '     POPTN
099530200529     C                   PARM      ODDSMCY       PCCY
099540200529     C     SDCURR        PARM      SDCURR        DSSDY
099550200529      *
099560200529     C     PRTCD         IFNE      *BLANKS
099570200529     C                   MOVEL     ODDSMCY       DBKEY
099580200529     C                   MOVEL     'SDCURRPD'    DBFILE
099590200529     C                   Z-ADD     021           DBASE
099600200529     C                   EXSR      *PSSR
099610200529     C                   ENDIF
099620200529      *
099630200529     C                   Z-ADD     A6NBDP        WSMCY             1 0
099640200529      *
099650200529      ** Align amount.
099660200529      *
099670200529     C                   Z-ADD     WSMCY         ZADEC
099680200529     C     11            SUB       WSMCY         ZADIG
099690200529     C                   MOVEL     *BLANKS       ZFIELD
099700200529     C                   MOVE      ODDSMAM       ZFIELD
099710200529      *
099720200529     C                   CALLB     'ZALIGN'
099730200529     C                   PARM                    ZalignOk
099740200529     C                   PARM                    ZField
099750200529     C                   PARM                    ZADec
099760200529     C                   PARM                    ZADig
099770200529      *
099780200529     C     ZalignOK      IFEQ      'Y'
099790200529     C                   MOVE      ZFIELD        W1SMA            11 0
099800200529     C                   ENDIF
099810200529      *
099820200529     C     W1PYA         IFNE      0
099830200529     C     W1SMA         ANDNE     0
099840200529      *
099850200529      ** Calculate the Rate by dividing the larger amount
099860200529      ** by the smaller amount.
099870200529      *
099880200529     C     W1PYA         IFGE      W1SMA
099890200529     C     W1PYA         DIV       W1SMA         W1RTE            11 7
099900200529     C                   MOVE      *BLANKS       ODDSMAM
099910200529     C                   ENDIF
099920200529      *
099930200529     C     W1SMA         IFGT      W1PYA
099940200529     C     W1PYA         DIV       W1SMA         W1RTE
099950200529     C                   MOVE      *BLANKS       ODDPYAM
099960200529     C                   ENDIF
099970200529      *
099980200529      ** Format Rate field.
099990200529      *
100000200529     C                   MOVE      *BLANKS       ZFIELD
100010200529     C                   MOVE      W1RTE         ZFIELD
100020200529     C                   Z-ADD     7             ZADEC2            2 0
100030200529      *
100040200529     C                   CALLB     'ZAEDITM'
100050200529     C                   PARM                    ZFIELD
100060200529     C                   PARM                    ZADEC2
100070200529      *
100080200529     C                   MOVE      ZFIELD        ODDRATE
100090200529      *
100100200529     C                   ENDIF
100110200529      *
100120200529     C                   ENDIF
100130200529      *
100140200529     C     PNWRK         IFEQ      'CASHV8'
100150200529      *
100160200529      ** Receiver's Correspondent and Ordering Bank.
100170200529      *
100180200529     C     P54           IFNE      *BLANKS
100190200529      *
100200200529     C                   MOVEL     P54           DSTRAN
100210200529     C*****              MOVEL     *BLANKS       ODDRCCO                        CFT014
100220200529     C*****              MOVEL     TMLIN         ODDRCCO                        CFT014
100230200529     C                   MOVEL     *BLANKS       ODDRCO1                        CFT014
100240200529     C                   MOVEL     TMLIN         ODDRCO1                        CFT014
100250200529     C                   MOVEL     *BLANKS       ODDOBK1
100260200529     C                   MOVEL     TMLIN         ODDOBK1
100270200529      *
100280200529     C                   ELSE
100290200529      *
100300200529      ** Use the default account code from CASH dataarea and
100310200529      ** build the account number.
100320200529      *
100330200529      ** Get Branch internal customer.
100340200529      *
100350200529     C**********         CALLB     'AOBRCHR0'                                                 CGL029
100360200529     C                   CALL      'AOBRCHR1'                                                 CGL029
100370200529     C                   PARM      *BLANKS       PRTCD
100380200529     C                   PARM      '*KEY   '     POPTN
100390200529     C                   PARM      ODDBRCA       PBRCH             3
100400200529     C*****SDBRCH        PARM      SDBRCH        DSFDY                                        CGL029
100410200529     C     SDBRCH        PARM      SDBRCH        DSSDY                                        CGL029
100420200529      *
100430200529     C     PRTCD         IFNE      *BLANKS
100440200529     C                   MOVEL     ODDBRCA       DBKEY
100450200529     C                   MOVEL     'SDBRCHPD'    DBFILE
100460200529     C                   Z-ADD     022           DBASE
100470200529     C                   EXSR      *PSSR
100480200529     C                   ENDIF
100490200529      *
100500200529      ** Retrieve Retail account number.
100510200529      *
100520200529     C                   MOVE      A8BICN        KACNUM
100530200529     C                   MOVEL     ODDSMCY       KACCCY
100540200529     C                   MOVE      WDACACD       KACCD
100550200529     C                   Z-ADD     1             KACSQ
100560200529     C                   MOVEL     ODDBRCA       KBRCA
100570200529      *
100580200529     C     KAccnt        CHAIN     ACCNT                              01
100590200529      *
100600200529     C     *IN01         IFEQ      *ON
100610200529     C                   MOVEL     WACKYDS       DBKEY
100620200529     C                   MOVEL     'ACCNT'       DBFILE
100630200529     C                   Z-ADD     023           DBASE
100640200529     C                   EXSR      *PSSR
100650200529     C                   ENDIF
100660200529      *
100670200529      ** Move Retail account number to Receiver's Correspondent.
100680200529      *
100690200529     C*****              MOVEL     *BLANKS       ODDRCCO                        CFT014
100700200529     C*****              MOVE      ACNO          ODDRCCO                        CFT014
100710200529     C                   MOVEL     *BLANKS       ODDRCO1                        CFT014
100720200529     C                   MOVE      ACNO          ODDRCO1                        CFT014
100730200529      *
100740200529     C                   ENDIF
100750200529      *
100760200529      ** Account with Institution.
100770200529      *
100780200529     C     P57           IFNE      *BLANKS
100790200529     C                   MOVEL     P57           DSTRAN
100800200529     C                   MOVEL     *BLANKS       WREAC            10
100810200529     C                   MOVEL     TMLIN         WREAC
100820200529     C                   MOVEL     *BLANKS       ODDACBK
100830200529     C                   MOVEL     WREAC         ODDACBK
100840200529     C                   ENDIF
100850200529      *
100860200529     C                   MOVEL     'N'           ODDOPIN
100870200529      *
100880200529     C                   ENDIF
100890200529      *                                                                         CFT014
100900200529     C     CFT014        IFEQ      'Y'                                          CFT014
100910200529      *                                                                         CFT014
100920200529      ** Third Reimbursment Institution                                         CFT014
100930200529      *                                                                         CFT014
100940200529     C     P55           IFNE      *BLANKS                                      CFT014
100950200529      *                                                                         CFT014
100960200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
100970200529     C                   MOVEL     P55           DSTRAN                         CFT014
100980200529      *                                                                         CFT014
100990200529      ** Map 1st line of SWIFT values into screen fields                        CFT014
101000200529     C                   MOVEL     TMLIN1        ODDTRIB                        CFT014
101010200529      *                                                                         CFT014
101020200529     C     CFT004        IFEQ      'Y'                                          CFT014
101030200529      ** Check whether the field carries an IBAN                                CFT014
101040200529      ** If it is the case, move the IBAN into the 'screen' field               CFT014
101050200529      ** which will be validated afterwards                                     CFT014
101060200529     C                   MOVEL     ODDTRIB       P@IBAN           34            CFT014
101070200529      ** Check that it is a valid IBAN                                          CFT014
101080200529     C                   CALL      'AOIBANR2'                                   CFT014
101090200529     C                   PARM      *BLANKS       @RTCD                          CFT014
101100200529     C                   PARM                    P@IBAN                         CFT014
101110200529     C                   PARM      *BLANKS       DSSDY                          CFT014
101120200529      ** Network information is mapped onto the 'screen' field                  CFT014
101130200529     C     @RTCD         IFEQ      *BLANKS                                      CFT014
101140200529     C                   MOVEL     *BLANK        ODDTRIB                        CFT014
101150200529      ** '/' has been removed                                                   CFT014
101160200529     C                   MOVEL     P@IBAN        ODDTRIB                        CFT014
101170200529     C                   ENDIF                                                  CFT014
101180200529      *                                                                         CFT014
101190200529     C                   ENDIF                                                  CFT014
101200200529      *                                                                         CFT014
101210200529     C                   ENDIF                                                  CFT014
101220200529      *                                                                         CFT014
101230200529      ** Bank Operation Code                                                    CFT014
101240200529      *                                                                         CFT014
101250200529     C     P23B          IFNE      *BLANKS                                      CFT014
101260200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101270200529     C                   MOVEL     P23B          DSTRAN                         CFT014
101280200529     C                   MOVEL     TTREF         ODDBOCD                        CFT014
101290200529     C                   ENDIF                                                  CFT014
101300200529      *                                                                         CFT014
101310200529      ** Instruction Code                                                       CFT014
101320200529      *                                                                         CFT014
101330200529     C     P23E          IFNE      *BLANKS                                      CFT014
101340200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101350200529     C                   MOVEL     P23E          DSTRAN                         CFT014
101360200529     C                   MOVEL     TMLIN1        ODDICD1                        CFT014
101370200529     C                   MOVEL     TMLIN2        ODDICD2                        CFT014
101380200529     C                   MOVEL     TMLIN3        ODDICD3                        CFT014
101390200529     C                   MOVEL     TMLIN4        ODDICD4                        CFT014
101400200529     C                   MOVEL     TMLIN5        ODDICD5                        CFT014
101410200529     C                   ENDIF                                                  CFT014
101420200529      *                                                                         CFT014
101430200529      ** Transaction Code                                                       CFT014
101440200529      *                                                                         CFT014
101450200529     C     P26T          IFNE      *BLANKS                                      CFT014
101460200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101470200529     C                   MOVEL     P26T          DSTRAN                         CFT014
101480200529     C                   MOVEL     TTREF         ODDTTCD                        CFT014
101490200529     C                   ENDIF                                                  CFT014
101500200529      *                                                                         CFT014
101510200529      ** Instructed Currency/Amount                                             CFT014
101520200529      *                                                                         CFT014
101530200529     C     P33B          IFNE      *BLANKS                                      CFT014
101540200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101550200529     C                   MOVEL     P33B          DSTRAN                         CFT014
101560200529     C                   EXSR      SRCYAM33B                                    CFT014
101570200529     C                   MOVEL     WCACY         ODDNDCY                        CFT014
101580200529     C                   MOVEL     WCAAM         ODDNDAM                        CFT014
101590200529     C                   ENDIF                                                  CFT014
101600200529      *                                                                         CFT014
101610200529      ** Original Rate Currency/Amount                                          CFT014
101620200529      *                                                                         CFT014
101630200529     C     P36           IFNE      *BLANKS                                      CFT014
101640200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101650200529     C                   MOVEL     P36           DSTRAN                         CFT014
101660200529     C                   EXSR      SRRATE36                                     CFT014
101670200529     C                   MOVEL     W36RT         ODDOEXR                        CFT014
101680200529     C                   ENDIF                                                  CFT014
101690200529      *                                                                         CFT014
101700200529      ** Regulatory Reporting                                                   CFT014
101710200529      *                                                                         CFT014
101720200529     C     P77B          IFNE      *BLANKS                                      CFT014
101730200529     C                   MOVEL     *BLANK        DSTRAN                         CFT014
101740200529     C                   MOVEL     P77B          DSTRAN                         CFT014
101750200529     C                   MOVEL     TMLIN1        ODDRRP1                        CFT014
101760200529     C                   MOVEL     TMLIN2        ODDRRP2                        CFT014
101770200529     C                   MOVEL     TMLIN3        ODDRRP3                        CFT014
101780200529     C                   ENDIF                                                  CFT014
101790200529      *                                                                         CFT014
101800200529     C                   ENDIF                                                  CFT014
101810200529      *
101820200529      ***Default*in*Book*Code.                                                                195063
101830200529      **********                                                                              195063
101840200529     C**********         MOVE      'FT'          ODDBOKC                                      195063
101850200529      *                                                                                       CSW209
101860200529     C                   IF        CSW209 = 'Y'                                               CSW209
101870200529      *                                                                                       CSW209
101880200529     C                   EVAL      ODDNWRK = PNWRK                                            CSW209
101890200529     C                   EVAL      ODDMTPY = PMTPY                                            CSW209
101900200529     C                   EVAL      ODDVALF = P119                                             CSW209
101910200529      *                                                                                       CSW209
101920200529      ** Set Ordering Customer (Cover)                                                        CSW209
101930200529      *                                                                                       CSW209
101940200529     C                   IF        PB50 <> *BLANKS                                            CSW209
101950200529     C                   EVAL      DSTRAN  = PB50                                             CSW209
101960200529     C                   EVAL      ODDCOC1 = TMLIN1                                           CSW209
101970200529     C                   EVAL      ODDCOC2 = TMLIN2                                           CSW209
101980200529     C                   EVAL      ODDCOC3 = TMLIN3                                           CSW209
101990200529     C                   EVAL      ODDCOC4 = TMLIN4                                           CSW209
102000200529     C                   EVAL      ODDCOC5 = TMLIN5                                           CSW209
102010200529     C                   ENDIF                                                                CSW209
102020200529      *                                                                                       CSW209
102030200529      ** Set Ordering Institution (Cover)                                                     CSW209
102040200529      *                                                                                       CSW209
102050200529     C                   IF        PB52 <> *BLANKS                                            CSW209
102060200529     C                   EVAL      DSTRAN  = PB52                                             CSW209
102070200529     C                   EVAL      ODDCOB1 = TMLIN1                                           CSW209
102080200529     C                   EVAL      ODDCOB2 = TMLIN2                                           CSW209
102090200529     C                   EVAL      ODDCOB3 = TMLIN3                                           CSW209
102100200529     C                   EVAL      ODDCOB4 = TMLIN4                                           CSW209
102110200529     C                   EVAL      ODDCOB5 = TMLIN5                                           CSW209
102120200529     C                   ENDIF                                                                CSW209
102130200529      *                                                                                       CSW209
102140200529      ** Set Intermediary Institution (Cover)                                                 CSW209
102150200529      *                                                                                       CSW209
102160200529     C                   IF        PB56 <> *BLANKS                                            CSW209
102170200529     C                   EVAL      DSTRAN = PB56                                              CSW209
102180200529     C                   EVAL      ODDCIB1 = TMLIN1                                           CSW209
102190200529     C                   EVAL      ODDCIB2 = TMLIN2                                           CSW209
102200200529     C                   EVAL      ODDCIB3 = TMLIN3                                           CSW209
102210200529     C                   EVAL      ODDCIB4 = TMLIN4                                           CSW209
102220200529     C                   EVAL      ODDCIB5 = TMLIN5                                           CSW209
102230200529     C                   ENDIF                                                                CSW209
102240200529      *                                                                                       CSW209
102250200529      ** Set Account with Institution (Cover)                                                 CSW209
102260200529      *                                                                                       CSW209
102270200529     C                   IF        PB57 <> *BLANKS                                            CSW209
102280200529     C                   EVAL      DSTRAN = PB57                                              CSW209
102290200529     C                   EVAL      ODDCAB1 = TMLIN1                                           CSW209
102300200529     C                   EVAL      ODDCAB2 = TMLIN2                                           CSW209
102310200529     C                   EVAL      ODDCAB3 = TMLIN3                                           CSW209
102320200529     C                   EVAL      ODDCAB4 = TMLIN4                                           CSW209
102330200529     C                   EVAL      ODDCAB5 = TMLIN5                                           CSW209
102340200529     C                   ENDIF                                                                CSW209
102350200529      *                                                                                       CSW209
102360200529      ** Set Beneficiary Customer (Cover)                                                     CSW209
102370200529      *                                                                                       CSW209
102380200529     C                   IF        PB59 <> *BLANKS                                            CSW209
102390200529     C                   EVAL      DSTRAN = PB59                                              CSW209
102400200529     C                   EVAL      ODDCBC1 = TMLIN1                                           CSW209
102410200529     C                   EVAL      ODDCBC2 = TMLIN2                                           CSW209
102420200529     C                   EVAL      ODDCBC3 = TMLIN3                                           CSW209
102430200529     C                   EVAL      ODDCBC4 = TMLIN4                                           CSW209
102440200529     C                   EVAL      ODDCBC5 = TMLIN5                                           CSW209
102450200529     C                   ENDIF                                                                CSW209
102460200529      *                                                                                       CSW209
102470200529      ** Set Remittance Information (Cover)                                                   CSW209
102480200529      *                                                                                       CSW209
102490200529     C                   IF        PB70 <> *BLANKS                                            CSW209
102500200529     C                   EVAL      DSTRAN = PB70                                              CSW209
102510200529     C                   EVAL      ODDCDP1 = TMLIN1                                           CSW209
102520200529     C                   EVAL      ODDCDP2 = TMLIN2                                           CSW209
102530200529     C                   EVAL      ODDCDP3 = TMLIN3                                           CSW209
102540200529     C                   EVAL      ODDCDP4 = TMLIN4                                           CSW209
102550200529     C                   ENDIF                                                                CSW209
102560200529      *                                                                                       CSW209
102570200529      ** Set Sender to Receiver Information (Cover)                                           CSW209
102580200529      *                                                                                       CSW209
102590200529     C                   IF        PB72 <> *BLANKS                                            CSW209
102600200529     C                   EVAL      DSTRAN = PB72                                              CSW209
102610200529     C                   EVAL      ODDCBB1 = TMLIN1                                           CSW209
102620200529     C                   EVAL      ODDCBB2 = TMLIN2                                           CSW209
102630200529     C                   EVAL      ODDCBB3 = TMLIN3                                           CSW209
102640200529     C                   EVAL      ODDCBB4 = TMLIN4                                           CSW209
102650200529     C                   EVAL      ODDCBB5 = TMLIN5                                           CSW209
102660200529     C                   EVAL      ODDCBB6 = TMLIN6                                           CSW209
102670200529     C                   ENDIF                                                                CSW209
102680200529      *                                                                                       CSW209
102690200529      ** Set Instructed Currency/Amount (Cover)                                               CSW209
102700200529      *                                                                                       CSW209
102710200529     C                   IF        PB33B <> *BLANKS                                           CSW209
102720200529     C                   EVAL      DSTRAN = *BLANKS                                           CSW209
102730200529     C                   EVAL      DSTRAN = PB33B                                             CSW209
102740200529     C                   EXSR      SRCYAM33B                                                  CSW209
102750200529     C                   EVAL      ODDCICY = WCACY                                            CSW209
102760200529     C                   EVAL      ODDCIAM = WCAAM                                            CSW209
102770200529     C                   ENDIF                                                                CSW209
102780200529      *                                                                                       CSW209
102790200529     C                   ENDIF                                                                CSW209
102800200529      *
102810200529      ** Default in Pay Currency.
102820200529      *
102830200529     C                   MOVE      ODDSMCY       ODDPCCY
102840200529      *
102850200529      ** Set up fields for Incoming FONTIS Messages.
102860200529      *
102870200529     C     PNWRK         IFEQ      'FONTIS'
102880200529     C                   EXSR      SRFont
102890200529     C                   ENDIF
102900200529      *
102910200529      ** Decode data if feature installed.
102920200529      *
102930200529     C     CFT002        IFEQ      'Y'
102940200529      *
102950200529      ** Call ME1580 to translate the data of the messages for
102960200529      ** FT fields.
102970200529      *
102980200529     C                   CALL      'ME1580'                             0101
102990200529     C                   PARM      '*TRANS  '    PACTD
103000200529     C                   PARM                    PHEAD
103010200529     C                   PARM                    PDATA
103020200529     C                   PARM                    PDAT2                                        CSW209
103030200529     C                   PARM      *BLANKS       PRTN
103040200529      *
103050200529      ** If call to program resulted in an error, then end program.
103060200529      *
103070200529     C     PRTN          IFEQ      '*ERROR*'
103080200529     C     *IN01         OREQ      *ON
103090200529     C                   MOVEL     '*CALL'       DBKEY
103100200529     C                   MOVEL     'ME1580'      DBFILE
103110200529     C                   Z-ADD     024           DBASE
103120200529     C                   EXSR      *PSSR
103130200529     C                   ENDIF
103140200529      *
103150200529      ** If clearing, then copy.  Otherwise, map.
103160200529      *
103170200529     C                   EXSR      SRIMsg
103180200529      *
103190200529     C                   ENDIF
103200200529      *
103210200529      ** Initialise screen fields with details of the electronic
103220200529      ** message.
103230200529      *
103240200529     C                   MOVEL     CrIP1ScnFmt   NwIP1ScnFmt
103250200529     C                   MOVEL     CrIP1AScnFmt  NwIP1AScnFmt                   CFT014
103260200529     C                   MOVEL     CrIP2ScnFmt   NwIP2ScnFmt
103270200529     C                   MOVEL     CrIP3ScnFmt   NwIP3ScnFmt
103280200529     C                   MOVEL     CrIP4ScnFmt   NwIP4ScnFmt
103290200529     C                   MOVEL     CrIP4AScnFmt  NwIP4AScnFmt                   CFT014
103300200529     C                   MOVEL     CrIP5ScnFmt   NwIP5ScnFmt                    CFT014
103310200529     C                   MOVEL     CrIP6ScnFmt   NwIP6ScnFmt                    CFT014
103320200529     C                   MOVEL     CrIP6AScnFmt  NwIP6AScnFmt                                 CER030
103330200529      *                                                                                       CER030
103340200529     C                   IF        CSW209 = 'Y'                                               CSW209
103350200529     C                   MOVEL     CrIP7ScnFmt   NwIP7ScnFmt                                  CSW209
103360200529     C                   MOVEL     CrIP8ScnFmt   NwIP8ScnFmt                                  CSW209
103370200529     C                   ENDIF                                                                CSW209
103380200529      *
103390200529      *
103400200529      ** Set Reserved Electronic Message flag to 'Y'.
103410200529      *
103420200529     C                   MOVEL     'Y'           WEMSG
103430200529      *
103440200529      ** Reset Read Next Browse Subfile indicator.
103450200529      *
103460200529     C                   MOVEL     *BLANK        PRDNB
103470200529     C/COPY WNCPYSRC,FTIPAYSC20
103480200529     C
103490200529     C     EEISwft       ENDSR
103500200529      *
103510200529      *****************************************************************
103520200529      /EJECT                                                                    CFT014
103530200529      *****************************************************************         CFT014
103540200529      *                                                               *         CFT014
103550200529      *  SRCYAM33B - Retrieve the amount/currency from tag 33B.       *         CFT014
103560200529      *           or a valid SWIFT Reference                          *         CFT014
103570200529      *                                                               *         CFT014
103580200529      *****************************************************************         CFT014
103590200529      *                                                                         CFT014
103600200529     C     SRCYAM33B     BEGSR                                                  CFT014
103610200529                                                                                CFT014
103620200529      ** Inputs                                                                 CFT014
103630200529      ** ------                                                                 CFT014
103640200529      ** DS for tags  (will NOT be blanked at the end of the S/R)               CFT014
103650200529      **                                  DSTRAN                                CFT014
103660200529      ** Outputs                                                                CFT014
103670200529      ** -------                                                                CFT014
103680200529      ** Currency                                                               CFT014
103690200529     C     *LIKE         DEFINE    DDSMCY        WCACY                          CFT014
103700200529      ** Amount                                                                 CFT014
103710200529     C     *LIKE         DEFINE    DDSMAM        WCAAM                          CFT014
103720200529                                                                                CFT014
103730200529     C                   MOVEL     *Blank        WCACY                          CFT014
103740200529     C                   MOVEL     *Blank        WCAAM                          CFT014
103750200529                                                                                CFT014
103760200529      ** Currency                                                               CFT014
103770200529                                                                                CFT014
103780200529      ** Translate currency to Midas currency if it is a different                            225169
103790200529      ** SWIFT currency code.                                                                 225169
103800200529      *                                                                                       225169
103810200529     C                   MOVE      TTCCY         W_CCY                                        225169
103820200529     C                   EXSR      WTRNCY                                                     225169
103830200529     C                   MOVE      W_CCY         TTCCY                                        225169
103840200529      *                                                                                       225169
103850200529     C                   MOVEL     TTCCY         WCACY                          CFT014
103860200529                                                                                CFT014
103870200529      ** Amount                                                                 CFT014
103880200529      * Format amount field (change ',' decimal point to '.').                  CFT014
103890200529                                                                                CFT014
103900200529     C                   MOVE      *BLANKS       WYA1                           CFT014
103910200529     C                   MOVEA     TTAMT         WYA1                           CFT014
103920200529     C                   Z-ADD     1             CX                             CFT014
103930200529                                                                                CFT014
103940200529     C     CX            DOUGT     15                                           CFT014
103950200529                                                                                CFT014
103960200529     C     WYA1(CX)      IFEQ      ','                                          CFT014
103970200529     C                   MOVE      '.'           WYA1(CX)                       CFT014
103980200529     C                   Z-ADD     16            Cx                             CFT014
103990200529     C                   ELSE                                                   CFT014
104000200529     C                   ADD       1             Cx                             CFT014
104010200529     C                   ENDIF                                                  CFT014
104020200529                                                                                CFT014
104030200529     C                   ENDDO                                                  CFT014
104040200529                                                                                CFT014
104050200529     C                   MOVEA     WYA1          WAMT                           CFT014
104060200529     C                   MOVEL     WAMT          WCAAM                          CFT014
104070200529                                                                                CFT014
104080200529     C                   ENDSR                                                  CFT014
104090200529      *                                                                         CFT014
104100200529      *****************************************************************         CFT014
104110200529      /EJECT                                                                    CFT014
104120200529      *****************************************************************         CFT014
104130200529      *                                                               *         CFT014
104140200529      *  SROV32AM  - Overwrite transaction amount                     *         CFT014
104150200529      *                                                               *         CFT014
104160200529      *****************************************************************         CFT014
104170200529      *                                                                         CFT014
104180200529     C     SROV32AM      BEGSR                                                  CFT014
104190200529      *                                                                         CFT014
104200200529      ** Inputs                                                                 CFT014
104210200529      ** ------                                                                 CFT014
104220200529      ** Input amount                                                           CFT014
104230200529     C     *LIKE         DEFINE    DDSMAM        WOVIAM                         CFT014
104240200529      ** Input currency                                                         CFT014
104250200529     C     *LIKE         DEFINE    DDSMCY        WOVICY                         CFT014
104260200529      ** Receiver's Charges amount                                              CFT014
104270200529     C     *LIKE         DEFINE    DDSMAM        WOVRAM                         CFT014
104280200529      ** Receiver's Charges currency                                            CFT014
104290200529     C     *LIKE         DEFINE    DDSMCY        WOVRCY                         CFT014
104300200529      ** Operation                                                              CFT014
104310200529     C                   MOVE      WOVOPR        WOVOPR            4            CFT014
104320200529      ** Value date                                                             CFT014
104330200529     C     *LIKE         DEFINE    ZDateOut      WOVVLD                         CFT014
104340200529      *                                                                         CFT014
104350200529      ** Outputs                                                                CFT014
104360200529      ** -------                                                                CFT014
104370200529      ** Amount overwritten                                                     CFT014
104380200529     C     *LIKE         DEFINE    DDSMAM        WOVAMT                         CFT014
104390200529      *                                                                         CFT014
104400200529      ** Temporary variables                                                    CFT014
104410200529      ** -------------------                                                    CFT014
104420200529      ** Transaction amount numeric format                                      CFT014
104430200529     C     *LIKE         DEFINE    P#TOAM        WOVTAN                         CFT014
104440200529      ** Receiver's charges amount numeric format                               CFT014
104450200529     C     *LIKE         DEFINE    P#TOAM        WOVRCN                         CFT014
104460200529      *                                                                         CFT014
104470200529      ** Reset output parameters and temporary variables                        CFT014
104480200529      *                                                                         CFT014
104490200529     C                   MOVEL     *BLANK        WOVAMT                         CFT014
104500200529     C                   Z-ADD     0             WOVTAN                         CFT014
104510200529     C                   Z-ADD     0             WOVRCN                         CFT014
104520200529      *                                                                         CFT014
104530200529      ** Retrieve details of transaction currency                               CFT014
104540200529      *                                                                         CFT014
104550200529     C                   CALL      'AOCURRR0'                           8080    CFT014
104560200529     C                   PARM      *BLANKS       @RTCD                          CFT014
104570200529     C                   PARM      '*KEY   '     @OPTN                          CFT014
104580200529     C                   PARM      WOVICY        @CHR03            3            CFT014
104590200529     C     SDCURR        PARM      *BLANKS       DSSDY                          CFT014
104600200529      *                                                                         CFT014
104610200529      ** If both currencies are the same, we don't need to perform              CFT014
104620200529      ** currency conversion before doing operation on the amounts              CFT014
104630200529      *                                                                         CFT014
104640200529     C     WOVICY        IFEQ      WOVRCY                                       CFT014
104650200529      *                                                                         CFT014
104660200529     C     @RTCD         IFEQ      *BLANKS                                      CFT014
104670200529     C     *IN80         ANDEQ     *OFF                                         CFT014
104680200529     C                   Z-ADD     A6NBDP        TRNBDP            1 0          CFT014
104690200529     C                   Z-ADD     A6NBDP        RCNBDP            1 0          CFT014
104700200529     C                   ENDIF                                                  CFT014
104710200529      *                                                                         CFT014
104720200529      ** Format charges amount                                                  CFT014
104730200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
104740200529     C                   MOVEL     WOVRAM        ZFIELD                         CFT014
104750200529     C     13            SUB       RCNBDP        ZADIG                          CFT014
104760200529     C                   Z-ADD     RCNBDP        ZADEC                          CFT014
104770200529     C                   CALLB     'ZALIGN'                                     CFT014
104780200529     C                   PARM                    ZalignOK                       CFT014
104790200529     C                   PARM                    ZFIELD                         CFT014
104800200529     C                   PARM                    ZADEC                          CFT014
104810200529     C                   PARM                    ZADIG                          CFT014
104820200529     C     ZAlignOK      IFEQ      'Y'                                          CFT014
104830200529     C                   MOVE      ZFIELD        WOVRCN                         CFT014
104840200529     C                   ENDIF                                                  CFT014
104850200529      *                                                                         CFT014
104860200529      ** Format input amount                                                    CFT014
104870200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
104880200529     C                   MOVEL     WOVIAM        ZFIELD                         CFT014
104890200529     C     13            SUB       TRNBDP        ZADIG                          CFT014
104900200529     C                   Z-ADD     TRNBDP        ZADEC                          CFT014
104910200529     C                   CALLB     'ZALIGN'                                     CFT014
104920200529     C                   PARM                    ZalignOK                       CFT014
104930200529     C                   PARM                    ZFIELD                         CFT014
104940200529     C                   PARM                    ZADEC                          CFT014
104950200529     C                   PARM                    ZADIG                          CFT014
104960200529     C     ZAlignOK      IFEQ      'Y'                                          CFT014
104970200529     C                   MOVE      ZFIELD        WOVTAN                         CFT014
104980200529     C                   ENDIF                                                  CFT014
104990200529      *                                                                         CFT014
105000200529     C                   SELECT                                                 CFT014
105010200529     C                   WHEN      (WOVOPR = '*SUB')                            CFT014
105020200529      ** Final amount = Input amount - Charges amount                           CFT014
105030200529     C                   SUB       WOVRCN        WOVTAN                         CFT014
105040200529     C                   WHEN      (WOVOPR = '*ADD')                            CFT014
105050200529      ** Final amount = Input amount + Charges amount                           CFT014
105060200529     C                   ADD       WOVRCN        WOVTAN                         CFT014
105070200529     C                   ENDSL                                                  CFT014
105080200529      *                                                                         CFT014
105090200529      ** Format Final amount                                                    CFT014
105100200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
105110200529     C                   MOVE      WOVTAN        ZFIELD                         CFT014
105120200529     C                   Z-ADD     TRNBDP        ZADEC                          CFT014
105130200529     C                   CALLB     'ZEDIT'                                      CFT014
105140200529     C                   PARM                    ZFIELD                         CFT014
105150200529     C                   PARM                    ZADEC                          CFT014
105160200529     C                   MOVE      ZFIELD        WOVAMT                         CFT014
105170200529      *                                                                         CFT014
105180200529     C                   ELSE                                                   CFT014
105190200529      *                                                                         CFT014
105200200529      ** Currencies are different                                               CFT014
105210200529      *                                                                         CFT014
105220200529      ** Begin to fill parameters for FT0010 (currency conversion)              CFT014
105230200529     C                   CLEAR                   P#0010                         CFT014
105240200529     C                   MOVEL     WOVRCY        P#FRCY                         CFT014
105250200529     C                   MOVEL     WOVICY        P#TOCY                         CFT014
105260200529      *                                                                         CFT014
105270200529     C     @RTCD         IFEQ      *BLANKS                                      CFT014
105280200529     C     *IN80         ANDEQ     *OFF                                         CFT014
105290200529     C                   Z-ADD     A6NBDP        TRNBDP                         CFT014
105300200529     C                   ENDIF                                                  CFT014
105310200529     C                   Z-ADD     WOVVLD        P#FRDT                         CFT014
105320200529     C                   Z-ADD     WOVVLD        P#TODT                         CFT014
105330200529      *                                                                         CFT014
105340200529      ** Retrieve details of currency of Receiver's Charges                     CFT014
105350200529     C                   CALL      'AOCURRR0'                           8080    CFT014
105360200529     C                   PARM      *BLANKS       @RTCD                          CFT014
105370200529     C                   PARM      '*KEY   '     @OPTN                          CFT014
105380200529     C                   PARM      WOVRCY        @CHR03                         CFT014
105390200529     C     SDCURR        PARM      *BLANKS       DSSDY                          CFT014
105400200529      *                                                                         CFT014
105410200529     C     @RTCD         IFEQ      *BLANKS                                      CFT014
105420200529     C     *IN80         ANDEQ     *OFF                                         CFT014
105430200529     C                   Z-ADD     A6NBDP        RCNBDP                         CFT014
105440200529      ** Format charges amount                                                  CFT014
105450200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
105460200529     C                   MOVEL     WOVRAM        ZFIELD                         CFT014
105470200529     C     13            SUB       RCNBDP        ZADIG                          CFT014
105480200529     C                   Z-ADD     RCNBDP        ZADEC                          CFT014
105490200529     C                   CALLB     'ZALIGN'                                     CFT014
105500200529     C                   PARM                    ZalignOK                       CFT014
105510200529     C                   PARM                    ZFIELD                         CFT014
105520200529     C                   PARM                    ZADEC                          CFT014
105530200529     C                   PARM                    ZADIG                          CFT014
105540200529     C     ZAlignOK      IFEQ      'Y'                                          CFT014
105550200529     C                   MOVE      ZFIELD        P#FRAM                         CFT014
105560200529     C                   ENDIF                                                  CFT014
105570200529      ** Convert the :71G: amount into the :32A: currency                       CFT014
105580200529     C                   CALL      'FT0010'                                     CFT014
105590200529     C                   PARM                    P#0010                         CFT014
105600200529     C     P#RTCD        IFNE      *BLANK                                       CFT014
105610200529     C                   MOVEL     'FT0010 '     DBFILE                         CFT014
105620200529     C                   MOVEL     '*CALL  '     DBKEY                          CFT014
105630200529     C                   Z-ADD     34            DBASE                          CFT014
105640200529     C                   EXSR      *PSSR                                        CFT014
105650200529     C                   ELSE                                                   CFT014
105660200529     C                   Z-ADD     P#TOAM        WOVRCN           13 0          CFT014
105670200529      ** Format input amount                                                    CFT014
105680200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
105690200529     C                   MOVEL     WOVIAM        ZFIELD                         CFT014
105700200529     C     13            SUB       TRNBDP        ZADIG                          CFT014
105710200529     C                   Z-ADD     TRNBDP        ZADEC                          CFT014
105720200529     C                   CALLB     'ZALIGN'                                     CFT014
105730200529     C                   PARM                    ZalignOK                       CFT014
105740200529     C                   PARM                    ZFIELD                         CFT014
105750200529     C                   PARM                    ZADEC                          CFT014
105760200529     C                   PARM                    ZADIG                          CFT014
105770200529     C     ZAlignOK      IFEQ      'Y'                                          CFT014
105780200529     C                   MOVE      ZFIELD        WOVTAN           13 0          CFT014
105790200529     C                   ENDIF                                                  CFT014
105800200529      *                                                                         CFT014
105810200529     C                   SELECT                                                 CFT014
105820200529     C                   WHEN      (WOVOPR = '*SUB')                            CFT014
105830200529      ** Final amount = Input amount - Charges amount                           CFT014
105840200529     C                   SUB       WOVRCN        WOVTAN                         CFT014
105850200529     C                   WHEN      (WOVOPR = '*ADD')                            CFT014
105860200529      ** Final amount = Input amount + Charges amount                           CFT014
105870200529     C                   ADD       WOVRCN        WOVTAN                         CFT014
105880200529     C                   ENDSL                                                  CFT014
105890200529      *                                                                         CFT014
105900200529      ** Format Final amount                                                    CFT014
105910200529     C                   MOVEL     *BLANK        ZFIELD                         CFT014
105920200529     C                   MOVE      WOVTAN        ZFIELD                         CFT014
105930200529     C                   Z-ADD     TRNBDP        ZADEC                          CFT014
105940200529     C                   CALLB     'ZEDIT'                                      CFT014
105950200529     C                   PARM                    ZFIELD                         CFT014
105960200529     C                   PARM                    ZADEC                          CFT014
105970200529     C                   MOVE      ZFIELD        WOVAMT                         CFT014
105980200529     C                   ENDIF                                                  CFT014
105990200529      *                                                                         CFT014
106000200529     C                   ENDIF                                                  CFT014
106010200529      *                                                                         CFT014
106020200529     C                   ENDIF                                                  CFT014
106030200529      *                                                                         CFT014
106040200529      ** Reset input parameters                                                 CFT014
106050200529      *                                                                         CFT014
106060200529     C                   MOVEL     *BLANK        WOVIAM                         CFT014
106070200529     C                   MOVEL     *BLANK        WOVICY                         CFT014
106080200529     C                   MOVEL     *BLANK        WOVRAM                         CFT014
106090200529     C                   MOVEL     *BLANK        WOVRCY                         CFT014
106100200529     C                   MOVEL     *BLANK        WOVOPR                         CFT014
106110200529     C                   Z-ADD     0             WOVVLD                         CFT014
106120200529                                                                                CFT014
106130200529     C                   ENDSR                                                  CFT014
106140200529      *                                                                         CFT014
106150200529      *****************************************************************         CFT014
106160200529      /EJECT                                                                    CFT014
106170200529      *****************************************************************         CFT014
106180200529      *                                                               *         CFT014
106190200529      *  SRRATE36  - Retrieve rate from tag 36                        *         CFT014
106200200529      *                                                               *         CFT014
106210200529      *****************************************************************         CFT014
106220200529      *                                                                         CFT014
106230200529     C     SRRATE36      BEGSR                                                  CFT014
106240200529      *                                                                         CFT014
106250200529      ** Inputs                                                                 CFT014
106260200529      ** ------                                                                 CFT014
106270200529      ** Code work lines                                                        CFT014
106280200529      **                                  DSTRAN                                CFT014
106290200529      ** Outputs                                                                CFT014
106300200529      ** -------                                                                CFT014
106310200529      ** Rate                                                                   CFT014
106320200529     C     *LIKE         DEFINE    DDOEXR        W36RT                          CFT014
106330200529      ** Decimal Position Truncated                                             CFT014
106340200529     C     *LIKE         DEFINE    A6NBDP        W36DPT                         CFT014
106350200529      ** Decimal Position                                                       CFT014
106360200529     C     *LIKE         DEFINE    A6NBDP        W36DP            +1            CFT014
106370200529      *                                                                         CFT014
106380200529     C                   MOVEL     *BLANK        W36RT                          CFT014
106390200529     C                   Z-ADD     0             W36DPT                         CFT014
106400200529     C                   Z-ADD     0             W36DP                          CFT014
106410200529      *                                                                         CFT014
106420200529      ** Map Rate                                                               CFT014
106430200529      ** Move possible 12 chars to work array and work string                   CFT014
106440200529      *                                                                         CFT014
106450200529     C     12            SUBST     TMLIN1:1      @R               13            CFT014
106460200529     C                   MOVEA     @R            W@R1                           CFT014
106470200529     C                   CLEAR                   @R                             CFT014
106480200529      *                                                                         CFT014
106490200529      ** If ',' in rate string @R change to '.'                                 CFT014
106500200529      ** Only need to check valid chars till one ',' found                      CFT014
106510200529     C                   Z-ADD     1             @C                3 0          CFT014
106520200529     C                   MOVE      *BLANK        @T                1            CFT014
106530200529      *                                                                         CFT014
106540200529     C     1             DO        12            @C                             CFT014
106550200529      *                                                                         CFT014
106560200529     C     W@R1(@C)      IFEQ      ','                                           CFT014
106570200529     C                   MOVE      '.'           W@R1(@C)                        CFT014
106580200529      ** Retrieve the number of decimal position                                CFT014
106590200529     C     W@CHK         CHECK     WWR1          @F                3 0           CFT014
106600200529     C     @F            IFNE      0                                            CFT014
106610200529     C     @F            SUB       1             @F                             CFT014
106620200529     C     @F            SUB       @C            W36DP                          CFT014
106630200529     C                   ELSE                                                   CFT014
106640200529     C     12            SUB       @C            W36DP                          CFT014
106650200529     C                   ENDIF                                                  CFT014
106660200529      ** Decimal position can be handled only on one 1 digit                    CFT014
106670200529      ** => range 0-9  (otherwise truncated to 9)                               CFT014
106680200529     C     W36DP         IFGT      9                                            CFT014
106690200529     C                   Z-ADD     9             W36DPT                         CFT014
106700200529     C                   ELSE                                                   CFT014
106710200529     C                   Z-ADD     W36DP         W36DPT                         CFT014
106720200529     C                   ENDIF                                                  CFT014
106730200529      *                                                                         CFT014
106740200529     C                   LEAVE                                                  CFT014
106750200529     C                   ENDIF                                                  CFT014
106760200529      *                                                                         CFT014
106770200529     C                   ENDDO                                                  CFT014
106780200529      *                                                                         CFT014
106790200529     C                   Z-ADD     1             @C                             CFT014
106800200529     C                   MOVE      *BLANKS       @T                1            CFT014
106810200529     C                   MOVEA     W@R1          @R                              CFT014
106820200529      *                                                                         CFT014
106830200529      ** Get amount - upto 12 chars possible                                    CFT014
106840200529      *                                                                         CFT014
106850200529     C     @C            DOUGT     12                                           CFT014
106860200529      *                                                                         CFT014
106870200529     C                   MOVE      W@R1(@C)      @T                              CFT014
106880200529     C     W@CHK         CHECK     @T            @F                       82    CFT014
106890200529      *                                                                         CFT014
106900200529      ** Char not valid must be end of rate                                     CFT014
106910200529     C     *IN82         IFEQ      *ON                                          CFT014
106920200529     C     @C            IFNE      1                                            CFT014
106930200529     C     @C            SUB       1             @F                             CFT014
106940200529     C     @F            SUBST     @R:1          W36RT                          CFT014
106950200529     C                   ENDIF                                                  CFT014
106960200529     C                   LEAVE                                                  CFT014
106970200529     C                   ENDIF                                                  CFT014
106980200529      *                                                                         CFT014
106990200529      ** All chars in string are ok                                             CFT014
107000200529     C     @C            IFEQ      12                                           CFT014
107010200529     C                   MOVEL     @R            W36RT                          CFT014
107020200529     C                   ENDIF                                                  CFT014
107030200529      *                                                                         CFT014
107040200529     C                   ADD       1             @C                             CFT014
107050200529      *                                                                         CFT014
107060200529     C                   ENDDO                                                  CFT014
107070200529      *                                                                         CFT014
107080200529     C                   ENDSR                                                  CFT014
107090200529      *                                                                         CFT014
107100200529      *****************************************************************         CFT014
107110200529      /EJECT
107120200529      *****************************************************************
107130200529      *                                                               *
107140200529      *  SRMKey - To determine if the SWIFT Reference holds a '?'     *
107150200529      *           or a valid SWIFT Reference                          *
107160200529      *                                                               *
107170200529      *****************************************************************
107180200529      *
107190200529     C     SRMKey        BEGSR
107200200529      *
107210200529      ** Set up part number parameter.
107220200529      *
107230200529     C                   MOVEL     DDSEQNO       WSEQNO            2 0
107240200529      *
107250200529     C     WSEQNO        IFEQ      0
107260200529     C                   Z-ADD     1             PKPRT
107270200529     C                   ELSE
107280200529     C                   Z-ADD     WSEQNO        PKPRT
107290200529     C                   ENDIF
107300200529      *
107310200529      ** The SWIFT Reference may hold either a '?' or an actual SWIFT
107320200529      ** Reference.  The called program will determine which.
107330200529      *
107340200529     C                   CALL      'ME1080'                             0101
107350200529     C                   PARM      '*KEY   '     PACT              7
107360200529     C     PHMSGR        PARM      *ZEROS        PMSGR             8 0
107370200529     C     PHPART        PARM                    PKPRT             3 0
107380200529     C     PHMOR         PARM      DDSWTN        PMOR             28
107390200529     C     PHMIR         PARM      DDSWTN        PMIR             28
107400200529     C                   PARM      *BLANKS       PRTN              7
107410200529      *
107420200529      ** If call to program resulted in an error, then end program.
107430200529      *
107440200529     C     PRTN          IFEQ      '*ERROR*'
107450200529     C     *IN01         OREQ      *ON
107460200529     C                   MOVEL     '*CALL'       DBKEY
107470200529     C                   MOVEL     'ME1080'      DBFILE
107480200529     C                   Z-ADD     025           DBASE
107490200529     C                   EXSR      *PSSR
107500200529     C                   ENDIF
107510200529      *
107520200529      ** F3 - end program.
107530200529      *
107540200529     C     PRTN          IFEQ      'Y2U9999'
107550200529     C                   MOVEL     'Y'           WErr
107560200529     C                   EXSR      SREndP
107570200529     C                   GOTO      EMKey
107580200529     C                   ENDIF
107590200529      *
107600200529      ** F12 - cancel.  Redisplay Initial screen.
107610200529      *
107620200529     C     PRTN          IFEQ      'USR0790'
107630200529     C                   MOVEL     'Y'           WErr
107640200529     C                   MOVEL     'MIN0001'     PErrMs
107650200529     C                   EXSR      SRSndM
107660200529     C                   GOTO      EMKey
107670200529     C                   ENDIF
107680200529      *
107690200529      ** MIN0105 - Reserved message found.
107700200529      *
107710200529      ** If there is an electronic message for the current job, then
107720200529      ** prepare input fields for processing.  Messages that are
107730200529      ** selected using the '?' facility are reserved at time of
107740200529      ** selection.
107750200529      *
107760200529     C     PRTN          IFEQ      'MIN0105'
107770200529     C                   MOVEL     'Y'           WEMSG
107780200529     C                   MOVEL     PMIR          DDSWTN
107790200529     C                   GOTO      EMKey
107800200529     C                   ENDIF
107810200529      *
107820200529      ** MIN0106 - No reserved messages to process.
107830200529      *
107840200529      ** If there is no electronic message for the current job, then
107850200529      ** clear the SWIFT Reference field and set on error indicator.
107860200529      ** On return to SREISwft, control will return immediately
107870200529      ** to Initial screen processing.
107880200529      *
107890200529     C     PRTN          IFEQ      'MIN0106'
107900200529     C                   MOVEL     'Y'           WErr
107910200529     C                   MOVEL     'MIN0106'     PErrMs
107920200529     C                   EXSR      SRSndM
107930200529     C                   MOVEL     *BLANKS       DDSWTN
107940200529     C                   GOTO      EMKey
107950200529     C                   ENDIF
107960200529      *
107970200529      ** Message may not be processed by FT.
107980200529      *
107990200529     C     PRTN          IFEQ      'MIN0197'
108000200529     C                   MOVEL     'Y'           WErr
108010200529     C                   MOVEL     'MIN0197'     PErrMs
108020200529     C                   EXSR      SRSndM
108030200529     C                   MOVEL     *BLANKS       DDSWTN
108040200529     C                   GOTO      EMKey
108050200529     C                   ENDIF
108060200529      *
108070200529      ** A SWIFT Reference was entered.
108080200529      *
108090200529      ** If any errors are detected, an error indicator is set on,
108100200529      ** control returns to SREISwft and from there, returns
108110200529      ** immediately to Initial screen processing.
108120200529      *
108130200529      ** MIN0101 - SWIFT Reference not found or invalid.
108140200529      *
108150200529     C     PRTN          IFEQ      'MIN0101'
108160200529     C                   MOVEL     'Y'           WErr
108170200529     C                   MOVEL     'MIN0101'     PErrMs
108180200529     C                   MOVE      'N'           OKSWTN
108190200529     C                   EXSR      SRSndM
108200200529     C                   GOTO      EMKey
108210200529     C                   ENDIF
108220200529      *
108230200529      ** MIN0100 - Message part does not exist or has already been
108240200529      ** processed by Funds Transfer.
108250200529      *
108260200529     C     PRTN          IFEQ      'MIN0100'
108270200529     C                   MOVEL     'Y'           WErr
108280200529     C                   MOVEL     'MIN0100'     PErrMs
108290200529     C                   MOVE      'N'           OKSWTN
108300200529     C                   EXSR      SRSndM
108310200529     C                   GOTO      EMKey
108320200529     C                   ENDIF
108330200529      *
108340200529      ** MIN0103 - SWIFT Reference already reserved for this job.
108350200529      *
108360200529     C     PRTN          IFEQ      'MIN0103'
108370200529     C                   MOVEL     'Y'           WErr
108380200529     C                   MOVEL     'MIN0103'     PErrMs
108390200529     C                   MOVE      'N'           OKSWTN
108400200529     C                   EXSR      SRSndM
108410200529     C                   GOTO      EMKey
108420200529     C                   ENDIF
108430200529      *
108440200529      ** MIN0104 - SWIFT Reference reserved for another job.
108450200529      *
108460200529     C     PRTN          IFEQ      'MIN0104'
108470200529     C                   MOVEL     'Y'           WErr
108480200529     C                   MOVEL     'MIN0104'     PErrMs
108490200529     C                   MOVE      'N'           OKSWTN
108500200529     C                   EXSR      SRSndM
108510200529     C                   GOTO      EMKey
108520200529     C                   ENDIF
108530200529      *
108540200529      ** MIN0112 - Valid SWIFT Reference found - not yet reserved.
108550200529      *
108560200529      ** If the SWIFT Reference is valid and available for use, then
108570200529      ** a reservation on the Reserved Messages file will be made after
108580200529      ** further validation in SREISwft.
108590200529      *
108600200529      ** Messages that are selected using the '?' facility are reserved
108610200529      ** at time of selection.
108620200529      *
108630200529     C     PRTN          IFEQ      'MIN0112'
108640200529     C                   MOVEL     'MIN0112'     PErrMs
108650200529     C                   EXSR      SRSndM
108660200529     C                   ENDIF
108670200529      *
108680200529     C     EMKey         ENDSR
108690200529      *
108700200529      *****************************************************************
108710200529      /EJECT
108720200529      *****************************************************************
108730200529      *                                                               *
108740200529      *  SRMsgRsv - To reserve a selected/entered electronic message  *
108750200529      *             for use by the current job only                   *
108760200529      *                                                               *
108770200529      *****************************************************************
108780200529      *
108790200529     C     SRMsgRsv      BEGSR
108800200529      *
108810200529      ** The SWIFT Reference must be written to the reserved messages
108820200529      ** file to prevent other workstations accessing it for update.
108830200529      *
108840200529     C                   CALL      'ME1070'                             0101
108850200529     C                   PARM      '*RESERV'     PACT
108860200529     C                   PARM                    PMSGR
108870200529     C                   PARM                    PKPRT
108880200529     C                   PARM                    PMOR
108890200529     C                   PARM                    PMIR
108900200529     C                   PARM      *BLANKS       PRTN
108910200529      *
108920200529      ** If call to program resulted in an error, then end program.
108930200529      *
108940200529     C     PRTN          IFEQ      '*ERROR*'
108950200529     C     *IN01         OREQ      *ON
108960200529     C                   MOVEL     '*CALL'       DBKEY
108970200529     C                   MOVEL     'ME1070'      DBFILE
108980200529     C                   Z-ADD     026           DBASE
108990200529     C                   EXSR      *PSSR
109000200529     C                   ENDIF
109010200529      *
109020200529      ** If any errors are detected, an error indicator is set on,
109030200529      ** control returns to SREISwft and from there, returns
109040200529      ** to Initial screen processing.
109050200529      *
109060200529      ** MIN0107 - Message previously reserved for this job.
109070200529      *
109080200529     C     PRTN          IFEQ      'MIN0107'
109090200529     C                   MOVEL     'Y'           WErr
109100200529     C                   MOVEL     'MIN0107'     PErrMs
109110200529     C                   MOVE      'N'           OKSWTN
109120200529     C                   EXSR      SRSndM
109130200529     C                   GOTO      EMsgRsv
109140200529     C                   ENDIF
109150200529      *
109160200529      ** MIN0108 - Message already reserved for another job.
109170200529      *
109180200529     C     PRTN          IFEQ      'MIN0108'
109190200529     C                   MOVEL     'Y'           WErr
109200200529     C                   MOVEL     'MIN0108'     PErrMs
109210200529     C                   MOVE      'N'           OKSWTN
109220200529     C                   EXSR      SRSndM
109230200529     C                   GOTO      EMsgRsv
109240200529     C                   ENDIF
109250200529      *
109260200529      ** If the SWIFT Reference is valid and available for use, then
109270200529      ** a reservation on the Reserved Messages file was made.
109280200529      *
109290200529      ** MIN0109 - Message is now reserved for this job.
109300200529      *
109310200529     C     PRTN          IFEQ      'MIN0109'
109320200529     C                   MOVEL     'MIN0109'     PErrMs
109330200529     C                   EXSR      SRSndM
109340200529      **                                                                                      CSC022
109350200529      ** Execute commit if SAR CSC022 is not enrolled or                                      CSC022
109360200529      **   job is not currently running in batch mode                                         CSC022
109370200529      **                                                                                      CSC022
109380200529     C                   If        CSC022 = 'N'                                               CSC022
109390200529     C                             Or (CSC022 = 'Y' and WSkpComtRolbk = 'N')                  CSC022
109400200529     C                   COMMIT
109410200529     C                   EndIf                                                                CSC022
109420200529     C                   ENDIF
109430200529      *
109440200529     C     EMsgRsv       ENDSR
109450200529      *
109460200529      *****************************************************************
109470200529      /EJECT
109480200529      *****************************************************************
109490200529      *                                                               *
109500200529      *  SRFOCmt2 - Extraction of field 72 from SWIFT Message         *
109510200529      *                                                               *
109520200529      *****************************************************************
109530200529      *
109540200529     C     SRFOCmt2      BEGSR
109550200529      *
109560200529      ** Initialise working fields for FONTIS.
109570200529      *
109580200529     C                   MOVE      *BLANKS       WCWCY             3
109590200529     C                   MOVE      *BLANKS       WCWAM            14
109600200529      *
109610200529      ** Retrieve Notified Delivery Currency and Amount.
109620200529      *
109630200529     C                   MOVEL     '012345'      WCHK             11
109640200529     C                   MOVE      '6789.'       WCHK
109650200529      *
109660200529     C     WCW           SCAN      WCWLIN:1      WF                3 0    01
109670200529      *
109680200529     C     *IN01         IFEQ      *ON
109690200529      *
109700200529      ** Map Currency Code -> ODDNDCY.
109710200529      *
109720200529     C                   ADD       6             WF
109730200529     C     3             SUBST     WCWLIN:WF     WCWCY
109740200529      *
109750200529      ** Translate currency to Midas currency if it is a different                            225169
109760200529      ** SWIFT currency code.                                                                 225169
109770200529      *                                                                                       225169
109780200529     C                   MOVE      WCWCY         W_CCY                                        225169
109790200529     C                   EXSR      WTRNCY                                                     225169
109800200529     C                   MOVE      W_CCY         WCWCY                                        225169
109810200529      *                                                                                       225169
109820200529      ** Map Amount -> ODDNDAM.
109830200529      *
109840200529      ** Move possible 15 chars to work array and work string.
109850200529      *
109860200529     C                   ADD       3             WF
109870200529     C     15            SUBST     WCWLIN:WF     WS               15
109880200529     C                   MOVEA     WS            WA
109890200529     C                   CLEAR                   WS
109900200529      *
109910200529      ** If ',' in amount string WS, change to '.'.
109920200529      ** Only need to check valid chars till one ',' found.
109930200529      *
109940200529     C                   Z-ADD     1             WC                3 0
109950200529     C                   MOVE      *BLANKS       WT                1
109960200529      *
109970200529     C     1             DO        15            WC
109980200529     C                   MOVE      WA(WC)        WT
109990200529     C     WT            IFEQ      ','
110000200529     C                   MOVE      '.'           WA(WC)
110010200529     C                   LEAVE
110020200529     C                   ENDIF
110030200529     C                   ENDDO
110040200529      *
110050200529     C                   Z-ADD     1             WC
110060200529     C                   MOVE      *BLANKS       WT                1
110070200529     C                   MOVEA     WA            WS
110080200529      *
110090200529      ** Get Amount - up to 15 chars possible.
110100200529      *
110110200529     C     WC            DOUGT     15
110120200529      *
110130200529     C                   MOVE      WA(WC)        WT
110140200529     C     WCHK          CHECK     WT            WF                       01
110150200529      *
110160200529      ** Char not valid, must be end of Amount.
110170200529      *
110180200529     C     *IN01         IFEQ      *ON
110190200529     C     WC            IFNE      1
110200200529     C     WC            SUB       1             WF
110210200529     C     WF            SUBST     WS:1          WCWAM
110220200529     C                   ENDIF
110230200529     C                   LEAVE
110240200529     C                   ENDIF
110250200529      *
110260200529      ** All chars in string ok.
110270200529      *
110280200529     C     WC            IFEQ      15
110290200529     C                   MOVEL     WS            WCWAM
110300200529     C                   ENDIF
110310200529      *
110320200529     C                   ADD       1             WC
110330200529      *
110340200529     C                   ENDDO
110350200529      *
110360200529     C                   ENDIF
110370200529      *
110380200529      ** Reset variables.
110390200529      *
110400200529     C                   MOVEL     *BLANKS       WCWLIN          256
110410200529     C                   MOVEL     *BLANKS       WCW               6
110420200529      *
110430200529     C                   ENDSR
110440200529      *
110450200529      *****************************************************************
110460200529      /EJECT
110470200529      *****************************************************************
110480200529      *                                                               *
110490200529      *  SRFont - Map translated data for Incoming FONTIS Messages    *
110500200529      *                                                               *
110510200529      *****************************************************************
110520200529      *
110530200529     C     SRFont        BEGSR
110540200529      *
110550200529      ** Set up defaults for FONTIS.
110560200529      *
110570200529     C                   MOVE      'N'           ODDSWPC
110580200529     C                   MOVE      *BLANKS       ODDACBK
110590200529     C                   MOVE      *BLANKS       ODDACBB
110600200529      *
110610200529      ** Retrieve Electronic Banking ICD details.
110620200529      *
110630200529     C                   CALL      'AOFONTR0'
110640200529     C                   PARM      *BLANKS       PRTCD
110650200529     C                   PARM      '*FIRST'      POPTN
110660200529     C     SDFONT        PARM      SDFONT        DSFDY
110670200529      *
110680200529     C     PRTCD         IFNE      *BLANKS
110690200529     C                   MOVEL     '*FIRST'      DBKEY
110700200529     C                   MOVEL     'SDFONTPD'    DBFILE
110710200529     C                   Z-ADD     027           DBASE
110720200529     C                   EXSR      *PSSR
110730200529     C                   ENDIF
110740200529      *
110750200529     C                   MOVE      F8IPST        ODDPYST
110760200529     C                   MOVE      F8TBKC        ODDBOKC
110770200529      *
110780200529      ** Related Reference.
110790200529      *
110800200529     C     P20           IFNE      *BLANKS
110810200529     C                   MOVEL     P20           DSTRAN
110820200529     C                   MOVEL     TTREF         IPRLPR
110830200529     C                   MOVEL     TTREF         ODDRLPR
110840200529     C                   ELSE
110850200529     C                   MOVEL     *BLANKS       IPRLPR
110860200529     C                   MOVEL     *BLANKS       ODDRLPR
110870200529     C                   ENDIF
110880200529      *
110890200529      ** Pay Currency/Value Date/Amount.
110900200529      *
110910200529     C     PDCA          IFNE      *BLANKS
110920200529      *
110930200529     C                   MOVEL     PDCA          DSTRAN
110940200529      *
110950200529      ** Pay Currency.
110960200529      *
110970200529     C                   MOVEL     TVCCY         ODDPCCY
110980200529      *
110990200529      ** Pay Amount.
111000200529      *
111010200529      ** Format amount field (change ',' decimal point to '.').
111020200529      *
111030200529     C                   MOVEA     *BLANKS       WYA1
111040200529     C                   MOVEA     TVAMT         WYA1
111050200529     C                   Z-ADD     1             Cx
111060200529      *
111070200529     C     Cx            DOUGT     15
111080200529     C     WYA1(Cx)      IFEQ      ','
111090200529     C                   MOVE      '.'           WYA1(Cx)
111100200529     C                   Z-ADD     16            Cx
111110200529     C                   ELSE
111120200529     C                   ADD       1             Cx
111130200529     C                   ENDIF
111140200529     C                   ENDDO
111150200529      *
111160200529     C                   MOVEA     WYA1          WNLAM
111170200529     C                   MOVEA     WYA1          WWPYAM           14
111180200529      *
111190200529     C                   EXSR      SRNull
111200200529      *
111210200529     C     WNLNUL        IFEQ      'N'
111220200529     C                   MOVEL     WWPYAM        ODDPYAM
111230200529     C                   ELSE
111240200529     C                   MOVEL     *BLANKS       ODDPYAM
111250200529     C                   ENDIF
111260200529      *
111270200529      ** Pay Value Date.
111280200529      *
111290200529     C                   MOVEL     TVVDAT        WWDT
111300200529      *
111310200529      ** MMDDYY format display.
111320200529      *
111330200529     C     BJDFIN        IFEQ      'M'
111340200529      *
111350200529     C                   EVAL      ODDPYDT = WD2 + WD3 + WD1
111360200529      *
111370200529     C                   ELSE
111380200529      *
111390200529      ** DDMMYY format display.
111400200529      *
111410200529     C                   EVAL      ODDPYDT = WD3 + WD2 + WD1
111420200529      *
111430200529     C                   ENDIF
111440200529      *
111450200529     C                   CALLB     'ZDATE1'
111460200529     C                   PARM      ODDPYDT       PDateIn           6
111470200529     C                   PARM      *ZERO         PDaynoOut         5 0
111480200529     C                   PARM      BJDFIN        PDateFmt          1
111490200529     C                   PARM                    PError            1
111500200529      *
111510200529     C     PError        IFNE      'Y'
111520200529     C                   Z-ADD     PDaynoOut     WVLDT
111530200529     C                   ELSE
111540200529     C                   Z-ADD     BJRDNB        WVLDT             5 0
111550200529     C                   ENDIF
111560200529      *
111570200529     C                   ENDIF
111580200529      *
111590200529      ** Debit Account.
111600200529      *
111610200529     C     P53           IFNE      *BLANKS
111620200529      *
111630200529     C                   MOVE      *BLANKS       WWP53P           35
111640200529     C                   MOVEL     P53           DSTRAN
111650200529     C                   MOVEL     TMLIN1        WWP53
111660200529      *
111670200529     C     WWP53A        IFEQ      '/'
111680200529     C                   MOVEL     WWP53B        WWP53P
111690200529     C                   ENDIF
111700200529      *
111710200529     C                   MOVEL     *BLANKS       ODDSND2
111720200529     C                   MOVEL     *BLANKS       ODDSND3
111730200529     C                   MOVEL     *BLANKS       ODDSND4
111740200529      *
111750200529     C     ' '           CHECKR    WWP53P        WWLEN             2 0
111760200529      *
111770200529      ** Check if it is a Retail Account.
111780200529      *
111790200529     C     WWLEN         IFEQ      10
111800200529      *
111810200529     C                   MOVEL     WWP53P        PPRETL
111820200529     C                   MOVEL     *BLANKS       PPCNUM
111830200529     C                   MOVEL     *BLANKS       PPCUCD
111840200529     C                   MOVEL     *BLANKS       PPACCD
111850200529     C                   MOVEL     *BLANKS       PPACSQ
111860200529     C                   MOVEL     *BLANKS       PPBRCA
111870200529      *
111880200529     C                   ELSE
111890200529      *
111900200529      ** Account is not Retail but General Ledger.
111910200529      *
111920200529     C                   MOVEL     *BLANKS       PPRETL
111930200529     C     3             SUBST     WWP53P:1      PPBRCA
111940200529     C     6             SUBST     WWP53P:4      PPCNUM
111950200529     C     3             SUBST     WWP53P:10     PPCUCD
111960200529     C     10            SUBST     WWP53P:13     PPACCD                                       CGL029
111970200529     C     2             SUBST     WWP53P:23     PPACSQ                                       CGL029
111980200529     C*****4****         SUBST     WWP53P:13     PPACCD                                       CGL029
111990200529     C*****2****         SUBST     WWP53P:17     PPACSQ                                       CGL029
112000200529      *
112010200529     C                   ENDIF
112020200529      *
112030200529      ** Access Account Details.
112040200529      *
112050200529     C                   CALLB     'AOACCTR0'
112060200529     C                   PARM      *BLANKS       PPRTCD            7
112070200529     C                   PARM      '*KEY   '     PPOPTN            7
112080200529     C                   PARM                    PPRETL           10
112090200529     C                   PARM                    PPCNUM            6
112100200529     C                   PARM                    PPCUCD            3
112110200529     C**********         PARM                    PPACCD            4                          CGL029
112120200529     C                   PARM                    PPACCD                                       CGL029
112130200529     C                   PARM                    PPACSQ            2
112140200529     C                   PARM                    PPBRCA            3
112150200529     C     SDACCT        PARM      SDACCT        DSSDY
112160200529
112170200529     C                   IF        PRTCD = *BLANKS
112180200529      *
112190200529      ** If it is a G/L Account, we put the Branch as the end
112200200529      ** (BRCA/CUST/CCY/ACOD/SEQ) => (CUST/CCY/ACOD/SEQ/BRCA).
112210200529      ** If it is a Retail one, we don't format it.
112220200529      *
112230200529     C     WWLEN         IFEQ      10
112240200529     C                   MOVEL     WWP53P        ODDSND1
112250200529     C                   ELSE
112260200529     C     3             SUBST     WWP53P:1      WGLBCH
112270200529     C     3             SUBST     WWP53P:10     WGLCCY
112280200529     C     6             SUBST     WWP53P:4      WGLCST
112290200529     C     10            SUBST     WWP53P:13     WGLACD                                       CGL029
112300200529     C     2             SUBST     WWP53P:23     WGLSQN                                       CGL029
112310200529     C*****4****         SUBST     WWP53P:13     WGLACD                                       CGL029
112320200529     C*****2****         SUBST     WWP53P:17     WGLSQN                                       CGL029
112330200529     C                   MOVEL     WDSGLDG       ODDSND1
112340200529     C                   ENDIF
112350200529      *
112360200529     C                   MOVEL     IFBRCA        ODDBRCA
112370200529     C                   MOVEL     IFBRCA        ODDORBR
112380200529
112390200529     C                   ELSE
112400200529      *
112410200529      ** If no valid account in tag 53 we concatenate line of
112420200529      ** 53 (A/C debited)  + first lines of 50 (Ord Cust)
112430200529     C                   MOVEL     WWP53P        ODDSND1
112440200529     C                   MOVEL     P50           DSTRAN
112450200529     C                   MOVEL     TMLIN1        ODDSND2
112460200529     C                   MOVEL     TMLIN2        ODDSND3
112470200529     C                   MOVEL     TMLIN3        ODDSND4
112480200529      *
112490200529     C                   ENDIF
112500200529      *
112510200529     C                   ENDIF
112520200529      *
112530200529      ** Profit Centre.
112540200529      *
112550200529     C     BKPRCU        IFEQ      'Y'
112560200529      *
112570200529      ** Retrieve default Profit Centre.
112580200529      *
112590200529     C     BKPCDU        IFEQ      'Y'
112600200529      *
112610200529     C                   CALLB     'AOPRFMR0'                           01
112620200529     C                   PARM      *BLANKS       PRTCD
112630200529     C                   PARM      ODDBOKC       PBOKC             2
112640200529     C                   PARM      PPYTP         PTRTP             5
112650200529     C                   PARM      ODDPYST       PSUTP             2
112660200529     C                   PARM      ODDBRCA       PBRAN             3
112670200529     C                   PARM      *BLANKS       PDEPT             3
112680200529     C                   PARM      *BLANKS       PUSER            10
112690200529     C                   PARM      *BLANKS       PACOF             2
112700200529     C                   PARM      *BLANKS       PCUST             6
112710200529     C     ODDPRFC       PARM      *BLANKS       PPRFC             4
112720200529      *
112730200529     C                   IF        *In01 = *On
112740200529     C                   MOVEL     '*CALL'       DBKEY
112750200529     C                   MOVEL     'AOPRFMR0'    DBFILE
112760200529     C                   Z-ADD     028           DBASE
112770200529     C                   EXSR      *PSSR
112780200529     C                   ENDIF
112790200529      *
112800200529     C                   ENDIF
112810200529      *
112820200529     C     ODDPRFC       IFEQ      *BLANKS
112830200529     C                   MOVEL     F8TPFC        ODDPRFC
112840200529     C                   ENDIF
112850200529      *
112860200529     C                   ENDIF
112870200529      *
112880200529      ** Beneficiary Customer.
112890200529      *
112900200529     C     P59           IFNE      *BLANKS
112910200529      *
112920200529     C                   MOVE      *BLANKS       WWP59P           35
112930200529     C                   MOVEL     P59           DSTRAN
112940200529     C                   MOVEL     TMLIN1        WWP59
112950200529      *
112960200529     C     WWP59A        IFEQ      '/'
112970200529     C                   MOVEL     WWP59B        WWP59P
112980200529     C                   ENDIF
112990200529      *
113000200529     C     ' '           CHECKR    WWP59P        WWLEN
113010200529      *
113020200529      ** Check if it is a Retail Account.
113030200529      *
113040200529     C     WWLEN         IFEQ      10
113050200529      *
113060200529     C                   MOVEL     WWP59P        PPRETL
113070200529     C                   MOVEL     *BLANKS       PPCNUM
113080200529     C                   MOVEL     *BLANKS       PPCUCD
113090200529     C                   MOVEL     *BLANKS       PPACCD
113100200529     C                   MOVEL     *BLANKS       PPACSQ
113110200529     C                   MOVEL     *BLANKS       PPBRCA
113120200529      *
113130200529     C                   ELSE
113140200529      *
113150200529      ** Account is not Retail but General Ledger.
113160200529      *
113170200529     C                   MOVEL     *BLANKS       PPRETL
113180200529     C     3             SUBST     WWP59P:1      PPBRCA
113190200529     C     6             SUBST     WWP59P:4      PPCNUM
113200200529     C     3             SUBST     WWP59P:10     PPCUCD
113210200529     C     10            SUBST     WWP59P:13     PPACCD                                       CGL029
113220200529     C     2             SUBST     WWP59P:23     PPACSQ                                       CGL029
113230200529     C*****4****         SUBST     WWP59P:13     PPACCD                                       CGL029
113240200529     C*****2****         SUBST     WWP59P:17     PPACSQ                                       CGL029
113250200529      *
113260200529     C                   ENDIF
113270200529      *
113280200529      ** Access Account details.
113290200529      *
113300200529     C                   CALL      'AOACCTR0'
113310200529     C                   PARM      *BLANKS       PPRTCD
113320200529     C                   PARM      '*KEY   '     PPOPTN
113330200529     C                   PARM                    PPRETL
113340200529     C                   PARM                    PPCNUM
113350200529     C                   PARM                    PPCUCD
113360200529     C                   PARM                    PPACCD
113370200529     C                   PARM                    PPACSQ
113380200529     C                   PARM                    PPBRCA
113390200529     C     SDACCT        PARM      SDACCT        DSSDY
113400200529      *
113410200529     C     PPRTCD        IFEQ      *BLANKS
113420200529      *
113430200529     C     WWLEN         IFEQ      10
113440200529     C                   MOVEL     WWP59P        ODDBNC1
113450200529     C                   ELSE
113460200529     C     3             SUBST     WWP59P:1      WWBCH1
113470200529     C     6             SUBST     WWP59P:4      WWCUS1
113480200529     C     10            SUBST     WWP59P:13     WWACD1                                       CGL029
113490200529     C     2             SUBST     WWP59P:23     WWSQN1                                       CGL029
113500200529     C*****4****         SUBST     WWP59P:13     WWACD1                                       CGL029
113510200529     C*****2****         SUBST     WWP59P:17     WWSQN1                                       CGL029
113520200529     C                   MOVEL     WWBNC1        ODDBNC1
113530200529     C                   ENDIF
113540200529      *
113550200529     C                   MOVEL     *BLANKS       ODDBNC2
113560200529     C                   MOVEL     *BLANKS       ODDBNC3
113570200529     C                   MOVEL     *BLANKS       ODDBNC4
113580200529     C                   MOVEL     *BLANKS       ODDBNC5
113590200529      *
113600200529     C                   ENDIF
113610200529      *
113620200529     C                   ENDIF
113630200529      *
113640200529      ** Details of Charges.
113650200529      *
113660200529     C     P71           IFNE      *BLANKS
113670200529      *
113680200529     C                   MOVEL     P71           DSTRAN
113690200529      *
113700200529     C     TTREF         IFEQ      'OUR'
113710200529     C                   MOVEL     'A'           ODDADDC
113720200529     C                   ELSE
113730200529     C                   MOVEL     'D'           ODDADDC
113740200529     C                   ENDIF
113750200529      *
113760200529     C                   ELSE
113770200529      *
113780200529     C                   MOVEL     'D'           ODDADDC
113790200529      *
113800200529     C                   ENDIF
113810200529      *
113820200529      ** Sender to Receiver Information.
113830200529      *
113840200529     C     P72           IFEQ      *BLANKS
113850200529      *
113860200529      ** Settlement CCY will be the same as the Account to be Debited.
113870200529      *
113880200529     C                   MOVEL     *BLANKS       ODDSMCY
113890200529      *
113900200529      ** FT fields have been cleared in SREISwft.
113910200529      *
113920200529     C                   ELSE
113930200529      *
113940200529     C                   EXSR      SRICChk
113950200529      *
113960200529     C                   MOVEL     P72           DSFONT
113970200529     C     WFound        IFEQ      'Y'
113980200529     C                   MOVEL     *BLANKS       ODDBBI6
113990200529     C                   MOVEL     FN72L2        ODDBBI1
114000200529     C                   MOVEL     FN72L3        ODDBBI2
114010200529     C                   MOVEL     FN72L4        ODDBBI3
114020200529     C                   MOVEL     FN72L5        ODDBBI4
114030200529     C                   MOVEL     FN72L6        ODDBBI5
114040200529     C                   ELSE
114050200529     C                   MOVEL     FN72L1        ODDBBI1
114060200529     C                   MOVEL     FN72L2        ODDBBI2
114070200529     C                   MOVEL     FN72L3        ODDBBI3
114080200529     C                   MOVEL     FN72L4        ODDBBI4
114090200529     C                   MOVEL     FN72L5        ODDBBI5
114100200529     C                   MOVEL     FN72L6        ODDBBI6
114110200529     C                   ENDIF
114120200529
114130200529     C                   MOVEL     '/REF/'       WCW
114140200529     C                   MOVEL     FONT72        WCWLIN
114150200529     C                   Z-ADD     30            WCWLEN
114160200529     C                   EXSR      SRCWVAL
114170200529     C     WCWVAL        IFNE      *BLANK
114180200529     C                   MOVEL     WCWVAL        ODDFDLR
114190200529     C                   ENDIF
114200200529      *
114210200529     C                   MOVEL     '/ORIG/'      WCW
114220200529     C                   MOVEL     FONT72        WCWLIN
114230200529     C                   EXSR      SRFOCmt2
114240200529     C     WCWCY         IFNE      *BLANK
114250200529     C                   MOVEL     WCWCY         ODDSMCY
114260200529     C                   ELSE
114270200529     C                   MOVEL     *BLANKS       ODDSMCY
114280200529     C                   ENDIF
114290200529      *
114300200529     C                   MOVEL     WCWAM         WNLAM
114310200529     C                   EXSR      SRNull
114320200529      *
114330200529     C     WNLNUL        IFEQ      'N'
114340200529     C                   MOVEL     WCWAM         ODDSMAM
114350200529     C                   ELSE
114360200529     C                   MOVEL     *BLANKS       ODDSMAM
114370200529     C                   ENDIF
114380200529      *
114390200529     C                   MOVEL     '/RATE/'      WCW
114400200529     C                   MOVEL     FONT72        WCWLIN
114410200529     C                   EXSR      SRRate
114420200529     C                   MOVEL     WCWRT         WNLAM
114430200529     C                   EXSR      SRNull
114440200529      *
114450200529     C     WNLNUL        IFEQ      'Y'
114460200529      *
114470200529     C                   MOVEL     *BLANKS       WCWRT
114480200529      *
114490200529     C                   ELSE
114500200529      *
114510200529      ** Decimal places in FT are stored on 8 digits
114520200529      ** => truncated if greater.
114530200529      *
114540200529     C     WCWDPT        IFGT      8
114550200529      *
114560200529     C     '.'           SCAN      WCWRT         IN                2 0
114570200529      *
114580200529      ** Extract Digits + comma.
114590200529      *
114600200529     C     IN            SUBST(P)  WCWRT:1       W014A            14
114610200529     C                   ADD       1             IN
114620200529      *
114630200529      ** Extract Decimals after comma.
114640200529      *
114650200529     C     8             SUBST(P)  WCWRT:IN      W008A             8
114660200529     C     W014A         CAT(P)    W008A:0       WCWRT
114670200529      *
114680200529     C                   ENDIF
114690200529      *
114700200529     C                   ENDIF
114710200529      *
114720200529     C     WCWRT         IFNE      *BLANKS
114730200529     C                   MOVE      WCWRT         ODDRATE
114740200529     C                   ENDIF
114750200529      *
114760200529     C                   ENDIF
114770200529      *
114780200529     C                   MOVEL     'N'           ODDOPIN
114790200529     C                   MOVEL     *BLANKS       ODDNDAM
114800200529      *
114810200529     C     ODDSMCY       IFEQ      ODDNDCY
114820200529     C                   MOVEL     *BLANK        ODDNDCY
114830200529     C                   ENDIF
114840200529      *
114850200529     C                   MOVEL     *BLANKS       ODDSNC1
114860200529     C                   MOVEL     *BLANKS       ODDSNC2
114870200529     C                   MOVEL     *BLANKS       ODDSNC3
114880200529     C                   MOVEL     *BLANKS       ODDSNC4
114890200529     C                   MOVEL     *BLANKS       ODDSNC5
114900200529     C                   MOVEL     *BLANKS       ODDINB1
114910200529     C                   MOVEL     *BLANKS       ODDINB2
114920200529     C                   MOVEL     *BLANKS       ODDINB3
114930200529     C                   MOVEL     *BLANKS       ODDINB4
114940200529     C                   MOVEL     *BLANKS       ODDINB5
114950200529      *
114960200529     C                   ENDSR
114970200529      *
114980200529      *****************************************************************
114990200529      /EJECT
115000200529      *****************************************************************
115010200529      *                                                               *
115020200529      *  SRNull - Test if Amount is null                              *
115030200529      *                                                               *
115040200529      *****************************************************************
115050200529      *
115060200529     C     SRNULL        BEGSR
115070200529      *
115080200529      ** Initialise working fields.
115090200529      *
115100200529     C                   MOVEL     'Y'           WNLNUL            1
115110200529     C                   MOVEL     '123456'      WNUL              9
115120200529     C                   MOVE      '789'         WNUL
115130200529      *
115140200529     C     WNLAM         IFNE      *BLANK
115150200529     C                   MOVEL     *BLANKS       WYA1
115160200529     C                   MOVEA     WNLAM         WYA1
115170200529      *
115180200529     C                   DO        15            IN
115190200529      *
115200200529     C     WNUL          CHECK     WYA1(IN)                               01
115210200529      *
115220200529     C     *IN01         IFEQ      '0'
115230200529     C                   MOVEL     'N'           WNLNUL
115240200529     C                   LEAVE
115250200529     C                   ENDIF
115260200529      *
115270200529     C                   ENDDO
115280200529      *
115290200529     C                   ENDIF
115300200529      *
115310200529      ** Initialise working fields.
115320200529      *
115330200529     C                   MOVEL     *BLANKS       WNLAM            15
115340200529     C                   MOVEL     *BLANKS       WYA1              1
115350200529      *
115360200529     C                   ENDSR
115370200529      *
115380200529      *****************************************************************
115390200529      /EJECT
115400200529      *****************************************************************
115410200529      *                                                               *
115420200529      *  SRICChk - Scan for /OCMT/, /ORIG/, /RATE/                    *
115430200529      *                                                               *
115440200529      *****************************************************************
115450200529      *
115460200529     C     SRICChk       BEGSR
115470200529      *
115480200529     C                   MOVEL     *BLANKS       WFound            1
115490200529      *
115500200529     C     '/RATE/'      SCAN      P72:1         PX                3 0    81
115510200529     C     *IN81         IFEQ      *OFF
115520200529     C     '/ORIG/'      SCAN      P72:1         PX                       81
115530200529     C     *IN81         IFEQ      *OFF
115540200529     C     '/OCMT/'      SCAN      P72:1         PX                       81
115550200529     C                   ENDIF
115560200529     C                   ENDIF
115570200529     C*
115580200529     C     *IN81         IFEQ      *ON
115590200529     C                   MOVE      'Y'           WFound
115600200529     C                   ENDIF
115610200529     C*
115620200529     C                   ENDSR
115630200529      *
115640200529      *****************************************************************
115650200529      /EJECT
115660200529      *****************************************************************
115670200529      *                                                               *
115680200529      *  SRRate - Retrieve the Rate and the Multiply/Divide indicator *
115690200529      *                                                               *
115700200529      *****************************************************************
115710200529      *
115720200529     C     SRRate        BEGSR
115730200529      *
115740200529      ** Reset work variables.
115750200529      *
115760200529     C                   MOVEL     *BLANK        WCWRT            14
115770200529     C                   Z-ADD     0             WCWDPT            1 0
115780200529     C                   Z-ADD     0             WCWDP             2 0
115790200529      *
115800200529     C     WCW           SCAN      WCWLIN:1      WF                3 0    01
115810200529      *
115820200529     C     *IN01         IFEQ      *ON
115830200529      *
115840200529     C                   ADD       6             WF
115850200529      *
115860200529      ** Move possible 13 chars to work array and work string.
115870200529      *
115880200529     C     13            SUBST     WCWLIN:WF     WR               13
115890200529     C                   MOVEA     WR            WSR
115900200529     C                   CLEAR                   WR
115910200529      *
115920200529      ** If ',' in rate string WR, change to '.'.
115930200529      ** Only need to check valid chars till one ',' found.
115940200529      *
115950200529     C                   Z-ADD     1             WC                3 0
115960200529     C                   MOVE      *BLANKS       WT                1
115970200529      *
115980200529     C     1             DO        13            WC
115990200529      *
116000200529     C     WSR(WC)       IFEQ      ','
116010200529      *
116020200529     C                   MOVE      '.'           WSR(WC)
116030200529      *
116040200529      ** Retrieve the number of decimal position.
116050200529      *
116060200529     C     WCHK          CHECK     WR1           WF                3 0
116070200529     C     WF            IFNE      0
116080200529     C     WF            SUB       1             WF
116090200529     C     WF            SUB       WC            WCWDP
116100200529     C                   ELSE
116110200529     C     13            SUB       WC            WCWDP
116120200529     C                   ENDIF
116130200529      *
116140200529      ** Decimal position can be handled only on one 1 digit
116150200529      ** => range 0-9  (otherwise, truncated to 9).
116160200529      *
116170200529     C     WCWDP         IFGT      9
116180200529     C                   Z-ADD     9             WCWDPT
116190200529     C                   ELSE
116200200529     C                   Z-ADD     WCWDP         WCWDPT
116210200529     C                   ENDIF
116220200529      *
116230200529     C                   LEAVE
116240200529      *
116250200529     C                   ENDIF
116260200529      *
116270200529     C                   ENDDO
116280200529      *
116290200529     C                   Z-ADD     1             WC
116300200529     C                   MOVE      *BLANKS       WT                1
116310200529     C                   MOVEA     WSR           WR
116320200529      *
116330200529      ** Get Amount - up to 13 chars possible.
116340200529      *
116350200529     C     WC            DOUGT     13
116360200529      *
116370200529     C                   MOVE      WSR(WC)       WT
116380200529     C     WCHK          CHECK     WT            WF                       01
116390200529      *
116400200529      ** Char not valid must be end of rate.
116410200529      *
116420200529     C     *IN01         IFEQ      *ON
116430200529     C     WC            IFNE      1
116440200529     C     WC            SUB       1             WF
116450200529     C     WF            SUBST     WR:1          WCWRT
116460200529     C                   ENDIF
116470200529     C                   LEAVE
116480200529     C                   ENDIF
116490200529      *
116500200529      ** All chars in string ok.
116510200529      *
116520200529     C     WC            IFEQ      13
116530200529     C                   MOVEL     WR            WCWRT
116540200529     C                   ENDIF
116550200529      *
116560200529     C                   ADD       1             WC
116570200529      *
116580200529     C                   ENDDO
116590200529      *
116600200529     C                   ENDIF
116610200529      *
116620200529      ** Reset input variables.
116630200529      *
116640200529     C                   MOVEL     *BLANKS       WCWLIN
116650200529     C                   MOVEL     *BLANKS       WCW
116660200529      *
116670200529     C                   ENDSR
116680200529      *
116690200529      *****************************************************************
116700200529      /EJECT
116710200529      *****************************************************************
116720200529      *                                                               *
116730200529      *  SRIMsg - Map translated data for incoming messages           *
116740200529      *                                                               *
116750200529      *****************************************************************
116760200529      *
116770200529     C     SRIMsg        BEGSR
116780200529      *
116790200529      ** Set up the detail screen fields from the message.
116800200529      *
116810200529      ** Sender.
116820200529      *
116830200529      ** In FONTIS, this field can be translated only by
116840200529      ** the sender correspondant (P53).
116850200529      *
116860200529     C     PNWRK         IFNE      'FONTIS'
116870200529      *
116880200529     C     PSN           IFNE      *BLANKS
116890200529      *
116900200529     C                   MOVEL     PSN           DSTRAN
116910200529      *
116920200529     C     TRCODE        IFNE      *BLANKS
116930200529      *
116940200529      ** Translate to Nostro and Retail account numbers.
116950200529      *
116960200529     C                   EXSR      SRTran
116970200529      *
116980200529     C                   SELECT
116990200529      *
117000200529      ** If Local and Account Currency Local, then use Retail number.
117010200529      *
117020200529     C     BJLCCY        WHENEQ    ODDSMCY
117030200529     C     WRCYCD        ANDEQ     ODDSMCY
117040200529     C     WWACNO        ANDNE     0
117050200529     C                   MOVE      *BLANKS       ODDSND1
117060200529     C                   MOVE      *BLANKS       ODDSND2
117070200529     C                   MOVE      *BLANKS       ODDSND3
117080200529     C                   MOVE      *BLANKS       ODDSND4
117090200529     C                   MOVEL     WWACNO        ODDSND1
117100200529      *
117110200529      ** If Currency the same as Settle and Nostro, use Nostro.
117120200529      *
117130200529     C     WWNCCY        WHENEQ    ODDSMCY
117140200529     C     WWNONB        ANDNE     *BLANKS
117150200529     C                   MOVE      *BLANKS       ODDSND1
117160200529     C                   MOVE      *BLANKS       ODDSND2
117170200529     C                   MOVE      *BLANKS       ODDSND3
117180200529     C                   MOVE      *BLANKS       ODDSND4
117190200529     C     WWNCCY        CAT(P)    WWNONB        ODDSND1
117200200529      *
117210200529      ** If Currency the same, use GL Account.
117220200529      *
117230200529     C     WRCYCD        WHENEQ    ODDSMCY
117240200529     C                   MOVE      *BLANKS       ODDSND1
117250200529     C                   MOVE      *BLANKS       ODDSND2
117260200529     C                   MOVE      *BLANKS       ODDSND3
117270200529     C                   MOVE      *BLANKS       ODDSND4
117280200529     C     BGMBIN        IFNE      'Y'
117290200529     C                   MOVE      '   '         TRCODE
117300200529     C                   ENDIF
117310200529     C                   MOVEL     TRCODE        ODDSND1
117320200529      *
117330200529      ** Use Customer Number.
117340200529      *
117350200529     C                   OTHER
117360200529     C                   MOVE      *BLANKS       ODDSND1
117370200529     C                   MOVE      *BLANKS       ODDSND2
117380200529     C                   MOVE      *BLANKS       ODDSND3
117390200529     C                   MOVE      *BLANKS       ODDSND4
117400200529     C                   MOVEL     WRCNUM        ODDSND1
117410200529      *
117420200529     C                   ENDSL
117430200529      *
117440200529     C                   ELSE
117450200529      *
117460200529     C                   MOVEL     TMLIN2        ODDSND2
117470200529      *
117480200529     C                   ENDIF
117490200529      *
117500200529     C                   ENDIF
117510200529      *
117520200529     C                   ENDIF
117530200529      *
117540200529      ** Senders Correspondent.
117550200529      *
117560200529      **  By default, will translate the Sender field in FONTIS.
117570200529      *
117580200529     C                   MOVEL     P54           DSTRAN
117590200529     C                   MOVEL     TRCODE        WRCDE2
117600200529      *
117610200529     C     P54           IFEQ      *BLANKS
117620200529     C     P55           ANDEQ     *BLANKS                                                    237914
117630200529     C     P53           ANDNE     *BLANKS
117640200529     C     P54           ORNE      *BLANKS
117650200529     C*****WRCNUM        ANDEQ     '501116'                                                   237914
117660200529     C     P53           ANDNE     *BLANKS
117670200529      *
117680200529     C                   MOVEL     P53           DSTRAN
117690200529     C                   MOVEL     TRCODE        WRCDE2
117700200529      *
117710200529     C     TRCODE        IFNE      *BLANKS
117720200529     C*****WRCNUM        ANDNE     '501116'                                                   237914
117730200529      *
117740200529      ** Translate to Nostro and Retail account numbers.
117750200529      *
117760200529     C                   EXSR      SRTran
117770200529      *
117780200529     C                   SELECT
117790200529      *
117800200529      ** If Local and Account Currency Local, then use Retail number.
117810200529      *
117820200529     C     BJLCCY        WHENEQ    ODDSMCY
117830200529     C     WRCYCD        ANDEQ     ODDSMCY
117840200529     C     WWACNO        ANDNE     0
117850200529     C                   MOVE      *BLANKS       ODDSND1
117860200529     C                   MOVE      *BLANKS       ODDSND2
117870200529     C                   MOVE      *BLANKS       ODDSND3
117880200529     C                   MOVE      *BLANKS       ODDSND4
117890200529     C                   MOVEL     WWACNO        ODDSND1
117900200529      *
117910200529      ** If Currency the same as Settle and Nostro, use Nostro.
117920200529      *
117930200529     C     WWNCCY        WHENEQ    ODDSMCY
117940200529     C     WWNONB        ANDNE     *BLANKS
117950200529     C                   MOVE      *BLANKS       ODDSND1
117960200529     C                   MOVE      *BLANKS       ODDSND2
117970200529     C                   MOVE      *BLANKS       ODDSND3
117980200529     C                   MOVE      *BLANKS       ODDSND4
117990200529     C     WWNCCY        CAT(P)    WWNONB        ODDSND1
118000200529      *
118010200529      ** If Currency the same, use GL Account.
118020200529      *
118030200529     C     WRCYCD        WHENEQ    ODDSMCY
118040200529     C                   MOVE      *BLANKS       ODDSND1
118050200529     C                   MOVE      *BLANKS       ODDSND2
118060200529     C                   MOVE      *BLANKS       ODDSND3
118070200529     C                   MOVE      *BLANKS       ODDSND4
118080200529     C     BGMBIN        IFNE      'Y'
118090200529     C                   MOVE      '   '         TRCODE
118100200529     C                   ENDIF
118110200529     C                   MOVEL     TRCODE        ODDSND1
118120200529      *
118130200529      ** Use Customer Number.
118140200529      *
118150200529     C                   OTHER
118160200529     C                   MOVE      *BLANKS       ODDSND1
118170200529     C                   MOVE      *BLANKS       ODDSND2
118180200529     C                   MOVE      *BLANKS       ODDSND3
118190200529     C                   MOVE      *BLANKS       ODDSND4
118200200529     C                   MOVEL     WRCNUM        ODDSND1
118210200529      *
118220200529     C                   ENDSL
118230200529      *
118240200529     C                   ENDIF
118250200529      *
118260200529     C                   ENDIF
118270200529      *
118280200529      ** Receiver's Correspondent.
118290200529      *
118300200529     C                   SELECT
118310200529      *
118320200529     C     PNWRK         WHENEQ    'YENKSI'
118330200529      *
118340200529     C     P54           WHENNE    *BLANKS
118350200529      *
118360200529     C                   MOVEL     P54           DSTRAN
118370200529     C                   MOVEL     TRCODE        WRCDE2
118380200529     C     TRCODE        IFNE      *BLANKS
118390200529     C     WRCNUM        ANDEQ     '501116'
118400200529     C*****              MOVE      *BLANKS       ODDRCCO                        CFT014
118410200529     C                   MOVE      *BLANKS       ODDRCO1                        CFT014
118420200529     C                   ENDIF
118430200529      *
118440200529     C     TRCODE        IFNE      *BLANKS
118450200529     C     WRCNUM        ANDNE     '501116'
118460200529      *
118470200529      ** Translate to Nostro and Retail account numbers.
118480200529      *
118490200529     C                   EXSR      SRTran
118500200529      *
118510200529     C                   SELECT
118520200529      *
118530200529      ** If Local and Account Currency Local, then use Retail number.
118540200529      *
118550200529     C     BJLCCY        WHENEQ    ODDSMCY
118560200529     C     WRCYCD        ANDEQ     ODDSMCY
118570200529     C     WWACNO        ANDNE     0
118580200529     C*****              MOVE      *BLANKS       ODDRCCO                        CFT014
118590200529     C*****              MOVEL     WWACNO        ODDRCCO                        CFT014
118600200529     C                   MOVE      *BLANKS       ODDRCO1                        CFT014
118610200529     C                   MOVEL     WWACNO        ODDRCO1                        CFT014
118620200529      *
118630200529      ** If Currency the same as Settle and Nostro, use Nostro.
118640200529      *
118650200529     C     WWNCCY        WHENEQ    ODDSMCY
118660200529     C     WWNONB        ANDNE     *BLANKS
118670200529     C*****              MOVE      *BLANKS       ODDRCCO                        CFT014
118680200529     C*****              MOVEL     WWNONB        ODDRCCO                        CFT014
118690200529     C                   MOVE      *BLANKS       ODDRCO1                        CFT014
118700200529     C**********         MOVEL     WWNONB        ODDRCO1                               CFT014 237914
118710200529     C     WWNCCY        CAT(P)    WWNONB        ODDRCO1                                      237914
118720200529      *
118730200529      ** Use Customer Number.
118740200529      *
118750200529     C                   OTHER
118760200529     C*****              MOVE      *BLANKS       ODDRCCO                        CFT014
118770200529     C*****              MOVEL     WRCNUM        ODDRCCO                        CFT014
118780200529     C                   MOVE      *BLANKS       ODDRCO1                        CFT014
118790200529     C                   MOVEL     WRCNUM        ODDRCO1                        CFT014
118800200529      *
118810200529     C                   ENDSL
118820200529      *
118830200529     C                   ENDIF
118840200529      *
118850200529     C                   ENDSL
118860200529      *                                                                                       237914
118870200529      ** Third Reimbursement                                                                  237914
118880200529      *                                                                                       237914
118890200529     C     P55           IFNE      *BLANKS                                                    237914
118900200529      *                                                                                       237914
118910200529     C                   MOVEL     P55           DSTRAN                                       237914
118920200529      *                                                                                       237914
118930200529     C     TRCODE        IFNE      *BLANKS                                                    237914
118940200529      *                                                                                       237914
118950200529      ** Translate to Nostro and Retail account numbers.                                      237914
118960200529      *                                                                                       237914
118970200529     C                   EXSR      SRTran                                                     237914
118980200529      *                                                                                       237914
118990200529     C                   SELECT                                                               237914
119000200529      *                                                                                       237914
119010200529      ** If Local and Account Currency Local, then use Retail number.                         237914
119020200529      *                                                                                       237914
119030200529     C     BJLCCY        WHENEQ    ODDSMCY                                                    237914
119040200529     C     WRCYCD        ANDEQ     ODDSMCY                                                    237914
119050200529     C     WWACNO        ANDNE     0                                                          237914
119060200529     C                   MOVE      *BLANKS       ODDTRIB                                      237914
119070200529     C                   MOVEL     WWACNO        ODDTRIB                                      237914
119080200529      *                                                                                       237914
119090200529      ** If Currency the same as Settle and Nostro, use Nostro.                               237914
119100200529      *                                                                                       237914
119110200529     C     WWNCCY        WHENEQ    ODDSMCY                                                    237914
119120200529     C     WWNONB        ANDNE     *BLANKS                                                    237914
119130200529     C                   MOVE      *BLANKS       ODDTRIB                                      237914
119140200529     C     WWNCCY        CAT(P)    WWNONB        ODDTRIB                                      237914
119150200529      *                                                                                       237914
119160200529      *                                                                                       237914
119170200529      ** If Currency the same as Settle and IBAN, use IBAN.                                   237914
119180200529      *                                                                                       237914
119190200529     C     WRCYCD        WHENEQ    ODDSMCY                                                    237914
119200200529     C     WWIBAN        ANDNE     *BLANKS                                                    237914
119210200529     C                   MOVE      *BLANKS       ODDTRIB                                      237914
119220200529     C                   MOVEL(P)  WWIBAN        ODDTRIB                                      237914
119230200529      *                                                                                       237914
119240200529      ** If Currency the same, use GL Account.                                                237914
119250200529      *                                                                                       237914
119260200529     C     WRCYCD        WHENEQ    ODDSMCY                                                    237914
119270200529     C                   MOVE      *BLANKS       ODDTRIB                                      237914
119280200529     C     BGMBIN        IFNE      'Y'                                                        237914
119290200529     C                   MOVE      '   '         TRCODE                                       237914
119300200529     C                   ENDIF                                                                237914
119310200529     C                   MOVEL     TRCODE        ODDTRIB                                      237914
119320200529      *                                                                                       237914
119330200529      ** Use Customer Number.                                                                 237914
119340200529      *                                                                                       237914
119350200529     C                   OTHER                                                                237914
119360200529     C                   MOVE      *BLANKS       ODDTRIB                                      237914
119370200529     C                   MOVEL     WRCNUM        ODDTRIB                                      237914
119380200529      *                                                                                       237914
119390200529     C                   ENDSL                                                                237914
119400200529      *                                                                                       237914
119410200529     C                   ELSE                                                                 237914
119420200529      *                                                                                       237914
119430200529     C                   MOVEL     TMLIN2        ODDTRIB                                      237914
119440200529      *                                                                                       237914
119450200529     C                   ENDIF                                                                237914
119460200529      *                                                                                       237914
119470200529     C                   ENDIF                                                                237914
119480200529      *
119490200529      ** Account with Institution.
119500200529      *
119510200529      ** Can't be translated if FONTIS message.
119520200529      *
119530200529     C     PNWRK         IFNE      'FONTIS'
119540200529      *
119550200529     C     P57           IFNE      *BLANKS
119560200529      *
119570200529     C                   MOVEL     P57           DSTRAN
119580200529      *
119590200529      ** Translate to Nostro and Retail account numbers.
119600200529      *
119610200529     C     TRCODE        IFNE      *BLANKS
119620200529      *
119630200529     C                   EXSR      SRTran
119640200529      *
119650200529     C                   SELECT
119660200529      *
119670200529      ** If Local and Account Currency Local, then use Retail number.
119680200529      *
119690200529     C     BJLCCY        WHENEQ    ODDSMCY
119700200529     C     WRCYCD        ANDEQ     ODDSMCY
119710200529     C     WWACNO        ANDNE     0
119720200529     C                   MOVE      *BLANKS       ODDACBK
119730200529     C                   MOVEL     WWACNO        ODDACBK
119740200529      *
119750200529      ** If Currency the same as Settle and Nostro, use Nostro.
119760200529      *
119770200529     C     WWNCCY        WHENEQ    ODDSMCY
119780200529     C     WWNONB        ANDNE     *BLANKS
119790200529     C                   MOVE      *BLANKS       ODDACBK
119800200529     C                   MOVEL     WWNONB        ODDACBK
119810200529      *
119820200529      ** If Currency the same, use GL Account.
119830200529      *
119840200529     C     WRCYCD        WHENEQ    ODDSMCY
119850200529     C                   MOVE      *BLANKS       ODDACBK
119860200529     C     WRCNUM        CAT       WRCDSQ        ODDACBK
119870200529     C     BGMBIN        IFEQ      'Y'
119880200529     C                   MOVE      WRBRCD        ODDACBB
119890200529     C                   ENDIF
119900200529      *
119910200529      ** Use Customer Number.
119920200529      *
119930200529     C                   OTHER
119940200529     C                   MOVE      *BLANKS       ODDACBK
119950200529     C                   MOVEL     WRCNUM        ODDACBK
119960200529      *
119970200529     C                   ENDSL
119980200529      *
119990200529     C                   ENDIF
120000200529      *
120010200529     C                   ENDIF
120020200529      *
120030200529     C                   ENDIF
120040200529      *
120050200529      ** Beneficiary Institution/ Beneficiary Customer.
120060200529      *
120070200529     C     P58           IFNE      *BLANKS
120080200529      *
120090200529     C                   MOVEL     P58           DSTRAN
120100200529      *
120110200529     C     TRCODE        IFNE      *BLANKS
120120200529      *
120130200529      ** Translate to Nostro and Retail account numbers.
120140200529      *
120150200529     C                   EXSR      SRTran
120160200529      *
120170200529     C                   SELECT
120180200529      *
120190200529      ** If Local and Account Currency Local, then use Retail number.
120200200529      *
120210200529     C     BJLCCY        WHENEQ    ODDSMCY
120220200529     C     WRCYCD        ANDEQ     ODDSMCY
120230200529     C     WWACNO        ANDNE     0
120240200529     C                   MOVE      *BLANKS       ODDBNC1
120250200529     C                   MOVEL     WWACNO        ODDBNC1
120260200529     C                   MOVEL     *BLANKS       ODDBNC2
120270200529     C                   MOVEL     *BLANKS       ODDBNC3
120280200529     C                   MOVEL     *BLANKS       ODDBNC4
120290200529     C                   MOVEL     *BLANKS       ODDBNC5
120300200529      *
120310200529      ** If Currency the same, use GL Account.
120320200529      *
120330200529     C     WRCYCD        WHENEQ    ODDSMCY
120340200529     C                   MOVE      *BLANKS       ODDBNC1
120350200529     C     BGMBIN        IFNE      'Y'
120360200529     C                   MOVEL     *BLANKS       WRBRCD
120370200529     C                   ENDIF
120380200529     C     WRCNUM        CAT       WRCSB         ODDBNC1
120390200529     C                   MOVEL     *BLANKS       ODDBNC2
120400200529     C                   MOVEL     *BLANKS       ODDBNC3
120410200529     C                   MOVEL     *BLANKS       ODDBNC4
120420200529     C                   MOVEL     *BLANKS       ODDBNC5
120430200529      *
120440200529      ** Use Customer Number.
120450200529      *
120460200529     C                   OTHER
120470200529     C                   MOVE      *BLANKS       ODDBNC1
120480200529     C                   MOVEL     WRCNUM        ODDBNC1
120490200529     C                   MOVEL     *BLANKS       ODDBNC2
120500200529     C                   MOVEL     *BLANKS       ODDBNC3
120510200529     C                   MOVEL     *BLANKS       ODDBNC4
120520200529     C                   MOVEL     *BLANKS       ODDBNC5
120530200529      *
120540200529     C                   ENDSL
120550200529      *
120560200529     C                   ENDIF
120570200529      *
120580200529     C                   ENDIF
120590200529      *
120600200529     C     P59           IFNE      *BLANKS
120610200529      *
120620200529     C                   MOVEL     P59           DSTRAN
120630200529      *
120640200529      ** Translate to Nostro and Retail account numbers.
120650200529      *
120660200529     C     TRCODE        IFNE      *BLANKS
120670200529      *
120680200529     C                   EXSR      SRTran
120690200529      *
120700200529     C                   SELECT
120710200529      *
120720200529      ** If Local and Account Currency Local, then use Retail number.
120730200529      *
120740200529     C     BJLCCY        WHENEQ    ODDSMCY
120750200529     C     WRCYCD        ANDEQ     ODDSMCY
120760200529     C     WWACNO        ANDNE     0
120770200529     C                   MOVE      *BLANKS       ODDBNC1
120780200529     C                   MOVEL     WWACNO        ODDBNC1
120790200529     C                   MOVEL     *BLANKS       ODDBNC2
120800200529     C                   MOVEL     *BLANKS       ODDBNC3
120810200529     C                   MOVEL     *BLANKS       ODDBNC4
120820200529     C                   MOVEL     *BLANKS       ODDBNC5
120830200529      *
120840200529      ** If Currency the same, use GL Account.
120850200529      *
120860200529     C     WRCYCD        WHENEQ    ODDSMCY
120870200529     C                   MOVE      *BLANKS       ODDBNC1
120880200529     C     BGMBIN        IFNE      'Y'
120890200529     C                   MOVEL     *BLANKS       WRBRCD
120900200529     C                   ENDIF
120910200529     C     WRCNUM        CAT       WRCSB         ODDBNC1
120920200529     C                   MOVEL     *BLANKS       ODDBNC2
120930200529     C                   MOVEL     *BLANKS       ODDBNC3
120940200529     C                   MOVEL     *BLANKS       ODDBNC4
120950200529     C                   MOVEL     *BLANKS       ODDBNC5
120960200529      *
120970200529      ** Use Customer Number.
120980200529      *
120990200529     C                   OTHER
121000200529     C                   MOVE      *BLANKS       ODDBNC1
121010200529     C                   MOVEL     WRCNUM        ODDBNC1
121020200529     C                   MOVEL     *BLANKS       ODDBNC2
121030200529     C                   MOVEL     *BLANKS       ODDBNC3
121040200529     C                   MOVEL     *BLANKS       ODDBNC4
121050200529     C                   MOVEL     *BLANKS       ODDBNC5
121060200529      *
121070200529     C                   ENDSL
121080200529      *
121090200529     C                   ENDIF
121100200529      *
121110200529     C                   ENDIF
121120200529      *
121130200529     C                   ENDSR
121140200529      *
121150200529      *****************************************************************
121160200529      /EJECT
121170200529      *****************************************************************
121180200529      *                                                               *
121190200529      *  SRTran - Translate to Retail and Nostro Code                 *
121200200529      *                                                               *
121210200529      *****************************************************************
121220200529      *
121230200529     C     SRTran        BEGSR
121240200529      *
121250200529     C     *LIKE         DEFINE    ACNO          WWACNO
121260200529     C     *LIKE         DEFINE    A7CYCD        WWNCCY
121270200529     C     *LIKE         DEFINE    A7NONB        WWNONB
121280200529     C     *LIKE         DEFINE    IBAN          WWIBAN                                       237914
121290200529      *
121300200529      ** Clear Retail number and Nostro Code.
121310200529      *
121320200529     C                   Z-ADD     *ZERO         WWACNO
121330200529     C                   MOVEL     *BLANKS       WWNCCY
121340200529     C                   MOVEL     *BLANKS       WWNONB
121350200529      *
121360200529      ** If TRCODE has no Currency, exit.
121370200529      *
121380200529     C                   MOVE      TRCODE        WRCDE2
121390200529     C     WRCYCD        IFEQ      *BLANKS
121400200529     C                   GOTO      ETran
121410200529     C                   ENDIF
121420200529      *
121430200529      ** Find Account details.
121440200529      *
121450200529     C                   MOVEL     TRCODE        WACKYDS
121460200529     C     KAccnt        CHAIN     ACCNTABF                           01
121470200529      *
121480200529     C     *IN01         IFEQ      *OFF
121490200529     C     RECI          ANDEQ     'D'
121500200529     C     ATYP          ANDEQ     'R'
121510200529     C                   Z-ADD     ACNO          WWACNO
121520200529     C                   ENDIF
121530200529      *                                                                                       237914
121540200529      ** IBAN                                                                                 237914
121550200529      *                                                                                       237914
121560200529     C     *IN01         IFEQ      *OFF                                                       237914
121570200529     C     IBAN          ANDNE     *BLANKS                                                    237914
121580200529     C                   MOVEL(P)  IBAN          WWIBAN                                       237914
121590200529     C                   ENDIF                                                                237914
121600200529      *
121610200529      ** Move numeric fields to parameter fields.
121620200529      *
121630200529     C                   MOVEL     CNUM          PCUST
121640200529     C                   MOVEL     ACOD          PACCD
121650200529     C                   MOVEL     ACSQ          PACSN
121660200529      *
121670200529      ** Find Nostro details.
121680200529      *
121690200529     C                   CALLB     'AONOSTR0'
121700200529     C                   PARM      *BLANKS       PRTCD
121710200529     C                   PARM      '*KEY   '     POPTN
121720200529     C                   PARM                    PCUST
121730200529     C                   PARM      CCY           PCYCD             3
121740200529     C**********         PARM                    PACCD             4                          CGL029
121750200529     C                   PARM                    PACCD                                        CGL029
121760200529     C                   PARM                    PACSN             2
121770200529     C                   PARM      *BLANKS       PNONB             2
121780200529     C                   PARM      BRCA          PBRCD             3
121790200529     C                   PARM      *BLANKS       PCSSN            10
121800200529     C                   PARM      *BLANKS       PPNOI             1
121810200529     C     SDNOST        PARM      *BLANKS       DSFDY
121820200529      *
121830200529     C     PRTCD         IFEQ      *BLANKS
121840200529     C                   MOVEL     A7CYCD        WWNCCY
121850200529     C                   MOVEL     A7NONB        WWNONB
121860200529     C                   ENDIF
121870200529      *
121880200529     C     ETran         ENDSR
121890200529      *
121900200529      *****************************************************************
121910200529      /EJECT
121920200529      *****************************************************************
121930200529      *                                                               *
121940200529      *  SRMsgNxt - Check if there are more electronic messages to    *
121950200529      *             be processed                                      *
121960200529      *                                                               *
121970200529      *****************************************************************
121980200529      *
121990200529     C     SRMsgNxt      BEGSR
122000200529      *
122010200529      ** All electronic messages selected are held on the file FTINMGPD
122020200529      ** for reservation purposes.  This file must be checked to see if
122030200529      ** there are any more outstanding for the current job.
122040200529      *
122050200529     C                   CALL      'ME1080'                             0101
122060200529     C                   PARM      '*NEXT  '     PACT
122070200529     C     PHMSGR        PARM      *ZEROS        PMSGR
122080200529     C     PHPART        PARM      *ZEROS        PKPRT
122090200529     C     PHMOR         PARM      *BLANKS       PMOR
122100200529     C     PHMIR         PARM      *BLANKS       PMIR
122110200529     C                   PARM      *BLANKS       PRTN
122120200529      *
122130200529      ** If call to program resulted in an error, then end program.
122140200529      *
122150200529     C     PRTN          IFEQ      '*ERROR*'
122160200529     C     *IN01         OREQ      *ON
122170200529     C                   MOVEL     '*CALL'       DBKEY
122180200529     C                   MOVEL     'ME1080'      DBFILE
122190200529     C                   Z-ADD     029           DBASE
122200200529     C                   EXSR      *PSSR
122210200529     C                   ENDIF
122220200529      *
122230200529      ** MIN0105 - Reserved message found.
122240200529      *
122250200529      ** If there is an electronic message for the current job, then
122260200529      ** prepare input fields for processing.
122270200529      *
122280200529     C     PRTN          IFEQ      'MIN0105'
122290200529     C                   MOVEL     'Y'           WEMSG
122300200529     C                   MOVEL     'I'           DDACTN
122310200529     C                   MOVEL     *BLANKS       DDPREF
122320200529     C                   MOVEL     *BLANKS       DDBRCA
122330200529     C                   MOVEL     PMIR          DDSWTN
122340200529     C                   MOVEL     *BLANKS       DDSEQNO
122350200529     C                   GOTO      EMsgNxt
122360200529     C                   ENDIF
122370200529      *
122380200529      ** MIN0106 - No reserved messages to process.
122390200529      *
122400200529      ** If there is no electronic message for the current job, then
122410200529      ** return to Initial screen.
122420200529      *
122430200529     C     PRTN          IFEQ      'MIN0106'
122440200529     C                   MOVEL     'N'           WEMSG
122450200529     C                   MOVEL     *BLANKS       DDACTN
122460200529     C                   MOVEL     *BLANKS       DDPREF
122470200529     C                   MOVEL     *BLANKS       DDBRCA
122480200529     C                   MOVEL     *BLANKS       DDSWTN
122490200529     C                   MOVEL     *BLANKS       DDSEQNO
122500200529     C                   MOVEL     'MIN0106'     PErrMs
122510200529     C                   EXSR      SRSndM
122520200529     C                   ENDIF
122530200529      *
122540200529     C     EMsgNxt       ENDSR
122550200529      *
122560200529      *****************************************************************
122570200529      /EJECT
122580200529      *****************************************************************
122590200529      *                                                               *
122600200529      *  SRMsgEnd - Remove all electronic messages reserved           *
122610200529      *             for the job                                       *
122620200529      *                                                               *
122630200529      *****************************************************************
122640200529      *
122650200529     C     SRMsgEnd      BEGSR
122660200529      *
122670200529      ** All electronic messages selected are held on the file FTINMGPD
122680200529      ** for reservation purposes.  This file must be cleared of all
122690200529      ** electronic messages that were selected for the current job.
122700200529      *
122710200529     C                   CALL      'ME1070'                             0101
122720200529     C                   PARM      '*END   '     PACT
122730200529     C                   PARM      *ZEROS        PMSGR
122740200529     C                   PARM      *ZEROS        PKPRT
122750200529     C                   PARM      *BLANKS       PMOR
122760200529     C                   PARM      *BLANKS       PMIR
122770200529     C                   PARM      *BLANKS       PRTN
122780200529      *
122790200529      ** If call to program resulted in an error, then end program.
122800200529      *
122810200529     C     PRTN          IFEQ      '*ERROR*'
122820200529     C     *IN01         OREQ      *ON
122830200529     C                   MOVEL     '*CALL'       DBKEY
122840200529     C                   MOVEL     'ME1070'      DBFILE
122850200529     C                   Z-ADD     030           DBASE
122860200529     C                   EXSR      *PSSR
122870200529     C                   ENDIF
122880200529      *
122890200529      ** If all reserved records were successfully cleared, then set the
122900200529      ** Electronic Message Processing flag and commit the file update.
122910200529      *
122920200529      ** MIN0111 - Reservation Processing Cancelled For Job.
122930200529      *
122940200529     C     PRTN          IFEQ      'MIN0111'
122950200529     C                   MOVEL     ' '           WEMSG
122960200529      **                                                                                      CSC022
122970200529      ** Execute commit if SAR CSC022 is not enrolled or                                      CSC022
122980200529      **   job is not currently running in batch mode                                         CSC022
122990200529      **                                                                                      CSC022
123000200529     C                   If        CSC022 = 'N'                                               CSC022
123010200529     C                             Or (CSC022 = 'Y' and WSkpComtRolbk = 'N')                  CSC022
123020200529     C                   COMMIT
123030200529     C                   EndIf                                                                CSC022
123040200529     C                   ENDIF
123050200529      *
123060200529     C                   ENDSR
123070200529      *
123080200529      *****************************************************************
123090200529      /EJECT
123100200529      *****************************************************************
123110200529      *                                                               *
123120200529      *  SRSndM - Send error message to screen                        *
123130200529      *                                                               *
123140200529      *****************************************************************
123150200529      *
123160200529     C     SRSndM        BEGSR
123170200529      *
123180200529      ** If single-branching, user does not have the authority to
123190200529      ** Browse.
123200200529      *
123210200529     C     PErrMs        IFEQ      'FTA0114'
123220200529     C                   MOVE      'N'           OKACTN
123230200529     C                   ENDIF
123240200529      *
123250200529      ** Invalid Payment Reference.
123260200529      *
123270200529     C     PErrMs        IFEQ      'FTA0108'
123280200529     C                   MOVE      'N'           OKPREF
123290200529     C                   ENDIF
123300200529      *
123310200529      ** Add error message to array passed to screen.
123320200529      *
123330200529     C                   Z-ADD     1             Ex                3 0
123340200529     C     *BLANK        LOOKUP    FldNameArr(Ex)                         99
123350200529     C                   MOVEL     '*ANY'        FldNameArr(Ex)
123360200529     C                   MOVEL     PErrMs        MsgIdArr(Ex)
123370200529      *
123380200529     C                   ENDSR
123390200529      *
123400200529      *****************************************************************
123410200529      /EJECT
123420200529      *****************************************************************
123430200529      *                                                               *
123440200529      *  SREndP - Set program to end                                  *
123450200529      *                                                               *
123460200529      *****************************************************************
123470200529      *
123480200529     C     SREndP        BEGSR
123490200529      *
123500200529      * ONLY reduce PREF sequence number if it was incremented.                               209067
123510200529     C                   IF        FirstTime <> 'Y'                                           209067
123520200529      * Reduce Sequence number in DTAARA as number is not being used                          204152
123530200529     C     *LOCK         IN        WINPAY                                                     204152
123540200529     C                   IF        CFT151 = 'N'                                               CFT151
123550200529      *                                                                                       209067
123560200529      * Check to see if another pref has been generated by another function                   209067
123570200529      *                                                                                       209067
123580200529     C                   z-add     WWINSQ        svnum             4 0                        209067
123590200529     C                   eval      svnum = svnum + 1                                          209067
123600200529     C**********         if        svnum = WINSQ                                      209067 BUG4776
123610200529     C*****SVNUM         IFLE      WINSQ                                              BUG4776 260326
123620200529     C                   if        svnum = WINSQ                                              260326
123630200529      * No new reference has been generated - so reduce sequence number on data area          209067
123640200529     C**********         SUB       1             WINSQ                                204152 BUG4776
123650200529     C**********         EVAL      WINSQ = WWINSQ                                     BUG4776 260326
123660200529     C                   SUB       1             WINSQ                                        260326
123670200529     C**********         else                                                         209067 BUG4776
123680200529     C                   else                                                                 260326
123690200529      * if another number has been generated, the current payment reference                   209067
123700200529     C                   endif                                                                209067
123710200529     C                   OUT       WINPAY                                                     204152
123720200529     C                   else                                                                 CFT151
123730200529     C                   MOVE      WWINSQT       svalph            4                          CFT151
123740200529     C                   CALL      'FT000328'                                                 CFT151
123750200529     C                   PARM                    PRTCD                                        CFT151
123760200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
123770200529     C                   PARM      'A'           WCALC                                        CFT151
123780200529     C                   PARM      'N'           WUPD              1                          CFT151
123790200529     C                   PARM                    svalph                                       CFT151
123800200529     C                   PARM                    WNEWSQ                                       CFT151
123810200529     C                   if        WNEWSQ = WINPAY                                            CFT151
123820200529     C                   CALL      'FT000328'                                                 CFT151
123830200529     C                   PARM                    PRTCD                                        CFT151
123840200529     C                   PARM      'IN'          W@OTIN            2                          CFT151
123850200529     C                   PARM      'S'           WCALC                                        CFT151
123860200529     C                   PARM      'Y'           WUPD                                         CFT151
123870200529     C                   PARM                    svalph                                       CFT151
123880200529     C                   PARM                    WNEWSQ                                       CFT151
123890200529     C                   ENDIF                                                                CFT151
123900200529     C                   endif                                                                CFT151
123910200529     C                   ENDIF                                                                209067
123920200529      *                                                                                       204152
123930200529      ** Issue rollback to clear any possible updates in lower
123940200529      ** level programs.
123950200529      *
123960200529      **                                                                                      CSC022
123970200529      ** Execute rollback if SAR CSC022 is not enrolled or                                    CSC022
123980200529      **   job is not currently running in batch mode                                         CSC022
123990200529      **                                                                                      CSC022
124000200529     C                   If        CSC022 = 'N'                                               CSC022
124010200529     C                   ROLBK
124020200529     C                   Else                                                                 CSC022
124030200529     C                   If        WSkpComtRolbk = 'N'                                        CSC022
124040200529     C                   RolBk                                                                CSC022
124050200529     C                   Else                                                                 CSC022
124060200529     C                   SetOn                                        U7U8                    CSC022
124070200529     C                   EndIf                                                                CSC022
124080200529     C                   EndIf                                                                CSC022
124090200529      *                                                                                       261468
124100200529      ** Call CL program to deallocate this reference to a dataarea                           261468
124110200529      *                                                                                       261468
124120200529     C                   EVAL      C#RTCD = *Blanks                                           261468
124130200529     C                   EVAL      @MODLE = 'FT'                                              261468
124140200529     C                   EVAL      @TREF  = *Blanks                                           261468
124150200529     C                   EVAL      @RTINF = *Blanks                                           261468
124160200529      *                                                                                       261468
124170200529     C                   CALL      'AOC8000'                                                  261468
124180200529     C                   PARM                    C#RTCD            7                          261468
124190200529     C                   PARM                    @MODLE            2                          261468
124200200529     C                   PARM                    @TREF            15                          261468
124210200529     C                   PARM                    @RTINF           80                          261468
124220200529      *
124230200529      ** Release all electronic messages that are reserved for the job
124240200529      ** if Incoming Payments Maintenance has been called from
124250200529      ** Messages to be Processed thru Funds Transfer option or reserved
124260200529      ** electronic messages are present.
124270200529      *
124280200529     C     PParmActn     IFEQ      'I'
124290200529     C     PParmLevel    ANDEQ     '1'
124300200529     C     PParmLink     ANDEQ     'Y'
124310200529     C     WEMSG         OREQ      'Y'
124320200529     C                   EXSR      SRMsgEnd
124330200529     C                   ENDIF
124340200529      *
124350200529      ** Incoming Payments Maintenance has been called by linked
124360200529      ** maintenance/enquiry.
124370200529      *
124380200529     C     PParmLink     IFEQ      'Y'
124390200529     C                   MOVEL     '1'           PParmRtcd
124400200529     C                   ENDIF
124410200529      *
124420200529      ** Terminate the program.
124430200529      *
124440200529     C                   MOVEL     'T'           WScrn
124450200529      *
124460200529     C                   ENDSR
124470200529      *
124480200529      *****************************************************************
124490200529      /EJECT
124500200529      *****************************************************************
124510200529      *                                                               *
124520200529      *  SRResetErr - Reset error fields                              *
124530200529      *                                                               *
124540200529      *****************************************************************
124550200529      *
124560200529     C     SRResetErr    BEGSR
124570200529      *
124580200529     C                   CLEAR                   FldNameArr
124590200529     C                   CLEAR                   MsgIDArr
124600200529     C                   CLEAR                   MsgDtaArr
124610200529     C                   CLEAR                   IDx
124620200529      *
124630200529     C                   CLEAR                   WFldNamArr
124640200529     C                   CLEAR                   WMsgIdArr
124650200529     C                   CLEAR                   WMsgDtaArr
124660200529     C                   CLEAR                   WIDx
124670200529      *
124680200529      ** Initialise screen fields error indicators.
124690200529      *
124700200529     C                   MOVE      *ALL'Y'       FTEIPY1
124710200529     C                   MOVE      *ALL'Y'       FTEIPY2
124720200529     C                   MOVE      *ALL'Y'       FTEIPY3
124730200529     C                   MOVE      *ALL'Y'       FTEIPY4                        CFT014
124740200529     C                   MOVE      *ALL'Y'       FTEIPY5                        CFT014
124750200529     C                   IF        CSW209 = 'Y'                                               CSW209
124760200529     C                   MOVE      *ALL'Y'       FTEIPY7                                      CSW209
124770200529     C                   MOVE      *ALL'Y'       FTEIPY8                                      CSW209
124780200529     C                   ENDIF                                                                CSW209
124790200529      *
124800200529      ** Initialise SWIFT Reference and Sequence No. error
124810200529      ** indicators.
124820200529      *
124830200529     C                   MOVE      'Y'           OKSWTN
124840200529     C                   MOVE      'Y'           OKSEQNO
124850200529      *
124860200529     C                   ENDSR
124870200529      *
124880200529      *****************************************************************
124890200529      /EJECT
124900200529      *****************************************************************
124910200529      *                                                               *
124920200529      *  SRInScn - Initialise screen formats                          *
124930200529      *                                                               *
124940200529      *****************************************************************
124950200529      *
124960200529     C     SRInScn       BEGSR
124970200529      *
124980200529      ** Blank out Incoming Payment Status, as well as, Detail
124990200529      ** fields on Level 1 screen.
125000200529      *
125010200529     C                   MOVEL     *BLANKS       PStatus
125020200529     C                   MOVEL     *BLANKS       NwDetailScrn
125030200529     C                   MOVEL     *BLANKS       NwIP1AScnFmt                   CFT014
125040200529      *
125050200529      ** Blank out Level 2 screen fields.
125060200529      *
125070200529     C                   MOVEL     *BLANKS       NwIP2ScnFmt
125080200529     C                   MOVEL     *BLANKS       NwIP3ScnFmt
125090200529     C                   MOVEL     *BLANKS       NwIP4ScnFmt
125100200529     C                   MOVEL     *BLANKS       NwIP4AScnFmt                   CFT014
125110200529     C                   MOVEL     *BLANKS       NwIP5ScnFmt                    CFT014
125120200529     C                   MOVEL     *BLANKS       NwIP6ScnFmt                    CFT014
125130200529     C                   MOVEL     *BLANKS       NwIP7ScnFmt                                  CSW209
125140200529     C                   MOVEL     *BLANKS       NwIP8ScnFmt                                  CSW209
125150200529     C                   MOVEL     *BLANKS       NwIP6AScnFmt                                 CER030
125160200529      *
125170200529      ** Set up default values on Level 1 screen.
125180200529      *
125190200529     C                   MOVEL     'IN'          PPYTP
125200200529     C                   MOVEL     'N'           DDSWPC
125210200529     C**********         MOVEL     'D'           DDADDC                                     MD036089
125220200529                                                                                CFT009
125230200529     C                   IF        CFT009 = 'N'                                 CFT009
125240200529     C                   MOVEL     WRUNDAY       DDSLDT
125250200529     C                   ENDIF                                                  CFT009
125260200529      *
125270200529      ** Save Incoming Payments Lvl 1 screen details.
125280200529      *
125290200529     C                   MOVEL     NwIP1ScnFmt   CrIP1ScnFmt
125300200529     C                   MOVEL     NwIP1AScnFmt  CrIP1AScnFmt                   CFT014
125310200529     C                   MOVEL     NwIP2ScnFmt   CrIP2ScnFmt
125320200529     C                   MOVEL     NwIP3ScnFmt   CrIP3ScnFmt
125330200529     C                   MOVEL     NwIP4ScnFmt   CrIP4ScnFmt
125340200529     C                   MOVEL     NwIP4AScnFmt  CrIP4AScnFmt                   CFT014
125350200529     C                   MOVEL     NwIP5ScnFmt   CrIP5ScnFmt                    CFT014
125360200529     C                   MOVEL     NwIP6ScnFmt   CrIP6ScnFmt                    CFT014
125370200529     C                   MOVEL     NwIP6AScnFmt  CrIP6AScnFmt                                 CER030
125380200529     C                   IF        CSW209 = 'Y'                                               CSW209
125390200529     C                   MOVEL     NwIP7ScnFmt   CrIP7ScnFmt                                  CSW209
125400200529     C                   MOVEL     NwIP8ScnFmt   CrIP8ScnFmt                                  CSW209
125410200529     C                   ENDIF                                                                CSW209
125420200529      *                                                                                       187056
125430200529      ** Initialise work fields for 'Charges to the Debit of a/c'.                            187056
125440200529      *                                                                                       187056
125450200529     C                   EVAL      PPrvCDRO = *BLANKS                                         187056
125460200529     C                   EVAL      PPrvCDBR = *BLANKS                                         187056
125470200529     C                   EVAL      PPrvCDRT = *BLANKS                                         187056
125480200529      *
125490200529     C                   ENDSR
125500200529      *
125510200529      *****************************************************************
125520200529      /EJECT                                                                                  187056
125530200529      *****************************************************************                       187056
125540200529      *                                                               *                       187056
125550200529      *  SRReCalc - Perform recalculation of charges.                 *                       187056
125560200529      *                                                               *                       187056
125570200529      *****************************************************************                       187056
125580200529      *                                                                                       187056
125590200529     C     SRReCalc      BEGSR                                                                187056
125600200529      *                                                                                       187056
125610200529     C                   MOVE      *BLANKS       W0FCUS            6                          187056
125620200529     C                   MOVE      *BLANKS       W0SCUS            6                          187056
125630200529     C                   MOVE      'N'           WReDspChg         1                          187056
125640200529      *                                                                                       187056
125650200529      ** Perform the following only if core feature S01508                                    187056
125660200529      ** (BLI Extended Payment Charges) is installed and core                                 187056
125670200529      ** feature S01506 (BLI Payment Charges Enhancements)                                    187056
125680200529      ** is NOT installed.  Get "Charges to the Debit of"                                     187056
125690200529      ** Customer using FT0035 based on Level 2 details.                                      187056
125700200529      *                                                                                       187056
125710200529     C     S01508        IFEQ      'Y'                                                        187056
125720200529     C     S01506        ANDNE     'Y'                                                        187056
125730200529      *                                                                                       187056
125740200529      ** Get original "Charges to the Debit of" Customer.                                     187056
125750200529      *                                                                                       187056
125760200529     C                   CLEAR                   P0DTA                                        187056
125770200529      *                                                                                       187056
125780200529     C     PPrvCDRT      IFNE      *BLANKS                                                    187056
125790200529     C                   MOVE      PPrvCDRT      WIPT1                                        187056
125800200529     C     PPrvCDRO      CAT(P)    PPrvCDBR      WIPTY1                                       187056
125810200529     C                   MOVE      BJCYCD        WICCY                                        187056
125820200529      *                                                                                       187056
125830200529     C                   CALL      'FT0035'                             9090                  187056
125840200529     C                   PARM      *BLANKS       PRTCD                                        187056
125850200529     C                   PARM                    P0DTA                                        187056
125860200529     C                   PARM                    P0MSG           256                          187056
125870200529      *                                                                                       187056
125880200529     C     *IN90         IFEQ      *ON                                                        187056
125890200529     C     PRTCD         ORNE      *BLANKS                                                    187056
125900200529     C                   MOVEL     '*CALL'       DBKEY                                        187056
125910200529     C                   MOVEL     'FT0035'      DBFILE                                       187056
125920200529     C                   Z-ADD     36            DBASE                                        187056
125930200529     C                   EXSR      *PSSR                                                      187056
125940200529     C                   ENDIF                                                                187056
125950200529      *                                                                                       187056
125960200529     C                   MOVE      WOCUST        W0FCUS                                       187056
125970200529      *                                                                                       187056
125980200529     C                   ENDIF                                                                187056
125990200529      *                                                                                       187056
126000200529      ** Get new "Charges to the Debit of" Customer.                                          187056
126010200529      *                                                                                       187056
126020200529     C                   CLEAR                   P0DTA                                        187056
126030200529      *                                                                                       187056
126040200529     C     IPCDRT        IFNE      *BLANKS                                                    187056
126050200529     C                   MOVE      IPCDRT        WIPT1                                        187056
126060200529     C     DDCDRO        CAT(P)    DDCDBR        WIPTY1                                       187056
126070200529     C                   MOVE      BJCYCD        WICCY                                        187056
126080200529      *                                                                                       187056
126090200529     C                   CALL      'FT0035'                             9090                  187056
126100200529     C                   PARM      *BLANKS       PRTCD                                        187056
126110200529     C                   PARM                    P0DTA                                        187056
126120200529     C                   PARM                    P0MSG                                        187056
126130200529      *                                                                                       187056
126140200529     C     *IN90         IFEQ      *ON                                                        187056
126150200529     C     PRTCD         ORNE      *BLANKS                                                    187056
126160200529     C                   MOVEL     '*CALL'       DBKEY                                        187056
126170200529     C                   MOVEL     'FT0035'      DBFILE                                       187056
126180200529     C                   Z-ADD     37            DBASE                                        187056
126190200529     C                   EXSR      *PSSR                                                      187056
126200200529     C                   ENDIF                                                                187056
126210200529      *                                                                                       187056
126220200529     C                   MOVE      WOCUST        W0SCUS                                       187056
126230200529     C                   ENDIF                                                                187056
126240200529      *                                                                                       187056
126250200529     C                   ENDIF                                                                187056
126260200529      *                                                                                       187056
126270200529      ** Call defaulting program to recalculate charges.                                      187056
126280200529      *                                                                                       187056
126290200529     C     DDCDRO        IFNE      PPrvCDRO                                                   187056
126300200529     C     DDCDBR        ORNE      PPrvCDBR                                                   187056
126310200529     C     W0FCUS        ORNE      W0SCUS                                                     187056
126320200529     C                   EVAL      PReCalc = 'Y'                                              187056
126330200529     C                   EXSR      SrCDefault                                                 187056
126340200529     C                   EVAL      PPrvCDRO = DDCDRO                                          187056
126350200529     C                   EVAL      PPRVCDBR = DDCDBR                                          187056
126360200529     C                   EVAL      PPrvCDRT = IPCDRT                                          187056
126370200529     C                   EVAL      PReCalc = 'N'                                              187056
126380200529     C                   EVAL      WReDspChg = 'Y'                                            187056
126390200529     C                   ENDIF                                                                187056
126400200529      *                                                                                       187056
126410200529     C                   ENDSR                                                                187056
126420200529      *                                                                                       187056
126430200529      *****************************************************************                       187056
126440200529      /EJECT                                                                                  CER001
126450200529      *****************************************************************                       CER001
126460200529      *                                                               *                       CER001
126470200529      * SRUPDAT - Update the extension file                           *                       CER001
126480200529      *                                                               *                       CER001
126490200529      *****************************************************************                       CER001
126500200529      *                                                                                       CER001
126510200529     C     SRUPDAT       BEGSR                                                                CER001
126520200529      *                                                                                       CER001
126530200529     C                   CALLB     'FTIPAY2UP'                                                CER001
126540200529     C                   PARM                    DDACTN                                       CER001
126550200529     C                   PARM      *BLANK        @RTCD                                        CER001
126560200529     C                   PARM                    WFIND                                        CER001
126570200529     C                   PARM                    NwDlFilFmt                                   CER001
126580200529     C                   PARM                    CrDlFilFmt                                   CER001
126590200529      *                                                                                       CER001
126600200529      ** If there were any errors in the update functions, rollback any                       CER001
126610200529      ** updates and end this pgm                                                             CER001
126620200529      *                                                                                       CER001
126630200529     C                   IF        @RTCD <> *Blank and                                        CER001
126640200529     C                             @RTCD <> '*RECUPD' and                                     CER001
126650200529     C                             @RTCD <> '*RECLCK'                                         CER001
126660200529     C                   ROLBK                                                                CER001
126670200529     C                   EXSR      *PSSR                                                      CER001
126680200529     C                   ELSE                                                                 CER001
126690200529     C                   ENDIF                                                                CER001
126700200529      *                                                                                       CER001
126710200529      ** If update not done due to record has been updated by another                         CER001
126720200529      ** workstation send message to screen.                                                  CER001
126730200529      *                                                                                       CER001
126740200529     C                   IF        @RTCD = '*RECUPD'                                          CER001
126750200529     C                   EVAL      FldNameArr(1) = '*ANY'                                     CER001
126760200529     C                   EVAL      #MsgID = 'XXX9000'                                         CER001
126770200529     C                   EVAL      MsgIdArr(1) = #MsgID                                       CER001
126780200529     C                   EVAL      WWERR = ' '                                                CER001
126790200529     C                   ENDIF                                                                CER001
126800200529      *                                                                                       CER001
126810200529      ** If update not done due to record being locked by another                             CER001
126820200529      ** workstation send message to screen.                                                  CER001
126830200529      *                                                                                       CER001
126840200529     C                   IF        @RTCD = '*RECLCK'                                          CER001
126850200529     C                   EVAL      FldNameArr(1) = '*ANY'                                     CER001
126860200529     C                   EVAL      #MsgID = 'ULX0208'                                         CER001
126870200529     C                   EVAL      MsgIdArr(1) = #MsgID                                       CER001
126880200529     C                   EVAL      WWERR = ' '                                                CER001
126890200529     C                   ENDIF                                                                CER001
126900200529      *                                                                                       CER001
126910200529     C                   ENDSR                                                                CER001
126920200529      *****************************************************************                       CER001
126930200529      /EJECT
126940200529     C/COPY WNCPYSRC,FTIPAYSC36
126950200529      *****************************************************************
126960200529      *                                                               *
126970200529      *  *INZSR - Program Initialisation                              *
126980200529      *         - This subroutine runs automatically for program      *
126990200529      *           initialisation.                                     *
127000200529      *                                                               *
127010200529      *****************************************************************
127020200529      *
127030200529     C     *INZSR        BEGSR
127040200529      *
127050200529      ** Receive entry parameters.
127060200529      *
127070200529     C     *ENTRY        PLIST
127080200529      *
127090200529      ** Action Code
127100200529     C                   PARM                    PParmActn         1
127110200529      *
127120200529      ** Payment Reference
127130200529     C                   PARM                    PParmPRef        15
127140200529      *
127150200529      ** Return Code
127160200529     C                   PARM                    PParmRtcd         1
127170200529      *
127180200529      ** Linked Maintenance
127190200529     C                   PARM                    PParmLink         1
127200200529      *
127210200529      ** Screen Level
127220200529     C                   PARM                    PParmLevel        1
127230200529      *
127240200529      ** Access Bank details.
127250200529      *
127260200529     C                   CALLB     'AOBANKR0'
127270200529     C                   PARM      *BLANKS       PRTCD             7
127280200529     C                   PARM      '*FIRST '     POPTN             7
127290200529     C     SDBANK        PARM      SDBANK        DSFDY
127300200529      *
127310200529      ** Database error.
127320200529      *
127330200529     C     PRTCD         IFNE      *BLANKS
127340200529     C                   MOVEL     POPTN         DBKEY
127350200529     C                   MOVEL     'SDBANKPD'    DBFILE
127360200529     C                   Z-ADD     001           DBASE
127370200529     C                   EXSR      *PSSR
127380200529     C                   ENDIF
127390200529      *
127400200529      ** Access General Ledger ICD details.
127410200529      *
127420200529     C**********         CALLB     'AOGELRR0'                                                 CGL029
127430200529     C                   CALL      'AOGELRR1'                                                 CGL029
127440200529     C                   PARM      *BLANKS       PRTCD
127450200529     C                   PARM      '*FIRST '     POPTN
127460200529     C     SDGELR        PARM      SDGELR        DSSDY
127470200529      *
127480200529      ** Database error.
127490200529      *
127500200529     C     PRTCD         IFNE      *BLANKS
127510200529     C                   MOVEL     POPTN         DBKEY
127520200529     C                   MOVEL     'SDGELRPD'    DBFILE
127530200529     C                   Z-ADD     002           DBASE
127540200529     C                   EXSR      *PSSR
127550200529     C                   ENDIF
127560200529      *
127570200529      ** Access Midas Modules details.
127580200529      *
127590200529     C                   CALLB     'AOMMODR0'
127600200529     C                   PARM      *BLANKS       PRTCD
127610200529     C                   PARM      '*FIRST '     POPTN
127620200529     C     SDMMOD        PARM      SDMMOD        DSFDY
127630200529      *
127640200529      ** Database error.
127650200529      *
127660200529     C     PRTCD         IFNE      *BLANKS
127670200529     C                   MOVEL     POPTN         DBKEY
127680200529     C                   MOVEL     'SDMMODPD'    DBFILE
127690200529     C                   Z-ADD     003           DBASE
127700200529     C                   EXSR      *PSSR
127710200529     C                   ENDIF
127720200529      *
127730200529      ** Access Funds Transfer ICD details.
127740200529      *
127750200529     C                   CALL      'AOFTFRR0'
127760200529     C                   PARM      *BLANKS       PRTCD
127770200529     C                   PARM      '*FIRST '     POPTN
127780200529     C     SDFTFR        PARM      SDFTFR        DSFDY
127790200529      *
127800200529      ** Database error.
127810200529      *
127820200529     C     PRTCD         IFNE      *BLANKS
127830200529     C                   MOVEL     POPTN         DBKEY
127840200529     C                   MOVEL     'SDFTFRPD'    DBFILE
127850200529     C                   Z-ADD     004           DBASE
127860200529     C                   EXSR      *PSSR
127870200529     C                   ENDIF
127880200529      *
127890200529      ** Access Retail ICD details if Retail module is
127900200529      ** installed.
127910200529      *
127920200529     C     BGRTBN        IFEQ      'Y'
127930200529      *
127940200529     C                   CALLB     'AORETLR0'
127950200529     C                   PARM      *BLANKS       PRTCD
127960200529     C                   PARM      '*FIRST '     POPTN
127970200529     C     SDRETL        PARM      SDRETL        DSFDY
127980200529      *
127990200529      ** Database error.
128000200529      *
128010200529     C     PRTCD         IFNE      *BLANKS
128020200529     C                   MOVEL     POPTN         DBKEY
128030200529     C                   MOVEL     'SDRETLPD'    DBFILE
128040200529     C                   Z-ADD     005           DBASE
128050200529     C                   EXSR      *PSSR
128060200529     C                   ENDIF
128070200529      *
128080200529     C                   ENDIF
128090200529      *
128100200529      ** Access SAR file to determine if S01494
128110200529      ** (BLI FT Enhancements Feature) is installed.
128120200529      *
128130200529     C                   CALLB     'AOSARDR0'
128140200529     C                   PARM      *BLANKS       PRTCD
128150200529     C                   PARM      '*VERIFY'     POPTN
128160200529     C                   PARM      'S01494'      PSARD             6
128170200529     C     SCSARD        PARM      SCSARD        DSFDY
128180200529      *
128190200529      ** An NRF (No Record Found) return code is valid.
128200200529      ** Issue database error only for error return codes.
128210200529      *
128220200529     C     PRTCD         IFNE      *BLANKS
128230200529     C     PRTCD         ANDNE     '*NRF   '
128240200529     C                   MOVEL     'S01494'      DBKEY
128250200529     C                   MOVEL     'SCSARDPD'    DBFILE
128260200529     C                   Z-ADD     006           DBASE
128270200529     C                   EXSR      *PSSR
128280200529     C                   ENDIF
128290200529      *
128300200529     C     PRTCD         IFEQ      *BLANK
128310200529     C                   MOVEL     'Y'           S01494            1
128320200529     C                   ELSE
128330200529     C                   MOVEL     'N'           S01494
128340200529     C                   ENDIF
128350200529      *
128360200529      ** Access SAR file to determine if S01499 (BLI VAT Processing)
128370200529      ** is installed.
128380200529      *
128390200529     C                   CALLB     'AOSARDR0'
128400200529     C                   PARM      *BLANKS       PRTCD
128410200529     C                   PARM      '*VERIFY'     POPTN
128420200529     C                   PARM      'S01499'      PSARD
128430200529     C     SCSARD        PARM      SCSARD        DSFDY
128440200529      *
128450200529      ** An NRF (No Record Found) return code is valid.
128460200529      ** Issue database error only for error return codes.
128470200529      *
128480200529     C     PRTCD         IFNE      *BLANKS
128490200529     C     PRTCD         ANDNE     '*NRF   '
128500200529     C                   MOVEL     'S01499'      DBKEY
128510200529     C                   MOVEL     'SCSARDPD'    DBFILE
128520200529     C                   Z-ADD     007           DBASE
128530200529     C                   EXSR      *PSSR
128540200529     C                   ENDIF
128550200529      *
128560200529     C     PRTCD         IFEQ      *BLANK
128570200529     C                   MOVEL     'Y'           S01499            1
128580200529     C                   ELSE
128590200529     C                   MOVEL     'N'           S01499
128600200529     C                   ENDIF
128610200529      *
128620200529      ** Access SAR file to determine if S01506 (BLI Payment Charges
128630200529      ** Enhancements) is installed.
128640200529      *
128650200529     C                   CALLB     'AOSARDR0'
128660200529     C                   PARM      *BLANKS       PRTCD
128670200529     C                   PARM      '*VERIFY'     POPTN
128680200529     C                   PARM      'S01506'      PSARD
128690200529     C     SCSARD        PARM      SCSARD        DSFDY
128700200529      *
128710200529      ** An NRF (No Record Found) return code is valid.
128720200529      ** Issue database error only for error return codes.
128730200529      *
128740200529     C     PRTCD         IFNE      *BLANKS
128750200529     C     PRTCD         ANDNE     '*NRF   '
128760200529     C                   MOVEL     'S01506'      DBKEY
128770200529     C                   MOVEL     'SCSARDPD'    DBFILE
128780200529     C                   Z-ADD     008           DBASE
128790200529     C                   EXSR      *PSSR
128800200529     C                   ENDIF
128810200529      *
128820200529     C     PRTCD         IFEQ      *BLANK
128830200529     C                   MOVEL     'Y'           S01506            1
128840200529     C                   ELSE
128850200529     C                   MOVEL     'N'           S01506
128860200529     C                   ENDIF
128870200529      *
128880200529      ** Access SAR file to determine if S01508 (BLI Extended Payment
128890200529      ** Charges) is installed.
128900200529      *
128910200529     C                   CALLB     'AOSARDR0'
128920200529     C                   PARM      *BLANKS       PRTCD
128930200529     C                   PARM      '*VERIFY'     POPTN
128940200529     C                   PARM      'S01508'      PSARD
128950200529     C     SCSARD        PARM      SCSARD        DSFDY
128960200529      *
128970200529      ** An NRF (No Record Found) return code is valid.
128980200529      ** Issue database error only for error return codes.
128990200529      *
129000200529     C     PRTCD         IFNE      *BLANKS
129010200529     C     PRTCD         ANDNE     '*NRF   '
129020200529     C                   MOVEL     'S01508'      DBKEY
129030200529     C                   MOVEL     'SCSARDPD'    DBFILE
129040200529     C                   Z-ADD     009           DBASE
129050200529     C                   EXSR      *PSSR
129060200529     C                   ENDIF
129070200529      *
129080200529     C     PRTCD         IFEQ      *BLANK
129090200529     C                   MOVEL     'Y'           S01508            1
129100200529     C                   ELSE
129110200529     C                   MOVEL     'N'           S01508
129120200529     C                   ENDIF
129130200529      *
129140200529      ** Access SAR file to determine if CEU006 (EMU FT Settlement
129150200529      ** Currency Conversion) is installed.
129160200529      *
129170200529     C                   CALLB     'AOSARDR0'
129180200529     C                   PARM      *BLANKS       PRTCD
129190200529     C                   PARM      '*VERIFY'     POPTN
129200200529     C                   PARM      'CEU006'      PSARD
129210200529     C     SCSARD        PARM      SCSARD        DSFDY
129220200529      *
129230200529      ** An NRF (No Record Found) return code is valid.
129240200529      ** Issue database error only for error return codes.
129250200529      *
129260200529     C     PRTCD         IFNE      *BLANKS
129270200529     C     PRTCD         ANDNE     '*NRF   '
129280200529     C                   MOVEL     'CEU006'      DBKEY
129290200529     C                   MOVEL     'SCSARDPD'    DBFILE
129300200529     C                   Z-ADD     010           DBASE
129310200529     C                   EXSR      *PSSR
129320200529     C                   ENDIF
129330200529      *
129340200529     C     PRTCD         IFEQ      *BLANK
129350200529     C                   MOVEL     'Y'           CEU006            1
129360200529     C                   ELSE
129370200529     C                   MOVEL     'N'           CEU006
129380200529     C                   ENDIF
129390200529      *
129400200529      ** Access SAR file to determine if CFT003 (Batch Authorisation)
129410200529      ** is installed.
129420200529      *
129430200529     C                   CALLB     'AOSARDR0'
129440200529     C                   PARM      *BLANKS       PRTCD
129450200529     C                   PARM      '*VERIFY'     POPTN
129460200529     C                   PARM      'CFT003'      PSARD
129470200529     C     SCSARD        PARM      SCSARD        DSFDY
129480200529      *
129490200529      ** An NRF (No Record Found) return code is valid.
129500200529      ** Issue database error only for error return codes.
129510200529      *
129520200529     C     PRTCD         IFNE      *BLANKS
129530200529     C     PRTCD         ANDNE     '*NRF   '
129540200529     C                   MOVEL     'CFT003'      DBKEY
129550200529     C                   MOVEL     'SCSARDPD'    DBFILE
129560200529     C                   Z-ADD     011           DBASE
129570200529     C                   EXSR      *PSSR
129580200529     C                   ENDIF
129590200529      *
129600200529     C     PRTCD         IFEQ      *BLANK
129610200529     C                   MOVEL     'Y'           CFT003            1
129620200529     C                   ELSE
129630200529     C                   MOVEL     'N'           CFT003
129640200529     C                   ENDIF
129650200529      *
129660200529      ** Access SAR file to determine if CFT002 (Straight
129670200529      ** Through Processing Phase 1) is installed.
129680200529      *
129690200529     C                   CALLB     'AOSARDR0'
129700200529     C                   PARM      *BLANKS       PRTCD
129710200529     C                   PARM      '*VERIFY'     POPTN
129720200529     C                   PARM      'CFT002'      PSARD
129730200529     C     SCSARD        PARM      SCSARD        DSFDY
129740200529      *
129750200529      ** An NRF (No Record Found) return code is valid.
129760200529      ** Issue database error only for error return codes.
129770200529      *
129780200529     C     PRTCD         IFNE      *BLANKS
129790200529     C     PRTCD         ANDNE     '*NRF   '
129800200529     C                   MOVEL     'CFT002'      DBKEY
129810200529     C                   MOVEL     'SCSARDPD'    DBFILE
129820200529     C                   Z-ADD     012           DBASE
129830200529     C                   EXSR      *PSSR
129840200529     C                   ENDIF
129850200529      *
129860200529     C     PRTCD         IFEQ      *BLANK
129870200529     C                   MOVEL     'Y'           CFT002            1
129880200529     C                   ELSE
129890200529     C                   MOVEL     'N'           CFT002
129900200529     C                   ENDIF
129910200529      *                                                                         CFT014
129920200529      ** Straight Through Processing - Phase 2                                  CFT014
129930200529      *                                                                         CFT014
129940200529     C                   CALLB     'AOSARDR0'                                   CFT014
129950200529     C                   PARM      *BLANKS       PRTCD                          CFT014
129960200529     C                   PARM      '*VERIFY'     POPTN                          CFT014
129970200529     C                   PARM      'CFT014'      PSARD                          CFT014
129980200529     C     SCSARD        PARM      SCSARD        DSFDY                          CFT014
129990200529     C     PRTCD         IFNE      *BLANKS                                      CFT014
130000200529     C     PRTCD         ANDNE     '*NRF   '                                    CFT014
130010200529     C                   MOVEL     'CFT014'      DBKEY                          CFT014
130020200529     C                   MOVEL     'SCSARDPD'    DBFILE                         CFT014
130030200529     C                   Z-ADD     33            DBASE                          CFT014
130040200529     C                   EXSR      *PSSR                                        CFT014
130050200529     C                   ENDIF                                                  CFT014
130060200529      *                                                                         CFT014
130070200529     C     PRTCD         IFEQ      *BLANK                                       CFT014
130080200529     C                   MOVEL     'Y'           CFT014            1            CFT014
130090200529     C                   ELSE                                                   CFT014
130100200529     C                   MOVEL     'N'           CFT014                         CFT014
130110200529     C                   ENDIF                                                  CFT014
130120200529      *
130130200529      ** Access SAR file to determine if CFT004 (IBAN
130140200529      ** numbers) is installed.
130150200529      *
130160200529     C                   CALLB     'AOSARDR0'
130170200529     C                   PARM      *BLANKS       PRTCD
130180200529     C                   PARM      '*VERIFY'     POPTN
130190200529     C                   PARM      'CFT004'      PSARD
130200200529     C     SCSARD        PARM      SCSARD        DSFDY
130210200529      *
130220200529      ** An NRF (No Record Found) return code is valid.
130230200529      ** Issue database error only for error return codes.
130240200529      *
130250200529     C     PRTCD         IFNE      *BLANKS
130260200529     C     PRTCD         ANDNE     '*NRF   '
130270200529     C                   MOVEL     'CFT004'      DBKEY
130280200529     C                   MOVEL     'SCSARDPD'    DBFILE
130290200529     C                   Z-ADD     013           DBASE
130300200529     C                   EXSR      *PSSR
130310200529     C                   ENDIF
130320200529      *
130330200529     C     PRTCD         IFEQ      *BLANK
130340200529     C                   MOVEL     'Y'           CFT004            1
130350200529     C                   ELSE
130360200529     C                   MOVEL     'N'           CFT004
130370200529     C                   ENDIF
130380200529      *
130390200529      ** Access SAR file to determine if CFT007 (BIC database
130400200529      ** plus) is installed.
130410200529      *
130420200529     C                   CALLB     'AOSARDR0'
130430200529     C                   PARM      *BLANKS       PRTCD
130440200529     C                   PARM      '*VERIFY'     POPTN
130450200529     C                   PARM      'CFT007'      PSARD
130460200529     C     SCSARD        PARM      SCSARD        DSFDY
130470200529      *
130480200529      ** An NRF (No Record Found) return code is valid.
130490200529      ** Issue database error only for error return codes.
130500200529      *
130510200529     C     PRTCD         IFNE      *BLANKS
130520200529     C     PRTCD         ANDNE     '*NRF   '
130530200529     C                   MOVEL     'CFT007'      DBKEY
130540200529     C                   MOVEL     'SCSARDPD'    DBFILE
130550200529     C                   Z-ADD     014           DBASE
130560200529     C                   EXSR      *PSSR
130570200529     C                   ENDIF
130580200529      *
130590200529     C     PRTCD         IFEQ      *BLANK
130600200529     C                   MOVEL     'Y'           CFT007            1
130610200529     C                   ELSE
130620200529     C                   MOVEL     'N'           CFT007
130630200529     C                   ENDIF
130640200529      *                                                                                     MD022652
130650200529      ** Access SAR file to determine if CFT050 (SWIFTRef Directories                       MD022652
130660200529      ** upload) is installed.                                                              MD022652
130670200529      *                                                                                     MD022652
130680200529     C                   CALLB     'AOSARDR0'                                               MD022652
130690200529     C                   PARM      *BLANKS       PRTCD                                      MD022652
130700200529     C                   PARM      '*VERIFY'     POPTN                                      MD022652
130710200529     C                   PARM      'CFT050'      PSARD                                      MD022652
130720200529     C     SCSARD        PARM      SCSARD        DSFDY                                      MD022652
130730200529      *                                                                                     MD022652
130740200529      ** CFT007 process will take place when CFT050 is switched on                          MD022652
130750200529      *                                                                                     MD022652
130760200529     C                   IF        PRTCD = *BLANKS                                          MD022652
130770200529     C                   EVAL      CFT007 = 'Y'                                             MD022652
130780200529     C                   ENDIF                                                              MD022652
130790200529      *
130800200529      ** Access SAR file to determine if CGL009 (Electronic Banking
130810200529      ** Interface IATs and TPPs) is installed.
130820200529      *
130830200529     C                   CALLB     'AOSARDR0'
130840200529     C                   PARM      *BLANKS       PRTCD
130850200529     C                   PARM      '*VERIFY'     POPTN
130860200529     C                   PARM      'CGL009'      PSARD
130870200529     C     SCSARD        PARM      SCSARD        DSFDY
130880200529      *
130890200529      ** An NRF (No Record Found) return code is valid.
130900200529      ** Issue database error only for error return codes.
130910200529      *
130920200529     C     PRTCD         IFNE      *BLANKS
130930200529     C     PRTCD         ANDNE     '*NRF   '
130940200529     C                   MOVEL     'CGL009'      DBKEY
130950200529     C                   MOVEL     'SCSARDPD'    DBFILE
130960200529     C                   Z-ADD     031           DBASE
130970200529     C                   EXSR      *PSSR
130980200529     C                   ENDIF
130990200529      *
131000200529     C     PRTCD         IFEQ      *BLANK
131010200529     C                   MOVEL     'Y'           CGL009            1
131020200529     C                   ELSE
131030200529     C                   MOVEL     'N'           CGL009
131040200529     C                   ENDIF
131050200529     C/COPY WNCPYSRC,FTIPAYSC37
131060200529      *                                                                         CFT009
131070200529      ** Access SAR file to determine if CFT009 is installed                    CFT009
131080200529      *                                                                         CFT009
131090200529     C                   CALLB     'AOSARDR0'                                   CFT009
131100200529     C                   PARM      *BLANKS       PRTCD                          CFT009
131110200529     C                   PARM      '*VERIFY'     POPTN                          CFT009
131120200529     C                   PARM      'CFT009'      PSARD                          CFT009
131130200529     C     SCSARD        PARM      SCSARD        DSFDY                          CFT009
131140200529      *                                                                         CFT009
131150200529      ** An NRF (No Record Found) return code is valid.                         CFT009
131160200529      ** Issue database error only for error return codes.                      CFT009
131170200529      *                                                                         CFT009
131180200529     C     PRTCD         IFNE      *BLANKS                                      CFT009
131190200529     C     PRTCD         ANDNE     '*NRF   '                                    CFT009
131200200529     C                   MOVEL     'CFT009'      DBKEY                          CFT009
131210200529     C                   MOVEL     'SCSARDPD'    DBFILE                         CFT009
131220200529     C                   Z-ADD     036           DBASE                          CFT009
131230200529     C                   EXSR      *PSSR                                        CFT009
131240200529     C                   ENDIF                                                  CFT009
131250200529      *                                                                         CFT009
131260200529     C     PRTCD         IFEQ      *BLANK                                       CFT009
131270200529     C                   MOVEL     'Y'           CFT009            1            CFT009
131280200529     C                   ELSE                                                   CFT009
131290200529     C                   MOVEL     'N'           CFT009                         CFT009
131300200529     C                   ENDIF                                                  CFT009
131310200529      *                                                                         CFT009
131320200529      ** Access SAR file to determine if CFT010 is installed                    CFT009
131330200529      *                                                                         CFT009
131340200529     C                   CALLB     'AOSARDR0'                                   CFT009
131350200529     C                   PARM      *BLANKS       PRTCD                          CFT009
131360200529     C                   PARM      '*VERIFY'     POPTN                          CFT009
131370200529     C                   PARM      'CFT010'      PSARD                          CFT009
131380200529     C     SCSARD        PARM      SCSARD        DSFDY                          CFT009
131390200529      *                                                                         CFT009
131400200529      ** An NRF (No Record Found) return code is valid.                         CFT009
131410200529      ** Issue database error only for error return codes.                      CFT009
131420200529      *                                                                         CFT009
131430200529     C     PRTCD         IFNE      *BLANKS                                      CFT009
131440200529     C     PRTCD         ANDNE     '*NRF   '                                    CFT009
131450200529     C                   MOVEL     'CFT010'      DBKEY                          CFT009
131460200529     C                   MOVEL     'SCSARDPD'    DBFILE                         CFT009
131470200529     C                   Z-ADD     037           DBASE                          CFT009
131480200529     C                   EXSR      *PSSR                                        CFT009
131490200529     C                   ENDIF                                                  CFT009
131500200529      *                                                                         CFT009
131510200529     C     PRTCD         IFEQ      *BLANK                                       CFT009
131520200529     C                   MOVEL     'Y'           CFT010            1            CFT009
131530200529     C                   ELSE                                                   CFT009
131540200529     C                   MOVEL     'N'           CFT010                         CFT009
131550200529     C                   ENDIF                                                  CFT009
131560200529      *                                                                                       CFT151
131570200529      ** Access SAR file to determine if CFT151 is installed                                  CFT151
131580200529      *                                                                                       CFT151
131590200529     C                   CALLB     'AOSARDR0'                                                 CFT151
131600200529     C                   PARM      *BLANKS       PRTCD                                        CFT151
131610200529     C                   PARM      '*VERIFY'     POPTN                                        CFT151
131620200529     C                   PARM      'CFT151'      PSARD                                        CFT151
131630200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CFT151
131640200529      *                                                                                       CFT151
131650200529      ** An NRF (No Record Found) return code is valid.                                       CFT151
131660200529      ** Issue database error only for error return codes.                                    CFT151
131670200529      *                                                                                       CFT151
131680200529     C     PRTCD         IFNE      *BLANKS                                                    CFT151
131690200529     C     PRTCD         ANDNE     '*NRF   '                                                  CFT151
131700200529     C                   MOVEL     'CFT151'      DBKEY                                        CFT151
131710200529     C                   MOVEL     'SCSARDPD'    DBFILE                                       CFT151
131720200529     C                   Z-ADD     037           DBASE                                        CFT151
131730200529     C                   EXSR      *PSSR                                                      CFT151
131740200529     C                   ENDIF                                                                CFT151
131750200529      *                                                                                       CFT151
131760200529     C     PRTCD         IFEQ      *BLANK                                                     CFT151
131770200529     C                   MOVEL     'Y'           CFT151            1                          CFT151
131780200529     C                   ELSE                                                                 CFT151
131790200529     C                   MOVEL     'N'           CFT151                                       CFT151
131800200529     C                   ENDIF                                                                CFT151
131810200529                                                                                              CSC011
131820200529     C                   EVAL      PPROCDTE = BJRDNB                                          CSC011
131830200529                                                                                              CSC011
131840200529      ** Access SAR details file to see if 24X7 (CSC011) is installed.                        CSC011
131850200529                                                                                              CSC011
131860200529     C                   CALLB     'AOSARDR0'                                                 CSC011
131870200529     C                   PARM      *BLANKS       PRTCD                                        CSC011
131880200529     C                   PARM      '*VERIFY'     POPTN                                        CSC011
131890200529     C                   PARM      'CSC011'      PSARD                                        CSC011
131900200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSC011
131910200529                                                                                              CSC011
131920200529     C                   IF        PRTCD <> *BLANKS AND                                       CSC011
131930200529     C                             PRTCD <> '*NRF   '                                         CSC011
131940200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CSC011
131950200529     C                   EVAL      DBASE = 38                                                 CSC011
131960200529     C                   EVAL      DBKEY = 'CSC011'                                           CSC011
131970200529     C                   EXSR      *PSSR                                                      CSC011
131980200529     C                   ENDIF                                                                CSC011
131990200529                                                                                              CSC011
132000200529     C                   IF        PRTCD = *BLANKS                                            CSC011
132010200529     C                   EVAL      CSC011 = 'Y'                                               CSC011
132020200529                                                                                              CSC011
132030200529      ** Get support system prefix and current system prefix                                  CSC011
132040200529                                                                                              CSC011
132050200529     C                   IN        SC24X7                                                     CSC011
132060200529     C                   IN        SDSTAT                                                     CSC011
132070200529                                                                                              CSC011
132080200529      ** Use processing date defined in SC24X7 dataarea when support system is active         CSC011
132090200529                                                                                              CSC011
132100200529     C                   IF        LIBR = S1SUPP                                              CSC011
132110200529     C                   EVAL      PPROCDTE = WPRDTE                                          CSC011
132120200529     C                   ENDIF                                                                CSC011
132130200529     C                   ELSE                                                                 CSC011
132140200529     C                   EVAL      CSC011 = 'N'                                               CSC011
132150200529     C                   ENDIF                                                                CSC011
132160200529      *                                                                                       CSW209
132170200529      ** Check if SWIFT 2009 feature is ON                                                    CSW209
132180200529      *                                                                                       CSW209
132190200529     C                   CALL      'SWIF2009'                                                 CSW209
132200200529     C                   PARM      *BLANKS       PRTCD                                        CSW209
132210200529      *                                                                                       CSW209
132220200529     C                   IF        PRTCD = 'CSW2009'                                          CSW209
132230200529     C                   EVAL      CSW209 = 'Y'                                               CSW209
132240200529     C                   ELSE                                                                 CSW209
132250200529     C                   EVAL      CSW209 = 'N'                                               CSW209
132260200529     C                   ENDIF                                                                CSW209
132270200529      *                                                                                       CSW209
132280200529                                                                                              CSD015
132290200529      ** Check if Compliance Watch Enhancement (CSD015) is installed                          CSD015
132300200529                                                                                              CSD015
132310200529     C                   EVAL      CSD015 = 'N'                                               CSD015
132320200529                                                                                              CSD015
132330200529     C                   CALLB     'AOSARDR0'                                                 CSD015
132340200529     C                   PARM      *Blank        PRtCd                                        CSD015
132350200529     C                   PARM      '*VERIFY'     POptn                                        CSD015
132360200529     C                   PARM      'CSD015'      PSard                                        CSD015
132370200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSD015
132380200529                                                                                              CSD015
132390200529      ** Database error                                                                       CSD015
132400200529                                                                                              CSD015
132410200529     C                   IF        (PRtCd <> *BLANKS) AND                                     CSD015
132420200529     C                             (PRtCd <> '*NRF   ')                                       CSD015
132430200529     C                   EVAL      DBKey = 'CSD015'                                           CSD015
132440200529     C                   EVAL      DBFile = 'SCSARDPD'                                        CSD015
132450200529     C                   EVAL      DBase = 39                                                 CSD015
132460200529     C                   EXSR      *PSSR                                                      CSD015
132470200529     C                   ENDIF                                                                CSD015
132480200529                                                                                              CSD015
132490200529     C                   IF        PRtCd = *Blank                                             CSD015
132500200529     C                   EVAL      CSD015 = 'Y'                                               CSD015
132510200529     C                   ENDIF                                                                CSD015
132520200529                                                                                              CSD015
132530200529      **  Access SAR details to see if CCF001 is switched on.                                 CSD015
132540200529                                                                                              CSD015
132550200529     C                   EVAL      CCF001 = 'N'                                               CSD015
132560200529     C                   CALL      'AOSARDR0'                                                 CSD015
132570200529     C                   PARM      *BLANKS       PrtCd                                        CSD015
132580200529     C                   PARM      '*VERIFY'     POptn                                        CSD015
132590200529     C                   PARM      'CCF001'      @SARD                                        CSD015
132600200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSD015
132610200529                                                                                              CSD015
132620200529      ** Database error                                                                       CSD015
132630200529                                                                                              CSD015
132640200529     C                   IF        PrtCd <> *Blanks  AND                                      CSD015
132650200529     C                             PrtCd <> '*NRF'                                            CSD015
132660200529     C     *LOCK         IN        LDA                                                        CSD015
132670200529     C                   EVAL      DBKey = 'CCF001'                                           CSD015
132680200529     C                   EVAL      DBFile = 'SCSARDPD'                                        CSD015
132690200529     C                   EVAL      DBase = 40                                                 CSD015
132700200529     C                   EXSR      *PSSR                                                      CSD015
132710200529     C                   ENDIF                                                                CSD015
132720200529                                                                                              CSD015
132730200529     C                   IF        PrtCd = *BLANKS                                            CSD015
132740200529     C                   EVAL      CCF001 = 'Y'                                               CSD015
132750200529     C                   ENDIF                                                                CSD015
132760200529                                                                                              CSD015
132770200529      **                                                                                      CSC022
132780200529      ** Access SAR details to see if CSC022 is switched on                                   CSC022
132790200529      **                                                                                      CSC022
132800200529     C                   CallB     'AOSARDR0'                                                 CSC022
132810200529     C                   Parm      *Blanks       PRtCd                                        CSC022
132820200529     C                   Parm      '*VERIFY'     POptn                                        CSC022
132830200529     C                   Parm      'CSC022'      PSard                                        CSC022
132840200529     C     SCSARD        Parm      SCSARD        DSFDY                                        CSC022
132850200529      ** Initialize CSC022 and Skip Commit Flags                                              CSC022
132860200529     C                   Eval      CSC022 = 'N'                                               CSC022
132870200529     C                   Eval      WSkpComtRolbk = 'N'                                        CSC022
132880200529      **                                                                                      CSC022
132890200529     C                   If        PRtCd = *BLANKS                                            CSC022
132900200529     C                   Eval      CSC022 = 'Y'                                               CSC022
132910200529      **                                                                                      CSC022
132920200529      ** Get Jobs currently running i batch mode using SCCMRJOB dataarea                      CSC022
132930200529      **                                                                                      CSC022
132940200529     C                   In        SCCMTJOB                                                   CSC022
132950200529     C                   If        ComitNum > 0                                               CSC022
132960200529      ** Move committed jobs to arrary for checking                                           CSC022
132970200529     C                   MoveA     WDSJobs       WJobs                                        CSC022
132980200529      ** Verify if job running exists in array                                                CSC022
132990200529     C                   Eval      WArrPtr = %LookUp(PSJobName:WJobs)                         CSC022
133000200529     C                   If        WArrPtr > 0                                                CSC022
133010200529     C                   Eval      WSkpComtRolbk = 'Y'                                        CSC022
133020200529     C                   EndIf                                                                CSC022
133030200529     C                   EndIf                                                                CSC022
133040200529      **                                                                                      CSC022
133050200529     C                   Else                                                                 CSC022
133060200529      ** Execute *PSSR if CSC022 is not found or Database error                               CSC022
133070200529     C                   If        PRtCd <> '*NRF'                                            CSC022
133080200529     C     *Lock         In        LDA                                                        CSC022
133090200529     C                   Eval      DBFile = 'SCSARDPD'                                        CSC022
133100200529     C                   Eval      DBPgm  = 'FTIPAYSIN'                                       CSC022
133110200529     C                   Eval      DBKey  = 'CSC022'                                          CSC022
133120200529     C                   Eval      DBase  = 900                                               CSC022
133130200529     C                   Out       LDA                                                        CSC022
133140200529     C                   Exsr      *PSSR                                                      CSC022
133150200529     C                   EndIf                                                                CSC022
133160200529     C                   EndIf                                                                CSC022
133170200529      **                                                                                      CSC022
133180200529      ** Check if enhancement CGL014 (Collaterals Processing) is on                           CGL014
133190200529                                                                                              CGL014
133200200529     C                   CALLB     'AOSARDR0'                                                 CGL014
133210200529     C                   PARM      *BLANKS       PRTCD                                        CGL014
133220200529     C                   PARM      '*VERIFY'     POPTN                                        CGL014
133230200529     C                   PARM      'CGL014'      PSARD                                        CGL014
133240200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CGL014
133250200529                                                                                              CGL014
133260200529     C                   IF        PRTCD <> *BLANKS  AND  PRTCD <> '*NRF   '                  CGL014
133270200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CGL014
133280200529     C                   EVAL      DBKEY  = 'CGL014'                                          CGL014
133290200529     C                   EVAL      DBASE  = 41                                                CGL014
133300200529     C                   EXSR      *PSSR                                                      CGL014
133310200529     C                   ENDIF                                                                CGL014
133320200529                                                                                              CGL014
133330200529     C                   IF        PRTCD = *BLANKS                                            CGL014
133340200529     C                   EVAL      CGL014 = 'Y'                                               CGL014
133350200529     C                   ELSE                                                                 CGL014
133360200529     C                   EVAL      CGL014 = 'N'                                               CGL014
133370200529     C                   ENDIF                                                                CGL014
133380200529                                                                                              CGL014
133390200529      ** Check if enhancement CSC024 (Open Month End) is on                                   CSC024
133400200529                                                                                              CSC024
133410200529     C                   CALLB     'AOSARDR0'                                                 CSC024
133420200529     C                   PARM      *BLANKS       PRTCD                                        CSC024
133430200529     C                   PARM      '*VERIFY'     POPTN                                        CSC024
133440200529     C**********         PARM      'CSC024'      PSARD                                 CSC024 CSC054
133450200529     C                   PARM      'CSC054'      PSARD                                        CSC054
133460200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSC024
133470200529                                                                                              CSC024
133480200529     C                   IF        PRTCD <> *BLANKS  AND  PRTCD <> '*NRF   '                  CSC024
133490200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CSC024
133500200529     C**********         EVAL      DBKEY  = 'CSC024'                                   CSC024 CSC054
133510200529     C                   EVAL      DBKEY  = 'CSC054'                                          CSC054
133520200529     C                   EVAL      DBASE  = 42                                                CSC024
133530200529     C                   EXSR      *PSSR                                                      CSC024
133540200529     C                   ENDIF                                                                CSC024
133550200529                                                                                              CSC024
133560200529     C                   IF        PRTCD = *BLANKS                                            CSC024
133570200529     C**********         MOVEL     'Y'           CSC024            1                   CSC024 CSC054
133580200529     C                   MOVEL     'Y'           CSC054            1                          CSC054
133590200529                                                                                              CSC024
133600200529      ** Access System values                                                                 CSC024
133610200529                                                                                              CSC024
133620200529     C                   CALL      'AOSVALR0'                                                 CSC024
133630200529     C                   PARM      *BLANKS       PRetCode          7                          CSC024
133640200529     C**********         PARM      SysValOME     P@OP01           20                   CSC024 CSC054
133650200529     C                   PARM      SysValPEA     P@OP01           20                          CSC054
133660200529     C                   PARM      *BLANKS       P@VL01          200                          CSC024
133670200529     C                   PARM      *BLANKS       P@OP02           20                          CSC024
133680200529     C                   PARM      *BLANKS       P@VL02          200                          CSC024
133690200529     C                   PARM      *BLANKS       P@OP03           20                          CSC024
133700200529     C                   PARM      *BLANKS       P@VL03          200                          CSC024
133710200529     C                   PARM      *BLANKS       P@OP04           20                          CSC024
133720200529     C                   PARM      *BLANKS       P@VL04          200                          CSC024
133730200529     C                   PARM      *BLANKS       P@OP05           20                          CSC024
133740200529     C                   PARM      *BLANKS       P@VL05          200                          CSC024
133750200529     C                   PARM      *BLANKS       P@OP06           20                          CSC024
133760200529     C                   PARM      *BLANKS       P@VL06          200                          CSC024
133770200529     C                   PARM      *BLANKS       P@OP07           20                          CSC024
133780200529     C                   PARM      *BLANKS       P@VL07          200                          CSC024
133790200529     C                   PARM      *BLANKS       P@OP08           20                          CSC024
133800200529     C                   PARM      *BLANKS       P@VL08          200                          CSC024
133810200529     C                   PARM      *BLANKS       P@OP09           20                          CSC024
133820200529     C                   PARM      *BLANKS       P@VL09          200                          CSC024
133830200529     C                   PARM      *BLANKS       P@OP10           20                          CSC024
133840200529     C                   PARM      *BLANKS       P@VL10          200                          CSC024
133850200529                                                                                              CSC024
133860200529     C                   IF        PRetCode  <> *BLANKS                                       CSC024
133870200529     C                   EVAL      DBPGM = 'FTIPAYSIN'                                        CSC024
133880200529     C                   EVAL      DBFILE = 'SDSVALPD'                                        CSC024
133890200529     C                   EVAL      DBKEy = '*KEY   '                                          CSC024
133900200529     C                   EVAL      DBase = 43                                                 CSC024
133910200529     C                   EXSR      *PSSR                                                      CSC024
133920200529     C                   ELSE                                                                 CSC024
133930200529     C                   IF        P@VL01 = 'Y'                                               CSC024
133940200529     C                   MOVEL     'N'           GENPREF           1                          CSC024
133950200529     C                   ELSE                                                                 CSC024
133960200529     C                   EVAL      GENPREF = 'Y'                                              CSC024
133970200529     C                   ENDIF                                                                CSC024
133980200529     C                   ENDIF                                                                CSC024
133990200529                                                                                              CSC024
134000200529     C                   ELSE                                                                 CSC024
134010200529     C**********         EVAL      CSC024 = 'N'                                        CSC024 CSC054
134020200529     C                   EVAL      CSC054 = 'N'                                               CSC054
134030200529     C                   EVAL      GENPREF = 'Y'                                              CSC024
134040200529     C                   ENDIF                                                                CSC024
134050200529                                                                                              CSC024
134060200529     C/COPY WNCPYSRC,FTIPAYSC10
134070200529      *
134080200529      ** Read SDTRADPD for US dollar currency code
134090200529      *
134100200529     C                   CALLB     'AOTRADR0'
134110200529     C                   PARM      *BLANKS       PRTCD
134120200529     C                   PARM      '*FIRST'      POPTN
134130200529     C     SDTRAD        PARM      SDTRAD        DSFDY
134140200529
134150200529     C                   IF        PRTCD <> *BLANKS
134160200529     C                   EVAL      DBKEY = POPTN
134170200529     C                   EVAL      DBFILE = 'SDTRADPD'
134180200529     C                   EVAL      DBASE = 032
134190200529     C                   EXSR      *PSSR
134200200529     C                   ENDIF
134210200529     C/COPY WNCPYSRC,FTIPAYSC14
134220200529      *
134230200529      ** If S01499 is installed, retrieve VAT Rate.
134240200529      *
134250200529     C     S01499        IFEQ      'Y'
134260200529     C     CFT009        ANDEQ     'N'                                          CFT009
134270200529     C     CFT010        OREQ      'Y'                                          CFT009
134280200529      *
134290200529     C                   CALL      'AOVATR0'                            9090
134300200529     C                   PARM      *BLANKS       PRTCD
134310200529     C                   PARM      '*FIRST '     POPTN
134320200529     C                   PARM                    PVATDS
134330200529      *
134340200529      ** Error occurred.
134350200529      *
134360200529     C     *IN90         IFEQ      '1'
134370200529     C     PRTCD         OREQ      '*ERROR*'
134380200529     C                   MOVEL     POPTN         DBKEY
134390200529     C                   MOVEL     'ABSFI101'    DBFILE
134400200529     C                   Z-ADD     015           DBASE
134410200529     C                   EXSR      *PSSR
134420200529     C                   ENDIF
134430200529      *
134440200529     C                   ELSE                                                   CFT009
134450200529     C                   Z-ADD     0             PVATR                          CFT009
134460200529     C                   ENDIF
134470200529      *
134480200529      ** Access FT Control Data.
134490200529      *
134500200529     C                   CALL      'FT0005'                             9090
134510200529     C                   PARM      *BLANKS       PRTCD
134520200529     C                   PARM                    PCNTRL
134530200529      *
134540200529      ** Error occurred.
134550200529      *
134560200529     C     *IN90         IFEQ      '1'
134570200529     C     PRTCD         ORNE      *BLANKS
134580200529     C                   MOVEL     '*CALL'       DBKEY
134590200529     C                   MOVEL     'FT0005'      DBFILE
134600200529     C                   Z-ADD     016           DBASE
134610200529     C                   EXSR      *PSSR
134620200529     C                   ENDIF
134630200529      *
134640200529      ** Set up FT Override for GL Balances.
134650200529      *
134660200529     C     PGLUI         IFEQ      'I'
134670200529     C                   MOVEL     'Y'           PFTOV             1
134680200529     C                   ELSE
134690200529     C                   MOVEL     *BLANK        PFTOV
134700200529     C                   ENDIF
134710200529      *
134720200529      ** Access Currency details file for Base Currency details.
134730200529      *
134740200529     C                   CALL      'AOCURRR0'
134750200529     C                   PARM      *BLANKS       PRTCD
134760200529     C                   PARM      '*KEY   '     POPTN
134770200529     C                   PARM      BJCYCD        PCCY              3
134780200529     C     SDCURR        PARM      SDCURR        DSSDY
134790200529      *
134800200529     C     PRTCD         IFNE      *BLANKS
134810200529     C                   MOVEL     '*CALL'       DBKEY
134820200529     C                   MOVEL     'SDCURRPD'    DBFILE
134830200529     C                   Z-ADD     017           DBASE
134840200529     C                   EXSR      *PSSR
134850200529     C                   ENDIF
134860200529      *
134870200529     C                   Z-ADD     A6NBDP        PBCDP             1 0
134880200529      *
134890200529      ** Access Currency details file for Local Currency details.
134900200529      *
134910200529     C                   CALL      'AOCURRR0'
134920200529     C                   PARM      *BLANKS       PRTCD
134930200529     C                   PARM      '*KEY   '     POPTN
134940200529     C                   PARM      BJLCCY        PCCY
134950200529     C     SDCURR        PARM      SDCURR        DSSDY
134960200529      *
134970200529     C     PRTCD         IFNE      *BLANKS
134980200529     C                   MOVEL     '*CALL'       DBKEY
134990200529     C                   MOVEL     'SDCURRPD'    DBFILE
135000200529     C                   Z-ADD     018           DBASE
135010200529     C                   EXSR      *PSSR
135020200529     C                   ENDIF
135030200529      *
135040200529     C                   Z-ADD     A6NBDP        PLCDP             1 0
135050200529     C     A6MDIN        IFEQ      'M'
135060200529     C                   Z-ADD     1             PLMDIN            1 0
135070200529     C                   ELSE
135080200529     C                   Z-ADD     0             PLMDIN
135090200529     C                   ENDIF
135100200529     C                   Z-ADD     A6SPRT        PLSPOT           13 8
135110200529      *
135120200529      ** Retrieve ZMUSER details.
135130200529      *
135140200529     C     *DTAARA       DEFINE                  ZMUSER
135150200529     C                   IN        ZMUSER
135160200529      *
135170200529      ** Retrieve CASH information.
135180200529      *
135190200529     C     *DTAARA       DEFINE    CASH          PCSHDTA
135200200529     C                   IN        PCSHDTA
135210200529      *
135220200529      ** Reset error fields.
135230200529      *
135240200529     C                   EXSR      SRResetErr
135250200529      *
135260200529     C     PParmLink     IFEQ      'Y'
135270200529      *
135280200529     C                   MOVEL     PParmActn     DDACTN
135290200529     C                   MOVEL     PParmPRef     DDPREF
135300200529      *
135310200529     C                   SELECT
135320200529      *
135330200529     C     PParmRtcd     WHENEQ    'G'
135340200529     C                   MOVEL     'GL4442    '  PLinkPgm         10
135350200529      *
135360200529     C     PParmRtcd     WHENEQ    'Z'
135370200529     C                   MOVEL     'GL0090    '  PLinkPgm
135380200529      *
135390200529     C                   OTHER
135400200529     C                   MOVEL     *BLANKS       PLinkPgm
135410200529      *
135420200529     C     PParmActn     IFEQ      'I'
135430200529     C     PParmLevel    ANDEQ     '1'
135440200529     C                   MOVEL     *BLANKS       DDPREF
135450200529     C                   MOVEL     PParmPref     WMsgRefDS
135460200529     C                   Z-ADD     WRefMsg       PHMsgR
135470200529     C                   Z-ADD     WRefPrt       PHPart
135480200529     C                   MOVEL     *BLANKS       PHMIR
135490200529     C                   MOVEL     *BLANKS       PHMOR
135500200529     C                   ENDIF
135510200529      *
135520200529     C                   ENDSL
135530200529      *
135540200529     C                   MOVE      *BLANK        PParmRtcd
135550200529     C                   MOVE      'I'           WScrn
135560200529      *
135570200529      ** Validate initial screen details.
135580200529     C                   EXSR      SRVal_I
135590200529      *
135600200529     C                   ELSE
135610200529      *
135620200529     C                   MOVE      'I'           WScrn             1
135630200529      *
135640200529     C                   ENDIF
135650200529      *
135660200529      ** Get screen format of rundate.
135670200529     C                   Z-ADD     BJRDNB        PDayNo
135680200529     C                   CALLB     'ZDATE2'
135690200529     C                   PARM                    PDayNo            5 0
135700200529     C                   PARM      BJDFIN        PFMT              1
135710200529     C                   PARM      *ZERO         PDate             6 0
135720200529     C                   PARM      *BLANKS       PADate            7
135730200529     C                   MOVEL     PDate         WRUNDAY           6
135740200529      *
135750200529      ** Define Account key list.
135760200529      *
135770200529     C     KAccnt        KLIST
135780200529     C                   KFLD                    KACNUM
135790200529     C                   KFLD                    KACCCY
135800200529     C                   KFLD                    KACCD
135810200529     C                   KFLD                    KACSQ
135820200529     C                   KFLD                    KBRCA
135830200529      *                                                                                       252696
135840200529     C     KEYMP         KLIST                                                                252696
135850200529     C                   KFLD                    IPINMSGR                                     252696
135860200529     C                   KFLD                    IPINKPRT                                     252696
135870200529      *
135880200529      * Initialise flag to show first time through                                            204152
135890200529     C                   MOVE      'Y'           FirstTime         1                          204152
135900200529      *                                                                                       204152
135910200529      ** Program, module and procedure names for database error processing
135920200529      ** =================================================================
135930200529      ** The following /COPY sets these values.
135940200529      *
135950200529      /COPY ZACPYSRC,DBFIELDS
135960200529      *
135970200529      ** Hook to enable non-core initial processing to be included
135980200529      *
135990200529      /COPY WNCPYSRC,FTIPAYS014
136000200529      *                                                                                       CER001
136010200529      ** ULX043 - New IBLC 2002 as Feature                                                    CER001
136020200529      *                                                                                       CER001
136030200529     C                   MOVEL     'N'           ULX043                                       CER001
136040200529     C                   CALL      'AOSARDR0'                                                 CER001
136050200529     C                   PARM      *BLANKS       @RTCD                                        CER001
136060200529     C                   PARM      '*VERIFY'     @OPTN                                        CER001
136070200529     C                   PARM      'ULX043'      @SARD                                        CER001
136080200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CER001
136090200529      *                                                                                       CER001
136100200529      ** An NRF (No Record Found) return code is valid.                                       CER001
136110200529      ** Issue database error only for error return codes.                                    CER001
136120200529      *                                                                                       CER001
136130200529     C                   IF        PRTCD <> *BLANKS AND                                       CER001
136140200529     C                             PRTCD <> '*NRF   '                                         CER001
136150200529     C                   EVAL      DBKEY = 'ULX043'                                           CER001
136160200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CER001
136170200529     C                   Z-ADD     901           DBASE                                        CER001
136180200529     C                   EXSR      *PSSR                                                      CER001
136190200529     C                   ENDIF                                                                CER001
136200200529      *                                                                                       CER001
136210200529     C                   IF        @RTCD = *BLANKS                                            CER001
136220200529     C                   EVAL      ULX043 = 'Y'                                               CER001
136230200529      *                                                                                       CER001
136240200529      ** Do not process lux extension details when IBLC Returns                               CER001
136250200529      ** indicator is not set to 'Y'                                                          CER001
136260200529      *                                                                                       CER001
136270200529     C                   IF        BGNWST <> 'Y'                                              CER001
136280200529     C                   EVAL      ULX043 = 'N'                                               CER001
136290200529     C                   ELSE                                                                 CER001
136300200529     C                   OPEN      FTIPX1L0                                                   CER001
136310200529     C                   ENDIF                                                                CER001
136320200529     C                   ENDIF                                                                CER001
136330200529      *                                                                                       CER001
136340200529      ** CER030 - Multicash German Feature                                                    CER030
136350200529      *                                                                                       CER030
136360200529     C                   CALL      'AOSARDR0'                                                 CER030
136370200529     C                   PARM      *BLANKS       PRTCD                                        CER030
136380200529     C                   PARM      '*VERIFY'     POPTN                                        CER030
136390200529     C                   PARM      'CER030'      PSARD                                        CER030
136400200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CER030
136410200529      *                                                                                       CER030
136420200529      ** An NRF (No Record Found) return code is valid.                                       CER030
136430200529      ** Issue database error only for error return codes.                                    CER030
136440200529      *                                                                                       CER030
136450200529     C                   IF        PRTCD <> *BLANKS AND                                       CER030
136460200529     C                             PRTCD <> '*NRF   '                                         CER030
136470200529     C                   EVAL      DBKEY = 'CER030'                                           CER030
136480200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CER030
136490200529     C                   Z-ADD     902           DBASE                                        CER030
136500200529     C                   EXSR      *PSSR                                                      CER030
136510200529     C                   ENDIF                                                                CER030
136520200529      *                                                                                       CER030
136530200529     C                   IF        PRTCD = *BLANKS                                            CER030
136540200529     C                   EVAL      CER030 = 'Y'                                               CER030
136550200529     C                   ELSE                                                                 CER030
136560200529     C                   EVAL      CER030 = 'N'                                               CER030
136570200529     C                   ENDIF                                                                CER030
136580200529      *                                                                                       CER030
136590200529      ** CER031 - Multicash German Feature                                                    CER030
136600200529      *                                                                                       CER030
136610200529     C                   CALL      'AOSARDR0'                                                 CER030
136620200529     C                   PARM      *BLANKS       PRTCD                                        CER030
136630200529     C                   PARM      '*VERIFY'     POPTN                                        CER030
136640200529     C                   PARM      'CER031'      PSARD                                        CER030
136650200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CER030
136660200529      *                                                                                       CER030
136670200529      ** An NRF (No Record Found) return code is valid.                                       CER030
136680200529      ** Issue database error only for error return codes.                                    CER030
136690200529      *                                                                                       CER030
136700200529     C                   IF        PRTCD <> *BLANKS AND                                       CER030
136710200529     C                             PRTCD <> '*NRF   '                                         CER030
136720200529     C                   EVAL      DBKEY = 'CER031'                                           CER030
136730200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CER030
136740200529     C                   Z-ADD     903           DBASE                                        CER030
136750200529     C                   EXSR      *PSSR                                                      CER030
136760200529     C                   ENDIF                                                                CER030
136770200529      *                                                                                       CER030
136780200529     C                   IF        PRTCD = *BLANKS                                            CER030
136790200529     C                   EVAL      CER031 = 'Y'                                               CER030
136800200529     C                   ELSE                                                                 CER030
136810200529     C                   EVAL      CER031 = 'N'                                               CER030
136820200529     C                   ENDIF                                                                CER030
136830200529      *                                                                                       CER001
136840200529      ** CGL013 - SWIFT Switcahble Feature                                                    CER030
136850200529      *                                                                                       CER030
136860200529     C                   CALL      'AOSARDR0'                                                 CER030
136870200529     C                   PARM      *BLANKS       PRTCD                                        CER030
136880200529     C                   PARM      '*VERIFY'     POPTN                                        CER030
136890200529     C                   PARM      'CGL013'      PSARD                                        CER030
136900200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CER030
136910200529      *                                                                                       CER030
136920200529      ** An NRF (No Record Found) return code is valid.                                       CER030
136930200529      ** Issue database error only for error return codes.                                    CER030
136940200529      *                                                                                       CER030
136950200529     C                   IF        PRTCD <> *BLANKS AND                                       CER030
136960200529     C                             PRTCD <> '*NRF   '                                         CER030
136970200529     C                   EVAL      DBKEY = 'CGL013'                                           CER030
136980200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CER030
136990200529     C                   Z-ADD     904           DBASE                                        CER030
137000200529     C                   EXSR      *PSSR                                                      CER030
137010200529     C                   ENDIF                                                                CER030
137020200529      *                                                                                       CER030
137030200529     C                   IF        PRTCD = *BLANKS                                            CER030
137040200529     C                   EVAL      CGL013 = 'Y'                                               CER030
137050200529     C                   ELSE                                                                 CER030
137060200529     C                   EVAL      CGL013 = 'N'                                               CER030
137070200529     C                   ENDIF                                                                CER030
137080200529      *                                                                                       CFT120
137090200529      ** CFT120 - FT IN/OP - Charges to DR of Account Ccy                                     CFT120
137100200529      *                                                                                       CFT120
137110200529     C                   CALL      'AOSARDR0'                                                 CFT120
137120200529     C                   PARM      *BLANKS       PRTCD                                        CFT120
137130200529     C                   PARM      '*VERIFY'     POPTN                                        CFT120
137140200529     C                   PARM      'CFT120'      PSARD                                        CFT120
137150200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CFT120
137160200529      *                                                                                       CFT120
137170200529      ** An NRF (No Record Found) return code is valid.                                       CFT120
137180200529      ** Issue database error only for error return codes.                                    CFT120
137190200529      *                                                                                       CFT120
137200200529     C                   IF        PRTCD <> *BLANKS AND                                       CFT120
137210200529     C                             PRTCD <> '*NRF   '                                         CFT120
137220200529     C                   EVAL      DBKEY = 'CFT120'                                           CFT120
137230200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CFT120
137240200529     C                   Z-ADD     905           DBASE                                        CFT120
137250200529     C                   EXSR      *PSSR                                                      CFT120
137260200529     C                   ENDIF                                                                CFT120
137270200529      *                                                                                       CFT120
137280200529     C                   IF        PRTCD = *BLANKS                                            CFT120
137290200529     C                   EVAL      CFT120 = 'Y'                                               CFT120
137300200529     C                   ELSE                                                                 CFT120
137310200529     C                   EVAL      CFT120 = 'N'                                               CFT120
137320200529     C                   ENDIF                                                                CFT120
137330200529      *
137340200529     C/COPY WNCPYSRC,FTH00270
137350200529     C                   ENDSR
137360200529      *
137370200529      *****************************************************************
137380200529      /EJECT
137390200529      *****************************************************************                       225169
137400200529      *                                                               *                       225169
137410200529      *  WTRNCY   :  Translate SWIFT ccy to Midas ccy if needed.      *                       225169
137420200529      *                                                               *                       225169
137430200529      *  CALLED BY:  SREISwft, SRCYAM33B, SRFOCmt2                    *                       225169
137440200529      *                                                               *                       225169
137450200529      *****************************************************************                       225169
137460200529     C     WTRNCY        BEGSR                                                                225169
137470200529     C     W_CCY         IFNE      *BLANKS                                                    225169
137480200529     C                   CALL      'AOCURRR0'                                                 225169
137490200529     C                   PARM      *BLANKS       PRTCD                                        225169
137500200529     C                   PARM      '*KEY   '     POPTN                                        225169
137510200529     C                   PARM      W_CCY         PCCY                                         225169
137520200529     C     SDCURR        PARM      SDCURR        DSSDY                                        225169
137530200529      *                                                                                       225169
137540200529     C     PRTCD         IFNE      *BLANKS                                                    225169
137550200529      *                                                                                       225169
137560200529      ** Access SDCURRLD keyed by SWIFT currency code, in case this is                        225169
137570200529      ** different from Midas currency code.                                                  225169
137580200529      *                                                                                       225169
137590200529     C     W_CCY         CHAIN     SDCURRLD                           80                      225169
137600200529     C******IN80***      IFEQ      *ON                                                 225169 226917
137610200529     C*************      MOVEL     W_CCY         DBKEY                                 225169 226917
137620200529     C*************      MOVEL     'SDCURRPD'    DBFILE                                225169 226917
137630200529     C*************      Z-ADD     87            DBASE                                 225169 226917
137640200529     C*************      EXSR      *PSSR                                               225169 226917
137650200529     C*************      ENDIF                                                         225169 226917
137660200529     C*************      ENDIF                                                         225169 226917
137670200529      *                                                                                       226917
137680200529      * Overwrite currency code if found                                                      226917
137690200529     C     *IN80         IFEQ      *OFF                                                       226917
137700200529     C                   MOVE      A6CYCD        W_CCY             3                          225169
137710200529     C                   ENDIF                                                                226917
137720200529      *                                                                                       226917
137730200529     C                   ENDIF                                                                226917
137740200529     C                   ENDIF                                                                225169
137750200529      *                                                                                       225169
137760200529     C                   ENDSR                                                                225169
137770200529     C/COPY WNCPYSRC,FTH00271
137780200529     C/EJECT                                                                                  225169
137790200529      *****************************************************************
137800200529      *
137810200529      ** The following /COPY contains the standard program status
137820200529      ** subroutine, including a bound call to the DBERRCTL module.
137830200529      *
137840200529      /COPY ZACPYSRC,PSSR_ILE
137850200529      *
137860200529      *****************************************************************
137870200529      /EJECT
137880200529      *****************************************************************
137890200529      *
137900200529**  CPY@
137910200529(c) Finastra International Limited 2001
137920200529**  PSNAR
137930200529Payment Advice From Cashier System
