     H DEBUG
     H COPYRIGHT('(c) Finastra International Limited 2002')
      *****************************************************************
/*STD *  RPGBASEMOD                                                   *
/*EXI *  TEXT('Midas FT Creates outgoing payment records')            *
      *****************************************************************
      *                                                               *
      *  Midas - Funds Transfer Module                                *
      *                                                               *
      *  FTM10XUPO - FT Creation of Outgoing Payment Records          *
      *                                                               *
      *  Function:  This module generates outgoing payment record     *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 AR1084524          Date 13Feb13               *
      *                 CFT120             Date 28Sep12               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG25995           Date 14Sep09               *
      *                 BUG25482           Date 12Aug09               *
      *                 BUG25239           Date 29Jul09               *
      *                 BUG25207           Date 28Jul09               *
      *                 BUG25173           Date 27Jul09               *
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 256564             Date 17Sep08               *
      *                 CSW207             Date 08Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CFT032             Date 11Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 06Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      *                 221761             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 188654             Date 06Feb01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187223             Date 23Nov200              *
      *                 187211             Date 17Oct00               *
      *                 185107             Date 17Oct00               *
      *                 184060             Date 22Sep00               *
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CFT008             Date 05Jan00               *
      *                 CFT006  *CREATE    Date 03Nov99               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  AR1084524 - Performance issue on IPAY & OPAY listview        *
      *              (Recompile)                                      *
      *  CFT120 - FT IN/OP - Charges to DR of Account Currency        *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature                            *
      *  BUG25995 - Payment reference not found                       *
      *  BUG25482 - Wrong Ordering customer values for outgoing       *
      *             transaction generated by CCTD.                    *
      *  BUG25239 - Slash was remove in the Beneficiary Field value   *
      *             in the OPAY transaction generated by RFTD INCOMING*
      *  BUG25207 - FTC0100 00001 failed                              *
      *  BUG25173 - Cant authorise OPAY transaction generated by RFTD,*
      *             Database error appear                             *
      *  CSW209 - SWIFT Changes 2009                                  *
      *  256564 - Recompile due to PF changes done by fix 256330      *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  CFT032 - Account line in field 50X in MT103                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  221761 - Recompiled due to change made in PF/FT101HPD.       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  188654 - Set SLDTD1 to system run date number                *
      *  187223 - Set DSTT to A and SLDTD1 to 010101                  *
      *  187211 - Generate Timestamp                                  *
      *  185107 - Mapping of details from swift message - Recompile   *
      *  184060 - No transaction type code in detail screen -Recompile*
      *  CFT014 - Straight-through Processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *  CFT008 - Funds Transfer/Swift Messages MT102                 *
      *  CFT006 - Funds Transfer/Swift Messages MT101                 *
      *                                                               *
      *****************************************************************
 
      ** +--------------------------------------+
      ** ¦ F-specs                              ¦
      ** ¦ =======                              ¦
      ** +--------------------------------------+
 
     FFT101HL3  IF   E           K DISK    INFSR(*PSSR)
     FFT101DL0  IF   E           K DISK    INFSR(*PSSR)
     FFT102HL3  IF   E           K DISK    INFSR(*PSSR)                         CFT008
     FFT102DL0  IF   E           K DISK    INFSR(*PSSR)                         CFT008
     FOTPAYDD   O    E             DISK    INFSR(*PSSR)
     FOTPAYXPD  O    E             DISK    INFSR(*PSSR)
     FOTPAYZZ   UF   E             DISK    INFSR(*PSSR)                         187211
     FOTPAYDQD  O    E             DISK    INFSR(*PSSR)                                     BUG25995
 
      *****************************************************************
      *                                                               *
      * ID F  C  H  L    FUNCTION OF INDICATORS                       *
      *                                                               *
      *       01  No record is found                                  *
      *                                                               *
      *****************************************************************
      ** +--------------------------------------+
      ** ¦ Automatically included D-specs       ¦
      ** ¦ ==============================       ¦
      ** +--------------------------------------+
      **
      **--------------------------------------------------------------------------------------------
      ** The following /COPY line includes (among others) the LDA layout
      ** and the copyright array definition:
      ** and the following named constants:
      **    True       logical = *on (for indcator processing)
      **    False      logical = *off (for indcator processing)
      **    DBErrCtl   10A     = 'DBERRCTL' (the name of the database error
      **                                    handler)
      ** and the following variables:
      **    RunBefore  1A (for the PSSR)
 
     D/COPY ZACPYSRC,STD_D_SPEC
      **--------------------------------------------------------------------------------------------
 
      **--------------------------------------------------------------------------------------------
      ** The following /COPY includes the MM standard declares:
     D/COPY ZACPYSRC,STDDECLARE
      **--------------------------------------------------------------------------------------------
 
      ** Program Status Data Structure
      ** =============================
      ** The following /COPY line includes all the defined fields in the
      ** PSDS.  They have meaningful names, prefixed by 'PS'.
 
     D/COPY ZACPYSRC,PSDS
      **--------------------------------------------------------------------------------------------
 
      ** +--------------------------------------+
      ** ¦ End of automatically included D-specs¦
      ** ¦ =====================================¦
      ** +--------------------------------------+
 
      *****************************************************************
      /EJECT
      *****************************************************************
 
      ** +--------------------------------------+
      ** ¦ Manually included D-specs            ¦
      ** ¦ =========================            ¦
      ** +--------------------------------------+
      ** Data structure for MULTIBRANCH Indicator using rundat.                 188654
     D RUNDAT          DS                                                       188654
     D  MBIN                  13     13                                         188654
 
      ** General constant fields                                                              CFT032
                                                                                              CFT032
      /COPY FTCPYSRC,SFTVALCSLE                                                               CFT032
                                                                                              CFT032
      ** +--------------------------------------+
      ** ¦ Arrays and Data Structures           ¦
      ** ¦ ==========================           ¦
      ** +--------------------------------------+
 
     D #SLST           S              2A   DIM(8) CTDATA PERRCD(8)                            CSW207
     D*CUS1*****       S              4A   DIM(9) CTDATA PERRCD(1)                     CSW207 CSW209
     D CUS1            S              4A   DIM(8) CTDATA PERRCD(1)                            CSW209
                                                                                              CSW207
      ** External DS for bank details
     D SDBANK        E DS                  EXTNAME(SDBANKPD)
      ** External DS for currency details
     D SDCURR        E DS                  EXTNAME(SDCURRPD)
      ** External DS for branch details
     D SDBRCH        E DS                  EXTNAME(SDBRCHPD)
      ** External DS for account details
     D SDACCT        E DS                  EXTNAME(ACCNTAB)
      ** External DS for funds transfer details
     D SDFTFR        E DS                  EXTNAME(SDFTFRPD)
      ** External DS for SAR Details                                                          CER030
     D SCSARD        E DS                  EXTNAME(SCSARDPD)                                  CER030
     D SLCD          E                     EXTFLD(LCD)                                        CER030
     D/COPY WNCPYSRC,FTM10XUD01
 
      ** External data structure for Customer Details                                         CFT032
                                                                                              CFT032
     D SDCUST        E DS                  EXTNAME(SDCUSTPD)                                  CFT032
     D   IFQQDFAC    E                     EXTFLD(QQDFAC)                                     CFT032
                                                                                              CFT032
      ** External data structure for Midas Retail Details                                     CFT032
                                                                                              CFT032
     D SDRETL        E DS                  EXTNAME(SDRETLPD)                                  CFT032
                                                                                              CFT032
      ** External data structure for Midas Module Details                                     CFT032
                                                                                              CFT032
     D SDMMOD        E DS                  EXTNAME(SDMMODPD)                                  CFT032
                                                                                              CFT032
      ** External DS for access programs, short DS
     D DSFDY         E DS                  EXTNAME(DSFDY)
      ** External DS for access programs, long DS
     D DSSDY         E DS                  EXTNAME(DSSDY)
 
      ** +--------------------------------------+
      ** ¦ Declared variables                   ¦
      ** ¦ ==================                   ¦
      ** +--------------------------------------+
 
     D TransID         S             15
     D TranSRef        S             16
 
     D Prtcd           S              7
     D Poptn           S              7
     D Pcurr           S              3
     D Pbrch           S              3
     D Pacid           S             10
     D Ptype           S              7
     D Pnosn           S              2
     D PSard           S              6A                                                      CER030
 
     D Payref          S             15
     D wtranid         S              1
     D wyy             S              2  0
     D wddmm           S              4
     D wccy            S              3
     D wkey            S             31
     D*wordbk***       S             12                                                       CGL029
     D wordbk          S             18                                                       CGL029
     D Zdayno          S              5  0
     D Zdate           S              6  0
     D Zadate          S              7
     D WChar2a         S              2A                                                      CSW207
     D WChar2b         S              2A                                                      CSW207
     D WChar2c         S              2A                                                      CSW207
     D WChar2d         S              2A                                                      CSW207
     D WChar4          S              4A                                                      CSW207
 
     D AccntCode       DS
     D  wcsno                  1      6
     D  Pcycd                  7      9
     D  Paccd                 10     19                                                       CGL029
     D  Pacsn                 20     21                                                       CGL029
     D  Pbrca                 22     24                                                       CGL029
     D**Paccd***              10     13                                                       CGL029
     D**Pacsn***              14     15                                                       CGL029
     D**Pbrca***              16     18                                                       CGL029
 
     D  W#Accnt        S             35
                                                                                187211
      ** Timestamp for the tranaction                                           187211
     D Timestamp       S               Z                                        187211
     D W@Hash          S             18S 0                                      187211
                                                                                187211
                                                                                              CFT032
     D FeatureCFT014   S               N                                                      CFT032
     D FeatureCFT004   S               N                                                      CFT032
     D CSW207          S              1A                                                      CSW207
     D CSW209          S              1A                                                      CSW209
     D CAP185          S              1A                                                    BUG25995
                                                                                              CFT032
     D PSar            S              6A                                                      CFT032
     D PIban           S             34A                                                      CFT032
                                                                                              CFT032
     D P@AcCd          S             10A                                                      CFT032
     D P@AcSq          S              2A                                                      CFT032
     D P@BrCa          S              3A                                                      CFT032
     D P@CNum          S              6A                                                      CFT032
     D P@CuCd          S              3A                                                      CFT032
     D P@Key1          S             10A                                                      CFT032
     D P@KySt          S              7A                                                      CFT032
     D P@RetL          S             10A                                                      CFT032
                                                                                              CFT032
                                                                                              CFT032
      *                                                                                       CER030
      ** Field defined for CER031                                                             CER030
      *                                                                                       CER030
     D CER031          S              1A                                                      CER030
      ** +--------------------------------------+
      ** ¦ End of D-specs                       ¦
      ** ¦ ==============                       ¦
      ** +--------------------------------------+
 
      ** Rename Field                                                           CFT008
     IFT102HD0                                                                  CFT008
     I              SINST                       SINSTX                          CFT008
      *****************************************************************
      /EJECT
      *****************************************************************
 
      ** +--- Start of Main processing -----------------------------------+
      ** ¦                                                                ¦
      ** ¦ Initial processing is performed automatically: the *inzsr is   ¦
      ** ¦ executed at program activation.                                ¦
      ** ¦                                                                ¦
      ** +----------------------------------------------------------------+
 
     C                   Exsr      SrInit
 
     C                   Eval      wtranid = %subst(TransID:1:1)
     C                   If        wtranid = 'A' or wtranid = 'B'
     C                   Exsr      SrRFT
     C                   Else                                                   CFT008
     C                   Exsr      SrCCT                                        CFT008
     C                   Endif
 
     C                   If        GOPFLG = 'Y'
     C                   Exsr      SrFmt
     C                   Endif
 
     C                   Seton                                        LR
 
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * SrRFT - Format Fields from RFT                                *
      *                                                               *
      * Called by: Main Processing                                    *
      *                                                               *
      * Calls: SrCurr - Access AOCURRR0                               *
      *        ZDATE2 - Format Date                                   *
      *                                                               *
      *****************************************************************
     C     SrRFT         Begsr
 
     C     KTrans        Chain     FT101DL0                           01
 
     C                   If        *IN01
     C                   Movel     TransID       WKey
     C                   Move      TransRef      Wkey
     C                   Eval      dbfile = 'FT101DL0'
     C                   Eval      dbase = 3
     C                   Eval      dbkey = WKey
     C                   Exsr      *PSSR
     C                   Endif
 
      ** Generate Outgoing Payment Record
 
     C                   If        GOPFLG = 'Y'
 
     C                   Eval      SMCY = TRNCCY
     C                   Eval      SMAM = TRNAMT
     C                   Eval      wccy = SMCY
     C                   Exsr      SrCurr
     C                   If        A6MDIN = 'M'
     C                   Eval      MDIN = 1
     C                   Else
     C                   Eval      MDIN = 0
     C                   Endif
 
     C                   Select
     C                   When      A6NBDP = 0
     C                   Z-Add     SMAM          SMAMD
     C                   When      A6NBDP = 1
     C                   Eval      SMAMD = SMAM / 10
     C                   When      A6NBDP = 2
     C                   Eval      SMAMD = SMAM / 100
     C                   Other
     C                   Eval      SMAMD = SMAM / 1000
     C                   Endsl
 
     C                   Eval      PCCY = PAYCCY
     C                   Eval      PYAM = PAYAMT
     C                   Eval      wccy = PCCY
     C                   Exsr      SrCurr
 
     C                   Select
     C                   When      A6NBDP = 0
     C                   Z-Add     PYAM          PYAMD
     C                   When      A6NBDP = 1
     C                   Eval      PYAMD = PYAM / 10
     C                   When      A6NBDP = 2
     C                   Eval      PYAMD = PYAM / 100
     C                   Other
     C                   Eval      PYAMD = PYAM / 1000
     C                   Endsl
 
      ** Access Header Details
 
     C     TransID       Chain     FT101HL3                           01
 
     C                   If        *IN01
     C                   Eval      dbfile = 'FT101HL3'
     C                   Eval      dbase = 4
     C                   Eval      dbkey = TransID
     C                   Exsr      *PSSR
     C                   Endif
 
      ** Ordering Customer
 
     C                   Select
     C                   When      HINPTY <> *Blanks
 
     C                   If        %SUBST(HINPTY:11) = *blanks
     C                   Eval      Pacid = %SUBST(HINPTY:1:10)
     C                   Eval      ORC1 = Pacid
     C                   Else
     C                   Eval      AccntCode = wcsno
     C                   Eval      Pacid = wcsno
     C                   Eval      ORC1 = AccntCode
     C                   Endif
 
     C                   Eval      W#Accnt = Pacid
     C                   Exsr      SrAcct
 
     C                   When      HOCUS1 <> *Blanks
     C                   If        %SUBST(HOCUS1:1:1) <> '/'
     C                   Eval      ORC1 = HOCUS1
      *                                                                                       CSW207
     C                   If        CSW207 = 'Y'                                               CSW207
     C                   Eval      WChar4  = HOCUS1                                           CSW207
     C                   Eval      WChar2a = HOCUS2                                           CSW207
     C                   Eval      WChar2b = HOCUS3                                           CSW207
     C                   Eval      WChar2c = HOCUS4                                           CSW207
     C                   Eval      WChar2d = HOCUS5                                           CSW207
     C                   If        %LOOKUP(WChar4  : CUS1) > *Zero  AND (                     CSW207
     C                             %LOOKUP(WChar2a : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2b : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2c : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2d : #SLST) > *Zero)                          CSW207
     C                   Eval      ORC1 = HOCUS1                                              CSW207
     C                   Eval      ORC2 = HOCUS2                                              CSW207
     C                   Eval      ORC3 = HOCUS3                                              CSW207
     C                   Eval      ORC4 = HOCUS4                                              CSW207
     C                   Eval      ORC5 = HOCUS5                                              CSW207
     C                   EndIf                                                                CSW207
     C                   EndIf                                                                CSW207
      *                                                                                       CSW207
     C                   Else
                                                                                              CFT032
     C                   If        FeatureCFT014 = *On                                        CFT032
     C                   Eval      ORC1 = HOCUS1                                              CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = %SUBST(HOCUS1:2)
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   If        FeatureCFT004 = *On                                        CFT032
                                                                                              CFT032
      ** Check if the entry is a customer number/shortname                                    CFT032
                                                                                              CFT032
     C                   If        %Len( %Trim( HOCUS1 ) ) = 6 Or                             CFT032
     C                             %Len( %Trim( HOCUS1 ) ) = 10 And                           CFT032
     C                             %Check(ALPHAB:HOCUS1) > 0                                  CFT032
                                                                                              CFT032
     C                   Eval      P@KEY1 = %Subst(HOCUS1:2)                                  CFT032
     C                   Call      'AOCUSTR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*KEY'        @Optn                                        CFT032
     C                   Parm                    P@KEY1                                       CFT032
     C                   Parm      *Blanks       P@KYST                                       CFT032
     C     SDCUST        Parm      SDCUST        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC2 = BBCUST                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not a customer, check IBAN; if valid IBAN, use it.                                   CFT032
                                                                                              CFT032
     C                   Call      'AOIBANR2'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      HOCUS1        PIban                                        CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC1 = IBAN                                                CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not an IBAN, check if retail is allowed                                              CFT032
                                                                                              CFT032
     C                   Call      'AORETLR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*FIRST'      @Optn                                        CFT032
     C     SDRETL        Parm      SDRETL        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd <> *Blanks                                           CFT032
     C                   Eval      DBFile = 'SDRETLPD'                                        CFT032
     C                   Eval      Dbase = 001                                                CFT032
     C                   Eval      DBKey = @Optn                                              CFT032
     C                   Exsr      *PSSR                                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      ** Check if it is a retail number                                                       CFT032
                                                                                              CFT032
     C                   Eval      P@Retl = %Subst(HOCUS1:2)                                  CFT032
     C                   Call      'AOACCTR0'                                                 CFT032
     C                   Parm                    P@Retl                                       CFT032
     C                   Parm                    P@CNum                                       CFT032
     C                   Parm                    P@CuCd                                       CFT032
     C                   Parm                    P@ACcd                                       CFT032
     C                   Parm                    P@AcSq                                       CFT032
     C                   Parm                    P@Brca                                       CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
                                                                                              CFT032
      ** Check if retail numbers are allowed. If so use it, otherwise,                        CFT032
      ** format as partial account                                                            CFT032
                                                                                              CFT032
     C                   If        BMRANR = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + %Char(AcNo)                                   CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** if formatting as partial account, determine if multibranching                        CFT032
      ** to determine the proper format of the acocunt                                        CFT032
                                                                                              CFT032
     C                   If        BGMBIN = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X') + BRCA                               CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X')                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Endif
     C                   Eval      ORC2 = HOCUS2
     C                   Eval      ORC3 = HOCUS3
     C                   Eval      ORC4 = HOCUS4
     C                   Eval      ORC5 = HOCUS5                                              CFT032
     C                   Eval      ORCT = CUSTTP
 
     C                   When      TINPTY <> *blanks
 
     C                   If        %SUBST(TINPTY:11) = *blanks
     C                   Eval      Pacid = %SUBST(TINPTY:1:10)
     C                   Eval      ORC1 = Pacid
     C                   Else
     C                   Eval      AccntCode = wcsno
     C                   Eval      Pacid = wcsno
     C                   Eval      ORC1 = AccntCode
     C                   Endif
 
     C                   Eval      W#Accnt = Pacid
     C                   Exsr      SrAcct
 
     C                   Other
     C                   If        %SUBST(TOCUS1:1:1) <> '/'
     C                   Eval      ORC1 = TOCUS1
      *                                                                                       CSW207
     C                   If        CSW207 = 'Y'                                               CSW207
     C                   Eval      WChar4  = TOCUS1                                           CSW207
     C                   Eval      WChar2a = TOCUS2                                           CSW207
     C                   Eval      WChar2b = TOCUS3                                           CSW207
     C                   Eval      WChar2c = TOCUS4                                           CSW207
     C                   Eval      WChar2d = TOCUS5                                           CSW207
     C                   If        %LOOKUP(WChar4  : CUS1) > *Zero  AND (                     CSW207
     C                             %LOOKUP(WChar2a : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2b : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2c : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2d : #SLST) > *Zero)                          CSW207
     C                   Eval      ORC1 = TOCUS1                                              CSW207
     C                   Eval      ORC2 = TOCUS2                                              CSW207
     C                   Eval      ORC3 = TOCUS3                                              CSW207
     C                   Eval      ORC4 = TOCUS4                                              CSW207
     C                   Eval      ORC5 = TOCUS5                                              CSW207
     C                   EndIf                                                                CSW207
     C                   EndIf                                                                CSW207
      *                                                                                       CSW207
     C                   Else
                                                                                              CFT032
     C                   If        FeatureCFT014 = *On                                        CFT032
     C                   Eval      ORC1 = TOCUS1                                              CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = %SUBST(TOCUS1:2)
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   If        FeatureCFT004 = *On                                        CFT032
                                                                                              CFT032
      ** Check if the entry is a customer number/shortname                                    CFT032
                                                                                              CFT032
     C                   If        %Len( %Trim( TOCUS1 ) ) = 6 Or                             CFT032
     C                             %Len( %Trim( TOCUS1 ) ) = 10 And                           CFT032
     C                             %Check(ALPHAB:TOCUS1) > 0                                  CFT032
                                                                                              CFT032
     C                   Eval      P@KEY1 = %Subst(TOCUS1:2)                                  CFT032
     C                   Call      'AOCUSTR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*KEY'        @Optn                                        CFT032
     C                   Parm                    P@KEY1                                       CFT032
     C                   Parm      *Blanks       P@KYST                                       CFT032
     C     SDCUST        Parm      SDCUST        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC2 = BBCUST                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not a customer, check IBAN; if valid IBAN, use it.                                   CFT032
                                                                                              CFT032
     C                   Call      'AOIBANR2'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      HOCUS1        PIban                                        CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC1 = IBAN                                                CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not an IBAN, check if retail is allowed                                              CFT032
                                                                                              CFT032
     C                   Call      'AORETLR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*FIRST'      @Optn                                        CFT032
     C     SDRETL        Parm      SDRETL        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd <> *Blanks                                           CFT032
     C                   Eval      DBFile = 'SDRETLPD'                                        CFT032
     C                   Eval      Dbase = 001                                                CFT032
     C                   Eval      DBKey = @Optn                                              CFT032
     C                   Exsr      *PSSR                                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      ** Check if it is a retail number                                                       CFT032
                                                                                              CFT032
     C                   Eval      P@Retl = %Subst(TOCUS1:2)                                  CFT032
     C                   Call      'AOACCTR0'                                                 CFT032
     C                   Parm                    P@Retl                                       CFT032
     C                   Parm                    P@CNum                                       CFT032
     C                   Parm                    P@CuCd                                       CFT032
     C                   Parm                    P@ACcd                                       CFT032
     C                   Parm                    P@AcSq                                       CFT032
     C                   Parm                    P@Brca                                       CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
                                                                                              CFT032
      ** Check if retail numbers are allowed. If so use it, otherwise,                        CFT032
      ** format as partial account                                                            CFT032
                                                                                              CFT032
     C                   If        BMRANR = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + %Char(AcNo)                                   CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** if formatting as partial account, determine if multibranching                        CFT032
      ** to determine the proper format of the acocunt                                        CFT032
                                                                                              CFT032
     C                   If        BGMBIN = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X') + BRCA                               CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X')                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Endif
     C                   Eval      ORC2 = TOCUS2
     C                   Eval      ORC3 = TOCUS3
     C                   Eval      ORC4 = TOCUS4
     C                   Eval      ORC5 = TOCUS5                                              CFT032
     C                   Eval      ORCT = DCUSTP
     C                   Endsl
 
     C                   If        TINST1 <> *blanks
 
      ** Destination
 
     C                   Eval      DST1 = TINST1
     C                   Eval      DST2 = TINST2
     C                   Eval      DST3 = TINST3
     C                   Eval      DST4 = TINST4
     C                   Eval      DSTT = INTTTP
 
      ** Account with Institution
 
     C                   Eval      ACB1 = TACA35
     C                   Eval      ACB2 = TACB35
     C                   Eval      ACB3 = TACC35
     C                   Eval      ACB4 = TACD35
     C                   Eval      ACB5 = TACE35
     C                   Eval      ACBT = AWITTP
     C                   Else
 
      ** Destination
 
     C                   Eval      DST1 = TACA35
     C                   Eval      DST2 = TACB35
     C                   Eval      DST3 = TACC35
     C                   Eval      DST4 = TACD35
     C                   Eval      DSTT = AWITTP
     C                   Endif
 
      ** Beneficiary
 
     C**********         If        %SUBST(TBNA35:1:1) <> '/'                                BUG25239
     C                   Eval      BNC1 = TBNA35
     C**********         Else                                                               BUG25239
     C**********         Eval      BNC1 = %SUBST(TBNA35:2)                                  BUG25239
     C**********         Endif                                                              BUG25239
     C                   Eval      BNC2 = TBNB35
     C                   Eval      BNC3 = TBNC35
     C                   Eval      BNC4 = TBND35
     C                   Eval      BNC5 = TBNE35
     C                   Eval      BNCT = BENTTP
 
      ** Details of Payment
 
     C                   Eval      DTP1 = TRMA35
     C                   Eval      DTP2 = TRMB35
     C                   Eval      DTP3 = TRMC35
     C                   Eval      DTP4 = TRMD35
 
      ** Pay Value Date
 
     C                   Eval      PVDT = EXDATE
     C                   Eval      Zdayno = EXDATE
     C                   CallB     'ZDATE2'
     C                   Parm                    Zdayno
     C                   Parm                    BJDFIN
     C                   Parm                    Zdate
     C                   Parm                    Zadate
     C                   Eval      PVDTD1 = Zdate
     C                   Move      Zdate         wyy
 
     C                   If        wyy < 72
     C                   Eval      PVDTD2 = 20
     C                   Else
     C                   Eval      PVDTD2 = 19
     C                   Endif
 
     C                   MoveL     Zdate         wddmm
     C                   MoveL     wyy           PVDTD3
     C                   Move      wddmm         PVDTD3
 
     C                   Eval      RLPR = SNDREF
 
      *                                                                                       CSW209
      ** Set Outgoing Payments fields                                                         CSW209
      *                                                                                       CSW209
     C                   IF        CSW209 = 'Y'                                               CSW209
     C                             AND PYTP = 'RI'                                            CSW209
     C                   MOVEL     'SWIFT'       OPNWRK                                       CSW209
     C                   MOVE      '101'         OPMTPY                                       CSW209
     C                   ENDIF                                                                CSW209
                                                                                              CSW209
     C                   Endif
 
     C                   Endsr
      *****************************************************************
      /EJECT                                                                    CFT008
      *****************************************************************         CFT008
      *                                                               *         CFT008
      * SrCCT - Format Fields from CCT                                *         CFT008
      *                                                               *         CFT008
      * Called by: Main Processing                                    *         CFT008
      *                                                               *         CFT008
      * Calls: SrCurr - Access AOCURRR0                               *         CFT008
      *        ZDATE2 - Format Date                                   *         CFT008
      *                                                               *         CFT008
      *****************************************************************         CFT008
     C     SrCCT         Begsr                                                  CFT008
                                                                                CFT008
     C     KTrans        Chain     FT102DL0                           01        CFT008
                                                                                CFT008
     C                   If        *IN01                                        CFT008
     C                   Movel     TransID       WKey                           CFT008
     C                   Move      TransRef      Wkey                           CFT008
     C                   Eval      dbfile = 'FT102DL0'                          CFT008
     C                   Eval      dbase = 5                                    CFT008
     C                   Eval      dbkey = WKey                                 CFT008
     C                   Exsr      *PSSR                                        CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
      ** Generate Outgoing Payment Record                                       CFT008
                                                                                CFT008
     C                   If        GOPFLG = 'Y'                                 CFT008
                                                                                CFT008
     C                   Eval      SMCY = CCTCCY                                CFT008
     C                   Eval      PCCY = CCTCCY                                CFT008
     C                   Eval      wccy = SMCY                                  CFT008
     C                   Exsr      SrCurr                                       CFT008
                                                                                CFT008
     C                   If        CCYCHG = 'OUR'                               CFT008
     C                   Eval      SMAM = CCTAMT                                CFT008
     C                   Else                                                   CFT008
     C                   Eval      SMAM = CCTAMT - RCVCTF                       CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
     C                   If        A6MDIN = 'M'                                 CFT008
     C                   Eval      MDIN = 1                                     CFT008
     C                   Else                                                   CFT008
     C                   Eval      MDIN = 0                                     CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
     C                   Select                                                 CFT008
     C                   When      A6NBDP = 0                                   CFT008
     C                   Z-Add     SMAM          SMAMD                          CFT008
     C                   When      A6NBDP = 1                                   CFT008
     C                   Eval      SMAMD = SMAM / 10                            CFT008
     C                   When      A6NBDP = 2                                   CFT008
     C                   Eval      SMAMD = SMAM / 100                           CFT008
     C                   Other                                                  CFT008
     C                   Eval      SMAMD = SMAM / 1000                          CFT008
     C                   Endsl                                                  CFT008
                                                                                CFT008
     C                   Eval      PYAM = SMAM                                  CFT008
     C                   Eval      PYAMD = SMAMD                                CFT008
                                                                                CFT008
      ** Access Header Details                                                  CFT008
                                                                                CFT008
     C     TransID       Chain     FT102HL3                           01        CFT008
                                                                                CFT008
     C                   If        *IN01                                        CFT008
     C                   Eval      dbfile = 'FT102HL3'                          CFT008
     C                   Eval      dbase = 6                                    CFT008
     C                   Eval      dbkey = TransID                              CFT008
     C                   Exsr      *PSSR                                        CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
      ** Ordering Customer                                                      CFT008
                                                                                CFT008
     C                   Select                                                 CFT008
     C                   When      TOCUS1 <> *Blanks                            CFT008
     C                   If        %SUBST(TOCUS1:1:1) <> *Blanks                CFT008
     C                   Eval      ORC1 = TOCUS1                                CFT008
     C                   Else                                                   CFT008
     C                   Eval      ORC1 = %SUBST(TOCUS1:2)                      CFT008
     C                   Endif                                                  CFT008
                                                                                              CFT032
     C                   If        %SUBST(TOCUS1:1:1) <> '/'                                  CFT032
     C                   Eval      ORC1 = TOCUS1                                              CFT032
      *                                                                                       CSW207
     C                   If        CSW207 = 'Y'                                               CSW207
     C                   Eval      WChar4  = TOCUS1                                           CSW207
     C                   Eval      WChar2a = TOCUS2                                           CSW207
     C                   Eval      WChar2b = TOCUS3                                           CSW207
     C                   Eval      WChar2c = TOCUS4                                           CSW207
     C                   Eval      WChar2d = TOCUS5                                           CSW207
     C                   If        %LOOKUP(WChar4  : CUS1) > *Zero  AND (                     CSW207
     C                             %LOOKUP(WChar2a : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2b : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2c : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2d : #SLST) > *Zero)                          CSW207
     C                   Eval      ORC1 = TOCUS1                                              CSW207
     C                   Eval      ORC2 = TOCUS2                                              CSW207
     C                   Eval      ORC3 = TOCUS3                                              CSW207
     C                   Eval      ORC4 = TOCUS4                                              CSW207
     C                   Eval      ORC5 = TOCUS5                                              CSW207
     C                   EndIf                                                                CSW207
     C                   EndIf                                                                CSW207
      *                                                                                       CSW207
     C                   Else                                                                 CFT032
                                                                                              CFT032
     C                   If        FeatureCFT014 = *On                                        CFT032
     C**********         Eval      ORC1 = HOCUS1                                     CFT032 BUG25482
     C                   Eval      ORC1 = TOCUS1                                            BUG25482
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = %SUBST(TOCUS1:2)                                    CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   If        FeatureCFT004 = *On                                        CFT032
                                                                                              CFT032
      ** Check if the entry is a customer number/shortname                                    CFT032
                                                                                              CFT032
     C**********         If        %Len( %Trim( HOCUS1 ) ) = 6 Or                    CFT032 BUG25482
     C**********                   %Len( %Trim( HOCUS1 ) ) = 10 And                  CFT032 BUG25482
     C**********                   %Check(ALPHAB:HOCUS1) > 0                         CFT032 BUG25482
     C                   If        %Len( %Trim( TOCUS1 ) ) = 6 Or                           BUG25482
     C                             %Len( %Trim( TOCUS1 ) ) = 10 And                         BUG25482
     C                             %Check(ALPHAB:TOCUS1) > 0                                BUG25482
                                                                                              CFT032
     C**********         Eval      P@KEY1 = %Subst(HOCUS1:2)                         CFT032 BUG25482
     C                   Eval      P@KEY1 = %Subst(TOCUS1:2)                                BUG25482
     C                   Call      'AOCUSTR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*KEY'        @Optn                                        CFT032
     C                   Parm                    P@KEY1                                       CFT032
     C                   Parm      *Blanks       P@KYST                                       CFT032
     C     SDCUST        Parm      SDCUST        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC2 = BBCUST                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not a customer, check IBAN; if valid IBAN, use it.                                   CFT032
                                                                                              CFT032
     C                   Call      'AOIBANR2'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C**********         Parm      HOCUS1        PIban                               CFT032 BUG25482
     C                   Parm      TOCUS1        PIban                                      BUG25482
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC1 = IBAN                                                CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not an IBAN, check if retail is allowed                                              CFT032
                                                                                              CFT032
     C                   Call      'AORETLR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*FIRST'      @Optn                                        CFT032
     C     SDRETL        Parm      SDRETL        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd <> *Blanks                                           CFT032
     C                   Eval      DBFile = 'SDRETLPD'                                        CFT032
     C                   Eval      Dbase = 001                                                CFT032
     C                   Eval      DBKey = @Optn                                              CFT032
     C                   Exsr      *PSSR                                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      ** Check if it is a retail number                                                       CFT032
                                                                                              CFT032
     C**********         Eval      P@Retl = %Subst(HOCUS1:2)                         CFT032 BUG25482
     C                   Eval      P@Retl = %Subst(TOCUS1:2)                                BUG25482
     C                   Call      'AOACCTR0'                                                 CFT032
     C                   Parm                    P@Retl                                       CFT032
     C                   Parm                    P@CNum                                       CFT032
     C                   Parm                    P@CuCd                                       CFT032
     C                   Parm                    P@ACcd                                       CFT032
     C                   Parm                    P@AcSq                                       CFT032
     C                   Parm                    P@Brca                                       CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
                                                                                              CFT032
      ** Check if retail numbers are allowed. If so use it, otherwise,                        CFT032
      ** format as partial account                                                            CFT032
                                                                                              CFT032
     C                   If        BMRANR = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + %Char(AcNo)                                   CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** if formatting as partial account, determine if multibranching                        CFT032
      ** to determine the proper format of the acocunt                                        CFT032
                                                                                              CFT032
     C                   If        BGMBIN = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X') + BRCA                               CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X')                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
     C                   Eval      ORC2 = TOCUS2                                CFT008
     C                   Eval      ORC3 = TOCUS3                                CFT008
     C                   Eval      ORC4 = TOCUS4                                CFT008
     C                   Eval      ORC5 = TOCUS5                                              CFT032
     C                   Eval      ORCT = CUSTTH                                CFT008
                                                                                CFT008
     C                   Other                                                  CFT008
     C                   If        %SUBST(ORDCU1:1:1) <> *Blanks                CFT008
     C                   Eval      ORC1 = ORDCU1                                CFT008
     C                   Else                                                   CFT008
     C                   Eval      ORC1 = %SUBST(ORDCU1:2)                      CFT008
     C                   Endif                                                  CFT008
                                                                                              CFT032
     C**********         If        %SUBST(TOCUS1:1:1) <> '/'                         CFT032 BUG25482
     C**********         Eval      ORC1 = TOCUS1                                     CFT032 BUG25482
     C                   IF        %SUBST(ORDCU1:1:1) <> '/'                                BUG25482
     C                   Eval      ORC1 = ORDCU1                                            BUG25482
      *                                                                                       CSW207
     C                   If        CSW207 = 'Y'                                               CSW207
     C                   Eval      WChar4  = ORDCU1                                           CSW207
     C                   Eval      WChar2a = ORDCU2                                           CSW207
     C                   Eval      WChar2b = ORDCU3                                           CSW207
     C                   Eval      WChar2c = ORDCU4                                           CSW207
     C                   Eval      WChar2d = ORDCU5                                           CSW207
     C                   If        %LOOKUP(WChar4  : CUS1) > *Zero  AND (                     CSW207
     C                             %LOOKUP(WChar2a : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2b : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2c : #SLST) > *Zero OR                        CSW207
     C                             %LOOKUP(WChar2d : #SLST) > *Zero )                         CSW207
     C                   Eval      ORC1 = ORDCU1                                              CSW207
     C                   Eval      ORC2 = ORDCU2                                              CSW207
     C                   Eval      ORC3 = ORDCU3                                              CSW207
     C                   Eval      ORC4 = ORDCU4                                              CSW207
     C                   Eval      ORC5 = ORDCU5                                              CSW207
     C                   EndIf                                                                CSW207
     C                   EndIf                                                                CSW207
      *                                                                                       CSW207
     C                   Else                                                                 CFT032
                                                                                              CFT032
     C                   If        FeatureCFT014 = *On                                        CFT032
     C**********         Eval      ORC1 = HOCUS1                                     CFT032 BUG25482
     C                   Eval      ORC1 = ORDCU1                                            BUG25482
     C                   Else                                                                 CFT032
     C**********         Eval      ORC1 = %SUBST(TOCUS1:2)                           CFT032 BUG25482
     C                   Eval      ORC1 = %SUBST(ORDCU1:2)                                  BUG25482
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   If        FeatureCFT004 = *On                                        CFT032
                                                                                              CFT032
      ** Check if the entry is a customer number/shortname                                    CFT032
                                                                                              CFT032
     C**********         If        %Len( %Trim( HOCUS1 ) ) = 6 Or                    CFT032 BUG25482
     C**********                   %Len( %Trim( HOCUS1 ) ) = 10 And                  CFT032 BUG25482
     C**********                   %Check(ALPHAB:HOCUS1) > 0                         CFT032 BUG25482
     C                   If        %Len( %Trim( ORDCU1 ) ) = 6 Or                           BUG25482
     C                             %Len( %Trim( ORDCU1 ) ) = 10 And                         BUG25482
     C                             %Check(ALPHAB:ORDCU1) > 0                                BUG25482
                                                                                              CFT032
     C**********         Eval      P@KEY1 = %Subst(HOCUS1:2)                         CFT032 BUG25482
     C                   Eval      P@KEY1 = %Subst(ORDCU1:2)                                BUG25482
     C                   Call      'AOCUSTR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*KEY'        @Optn                                        CFT032
     C                   Parm                    P@KEY1                                       CFT032
     C                   Parm      *Blanks       P@KYST                                       CFT032
     C     SDCUST        Parm      SDCUST        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC2 = BBCUST                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not a customer, check IBAN; if valid IBAN, use it.                                   CFT032
                                                                                              CFT032
     C                   Call      'AOIBANR2'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C**********         Parm      HOCUS1        PIban                               CFT032 BUG25482
     C                   Parm      ORDCU1        PIban                                      BUG25482
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
     C                   Eval      ORC1 = IBAN                                                CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** Not an IBAN, check if retail is allowed                                              CFT032
                                                                                              CFT032
     C                   Call      'AORETLR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*FIRST'      @Optn                                        CFT032
     C     SDRETL        Parm      SDRETL        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd <> *Blanks                                           CFT032
     C                   Eval      DBFile = 'SDRETLPD'                                        CFT032
     C                   Eval      Dbase = 001                                                CFT032
     C                   Eval      DBKey = @Optn                                              CFT032
     C                   Exsr      *PSSR                                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      ** Check if it is a retail number                                                       CFT032
                                                                                              CFT032
     C**********         Eval      P@Retl = %Subst(HOCUS1:2)                         CFT032 BUG25482
     C                   Eval      P@Retl = %Subst(ORDCU1:2)                                BUG25482
     C                   Call      'AOACCTR0'                                                 CFT032
     C                   Parm                    P@Retl                                       CFT032
     C                   Parm                    P@CNum                                       CFT032
     C                   Parm                    P@CuCd                                       CFT032
     C                   Parm                    P@ACcd                                       CFT032
     C                   Parm                    P@AcSq                                       CFT032
     C                   Parm                    P@Brca                                       CFT032
     C     SDACCT        Parm      SDACCT        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd = *Blanks                                            CFT032
                                                                                              CFT032
      ** Check if retail numbers are allowed. If so use it, otherwise,                        CFT032
      ** format as partial account                                                            CFT032
                                                                                              CFT032
     C                   If        BMRANR = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + %Char(AcNo)                                   CFT032
     C                   Else                                                                 CFT032
                                                                                              CFT032
      ** if formatting as partial account, determine if multibranching                        CFT032
      ** to determine the proper format of the acocunt                                        CFT032
                                                                                              CFT032
     C                   If        BGMBIN = 'Y'                                               CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X') + BRCA                               CFT032
     C                   Else                                                                 CFT032
     C                   Eval      ORC1 = '/' + CNUM + %EditC(ACOD:'X') +                     CFT032
     C                                  %EditC(ACSQ:'X')                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
     C                   EndIf                                                                CFT032
     C                   Eval      ORC2 = ORDCU2                                CFT008
     C                   Eval      ORC3 = ORDCU3                                CFT008
     C                   Eval      ORC4 = ORDCU4                                CFT008
     C                   Eval      ORC5 = ORDCU5                                            BUG25482
     C                   Eval      ORCT = CUSTTD                                CFT008
     C                   Endsl                                                  CFT008
                                                                                CFT008
      ** Destination                                                            CFT008
                                                                                CFT008
     C                   Eval      DST1 = ACCI35                                CFT008
     C                   Eval      DST2 = ACCI11                                CFT008
     C                   Eval      DSTT = AWITP                                 CFT008
                                                                                CFT008
      ** Beneficiary                                                            CFT008
                                                                                CFT008
     C                   If        %SUBST(BENF1:1:1) <> *Blanks                 CFT008
     C                   Eval      BNC1 = BENF1                                 CFT008
     C                   Else                                                   CFT008
     C                   Eval      BNC1 = %SUBST(BENF1:2)                       CFT008
     C                   Endif                                                  CFT008
     C                   Eval      BNC2 = BENF2                                 CFT008
     C                   Eval      BNC3 = BENF3                                 CFT008
     C                   Eval      BNC4 = BENF4                                 CFT008
     C                   Eval      BNC5 = BENF5                                 CFT008
     C                   Eval      BNCT = BENTTD                                CFT008
                                                                                CFT008
      ** Details of Payment                                                     CFT008
                                                                                CFT008
     C                   Eval      DTP1 = REMI1                                 CFT008
     C                   Eval      DTP2 = REMI2                                 CFT008
     C                   Eval      DTP3 = REMI3                                 CFT008
     C                   Eval      DTP4 = REMI4                                 CFT008
                                                                                CFT008
      ** Pay Value Date                                                         CFT008
                                                                                CFT008
     C                   Eval      PVDT = TTVDTE                                CFT008
     C                   Eval      Zdayno = TTVDTE                              CFT008
     C                   CallB     'ZDATE2'                                     CFT008
     C                   Parm                    Zdayno                         CFT008
     C                   Parm                    BJDFIN                         CFT008
     C                   Parm                    Zdate                          CFT008
     C                   Parm                    Zadate                         CFT008
     C                   Eval      PVDTD1 = Zdate                               CFT008
     C                   Move      Zdate         wyy                            CFT008
                                                                                CFT008
     C                   If        wyy < 72                                     CFT008
     C                   Eval      PVDTD2 = 20                                  CFT008
     C                   Else                                                   CFT008
     C                   Eval      PVDTD2 = 19                                  CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
     C                   MoveL     Zdate         wddmm                          CFT008
     C                   MoveL     wyy           PVDTD3                         CFT008
     C                   Move      wddmm         PVDTD3                         CFT008
                                                                                CFT008
     C                   Eval      RLPR = FILREF                                CFT008
                                                                                              CSW209
     C                   IF        CSW209 = 'Y'                                               CSW209
     C                   IF        CCTTYP = 'BI'                                              CSW209
     C                   EVAL      OPNWRK = CCNWRK                                            CSW209
     C                   EVAL      OPMTPY = CCMTPY                                            CSW209
     C                   EVAL      OPVALF = CCVALF                                            CSW209
     C                   EVAL      OPOMVF = *BLANKS                                           CSW209
     C                   EVAL      OPOCVF = *BLANKS                                           CSW209
     C                   ENDIF                                                                CSW209
     C                   ENDIF                                                                CSW209
                                                                                CFT008
     C                   Endif                                                  CFT008
                                                                                CFT008
     C                   Endsr                                                  CFT008
      *****************************************************************         CFT008
      /EJECT
      *****************************************************************
      *                                                               *
      * SrFmt - Format other fields and generates a record            *
      *                                                               *
      * Called by: Main Processing                                    *
      *                                                               *
      * Calls: FTOPAY2RV - Gets Next Outgoing Payment Reference       *
      *        AOBRCHR0 Access Object                                 *
      *                                                               *
      *****************************************************************
     C     SrFmt         Begsr
 
     C                   Eval      RECI = 'D'
 
      ** Payment Reference
 
     C                   CallB     'FTOPAY2RV'
     C                   Parm                    ReturnCode
     C                   Parm      *blanks       PayRef
 
     C                   Eval      PREF = PayRef
 
     C                   Eval      PYTP = 'OP'
     C                   Eval      STMT = 08
     C                   Eval      SWPC = 2
     C                   Eval      DTCH = 'BEN'
     C/COPY WNCPYSRC,FTM10XUC01
     C                   Eval      ADDC = 'D'
      *                                                                                     BUG25207
     C                   SELECT                                                             BUG25207
      *                                                                                     BUG25207
     C                   WHEN      BTCHCY = 'C'                                             BUG25207
     C                   EVAL      OPCHGC = PCCY                                            BUG25207
      *                                                                                     BUG25207
     C                   WHEN      BTCHCY = 'L'                                             BUG25207
     C                   EVAL      OPCHGC = BJLCCY                                          BUG25207
      *                                                                                     BUG25207
     C                   OTHER                                                              BUG25207
     C                   EVAL      OPCHGC = BJCYCD                                          BUG25207
     C                   ENDSL                                                              BUG25207
 
     C                   Eval      PYST = *blanks
     C                   Eval      BOKC = *blanks
     C                   Eval      PRFC = *blanks
     C                   Eval      AUP1 = *blanks
     C                   Eval      AUP2 = *blanks
     C                   Eval      AUIN = *blank
     C                   Eval      CQIN = *blank
     C                   Eval      PBCQ = 0
 
      ** Access Branch Details
 
     C**********         CALL      'AOBRCHR0'                                                 CGL029
     C                   CALL      'AOBRCHR1'                                                 CGL029
     C                   Parm      *Blanks       Prtcd
     C                   Parm      '*KEY    '    Poptn
     C                   Parm      BRCA          Pbrch
     C     Sdbrch        Parm      Sdbrch        Dssdy
 
     C                   If        Prtcd <> *Blanks
     C                   Eval      dbfile = 'SDBRCHPD'
     C                   Eval      dbase = 7
     C                   Eval      dbkey = BRCA
     C                   Exsr      *PSSR
     C                   Endif
 
      ** Ordering Bank
 
     C                   Eval      %SUBST(OPORB1:1:6) = A8BICN
     C                   Eval      %SUBST(OPORB1:7:3) = SMCY
     C                   Eval      %SUBST(OPORB1:10:10) = BTIOSA                              CGL029
     C                   Eval      %SUBST(OPORB1:20:2) = '01'                                 CGL029
     C                   Eval      %SUBST(OPORB1:22:3) = BRCA                                 CGL029
     C**********         Eval      %SUBST(OPORB1:10:4) = BTIOSA                               CGL029
     C**********         Eval      %SUBST(OPORB1:14:2) = '01'                                 CGL029
     C**********         Eval      %SUBST(OPORB1:16:3) = BRCA                                 CGL029
 
     C                   Eval      %SUBST(wordbk:1:6) = A8BICN
     C                   Eval      %SUBST(wordbk:7:10) = BTIOSA                               CGL029
     C                   Eval      %SUBST(wordbk:17:2) = '01'                                 CGL029
     C**********         Eval      %SUBST(wordbk:7:4) = BTIOSA                                CGL029
     C**********         Eval      %SUBST(wordbk:11:2) = '01'                                 CGL029
     C                   MoveL     wordbk        ORBK
 
     C                   Eval      ORBB = BRCA
     C                   Eval      ORBT = 'P'
     C                   Eval      OPORBT = 'G'
     C                   Eval      OPRECI = RECI
     C                   Eval      OPPREF = PREF
     C                   Eval      OPAUTO = 'Y'
      *                                                                                     BUG25173
     C                   Select                                                             BUG25173
     C                   When      BTCHCY = 'C'                                             BUG25173
     C     ADDC          IfEq      'A'                                                      BUG25173
     C                   Movel     SMCY          OPCHGC                                     BUG25173
     C                   Else                                                               BUG25173
     C                   Movel     PCCY          OPCHGC                                     BUG25173
     C                   EndIf                                                              BUG25173
     C                   When      BTCHCY = 'L'                                             BUG25173
     C                   Movel     BJLCCY        OPCHGC                                     BUG25173
     C                   Other                                                              BUG25173
     C                   Movel     BJCYCD        OPCHGC                                     BUG25173
     C                   EndSl                                                              BUG25173
      *                                                                                     BUG25173
                                                                                187211
      ** Generate timestamp                                                     187211
     C                   CALLB     'ZAGENTMSTM'                                 187211
     C                   PARM                    Timestamp                      187211
                                                                                187211
     C                   Eval      TMST = Timestamp                             187211
 
      * Set DSTT to A and SLDTD1 to 010101                                      187223
     C                   Eval      DSTT = 'A'                                   187223
     C*******************Eval      SLDTD1 = 010101                        187223188654
     C                   Eval      SLDTD1 = WSLDTD1                             188654
     C                   Eval      SLDT   = BJRDNB                              188654
      *                                                                                       CER030
      ** If switchable feature CER031 is on Extended Narratives defaulted to Blanks           CER030
      *                                                                                       CER030
     C                   IF        CER031 = 'Y'                                               CER030
      *                                                                                       CER030
     C                   EVAL      OPEXT1 = *BLANKS                                           CER030
     C                   EVAL      OPEXT2 = *BLANKS                                           CER030
     C                   EVAL      OPEXT3 = *BLANKS                                           CER030
     C                   EVAL      OPEXT4 = *BLANKS                                           CER030
     C                   EVAL      OPEXT5 = *BLANKS                                           CER030
     C                   EVAL      OPEXT6 = *BLANKS                                           CER030
     C                   EVAL      OPEXC1 = *BLANKS                                           CER030
     C                   EVAL      OPEXC2 = *BLANKS                                           CER030
     C                   EVAL      OPEXC3 = *BLANKS                                           CER030
     C                   EVAL      OPEXC4 = *BLANKS                                           CER030
     C                   EVAL      OPEXC5 = *BLANKS                                           CER030
     C                   EVAL      OPEXC6 = *BLANKS                                           CER030
      *                                                                                       CER030
     C                   ENDIF                                                                CER030
 
     C                   Write     OTPAYDDF
     C                   Write     OTPAYXDF
      *                                                                                     BUG25995
     C                   If        CAP185 = 'Y'                                             BUG25995
     C                   Eval      OTPREF = PREF                                            BUG25995
     C                   Eval      OTBRCA = ORBR                                            BUG25995
     C                   Eval      OTFRID = FRNT                                            BUG25995
     C                   Write     OTPAYQD0                                                 BUG25995
     C                   Endif                                                              BUG25995
                                                                                187211
      * Update trailer                                                          187211
                                                                                187211
     C     1             Setll     OTPAYZZF                                     187211
     C                   Read      OTPAYZZF                               90    187211
                                                                                187211
     C     *In90         Ifeq      *off                                         187211
     C                   Add       1             NORE1                          187211
     C                   Eval      W@Hash = HRWN * 1000 + HRDC                  187211
     C                                      + SMAM                              187211
     C     W@Hash        Div       1000          HRWN                           187211
     C                   Z-add     W@Hash        HRDC                           187211
     C                   Update    OTPAYZZF                                     187211
     C                   Endif                                                  187211
 
     C                   Endsr
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * SrInit - Initialises all OTPAYDD fields                       *
      *                                                               *
      * Called by: Main Processing                                    *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
     C     SrInit        Begsr
 
     C                   Eval      RECI = *blank
     C                   Eval      PREF = *blanks
     C                   Eval      PYTP = *blanks
     C                   Eval      PYST = *blanks
     C                   Eval      DSTT = *blank
     C                   Eval      DST1 = *blanks
     C                   Eval      DST2 = *blanks
     C                   Eval      DST3 = *blanks
     C                   Eval      DST4 = *blanks
     C                   Eval      SNCT = *blank
     C*****              Eval      SNCO = 0                                                   CSD027
     C                   Eval      SNCO = *blank                                              CSD027
     C                   Eval      ORBT = *blank
     C***********        Eval      ORBK = 0                                                   CSD027
     C                   Eval      ORBK = *BLANKS                                             CSD027
     C                   Eval      ORCT = *blank
     C                   Eval      ORC1 = *blanks
     C                   Eval      ORC2 = *blanks
     C                   Eval      ORC3 = *blanks
     C                   Eval      ORC4 = *blanks
     C                   Eval      SMAM = 0
     C                   Eval      SMAMD = 0
     C                   Eval      SMCY = *blanks
     C                   Eval      MDIN = 0
     C                   Eval      RATE = 0
     C                   Eval      RATED = 0
     C                   Eval      OVRD = *blank
     C                   Eval      PYAM = 0
     C                   Eval      PYAMD = 0
     C                   Eval      PCCY = *blanks
     C                   Eval      SLDT = 0
     C                   Eval      SLDTD1 = 0
     C                   Eval      SLDTD2 = 0
     C                   Eval      SLDTD3 = 0
     C                   Eval      PVDT = 0
     C                   Eval      PVDTD1 = 0
     C                   Eval      PVDTD2 = 0
     C                   Eval      PVDTD3 = 0
     C                   Eval      ADDC = *blank
     C                   Eval      RPAY = *blank
     C                   Eval      PAYF = *blank
     C                   Eval      DYIM = 0
     C                   Eval      FDAT = 0
     C                   Eval      FDATD1 = 0
     C                   Eval      FDATD2 = 0
     C                   Eval      FDATD3 = 0
     C                   Eval      SWPC = 0
     C                   Eval      STMT = 0
     C                   Eval      SNMT = *blank
     C                   Eval      RCRT = *blank
     C                   Eval      RCO1 = *blanks
     C                   Eval      RCO2 = *blanks
     C                   Eval      RCO3 = *blanks
     C                   Eval      RCO4 = *blanks
     C                   Eval      RCO5 = *blanks
     C                   Eval      ACBT = *blank
     C                   Eval      ACB1 = *blanks
     C                   Eval      ACB2 = *blanks
     C                   Eval      ACB3 = *blanks
     C                   Eval      ACB4 = *blanks
     C                   Eval      ACB5 = *blanks
     C                   Eval      BNCT = *blank
     C                   Eval      BNC1 = *blanks
     C                   Eval      BNC2 = *blanks
     C                   Eval      BNC3 = *blanks
     C                   Eval      BNC4 = *blanks
     C                   Eval      BNC5 = *blanks
     C                   Eval      DTP1 = *blanks
     C                   Eval      DTP2 = *blanks
     C                   Eval      DTP3 = *blanks
     C                   Eval      DTP4 = *blanks
     C                   Eval      DTCH = *blanks
     C                   Eval      BBI1 = *blanks
     C                   Eval      BBI2 = *blanks
     C                   Eval      BBI3 = *blanks
     C                   Eval      BBI4 = *blanks
     C                   Eval      BBI5 = *blanks
     C                   Eval      BBI6 = *blanks
     C                   Eval      DNBC = 0
     C                   Eval      TRCT = *blank
     C                   Eval      TRCM = 0
     C                   Eval      TRCMD = 0
     C                   Eval      TXCH = 0
     C                   Eval      TXCHD = 0
     C                   Eval      CQCH = 0
     C                   Eval      CQCHD = 0
     C                   Eval      CSTA = 0
     C                   Eval      CSTAD = 0
     C                   Eval      SPCH = 0
     C                   Eval      SPCHD = 0
     C                   Eval      MSCH = 0
     C                   Eval      MSCHD = 0
     C                   Eval      CDRT = *blank
     C***********        Eval      CDRO = 0                                                   CSD027
     C                   Eval      CDRO = *BLANKS                                             CSD027
     C                   Eval      OPCDRC = *Blanks                                           CFT120
     C                   Eval      LCHT = 0
     C                   Eval      LCD = 0
     C                   Eval      CHTP = *blank
     C                   Eval      AUP1 = *blanks
     C                   Eval      AUP2 = *blanks
     C                   Eval      AUIN = *blank
     C                   Eval      IACG = *blank
     C                   Eval      SACG = *blank
     C                   Eval      PACG = *blank
     C                   Eval      SMSG = *blank
     C                   Eval      PMSG = *blank
     C                   Eval      OEDT = 0
     C                   Eval      OEDTD1 = 0
     C                   Eval      OEDTD2 = 0
     C                   Eval      OEDTD3 = 0
     C                   Eval      NPDT = 0
     C                   Eval      NPDTD1 = 0
     C                   Eval      NPDTD2 = 0
     C                   Eval      NPDTD3 = 0
     C                   Eval      PRBD = 0
     C                   Eval      FAIN = *blank
     C                   Eval      ADIN = *blank
     C                   Eval      CQIN = *blank
     C                   Eval      PRIN = *blank
     C                   Eval      MT100 = *blank
     C                   Eval      MT202 = *blank
     C                   Eval      TXIN = *blank
     C                   Eval      BAIN = *blank
     C                   Eval      ISIN = *blank
     C                   Eval      MPYI = *blank
     C                   Eval      RLPR = *blanks
     C                   Eval      INBT = *blank
     C                   Eval      INB1 = *blanks
     C                   Eval      INB2 = *blanks
     C                   Eval      INB3 = *blanks
     C                   Eval      INB4 = *blanks
     C                   Eval      INB5 = *blanks
     C                   Eval      CHAP = 0
     C                   Eval      LVL1 = *blank
     C                   Eval      LVL2 = *blank
     C                   Eval      SBCQ = 0
     C                   Eval      PBCQ = 0
     C                   Eval      OPIN = *blank
     C                   Eval      OXPREF = *blanks
     C                   Eval      ZZ011 = *blanks
     C                   Eval      AMTS = *blanks
     C                   Eval      SVDT = *blanks
     C                   Eval      NSTR = *blanks
     C                   Eval      TSKS = *blank
     C                   Eval      INUSR1 = *blanks
     C                   Eval      INUSR2 = *blanks
     C                   Eval      DUMA1 = 0
     C                   Eval      DUMA2 = 0
     C                   Eval      DUMA3 = 0
     C                   Eval      DUMA4 = 0
     C                   Eval      DUMA5 = 0
     C                   Eval      DUMA6 = 0
     C                   Eval      BRCA = *blanks
     C                   Eval      ORBR = *blanks
     C                   Eval      ORBB = *blanks
     C                   Eval      CDBR = *blanks
     C                   Eval      MT202C = *blank
     C                   Eval      BOKC = *blanks
     C                   Eval      PRFC = *blanks
     C                   Eval      OPORBT = *blank
     C                   Eval      OPORB1 = *blanks
     C                   Eval      OPORB2 = *blanks
     C                   Eval      OPORB3 = *blanks
     C                   Eval      OPORB4 = *blanks
     C                   Eval      OPORB5 = *blanks
     C                   Eval      OPMSGR = 0
     C                   Eval      OPKPRT = 0
     C                   Eval      OPVAT1 = *blank
     C                   Eval      OPVAT2 = *blank
     C                   Eval      OPVAT3 = *blank
     C                   Eval      OPVAT4 = *blank
     C                   Eval      OPVAT5 = *blank
     C                   Eval      OPVAT6 = *blank
     C                   Eval      OPVAT7 = *blank
     C                   Eval      OPCHCM = 0
     C                   Eval      OPVATT = 0
     C                   Eval      OPDUM7 = 0
     C                   Eval      OPDUM8 = 0
     C                   Eval      OPRPRF = *blanks
     C                   Eval      OPVATR = 0
     C                   Eval      FXMP = 0
     C                   Eval      FXMD = 0
     C                   Eval      MBSI = *blank
     C                   Eval      MSIG = *blank
     C                   Eval      MAMT = 0
     C                   Eval      NDCY = *blanks
     C                   Eval      NDAM = 0
     C                   Eval      PDCY = *blanks
     C                   Eval      PDAM = 0
     C                   EVAL      OPEXT1 = *BLANKS                                           CER030
     C                   EVAL      OPEXT2 = *BLANKS                                           CER030
     C                   EVAL      OPEXT3 = *BLANKS                                           CER030
     C                   EVAL      OPEXT4 = *BLANKS                                           CER030
     C                   EVAL      OPEXT5 = *BLANKS                                           CER030
     C                   EVAL      OPEXT6 = *BLANKS                                           CER030
     C                   EVAL      OPEXC1 = *BLANKS                                           CER030
     C                   EVAL      OPEXC2 = *BLANKS                                           CER030
     C                   EVAL      OPEXC3 = *BLANKS                                           CER030
     C                   EVAL      OPEXC4 = *BLANKS                                           CER030
     C                   EVAL      OPEXC5 = *BLANKS                                           CER030
     C                   EVAL      OPEXC6 = *BLANKS                                           CER030
      *                                                                         CFT014
     C                   Clear                   OTPAYXDF                       CFT014
 
     C                   Eval      ORC5 = *Blanks                                             CFT032
                                                                                              CFT032
      ** Check if CFT004 is installed                                                         CFT032
                                                                                              CFT032
     C                   Call      'AOSARSR0'                                                 CFT032
     C                   Parm      *Blanks       PRtCd                                        CFT032
     C                   Parm      '*VERIFY'     POptn                                        CFT032
     C                   Parm      'CFT0004'     PSar                                         CFT032
     C                   Parm                    DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        PRtCd = *Blanks                                            CFT032
     C                   Eval      FeatureCFT004 = *On                                        CFT032
     C                   Else                                                                 CFT032
     C                   Eval      FeatureCFT004 = *Off                                       CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      ** Check if CFT014 is installed                                                         CFT032
                                                                                              CFT032
     C                   Call      'AOSARSR0'                                                 CFT032
     C                   Parm      *Blanks       PRtCd                                        CFT032
     C                   Parm      '*VERIFY'     POptn                                        CFT032
     C**********         Parm      'CFT0014'     PSar                                CFT032 BUG25482
     C                   Parm      'CFT014'      PSar                                       BUG25482
     C                   Parm                    DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        PRtCd = *Blanks                                            CFT032
     C                   Eval      FeatureCFT014 = *On                                        CFT032
     C                   Else                                                                 CFT032
     C                   Eval      FeatureCFT014 = *Off                                       CFT032
     C                   EndIf                                                                CFT032
      *                                                                                     BUG25995
      ** Check if CAP185 is installed                                                       BUG25995
      *                                                                                     BUG25995
     C                   Call      'AOSARDR0'                                               BUG25995
     C                   Parm      *Blanks       PRtCd                                      BUG25995
     C                   Parm      '*VERIFY'     POptn                                      BUG25995
     C                   Parm      'CAP185'      PSar                                       BUG25995
     C                   Parm                    DSSDY                                      BUG25995
      *                                                                                     BUG25995
     C                   If        PRtCd = *Blanks                                          BUG25995
     C                   Eval      CAP185 = 'Y'                                             BUG25995
     C                   Else                                                               BUG25995
     C                   Eval      CAP185 = 'N'                                             BUG25995
     C                   EndIf                                                              BUG25995
      *                                                                                       CSW207
      ** Check if SWIFT 2007 is installed                                                     CSW207
      *                                                                                       CSW207
     C                   CALL      'SWIF2007'                                                 CSW207
     C                   PARM                    PRtCd                                        CSW207
      *                                                                                       CSW207
     C                   IF        PRtCd = 'CSW2007'                                          CSW207
     C                   EVAL      CSW207 = 'Y'                                               CSW207
     C                   ELSE                                                                 CSW207
     C                   EVAL      CSW207 = 'N'                                               CSW207
     C                   ENDIF                                                                CSW207
      *                                                                                       CSW207
                                                                                              CFT032
      ** Check if SWIFT 2009 is installed                                                     CSW209
     C                   CALL      'SWIF2009'                                                 CSW209
     C                   PARM                    PRtCd                                        CSW209
      *                                                                                       CSW209
     C                   IF        PRtCd = 'CSW2009'                                          CSW209
     C                   EVAL      CSW209 = 'Y'                                               CSW209
     C                   ELSE                                                                 CSW209
     C                   EVAL      CSW209 = 'N'                                               CSW209
     C                   ENDIF                                                                CSW209
      *                                                                                       CSW209
     C                   Endsr
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * SrAcct - Access AOACCTV1                                      *
      *                                                               *
      * Called by: Main Processing                                    *
      *                                                               *
      * Calls: AOACCTV0M                                              *
      *                                                               *
      *****************************************************************
     C     SrAcct        Begsr
 
      ** Access Account Details
 
     C                   CallB     'AOACCTV1'
     C                   Parm                    Prtcd
     C                   Parm                    Ptype
     C                   Parm                    W#Accnt
     C                   Parm                    DSSDY
 
 
     C                   If        Prtcd <> *Blanks  or Ptype <> '*NOSTRO'
     C                             and Ptype <> '*RETAIL' and
     C                             Ptype <> '*NUMBER' and
     C                             Ptype <> '*SHNAME'
     C                   Eval      dbfile = 'ACCNTAB'
     C                   Eval      dbase = 8
     C                   Eval      dbkey = ORC1
     C                   Exsr      *PSSR
     C                   Endif
 
     C                   Select
     C                   When      Ptype = '*NUMBER' or
     C                             Ptype = '*SHNAME'
     C                   Eval      ORCT = 'G'
     C                   When      Ptype = '*NOSTRO'
     C                   Eval      ORCT = 'N'
     C                   When      Ptype = '*RETAIL'
     C                   Eval      ORCT = 'R'
     C                   Endsl
 
     C                   Endsr
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * SrCurr - Access AOCURRR0                                      *
      *                                                               *
      * Called by: SrRFT - Format Fields from RFT                     *
      *            SrCCT - Format Fields from CCT                     *         CFT008
      *                                                               *
      * Calls: AOCURRR0                                               *
      *                                                               *
      *****************************************************************
     C     SrCurr        Begsr
 
      ** Access Currency Details
 
     C                   Call      'AOCURRR0'
     C                   Parm      *Blanks       Prtcd
     C                   Parm      '*KEY    '    Poptn
     C                   Parm      wccy          Pcurr
     C     Sdcurr        Parm      Sdcurr        Dssdy
 
     C                   If        Prtcd <> *Blanks
     C                   Eval      dbfile = 'SDCURRPD'
     C                   Eval      dbase = 9
     C                   Eval      dbkey = wccy
     C                   Exsr      *PSSR
     C                   Endif
 
     C                   Endsr
     C
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * *Inzsr - Program Initialisation routine                       *
      *                                                               *
      * Called by: Implicitly on program activation                   *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
 
     C     *INZSR        Begsr
 
     C     *Entry        Plist
 
      ** Return code
     C                   Parm                    RetCodeIn
      ** Transaction ID (RFTID/CCTID)
     C                   Parm                    TransID
      ** Transaction Reference
     C                   Parm                    TransRef
 
      ** Klist for FT101DL0/FT102DL0
     C     KTrans        Klist
     C                   Kfld                    TransID
     C                   Kfld                    TransRef
 
      ** Access Bank Details
 
     C                   Call      'AOBANKR0'
     C                   Parm      *Blanks       Prtcd
     C                   Parm      '*FIRST   '   Poptn
     C     Sdbank        Parm      Sdbank        Dsfdy
 
     C                   If        Prtcd <> *Blanks
     C                   Eval      dbfile = 'SDBANKPD'
     C                   Eval      dbase = 1
     C                   Eval      dbkey = '*FIRST'
     C                   Exsr      *PSSR
     C                   Endif
      *
      **  Read data area - RUNDAT                                              188654
      *                                                                        188654
     C     *DTAARA       DEFINE                  RUNDAT                        188654
     C                   IN        RUNDAT                                      188654
      *                                                                        188654
      * Convert todays run date to current date format                         188654
      *                                                                        188654
     C                   CallB     'ZDATE2'                                    188654
     C                   PARM                    BJRDNB                        188654
     C                   PARM                    MDIN                          188654
     C                   PARM                    WSLDTD1           6 0         188654
     C                   PARM      *Blanks       WQ0004            7           188654
 
      ** Access Funds Transfer Details
 
     C                   Call      'AOFTFRR0'
     C                   Parm      *Blanks       Prtcd
     C                   Parm      '*FIRST   '   Poptn
     C     Sdftfr        Parm      Sdftfr        Dsfdy
 
     C                   If        Prtcd <> *Blanks
     C                   Eval      dbfile = 'SDFTFRPD'
     C                   Eval      dbase = 2
     C                   Eval      dbkey = '*FIRST'
     C                   Exsr      *PSSR
     C                   Endif
 
      ** Access Module Details                                                                CFT032
                                                                                              CFT032
     C                   Call      'AOMMODR0'                                                 CFT032
     C                   Parm      *Blanks       @RtCd                                        CFT032
     C                   Parm      '*FIRST'      @Optn                                        CFT032
     C     SDMMOD        Parm      SDMMOD        DSSDY                                        CFT032
                                                                                              CFT032
     C                   If        @RtCd <> *Blanks                                           CFT032
     C                   Eval      DBFile = 'SDMMODPD'                                        CFT032
     C                   Eval      Dbase = 002                                                CFT032
     C                   Eval      DBKey = @Optn                                              CFT032
     C                   Exsr      *PSSR                                                      CFT032
     C                   EndIf                                                                CFT032
                                                                                              CFT032
      *                                                                                       CER030
      ** Check the switchable feature CER031                                                  CER030
      *                                                                                       CER030
     C                   CALLB     'AOSARDR0'                                                 CER030
     C                   PARM      *BLANKS       PRtCd                                        CER030
     C                   PARM      '*VERIFY'     POptn                                        CER030
     C                   PARM      'CER031'      PSard                                        CER030
     C     SCSARD        PARM      SCSARD        DSFDY                                        CER030
      *                                                                                       CER030
     C                   IF        PRtCd = *BLANKS                                            CER030
     C                   EVAL      CER031 = 'Y'                                               CER030
     C                   ELSE                                                                 CER030
      *                                                                                       CER030
      ** Database error (return code other than *NRF)                                         CER030
      *                                                                                       CER030
     C                   IF        PRtCd  <> '*NRF   '                                        CER030
      *                                                                                       CER030
     C                   EVAL      DBFILE =  'SCSARDPD'                                       CER030
     C                   EVAL      DBASE  =  010                                              CER030
     C                   EVAL      DBKEY  =  POptn                                            CER030
     C                   EXSR      *PSSR                                                      CER030
     C                   ELSE                                                                 CER030
     C                   EVAL      CER031 = 'N'                                               CER030
      *                                                                                       CER030
     C                   ENDIF                                                                CER030
      *                                                                                       CER030
     C                   ENDIF                                                                CER030
      ** Program, module and procedure names for database error processing.
      ** =================================================================
      ** The following /COPY sets these values, and also defines LDA as
      ** an external data area
 
     C/COPY ZACPYSRC,DBFIELDS
 
     C                   ENDSR
 
      *****************************************************************
      /EJECT
      *****************************************************************
      **--------------------------------------------------------------------------------------------
      ** The following /COPY contains the standard program status
      ** subroutine, including a bound call to the DBERRCTL module.
     C/COPY ZACPYSRC,PSSR_ILE
      **--------------------------------------------------------------------------------------------
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                                       CSW209
      ** Element 'IBEI' in Array 'CUS1' has been deleted.                                     CSW209
      *                                                                                       CSW209
**  CPY@
(c) Finastra International Limited 2001
**  #SLST                                                                                     CSW207
1/2/3/4/5/6/7/8/                                                                              CSW207
**  CUS1                                                                                      CSW207
ARNU                                                                                          CSW207
CCPT                                                                                          CSW207
CUST                                                                                          CSW207
DRLC                                                                                          CSW207
EMPL                                                                                          CSW207
NIDN                                                                                          CSW207
SOSE                                                                                          CSW207
TXID                                                                                          CSW207
