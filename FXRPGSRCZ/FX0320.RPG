     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FX Update FX Database')                          *
     F****************************************************************
     F*                                                              *
     F*  Midas - FX Dealer Module
     F*                                                              *
     F*     FX0320    - UPDATE FX DATABASE                           *
     F*                                                              *
     F*     This program will be made redundant at DBA R4.00         *
     F*     In the interim please check the new ILE RPG versions     *
     F*     and apply any new fixes if they are appropriate.         *
     F*                                                              *
     F*     Function:   This program updates the Foreign exchange    *
     F*     (I/C)       equivalents, positions and profit file       *
     F*     (I/C INIT)  (FXEPOSPP), and the forward book file        *
     F*                 (FXFWDDPP) in I/C Initiation and I/C for     *
     F*                 every FX transaction entered.                *
     F*                                                              *
     F*     Called by: FX8020  - Present after hours deals (I/C INIT)*
     F*              : FX0820  - FX Deal input              (I/C)    *
     F*              : FX0830  - FX Deal range authorisation(I/C)    *
     F*                                                              *
     F******Calls****:*FX1000**-*Customer/parent*data*generation**********S01319
     F*                                                              *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                              *
      *  Last Amend No. CSW212             Date 03May12               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242477             Date 27Sep06               *
      *                 CDL049             Date 07Jul06               *
      *                 BUG11679           Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 184828             DATE 08Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      *                 182794             DATE 06Sep00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 156672             DATE 22Mar99               *
      *                 154448             DATE 13Jul98               *
      *                 CAP002             Date 01May98               *
      *                 CEU003             Date 08Jan98               *
      *                 CDL002             Date 14Jan97               *
     F*                 CAC001             Date 01Feb96              *
     F*                 S01408             DATE 24MAY96              *
     F*                 090654             DATE 19JUL95              *
     F*                 041754             DATE 10OCT95              *
     F*                     082738             DATE   05FEB95        *
     F*                     S01408             DATE   18APR95        *
     F*                     S01486             DATE   06OCT94        *
     F*                     S01453             DATE   13DEC93        *
     F*                     E39319             DATE   15APR93        *
     F*                     E47225             DATE    1FEB93        *
     F*                     S01319             DATE   06NOV91        *
     F*                     S01319             DATE    5AUG91        *
     F*                     S01277             DATE   18JUN90        *
     F*                     DT0203             DATE   30MAY91        *
     F*                     DT0074             DATE   10MAY91        *
     F*                     E22405             DATE   18JUN90        *
     F*                     LN0391             DATE   21JUN90        *
     F*                     S01227             DATE   16NOV89        *
     F*                     E19660             DATE   18/10/89       *
     F*                     E18468             DATE   18/10/89       *
     F*                     E17909             DATE   18/10/89       *
     F*                     E17654             DATE   18/10/89       *
     F*                     S01117             DATE   17/03/89       *S01117
     F*                     S01194             DATE   15/03/89       *S01194
     F*                     S01177             DATE   12/09/88       *S01177
     F*                     E16211             DATE   18/01/89       *
     F*                     E16484             DATE   05/01/89       *
     F*                     E13902             DATE   27/07/88       *
     F*                     E13899             DATE   01/07/88       *
     F*                     E13898             DATE   01/07/88       *
     F*                     E13228             DATE   07/06/88       *
     F*                     E13249             DATE   16/05/88       *
     F*                     E13237             DATE   12/05/88       *
     F*                     E13223             DATE   10/05/88       *
     F*                     E13208             DATE   10/05/88       *
     F*                     E12887             DATE   13/04/88       *
     F*                     E12787             DATE   30/03/88       *
     F*                     E12279a            DATE   17/03/88       *
     F*                     E12334             DATE   15/03/88       *
     F*                     E12441             DATE   15/03/88       *
     F*                     E12279             DATE   12/02/88       *
     F*                     S01136             DATE   24/01/88       *
     F*                     S01136             DATE   21/01/88       *
     F*                     S01136             DATE   10/12/87       *
     F*                     S01136             DATE   10/12/87       *
     F*                     S01136             DATE   10/12/87       *
     F*                     S01136             DATE   09/12/87       *
     F*                                                              *
     F****************************************************************
     F*                                                              *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  242477 - Applied fix 199711.  Update related deal of broker  *
      *           code swap (dtyp = CX and broker code = SWAP) such   *
      *           that deal type ind is set to 'S' but original deal  *
      *           type remains as 'CX' instead of changing to 'SW'.   *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha.*
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
     F*  184828 - Update Deal Transaction Date, Value Date and Option*
     F*           Date correctly on FXDEALPP.                        *
      *  CDL008 - Continuous Linked Settlement                        *
     F*  182794 - Do not blank out Settlement Receive or Pay currency*
     F*           if the Buy or Sell Deal currency is EURO.          *
     F*  156672 - Program always updated the settlement currencies   *
     F*           without checking whether the Buy and/or Sell       *
     F*           currencies were "In " Currencies.                  *
     F*  154448 - Correct update of online position file for swap deals
     F*  CAP002 - Recompiled as part of conversion of Midas inputs to *
     F*           modular API structure.                              *
     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
     F*  CDL002 - FX Netting.                                         *
     F*  CAC001 - Profit Centre Accounting Development:              *
     F*           For an Option Takedown deal ('OT'), reduce margin  *
     F*           amount of the related 'OP' deal if action is insert*
     F*           increase the margin of the related 'OP' deal if    *
     F*           action is delete and adjust the margin amount of   *
     F*           the related 'OP' deal if action is amend.          *
     F*     S01408 - Addition of Core Hook FX0320FFP1                *
     F*            - Addition of Core Hook FX0320IIP1                *
     F*            - Addition of Core Hook FX0320CCP8                *
     F*            - Addition of Core Hook FX0320CCP9                *
     F*            - Addition of Core Hook FX0320CP10                *
     F*            - Addition of Core Hook FX0320CP11                *
     F*            - Addition of Core Hook FX0320CP12                *
     F*            - Addition of Core Hook FX0320CP13                *
     F*            - Addition of Core Hook FX0320CP14                *
     F*            - Addition of Core Hook FX0320CP15                *
     F*     090654 - CDP FIELD SHOULD BE OF 1,0 LONG AND SHOULD USE  *
     F*              Z-ADD INSTEAD OF MOVEL OPERATION                *
     F*     041754 - On authorize of an FX deal, last change type    *
     F*              in FXDEALPP incorrectly set to 'D'. Affects     *
     F*              online exposure updating                        *
     F*     082738 - Account Movements.                              *
     F*              Rewrite update of PRONO, MEMOS & RSACMTPD using *
     F*              access object AOSPOSU0 via utility AOOUFXU0.    *
     F*     S01408 - Addition of Core Hook FX0320CCP7                *
     F*            - Addition of Core Hook FX0320CCP6                *
     F*            - Addition of Core Hook FX0320CCP5                *
     F*            - Addition of Core Hook FX0320CCP4                *
     F*            - Addition of Core Hook FX0320CCP3                *
     F*            - Addition of Core Hook FX0320CCP2                *
     F*            - Addition of Core Hook FX0320CCP1                *
     F*            - Addition of Core Hook FX0320CCPG                *
     F*     S01486 - Portfolio Management Upgrade to Release 10.     *
     F*     S01453 - Margin and FX Positions/Points and Base         *
     F*              Currency Positions/Points added to FX input     *
     F*     E39319 - Cross currencies records on FXEPOSPP are        *
     F*              processed for action code authorise.            *
     F*     E47225 - Condition CALL to AORETLR0 on retail being      *
     F*              present.                                        *
     F*     S01319 - (HY0011) Condition access of SDTRMAPD on the    *
     F*              TM flag being on.                               *
     F*     S01319 - Remove redundant processing                     *
     F*     S01277 - Cross currencies position update.               *
     F*     DT0203 - RECOMPILED FOR FXSTDDPP CHANGE                  *
     F*                                                              *
     F*     DT0074 - Last change type should be 'D' if delete        *
     F*                                                              *
     F*     E22405 - Add new field to Extended Settlements.(Cover    *
     F*              MT202 required).                                *
     F*                                                              *
     F*     LN0391 - Replace '*DBERR' with '*MSG' when calling       *
     F*              access objects                                  *
     F*                                                              *
     F*     S01227 - Copy PC Settlement instructions to new extended *
     F*              settlement fields.                              *
     F*                                                              *
     F*     E19660 - Setup the date value for @@VDAT in the          *
     F*              subroutine ZA0640, so that it can calculate     *
     F*              the outright exchange rate for a given Value    *
     F*              date which do not have a rate on file           *
     F*                                                              *
     F*     E18468 - File access changed to keyed to enhance         *
     F*              speed of FX takeon.                             *
     F*                                                              *
     F*     E17909 - FXSTDDLL is defined as a keyed file in FX0320   *
     F*              even though it is not keyed.                    *
     F*                                                              *
     F*     E17654 - CUSTOMER EXPOSURE FILE KEYED ON NUMBER NOW      *    E17654
     F*                                                              *    E17654
     F*     S01117 - Multibranching                                  *
     F*                                                              *
     F*     S01194 - New standing data - add access programs         *
     F*                                                              *
     F*     S01177 - Extended settlements.                           *
     F*                                                              *
     F*     E16211 - Release 1 new fields Book Code & Linked         *
     F*              Reference Number not being updated.             *
     F*                                                              *
     F*     E16484 - Amending SWAP from previous day expects other   *
     F*              leg on FXDW38LL. Other leg is not needed.       *
     F*                                                              *
     F*     E13902 - If brokerage on standard deal is all 9's        *
     F*              update deals file with all 9's.                 *
     F*                                                              *
     F*     E13899 - Download blotter associated deal number should  *    SS1262
     F*              be updated with the AS400 deal number for swaps *    SS1262
     F*              and not the PC deal number.                     *
     F*                                                              *
     F*     E13898 - Processing for dates before run date incorrect  *    SS1262
     F*              and unnecessary when calculating P/L in ZA0640  *    SS1262
     F*                                                              *
     F*     E13228 - MIDAS customer pay/receive instruction are      *    SS1262
     F*              being output incorrectly, causing swift and     *    SS1262
     F*              deal tickets to fall over. Move correct field   *    SS1262
     F*              in to instructions field.                       *    SS1262
     F*                                                              *
     F*     E13249 - Banks open position should be adjusted to       *
     F*              reflect difference between exchange rates at    *
     F*              option date and takedown date.                  *
     F*                                                              *
     F*     E13237 - P & L for spot date should be included in the   *
     F*              figure for spot P & L, not forward P & L        *
     F*                                                              *
     F*     E13223 - Deadlocking on Customer exposure, uses some     *
     F*              wrong fields.                                   *
     F*              ALSO correct - Doesnt add Parent FXCUEXPP       *
     F*              after Customer FXCUEXPP added.                  *
     F*              ALSO correct - Uses This Deal Customer instead  *
     F*              of Related Deal Customer for Swap Deletions.    *
     F*                                                              *
     F*     E13208 - Remove E12441                                   *
     F*                                                              *
     F*     E12887 - S/R #BDB fixed to calculate short and forward   *
     F*              profit/loss for option takedowns using @ACDR5   *
     F*              (option date) and not @ACTD5(takedown date).    *
     F*                                                              *
     F*     E12787 - Program incorrectly processing the setting up of*
     F*              the short/forward date when the period date for *
     F*              this is defined as spot. The database error has *
     F*              been eliminated.                                *
     F*                                                              *
     F*    E12279a - Core fix to prevent dead-locking.               *
     F*              (In #BA if the deal type is swap, the action    *
     F*               is amend or delete, and the associated deal    *
     F*               number less than the deal number, then the     *
     F*               deals file is chained for the associated deal  *
     F*               in order to lock this record to the program.)  *
     F*              (In #BC required customer exposure file         *
     F*               updates are determined and sorted so that      *
     F*               updates; in #BCA; are performed in ascending   *
     F*               shortname/currency order, with all client      *
     F*               updates being done before parent updates.)     *
     F*              (In #BD required forward book file updates      *
     F*               are determined and sorted so that updates;     *
     F*               in #BDA and #BDB; are performed in ascending   *
     F*               currency/date order - NB. This superceeds      *
     F*               fix E12279.)                                   *
     F*                                                              *
     F*     E12279 - fix to prevent deadlock on insertions or        *    E12279
     F*              amendment on fxfwddpp and fxepospp file.        *    E12279
     F*                                                              *
     F*     E12334 - Pay/receive instructions updated incorrectly    *    E12334
     F*              when blank entered; outputs zero nostro code.   *
     F*                                                              *
     F*     E12441 - USE BRCD INSTEAD OF KEY FOR UPDATE OF STD DEAL  *    E12441
     F*                                                              *
     F*     S01136 - USE FXCEXDLL INSTEAD OF FXCEXELL                *
     F*                                                              *
     F*     S01136 - 10/12/87 - FRONT OFFICE SETTLEMENT AMENDS NOT   *
     F*                         PICKED BY MIDAS FIELDS               *
     F*                                                              *
     F*     S01136 - 10/12/87 - #BCA PUTTING AMOUNTS IN WRONG FIELD  *
     F*                                                              *
     F*     S01136 - #ZA INCORRECTLY FORMATTING NEGATIVE AMOUNTS     *
     F*                                                              *
     F*     S01136 - 21/01/88 - Check for data base error added at   *
     F*              lines 4518 and 4533. Line 4507 changed to show  *
     F*              correct data base error number.                 *
     F*                                                              *
     F*     S01136 - 24/01/88 - DEAL STATUS OF 'A' NOT SET UP        *
     F*              BLOTTER FOR AUTHORISED DEALS.                   *
     F*                                                              *
     F*                                                              *
     F****************************************************************
     F*
     F**  Indicator Function Summary
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     F*       60  FILE ACCESS INDICATOR - FXDEAULL INITIAL READ
     F*       61  FILE ACCESS INDICATOR - FXDWNBLL
     F*       62  FILE ACCESS INDICATOR - FXCUEXPP
     F*       63  FILE ACCESS INDICATOR - GENERAL
     F*       64  FILE ACCESS INDICATOR - FXFWDULL
     F*       65  FILE ACCESS INDICATOR - FXFWMULL
     F*       66  FILE ACCESS INDICATOR - FXEPOULL
     F*       67  FILE ACCESS INDICATOR - FXCRSCLL                        S01277
     F*       68  FILE ACCESS INDICATOR - FXEPOCLL                        S01277
     F*       79  TEST NUMERIC INDICATOR
     F********80**ZA0870*FILE*ACCESS*FOR*FDINSTLL**
     F*       80  ZA0710 LOKUP RESULTING INDICATOR
     F*       81  ZA0710 LOKUP RESULTING INDICATOR
     F*       U6  PROGRAM ERROR
     F*     U7+U8 DATA BASE ERROR
     F*
     F*****************************************************************
     F*****FDICDRLLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     F*FDINSTLLIF**E*******************DISK*********KINFSR*INFSR******UC**S01319
     FFDCCYPLLIF  E           K        DISK         KINFSR INFSR      UC
     F*FXSSTSLLIF**E*******************DISK*********KINFSR*INFSR******UC**S01319
     F*****FDBRKRLLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     F*****FDBSNCLLIF E       K        DISK         KINFSR INFSR      UC  S01194
     F****FXSTDDLLO   E       K        DISK         KINFSR INFSR      UC  E17909
     F*XSTDDLLO   E                    DISK         KINFSR INFSR   E17909 E18468
     F*FXSTDDLLO***E**********K********DISK*********KINFSR*INFSRUC**E18468S01319
     F**********************************************KCOMIT****************S01319
     F*FXDW38LLUF**E**********K********DISK*********KINFSR*INFSR*A****UC**S01319
     F**********************************************KCOMIT****************S01319
     F*****FDNOSTLLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     F*****FDSNAMLLIF  E     K        DISK         KINFSR INFSR      U C  S01194
     FFXREVHLLIF  E           K        DISK         KINFSR INFSR      UC
     FFXDEAULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F*****FDCSNMLLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     FFXEPOULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F*****FDCCYTLLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     F*****FDTG11LLIF  E      K        DISK         KINFSR INFSR      UC  S01194
     F************TABTG10F                          KRENAMERTBTG10F       S01194
     F************TABTG20F                          KIGNORE               S01194
     FFXFWMULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     FFXFWDULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F*XCEXELLUF  E           K        DISK         KINFSR INFSR A    UC  S01136
     F*FXCEXDLLUF**E**********K********DISK*********KINFSR*INFSR*AUCS01136S01319
     F**********************************************KCOMIT****************S01319
     FFXCRSCLLIF  E           K        DISK         KINFSR INFSR          S01277
     F*FXEPOCLLUF**E***********K********DISK*********KINFSR*INFSR*A*S01277S01319
     FFXEPOCLLUF  E           K        DISK         KINFSR INFSR A    UC  S01319
     F            FXEPOSP0                          KRENAMEFXEPOCL1       S01277
     F*                                                                   S01408
     F/COPY WNCPYSRC,FX0320FFP1                                           S01408
     F*                                                                   S01408
     //EJECT
     E*
     E*
     E**  ARRAY FOR SR. ZA0620 - DECIMAL PLACES CORRECTION
     E**  ( ie 1000  100  10  1  .1  .01  .001)
     E                    @DP     7   7  7 3
     E*
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E*
     E********************@AF********15**1********************************S01319
     E********************@AD*********3**1********************************S01319
     E********************@AI********15**1********************************S01319
     E*
     E** USED TO PREPARE FIELDS FOR TESTN
     E                    @IA        10  1
     E                    @O         10  1
     E*
     E** TABLES FOR SHORT OR FORWARD P/L
     E                    TAB1    1  12  4   TAB2    2
     E*
     E********************@CK********10*16**A*********************E12279aS01319
     E****Array*to*store*and*sort*customer*exposure*file*keys*****E12279aS01319
     E****with*sequence*numbers*for*proposed*updates**************E12279aS01319
     E*                                                                  E12279a
     E                    @FK        14 13  A                            E12279a
     E**  Array to store and sort forward book file keys with            E12279a
     E**  sequence numbers for proposed updates                          E12279a
     E*
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80
     E*   COPYRIGHT ARRAY
     //EJECT
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I** DATA STRUCTURE FOR BRANCH DETAILS                                S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** DATA STRUCTURE FOR CURRENCY DETAILS                              S01194
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I** DATA STRUCTURE FOR RETAIL DETAILS                                S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** DATA STRUCTURE FOR BANK DETAILS                                  S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I              QQDFAC                          QQDFC1                                    CGL029
     I** DATA STRUCTURE FOR CUSTOMER DETAILS                              S01194
     I*                                                                   S01194
     ISDBROK    E DSSDBROKPD                                              S01194
     I** DATA STRUCTURE FOR BROKER DETAILS                                S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACD1                                    CGL029
     I** DATA STRUCTURE FOR NOSTRO DETAILS                                S01194
     I*                                                                   S01194
     ISDCNST    E DSSDCNSTPD                                              S01194
     I** DATA STRUCTURE FOR COUNTERPARTY NOSTRO DETAILS                   S01194
     I*
     ISDDEAL    E DSSDDEALPD                                              S01319
     I              QQACCD                          QQACD2                                    CGL029
     I** DATA STRUCTURE FOR DEALING DETAILS                               S01319
     I*                                                                   S01319
     ISDTRMA    E DSSDTRMAPD                                              S01319
     I** DATA STRUCTURE FOR TREASURY MANAGEMENT DETAILS                   S01319
     I*                                                                   S01319
     ISDMMOD    E DSSDMMODPD                                              S01319
     I* DATA STRUCTURE FOR MODULE DETAILS                                 S01319
     I*                                                                   S01319
     ISCSARD    E DSSCSARDPD                                              CEU003
      ** Switchable Features File                                         CEU003
      *                                                                   CEU003
     ISDGELR    E DSSDGELRPD                                              CEU003
     I              QQACCD                          QQACD3                                    CGL029
      ** External DS for GENERAL LEDGER  Details                          CEU003
      *                                                                   CEU003
     I/COPY WNCPYSRC,FX0320I001
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01117
     I*****RTBTG10F                                                       S01194
     I*****                                                           *   S01194
     I****Fields*renamed*to*avoid*confusion*between*table*file*fields.*   S01194
     I**************RECI                            CRECI                 S01194
     I**************KEY                             CKEY                  S01194
     I**************CDP                             CCDP                  S01194
     I*
     IPSDS       SDS
     I*
     I**  Program status data structure.
     I**  Field containing FILE NAME
     I                                      201 208 @FILE
     I****Field*containing*workstaion**ID.********************************S01319
     I**************************************244*253*@JOB******************S01319
     I**  Field containing user ID.
     I                                      254 263 @USER
     I*
     I           UDS
     I**  Local data area for data base errors.
     I**  Field containing name of database file in error.
     I                                      134 141 DBFILE
     I**  Field containing key value causing database error.
     I                                      142 170 DBKEY
     I**  Field containing name of program causing database error.
     I                                      171 180 DBPGM
     I**  Field containing number of database error.
     I                                      181 183 DBASE
     IDATE1       DS
     I                                        1   8 @DATE1
     I                                        1   4 @D1YY
     I                                        5   6 @D1MM
     I                                        7   8 @D1DD
     IRUNS1       DS
     I                                        1   7 RUNA                  S01194
     I                                        1   2 @RUND
     I                                        3   5 @RUNM
     I                                        6   7 @RUNY
     I*
     I** STANDARD DEAL EXTERNALLY DEFINED DATA STRUCTURE
     I@STDDL    E DSFXSTDDPP
     I*                                                                   082738
     I** FX DEAL EXTERNALLY DEFINED DATA STRUCTURE                        082738
     I@FXDL     E DSFXDEALPP                                              082738
     I              QQMORI                          QQMORX                                    CGL029
     I              QQMOPI                          QQMOPX                                    CGL029
     I              QQDORI                          QQDORX                                    CGL029
     I              QQDOPI                          QQDOPX                                    CGL029
     I              QQRONS                          QQRONX                                    CGL029
     I              QQPONS                          QQPONX                                    CGL029
     I*                                                                   082738
     I** Data Structures to define long parameters for AOOUFXU0           082738
     I            DS                                                      082738
     IZ#BSTS    E DSZ#BST                                                 082738
     IZ#ASTS    E DSZ#AST                                                 082738
     IZ#WSTS    E DSZ#WST                                                 082738
     IZ#XSTS    E DSZ#XST                                                 154448
     I*
     I**  DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE
     I            DS
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        3   40@@YY
     I                                        1   20@@CC
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I*
     I****DATA*STRUCTURE*FOR*TABTG20*ACCESS***                            S01194
     I****@@KDCY      DS                                                  S01194
     I****************                        1   2 @@K20                 S01194
     I****************                        9  11 @@CCY                 S01194
     I****************                       12  12 @@K1                  S01194
     I*
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I*
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I*
     I***USED*IN*ALIGN*FIGURE*ROUTINE*************************************S01319
     I*@ALIGD*****DS******************************************************S01319
     I****************************************1***3*@AD*******************S01319
     I****************************************1***30@ALDEC****************S01319
     I*@ALIGI*****DS******************************************************S01319
     I****************************************1**15*@AI*******************S01319
     I****************************************1**150@ALINT****************S01319
     I@INAMT      DS
     I                                        1  10 @IN
     I                                        1  10 @IA
     I@OUTAM      DS
     I                                        1  10 @OUT
     I                                        1  10 @O
     I*
     I@PRLOS      DS                          2
     I* USED IN REVALUATION PROFIT/LOSS CALCULATION  FOR ADJUSTMENT
     I* TO EXPOSURE,POSITIONS AND P/L FILE WHEN FORWARD BOOK DAILY
     I* RECORDS ARE UPDATED
     I                                        1   3 @PCCY
     I                                        4  180@SPLO
     I                                       19  330@FPLO
     I                                       34  34 @ADJAD
     I*
     I*@CEKE******DS*****************************16*****************E12279S01319
     I****Customer*exposure*file*key*array*element*data*structure**E12279aS01319
     I****-*used*by*@CK********************************************E12279aS01319
     I****************************************1***1*@CECP*****************E12279
     I*****                                   2  11 @CESN          E12279 E17654
     I****************************************2***70@CESN***********E17654S01319
     I***************************************12**14*@CECY***********E12279S01319
     I***************************************15**16*@CESQ***********E12279S01319
     I*                                                                  E12279a
     I@FBKE       DS                             13                       E12279
     I**  Forward book file key array element data structure             E12279a
     I**  - used by @FK                                                  E12279a
     I                                        1   3 @FBCY                 E12279
     I                                        4  11 @FBDT                 E12279
     I                                       12  13 @FBSQ                 E12279
     I*
     I*                                                                   S01408
     I/COPY WNCPYSRC,FX0320IIP1                                           S01408
     I*                                                                   S01408
     I*****************************************************************
     //EJECT
     C****************************************************************
     C*                 MAIN PROGRAM
     C*                 ~~~~~~~~~~~~
     C** INITIAL PROCESSING
     C                     EXSR #A
     C*
     C** MAIN PROCESSING FXP0035
     C           *INU7     IFNE '1'                        B1
     C           @TERM     ANDNE'T'                        *1
     C                     EXSR #B                         *1
     C                     END                             E1
     C*
     C** FINAL PROCESSING
     C           ENDPGM    TAG                                        ***
     C                     EXSR #C
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP8                                           S01408
     C*                                                                   S01408
     C                     RETRN
     C****************************************************************
     //EJECT
     C****************************************************************
     C*                                                              *
     C*            INDEX TO SUBROUTINES                              *
     C*            ~~~~~~~~~~~~~~~~~~~~                              *
     C*   1. #B           MAIN PROCESSING                            *
     C*   2. ZA0680       CONVERT YYYYMMDD TO DAY NUMBER             *
     C****3.*#BCA*********CALCULATE*NEW*EXPOSURE*FIGURES******************S01319
     C*   4. ZA0620       CALCULATE REVALUATION P/L                  *
     C*   5. ZA0640       CALCULATE FORWARD OUTRIGHT RATE            *
     C****6.*ZA0870*******GET*DBCE*DECIMAL*PLACES*********************    S01194
     C*   6. #AB          GET DBCE DECIMAL PLACES                    *    S01194
     C****7.*#ZA**********ALIGN*AMOUNT************************************S01319
     C*   8. #BDB         UPDATE FORWARD BOOK FOR OPTION TAKEDOWN    *
     C*   9. #BDA         UPDATE FORWARD BOOK DAILY SCHEDULE         *
     C*  10. ZA0710       CONVERT DAY NUMBER TO YYYYMMDD             *
     C***11.*#BB**********UPDATE*FX*DOWNLOAD*BLOTTER**********************S01319
     C***12.*#BC**********UPDATE*CUSTOMER*EXPOSURE*DETAILS****************S01319
     C*  13. #BD          UPDATE FORWARD BOOK DETAILS                *
     C*  14. #BE          UPDATE EQUIVALENTS POSITIONS & PROFITS     *
     C*  15. #BEA         CALCULATE ADJUSTMENTS                      *
     C*  16. #BEB         UPDATE FXEPOULL - ADD THIS DEAL            *
     C*  17. #BEC         UPDATE FXEPOULL - DELETE PREV AMOUNTS      *
     C*  18. #BAC         UPDATE DEALS FILE                          *
     C*  19. #BED         UPDATE FXEPOULL - REMOVE RELATED DEAL      *
     C*  20. #BEE         UPDATE FXEPOULL - ADD IN TAKEDOWN          *
     C*  21. #BEF         UPDATE FXEPOULL - DELETE TAKEDOWN          *
     C*  22. #BEG         UPDATE FXEPOULL - AMEND TAKEDOWN           *
     C*      #BEH         UPDATE FXEPOCLL - CROSS CURRENCIES         *    S01277
     C*  23. #ZD          CREATE ZERO RECORD FOR FXEPOULL            *
     C*  24. #A           INITIAL PROCESSING                         *
     C*  25. #BA          UPDATE DEALS FILE                          *
     C*  26. #BAA         UPDATE SUPPLEMENTARY STANDARD DEAL         *
     C*  27. #ZB          PREPARE FIELD FOR TESTN                    *
     C*  28. #BAB         UPDATE SUPP STD DEAL RELATED DEAL FIELDS   *
     C*  29. #BAD         UPDATE DEALS FILE - RELATED DEAL           *
     C*  30. #C           FINAL PROCESSING                           *
     C*  31. *PSSR        PROGRAM ERROR SUBROUTINE                   *
     C*  32. INFSR        FILE ERROR SUBROUTINE                      *
     C*                                                              *
     C*                                                              *
     C*                                                              *
     C****************************************************************
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #B    FXP0035 MAIN PROCESSING                   *
     C*                                                              *
     C*  FIELDS USED :     @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       MAIN PROGRAM                              *
     C*                                                              *
     C***CALLS*:***********#BB*#BC*#BD*#BE********************************S01319
     C*  CALLS :           #BA #BD #BE                               *    S01319
     C*                                                              *
     C****************************************************************
     C           #B        BEGSR
     C*
     C** FXP0038
     C                     EXSR #BA
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP7                                           S01408
     C*                                                                   S01408
     C*
     C***FX0041***********************************************************S01319
     C************INU7*****IFNE*'1'************************B1*************S01319
     C***********@FRBA*****ANDEQ'F'*************************1*************S01319
     C*********************EXSR*#BB*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***FXP0039**********************************************************S01319
     C************INU7*****IFNE*'1'************************B1*************S01319
     C*********************EXSR*#BC*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C** FXP0042
      *  - only if Treasury management present                            S01319
     C           *INU7     IFNE '1'                        B1
     C           @TERM     ANDNE'E'                        *1
     C           BGTRMG    ANDEQ'Y'                                       S01319
     C                     EXSR #BD                        *1
     C                     END                             E1
     C*
     C** FXP0043
      *  - only if Treasury management present                            S01319
     C           *INU7     IFNE '1'                        B1
     C           @TERM     ANDNE'E'                        *1
     C           BGTRMG    ANDEQ'Y'                                       S01319
     C                     EXSR #BE                        *1
     C                     END                             E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP6                                           S01408
     C*                                                                   S01408
     C** FXP0219
     C           *INU7     IFNE '1'                        B1
     C           @TERM     ANDNE'E'                        *1
     C                     Z-SUBF3DSEL    F3DSEL           *1
     C                     MOVE 'F3'      F3RCID           *1
     C                     MOVE ' '       F3DLTF           *1
     C                     MOVE @RUND     F3DLUP           *1
     C                     MOVE @RUNM     F3MLUP           *1
     C                     MOVE @RUNY     F3YLUP           *1
     C                     TIME           F3TLUP           *1
     C                     MOVE 'I'       F3CHTP           *1
     C*********************MOVE RUND      F3LCD            *1             S01194
     C                     MOVE BJRDNB    F3LCD            *1             S01194
     C                     MOVEL@USER     F3LUID           *1
     C*********************WRITEFXSTDDP0********************1*************S01319
     C                     END                             E1
     C*
     C           #B9       ENDSR
     //EJECT
     C*******************************************************************
     C*                                                               *
     C* ZA0680 - THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO     *
     C*          MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)     *
     C*                                                               *
     C**CALLED*BY*:*#A*#BA*#BC*#BCA*#BD*#BE****************************   S01319
     C* CALLED BY : #A #BA #BD #BE                                    *   S01319
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)
     C*                                                               *
     C* OUTPUT : @@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                 *
     C*                                                               *
     C* USES :   @@CC   NUMBER OF CENTURIES IN DATE                   *
     C*          @@DAY  DAY NUMBER                                    *
     C*          @@REM  REMAINDER FROM DIVIDE                         *
     C*          @@MTH  MONTH NUMBER                                  *
     C*          @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN *
     C*                 MONTH                                         *
     C*          @@WK2  WORK FIELD (2,0)                              *
     C*          @@WK5  WORK FIELD (5,0)                              *
     C*          @@YYYY YEAR (4 CHARACTER)                            *
     C*          @@YY   YEAR (2 CHARACTER)                            *
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN *
     C*                 A FOUR YEAR PERIOD                            *
     C*                                                               *
     C*******************************************************************
     C*
     C           ZA0680    BEGSR
     C*
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD
     C                     Z-ADD0         @@MDNO  50
     C*
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING
     C           @@YYYY    IFGE 2072                       B1
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)
     C           @@CC      SUB  19        @@WK2   20       *1
     C           @@WK2     MULT 36524     @@MDNO           *1
     C*
     C**  YEAR 2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C           @@YYYY    ADD  28        @@WK2
     C*
     C           @@WK2     DIV  4         @@WK2
     C                     MVR            @@REM   10
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD
     C           @@WK2     MULT 1461      @@WK5   50
     C                     ADD  @@WK5     @@MDNO
     C*
     C**  CHECK REMAINDER AND MONTH NUMBER
     C           @@REM     IFEQ 0                          B1
     C           @@MTH     ANDGT2                          *1
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR
     C           @@REM     IFNE 0                          B1
     C                     ADD  @YD,@@REM @@MDNO           *1
     C                     END                             E1
     C*
     C**  ADD MONTHS THIS YEAR
     C                     ADD  @MD,@@MTH @@MDNO
     C*
     C**  ADD DAYS THIS MONTH
     C                     ADD  @@DAY     @@MDNO
     C*
     C           ZA0689    ENDSR                                     AG**
     C*****************************************************************
     //EJECT
     C****************************************************************
     C********************************************************************S01319
     C***SUBROUTINE:*#BCA**FXP0040**CALCULATE*NEW*EXPOSURE*FIGURES********S01319
     C********************************************************************S01319
     C***FIELDS*USED*:*****@RCUS**-**CUSTOMER*SHORTNAME*INPUT*************S01319
     C*********************@RCCY**-**CURRENCY*INPUT***********************S01319
     C*********************@RDAT**-**ACTION*DATE*INPUT********************S01319
     C*********************@RREV**-**REVERSE*INDICATOR********************S01319
     C*********************@RAMT**-**AMOUNT*INPUT*************************S01319
     C*********************@@DTIN*-**INPUT*DATE*FOR*ZA0680****************S01319
     C*********************@@MDNO*-**OUTPUT*DATE*FROM*ZA0680**************S01319
     C*********************@RDAT5*-**ACTION*DATE(NUM)*********************S01319
     C*********************@ENDD**-**END*LIMIT*DATE***********************S01319
     C*********************@RUND**-**RUN*DATE*(DAY)***********************S01319
     C*********************@RUNM**-**RUN*DATE*(MONTH)*********************S01319
     C*********************@RUNY**-**RUN*DATE*(YEAR)**********************S01319
     C*********************@USER**-**USER*FROM*PSDS***********************S01319
     C********************************************************************S01319
     C***CALLED*BY*:*******#BC*UPDATE*CUSTOMER*EXPOSURE*DETAILS***********S01319
     C********************************************************************S01319
     C***CALLS*:***********ZA0680*****************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BCA******BEGSR******************************************S01319
     C********************************************************************S01319
     C***ACCESS*FXCUPAP0*ON*CUST*SHORT*AS*PASSED*TO*THIS*ROUTINE**********S01319
     C***TO*GET*APPROPRIATE*FXCUPAP0*RECORD*******************************S01319
     C***********@RCUS*****CHAINFXCUPAP0*************63*******************S01319
     C************IN63*****IFEQ*'1'************************B1*************S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVEL@RCUS*****DBKEY***************************S01319
     C*********************MOVEL'FXCUPAP0'DBFILE*************DB*ERROR*023*S01319
     C*********************MOVEL'023'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8*************1*************S01319
     C*********************GOTO*#BCA9***********************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***ACCESS*FXCEXDLL*FORMAT*FXCUEXP0**********************************S01319
     C***********KEY2******KLIST******************************************S01319
     C*****                KFLD           FFCSNM                          E17654
     C*********************KFLD***********FFCNUM********************E17654S01319
     C*********************KFLD***********FFCCY***************************S01319
     C*****                MOVE @RCUS     FFCSNM                          E17654
     C*********************MOVE*@RCUS*****FFCNUM********************E17654S01319
     C*********************MOVE*@RCCY*****FFCCY***************************S01319
     C***********KEY2******CHAINFXCUEXP0*************62*******************S01319
     C************IN62*****IFEQ*'1'************************B1*************S01319
     C********************************************************************S01319
     C***WRITE*A*ZERO*RECORD*TO*FXCUEXP0**********************************S01319
     C*********************MOVE*'FF'******FFRCID************1*************S01319
     C*********************MOVE**BLANKS***FFDLTF************1*************S01319
     C*********************MOVE*@RUND*****FFDLUP************1*************S01319
     C*********************MOVE*@RUNM*****FFMLUP************1*************S01319
     C*********************MOVE*@RUNY*****FFYLUP************1*************S01319
     C*********************TIME***********FFTLUP************1*************S01319
     C*********************MOVE*'I'*******FFCHTP************1*************S01319
     C*********************MOVE RUND      FFLCD            *1             S01194
     C*********************MOVE*BJRDNB****FFLCD*************1*******S01194S01319
     C*********************MOVEL@USER*****FFLUID************1*************S01319
     C*********************MOVE**ZEROS****FFTPC1************1*************S01319
     C*********************MOVE**ZEROS****FFTPC2************1*************S01319
     C*********************MOVE**ZEROS****FFTPC3************1*************S01319
     C*********************MOVE**ZEROS****FFTPC4************1*************S01319
     C*********************MOVE**ZEROS****FFTPC5************1*************S01319
     C*********************MOVE**ZEROS****FFTPC6************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***CONVERT*ACTION*DATE*TO*5N****************************************S01319
     C*********************MOVE*@RDAT*****@@DTIN**************************S01319
     C***********@@DTIN****IFNE**ZEROS*********************B1*************S01319
     C*********************EXSR*ZA0680**********************1*************S01319
     C************INU7*****IFEQ*'1'************************B*2************S01319
     C*********************GOTO*#BCA9************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************MOVE*@@MDNO****@RDAT5**50********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE**ZEROS****@RDAT5************1*************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************S01136S01319
     C***SET*UP*RUN*DATE*MINUS*ONE*WORK*FIELD***********************S01136S01319
     C**************************************************************S01136S01319
     C***********RUND******SUB  1         @RUND1  50                S01136S01194
     C***********BJRDNB****SUB**1*********@RUND1**50****************S01194S01319
     C********************************************************************S01319
     C***IF*REVERSAL*INDICATOR*NOT*SET*ADD*EXPOSURES*TO*PERIODS***********S01319
     C********************************************************************S01319
     C***********@RREV*****IFNE*'R'************************B1*************S01319
     C***********FGEDP1****IFNE*0**************************B*2************S01319
     C***********FGSDP1    ADD  RUND      @ENDD   50       **2            S01136
     C***********FGSDP1****ADD**@RUND1****@ENDD***50*********2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC1****ADD**@RAMT*****FFTPC1**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP2****IFNE*0**************************B*2************S01319
     C***********FGSDP2    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP2****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC2****ADD**@RAMT*****FFTPC2**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP3****IFNE*0**************************B*2************S01319
     C***********FGSDP3    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP3****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC3****ADD**@RAMT*****FFTPC3**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP4****IFNE*0**************************B*2************S01319
     C***********FGSDP4    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP4****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC4****ADD**@RAMT*****FFTPC4**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP5****IFNE*0**************************B*2************S01319
     C***********FGSDP5    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP5****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC5****ADD**@RAMT*****FFTPC5**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP6****IFNE*0**************************B*2************S01319
     C***********FGSDP6    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP6****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC6****ADD**@RAMT*****FFTPC6**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***IF*REVERSAL*INDICATOR*SET*REMOVE*EXPOSURES*FROM*PERIODS**********S01319
     C***********@RREV*****IFEQ*'R'************************B1*************S01319
     C***********FGEDP1****IFNE*0**************************B*2************S01319
     C***********FGSDP1    ADD  RUND      @ENDD   50       **2            S01136
     C***********FGSDP1****ADD**@RUND1****@ENDD***50*********2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC1****SUB**@RAMT*****FFTPC1**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP2****IFNE*0**************************B*2************S01319
     C***********FGSDP2    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP2****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC2****SUB**@RAMT*****FFTPC2**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP3****IFNE*0**************************B*2************S01319
     C***********FGSDP3    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP3****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC3****SUB**@RAMT*****FFTPC3**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP4****IFNE*0**************************B*2************S01319
     C***********FGSDP4    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP4****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC4****SUB**@RAMT*****FFTPC4**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP5****IFNE*0**************************B*2************S01319
     C***********FGSDP5    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP5****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC5****SUB**@RAMT*****FFTPC5**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C***********FGEDP6****IFNE*0**************************B*2************S01319
     C***********FGSDP6    ADD  RUND      @ENDD            **2            S01136
     C***********FGSDP6****ADD**@RUND1****@ENDD**************2******S01136S01319
     C***********@ENDD*****IFLE*@RDAT5*********************B**3***********S01319
     C***********FFTPC6****SUB**@RAMT*****FFTPC6**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C************IN62*****IFEQ*'1'************************B1*************S01319
     C*********************WRITEFXCUEXP0********************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*@RUND*****FFDLUP************1*************S01319
     C*********************MOVE*@RUNM*****FFMLUP************1*************S01319
     C*********************MOVE*@RUNY*****FFYLUP************1*************S01319
     C*********************TIME***********FFTLUP************1*************S01319
     C*********************MOVE*'A'*******FFCHTP************1*************S01319
     C*********************MOVE RUND      FFLCD            *1             S01194
     C*********************MOVE*BJRDNB****FFLCD*************1*******S01194S01319
     C*********************MOVEL@USER*****FFLUID************1*************S01319
     C*********************UPDATFXCUEXP0********************1*************S01319
     C*********************END*****************************E1*************S01319
     C***********#BCA9*****ENDSR******************************************S01319
     /*/EJECT*************************************************************S01319
     C****************************************************************
     C*                                                              *
     C* ZA0620 - THIS SUBROUTINE CALCULATES THE REVALUATION PROFIT   *
     C*          AND LOSS (IN BASE CCY)                              *
     C*                                                              *
     C* CALLED BY :   #BEA #BEB #BEC #BED                            *
     C*                                                              *
     C* CALLS :  ZA0640  TO OBTAIN MARKET OUTRIGHT RATE              *
     C***********ZA0870**TO*OBTAIN*BASE*CURRENCY*DECIMAL**************    S01194
     C*******************PLACES*(EXPECTED)****************************    S01194
     C*                                                              *
     C* INPUT  : @@VDT   VALUE DATE(YYYYMMDD)           (ZA0640)     *
     C*          @@AMT   AMOUNT                                      *
     C*          @@DBCE  DEALT BASE CURRENCY EQUIV    (SIZE : 15,0)  *
     C*          @@CCY   CURRENCY CODE                  (ZA0640)     *
     C*          @@BYSL  BUY OR SELL RATE REQUIRED      (ZA0640)     *
     C***********CDP*****CURRENCY*DECIMAL*PLACES*******(S/TABTG10)****    S01194
     C***********XRMD****EXCHANGE*RATE*MULTIPLY/DIVIDE*(S/TABTG10)****    S01194
     C*          CDP     CURRENCY DECIMAL PLACES       (SDCURRPD)    *    S01194
     C*          XRMD    EXCHANGE RATE MULTIPLY/DIVIDE (SDCURRPD)    *    S01194
     C*                                                              *
     C* OUTPUT : @@RPL   REVALUATION PROFIT/LOSS    (SIZE : 15,0)    *
     C*                                                              *
     C* USES :   @@RBCE  REVALUED BASE CURRENCY EQUIVALENT           *
     C*          @DP     DECIMAL PLACES CORRECTION ARRAY             *
     C*          @@MOR   MARKET OUTRIGHT RATE                        *
     C***********@@NDPB**BASE*CURRENCY*DECIMAL*PLACES**(FROM*ZA0870)**    S01194
     C*          @@NDPB  BASE CURRENCY DECIMAL PLACES  (FROM #AB)    *    S01194
     C*          @@P     DECIMAL PLACES CORRECTION ARRAY INDEX       *
     C*          @@DEC   DECIMAL VALUS OF @@RBCE FIELD.              *
     C*          @@MDEC  DECIMAL VALUS OF @@RBCE FIELD AFTER         *
     C*                  DECIMAL CORRECTION.                         *
     C*                                                              *
     C*     AMEND NO. 000001                  DATE   15/07/86        *
     C*       Amendment to remove rounding errors.                   *
     C*       mutual working days.                                   *
     C*                                                              *
     C*****************************************************************
     C*
     C           ZA0620    BEGSR
     C*
     C**   DEFINE @@AMT.
     C                     Z-ADD@@AMT     @@AMT  150
     C*
     C**   OBTAIN MARKET OUTRIGHT RATE
     C                     EXSR ZA0640
     C           *INU7     CABEQ'1'       ZA0629
     C*
     C**   CHECK MULTIPLY/DIVIDE INDICATOR
     C           XRMD      IFEQ 'M'                        B1             S01194
     C*
     C**   CALCULATE THE RETURN BASE CURRENCY EQUIVALENT, AND ALSO
     C**   STORE THE RESULTING DECIMAL PLACES.
     C           @@AMT     MULT @@MOR     @@RBCE 150       *1
     C           @@AMT     MULT @@MOR     @@DEC   33H      *1
     C                     ELSE                            X1
     C           @@AMT     DIV  @@MOR     @@RBCE           *1
     C           @@AMT     DIV  @@MOR     @@DEC     H      *1
     C                     END                             E1
     C*
     C**  CORRECT DECIMAL PLACES OF REVALUED BASE CCY EQUIVALENT
     C           CDP       SUB  @@NDPB    @@P     10                      S01194
     C                     ADD  4         @@P
     C           @@RBCE    MULT @DP,@@P   @@RBCE    H
     C           @@DEC     MULT @DP,@@P   @@MDEC  63
     C*
     C**  CALCULATE EXACT VALUE OF @@RBCE (INCLUDES DEC. PLACES FIGURE)
     C           @@MDEC    ADD  @@RBCE    @@RBCE    H
     C*
     C**  CALCULATE PROFIT/LOSS
     C           @@RBCE    SUB  @@DBCE    @@RPL  150
     C*
     C           ZA0629    ENDSR                                     AG**
     //EJECT
     C*****************************************************************
     C*                                                               *
     C* ZA0640 - THIS SUBROUTINE CALCULATES THE FORWARD OUTRIGHT      *
     C*          RATE FOR A DATE AND CURRENCY                         *
     C*                                                               *
     C* CALLED BY :      ZA0620                                       *
     C*                                                               *
     C* CALLS :  ZA0680  TO CONVERT DATES TO MIDAS DAY NUMBER FORMAT  *
     C*                                                               *
     C* INPUT  : @@CCY   CURRENCY CODE                                *
     C*          @@BYSL  BUY OR SELL RATE REQUIRED                    *
     C*          @@VDT   VALUE DATE(YYYYMMDD)                         *
     C***********XRMD****EXCHANGE*RATE*MULTIPLY/DIVIDE*(S/TABTG10)*****   S01194
     C*          XRMD    EXCHANGE RATE MULTIPLY/DIVIDE (SDCURRPD)     *   S01194
     C*                                                               *
     C* OUTPUT : @@MOR   FORWARD MARKET OUTRIGHT RATE  (SIZE : 13,8)  *
     C*                                                               *
     C* USES :   @@DATD  DATE EXCESS (VALUE DATE AND LOWER LIMIT DATE)*
     C*          @@DATD  DATE DIFFERENCE BETWEEN THE TWO READ'S       *
     C*          @@FCCY  CURRENCY FROM FIRST READ                     *
     C*          @@FRAT  OUTRIGHT RATE FROM FIRST READ (HIGH OR LOW)  *
     C*          @@HRT1  HIGH OUTRIGHT RATE FROM FIRST READ           *
     C***********@@KDCY**KLIST*FOR*ACCESS*TO*S/FDCCYTLL*(EXPECTED)*****S01194
     C*          @@KREV  KEY FOR READ OF S/FXREVHLL                   *
     C*          @@LRT1  LOW OUTRIGHT RATE FROM FIRST READ            *
     C*          @@PRD1  PERIOD DATE FROM FIRST READ (MIDAS DAY NO.)  *
     C*          @@PRD2  PERIOD DATE FROM SECOND READ (MIDAS DAY NO.) *
     C*          @@RATD  RATE DIFFERENCE BETWEEN THE TWO READ'S       *
     C*          @@SRAT  OUTRIGHT RATE FROM SECOND READ (HIGH OR LOW) *
     C*          @@VDAT  VALUE DATE IN MIDAS DAY NUMBER FORMAT        *
     C*          @@VTE   VALUE DATE IN ZONED FORMAT                   *
     C*          @@WK5   WORK FIELD                                   *
     C*          @@WK6   WORK FIELD                                   *
     C***********IDCYDL**BASE*CURRENCY*FOR*DEALING.****(S/FDINSTLL)*******S01319
     C*          BNCYDL  BASE CURRENCY FOR DEALING.    (S/SDDEALPD)   *   S01319
     C*          FVCCY   CURRENCY CODE                 (S/FXREVHLL)   *
     C*          FVHORT  HIGH OUTRIGHT RATE            (S/FXREVHLL)   *
     C*          FVLORT  LOW OUTRIGHT RATE             (S/FXREVHLL)   *
     C*          FVPRDT  PERIOD DATE                   (S/FXREVHLL)   *
     C***********FXSP****SPOT*DATE*********************(S/TABTG10)*****   S01194
     C***********XRMD****MULTIPLY/DIVIDE*INDICATOR*****(S/TABTG10)*****   S01194
     C*          XRMD    MULTIPLY/DIVIDE INDICATOR     (SDCURRPD)     *   S01194
     C*          *IN85   ERROR/RESULT *IN FOR READ'S (NOT REFERRED TO)*
     C*                                                               *
     C*****************************************************************
     C*
     C           ZA0640    BEGSR
     C*
      *
      **   If the currency requested is Base for dealing, assume
      **     a Rate of 1.00.
     C***********IDCYDL****IFEQ*@@CCY**********************B1*************S01319
     C           BNCYDL    IFEQ @@CCY                      B1             S01319
     C                     Z-ADD0001.00   @@MOR            *1
     C                     ELSE                            X1
     C*
     C****CHECK*IF VALUE DATE FROM S/TABTG10 IS BEFORE TWO                E13898
     C****DAYS*BEFORE SPOT DATE (MUST CONVERT TO MIDAS DAY NUMBERS)       E13898
     C**********           Z-ADD@@VDT     @@DTIN           *1             E13898
     C**********           EXSR ZA0680                     *1             E13898
     C**********           Z-ADD@@MDNO    @@VDAT           *1             E13898
     C**********                                                          E13898
     C**********           Z-ADDFXSP      @@DTIN           *1             E13898
     C**********           EXSR ZA0680                     *1             E13898
     C********** @@MDNO    SUB  @@VDAT    @@WK5   50       *1             E13898
     C**********                                                          E13898
     C****IF*SO*USE SPOT RATE                                             E13898
     C********** @@WK5     IFGT 2                          B*2            E13898
     C**********           Z-ADDSPOT      @@MOR            **2            E13898
     C**********                                                          E13898
     C****EXIT*ROUTINE                                                    E13898
     C**********           GOTO ZA0649                     **2            E13898
     C**********           END                             E*2            E13898
     C*
     C**  KEY LIST FOR FXREVHLL READ
     C**  DATE KEY MUST BE ZONED NOT PACKED
     C                     Z-ADD@@VDT     @@VTE            *1
     C           @@KREV    KLIST                           *1
     C                     KFLD           @@CCY   3        *1
     C                     KFLD           @@VTE            *1
      *
      **  Clear database field from previous executions.
     C                     MOVE *BLANKS   FVCCY            *1
     C*
     C**  SETLL FOR NEXT READP
     C           @@KREV    SETLLFXREVHP0                   *1
     C           @@CCY     READEFXREVHP0               8685*1
     C*
     C**  If record not found, or locked, try for record
     C**   with date less than that provided. Read last
     C**   record for currency.
     C           *IN85     IFEQ '1'                        B*2
     C           *IN86     OREQ '1'                        **2
     C           @@CCY     SETGTFXREVHP0                   **2
     C                     READPFXREVHP0               8685**2
      *
      **  No record whatsoever exists for the currency,
      **   perform error processing. Set IN85, cause
      **   Non Extrapolation processing.
     C           @@CCY     CABNEFVCCY     ZA0648           **2
     C                     MOVE '1'       *IN85            **2
     C                     END                             E*2
     C*
     C**  RECORD EXISTS FOR CCY
     C**         and VALUE DATE = that on file.
     C**         or  VALUE DATE > than any on file.
      *
     C           @@VTE     IFEQ FVPRDT                     B*2
     C           *IN85     OREQ '1'                        **2
     C*
     C**  CHECK IF HIGH OR LOW OUTRIGHT RATE IS REQUIRED
     C           XRMD      IFEQ 'M'                        B**3
     C           @@BYSL    ANDEQ'B'                        ***3
     C*
     C           XRMD      OREQ 'D'                        ***3
     C           @@BYSL    ANDEQ'S'                        ***3
     C*
     C**   USE HIGH OUTRATE RATE
     C                     Z-ADDFVHORT    @@MOR            ***3
     C                     ELSE                            X**3
     C*
     C**   USE LOW OUTRATE RATE
     C                     Z-ADDFVLORT    @@MOR            ***3
     C                     END                             E**3
     C*
     C**  EXIT ROUTINE
     C                     GOTO ZA0649                     **2
     C                     END                             E*2
     C*
     C**  Setting up of  @@VDAT                                           E19660
     C**  Convert the Value Date to MIDAS No. and store in @@VDAT         E19660
     C                     Z-ADD@@VDT     @@DTIN           *1             E19660
     C                     EXSR ZA0680                     *1             E19660
     C                     Z-ADD@@MDNO    @@VDAT           *1             E19660
     C*                                                                   E19660
     C**  SAVE FIRST READ VALUES
     C                     MOVE FVCCY     @@FCCY           *1
     C                     MOVE *BLANKS   FVCCY            *1
     C*
     C** CONVERT TO MIDAS DAY NUMBER FORMAT
     C                     Z-ADDFVPRDT    @@DTIN           *1
     C                     EXSR ZA0680                     *1
     C                     Z-ADD@@MDNO    @@PRD1           *1
     C                     Z-ADDFVHORT    @@HRT1           *1
     C                     Z-ADDFVLORT    @@LRT1           *1
     C*
     C**  READ PREVIOUS RECORD
     C                     READPFXREVHP0                 85*1
     C*
     C**  MUST EXTRAPOLATE TO GET RATE FOR VALUE DATE
     C           @@FCCY    IFEQ @@CCY                      B*2
     C           FVCCY     ANDEQ@@CCY                      **2
     C           @@PRD1    ANDGT@@VDAT                     **2
     C           *IN85     ANDEQ'0'                        **2
     C*
     C**  CHECK IF HIGH OR LOW OUTRIGHT RATE IS REQUIRED
     C           XRMD      IFEQ 'M'                        B**3
     C           @@BYSL    ANDEQ'B'                        ***3
     C*
     C           XRMD      OREQ 'D'                        ***3
     C           @@BYSL    ANDEQ'S'                        ***3
     C*
     C**   USE HIGH OUTRATE RATE
     C                     Z-ADDFVHORT    @@SRAT           ***3
     C                     Z-ADD@@HRT1    @@FRAT           ***3
     C                     ELSE                            X**3
     C*
     C**   USE LOW OUTRATE RATE
     C                     Z-ADDFVLORT    @@SRAT           ***3
     C                     Z-ADD@@LRT1    @@FRAT           ***3
     C                     END                             E**3
     C*
     C**  CALCULATION:
     C**  RATE DIFFERENCE
     C           @@FRAT    SUB  @@SRAT    @@RATD           **2
     C*
     C**  DATE DIFFERENCE
     C**  CONVERT TO MIDAS DAY NUMBER FORMAT
     C                     Z-ADDFVPRDT    @@DTIN           **2
     C                     EXSR ZA0680                     **2
     C                     Z-ADD@@MDNO    @@PRD2           **2
     C*
     C**  DATE EXCESS
     C           @@VDAT    SUB  @@PRD2    @@EDAT           **2
     C*
     C           @@PRD1    SUB  @@PRD2    @@DATD           **2
     C*
     C           @@EDAT    DIV  @@DATD    @@WK6  109H      **2
     C           @@WK6     MULT @@RATD    @@MOR     H      **2
     C                     ADD  @@SRAT    @@MOR            **2
     C*
     C**  EXIT ROUTINE
     C                     GOTO ZA0649                     **2
     C                     END                             E*2
     C*
     C**  ONLY ONE REVALUATION RECORD FOR THIS CCY SO CANNOT EXTRAPOLATE
     C           @@FCCY    IFEQ @@CCY                      B*2
     C           FVCCY     ANDNE@@CCY                      **2
     C*
     C*
     C**  CHECK IF HIGH OR LOW OUTRIGHT RATE IS REQUIRED
     C           XRMD      IFEQ 'M'                        B**3
     C           @@BYSL    ANDEQ'B'                        ***3
     C*
     C           XRMD      OREQ 'D'                        ***3
     C           @@BYSL    ANDEQ'S'                        ***3
     C*
     C**   USE HIGH OUTRATE RATE
     C                     Z-ADD@@HRT1    @@MOR            ***3
     C                     ELSE                            X**3
     C*
     C**   USE LOW OUTRATE RATE
     C                     Z-ADD@@LRT1    @@MOR            ***3
     C                     END                             E**3
     C*
     C**  EXIT ROUTINE
     C                     GOTO ZA0649                     **2
     C                     END                             E*2
     C*
     C**  ONLY ONE REVALUATION RECORD FOR THIS CCY SO CANNOT EXTRAPOLATE
     C           FVCCY     IFEQ @@CCY                      B*2
     C           @@FCCY    ANDNE@@CCY                      **2
     C*
     C*
     C**  CHECK IF HIGH OR LOW OUTRIGHT RATE IS REQUIRED
     C           XRMD      IFEQ 'M'                        B**3
     C           @@BYSL    ANDEQ'B'                        ***3
     C*
     C           XRMD      OREQ 'D'                        ***3
     C           @@BYSL    ANDEQ'S'                        ***3
     C*
     C**   USE HIGH OUTRATE RATE
     C                     Z-ADDFVHORT    @@MOR            ***3
     C                     ELSE                            X**3
     C*
     C**   USE LOW OUTRATE RATE
     C                     Z-ADDFVLORT    @@MOR            ***3
     C                     END                             E**3
     C*
     C**  EXIT ROUTINE
     C                     GOTO ZA0649                     **2
     C                     END                             E*2
     C*
     C**  ANY OTHER RESULTS MUST BE A DATABASE ERROR
     C           ZA0648    TAG                             *1
     C                     MOVE @@CCY     DBKEY            ***************
     C                     MOVEL'FXREVHLL'DBFILE           * DB ERROR 920*
     C                     MOVE '920'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
      *
     C                     END                             E1
      *                                                    E1
     C*
     C**  FIELD DEFINITIONS
     C           *LIKE     DEFN @@MDNO    @@EDAT
     C           *LIKE     DEFN FVHORT    @@RATD
     C           *LIKE     DEFN FVCCY     @@FCCY
     C           *LIKE     DEFN @@MDNO    @@VDAT
     C************LIKE*****DEFN SPOT      @@MOR                           S01194
     C           *LIKE     DEFN A6SPRT    @@MOR                           S01194
     C           *LIKE     DEFN FVPRDT    @@VTE
     C           *LIKE     DEFN @@MDNO    @@PRD1
     C           *LIKE     DEFN FVHORT    @@HRT1
     C           *LIKE     DEFN FVLORT    @@LRT1
     C           *LIKE     DEFN FVHORT    @@SRAT
     C           *LIKE     DEFN FVHORT    @@FRAT
     C           *LIKE     DEFN @@MDNO    @@PRD2
     C           *LIKE     DEFN @@MDNO    @@DATD
      *
     C                     GOTO ZA0649
      *  FOR DEFN ONLY.
     C                     MOVE @@BYSL    @@BYSL  1
     C                     Z-ADD@@DBCE    @@DBCE 150
     C*
     C           ZA0649    ENDSR
     //EJECT
     C*****************************************************************   S01194
     C*****                                                           *   S01194
     C********FIELDS*USED*:*IDCYDL*-*CURRENCY*CODE*FROM*FDINSTLL****S01194S01319
     C*****   FIELDS USED : BNCYDL - CURRENCY CODE FROM SDDEALPD      *   S01319
     C*****                 @@NDPB - NO.OF DEC.PLACES IN BASE CURR.   *   S01194
     C*****                                                           *   S01194
     C*****   INPUT FIELDS: IDCYDL                                    *   S01194
     C*****                                                           *   S01194
     C*****   OUTPUT FIELD: @@NDPB                                    *   S01194
     C*****                                                           *   S01194
     C****CHECKS MADE ARE :                                           *   S01194
     C*****                                                           *   S01194
     C****A) IF RECORD NOT FOUND ON LOGICAL FILE 'FDCCYDL' OR         *   S01194
     C*****      'FDINSTLL' SETON INDICATORS U7 , U8 & 80             *   S01194
     C*****        AND EXIT                                           *   S01194
     C*****  ELSE                                                     *   S01194
     C*****       STORE CDP IN FIELD @@NDPB.                          *   S01194
     C*****                                                           *   S01194
     C****CALLED BY:  ZA0620                                          *   S01194
     C*****************************************************************   S01194
     C*****                                                               S01194
     C*****      ZA0870    BEGSR                                          S01194
     C*****                                                               S01194
     C*****      *LIKE     DEFN CDP       @@NDPB                          S01194
     C*****                Z-ADD0         @@NDPB                          S01194
      *****                                                               S01194
      ***Access Installation control data for Base Currency Dealing.      S01194
     C*****      1         SETLLFDINSTLL                                  S01194
     C*****                READ FDINSTLL                 80           *   S01194
      *****                                                               S01194
     C*****      *IN80     IFEQ '1'                        B1             S01194
     C*****                SETON                     U7U8  *1             S01194
     C*****                MOVEL'FDINSTLL'DBFILE           *1             S01194
     C*****                MOVEL'922'     DBASE            *1             S01194
     C*****                MOVEL*BLANKS   DBKEY            *1             S01194
     C*****                GOTO ZA0879                     *1             S01194
     C*****                END                             E1             S01194
      *****                                                               S01194
     C*****                MOVEL'20      '@@1200 12                       S01194
     C*****                MOVE '1'       @@1201  4                       S01194
     C*****                MOVELIDCYDL    @@1201                          S01194
     C*****                MOVE @@1201    @@1200                          S01194
      *****                                                               S01194
      ***ACcess Currency file for Base decimal places.                    S01194
     C*****      @@1200    CHAINFDCCYTLL             80                   S01194
      *****                                                               S01194
     C*****      *IN80     IFEQ '1'                        B1             S01194
     C*****                SETON                     U7U8  *1             S01194
     C*****                MOVEL'FDCCYTLL'DBFILE           *1             S01194
     C*****                MOVEL'921'     DBASE            *1             S01194
     C*****                MOVEL@@1200    DBKEY            *1             S01194
     C*****                GOTO ZA0879                     *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C*****                Z-ADDCDP       @@NDPB                          S01194
     C*****                                                               S01194
     C*****      ZA0879    ENDSR                                          S01194
     C*****************************************************************   S01194
     //EJECT                                                              S01194
     C*****************************************************************
     C*                                                               *
     C********FIELDS*USED*:*IDCYDL*-*CURRENCY*CODE*FROM*FDINSTLL**********S01319
     C*       FIELDS USED : BNCYDL - CURRENCY CODE FROM SDDEALPD      *   S01319
     C*                     @@NDPB - NO.OF DEC.PLACES IN BASE CURR.   *
     C*                                                               *
     C********INPUT*FIELDS:*IDCYDL****************************************S01319
     C*       INPUT FIELDS: BNCYDL                                    *   S01319
     C*                                                               *
     C*       OUTPUT FIELD: @@NDPB                                    *
     C*                                                               *
     C*   CHECKS MADE ARE :                                           *
     C*                                                               *
     C*   A) IF RECORD NOT FOUND ON LOGICAL FILE 'SDCURRPD' OR        *
     C*          'FDINSTLL' SETON INDICATORS U7 , U8 & 80             *
     C*            AND EXIT                                           *
     C*      ELSE                                                     *
     C*           STORE CURRRENCY (A6DANB) IN FIELD @@NDPB.           *
     C*                                                               *
     C*   CALLED BY:  #A                                              *
     C*****************************************************************
     C*
     C           #AB       BEGSR
     C*
     C           *LIKE     DEFN A6NBDP    @@NDPB                          S01194
     C                     Z-ADD0         @@NDPB
      *
     C***Access*Installation*control*data*for*Base*Currency*Dealing.******S01319
     C***********1*********SETLLFDINSTLL**********************************S01319
     C*********************READ*FDINSTLL*****************80***************S01319
     C********************************************************************S01319
     C************IN80*****IFEQ*'1'************************B1*************S01319
     C**********           CALL 'AODEALR0'                                S01319              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01319              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                    B1             S01319
     C                     SETON                     U7U8  *1
     C*********************MOVEL'FDINSTLL'DBFILE************1*************S01319
     C                     MOVEL'SDDEALPD'DBFILE           *1             S01319
     C                     MOVEL'922'     DBASE            *1
     C                     MOVEL*BLANKS   DBKEY            *1
     C                     GOTO #AB9                       *1
     C                     END                             E1
      *
      *  Access Currency file for Base decimal places.
     C                     CALL 'AOCURRR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C*********************PARM*IDCYDL****@AJCD***3*****************S01194S01319
     C                     PARM BNCYDL    @AJCD   3                       S01319
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     SETON                     U7U8  *1
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01194
     C                     MOVEL'921'     DBASE            * DBERROR 921 *S01194
     C*********************MOVELIDCYDL****DBKEY*********************S01194S01319
     C                     MOVELBNCYDL    DBKEY            ***************S01319
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #AB9                       *1
     C                     END                             E1
     C*
     C                     Z-ADDA6NBDP    @@NDPB                          S01194
     C*
     C           #AB9      ENDSR
     C*****************************************************************
     //EJECT
     C****************************************************************
     C********************************************************************S01319
     C***SUBROUTINE:*#ZA***ALIGN*AMOUNT***********************************S01319
     C********************************************************************S01319
     C***FIELDS*USED*:*****@ALAMT*-**AMOUNT*TO*ALIGN**********************S01319
     C*********************@ALAMA*-**AMOUNT*TO*ALIGN(CHAR)****************S01319
     C*********************@ALSIG*-**AMOUNT*SIGN**************************S01319
     C*********************@ALDNO*-**NO*OF*DECIMAL*PLACES*****************S01319
     C*********************@AD****-**DECIMALS*ARRAY***********************S01319
     C*********************@AI****-**INTEGERS*ARRAY***********************S01319
     C*********************@F*****-**INDEX********************************S01319
     C*********************@D*****-**INDEX********************************S01319
     C*********************@AF****-**AMOUNT*ARRAY*************************S01319
     C*********************@I*****-**INTEGER*INDEX************************S01319
     C*********************@NOINT*-**NUMBER*OF*INTEGERS*******************S01319
     C********************************************************************S01319
     C***CALLED*BY*:*******#BB**UPDATE*FX*DOWNLOAD*BLOTTER****************S01319
     C********************************************************************S01319
     C***CALLS*:**********************************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#ZA*******BEGSR******************************************S01319
     C*********************MOVEA'000'*****@AD,1***************************S01319
     C*********************MOVEA'00000000'@AI,1***************************S01319
     C*********************MOVEA'0000000'*@AI,9***************************S01319
     C************         MOVE @ALAMT    @ALAMA 15               S01136
     C********************************************************************S01319
     C***SIGN*************************************************************S01319
     C***********@ALAMT****IFGE*0**************************B1*************S01319
     C*********************MOVE*'+'*******@ALSIG**1*********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*'-'*******@ALSIG************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********@ALAMT****IFLT*0**************************B1********136**S01319
     C*********************Z-SUB@ALAMT****@ALAMT************1********136**S01319
     C*********************END*****************************E1********136**S01319
     C*********************MOVE*@ALAMT****@ALAMA*15******************136**S01319
     C********************************************************************S01319
     C***DECIMAL*PART*****************************************************S01319
     C***********15********SUB**@ALDNO****@F******20**********************S01319
     C*********************ADD**1*********@F******20**********************S01319
     C*********************Z-ADD1*********@D******20**********************S01319
     C*********************MOVEA@ALAMA****@AF*****************************S01319
     C*********************DO***@ALDNO*********************B1*************S01319
     C*********************MOVE*@AF,@F****@AD,@D************1*************S01319
     C***********@F********ADD**1*********@F****************1*************S01319
     C***********@D********ADD**1*********@D****************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***INTEGER*PART*****************************************************S01319
     C*********************Z-ADD15********@I******20**********************S01319
     C***********15********SUB**@ALDNO****@NOINT**20**********************S01319
     C*********************Z-ADD@NOINT****@F******************************S01319
     C*********************DO***@NOINT*********************B1*************S01319
     C*********************MOVE*@AF,@F****@AI,@I************1*************S01319
     C***********@F********SUB**1*********@F****************1*************S01319
     C***********@I********SUB**1*********@I****************1*************S01319
     C*********************END*****************************E1*************S01319
     C***********#ZA9******ENDSR******************************************S01319
     /*/EJECT*************************************************************S01319
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BDB  FXR0048     UPDATE FORWARD BOOK OPTION    *
     C*                    FXR0049     TAKEDOWN SCHEDULE             *
     C*                                                              *
     C*  FIELDS USED :     @RACT8 -  ACTION DATE(NUM)                *
     C*                    @RBCD  -  BCD INPUT                       *
     C*                    @RACT  -  ACTION DATE INPUT               *
     C*                    @RREV  -  REVERSE INDICATOR INPUT         *
     C*                    @RAMT  -  AMOUNT INPUT                    *
     C*                    @RCCY  -  CURRENCY INPUT                  *
     C*                    @R12   -  BUY/SELL FLAG                   *
     C*                    @RDELB -  DBCE INPUT                      *
     C*                    @@DAYN -  INPUT DATE FOR ZA0710           *
     C*                    @@RTN  -  RETURN FLAG FROM ZA0710         *
     C*                    @@VDT  -  OUTPUT DATE FROM ZA0710         *
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @DATE1 -  DATA STRUCTURE DATE             *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                    @TDOWN -  TAKEDOWN PROPORTION             *
     C*                    @TPOO2 -  TAKEDOWN PROP OP ORIG 2ND AMT   *
     C*                    @TPBCE -  TAKEDOWN PROP DBCE              *
     C*                    @OPL  -  'OLD' PROFIT/LOSS                *
     C*                    @PLADJ-  PROFIT/LOSS ADJUSTMENT WORK FIELD*
     C*                                                              *
     C*  CALLED BY :       #BD  UPDATE FORWARD BOOK DETAILS          *
     C*                                                              *
     C*  CALLS :           ZA0710                                    *
     C*                                                              *
     C****************************************************************
     C           #BDB      BEGSR
     C*
     C** FX00048
     C*
     C** ACCESS FXFWDULL
     C*
     C** CONVERT ACTION DATE TO YYYYMMDD FORM
     C                     MOVE @RACT     @@DAYN  50
     C           @@DAYN    IFNE *ZEROS                     B1
     C                     EXSR ZA0710                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BDB9                      **2
     C                     END                             E*2
     C** IF RETURN IS SET THEN DATABASE ERROR
     C           @@RTN     IFEQ 1                          B*2
     C**  Set up error output for screen.
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 025*
     C                     MOVEL'025'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BDB9                      **2
     C                     END                             E*2
     C                     MOVE @@VDT     @RACT8  80       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @RACT8           *1
     C                     END                             E1
     C                     MOVE @RACT8    @DATE1
     C                     MOVE @D1YY     FPFWBY
     C                     MOVE @D1MM     FPFWBM
     C                     MOVE @D1DD     FPFWBD
     C                     MOVE @RCCY     FPCCY
     C           KEY5      CHAINFXFWDULL             64
     C           *IN64     IFEQ '1'                        B1
     C*
     C** CREATE A ZERO RECORD FOR FXFWDDP0
     C                     MOVE 'FP'      FPRCID           *1
     C                     MOVE *BLANKS   FPDLTF           *1
     C                     MOVE @RUND     FPDLUP           *1
     C                     MOVE @RUNM     FPMLUP           *1
     C                     MOVE @RUNY     FPYLUP           *1
     C                     TIME           FPTLUP           *1
     C                     MOVE 'I'       FPCHTP           *1
     C*********************MOVE RUND      FPLCD            *1             S01194
     C                     MOVE BJRDNB    FPLCD            *1             S01194
     C                     MOVEL@USER     FPLUID           *1
     C                     MOVE *ZEROS    FPDYCI           *1
     C                     MOVE *ZEROS    FPDYCO           *1
     C                     MOVE *ZEROS    FPDYNM           *1
     C                     MOVE *ZEROS    FPDYDE           *1
     C                     END                             E1
     C*
     C**  CALCULATE 'OLD' PROFIT/LOSS FOR
     C                     MOVE @DATE1    @@VDT
     C                     Z-ADDFPDYNM    @@AMT
     C                     Z-ADDFPDYDE    @@DBCE
     C                     MOVE FPCCY     @@CCY
     C           FPDYNM    IFLT 0                          B1
     C                     MOVE 'B'       @@BYSL           *1
     C                     ELSE                            X1
     C                     MOVE 'S'       @@BYSL           *1
     C                     END                             E1
     C*
     C** ACCESS CURRENCY RECORD IN PREPARATION FOR ZA0620
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE FPCCY     @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63     IFEQ '1'                        B1             S01194
     C                     CALL 'AOCURRR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM FPCCY     @AJCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C**  Set up error output for screen.
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 037*S01194
     C                     MOVELFPCCY     DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 037 *S01194
     C                     MOVEL'037'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #BDB9                      *1
     C                     END                             E1
     C*
     C** CALCULATE THE REVALUATION PROFIT AND LOSS
     C                     MOVELA6MDEX    XRMD    1                       S01194
     C***********          MOVELA6NBDP    CDP     30               S01194 090654
     C                     Z-ADDA6NBDP    CDP     10                      090654
     C                     EXSR ZA0620
     C*
     C** SAVE THE 'OLD' PROFIT/LOSS FOR CURRENCY
     C           *LIKE     DEFN @@RPL     @OPL
     C                     Z-ADD@@RPL     @OPL
     C*
     C** CALCULATE THE TAKEDOWN PROPORTION
     C*
     C** DAILY CASH IN AND OUT
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYCI    SUB  @RAMT     FPDYCI           ***3
     C                     ELSE                            X**3
     C           FPDYCO    ADD  @RAMT     FPDYCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C*
     C** CALCULATE TAKEDOWN PROPORTION OF OPTION ORIGINAL SECOND AMOUNT
     C           F3OOSA    MULT @TDOWN    @TPOO2 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYCI    SUB  @TPOO2    FPDYCI           ***3
     C                     ELSE                            X**3
     C           FPDYCO    ADD  @TPOO2    FPDYCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYCI    ADD  @RAMT     FPDYCI           ***3
     C                     ELSE                            X**3
     C           FPDYCO    SUB  @RAMT     FPDYCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C*
     C** CALCULATE TAKEDOWN PROPORTION OF OPTION ORIGINAL SECOND AMOUNT
     C           F3OOSA    MULT @TDOWN    @TPOO2 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYCI    ADD  @TPOO2    FPDYCI           ***3
     C                     ELSE                            X**3
     C           FPDYCO    SUB  @TPOO2    FPDYCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** DAILY NET MOVEMENT
     C           FPDYCI    SUB  FPDYCO    FPDYNM
     C*
     C** DAILY NET DEALT BASE CCY EQUIV
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYDE    SUB  @TPBCE    FPDYDE           ***3
     C                     ELSE                            X**3
     C           FPDYDE    ADD  @TPBCE    FPDYDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYDE    SUB  @TPBCE    FPDYDE           ***3
     C                     ELSE                            X**3
     C           FPDYDE    ADD  @TPBCE    FPDYDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYDE    ADD  @TPBCE    FPDYDE           ***3
     C                     ELSE                            X**3
     C           FPDYDE    SUB  @TPBCE    FPDYDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE 150H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FPDYDE    ADD  @TPBCE    FPDYDE           ***3
     C                     ELSE                            X**3
     C           FPDYDE    SUB  @TPBCE    FPDYDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C           *IN64     IFEQ '0'                        B1
     C                     MOVE @RUND     FPDLUP           *1
     C                     MOVE @RUNM     FPMLUP           *1
     C                     MOVE @RUNY     FPYLUP           *1
     C                     TIME           FPTLUP           *1
     C                     MOVE 'A'       FPCHTP           *1
     C*********************MOVE RUND      FPLCD            *1             S01194
     C                     MOVE BJRDNB    FPLCD            *1             S01194
     C                     MOVEL@USER     FPLUID           *1
     C                     UPDATFXFWDDP0                   *1
     C                     ELSE                            X1
     C                     WRITEFXFWDDP0                   *1
     C                     END                             E1
     C*
     C**  CALCULATE 'NEW' PROFIT/LOSS
     C                     MOVE @DATE1    @@VDT
     C                     Z-ADDFPDYNM    @@AMT
     C                     Z-ADDFPDYDE    @@DBCE
     C                     MOVE FPCCY     @@CCY
     C           FPDYNM    IFLT 0                          B1
     C                     MOVE 'B'       @@BYSL           *1
     C                     ELSE                            X1
     C                     MOVE 'S'       @@BYSL           *1
     C                     END                             E1
     C*
     C** ACCESS CURRENCY RECORD IN PREPERATION FOR ZA0620
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE FPCCY     @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63*****IFEQ '1'                        B1             S01194
     C                     CALL 'AOCURRR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM FPCCY     @AJCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C**  Set up error output for screen.
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 038*S01194
     C                     MOVELFPCCY     DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 038 *S01194
     C                     MOVEL'038'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #BDB9                      *1
     C                     END                             E1
     C*
     C** CALCULATE THE REVALUATION PROFIT AND LOSS
     C                     MOVELA6MDEX    XRMD                            S01194
     C***********          MOVELA6NBDP    CDP                      S01194 090654
     C                     Z-ADDA6NBDP    CDP                             090654
     C                     EXSR ZA0620
     C*
     C** SAVE THE 'NEW' PROFIT/LOSS FOR CURRENCY
     C           *LIKE     DEFN @@RPL     @PLADJ
     C           *LIKE     DEFN @@RPL     @NPL
     C                     Z-ADD@@RPL     @NPL
     C*
     C**  CALCULATE ADJUSTMENT AND STORE IN MULT OCC. DS. EITHER
     C*   SHORT OR FORWARD FIELD
     C*
     C** DETERMINE IF FIRST OR SECOND CURRENCY BEING PROCESSED AND
     C** SET DATA STRUCTURE OCCURANCE AS APPROPRIATE
     C           1         OCUR @PRLOS
     C           FPCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** IF ACTION FALLS WITHIN ONE MONTH DATE (@FWD5) ADD P/L INTO
     C** SHORT P/L, ELSE ADD INTO FORWARD P/L
     C***********@ACDR5****IFGE RUND                       B1       E12887S01194
     C           @ACDR5    IFGE BJRDNB                     B1             S01194
     C***********@ACDR5    ANDLT@FWD5                      *1      E12887 E13237
     C           @ACDR5    ANDLE@FWD5                      *1             E13237
     C***********@ACTD5    IFGE RUND                       B1             E12887
     C***********@ACTD5    ANDLT@FWD5                      *1             E12887
     C           @NPL      SUB  @OPL      @PLADJ           *1
     C                     ADD  @PLADJ    @SPLO            *1
     C                     END                             E1
     C*
     C***********@ACDR5    IFGE @FWD5                      B1      E12887 E13237
     C           @ACDR5    IFGT @FWD5                      B1             E13237
     C***********@ACTD5    IFGE @FWD5                      B1             E12887
     C           @NPL      SUB  @OPL      @PLADJ           *1
     C                     ADD  @PLADJ    @FPLO            *1
     C                     END                             E1
     C*
     C** FXR0049
     C*
     C** ACCESS FXFWMULL
     C                     MOVE @RACT8    DATE1
     C                     MOVE @D1YY     FQFWBY
     C                     MOVE @D1MM     FQFWBM
     C           @D1DD     IFGE '01'                       B1
     C           @D1DD     ANDLE'15'                       *1
     C                     Z-ADD1         FQFBHM           *1
     C                     ELSE                            X1
     C                     Z-ADD2         FQFBHM           *1
     C                     END                             E1
     C                     MOVE @RCCY     FQCCY
     C           KEY6      CHAINFXFWMULL             65
     C*
     C** CREATE A ZERO RECORD FOR FXFWMHP0
     C           *IN65     IFEQ '1'                        B1
     C                     MOVE 'FQ'      FQRCID           *1
     C                     MOVE *BLANKS   FQDLTF           *1
     C                     MOVE @RUND     FQDLUP           *1
     C                     MOVE @RUNM     FQMLUP           *1
     C                     MOVE @RUNY     FQYLUP           *1
     C                     TIME           FQTLUP           *1
     C                     MOVE 'I'       FQCHTP           *1
     C*********************MOVE RUND      FQLCD            *1             S01194
     C                     MOVE BJRDNB    FQLCD            *1             S01194
     C                     MOVEL@USER     FQLUID           *1
     C                     MOVE *ZEROS    FQHMCI           *1
     C                     MOVE *ZEROS    FQHMCO           *1
     C                     MOVE *ZEROS    FQHMNM           *1
     C                     MOVE *ZEROS    FQHMDE           *1
     C                     END                             E1
     C*
     C** DAILY CASH IN AND OUT
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMCI    SUB  @RAMT     FQHMCI           ***3
     C                     ELSE                            X**3
     C           FQHMCO    ADD  @RAMT     FQHMCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C*
     C** CALCULATE TAKEDOWN PROPORTION OF OPTION ORIGINAL SECOND AMOUNT
     C           F3OOSA    MULT @TDOWN    @TPOO2    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMCI    SUB  @TPOO2    FQHMCI           ***3
     C                     ELSE                            X**3
     C           FQHMCO    ADD  @TPOO2    FQHMCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMCI    ADD  @RAMT     FQHMCI           ***3
     C                     ELSE                            X**3
     C           FQHMCO    SUB  @RAMT     FQHMCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C*
     C** CALCULATE TAKEDOWN PROPORTION OF OPTION ORIGINAL SECOND AMOUNT
     C           F3OOSA    MULT @TDOWN    @TPOO2    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMCI    ADD  @TPOO2    FQHMCI           ***3
     C                     ELSE                            X**3
     C           FQHMCO    SUB  @TPOO2    FQHMCO           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** DAILY NET MOVEMENT
     C           FQHMCI    SUB  FQHMCO    FQHMNM
     C*
     C** DAILY NET DEALT BASE CCY EQUIV
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMDE    SUB  @TPBCE    FQHMDE           ***3
     C                     ELSE                            X**3
     C           FQHMDE    ADD  @TPBCE    FQHMDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMDE    SUB  @TPBCE    FQHMDE           ***3
     C                     ELSE                            X**3
     C           FQHMDE    ADD  @TPBCE    FQHMDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C*
     C** IF CCY AND AMOUNT ARE 1ST
     C           @R12      IFEQ '1'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMDE    ADD  @TPBCE    FQHMDE           ***3
     C                     ELSE                            X**3
     C           FQHMDE    SUB  @TPBCE    FQHMDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF CCY AND AMOUNT ARE 2ND
     C           @R12      IFEQ '2'                        B*2
     C           @RDELB    MULT @TDOWN    @TPBCE    H      **2
     C           @RAMT     IFGE 0                          B**3
     C           FQHMDE    ADD  @TPBCE    FQHMDE           ***3
     C                     ELSE                            X**3
     C           FQHMDE    SUB  @TPBCE    FQHMDE           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C           *IN65     IFEQ '0'                        B1
     C                     MOVE @RUND     FQDLUP           *1
     C                     MOVE @RUNM     FQMLUP           *1
     C                     MOVE @RUNY     FQYLUP           *1
     C                     TIME           FQTLUP           *1
     C                     MOVE 'A'       FQCHTP           *1
     C*********************MOVE RUND      FQLCD            *1             S01194
     C                     MOVE BJRDNB    FQLCD            *1             S01194
     C                     MOVEL@USER     FQLUID           *1
     C                     UPDATFXFWDHP0                   *1
     C                     ELSE                            X1
     C                     WRITEFXFWDHP0                   *1
     C                     END                             E1
     C           #BDB9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BDA  FXR0014  UPDATE FORWARD BOOK DAILY SCHEDULE
     C*                    FXR0015                                   *
     C*                                                              *
     C*  FIELDS USED :     @RACT8 -  ACTION DATE(NUM)                *
     C*                    @RBCD  -  BCD INPUT                       *
     C*                    @RACT  -  ACTION DATE INPUT               *
     C*                    @RREV  -  REVERSE INDICATOR INPUT         *
     C*                    @RAMT  -  AMOUNT INPUT                    *
     C*                    @@DAYN -  INPUT DATE FOR ZA0710           *
     C*                    @@RTN  -  RETURN FLAG FROM ZA0710         *
     C*                    @@VDT  -  OUTPUT DATE FROM ZA0710         *
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @DATE1 -  DATA STRUCTURE DATE             *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                    @PLADJ - PROFIT/LOSS ADJUSTMENT WORK FIELD*
     C*                                                              *
     C*  CALLED BY :       #BD  UPDATE FORWARD BOOK DETAILS          *
     C*                                                              *
     C*  CALLS :           ZA0710                                    *
     C*                                                              *
     C****************************************************************
     C           #BDA      BEGSR
     C*
     C** ACCESS FXFWDULL
     C*
     C           KEY5      KLIST
     C******************** KFLD           FPBRC                           S01117
     C                     KFLD           FPCCY
     C                     KFLD           FPFWBY
     C                     KFLD           FPFWBM
     C                     KFLD           FPFWBD
     C*
     C** CONVERT ACTION DATE TO YYYYMMDD FORM
     C                     MOVE @RACT     @@DAYN  50
     C           @@DAYN    IFNE *ZEROS                     B1
     C                     EXSR ZA0710                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BDA9                      **2
     C                     END                             E*2
     C** IF RETURN IS SET THEN DATABASE ERROR
     C           @@RTN     IFEQ 1                          B*2
     C**  Set up error output for screen.
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 024*
     C                     MOVEL'024'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BDA9                      **2
     C                     END                             E*2
     C                     MOVE @@VDT     @RACT8  80       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @RACT8           *1
     C                     END                             E1
     C                     MOVE @RACT8    @DATE1
     C                     MOVE @D1YY     FPFWBY
     C                     MOVE @D1MM     FPFWBM
     C                     MOVE @D1DD     FPFWBD
     C                     MOVE @RCCY     FPCCY
     C           KEY5      CHAINFXFWDULL             64
     C           *IN64     IFEQ '1'                        B1
     C*
     C** CREATE A ZERO RECORD FOR FXFWDDP0
     C                     MOVE 'FP'      FPRCID           *1
     C                     MOVE *BLANKS   FPDLTF           *1
     C                     MOVE @RUND     FPDLUP           *1
     C                     MOVE @RUNM     FPMLUP           *1
     C                     MOVE @RUNY     FPYLUP           *1
     C                     TIME           FPTLUP           *1
     C                     MOVE 'I'       FPCHTP           *1
     C*********************MOVE RUND      FPLCD            *1             S01194
     C                     MOVE BJRDNB    FPLCD            *1             S01194
     C                     MOVEL@USER     FPLUID           *1
     C                     MOVE *ZEROS    FPDYCI           *1
     C                     MOVE *ZEROS    FPDYCO           *1
     C                     MOVE *ZEROS    FPDYNM           *1
     C                     MOVE *ZEROS    FPDYDE           *1
     C                     END                             E1
     C*
     C**  CALCULATE 'OLD' PROFIT/LOSS
     C                     MOVE @DATE1    @@VDT
     C                     Z-ADDFPDYNM    @@AMT
     C                     Z-ADDFPDYDE    @@DBCE
     C                     MOVE FPCCY     @@CCY
     C           FPDYNM    IFLT 0                          B1
     C                     MOVE 'B'       @@BYSL           *1
     C                     ELSE                            X1
     C                     MOVE 'S'       @@BYSL           *1
     C                     END                             E1
     C*
     C** ACCESS CURRENCY RECORD IN PREPERATION FOR ZA0620
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE FPCCY     @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63*****IFEQ '1'                        B1             S01194
     C                     CALL 'AOCURRR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM FPCCY     @AJCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C**  Set up error output for screen.
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 039*S01194
     C                     MOVELFPCCY     DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 039 *S01194
     C                     MOVEL'039'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #BDA9                      *1
     C                     END                             E1
     C*
     C** CALCULATE THE REVALUATION PROFIT AND LOSS
     C                     MOVELA6MDEX    XRMD                            S01194
     C***********          MOVELA6NBDP    CDP                      S01194 090654
     C                     Z-ADDA6NBDP    CDP                             090654
     C                     EXSR ZA0620
     C*
     C** SAVE THE 'OLD' PROFIT/LOSS FOR CURRENCY
     C                     Z-ADD@@RPL     @OPL
     C*
     C** DAILY CASH IN AND OUT
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FPDYCI    ADD  @RAMT     FPDYCI           **2
     C                     ELSE                            X*2
     C           FPDYCO    SUB  @RAMT     FPDYCO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FPDYCI    SUB  @RAMT     FPDYCI           **2
     C                     ELSE                            X*2
     C           FPDYCO    ADD  @RAMT     FPDYCO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** DAILY NET MOVEMENT
     C           FPDYCI    SUB  FPDYCO    FPDYNM
     C*
     C** DAILY NET DEALT BASE CCY EQUIV
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FPDYDE    ADD  @RBCD     FPDYDE           **2
     C                     ELSE                            X*2
     C           FPDYDE    SUB  @RBCD     FPDYDE           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FPDYDE    SUB  @RBCD     FPDYDE           **2
     C                     ELSE                            X*2
     C           FPDYDE    ADD  @RBCD     FPDYDE           **2
     C                     END                             E*2
     C                     END                             E1
     C           *IN64     IFEQ '0'                        B1
     C                     MOVE @RUND     FPDLUP           *1
     C                     MOVE @RUNM     FPMLUP           *1
     C                     MOVE @RUNY     FPYLUP           *1
     C                     TIME           FPTLUP           *1
     C                     MOVE 'A'       FPCHTP           *1
     C*********************MOVE RUND      FPLCD            *1             S01194
     C                     MOVE BJRDNB    FPLCD            *1             S01194
     C                     MOVEL@USER     FPLUID           *1
     C                     UPDATFXFWDDP0                   *1
     C                     ELSE                            X1
     C                     WRITEFXFWDDP0                   *1
     C                     END                             E1
     C*
     C**  CALCULATE 'NEW' PROFIT/LOSS
     C                     MOVE @DATE1    @@VDT
     C                     Z-ADDFPDYNM    @@AMT
     C                     Z-ADDFPDYDE    @@DBCE
     C                     MOVE FPCCY     @@CCY
     C           FPDYNM    IFLT 0                          B1
     C                     MOVE 'B'       @@BYSL           *1
     C                     ELSE                            X1
     C                     MOVE 'S'       @@BYSL           *1
     C                     END                             E1
     C*
     C** ACCESS CURRENCY RECORD IN PREPERATION FOR ZA0620
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE FPCCY     @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63*****IFEQ '1'                        B1             S01194
     C                     CALL 'AOCURRR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM FPCCY     @AJCD                           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C**  Set up error output for screen.
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 039*S01194
     C                     MOVELFPCCY     DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 039 *S01194
     C                     MOVEL'039'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #BDA9                      *1
     C                     END                             E1
     C*
     C** CALCULATE THE REVALUATION PROFIT AND LOSS
     C                     MOVELA6MDEX    XRMD                            S01194
     C***********          MOVELA6NBDP    CDP                      S01194 090654
     C                     Z-ADDA6NBDP    CDP                             090654
     C                     EXSR ZA0620
     C*
     C** SAVE THE 'NEW' PROFIT/LOSS FOR CURRENCY
     C                     Z-ADD@@RPL     @NPL
     C*
     C**  CALCULATE ADJUSTMENT AND STORE IN MULT OCC. DS. EITHER
     C*   SHORT OR FORWARD FIELD
     C** DETERMINE IF FIRST OR SECOND CURRENCY BEING PROCESSED AND
     C** SET DATA STRUCTURE OCCURANCE AS APPROPRIATE
     C           1         OCUR @PRLOS
     C           FPCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** IF ACTION FALLS WITHIN ONE MONTH DATE (@FWD5) ADD P/L INTO
     C** SHORT P/L, ELSE ADD INTO FORWARD P/L
     C***********@ACTD5****IFGE RUND                       B1             S01194
     C           @ACTD5    IFGE BJRDNB                     B1             S01194
     C********** @ACTD5    ANDLT@FWD5                      *1             E13237
     C           @ACTD5    ANDLE@FWD5                      *1             E13237
     C           @NPL      SUB  @OPL      @PLADJ           *1
     C                     ADD  @PLADJ    @SPLO            *1
     C                     END                             E1
     C*
     C********** @ACTD5    IFGE @FWD5                      B1             E13237
     C           @ACTD5    IFGT @FWD5                      B1             E13237
     C           @NPL      SUB  @OPL      @PLADJ           *1
     C                     ADD  @PLADJ    @FPLO            *1
     C                     END                             E1
     C*
     C*
     C** FXR0015
     C*
     C** ACCESS FXFWMULL
     C           KEY6      KLIST
     C*********************KFLD           FQBRC                           S01117
     C                     KFLD           FQCCY
     C                     KFLD           FQFWBY
     C                     KFLD           FQFWBM
     C                     KFLD           FQFBHM
     C                     MOVE @RACT8    DATE1
     C                     MOVE @D1YY     FQFWBY
     C                     MOVE @D1MM     FQFWBM
     C*
     C** FORWARD BOOK HALF MONTH
     C           @D1DD     IFGE '01'                       B1
     C           @D1DD     ANDLE'15'                       *1
     C                     Z-ADD1         FQFBHM           *1
     C                     ELSE                            X1
     C                     Z-ADD2         FQFBHM           *1
     C                     END                             E1
     C                     MOVE @RCCY     FQCCY
     C           KEY6      CHAINFXFWMULL             65
     C*
     C** CREATE A ZERO RECORD FOR FXFWDHP0
     C           *IN65     IFEQ '1'                        B1
     C                     MOVE 'FQ'      FQRCID           *1
     C                     MOVE *BLANKS   FQDLTF           *1
     C                     MOVE @RUND     FQDLUP           *1
     C                     MOVE @RUNM     FQMLUP           *1
     C                     MOVE @RUNY     FQYLUP           *1
     C                     TIME           FQTLUP           *1
     C                     MOVE 'I'       FQCHTP           *1
     C*********************MOVE RUND      FQLCD            *1             S01194
     C                     MOVE BJRDNB    FQLCD            *1             S01194
     C                     MOVEL@USER     FQLUID           *1
     C                     MOVE *BLANKS   FQHMCI           *1
     C                     MOVE *BLANKS   FQHMCO           *1
     C                     MOVE *BLANKS   FQHMNM           *1
     C                     MOVE *BLANKS   FQHMDE           *1
     C                     END                             E1
     C*
     C** HALF MONTH CASH IN AND OUT
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FQHMCI    ADD  @RAMT     FQHMCI           **2
     C                     ELSE                            X*2
     C           FQHMCO    SUB  @RAMT     FQHMCO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FQHMCI    SUB  @RAMT     FQHMCI           **2
     C                     ELSE                            X*2
     C           FQHMCO    ADD  @RAMT     FQHMCO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** HALF MONTH NET MOVEMENT
     C           FQHMCI    SUB  FQHMCO    FQHMNM
     C*
     C** HALF MONTH NET MM INTEREST NOT UPDATED
     C*
     C** HALF MONTH NET DEALT BASE CCY EQUIV
     C*
     C** IF REVERSE SIGN INDICATOR NOT SET
     C           @RREV     IFNE 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FQHMDE    ADD  @RBCD     FQHMDE           **2
     C                     ELSE                            X*2
     C           FQHMDE    SUB  @RBCD     FQHMDE           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF REVERSE SIGN INDICATOR SET
     C           @RREV     IFEQ 'R'                        B1
     C           @RAMT     IFGE 0                          B*2
     C           FQHMDE    SUB  @RBCD     FQHMDE           **2
     C                     ELSE                            X*2
     C           FQHMDE    ADD  @RBCD     FQHMDE           **2
     C                     END                             E*2
     C                     END                             E1
     C           *IN65     IFEQ '0'                        B1
     C                     MOVE @RUND     FQDLUP           *1
     C                     MOVE @RUNM     FQMLUP           *1
     C                     MOVE @RUNY     FQYLUP           *1
     C                     TIME           FQTLUP           *1
     C                     MOVE 'A'       FQCHTP           *1
     C*********************MOVE RUND      FQLCD            *1             S01194
     C                     MOVE BJRDNB    FQLCD            *1             S01194
     C                     MOVEL@USER     FQLUID           *1
     C                     UPDATFXFWDHP0                   *1
     C                     ELSE                            X1
     C                     WRITEFXFWDHP0                   *1
     C                     END                             E1
     C           #BDA9     ENDSR
     //EJECT
      *****************************************************************
      *                                                               *
      *       TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *
      *                                                               *
      *       SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *
      *       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *
      *       THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *
      *       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *
      *       IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *
      *       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *
      *                                                               *
      * NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS
      *                                                               *
      *       1) @@DAYN   LENGTH 5,0.                                 *
      *                                                               *
      *       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *
      *                                                               *
      *       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *
      *       2) @@RTN    LENGTH 1,0.                                 *
      *       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *
      *       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *
      *       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *
      *       6) @@RDAY   LENGTH 5,0.                                 *
      *       7) @@LEAP   LENGTH 1,0.
      *                                                               *
      *       INDICATORS USED ARE:                                    *
      *                                                               *
      *       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *
      *       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *
      *                                                               *
      * INPUT FIELD:       @@DAYN                                     *
      *                                                               *
      * OUTPUT FIELD:      @@VDT                                      *
      *                                                               *
      * WORK FIELDS:       @@RTN                                      *
      *                    @@Z71Y                                     *
      *                    @@RDAY                                     *
      *                    @@LEAP                                     *
      *                    @@I                                        *
      *                    @@J                                        *
      *                                                               *
      * ARRAYS USED:       @YD COMPILE TIME ARRAY.                    *
      *                    @MD COMPILE TIME ARRAY.                    *
      *                                                               *
      * CALLED BY:    #BDA #BDB #BE                                   *
      *****************************************************************
     C*
     C           ZA0710    BEGSR
     C*
     C                     SETOF                     8081
     C                     Z-ADD0         @@RTN   10
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1                          B1
     C                     Z-ADD1         @@RTN            *1
     C                     GOTO ZA0719                     *1
     C                     END                             E1
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100                       B1
     C                     ADD  @@SSY2    @@RDAY           *1
     C                     END                             E1
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'                        B1
     C                     Z-ADD0         @@LEAP           *1
     C                     END                             E1
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1                          B1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY           *1
     C                     ADD  @@I       @@Z71Y           *1
     C                     END                             E1
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0                          B1
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60                         B*2
     C                     Z-ADD29        @@Z71D           **2
     C                     Z-ADD2         @@Z71M           **2
     C                     GOTO ZA0711                     **2
     C                     END                             E*2
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60                         B*2
     C           @@RDAY    SUB  1         @@RDAY           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0                          B1
     C                     Z-ADD31        @@Z71D           *1
     C                     Z-ADD12        @@Z71M           *1
     C                     SUB  1         @@Z71Y           *1
     C                     GOTO ZA0711                     *1
     C                     END                             E1
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZA0719    ENDSR
     //EJECT
     C****************************************************************
     C********************************************************************S01319
     C***SUBROUTINE:*#BB***FXP0041**UPDATE*FX*DOWNLOAD*BLOTTER************S01319
     C********************************************************************S01319
     C***FIELDS*USED*:*****@ALAMT*-**AMOUNT*TO*ALIGN**********************S01319
     C*********************@@KDCY*-**KEY*FOR*FDCCYTLL*****************    S01194
     C*********************@@K1***-**KEY*FIELD*FDCCYTLL***************    S01194
     C*********************@@K20**-**KEY*FIELD*FDCCYTLL***************    S01194
     C*********************@@CCY**-**CURRENCY*****************************S01319
     C*********************@ALINT*-**ALIGNED*INTEGER**********************S01319
     C*********************@ALDEC*-**ALIGNED*DECIMALS*********************S01319
     C*********************@ALSIG*-**ALIGNED*AMOUNT*SIGN******************S01319
     C*********************@ALDNO*-**ALIGNED*CCY*DECIMAL*PLACES***********S01319
     C*********************@DECA**-**DEAL*BCAE****************************S01319
     C*********************@@NDPB*-**DEAL*BCD*DECIMAL*PLACES**************S01319
     C*********************@D1YY**-**DATE*FIELD*-*YEAR********************S01319
     C*********************@D1MM**-**DATE*FIELD*-*MONTH*******************S01319
     C*********************@D1DD**-**DATE*FIELD*-*DAY*********************S01319
     C*********************@DATE1*-**DATA*STRUCTURE*DATE******************S01319
     C*********************@DADN**-**DEAL*ASSOCIATED*DEAL*NO(NUM)*********S01319
     C********************************************************************S01319
     C***CALLED*BY*:*******#B**MAIN*PROCESSING****************************S01319
     C********************************************************************S01319
     C***CALLS*:***********#ZA********************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BB*******BEGSR******************************************S01319
     C***********F3DN38****CHAINFXDW38LL*************61*******************S01319
     C********************************************************************S01319
     C***IF*NEW*RECORD**BLANKSZERO/BLANK*RECORD***************************S01319
     C************IN61*****IFEQ*'1'************************B1*************S01319
     C*********************MOVE*'GC'******FNRCID************1*************S01319
     C*********************MOVE**BLANKS***FNDSTS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***UPDATE*BLOTTER*FILE*AS*PER*FXR0013*******************************S01319
     C*********************MOVE*F3DN38****FNDN38**************************S01319
     C********************************************************************S01319
     C***VALUE*DATE*******************************************************S01319
     C*********************MOVE*F3VDYY****FNVDYY**************************S01319
     C*********************MOVE*F3VDMM****FNVDMM**************************S01319
     C*********************MOVE*F3VDDD****FNVDDD**************************S01319
     C********************************************************************S01319
     C***TRANSACTION*DATE*************************************************S01319
     C*********************MOVE*F3DTYY****FNDTYY**************************S01319
     C*********************MOVE*F3DTMM****FNDTMM**************************S01319
     C*********************MOVE*F3DTDD****FNDTDD**************************S01319
     C********************************************************************S01319
     C***DEAL*OPTION*END*DATE*********************************************S01319
     C*********************MOVE*F3DOEY****FNDOEY**************************S01319
     C*********************MOVE*F3DOEM****FNDOEM**************************S01319
     C*********************MOVE*F3DOED****FNDOED**************************S01319
     C********************************************************************S01319
     C*********************MOVE*F3DADN****FNDADN**************************S01319
     C********************************************************************S01319
     C***MULTIBRANCHING*FIELDS**************************************S01117S01319
     C*********************MOVE*F3ORBR****FNORBR********************S01117S01319
     C*********************MOVE*F3PRFC****FNPRFC********************S01117S01319
     C*********************MOVE*F3ROBR****FNROBR********************S01117S01319
     C*********************MOVE*F3POBR****FNPOBR********************S01117S01319
     C**************************************************************S01117S01319
     C***DEAL*DELETED*INDICATOR*******************************************S01319
     C***********F3LACT****IFEQ*'D'************************B1*************S01319
     C*********************MOVE*'D'*******FNDDLT************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE**BLANKS***FNDDLT************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***DEAL*STATUS*INDICATOR********************************************S01319
     C***********F3LACT****IFEQ*'I'************************B1*************S01319
     C***********F3LACT****OREQ*'A'*************************1*************S01319
     C***********F3DSTS****IFEQ*'I'************************B*2************S01319
     C*********************MOVE*'I'*******FNDSTS*************2************S01319
     C*********************END*****************************E*2************S01319
     C***********F3DSTS****IFNE*'I'************************B*2************S01319
     C*********************MOVE*'C'*******FNDSTS*************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C***********F3DSTS****IFEQ*'A'************************B1*******S01136S01319
     C*********************MOVE*'A'*******FNDSTS************1*******S01136S01319
     C*********************END*****************************E1*******S01136S01319
     C********************************************************************S01319
     C*********************MOVE*F3DTYP****FNDTYP**************************S01319
     C*********************MOVE*F3DCSN****FNDCSN**************************S01319
     C*********************MOVE*F3DXRT****FNDEXC**************************S01319
     C********************************************************************S01319
     C***ALIGN*FIRST*AMOUNT***********************************************S01319
     C*********************Z-ADDF3DAM1****@ALAMT*150**********************S01319
     C********************************************************************S01319
     C*****ACCESS*S/TABTG10*VIA*FDCCYTLL**********************************S01319
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE F3CCY1    @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63*****IFEQ '1'                        B1             S01194
     C*********************CALL*'AOCURRR0'**************************S01194S01319
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C*********************PARM*'*MSG***'*@RTCD*********************LN0391S01319
     C*********************PARM*'*KEY***'*@OPTN*********************S01194S01319
     C*********************PARM*F3CCY1****@AJCD*********************S01194S01319
     C***********SDCURR****PARM*SDCURR****DSSDY*********************S01194S01319
     C**************************************************************S01194S01319
     C***********@RTCD*****IFNE**BLANK*********************B1*******S01194S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 017*S01194
     C*********************MOVELF3CCY1****DBKEY*********************S01194S01319
     C*********************MOVEL'SDCURRPD'DBFILE*************DBERRORS01194S01319
     C*********************MOVEL'017'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8*************1*************S01319
     C*********************EXSR**PSSR***********************1*******S01194S01319
     C*********************GOTO*#BB9************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*********************MOVE CDP       @ALDNO  10                      S01194
     C*********************MOVE*A6NBDP****@ALDNO**10****************S01194S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNATI1**************************S01319
     C*********************MOVE*@ALDEC****FNDEC1**************************S01319
     C*********************MOVE*@ALSIG****FNSGD1**************************S01319
     C********************************************************************S01319
     C***ALSO*ALIGN*DEAL*OPTION*ORIGINAL*FIRST*AMOUNT*********************S01319
     C***********F3OOFA****IFNE**ZERO**********************B1*************S01319
     C*********************Z-ADDF3OOFA****@ALAMT*150********1*************S01319
     C*********************EXSR*#ZA*************************1*************S01319
     C*********************MOVE*@ALINT****FNOOFI************1*************S01319
     C*********************MOVE*@ALDEC****FNOOFD************1*************S01319
     C*********************MOVE*@ALSIG****FNOOFS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVE*F3CCY1****FNCCY1**************************S01319
     C*********************MOVE*F3CCY2****FNCCY2**3***********************S01319
     C********************************************************************S01319
     C***ALIGN*SECOND*AMOUNT**********************************************S01319
     C*********************Z-ADDF3DAM2****@ALAMT**************************S01319
     C********************************************************************S01319
     C*****ACCESS*S/TABTG10*VIA*FDCCYTLL**********                        S01194
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C*********************MOVE F3CCY2    @@CCY                           S01194
     C***********@@KDCY****CHAINFDCCYTLL             63                   S01194
     C************IN63*****IFEQ '1'                        B1             S01194
     C** ACCESS CURRENCY FILE VIA ACCESS PROGRAM                          S01194
     C*********************CALL*'AOCURRR0'*************************S01194 S01319
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C*********************PARM*'*MSG***'*@RTCD*********************LN0391S01319
     C*********************PARM*'*KEY***'*@OPTN*********************S01194S01319
     C*********************PARM*F3CCY2****@AJCD*********************S01194S01319
     C***********SDCURR****PARM*SDCURR****DSSDY*********************S01194S01319
     C**************************************************************S01194S01319
     C***********@RTCD*****IFNE**BLANK*********************B1*******S01194S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDCCYTLL'DBFILE           * DB ERROR 018*S01194
     C*********************MOVELF3CCY2****DBKEY*********************S01194S01319
     C*********************MOVEL'SDCURRPD'DBFILE*************DBERRORS01194S01319
     C*********************MOVEL'018'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8*************1*************S01319
     C*********************EXSR**PSSR***********************1*******S01194S01319
     C*********************GOTO*#BB9************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*********************MOVE CDP       @ALDNO                          S01194
     C*********************MOVE*A6NBDP****@ALDNO********************S01194S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNATI2**************************S01319
     C*********************MOVE*@ALDEC****FNDEC2**************************S01319
     C*********************MOVE*@ALSIG****FNSGD2**************************S01319
     C********************************************************************S01319
     C***ALSO*ALIGN*DEAL*OPTION*ORIGINAL*SECOND*AMOUNT********************S01319
     C***********F3OOSA****IFNE**ZERO**********************B1*************S01319
     C*********************Z-ADDF3OOSA****@ALAMT*150********1*************S01319
     C*********************EXSR*#ZA*************************1*************S01319
     C*********************MOVE*@ALINT****FNOOSI************1*************S01319
     C*********************MOVE*@ALDEC****FNOOSD************1*************S01319
     C*********************MOVE*@ALSIG****FNOOSS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVE*F3DMD1****FNDMD1**************************S01319
     C********************************************************************S01319
     C***ALIGN*DEAL*BCFA**************************************************S01319
     C*********************Z-ADDF3BCAE****@ALAMT**************************S01319
     C*********************MOVE*@DECA*****@ALDNO**************************S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNBAEI**************************S01319
     C*********************MOVE*@ALDEC****FNBAED**************************S01319
     C********************************************************************S01319
     C***ALIGN*DEAL*BCFD**************************************************S01319
     C*********************Z-ADDF3BCDE****@ALAMT**************************S01319
     C*********************MOVE*@@NDPB****@ALDNO**************************S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNBDEI**************************S01319
     C*********************MOVE*@ALDEC****FNBDED**************************S01319
     C********************************************************************S01319
     C***ALIGN*DEAL*DSBCE*************************************************S01319
     C*********************Z-ADDF3DSBE****@ALAMT**************************S01319
     C*********************MOVE*@@NDPB****@ALDNO**************************S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNDSBI**************************S01319
     C*********************MOVE*@ALDEC****FNDSBD**************************S01319
     C********************************************************************S01319
     C***DEAL*USER*CODE*-*Only*set*for*Inserts.***************************S01319
     C***********F3LACT****IFEQ*'I'************************B1*************S01319
     C*********************MOVE*F3DUSC****FNDUSC************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*FNDUSC****F3DUSC************1*************S01319
     C*********************END*****************************E1*************S01319
      ********************************************************************S01319
     C*********************MOVE*F3DBRC****FNDBRC**************************S01319
     C********************************************************************S01319
     C***MOVE*DEAL*DONE*DATE*TO*DATA*STRUCTURE*DATE1**********************S01319
     C*********************MOVE*F3DDDT****@DATE1**************************S01319
     C*********************MOVE*@D1DD*****FNDDDD**************************S01319
     C*********************MOVE*@D1MM*****FNDDMM**************************S01319
     C*********************MOVE*@D1YY*****FNDDYY**************************S01319
     C********************************************************************S01319
     C***DEAL*FORWARD*POINTS**********************************************S01319
     C***********F3FWPZ****IFLT*0**************************B1*************S01319
     C*********************Z-SUBF3FWPZ****FNFWPZ************1*************S01319
     C*********************MOVE*'-'*******FNFWPS************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*F3FWPZ****FNFWPZ************1*************S01319
     C*********************MOVE*'+'*******FNFWPS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVE*F3DORM****FNDORM**************************S01319
     C*********************MOVE*F3DORI****FNDORI**************************S01319
     C********************************************************************S01319
     C***DEAL*MIDAS*OUR*PAYMENT*METHOD************************************S01319
     C*********************MOVE*F3DOPM****FNDOPM**************************S01319
     C*********************MOVE*F3DOPI****FNDOPI**************************S01319
     C*********************MOVE*F3TYPE****FNTYPE**************************S01319
     C*********************MOVE*F3STYP****FNSTYP**************************S01319
     C********************************************************************S01319
     C***DEAL*BROKER*CODE*************************************************S01319
     C*********************MOVE*F3BROK****FNBRK1**************************S01319
     C*********************MOVE*F3BROK****FNBRK2**************************S01319
     C*********************MOVE*F3BROK****FNBRK3**************************S01319
     C********************************************************************S01319
     C***DEAL*BROKERAGE*ACCESS*BROKER*FILE*USING*BROKER*CODE*TO*GET*CCY***S01319
     C***********F3BROK****IFNE*'PHON'*********************B1*************S01319
     C***********F3BROK****ANDNE'TELX'**********************1*************S01319
     C***********F3BROK****ANDNE'MAIL'**********************1*************S01319
     C***********F3BROK****ANDNE'SWAP'**********************1*************S01319
     C***********F3BROK****ANDNE*BLANKS*********************1*************S01319
     C********************************************************************S01319
     C***********F3BRKG****IFEQ**ALL'9'********************B*2******E13902S01319
     C*********************MOVE**ALL'9'***FNBRKI*************2******E13902S01319
     C*********************MOVE**ALL'9'***FNBRKD*************2******E13902S01319
     C*********************ELSE****************************X*2******E13902S01319
     C********************************************************************S01319
     C*********************MOVE *BLANKS   KEY              *1             S01194
     C*********************MOVEL'80'      KEY              *1             S01194
     C*********************MOVE FNBRK1    KEY              *1             S01194
     C***********KEY*******CHAINFDBRKRLL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C*********************CALL*'AOBROKR0'*******************2******S01194S01319
     C*********************PARM '*DBERR ' @RTCD            **2     S01194 LN0391
     C*********************PARM*'*MSG***'*@RTCD**************2******LN0391S01319
     C*********************PARM*'*KEY***'*@OPTN**************2******S01194S01319
     C*********************PARM*FNBRK1****@BQTX***4**********2******S01194S01319
     C***********SDBROK****PARM*SDBROK****DSFDY*********************S01194S01319
     C**************************************************************S01194S01319
     C***********@RTCD*****IFNE**BLANK*********************B*3******S01194S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDBRKRLL'DBFILE           * DB ERROR 019*S01194
     C*********************MOVELFNBRK1****DBKEY*********************S01194S01319
     C*********************MOVEL'SDBROKPD'DBFILE*************DB*ERROS01194S01319
     C*********************MOVEL'019'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7**************2************S01319
     C*********************MOVE*'1'********INU8**************2************S01319
     C*********************EXSR**PSSR************************3******S01194S01319
     C*********************GOTO*#BB9*************************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***ALIGN*FIGURE*1***************************************************S01319
     C*********************Z-ADDF3BRKG****@ALAMT************1*************S01319
     C********************************************************************S01319
     C*****ACCESS*S/TABTG10*VIA*FDTG11LL*USING*BROKER*CCY*TO*GET*DEC*PL** S01194
     C*********************MOVE '1'       @@K1             *1             S01194
     C*********************MOVE '20'      @@K20            *1             S01194
     C*********************MOVE BKCY      @@CCY            *1             S01194
     C***********@@KDCY****CHAINFDTG11LL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C***********CRECI*****OREQ '*'                        **2            S01194
     C***ACCESS*CURRENCY*FILE*WITH*BROKER*CCY*TO*GET*DECIMAL*PLACES*S01194S01319
     C*********************CALL*'AOCURRR0'******************1*******S01194S01319
     C*********************PARM '*DBERR ' @RTCD            *1      S01194 LN0391
     C*********************PARM*'*MSG***'*@RTCD*************1*******LN0391S01319
     C*********************PARM*'*KEY***'*@OPTN*************1*******S01194S01319
     C*********************PARM*A9BRCY****@AJCD*************1*******S01194S01319
     C***********SDCURR****PARM*SDCURR****DSSDY*********************S01194S01319
     C**************************************************************S01194S01319
     C***********@RTCD*****IFNE**BLANK*********************B*2******S01194S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVEL@@KDCY    DBKEY            ***************S01194
     C*********************MOVEL'FDTG11LL'DBFILE           * DB ERROR 020*S01194
     C*********************MOVELA9BRCY****DBKEY*********************S01194S01319
     C*********************MOVEL'SDCURRPD'DBFILE*************DBERRORS01194S01319
     C*********************MOVEL'020'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7**************2************S01319
     C*********************MOVE*'1'********INU8**************2************S01319
     C*********************EXSR**PSSR************************2******S01194S01319
     C*********************GOTO*#BB9*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************MOVE CCDP      @ALDNO           *1             S01194
     C*********************MOVE*A6NBDP****@ALDNO************1*******S01194S01319
     C*********************EXSR*#ZA*************************1*************S01319
     C*********************MOVE*@ALINT****FNBRKI************1*************S01319
     C*********************MOVE*@ALDEC****FNBRKD************1*************S01319
     C*********************END*****************************E*2******E13902S01319
     C********************************************************************S01319
     C**ELSE*BLANK*OUT*BROKER*DETAILS*************************************S01319
     C*********************ELSE****************************X1*************S01319
     C**********           MOVE *ZEROS    FNBRKI           *1             E13902
     C**********           MOVE *ZEROS    FNBRKD           *1             E13902
     C*********************MOVE**ALL'9'***FNBRKI************1*******E13902S01319
     C*********************MOVE**ALL'9'***FNBRKD************1*******E13902S01319
     C*********************MOVE**BLANKS***FNBKCY************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***DEAL*CUSTOMERS*PAYMENT*INSTRUCTIONS******************************S01319
     C*********************MOVE*F3DCPI****FNDCPI**************************S01319
     C*********************MOVE*F3DCRI****FNDCRI**************************S01319
     C*********************MOVE*F3DFAC****FNDFAC**************************S01319
     C*********************MOVE*F3SPEC****FNSPEC**************************S01319
     C*********************MOVE*F3LACT****FNLACT**************************S01319
     C*********************MOVE*F3ETIM****FNETIM**************************S01319
     C********************************************************************S01319
     C***DEAL*BROKER*CURRENCY*********************************************S01319
     C*********************MOVE BKCY      FNBKCY                          S01194
     C*********************MOVE*A9BRCY****FNBKCY********************S01194S01319
     C********************************************************************S01319
     C***MOVE*PC*NUMBER*TO*FIELD*4*TIMES**********************************S01319
     C*********************MOVE*F3PCDN****FNPCD1**************************S01319
     C*********************MOVE*F3PCDN****FNPCD2**************************S01319
     C*********************MOVE*F3PCDN****FNPCD3**************************S01319
     C*********************MOVE*F3PCDN****FNPCD4**************************S01319
     C********************************************************************S01319
     C*********************MOVE*F3PCTN****FNPCTN**************************S01319
     C********************************************************************S01319
     C***DEAL*PROCESSING*OUTSTANDING**************************************S01319
     C***********F3DSTS****IFEQ*'I'************************B1*************S01319
     C*********************MOVE*'2'*******FNPRCO************1*************S01319
     C*********************END*****************************E1*************S01319
     C***********F3DSTS****IFNE*'I'************************B1*************S01319
     C*********************MOVE*'8'*******FNPRCO************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***DEAL*PREVIOUS*STATUS*INDICATOR***********************************S01319
     C*********************MOVE*FNDSTS****FNPSTI**************************S01319
     C********************************************************************S01319
     C***OPTION*DSBCE*****************************************************S01319
     C*********************Z-ADDF3ODSB****@ALAMT**************************S01319
     C*********************MOVE*@@NDPB****@ALDNO**************************S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNODSI**************************S01319
     C*********************MOVE*@ALDEC****FNODSD**************************S01319
     C********************************************************************S01319
     C***OPTION*DBCE******************************************************S01319
     C*********************Z-ADDF3ODBE****@ALAMT**************************S01319
     C*********************MOVE*@@NDPB****@ALDNO**************************S01319
     C*********************EXSR*#ZA***************************************S01319
     C*********************MOVE*@ALINT****FNODBI**************************S01319
     C*********************MOVE*@ALDEC****FNODBD**************************S01319
     C************IN61*****IFEQ*'0'************************B1*************S01319
     C*********************UPDATFXDWNBP0********************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************WRITEFXDWNBP0********************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***RELATED*DEAL*BLOTTER*********************************************S01319
     C***IF*DEAL*IS*A*SWAP*ACCESS*BLOTTER*USING*ASSOCIATED*DEAL*NO.*******S01319
     C***********F3DTYP****IFEQ*'S'************************B1*************S01319
     C*********************MOVE*F3DADN****@DADN***60********1*************S01319
     C***********@DADN*****CHAINFXDW38LL*************61*****1*************S01319
     C********************************************************************S01319
     C***IF*INSERTING*****************************************************S01319
     C***********F3LACT****IFEQ*'I'************************B*2************S01319
     C************IN61*****IFEQ*'1'************************B**3***********S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVELF3DADN****DBKEY***************************S01319
     C*********************MOVEL'FXDW38LL'DBFILE*************DB*ERROR*021*S01319
     C*********************MOVEL'021'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7***************3***********S01319
     C*********************MOVE*'1'********INU8***************3***********S01319
     C*********************GOTO*#BB9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************MOVE*'S'*******FNDTYP*************2************S01319
     C*********************MOVE*'SW'******FNTYPE*************2************S01319
     C**********           MOVE F3PCDN    FNDADN           **2            E13899
     C*********************MOVE*F3DN38****FNDADN*************2******E13899S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***IF*AMENDING************************************************E16484S01319
     C***********F3LACT****IFEQ*'A'************************B*2******E16484S01319
     C************IN61*****ANDEQ'1'************************B*2******E16484S01319
     C*********************GOTO*#BB9*************************2******E16484S01319
     C*********************END*****************************E*2******E16484S01319
     C***IF*DELETING******************************************************S01319
     C***********F3LACT****IFEQ*'D'************************B*2************S01319
     C************IN61*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BB9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************MOVE*'D'*******FNDDLT*************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************UPDATFXDWNBP0********************1*************S01319
     C*********************END*****************************E1*************S01319
     C***********#BB9******ENDSR******************************************S01319
     /*/EJECT*************************************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***SUBROUTINE:*#BC***FXP0039**UPDATE*CUSTOMER*EXPOSURE*DETAILS******S01319
     C********************************************************************S01319
     C***FIELDS*USED*:*****@VDAT**-**DEAL*VALUE*DATE**********************S01319
     C*********************@ACTD**-**DEAL*ACTION*DATE*********************S01319
     C*********************@ODAT**-**DEAL*OPTION*TO*DATE******************S01319
     C*********************@@DTIN*-**INPUT*DATE*FOR*ZA0680****************S01319
     C*********************@@MDNO*-**OUTPUT*DATE*FROM*ZA0680**************S01319
     C*********************@ACTD5*-**DEAL*ACTION*DATE*(NUM)***************S01319
     C*********************@BACTD*-**BEFORE*UPDATE*ACTION*DATE(CHAR)******S01319
     C*********************@BACT5*-**BEFORE*UPDATE*ACTION*DATE(NUM)*******S01319
     C*********************@SCUS**-**CUSTOMER*SHORTNAME*BEFORE*UPDATE*****S01319
     C*********************@PSBEF*-**PARENT*SHORTNAME*BEFORE*UPDATE*******S01319
     C*********************@TERM**-**TERMINATION*PARAMETER****************S01319
     C*********************@PARNT*-**PARENT*SHORTNAME*********************S01319
     C*********************@PTPT**-**PARENT*PARAMETER*********************S01319
     C*********************@DOFLG*-**PROCESSING*FLAG**********************S01319
     C*********************@BUYA**-**BUY*AMOUNT***************************S01319
     C*********************@RCCY**-**CURRENCY*FOR*#BCA********************S01319
     C*********************@RCUS**-**SHORTNAME*FOR*#BCA*******************S01319
     C*********************@RAMT**-**AMOUNT*FOR*#BCA**********************S01319
     C*********************@RDAT**-**ACTION*DATE*FOR*#BCA*****************S01319
     C*********************@RREV**-**REVERSE*INDICATOR*FOR*#BCA***********S01319
     C*********************@RCUSB*-**RELATED*DEAL*CUSTOMER*SHORTNAME******S01319
     C*********************@DATOB*-**RELATED*DEAL*OPTION*TO*DATE**********S01319
     C********************************************************************S01319
     C***CALLED*BY*:*******#B**MAIN*PROCESSING****************************S01319
     C********************************************************************S01319
     C***CALLS*:***********#BCA*ZA0680*FX1000*****************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BC*******BEGSR******************************************S01319
     C********************************************************************S01319
     C***FIND*ACTION*DATE*************************************************S01319
     C***********F3DTYP****IFNE*'O'************************B1*************S01319
     C*********************MOVE*@VDAT*****@ACTD***80********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*@ODAT*****@ACTD***80********1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***CHANGE*ACTION*DATE*INTO*MIDAS*DAY*FORM***************************S01319
     C*********************MOVE*@ACTD*****@@DTIN**************************S01319
     C***********@@DTIN****IFNE**ZEROS*********************B1*************S01319
     C*********************EXSR*ZA0680**********************1*************S01319
     C************INU7*****IFEQ*'1'************************B*2************S01319
     C*********************GOTO*#BC9*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************MOVE*@@MDNO****@ACTD5**50********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE**ZEROS****@ACTD5************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***FIND*BEFORE*ACTION*DATE******************************************S01319
     C***********F3DTYP****IFNE*'O'************************B1*************S01319
     C*********************MOVE*F3BVDT****@BACTD**80********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE*F3BOTD****@BACTD**80********1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***CHANGE*BEFORE*ACTION*DATE*INTO*MIDAS*DAY*FORM********************S01319
     C*********************MOVE*@BACTD****@@DTIN**************************S01319
     C***********@@DTIN****IFNE**ZEROS*********************B1*************S01319
     C*********************EXSR*ZA0680**********************1*************S01319
     C************INU7*****IFEQ*'1'************************B*2************S01319
     C*********************GOTO*#BC9*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************MOVE*@@MDNO****@BACT5**50********1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVE**ZEROS****@BACT5************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***IF*ACTION*DATE*LT*SYSTEM*DATE*THEN*EXIT*PROCESS******************S01319
     C***********@ACTD5****IFLT RUND                       B1             S01194
     C***********@ACTD5****IFLT*BJRDNB*********************B1*******S01194S01319
     C*********************GOTO*#BC9************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***ACCESS*FXCUPAP0*ON*CUST*SHORT*BEFORE*TO*GET*PARENT*SHORT*BEFOR***S01319
     C***********@SCUS*****IFNE**BLANKS********************B1*************S01319
     C*********************CALL*'AOCUSTR0'*************************E17654 S01319
     C*********************PARM '*DBERR ' @RTCD                    E17654 LN0391
     C*********************PARM*'*MSG***'*@RTCD*********************LN0391S01319
     C*********************PARM*'*KEY***'*@OPTN*********************E17654S01319
     C*********************PARM*@SCUS*****@KEY1**10*****************E17654S01319
     C*********************PARM**BLANKS***@KYST***7*****************E17654S01319
     C***********SDCUST****PARM*SDCUST****DSSDY*********************S01194S01319
     C**************************************************************E17654S01319
     C*********************MOVE*BBCUST****@CNUM***60****************S01194S01319
     C*********  @SCUS     CHAINFXCUPAP0             63    *1             E17654
     C***********@CNUM*****CHAINFXCUPAP0*************63*****1*******E17654S01319
     C************IN63*****IFEQ*'1'************************B*2************S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*****                MOVEL@SCUS     DBKEY            ***************E17654
     C*********************MOVELBBCUST****DBKEY*********************E17654S01319
     C*********************MOVEL'FXCUPAP0'DBFILE*************DB*ERROR*022*S01319
     C*********************MOVEL'022'*****DBASE***************************S01319
     C*********************MOVE*'1'********INU7**************2************S01319
     C*********************MOVE*'1'********INU8**************2************S01319
     C*********************GOTO*#BC9*************************2************S01319
     C*********************END*****************************E*2************S01319
     C*****                MOVE FGPSNM    @PSBEF 10        *1             E17654
     C*********************MOVE*FGPNUM****@PNBEF**60********1*******E17654S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*****                MOVE *BLANKS   FGPSNM                          E17654
     C*********************Z-ADD0*********FGPNUM********************E17654S01319
     C********************************************************************S01319
     C***ACCESS*FXCUPAP0*ON*PRESENT*CUST*NUMBER*********************E17654S01319
     C***********F3DCSN****IFNE**BLANKS********************B1*************S01319
     C*****      F3DCSN    CHAINFXCUPAP0             63    *1             E17654
     C***********F3CNUM****CHAINFXCUPAP0*************63*****1*******E17654S01319
     C********************************************************************S01319
     C***IF*NO*RECORD*ALLREADY*EXISTING*THEN*CREATE*ONE*******************S01319
     C************IN63*****IFEQ*'1'************************B*2************S01319
     C*********************Z-ADDF3CNUM****@PCNUM**60****************E17654S01319
     C*********************CALL*'FX1000'*********************2************S01319
     C*********************PARM***********@TERM**************2************S01319
     C*****                PARM           F3DCSN           **2            E17654
     C*****                PARM           @PARNT 10        **2            E17654
     C*********************PARM***********@PCNUM*************2******E17654S01319
     C*********************PARM***********@PNUM***60*********2******E17654S01319
     C***********@TERM*****CABEQ'E'*******#BC9***************2************S01319
     C********************************************************************S01319
     C***IF*PARENT*SHORTNAME*NOT*BLANK*GENERATE*RECORD*FOR*PARENT*********S01319
     C*****      @PARNT    IFNE *BLANKS                    B**3           E17654
     C***********@PNUM*****IFNE*0**************************B**3*****E17654S01319
     C*********************CALL*'FX1000'**********************3***********S01319
     C*********************PARM***********@TERM***************3***********S01319
     C*****                PARM           @PARNT           ***3           E17654
     C*****                PARM           @PTPT  10        ***3           E17654
     C*********************PARM***********@PNUM***************3****E17654 S01319
     C*********************PARM***********@PNUM2**60**********3****E17654 S01319
     C***********@TERM*****CABEQ'E'*******#BC9****************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************ELSE****************************X*2*****E13223 S01319
     C*****                MOVE FGPSNM    @PARNT           **2     E13223 E17654
     C*********************MOVE*FGPNUM****@PNUM**************2*****E17654*S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***Initialise*customer*exposure*file*keys*array,*process****E12279a*S01319
     C***count*and*array*index.***********************************E12279a*S01319
     C*********************MOVE**BLANK****@CK*********************E12279a*S01319
     C*********************Z-ADD*ZERO*****@C******20**************E12279a*S01319
     C*********************Z-ADD*ZERO*****@X******20**************E12279a*S01319
     C************************************************************E12279a*S01319
     C***Set*up*customer*exposure*file*keys*array*with*customer-*E12279a**S01319
     C***parent*indicator/short*name/currency/sequence*number*for*E12279a*S01319
     C***each*update*required.************************************E12279a*S01319
     C***(there*will*be*up*to*10*events)**************************E12279a*S01319
     C********************************************************************S01319
     C***IF*DELETION*OR*AMENDMENT*AND*CHANGES*THEN*REMOVE*OLD*EXPOSURES***S01319
     C*********************MOVE*'N'*******@DOFLG**1***********************S01319
     C***********@SCUS*****IFNE**BLANKS********************B1*************S01319
     C***********F3LACT****IFEQ*'D'************************B*2************S01319
     C*********************MOVE*'Y'*******@DOFLG*************2************S01319
     C*********************END*****************************E*2************S01319
     C***********F3LACT****IFEQ*'A'************************B*2************S01319
     C***********@BUYA*****IFNE*F3DBUY*********************B**3***********S01319
     C***********@ACTD*****ORNE*@BACTD************************3***********S01319
     C***********F3DCSN****ORNE*@SCUS*************************3***********S01319
     C*********************MOVE*'Y'*******@DOFLG**************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C******i)*check*if*deletion*of*old*exposures*for*customer****E12279a*S01319
     C*********is*required.***************************************E12279a*S01319
     C***********@DOFLG****IFEQ*'Y'************************B1*****E12279a*S01319
     C*********************MOVE*'C'*******@CECP*************1*****E12279a*S01319
     C*****                MOVE @SCUS     @CESN            *1     E12279a E17654
     C*****                MOVE CNUM      @CESN            *1      E17654 S01194
     C*********************MOVE*BBCUST****@CESN*************1******S01194*S01319
     C*********************MOVE*F3BBCY****@CECY*************1******E12279aS01319
     C*********************MOVE*'01'******@CESQ*************1******E12279aS01319
     C*********************MOVE*@CEKE*****@CK,1*************1******E12279aS01319
     C*********************ADD**1*********@C****************1******E12279aS01319
     C*************************************************************E12279aS01319
     C*****ii)*check*if*deletion*of*old*exposures*for*parent*is****E12279aS01319
     C*********required.*******************************************E12279aS01319
     C*****      @PSBEF    IFNE *BLANKS                    B*2    E12279a E17654
     C***********@PNBEF****IFNE*0**************************B*2*****E17654*S01319
     C*********************MOVE*'P'*******@CECP**************2*****E12279aS01319
     C*****                MOVE @PSBEF    @CESN            **2    E12279a E17654
     C*********************MOVE*@PNBEF****@CESN**************2*****E17654*S01319
     C*********************MOVE*F3BBCY****@CECY**************2*****E12279aS01319
     C*********************MOVE*'02'******@CESQ**************2*****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,2**************2*****E12279aS01319
     C*********************ADD**1*********@C*****************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E1******E12279aS01319
     C*************************************************************E12279aS01319
     C****iii)*check*if*deletion*of*old*exposures*for*customer*****E12279aS01319
     C*********in*other*leg*of*a*swap*deal*is*required.************E12279aS01319
     C***********F3LACT****IFEQ*'D'************************B1******E12279aS01319
     C***********F3DTYP****ANDEQ'S'*************************1******E12279aS01319
     C* * * * * *F3DCSN* * ANDNE*BLANKS* * * * * * * * * * *1     E12279a E13223
     C*****      @RCUSB    ANDNE*BLANKS                    *1      E13223 E17654
     C***********@RCUSB****ANDNE0***************************1******E17654*S01319
     C*********************MOVE*'C'*******@CECP*************1******E12279aS01319
     C* * * * * * * * * * *MOVE F3DCSN* * @CESN * * * * * **1     E12279a E13223
     C*********************MOVE*@RCUSB****@CESN*************1******E13223*S01319
     C*********************MOVE*F3RBCY****@CECY*************1******E12279aS01319
     C*********************MOVE*'03'******@CESQ*************1******E12279aS01319
     C*********************MOVE*@CEKE*****@CK,3*************1******E12279aS01319
     C*********************ADD**1*********@C****************1******E12279aS01319
      **************************************************************E13223S01319
      ***Get*Related*Deal*Customer*Parent*Short*name****************E13223S01319
     C***********@RCUSB****CHAINFXCUPAP0*************63*****1*******E13223S01319
     C************IN63*****IFEQ*'1'************************B*2******E13223S01319
     C****Set*up*error*output*for*screen.***************************E13223S01319
     C*********************MOVEL@RCUSB****DBKEY*********************E13223S01319
     C*********************MOVEL'FXCUPAP0'DBFILE*************DB*ERROE13223S01319
     C*********************MOVEL'028'*****DBASE*********************E13223S01319
     C*********************MOVE*'1'********INU7**************2******E13223S01319
     C*********************MOVE*'1'********INU8**************2******E13223S01319
     C*********************GOTO*#BC9*************************2******E13223S01319
     C*********************END*****************************E*2******E13223S01319
     C*************************************************************E12279aS01319
     C*****iv)*check*if*deletion*of*old*exposures*for*parent*in****E12279aS01319
     C*********other*leg*of*a*swap*deal*is*required.***************E12279aS01319
     C*****      FGPSNM    IFNE *BLANKS                    B*2    E12279a E17654
     C***********FGPNUM****IFNE*0**************************B*2*****E17654*S01319
     C*********************MOVE*'P'*******@CECP**************2*****E12279aS01319
     C*****                MOVE FGPSNM    @CESN            **2    E12279a E17654
     C*********************MOVE*FGPNUM****@CESN**************2*****E17654*S01319
     C*********************MOVE*F3RBCY****@CECY**************2*****E12279aS01319
     C*********************MOVE*'04'******@CESQ**************2*****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,4**************2*****E12279aS01319
     C*********************ADD**1*********@C*****************2*****E12279aS01319
     C*********************END*****************************E*2****E12279a*S01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E1******E12279aS01319
     C*************************************************************E12279aS01319
     C***IF*INSERTION*OR*AMENDMENT*AND*CHANGES*********************E12279aS01319
     C*********************MOVE*'N'*******@DOFLG*******************E12279aS01319
     C***********F3DCSN****IFNE**BLANKS********************B1*****E12279a*S01319
     C***********F3LACT****IFEQ*'I'************************B*2*****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG*************2****E12279a*S01319
     C*********************END*****************************E*2*****E12279aS01319
     C***********F3LACT****IFEQ*'A'************************B*2*****E12279aS01319
     C***********@BUYA*****IFNE*F3DBUY*********************B**3****E12279aS01319
     C***********@ACTD*****ORNE*@BACTD************************3****E12279aS01319
     C***********F3DCSN****ORNE*@SCUS*************************3****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG**************3****E12279aS01319
     C*********************END*****************************E**3****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*********************END*****************************E1******E12279aS01319
     C*************************************************************E12279aS01319
     C******v)*check*if*insertion*of*new*exposures*for*customer****E12279aS01319
     C*********is*required.****************************************E12279aS01319
     C***********@DOFLG****IFEQ*'Y'************************B1******E12279aS01319
     C*********************MOVE*'C'*******@CECP*************1******E12279aS01319
     C*****                MOVE F3DCSN    @CESN            *1     E12279a E17654
     C*********************MOVE*F3CNUM****@CESN*************1*******E17654S01319
     C*********************MOVE*@BUYC*****@CECY*************1*****E12279a*S01319
     C*********************MOVE*'05'******@CESQ*************1*****E12279a*S01319
     C*********************MOVE*@CEKE*****@CK,5*************1*****E12279a*S01319
     C*********************ADD**1*********@C****************1*****E12279a*S01319
     C************************************************************E12279a*S01319
     C*****vi)*check*if*insertion*of*new*exposures*for*parent*is**E12279a*S01319
     C*********required.******************************************E12279a*S01319
     C* * * * * *FGPSNM* * IFNE *BLANKS* * * * * * * * * * B*2   E12279a  E13223
     C*****      @PARNT    IFNE *BLANKS                    B*2     E13223 E17654
     C***********@PNUM*****IFNE*0**************************B*2******E17654S01319
     C*********************MOVE*'P'*******@CECP**************2*****E12279aS01319
     C* * * * * * * * * * *MOVE FGPSNM* * @CESN * * * * * ***2   E12279a  E13223
     C*****                MOVE @PARNT    @CESN            **2     E13223 E17654
     C*********************MOVE*@PNUM*****@CESN**************2******E17654S01319
     C*********************MOVE*@BUYC*****@CECY**************2*****E12279aS01319
     C*********************MOVE*'06'******@CESQ**************2*****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,6**************2*****E12279aS01319
     C*********************ADD**1*********@C*****************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E1******E12279aS01319
     C*************************************************************E12279aS01319
     C***IF*DEAL*TYPE*IS*'T'***************************************E12279aS01319
     C***********F3DTYP****IFEQ*'T'************************B1******E12279aS01319
     C*************************************************************E12279aS01319
     C***IF*DELETION*OR*AMENDMENT*AND*CHANGES**********************E12279aS01319
     C*********************MOVE*'N'*******@DOFLG************1******E12279aS01319
     C***********F3LACT****IFEQ*'D'************************B*2*****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG*************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C***********F3LACT****IFEQ*'A'************************B*2*****E12279aS01319
     C***********@BUYA*****IFNE*F3DBUY*********************B**3****E12279aS01319
     C***********@ACTD*****ORNE*@BACTD************************3****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG**************3****E12279aS01319
     C*********************END*****************************E**3****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*************************************************************E12279aS01319
     C****vii)*check*if*deletion*of*the*effects*of*takedown*is*****E12279aS01319
     C*********required*for*customer.******************************E12279aS01319
     C***********@DOFLG****IFEQ*'Y'************************B*2****E12279a*S01319
     C* * * * * *@RCUSB * *ANDEQ*BLANKS* * * * * * * * * * **2    E12279a E13223
     C*****      @RCUSB    ANDNE*BLANKS                    **2     E13223 E17654
     C***********@RCUSB****ANDNE0****************************2******E17654S01319
     C*********************MOVE*'C'*******@CECP**************2*****E12279aS01319
     C*********************MOVE*@RCUSB****@CESN**************2*****E12279aS01319
     C*********************MOVE*F3BBCY****@CECY**************2****E12279a*S01319
     C*********************MOVE*'07'******@CESQ**************2*****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,7**************2*****E12279aS01319
     C*********************ADD**1*********@C*****************2*****E12279aS01319
     C*************************************************************E12279aS01319
     C***viii)*check*if*deletion*of*the*effects*of*takedown*is*****E12279aS01319
     C*********required*for*parent.********************************E12279aS01319
     C* * * * * *FGPSNM* * IFNE *BLANKS * * * ** * * * * * B**3   E12279a E13223
     C*****      @PARNT    IFNE *BLANKS                    B**3    E13223 E17654
     C***********@PNUM*****IFNE*0**************************B**3****E17654*S01319
     C*********************MOVE*'P'*******@CECP***************3****E12279aS01319
     C* * * * * * * * * * *MOVE FGPSNM * *@CESN * * * * * ****3   E12279a E13223
     C*****                MOVE @PARNT    @CESN            ***3    E13223 E17654
     C*********************MOVE*@PNUM*****@CESN***************3****E17654*S01319
     C*********************MOVE*F3BBCY****@CECY***************3****E12279aS01319
     C*********************MOVE*'08'******@CESQ***************3****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,8***************3****E12279aS01319
     C*********************ADD**1*********@C******************3****E12279aS01319
     C*********************END*****************************E**3****E12279aS01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*************************************************************E12279aS01319
     C***IF*INSERT*OR*AMEND*AND*CHANGES****************************E12279aS01319
     C*********************MOVE*'N'*******@DOFLG************1******E12279aS01319
     C***********F3LACT****IFEQ*'I'************************B*2*****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG*************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C***********F3LACT****IFEQ*'A'************************B*2*****E12279aS01319
     C***********@BUYA*****IFNE*F3DBUY*********************B**3****E12279aS01319
     C***********@ACTD*****ORNE*@BACTD************************3****E12279aS01319
     C*********************MOVE*'Y'*******@DOFLG**************3****E12279aS01319
     C*********************END*****************************E**3****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C************************************************************E12279a*S01319
     C*****ix)*check*if*insertion*of*the*effects*of*takedown*is***E12279a*S01319
     C*********required*for*customer.*****************************E12279a*S01319
     C***********@DOFLG****IFEQ*'Y'************************B*2****E12279a*S01319
     C***********@RCUSB****ANDEQ*BLANKS**********************2***********E12279a
     C*****      @RCUSB    ANDNE*BLANKS                    **2    E12279a E17654
     C***********@RCUSB****ANDNE0****************************2*****E17654*S01319
     C*********************MOVE*'C'*******@CECP**************2*****E12279aS01319
     C*********************MOVE*@RCUSB****@CESN**************2*****E12279aS01319
     C*********************MOVE*@BUYC*****@CECY**************2****E12279a*S01319
     C*********************MOVE*'09'******@CESQ**************2*****E12279aS01319
     C*********************MOVE*@CEKE*****@CK,9**************2*****E12279aS01319
     C*********************ADD**1*********@C*****************2*****E12279aS01319
     C************************************************************E12279a*S01319
     C******x)*check*if*insertion*of*the*effects*of*takedown*is***E12279a*S01319
     C*********required*for*parent.*******************************E12279a*S01319
     C* * * * * *FGPSNM* * IFNE *BLANKS * * * * * * * * * *B**3   E12279a E13223
     C*****      @PARNT    IFNE *BLANKS                    B**3    E13223 E17654
     C***********@PNUM*****IFNE*0**************************B**3****E17654*S01319
     C*********************MOVE*'P'*******@CECP***************3***E12279a*S01319
     C*****                MOVE FGPSNM    @CESN            ***3   E12279a E17654
     C*********************MOVE*FGPNUM****@CESN***************3****E17654*S01319
     C*********************MOVE*@BUYC*****@CECY***************3***E12279a*S01319
     C*********************MOVE*'10'******@CESQ***************3***E12279a*S01319
     C*********************MOVE*@CEKE*****@CK,10**************3***E12279a*S01319
     C*********************ADD**1*********@C******************3***E12279a*S01319
     C*********************END*****************************E**3****E12279aS01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C*************************************************************E12279aS01319
     C*********************END*****************************E1******E12279aS01319
     C************************************************************E12279a*S01319
     C***Sort*customer*exposure*file*keys*array*in*ascending*order.E12279aS01319
     C***(SORTA*will*place*empty*elements*at*front*of*array)*******E12279aS01319
     C*********************SORTA@CK********************************E12279aS01319
     C*************************************************************E12279aS01319
     C***Calculate*array*index*of*first*required*event.************E12279aS01319
     C***********11********SUB**@C********@X***********************E12279aS01319
     C*************************************************************E12279aS01319
     C***Execute*DO*processing*for*the*number*of*required*events.**E12279aS01319
     C*********************DO***@C*************************B1******E12279aS01319
     C*************************************************************E12279aS01319
     C***Move*array*element*into*array*element*data*structure.*****E12279aS01319
     C*********************MOVE*@CK,@X****@CEKE*************1******E12279aS01319
     C********************************************************************S01319
     C********** @DOFLG    IFEQ 'Y'                        B*2           E12279a
     C********************************************************************S01319
     C***REMOVE*THE*OLD*EXPOSURES*FOR*CUSTOMER****************************S01319
     C***********@CESQ*****IFEQ*'01'***********************B*2****E12279a*S01319
     C*********************MOVE*F3BBCY****@RCCY***3**********2************S01319
     C*********************MOVE*@SCUS*****@RCUS**10**********2*****E17654*S01319
     C*****                MOVE CNUM      @RCUS   60       **2     E17654 S01194
     C*********************MOVE*BBCUST****@RCUS***60*********2******S01194S01319
     C*********************MOVE*F3DBUY****@RAMT**150*********2************S01319
     C*********************MOVE*@BACTD****@RDAT***80*********2************S01319
     C*********************MOVE*'R'*******@RREV**************2************S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2****E12279a*S01319
     C*********************END*****************************E*2****E12279a*S01319
     C********************************************************************S01319
     C***IF*PARENT*SHORTNAME*BEFORE*NE**BLANKS*REMOVE*OLD*EXPOSURES*******S01319
     C***FOR*PARENT*******************************************************S01319
     C********** @PSBEF    IFNE *BLANKS                    B*2           E12279a
     C***********@CESQ*****IFEQ*'02'***********************B*2****E12279a*S01319
     C*********************MOVE*F3BBCY****@RCCY**************2*****E13223*S01319
     C*****                MOVE @PSBEF    @RCUS            **2            E17654
     C*********************MOVE*@PNBEF****@RCUS**************2******E17654S01319
     C*********************MOVE*F3DBUY****@RAMT**************2******E13223S01319
     C*********************MOVE*@BACTD****@RDAT**************2******E13223S01319
     C*********************MOVE*'R'*******@RREV**************2******E13223S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2*****E12279aS01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***DELETING*A*SWAP*DEAL*********************************************S01319
     C********** F3LACT    IFEQ 'D'                        B1            E12279a
     C********** F3DTYP    ANDEQ'S'                        *1            E12279a
     C********** F3DCSN    ANDNE*BLANKS                    *1            E12279a
     C********************************************************************S01319
     C***REMOVE*THE*OTHER*LEG*OF*THE*SWAP*DEAL*EXPOSURES******************S01319
     C***********@CESQ*****IFEQ*'03'***********************B*2*****E12279aS01319
     C*********************MOVE*F3RBCY****@RCCY**************2************S01319
     C* * * * * * * * * * *MOVE F3DCSN * *@RCUS * * * * * ***2            E13223
     C*********************MOVE*@RCUSB****@RCUS**************2******E13223S01319
     C*********************MOVE*F3RBAT****@RAMT**************2************S01319
     C*********************MOVE*F3RVDT****@RDAT**************2************S01319
     C*********************MOVE*'R'*******@RREV**************2************S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C********************************************************************S01319
     C***REMOVE*THE*EXPOSURES*FOR*PARENT**********************************S01319
     C********** FGPSNM    IFNE *BLANKS                    B*2           E12279a
     C***********@CESQ*****IFEQ*'04'***********************B*2****E12279a*S01319
     C*********************MOVE*F3RBCY****@RCCY**************2*****E13223*S01319
     C* * * * * * * * * * *MOVE FGPSNM * *@RCUS * * * * *  **2            E13223
     C*********************MOVE*@CESN*****@RCUS**************2******E13223S01319
     C*********************MOVE*F3RBAT****@RAMT**************2******E13223S01319
     C*********************MOVE*F3RVDT****@RDAT**************2******E13223S01319
     C*********************MOVE*'R'*******@RREV**************2******E13223S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2*****E12279aS01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***IF*INSERTION OR AMENDMENT AND CHANGES                           E12279a
     C**********           MOVE 'N'       @DOFLG                         E12279a
     C********** F3DCSN    IFNE *BLANKS                    B1            E12279a
     C********** F3LACT    IFEQ 'I'                        B*2           E12279a
     C**********           MOVE 'Y'       @DOFLG           **2           E12279a
     C**********           END                             E*2           E12279a
     C********** F3LACT    IFEQ 'A'                        B*2           E12279a
     C********** @BUYA     IFNE F3DBUY                     B**3          E12279a
     C********** @ACTD     ORNE @BACTD                     ***3          E12279a
     C********** F3DCSN    ORNE @SCUS                      ***3          E12279a
     C**********           MOVE 'Y'       @DOFLG           ***3          E12279a
     C**********           END                             E**3          E12279a
     C**********           END                             E*2           E12279a
     C**********           END                             E1            E12279a
     C********** @DOFLG    IFEQ 'Y'                        B1            E12279a
     C********************************************************************S01319
     C***ADD*IN*NEW*EXPOSURES*********************************************S01319
     C***********@CESQ*****IFEQ*'05'***********************B*2****E12279a*S01319
     C*********************MOVE*@BUYC*****@RCCY**************2************S01319
     C*********************MOVE*F3DCSN****@RCUS**************2************E17654
     C*********************MOVE*F3CNUM****@RCUS**************2*****E17654*S01319
     C*********************MOVE*@BUYA*****@RAMT**************2************S01319
     C*********************MOVE*@ACTD*****@RDAT**************2************S01319
     C*********************MOVE*'*'*******@RREV**************2************S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2*****E12279aS01319
     C*********************END*****************************E*2*****E12279aS01319
     C********************************************************************S01319
     C***ADD*IN*NEW*EXPOSURES*FOR*PARENT**********************************S01319
     C********** FGPSNM    IFNE *BLANKS                    B*2           E12279a
     C***********@CESQ*****IFEQ*'06'***********************B*2****E12279a*S01319
     C*********************MOVE*@BUYC*****@RCCY**************2*****E13223*S01319
     C* * * * * * * * * * *MOVE FGPSNM * *@RCUS * * * * * ***2            E13223
     C*********************MOVE*@CESN*****@RCUS**************2******E13223S01319
     C*********************MOVE*@BUYA*****@RAMT**************2******E13223S01319
     C*********************MOVE*@ACTD*****@RDAT**************2******E13223S01319
     C*********************MOVE*'*'*******@RREV**************2******E13223S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2****E12279a*S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***IF*DEAL TYPE IS 'T'                                             E12279a
     C********** F3DTYP    IFEQ 'T'                        B1            E12279a
     C**********                                                         E12279a
     C***IF*DELETION OR AMENDMENT AND CHANGES                            E12279a
     C**********           MOVE 'N'       @DOFLG                         E12279a
     C********** F3LACT    IFEQ 'D'                        B*2           E12279a
     C**********           MOVE 'Y'       @DOFLG           **2           E12279a
     C**********           END                             E*2           E12279a
     C********** F3LACT    IFEQ 'A'                        B*2           E12279a
     C********** @BUYA     IFNE F3DBUY                     B**3          E12279a
     C********** @ACTD     ORNE @BACTD                     ***3          E12279a
     C**********           MOVE 'Y'       @DOFLG           ***3          E12279a
     C**********           END                             E**3          E12279a
     C**********           END                             E*2           E12279a
     C********** @DOFLG    IFEQ 'Y'                        B*2           E12279a
     C*
     C** REMOVE THE EFFECTS OF THE TAKEDOWN - ADD TO EXPOSURES FOR OPT
     C********** @RCUSB    IFNE *BLANKS                    B**3          E12279a
     C***********@CESQ*****IFEQ*'07'***********************B*2****E12279a*S01319
     C*********************MOVE*F3BBCY****@RCCY**************2************S01319
     C*********************MOVE*@RCUSB****@RCUS**************2************S01319
     C*********************MOVE*F3DBUY****@RAMT**************2************S01319
     C*********************MOVE*@DATOB****@RDAT**************2************S01319
     C*********************MOVE*'*'*******@RREV**************2************S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2****E12279a*S01319
     C*********************END*****************************E*2****E12279a*S01319
     C************************************************************E12279a*S01319
     C********** FGPSNM    IFNE *BLANKS                    B***4         E12279a
     C***********@CESQ*****IFEQ*'08'***********************B*2*****E12279aS01319
     C*********************MOVE*F3BBCY****@RCCY**************2******E13223S01319
     C* * * * * * * * * * *MOVE FGPSNM * *@RCUS * * * * * ***2            E13223
     C*********************MOVE*@CESN*****@RCUS**************2******E13223S01319
     C*********************MOVE*F3DBUY****@RAMT**************2******E13223S01319
     C*********************MOVE*@DATOB****@RDAT**************2******E13223S01319
     C*********************MOVE*'*'*******@RREV**************2******E13223S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C**********           END                             E***4         E12279a
     C**********           END                             E**3          E12279a
     C*********************GOTO*#BC7*************************2****E12279a*S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***IF*INSERT OR AMEND AND CHANGES                                  E12279a
     C**********           MOVE 'N'       @DOFLG           *1            E12279a
     C********** F3LACT    IFEQ 'I'                        B*2           E12279a
     C**********           MOVE 'Y'       @DOFLG           **2           E12279a
     C**********           END                             E*2           E12279a
     C********** F3LACT    IFEQ 'A'                        B*2           E12279a
     C********** @BUYA     IFNE F3DBUY                     B**3          E12279a
     C********** @ACTD     ORNE @BACTD                     ***3          E12279a
     C**********           MOVE 'Y'       @DOFLG           ***3          E12279a
     C**********           END                             E**3          E12279a
     C**********           END                             E*2           E12279a
     C********** @DOFLG    IFEQ 'Y'                        B*2           E12279a
     C*
     C** ADD IN THE EFFECT OF THE NEW TAKEDOWN - REMOVE EXPOSURES FOR
     C** OPTION
     C********** @RCUSB    IFNE *BLANKS                    B**3
     C***********@CESQ*****IFEQ*'09'***********************B*2****E12279a*S01319
     C*********************MOVE*@BUYC*****@RCCY**************2************S01319
     C*********************MOVE*@RCUSB****@RCUS**************2************S01319
     C*********************MOVE*@BUYA*****@RAMT**************2************S01319
     C*********************MOVE*F3ROTD****@RDAT**************2************S01319
     C*********************MOVE*'R'*******@RREV**************2************S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C*********************GOTO*#BC7*************************2****E12279a*S01319
     C*********************END*****************************E*2****E12279a*S01319
     C************************************************************E12279a*S01319
     C********** FGPSNM    IFNE *BLANKS                    B***4         E12279a
     C***********@CESQ*****IFEQ*'10'***********************B*2****E12279a*S01319
     C*********************MOVE*@BUYC*****@RCCY**************2*****E13223*S01319
     C*********************MOVE*FGPSNM****@RCUS**************2************E13223
     C*********************MOVE*@CESN*****@RCUS**************2******E13223S01319
     C*********************MOVE*@BUYA*****@RAMT**************2******E13223S01319
     C*********************MOVE*F3ROTD****@RDAT**************2*****E13223*S01319
     C*********************MOVE*'R'*******@RREV**************2******E13223S01319
     C*********************EXSR*#BCA*************************2************S01319
     C************INU7*****IFEQ*'1'************************B**3***********S01319
     C*********************GOTO*#BC9**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C**********           END                             E***4         E12279a
     C**********           END                             E**3          E12279a
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********#BC7******TAG******************************1*****E12279a*S01319
     C************************************************************E12279a*S01319
     C*********************ADD**1*********@X****************1*****E12279a*S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#BC9******ENDSR******************************************S01319
     /*/EJECT*************************************************************S01319
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BD   FXP0042  UPDATE FORWARD BOOK DETAILS      *
     C*                                                              *
     C*  FIELDS USED  :    @ACTD  -  DEAL ACTION DATE(CHAR)          *
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @DATE1 -  DATA STRUCTURE DATE             *
     C*                    @@DTIN -  INPUT DATE FOR ZA0680           *
     C*                    @@MDNO -  OUTPUT DATE FROM ZA0680         *
     C*                    @ACTD5 -  DEAL ACTION DATE(NUM)           *
     C*                    @VDAT5 -  DEAL VALUE DATE(NUM)            *
     C*                    @ACTDB -  ACTION DATE BEFORE UPDATE(CHAR) *
     C*                    @ACDB5 -  ACTIN DATE BEFORE UPDATE(NUM)   *
     C*                    @VDTB5 -  VALUE DATE BEFORE UPDATE(NUM)   *
     C*                    @ACTR  -  RELATED DEAL ACTION DATE(CHAR)  *
     C*                    @ACDR5 -  RELATED DEAL ACTION DATE(NUM)   *
     C*                    @VDTR5 -  RELATED DEAL VALUE DATE(NUM)    *
     C*                    @DOFLG -  PROCESSING FLAG                 *
     C*                    @BUYA  -  DEAL BUY AMOUNT                 *
     C*                    @SELA  -  DEAL SELL AMOUNT                *
     C*                    @DEALB -  DEAL BDC BEFORE UPDATE          *
     C*                    @RREV  -  REVERSE INDICATOR               *
     C*                    @RCCY  -  CURRENCY FOR SUBROUTINE         *
     C*                    @RAMT  -  AMOUNT FOR SUBROUTINE           *
     C*                    @RBCD  -  BCDE FOR SUBROUTINE             *
     C*                    @RACT  -  ACTION DATE FOR SUBROUTINE      *
     C*                    @RDELB -  RELATED DEAL BCE                *
     C*                    @BUYC  -  DEAL BUY CURRENCY               *
     C*                    @SELC  -  DEAL SELL CURRENCY              *
     C*                    @TDOWN -  TAKEDOWN PROPORTION             *
     C*                    @B12   -  BUY FLAG                        *
     C*                    @S12   -  SELL FLAG                       *
     C*                    @R12   -  BUY/SELL FLAG FOR SUBROUTINE    *
     C*                    @AMT1B -  DEAL AMOUNT 1 BEFORE UPDATE     *
     C*                    @BUYSL -  BUY OR SELL CCY PROCESS IND     *
     C*                                                              *
     C*  CALLED BY :       #B  MAIN PROCESSING                       *
     C*                                                              *
     C*  CALLS :           #BDA #BDB ZA0680                          *
     C*                                                              *
     C****************************************************************
     C           #BD       BEGSR
     C*
     C** GET ACTION DATE AND CONVERT TO 5N
     C                     MOVE F3VDYY    @D1YY
     C                     MOVE F3VDMM    @D1MM
     C                     MOVE F3VDDD    @D1DD
     C*********************MOVE*@DATE1****@ACTD***************************S01319
     C                     MOVE @DATE1    @ACTD   80                      S01319
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'N'*************************1*************S01319
     C           EROVDI    ANDEQ'N'                        *1             S01319
     C                     MOVE F3DOEY    @D1YY            *1
     C                     MOVE F3DOEM    @D1MM            *1
     C                     MOVE F3DOED    @D1DD            *1
     C                     MOVE @DATE1    @ACTD            *1
     C                     END                             E1
     C                     MOVE @ACTD     @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BD9                       **2
     C                     END                             E*2
     C*********************MOVE*@@MDNO****@ACTD5************1*************S01319
     C                     MOVE @@MDNO    @ACTD5  50       *1             S01319
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACTD5           *1
     C                     END                             E1
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'Y'*************************1*************S01319
     C           EROVDI    ANDEQ'Y'                        *1             S01319
     C***********@VDAT5****ANDLTRUND                       *1             S01194
     C*********************MOVE RUND      @ACTD5           *1             S01194
     C           @VDAT5    ANDLTBJRDNB                     *1             S01194
     C                     MOVE BJRDNB    @ACTD5           *1             S01194
     C                     END                             E1
     C*
     C** GET BEFORE ACTION DATE AND CONVERT TO 5N
     C                     MOVE F3BVDT    @ACTDB  80
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'N'*************************1*************S01319
     C           EROVDI    ANDEQ'N'                        *1             S01319
     C                     MOVE F3BOTD    @ACTDB           *1
     C                     END                             E1
     C                     MOVE @ACTDB    @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BD9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @ACDB5  50       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACDB5           *1
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP9                                           S01408
     C*                                                                   S01408
     C*
     C** CONVERT VALUE DATE TO 5N
     C                     MOVE F3BVDT    @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BD9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @VDTB5  50       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @VDTB5           *1
     C                     END                             E1
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'Y'*************************1*************S01319
     C           EROVDI    ANDEQ'Y'                        *1             S01319
     C***********@VDTB5****ANDLTRUND                       *1             S01194
     C*********************MOVE RUND      @ACDB5           *1             S01194
     C           @VDTB5    ANDLTBJRDNB                     *1             S01194
     C                     MOVE BJRDNB    @ACDB5           *1             S01194
     C                     END                             E1
     C*
     C** GET RELATED ACTION DATE AND CONVERT TO 5N
     C           F3DTYP    IFEQ 'T'                        B1
     C           F3DTYP    OREQ 'S'                        *1
     C                     MOVE F3RVDT    @ACTR            *1
     C           F3DTYP    IFEQ 'T'                        B*2
     C***********FWOVDI****ANDEQ'N'**************************2************S01319
     C           EROVDI    ANDEQ'N'                        **2            S01319
     C                     MOVE F3ROTD    @ACTR   80       **2
     C                     END                             E*2
     C                     MOVE @ACTR     @@DTIN           *1
     C           @@DTIN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0680                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     MOVE @@MDNO    @ACDR5  50       **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @ACDR5           **2
     C                     END                             E*2
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP10                                           S01408
     C*                                                                   S01408
     C*
     C** CONVERT RELATED VALUE DATE TO 5N
     C                     MOVE F3RVDT    @@DTIN           *1
     C           @@DTIN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0680                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     MOVE @@MDNO    @VDTR5  50       **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @VDTR5           **2
     C                     END                             E*2
     C           F3DTYP    IFEQ 'T'                        B*2
     C***********FWOVDI****ANDEQ'Y'**************************2************S01319
     C           EROVDI    ANDEQ'Y'                        **2            S01319
     C***********@VDTR5****ANDLTRUND                       **2            S01194
     C*********************MOVE RUND      @ACDR5           **2            S01194
     C           @VDTR5    ANDLTBJRDNB                     **2            S01194
     C                     MOVE BJRDNB    @ACDR5           **2            S01194
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Initialise forward book file keys array, process count          E12279a
     C** and array index.                                                E12279a
     C                     MOVE *BLANK    @FK                            E12279a
     C*********************Z-ADD*ZERO*****@C**********************E12279a*S01319
     C                     Z-ADD*ZERO     @C      20                      S01319
     C*********************Z-ADD*ZERO*****@X**********************E12279a*S01319
     C                     Z-ADD*ZERO     @X      20                      S01319
     C*                                                                  E12279a
     C** Set up forward book file keys array with currency/date/         E12279a
     C** sequence number for each update required.                       E12279a
     C** (there will be up to 14 events)                                 E12279a
     C*
     C** IF DELETE OR AMEND AND CHANGES
     C*********************MOVE*'N'*******@DOFLG**************************S01319
     C                     MOVE 'N'       @DOFLG  1                       S01319
     C           F3LACT    IFEQ 'D'                        B1
     C                     MOVE 'Y'       @DOFLG           *1
     C                     END                             E1
     C           F3LACT    IFEQ 'A'                        B1
     C           @BUYA     IFNE F3DBUY                     B*2
     C           @SELA     ORNE F3DSEL                     **2
     C           @ACTD5    ORNE @ACDB5                     **2
     C                     MOVE 'Y'       @DOFLG           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**   i) check if deletion of old deal amounts, etc is              E12279a
     C*       required.                                                  E12279a
     C           @DOFLG    IFEQ 'Y'                        B1            E12279a
     C***********@ACDB5****ANDGERUND                       *1      E12279aS01194
     C           @ACDB5    ANDGEBJRDNB                     *1      E12279aS01194
     C*                                                                  E12279a
     C**      set up key for buy currency before record.     .           E12279a
     C                     MOVE F3BBCY    @FBCY            *1            E12279a
     C                     MOVE @ACDB5    @FBDT            *1            E12279a
     C                     MOVE '01'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,1            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C**      set up key for sell currency before record.                E12279a
     C                     MOVE F3BSCY    @FBCY            *1            E12279a
     C                     MOVE @ACDB5    @FBDT            *1            E12279a
     C                     MOVE '02'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,2            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C                     END                             E1            E12279a
     C*                                                                  E12279a
     C**  ii) if old deal is a swap, check if deletion of                E12279a
     C**      related deal amounts, etc is required.                     E12279a
     C           F3DTYP    IFEQ 'S'                        B1            E12279a
     C           F3LACT    ANDEQ'D'                        *1            E12279a
     C***********@ACDR5****ANDGERUND                       *1      E12279aS01194
     C           @ACDR5    ANDGEBJRDNB                     *1             S01194
     C*                                                                  E12279a
     C**     set up key for related buy currency record.                 E12279a
     C                     MOVE F3RBCY    @FBCY            *1            E12279a
     C                     MOVE @ACDR5    @FBDT            *1            E12279a
     C                     MOVE '03'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,3            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C**     set up key for related sell currency record.                E12279a
     C                     MOVE F3RSCY    @FBCY            *1            E12279a
     C                     MOVE @ACDR5    @FBDT            *1            E12279a
     C                     MOVE '04'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,4            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C                     END                             E1            E12279a
     C*                                                                  E12279a
     C** IF INSERT OR AMEND WITH CHANGES                                 E12279a
     C                     MOVE 'N'       @DOFLG                         E12279a
     C           F3LACT    IFEQ 'I'                        B1            E12279a
     C                     MOVE 'Y'       @DOFLG           *1            E12279a
     C                     END                             E1            E12279a
     C           F3LACT    IFEQ 'A'                        B1            E12279a
     C           @BUYA     IFNE F3DBUY                     B*2           E12279a
     C           @SELA     ORNE F3DSEL                     **2           E12279a
     C           @ACTD5    ORNE @ACDB5                     **2           E12279a
     C                     MOVE 'Y'       @DOFLG           **2           E12279a
     C                     END                             E*2           E12279a
     C                     END                             E1            E12279a
     C*                                                                  E12279a
     C** iii) check if insertion of new deal amounts, etc is             E12279a
     C**      required.                                                  E12279a
     C           @DOFLG    IFEQ 'Y'                        B1            E12279a
     C***********@ACTD5****ANDGERUND                       A1      E12279aS01194
     C           @ACTD5    ANDGEBJRDNB                     A1             S01194
     C*                                                                  E12279a
     C**     set up key for new buy currency record.                     E12279a
     C                     MOVE @BUYC     @FBCY            *1            E12279a
     C                     MOVE @ACTD5    @FBDT            *1            E12279a
     C                     MOVE '05'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,5            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C**     set up key for new sell currency record.                    E12279a
     C                     MOVE @SELC     @FBCY            *1            E12279a
     C                     MOVE @ACTD5    @FBDT            *1            E12279a
     C                     MOVE '06'      @FBSQ            *1            E12279a
     C                     MOVE @FBKE     @FK,6            *1            E12279a
     C                     ADD  1         @C               *1            E12279a
     C*                                                                  E12279a
     C                     END                             E1            E12279a
     C*                                                                  E12279a
     C** IF DEAL IS A TAKEDOWN                                           E12279a
     C           F3DTYP    IFEQ 'T'                        B1            E12279a
     C***********@ACDR5****ANDGERUND                       *1      E12279aS01194
     C           @ACDR5    ANDGEBJRDNB                     *1             S01194
     C*                                                                  E12279a
     C**  iv) check if insertion of takedown - ie. removal of            E12279a
     C**      part of option.                                            E12279a
     C           F3LACT    IFEQ 'I'                        B*2           E12279a
     C*                                                                  E12279a
     C**     set up key for new option buy currency record.              E12279a
     C                     MOVE @BUYC     @FBCY            **2           E12279a
     C                     MOVE @ACDR5    @FBDT            **2           E12279a
     C                     MOVE '07'      @FBSQ            **2           E12279a
     C                     MOVE @FBKE     @FK,7            **2           E12279a
     C                     ADD  1         @C               **2           E12279a
     C*                                                                  E12279a
     C**     set up key for new option sell currency record.             E12279a
     C                     MOVE @SELC     @FBCY            **2           E12279a
     C                     MOVE @ACDR5    @FBDT            **2           E12279a
     C                     MOVE '08'      @FBSQ            **2           E12279a
     C                     MOVE @FBKE     @FK,8            **2           E12279a
     C                     ADD  1         @C               **2           E12279a
     C*                                                                  E12279a
     C                     END                             E*2           E12279a
     C*                                                                  E12279a
     C**   v) check if deletion of takedown - ie. re-addition            E12279a
     C**      of part of option.                                         E12279a
     C           F3LACT    IFEQ 'D'                        B*2           E12279a
     C*                                                                  E12279a
     C**     set up key for old option buy currency record.              E12279a
     C                     MOVE @BUYC     @FBCY            **2           E12279a
     C                     MOVE @ACDR5    @FBDT            **2           E12279a
     C                     MOVE '09'      @FBSQ            **2           E12279a
     C                     MOVE @FBKE     @FK,9            **2           E12279a
     C                     ADD  1         @C               **2           E12279a
     C*                                                                  E12279a
     C**     set up key for old option sell currency record.             E12279a
     C                     MOVE @SELC     @FBCY            **2           E12279a
     C                     MOVE @ACDR5    @FBDT            **2           E12279a
     C                     MOVE '10'      @FBSQ            **2           E12279a
     C                     MOVE @FBKE     @FK,10           **2           E12279a
     C                     ADD  1         @C               **2           E12279a
     C*                                                                  E12279a
     C                     END                             E*2           E12279a
     C*                                                                  E12279a
     C**  vi) check if amendment of takedown with changes.               E12279a
     C           F3LACT    IFEQ 'A'                        B*2           E12279a
     C           @BUYA     IFNE F3DBUY                     B**3          E12279a
     C           @SELA     ORNE F3DSEL                     ***3          E12279a
     C           @ACTD5    ORNE @ACDB5                     ***3          E12279a
     C*                                                                  E12279a
     C**     set up key for old option buy currency record.              E12279a
     C                     MOVE F3BBCY    @FBCY            ***3          E12279a
     C                     MOVE @ACDR5    @FBDT            ***3          E12279a
     C                     MOVE '11'      @FBSQ            ***3          E12279a
     C                     MOVE @FBKE     @FK,11           ***3          E12279a
     C                     ADD  1         @C               ***3          E12279a
     C*                                                                  E12279a
     C**     set up key for old option sell currency record.             E12279a
     C                     MOVE F3BSCY    @FBCY            ***3          E12279a
     C                     MOVE @ACDR5    @FBDT            ***3          E12279a
     C                     MOVE '12'      @FBSQ            ***3          E12279a
     C                     MOVE @FBKE     @FK,12           ***3          E12279a
     C                     ADD  1         @C               ***3          E12279a
     C*                                                                  E12279a
     C**     set up key for new option buy currency record.              E12279a
     C                     MOVE @BUYC     @FBCY            ***3          E12279a
     C                     MOVE @ACDR5    @FBDT            ***3          E12279a
     C                     MOVE '13'      @FBSQ            ***3          E12279a
     C                     MOVE @FBKE     @FK,13           ***3          E12279a
     C                     ADD  1         @C               ***3          E12279a
     C*                                                                  E12279a
     C**     set up key for new option sell currency record.             E12279a
     C                     MOVE @SELC     @FBCY            ***3          E12279a
     C                     MOVE @ACDR5    @FBDT            ***3          E12279a
     C                     MOVE '14'      @FBSQ            ***3          E12279a
     C                     MOVE @FBKE     @FK,14           ***3          E12279a
     C                     ADD  1         @C               ***3          E12279a
     C*                                                                  E12279a
     C                     END                             E**3          E12279a
     C                     END                             E*2           E12279a
     C                     END                             E1            E12279a
     C*                                                                  E12279a
     C** Sort forward book file keys array in ascending order.           E12279a
     C** (SORTA will place empty elements at front of array)             E12279a
     C                     SORTA@FK                                      E12279a
     C*                                                                  E12279a
     C** Calculate array index of first required event.                  E12279a
     C           15        SUB  @C        @X                             E12279a
     C*                                                                  E12279a
     C** Execute DO processing for the number of required events.        E12279a
     C                     DO   @C                         B1            E12279a
     C*                                                                  E12279a
     C** Move array element into array element data structure.           E12279a
     C                     MOVE @FK,@X    @FBKE            *1            E12279a
     C*                                                                  E12279a
     C***To*stop program locking problem do the update twice      E12279 E12279a
     C***once*for buy and once for sell currency. The currency    E12279 E12279a
     C***is*sorted alphabatically and the lowest currency is      E12279 E12279a
     C***done*on the first DO.                                    E12279 E12279a
     C**********           MOVE ' '       @BUYSL  1               E12279 E12279a
     C********** @BUYC     IFLT @SELC                      B1     E12279 E12279a
     C**********           MOVE 'B'       @BUYSL           *1     E12279 E12279a
     C**********           ELSE                            X1     E12279 E12279a
     C**********           MOVE 'S'       @BUYSL           *1     E12279 E12279a
     C**********           END                             E1     E12279 E12279a
     C**********                                                  E12279 E12279a
     C**********           DO   2                          B1     E12279 E12279a
     C***REVERSE OUT DEAL AMOUNTS                                        E12279a
     C********** @DOFLG    IFEQ 'Y'                        B*2           E12279a
     C********** @ACDB5    ANDGERUND                       **2           E12279a
     C**********                                                         E12279a
     C***check*for the buy/sell indicator before update each time E12279 E12279a
     C********** @BUYSL    IFEQ 'B'                        B**3   E12279 E12279a
     C*                                                                  E12279a
     C**   i) deletion of old deal amounts, etc.                         E12279a
     C*
     C** FXR0014 & FXR0015 FOR BUY CCY BEFORE AMOUNTS ETC.
     C           @FBSQ     IFEQ '01'                       B*2           E12279a
     C                     MOVE 'R'       @RREV   1        **2
     C                     MOVE F3BBCY    @RCCY   3        **2
     C                     MOVE F3DBUY    @RAMT  150       **2
     C                     MOVE @DEALB    @RBCD  150       **2
     C                     MOVE @ACDB5    @RACT   80       **2
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C***if*buy*indicator not on do sell processing.              E12279 E12279a
     C**********           ELSE                            X**3   E12279 E12279a
     C*
     C** FXR0014 & FXR0015 FOR SELL CCY BEFORE AMOUNTS ETC.
     C           @FBSQ     IFEQ '02'                       B*2           E12279a
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE F3BSCY    @RCCY            **2
     C                     MOVE F3DSEL    @RAMT            **2
     C                     MOVE @DEALB    @RBCD            **2
     C                     MOVE @ACDB5    @RACT            **2
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP11                                           S01408
     C*                                                                   S01408
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C**********           END                             E**3   E12279 E12279a
     C                     END                             E*2
     C*
     C***IF*DELETE AND DEAL IS A SWAP                                    E12279a
     C********** F3LACT    IFEQ 'D'                        B*2           E12279a
     C********** F3DTYP    ANDEQ'S'                        **2           E12279a
     C********** @ACDR5    ANDGERUND                       **2           E12279a
     C**********                                                         E12279a
     C***check*for the buy/sell indicator before update each time E12279 E12279a
     C********** @BUYSL    IFEQ 'S'                        B**3   E12279 E12279a
     C*
     C**  ii) deletion of related deal amounts, etc for swap.            E12279a
     C*
     C** FXR0014 & FXR0015 FOR RELATED BUY CCY
     C           @FBSQ     IFEQ '03'                       B*2           E12279a
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE F3RBCY    @RCCY            **2
     C                     MOVE F3RBAT    @RAMT            **2
     C                     MOVE @RDELB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C***if*sell indicator not on do buy processing.              E12279 E12279a
     C**********           ELSE                            X**3   E12279 E12279a
     C*
     C** FXR0014 & FXR0015 FOR RELATED SELL CCY
     C           @FBSQ     IFEQ '04'                       B*2           E12279a
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE F3RSCY    @RCCY            **2
     C                     Z-SUBF3RSAT    @RAMT            **2
     C                     MOVE @RDELB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP12                                           S01408
     C*                                                                   S01408
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C**********           END                             E**3   E12279 E12279a
     C                     END                             E*2
     C*
     C***IF*INSERT OR AMEND WITH CHANGES                                 E12279a
     C**********           MOVE 'N'       @DOFLG           *1            E12279a
     C********** F3LACT    IFEQ 'I'                        B*2           E12279a
     C**********           MOVE 'Y'       @DOFLG           **2           E12279a
     C**********           END                             E*2           E12279a
     C********** F3LACT    IFEQ 'A'                        B*2           E12279a
     C********** @BUYA     IFNE F3DBUY                     B**3          E12279a
     C********** @SELA     ORNE F3DSEL                     ***3          E12279a
     C********** @ACTD5    ORNE @ACDB5                     ***3          E12279a
     C**********           MOVE 'Y'       @DOFLG           ***3          E12279a
     C**********           END                             E**3          E12279a
     C**********           END                             E*2           E12279a
     C**********                                                         E12279a
     C***ADD*IN*DEAL AMOUNTS (CURRENT)                                   E12279a
     C********** @DOFLG    IFEQ 'Y'                        B*2           E12279a
     C********** @ACTD5    ANDGERUND                       **2           E12279a
     C**********                                                         E12279a
     C***check*for the buy/sell indicator before update each time E12279 E12279a
     C********** @BUYSL    IFEQ 'B'                        B**3   E12279 E12279a
     C*
     C** iii) insertion of new deal amounts, etc.                        E12279a
     C*
     C** FXR0014 & FXR0015 FOR BUY CCY
     C           @FBSQ     IFEQ '05'                       B*2           E12279a
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @BUYC     @RCCY            **2
     C                     MOVE @BUYA     @RAMT            **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACTD5    @RACT            **2
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C***if*buy*indicator not on do sell processing.              E12279 E12279a
     C**********           ELSE                            X**3   E12279 E12279a
     C*
     C** FXR0014 & FXR0015 FOR SELL CCY
     C           @FBSQ     IFEQ '06'                       B*2           E12279a
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @SELC     @RCCY            **2
     C                     MOVE @SELA     @RAMT            **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACTD5    @RACT            **2
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP14                                           S01408
     C*                                                                   S01408
     C                     EXSR #BDA                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C**********           END                             E**3   E12279 E12279a
     C                     END                             E*2
     C*
     C***IF*DEAL IS A TAKEDOWN                                           E12279a
     C********** F3DTYP    IFEQ 'T'                        B*2           E12279a
     C********** @ACDR5    ANDGERUND                       **2           E12279a
     C**********                                                         E12279a
     C***IF*INSERT THEN USE 'REMOVAL OF OPTION TAKEDOWN' SCHEDULES       E12279a
     C***TO*REMOVE PART OF THE OPTION                                    E12279a
     C********** F3LACT    IFEQ 'I'                        B**3          E12279a
     C**********                                                         E12279a
     C***CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C********** F3DAM1    DIV  F3OOFA    @TDOWN 109H      ***3          E12279a
     C**********                                                         E12279a
     C***check*for the buy/sell indicator before update each time E12279 E12279a
     C********** @BUYSL    IFEQ 'B'                        B***4  E12279 E12279a
     C*                                                                  E12279a
     C**  iv) insertion of takedown - use 'removal of option             E12279a
     C*       takedown' schedules to remove part of the option.          E12279a
     C*
     C** FXR0048 & FXR0049 FOR BUY CCY CURRENT AMOUNTS
     C           @FBSQ     IFEQ '07'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN 109H      **2           E12279a
     C*
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @BUYC     @RCCY            **2
     C                     MOVE @BUYA     @RAMT            **2
     C                     MOVE @B12      @R12    1        **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     MOVE F3DAM1    @RTPA1 150       **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C***if*buy*indicator not on do sell processing.              E12279 E12279a
     C**********           ELSE                            X***4  E12279 E12279a
     C*
     C** FXR0048 & FXR0049 FOR SELL CCY CURRENT AMOUNTS
     C           @FBSQ     IFEQ '08'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @SELC     @RCCY            **2
     C                     MOVE @SELA     @RAMT            **2
     C                     MOVE @S12      @R12    1        **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C**********           END                             E***4  E12279 E12279a
     C**********           END                             E**3          E12279a
     C**********                                                         E12279a
     C***IF*DELETE THEN ADD IN AMOUNTS (CURRENT)                         E12279a
     C***IF*DELETE THEN USE 'REMOVAL OF OPTION TAKEDOWN' SCHEDULES       E12279a
     C***WITH*REVERSE INDICATOR SET TO ADD IN FOR THE OPTION             E12279a
     C********** F3LACT    IFEQ 'D'                        B**3          E12279a
     C**********                                                         E12279a
     C***CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C********** F3DAM1    DIV  F3OOFA    @TDOWN 109H      ***3          E12279a
     C**********                                                         E12279a
     C********** @BUYSL    IFEQ 'B'                        B***4  E12279 E12279a
     C*                                                                  E12279a
     C**   v) deletion of takedown - use 'removal of option              E12279a
     C*       takedown' schedules with reverse indicator set             E12279a
     C*       to add in for the option.                                  E12279a
     C*
     C** FXR0048 & FXR0049 FOR BUY CCY
     C           @FBSQ     IFEQ '09'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE @BUYC     @RCCY            **2
     C                     MOVE @BUYA     @RAMT            **2
     C                     MOVE @B12      @R12             **2
     C                     MOVE @DEALB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C**********           ELSE                            X***4  E12279 E12279a
     C*
     C** FXR0048 & FXR0049 FOR SELL CCY
     C           @FBSQ     IFEQ '10'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE @SELC     @RCCY            **2
     C                     MOVE @SELA     @RAMT            **2
     C                     MOVE @S12      @R12             **2
     C                     MOVE @DEALB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C**********           END                             E***4  E12279 E12279a
     C**********           END                             E**3          E12279a
     C**********                                                         E12279a
     C***IF*ACTION IS AMEND AND CHANGES                                  E12279a
     C********** F3LACT    IFEQ 'A'                        B**3          E12279a
     C********** @BUYA     IFNE F3DBUY                     B***4         E12279a
     C********** @SELA     ORNE F3DSEL                     ****4         E12279a
     C********** @ACTD5    ORNE @ACDB5                     ****4         E12279a
     C**********                                                         E12279a
     C***ADD*IN*DEAL BEFORE AMOUNTS                                      E12279a
     C**********                                                         E12279a
     C***CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C********** @AMT1B    DIV  F3OOFA    @TDOWN 109H      ****4         E12279a
     C**********                                                         E12279a
     C********** @BUYSL    IFEQ 'B'                        B****5 E12279 E12279a
     C*                                                                  E12279a
     C**  vi) amendment of takedown with changes.                        E12279a
     C*
     C** FXR0048 & FXR0049 FOR BUY CCY BEFORE
     C           @FBSQ     IFEQ '11'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           @AMT1B    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE F3BBCY    @RCCY            **2
     C                     MOVE F3DBUY    @RAMT            **2
     C                     MOVE @B12      @R12             **2
     C                     MOVE @DEALB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     MOVE @AMT1B    @RTPA1           **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C**********           ELSE                            X****5 E12279 E12279a
     C*
     C** FXR0048 & FXR0049 FOR SELL CCY
     C           @FBSQ     IFEQ '12'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           @AMT1B    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE 'R'       @RREV            **2
     C                     MOVE F3BSCY    @RCCY            **2
     C                     MOVE F3DSEL    @RAMT            **2
     C                     MOVE @S12      @R12             **2
     C                     MOVE @DEALB    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C**********           END                             E****5 E12279 E12279a
     C**********                                                         E12279a
     C***REVERSE OUT CURRENT AMOUNTS                                     E12279a
     C**********                                                         E12279a
     C********** @BUYSL    IFEQ 'B'                        B****5 E12279 E12279a
     C**********                                                         E12279a
     C***CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C********** F3DAM1    DIV  F3OOFA    @TDOWN 109H      *****5        E12279a
     C*
     C** FXR0048 & FXR0049 FOR BUY CCY
     C           @FBSQ     IFEQ '13'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @BUYC     @RCCY            **2
     C                     MOVE @BUYA     @RAMT            **2
     C                     MOVE @B12      @R12             **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     MOVE F3DAM1    @RTPA1           **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     GOTO #BD7                       **2           E12279a
     C                     END                             E*2           E12279a
     C*
     C**********           ELSE                            X****5 E12279 E12279a
     C*
     C** FXR0048 & FXR0049 FOR SELL CCY
     C           @FBSQ     IFEQ '14'                       B*2           E12279a
     C*                                                                  E12279a
     C** CALCULATE TAKEDOWN PROPORTION                                   E12279a
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      **2           E12279a
     C*
     C                     MOVE ' '       @RREV            **2
     C                     MOVE @SELC     @RCCY            **2
     C                     MOVE @SELA     @RAMT            **2
     C                     MOVE @S12      @R12             **2
     C                     MOVE F3BCDE    @RBCD            **2
     C                     MOVE @ACDR5    @RACT            **2
     C                     EXSR #BDB                       **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BD9                       ***3
     C                     END                             E**3
     C                     END                             E*2           E12279a
     C*
     C**********           END                             E****5        E12279a
     C**********                                                         E12279a
     C**********           END                             E***4         E12279a
     C**********           END                             E**3          E12279a
     C**********           END                             E*2           E12279a
     C***change*buy/sell indicator for second round of update     E12279 E12279a
     C********** @BUYSL    IFEQ 'B'                        B*2    E12279 E12279a
     C**********           MOVE 'S'       @BUYSL           **2    E12279 E12279a
     C**********           ELSE                            X*2    E12279 E12279a
     C**********           MOVE 'B'       @BUYSL           **2    E12279 E12279a
     C**********           END                             E*2    E12279 E12279a
     C*
     C           #BD7      TAG                             *1            E12279a
     C                     ADD  1         @X               *1            E12279a
     C                     END                             E1     E12279 E12279a
     C*
     C           #BD9      ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BE   FXP0043  UPDATE EQUIVALENTS POSITIONS AND *
     C*                             PROFITS                          *
     C*                                                              *
     C*  FIELDS USED  :    @ACTD  -  DEAL ACTION DATE(CHAR)          *
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @DATE1 -  DATA STRUCTURE DATE             *
     C*                    @@DTIN -  INPUT DATE FOR ZA0680           *
     C*                    @@MDNO -  OUTPUT DATE FROM ZA0680         *
     C*                    @ACTD5 -  DEAL ACTION DATE(NUM)           *
     C*                    @VDAT  -  DEAL VALUE DATE(CHAR)           *
     C*                    @VDAT5 -  DEAL VALUE DATE(NUM)            *
     C*                    @@DAYN -  INPUT DATE FOR ZA0710           *
     C*                    @@RTN  -  RETURN FLAG FROM ZA0710         *
     C*                    @@VDT  -  OUTPUT DATE FROM ZA0710         *
     C*                    @ACTDB -  ACTION DATE BEFORE UPDATE(CHAR) *
     C*                    @ACDB5 -  ACTIN DATE BEFORE UPDATE(NUM)   *
     C*                    @VDTB5 -  VALUE DATE BEFORE UPDATE(NUM)   *
     C*                    @ACTR  -  RELATED DEAL ACTION DATE(CHAR)  *
     C*                    @ACTR5 -  RELATED DEAL ACTION DATE(NUM)   *
     C*                    @VDTR5 -  RELATED DEAL VALUE DATE(NUM)    *
     C*                    @DOFLG -  PROCESSING FLAG                 *
     C*                    @BUYA  -  DEAL BUY AMOUNT                 *
     C*                    @SELA  -  DEAL SELL AMOUNT                *
     C*                    @DEALB -  DEAL BDC BEFORE UPDATE          *
     C*                    @RREV  -  REVERSE INDICATOR               *
     C*                    @RCCY  -  CURRENCY FOR SUBROUTINE         *
     C*                    @RAMT  -  AMOUNT FOR SUBROUTINE           *
     C*                    @RBCD  -  BCDE FOR SUBROUTINE             *
     C*                    @RACT  -  ACTION DATE FOR SUBROUTINE      *
     C*                    @RDBCE -  BCDE FOR SUBROUTINE             *
     C*                    @RDSBE -  DSBE FOR SUBROUTINE             *
     C*                    @RAMTO -  OPTION ORIGINAL AMT FOR SUBR'TINE
     C*                    @BUYC  -  DEAL BUY CURRENCY               *
     C*                    @SELC  -  DEAL SELL CURRENCY              *
     C*                    @TDOWN -  TAKEDOWN PROPORTION             *
     C*                    @B12   -  BUY FLAG                        *
     C*                    @S12   -  SELL FLAG                       *
     C*                    @R12   -  BUY/SELL FLAG FOR SUBROUTINE    *
     C*                    @AMT1B -  DEAL AMOUNT 1 BEFORE UPDATE     *
     C*                    @AMT2B -  DEAL AMOUNT 2 BEFORE UPDATE     *
     C*                    @NPA   -  NET POSITION ADJUSTMENT         *
     C*                    @DBCEA -  DBCE ADJUSTMENT                 *
     C*                    @DSBCA -  DSBCE ADJUSTMENT                *
     C*                    @OPTPL -  OPTION DEAL P/L                 *
     C*                    @DELPL -  DEAL P/L                        *
     C*                    @ABNPA -  BUY CCY NET POSITION ADJUSTMENT *
     C*                    @ABDBC -  BUY CCY DBCE ADJUSTMENT         *
     C*                    @ABDSB -  BUY CCY DSBCE ADJUSTMENT        *
     C*                    @ABOPL -  BUY CCY OPTION DEAL P/L         *
     C*                    @ABDPL -  BUY CCY DEAL P/L                *
     C*                    @ASNPA -  SELL CCY NET POSITION ADJUSTMENT*
     C*                    @ASDBC -  SELL CCY DBCE ADJUSTMENT        *
     C*                    @ASDSB -  SELL CCY DSBCE ADJUSTMENT       *
     C*                    @ASOPL -  SELL CCY OPTION DEAL P/L        *
     C*                    @ASDPL -  SELL CCY DEAL P/L               *
     C*                    @RNPA  -  NET POSN ADJ FOR SUBROUTINE     *
     C*                    @RDBC  -  DBCE ADJUSTMENT FOR SUBROUTINE  *
     C*                    @RDSB  -  DSBCE ADJUSTMENT FOR SUBROUTINE *
     C*                    @ROPL  -  OPTION DEAL P/L FOR SUBROUTINE  *
     C*                    @RDPL  -  DEAL P/L FOR SUBROUTINE         *
     C*                    @DEALB -  DBCE BEFORE UPDATE              *
     C*                    @SPOTB -  DSBCE BEFORE UPDATE             *
     C*                    @TBNPA -  TOTAL BUY CCY NET POSN ADJ      *
     C*                    @TBDBC -  TOTAL BUY CCY DBCE ADJUSTMENT   *
     C*                    @TBDSB -  TOTAL BUY CCY DSBCE ADJUSTMENT  *
     C*                    @TSNPA -  TOTAL SELL CCY NET POSN ADJ     *
     C*                    @TSDBC -  TOTAL SELL CCY DBCE ADJUSTMENT  *
     C*                    @TSDSB -  TOTAL SELL CCY DSBCE ADJUSTMENT *
     C*                    @BUYSL -  BUY OR SELL PROCESS INDICATOR   *
     C*                                                              *
     C*  CALLED BY :       #B   MAIN PROCESSING                      *
     C*                                                              *
     C*  CALLS :           #BEA #BEB #BEC #BED #BEE #BEF #BEG        *
     C*                    ZA0680 ZA0710                             *
     C*                                                              *
     C****************************************************************
     C           #BE       BEGSR
     C*
     C** GET ACTION DATE AND CONVERT TO 5N
     C                     MOVE F3VDYY    @D1YY
     C                     MOVE F3VDMM    @D1MM
     C                     MOVE F3VDDD    @D1DD
     C                     MOVE @DATE1    @ACTD
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'N'*************************1*************S01319
     C           EROVDI    ANDEQ'N'                        *1             S01319
     C                     MOVE F3DOEY    @D1YY            *1
     C                     MOVE F3DOEM    @D1MM            *1
     C                     MOVE F3DOED    @D1DD            *1
     C                     MOVE @DATE1    @ACTD            *1
     C                     END                             E1
     C                     MOVE @ACTD     @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @ACTD5           *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACTD5           *1
     C                     END                             E1
     C*
     C** CONVERT VALUE DATE TO 5N
     C                     MOVE @VDAT     @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @VDAT5           *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @VDAT5           *1
     C                     END                             E1
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'Y'*************************1*************S01319
     C           EROVDI    ANDEQ'Y'                        *1             S01319
     C***********RUND******IFGT @VDAT5                     B*2            S01194
     C*********************MOVE RUND      @ACTD5           **2            S01194
     C           BJRDNB    IFGT @VDAT5                     B*2            S01194
     C                     MOVE BJRDNB    @ACTD5           **2            S01194
     C                     ELSE                            X*2
     C                     MOVE @VDAT5    @ACTD5           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** GET ACTION DATE IN YYYYMMDD FORM
     C                     MOVE @ACTD5    @@DAYN
     C           @@DAYN    IFNE *ZEROS                     B1
     C                     EXSR ZA0710                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C** IF RETURN IS SET THEN DATABASE ERROR
     C           @@RTN     IFEQ 1                          B*2
     C**  Set up error output for screen.
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 026*
     C                     MOVEL'026'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@VDT     @ACTD            *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACTD            *1
     C                     END                             E1
     C*
     C** GET BEFORE ACTION DATE AND CONVERT TO 5N
     C                     MOVE F3BVDT    @ACTDB
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'N'*************************1*************S01319
     C           EROVDI    ANDEQ'N'                        *1             S01319
     C                     MOVE F3BOTD    @ACTDB           *1
     C                     END                             E1
     C                     MOVE @ACTDB    @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @ACDB5           *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACDB5           *1
     C                     END                             E1
     C*
     C** CONVERT VALUE DATE TO 5N
     C                     MOVE F3BVDT    @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @VDTB5           *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @VDTB5           *1
     C                     END                             E1
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'Y'*************************1*************S01319
     C           EROVDI    ANDEQ'Y'                        *1             S01319
     C***********RUND******IFGT @VDTB5                     B*2            S01194
     C*********************MOVE RUND      @ACDB5           **2            S01194
     C           BJRDNB    IFGT @VDTB5                     B*2            S01194
     C                     MOVE BJRDNB    @ACDB5           **2            S01194
     C                     ELSE                            X*2
     C                     MOVE @VDAT5    @ACDB5           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** GET BEFORE ACTION DATE IN YYYYMMDD FORM
     C                     MOVE @ACDB5    @@DAYN
     C           @@DAYN    IFNE *ZEROS                     B1
     C                     EXSR ZA0710                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C** IF RETURN IS SET THEN DATABASE ERROR
     C           @@RTN     IFEQ 1                          B*2
     C**  Set up error output for screen.
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 027*
     C                     MOVEL'027'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BE9                       **2
     C                     END                             E*2
     C                     MOVE @@VDT     @ACTDB           *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ACTDB           *1
     C                     END                             E1
     C*
     C** GET RELATED DEAL ACTION DATE AND CONVERT TO 5N
     C** ONLY IF DEAL IS A TAKEDOWN OR A SWAP
     C           F3DTYP    IFEQ 'T'                        B1
     C           F3DTYP    OREQ 'S'                        *1
     C                     MOVE F3RVDT    @ACTR            *1
     C           F3DTYP    IFEQ 'T'                        B*2
     C***********FWOVDI****ANDEQ'N'**************************2************S01319
     C           EROVDI    ANDEQ'N'                        **2            S01319
     C                     MOVE F3ROTD    @ACTR            **2
     C                     END                             E*2
     C                     MOVE @ACTR     @@DTIN           *1
     C           @@DTIN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0680                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BE9                       ***3
     C                     END                             E**3
     C                     MOVE @@MDNO    @ACTR5  50       **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @ACTR5           **2
     C                     END                             E*2
     C*
     C** CONVERT RELATED VALUE DATE TO 5N
     C                     MOVE F3RVDT    @@DTIN           *1
     C           @@DTIN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0680                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BE9                       ***3
     C                     END                             E**3
     C                     MOVE @@MDNO    @VDTR5           **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @VDTR5           **2
     C                     END                             E*2
     C           F3DTYP    IFEQ 'T'                        B*2
     C***********FWOVDI****ANDEQ'Y'**************************2************S01319
     C           EROVDI    ANDEQ'Y'                        **2            S01319
     C***********RUND******IFGT @VDTR5                     B**3           S01194
     C*********************MOVE RUND      @ACTR5           ***3           S01194
     C           BJRDNB    IFGT @VDTR5                     B**3           S01194
     C                     MOVE BJRDNB    @ACTR5           ***3           S01194
     C                     ELSE                            X**3
     C                     MOVE @VDTR5    @ACTR5           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** GET ACTION DATE IN YYYYMMDD FORM
     C                     MOVE @ACTR5    @@DAYN           *1
     C           @@DAYN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0710                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BE9                       ***3
     C                     END                             E**3
     C** IF RETURN IS SET THEN DATABASE ERROR
     C           @@RTN     IFEQ 1                          B**3
     C**  Set up error output for screen.
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 036*
     C                     MOVEL'036'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     GOTO #BE9                       ***3
     C                     END                             E**3
     C                     MOVE @@VDT     @ACTR            **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @ACTR            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** to stop program locking problem do the update twice              E12279
     C** once for buy and once for sell currency. The currency            E12279
     C** is sorted alphabatically and the lowest currency is done         E12279
     C** on the first DO.                                                 E12279
     C                     MOVE ' '       @BUYSL  1                       E12279
     C           @BUYC     IFLT @SELC                      B1             E12279
     C                     MOVE 'B'       @BUYSL           *1             E12279
     C                     ELSE                            X1             E12279
     C                     MOVE 'S'       @BUYSL           *1             E12279
     C                     END                             E1             E12279
     C*                                                                   E12279
     C                     DO   2                          B1             E12279
     C** IF DEAL TYPE INDICATOR NE T
     C           F3DTYP    IFNE 'T'                        B*2
     C*
     C** IF INSERT ADD IN EXPOSURES FOR THIS DEAL
     C           F3LACT    IFEQ 'I'                        B**3
     C** check buy/sell indicator before start of update                  E12279
     C           @BUYSL    IFEQ 'B'                        B***4          E12279
     C                     MOVE @BUYC     @RCCY            ****4
     C                     MOVE @BUYA     @RAMT            ****4
     C                     EXSR #BEB                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     ELSE                            X***4          E12279
     C                     MOVE @SELC     @RCCY            ****4
     C                     MOVE @SELA     @RAMT            ****4
     C                     EXSR #BEB                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4          E12279
     C                     END                             E**3
     C*
     C** IF DELETE REMOVE EXPOSURES FOR BEFORE DEAL
     C           F3LACT    IFEQ 'D'                        B**3
     C           @BUYSL    IFEQ 'B'                        B***4          E12279
     C                     MOVE F3BBCY    @RCCY            ****4
     C                     MOVE F3DBUY    @RAMT            ****4
     C                     EXSR #BEC                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     ELSE                            X***4          E12279
     C                     MOVE F3BSCY    @RCCY            ****4
     C                     MOVE F3DSEL    @RAMT            ****4
     C                     EXSR #BEC                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4          E12279
     C                     END                             E**3
     C*
     C** IF AMEND AND THINGS CHANGED
     C** REMOVE EXPOSURES FOR BEFORE DEAL
     C** ADD IN EXPOSURES FOR THIS DEAL
     C                     MOVE 'N'       @DOFLG           **2
     C           F3LACT    IFEQ 'A'                        B**3
     C           F3DAM1    IFNE @AMT1B                     B***4
     C           F3DAM2    ORNE @AMT2B                     ****4
     C                     MOVE 'Y'       @DOFLG           ****4
     C                     END                             E***4
     C***********@ACTD5****IFLT RUND                       B***4          S01194
     C***********@ACDB5****ANDGERUND                       ****4          S01194
     C           @ACTD5    IFLT BJRDNB                     B***4          S01194
     C           @ACDB5    ANDGEBJRDNB                     ****4          S01194
     C                     MOVE 'Y'       @DOFLG           ****4
     C                     END                             E***4
     C***********@ACTD5****IFGE RUND                       B***4          S01194
     C***********@ACDB5****ANDLTRUND                       ****4          S01194
     C           @ACTD5    IFGE BJRDNB                     B***4          S01194
     C           @ACDB5    ANDLTBJRDNB                     ****4          S01194
     C                     MOVE 'Y'       @DOFLG           ****4
     C                     END                             E***4
     C                     END                             E**3
     C           @DOFLG    IFEQ 'Y'                        B**3
     C           @BUYSL    IFEQ 'B'                        B***4          E12279
     C*
     C** PERFORM DELETE PROCESSING FOR BEFORE UPDATE FIELDS
     C                     MOVE F3BBCY    @RCCY            ****4
     C                     MOVE F3DBUY    @RAMT            ****4
     C                     EXSR #BEC                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     ELSE                            X***4          E12279
     C                     MOVE F3BSCY    @RCCY            ****4
     C                     MOVE F3DSEL    @RAMT            ****4
     C                     EXSR #BEC                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4          E12279
     C*
     C           @BUYSL    IFEQ 'B'                        B***4          E12279
     C** PERFORM INSERT PROCESSING FOR CURRENT FIELDS
     C                     MOVE @BUYC     @RCCY            ****4
     C                     MOVE @BUYA     @RAMT            ****4
     C                     EXSR #BEB                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     ELSE                            X***4          E12279
     C                     MOVE @SELC     @RCCY            ****4
     C                     MOVE @SELA     @RAMT            ****4
     C                     EXSR #BEB                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4          E12279
     C                     END                             E**3
     C*
     C** DELETING A SWAP DEAL
     C** REMOVE EXPOSURES FOR RELATED DEAL
     C           F3DTYP    IFEQ 'S'                        B**3
     C           F3LACT    ANDEQ'D'                        ***3
     C           @BUYSL    IFEQ 'S'                        B***4          E12279
     C                     MOVE F3RBCY    @RCCY            ****4
     C                     MOVE F3RBAT    @RAMT            ****4
     C                     EXSR #BED                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     ELSE                            X***4          E12279
     C                     MOVE F3RSCY    @RCCY            ****4
     C                     Z-SUBF3RSAT    @RAMT            ****4
     C                     EXSR #BED                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4          E12279
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF DEAL IS A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B*2
     C*
     C           @BUYSL    IFEQ 'B'                        B**3           E12279
     C** CALCULATE TAKEDOWN PROPORTION
     C           F3DAM1    DIV  F3OOFA    @TDOWN    H      ***3
     C*
     C** PROCESS CALCULATE ADJUSTMENTS FOR BUY CCY
     C                     MOVE @BUYC     @RCCY            ***3
     C                     MOVE @BUYA     @RAMT            ***3
     C                     MOVE @ACTD     @RACT            ***3
     C                     MOVE F3BCDE    @RDBCE 150       ***3
     C                     MOVE F3DSBE    @RDSBE 150       ***3
     C           @B12      IFEQ '1'                        B***4
     C                     MOVE F3OOFA    @RAMTO 150       ****4
     C                     ELSE                            X***4
     C                     MOVE F3OOSA    @RAMTO           ****4
     C                     END                             E***4
     C                     MOVE @B12      @R12             ***3
     C                     EXSR #BEA                       ***3
     C           *INU7     IFEQ '1'                        B***4
     C                     GOTO #BE9                       ****4
     C                     END                             E***4
     C*
     C** SAVE VALUES OF BUY CCY FIELDS
     C                     MOVE @NPA      @ABNPA 150       ***3
     C                     MOVE @DBCEA    @ABDBC 150       ***3
     C                     MOVE @DSBCA    @ABDSB 150       ***3
     C*
     C** PUT SAVE VALUES INTO SUBROUTINE FIELDS
     C                     MOVE @ABNPA    @RNPA  150       ***3
     C                     MOVE @ABDBC    @RDBC  150       ***3
     C                     MOVE @ABDSB    @RDSB  150       ***3
     C*
     C** IF INSERT UPDATE FXEPOULL FXR0050
     C           F3LACT    IFEQ 'I'                        B***4
     C                     EXSR #BEE                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4
     C*
     C** IF DELETE UPDATE FXEPOULL FXR0050 REVERSING ADDS & SUBS
     C           F3LACT    IFEQ 'D'                        B***4
     C                     EXSR #BEF                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     ELSE                            X**3           E12279
     C*
     C** PROCESS CALCULATE ADJUSTMENTS FOR SEL CCY
     C                     MOVE @SELC     @RCCY            ***3
     C                     MOVE @SELA     @RAMT            ***3
     C                     MOVE @ACTD     @RACT            ***3
     C                     MOVE F3BCDE    @RDBCE           ***3
     C                     MOVE F3DSBE    @RDSBE           ***3
     C           @S12      IFEQ '1'                        B***4
     C                     MOVE F3OOFA    @RAMTO           ****4
     C                     ELSE                            X***4
     C                     MOVE F3OOSA    @RAMTO           ****4
     C                     END                             E***4
     C                     MOVE @S12      @R12             ***3
     C                     EXSR #BEA                       ***3
     C           *INU7     IFEQ '1'                        B***4
     C                     GOTO #BE9                       ****4
     C                     END                             E***4
     C*
     C** SAVE VALUES OF SELL CCY FIELDS
     C                     MOVE @NPA      @ASNPA 150       ***3
     C                     MOVE @DBCEA    @ASDBC 150       ***3
     C                     MOVE @DSBCA    @ASDSB 150       ***3
     C*
     C** PUT SAVED FIELDS INTO SUBROUTINE FIELDS
     C                     MOVE @ASNPA    @RNPA  150       ***3
     C                     MOVE @ASDBC    @RDBC  150       ***3
     C                     MOVE @ASDSB    @RDSB  150       ***3
     C*
     C** IF INSERT UPDATE FXEPOULL FXR0050
     C           F3LACT    IFEQ 'I'                        B***4
     C                     EXSR #BEE                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4
     C*
     C** IF DELETE UPDATE FXEPOULL FXR0050 REVERSING ADDS & SUBS
     C           F3LACT    IFEQ 'D'                        B***4
     C                     EXSR #BEF                       ****4
     C           *INU7     IFEQ '1'                        B****5
     C                     GOTO #BE9                       *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3           E12279
     C*
     C** IF AMEND AND THINGS CHANGED
     C           F3LACT    IFEQ 'A'                        B**3
     C           F3DAM1    IFNE @AMT1B                     B***4
     C           F3DAM2    ORNE @AMT2B                     ****4
     C           @VDAT     ORNE F3BVDT                     ****4
     C*
     C** CALCULATE ORIGINAL TAKEDOWN PROPORTION
     C           @AMT1B    DIV  F3OOFA    @TDOWN    H      ****4
     C*
     C           @BUYSL    IFEQ 'B'                        B****5         E12279
     C** PROCESS CALCULATE ADJUSTMENTS FOR BUY CCY
     C                     MOVE F3BBCY    @RCCY            *****5
     C                     MOVE F3DBUY    @RAMT            *****5
     C                     MOVE @ACTDB    @RACT            *****5
     C                     MOVE @DEALB    @RDBCE           *****5
     C                     MOVE @SPOTB    @RDSBE           *****5
     C           @B12      IFEQ '1'                        B*****6
     C                     MOVE F3OOFA    @RAMTO           ******6
     C                     ELSE                            X*****6
     C                     MOVE F3OOSA    @RAMTO           ******6
     C                     END                             E*****6
     C                     MOVE @B12      @R12             *****5
     C                     EXSR #BEA                       *****5
     C           *INU7     IFEQ '1'                        B*****6
     C                     GOTO #BE9                       ******6
     C                     END                             E*****6
      *
      ** EXTRA PROCESSING FOR DEAL BCE - IGNORE ANYTHING FROM LAST
      ** CALL TO #BEA
      * MUST REMOVE ORIGINAL DBCE FROM FOTDPE B'COS OF RATE CHGS
      * @DEALB MAY NOT BE OLD DEAL BCE AMOUNT FOR TAKEDOWN
      * CALC RATE FOR OLD DBCE
     C           F3BCDE    DIV  F3DAM2    @ORATE 138       *****5
     C           @ORATE    MULT @AMT2B    @DBCEA    H      *****5
      *
     C*
     C** SUBTRACT BUY - THESE ADJUSTMENTS
     C           @ABNPA    SUB  @NPA      @TBNPA 150       *****5
     C           @ABDBC    SUB  @DBCEA    @TBDBC 150       *****5
     C           @ABDSB    SUB  @DSBCA    @TBDSB 150       *****5
     C*
     C** UPDATE FXEPOULL FXR0050
     C                     MOVE @TBNPA    @RNPA  150       *****5
     C                     MOVE @TBDBC    @RDBC  150       *****5
     C                     MOVE @TBDSB    @RDSB  150       *****5
     C                     EXSR #BEG                       *****5
     C           *INU7     IFEQ '1'                        B*****6
     C                     GOTO #BE9                       ******6
     C                     END                             E*****6
     C                     ELSE                            X****5         E12279
     C*
     C** PROCESS CALCULATE ADJUSTMENTS FOR SELL CCY
     C                     MOVE F3BSCY    @RCCY            *****5
     C                     MOVE F3DSEL    @RAMT            *****5
     C                     MOVE @ACTDB    @RACT            *****5
     C                     MOVE @DEALB    @RDBCE           *****5
     C                     MOVE @SPOTB    @RDSBE           *****5
     C           @S12      IFEQ '1'                        B*****6
     C                     MOVE F3OOFA    @RAMTO           ******6
     C                     ELSE                            X*****6
     C                     MOVE F3OOSA    @RAMTO           ******6
     C                     END                             E*****6
     C                     MOVE @S12      @R12             *****5
     C                     EXSR #BEA                       *****5
     C           *INU7     IFEQ '1'                        B*****6
     C                     GOTO #BE9                       ******6
     C                     END                             E*****6
      ** EXTRA PROCESSING FOR DEAL BCE - IGNORE ANYTHING FROM LAST
      ** CALL TO #BEA
      * MUST REMOVE ORIGINAL DBCE FROM FOTDPE B'COS OF RATE CHGS
      * @DEALB MAY NOT BE OLD DEAL BCE AMOUNT FOR TAKEDOWN
      * CALC RATE FOR OLD DBCE
     C           F3BCDE    DIV  F3DAM1    @ORATE 138       *****5
     C           @ORATE    MULT @AMT1B    @DBCEA    H      *****5
      *
     C*
     C** SUBTRACT SELL- THESE ADJUSTMENTS
     C           @ASNPA    SUB  @NPA      @TSNPA 150       *****5
     C           @DBCEA    SUB  @ASDBC    @TSDBC 150       *****5
     C           @ASDSB    SUB  @DSBCA    @TSDSB 150       *****5
     C*
     C** UPDATE FXEPOULL FXR0050
     C                     MOVE @TSNPA    @RNPA  150       *****5
     C                     MOVE @TSDBC    @RDBC  150       *****5
     C                     MOVE @TSDSB    @RDSB  150       *****5
     C                     EXSR #BEG                       *****5
     C           *INU7     IFEQ '1'                        B*****6
     C                     GOTO #BE9                       ******6
     C                     END                             E*****6
     C                     END                             E****5         E12279
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C** change buy/sell indicator for second round of update             E12279
     C           @BUYSL    IFEQ 'B'                        B*2            E12279
     C                     MOVE 'S'       @BUYSL           **2            E12279
     C                     ELSE                            X*2            E12279
     C                     MOVE 'B'       @BUYSL           **2            E12279
     C                     END                             E*2            E12279
     C                     END                             E1             E12279
     C*                                                                   S01277
     C** CROSS CURRENCIES POSITION UPDATE PROCESSING                      S01277
     C*                                                                   S01277
     C** If first currency of deal is not base currency for               S01277
     C** dealing check cross currency file to see whether                 S01277
     C** a position is being kept for this currency combination.          S01277
     C*                                                                   S01277
     C***********F3CCY1****IFNE*IDCYDL*********************B1*******S01277S01319
     C           F3CCY1    IFNE BNCYDL                     B1             S01319
     C***********F3LACT    ANDEQ'X'                                E39319 082738
     C           F3LACT    ANDNE'X'                                       082738
     C*                                                                   S01277
     C                     MOVE F3CCY1    @CPCCY                          S01277
     C                     MOVE F3CCY2    @CSCCY                          S01277
     C*                                                                   S01277
     C           @CCKEY    CHAINFXCRSCLL             67                   S01277
     C*                                                                   S01277
     C** If record found then a position is being kept                    S01277
     C** which needs updating for this deal.                              S01277
     C*                                                                   S01277
     C           *IN67     IFEQ '0'                        B*2            S01277
     C*                                                                   S01277
     C                     MOVE F3CCY2    @RCCY                           S01277
     C                     MOVE F3CCY2    @EECCY                          S01277
     C                     MOVE F3CCY1    @EPCCY                          S01277
     C                     Z-ADDF3DAM2    @CCAMT 150                      S01277
     C                     Z-ADDF3DAM1    @CCEQV 150                      S01277
     C                     Z-ADDF3DSEL    @CCOAM 150                      S01277
     C                     Z-ADDF3DBUY    @CCOEQ 150                      S01277
     C*                                                                   S01277
     C                     EXSR #BEH                                      S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** If second currency of deal is not base currency for              S01277
     C** dealing check cross currency file to see whether                 S01277
     C** a position is being kept for this currency combination.          S01277
     C*                                                                   S01277
     C***********F3CCY2****IFNE*IDCYDL*********************B1*******S01277S01319
     C           F3CCY2    IFNE BNCYDL                     B1             S01319
     C***********F3LACT    ANDEQ'X'                                E39319 082738
     C           F3LACT    ANDNE'X'                                       082738
     C*                                                                   S01277
     C                     MOVE F3CCY2    @CPCCY                          S01277
     C                     MOVE F3CCY1    @CSCCY                          S01277
     C*                                                                   S01277
     C           @CCKEY    CHAINFXCRSCLL             67                   S01277
     C*                                                                   S01277
     C** If record found then a position is being kept                    S01277
     C** which needs updating for this deal.                              S01277
     C*                                                                   S01277
     C           *IN67     IFEQ '0'                        B*2            S01277
     C*                                                                   S01277
     C                     MOVE F3CCY1    @RCCY                           S01277
     C                     MOVE F3CCY1    @EECCY                          S01277
     C                     MOVE F3CCY2    @EPCCY                          S01277
     C                     Z-ADDF3DAM1    @CCAMT 150                      S01277
     C                     Z-ADDF3DAM2    @CCEQV 150                      S01277
     C                     Z-ADDF3DBUY    @CCOAM 150                      S01277
     C                     Z-ADDF3DSEL    @CCOEQ 150                      S01277
     C*                                                                   S01277
     C                     EXSR #BEH                                      S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           #BE9      ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEA  CALCULATE ADJUSTMENTS                     *
     C*                                                              *
     C*  FIELDS USED :     @NPA   -  NET POSITION ADJUSTMENT         *
     C*                    @DBCEA -  DBCE ADJUSTMENT                 *
     C*                    @DSBCA -  DSBCE ADJUSTMENT                *
     C*                    @RDBCE -  BCDE                            *
     C*                    @RDSBE -  DSBE                            *
     C*                    @RAMTO -  OPTION ORIGINAL AMT             *
     C*                    @RAMT  -  DEAL AMOUNT                     *
     C*                    @RDELB -  RELATED DEAL BCE                *
     C*                    @RDSPB -  RELATED DEAL DSBE               *
     C*                    @WORK1 -  WORK FIELD                      *
     C*                    @ACTR  -  RELATED DEAL ACTION DATE        *
     C*                    @RCCY  -  CURRENCY                        *
     C*                    @RDELB -  RELATED DEAL BCE                *
     C*********************@@VDT  -  INPUT DATE FOR ZA0620           *    S01194
     C*********************@@CCY  -  INPUT CCY FOR ZA0620            *    S01194
     C*********************@@AMT  -  INPUT AMOUNT FOR ZA0620         *    S01194
     C*********************@@DBCE -  INPUT DBCE FOR ZA0620           *    S01194
     C*********************@@BYSL -  INPUT FLAG FOR ZA0620           *    S01194
     C*********************@@K1***-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@K20**-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@KDCY*-**KEY*FOR*FDCCYTLL*****************    S01194
     C*********************@@RPL  -  P/L FROM ZA0620                 *
     C*                    @OPTPL -  OPTION DEAL P/L                 *
     C*                    @DELPL -  DEAL P/L                        *
     C*                    @RACT  -  ACTION DATE                     *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C***CALLS*:***********ZA0620*************************************    S01194
     C*                                                              *
     C****************************************************************
     C           #BEA      BEGSR
     C*
     C** IF CURRENCY IS DEAL 1ST CURRENCY
     C           @R12      IFEQ '1'                        B1
     C********** F3DTYP    ANDNE'T'                        *1             E13249
     C           F3LACT    ANDNE'A'                        *1             E13249
     C                     Z-ADD0         @NPA   150       *1
     C                     Z-ADD0         @DBCEA 150       *1
     C                     Z-ADD0         @DSBCA 150       *1
     C*
     C** IF CURRENCY IS DEAL 2ND CURRENCY
     C                     ELSE                            X1
     C*
     C** NET POSITION ADJUSTMENT
     C** IF THIS IS A TAKEDOWN DON'T WANT TO ADD IN THIS AGAIN
     C** BECAUSE THIS IS A TOTAL - ALREADY IN
     C********** F3DTYP    IFNE 'T'                        B*2            E13249
     C           F3LACT    IFNE 'A'                        B*2            E13249
     C           @TDOWN    MULT F3OOSA    @WORK1 150H      **2
     C           @RAMT     SUB  @WORK1    @NPA             **2
     C                     ELSE                            X*2
     C                     Z-ADD0         @NPA             **2
     C                     END                             E*2
     C*
     C** DEALT BASE CCY EQUIV
      *
      **  SPECIAL PROCESSING FOR AMEND OF OPTION TAKEDOWNS
      **  TO CATER FOR ANY RATE CHANGES
     C           F3LACT    IFEQ 'A'                        B*2
     C           F3DTYP    ANDEQ'T'                        **2
      *   CALC. AMOUNT OF OLD DBCE REMOVED BY AMEND
     C           1         SUB  @TDOWN    @WTDWN 138       **2
     C           @WTDWN    MULT @RDELB    @WORK1    H      **2
      *   ADD IN NEW DBCE
     C           @RDBCE    ADD  @WORK1    @DBCEA           **2
      *
     C                     ELSE                            X*2
     C           @TDOWN    MULT @RDELB    @WORK1    H      **2
     C           @RDBCE    SUB  @WORK1    @DBCEA           **2
     C                     END                             E*2
     C*
     C** DEALT SPOT BASE CCY EQUIV
     C           @TDOWN    MULT @RDSPB    @WORK1    H      *1
     C           @RDSBE    SUB  @WORK1    @DSBCA           *1
     C*
     C                     END                             E1
     C*
     C           #BEA9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEB  UPDATE FXEPOULL FXR0017                   *
     C*                    ADD IN EXPOSURES FOR THIS DEAL            *
     C*                    CURRENT AMOUNTS AND NOT REVERSING SIGNS   *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @ACTD5 -  ACTION DATE                     *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTD  -  ACTION DATE(CHAR)               *
     C*********************@@VDT  -  INPUT DATE FOR ZA0620           *    S01194
     C*                    @@CCY  -  INPUT CCY FOR ZA0620            *
     C*********************@@AMT  -  INPUT AMOUNT FOR ZA0620         *    S01194
     C*********************@@DBCE -  INPUT DBCE FOR ZA0620           *    S01194
     C*********************@@BYSL -  INPUT FLAG FOR ZA0620           *    S01194
     C*********************@@K1***-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@K20**-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@KDCY*-**KEY*FOR*FDCCYTLL*****************    S01194
     C*********************@@RPL  -  P/L FROM ZA0620                 *    S01194
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C***CALLS*:***********#ZD*ZA0620*********************************    S01194
     C*  CALLS :           #ZD                                       *    S01194
     C*                                                              *
     C****************************************************************
     C           #BEB      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C*
     C** CREATE A ZERO RECORD FOR FXEPOSP0
     C                     EXSR #ZD                        *1
     C                     END                             E1
     C                     MOVE @RCCY     FOCCY
     C*
     C** IF ACTION DATE LT RUN DATE
     C***********@ACTD5****IFLT RUND                       B1             S01194
     C           @ACTD5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    ADD  @RAMT     FONNCP           *1
     C*
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    ADD  F3BCDE    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    SUB  F3BCDE    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           FOTNTP    ADD  @RAMT     FOTNTP
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOTDPE    ADD  F3BCDE    FOTDPE           *1
     C                     ELSE                            X1
     C           FOTDPE    SUB  F3BCDE    FOTDPE           *1
     C                     END                             E1
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOBDSE    ADD  F3DSBE    FOBDSE           *1
     C                     ELSE                            X1
     C           FOBDSE    SUB  F3DSBE    FOBDSE           *1
     C                     END                             E1
     C*********************MOVE '1'       @@K1                            S01194
     C*********************MOVE '20'      @@K20                           S01194
     C                     MOVE @RCCY     @@CCY                           S01194
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C*
     C           *IN66     IFEQ '1'                        B1
     C                     WRITEFXEPOSP0                   *1
     C                     ELSE                            X1
     C                     MOVE @RUND     FODLUP           *1
     C                     MOVE @RUNM     FOMLUP           *1
     C                     MOVE @RUNY     FOYLUP           *1
     C                     TIME           FOTLUP           *1
     C                     MOVE 'A'       FOCHTP           *1
     C*********************MOVE RUND      FOLCD            *1             S01194
     C                     MOVE BJRDNB    FOLCD            *1             S01194
     C                     MOVEL@USER     FOLUID           *1
     C                     UPDATFXEPOSP0                   *1
     C                     END                             E1
     C           #BEB9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEC  UPDATE FXEPOULL FXR0017                   *
     C*                    REMOVE EXPOSURES FOR BEFORE DEAL          *
     C*                    BEFORE AMOUNTS AND REVERSING ADDS AND     *
     C*                    SUBTRACTIONS                              *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @ACDB5 -  ACTION DATE BEFORE UPDATE       *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTDB -  ACTION DATE BEFORE UPDATE(CHAR) *
     C*                    @DEALB -  DBCE BEFORE UPDATE              *
     C*                    @SPOTB -  DSBCE BEFORE UPDATE             *
     C*********************@@VDT  -  INPUT DATE FOR ZA0620           *    S01194
     C*********************@@CCY  -  INPUT CCY FOR ZA0620            *    S01194
     C*********************@@AMT  -  INPUT AMOUNT FOR ZA0620         *    S01194
     C*********************@@DBCE -  INPUT DBCE FOR ZA0620           *    S01194
     C*********************@@BYSL -  INPUT FLAG FOR ZA0620           *    S01194
     C*********************@@K1***-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@K20**-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@KDCY*-**KEY*FOR*FDCCYTLL*****************    S01194
     C*********************@@RPL  -  P/L FROM ZA0620                 *    S01194
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C***CALLS*:***********ZA0620*************************************    S01194
     C*                                                              *
     C****************************************************************
     C           #BEC      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C**  Set up error output for screen.
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     MOVEL'FXEPOULL'DBFILE           * DB ERROR 030*
     C                     MOVEL'030'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #BEC9                      *1
     C                     END                             E1
     C                     MOVE @RCCY     FOCCY
     C*
     C** IF ACTION DATE LT RUN DATE
     C***********@ACDB5****IFLT RUND                       B1             S01194
     C           @ACDB5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    SUB  @RAMT     FONNCP           *1
     C*
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    SUB  @DEALB    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    ADD  @DEALB    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           FOTNTP    SUB  @RAMT     FOTNTP
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOTDPE    SUB  @DEALB    FOTDPE           *1
     C                     ELSE                            X1
     C           FOTDPE    ADD  @DEALB    FOTDPE           *1
     C                     END                             E1
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOBDSE    SUB  @SPOTB    FOBDSE           *1
     C                     ELSE                            X1
     C           FOBDSE    ADD  @SPOTB    FOBDSE           *1
     C                     END                             E1
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C                     MOVE @RUND     FODLUP
     C                     MOVE @RUNM     FOMLUP
     C                     MOVE @RUNY     FOYLUP
     C                     TIME           FOTLUP
     C                     MOVE 'A'       FOCHTP
     C*********************MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVEL@USER     FOLUID
     C                     UPDATFXEPOSP0
     C           #BEC9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BAC  FXR0009  UPDATE DEALS FILE SCHEDULE       *
     C*                                                              *
     C*  FIELDS USED :     @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                    @DATE1 -  DATA STRUCTURE DATE             *
     C*                                                              *
     C*  CALLED BY :       #BA UPDATE DEALS FILE                     *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #BAC      BEGSR
     C*
     C** UPDATE RECORD ID ETC.
     C                     MOVE 'FH'      FHRCID
     C                     MOVE *BLANKS   FHDLTF
     C                     MOVE @RUND     FHDLUP
     C                     MOVE @RUNM     FHMLUP
     C                     MOVE @RUNY     FHYLUP
     C**********           TIME           FHTLUP                         E12279a
     C                     TIME           @RUNT                          E12279a
     C                     MOVE @RUNT     FHTLUP                         E12279a
     C           F3LACT    IFEQ 'I'                        B1
     C                     MOVE 'I'       FHCHTP           *1
     C                     ELSE                            X1
     C           F3LACT    IFEQ 'A'                                       DT0074
     C                     MOVE 'A'       FHCHTP           *1
     C                     ELSE                            X1             DT0074
     C           F3LACT    IFEQ 'X'                                       041754
     C                     MOVE 'X'       FHCHTP           *1             041754
     C                     ELSE                            X1             041754
     C                     MOVE 'D'       FHCHTP           *1             DT0074
     C                     END                             E1             041754
     C                     END                             E1             DT0074
     C                     END                             E1
     C*********************MOVE RUND      FHLCD                           S01194
     C                     MOVE BJRDNB    FHLCD                           S01194
     C                     MOVEL@USER     FHLUID
     C*
     C** UPDATE DEALS FILE AS PER FXR0009
     C                     MOVE F3DN38    FHDN38
     C*
     C** VALUE DATE
     C                     MOVE F3VDYY    FHVDYY
     C                     MOVE F3VDMM    FHVDMM
     C                     MOVE F3VDDD    FHVDDD
     C*
     C** TRANSACTION DATE
     C                     MOVE F3DTYY    FHDTYY
     C                     MOVE F3DTMM    FHDTMM
     C                     MOVE F3DTDD    FHDTDD
     C*
     C** DEAL OPTION END DATE
     C                     MOVE F3DOEY    FHDOEY
     C                     MOVE F3DOEM    FHDOEM
     C                     MOVE F3DOED    FHDOED
     C*
     C                     MOVE F3DADN    FHDADN
     C*
     C** Book Code                                                        E16211
     C                     MOVE F3BOKC    FHBOKC                          E16211
     C** Linked Ref NO                                                    E16211
     C                     MOVE F3LNKN    FHLNKN                          E16211
     C*                                                                   E16211
     C** Portfolio Reference                                              S01486
     C                     MOVE F3PTFR    FHPTFR                          S01486
     C*                                                                   S01486
     C** MULTIBRANCHING FIELDS                                            S01117
     C                     MOVE F3ORBR    FHORBR                          S01117
     C                     MOVE F3PRFC    FHPRFC                          S01117
     C                     MOVE F3ROBR    FHROBR                          S01117
     C                     MOVE F3POBR    FHPOBR                          S01117
     C*                                                                   S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP5                                           S01408
     C*                                                                   S01408
     C** DEAL DELETED
     C           F3LACT    IFEQ 'D'                        B1
     C                     MOVE 'D'       FHDDLT           *1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   FHDDLT           *1
     C                     END                             E1
     C*
     C                     MOVE F3DSTS    FHDSTS
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP4                                           S01408
     C*                                                                   S01408
     C                     MOVE F3DTYP    FHDTYP
     C                     MOVE F3DCSN    FHDCSN
     C                     MOVE F3CNUM    FHDCNO
     C                     MOVE F3DXRT    FHDXRT
     C                     MOVE F3DAM1    FHDAM1
     C                     MOVE F3CCY1    FHCCY1
     C                     MOVE F3CCY2    FHCCY2
     C                     MOVE F3DAM2    FHDAM2
     C                     MOVE F3DMD1    FHDMD1
     C*
     C** DEAL BUY AND SELL AMOUNTS
     C           F3DAM1    IFGE 0                          B1
     C                     MOVE F3DAM1    FHDBUY           *1
     C                     Z-SUBF3DAM2    FHDSEL           *1
     C                     ELSE                            X1
     C                     Z-SUBF3DAM1    FHDSEL           *1
     C                     MOVE F3DAM2    FHDBUY           *1
     C                     END                             E1
     C                     MOVE F3BCAE    FHBCAE
     C                     MOVE F3BCDE    FHBCDE
     C                     MOVE F3DSBE    FHDSBE
     C                     MOVE F3AOFR    FHAOFR
     C*                                                                   S01453
     C** Update Margin details                                            S01453
     C*                                                                   S01453
     C                     MOVE F3MGPT    FHMGPT                          S01453
     C                     MOVE F3MGAM    FHMGAM                          S01453
     C                     MOVE F3MGCY    FHMGCY                          S01453
     C                     MOVE F3MGBS    FHMGBS                          S01453
     C                     MOVE F3OSRT    FHOSRT                          S01453
     C                     MOVE F3BFPA    FHBFPA                          S01453
     C                     MOVE F3SFPA    FHSFPA                          S01453
     C                     MOVE F3BDBS    FHBDBS                          S01453
     C                     MOVE F3SDBS    FHSDBS                          S01453
     C                     MOVE F3SDBE    FHSDBE                          S01453
     C                     MOVE F3BDBF    FHBDBF                          S01453
     C                     MOVE F3SDBF    FHSDBF                          S01453
     C                     MOVE F3BDFA    FHBDFA                          S01453
     C                     MOVE F3SDFA    FHSDFA                          S01453
     C*                                                                   S01453
      *  Deal User Code is only set for inserts.
     C           F3LACT    IFEQ 'I'                        B1
     C                     MOVE F3DUSC    FHDUSC           *1
     C                     ELSE                            X1
     C                     MOVE FHDUSC    F3DUSC           *1
     C                     END                             E1
      *
     C                     MOVE F3DBRC    FHDBRC
     C*********************MOVE F3MBRC    FHMBRC                          S01117
     C                     MOVE F3MBCA    FHMBCA                          S01117
     C*
     C** MOVE DEAL DONE DATE TO DATA STRUCTURE DATE1
     C                     MOVE F3DDDT    @DATE1
     C                     MOVE @D1DD     FHDDDD
     C                     MOVE @D1MM     FHDDMM
     C                     MOVE @D1YY     FHDDYY
     C*
     C                     MOVE F3FWPZ    FHFWPP
     C                     MOVE F3ORCM    FHORCM
     C                     MOVE F3DORM    FHDORM
     C                     MOVE F3MORI    FHMORI
     C                     MOVE F3DORI    FHDORI
     C*
     C** DEAL MIDAS OUR PAYMENT METHOD
     C                     MOVE F3DMPM    FHMOPM
     C                     MOVE F3DOPM    FHDOPM
     C                     MOVE F3MOPI    FHMOPI
     C                     MOVE F3DOPI    FHDOPI
     C                     MOVE F3TYPE    FHTYPE
     C                     MOVE F3STYP    FHSTYP
     C*
     C** DEAL BROKER CODE
     C                     MOVE F3BROK    FHBROK
     C*
     C** Deal brokerage                                                   E13902
     C**********           MOVE F3BRKG    FHBRKG                          E13902
     C********** F3BRKG    IFGT 999999999                  B1             E13902
     C           F3BRKG    IFEQ *ALL'9'                    B1             E13902
     C                     MOVE *ALL'9'   FHBRKG           *1
     C                     ELSE                            x1             E13902
     C                     MOVE F3BRKG    FHBRKG           *1             E13902
     C                     END                             E1
     C                     MOVE F3DCPI    FHDCPI
     C                     MOVE F3MCPI    FHMCPI
     C                     MOVE F3DCRI    FHDCRI
     C*
     C** DEAL MIDAS CUSTOMERS RECEIVED INSTRUCTIONS
     C                     MOVE F3MCRI    FHMCRI
     C                     MOVE F3DFAC    FHDFAC
     C                     MOVE F3MFAC    FHMFAO
     C                     MOVE F3SPEC    FHSPEC
     C                     MOVE F3LACT    FHLACT
     C                     MOVE F3ETIM    FHETIM
     C*
     C** Extended settlement instuctions                                  S01177
     C                     MOVE F3RSTM    FHRSTM                          S01177
     C                     MOVE F3RONS    FHRONS                          S01177
     C                     MOVE F3RIBN    FHRIBN                          S01177
     C                     MOVE F3RIBA    FHRIBA                          S01177
     C                     MOVE F3ROBN    FHROBN                          S01177
     C                     MOVE F3ROCN    FHROCN                          S01177
     C                     MOVE F3PSTM    FHPSTM                          S01177
     C                     MOVE F3PONS    FHPONS                          S01177
     C                     MOVE F3PIBN    FHPIBN                          S01177
     C                     MOVE F3PIBA    FHPIBA                          S01177
     C                     MOVE F3POBN    FHPOBN                          S01177
     C                     MOVE F3POCN    FHPOCN                          S01177
     C                     MOVE F3RCRN    FHRCRN                          S01177
     C                     MOVE F3RCRA    FHRCRA                          S01177
     C                     MOVE F3RVNO    FHRVNO                          S01177
     C                     MOVE F3AWBN    FHAWBN                          S01177
     C                     MOVE F3AWBA    FHAWBA                          S01177
     C                     MOVE F3BENN    FHBENN                          S01177
     C                     MOVE F3BENA    FHBENA                          S01177
     C                     MOVE F3DTP1    FHDTP1                          S01177
     C                     MOVE F3DTP2    FHDTP2                          S01177
     C                     MOVE F3DTP3    FHDTP3                          S01177
     C                     MOVE F3DTP4    FHDTP4                          S01177
     C                     MOVE F3DCHG    FHDCHG                          S01177
     C                     MOVE F3BTB1    FHBTB1                          S01177
     C                     MOVE F3BTB2    FHBTB2                          S01177
     C                     MOVE F3BTB3    FHBTB3                          S01177
     C                     MOVE F3BTB4    FHBTB4                          S01177
     C                     MOVE F3BTB5    FHBTB5                          S01177
     C                     MOVE F3BTB6    FHBTB6                          S01177
     C                     MOVE F3CVMR    FHCVMR                          E22405
     C*                                                                   S01177
     C** OPTION ORIGINAL AMOUNTS
     C                     MOVE F3OOFA    FHOOFA
     C                     MOVE F3OOSA    FHOOSA
     C                     MOVE F3BKCY    FHBKCY
     C                     MOVE F3PCDN    FHPCDN
     C                     MOVE F3PCTN    FHPCTN
     C                     MOVE F3FEDF    FHFEDF
     C*
     C** DEAL ACTION DATE
     C           F3DTYP    IFEQ 'O'                        B1
     C***********FWOVDI****ANDEQ'N'*************************1*************S01319
     C           EROVDI    ANDEQ'N'                        *1             S01319
     C                     MOVE F3DOEY    @D1YY            *1
     C                     MOVE F3DOEM    @D1MM            *1
     C                     MOVE F3DOED    @D1DD            *1
     C                     MOVE DATE1     FHADAT           *1
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP2                                           S01408
     C*                                                                   S01408
     C                     ELSE                            X1
     C                     MOVE F3VDYY    @D1YY            *1
     C                     MOVE F3VDMM    @D1MM            *1
     C                     MOVE F3VDDD    @D1DD            *1
     C                     MOVE DATE1     FHADAT           *1
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP3                                           S01408
     C*                                                                   S01408
     C                     END                             E1
     C*                                                                   CEU003
     C** Check if the BUY currency is an "In currency".                   156672
     C*                                                                   156672
     C                     CALL 'AOCURRR0'                                156672
     C                     PARM '*MSG   ' @RTCD                           156672
     C                     PARM '*KEY   ' @OPTN                           156672
     C                     PARM FHCCY1    @AJCD   3                       156672
     C           SDCURR    PARM SDCURR    DSSDY                           156672
     C*                                                                   156672
     C           @RTCD     IFNE *BLANK                     B1             156672
     C                     SETON                     U7U8  *1             156672
     C                     MOVEL'SDCURRPD'DBFILE           ***************156672
     C                     MOVEL'700'     DBASE            * DBERROR 700 *156672
     C                     MOVELFHCCY1    DBKEY            ***************156672
     C                     EXSR *PSSR                      *1             156672
     C                     GOTO #BAC9                      *1             156672
     C                     END                             E1             156672
     C           A6INCY    IFNE 'Y'                                       156672
     C           FHCCY1    ANDNEBKEURO                                    182794
     C                     MOVE *BLANKS   FHRSCY                          156672
     C                     ELSE                                           156672
     C                     MOVE F3RVCY    FHRSCY                          CEU003
     C                     END                                            156672
     C*                                                                   156672
     C** Check if the SELL currency is an "In currency".                  156672
     C*                                                                   156672
     C                     CALL 'AOCURRR0'                                156672
     C                     PARM '*MSG   ' @RTCD                           156672
     C                     PARM '*KEY   ' @OPTN                           156672
     C                     PARM FHCCY2    @AJCD   3                       156672
     C           SDCURR    PARM SDCURR    DSSDY                           156672
     C*                                                                   156672
     C           @RTCD     IFNE *BLANK                     B1             156672
     C                     SETON                     U7U8  *1             156672
     C                     MOVEL'SDCURRPD'DBFILE           ***************156672
     C                     MOVEL'701'     DBASE            * DBERROR 701 *156672
     C                     MOVELFHCCY2    DBKEY            ***************156672
     C                     EXSR *PSSR                      *1             156672
     C                     GOTO #BAC9                      *1             156672
     C                     END                             E1             156672
     C           A6INCY    IFNE 'Y'                                       156672
     C           FHCCY2    ANDNEBKEURO                                    182794
     C                     MOVE *BLANKS   FHPSCY                          156672
     C                     ELSE                                           156672
     C                     MOVE F3PSCY    FHPSCY                          CEU003
     C                     END                                            156672
     C                     MOVE F3IC72    FHIC72                          CEU003
     C*                                                                   CEU003
      *                                                                   CDL002
      ** FX Netting Fields                                                CDL002
     C                     MOVE F3NBUY    FHNBUY                          CDL002
     C                     MOVE F3NBRF    FHNBRF                          CDL002
     C                     MOVE F3NSEL    FHNSEL                          CDL002
     C                     MOVE F3NSRF    FHNSRF                          CDL002
     C                     MOVE F3MTCH    FHMTCH                          CDL002
      *                                                                   CDL008
      ** Deal transaction, Option and Value dates (5N)                    184828
     C                     MOVE F3DDDN    FHDDDN                          184828
     C                     MOVE F3OTDN    FHOTDN                          184828
     C                     MOVE F3VDDN    FHVDDN                          184828
      *                                                                   184828
     C           CDL008    IFEQ 'Y'                                       CDL008
     C                     MOVE F3CLSS    FHCLSS                          CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL002
     C           *IN60     IFEQ '0'                        B1
     C                     UPDATFXDEALP0                   *1
     C                     ELSE                            X1
     C                     MOVEASTAMP,1   FHTMST           Default Timestamp                  CPK015
     C                     WRITEFXDEALP0                   *1
     C                     END                             E1
     C*                                                                   082738
     C/COPY WNCPYSRC,FX0320C003
     C** Update parameter for new enquiry update program AOOUFXU0         082738
     C** with the deal details exactly as they are updated on FXDEALPP    082738
     C                     MOVEL@FXDL     Z#ASTS                          082738
     C*                                                                   082738
     C           #BAC9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BED  UPDATE FXEPOULL FXR0017                   *
     C*                    REMOVE EXPOSURES FOR RELATED DEAL         *
     C*                    RELATED DEAL BEFORE AMOUNTS AND REVERSING *
     C*                    ADDS AND SUBTRACTS                        *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @ACTR5 -  ACTION DATE RELATED DEAL        *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTR  -  ACTION DATE RELATED DEAL(CHAR)  *
     C*                    @RDELB -  DBCE RELATED DEALE              *
     C*                    @RDSPB -  DSBCE RELATED DEAL              *
     C*********************@@VDT  -  INPUT DATE FOR ZA0620           *    S01194
     C*********************@@CCY  -  INPUT CCY FOR ZA0620            *    S01194
     C*********************@@AMT  -  INPUT AMOUNT FOR ZA0620         *    S01194
     C*********************@@DBCE -  INPUT DBCE FOR ZA0620           *    S01194
     C*********************@@BYSL -  INPUT FLAG FOR ZA0620           *    S01194
     C*********************@@K1***-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@K20**-**KEY*FIELD*FOR*FDCCYTLL***********    S01194
     C*********************@@KDCY*-**KEY*FOR*FDCCYTLL*****************    S01194
     C*********************@@RPL  -  P/L FROM ZA0620                 *    S01194
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C***CALLS*:***********ZA0620*************************************    S01194
     C*                                                              *
     C****************************************************************
     C           #BED      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C**  Set up error output for screen.
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     MOVEL'FXEPOULL'DBFILE           * DB ERROR 032*
     C                     MOVEL'032'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #BED9                      *1
     C                     END                             E1
     C                     MOVE @RCCY     FOCCY
     C*
     C** IF ACTION DATE LT RUN DATE
     C***********@ACTR5****IFLT RUND                       B1             S01194
     C           @ACTR5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    SUB  @RAMT     FONNCP           *1
     C*
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    SUB  @RDELB    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    ADD  @RDELB    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           FOTNTP    SUB  @RAMT     FOTNTP
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOTDPE    SUB  @RDELB    FOTDPE           *1
     C                     ELSE                            X1
     C           FOTDPE    ADD  @RDELB    FOTDPE           *1
     C                     END                             E1
     C*
     C           @RAMT     IFGE 0                          B1
     C           FOBDSE    SUB  @RDSPB    FOBDSE           *1
     C                     ELSE                            X1
     C           FOBDSE    ADD  @RDSPB    FOBDSE           *1
     C                     END                             E1
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C                     MOVE @RUND     FODLUP
     C                     MOVE @RUNM     FOMLUP
     C                     MOVE @RUNY     FOYLUP
     C                     TIME           FOTLUP
     C                     MOVE 'A'       FOCHTP
     C*********************MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVEL@USER     FOLUID
     C                     UPDATFXEPOSP0
     C           #BED9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEE  FXR0050 UPDATE FXEPOULL                   *
     C*                    NOT REVERSING SIGNS                       *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @ACTD5 -  ACTION DATE                     *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTR5 -  ACTION DATE RELATED DEAL        *
     C*                    @VDAT5 -  DEAL VALUE DATE                 *
     C*                    @RNPA  -  NET POSITION ADJUSTMENT         *
     C*                    @RDBC  -  DBCE ADJUSTMENT                 *
     C*                    @RDSB  -  DSBCE ADJUSTMENT                *
     C*                    @ROPL  -  OPTION P/L ADJUSTMENT           *
     C*                    @RDPL  -  DEAL P/L ADJUSTMENT             *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C*  CALLS :           #ZD                                       *
     C*                                                              *
     C****************************************************************
     C           #BEE      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C*
     C** CREATE A ZERO RECORD FOR FXEPOUP0
     C                     EXSR #ZD                        *1
     C                     END                             E1
     C                     MOVE @RCCY     FOCCY
     C***********@ACTD5****IFLT RUND                       B1             S01194
     C           @ACTD5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    ADD  @RAMT     FONNCP           *1
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    ADD  F3BCDE    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    SUB  F3BCDE    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** TOTAL NET POSITION
     C           FOTNTP    ADD  @RNPA     FOTNTP
     C*
     C*   FOR BUY CCY
     C           @BUYC     IFEQ @RCCY                      B1
     C           FOTDPE    ADD  @RDBC     FOTDPE           *1
     C*
     C*   FOR SELL CCY
     C                     ELSE                            X1
     C           FOTDPE    SUB  @RDBC     FOTDPE           *1
     C                     END                             E1
     C*
     C**  FOR OPTION TAKEDOWNS MUST INVERT THE SIGN OF THE
     C**  SELL ADJUSTMENT. B'COS ALL BCE ARE +VE ON DEALS FILE
     C           F3DTYP    IFEQ 'T'                        B1
     C           @RAMT     ANDLT0                          *1
     C                     Z-SUB@RDSB     @RDSB            *1
     C                     END                             E1
     C*
     C           FOBDSE    ADD  @RDSB     FOBDSE
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C           *IN66     IFEQ '1'                        B1
     C                     WRITEFXEPOSP0                   *1
     C                     ELSE                            X1
     C                     MOVE @RUND     FODLUP           *1
     C                     MOVE @RUNM     FOMLUP           *1
     C                     MOVE @RUNY     FOYLUP           *1
     C                     TIME           FOTLUP           *1
     C                     MOVE 'A'       FOCHTP           *1
     C*********************MOVE RUND      FOLCD            *1             S01194
     C                     MOVE BJRDNB    FOLCD            *1             S01194
     C                     MOVEL@USER     FOLUID           *1
     C                     UPDATFXEPOSP0                   *1
     C                     END                             E1
     C           #BEE9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEF  FXR0050 UPDATE FXEPOULL                   *
     C*                    REVERSING SIGNS FOR DELETES.              *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @ACTD5 -  ACTION DATE                     *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTR5 -  ACTION DATE RELATED DEAL        *
     C*                    @VDAT5 -  DEAL VALUE DATE                 *
     C*                    @RNPA  -  NET POSITION ADJUSTMENT         *
     C*                    @RDBC  -  DBCE ADJUSTMENT                 *
     C*                    @RDSB  -  DSBCE ADJUSTMENT                *
     C*                    @ROPL  -  OPTION P/L ADJUSTMENT           *
     C*                    @RDPL  -  DEAL P/L ADJUSTMENT             *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #BEF      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C**  Set up error output for screen.
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     MOVEL'FXEPOULL'DBFILE           * DB ERROR 034*
     C                     MOVEL'034'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #BEF9                      *1
     C                     END                             E1
     C                     MOVE @RCCY     FOCCY
     C***********@ACTD5****IFLT RUND                       B1             S01194
     C           @ACTD5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    SUB  @RAMT     FONNCP           *1
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    SUB  F3BCDE    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    ADD  F3BCDE    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C                     MOVE @RUND     FODLUP
     C                     MOVE @RUNM     FOMLUP
     C                     MOVE @RUNY     FOYLUP
     C                     TIME           FOTLUP
     C                     MOVE 'A'       FOCHTP
     C*********************MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVEL@USER     FOLUID
     C                     UPDATFXEPOSP0
     C           #BEF9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BEG  FXR0050 UPDATE FXEPOULL                   *
     C*                            AMENDING A TAKEDOWN               *
     C*                                                              *
     C*  FIELDS USED :     @RCCY  -  CURRENCY                        *
     C*                    @VDTB5 -  VALUE DATE BEFORE UPDATE        *
     C*                    @RAMT  -  AMOUNT                          *
     C*                    @FWD5  -  1 MONTH FORWARD DATE LOCAL CCY  *
     C*                    @ACTR5 -  ACTION DATE RELATED DEAL        *
     C*                    @VDAT5 -  DEAL VALUE DATE                 *
     C*                    @DEALB -  DBCE BEFORE UPDATE              *
     C*                    @OPTPL -  OPTION DEAL P/L                 *
     C*                    @RNPA  -  NET POSITION ADJUSTMENT         *
     C*                    @RDBC  -  DBCE ADJUSTMENT                 *
     C*                    @RDSB  -  DSBCE ADJUSTMENT                *
     C*                    @ROPL  -  OPTION P/L ADJUSTMENT           *
     C*                    @RDPL  -  DEAL P/L ADJUSTMENT             *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #BEG      BEGSR
     C*
     C** ACCESS FXEPOULL
     C           @RCCY     CHAINFXEPOULL             66
     C           *IN66     IFEQ '1'                        B1
     C**  Set up error output for screen.
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     MOVEL'FXEPOULL'DBFILE           * DB ERROR 035*
     C                     MOVEL'035'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #BEG9                      *1
     C                     END                             E1
     C*
     C**
     C                     MOVE @RCCY     FOCCY
     C***********@VDTB5****IFLT RUND                       B1             S01194
     C           @VDTB5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    SUB  @RAMT     FONNCP           *1
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    SUB  @DEALB    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    ADD  @DEALB    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C***********@VDAT5****IFLT RUND                       B1             S01194
     C           @VDAT5    IFLT BJRDNB                     B1             S01194
     C           FONNCP    ADD  @RAMT     FONNCP           *1
     C           @RAMT     IFGE 0                          B*2
     C           FONDBC    ADD  F3BCDE    FONDBC           **2
     C                     ELSE                            X*2
     C           FONDBC    SUB  F3BCDE    FONDBC           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** TOTAL NET POSITION
     C           FOTNTP    ADD  @RNPA     FOTNTP
     C           FOTDPE    ADD  @RDBC     FOTDPE
     C*
     C**  FOR OPTION TAKEDOWNS MUST INVERT THE SIGN OF THE
     C**  SELL ADJUSTMENT. B'COS ALL BCE ARE +VE ON DEALS FILE
     C           F3DTYP    IFEQ 'T'                        B1
     C           @RAMT     ANDLT0                          *1
     C                     Z-SUB@RDSB     @RDSB            *1
     C                     END                             E1
     C*
     C           FOBDSE    ADD  @RDSB     FOBDSE
     C*
     C**  CALCULATE PROFIT/LOSS FIGURES
     C           1         OCUR @PRLOS
     C           @RCCY     IFNE @PCCY                      B1
     C           2         OCUR @PRLOS                     *1
     C                     END                             E1
     C*
     C** ONLY ADD AJUSTMENTS TO FILE FIELDS IF NOT ALREADY DONE
     C           @ADJAD    IFEQ 'N'                        B1
     C                     ADD  @SPLO     FOSHPL           *1
     C                     ADD  @FPLO     FOFWPL           *1
     C                     MOVE 'Y'       @ADJAD           *1
     C                     END                             E1
     C                     MOVE @RUND     FODLUP
     C                     MOVE @RUNM     FOMLUP
     C                     MOVE @RUNY     FOYLUP
     C                     TIME           FOTLUP
     C                     MOVE 'A'       FOCHTP
     C*********************MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVEL@USER     FOLUID
     C                     UPDATFXEPOSP0
     C           #BEG9     ENDSR
     //EJECT
     C****************************************************************    S01277
     C*                                                              *    S01277
     C*  SUBROUTINE: #BEH  UPDATE FXEPOCLL                           *    S01277
     C*                    ADD IN EXPOSURES FOR THIS DEAL            *    S01277
     C*                    CURRENT AMOUNTS AND NOT REVERSING SIGNS   *    S01277
     C*                                                              *    S01277
     C*  FIELDS USED :                                               *    S01277
     C*                    @RUND  -  RUN DATE (DAY)                  *    S01277
     C*                    @RUNM  -  RUN DATE (MONTH)                *    S01277
     C*                    @RUNY  -  RUN DATE (YEAR)                 *    S01277
     C*                    @USER  -  USER FROM PSDS                  *    S01277
     C*                                                              *    S01277
     C*  CALLED BY :       #BE  UPDATE EQUIV POSITIONS & PROFITS     *    S01277
     C*                                                              *    S01277
     C*  CALLS :           #ZD                                       *    S01277
     C*                                                              *    S01277
     C****************************************************************    S01277
     C           #BEH      BEGSR                                          S01277
     C*                                                                   S01277
     C** Access positions file.                                           S01277
     C*                                                                   S01277
     C           @EPKEY    CHAINFXEPOCLL             68                   S01277
     C*                                                                   S01277
     C** If record not found currency combination is newly                S01277
     C** set up so need to initialise record                              S01277
     C*                                                                   S01277
     C           *IN68     IFEQ '1'                        B1             S01277
     C                     EXSR #ZD                        *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** Set up Cross currency total net position (FOCTNP) and            S01277
     C** Cross currency equivalent in primary currency (FOCTEP)           S01277
     C*                                                                   S01277
     C** If action code is insert:                                        S01277
     C*                                                                   S01277
     C           F3LACT    IFEQ 'I'                        B1             S01277
     C           FOCTNP    ADD  @CCAMT    FOCTNP                          S01277
     C           FOCTEP    SUB  @CCEQV    FOCTEP                          S01277
     C                     MOVE @EPCCY    FOPCCY                          S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** If action code is delete:                                        S01277
     C*                                                                   S01277
     C           F3LACT    IFEQ 'D'                        B1             S01277
     C           FOCTNP    SUB  @CCAMT    FOCTNP                          S01277
     C           FOCTEP    ADD  @CCEQV    FOCTEP                          S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** If action code is amend:                                         S01277
     C*                                                                   S01277
     C           F3LACT    IFEQ 'A'                        B1             S01277
     C           FOCTNP    SUB  @CCOAM    FOCTNP                          S01277
     C           FOCTNP    ADD  @CCAMT    FOCTNP                          S01277
     C*                                                                   S01277
     C           FOCTEP    ADD  @CCOEQ    FOCTEP                          S01277
     C           FOCTEP    SUB  @CCEQV    FOCTEP                          S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           *IN68     IFEQ '1'                        B1             S01277
     C                     WRITEFXEPOCL1                   *1             S01277
     C                     ELSE                            X1             S01277
     C                     MOVE @RUND     FODLUP           *1             S01277
     C                     MOVE @RUNM     FOMLUP           *1             S01277
     C                     MOVE @RUNY     FOYLUP           *1             S01277
     C                     TIME           FOTLUP           *1             S01277
     C                     MOVE 'A'       FOCHTP           *1             S01277
     C                     MOVE BJRDNB    FOLCD            *1             S01194
     C                     MOVEL@USER     FOLUID           *1             S01277
     C                     UPDATFXEPOCL1                   *1             S01277
     C                     END                             E1             S01277
     C           #BEH9     ENDSR                                          S01277
     //EJECT                                                              S01277
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #ZD   CREATE ZERO RECORD FOR FXEPOULL           *
     C*                                                              *
     C*  FIELDS USED :     @RUND  -  RUN DATE DAY                    *
     C*                    @RUNM  -  RUN DATE MONTH                  *
     C*                    @RUNY  -  RUN DATE YEAR                   *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                    @RCCY  -  CURRENCY                        *
     C*                                                              *
     C*  CALLED BY :       #BEB UPDATE FXEPOULL FXR0017              *
     C*                    #BEE UPDATE FXEPOULL FXR0050              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #ZD       BEGSR
     C                     MOVE 'FO'      FORCID
     C                     MOVE *BLANKS   FODLTF
     C                     MOVE @RUND     FODLUP
     C                     MOVE @RUNM     FOMLUP
     C                     MOVE @RUNY     FOYLUP
     C                     TIME           FOTLUP
     C                     MOVE 'I'       FOCHTP
     C*********************MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVEL@USER     FOLUID
     C                     MOVE @RCCY     FOCCY
     C                     MOVE *ZEROS    FONNCP
     C                     MOVE *ZEROS    FONDBC
     C                     MOVE *ZEROS    FOTNTP
     C                     MOVE *ZEROS    FOTDPE
     C                     MOVE *ZEROS    FOBDSE
     C                     MOVE *ZEROS    FOSHPL
     C                     MOVE *ZEROS    FOFWPL
     C                     MOVE *ZEROS    FOCTNP                          S01277
     C                     MOVE *ZEROS    FOCTEP                          S01277
     C                     MOVE *BLANKS   FOPCCY                          S01277
     C           #ZD9      ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #A    INITIAL PROCESSING                        *
     C*                                                              *
     C*  FIELDS USED :     @TERM  -  TERMINATION PARAMETER           *
     C*********************@FRBA**-**FRONT/BACK*OFFICE*PARAMETER**********S01319
     C*                    @STDDL -  STANDARD DEAL PARAMETER         *
     C*                    @FIRST -  FIRST TIME CALLED FLAG          *
     C*                    @@DTIN -  INPUT DATE FOR ZA0680           *
     C*                    @@MDNO -  OUTPUT DATE FROM ZA0680         *
     C*                    @FWD5  -  ONE MONTH FORWARD DATE LOCAL CCY*
     C*********************@WK4***-**WORK*FIELD***********************    S01194
     C*                    @DECA  -  BCA DECIMAL PLACES              *
     C*                    @BUYA  -  BUY AMOUNT                      *
     C*                    @BUYC  -  BUY CURRENCY                    *
     C*                    @B12   -  BUY FLAG                        *
     C*                    @SELA  -  SELL AMOUNT                     *
     C*                    @SELC  -  SELL CURRENCY                   *
     C*                    @S12   -  SELL FLAG                       *
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @VDAT  -  VALUE DATE(CHAR)                *
     C*                    @VDAT5 -  VALUE DATE(NUM)                 *
     C*                    @ODAT  -  OPTION TO DATE(CHAR)            *
     C*                    @ODAT5 -  OPTION TO DATE(NUM)             *
     C*                    @PRLOS -  REVALUATION PROFIT AND LOSS     *
     C*                              DATA STRUCTURE (2 OCURS)        *
     C*                              CONTAINING:                     *
     C*                       @PCCY  -  CURRENCY                     *
     C*                       @SPLO  -  SHORT PROFIT/LOSS ADJUSTMENT *
     C*                       @FPLO  -  FORWARD PROFIT/LOSS ADJUSTMT *
     C*                       @ADJAD -  ADJUSTMENT HAS BEEN ADDED    *
     C*                                 INDICATOR (Y OR N)           *
     C*                                                              *
     C*                                                              *
     C*  CALLED BY :       MAIN PROGRAM                              *
     C*                                                              *
     C*  CALLS :           ZA0680                                    *
     C*                                                              *
     C****************************************************************
     C           #A        BEGSR
     C**  INPUT PARAMETERS
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*********************PARM***********@FRBA***1***********************S01319
     C                     PARM           @STDDL
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C                     PARM           Z#XSTS                          154448
     C*                                                                   S01277
     C** Keylist for FXCRSCLL                                             S01277
     C*                                                                   S01277
     C           @CCKEY    KLIST                                          S01277
     C                     KFLD           @CPCCY  3                       S01277
     C                     KFLD           @CSCCY  3                       S01277
     C*                                                                   S01277
     C** Keylist for FXEPOCLL                                             S01277
     C*                                                                   S01277
     C           @EPKEY    KLIST                                          S01277
     C                     KFLD           @EECCY  3                       S01277
     C                     KFLD           @EPCCY  3                       S01277
     C*
     C**  Define field to store update run time                          E12279a
     C           *LIKE     DEFN FHTLUP    @RUNT                          E12279a
     C*
     C**  IF TERMINATION FLAG SET MUST TERMINATE PROGRAM IMMEDIATELY
     C           @TERM     IFEQ 'T'                        B1
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP13                                           S01408
     C*                                                                   S01408
     C*
     C**  CHECK IF THIS IS THE FIRST RUN OF THE PGM
     C           @FIRST    IFEQ *BLANK                     B1
     C                     MOVE 'N'       @FIRST  1        *1
     C                     MOVEL'FX0320'  DBPGM            *1
     C***********@FRBA*****IFEQ*'F'************************B*2************S01319
     C*********************OPEN*FXDW38LL*********************2************S01319
     C*********************END*****************************E*2************S01319
     C*********************OPEN FDICDRLL                   *1             S01194
     C                     OPEN FDCCYPLL                   *1
     C*********************OPEN FDTG11LL                   *1             S01194
     C*********************OPEN*FXSSTSLL********************1*************S01319
     C*********************OPEN FDBRKRLL                   *1             S01194
     C*********************OPEN*FDINSTLL********************1*************S01319
     C*********************OPEN FDCSNMLL                   *1             S01194
     C*********************OPEN FDBSNCLL                   *1             S01194
     C*********************OPEN FDSNAMLL                   *1             S01194
     C*********************OPEN FDNOSTLL                   *1             S01194
     C                     OPEN FXREVHLL                   *1
     C                     OPEN FXDEAULL                   *1
     C*********************OPEN*FXCEXELL****************** *1             S01136
     C*********************OPEN*FXCEXDLL********************1*******S01136S01319
     C/COPY WNCPYSRC,FX0320C005
      *                                                                   S01319
      ** Access SDMMODPD                                                  S01319
     C                     CALL 'AOMMODR0'                                S01319
     C                     PARM '*MSG    '@RTCD                           S01319
     C                     PARM '*FIRST  '@OPTN                           S01319
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01319
     C*                                                                   S01319
     C           @RTCD     IFNE *BLANK                     B*2            S01319
     C**  Set up error output for screen.                                 S01319
     C                     MOVEL@OPTN     DBKEY            ***************S01319
     C                     MOVEL'SDMMODPD'DBFILE           * DBERROR 052 *S01319
     C                     MOVEL'052'     DBASE            ***************S01319
     C                     MOVE '1'       *INU7            **2            S01319
     C                     MOVE '1'       *INU8            **2            S01319
     C                     EXSR *PSSR                      **2            S01319
     C                     GOTO #A9                        **2            S01319
     C                     END                             E*2            S01319
      *                                                                   S01319
     C           BGTRMG    IFEQ 'Y'                                       S01319
     C                     OPEN FXFWDULL                   *1
     C                     OPEN FXEPOULL                   *1
     C                     OPEN FXFWMULL                   *1
     C                     OPEN FXEPOCLL                   *1             S01319
     C                     END                                            S01319
     C*********************OPEN*FXSTDDLL********************1*************S01319
     C*********************OPEN FDCCYTLL                   *1             S01194
     C*
     C***ACCESS*FDICDRLL*TO*GET*RUN*DATES******                           S01194
     C*********************MOVE *BLANKS   KEY              *1             S01194
     C*********************MOVEL'01'      KEY              *1             S01194
     C*********************MOVE '10'      KEY              *1             S01194
     C***********KEY*******CHAINFDICDRLL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C** ACCESS BANK DETAILS VIA ACCESS PROGRAM TO GET RUN DATES          S01194
     C                     CALL 'AOBANKR0'                 *1             S01194
     C*********************PARM '*DBERR ' @RTCD            *1      S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            *1             LN0391
     C                     PARM '*FIRST ' @OPTN            *1             S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C**  Set up error output for screen.
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDICDRLL'DBFILE           * DB ERROR 001*S01194
     C                     MOVEL@OPTN     DBKEY            ***************S01194
     C                     MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *S01194
     C                     MOVEL'001'     DBASE            ***************
     C                     MOVEL'FX0320'  DBPGM            **2
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     EXSR *PSSR                      **2            S01194
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C                     MOVE BJMRDT    RUNA    7                       S01194
     C*********************                                               S01194
     C***ACCESS*FDICDRLL*TO*GET*BASE*CCY*FOR*ACCOUNTING*AND*LOCAL*CCY*    S01194
     C*********************MOVE *BLANKS   KEY              *1             S01194
     C*********************MOVEL'01'      KEY              *1             S01194
     C*********************MOVE '11'      KEY              *1             S01194
     C***********KEY*******CHAINFDICDRLL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C****Set*up*error*output*for*screen.***                              S01194
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDICDRLL'DBFILE           * DB ERROR 002*S01194
     C*********************MOVEL'002'     DBASE            ***************S01194
     C*********************MOVE '1'       *INU7            **2            S01194
     C*********************MOVE '1'       *INU8            **2            S01194
     C*********************GOTO #A9                        **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***ACCESS*FDICDRLL*TO*GET*PRIME*CURRENT*ACCOUNT*CODE***             S01194
     C*********************MOVE *BLANKS   KEY              *1             S01194
     C*********************MOVEL'01'      KEY              *1             S01194
     C*********************MOVE '20'      KEY              *1             S01194
     C***********KEY*******CHAINFDICDRLL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C** ACCESS RETAIL DETAILS TO GET PRIME CURRENT ACCOUNT CODE          S01194
     C           BGRTBN    IFEQ 'Y'                                       E47225
     C           BGIOAC    OREQ 'Y'                                       E47225
     C                     CALL 'AORETLR0'                 *1             S01194
     C*********************PARM '*DBERR ' @RTCD            *1      S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            *1             LN0391
     C                     PARM '*FIRST ' @OPTN            *1             S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C**  Set up error output for screen.
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDICDRLL'DBFILE           * DB ERROR 003*S01194
     C                     MOVEL@OPTN     DBKEY            ***************S01194
     C                     MOVEL'SDRETLPD'DBFILE           * DBERROR 003 *S01194
     C                     MOVEL'003'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     EXSR *PSSR                      **2            S01194
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C                     END                                            E47225
     C*
     C***ACCESS*FXSSTSLL*TO*GET*OPTIONS*ON*VALUE*DATE*INDICATOR***********S01319
     C***********1*********CHAINFXSSTSLL*************63*****1*************S01319
     C************IN63*****IFEQ*'1'************************B*2************S01319
     C****Set*up*error*output*for*screen.*********************************S01319
      ** Access SDTRMAPD if TM module is on.                              S01319
      *                                                                   S01319
     C           BGTRMG    IFEQ 'Y'                        B*2            S01319
     C                     CALL 'AOTRMAR0'                                S01319
     C                     PARM '*MSG   ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C           SDTRMA    PARM SDTRMA    DSFDY                           S01319
     C           @RTCD     IFNE *BLANKS                    B**3           S01319
     C                     MOVEL'1'       DBKEY            ***************
     C*********************MOVEL'FXSSTSLL'DBFILE*************DB*ERROR*004*S01319
     C                     MOVEL'SDTRMAPD'DBFILE           * DB ERROR 004*
     C                     MOVEL'004'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     GOTO #A9                        ***3
     C                     END                             E**3
     C*
     C***ACCESS*FDINSTLL*TO*GET*PERIOD*DEFINING*SHORT*OR******************S01319
     C***FORWARD*P/L******************************************************S01319
     C           KEY1      KLIST                           **2
     C                     KFLD           XPCCY            **2
     C                     KFLD           XPTPRD           **2
     C                     KFLD           XPPRD            **2
     C*********************MOVELLOCY      XPCCY            *1             S01194
     C                     MOVELBJLCCY    XPCCY            **2            S01194
     C***********1*********CHAINFDINSTLL*************63*****1*************S01319
     C************IN63*****IFEQ*'1'************************B*2************S01319
     C***********XPDLTF****OREQ*'*'**************************2************S01319
     C****Set*up*error*output*for*screen.*********************************S01319
     C*********************MOVELKEY       DBKEY            ***************S01194
     C***********IDPRDE****IFNE*'SP'***********************B*2************S01319
     C***********IDPRDE****LOKUPTAB1******TAB2***********50**2************S01319
     C           ERSPRE    IFNE 'SP'                       B**3           S01319
     C           ERSPRE    LOKUPTAB1      TAB2           50***3           S01319
     C                     MOVELTAB2      @TEMP   1        ***3
     C                     MOVE TAB2      XPTPRD           ***3
     C                     MOVE @TEMP     XPPRD            ***3
     C           KEY1      CHAINFDCCYPLL             63    ***3
     C           *IN63     IFEQ '1'                        B***4          S01136
     C           XPDLTF    OREQ '*'                        ****4          E12787
     C**  Set up error output for screen.                                 E12787
     C                     MOVELXPPRD     DBKEY            ***************E12787
     C                     MOVE XPTPRD    DBKEY            ***************E12787
     C                     MOVEL'FDCCYPLL'DBFILE           * DB ERROR 005*E12787
     C                     MOVEL'005'     DBASE            ***************E12787
     C                     MOVE '1'       *INU7            ****4          E12787
     C                     MOVE '1'       *INU8            ****4          E12787
     C                     GOTO #A9                        ****4          E12787
     C                     END                             E***4          E12787
     C*                                                                   E12787
     C**  Set up error output for screen.                                 E12787
     C******               MOVELXPCCY     DBKEY            ***************E12787
     C******               MOVE XPPRD     DBKEY            ***************E12787
     C******               MOVEL'FDCCYPLL'DBFILE           * DB ERROR 041*E12787
     C******               MOVEL'041'     DBASE            ***************E12787
     C******               MOVE '1'       *INU7            **2            E12787
     C******               MOVE '1'       *INU8            **2            E12787
     C******               GOTO #A9                        **2            E12787
     C******               END                             E*2            E12787
     C                     ELSE                            X**3
     C*********************MOVELXPCCY     @T1     4        **2            S01194
     C*********************MOVE '1'       @T1              **2            S01194
     C*********************MOVEL'20'      @T2    12        **2            S01194
     C*********************MOVE @T1       @T2              **2            S01194
     C***********@T2*******CHAINFDCCYTLL             63    **2            S01194
     C                     CALL 'AOCURRR0'                 ***3           S01194
     C*********************PARM '*DBERR ' @RTCD            **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            ***3           LN0391
     C                     PARM '*KEY   ' @OPTN            ***3           S01194
     C                     PARM XPCCY     @AJCD            ***3           S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                     B***4          S01194
     C                     MOVELXPCCY     DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 042 *S01194
     C                     MOVEL'042'     DBASE            ***************
     C                     MOVE '1'       *INU7            ****4
     C                     MOVE '1'       *INU8            ****4
     C                     EXSR *PSSR                      ****4          S01194
     C                     GOTO #A9                        ****4
     C                     END                             E***4
     C********** *IN63     IFEQ '1'                        B**3           E12787
     C****Set*up*error output for screen.                                 E12787
     C***********          MOVEL@T2       DBKEY            ***************E12787
     C******               MOVEL'FDCCYTLL'DBFILE           * DB ERROR 042*E12787
     C******               MOVEL'042'     DBASE            ***************E12787
     C******               MOVE '1'       *INU7            **2            E12787
     C*********            MOVE '1'       *INU8            **2            E12787
     C*********            EXSR *PSSR                      **2            S01194
     C*********            GOTO #A9                        **2            E12787
     C******               END                             E*2            E12787
     C*********************MOVELFXSP      XPPRDD           **2            S01194
      *
     C                     MOVELA6FXSD    XPPRDD           ***3           S01194
     C                     END                             E**3
      *
     C******     KEY1      CHAINFDCCYPLL             63    *1             E12787
     C******     *IN63     IFEQ '1'                        B*2            E12787
     C******     XPDLTF    OREQ '*'                        **2            E12787
     C**  Set up error output for screen.
     C******               MOVELXPPRD     DBKEY            ***************E12787
     C******               MOVE XPTPRD    DBKEY            ***************E12787
     C******               MOVEL'FDCCYPLL'DBFILE           * DB ERROR 005*E12787
     C******               MOVEL'005'     DBASE            ***************E12787
     C******               MOVE '1'       *INU7            **2            E12787
     C******               MOVE '1'       *INU8            **2            E12787
     C******               GOTO #A9                        **2            E12787
     C******               END                             E*2            E12787
     C*
     C** CONVERT 1 MONTH FORWARD DATE TO 5N
     C                     MOVE XPPRDD    @@DTIN           **2
     C           @@DTIN    IFNE *ZEROS                     B**3
     C                     EXSR ZA0680                     ***3
     C           *INU7     IFEQ '1'                        B***4
     C                     GOTO #A9                        ****4
     C                     END                             E***4
     C                     MOVE @@MDNO    @FWD5   50       ***3
     C                     ELSE                            X**3
     C                     MOVE *ZEROS    @FWD5            ***3
     C                     END                             E**3
     C*
     C                     END                             E*2            S01319
      *
     C** OBTAIN BASE CURRENCY FOR DEALING DECIMAL PLACES FOR IT
     C** IDCYDL & @@NDPB
     C*********************EXSR ZA0870                     *1             S01194
     C                     EXSR #AB                        *1             S01194
     C*
     C***ACCESS*FDTG11LL*TO*GET*DEC*PLACES*FOR*ACCOUNTING***              S01194
     C*********************MOVE *BLANKS   KEY              *1             S01194
     C*********************MOVEL'20'      KEY              *1             S01194
     C*********************MOVELBCCY      @WK4    4        *1             S01194
     C*********************MOVE @WK4      KEY              *1             S01194
     C*********************MOVE '1'       KEY              *1             S01194
     C***********KEY*******CHAINFDTG11LL             63    *1             S01194
     C************IN63*****IFEQ '1'                        B*2            S01194
     C***********CRECI*****OREQ '*'                        **2            S01194
     C** ACCESS CURRENCY DETAILS TO GET DECIMAL PLACES FOR ACCOUNTING     S01194
     C                     CALL 'AOCURRR0'                 *1             S01194
     C*********************PARM '*DBERR ' @RTCD            *1      S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            *1             LN0391
     C                     PARM '*KEY   ' @OPTN            *1             S01194
     C                     PARM BJCYCD    @AJCD            *1             S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C**  Set up error output for screen.
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDTG11LL'DBFILE           * DB ERROR 006*S01194
     C                     MOVELBJCYCD    DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 006 *S01194
     C                     MOVEL'006'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     EXSR *PSSR                      **2            S01194
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*********************MOVE CCDP      @DECA   10       *1             S01194
     C                     MOVE A6NBDP    @DECA   10       *1             S01194
     C                     END                             E1
     C*
     C** FIND AND STORE DEAL BUY AMOUNT AND SELL AMOUNT AND CURRENCY
     C** ALSO STORE INDICATION OF WHICH AMOUNT (1 OR 2) IS BUY AND SELL
     C           F3DAM1    IFGE 0                          B1
     C                     MOVE F3DAM1    @BUYA  150       *1
     C                     MOVE F3CCY1    @BUYC   3        *1
     C                     MOVE '1'       @B12    1        *1
     C                     MOVE F3DAM2    @SELA  150       *1
     C                     MOVE F3CCY2    @SELC   3        *1
     C                     MOVE '2'       @S12    1        *1
     C                     ELSE                            X1
     C                     MOVE F3DAM2    @BUYA            *1
     C                     MOVE F3CCY2    @BUYC            *1
     C                     MOVE '2'       @B12    1        *1
     C                     MOVE F3DAM1    @SELA            *1
     C                     MOVE F3CCY1    @SELC            *1
     C                     MOVE '1'       @S12    1        *1
     C                     END                             E1
     C*
     C** GET AND STORE DEAL TRANSACTION DATE FROM STANDARD DEAL           184828
     C                     MOVE F3DTYY    @D1YY                           184828
     C                     MOVE F3DTMM    @D1MM                           184828
     C                     MOVE F3DTDD    @D1DD                           184828
     C                     MOVE DATE1     @DTAT   80                      184828
     C*                                                                   184828
     C** CONVERT DEAK TRANSACTION DATE TO 5N                              184828
     C                     MOVE @DTAT     @@DTIN                          184828
     C           @@DTIN    IFNE *ZEROS                     B1             184828
     C                     EXSR ZA0680                     *1             184828
     C           *INU7     IFEQ '1'                        B*2            184828
     C                     GOTO #A9                        **2            184828
     C                     END                             E*2            184828
     C                     MOVE @@MDNO    @DTAT5  50       *1             184828
     C                     ELSE                            X1             184828
     C                     MOVE *ZEROS    @DTAT5           *1             184828
     C                     END                             E1             184828
     C                     Z-ADD@DTAT5    F3DDDN                          184828
     C*                                                                   184828
     C** GET AND STORE VALUE DATE FROM STANDARD DEAL
     C                     MOVE F3VDYY    @D1YY
     C                     MOVE F3VDMM    @D1MM
     C                     MOVE F3VDDD    @D1DD
     C                     MOVE DATE1     @VDAT   80
     C*
     C** CONVERT VALUE DATE TO 5N
     C                     MOVE @VDAT     @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @VDAT5  50       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @VDAT5           *1
     C                     END                             E1
     C                     Z-ADD@VDAT5    F3VDDN                          184828
     C*
     C** GET AND STORE OPTION TO DATE FROM STANDARD DEAL
     C                     MOVE F3DOEY    @D1YY
     C                     MOVE F3DOEM    @D1MM
     C                     MOVE F3DOED    @D1DD
     C                     MOVE @DATE1    @ODAT   80
     C*
     C** CONVERT OPTION DATE TO 5N
     C                     MOVE @ODAT     @@DTIN
     C           @@DTIN    IFNE *ZEROS                     B1
     C                     EXSR ZA0680                     *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C                     MOVE @@MDNO    @ODAT5  50       *1
     C                     ELSE                            X1
     C                     MOVE *ZEROS    @ODAT5           *1
     C                     END                             E1
     C                     Z-ADD@ODAT5    F3OTDN                          184828
     C*
     C** INITIALISE P/L ACCUMULATORS
     C           1         OCUR @PRLOS
     C                     Z-ADD0         @SPLO
     C                     Z-ADD0         @FPLO
     C                     MOVE @BUYC     @PCCY
     C                     MOVE 'N'       @ADJAD
     C           2         OCUR @PRLOS
     C                     Z-ADD0         @SPLO
     C                     Z-ADD0         @FPLO
     C                     MOVE @SELC     @PCCY
     C                     MOVE 'N'       @ADJAD
     C                     MOVEACPY@      BIS@   80
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCPG                                           S01408
     C*                                                                   S01408
      *                                                                   CEU003
      ** Check if CEU003 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD                           CEU003
     C                     PARM '*VERIFY' @OPTN                           CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFNE *BLANKS                                   CEU003
     C                     MOVE 'N'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVE 'Y'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CDL008
      ** Determine if SAR Continuous Linked Settlement enhancement is     CDL008
      ** installed.                                                       CDL008
      *                                                                   CDL008
     C                     CALL 'AOSARDR0'                                CDL008
     C                     PARM *BLANKS   @RTCD                           CDL008
     C                     PARM '*VERIFY '@OPTN                           CDL008
     C                     PARM 'CDL008'  @SARD                           CDL008
     C           SCSARD    PARM SCSARD    DSFDY                           CDL008
      *                                                                   CDL008
     C           @RTCD     IFNE *BLANKS                                   CDL008
     C           @RTCD     ANDNE'*NRF   '                                 CDL008
     C                     MOVE *ON       *INU7                           CDL008
     C                     MOVE *ON       *INU8                           CDL008
     C                     MOVEL'SCSARDPD'DBFILE                          CDL008
     C                     MOVEL'993'     DBASE                           CDL008
     C                     MOVEL'CDL008'  DBKEY                           CDL008
     C                     EXSR *PSSR                                     CDL008
     C                     GOTO #A9                                       CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C           @RTCD     IFEQ *BLANKS                                   CDL008
     C                     MOVE 'Y'       CDL008  1                       CDL008
     C                     ELSE                                           CDL008
     C                     MOVE 'N'       CDL008                          CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CEU003
      ** Access General Ledger ICD file to get Euro curr. code.           CEU003
      *                                                                   CEU003
     C**********           CALL 'AOGELRR0'                                CEU003              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           CEU003
     C                     PARM '*FIRST ' @OPTN                           CEU003
     C********** SDGELR    PARM SDGELR    DSFDY                           CEU003              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CEU003
     C           @RTCD     IFNE *BLANKS                                   CEU003
     C           @RTCD     ANDNE'*NRF   '                                 CEU003
     C                     MOVEL'*FIRST'  DBKEY            ***************CEU003
     C                     MOVEL'SDGELRPD'DBFILE           * DBERROR 052 *CEU003
     C                     MOVEL'052'     DBASE            ***************CEU003
     C                     MOVE '1'       *INU7                           CEU003
     C                     MOVE '1'       *INU8                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Determine buy effective settlement currency.                     CEU003
      *                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM '       ' @RTCD   7                       CEU003
     C                     PARM '*KEY   ' @OPTN   7                       CEU003
     C                     PARM @BUYC     @CURKY  3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   @BESC   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           A6INCY    ANDEQ'Y'                                       CEU003
     C           F3RVCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C           CEU003    OREQ 'Y'                                       CEU003
     C           @BUYC     ANDEQBKEURO                                    CEU003
     C           F3RVCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVE F3RVCY    @BESC                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE @BUYC     @BESC                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Determine sell effective settlement currency.                    CEU003
      *                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM '       ' @RTCD   7                       CEU003
     C                     PARM '*KEY   ' @OPTN   7                       CEU003
     C                     PARM @SELC     @CURKY  3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   @SESC   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           A6INCY    ANDEQ'Y'                                       CEU003
     C           F3PSCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C           CEU003    OREQ 'Y'                                       CEU003
     C           @BUYC     OREQ BKEURO                                    CEU003
     C           F3PSCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVE F3PSCY    @SESC                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE @SELC     @SESC                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           #A9       ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BA   FXP0038 UPDATE DEALS FILE                 *
     C*                                                              *
     C*  FIELDS USED :     @DLANO -  DEAL ASSOCIATED DEAL NO         *
     C*                    @OOFA  -  OPTION ORIGINAL FIRST AMOUNT    *
     C*                    @OOSA  -  OPTION ORIGINAL SECOND AMOUNT   *
     C*                    @SCUS  -  CUSTOMER SHORTNAME BEFORE UPDATE*
     C*                    @CCY1B -  CCY 1 BEFORE UPDATE             *
     C*                    @CCY2B -  CCY 2 BEFORE UPDATE             *
     C*                    @ACTB  -  DEAL LAST ACTION BEFORE UPDATE  *
     C*                    @STSB  -  DEAL STATUS BEFORE UPDATE       *
     C*                    @TYPB  -  DEAL TYPE BEFORE UPDATE         *
     C*                    @DACCB -  DEAL BCAE BEFORE UPDATE         *
     C*                    @DEALB -  DEAL BCE BEFORE UPDATE          *
     C*                    @SPOTB -  DEAL SBCE BEFORE UPDATE         *
     C*                    @AMT1B -  DEAL FIRST AMOUNT BEFORE UPDATE *
     C*                    @AMT2B -  DEAL SECOND AMOUNT BEFORE UPDATE*
     C*                    @MGAMB -  Margin Amount Before Update     *    CAC001
     C*                    @D1YY  -  DATE FIELD - YEAR               *
     C*                    @D1MM  -  DATE FIELD - MONTH              *
     C*                    @D1DD  -  DATE FIELD - DAY                *
     C*                    @DATOB -  RELATED DEAL OPTION TO DATE     *
     C*                    @VDTOB -  RELATED DEAL VALUE DATE(CHAR)   *
     C*                    @VDOB5 -  RELATED DEAL VALUE DATE(NUM)    *
     C*                    @RDELB -  RELATED DEAL BCE BEFORE UPDATE  *
     C*                    @RDSPB -  RELATED DEAL SBCE BEFORE UPDATE *
     C*                    @RAM1B -  RELATED DEAL AMT 1 BEFORE UPDATE*
     C*                    @RAM2B -  RELATED DEAL AMT 2 BEFORE UPDATE*
     C*                    @RCUSB -  RELATED DEAL CUSTOMER SHORTNAME *
     C*                                                              *
     C*  CALLED BY :       #B MAIN PROCESSING                        *
     C*                                                              *
     C*  CALLS :           #BAA #BAB #BAC #BAD ZA0680                *
     C*                                                              *
     C****************************************************************
     C           #BA       BEGSR
     C*
     C** ACCESS FXDEALL RELATED DEAL TO SAVE FIELDS FOR ORIGINAL FIRST
     C** AND SECOND AMOUNTS (ONLY IF INSERTING A TAKEDOWN)
     C           F3DTYP    IFEQ 'T'                        B1
     C           F3LACT    ANDEQ'I'                        *1
     C                     MOVE F3DADN    @DLANO  60       *1
     C           @DLANO    CHAINFXDEAULL             63    *1
     C           *IN63     IFEQ '1'                        B*2
     C**  Set up error output for screen.
     C                     MOVEL@DLANO    DBKEY            ***************
     C                     MOVEL'FXDEAULL'DBFILE           * DB ERROR 007*
     C                     MOVEL'007'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BA9                       **2
     C                     END                             E*2
     C                     MOVE FHOOFA    @OOFA  150       *1
     C                     MOVE FHOOSA    @OOSA  150       *1
     C                     END                             E1
     C*
     C**  Check the deal type before accessing record to be locked.      E12279a
     C**  If it is a swap, and the associated deal number is lower       E12279a
     C**  than the deal number, check the action to be performed.        E12279a
     C**  If the action is amend or delete, chain the deals file for     E12279a
     C**  the associated deal as well as for the deal.                   E12279a
     C                     MOVE F3DADN    @DLANO                         E12279a
     C           F3DTYP    IFEQ 'S'                        B1            E12279a
     C           @DLANO    ANDLTF3DN38                     *1            E12279a
     C           F3LACT    IFEQ 'A'                        B*2           E12279a
     C           F3LACT    OREQ 'D'                        **2           E12279a
     C           @DLANO    CHAINFXDEAULL             63    **2           E12279a
     C           *IN63     IFEQ '1'                        B**3          E12279a
     C*                                                                  E12279a
     C**  Set up error output for screen.                                E12279a
     C                     MOVEL@DLANO    DBKEY            **************E12279a
     C                     MOVEL'FXDEAULL'DBFILE           * DBERROR 043 E12279a
     C                     MOVEL'043'     DBASE            **************E12279a
     C                     MOVE '1'       *INU7            ***3          E12279a
     C                     MOVE '1'       *INU8            ***3          E12279a
     C                     GOTO #BA9                       ***3          E12279a
     C                     END                             E**3          E12279a
     C*                                                                  E12279a
     C**  Update record with no changes to lock it.                      E12279a
     C                     UPDATFXDEALP0                   **2           E12279a
     C*                                                                  E12279a
     C                     END                             E*2           E12279a
     C                     END                             E1            E12279a
     C*
     C** ACCESS FXDEALL
     C           F3DN38    CHAINFXDEAULL             60
     C*                                                                   082738
     C** Update parameter for new enquiry update program AOOUFXU0         082738
     C** with the deal details before they are changed in any way.        082738
     C                     MOVEL@FXDL     Z#BSTS                          082738
     C*                                                                   082738
     C           *IN60     IFEQ '1'                        B1
     C           F3LACT    ANDNE'I'                        *1
     C**  Set up error output for screen.
     C                     MOVELF3DN38    DBKEY            ***************
     C                     MOVEL'FXDEAULL'DBFILE           * DB ERROR 008*
     C                     MOVEL'008'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #BA9                       *1
     C                     END                             E1
     C*
     C** IF ACTION EQ 'I'
     C           F3LACT    IFEQ 'I'                        B1
     C           *IN60     IFEQ '0'                        B*2
     C           FHDLTF    ANDNE'*'                        **2
     C**  Set up error output for screen.
     C                     MOVELF3DN38    DBKEY            ***************
     C                     MOVEL'FXDEAULL'DBFILE           * DB ERROR 009*
     C                     MOVEL'009'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BA9                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF LAST ACTION EQUALS 'I'
     C           F3LACT    IFEQ 'I'                        B1
     C                     MOVE *BLANKS   @SCUS            *1
     C                     MOVE *BLANKS   @CCY1B           *1
     C                     MOVE *BLANKS   @CCY2B           *1
     C                     MOVE *BLANKS   @ACTB            *1
     C                     MOVE *BLANKS   @STSB            *1
     C                     MOVE *BLANKS   @TYPB            *1
     C*
     C                     Z-ADD*ZEROS    @DACCB           *1
     C                     Z-ADD*ZEROS    @DEALB           *1
     C                     Z-ADD*ZEROS    @SPOTB           *1
     C                     Z-ADD*ZEROS    @AMT1B           *1
     C                     Z-ADD*ZEROS    @AMT2B           *1
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADD*ZEROS    @MGAMB           *1             CAC001
     C                     ENDIF                                          CAC001
     C                     END                             E1
     C*
     C** IF LAST ACTION NOT 'I'
     C           F3LACT    IFNE 'I'                        B1
     C*
     C** SAVE CERTAIN FIELDS FROM BEFORE UPDATE
     C*
     C** SAVE CUSTOMER SHORTNAME BEFORE UPDATE
     C                     MOVE FHDCSN    @SCUS  10        *1
     C*
     C** SAVE DEAL BASE CCY FOR ACCOUNTING EQUIVALENT BEFORE UPDATE
     C                     MOVE FHBCAE    @DACCB 150       *1
     C*
     C** SAVE DEAL BASE CCY FOR DEALING EQUIVALENT BEFORE UPDATE
     C                     MOVE FHBCDE    @DEALB 150       *1
     C*
     C** SAVE DEAL SPOT BASE CCY FOR DEALING EQUIVALENT BEFORE UPDATE
     C                     MOVE FHDSBE    @SPOTB 150       *1
     C*
     C** SAVE DEAL 1ST AND 2ND AMOUNTS BEFORE UPDATE
     C                     MOVE FHDAM1    @AMT1B 150       *1
     C                     MOVE FHDAM2    @AMT2B 150       *1
      *                                                                   CAC001
      ** Save margin amount before update                                 CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     Z-ADDFHMGAM    @MGAMB 130       *1             CAC001
     C                     ENDIF                                          CAC001
     C*
     C** SAVE DEAL 1ST AND 2ND CCY BEFORE UPDATE
     C                     MOVE FHCCY1    @CCY1B  3        *1
     C                     MOVE FHCCY2    @CCY2B  3        *1
     C*
     C** SAVE DEAL LAST ACTION BEFORE UPDATE
     C                     MOVE FHLACT    @ACTB   1        *1
     C*
     C** SAVE DEAL STATUS BEFORE UPDATE
     C                     MOVE FHDSTS    @STSB   1        *1
     C*
     C** SAVE DEAL TYPE BEFORE UPDATE
     C                     MOVE FHDTYP    @TYPB   1        *1
     C*
     C** SET UP BEFORE UPDATE PART OF STANDARD DEAL
     C                     MOVE FHORCM    F3BORM           *1
     C                     MOVE FHMORI    F3BORI           *1
     C                     MOVE FHMCPI    F3BCPI           *1
     C                     MOVE FHMOPM    F3BOPM           *1
     C                     MOVE FHMOPI    F3BOPI           *1
     C                     MOVE FHMCRI    F3BCRI           *1
     C                     MOVE FHROBR    F3BROB           *1             S01117
     C                     MOVE FHPOBR    F3BPOB           *1             S01117
     C/COPY WNCPYSRC,FX0320C004
     C*
     C** BUY AND SELL AMOUNT AND CCY
     C           FHDAM1    IFGE 0                          B*2
     C                     MOVE FHDAM1    F3DBUY           **2
     C                     MOVE FHCCY1    F3BBCY           **2
     C                     MOVE FHDAM2    F3DSEL           **2
     C                     MOVE FHCCY2    F3BSCY           **2
     C                     ELSE                            X*2
     C                     MOVE FHDAM1    F3DSEL           **2
     C                     MOVE FHCCY1    F3BSCY           **2
     C                     MOVE FHDAM2    F3DBUY           **2
     C                     MOVE FHCCY2    F3BBCY           **2
     C                     END                             E*2
     C*
     C                     MOVE FHDCNO    F3BCNM           *1
     C*
     C** VALUE DATE
     C                     MOVE FHVDDD    @D1DD            *1
     C                     MOVE FHVDMM    @D1MM            *1
     C                     MOVE FHVDYY    @D1YY            *1
     C                     MOVE DATE1     F3BVDT           *1
     C*
     C** OPTION DATE
     C                     MOVE FHDOED    @D1DD            *1
     C                     MOVE FHDOEM    @D1MM            *1
     C                     MOVE FHDOEY    @D1YY            *1
     C                     MOVE DATE1     F3BOTD           *1
     C                     END                             E1
     C*
     C** FXP0215  SET UP SUPPLEMENTARY PART OF STANDARD DEAL FILE
     C** NON RELATED DEAL DEPENDANT FIELDS ONLY AND OPTION FIRST AND SECOND
     C** ORIGINAL AMOUNTS
     C                     EXSR #BAA
     C           *INU7     IFEQ '1'                        B1
     C                     GOTO #BA9                       *1
     C                     END                             E1
     C*
     C** UPDATE FXDEALLS AS PER FXR0009
     C                     EXSR #BAC
     C           *INU7     IFEQ '1'                        B1
     C                     GOTO #BA9                       *1
     C                     END                             E1
     C*                                                                   154448
     C* BEFORE/AFTER status of related deal for AOOUFXU0                  154448
     C*
     C                     MOVEL*BLANK    Z#WSTS                          082738
     C                     MOVEL*BLANK    Z#XSTS                          154448
     C*                                                                   082738
     C** RELATED DEAL PROCESSING
     C           F3DTYP    IFEQ 'S'                        B1
     C           F3DTYP    OREQ 'T'                        *1
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CCP1                                           S01408
     C*                                                                   S01408
     C*
     C** ACCESS FXDEALL USING ASSOCIATED DEAL NUMBER
     C                     MOVE F3DADN    @DLANO  60       *1
     C           @DLANO    CHAINFXDEAULL             63    *1
     C*                                                                   082738
     C***Update*parameter*for*new enquiry update program AOOUFXU0  082738 154448
     C***with*the*associated*deal's details(e.g the other leg of th082738 154448
     C***Swap)*before*they*are*changed in any way for DELETE.      082738 154448
     C***********F3DTYP    IFEQ 'S'                        B*2     082738 154448
     C***********F3LACT    ANDEQ'D'                        B*2     082738 154448
      *                                                                   154448
      * BEFORE status of related deal for AOOUFXU0                        154448
      *                                                                   154448
     C           *IN63     IFEQ '0'                        B*2            154448
     C                     MOVEL@FXDL     Z#WSTS           **2            082738
     C                     END                             E*2            082738
     C*                                                                   082738
     C           *IN63     IFEQ '1'                        B*2
     C**  Set up error output for screen.
     C                     MOVEL@DLANO    DBKEY            ***************
     C                     MOVEL'FXDEAULL'DBFILE           * DB ERROR 010*
     C                     MOVEL'010'     DBASE            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #BA9                       **2
     C                     END                             E*2
     C*
     C** SAVE RELATED DEAL OPTION TO DATE BEFORE UPDATE
     C                     MOVE FHDOEY    @D1YY            *1
     C                     MOVE FHDOEM    @D1MM            *1
     C                     MOVE FHDOED    @D1DD            *1
     C                     MOVE DATE1     @DATOB  80       *1
     C*
     C** SAVE RELATED DEAL VALUE DATE BEFORE UPDATE
     C                     MOVE FHVDYY    @D1YY            *1
     C                     MOVE FHVDMM    @D1MM            *1
     C                     MOVE FHVDDD    @D1DD            *1
     C                     MOVE DATE1     @VDTOB  80       *1
     C*
     C** CONVERT VALUE DATE ABOVE TO 5N
     C                     MOVE @VDTOB    @@DTIN           *1
     C           @@DTIN    IFNE *ZEROS                     B*2
     C                     EXSR ZA0680                     **2
     C           *INU7     IFEQ '1'                        B**3
     C                     GOTO #BA9                       ***3
     C                     END                             E**3
     C                     MOVE @@MDNO    @VDOB5  50       **2
     C                     ELSE                            X*2
     C                     MOVE *ZEROS    @VDOB5           **2
     C                     END                             E*2
     C*
     C** SAVE RELATED DEAL DEALT BCE BEFORE UPDATE
     C                     MOVE FHBCDE    @RDELB 150       *1
     C*
     C** SAVE RELATED DEAL DEALT SPOT BCE BEFORE UPDATE
     C                     MOVE FHDSBE    @RDSPB 150       *1
     C*
     C** SAVE RELATED DEAL 1ST AMOUNT BEFORE UPDATE
     C                     MOVE FHDAM1    @RAM1B 150       *1
     C*
     C** SAVE RELATED DEAL 2ND AMOUNT BEFORE UPDATE
     C                     MOVE FHDAM2    @RAM2B 150       *1
     C*
     C** SAVE RELATED DEAL CUSTOMER SHORT NAME
     C*****                MOVE FHDCSN    @RCUSB 10        *1             E17654
     C**********           MOVE FHDCNO    @RCUSB  60       *1                        E17654 BUG11679
     C                     MOVE FHDCNO    @RCUSB  6        *1                               BUG11679
     C*
     C** UPDATE SUPPLEMENTARY PART OF STANDARD DEAL
     C** REALATED DEAL DEPENDANT FIELDS ONLY
     C                     EXSR #BAB                       *1
     C           *INU7     IFEQ '1'                        B*2
     C                     GOTO #BA9                       **2
     C                     END                             E*2
     C*
     C** UPDATE RELATED DEAL PART OF SUPPLEMENTARY DEAL
     C                     Z-ADDFHORCM    F3RORM           *1
     C                     MOVE FHMORI    F3RORI           *1
     C                     MOVE FHMCPI    F3RCPI           *1
     C                     MOVE FHMOPM    F3ROPM           *1
     C                     MOVE FHMOPI    F3ROPI           *1
     C                     MOVE FHMCRI    F3RCRI           *1
     C                     Z-ADDFHDBUY    F3RBAT           *1
     C                     Z-ADDFHDSEL    F3RSAT           *1
     C           FHDAM1    IFGE 0                          B*2
     C                     MOVE FHCCY1    F3RBCY           **2
     C                     MOVE FHCCY2    F3RSCY           **2
     C                     ELSE                            X*2
     C                     MOVE FHCCY2    F3RBCY           **2
     C                     MOVE FHCCY1    F3RSCY           **2
     C                     END                             E*2
     C                     MOVE FHDCNO    F3RCNM           *1
     C                     MOVE FHVDYY    @D1YY            *1
     C                     MOVE FHVDMM    @D1MM            *1
     C                     MOVE FHVDDD    @D1DD            *1
     C                     MOVE DATE1     F3RVDT           *1
     C                     MOVE FHDOEY    @D1YY            *1
     C                     MOVE FHDOEM    @D1MM            *1
     C                     MOVE FHDOED    @D1DD            *1
     C                     MOVE DATE1     F3ROTD           *1
     C*
     C** UPDATE RELATED DEAL DETAILS FXR0019
     C                     EXSR #BAD                       *1
      *                                                                   154448
      * AFTER status of related deal for AOOUFXU0                         154448
      *                                                                   154448
     C                     MOVEL@FXDL     Z#XSTS                          154448
     C                     END                             E1
     C/COPY WNCPYSRC,FX0320C002
     C           #BA9      ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BAA  UPDATE SUPPLEMENTARY PART OF STANDARD DEAL*
     C*                    NON RELATED DEAL DEPENDANT FIELDS ONLY    *
     C*                                                              *
     C*  FIELDS USED :     @BUYC  -  BUY CURRENCY                    *
     C*                    @SELC  -  SELL CURRENCY                   *
     C*                    @WK6   -  WORK FIELD                      *
     C*                    @IN    -  INPUT FIELD FOR #ZB             *
     C*                    @OUT   -  OUTPUT FIELD FROM #ZB           *
     C*                    @WK8   -  WORK FIELD                      *
     C*                    @OOFA  -  OPTION ORIGINAL FIRST AMOUNT    *
     C*                    @OOSA  -  OPTION ORIGINAL SECOND AMOUNT   *
     C*                                                              *
     C*  CALLED BY :       #BA UPDATE DEALS FILE                     *
     C*                                                              *
     C*  CALLS :           #ZB                                       *
     C*                                                              *
     C****************************************************************
     C           #BAA      BEGSR
     C*
     C** CLEAR DEAL RECORD FIELDS FOR NEW DEAL
     C           F3LACT    IFEQ 'I'                        B1
     C                     MOVE *BLANKS   FHDCSN           *1
     C                     MOVE *BLANKS   FHBROK           *1
     C                     MOVE *BLANKS   FHBKCY           *1
     C                     MOVE *BLANKS   FHDORM           *1
     C                     MOVE *BLANKS   FHDORI           *1
     C                     MOVE *BLANKS   FHMORI           *1
     C                     MOVE *BLANKS   FHMCPI           *1
     C                     MOVE *BLANKS   FHMCRI           *1
     C                     MOVE *BLANKS   FHMFAO           *1
     C                     MOVE *BLANKS   FHMOPI           *1
     C                     MOVE *BLANKS   FHDOPM           *1
     C                     MOVE *BLANKS   FHDOPI           *1
     C                     MOVE *BLANKS   FHDCPI           *1
     C                     MOVE *BLANKS   FHDCRI           *1
     C                     MOVE *BLANKS   FHDFAC           *1
     C                     MOVE *BLANKS   FHBKCY           *1
     C                     MOVE *ZEROS    FHBRKG           *1
     C                     MOVE *ZEROS    FHORCM           *1
     C                     MOVE *ZEROS    FHMOPM           *1
     C*********************MOVE *ZEROS    FHMBRC           *1             S01117
     C                     MOVE *ZEROS    FHMBCA           *1             S01117
     C                     MOVE *ZEROS    FHDBRC           *1
     C                     MOVE *ZEROS    FHDCNO           *1
     C                     END                             E1
     C*
     C** CUSTOMER NUMBER
     C           F3CNUM    IFEQ *ZEROS                     B1
     C           F3DCSN    ANDNE*BLANKS                    *1
     C           F3DCSN    IFNE FHDCSN                     B*2
     C*
     C** ACCESS SNAME USING DEAL CUSTOMER SHORTNAME
     C***********F3DCSN****CHAINFDCSNMLL             63    **2            S01194
     C************IN63*****IFEQ '1'                        B**3           S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD                           LN0391
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM F3DCSN    @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C**  Set up error output for screen.
     C                     MOVELF3DCSN    DBKEY            ***************
     C*********************MOVEL'FDCSNMLL'DBFILE           * DB ERROR 011*S01194
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERROR 011 *S01194
     C                     MOVEL'011'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     EXSR *PSSR                      **2            S01194
     C                     GOTO #BAA9                      ***3
     C                     END                             E**3
     C*********************MOVE CNUM      F3CNUM           **2            S01194
     C                     MOVE BBCUST    F3CNUM           **2            S01194
     C                     ELSE                            X*2
     C                     MOVE FHDCNO    F3CNUM           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** BROKER CURRENCY
     C           F3BROK    IFNE *BLANKS                    B0.5           E13902
     C           F3BROK    IFEQ 'PHON'                     B1
     C           F3BROK    OREQ 'TELX'                     *1
     C           F3BROK    OREQ 'MAIL'                     *1
     C           F3BROK    OREQ 'SWAP'                     *1
     C********** F3BROK    OREQ *BLANKS                    *1             E13902
     C                     MOVE *BLANKS   F3BKCY           *1
     C**********           MOVE *ZEROS    F3BRKG           *1             E13902
     C                     MOVE *ALL'9'   F3BRKG           *1             E13902
     C                     ELSE                            X1
     C           F3BKCY    IFEQ *BLANKS                    B*2
     C           F3BROK    IFNE FHBROK                     B**3
     C*
     C***ACCESS*TABLET1*USING*DEAL*BROKER*CODE*****                       S01194
     C*********************MOVE *BLANKS   KEY              ***3           S01194
     C*********************MOVEL'80'      KEY              ***3           S01194
     C*********************MOVE F3BROK    KEY              ***3           S01194
     C***********KEY*******CHAINFDBRKRLL             63    ***3           S01194
     C************IN63*****IFEQ '1'                        B***4          S01194
     C** ACCESS BROKER FILE VIA ACCESS PROGRAM                            S01194
     C                     CALL 'AOBROKR0'                 ***3           S01194
     C*********************PARM '*DBERR ' @RTCD            ***3    S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            ***3           LN0391
     C                     PARM '*KEY   ' @OPTN            ***3           S01194
     C*********************PARM*F3BROK****@BQTX***************3*****S01194S01319
     C                     PARM F3BROK    @BQTX   4        ***3           S01319
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B***4          S01194
     C**  Set up error output for screen.
     C*********************MOVELKEY       DBKEY            ***************S01194
     C*********************MOVEL'FDBRKRLL'DBFILE           * DB ERROR 012*S01194
     C                     MOVELF3BROK    DBKEY            ***************S01194
     C                     MOVEL'SDBROKPD'DBFILE           * DBERROR 012 *S01194
     C                     MOVEL'012'     DBASE            ***************
     C                     MOVE '1'       *INU7            ****4
     C                     MOVE '1'       *INU8            ****4
     C                     EXSR *PSSR                      ****4          S01194
     C                     GOTO #BAA9                      ****4
     C                     END                             E***4
     C*********************MOVE BKCY      F3BKCY           ***3           S01194
     C                     MOVE A9BRCY    F3BKCY           ***3           S01194
     C                     ELSE                            X**3
     C                     MOVE FHBKCY    F3BKCY           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C                     END                             E0.5           E13902
     C*
     C** DEAL MIDAS BRANCH CODE
     C***********F3MBRC****IFEQ *ZEROS                     B1             S01117
     C           F3MBCA    IFEQ *ZEROS                     B1             S01117
     C           F3DBRC    IFNE FHDBRC                     B*2
     C*
     C***ACCESS*FDBSNCLL*USING*DEAL*BRANCH*CODE**                         S01194
     C***********F3DBRC****CHAINFDBSNCLL             63    **2            S01194
     C************IN63*****IFEQ '1'                        B**3           S01194
     C** ACCESS BRANCH DETAILS VIA ACCESS PROGRAM                         S01194
     C**********           CALL 'AOBRCHR0'                 **2            S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C*********************PARM '*DBERR ' @RTCD   7        **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD   7        **2            LN0391
     C                     PARM '*KEY   ' @OPTN   7        **2            S01194
     C                     PARM F3DBRC    @DSNB   3        **2            S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B***3          S01194
     C**  Set up error output for screen.
     C                     MOVELF3DBRC    DBKEY            ***************
     C*********************MOVEL'FDBSNCLL'DBFILE           * DB ERROR 013*S01194
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERROR 013 *S01194
     C                     MOVEL'013'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     EXSR *PSSR                      ****4          S01194
     C                     GOTO #BAA9                      ***3
     C                     END                             E**3
     C*********************MOVE KEY       F3MBRC           **2E12441E13208S01194
     C                     MOVE F3BROK    F3MBCA           **2     S01194 S01117
     C******************** MOVE BRCD      F3MBRC           **2     E12441 E13208
     C                     ELSE                            X*2
     C*********************MOVE FHMBRC    F3MBRC           **2            S01117
     C                     MOVE FHMBCA    F3MBCA           **2            S01117
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR RECEIVE METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3ORCM    IFEQ *ZEROS                     B1
     C           F3DORM    IFNE FHDORM                     B*2
     C           F3DORM    IFEQ 'NA'                       B**3
     C           F3DORM    OREQ *BLANKS                    ***3
     C                     Z-ADD0         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'TELX '                    B**3
     C                     Z-ADD1         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'CHIPS'                    B**3
     C                     Z-ADD7         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'SWIFT'                    B**3
     C                     Z-ADD8         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'CSENT'                    B**3
     C                     Z-ADD2         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'CCOLL'                    B**3
     C                     Z-ADD12        F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'COMP '                    B**3
     C                     Z-ADD3         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'PCURR'                    B**3
     C                     Z-ADD4         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'CURR '                    B**3
     C                     Z-ADD14        F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'MACC '                    B**3
     C                     Z-ADD5         F3ORCM           ***3
     C                     END                             E**3
     C           F3DORM    IFEQ 'SUSP '                    B**3
     C                     Z-ADD6         F3ORCM           ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE FHORCM    F3ORCM           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C*
     C           F3MORI    IFEQ *BLANKS                    B1
     C           F3MORI    OREQ '00'                       *1             S01136
     C*
     C           F3DORI    IFNE FHDORI                     B*2
     C           F3DORM    ORNE FHDORM                     **2
     C           @BUYC     ORNE F3BBCY                     **2
     C*
     C           F3DORM    IFNE 'TELX '                    B**3
     C           F3DORM    ANDNE'CHIPS'                    ***3
     C           F3DORM    ANDNE'SWIFT'                    ***3
     C           F3DORM    ANDNE'CCOLL'                    ***3
     C           F3DORM    ANDNE'CSENT'                    ***3
     C           F3DORM    ANDNE'PCURR'                    ***3
     C           F3DORI    ANDNE'NODEF'                    ***3
     C                     MOVE F3DORI    F3MORI           ***3
     C                     END                             E**3
     C*
     C           F3DORM    IFEQ 'TELX'                     B**3
     C           F3DORM    OREQ 'CHIPS'                    ***3
     C           F3DORM    OREQ 'SWIFT'                    ***3
     C           F3DORM    OREQ 'CCOLL'                    ***3
     C           F3DORM    OREQ 'CSENT'                    ***3
     C*
     C*********************MOVE *BLANKS   NOSN             ***3           S01194
     C***********          MOVE *BLANKS   A7NONB           ***3           S01194
     C*
     C***ACCESS*FDNOSTLL*USING*DEAL*BRANCH*CODE***                        S01194
     C***********KEY3******KLIST                           ***3           S01194
     C*********************KFLD           CSNM             ***3           S01194
     C*********************KFLD           CCY              ***3           S01194
     C*********************KFLD           PNOI             ***3           S01194
     C*********************MOVELF3DORI    CSNM             ***3           S01194
     C*********************MOVE @BUYC     CCY              ***3           S01194
     C*********************MOVE 'P'       PNOI             ***3           S01194
     C***********KEY3******CHAINFDNOSTLL             63    ***3           S01194
     C** ACCESS NOSTRO DETAILS USING DEAL BRANCH CODE                     S01194
     C                     MOVELF3DORI    @CSSN            ***3           S01194
     C                     CALL 'AONOSTR0'                 ***3           S01194
     C                     PARM '*MSG   ' @RTCD            ***3           S01194
     C                     PARM '*KEY   ' @OPTN            ***3           S01194
     C                     PARM *BLANKS   @CUST   6        ***3           S01194
     C***********          PARM @BUYC     @CYCD   3        ***3    S01194 CEU003
     C                     PARM @BESC     @CYCD   3        ***3           CEU003
     C**********           PARM *BLANKS   @ACCD   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        ***3           S01194
     C                     PARM *BLANKS   @NONB   2        ***3           S01194
     C                     PARM *BLANKS   @BRCD   3        ***3           S01194
     C                     PARM           @CSSN  10        ***3           S01194
     C                     PARM 'P'       @PNOI   1        ***3           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*
     C***IF*ACCESS*FAILS*THEN*USE*BLANK*PNOI***                           S01194
     C************IN63*****IFEQ '1'                        B***4          S01194
     C*********************MOVE ' '       PNOI             ****4          S01194
     C***********KEY3******CHAINFDNOSTLL             63    ****4          S01194
     C** IF ACCESS FAILS THEN USE BLANK PRIME NOSTRO INDICATOR            S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B***4          S01194
     C************         MOVE ' '       A7PNOI           ****4          S01194
     C                     CALL 'AONOSTR0'                 ****4          S01194
     C                     PARM '*MSG   ' @RTCD            ****4          S01194
     C                     PARM '*KEY   ' @OPTN            ****4          S01194
     C                     PARM *BLANKS   @CUST   6        ***3           S01194
     C***********          PARM @BUYC     @CYCD   3        ***3    S01194 CEU003
     C                     PARM @BESC     @CYCD   3        ***3           CEU003
     C**********           PARM *BLANKS   @ACCD   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        ***3           S01194
     C                     PARM *BLANKS   @NONB   2        ***3           S01194
     C                     PARM *BLANKS   @BRCD   3        ***3           S01194
     C                     PARM           @CSSN  10        ***3           S01194
     C                     PARM *BLANKS   @PNOI   1        ***3           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C                     END                             E***4
     C************IN63     IFEQ '1'                        B***4    E12334S01194
     C           @RTCD     IFNE *BLANK                     B***4          S01194
     C                     MOVE *BLANKS   F3MORI           ****4          E12334
     C                     ELSE                            E***4          E12334
     C*********************MOVELNOSN      F3MORI           ****4          S01194
     C                     MOVELA7NONB    F3MORI           ****4          S01194
     C                     END                             E***4          E12334
     C                     END                             E**3
     C*
     C           F3DORM    IFEQ 'PCURR'                    B**3
     C                     MOVELF3CNUM    F3MORI           ***3
     C*********************MOVELCADC      @WK6    6        ***3           S01194
     C**********           MOVELBMACCD    @WK6    6        ***3                        S01194 CGL029
     C                     MOVELBMACCD    @WK6   12                                           CGL029
     C                     MOVE '01'      @WK6             ***3
     C                     MOVE @WK6      F3MORI           ***3
     C                     END                             E**3
     C*
     C           F3DORI    IFEQ 'NODEF'                    B**3
     C                     MOVE *BLANKS   F3MORI           ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE FHMORI    F3MORI           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR PAY METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3DMPM    IFEQ *ZEROS                     B1
     C           F3DOPM    IFNE FHDOPM                     B*2
     C           F3DOPM    IFEQ 'NA'                       B**3
     C           F3DOPM    OREQ *BLANKS                    ***3
     C                     Z-ADD0         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'TELX '                    B**3
     C                     Z-ADD1         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'CHIPS'                    B**3
     C                     Z-ADD7         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'SWIFT'                    B**3
     C                     Z-ADD8         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'CSENT'                    B**3
     C                     Z-ADD2         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'CCOLL'                    B**3
     C                     Z-ADD12        F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'COMP '                    B**3
     C                     Z-ADD3         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'PCURR'                    B**3
     C                     Z-ADD4         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'CURR '                    B**3
     C                     Z-ADD14        F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'MACC '                    B**3
     C                     Z-ADD5         F3DMPM           ***3
     C                     END                             E**3
     C           F3DOPM    IFEQ 'SUSP '                    B**3
     C                     Z-ADD6         F3DMPM           ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C                     MOVE FHMOPM    F3DMPM           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3MOPI    IFEQ *BLANKS                    B1
     C           F3MOPI    OREQ '00'                       *1             S01136
     C*
     C           F3DOPI    IFNE FHDOPI                     B*2
     C           F3DOPM    ORNE FHDOPM                     **2
     C           @SELC     ORNE F3BSCY                     **2
     C*
     C           F3DOPM    IFNE 'TELX '                    B**3
     C           F3DOPM    ANDNE'CHIPS'                    ***3
     C           F3DOPM    ANDNE'SWIFT'                    ***3
     C           F3DOPM    ANDNE'CCOLL'                    ***3
     C           F3DOPM    ANDNE'CSENT'                    ***3
     C           F3DOPM    ANDNE'PCURR'                    ***3
     C           F3DOPI    ANDNE'NODEF'                    ***3
     C                     MOVE F3DOPI    F3MOPI           ***3
     C                     END                             E**3
     C*
     C           F3DOPM    IFEQ 'TELX'                     B**3
     C           F3DOPM    OREQ 'CHIPS'                    ***3
     C           F3DOPM    OREQ 'SWIFT'                    ***3
     C           F3DOPM    OREQ 'CCOLL'                    ***3
     C           F3DOPM    OREQ 'CSENT'                    ***3
     C*
     C*********************MOVE *BLANKS   NOSN             ***3           S01194
     C************         MOVE *BLANKS   A7NONB           ***3           S01194
     C*
     C***ACCESS*FDNOSTLL*USING*DEAL*BRANCH*CODE**                         S01194
     C*********************MOVELF3DOPI    CSNM             ***3           S01194
     C*********************MOVE @SELC     CCY              ***3           S01194
     C*********************MOVE 'P'       PNOI             ***3           S01194
     C***********KEY3******CHAINFDNOSTLL             63    ***3           S01194
     C** ACCESS NOSTRO DETAILS USING DEAL BRANCH CODE                     S01194
     C                     MOVELF3DOPI    @CSSN            ***3           S01194
     C                     CALL 'AONOSTR0'                 ***3           S01194
     C                     PARM '*MSG   ' @RTCD            ***3           S01194
     C                     PARM '*KEY   ' @OPTN            ***3           S01194
     C                     PARM *BLANKS   @CUST   6        ***3           S01194
     C***********          PARM @SELC     @CYCD   3        ***3    S01194 CEU003
     C                     PARM @SESC     @CYCD   3        ***3           CEU003
     C*********            PARM *BLANKS   @ACCD   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        ***3           S01194
     C                     PARM *BLANKS   @NONB   2        ***3           S01194
     C                     PARM *BLANKS   @BRCD   3        ***3           S01194
     C                     PARM           @CSSN  10        ***3           S01194
     C                     PARM 'P'       @PNOI   1        ***3           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*
     C***IF*ACCESS*FAILS*THEN*USE*BLANK*PNOI***                           S01194
     C************IN63*****IFEQ '1'                        B***4          S01194
     C*********************MOVE ' '       PNOI             ****4          S01194
     C***********KEY3******CHAINFDNOSTLL             63    ****4          S01194
     C** IF ACCESS FAILS THEN USE BLANK PRIME NOSTRO INDICATOR            S01194
     C           @RTCD     IFNE *BLANKS                    B***4          S01194
     C*************        MOVE ' '       A7PNOI           ****4          S01194
     C                     CALL 'AONOSTR0'                 ****4          S01194
     C                     PARM '*MSG   ' @RTCD            ****4          S01194
     C                     PARM '*KEY   ' @OPTN            ****4          S01194
     C                     PARM *BLANKS   @CUST   6        ***3           S01194
     C***********          PARM @SELC     @CYCD   3        ***3    S01194 CEU003
     C                     PARM @SESC     @CYCD   3        ***3           CEU003
     C**********           PARM *BLANKS   @ACCD   4        ***3                        S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        ***3           S01194
     C                     PARM *BLANKS   @NONB   2        ***3           S01194
     C                     PARM *BLANKS   @BRCD   3        ***3           S01194
     C                     PARM           @CSSN  10        ***3           S01194
     C                     PARM *BLANKS   @PNOI   1        ***3           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C                     END                             E***4
     C************IN63*****IFEQ '1'                        B***4          E12334
     C           @RTCD     IFNE *BLANKS                    B***4          S01194
     C                     MOVE *BLANKS   F3MOPI           ****4          E12334
     C                     ELSE                            E***4          E12334
     C*********************MOVELNOSN      F3MOPI           ****4          S01194
     C                     MOVELA7NONB    F3MOPI           ****4          S01194
     C                     END                             E***4          E12334
     C                     END                             E**3
     C*
     C           F3DOPM    IFEQ 'PCURR'                    B**3
     C                     MOVELF3CNUM    F3MOPI           ***3
     C*********************MOVELCADC      @WK6    6        ***3           S01194
     C**********           MOVELBMACCD    @WK6    6        ***3                        S01194 CGL029
     C                     MOVELBMACCD    @WK6   12                                           CGL029
     C                     MOVE '01'      @WK6             ***3
     C                     MOVE @WK6      F3MOPI           ***3
     C                     END                             E**3
     C*
     C           F3DOPI    IFEQ 'NODEF'                    B**3
     C                     MOVE *BLANKS   F3MOPI           ***3
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C                     MOVE FHMOPI    F3MOPI           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS CUSTOMER PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3MCPI    IFEQ *BLANKS                    B1
     C           F3DCPI    IFNE FHDCPI                     B*2
     C           F3DCPI    IFEQ 'NODEF'                    B**3
     C           F3DCPI    OREQ *BLANKS                    ***3
     C                     MOVE *BLANKS   F3MCPI           ***3
     C                     GOTO #BAA1                      ***3
     C                     END                             E**3
     C*
     C** TEST DEAL CUST PAY INSTR IS A NUMBER
     C*
     C** REMOVE TRAILING BLANKS SO TESTN WORKS
     C                     MOVE F3DCPI    @IN              **2
     C                     EXSR #ZB                        **2
     C                     TESTN          @OUT       7979  **2
     C           *IN79     IFEQ '1'                        B**3
     C                     MOVE F3DCPI    F3MCPI           ***3
     C                     GOTO #BAA1                      ***3
     C                     END                             E**3
     C*
     C** ACCESS SNAME USING DEAL CUSTOMER PAY INSTR                       S01194
     C***********F3DCPI****CHAINFDCSNMLL             63    **2      S01133S01194
     C************IN63*****IFEQ '0'                        B**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C*********************PARM '*DBE   ' @RTCD            **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            **2            LN0391
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DCPI    @KEY1            **2            S01194
     C                     PARM *BLANKS   @KYST            **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C*********************MOVELCNUM      F3MCPI           ***3           S01194
     C                     MOVELBBCUST    F3MCPI           ***3           S01194
     C                     GOTO #BAA1                      ***3
     C                     END                             E**3
     C*
     C***ACCESS*TABLET2*VIA*FDSNAMLL*USING*DCPI***                        S01194
     C***********KEY4******KLIST                           **2            S01194
     C*********************KFLD           CSN1             **2            S01194
     C*********************KFLD           CSN2             **2            S01194
     C*********************MOVE *BLANKS   CSN1             **2            S01194
     C*********************MOVE *BLANKS   CSN2             **2            S01194
     C*********************MOVELF3DCPI    CSN1             **2            S01194
     C*********************MOVE F3DCPI    CSN2             **2            S01194
     C***********KEY4******CHAINFDSNAMLL             63    **2            S01194
     C************IN63*****IFEQ '1'                        B**3           S01194
     C** ACCESS NOSTRO DETAILS USING DCPI                                 S01194
     C                     CALL 'AOCNSTR0'                 **2            S01194
     C*********************PARM '*DBERR ' @RTCD            **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            **2            LN0391
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DCPI    @ARCD   8        **2            S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C**  Set up error output for screen.
     C                     MOVE F3DCPI    DBKEY            ***************
     C*********************MOVEL'FDSNAMLL'DBFILE           * DB ERROR 014*S01194
     C                     MOVEL'SDCNSTPD'DBFILE           * DBERROR 014 *S01194
     C                     MOVEL'014'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     EXSR *PSSR                      ***3           S01194
     C                     GOTO #BAA9                      ***3
     C                     END                             E**3
     C*                                                                   E13228
     C** MOVE COUNTER PARTY SHORT NAME TO PAY INSTRUCTION                 E13228
     C********             MOVE KEY       @WK8    8        **2            E13228
     C*********************MOVE CPSH      @WK8    8        **2      E13228S01194
     C                     MOVE AWCPNC    @WK8    8        **2            S01194
     C                     MOVEL@WK8      F3MCPI           **2
     C                     ELSE                            X*2
     C                     MOVE FHMCPI    F3MCPI           **2
     C                     END                             E*2
     C                     END                             E1
     C           #BAA1     TAG
     C*
     C** MIDAS CUSTOMER RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3MCRI    IFEQ *BLANKS                    B1
     C           F3DCRI    IFNE FHDCRI                     B*2
     C           F3DCRI    IFEQ 'NODEF'                    B**3
     C           F3DCRI    OREQ *BLANKS                    ***3
     C                     MOVE *BLANKS   F3MCRI           ***3
     C                     GOTO #BAA2                      ***3
     C                     END                             E**3
     C*
     C** TEST DEAL CUST RECEIVE INSTR IS A NUMBER
     C                     MOVE F3DCRI    @IN              **2
     C                     EXSR #ZB                        **2
     C                     TESTN          @OUT       7979  **2
     C           *IN79     IFEQ '1'                        B**3
     C                     MOVE F3DCRI    F3MCRI           ***3
     C                     GOTO #BAA2                      ***3
     C                     END                             E**3
     C*
     C** ACCESS SNAME USING DEAL CUSTOMER RECEIVE INSTR
     C***********F3DCRI    CHAINFDCSNMLL             63    **2            S01194
     C************IN63     IFEQ '0'                        B**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DCRI    @KEY1            **2            S01194
     C                     PARM *BLANKS   @KYST            **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C*********************MOVELCNUM      F3MCRI           ***3           S01194
     C                     MOVELBBCUST    F3MCRI           ***3           S01194
     C                     GOTO #BAA2                      ***3
     C                     END                             E**3
     C*
     C***ACCESS*TABLET2*VIA*FDSNAMLL*USING*DCRI***                        S01194
     C** ACCESS NOSTRO DETAILS VIA ACCESS PROGRAM USING DCRI              S01194
     C*********************MOVE *BLANKS   CSN1             **2            S01194
     C*********************MOVE *BLANKS   CSN2             **2            S01194
     C*********************MOVELF3DCRI    CSN1             **2            S01194
     C*********************MOVE F3DCRI    CSN2             **2            S01194
     C***********KEY4******CHAINFDSNAMLL             63    **2            S01194
     C************IN63*****IFEQ '1'                        B**3           S01194
     C                     CALL 'AOCNSTR0'                 **2            S01194
     C*********************PARM '*DBERR ' @RTCD            **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            **2            LN0391
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DCRI    @ARCD            **2            S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C**  Set up error output for screen.
     C                     MOVELF3DCRI    DBKEY            ***************
     C*********************MOVEL'FDSNAMLL'DBFILE           * DB ERROR 015*S01194
     C                     MOVEL'AOCNSTPD'DBFILE           * DBERROR 015 *S01194
     C                     MOVEL'015'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     EXSR *PSSR                      ***3           S01194
     C                     GOTO #BAA9                      ***3
     C                     END                             E**3
     C*                                                                   E13228
     C** MOVE COUNTER PARTY SHORT NAME TO RECEIVE INSTRUCTION             E13228
     C********             MOVE KEY       @WK8    8        **2            E13228
     C*********************MOVE CPSH      @WK8    8        **2      E13228S01194
     C                     MOVE AWCPNC    @WK8    8        **2            S01194
     C                     MOVEL@WK8      F3MCRI           **2
     C                     ELSE                            X*2
     C                     MOVE FHMCRI    F3MCRI           **2
     C                     END                             E*2
     C                     END                             E1
     C           #BAA2     TAG
     C*
     C** MIDAS FOR ACCOUNT OF
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           F3MFAC    IFEQ *BLANKS                    B1
     C           F3DFAC    IFNE FHDFAC                     B*2
     C           F3DFAC    IFEQ 'NODEF'                    B**3
     C           F3DFAC    OREQ *BLANKS                    ***3
     C                     MOVE *BLANKS   F3MFAC           ***3
     C                     GOTO #BAA3                      ***3
     C                     END                             E**3
     C*
     C** TEST DEAL FOR A/C OF IS A NUMBER
     C                     MOVE F3DFAC    @IN              **2
     C                     EXSR #ZB                        **2
     C                     TESTN          @OUT       7979  **2
     C           *IN79     IFEQ '1'                        B**3
     C                     MOVE F3DFAC    F3MFAC           ***3
     C                     GOTO #BAA3                      ***3
     C                     END                             E**3
     C*
     C** ACCESS SNAME USING DEAL FOR A/C OF
     C***********F3DFAC****CHAINFDCSNMLL             63    **2            S01194
     C************IN63*****IFEQ '0'                        B**3           S01194
     C                     CALL 'AOCUSTR0'                 **2            S01194
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DFAC    @KEY1            **2            S01194
     C                     PARM *BLANKS   @KYST            **2            S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C*********************MOVELCNUM      F3MFAC           ***3           S01194
     C                     MOVELBBCUST    F3MFAC           ***3           S01194
     C                     GOTO #BAA3                      ***3
     C                     END                             E**3
     C*
     C***ACCESS*TABLET2*VIA*FDSNAMLL*USING*DEAL*FOR*A/C*OF****            S01194
     C** ACCESS NOSTRO DETAILS USING DEAL FOR A/C OF                      S01194
     C*********************MOVE *BLANKS   CSN1             **2            S01194
     C*********************MOVE *BLANKS   CSN2             **2            S01194
     C*********************MOVELF3DFAC    CSN1             **2            S01194
     C*********************MOVE F3DFAC    CSN2             **2            S01194
     C***********KEY4******CHAINFDSNAMLL             63    **2            S01194
     C************IN63*****IFEQ '1'                        B**3           S01194
     C                     CALL 'AOCNSTR0'                 **2            S01194
     C*********************PARM '*DBERR ' @RTCD            **2     S01194 LN0391
     C                     PARM '*MSG   ' @RTCD            **2            LN0391
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM F3DFAC    @ARCD            **2            S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C**  Set up error output for screen.
     C                     MOVELF3DFAC    DBKEY            ***************
     C*********************MOVEL'FDSNAMLL'DBFILE           * DB ERROR 016*S01194
     C                     MOVEL'SDCNSTPD'DBFILE           * DBERROR 016 *S01194
     C                     MOVEL'016'     DBASE            ***************
     C                     MOVE '1'       *INU7            ***3
     C                     MOVE '1'       *INU8            ***3
     C                     EXSR *PSSR                      ***3           S01194
     C                     GOTO #BAA9                      ***3
     C                     END                             E**3
     C*                                                                   E13228
     C** MOVE COUNTER PARTY SHORT NAME TO FOR A/C OF                      E13228
     C********             MOVE KEY       @WK8    8        **2            E13228
     C*********************MOVE CPSH      @WK8    8        **2      E13228S01194
     C                     MOVE AWCPNC    @WK8    8        **2            S01194
     C                     MOVEL@WK8      F3MFAC           **2
     C                     ELSE                            X*2
     C                     MOVE FHMFAO    F3MFAC           **2
     C                     END                             E*2
     C                     END                             E1
     C           #BAA3     TAG
     C*
     C** OPTION - ORIGINAL FIRST AMOUNTS
     C           F3OOFA    IFEQ *ZEROS                     B1
     C*
     C** IF DEAL IS AN OPTION
     C           F3DTYP    IFEQ 'O'                        B*2
     C*
     C** AND DEAL IS AN INSERT
     C           F3LACT    IFEQ 'I'                        B**3
     C                     MOVE F3DAM1    F3OOFA           ***3
     C                     END                             E**3
     C*
     C** AND DEAL IS NOT AN INSERT
     C           F3LACT    IFNE 'I'                        B**3
     C*
     C** AND DEAL IS INCOMPLETE
     C           FHDSTS    IFEQ 'I'                        B***4
     C                     MOVE F3DAM1    F3OOFA           ****4
     C                     END                             E***4
     C*
     C** AND DEAL IS NOT INCOMPLETE
     C           FHDSTS    IFNE 'I'                        B***4
     C                     MOVE FHOOFA    F3OOFA           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF DEAL IS A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B*2
     C*
     C** AND DEAL IS AN INSERT
     C           F3LACT    IFEQ 'I'                        B**3
     C                     MOVE @OOFA     F3OOFA           ***3
     C                     END                             E**3
     C*
     C** AND DEAL IS NOT AN INSERT
     C           F3LACT    IFNE 'I'                        B**3
     C                     MOVE FHOOFA    F3OOFA           ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C** OPTION - ORIGINAL SECOND AMOUNTS
     C           F3OOSA    IFEQ *ZEROS                     B1
     C*
     C** IF DEAL IS AN OPTION
     C           F3DTYP    IFEQ 'O'                        B*2
     C*
     C** AND DEAL IS AN INSERT
     C           F3LACT    IFEQ 'I'                        B**3
     C                     MOVE F3DAM2    F3OOSA           ***3
     C                     END                             E**3
     C*
     C** AND DEAL IS NOT AN INSERT
     C           F3LACT    IFNE 'I'                        B**3
     C*
     C** AND DEAL IS INCOMPLETE
     C           FHDSTS    IFEQ 'I'                        B***4
     C                     MOVE F3DAM2    F3OOSA           ****4
     C                     END                             E***4
     C*
     C** AND DEAL IS NOT INCOMPLETE
     C           FHDSTS    IFNE 'I'                        B***4
     C                     MOVE FHOOSA    F3OOSA           ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF DEAL IS A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B*2
     C*
     C** AND DEAL IS AN INSERT
     C           F3LACT    IFEQ 'I'                        B**3
     C                     MOVE @OOSA     F3OOSA           ***3
     C                     END                             E**3
     C*
     C** AND DEAL IS NOT AN INSERT
     C           F3LACT    IFNE 'I'                        B**3
     C                     MOVE FHOOSA    F3OOSA           ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C                     END                             E1
     C***Set*up*extended*settlement*fields*for*the*PC***************S01227S01319
     C***********@FRBA*****IFEQ*'F'************************B1*******S01227S01319
     C*********************MOVELF3ORCM****F3RSTM************1*******S01227S01319
     C*********************MOVELF3MORI****F3RONS************1*******S01227S01319
     C*********************MOVELF3DMPM****F3PSTM************1*******S01227S01319
     C*********************MOVELF3MOPI****F3PONS************1*******S01227S01319
     C*********************MOVELF3SPEC****F3BTB1************1*******S01227S01319
     C*********************MOVELF3MCPI****F3RIBN************1*******S01227S01319
     C*********************MOVELF3MCRI****F3AWBN************1*******S01227S01319
     C*********************MOVELF3MFAC****F3BENN************1*******S01227S01319
     C*********************MOVE*'N'*******F3CVMR************1*******E22405S01319
     C*********************END*****************************E1*******S01227S01319
     C**************************************************************S01227S01319
     C           #BAA9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #ZB   PREPARES FIELD FOR TESTN                  *
     C*                    REMOVES TRAILING BLANKS                   *
     C*                                                              *
     C*  FIELDS USED :     @OUT   -  FIELD OUTPUT                    *
     C*                    @IP    -  INPUT INDEX                     *
     C*                    @END   -                                  *
     C*                    @STP   -  STOP FLAG                       *
     C*                    @IA    -  INPUT AMOUNT                    *
     C*                    @O     -  OUTPUT FIELD                    *
     C*                    @OP    -  OUTPUT INDEX                    *
     C*                                                              *
     C*  CALLED BY :       #BAA  UPDATE SUPPLEMENTARY STANDARD DEAL  *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #ZB       BEGSR
     C                     MOVE *BLANKS   @OUT
     C                     Z-ADD11        @IP     20
     C                     Z-ADD10        @END    20
     C                     MOVE 'N'       @STP    1
     C           @STP      DOWNE'Y'                        B1
     C           @IP       SUB  1         @IP              *1
     C           @IA,@IP   IFNE ' '                        B*2
     C                     MOVE 'Y'       @STP             **2
     C                     END                             E*2
     C                     END                             E1
     C                     Z-ADD10        @OP     20
     C                     MOVE 'N'       @STP    1
     C           @STP      DOWNE'Y'                        B1
     C                     MOVE @IA,@IP   @O,@OP           *1
     C           @IP       SUB  1         @IP              *1
     C           @OP       SUB  1         @OP              *1
     C           @IP       IFEQ 0                          B*2
     C                     MOVE 'Y'       @STP             **2
     C                     END                             E*2
     C                     END                             E1
     C           #ZB9      ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BAB  UPDATE SUPPLEMENTARY PART OF STANDARD DEAL*
     C*                    RELATED DEAL DEPENDANT FIELDS ONLY        *
     C*  FIELDS INPUT :                                              *
     C*                                                              *
     C*  FIELDS USED :                                               *
     C*                                                              *
     C*  CALLED BY :       #BA UPDATE DEALS FILE                     *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C*  FIELDS OUTPUT :                                             *
     C*                                                              *
     C****************************************************************
     C           #BAB      BEGSR
     C*
     C** OPTION DSBCE
     C           F3ODSB    IFEQ *ZEROS                     B1
     C*
     C** IF DEAL IS A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B*2
     C                     MOVE FHDSBE    F3ODSB           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** OPTION DBCE
     C           F3ODBE    IFEQ *ZEROS                     B1
     C*
     C** IF DEAL IS A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B*2
     C                     MOVE FHBCDE    F3ODBE           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C           @BAB9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #BAD  FXR0019  UPDATE RELATED DEALS FILE SCHEDULE
     C*                                                              *
     C*  FIELDS USED :     @CAMT1 -  CORRESPONDING AMOUNT 1          *
     C*                    @CAMT2 -  CORRESPONDING AMOUNT 2          *
     C*                    @CAMB1 -  CORRESPONDING AMOUNT 1 (BEFORE) *
     C*                    @CAMB2 -  CORRESPONDING AMOUNT 2 (BEFORE) *
     C*                    @MGAMB -  Margin Amount Before Update     *    CAC001
     C*                    @CCY1B -  CURRENCY 1 BEFORE UPDATE        *
     C*                    @AMT1B -  DEAL AMOUNT 1 BEFORE UPDATE     *
     C*                    @AMT2B -  DEAL AMOUNT 2 BEFORE UPDATE     *
     C*                    @ADJ1  -  ADJUSTMENT 1                    *
     C*                    @ADJ2  -  ADJUSTMENT 2                    *
     C*                    @ADJ3  -  ADJUSTMENT 3                    *
     C*                    @DACCB -  DEAL BCA BEFORE UPDATE          *
     C*                    @RUND  -  RUN DATE (DAY)                  *
     C*                    @RUNM  -  RUN DATE (MONTH)                *
     C*                    @RUNY  -  RUN DATE (YEAR)                 *
     C*                    @USER  -  USER FROM PSDS                  *
     C*                                                              *
     C*  CALLED BY :       #BA UPDATE DEALS FILE                     *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #BAD      BEGSR
     C*
     C** IF A SWAP
     C           F3DTYP    IFEQ 'S'                        B1
     C                     MOVE F3DN38    FHDADN           *1
     C           F3LACT    IFEQ 'D'                        B*2
     C                     MOVE 'D'       FHDDLT           **2
     C                     END                             E*2
     C                     MOVE 'S'       FHDTYP           *1
     C                     ENDIF                                                              242477
     C/COPY WNCPYSRC,FX0320C001
      *                                                                                       242477
      ** Only update deal type of the 1st leg, if deal type of the 2nd                        242477
      ** leg = 'SW'.                                                                          242477
      *                                                                                       242477
     C           F3DTYP    IFEQ 'S'                                                           242477
     C           F3TYPE    ANDEQ'SW'                                                          242477
     C                     MOVE 'SW'      FHTYPE           *1
     C                     END                             E1
     C*
     C** IF A TAKEDOWN
     C           F3DTYP    IFEQ 'T'                        B1
     C*
     C** IF AN INSERTION
     C           F3LACT    IFEQ 'I'                        B*2
     C*
     C** REDUCE AMOUNTS BY CORRESPONDING CURRENCY AMOUNTS
     C           FHCCY1    IFEQ F3CCY1                     B**3
     C           FHDAM1    SUB  F3DAM1    FHDAM1           ***3
     C           FHDAM2    SUB  F3DAM2    FHDAM2           ***3
     C                     ELSE                            X**3
     C           FHDAM1    SUB  F3DAM2    FHDAM1           ***3
     C           FHDAM2    SUB  F3DAM1    FHDAM2           ***3
     C                     END                             E**3
     C*
     C** REDUCE DEAL BASE CCY FOR ACCOUNTING EQUIVALENT
     C           FHBCAE    SUB  F3BCAE    FHBCAE           **2
      *                                                                   CAC001
      ** Reduce Margin Amount                                             CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           FHMGAM    SUB  F3MGAM    FHMGAM           **2            CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END                             E*2
     C*
     C** IF A DELETION
     C           F3LACT    IFEQ 'D'                        B*2
     C*
     C** INCREASE AMOUNTS BY CORRESPONDING CURRENCY AMOUNTS
     C           FHCCY1    IFEQ F3CCY1                     B**3
     C           FHDAM1    ADD  F3DAM1    FHDAM1           ***3
     C           FHDAM2    ADD  F3DAM2    FHDAM2           ***3
     C                     ELSE                            X**3
     C           FHDAM1    ADD  F3DAM2    FHDAM1           ***3
     C           FHDAM2    ADD  F3DAM1    FHDAM2           ***3
     C                     END                             E**3
     C*
     C** INCREASE DEAL BASE CCY FOR ACCOUNTING EQUIVALENT
     C           FHBCAE    ADD  F3BCAE    FHBCAE           **2
      *                                                                   CAC001
      ** Increase Margin Amount                                           CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           FHMGAM    ADD  F3MGAM    FHMGAM           **2            CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END                             E*2
     C*
     C** IF AN AMENDMENT
     C           F3LACT    IFEQ 'A'                        B*2
     C*
     C** ADJUST AMOUNTS
     C*
     C** STANDARD DEAL AMOUNTS CORRESPONDING TO DEAL AMOUNTS
     C           FHCCY1    IFEQ F3CCY1                     B**3
     C                     MOVE F3DAM1    @CAMT1 150       ***3
     C                     MOVE F3DAM2    @CAMT2 150       ***3
     C                     ELSE                            X**3
     C                     MOVE F3DAM2    @CAMT1           ***3
     C                     MOVE F3DAM1    @CAMT2           ***3
     C                     END                             E**3
     C*
     C** TAKEDOWN BEFORE AMOUNTS CORRESPONDING TO DEAL AMOUNTS
     C           FHCCY1    IFEQ @CCY1B                     B**3
     C                     MOVE @AMT1B    @CAMB1 150       ***3
     C                     MOVE @AMT2B    @CAMB2 150       ***3
     C                     ELSE                            X**3
     C                     MOVE @AMT2B    @CAMB1           ***3
     C                     MOVE @AMT1B    @CAMB2           ***3
     C                     END                             E**3
     C*
     C** CALCULATE ADJUSTMENTS
     C           @CAMB1    SUB  @CAMT1    @ADJ1  150       **2
     C           @CAMB2    SUB  @CAMT2    @ADJ2  150       **2
     C*
     C** MAKE ADJUSTMENTS TO DEAL AMOUNTS
     C           FHDAM1    ADD  @ADJ1     FHDAM1           **2
     C           FHDAM2    ADD  @ADJ2     FHDAM2           **2
     C*
     C** CALCULATE ADJUSTMENTS FOR DBCA
     C*
     C           @DACCB    SUB  F3BCAE    @ADJ3  150       **2
     C*
     C*  MAKE ADJUSTMENT TO DBCA
     C           FHBCAE    ADD  @ADJ3     FHBCAE           **2
      *                                                                   CAC001
      **  Calculate adjustment for Margin Amount                          CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           @MGAMB    SUB  F3MGAM    @ADJ4  130                      CAC001
     C           FHMGAM    ADD  @ADJ4     FHMGAM                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** UPDATE FILE
     C                     MOVE @RUND     FHDLUP
     C                     MOVE @RUNM     FHMLUP
     C                     MOVE @RUNY     FHYLUP
     C**********           TIME           FHTLUP                         E12279a
     C                     MOVE @RUNT     FHTLUP                         E12279a
     C           F3LACT    IFEQ 'D'                                       DT0074
     C           F3DTYP    ANDEQ'S'                                       154448
     C                     MOVE 'D'       FHCHTP                          DT0074
     C                     ELSE                                           DT0074
     C                     MOVE 'A'       FHCHTP
     C                     END                                            DT0074
     C*********************MOVE RUND      FHLCD                           S01194
     C                     MOVE BJRDNB    FHLCD                           S01194
     C                     MOVEL@USER     FHLUID
     C                     UPDATFXDEALP0
     C           #BAD9     ENDSR
     //EJECT
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #C    FINAL PROCESSING                          *
     C*                                                              *
     C*  FIELDS USED :     @TERM  -  TERMINATION PARAMETER           *
     C*                                                              *
     C*  CALLED BY :       MAIN PROGRAM                              *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #C        BEGSR
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     MOVE 'E'       @TERM            *1
     C                     END                             E1
     C           @TERM     IFEQ 'T'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     END                             E1
     C           #C9       ENDSR
     //EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR - PROGRAM ERROR SUBROUTINE                              *
     C*                                                               *
     C* CALLED BY:   EXECUTES WHENEVER PROGRAM ERROR OCCURS           *
     C*                                                               *
     C* CALLS:                                                        *
     C*                                                               *
     C* USES :  @ERR1  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
     C*         @TERM  - TERMINATION PARAMETER                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C*
     C           DBASE     IFEQ *BLANKS                    B*2
      ** IF CALLED FOR DBASE ERROR THIS WILL NOT BE RUN
     C** SET UP FIELDS IN LOCAL DATA AREA                  **2
     C                     MOVE '991'     DBASE            **2
     C                     MOVE '1'       *INU6            **2
     C                     END                             E*2
     C*
     C** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     MOVE 'E'       @TERM            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C*********************MOVE '1'       *INU6
     C                     MOVE '1'       *INLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,FX0320CP15                                           S01408
     C*                                                                   S01408
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     //EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR - FILE EXCEPTION/ERROR SUBROUTINE                       *
     C*                                                               *
     C* CALLED BY:   EXECUTES WHENEVER FILE EXCEPTION/ERROR OCCURS    *
     C*                                                               *
     C* CALLS:                                                        *
     C*                                                               *
     C* USES :  @ERR2  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
     C*         @FILE  - FILENAME FOR WHICH EXCEPTION/ERROR           *
     C*                  OCCURRED (POSNS 201-208 OF PSDS)             *
     C*         @TERM  - TERMINATION PARAMETER                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           INFSR     BEGSR
     C*
     C** SET @ERR2 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
     C*                                                    *1
     C** SET UP FIELDS IN LOCAL DATA AREA                  *1
     C                     MOVEL@FILE     DBFILE           *1
     C                     MOVE '992'     DBASE            *1
     C*                                                    *1
     C** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     MOVE 'E'       @TERM            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
** @DP USED BY SR. ZA0680 - DECIMAL PLACES CORRECTION ARRAY
1000000010000000100000001000000010000000100000001
** @YD  USED BY SR. ZA0680 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0680 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** TAB1 AND TAB2 TO DETERMINE SHORT OR FORWARD P/L PERIOD
OVR 0D
TOMN1D
SPN 2D
SP1W1W
SP2W2W
SP3W3W
SP1M1M
SP2M2M
SP3M3M
SP6M6M
SP9M9M
SPYR1Y
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
