     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FX Set up daily eqv. posns. and profits')        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FX Dealer Module
     F*                                                               *
     F*  FX0680 - SETUP DAILY EQUIVALENT - POSITION & PROFITS         *
     F*                                                               *
     F*  Function: This program performs the FX revaluation           *
     F*  (I/C INIT)processing by recalculating the dealt spot base    *
     F*            currency eqivalent for each day forward from       *
     F*            today using the closing exchange rate on file,     *
     F*            thus zeroising the close out rate profit/loss.     *
     F*                                                               *
     F*  Called by: FX8010  - Daily file setup.                       *
     F*                                                               *
     F*  Calls    : none                                              *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL094             Date 11Jun14               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CGL029             Date 01Sep03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 193092             Date 19Apr02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU003             Date 27Apr98               *
      *                 131644             Date 06Mar98               *
     F*                 057944             DATE 28DEC93               *
     F*                 S01453             DATE 14DEC93               *
     F*                 S01319             DATE 13AUG91               *
     F*                 S01277             DATE 01AUG90               *
     F*                 S01194             DATE 03JAN90               *
     F*                 S01117             DATE 03JAN90               *
     F*                 E16286             DATE 22/12/88              *
     F*                 E14319             DATE 15/07/88              *
     F*                 S01136             DATE 10/12/87              *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in FXDEALPP.*
     F*  193092 - PGM tried to divide by zero when H/L spot rate not  *
     F*           defined to currency.                                *
     F*  CEU003 - Recompiled over changed FXDECXLL                    *
     F*  131644 - The field RSPOT was defined as 7,0 rather than      *
     F*           13,8 which results in a truncation of the spot      *
     F*           rate and in some cases a divide by zero error.      *
     F*  057944 - Database error occurs when a non-dealing currency   *
     F*           is processed because LF/SDCURRL0 which is now       *
     F*           used in place of FDINSTLL includes non-dealing      *
     F*           currencies.  Fis is to add processing to bypass     *
     F*           non-dealing currencies.                             *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  S01319 - Remove references to FDINSTLL                       *
     F*  S01277 - CROSS-CURRENCY POSITIONS PROCESSING                 *
     F*  S01194 - STANDING DATA CHANGES FOR RELEASE 10                *
     F*  S01117 - RELEASE 10 MULTIBRANCHING                           *
     F*  E16286 - ON DATABASE ERROR,PGM NAME NOT MOVED TO DBPGM AND   *
     F*           ERROR 003 USED FOR DIFFERENT FILES                  *
     F*  E14319 - REMOVE IGNORES OF ICD REDORD FORMATS.               *
     F*  S01136 - DO NOT REVERSE SIGN OF @WORK1 BEFORE CALLING $BBB   *
     F*           SO THAT NOSTRO DEALT BCE (FONDBE) IS HELD ON FILE   *
     F*           WITH THE SAME SIGN AS NOSTRO NET CURRENCY POSITION  *
     F*           (FONNCP)                                            *
     F*           2) RECALCULATE BANKS DEALT SPOT BCE DAILY IN        *
     F*           ORDER TO CAUSE P/L ON BANKS OPEN POSTN ENQUIRY TO   *
     F*           BE ZEROISED DAILY                                   *
     F*           3) WRITE A  RECORD TO FXEPOSPP REGARDLESS OF        *
     F*           PREVIOUS POSITION ON OLPOS                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F**FDCCYTLLIF  E           K        DISK         KINFSR INFSR      UCS01194
     F*FDINSTLLIF**E*******************DISK***************************UC**S01319
     F**FDTG10LLIF  E           K        DISK         KINFSR INFSR      UCS01194
     F*****       TABTG10F                          KRENAMETG10F          S01194
     F**FDICDRLLIF  E           K        DISK         KINFSR INFSR      UCS01194
     F********    TABTB20F                          KIGNORE               E14319
     FOLPOS   IF  E           K        DISK         KINFSR INFSR      UC
     F            OLPOSHHF                          KIGNORE
     F            OLPOSOBF                          KIGNORE
     FACCNT   IF  E           K        DISK         KINFSR INFSR      UC
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FFXFWMHLLIF  E           K        DISK         KINFSR INFSR      UC
     F**FDBRNCLLIF  E           K        DISK         KINFSR INFSR      UCS01194
     FFXEPOSLLUF  E           K        DISK         KINFSR INFSR A    UC
     FSDCURRL0IF  E           K        DISK         KINFSR INFSR          S01194
     FSDBRCHL1IF  E           K        DISK         KINFSR INFSR          S01194
     FFXCRSCLLIF  E           K        DISK         KINFSR INFSR          S01277
     FFXEPOCLLUF  E           K        DISK         KINFSR INFSR A        S01277
     F            FXEPOSP0                          KRENAMEFXEPOCL1       S01277
     FFXDECXLLIF  E           K        DISK         KINFSR INFSR          S01277
     FFDCCYPLLIF  E           K        DISK         KINFSR INFSR          S01277
     FFXCCYPLLIF  E           K        DISK         KINFSR INFSR          S01277
     F            FDCCYPP0                          KRENAMEFXCCYPP0       S01277
     F*****************************************************************
      /EJECT
     E*****************************************************************
     E*
     E                    CPY@    1   1 80                                S01194
      *
     E*   THIS ARRAY IS USED BY ROUTINE #BBB OF THIS PROGRAM
     E**  ARRAY FOR SR. ZA0620 - DECIMAL PLACES CORRECTION
     E**  ( ie 1000  100  10  1  .1  .01  .001)
     E                    @DP     7   7  7 3
     E*
     E                    @SF     1  10 10 0                              S01277
     E**  Array of scaling factors.                                       S01277
     E*                                                                   S01277
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIODS01277
     E                    @YD     4   4  5 0A                             S01277
     E*                                                                   S01277
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR PER MONTH        S01277
     E                    @MD    13  13  5 0A                             S01277
     E*                                                                   S01277
     E**  ARRAY FOR SR. ZA0630 - POWERS OF TEN.                           S01277
     E                    @@AY    1  10 10 0                              S01277
     E*                                                                   S01277
     E**  USED TO INITIALISE SCALE RATE TO 99999.99999999                 S01277
     E                    @IN     1   1 13 8                              S01277
     E*                                                                   S01277
     E                    @TXT    1   1 29                                S01277
     E**  Array FOR ERROR DESCRIPTION                                     S01277
     E*                                                                   S01277
     E/COPY ZSRSRC,ZHOLE                                                  S01277
      * Copy holiday array                                                S01277
     E*****************************************************************
      /EJECT
     I*****************************************************************
     I* ID  F  C  H  L   FUNCTION OF INDICATORS
     I*********60********NO*RECORD*ON*FILES*FDINSTLL**********************S01319
     I*****                                 FDICDRLL                      S01194
     I*****                                 FDTG10LL                      S01194
     I*        61        NO RECORDS ON FILE SDCURRL0                      S01194
     I*        62        NO RECORDS ON FILE FXEPOSLL
     I*        63        INSERT MODE
     I*        64        NO RECORDS ON FILE OLPOS
     I*        66        CALCULATE ONLY BANK DEALT SPOT BCE
     I*        68        NO RECORDS ON FILE SDBRCHL1                      S01194
     I*        69        NO RECORDS ON FILE ACCNT
     I*        70        EOF FXCRSCLL                                     S01277
     I*        71        RECORDS TO PROCESS ON FXDECXLL                   S01277
     I*        72        EOF FXDECXLL                                     S01277
     I*        73        RECORD  NOT FOUND ON FILE FXEPOCLL               S01277
     I*****************************************************************
     I*TG10F                                                              S01194
     I*****         SPOT                            RSPOT                 S01194
     I*****         TACC                            RTACC                 S01194
     I*****         MDIN                            RMDIN                 S01194
     I*****         CDP                             RCDP                  S01194
     I*
     I* PROGRAM STATUS DATA STRUCTURE                                *
     IPSDS       SDS
     I                                      254 263 @JOB
     I                                      254 256 @USER
     I* LOCAL DATA AREA DATA STRUCTURE                                *
     I           UDS
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I**DATA*STRUCTURE TO REDEFINE FIELD RUNA FROM TABTB10F          *    S01194
     I* DATA STRUCTURE TO REDEFINE FIELD BJMRDT FROM SDBANKPD          *  S01194
     I            DS
     I*****                                   1   7 RUNA                  S01194
     I                                        1   7 @@RUNA                S01194
     I                                        1   20@DAY
     I                                        3   5 @MTH
     I                                        6   70@YR
     I* DATA STRUCTURE TO REDEFINE KEY @OLPOS AS @OLP                *
     I            DS
     I*****                                   1   5 @OLP                  S01117
     I*****                                   1   3 @OLP1                 S01117
     I*****                                   4   50@OLP2                 S01117
     I                                        1   8 @OLP                  S01117
     I                                        1   3 @OLP1                 S01117
     I                                        4   6 @OLP2                 S01117
     I                                        7   80@OLP3                 S01117
     I* DATA STRUCTURE TO HOLD KEY TO FCDECXLL                            S01277
     I            DS                                                      S01277
     I                                        1   6 @DEKEY                S01277
     I                                        1   3 FHCCY1                S01277
     I                                        4   6 FHCCY2                S01277
     I                                        1   3 JPDFCY                S01277
     I                                        4   6 JPDSCY                S01277
     I** DATA STRUCTURE FOR MODULES PRESENT                               S01277
     IMMODS       DS                            256                       S01277
     I                                       19  19 @ARB                  S01277
     I**  DATA STRUCTURE FOR ZA0680/ZA0710 - DATE INPUT TO SUBROUTINES*   S01277
     I            DS                              8                       S01277
     I                                        1   80@@DTIN                S01277
     I                                        1   40@@YYYY                S01277
     I                                        3   40@@YY                  S01277
     I                                        1   20@@CC                  S01277
     I                                        5   60@@MTH                 S01277
     I                                        7   80@@DAY                 S01277
     I*                                                                   S01277
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@Z71Y                 S01277
     I            DS                              4                       S01277
     I                                        1   40@@Z71Y                S01277
     I                                        1   10@@SSY1                S01277
     I                                        2   20@@SSY2                S01277
     I                                        3   30@@SSY3                S01277
     I                                        4   40@@SSY4                S01277
     I*                                                                   S01277
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@VDT                  S01277
     I            DS                              8                       S01277
     I                                        1   80@@VDT                 S01277
     I                                        1   40@@YR                  S01277
     I                                        5   60@@Z71M                S01277
     I                                        7   80@@Z71D                S01277
     I            DS                                                      S01277
     I*                                                                   S01277
     I**   Controlling parameters   (Current Prompt 1)                    S01277
     I**                                                                  S01277
     I            DS                             80                       S01277
     I                                        1  80 FAEPT1                S01277
     I                                        2   4 @@CCY1                S01277
     I                                       32  34 @@CCY2                S01277
     I*                                                                   S01277
      *                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
      ** BANK DETAILS ACCESSED VIA ACCESS PROGRAM                         S01194
      *                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
      ** CURRENCY DETAILS ACCESSED VIA ACCESS PROGRAM                     S01194
      *                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
      ** BRANCH DETAILS ACCESSED VIA ACCESS PROGRAM                       S01194
      *                                                                   S01319
     ISDDEAL    E DSSDDEALPD                                              S01319
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01319
      *                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
      *                                                                   S01194
     IRUNDAT      DS                             13                       S01194
     I* DATA STRUCTURE FOR MULTIBRANCHING INDICATOR                       S01194
     I                                       13  13 @MBIN                 S01194
     I*                                                                   S01194
      /COPY ZSRSRC,ZHOLI                                                  S01277
     I* Copy standard holiday data structure                              S01277
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C* *LIKE DEFN
     C*
     C*****      *LIKE     DEFN MDIN      @MDIN                           S01194
     C*****      *LIKE     DEFN SPOT      @WSPOT                          S01194
     C           *LIKE     DEFN A6MDIN    @MDIN                           S01194
     C           *LIKE     DEFN A6SPRT    @WSPOT                          S01194
     C           *LIKE     DEFN FONNCP    @WORK1
     C           *LIKE     DEFN FOTLUP    @TIME
     C*****      *LIKE     DEFN CCY       @AVCCY                          S01194
     C*****      *LIKE     DEFN CNUM      @ACC1                           S01194
     C*****      *LIKE     DEFN CCY       @ACC2                           S01194
     C*****      *LIKE     DEFN ACOD      @ACC3                           S01194
     C*****      *LIKE     DEFN ACSQ      @ACC4                           S01194
     C*****      *LIKE     DEFN KEY       @DIC                            S01194
     C           *LIKE     DEFN A6CYCD    @AVCCY                          S01194
     *****       *LIKE     DEFN KEY       @DCCY1                          S01194
     C           *LIKE     DEFN FQCCY     @FXMH1
     C*****      *LIKE     DEFN KEY       @DBR1                           S01194
     C           *LIKE     DEFN FOCCY     @EPOS1
     C*****      *LIKE     DEFN RCDP      @CDP                            S01194
     C           *LIKE     DEFN A6NBDP    @CDP                            S01194
     C*****************************************************************
     C* KLISTS
     C*
     C**KLIST FOR FDICDRLL                                                S01194
     C*****      @DICD     KLIST                                          S01194
     C*****                KFLD           @DIC                            S01194
     C*****                                                               S01194
     C**KLIST FOR FDCCYTLL                                                S01194
     C*****      @DCCY     KLIST                                          S01194
     C*****                KFLD           @DCCY1                          S01194
     C*
     C* KLIST FOR ACCNT
     C           @ACCNT    KLIST
     C                     KFLD           @ACC1
     C                     KFLD           @ACC2
     C                     KFLD           @ACC3
     C                     KFLD           @ACC4
     C                     KFLD           @ACC5                           S01117
     C*
     C* KLIST FOR OLPOS
     C           @OLPOS    KLIST
     C                     KFLD           @OLP1
     C                     KFLD           @OLP2
     C                     KFLD           @OLP3                           S01117
     C*
     C* KLIST FOR FXFWMHLL
     C           @FXMH     KLIST
     C                     KFLD           @FXMH1
     C*
     C**KLIST FOR FDBRNCLL                                                S01194
     C*****      @DBR      KLIST                                          S01194
     C*****                KFLD           @DBR1                           S01194
     C* KLIST FOR FXEPOSLL
     C           @EPOS     KLIST
     C                     KFLD           @EPOS1
     C*                                                                   S01277
     C* KLIST FOR FXDECXLL                                                S01277
     C           @DECX     KLIST                                          S01277
     C                     KFLD           @CCY1                           S01277
     C                     KFLD           @CCY2                           S01277
     C*                                                                   S01277
     C* KLIST FOR FXEPOCLL                                                S01277
     C           @EPOC     KLIST                                          S01277
     C                     KFLD           @EPOC1  3                       S01277
     C                     KFLD           @EPOC2  3                       S01277
     C*                                                                   S01277
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C* MAINLINE
     C*              #A INITIALIZATION
     C*              #B MAILINE LOGIC
     C*              #C TERMINATION
     C*****************************************************************
     C*
     C                     EXSR #A
     C*
     C           *INU7     IFNE '1'
     C                     EXSR #B
     C                     END
     C*
     C                     EXSR #C
     C*
     C                     SETON                     LR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C* #A                                                            *
     C* --                                                            *
     C* THIS ROUTINE IS THE INITIAL ROUTINE                         *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C                     MOVEACPY@      BIS@   80                       S01194
      *
     C*****                MOVE *BLANKS   @DTG10 12                       S01194
     C*****                MOVE *BLANKS   @DIC                            S01194
     C*
     C** GET MULTIBRANCH IND FROM DATA AREA - RUNDATE                     S01117
     C*                                                                   S01117
     C                     IN   RUNDAT                                    S01117
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C*                                                                   S01117
     C                     MOVEL'FX0680'  DBPGM                           E16286
     C* OPENING FILES
     C*****                OPEN FDCCYTLL                                  S01194
     C                     OPEN OLPOS
     C                     OPEN ACCNT
     C                     OPEN FXFWMHLL
     C*****                OPEN FDBRNCLL                                  S01194
     C                     OPEN FXEPOSLL
     C*********************OPEN*FDINSTLL**********************************S01319
     C*****                OPEN FDICDRLL                                  S01194
     C*****                OPEN FDTG10LL                                  S01194
     C*
     C***********1*********SETLLFDINSTLL**********************************S01319
     C*********************READ*FDINSTLL*****************60***************S01319
     C********************************************************************S01319
     C************IN60*****IFEQ*'1'***************************************S01319
     C**********           CALL 'AODEALR0'                                S01319              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01319              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01319
     C                     SETON                     U7U8
     C*********************MOVEL'FDINSTLL'DBFILE**************************S01319
     C                     MOVEL'SDDEALPD'DBFILE                          S01319
     C                     MOVEL'001'     DBASE
     C                     MOVEL*BLANK    DBKEY
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #A9
     C                     END
     C*
     C*****                MOVEL'01'      @DIC                            S01194
     C*****                MOVE '10'      @DIC                            S01194
     C*****                                                               S01194
     C*****      @DICD     CHAINFDICDRLL             60                   S01194
     C*****      *IN60     IFEQ '1'                                       S01194
      *                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8
     C*****                MOVEL'FDICDRLL'DBFILE                          S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL'002'     DBASE
     C*****                MOVEL@DIC      DBKEY                           S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #A9
     C                     END
     C*
     C*****                Z-ADDDFBR      @DFBR   30                      S01194
     C                     MOVE BJSBRC    @DFBR   3                       S01194
     C                     MOVE BJMRDT    @@RUNA                          S01194
     C*
     C*****                MOVEL'01'      @DIC                            S01194
     C*****                MOVE '11'      @DIC                            S01194
     C*****                                                               S01194
     C*****      @DICD     CHAINFDICDRLL             60                   S01194
     C*****      *IN60     IFEQ '1'                                       S01194
     C*****                SETON                     U7U8                 S01194
     C*****                MOVEL'FDICDRLL'DBFILE                          S01194
     C*****                MOVEL'003'     DBASE                    E16286 S01194
     C*****                MOVEL@DIC      DBKEY                           S01194
     C*****                GOTO #A9                                       S01194
     C*****                END                                            S01194
     C*
     C*****                MOVE BCCY      @BCCY   3                       S01194
     C                     MOVE BJCYCD    @BCCY   3                       S01194
     C*
     C*****                MOVEL'20'      @DTG10                          S01194
     C*****                MOVEL@BCCY     @DTG4   4                       S01194
     C*****                MOVE '1'       @DTG4                           S01194
     C*****                MOVE @DTG4     @DTG10                          S01194
     C*****                                                               S01194
     C*****      @DTG10    CHAINFDTG10LL             60                   S01194
     C*****      *IN60     IFEQ '1'                                       S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM @BCCY     @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8
     C*****                MOVEL'FDTG10LL'DBFILE                          S01194
     C                     MOVEL'SDCURRPD'DBFILE                          S01194
     C***********          MOVEL'003'     DBASE                           E16286
     C                     MOVEL'004'     DBASE                           E16286
     C*****                MOVEL@DTG10    DBKEY                           S01194
     C                     MOVEL@BCCY     DBKEY                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #A9
     C                     END
     C*
     C* SAVING NO.OF DECIMALS FOR BASE CURRENCY FOR ACCOUNTING
     C*
     C*****                MOVE RCDP      @CDP                            S01194
     C                     MOVE A6NBDP    @CDP                            S01194
     C*
     C**SAVING*NO.OF DECIMALS FOR BASE CURRENCY FOR DEALING AS WELL       S01194
     C**THE*SPOT*RATE AND MULTIPLY INDICATOR IS AUTOMATICALLY DONE        S01194
     C**IN*THE*RENAMED FIELDS OF TABTG10.                                 S01194
     C*
     C*****                MOVEL'20'      @DTG10                          S01194
     C*****                MOVELIDCYDL    @DTG4   4                       S01194
     C*****                MOVE '1'       @DTG4                           S01194
     C*****                MOVE @DTG4     @DTG10                          S01194
     C*****                                                               S01194
     C*****      @DTG10    CHAINFDTG10LL             60                   S01194
     C*****      *IN60     IFEQ '1'                                       S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C*********************PARM*IDCYDL****@AJCD***3*****************S01194S01319
     C                     PARM BNCYDL    @AJCD   3                       S01319
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8
     C*****                MOVEL'FDTG10LL'DBFILE                          S01194
     C                     MOVEL'SDCURRPD'DBFILE                          S01194
     C***********          MOVEL'003'     DBASE                           E16286
     C                     MOVEL'005'     DBASE                           E16286
     C*****                MOVEL@DTG10    DBKEY                           S01194
     C*********************MOVELIDCYDL****DBKEY*********************S01194S01319
     C                     MOVELBNCYDL    DBKEY                           S01319
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #A9
     C                     END
     C*
     C                     TIME           @TIME
     C*
     C** RETRIEVE THE EXTERNAL DATAAREA MMOD                              S01277
     C           *NAMVAR   DEFN MMOD      MMODS                           S01277
     C                     IN   MMODS                                     S01277
     C*                                                                   S01277
     C***  Initialise fields used in ZA subroutines                       S01277
     C**                                                                  S01277
     C                     MOVE *BLANK    @@CC1D  1                       S01277
     C                     MOVE *BLANK    @@CC2D  1                       S01277
     C                     MOVE *BLANK    @@CC1W  1                       S01277
     C                     MOVE *BLANK    @@CC2W  1                       S01277
     C                     MOVE *ZEROS    @@MNOL  50                      S01277
     C                     MOVE *BLANKS   @@CCYL  3                       S01277
     C                     MOVE *ZEROS    @@VDTL  80                      S01277
     C                     MOVE *BLANKS   @@CCYP  3                       S01277
     C                     MOVE *ZEROS    @@VDTP  80                      S01277
     C*                                                                   S01277
     C**  Define program work fields with reference to file fields.       S01277
     C**                                                                  S01277
     C           *LIKE     DEFN A6SPDY    @@WSP1                          S01277
     C           *LIKE     DEFN A6SPDY    @@WSP2                          S01277
     C           *LIKE     DEFN A6FXSD    @@SPD1                          S01277
     C           *LIKE     DEFN A6FXSD    @@SPD2                          S01277
     C           *LIKE     DEFN A6HSRT    @HISP1                          S01277
     C           *LIKE     DEFN A6HSRT    @HISP2                          S01277
     C           *LIKE     DEFN A6LSPR    @LOSP1                          S01277
     C           *LIKE     DEFN A6LSPR    @LOSP2                          S01277
     C           *LIKE     DEFN A6NBDP    @CDP1                           S01277
     C           *LIKE     DEFN A6NBDP    @CDP2                           S01277
     C           *LIKE     DEFN A6DPBF    @DPBF1                          S01277
     C           *LIKE     DEFN A6DPBF    @DPBF2                          S01277
     C           *LIKE     DEFN A6NQDP    @NQDP1                          S01277
     C           *LIKE     DEFN A6NQDP    @NQDP2                          S01277
     C           *LIKE     DEFN A6MDEX    @XRMD1                          S01277
     C           *LIKE     DEFN A6MDEX    @XRMD2                          S01277
     C           *LIKE     DEFN XPPRDD    @@SPDD                          S01277
     C           *LIKE     DEFN @@MDI1    @@MDI2                          S01277
     C           *LIKE     DEFN A6HSRT    @XR1                            S01277
     C           *LIKE     DEFN A6LSPR    @XR2                            S01277
     C           *LIKE     DEFN XPCCY     @@XCCY                          S01277
     C           *LIKE     DEFN XPPRDD    @@XPRD                          S01277
     C           *LIKE     DEFN XPTPRD    @@XTPR                          S01277
     C           *LIKE     DEFN XPLOPT    @@XLOP                          S01277
     C           *LIKE     DEFN XPHIPT    @@XHIP                          S01277
     C           *LIKE     DEFN XPPRDD    @@XPCC                          S01277
     C           *LIKE     DEFN XPLOPT    @@XPLP                          S01277
     C           *LIKE     DEFN XPHIPT    @@XPHP                          S01277
     C*
     C** SAVE FIELDS FROM SDCURRPD                                        S01194
     C**********           Z-ADDA6SPRT    RSPOT   70               S01194 131644
     C                     Z-ADDA6SPRT    RSPOT  138                      131644
     C**********           MOVE A6SPAE    RTACC   4                                    S01194 CGL029
     C                     MOVE A6SPAE    RTACC  10                                           CGL029
     C                     MOVE A6MDIN    RMDIN   1                       S01194
     C                     Z-ADDA6NBDP    RCDP    10                      S01194
     C*                                                                   S01194
     C           #A9       ENDSR
      /EJECT
     C*****************************************************************
     C* #B                                                            *
     C* --                                                            *
     C* THIS ROUTINE IS THE MAIN LINE ROUTINE                         *
     C* READS FILES :- SDCURRPD
     C*                FXEPOSLL
     C*                OLPOS
     C* CALLS ROUTINES:-
     C*                #BA,#BB,#BC.
     C*
     C*****************************************************************
     C           #B        BEGSR
     C*
     C*****                MOVE *BLANKS   @DCCY1                          S01194
     C*****      @DCCY     SETLLFDCCYTLL                                  S01194
     C           *LOVAL    SETLLSDCURRL0                                  S01194
     C*
     C           #B1       TAG
     C* READS FILE SDCURRL0
     C*
     C*****                READ FDCCYTLL                 61               S01194
     C                     READ SDCURRL0                 61               S01194
     C*
     C           *IN61     IFEQ '1'
     C**********           GOTO #B9                                       S01277
     C                     GOTO #B8                                       S01277
     C                     END
     C*                                                                   057944
     C** Skip if a non-dealing currency - read next record                057944
     C*                                                                   057944
     C           A6DLCI    IFEQ 'N'                                       057944
     C                     GOTO #B1                                       057944
     C                     END                                            057944
     C*
     C*****                MOVE CCY       @EPOS1                          S01194
     C*****                MOVE CCY       @AVCCY                          S01194
     C                     MOVE A6CYCD    @EPOS1                          S01194
     C                     MOVE A6CYCD    @AVCCY                          S01194
     C*
     C* READS FILE FXEPOSLL TO CHECK IF IT IS IN THE INSERT MODE
     C* IF IN THE INSERT MODE IT SETS ON INDICATOR 63.
     C*
     C           @EPOS     CHAINFXEPOSLL             62
     C*
     C                     MOVE @USER     FOLUID
     C                     MOVE *BLANK    FODLTF
     C                     MOVE @DAY      FODLUP
     C                     MOVE @MTH      FOMLUP
     C                     MOVE @YR       FOYLUP
     C*****                MOVE RUND      FOLCD                           S01194
     C                     MOVE BJRDNB    FOLCD                           S01194
     C                     MOVE @TIME     FOTLUP
     C*
     C* SETS ON INDICATOR 63 IF IN THE INSERT MODE AND EXECUTES #BA
     C* THE INIT SR.FOR FILE FXEPOSLL.
     C*
     C           *IN62     IFEQ '1'
     C                     SETON                     63
     C                     EXSR #BA
     C                     ELSE
     C                     MOVE 'A'       FOCHTP
     C                     Z-ADD0         FOTNTP
     C                     Z-ADD0         FOTDPE
     C                     SETOF                     63
     C                     END
     C*
     C**  IF MULTIBRANCHING OFF                                           S01117
     C           @MBIN     IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C*****                Z-ADD01        @OLP2                           S01117
     C*****                MOVE CCY       @OLP1                           S01117
     C                     MOVE @DFBR     @OLP1                           S01117
     C                     MOVE A6CYCD    @OLP2                           S01117
     C                     Z-ADD01        @OLP3                           S01117
     C*
     C           @OLPOS    CHAINOLPOS                64
     C*
     C           *IN64     IFEQ '1'
     C                     SETON                     U7U8
     C                     MOVEL'OLPOS   'DBFILE
     C***********          MOVEL'004'     DBASE
     C                     MOVEL'006'     DBASE
     C                     MOVEL@OLP      DBKEY
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #B9
     C                     END
     C*
     C* ADDS PCOB TO FIELD NOSTRO NET CURRENCY POSITION
     C*
     C                     Z-ADDPCOB      FONNCP
     C*
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** MULTIBRANCHING ON                                                S01117
     C** CHAIN TO OLPOS FOR EVERY BRANCH AND ACCUMULATE TOTAL             S01117
     C*                                                                   S01117
     C           *LOVAL    SETLLSDBRCHL1                                  S01117
     C                     SETOF                     68                   S01117
     C                     MOVE A6CYCD    @OLP2                           S01117
     C                     Z-ADD01        @OLP3                           S01117
     C                     Z-ADD*ZEROS    FONNCP                          S01117
     C*                                                                   S01117
     C           *IN68     DOWEQ'0'                                       S01117
     C*                                                                   S01117
     C                     READ SDBRCHL1                 68               S01117
     C*                                                                   S01117
     C           *IN68     IFEQ '0'                                       S01117
     C                     MOVE A8BRCD    @OLP1                           S01117
     C*                                                                   S01117
     C           @OLPOS    CHAINOLPOS                64                   S01117
     C*                                                                   S01117
     C           *IN64     IFEQ '0'                                       S01117
     C* ADDS PCOB TO FIELD NOSTRO NET CURRENCY POSITION                   S01117
     C*                                                                   S01117
     C                     ADD  PCOB      FONNCP                          S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF CURRENCY IS EQUAL TO BASE DEALING CURRENCY THEN
     C* NOSTRO NET BCE IS SET TO ZERO ELSE IT EXECUTES #BB.
     C*
     C*****      CCY       IFEQ IDCYDL                                    S01194
     C***********A6CYCD****IFEQ*IDCYDL******************************S01194S01319
     C           A6CYCD    IFEQ BNCYDL                                    S01319
     C                     Z-ADD0         FONDBC
     C                     ELSE
     C                     EXSR #BB
     C                     END
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO #B9
     C                     END
     C*
     C*
     C                     EXSR #BC
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO #B9
     C                     END
     C*
     C           *IN63     IFEQ '1'
     C                     SETOF                     63
     C                     Z-ADD0         FOSHPL
     C                     Z-ADD0         FOFWPL
      * IF NO AMOUNT DO NOT WANT TO WRITE A RCD TO EPOS FILE
      *
     C***********PCOB      IFNE *ZERO                      B1             S01136
     C                     WRITEFXEPOSP0                   *1
     C***********          END                             E1             S01136
      *
     C                     ELSE
     C                     UPDATFXEPOSP0
     C                     END
     C*
     C                     GOTO #B1
     C*                                                                   S01277
     C           #B8       TAG                                            S01277
     C*                                                                   S01277
     C** DO CROSS CURRENCY POSITION UPDATING                              S01277
     C*                                                                   S01277
     C                     EXSR #BD                                       S01277
     C*
     C           #B9       ENDSR
      /EJECT                                                              S01277
     C*****************************************************************   S01277
     C* #BD                                                           *   S01277
     C* --                                                            *   S01277
     C* THIS ROUTINE UPDATES THE CROSS CURRENCY POSITIONS             *   S01277
     C* READS FILES :- FXCRSCLL                                       *   S01277
     C*                FXEPOCLL                                       *   S01277
     C*                FXDECXLL                                       *   S01277
     C* CALLS ROUTINES:-                                              *   S01277
     C*                #BDA                                           *   S01277
     C*                                                               *   S01277
     C*****************************************************************   S01277
     C           #BD       BEGSR                                          S01277
     C*                                                                   S01277
     C** Position at first record on Cross Currencies Position            S01277
     C** Maintained file.                                                 S01277
     C*                                                                   S01277
     C           *LOVAL    SETLLFXCRSCLL                                  S01277
     C*                                                                   S01277
     C                     READ FXCRSCLL                 70               S01277
     C*                                                                   S01277
     C** MAIN LOOP                                                        S01277
     C** ~~~~~~~~~                                                        S01277
     C** If record found process all records on file.                     S01277
     C*                                                                   S01277
     C           *IN70     DOWEQ'0'                        B1             S01277
     C*                                                                   S01277
     C** Zeroise Cross ccy total net position and                         S01277
     C** Cross ccy equivalent in primary ccy work fields.                 S01277
     C*                                                                   S01277
     C                     Z-ADD0         @FCTNP 150                      S01277
     C                     Z-ADD0         @FCTEP 150                      S01277
     C*                                                                   S01277
     C** Set up key for chains to LF/FXDECXLL.                            S01277
     C*                                                                   S01277
     C                     MOVE CPPCCY    @CCY1   3                       S01277
     C                     MOVE CPSCCY    @CCY2   3                       S01277
     C*                                                                   S01277
     C** FORMAT 1                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from First format FXDECXLL (FXDEALPP).         S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP1                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B2             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP1                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY1     @SAVCY  6                       S01277
     C                     MOVE @CCY2     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B3             S01277
     C           *IN72     ANDEQ'0'                        B3             S01277
     C*                                                                   S01277
     C           AMT2      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP1                 72               S01277
     C*                                                                   S01277
     C                     END                             E3             S01277
     C                     END                             E2             S01277
     C*                                                                   S01277
     C** FORMAT 2                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from second format FXDECXLL (FXDEALPP).        S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP2                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B2             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP2                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY2     @SAVCY                          S01277
     C                     MOVE @CCY1     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B3             S01277
     C           *IN72     ANDEQ'0'                        B3             S01277
     C*                                                                   S01277
     C           AMT1      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP2                 72               S01277
     C*                                                                   S01277
     C                     END                             E3             S01277
     C                     END                             E2             S01277
     C*                                                                   S01277
     C** If Arbitrage/Internal Contracts is on in the system              S01277
     C** need to process further 4 formats of FXDECXLL.                   S01277
     C*                                                                   S01277
     C           @ARB      IFEQ 'Y'                        B2             S01277
     C*                                                                   S01277
     C** FORMAT 3                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from third format FXDECXLL (ABDEALPP).         S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP3                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B3             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP3                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY1     @SAVCY                          S01277
     C                     MOVE @CCY2     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B4             S01277
     C           *IN72     ANDEQ'0'                        B4             S01277
     C*                                                                   S01277
     C           AMT2      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP3                 72               S01277
     C*                                                                   S01277
     C                     END                             E4             S01277
     C                     END                             E3             S01277
     C*                                                                   S01277
     C** FORMAT 4                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from fourth format FXDECXLL (ABDEALPP).        S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP4                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B3             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP4                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY1     @SAVCY                          S01277
     C                     MOVE @CCY2     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B4             S01277
     C           *IN72     ANDEQ'0'                        B4             S01277
     C*                                                                   S01277
     C           AMT2      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP4                 72               S01277
     C*                                                                   S01277
     C                     END                             E4             S01277
     C                     END                             E3             S01277
     C*                                                                   S01277
     C** FORMAT 5                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from fifth format FXDECXLL (ABDEALPP).         S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP5                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B3             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP5                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY2     @SAVCY                          S01277
     C                     MOVE @CCY1     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B4             S01277
     C           *IN72     ANDEQ'0'                        B4             S01277
     C*                                                                   S01277
     C           AMT1      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP5                 72               S01277
     C*                                                                   S01277
     C                     END                             E4             S01277
     C                     END                             E3             S01277
     C*                                                                   S01277
     C** FORMAT 6                                                         S01277
     C** ~~~~~~~~                                                         S01277
     C** Process all deals from sixth format FXDECXLL (ABDEALPP).         S01277
     C*                                                                   S01277
     C           @DECX     SETLLFXDECXP6                 71               S01277
     C*                                                                   S01277
     C** If *IN71 on there is at least 1 record to process.               S01277
     C*                                                                   S01277
     C           *IN71     IFEQ '1'                        B3             S01277
     C*                                                                   S01277
     C** Read 1st record.                                                 S01277
     C*                                                                   S01277
     C                     READ FXDECXP6                 72               S01277
     C*                                                                   S01277
     C** Store key for comparison.                                        S01277
     C*                                                                   S01277
     C                     MOVEL@CCY2     @SAVCY                          S01277
     C                     MOVE @CCY1     @SAVCY                          S01277
     C*                                                                   S01277
     C** Process until key changes or end of file.                        S01277
     C*                                                                   S01277
     C           @DEKEY    DOWEQ@SAVCY                     B4             S01277
     C           *IN72     ANDEQ'0'                        B4             S01277
     C*                                                                   S01277
     C           AMT1      ADD  @FCTNP    @FCTNP                          S01277
     C*                                                                   S01277
     C                     READ FXDECXP6                 72               S01277
     C*                                                                   S01277
     C                     END                             E4             S01277
     C                     END                             E3             S01277
     C*                                                                   S01277
     C                     END                             E2             S01277
     C*                                                                   S01277
     C** Calculate cross rates if primary currency amount                 S01277
     C** not zero.                                                        S01277
     C*                                                                   S01277
     C           @FCTNP    IFNE 0                          B2             S01277
     C*                                                                   S01277
     C                     EXSR #BDA                                      S01277
     C*                                                                   S01277
     C** Scale amount: subtract number of decimal places of primary       S01277
     C** currency from number secondary currency, add this number         S01277
     C** to  4 and look up array for scaling factor to use.               S01277
     C*                                                                   S01277
     C           @CDP1     SUB  @CDP2     @@Q                             S01277
     C           4         ADD  @@Q       @@Q     10                      S01277
     C           @FCTNP    MULT @DP,@@Q   @SCAMT 150                      S01277
     C*                                                                   S01277
     C** If primary currency amount +ve use low   cross rate              S01277
     C** to calculate Cross currency equivalent in primary ccy.           S01277
     C*                                                                   S01277
     C           @FCTNP    IFGT 0                          B3             S01277
     C*                                                                   S01277
     C           @SCAMT    MULT @@LRAT    @FCTEP                          S01277
     C                     ELSE                            X3             S01277
     C*                                                                   S01277
     C** Else use low cross rate.                                         S01277
     C*                                                                   S01277
     C           @SCAMT    MULT @@HRAT    @FCTEP                          S01277
     C                     END                             E3             S01277
     C*                                                                   S01277
     C                     END                             E2             S01277
     C*                                                                   S01277
     C** Access FXEPOCLL for currency combination.                        S01277
     C*                                                                   S01277
     C                     MOVE CPSCCY    @EPOC1                          S01277
     C                     MOVE CPPCCY    @EPOC2                          S01277
     C*                                                                   S01277
     C           @EPOC     CHAINFXEPOCLL             73                   S01277
     C*                                                                   S01277
     C                     Z-ADD@FCTNP    FOCTNP                          S01277
     C                     Z-ADD@FCTEP    FOCTEP                          S01277
     C                     MOVE @USER     FOLUID                          S01277
     C                     MOVE *BLANK    FODLTF                          S01277
     C                     MOVE @DAY      FODLUP                          S01277
     C                     MOVE @MTH      FOMLUP                          S01277
     C                     MOVE @YR       FOYLUP                          S01277
     C                     MOVE BJRDNB    FOLCD                           S01277
     C                     MOVE @TIME     FOTLUP                          S01277
     C                     Z-ADD0         FONNCP                          S01277
     C                     Z-ADD0         FONDBC                          S01277
     C                     Z-ADD0         FOTNTP                          S01277
     C                     Z-ADD0         FOTDPE                          S01277
     C                     Z-ADD0         FOBDSE                          S01277
     C                     Z-ADD0         FOSHPL                          S01277
     C                     Z-ADD0         FOFWPL                          S01277
     C*                                                                   S01277
     C** If record found update file.                                     S01277
     C*                                                                   S01277
     C           *IN73     IFEQ '0'                        B2             S01277
     C                     MOVE 'A'       FOCHTP                          S01277
     C                     UPDATFXEPOCL1                                  S01277
     C*                                                                   S01277
     C** If record not found write new record to FXEPOCLL.                S01277
     C*                                                                   S01277
     C                     ELSE                            X2             S01277
     C                     MOVE 'I'       FOCHTP                          S01277
     C                     MOVE CPSCCY    FOCCY                           S01277
     C                     MOVE CPPCCY    FOPCCY                          S01277
     C                     WRITEFXEPOCL1                                  S01277
     C*                                                                   S01277
     C                     END                             E2             S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C                     READ FXCRSCLL                 70               S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           #BD9      ENDSR                                          S01277
     C/EJECT                                                              S01277
     C*****************************************************************   S01277
     C*                                                               *   S01277
     C*  SUBROUTINE: #BDA -  Cross exchange rate enquiry              *   S01277
     C*                                                               *   S01277
     C*                                                               *   S01277
     C*  FIELDS USED:  Input  -- CPPCCY    )    Input                 *   S01277
     C*                       -- CPSCCY    )      currencies          *   S01277
     C*                                                               *   S01277
     C*  CALLED BY : #BD                                              *   S01277
     C*  CALLS     : #BDAA                                            *   S01277
     C*                                                               *   S01277
     C*****************************************************************   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C           #BDA      BEGSR                                          S01277
     C*                                                                   S01277
     C***  Access spot days and spot dates for the two currencies         S01277
     C***  via access object                                              S01277
     C**                                                                  S01277
     C                     MOVELCPSCCY    @CUR    3                       S01277
     C*                                                                   S01277
     C                     CALL 'AOCURRR0'                                S01277
     C                     PARM '*MSG   ' @RTCD   7                       S01277
     C                     PARM '*KEY   ' @OPTN   7                       S01277
     C                     PARM @CUR      @AJCD   3                       S01277
     C           SDCURR    PARM SDCURR    DSSDY                           S01277
     C*                                                                   S01277
     C           @RTCD     IFNE *BLANKS                    B1             S01277
     C                     MOVEL'SDCURRPD'DBFILE           *1             S01277
     C                     MOVEL'007'     DBASE            *1             S01277
     C                     MOVEL@CUR      DBKEY            *1             S01277
     C                     MOVE '1'       *INU7            *1             S01277
     C                     MOVE '1'       *INU8            *1             S01277
     C                     GOTO #BDA9                      *1             S01277
     C                     END                             E1             S01277
     C**                                                                  S01277
     C                     MOVELCPSCCY    @@CCY1                          S01277
     C                     Z-ADDA6FXSD    @@SPD1                          S01277
     C                     Z-ADDA6SPDY    @@WSP1                          S01277
     C                     Z-ADDA6HSRT    @HISP1                          S01277
     C                     Z-ADDA6LSPR    @LOSP1                          S01277
     C                     Z-ADDA6DPBF    @DPBF1                          S01277
     C                     Z-ADDA6NBDP    @CDP1                           S01277
     C                     Z-ADDA6NQDP    @NQDP1                          S01277
     C                     MOVELA6MDEX    @XRMD1                          S01277
     C*                                                                   S01277
     C**  move scale exponent to work field                               S01277
     C                     Z-ADDA6SCEX    @SCXP1  10                      S01277
     C***                                                                 S01277
     C                     MOVELCPPCCY    @CUR                            S01277
     C*                                                                   S01277
     C                     CALL 'AOCURRR0'                                S01277
     C                     PARM '*MSG   ' @RTCD   7                       S01277
     C                     PARM '*KEY   ' @OPTN   7                       S01277
     C                     PARM @CUR      @AJCD   3                       S01277
     C           SDCURR    PARM SDCURR    DSSDY                           S01277
     C*                                                                   S01277
     C           @RTCD     IFNE *BLANKS                    B1             S01277
     C                     MOVEL'SDCURRPD'DBFILE           *1             S01277
     C                     MOVEL'008'     DBASE            *1             S01277
     C                     MOVEL@CUR      DBKEY            *1             S01277
     C                     MOVE '1'       *INU7            *1             S01277
     C                     MOVE '1'       *INU8            *1             S01277
     C                     GOTO #BDA9                      *1             S01277
     C                     END                             E1             S01277
     C**                                                                  S01277
     C                     MOVELCPPCCY    @@CCY2                          S01277
     C                     Z-ADDA6FXSD    @@SPD2                          S01277
     C                     Z-ADDA6SPDY    @@WSP2                          S01277
     C                     Z-ADDA6HSRT    @HISP2                          S01277
     C                     Z-ADDA6LSPR    @LOSP2                          S01277
     C                     Z-ADDA6DPBF    @DPBF2                          S01277
     C                     Z-ADDA6NBDP    @CDP2                           S01277
     C                     Z-ADDA6NQDP    @NQDP2                          S01277
     C                     MOVELA6MDEX    @XRMD2                          S01277
     C*                                                                   S01277
     C**  move scale exponent to work field                               S01277
     C                     Z-ADDA6SCEX    @SCXP2  10                      S01277
     C**                                                                  S01277
     C***  Calculate mutual spot day                                      S01277
     C**                                                                  S01277
     C                     EXSR ZA0820                                    S01277
     C                     Z-ADD@@VDT     @@SPDD                          S01277
     C**                                                                  S01277
     C**                                                                  S01277
     C***  Calculate two cross rates for spot date                        S01277
     C**                                                                  S01277
     C                     EXSR #BDAA                                     S01277
     C**                                                                  S01277
     C***  Decide if first rate is low (left column) or high (right)      S01277
     C**                                                                  S01277
     C           @XR1      IFLT @XR2                       B1             S01277
     C                     Z-ADD@XR1      @@LRAT 138       *1             S01277
     C                     Z-ADD@XR2      @@HRAT 138       *1             S01277
     C                     ELSE                            X1             S01277
     C                     Z-ADD@XR2      @@LRAT           *1             S01277
     C                     Z-ADD@XR1      @@HRAT           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           #BDA9     ENDSR                           **#BDA9*       S01277
     C*****************************************************************   S01277
     C/EJECT                                                              S01277
     C*****************************************************************   S01277
     C*                                                               *   S01277
     C*  SUBROUTINE: #BDAA  - Calculate two cross rates for a date    *   S01277
     C*                                                               *   S01277
     C*                                                               *   S01277
     C*  FIELDS USED:  CPPCCY  -- First Currency                      *   S01277
     C*                CPSCCY  -- Second Currency                     *   S01277
     C*                @@VDT   -- Value Date                          *   S01277
     C*                @HISP1/2  -- First/second High Spots           *   S01277
     C*                @LOSP1/2  -- First/second Low Spots            *   S01277
     C*                @XRMD1/2  -- First/second Multiply/divides     *   S01277
     C*                @NQDP1/2  -- First/second Normal Quote Dec.Pl. *   S01277
     C*                                                               *   S01277
     C*                                                               *   S01277
     C*     OUTPUT:    @XR1    -- First Cross Rate                    *   S01277
     C*                @XR2    -- Second Cross Rate                   *   S01277
     C*                @XM1    -- First Multiply/Divide Indicator     *   S01277
     C*                @XM2    -- Second Multiply/Divide Indicator    *   S01277
     C*                                                               *   S01277
     C*  CALLED BY : #BDA                                             *   S01277
     C*  CALLS     : ZA0630                                           *   S01277
     C*              ZA0900                                           *   S01277
     C*              ZA1150     - Convert rate to scaled rate         *   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*****************************************************************   S01277
     C*                                                                   S01277
     C           #BDAA     BEGSR                                          S01277
     C*                                                                   S01277
     C**                                                                  S01277
     C***   Calculate forward outright rates on each line                 S01277
     C**        Each line has a buy and sell for each currency            S01277
     C**           Currency 1, Buy rate, is @RBC1                         S01277
     C**           Currency 1, Sell rate, is @RSC1                        S01277
     C**           Currency 2, Buy rate, is @RBC2                         S01277
     C**           Currency 2, Sell rate, is @RSC2                        S01277
     C**                                                                  S01277
     C                     MOVELCPPCCY    @@CCY   3        *1             S01277
     C                     Z-ADD@HISP1    A6HSRT           *1             S01277
     C                     Z-ADD@LOSP1    A6LSPR           *1             S01277
     C                     MOVEL@XRMD1    A6MDEX           *1             S01277
     C                     MOVEL@NQDP1    A6NQDP           *1             S01277
     C                     Z-ADD@@SPD1    A6FXSD           *1             S01277
     C*                                                                   S01277
     C** MOVE FIRST CURRENCY SCALING TO WORK FIELD                        S01277
     C                     Z-ADD@SCXP1    @@SXP1           *1             S01277
     C**                                                                  S01277
     C                     MOVE 'B'       @@BYSL           *1             S01277
     C                     EXSR ZA0630                     *1             S01277
     C*                                                                   S01277
     C** If database error branch to end of subroutine                    S01277
     C           *INU7     CABEQ'1'       #BDAA9                          S01277
     C*                                                                   S01277
     C                     Z-ADD@@MOR     @RBC1  138       *1             S01277
     C**                                                                  S01277
     C                     MOVE 'S'       @@BYSL           *1             S01277
     C                     EXSR ZA0630                     *1             S01277
     C*                                                                   S01277
     C** If database error branch to end of subroutine                    S01277
     C           *INU7     CABEQ'1'       #BDAA9                          S01277
     C*                                                                   S01277
     C                     Z-ADD@@MOR     @RSC1  138       *1             S01277
     C**                                                                  S01277
     C                     MOVELCPSCCY    @@CCY            *1             S01277
     C                     Z-ADD@HISP2    A6HSRT           *1             S01277
     C                     Z-ADD@LOSP2    A6LSPR           *1             S01277
     C                     MOVEL@XRMD2    A6MDEX           *1             S01277
     C                     MOVEL@NQDP2    A6NQDP           *1             S01277
     C                     Z-ADD@@SPD2    A6FXSD           *1             S01277
     C*                                                                   S01277
     C** MOVE SECOND CURRENCY SCALING TO WORK FIELD                       S01277
     C                     Z-ADD@SCXP2    @@SXP1           *1             S01277
     C**                                                                  S01277
     C                     MOVE 'B'       @@BYSL           *1             S01277
     C                     EXSR ZA0630                     *1             S01277
     C*                                                                   S01277
     C** If database error branch to end of subroutine                    S01277
     C           *INU7     CABEQ'1'       #BDAA9                          S01277
     C*                                                                   S01277
     C                     Z-ADD@@MOR     @RBC2  138       *1             S01277
     C**                                                                  S01277
     C                     MOVE 'S'       @@BYSL           *1             S01277
     C                     EXSR ZA0630                     *1             S01277
     C*                                                                   S01277
     C** If database error branch to end of subroutine                    S01277
     C           *INU7     CABEQ'1'       #BDAA9                          S01277
     C*                                                                   S01277
     C                     Z-ADD@@MOR     @RSC2  138       *1             S01277
     C**                                                                  S01277
     C****   Calculate two cross rates                                    S01277
     C**                                                                  S01277
     C                     Z-ADD@RBC1     @@RAT1           *1             S01277
     C                     Z-ADD@RSC2     @@RAT2           *1             S01277
     C                     MOVEL@XRMD1    @@MDI1           *1             S01277
     C                     MOVEL@XRMD2    @@MDI2           *1             S01277
     C                     EXSR ZA0900                     *1             S01277
     C                     Z-ADD@@CSRT    @XR1             *1             S01277
     C                     MOVEL@@FCMD    @XM1    1        *1             S01277
     C**                                                                  S01277
     C                     Z-ADD@RSC1     @@RAT1 138       *1             S01277
     C                     Z-ADD@RBC2     @@RAT2 138       *1             S01277
     C                     MOVEL@XRMD1    @@MDI1           *1             S01277
     C                     MOVEL@XRMD2    @@MDI2           *1             S01277
     C                     EXSR ZA0900                     *1             S01277
     C                     Z-ADD@@CSRT    @XR2             *1             S01277
     C                     MOVEL@@FCMD    @XM2    1        *1             S01277
     C*                                                                   S01277
     C**                                                                  S01277
     C**    Convert CROSS rate to scale rate                              S01277
     C                     Z-ADD@SCXP1    @@SXP1  10                      S01277
     C                     Z-ADD@SCXP2    @@SXP2  10                      S01277
     C                     Z-ADD@XR1      @@INRT                          S01277
     C                     MOVE 'M'       @@FCMD                          S01277
     C                     EXSR ZA1150                                    S01277
     C*                                                                   S01277
     C**    MOVE SCALE RATED                                              S01277
     C                     Z-ADD@@SCRT    @XR1                            S01277
     C*                                                                   S01277
     C** STORE OUTPUT FIELDS FROM ZA1150 TO WORK FIELD FOR FIRST CCY      S01277
     C                     Z-ADD@@ISRT    @ISRT1                          S01277
     C                     Z-ADD@@ERCD    @ERCD1                          S01277
     C*                                                                   S01277
     C**  Convert CROSS rate to scale rate                                S01277
     C                     Z-ADD@XR2      @@INRT                          S01277
     C                     EXSR ZA1150                                    S01277
     C*                                                                   S01277
     C** STORE OUTPUT FIELDS FROM ZA1150 TO WORK FIELD FOR SECOND CCY     S01277
     C                     Z-ADD@@ISRT    @ISRT2                          S01277
     C                     Z-ADD@@ERCD    @ERCD2                          S01277
     C*                                                                   S01277
     C**    MOVE SCALE RATED                                              S01277
     C                     Z-ADD@@SCRT    @XR2                            S01277
     C*                                                                   S01277
     C**  CHECK  IF RETURN CODE1 ='1'  OR RETURN CODE2 = '1'              S01277
     C**         USE INVERSE OF SCALE RATE FOR BOTH CROSS RATES           S01277
     C           @ERCD1    IFEQ 1                          B1             S01277
     C           @ERCD2    OREQ 1                          B1             S01277
     C                     Z-ADD@ISRT1    @XR1             *1             S01277
     C                     Z-ADD@ISRT2    @XR2             *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  CHECK  IF RETURN CODE ='3' USE 99999.99999999                   S01277
     C           @ERCD1    IFEQ 3                          B1             S01277
     C           @ERCD2    OREQ 3                          B1             S01277
     C                     Z-ADD@IN,1     @XR1             *1             S01277
     C                     Z-ADD@IN,1     @XR2             *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C                     GOTO #BDAA9                                    S01277
     C*                                                                   S01277
     C** DEFINE WORK FIELDS                                               S01277
     C           *LIKE     DEFN @@ISRT    @ISRT1                          S01277
     C           *LIKE     DEFN @@ERCD    @ERCD1                          S01277
     C           *LIKE     DEFN @@ISRT    @ISRT2                          S01277
     C           *LIKE     DEFN @@ERCD    @ERCD2                          S01277
     C*                                                                   S01277
     C           #BDAA9    ENDSR                           **#BDAA9*      S01277
     C*****************************************************************   S01277
      /EJECT
     C*****************************************************************
     C* #BA                                                           *
     C* ---                                                           *
     C* THIS ROUTINE INITIALISES FIELDS IN FILE "FXEPOSLL" AS THE MODE*
     C* WOULD BE INSERT.                                              *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C*****                MOVE CCY       FOCCY                           S01194
     C                     MOVE A6CYCD    FOCCY                           S01194
     C                     Z-ADD0         FONNCP
     C                     Z-ADD0         FONDBC
     C                     Z-ADD0         FOTNTP
     C                     Z-ADD0         FOTDPE
     C                     Z-ADD0         FOBDSE
     C                     MOVE 'I'       FOCHTP
     C*
     C                     ENDSR
      /EJECT
     C*****************************************************************
     C* #BB                                                           *
     C* ------                                                        *
     C* THIS IS THE DRIVING ROUTINE TO CALCULATE THE NOSTRO DEALT BCE.*
     C* CALLS ROUTINES:- #BBA #BBB                                    *
     C* CALLED BY :- #B                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C*
     C                     Z-ADD0         @WORK1
     C                     SETOF                     66
     C*
     C* IF BASE CURRENCY DEALING IS NOT EQUAL TO BASE CURRENCY ACCT.
     C* AND ALSO CURRENCY IS BASE CURRENCY FOR ACCOUNTING THEN ZERO
     C* ADDS NOSTRO NET CURRENCY POSITION TO WORK FIELD @WORK1WHICH
     C* IS THEN USED BY ROUTINE #BBB TO RETURN NOSTRO DEALT BCE.
     C*
     C***********IDCYDL****IFNE*@BCCY*************************************S01319
     C           BNCYDL    IFNE @BCCY                                     S01319
     C           @BCCY     IFEQ @AVCCY
     C                     Z-ADDFONNCP    @WORK1
     C                     GOTO #BB1
     C                     END
     C                     END
     C*
     C**IF*DEFAULT*BRANCH NUMBER IS NOT ZERO THEN IT CALLS #BBA TO        S01117
     C* IF @MBIN OFF DEFAULT BRANCH WILL NOT BE BLANK SO CALL #BBA TO     S01117
     C* GET THE LEDGER BALANCE FROM FILE ACCNT AND THEN CALLS #BBB
     C* TO RETURN THE NOSTRO DEALT BCE.
     C*
     C*****      @DFBR     IFNE 0                                         S01117
     C           @DFBR     IFNE *BLANK                                    S01117
     C                     EXSR #BBA
     C                     GOTO #BB1
     C                     END
     C*
     C* IF DEFAULT BRANCH NUMBER IS ZERO (@MBIN ON) THEN IT READS FILE
     C* SDBRCHL1 TO GET ALL THE VALID CUSTOMER NOS,BY WHICH IT ACCESSES
     C* FILE ACCNT FOR EACH OF THE VALID CUSTOMER NOS FOR THAT CURRENCY
     C* AND TOTALS THE LEDGER BALANCES WHICH IS THEN USED TO CALCULATE
     C* THE NOSTRO DEALT BCE
     C*
     C*
     C*****                MOVE *BLANKS   @DBR1                           S01194
     C*
     C*****      @DBR      SETLLFDBRNCLL                                  S01194
     C           *LOVAL    SETLLSDBRCHL1                                  S01194
     C*
     C                     SETOF                     68
     C*
     C           *IN68     DOWEQ'0'
     C*
     C* READS THE TABLE FILE FDBRNCLL TO GET VALID CUSTOMER NOS.
     C*
     C*****                READ FDBRNCLL                 68               S01194
     C                     READ SDBRCHL1                 68               S01194
     C*
     C           *IN68     IFEQ '0'
     C*
     C*****                Z-ADDBICN      @ACC1                           S01194
     C*****                MOVE @BCCY     @ACC2                           S01194
     C*****                Z-ADDTACC      @ACC3                           S01194
     C*****                Z-ADD01        @ACC4                           S01194
     C**********           MOVE A8BICN    @ACC1   60                                   S01194 CSD027
     C                     MOVE A8BICN    @ACC1   6                                           CSD027
     C                     MOVE @BCCY     @ACC2   3                       S01194
     C**********           MOVE A6SPAE    @ACC3   40                                   S01194 CGL029
     C                     MOVE A6SPAE    @ACC3  100                                          CGL029
     C                     Z-ADD01        @ACC4   20                      S01194
     C                     MOVE A8BRCD    @ACC5   3                       S01194
     C*
     C* READS THE ACCNT FILE TO GET LEDGER BALANCES.
     C*
     C           @ACCNT    CHAINACCNT                69
     C           *IN69     IFEQ '1'
     C                     ADD  0         @WORK1
     C                     ELSE
     C                     ADD  LDBL      @WORK1
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C*
     C***********@WORK1    IFNE 0                                         S01136
     C***********          Z-SUB@WORK1    @WORK1                          S01136
     C***********          END                                            S01136
     C*
     C           #BB1      TAG
     C*
     C* ROUTINE CALLED TO CALCULATE NOSTRO DEALT BCE.
     C*
     C***********IDCYDL****IFNE*@BCCY*************************************S01319
     C           BNCYDL    IFNE @BCCY                                     S01319
     C                     EXSR #BBB
     C                     END
     C*
     C                     Z-ADD@WORK1    FONDBC
     C*
     C           #BB9      ENDSR
      /EJECT
     C*****************************************************************
     C* #BBA                                                          *
     C* ----                                                          *
     C* THIS ROUTINE READS FILE "SDBRCHPD" WHEN DEFAULT BRANCH NO.    *
     C* IS NOT 0 AND THEN GETS THE LEDGER BALANCE FROM THE "ACCNT"    *
     C* FILE.IT THEN REVERSES THE SIGN OF THE BALANCE.                *
     C* ROUTINE CALLED BY :- #BB                                      *
     C*****************************************************************
     C           #BBA      BEGSR
     C*
     C*****                MOVE *BLANKS   @DBR1                           S01194
     C*****                MOVEL'10'      @DBR1                           S01194
     C*****                MOVE @DFBR     @DBR1                           S01194
     C*
     C* READS THE  FILE SDBRCHPD TO GET THE VALID CUSTOMER NO.
     C* IF THE RECORD IS MISSING IT CONSIDERS A ZERO BALANCE.
     C*
     C*****      @DBR      CHAINFDBRNCLL             68                   S01194
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DFBR     @DSNB   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C*****      *IN68     IFEQ '1'                                       S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     Z-ADD0         @WORK1
     C                     GOTO #BBA9
     C                     END
     C*
     C*****                Z-ADDBICN      @ACC1                           S01194
     C                     MOVE A8BICN    @ACC1                           S01194
     C                     MOVE @BCCY     @ACC2
     C*****                Z-ADDTACC      @ACC3                           S01194
     C                     MOVE A6SPAE    @ACC3                           S01194
     C                     Z-ADD01        @ACC4
     C                     MOVE @DFBR     @ACC5                           S01194
     C*
     C* READS THE ACCNT FILE TO GET THE LEDGER BALANCE FOR THE ABOVE
     C* CUSTOMER NO. FROM FDBRNCLL IF MISSING THEN ZERO BALANCE IS
     C* IS CONSIDERED.
     C*
     C           @ACCNT    CHAINACCNT                69
     C           *IN69     IFEQ '1'
     C                     Z-ADD0         @WORK1
     C                     ELSE
     C                     Z-ADDLDBL      @WORK1
     C                     END
     C*
     C***********@WORK1    IFNE 0                                         S01136
     C***********          Z-SUB@WORK1    @WORK1                          S01136
     C***********          END                                            S01136
     C*
     C           #BBA9     ENDSR
      /EJECT
     C*****************************************************************
     C* #BBB                                                          *
     C* ----                                                          *
     C* THIS ROUTINE USES THE WORK-FIELD(@WORK1) TO CONVERT IT INTO   *
     C* THE NOSTRO DEALT BCE USING MIDAS SPOT RATE  AND NO. OF        *
     C* DECIMAL PLACES FROM SDCURRPD FOR BASE CURRENCY DEALING AND    *
     C* THE NO. OF DECIMAL PLACES FROM SDCURRPD FOR BASE CURRENCY
     C* ACCOUNTING.
     C*****************************************************************
     C           #BBB      BEGSR
     C*
     C           *IN66     IFEQ '1'
     C                     SETOF                     66
     C                     GOTO #BBB1
     C                     END
     C*
     C           @WORK1    IFEQ 0
     C                     GOTO #BBB9
     C                     END
     C*
     C* MOVING MULTIPLY INDICATOR AND SPOT RATE FROM BASE CURRENCY
     C* FOR DEALING
     C*
     C                     Z-ADDRSPOT     @WSPOT
     C*****                Z-ADDRMDIN     @MDIN                           S01194
     C                     MOVE RMDIN     @MDIN                           S01194
     C*
     C**CHECKING*IF*MULTIPLY INDICATOR IS 0 OR 1. IF 0 THEN MULTIPLY      S01117
     C**AS*CONVERSION*IS FROM ACC0UNTING TO DEALING BASE CURRENCY         S01117
     C**ELSE*THE*REVERSE I.E. DIVIDE                                      S01117
     C* CHECKING IF MULTIPLY INDICATOR IS D OR M. IF D THEN MULTIPLY      S01117
     C* AS CONVERSION IS FROM ACC0UNTING TO DEALING BASE CURRENCY         S01117
     C* ELSE THE REVERSE I.E. DIVIDE                                      S01117
     C*
     C*****      @MDIN     IFEQ 0                                         S01117
     C           @MDIN     IFEQ 'D'                                       S01117
     C                     MULT @WSPOT    @WORK1    H
     C                     ELSE
     C                     DIV  @WSPOT    @WORK1    H
     C                     END
     C*
     C* CORRECT DECIMAL PLACES OF REVALUED AMOUNT WITH RESPECT TO
     C* BASE CURRENCY FOR DEALING
     C*
     C           @CDP      SUB  RCDP      @@P     10
     C                     ADD  4         @@P
     C           @WORK1    MULT @DP,@@P   @WORK1    H
     C*
     C                     GOTO #BBB9
     C*
     C           #BBB1     TAG
     C*
     C**CHECKING*IF*THE*MODE*IS*AMEND.*IF*AMEND*EXIT*OUT.*****************S01136
     C**INSERTING BANK DEALT SPOT BCE.************************************S01136
     C************                                                        S01136
     C************IN62     IFEQ '0'                                       S01136
     C************         GOTO #BBB9                                     S01136
     C************         END                                            S01136
     C*
     C           FOTNTP    IFEQ 0
     C                     Z-ADD0         FOBDSE
     C                     GOTO #BBB9
     C                     END
     C* IF DIVIDE/MULTIPLY INDICATOR IS D AND TOTAL NET CURR.POSTION
     C* IS POSITIVE THEN USE HIGH SPOT RATE. THE SAME IF INDICATOR
     C* IS MULTIPLY(M) AND TOTAL NET CURR.POSITION IS NEGATIVE.
     C*
     C*
     C** Use Spot Rate if High/Low Spot Rate is zero.                     193092
     C*                                                                   193092
     C           FOTNTP    IFGT 0
     C*****      XRMD      IFEQ 'D'                                       S01194
     C*****      FOTNTP    DIV  HGSP      FOBDSE    H                     S01194
     C           A6MDEX    IFEQ 'D'                                       S01194
     C*                                                                   193092
     C           A6HSRT    IFNE 0                                         193092
     C           FOTNTP    DIV  A6HSRT    FOBDSE    H                     S01194
     C                     ELSE                                           193092
     C           FOTNTP    DIV  A6SPRT    FOBDSE    H                     193092
     C                     END                                            193092
     C*                                                                   193092
     C                     END
     C                     END
     C*
     C           FOTNTP    IFLT 0
     C*****      XRMD      IFEQ 'M'                                       S01194
     C*****      FOTNTP    MULT HGSP      FOBDSE    H                     S01194
     C           A6MDEX    IFEQ 'M'                                       S01194
     C*                                                                   193092
     C           A6HSRT    IFNE 0                                         193092
     C           FOTNTP    MULT A6HSRT    FOBDSE    H                     S01194
     C                     ELSE                                           193092
     C           FOTNTP    MULT A6SPRT    FOBDSE    H                     193092
     C                     END                                            193092
     C*                                                                   193092
     C                     END
     C                     END
     C*
     C* IF DIVIDE/MULTIPLY INDICATOR IS D AND TOTAL NET CURR.POSTION
     C* IS NEGATIVE THEN USE LOW SPOT RATE. THE SAME IF INDICATOR
     C* IS MULTIPLY(M) AND TOTAL NET CURR.POSITION IS POSITIVE.
     C*
     C           FOTNTP    IFLT 0
     C*****      XRMD      IFEQ 'D'                                       S01194
     C*****      FOTNTP    DIV  LOSP      FOBDSE    H                     S01194
     C           A6MDEX    IFEQ 'D'                                       S01194
     C*                                                                   193092
     C           A6LSPR    IFNE 0                                         193092
     C           FOTNTP    DIV  A6LSPR    FOBDSE    H                     S01194
     C                     ELSE                                           193092
     C           FOTNTP    DIV  A6SPRT    FOBDSE    H                     193092
     C                     END                                            193092
     C*                                                                   193092
     C                     END
     C                     END
     C*
     C           FOTNTP    IFGT 0
     C*****      XRMD      IFEQ 'M'                                       S01194
     C*****      FOTNTP    MULT LOSP      FOBDSE    H                     S01194
     C           A6MDEX    IFEQ 'M'                                       S01194
     C*                                                                   193092
     C           A6LSPR    IFNE 0                                         193092
     C           FOTNTP    MULT A6LSPR    FOBDSE    H                     S01194
     C                     ELSE                                           193092
     C           FOTNTP    MULT A6SPRT    FOBDSE    H                     193092
     C                     END                                            193092
     C*                                                                   193092
     C                     END
     C                     END
     C*
     C* CORRECT DECIMAL PLACES OF REVALUED AMOUNT WITH RESPECT TO
     C* BASE CURRENCY FOR ACCOUNTING
     C*
     C*****      CDP       SUB  @CDP      @@P     10                      S01194
     C           A6NBDP    SUB  @CDP      @@P     10                      S01194
     C                     ADD  4         @@P
     C           FOBDSE    MULT @DP,@@P   FOBDSE    H
     C*
     C           #BBB9     ENDSR
      /EJECT
     C*****************************************************************
     C* #BC                                                           *
     C* ----                                                          *
     C* THIS ROUTINE CALCULATES THE TOTAL NET POSITION (FOTNTP) AND   *
     C* TOTAL DEALT POSITION BCE (FOTDPE) BY SCANNING THE HALF        *
     C* MONTHLY SUMMARIES FILE "FXFWMHLL". IT ALSO CALLS ROUTINE      *
     C* #BBB IF THE MODE IS INSERT SO AS TO CALCULATE THE NOSTRO      *
     C* DEALT BASE CURRENCY EQIUVALENT (FONDBC).                      *
     C*****************************************************************
     C           #BC       BEGSR
     C*
     C                     SETOF                     70
     C                     SETON                     66
     C                     MOVE @AVCCY    @FXMH1
     C*
     C           @FXMH     SETLLFXFWMHLL
     C*
     C           *IN70     DOWEQ'0'
     C*
     C           @FXMH     READEFXFWMHLL                 70
     C*
     C           *IN70     IFEQ '0'
     C                     ADD  FQHMNM    FOTNTP
     C                     ADD  FQHMDE    FOTDPE
     C                     END
     C                     END
     C*
     C                     ADD  FONNCP    FOTNTP
     C                     ADD  FONDBC    FOTDPE
     C*
     C                     EXSR #BBB
     C*
     C                     ENDSR
      /EJECT
     C*****************************************************************   S01277
     C*                                                               *   S01277
     C*       TITLE:DETERMINE SPOT DATE.      .                       *   S01277
     C*                                                               *   S01277
     C* INPUT  :@@CCY1 CURRENCY-1.                        -FORMAT(3A) *   S01277
     C*         @@CCY2 CURRENCY-2.                        -FORMAT(3A) *   S01277
     C*         @@WSP1 SPOT DAYS CURRENCY-1               -FORMAT(3N) *   S01277
     C*         @@WSP2 SPOT DAYS CURRENCY-2               -FORMAT(3N) *   S01277
     C*         @@SPD1 SPOT DATE FOR CURRENCY-1           -FORMAT(8N) *   S01277
     C*         @@SPD2 SPOT DATE FOR CURRENCY-2           -FORMAT(8N) *   S01277
     C**********IDCYDL*BASE*CURRENCY*FOR*DEALING**********-FORMAT(3AS01277S01319
     C*         BNCYDL BASE CURRENCY FOR DEALING          -FORMAT(3A) *   S01319
     C*                                                               *   S01277
     C* OUTPUT :@@VDT  DATE (YYYYMMDD)                    -FORMAT(8N) *   S01277
     C*                                                               *   S01277
     C* USES :   @@DAYN MIDAS DAY NO USED BY SR ZA0710                *   S01277
     C*          ZDAYNO MIDAS DAY NO USED BY SR ZCHKH & THIS ROUTINE  *   S01277
     C*          ZIND   HOLIDAY IND.RETURNED BY ZCHKH                 *   S01277
     C*          ZCCY   CURRENCY SHORTNAME FIELD USED BY ZCHKH        *   S01277
     C*          ZLOC   CCY LOCATION CODE USED BY ZCHKH               *   S01277
     C*          @@CDYN CALCULATED SPOT DATE DAY NO.                  *   S01277
     C*          @@SPDY NO. OF SPOT DAYS REQUIRED.                    *   S01277
     C*          @@WDAD NO. OF WORKING DAYS ADDED TO CURRENT DAY NO.  *   S01277
     C*                                                              *    S01277
     C* CALLED BY:  #BD                                              *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C* CALLS:                                                       *    S01277
     C*                                                              *    S01277
     C*                                                               *   S01277
     C*     AMEND NO. 000001                  DATE   14/07/86        *    S01277
     C*       Amendment to calculate Spot Date on the basis of only  *    S01277
     C*       mutual working days.                                   *    S01277
     C*                                                              *    S01277
     C*****************************************************************   S01277
     C*                                                               *   S01277
     C           ZA0820    BEGSR                                          S01277
     C*                                                                   S01277
     C**  DEFINE AND INITIALISE FIELDS USED IN THIS ROUTINE.              S01277
     C                     Z-ADD0         @@CDYN  50                      S01277
     C                     Z-ADD0         @@VDT   80                      S01277
     C                     Z-ADD0         @@SPDY  30                      S01277
     C                     Z-ADD0         @@WDAD  30                      S01277
     C                     Z-ADD0         @@DAYN  50                      S01277
     C*                                                                   S01277
     C**  CHECK IF THE FIRST CURRENCY IS THE BASE CURRENCY FOR DEALING    S01277
     C**  - IF IT IS BLANK THIS ALSO MEANS IT IS THE BASE CURRENCY.       S01277
     C***********@@CCY1****IFEQ*IDCYDL*********************B1*******S01277S01319
     C           @@CCY1    IFEQ BNCYDL                     B1             S01319
     C           @@CCY1    OREQ *BLANK                     X1             S01277
     C*                                                                   S01277
     C**  IF IT IS THE BASE CURRENCY FOR DEALING, USE THE SPOT DATE FOR   S01277
     C**  THE OTHER CURRENCY - THEN BY-PASS FURTHER PROCESSING.           S01277
     C                     Z-ADD@@SPD2    @@VDT            *1             S01277
     C                     GOTO ZA0829                     *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  CHECK IF THE SECOND CURRENCY IS THE BASE CURRENCY FOR DEALING   S01277
     C**  - IF IT IS BLANK THIS ALSO MEANS IT IS THE BASE CURRENCY.       S01277
     C***********@@CCY2****IFEQ*IDCYDL*********************B1*******S01277S01319
     C           @@CCY2    IFEQ BNCYDL                     B1             S01319
     C           @@CCY2    OREQ *BLANK                     X1             S01277
     C*                                                                   S01277
     C**  IF IT IS THE BASE CURRENCY FOR DEALING, USE THE SPOT DATE FOR   S01277
     C**  THE OTHER CURRENCY - THEN BY-PASS FURTHER PROCESSING.           S01277
     C                     Z-ADD@@SPD1    @@VDT            *1             S01277
     C                     GOTO ZA0829                     *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  NEITHER CURRENCY IS THE BASE CURRENCY FOR DEALING - CALCULATE   S01277
     C**  THE SPOT DATE.                                                  S01277
     C*                                                                   S01277
     C**  SET THE SPOT DATE TO BE CALCULATED TO THE MIDAS RUNDATE.        S01277
     C                     Z-ADDBJRDNB    @@CDYN                          S01277
     C*                                                                   S01277
     C**  DETERMINE WHICH OF THE CURRENCIES HAS THE LARGER NUMBER OF      S01277
     C**  SPOT DAYS AND USE THAT FIGURE AS THE NUMBER OF SPOT DAYS        S01277
     C**  REQUIRED.                                                       S01277
     C           @@WSP1    IFGT @@WSP2                                    S01277
     C*                                                                   S01277
     C                     Z-ADD@@WSP1    @@SPDY                          S01277
     C*                                                                   S01277
     C                     ELSE                                           S01277
     C*                                                                   S01277
     C                     Z-ADD@@WSP2    @@SPDY                          S01277
     C*                                                                   S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C**  INITIALISE THE NUMBER OF WORKING DAYS ADDED TO THE CURRENT      S01277
     C**  DATE.                                                           S01277
     C                     Z-ADD0         @@WDAD                          S01277
      *                                                                   S01277
      * Set up location code input for SR.ZCHKH as system location        S01277
      * from PF/SDBANKPD                                                  S01277
     C                     MOVELBJSLCD    ZLOC                            S01277
     C*                                                                   S01277
     C**  CONTINUE PROCESSING WHILST THE NUMBER OF SPOT DAYS REQUIRED     S01277
     C**  IS GREATER THAN THE NUMBER OF WORKING DAYS ADDED TO THE         S01277
     C**  CURRENT DATE.                                                   S01277
     C           @@SPDY    DOWGT@@WDAD                     B1             S01277
     C*                                                                   S01277
     C**  CONTINUE PROCESSING WHILST THE CALC. SPOT DATE IS A HOLIDAY     S01277
     C**  FOR EITHER CURRENCY.                                            S01277
     C                     MOVE 'H'       ZIND             *1             S01277
     C           ZIND      DOWEQ'H'                        B*2            S01277
     C*                                                                   S01277
     C**  INCREMENT THE SPOT DATE BEING CALCULATED BY ONE DAY.            S01277
     C                     ADD  1         @@CDYN           **2            S01277
     C*                                                                   S01277
     C**  CHECK WHETHER THE CALC. SPOT DATE IS A HOLIDAY FOR THE FIRST    S01277
     C**  CURRENCY BY EXECUTING SR. ZCHKH                                 S01277
     C                     MOVE @@CCY1    ZCCY             **2            S01277
     C                     Z-ADD@@CDYN    ZDAYNO           **2            S01277
     C                     EXSR ZCHKH                      **2            S01277
     C*                                                                   S01277
     C**  IF THE SPOT DATE IS NOT A HOLIDAY FOR THE FIRST CURRENCY,       S01277
     C**  CHECK WHETHER THE CALC. SPOT DATE IS A HOLIDAY FOR THE          S01277
     C**  SECOND CURRENCY BY EXECUTING SR. ZCHKH                          S01277
     C           ZIND      IFNE 'H'                        B**3           S01277
     C*                                                                   S01277
     C                     MOVE @@CCY2    ZCCY             ***3           S01277
     C                     Z-ADD@@CDYN    ZDAYNO           ***3           S01277
     C                     EXSR ZCHKH                      ***3           S01277
     C*                                                                   S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C**  INCREMENT THE NO. OF WORKING DAYS ADDED TO THE CURRENT DATE     S01277
     C**  BY ONE DAY.                                                     S01277
     C                     ADD  1         @@WDAD           *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C**  CONVERT THE RESULTING SPOT DATE TO YYYYMMDD FORM.               S01277
     C*                                                                   S01277
     C                     Z-ADD@@CDYN    @@DAYN                          S01277
     C                     EXSR ZA0710                                    S01277
     C*                                                                   S01277
     C           ZA0829    ENDSR                           **ZA8029**     S01277
     C*****************************************************************   S01277
     C/EJECT                                                              S01277
     C****************************************************************    S01277
     C*                                                              *    S01277
     C* ZA0630 - THIS SUBROUTINE CALCULATES THE FORWARD OUTRIGHT RATE*    S01277
     C*                                                              *    S01277
     C* CALLED BY:   #BDA                                            *    S01277
     C*                                                              *    S01277
     C* CALLS :   ZA0700                                             *    S01277
     C*       :   ZA1150   - Convert rate to scaled rate             *    S01277
     C*       :   ZA1160   - Convert scale rate to unscaled rate      *   S01277
     C*                                                              *    S01277
     C* INPUT  :  @@BYSL BUY/SELL RATE                         (1A)  *    S01277
     C*        :  @@SXP1 FIRST CURRENCY  SCALING EXPONENT      (1N)  *    S01277
     C*        :  @@SXP2 SECOND CURRENCY SCALING EXPONENT      (1N)  *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C* OUTPUT :  @@MOR  FORWARD OUTRIGHT RATE                 (13N) *    S01277
     C*           @@MDI1 MULTIPLY/DIVIDE INDICATOR             (1A)  *    S01277
     C*                                                              *    S01277
     C* USES :    @@SPRT SPOT RATE                                   *    S01277
     C*           @@FPT  FORWARD POINTS                              *    S01277
     C*           @@C    ARRAY INDEX                                 *    S01277
     C*           @@AY   ARRAY OF POWERS OF 10                       *    S01277
     C*           @@WF1  WORKFIELD                                   *    S01277
     C*****************************************************************   S01277
     C*                                                                   S01277
     C           ZA0630    BEGSR                                          S01277
     C           @@BYSL    IFEQ 'B'                        B1             S01277
     C*                                                                   S01277
     C** If multiply/divide indicator is 'M' move high spot rate to       S01277
     C** spot rate work field otherwise fill with low spot rate.          S01277
     C           A6MDEX    IFEQ 'M'                        B*2            S01277
     C                     MOVE A6HSRT    @@SPRT 138       **2            S01277
     C*                                                                   S01277
     C** Otherwise multiply/divide is 'D'.                                S01277
     C                     ELSE                            X*2            S01277
     C                     MOVE A6LSPR    @@SPRT           **2            S01277
     C                     END                             E*2            S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           @@BYSL    IFEQ 'S'                        B1             S01277
     C*                                                                   S01277
     C** If multiply/divide indicator is 'M' move low spot rate to        S01277
     C** spot rate work field otherwise fill with high spot rate.         S01277
     C           A6MDEX    IFEQ 'M'                        B*2            S01277
     C                     MOVE A6LSPR    @@SPRT           **2            S01277
     C*                                                                   S01277
     C** Otherwise multiply/divide is 'D'.                                S01277
     C                     ELSE                            X*2            S01277
     C                     MOVE A6HSRT    @@SPRT           **2            S01277
     C                     END                             E*2            S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** Store multiply/divide indicator for output from routine.         S01277
     C                     MOVE A6MDEX    @@MDI1  1                       S01277
     C                     Z-ADD@@SXP1    @@SXP1                          S01277
     C                     Z-ADD0         @@SXP2                          S01277
     C                     Z-ADD@@SPRT    @@INRT                          S01277
     C                     MOVE 'M'       @@FCMD                          S01277
     C                     EXSR ZA1150                                    S01277
     C*                                                                   S01277
     C** CHECK FOR RETURN ERROR CODE                                      S01277
     C           @@ERCD    IFEQ 1                                         S01277
     C           @@ERCD    OREQ 3                                         S01277
     C*                                                                   S01277
     C** SET UP DATABASE ERROR FIELDS                                     S01277
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01277
     C                     MOVEL'905'     DBASE            * DBERROR 905 *S01277
     C                     MOVEL@TXT,1    DBKEY            ***************S01277
     C                     MOVE '1'       *INU7                           S01277
     C                     MOVE '1'       *INU8                           S01277
     C                     GOTO ZA0639                                    S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C** MOVE scale rate TO WORK FIELD                                    S01277
     C                     Z-ADD@@SCRT    @@SPRT                          S01277
     C*                                                                   S01277
     C** ZA0700  is an internal subroutine which is used                  S01277
     C** to obtain forward points(@@FPT).                                 S01277
     C                     EXSR ZA0700                                    S01277
     C*                                                                   S01277
     C** Calculate forward outright rate by adding high/low spot rate     S01277
     C** to forward points & then dividing the result by 10 to the        S01277
     C** power of A6NQDP (normally quoted decimal places).                S01277
     C                     Z-ADDA6NQDP    @@C     20                      S01277
     C                     ADD  1         @@C                             S01277
     C           @@FPT     DIV  @@AY,@@C  @@WF1  158H                     S01277
     C           @@WF1     ADD  @@SPRT    @@MOR  138                      S01277
     C*                                                                   S01277
     C** Unscale forward outright rate                                    S01277
     C                     Z-ADD@@SXP1    @@SEXP                          S01277
     C                     Z-ADD@@MOR     @@INRT                          S01277
     C                     EXSR ZA1160                                    S01277
     C                     Z-ADD@@USRT    @@MOR                           S01277
     C                     GOTO ZA0639                                    S01277
     C*                                                                   S01277
     C** Unexecuted processing to define fields used in routine.          S01277
     C                     MOVE @@BYSL    @@BYSL  1                       S01277
     C                     MOVE @@FPT     @@FPT   72                      S01277
     C*                                                                   S01277
     C           ZA0639    ENDSR                                          S01277
     C*                                                                   S01277
     C*****************************************************************   S01277
     C/EJECT                                                              S01277
     C****************************************************************    S01277
     C*                                                              *    S01277
     C* ZA0900 - THIS SUBROUTINE CALCULATES THE CROSS EXCHANGE RATE  *    S01277
     C*                                                              *    S01277
     C* CALLED BY :  #BDA                                            *    S01277
     C*                                                              *    S01277
     C* CALLS :                                                      *    S01277
     C*                                                              *    S01277
     C* INPUT  : @@MDI1  FIRST MULTIPLY/DIVIDE INDICATOR             *    S01277
     C*          @@MDI2  SECOND MULTIPLY/DIVIDE INDICATOR            *    S01277
     C*          @@RAT1  FIRST RATE (SIZE : 13,8)                    *    S01277
     C*          @@RAT2  SECOND RATE (SIZE : 13,8)                   *    S01277
     C*                                                              *    S01277
     C* OUTPUT : @@CSRT  CROSS RATE  (SIZE : 13,8)                   *    S01277
     C*          @@FCMD  FIRST CCY MULTIPLY/DIVIDE INDICATOR         *    S01277
     C*                                                              *    S01277
     C* USES :                                                       *    S01277
     C*                                                              *    S01277
     C*     LAST AMEND NO. 000003             DATE   21/08/86        *    S01277
     C*      Amendment to prevent divide by zero.                    *    S01277
     C*                                                              *    S01277
     C****************************************************************    S01277
     C*                                                                   S01277
     C           ZA0900    BEGSR                                          S01277
     C*                                                                   S01277
     C           @@RAT1    IFEQ *ZERO                      B1             S01277
     C                     Z-ADD1         @@RAT1           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           @@RAT2    IFEQ *ZERO                      B1             S01277
     C                     Z-ADD1         @@RAT2           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  IF THE FIRST RATE M/D INDICATOR IS 'M' MULTIPLY,                S01277
     C**             ELSE DIVIDE                                          S01277
     C*                                                                   S01277
     C           @@MDI1    IFEQ 'M'                        B1             S01277
     C                     Z-ADD@@RAT1    @@CSRT 138       *1             S01277
     C                     ELSE                            X1             S01277
     C           1         DIV  @@RAT1    @@CSRT    H      *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  IF THE SECOND RATE M/D INDICATOR IS 'D' MULTIPLY,               S01277
     C**             ELSE DIVIDE                                          S01277
     C*                                                                   S01277
     C           @@MDI2    IFEQ 'D'                        B1             S01277
     C           @@CSRT    MULT @@RAT2    @@CSRT           *1             S01277
     C                     ELSE                            X1             S01277
     C           @@CSRT    DIV  @@RAT2    @@CSRT    H      *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C**  SET FIRST CCY MULTIPLY/DIVIDE *IN TO MULTIPLY                   S01277
     C                     MOVE 'M'       @@FCMD  1                       S01277
     C*                                                                   S01277
     C           ZA0909    ENDSR                           **ZA0909 TAG** S01277
     C*****************************************************************   S01277
     C/EJECT                                                              S01277
     C****************************************************************    S01277
     C*                                                              *    S01277
     C* ZA0700 - THIS SUBROUTINE CALCULATES FORWARD POINTS           *    S01277
     C*                                                              *    S01277
     C* CALLED BY:ZA0630                                             *    S01277
     C*                                                              *    S01277
     C* CALLS :   ZA0680                                             *    S01277
     C*                                                              *    S01277
     C* INPUT  :  @@VDT  VALUE DATE                            (8N)  *    S01277
     C*           @@CCY  CURRENCY CODE                         (3A)  *    S01277
     C*           @@BYSL BUY/SELL RATE                         (1A)  *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C* OUTPUT :  @@FPT  FORWARD POINTS                        (7N)  *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C* ADDITIONAL WORK FIELDS USED WITHIN THIS ROUTINE :                 S01277
     C*                                                              *    S01277
     C*           @@SPDT SPOT DATE             (MIDAS DAY NO.)       *    S01277
     C*           @@VDAT VALUE DATE            (MIDAS DAY NO.)       *    S01277
     C*           @@TPRD TYPE OF PERIOD        ('W' IS WEEKS)        *    S01277
     C*           @@PRD  NUMBER OF PERIODS                           *    S01277
     C*           @@FP1  FORWARD POINTS FROM 1ST REC. USED IN CALC.  *    S01277
     C*           @@FP2  FORWARD POINTS FROM 2ND REC. USED IN CALC.  *    S01277
     C*           @@D1   MIDAS DAY NO. CORRESPONDING WITH @@FP1      *    S01277
     C*           @@D2   MIDAS DAY NO. CORRESPONDING WITH @@FP2      *    S01277
     C*           @@WF1  WORK FIELD HOLDING INTERMEDIATE RESULT FROM *    S01277
     C*                                                  CALCULATION.*    S01277
     C*           @@WF2  WORK FIELD HOLDING INTERMEDIATE RESULT FROM *    S01277
     C*                                                  CALCULATION.*    S01277
     C*           @@MDNO MIDAS DAY NUMBER RETURNED FROM SR @@MDNO    *    S01277
     C*           @@DTWF DATE WORKFIELD                              *    S01277
     C*                                                              *    S01277
     C*           @@CCY1 1st Currency                                *    S01277
     C*           @@CCY2 2nd Currency                                *    S01277
     C*           @@CC1D Read(red) 1st point for 1st Ccy             *    S01277
     C*           @@CC2D Read(red) 1st point for 2nd Ccy             *    S01277
     C*           @@PRD1 Stored period date for 1st point, 1st Ccy   *    S01277
     C*           @@PRD2 Stored period date for 1st point, 2nd Ccy   *    S01277
     C*           @@PRDD Stored period date for 1st point, this Ccy  *    S01277
     C*           @@CC1W 1W point record for 1st Ccy read(red)       *    S01277
     C*           @@CC2W 1W point record for 2nd Ccy read(red)       *    S01277
     C*           @@C1LP 1W 1st Ccy low points                       *    S01277
     C*           @@C2LP 1W 2nd Ccy low points                       *    S01277
     C*           @@C1HP 1W 1st Ccy high points                      *    S01277
     C*           @@C2HP 1W 2nd Ccy high points                      *    S01277
     C*           @@D2C1 1W 1st Ccy period date day no.              *    S01277
     C*           @@D2C2 1W 2nd Ccy period date day no.              *    S01277
     C*           @@SPC1 1W 1st Ccy spot date day no.                *    S01277
     C*           @@SPC2 1W 2nd Ccy spot date day no.                *    S01277
     C*           @@CCYL Currency used by previous Exsr of ZA0700    *    S01277
     C*           @@VDTL Value date used by previous Exsr of ZA0700  *    S01277
     C*           @@CNFD No record found for currency with > date    *    S01277
     C*           @@XCCY Stored Ccy from last Exsr                   *    S01277
     C*           @@XPRD Stored Period Date from last Exsr           *    S01277
     C*           @@XTPR Stored Period Type from last Exsr           *    S01277
     C*           @@XLOP Stored Low Points from last Exsr            *    S01277
     C*           @@XHIP Stored High Points from last Exsr           *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C*     AMEND NO. XXXXX                    DATE XX/XX/XX         *    S01277
     C*                                                              *    S01277
     C*****************************************************************   S01277
     C*                                                                   S01277
     C           ZA0700    BEGSR                                          S01277
     C*                                                                   S01277
     C**  Only access 1st points record once per currency.                S01277
     C           @@CCY     IFEQ @@CCY1                     B1             S01277
     C           @@CC1D    ANDNE'Y'                        A1             S01277
     C           @@CCY     OREQ @@CCY2                     B1             S01277
     C           @@CC2D    ANDNE'Y'                        A1             S01277
     C*                                                                   S01277
     C**  Find first record on file for currency.                         S01277
     C                     MOVE *LOVAL    @@DTWF  80       *1             S01277
     C*                                                                   S01277
     C**  Load key used to access LF/FXCCYPLL.                            S01277
     C           CCYLOW    KLIST                                          S01277
     C                     KFLD           @@CCY            *1             S01277
     C                     KFLD           @@DTWF           *1             S01277
     C           CCYLOW    SETLLFXCCYPLL                   *1             S01277
     C                     READ FXCCYPLL                 81*1             S01277
     C*                                                                   S01277
     C** If currency for record has not been found                        S01277
     C** then there is a database error.                                  S01277
     C           @@CCY     IFNE XPCCY                      B*2            S01277
     C                     MOVEL'FXCCYPLL'DBFILE           **2            S01277
     C                     MOVEL'924'     DBASE            ***************S01277
     C                     MOVEL@@CCY     DBKEY            *             *S01277
     C                     MOVE '1'       *INU7            * DBERROR 924 *S01277
     C                     MOVE '1'       *INU8            *             *S01277
     C                     GOTO ZA0709                     ***************S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C*   Store period date for 1st points record for ccy                 S01277
     C           @@CCY     IFEQ @@CCY1                     B*2            S01277
     C                     MOVE XPPRDD    @@PRD1  80       **2            S01277
     C                     MOVE 'Y'       @@CC1D           **2            S01277
     C                     ELSE                            X*2            S01277
     C                     MOVE XPPRDD    @@PRD2  80       **2            S01277
     C                     MOVE 'Y'       @@CC2D           **2            S01277
     C                     END                             E*2            S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C*   Store period date for 1st points record for ccy                 S01277
     C           @@CCY     IFEQ @@CCY1                     B1             S01277
     C                     MOVE @@PRD1    @@PRDD  80       *1             S01277
     C                     ELSE                            X1             S01277
     C                     MOVE @@PRD2    @@PRDD           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** If the value date is spot date , or before the first record      S01277
     C** on file for the currency then the points are zero.               S01277
     C*                                                                   S01277
     C           @@VDT     IFEQ A6FXSD                     B1             S01277
     C           @@VDT     ORLT @@PRDD                     *1             S01277
     C********** @@VDT *** ORLT XPPRDD ******************* *1 *********   S01277
     C                     Z-ADD0         @@FPT   72       *1             S01277
     C                     GOTO ZA0709                     *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  Prevent rereading of point record if Currency and Date same     S01277
     C           @@CCY     IFNE @@CCYL                     B1             S01277
     C           @@VDT     ORNE @@VDTL                     B1             S01277
     C                     MOVE @@CCY     @@CCYL           *1             S01277
     C                     MOVE @@VDT     @@VDTL           *1             S01277
     C                     MOVE *BLANK    @@CNFD  1        *1             S01277
     C*                                                                   S01277
     C**  Load key used to access LF/FXCCYPLL.             *1             S01277
     C           CCYVDT    KLIST                           *1             S01277
     C                     KFLD           @@CCY            *1             S01277
     C                     KFLD           @@VDT            *1             S01277
     C           CCYVDT    SETLLFXCCYPLL                   *1             S01277
     C                     READ FXCCYPLL                 81*1             S01277
     C*                                                                   S01277
     C** If currency has not been found check previous record.            S01277
     C           @@CCY     IFNE XPCCY                      B*2            S01277
     C           *IN81     OREQ '1'                        **2            S01277
     C                     MOVE 'Y'       @@CNFD           **2            S01277
     C**                                                                  S01277
     C** IF *IN81 IS ON, EOF IS ENCOUNTERED AND NEED REPOSITION FILE      S01277
     C** TO EOF MARK AND RESET THE EOF STATUS SAVE UP BY SYSTEM.          S01277
     C           *IN81     IFEQ '1'                         B**3          S01277
     C           CCYVDT    SETGTFXCCYPLL                    ***3          S01277
     C                     END                              E**3          S01277
     C                     END                              E*2           S01277
     C*  Store for possible use in next Exsr of ZA0700                    S01277
     C                     MOVE XPCCY     @@XCCY            *1            S01277
     C                     MOVE XPPRDD    @@XPRD            *1            S01277
     C                     MOVE XPTPRD    @@XTPR            *1            S01277
     C                     MOVE XPLOPT    @@XLOP            *1            S01277
     C                     MOVE XPHIPT    @@XHIP            *1            S01277
     C                     ELSE                             X1            S01277
     C*  If Ccy/Date same as last Exsr, restore essential values.         S01277
     C                     MOVE @@XCCY    XPCCY             *1            S01277
     C                     MOVE @@XPRD    XPPRDD            *1            S01277
     C                     MOVE @@XTPR    XPTPRD            *1            S01277
     C                     MOVE @@XLOP    XPLOPT            *1            S01277
     C                     MOVE @@XHIP    XPHIPT            *1            S01277
     C*                                                                   S01277
     C                     END                              E1            S01277
     C* No Currency with > date, take last for Ccy.                       S01277
     C           @@CNFD    IFEQ 'Y'                         B1            S01277
     C                     GOTO ZA0708                      *1            S01277
     C                     END                              E1            S01277
     C*                                                                   S01277
     C** Find midas day number of value date.                             S01277
     C                     Z-ADD@@VDT     @@DTIN                          S01277
     C                     EXSR ZA0680                                    S01277
     C                     Z-ADD@@MDNO    @@VDAT  50                      S01277
     C*                                                                   S01277
     C** IF    record with = date found                                   S01277
     C           @@VDT     IFEQ XPPRDD                     B1             S01277
     C*                                                                   S01277
     C** IF Type of period is not 'D'                                     S01277
     C           XPTPRD    IFNE 'D'                        B*2            S01277
     C*                                                                   S01277
     C** If the buy/sell rate indicator is 'B' & the currency multiply    S01277
     C** /divide exchange rate indicator is 'D' ,                         S01277
     C** or 'S' & 'M' respectively,use low points otherwise use high      S01277
     C** points.                                                          S01277
     C           @@BYSL    IFEQ 'B'                        B**3           S01277
     C           A6MDEX    ANDEQ'D'                        ***3           S01277
     C                     MOVE XPLOPT    @@FPT            ***3           S01277
     C                     GOTO ZA0709                     ***3           S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C           @@BYSL    IFEQ 'S'                        B**3           S01277
     C           A6MDEX    ANDEQ'M'                        ***3           S01277
     C                     MOVE XPLOPT    @@FPT            ***3           S01277
     C                     GOTO ZA0709                     ***3           S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C                     MOVE XPHIPT    @@FPT            **2            S01277
     C                     GOTO ZA0709                     **2            S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C** The type of period is 'D'.                                       S01277
     C** Date is spot + 1 , spot - 1 or spot - 2 days.                    S01277
     C** Linear interpolation or extrapolation used between one week      S01277
     C** rate & 0 on the spot date.                                       S01277
     C*                                                                   S01277
     C*   Only access 1W point once per currency.                         S01277
     C           @@CCY     IFEQ @@CCY1                     B*2            S01277
     C           @@CC1W    ANDNE'Y'                        A*2            S01277
     C           @@CCY     OREQ @@CCY2                     B*2            S01277
     C           @@CC2W    ANDNE'Y'                        A*2            S01277
     C*                                                                   S01277
     C** Find the one week rate.                                          S01277
     C** Define search argument for chain to LF/FDCCYPLL.                 S01277
     C                     MOVE 'W'       @@TPRD  1        **2            S01277
     C                     Z-ADD1         @@PRD   20       **2            S01277
     C           WEEKRT    KLIST                           **2            S01277
     C                     KFLD           @@CCY            **2            S01277
     C                     KFLD           @@TPRD           **2            S01277
     C                     KFLD           @@PRD            **2            S01277
     C*                                                                   S01277
     C** CHAIN TO FILE FDCCYPLL                                           S01277
     C           WEEKRT    CHAINFDCCYPLL             80    **2            S01277
     C           XPDLTF    IFEQ '*'                        B**3           S01277
     C                     MOVE '1'       *IN80            ***3           S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C** DEAL WITH DATA BASE ERROR                                        S01277
     C           *IN80     IFEQ '1'                        B**3           S01277
     C                     MOVEL'FDCCYPLL'DBFILE           ***3           S01277
     C                     MOVEL'923'     DBASE            ***************S01277
     C                     MOVEL@@CCY     DBKEY            *             *S01277
     C                     MOVE '1'       *INU7            * DBERROR 923 *S01277
     C                     MOVE '1'       *INU8            *             *S01277
     C                     GOTO ZA0709                     ***************S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C** Find 1 week date & spot date as a day number.                    S01277
     C                     Z-ADDXPPRDD    @@DTIN           **2            S01277
     C                     EXSR ZA0680                     **2            S01277
     C                     Z-ADD@@MDNO    @@D2    50       **2            S01277
     C*                                                                   S01277
     C                     Z-ADDA6FXSD    @@DTIN           **2            S01277
     C                     EXSR ZA0680                     **2            S01277
     C                     Z-ADD@@MDNO    @@SPDT  50       **2            S01277
     C*                                                                   S01277
     C           @@CCY     IFEQ @@CCY1                     B**3           S01277
     C                     MOVE 'Y'       @@CC1W           ***3           S01277
     C                     MOVE XPLOPT    @@C1LP  72       ***3           S01277
     C                     MOVE XPHIPT    @@C1HP  72       ***3           S01277
     C                     Z-ADD@@D2      @@D2C1  50       ***3           S01277
     C                     Z-ADD@@SPDT    @@SPC1  50       ***3           S01277
     C                     ELSE                            X**3           S01277
     C                     MOVE 'Y'       @@CC2W           ***3           S01277
     C                     MOVE XPLOPT    @@C2LP  72       ***3           S01277
     C                     MOVE XPHIPT    @@C2HP  72       ***3           S01277
     C                     Z-ADD@@D2      @@D2C2  50       ***3           S01277
     C                     Z-ADD@@SPDT    @@SPC2  50       ***3           S01277
     C                     END                             E**3           S01277
     C*                                                                   S01277
     C                     END                             E*2            S01277
     C*  Restore week 1 points etc. as previously stored.                 S01277
     C           @@CCY     IFEQ @@CCY1                     B*2            S01277
     C                     MOVE @@C1LP    XPLOPT           **2            S01277
     C                     MOVE @@C1HP    XPHIPT           **2            S01277
     C                     Z-ADD@@D2C1    @@D2             **2            S01277
     C                     Z-ADD@@SPC1    @@SPDT           **2            S01277
     C                     ELSE                            X*2            S01277
     C                     MOVE @@C2LP    XPLOPT           **2            S01277
     C                     MOVE @@C2HP    XPHIPT           **2            S01277
     C                     Z-ADD@@D2C2    @@D2             **2            S01277
     C                     Z-ADD@@SPC2    @@SPDT           **2            S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C** If the buy/sell rate indicator is 'B' & the currency multiply    S01277
     C** /divide exchange rate indicator is 'D' ,                         S01277
     C** or 'S' & 'M' respectively,use low points otherwise use high      S01277
     C** points.                                                          S01277
     C           @@BYSL    IFEQ 'B'                        B*2            S01277
     C           A6MDEX    ANDEQ'D'                        **2            S01277
     C                     MOVE XPLOPT    @@FP2   72       **2            S01277
     C*                                                                   S01277
     C                     ELSE                            X*2            S01277
     C           @@BYSL    IFEQ 'S'                        B**3           S01277
     C           A6MDEX    ANDEQ'M'                        ***3           S01277
     C                     MOVE XPLOPT    @@FP2            ***3           S01277
     C*                                                                   S01277
     C                     ELSE                            X**3           S01277
     C                     MOVE XPHIPT    @@FP2            ***3           S01277
     C                     END                             E**3           S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C** Forward points can now be calculated.                            S01277
     C           @@VDAT    SUB  @@SPDT    @@WF1  158       *1             S01277
     C           @@FP2     MULT @@WF1     @@WF1            *1             S01277
     C           @@D2      SUB  @@SPDT    @@WF2   80       *1             S01277
     C           @@WF1     DIV  @@WF2     @@FPT            *1             S01277
     C                     GOTO ZA0709                     *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C*                                                                   S01277
     C** IF    record with > date found                                   S01277
     C           XPPRDD    IFGT @@VDT                      B1             S01277
     C*                                                                   S01277
     C** If the buy/sell rate indicator is 'B' & the currency multiply    S01277
     C** /divide exchange rate indicator is 'D' ,                         S01277
     C** or 'S' & 'M' respectively,use low points otherwise use high      S01277
     C** points.                                                          S01277
     C           @@BYSL    IFEQ 'B'                        B*2            S01277
     C           A6MDEX    ANDEQ'D'                        **2            S01277
     C                     MOVE XPLOPT    @@FP2   72       **2            S01277
     C*                                                                   S01277
     C                     ELSE                            X*2            S01277
     C           @@BYSL    IFEQ 'S'                        B**3           S01277
     C           A6MDEX    ANDEQ'M'                        ***3           S01277
     C                     MOVE XPLOPT    @@FP2            ***3           S01277
     C*                                                                   S01277
     C                     ELSE                            X**3           S01277
     C                     MOVE XPHIPT    @@FP2            ***3           S01277
     C                     END                             E**3           S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C** Find day number of date.                                         S01277
     C                     Z-ADDXPPRDD    @@DTIN           *1             S01277
     C                     EXSR ZA0680                     *1             S01277
     C                     Z-ADD@@MDNO    @@D2    50       *1             S01277
     C*                                                                   S01277
     C** Prevent rereading of point record if Ccy/Date same               S01277
     C           @@CCY     IFNE @@CCYP                     B*2            S01277
     C           @@VDT     ORNE @@VDTP                     B*2            S01277
     C                     MOVE @@CCY     @@CCYP           **2            S01277
     C                     MOVE @@VDT     @@VDTP           **2            S01277
     C*                                                                   S01277
     C** READ PREVIOUS record on LF/FXCCYPLL                              S01277
     C                     READPFXCCYPLL               8180**2            S01277
     C*                                                                   S01277
     C** IF read prior was unsuccessful then there is a database error.   S01277
     C           *IN80     IFEQ '1'                        B**3           S01277
     C           *IN81     OREQ '1'                        ***3           S01277
     C                     MOVEL'FXCCYPLL'DBFILE           ***3           S01277
     C                     MOVEL'927'     DBASE            ***************S01277
     C                     MOVE '1'       *INU7            *             *S01277
     C                     MOVE '1'       *INU8            * DBERROR 927 *S01277
     C                     GOTO ZA0709                     *             *S01277
     C                     END                             E**3***********S01277
     C*                                                                   S01277
     C* Store point record detail for later Exsrs of ZA0700               S01277
     C                     MOVE XPPRDD    @@XPCC           **2            S01277
     C                     MOVE XPLOPT    @@XPLP           **2            S01277
     C                     MOVE XPHIPT    @@XPHP           **2            S01277
     C                     ELSE                            X*2            S01277
     C                     MOVE @@XPCC    XPPRDD           **2            S01277
     C                     MOVE @@XPLP    XPLOPT           **2            S01277
     C                     MOVE @@XPHP    XPHIPT           **2            S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C           @@BYSL    IFEQ 'B'                        B*2            S01277
     C           A6MDEX    ANDEQ'D'                        **2            S01277
     C                     MOVE XPLOPT    @@FP1   72       **2            S01277
     C*                                                                   S01277
     C                     ELSE                            X*2            S01277
     C           @@BYSL    IFEQ 'S'                        B**3           S01277
     C           A6MDEX    ANDEQ'M'                        ***3           S01277
     C                     MOVE XPLOPT    @@FP1            ***3           S01277
     C*                                                                   S01277
     C                     ELSE                            X**3           S01277
     C                     MOVE XPHIPT    @@FP1            ***3           S01277
     C                     END                             E**3           S01277
     C                     END                             E*2            S01277
     C*                                                                   S01277
     C** Find day number of date.                                         S01277
     C                     Z-ADDXPPRDD    @@DTIN           *1             S01277
     C                     EXSR ZA0680                     *1             S01277
     C                     Z-ADD@@MDNO    @@D1    50       *1             S01277
     C*                                                                   S01277
     C** Forward points can now be calculated.                            S01277
     C           @@FP2     SUB  @@FP1     @@WF1            *1             S01277
     C           @@VDAT    SUB  @@D1      @@WF2            *1             S01277
     C           @@WF1     MULT @@WF2     @@WF1            *1             S01277
     C           @@D2      SUB  @@D1      @@WF2            *1             S01277
     C           @@WF1     DIV  @@WF2     @@WF1            *1             S01277
     C********** @@WF1     ADD  @@FP1     @@FPT            *1             S01277
     C           @@WF1     ADD  @@FP1     @@FPT     H      *1             S01277
     C                     GOTO ZA0709                     *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** No record with > or = date has been found at this stage          S01277
     C** of processing so the points on the furthest forward              S01277
     C** record are used.                                                 S01277
     C** Find the furthest forward record                                 S01277
     C*                                                                   S01277
     C** READ PREVIOUS record on LF/FXCCYPLL                              S01277
     C           ZA0708    TAG                                            S01277
     C                     MOVE *HIVAL    @@VDT                           S01277
     C           CCYVDT    SETGTFXCCYPLL                                  S01277
     C                     READPFXCCYPLL               8081               S01277
     C           @@CCY     IFNE XPCCY                      B1             S01277
     C                     MOVE '1'       *IN80            *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** IF read prior was unsuccessful then there is a database error.   S01277
     C           *IN80     IFEQ '1'                        B1             S01277
     C           *IN81     OREQ '1'                        *1             S01277
     C                     MOVEL'FXCCYPLL'DBFILE           ***************S01277
     C                     MOVEL'928'     DBASE            *             *S01277
     C                     MOVE '1'       *INU7            * DBERROR 928 *S01277
     C                     MOVE '1'       *INU8            *             *S01277
     C                     GOTO ZA0709                     ***************S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C** If the buy/sell rate indicator is 'B' & the currency multiply    S01277
     C** /divide exchange rate indicator is 'D' ,                         S01277
     C** or 'S' & 'M' respectively,use low points otherwise use high      S01277
     C** points.                                                          S01277
     C           @@BYSL    IFEQ 'B'                        B1             S01277
     C           A6MDEX    ANDEQ'D'                        *1             S01277
     C                     MOVE XPLOPT    @@FPT            *1             S01277
     C                     GOTO ZA0709                     *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           @@BYSL    IFEQ 'S'                        B1             S01277
     C           A6MDEX    ANDEQ'M'                        *1             S01277
     C                     MOVE XPLOPT    @@FPT            *1             S01277
     C                     GOTO ZA0709                     *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C                     MOVE XPHIPT    @@FPT                           S01277
     C*                                                                   S01277
     C                     GOTO ZA0709                                    S01277
     C*                                                                   S01277
     C** Unexecuted processing to define fields used by this subroutine.  S01277
     C                     MOVE @@MDNO    @@MDNO  50                      S01277
     C*                                                                   S01277
     C           ZA0709    ENDSR                                          S01277
     C*****************************************************************   S01277
     C/EJECT                                                              S01277
     C****************************************************************    S01277
     C*                                                              *    S01277
     C*     ZA1150 -  Convert rate to scaled rate.                   *    S01277
     C*                                                              *    S01277
     C*     CALLS:                                                   *    S01277
     C*                                                              *    S01277
     C*     INPUT:   @@SXP1 - First currency scaling exponent.       *    S01277
     C*              @@SXP2 - Second currency scaling exponent.      *    S01277
     C*              @@INRT - Rate to be scaled.                     *    S01277
     C*              @@FCMD - First Currency Multiply/Divide Ind.    *    S01277
     C*                                                              *    S01277
     C*     OUTPUT:  @@SCRT - Scaled rate.                           *    S01277
     C*              @@ISRT - Inverse of scaled rate.                *    S01277
     C*              @@ERCD - Error code.                            *    S01277
     C*                                                              *    S01277
     C*     USES:    @SF    - Array of scaling factors.              *    S01277
     C*              @@C    - Index for array @SF.                   *    S01277
     C*              @@SCF1 - Scaling factor for currency 1.         *    S01277
     C*              @@SCF2 - Scaling factor for currency 2.         *    S01277
     C*              @@WKA  - Work field, 15,0N.                     *    S01277
     C*              @@WKB  - Work field, 15,0N.                     *    S01277
     C*                                                              *    S01277
     C*     LAST AMEND NO. 000000             DATE   XX/XX/XX        *    S01277
     C*                                                              *    S01277
     C****************************************************************    S01277
     C*                                                                   S01277
     C           ZA1150    BEGSR                                          S01277
     C*                                                                   S01277
     C**  Define and initialise fields used and output fields.            S01277
     C                     Z-ADD@@SXP1    @@SXP1  10                      S01277
     C                     Z-ADD@@SXP2    @@SXP2  10                      S01277
     C                     Z-ADD@@INRT    @@INRT 128                      S01277
     C                     MOVE @@FCMD    @@FCMD  1                       S01277
     C*                                                                   S01277
     C                     Z-ADD*ZEROS    @@SCRT 128                      S01277
     C                     Z-ADD*ZEROS    @@ISRT 128                      S01277
     C                     Z-ADD*ZEROS    @@ERCD  10                      S01277
     C*                                                                   S01277
     C                     Z-ADD*ZEROS    @@C     20                      S01277
     C                     Z-ADD*ZEROS    @@SCF1 100                      S01277
     C                     Z-ADD*ZEROS    @@SCF2 100                      S01277
     C                     Z-ADD*ZEROS    @@WKA  150                      S01277
     C                     Z-ADD*ZEROS    @@WKB  150                      S01277
     C*                                                                   S01277
     C**  If the input rate is zero, the two output rates are zero,       S01277
     C**  by-pass further processing.                                     S01277
     C           @@INRT    CABEQ0         ZA1159                          S01277
     C*                                                                   S01277
     C**  Determine the scaling factor from the scaling exponent for      S01277
     C**  the first currency.                                             S01277
     C                     Z-ADD@@SXP1    @@C                             S01277
     C                     ADD  1         @@C                             S01277
     C                     Z-ADD@SF,@@C   @@SCF1                          S01277
     C*                                                                   S01277
     C**  Determine the scaling factor from the scaling exponent for      S01277
     C**  the second currency.                                            S01277
     C                     Z-ADD@@SXP2    @@C                             S01277
     C                     ADD  1         @@C                             S01277
     C                     Z-ADD@SF,@@C   @@SCF2                          S01277
     C*                                                                   S01277
     C**  If the M/D indicator is M, then the scaled rate is calculated   S01277
     C**  as follows....                                                  S01277
     C           @@FCMD    IFEQ 'M'                        B1             S01277
     C*                                                                   S01277
     C**  Calculate the scaled rate and its inverse.                      S01277
     C           @@INRT    MULT @@SCF1    @@SCRT           *1             S01277
     C           @@SCF2    DIV  @@INRT    @@ISRT    H      *1             S01277
     C*                                                                   S01277
     C**  Calculate the scaled rate and its inverse, placing the result   S01277
     C**  into 15,0 fields to check for overflow.                         S01277
     C           @@INRT    MULT @@SCF1    @@WKA            *1             S01277
     C           @@SCF2    DIV  @@INRT    @@WKB     H      *1             S01277
     C*                                                                   S01277
     C**  Otherwise, calculate the rate as follows....                    S01277
     C                     ELSE                            X1             S01277
     C*                                                                   S01277
     C**  Calculate the scaled rate and its inverse.                      S01277
     C           @@INRT    MULT @@SCF2    @@SCRT           *1             S01277
     C           @@SCF1    DIV  @@INRT    @@ISRT    H      *1             S01277
     C*                                                                   S01277
     C**  Calculate the scaled rate and its inverse, placing the result   S01277
     C**  into 15,0 fields to check for overflow.                         S01277
     C           @@INRT    MULT @@SCF2    @@WKA            *1             S01277
     C           @@SCF1    DIV  @@INRT    @@WKB     H      *1             S01277
     C*                                                                   S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  If the work fields are greater than 9999.99999999, set up the   S01277
     C**  error codes.                                                    S01277
     C           @@WKA     IFGE 10000                      B1             S01277
     C                     Z-ADD1         @@ERCD           *1             S01277
     C                     END                             E1             S01277
     C           @@WKB     IFGE 10000                      B1             S01277
     C                     Z-ADD2         @@ERCD           *1             S01277
     C                     END                             E1             S01277
     C           @@WKA     IFGE 10000                      B1             S01277
     C           @@WKB     ANDGE10000                      B1             S01277
     C                     Z-ADD3         @@ERCD           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           ZA1159    ENDSR                           **ZA1159**     S01277
     C/EJECT                                                              S01277
     C****************************************************************    S01277
     C*                                                              *    S01277
     C*     ZA1160 -  Convert scaled rate to unscaled rate.          *    S01277
     C*                                                              *    S01277
     C*     CALLS:                                                   *    S01277
     C*                                                              *    S01277
     C*     INPUT:   @@SEXP - Scaling exponent.                      *    S01277
     C*              @@INRT - Rate to be unscaled.                   *    S01277
     C*                                                              *    S01277
     C*     OUTPUT:  @@USRT - Unscaled rate.                         *    S01277
     C*                                                              *    S01277
     C*     USES:    @SF    - Array of scaling factors.              *    S01277
     C*              @@C    - Index for array @SF.                   *    S01277
     C*              @@SCAF - Scaling factor.                        *    S01277
     C*                                                              *    S01277
     C*     LAST AMEND NO. 000000             DATE   XX/XX/XX        *    S01277
     C*                                                              *    S01277
     C****************************************************************    S01277
     C*                                                                   S01277
     C           ZA1160    BEGSR                                          S01277
     C*                                                                   S01277
     C**  Define and initialise fields used and output fields.            S01277
     C                     Z-ADD@@SEXP    @@SEXP  10                      S01277
     C                     Z-ADD@@INRT    @@INRT 128                      S01277
     C*                                                                   S01277
     C                     Z-ADD*ZEROS    @@USRT 128                      S01277
     C*                                                                   S01277
     C                     Z-ADD*ZEROS    @@C     20                      S01277
     C                     Z-ADD*ZEROS    @@SCAF 100                      S01277
     C*                                                                   S01277
     C**  If the input rate is zero, the output rate is zero, by-pass     S01277
     C**  further processing.                                             S01277
     C           @@INRT    CABEQ0         ZA1169                          S01277
     C*                                                                   S01277
     C**  Determine the scaling factor from the scaling exponent.         S01277
     C                     Z-ADD@@SEXP    @@C                             S01277
     C                     ADD  1         @@C                             S01277
     C                     Z-ADD@SF,@@C   @@SCAF                          S01277
     C*                                                                   S01277
     C**  Calculate the unscaled rate.                                    S01277
     C           @@INRT    DIV  @@SCAF    @@USRT    H                     S01277
     C*                                                                   S01277
     C           ZA1169    ENDSR                           **ZA1169**     S01277
     C/EJECT                                                              S01277
     C******************************************************************* S01277
     C*                                                              *    S01277
     C* ZA0680 - THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO    *    S01277
     C*          MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)    *    S01277
     C*                                                              *    S01277
     C*                                                              *    S01277
     C* CALLED BY :   ZA0700    (5 times)                            *    S01277
     C*               ZA0730                                         *    S01277
     C*                                                              *    S01277
     C* CALLS :                                                      *    S01277
     C*                                                              *    S01277
     C* INPUT  : @@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   S01277
     C*                                                              *    S01277
     C* OUTPUT : @@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                *    S01277
     C*                                                              *    S01277
     C* USES :   @@CC   NUMBER OF CENTURIES IN DATE                  *    S01277
     C*          @@DAY  DAY NUMBER                                   *    S01277
     C*          @@REM  REMAINDER FROM DIVIDE                        *    S01277
     C*          @@MTH  MONTH NUMBER                                 *    S01277
     C*          @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN*    S01277
     C*                 MONTH                                        *    S01277
     C*          @@WK2  WORK FIELD (2,0)                             *    S01277
     C*          @@WK5  WORK FIELD (5,0)                             *    S01277
     C*          @@YYYY YEAR (4 CHARACTER)                           *    S01277
     C*          @@YY   YEAR (2 CHARACTER)                           *    S01277
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN*    S01277
     C*                 A FOUR YEAR PERIOD                           *    S01277
     C*                                                              *    S01277
     C****************************************************************    S01277
     C*                                                                   S01277
     C           ZA0680    BEGSR                                          S01277
     C*                                                                   S01277
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD                               S01277
     C                     Z-ADD0         @@MDNO  50                      S01277
     C*                                                                   S01277
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          S01277
     C           @@YYYY    IFGE 2072                       B1             S01277
     C*                                                                   S01277
     C**    MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)            S01277
     C           @@CC      SUB  19        @@WK2   20       *1             S01277
     C           @@WK2     MULT 36524     @@MDNO           *1             S01277
     C*                                                                   S01277
     C**  YEAR 2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY                   S01277
     C                     ADD  1         @@MDNO           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C           @@YYYY    ADD  28        @@WK2                           S01277
     C*                                                                   S01277
     C           @@WK2     DIV  4         @@WK2                           S01277
     C                     MVR            @@REM   10                      S01277
     C*                                                                   S01277
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                S01277
     C           @@WK2     MULT 1461      @@WK5   50                      S01277
     C                     ADD  @@WK5     @@MDNO                          S01277
     C*                                                                   S01277
     C**  CHECK REMAINDER AND MONTH NUMBER                                S01277
     C           @@REM     IFEQ 0                          B1             S01277
     C           @@MTH     ANDGT2                          B1             S01277
     C                     ADD  1         @@MDNO           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               S01277
     C           @@REM     IFNE 0                          B1             S01277
     C                     ADD  @YD,@@REM @@MDNO           *1             S01277
     C                     END                             E1             S01277
     C*                                                                   S01277
     C**  ADD MONTHS THIS YEAR                                            S01277
     C                     ADD  @MD,@@MTH @@MDNO                          S01277
     C*                                                                   S01277
     C**  ADD DAYS THIS MONTH                                             S01277
     C                     ADD  @@DAY     @@MDNO                          S01277
     C*                                                                   S01277
     C           ZA0689    ENDSR                           **ZA0689 TAG** S01277
     C*****************************************************************   S01277
      * Copy standard holiday subroutines                                 S01277
     C/COPY ZSRSRC,ZCHKH                                                  S01277
     C/COPY ZSRSRC,ZACCH                                                  S01277
     C*****************************************************************   S01277
     C*                                                               *   S01277
     C*       TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   S01277
     C*                                                               *   S01277
     C*       SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   S01277
     C*       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   S01277
     C*       THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   S01277
     C*       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   S01277
     C*       IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   S01277
     C*       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   S01277
     C*                                                               *   S01277
     C* NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  S01277
     C*                                                               *   S01277
     C*       1) @@DAYN   LENGTH 5,0.                                 *   S01277
     C*                                                               *   S01277
     C*       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   S01277
     C*                                                               *   S01277
     C*       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   S01277
     C*       2) @@RTN    LENGTH 1,0.                                 *   S01277
     C*       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   S01277
     C*       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   S01277
     C*       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   S01277
     C*       6) @@RDAY   LENGTH 5,0.                                 *   S01277
     C*       7) @@LEAP   LENGTH 1,0.                                     S01277
     C*                                                               *   S01277
     C*       INDICATORS USED ARE:                                    *   S01277
     C*                                                               *   S01277
     C*       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   S01277
     C*       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *   S01277
     C*                                                               *   S01277
     C* INPUT FIELD:       @@DAYN                                     *   S01277
     C*                                                               *   S01277
     C* OUTPUT FIELD:      @@VDT                                      *   S01277
     C*                                                               *   S01277
     C* WORK FIELDS:       @@RTN                                      *   S01277
     C*                    @@Z71Y                                     *   S01277
     C*                    @@RDAY                                     *   S01277
     C*                    @@LEAP                                     *   S01277
     C*                    @@I                                        *   S01277
     C*                    @@J                                        *   S01277
     C*                                                               *   S01277
     C* ARRAYS USED:       @YD COMPILE TIME ARRAY.                        S01277
     C*                    @MD COMPILE TIME ARRAY.                        S01277
     C*                                                                   S01277
     C*     CALLED BY:   ZA0730                                           S01277
     C*                  ZA0820                                           S01277
     C*                                                                   S01277
     C*****************************************************************   S01277
     C*                                                                   S01277
     C           ZA0710    BEGSR                                          S01277
     C*                                                                   S01277
     C                     SETOF                     8081                 S01277
     C                     Z-ADD0         @@RTN   10                      S01277
     C                     Z-ADD0         @@VDT                           S01277
     C                     Z-ADD1         @@I     20                      S01277
     C                     Z-ADD1         @@J     20                      S01277
     C                     Z-ADD1         @@LEAP  10                      S01277
     C*                                                                   S01277
     C           @@DAYN    IFLT 1                                         S01277
     C                     Z-ADD1         @@RTN                           S01277
     C                     GOTO ZA0719                                    S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.                           S01277
     C*                                                                   S01277
     C           @@DAYN    DIV  1461      @@Z71Y                          S01277
     C                     MVR            @@RDAY  50                      S01277
     C*                                                                   S01277
     C* CALCULATING YEAR.                                                 S01277
     C*                                                                   S01277
     C           @@Z71Y    MULT 4         @@Z71Y                          S01277
     C                     ADD  1972      @@Z71Y                          S01277
     C*                                                                   S01277
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100                 S01277
     C*                                                                   S01277
     C           @@Z71Y    IFGE 2100                                      S01277
     C                     ADD  @@SSY2    @@RDAY                          S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        S01277
     C* HAVE PASSED.                                                      S01277
     C*                                                                   S01277
     C           @@RDAY    LOKUP@YD,@@I                8080               S01277
     C*                                                                   S01277
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     S01277
     C*                                                                   S01277
     C           *IN80     IFEQ '0'                                       S01277
     C                     Z-ADD0         @@LEAP                          S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       S01277
     C*                                                                   S01277
     C           @@LEAP    IFEQ 1                                         S01277
     C           @@RDAY    SUB  @YD,@@I   @@RDAY                          S01277
     C                     ADD  @@I       @@Z71Y                          S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* PROCESSING FOR A LEAP YEAR.                                       S01277
     C*                                                                   S01277
     C           @@LEAP    IFEQ 0                                         S01277
     C*                                                                   S01277
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   S01277
     C*                                                                   S01277
     C           @@RDAY    IFEQ 60                                        S01277
     C                     Z-ADD29        @@Z71D                          S01277
     C                     Z-ADD2         @@Z71M                          S01277
     C                     GOTO ZA0711                                    S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    S01277
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     S01277
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          S01277
     C*                                                                   S01277
     C           @@RDAY    IFGT 60                                        S01277
     C           @@RDAY    SUB  1         @@RDAY                          S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      S01277
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      S01277
     C* GROUP.                                                            S01277
     C*                                                                   S01277
     C           @@RDAY    IFEQ 0                                         S01277
     C                     Z-ADD31        @@Z71D                          S01277
     C                     Z-ADD12        @@Z71M                          S01277
     C                     SUB  1         @@Z71Y                          S01277
     C                     GOTO ZA0711                                    S01277
     C                     END                                            S01277
     C*                                                                   S01277
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         S01277
     C* OCCURS IN                                                         S01277
     C*                                                                   S01277
     C           @@RDAY    LOKUP@MD,@@J                81                 S01277
     C                     Z-ADD@@J       @@Z71M                          S01277
     C           @@RDAY    SUB  @MD,@@J   @@Z71D                          S01277
     C*                                                                   S01277
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT                          S01277
     C*                                                                   S01277
     C           ZA0711    TAG                                            S01277
     C*                                                                   S01277
     C                     MOVE @@Z71Y    @@YR                            S01277
     C*                                                                   S01277
     C           ZA0719    ENDSR                                          S01277
     C*****************************************************************   S01277
     C/EJECT
     C*****************************************************************
     C* #C                                                            *
     C* --                                                            *
     C* THIS ROUTINE DOES TERMINATION                                 *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C           *INU7     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C* CLOSING FILES
     C*****                CLOSEFDCCYTLL                                  S01194
     C                     CLOSEOLPOS
     C                     CLOSEACCNT
     C                     CLOSEFXFWMHLL
     C*****                CLOSEFDBRNCLL                                  S01194
     C                     CLOSEFXEPOSLL
     C*********************CLOSEFDINSTLL**********************************S01319
     C*****                CLOSEFDICDRLL                                  S01194
     C*****                CLOSEFDTG10LL                                  S01194
     C*
     C                     ENDSR
      /EJECT
     C*****************************************************************
     C           INFSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      *                                                               *   S01194
      *  This is the exception error subroutine, all file and program *   S01194
      *  errors return through here.                                  *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
      *                                                                   S01194
     C           @DUMP     IFEQ *BLANKS                                   S01194
     C                     MOVE 'Y'       @DUMP   1                       S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
      *                                                                   S01194
     C           PSSR9     ENDSR'*CANCL'                                  S01194
      *                                                                   S01194
      *****************************************************************   S01194
      /EJECT                                                              S01194
**
(c) Misys International Banking Systems Ltd. 2001
** @DP USED BY SR. ZA0680 - DECIMAL PLACES CORRECTION ARRAY
1000000010000000100000001000000010000000100000001
** Scaling factors array - @SF
0000000001
0000000010
0000000100
0000001000
0000010000
0000100000
0001000000
0010000000
0100000000
1000000000
** @YD  USED BY SR. ZA0710 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0710 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @@AY   - Array of powers of 10.
0000000001
0000000010
0000000100
0000001000
0000010000
0000100000
0001000000
0010000000
0100000000
1000000000
** @IN   USED TO INITIALISE SCALE RATE TO 99999.99999999
9999999999999
** ERROR DESCRIPTION  - @TXT
HIGH/LOW RATE UNABLE TO SCALE
