     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FX Net display and confirmation')                *
      *****************************************************************
      *                                                               *
      *  Midas - Dealing Module - Foreign Exchange.                   *
      *                                                               *
      *  FX0920 - Confirmed Net Display.                              *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD045437           Date 10May17               *
      *  Prev Amend No. MD044408           Date 30Mar17               *
      *                 MD044592           Date 28Mar17               *
      *                 MD036826           Date 18Jan16               *
      *                 MD041420A          Date 04Jan17               *
      *                 MD041420           Date 07Oct16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 AR646775           Date 19Aug14               *
      *                 MD023887A          Date 27Feb14               *
      *                 MD023887           Date 29Nov13               *
      *                 MD025805           Date 25Mar14               *
      *                 MD025229           Date 28Feb14               *
      *                 MD024497           Date 04Feb14               *
      *                 MD024498           Date 04Feb14               *
      *                 245692             Date 09Dec13               *
      *                 MD021333           Date 02Aug13               *
      *                 CSW212             Date 05May12               *
      *                 CRE073             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG25189           Date 27Jul09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG11679           Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 237421             Date 02May05               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 06May06               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6252            Date 08Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CDL025             Date 20Nov04               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CDL010             Date 02Aug02               *
      *                 CAS004             Date 26Jun02               *
      *                 CDE003             Date 17Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 200138             Date 07Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 127051             Date 04Dec97               *
      *                 127084             Date 02Dec97               *
      *                 126785             Date 02Dec97               *
      *                 126100             Date 24Nov97               *
      *                 CDL002             Date 06Mar97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD045437 - When transaction is amended, no new projections   *
      *             were created by the system.  During amend,        *
      *             reverse old projections and create new ones.      *
      *  MD044408 - DLC0350 report on MSGW due to file locking        *
      *             Ensure files are released after program exit      *
      *  MD044592 - FX netting is absent in Unconfirmed currency nets *
      *             after BF Midas session has been expired.          *
      *  MD036826 - Error in project account movements for deals      *
      *             involved in Nets.                                 *
      *  MD041420A - initial fix incomplete. The three files should   *
      *              also be udpated for 'NT' transaction types.      *
      *  MD041420 - Todays Projected Closing balance incorrect        *
      *             Ensure MEMOS, PRONO and OLPOS are updated         *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR646775 - Do not clear Settlement details if they were      *
      *           inputted correctly for input from FX0910.           *
      *           Applied fix 244792.                                 *
      *  MD023887A - FX Netting - No Projected Movements created      *
      *  (Reopen)  - Different error.  Create Net Settlement posting  *
      *              in addition to the normal settlement account     *
      *              which is the branch and currency of the transac- *
      *              tion, branch internal customer and FX netting    *
      *              account code from dealing ICD.                   *
      *  MD023887 - FX Netting - No Projected Movements created       *
      *  MD025805 - Net Number is not shown in the FX Netting Detail. *
      *           - Display the Net Number.                           *
      *  MD025229 - No Pay/Rec message generated after Net Confirma-  *
      *             tion and Netting Pay/Rec Generation.              *
      *           - Our Settlement Branch is blank that causes the    *
      *             program to dump due to database error in branch.  *
      *  MD024497 - SSI for FX Netting Settlement (type NT) not       *
      *             defaulted during FX Net confirmation              *
      *  MD024498 - Amended settlement details lost. Also, when F17   *
      *             is selected in enquiry mode, screen shows extended*
      *             settlement details instead of split settlements.  *
      *           - Also applied MD023887.                            *
      *  245692 - Incorrect validation of rates when the decimal se-  *
      *           parator in the Dealing ICD was defined as "," ins-  *
      *           tead of ".".                                        *
      *         - Applied for MD23981.                                *
      *  MD021333 - FX Netting - No Projected Movements.              *
      *           - Amend program to create projected movements on    *
      *             confirmed nets.                                   *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG25189 - MARG field on DLCHISPD contains invalid data after*
      *             the close of business (Recompile)                 *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha.*
      *  237421 - FX Netting function - zero net ccy not allowed.     *
      *           Amended program to allow zero ccy net.              *
      *         - Applied 205330                                      *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6252 - Transaction status is not shown (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CDL025 - FX Netting Payment Generation
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CDE003 - Data Export - MCR Limits Phase II                   *
      *  200138 - Invalid Settlement instruction are reflected by the *
      *           FX netting details maintenance. In consequence, Net *
      *           Settlement postings will not be generated by system *
      *           and causing imbalance in COB component GLC30.       *
      *  127051 - Enable F12 to return to calling program             *
      *  127084 - Process F15's                                       *
      *  126785 - Need to Process E's when press F12                  *
      *  126100 - Display Settlements Screen Message(Recompiled Only) *
      *  CDL002 - PROVIDE NET TOTALS CALCULATION                      *
      *                                                               *
      *****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                       *
     F*****************************************************************
      *       27         Display pair currency details                *
      *       28         Display different net calculated             *
      *       30         PROTECT SUBFILE SELECT FIELD                 *
      *                    AND NON-DISPLAY SUBFILE FIELDS
      *       31         DISPLAY SUBFILE CONTROL RECORD               *
      *       32         DISPLAY SUBFILE                              *
      *       33         INITIALIZE SUBFILE                           *
      *       34         SFLEND INDICATOR                             *
      *       35         CLEAR SUBFILE                                *
      *       36         SFLNXTCHG INDICATOR                          *
      *       38         ERROR ON SUBFILE SELECT FIELD                *
      *       68         Display F15 to view deals                    *   127084
      *       69         If off non display status in subfile.        *
      *       70         EOF ON READ  FXNETML0                        *
      *       71         ERROR ON ACCESS TO CUSTOMER FILES            *
      *       74         LOKUP of Month Code for date format          *
      *       75         Position cursor on Customer number           *
      *       77         If ON = Confirm mode else Display mode       *
      *       78         Protect Pay settlement instructions          *
      *       79         Protect Receive settlement instructions      *
      *       80         Failed access on group code for cust ref     *
      *       81         ON Group being processed for subfile         *
      *       82         Lokup indicator                              *
      *       83         GENERAL ERROR INDICATOR                      *
      *       84         DATABASE ERROR INDICATOR                     *
      *
      *  KC            F3 pressed ==> Exit
      *  KE            F5         ==> Refresh
      *  KF            F6         ==> Confirm Net
      *  KJ            F10        ==> Confirm delete of net
      *  KL            F12        ==> Cancel
      *  KP            F15        ==> Display deals
      *
      *
      *****************************************************************
     FCAMIDNLLUF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     F            FXDEALP0                          KIGNORE
     F            MMDELDP0                          KIGNORE
     F            DCDEALP0                          KIGNORE
     F            MMDENBP0                          KIGNORE
     F            DDDEALP0                          KIGNORE
     F            MMDENSP0                          KIGNORE
     F            DEDEALP0                          KIGNORE
     F            ABDEALP1                          KIGNORE
     F            ABDEALP2                          KIGNORE
     FFXNETMPDUF  E           K        DISK                      A
     FFXNETML0IF  E           K        DISK
     F            FXNETMD0                          KRENAMEFXNETMV0
     FFXNTIPL0UF  E           K        DISK
     F            FXNTIPD0                          KRENAMEFXNTIPV0
      *                                                                                       CDL025
     FFXNETSPDUF  E           K        DISK         KCOMIT                                    CDL025
     F                                              KINFSR *PSSR                              CDL025
      ** FX Confirmed split nets master file                                                  CDL025
      *                                                                                       CDL025
     FSDCGRPL2IF  E           K        DISK
     FFXDEALLLUF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     F            FXDEALP0                          KRENAMEFXDEALL0
     FDLDEALL1UF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     F            DEALSDBF                          KRENAMEDLBUYNRF
     F            DLBHISD0                          KIGNORE
     FDLDEALL2UF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     F            DEALSDBF                          KRENAMEDLSELNRF
     F            DLBHISD0                          KIGNORE
     FSDFNMSL0IF  E           K        DISK                                                 MD021333
     FRSACMTLFUF  E           K        DISK         KCOMIT       A                          MD021333
     F            RSACMTPO                          KRENAMEQACMTLF                          MD021333
     FRSACMTLGUF  E           K        DISK         KCOMIT       A                          MD021333
     F            RSACMTPO                          KRENAMEQACMTLG                          MD021333
     FFX0920DFCF  E                    WORKSTN
     F                                        S1RRN KSFILE FX0920S1
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
     FMEMOSL1 UF  E           K        DISK         KINFSR *PSSR                            MD041420
     F                                              KCOMIT                                 MD041420A
     FSDNOSTL4IF  E           K        DISK         KINFSR *PSSR                            MD041420
      *
     F/COPY WNCPYSRC,FXH00156
     E                    CPY@    1   1 80
      ** Array containing Copyright statement
      *
      *  Arrays and Tables
     E                    UER        50  3               Sett. Insts Err codes
     E                    CY        200  3
     E                    CDP       200  1 0
     E                    CYNM      200 14
      *
      /COPY ZSRSRC,ZFRPEDZ1
      *  /Copy is for ARRAYS/TABLES for amount formatting
      *
     E                    TABMTH  1  12  3   TABCOD  2
      *  Months/Month Numbers
      *
     E                    XOT     1   9 25                                                    CSD015
      ** XML Opening Tags for the Compliance Engine                                           CSD015
      *                                                                                       CSD015
     E                    XCT     1   9 25                                                    CSD015
      ** XML Closing Tags for the Compliance Engine                                           CSD015
      *                                                                                       CSD015
     E                    WLF         9 35                                                    CSD015
      ** Watch List Fields Array                                                              CSD015
      *                                                                                       CSD015
     E                    WSD        13 35                                                    CSD015
      ** Watch List Fields Standing Data Array.                                               CSD015
      *                                                                                       CSD015
     ILDA       E DSLDA                         256
      ** Data Area for Database Error handling
      *
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Installation Control Details
      *
     ISDNOST    E DSSDNOSTPD                                                                MD021333
     I              QQACCD                          QQACD2                                  MD021333
     I** Nostro details                                                                     MD021333
     ISDACNT    E DSACCNTAB                                                                 MD021333
      *                                                                                     MD021333
      ** External DS for account details                                                    MD021333
      *                                                                                     MD021333
     I              RECI                            NRECI                                   MD021333
     I              CNUM                            NCNUM                                   MD021333
     I              CCY                             NCCY                                    MD021333
     I              BRCA                            NBRCA                                   MD021333
     I              PRFC                            NPRFC                                   MD021333
     I              ORED                            NORED                                   MD021333
     I              FACT                            NFACT                                   MD021333
     I              FCNO                            NFCNO                                   MD021333
     I              CHTP                            NCHTP                                   MD021333
     I              TNLU                            NTNLU                                   MD021333
     I              NACSG                           NNACSG                                  MD021333
     I              LCD                             NLCD                                    MD021333
     I*                                                                                     MD021333
     ICYDDS     E DSSDCURRPD
      **   Currency details from SDCURRPD
      *
      /COPY ZSRSRC,ZFRPEDZ2
      *  /Copy is for DS statements for amount formatting
      *  Data structure to define Paired ccys
     IDCCYS       DS
     I                                        4   6 DCCYS1
     I                                        7   9 DCCYS2
      **  Data Structure:  layout of net reference field
     INETFMT      DS
     I                                        1  19 DDNETR
     I                                        1   3 WFBRCA
     I                                        4   70WFDLVD
     I                                        8  10 WFCCY
     I                                       11  16 WFCUSN
     I                                       11  14 WFGRP#
     I                                       15  16 GRPREF
     I                                       17  190WFSEQN
     I*
     I** Data area ZMUSER
     IZMUSER      DS                             17
     I                                       11  13 USRBCH
     I*
      **  Data Structure:  Date in YYMMDD format
     I            DS
     I                                        1   60WFDLDC
     I                                        3   40WFDLMC
      **  Data Structure:  Date in DDMMYY format
     I            DS
     I                                        1   60DDMMYY
     I                                        1   20DDMM#1
     I                                        3   40DDMM#2
     I                                        5   60DDMM#3
      **  Data Structure:  Date in MMDDYY format
     I            DS
     I                                        1   60MMDDYY
     I                                        1   20MMDD#1
     I                                        3   40MMDD#2
     I                                        5   60MMDD#3
      *  Data Structure to determine Customer or Group.
     I            DS
     I                                        1  10 CUSGRP
     I                                        1   6 CUSTOM
     I                                        7  10 GRPCDE
      *  Data Structure to redefine Customer Shortname.
     I            DS
     I                                        1  10 DDCSSN
     I                                        1   4 GRPKEY
     I                                        5  10 CHKGRP
      **  Data Structure:  6 to 8 digit year/mont day field
     I            DS
     I                                        1   80WFVAL8
     I                                        3   40WFVALY
     I                                        3   80WFVALD
      *  Data Structure to redefine Customer no. parm
     I            DS
     I**********                              1   60WFCUST                                  BUG11679
     I                                        1   6 WFCUST                                  BUG11679
     I                                        1   6 WACUST
     I                                        7  120PDVALD
     I                                        7  12 WAVALD
      *
      ** Date DS - DDMMMYY.
     ID#DATE      DS
     I                                        1   20D#DAY
     I                                        3   5 D#MON
     I                                        6   70D#YRS
      *
      ** Date DS - MMMDDYY.
     IM#DATE      DS
     I                                        1   3 M#MON
     I                                        4   50M#DAY
     I                                        6   70M#YRS
      *
      *  DataStructure containing Text for COMIT entry in JOURNAL
     ICMTTXT      DS
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  25 CMTWS
     I                                       26  310CMTTIM
     I                                       32  32 CMTACT
     I                                       33  42 CMTUSR
     I                                       43  480CMTDNO
     I                                       51 300 CMTDT1
     I                                      301 550 CMTDT2
      *
      *   Retrieve UsrId From Programme Status Data Structure
     IPSDS       SDS
     I                                        1  10 ##PGM
     I                                     *PARMS   NOPARM
     I                                      244 253 SWSID
     I                                      254 263 SUSER
     I                                      264 269 JOBNBR
      *
     ISPOOL       DS
     I** SPOOL INFORMATION DATA STRUCTURE
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      *
      **  Data Structure to redefine Report Parameter.
     I            DS
     I                                        1 100 REPTDS
     I                                        1  19 PPNETR
     I                                       20  29 PPCSSN
     I                                       30  59 PPDETS
     I                                       60  65 PPVALD
     I                                       66  67 PPSETM
     I**********                             68  82 PPSEAC                                    CGL029
     I                                       83  90 PPSEAC                                    CGL029
      *                                                                                       CSD015
      **  Watch List Fields in Data Structure Format.                                         CSD015
     IWLFDS       DS                                                                          CSD015
     I**********                              1  12 AMOURN                             CSD015 CGL029
     I                                        1  12 QQOURN                             CSD015 CGL029
     I                                       13  20 AMIBNK                                    CSD015
     I**********                             21  260AMOBNK                             CSD015 CSD027
     I**********                             27  320AMORDC                             CSD015 CSD027
     I                                       21  26 AMOBNK                                    CSD027
     I                                       27  32 AMORDC                                    CSD027
     I                                       33  40 AMRCRN                                    CSD015
     I                                       41  48 AMRVNO                                    CSD015
     I                                       49  56 AMAWBN                                    CSD015
     I                                       57  64 AMBENN                                    CSD015
     I                                       65  99 AMDTP1                                    CSD015
     I                                      100 134 AMDTP2                                    CSD015
     I                                      135 169 AMDTP3                                    CSD015
     I                                      170 204 AMDTP4                                    CSD015
     I                                      205 222 AMOURN                                    CGL029
      *                                                                                       CSD015
      **  Watch List Fields Storage Data Structure.                                           CSD015
     IWBC         DS                                                                          CSD015
     I                                        1  12 BCOURN                                    CSD015
     I                                       13  20 BCIBNK                                    CSD015
     I**********                             21  260BCOBNK                             CSD015 CSD027
     I**********                             27  320BCORDC                             CSD015 CSD027
     I                                       21  26 BCOBNK                                    CSD027
     I                                       27  32 BCORDC                                    CSD027
     I                                       33  40 BCRCRN                                    CSD015
     I                                       41  48 BCRVNO                                    CSD015
     I                                       49  56 BCAWBN                                    CSD015
     I                                       57  64 BCBENN                                    CSD015
     I                                       65  99 BCDTP1                                    CSD015
     I                                      100 134 BCDTP2                                    CSD015
     I                                      135 169 BCDTP3                                    CSD015
     I                                      170 204 BCDTP4                                    CSD015
      *
      **  Subfile options - Enquire, Delete, View, Print or Amend.
     I              'E, D, V, P or A.'    C         SFOPT
      *                                                                                       CDE003
     I            DS                                                                          CDE003
     I              'DEWRTTRIG'           C         DEWRT                                     CDE003
      *
     I@PARM2    E DSSETLIAB
      ** DS for call to SD2400.
      *
     I@PARM3    E DSSETLIAZ
      ** DS for call to SD2400.
      *
     I@PARM4    E DSSDSETLPD                                              200138
      *                                                                   200138
      ** DS for call tp SD2400.                                           200138
      *                                                                   200138
     I@PARM5      DS                                                      CDL025
     I                                        1   1 PACTN                 CDL025
     I                                        2   7 P5VDAT                CDL025
     I                                        8  11 DDGPCD                CDL025
     I                                       12  31 DDCRNM                CDL025
     I                                       32  41 DDC3SN                CDL025
     I                                       42  51 DDCRTN                CDL025
     I                                       52  70 PNETR                 CDL025
     I                                       71  71 DDPIND                CDL025
     I                                       72  74 DDNCCY                CDL025
     I                                       75  88 DDNCCN                CDL025
     I                                       89  91 DDPCY1                CDL025
     I                                       92 105 DDPC1N                CDL025
     I                                      106 108 DDPCY2                CDL025
     I                                      109 122 DDPC2N                CDL025
     I                                      123 142 DDNAMT                CDL025
      **                                                                  CDL025
     I                                      143 148 P5CUST                CDL025
     I                                      149 149 PRTBN                 CDL025
     I                                      150 150 PCHIP                 CDL025
     I                                      151 151 PRANR                 CDL025
     I                                      152 155 PACCD                 CDL025
     I                                      156 165 PCSSN                 CDL025
     I                                      166 166 PMBIN                 CDL025
     I                                      167 1670PNBDP                 CDL025
     I                                      168 1820PDBUY                 CDL025
      ** DS for call tp FX0925.                                           CDL025
     ICONV        DS                                                                        MD021333
     I                                        1   2 D#ACSQ                                  MD021333
      * Data structyre that converts numeric ACSQ to character                              MD021333
      *                                                                                     MD021333
     I##PAYD      DS                                                                        MD021333
     I                                        1   1 ##PAY                                   MD021333
     I                                        2   3 ##PAYM                                  MD021333
     I                                        4  21 ##PAYA                                  MD021333
     I                                       22  24 ##PAYB                                  MD021333
     I##RECD      DS                                                                        MD021333
     I                                        1   1 ##REC                                   MD021333
     I                                        2   3 ##RECM                                  MD021333
     I                                        4  21 ##RECA                                  MD021333
     I                                       22  24 ##RECB                                  MD021333
     I##SETD      DS                                                                        MD021333
      * Pay/Receive (P/R)                                                                   MD021333
     I                                        1   1 ##PYRC                                  MD021333
      * Settlement Method                                                                   MD021333
     I                                        2   3 ##SETM                                  MD021333
      * Settlement Account                                                                  MD021333
     I                                        4  21 ##SETA                                  MD021333
     I                                        4   5 ##NOSN                                  MD021333
     I                                        4  13 ##ACNO                                  MD021333
     I                                        4   9 ##CNUM                                  MD021333
     I                                       10  19 ##ACOD                                  MD021333
     I                                       20  21 ##ACSQ                                  MD021333
      * Settlement Branch                                                                   MD021333
     I                                       22  24 ##BRCA                                  MD021333
     IC#DTA       DS                            256                                         MD021333
      *  Account type N=nostro nbr F=Full nostro G=General Ledger                           MD021333
      *               P=Partial Ledger R= Retail Number  X= no settlement                   MD021333
     I                                        1   1 C#ATYP                                  MD021333
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ                              MD021333
     I                                        2  19 C#ACCT                                  MD021333
     I                                        2   7 C#CNU1                                  MD021333
     I                                        8  10 C#CCY1                                  MD021333
     I                                       15  160C#ACS1                                  MD021333
     I                                       17  19 C#BRC1                                  MD021333
      *               Nostro number                                                         MD021333
     I                                        2   30C#NOSN                                  MD021333
      *               Full Nostro - CCY/NOSN                                                MD021333
     I                                        2   6 C#NOS                                   MD021333
      *               Retail Number                                                         MD021333
     I                                        2  110C#ACNO                                  MD021333
      *               Partial Account - CNUM/ACOD/ACSQ                                      MD021333
     I                                        2   7 C#CNUM                                  MD021333
     I                                       12  130C#ACSQ                                  MD021333
      *               Branch of account if Partial                                          MD021333
     I                                       14  16 C#BRCA                                  MD021333
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or                       MD021333
      *                     ' ' no OLPOS update                                             MD021333
     I                                       24  24 C#IO                                    MD021333
      *               Currency of transaction                                               MD021333
     I                                       25  27 C#CCY                                   MD021333
      *               Transaction Type                                                      MD021333
     I                                       28  29 C#TRYP                                  MD021333
      *               Transaction Narrative                                                 MD021333
     I                                       30  59 C#NARR                                  MD021333
      *               Cheque Number                                                         MD021333
     I                                       60  670C#CHQN                                  MD021333
      *               FT transaction reference                                              MD021333
     I                                       68  82 C#PREF                                  MD021333
      *               DL/LE/GL/RE transaction reference                                     MD021333
     I                                       83  88 C#TRN                                   MD021333
      *               Movement amount                                                       MD021333
     I                                    P  89  960C#AMT                                   MD021333
      *               Processing indicators Not blank = no update                           MD021333
      *                                     ' ' = Update                                    MD021333
      *               Prono update indicator                                                MD021333
     I                                       97  97 C#PRON                                  MD021333
      *               Olpos update indicator                                                MD021333
     I                                       98  98 C#OLPS                                  MD021333
      *               Memos update indicator                                                MD021333
     I                                       99  99 C#MEMS                                  MD021333
      *               Rsacmtpd write indicator                                              MD021333
     I                                      100 100 C#RSAC                                  MD021333
      *               Module                                                                MD021333
     I                                      101 102 C#MODM                                  MD021333
     I                                      103 104 C#OLRC                                  MD021333
     I                                      105 105 C#FTOV                                  MD021333
      *               Value date and posting date                                           MD021333
     I                                    P 106 1080C#VDAT                                  MD021333
     I                                    P 109 1110C#PSTD                                  MD021333
     I                                      112 112 C#PSTO                                  MD021333
     I                                      113 113 C#RPST                                  MD021333
     I                                      114 1160C#RPNB                                  MD021333
     I                                      117 117 C#RTYP                                  MD021333
     I                                      118 120 C#BBRN                                  MD021333
     I                                      121 1300C#ACO1                                  MD021333
      ** Account code for partial account                                                   MD021333
     I                                      131 1400C#ACOD                                  MD021333
      ** Other Transaction Reference                                                        MD021333
     I                                      141 160 C#OTR1                                  MD021333
      ** Movement Type                                                                      MD021333
     I                                      161 161 C#MTYP                                  MD021333
      *
     ISDSSDY    E DSDSSDY
      ** Dummy Data Structure for Access Objects.
      *
     ISDBANK    E DSSDBANKPD
      ** Bank ICD Details accessed via Access Object.
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas Module(s) Details accessed via Access Object.
      *
     ISCSARD    E DSSCSARDPD                                                                  CDE003
      ** Switchable Features File                                                             CDE003
      *                                                                                       CDE003
     ISDRETL    E DSSDRETLPD
      ** Retail Details accessed via Access Object.
      *
     ISDCUST    E DSSDCUSTPD
      ** Client Details accessed via Access Object.
      *
     ISDBRCH    E DSSDBRCHPD                                                               MD023887A
      ** Branch Details accessed via Access Object.                                        MD023887A
     I              QQDFAC                          QDFAC1                                 MD023887A
      *                                                                                    MD023887A
     ISDDEAL    E DSSDDEALPD
     I              QQACCD                          QQACD1                                    CGL029
      ** Dealing ICD Details accessed via Access Object.
      *
     I/COPY WNCPYSRC,FXH00157
     IDSFDY     E DSDSFDY                                                                     CDE003
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                                    CDE003
     I*                                                                                       CDE003
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Watch List Checking Details accessed via Access Object.                              CSD015
      *                                                                                       CSD015
     ISDWLTO    E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction Details Data Structure.                                       CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch Configuration Data DS                                               CSD015
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      ** 24X7 Status Data Area.                                                               CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD Status Data Area.                                                                 CSD015
      *                                                                                       CSD015
     IWXPCKT      DS                            400                                           CSD015
     IPFFS        DS                           9999                                           CSD015
      ** Data Structures used by the Compliance Watch Subroutine.                             CSD015
      *                                                                                       CSD015
     I              'SDWLCLOP'            C         CEPGM                                     CSD015
      ** Compliance Engine Program Name (ILE).                                                CSD015
      *                                                                                       CSD015
     I              'A'                   C         ALL                                       CSD015
     I              'C'                   C         CHANGD                                    CSD015
      ** WMOVM (Move Mode) Constants.                                                         CSD015
      *                                                                                       CSD015
     I              'I'                   C         ONINS                                     CSD015
     I              'A'                   C         ONAMD                                     CSD015
      ** WCMPM (Compliance Mode) Constants.                                                   CSD015
      *                                                                                       CSD015
     I              9                     C         ARRMAX                                    CSD015
      ** Max. no. of elements associated with the CE arrays.                                  CSD015
      *                                                                                       CSD015
      /EJECT
      *=========================================================================
      * Main processing. Initialization done in *INZSR
      *=========================================================================
      *
      ** If No parms entered treta as Display.
     C           NOPARM    CASEQ0         DISPLY
     C           CNFDSP    CASEQ'CONFIRM' CONFRM
     C                     CAS            DISPLY
     C                     ENDCS
      *  End pgm
     C                     MOVE *ON       *INLR
     C                     RETRN                                                            MD044408
      *
      /EJECT
     C           CONFRM    BEGSR
      *=========================================================================
      * Confirm net requested from FX0910
      *=========================================================================
      *
      *  Govern use of Cmd. Keys and display relevant options.
     C                     MOVE *ON       *IN77
     C                     MOVEL*OFF      *IN20                           200138
      *
      ** Determine whether to procees Group or by Customer.
     C                     MOVELPLCSSN    CUSGRP
     C           CUSTOM    IFNE *BLANKS
     C                     MOVE *OFF      *IN81
     C                     MOVE 'N'       GROUP   1
     C                     ELSE
     C                     MOVE *ON       *IN81
     C                     MOVE 'Y'       GROUP
     C                     ENDIF
      *
     C                     MOVE PLCCY     DDCCY
     C                     MOVE PLCCY1    DCCYS1
     C                     MOVE PLCCY2    DCCYS2
     C                     MOVE 'I'       DDACTN
      *
      ** Create Net Ref., Calc. Net. Amt. and update FXNETMPD + FXNTIPPD.
     C                     CALL 'FX0921'  PL0921
      *
      ** Check Return Code.
     C           CCRTRN    IFEQ 'Y2U0004 '
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           CCRTRN    IFNE *BLANK
     C                     MOVELCCRTRN    @MSGID 10
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ENDIF
      *
      * If Net amts. from FX0910 differs from calc. amount then Error.
     C           NETA      IFNE NETAC
     C                     MOVE 'Y'       NETERR  1
     C                     MOVE *ON       *IN28
      *  Get currency details and edit amount.
     C                     MOVELDDCCY     WKCCY   3
     C                     EXSR CURDET
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     MOVE NETAC     ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    DDCAMT
     C                     ENDIF
      *
     C/COPY WNCPYSRC,FX0920C001
      **If*Net*Amt.*from FX0910 = 0 then error.                                               237421
     C***********NETA      IFEQ 0                                                             237421
     C***********NETA      ANDEQNETAC                                                         237421
     C***********          MOVE 'Y'       NETERR  1                                           237421
     C***********          MOVE *OFF      *IN28                                               237421
     C***********          ENDIF                                                              237421
     C/COPY WNCPYSRC,FX0920C002
      *
      ** Create Net Reference and Calc. Net Amount.
     C                     MOVE PLNETR    DDNETR
     C                     EXSR FMTNET
     C                     MOVE BBCSSN    PDCSSN 10
     C                     MOVE PLCCY     PDCCY
     C                     MOVE PLCCY1    PDCCY1
     C                     MOVE PLCCY2    PDCCY2
     C                     MOVE PLVALD    PDVALD
     C                     MOVE PLVALD    DDVALD
     C                     MOVE PLSEQN    KYSEQN
      *
     C           NETERR    IFEQ 'Y'
      ** Validate Screen Fields.
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C                     WRITE#MSGCTL
     C                     EXFMTFX0920C3
      **  Clear screen message queue.
     C                     CALL 'ZA0250'
      *
     C                     CALL 'ZA0240'
     C                     PARM 'FXM5020' @MSGID
     C                     ENDDO
      *
     C                     EXSR SDTERM
     C                     SETON                     LR
      ** Rollback previous Updates
     C                     ROLBK
     C           *INKC     IFEQ *ON
     C           NOPARM    ANDNE0
     C                     MOVEL'*INKC'   PLRTRN
     C                     ENDIF
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
     C                     EXSR CNFTRM
     C                     RETRN
     C                     ENDIF
      *
     C           NETERR    IFNE 'Y'
      ** Validate Screen Fields.
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
      **                                                                                      CDL025
     C           CDL025    IFEQ 'Y'                                                           CDL025
      ** CHECK FOR EXISTING SPLIT SETTLEMENT                                                  CDL025
     C           AMNETR    SETLLFXNETSD0                                                      CDL025
     C           AMNETR    READEFXNETSD0            N    26                                   CDL025
     C                     ENDIF                                                              CDL025
      *                                                                                       CDL025
     C                     WRITE#MSGCTL
     C                     EXFMTFX0920C3
      **  Clear screen message queue.
     C                     CALL 'ZA0250'
      *                                                                   200138
     C           *IN20     IFEQ *ON                                       200138
     C                     MOVEL*OFF      *INKF                           200138
     C                     ENDIF                                          200138
      *                                                                   200138
      ** If Enter call Extended Settlement Instructions.
     C           *INKC     IFEQ *OFF
     C           *INKP     ANDEQ*OFF
     C           *INKL     ANDEQ*OFF
     C/COPY WNCPYSRC,FX0920C003
     C********** *INKF     ANDEQ*OFF                                                        MD024497
     C/COPY WNCPYSRC,FX0920C004
     C           CDL025    ANDEQ'N'                                                         CDL025
     C           NETA      ANDNE0                                                           237421
      *                                                                                     CDL025
     C           CDL025    OREQ 'Y'                                                         CDL025
     C           *INKC     ANDEQ*OFF                                                        CDL025
     C           *INKL     ANDEQ*OFF                                                        CDL025
     C********** *INKF     ANDEQ*OFF                                                 CDL025 MD024497
     C           *INKP     ANDEQ*OFF                                                        CDL025
     C           *INKR     ANDEQ*OFF                                                        CDL025
     C           NETA      ANDNE0                                                           237421
     C                     MOVE 'I'       ACTION
     C           CDL025    IFEQ 'N'                                                         CDL025
     C                     EXSR EXTSET
     C                     ENDIF                                                            CDL025
      **                                                                                    CDL025
     C           CDL025    IFEQ 'Y'                                                         CDL025
     C           *IN26     IFEQ *ON                                                         CDL025
     C                     EXSR EXTSET                                                      CDL025
     C                     ELSE                                                             CDL025
     C                     EXSR SPLIT                                                       CDL025
     C           @PARM1    IFEQ '06     '                                                   CDL025
     C                     MOVE '1'       *INKF                                             CDL025
     C                     ENDIF                                                            CDL025
     C                     ENDIF                                                            CDL025
     C                     ENDIF                                                            CDL025
      *                                                                                     CDL025
     C                     ENDIF
      ** If F15 call FX0940 to display Deals.
     C           *INKP     IFEQ *ON
      *  Validate action codes - Multiple + Single branch ('V' for View)
     C           BGMBIN    IFEQ 'Y'
     C                     CALL 'ZVACTBU'
     C                     PARM 'V'       @ZACTN
     C                     PARM USRBCH    @ZBR
     C                     PARM           @ERR
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM 'V'       @ZACTN
     C                     PARM           @ERR
     C                     ENDIF
      *
      * Action code invalid for user/branch combination
     C           @ERR      IFEQ 2
     C                     CALL 'ZA0240'
     C                     PARM 'FXM0291' @MSGID
     C                     ENDIF
      *
      * Action code invalid for user
     C           @ERR      IFEQ 1
     C                     CALL 'ZA0240'
     C                     PARM 'FXM0292' @MSGID
     C                     ENDIF
      *
     C           @ERR      IFEQ 0
     C                     EXSR VIEW
     C                     ENDIF
      *
     C                     ITER
     C                     ENDIF
      **                                                                                  CDL025
     C           CDL025    IFEQ 'Y'                                                       CDL025
     C           *INKR     IFEQ *ON                                                       CDL025
     C                     MOVE DDNETR    SNETR                                           CDL025
     C                     MOVE *OFF      *INKR                                           CDL025
     C                     MOVE 'A'       ACTION                                          CDL025
     C                     EXSR SPLIT                                                     CDL025
     C           @PARM1    IFEQ '06     '                                                 CDL025
     C                     MOVE '1'       *INKF                                           CDL025
     C                     ELSE                                                           CDL025
     C                     ITER                                                           CDL025
     C                     ENDIF                                                          CDL025
     C                     ENDIF                                                          CDL025
     C                     ENDIF                                                          CDL025
      **                                                                                  CDL025
      ** If F6 not pressed then error.
     C           *INKF     IFEQ *OFF
     C           *INKJ     ANDEQ*OFF
      *                                                                   200138
     C           *IN20     IFEQ *OFF                                      200138
     C                     MOVEL'FXM5001' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ENDIF                                          200138
     C                     ELSE
      ** If F6 confirm updates.
     C/COPY WNCPYSRC,FX0920C005
     C                     EXSR CNFUPD
     C                     EXSR SDTERM
     C                     SETON                     LR
      ** Rollback previous Updates
     C                     ROLBK
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
     C                     RETRN
     C/COPY WNCPYSRC,FX0920C006
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
     C           *INKC     IFEQ *ON
     C           NOPARM    ANDNE0
     C                     MOVEL'*INKC'   PLRTRN
     C                     ENDIF
      *
      * If Exit by F3 or F12, confirmation cancelled therefore remove
      * updates made by FX0921.
     C           *INKC     IFEQ '1'
     C           *INKL     OREQ '1'
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
     C                     EXSR CNFTRM
     C                     ENDIF
      *
     C                     ENDSR
      *.........................................................................
      /EJECT
      *=========================================================================
      * Retrieve currency details
      *=========================================================================
      *
     C           CURDET    BEGSR
     C                     Z-ADD1         K       30
     C           WKCCY     LOKUPCY,K                     82
     C           *IN82     IFEQ '1'
     C                     Z-ADDCDP,K     A6NBDP
     C                     MOVE CYNM,K    A6CYNM
     C                     ELSE
     C                     Z-ADD0         A6NBDP
     C                     MOVE *BLANKS   A6CYNM
     C                     ENDIF
      *
     C                     ENDSR
      *.........................................................................
      /EJECT
     C           DISPLY    BEGSR
      *=========================================================================
      * Display subfile of confirmed nets
      *=========================================================================
      *
      *
      *  First Time show Subfile control
     C                     MOVEA'10001'   *IN,31           SFLDSPCTL/CLR on
     C                     Z-ADD1         S1RRN
     C                     Z-ADD1         S1RRND
     C                     Z-ADD1         SFLCNT
      *  Check for Input Parms
     C           NOPARM    IFEQ 0                          Parameters passed
     C                     MOVEL*BLANKS   PDCCY            Setup of CCY
     C                     MOVEL*BLANKS   PDCCY1           Setup of CCY
     C                     MOVEL*BLANKS   PDCCY2           Setup of CCY
     C                     MOVEL*BLANKS   PDCSSN           Setup of Cust
     C                     Z-ADD0         PDVALD                    Value
     C                     MOVE *BLANKS   PVDATE                    Value
     C/COPY WNCPYSRC,FXH00204
     C                     ELSE
     C                     MOVELPLCCY     PDCCY            Setup of CCY
     C                     MOVELPLCCY1    PDCCY1           Setup of CCY
     C                     MOVELPLCCY2    PDCCY2           Setup of CCY
      *  Check if Customer supplied
     C           PLCSSN    IFNE *BLANKS
     C                     MOVELPLCSSN    PDCSSN           Setup of Cust
     C                     END
      *  Check if Value date supplied
     C           PLVALD    IFNE *BLANKS
     C                     MOVELPLVALD    PDVALD                    Value
     C                     MOVELPLVALD    PVDATE                    Value
     C                     ENDIF
     C/COPY WNCPYSRC,FXH00205
     C                     ENDIF
     C           PDVALD    IFEQ 0
      * IF BLANK DEFAULT SCREEN DATE TO DATE OF NEXT WORKING DAY
      *     Convert Midas day number to date
     C                     CALL 'ZDATE2'
     C                     PARM BJDNWD    WQ0005  50
     C                     PARM BJDFIN    WQ0006  1
     C           WQ0007    PARM *ZERO     WQ0007  60
     C           DAYDAT    PARM *BLANK    DAYDAT  7
      * Default Date
     C                     MOVELWQ0007    PDVALD
     C                     MOVELWQ0007    PVDATE
     C                     ENDIF
      *
     C                     MOVE *LOVAL    KYSEQN
     C                     EXSR LOADSF                     Load Subfile
      *  Loop until F3 is pressed or F15 returns
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'                                       127051
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     Z-ADD1         S1RRND
      *
     C           WFNEWC    IFEQ 'Y'
     C                     Z-ADD1         ##SFRC
     C                     ELSE
     C                     Z-ADDS1RRN     ##SFRC
     C                     ENDIF
      *
     C                     EXFMTFX0920C1
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
      *
      *  Bypass if F3/F12
     C           *INKC     IFEQ '0'
     C           *INKL     ANDEQ'0'
      *  Check for change of request
     C                     MOVE ' '       WFNEWC  1
     C                     MOVE PVDATE    PDVALD
     C           PDCSSN    IFNE SAVCUS                     Customer change
     C           PDVALD    ORNE WFVALD                     Val date change
     C           PDCCY     ORNE SAVCCY                     CCY chg
     C           PDCCY1    ORNE SAVCY1                     CCY chg
     C           PDCCY2    ORNE SAVCY2                     CCY chg
     C                     MOVE 'Y'       WFNEWC
     C                     Z-ADD1         S1RRN
     C                     END
     C                     MOVE PDCCY     SAVCCY  3
     C                     MOVE PDCCY1    SAVCY1  3
     C                     MOVE PDCCY2    SAVCY2  3
      *  Process request
     C           *INKE     CASEQ'1'       LOADSF           F5 Refresh
     C           WFNEWC    CASEQ'Y'       LOADSF           New conditions
     C                     CAS            PROCSF           Process Selections
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C           *INKC     IFEQ *ON
     C           NOPARM    ANDNE0
     C                     MOVEL'*INKC'   PLRTRN
     C                     ENDIF
      *
     C                     ENDSR
      *.........................................................................
      /EJECT
      *****************************************************************
      *
     C           LOADSF    BEGSR
      *  Initialise Subfile
     C                     MOVEA'00001'   *IN,31           SFLINZ activated
     C                     WRITEFX0920C1
     C                     MOVEA'10000'   *IN,31           SFLDSPCTL activated
     C                     Z-ADD0         S1RRN   40
     C                     Z-ADD0         S1RRND  40
     C                     Z-ADD0         SFLCNT  50
      ** Clear screen message queue.
     C                     CALL 'ZA0250'
     C                     MOVE *OFF      *IN38
      *
      ** Validate Entered Customer Number
     C                     MOVE '0'       *IN71
     C                     MOVE '0'       *IN75
     C**********           Z-ADD0         WFCUST                                            BUG11679
     C                     MOVEL*BLANKS   WFCUST                                            BUG11679
      *
      ** If Data querying required access customer program
      *
     C           PDCSSN    IFEQ '?'
     C                     CALL 'SD0012S'
     C                     PARM *BLANKS   PORTN   7
     C                     PARM *BLANKS   WPC001  6
     C           PORTN     IFNE *BLANKS
     C           PORTN     ANDNE'Y2U0016'
     C                     EXSR *PSSR
     C                     ELSE
      *
      ** If a Customer Number is not selected blank out field
      *
     C           PORTN     IFEQ 'Y2U0016'
     C                     MOVEL*BLANKS   PDCSSN           Customer Number
     C                     ELSE
     C                     MOVELWPC001    PDCSSN
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           PDCSSN    IFNE *BLANK
      * Check for Group Processing.                                    CUST
     C                     MOVE '*'       KSET
     C                     MOVELPDCSSN    KGRP
     C           CGPKEY    CHAINSDCGRPL2             80
     C/COPY WNCPYSRC,FXH00158
     C           *IN80     IFEQ '0'
      * GROUP TO BE PROCESSED
     C                     MOVE '1'       *IN81
     C                     ELSE
     C                     MOVE *OFF      *IN81
      * ACCESS CUSTOMER
     C                     MOVELPDCSSN    WKEY
      *                                                                CUST
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY'    WOPTN
     C                     PARM           WKEY
     C                     PARM           WKYST
     C           SDCUST    PARM SDCUST    SDSSDY
      *
      *  Set Customer in error
     C           WRTCD     IFNE *BLANKS
     C                     MOVE '1'       *IN71
     C                     MOVE '1'       *IN75
     C                     ELSE
     C                     MOVELBBCUST    WFCUST
     C                     MOVELBBCSSN    PDCSSN
     C                     END
     C                     END
     C                     END
      *  Save Customer No.
     C                     MOVELPDCSSN    SAVCUS 10
      *  Initialise date
     C                     MOVE PVDATE    WFVALD
     C           WFVALY    IFGE 72
     C                     MOVEL'19'      WFVAL8
     C                     ELSE
     C                     MOVEL'20'      WFVAL8
     C                     END
     C                     MOVE *LOVAL    KYSEQN
      *  Position file
     C           NETMKY    SETLLFXNETML0
      *  Read first record
     C                     READ FXNETML0                 70
      *  Loop until end of file/customer
     C           *IN70     DOWEQ'0'
      * CHECK FIELDS IF PRESENT
     C           PDCSSN    IFNE *BLANKS
     C           PDCSSN    CABNEAMDCSN    NXTREC
     C                     END
     C           PDCCY     IFNE *BLANKS
     C           PDCCY     CABNEAMCCYD    NXTREC
     C                     END
     C           PDCCY1    IFNE *BLANKS
     C           PDCCY1    CABNEAMCCY1    NXTREC
     C                     END
     C           PDCCY2    IFNE *BLANKS
     C           PDCCY2    CABNEAMCCY2    NXTREC
     C                     END
     C           PDVALD    IFNE 0
     C           PDVALD    CABNEAMVDTY    NXTREC
     C                     END
      * EXCLUDE CANCELLED OR IN PROGRESS NETS
     C           AMRECI    IFEQ 'C'
     C           AMRECI    OREQ 'R'
     C           AMRECI    OREQ 'M'
     C           AMRECI    OREQ 'N'
      *  One record read
     C                     MOVE '1'       *IN32
      * SETUP FILE FIELDS FOR DISPLAY
     C                     MOVE ' '       DDSEL
     C                     MOVE AMNETR    DDNETR
     C           GRPREF    IFNE '##'
     C                     MOVE WFCUSN    DDCUSN
     C                     ELSE
     C                     MOVE *BLANKS   DDCUSN
     C                     ENDIF
     C                     MOVE AMDCSN    DDCSSN
     C                     MOVE AMCCYD    DDCCY
     C                     MOVE AMCCY1    DCCYS1
     C                     MOVE AMCCY2    DCCYS2
     C                     MOVE AMVDTY    DDVALD
     C                     MOVE AMSETM    DDSETP
     C                     MOVE *BLANKS   DDSEAC
      *  SHOW BRANCH CODE FOR MULTI BRANCH SETTL TYPE 05
     C           DDSETP    IFEQ '05'
     C           BGMBIN    ANDEQ'Y'
     C                     MOVE AMOURN    DDSEAC
     C                     MOVELAMONOB    DDSEAC
     C                     ELSE
     C                     MOVELAMOURN    DDSEAC
     C                     END
      *  Get currency details
     C                     MOVELDDCCY     WKCCY   3
     C                     EXSR CURDET
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
      * BECAUSE AMOUNTS HELD AS POSITIVE, MAKE SALE NEGATIVE
     C           AMBSIN    IFEQ 'S'
     C                     Z-SUBAMDBUY    ZFLD15
     C                     ELSE
     C                     Z-ADDAMDBUY    ZFLD15
     C                     END
     C                     EXSR ZFRPED
     C                     MOVELZOUT22    DDNETT
      * SET STATUS FIELD
     C                     MOVE *BLANKS   DDSTUS
     C                     MOVE '1'       *IN65
     C           AMRECI    IFEQ 'M'
     C           AMRECI    OREQ 'N'
     C                     MOVE 'MAT'     DDSTUS
     C                     MOVE '0'       *IN65
     C                     END
     C           AMRECI    IFEQ 'R'
     C                     MOVE 'DEL'     DDSTUS
     C                     MOVE '0'       *IN65
     C                     END
      *  Write subfile
     C           SFLCNT    ADD  1         S1RRN
     C                     Z-ADDS1RRN     S1RRND
     C                     ADD  1         SFLCNT
     C                     WRITEFX0920S1
     C                     END
     C           NXTREC    TAG
      *  Read next record
     C                     READ FXNETML0                 70
     C                     END
      *  Set Subfile End Flag
     C                     MOVE '1'       *IN34
     C           *IN32     IFEQ '0'
      * Clear Subfile if there are no records
     C                     MOVEA'00001'   *IN,31           SFLINZ/CLR on
     C                     Z-ADD1         S1RRND
     C                     WRITEFX0920C1
     C                     Z-ADD1         S1RRN
     C                     Z-ADD1         SFLCNT
     C                     MOVE *BLANKS   DDCCY
     C                     MOVE '1'       *IN30
     C                     WRITEFX0920S1
     C                     MOVE '0'       *IN30
     C                     MOVEA'11010'   *IN,31           SFLDSPCTL/CLR on
     C                     MOVE '1'       *IN75            POSITION CURSOR
      *  Message for no deals selected
     C                     MOVEL'FXM5003' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *  Amount Format Subroutine
      *COPY*ZSRSRC,ZFRPEDZ3***                                                                245692
      /COPY ZSRSRC,ZFRPEDZ4                                                                   245692
      *
      /EJECT
      *****************************************************************
      *
      *  Format details for customer/ccy(s)
      *
     C           FMTNET    BEGSR
     C                     MOVE *BLANKS   DDSTS
      * Non display status if blank.
     C                     MOVE *OFF      *IN69
     C           DDNETR    CHAINFXNETMPD            N84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETML1).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD1         DBASE            ***************
     C                     MOVEL'FXNETML1'DBFILE           *DB ERROR 01  *
     C                     MOVELDDNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE *BLANKS   DDCUSN
     C                     MOVE AMCCYD    DDNCCY
     C                     MOVE AMCCY1    DDPCY1
     C                     MOVE AMCCY2    DDPCY2
     C                     MOVE AMVDTY    DDVDAT
     C                     MOVE AMNTNO    DDNTNO                                            MD025805
      ** Display ccy fields.
     C           DCCYS1    IFNE *BLANKS
     C                     MOVE '1'       *IN27
     C                     MOVE 'Y'       DDPIND
      ** Access Currency Details.
     C                     MOVELDCCYS1    WKCCY
     C                     EXSR CURDET
     C                     MOVE A6CYNM    DDPC1N
     C                     MOVELDCCYS2    WKCCY
     C                     EXSR CURDET
     C                     MOVE A6CYNM    DDPC2N
     C                     ELSE
      ** Non-Display Fields.
     C                     MOVE '0'       *IN27
     C                     MOVE 'N'       DDPIND
     C                     MOVE *BLANKS   DCCYS1
     C                     MOVE *BLANKS   DDPC1N
     C                     MOVE *BLANKS   DCCYS2
     C                     MOVE *BLANKS   DDPC2N
     C                     ENDIF
      *                                                                CUST
      ** Check for entry of group code if passed as parameter.
     C           NOPARM    IFNE 0
     C           DDCSSN    ANDEQ*BLANKS
     C           GRPCDE    IFNE *BLANKS
     C                     MOVE '*'       KSET
     C                     MOVELGRPCDE    KGRP
     C           CGPKEY    CHAINSDCGRPL2             84
     C/COPY WNCPYSRC,FXH00159
     C           *IN84     IFEQ *ON
      ** Data base error in file (SDCGRPL2).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD2         DBASE            ***************
     C                     MOVEL'SDCGRPL2'DBFILE           *DB ERROR 02  *
     C                     MOVELGRPCDE    DBKEY            ***************
     C/COPY WNCPYSRC,FXH00160
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELD6NTCU    WKEY
     C                     ENDIF
     C                     ELSE
     C                     MOVELCUSTOM    WKEY
     C                     ENDIF
     C                     ELSE
      ** No parameters passed.
     C                     MOVE '*'       KSET
     C                     MOVE *BLANKS   KGRP
     C                     MOVELDDCSSN    KGRP
     C           CGPKEY    CHAINSDCGRPL2             84
     C/COPY WNCPYSRC,FXH00161
      ** Customer Details for Settlement Customer of Group or Customer.
     C           *IN84     IFEQ *OFF
     C                     MOVELD6NTCU    WKEY   10
     C                     ELSE
     C                     MOVELDDCSSN    WKEY
     C                     ENDIF
     C                     ENDIF
      *                                                                CUST
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY'    WOPTN
     C                     PARM           WKEY   10
     C                     PARM           WKYST   7
     C           SDCUST    PARM SDCUST    SDSSDY
      *
      ** Set up relevent Customer Shortname.
     C           *LIKE     DEFN PMCSNM    WKCSNM
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE *BLANKS   WKCSNM
     C                     MOVE BBCSSN    WKCSNM
     C                     ENDIF
      ** If part of group display description else customer name and town.
     C           GRPREF    IFEQ '##'
     C                     MOVE *ON       *IN81
     C                     MOVELD6GPCD    DDGPCD
     C                     MOVELD6GPDS    DDGPDS
     C                     ELSE
     C                     MOVE BBCUST    DDCUST
     C                     MOVE BBCSSN    DDC3SN
     C                     MOVELBBCRNM    DDCRNM
     C                     MOVELBBCRTN    DDCRTN
     C                     ENDIF
      *
      ** Display Ccy name.
     C                     MOVELDDCCY     WKCCY
     C                     EXSR CURDET
     C                     MOVE A6CYNM    DDNCCN
      *
      ** Format Net Amount.
     C                     MOVE A6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
      ** Amounts held as +ve, thereforef makd sales -ve.
     C           AMBSIN    IFEQ 'S'
     C                     Z-SUBAMDBUY    ZFLD15
     C                     ELSE
     C                     Z-ADDAMDBUY    ZFLD15
     C                     ENDIF
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    DDNAMT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *
      *  Print details for selected customer(s)
      *
     C           PRTDET    BEGSR
      * DO NOT ALLOW FOR DELETED NETS
     C           DDSTUS    IFEQ 'DEL'
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5004' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
     C                     EXSR FMTNET
      *
     C                     MOVELAMNETR    PPNETR
     C                     MOVELAMNETR    NETFMT
      *
      ** If part of group pass description else customer name and town.
     C           GRPREF    IFEQ '##'
     C                     MOVELD6GPCD    PPCSSN    P
     C                     MOVELD6GPDS    PPDETS
     C                     ELSE
     C                     MOVE BBCSSN    PPCSSN    P
     C                     MOVELBBCRNM    PPDETS
     C                     MOVE BBCRTN    PPDETS
     C                     ENDIF
      *
     C                     MOVELAMVDTY    PPVALD
     C                     MOVELAMSETM    PPSETM
     C                     MOVELDDSEAC    PPSEAC
      *
     C                     CALL 'FC0040X'
     C                     PARM           P6RTN   7
     C                     PARM 'FX0922'  P1RNAM 10
     C                     PARM 'FXC0922' P2COTT 10
     C                     PARM '10001'   P3CSEQ  5
     C                     PARM REPTDS    P4CLPM100
     C                     PARM BGMBIN    P5MBIN  1
     C                     PARM 'S'       LEVEL   1
     C                     PARM *BLANKS   ENTITY  5
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *
      *  Amend the netting details
     C           AMEND     BEGSR
      *                                                                   127084
      * Display Command line informing that F15 is available              127084
     C                     MOVE *ON       *IN68                           127084
     C                     MOVEL*OFF      *IN20                           200138
      *
      * Determine whether group or customer.
     C           GRPREF    IFEQ '##'
     C                     MOVE *ON       *IN81
     C                     MOVELWFGRP#    GRPCDE
     C                     ELSE
     C                     MOVE *OFF      *IN81
     C                     MOVELWFCUSN    CUSTOM
     C                     ENDIF
      *
      *  RUN FMTNET FOR DETAILS IN HEADER
     C                     EXSR FMTNET
      *  CONFIRM THAT NET HAS NOT ALREADY PASSED VALUE DATE. GIVE ERROR
     C           AMVALD    IFLT BJRDNB
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5006' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
      *  CONFIRM THAT NET NOT ALREADY DELETED
     C           AMRECI    IFNE 'C'
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5007' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
     C                     MOVEA'00'      *IN,78
     C                     MOVE 'A'       DDACTN
      *
      *  GIVE WARNING ERROR IF PAY/REC ALREADY GENERATED
     C           AMPRGI    IFNE *BLANK
     C                     MOVEL'FXM5008' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ENDIF
      *
      * VALIDATE SCREEN FIELDS
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           *INKF     ANDEQ'0'
      **                                                                  CDL025
     C           CDL025    IFEQ 'Y'                                       CDL025
      ** CHECK FOR EXISTING SPLIT SETTLEMENT                              CDL025
     C           AMNETR    SETLLFXNETSD0                                  CDL025
     C           AMNETR    READEFXNETSD0            N    26               CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C                     WRITE#MSGCTL
     C                     EXFMTFX0920C3
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
      *
     C           *IN20     IFEQ *ON                                       200138
     C                     MOVEL*OFF      *INKF                           200138
     C                     ENDIF                                          200138
      *                                                                   200138
     C           *INKF     IFEQ *ON
     C           AMNETR    CHAINFXNETMPD             84
      *                                                                                       CSD015
      ** Save the current transaction to the data store.                                      CSD015
      *                                                                                       CSD015
     C                     MOVE WLFDS     WBC                                                 CSD015
      *                                                                                       CSD015
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD15        DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 15  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                     MD045437
      ** Determine if new projections have to be created.                                   MD045437
      * Reverse old projections before fields are updated.                                  MD045437
      *                                                                                     MD045437
     C           PMRONS    IFNE AMOURN                                                      MD045437
     C                     EXSR RSCRV2                                                      MD045437
     C                     ENDIF                                                            MD045437
      *
     C                     EXSR UPDFLD
      *  UPDATE PAY/REC FLAG IF ALREADY GENERATED
     C           AMPRGI    IFEQ 'G'
     C                     MOVE 'A'       AMPRGI
     C                     ENDIF
     C                     MOVELCHGDAT    AMDTCH
     C                     TIME           AMCHTI
     C                     MOVE 'A'       AMCHTY
     C                     MOVE SUSER     AMCHUS
     C                     MOVE SWSID     AMCHWS
      *                                                                                       CSD015
      ** Call the Compliance Engine if necessary.                                             CSD015
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
     C           CSD015    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C           CSC011    ORNE 'Y'                                                           CSD015
     C                     MOVE ONAMD     WCMPM   1                                           CSD015
     C                     EXSR SRCMPC                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     UPDATFXNETMD0               84
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETML1).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD16        DBASE            ***************
     C                     MOVEL'FXNETML1'DBFILE           *DB ERROR 16  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *  Comit File Updates                                                                 MD044408
     C                     MOVE 'FX'      MDID             Module                           MD044408
     C                     MOVEL'FX0920'  PGMN             Programme Name                   MD044408
     C                     MOVE SWSID     CMTWS            Workstation Id                   MD044408
     C                     MOVE SUSER     CMTUSR           User Id                          MD044408
     C                     TIME           CMTTIM           Time                             MD044408
     C           CMTTXT    COMIT                           Commit updates                   MD044408
      *                                                                                     MD045437
      ** Determine if new projections have to be created.                                   MD045437
      *                                                                                     MD045437
     C           AMOURN    IFNE BCOURN                                                      MD045437
     C                     EXSR RSCNT2                                                      MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF
      *
      * If 'Enter' Display Extended Settlements                           127084
     C           *INKC     IFEQ *OFF
     C           *INKL     ANDEQ*OFF
     C           *INKF     ANDEQ*OFF
     C           *INKP     ANDEQ*OFF                                      127084
      *                                                                   CDL025
     C           CDL025    ANDEQ'N'                                       CDL025
     C           CDL025    OREQ 'Y'                                       CDL025
     C           *INKC     ANDEQ*OFF                                      CDL025
     C           *INKL     ANDEQ*OFF                                      CDL025
     C           *INKF     ANDEQ*OFF                                      CDL025
     C           *INKP     ANDEQ*OFF                                      CDL025
     C           *INKR     ANDEQ*OFF                                      CDL025
      *                                                                   CDL025
     C                     MOVE 'A'       ACTION
      * IF F6 NOT PRESSED GIVE ERROR
      *                                                                   CDL025
     C           CDL025    IFEQ 'N'                                       CDL025
     C                     EXSR EXTSET
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C           CDL025    IFEQ 'Y'                                       CDL025
     C           *IN26     IFEQ *ON                                       CDL025
     C                     EXSR EXTSET                                    CDL025
     C                     ELSE                                           CDL025
     C                     EXSR SPLIT                                     CDL025
     C                     ENDIF                                          CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C********** CDL025    IFEQ 'N'                                                  CDL025 MD024498
     C           *INKF     IFEQ *OFF
     C           *IN20     ANDEQ*OFF                                      200138
     C                     MOVEL'FXM5001' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ENDIF
     C**********           ENDIF                                                     CDL025 MD024498
      *
     C                     END
     C           *INKP     IFEQ *ON                                       127084
     C                     MOVE DDNETR    SNETR                           127084
     C                     MOVE *OFF      *INKP                           127084
     C                     EXSR VIEW                                      127084
     C                     ENDIF                                          127084
      **                                                                  CDL025
     C           CDL025    IFEQ 'Y'                                       CDL025
     C           *INKR     IFEQ *ON                                       CDL025
     C                     MOVE DDNETR    SNETR                           CDL025
     C                     MOVE *OFF      *INKR                           CDL025
     C                     MOVE 'A'       ACTION                          CDL025
     C                     EXSR SPLIT                                     CDL025
     C                     ENDIF                                          CDL025
     C                     ENDIF                                          CDL025
      **
     C                     SETON                     77                                     MD044408
      *                                                                                     MD044408
     C                     END
     C                     END
     C                     END
      *                                                                   127084
      * Remove Command line informing that F15 is available               127084
     C                     MOVE *OFF      *IN68                           127084
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *
      * Delete the netting details
      *
     C           DELETE    BEGSR
      *
      * Determine whether group or customer.
     C           GRPREF    IFEQ '##'
     C                     MOVE *ON       *IN81
     C                     MOVELWFGRP#    GRPCDE
     C                     ELSE
     C                     MOVE *OFF      *IN81
     C                     MOVELWFCUSN    CUSTOM
     C                     ENDIF
      *
      *  RUN FMTNET FOR DETAILS IN HEADER
     C                     EXSR FMTNET
      *  CONFIRM THAT NET HAS NOT ALREADY PASSED VALUE DATE. GIVE ERROR
     C           AMVALD    IFLT BJRDNB
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5006' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
      *  CONFIRM THAT NET NOT ALREADY DELETED
     C           AMRECI    IFNE 'C'
     C                     MOVE '1'       *IN38
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5007' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
     C                     MOVEA'11'      *IN,78
     C                     MOVE 'D'       DDACTN
      *
      * VALIDATE SCREEN FIELDS
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           *INKJ     ANDEQ'0'
     C           *IN83     OREQ '0'
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5002' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     WRITE#MSGCTL
     C                     EXFMTFX0920C3
      *  Clear screen message queue.
     C                     CALL 'ZA0250'
     C           *INKC     IFEQ '0'
     C           *INKL     ANDEQ'0'
     C           *INKJ     IFEQ '0'
     C                     MOVE '1'       *IN83
     C                     MOVEL'FXM5002' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     ELSE
      * PROCESS UPDATES FOR DELETE
      * FIRST SET RECI TO 'E' TO FACILITATE RECOVERY IF FAILURE
     C           AMNETR    CHAINFXNETMD0             84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD18        DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 18  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE 'E'       AMRECI
     C                     UPDATFXNETMD0
      *
     C           AMNETR    SETLLDLDEALL1
     C           AMNETR    READEDLDEALL1                 82
      *
     C           *IN82     IFEQ *OFF
     C                     MOVEL'B'       BSNREF  1
     C                     ENDIF
      *
     C           *IN82     DOWEQ'0'
     C                     EXSR UPDLFX
     C           AMNETR    READEDLDEALL1                 82
     C                     ENDDO
      *
     C                     MOVEL*BLANKS   BSNREF
      *
     C           AMNETR    SETLLDLDEALL2
     C           AMNETR    READEDLDEALL2                 82
      *
     C           *IN82     IFEQ *OFF
     C                     MOVEL'S'       BSNREF
     C                     ENDIF
      *
     C           *IN82     DOWEQ'0'
     C                     EXSR UPDLFX
     C           AMNETR    READEDLDEALL2                 82
     C                     ENDDO
      *
     C           CDL025    IFEQ 'Y'                                                           CDL025
      ** CHECK FOR EXISTING SPLIT SETTLEMENT AND SET TO DELETED                               CDL025
     C           AMNETR    SETLLFXNETSD0                                                      CDL025
     C           AMNETR    READEFXNETSD0                 82                                   CDL025
     C           *IN82     DOWEQ'0'                                                           CDL025
     C                     MOVE 'R'       ASRECI                                              CDL025
     C                     MOVELCHGDAT    ASDTCH                                              CDL025
     C                     TIME           ASCHTI                                              CDL025
     C                     MOVE 'R'       ASCHTY                                              CDL025
     C                     MOVE SUSER     ASCHUS                                              CDL025
     C                     MOVE SWSID     ASCHWS                                              CDL025
     C                     MOVE 'E'       ASEXPF                                              CDL025
     C                     UPDATFXNETSD0                                                      CDL025
      *                                                                                       CDL025
     C           AMNETR    READEFXNETSD0                 82                                   CDL025
     C                     ENDDO                                                              CDL025
     C                     ENDIF                                                              CDL025
      *                                                                                       CDL025
      * SET RECI TO 'R' TO SHOW COMPLETION OF DELETE UPDATE
     C           AMNETR    CHAINFXNETMPD             84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD18        DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 18  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE 'R'       AMRECI
     C                     MOVELCHGDAT    AMDTCH
     C                     TIME           AMCHTI
     C                     MOVE 'R'       AMCHTY
     C                     MOVE SUSER     AMCHUS
     C                     MOVE SWSID     AMCHWS
     C                     MOVE 'E'       AMEXPF
     C                     UPDATFXNETMD0
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD20        DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 20  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Delete nets in progress.
     C           AMNETR    SETLLFXNTIPV0
     C           AMNETR    READEFXNTIPV0                 82
     C           *IN82     DOWEQ'0'
     C                     DELETFXNTIPV0
     C           AMNETR    READEFXNTIPV0                 82
     C                     ENDDO
      *                                                                                     MD021333
      ** Update RSACMTPD (Delete projection for the NET)                                    MD021333
      *                                                                                     MD021333
     C                     EXSR RSCDEL                                                      MD021333
      *                                                                                     MD021333
      *
     C* SET STATUS TO ALLOW UPDATE OF SUBFILE RECORD
     C                     MOVE 'DEL'     DDSTUS
      *  Comit File Updates
     C                     MOVE 'FX'      MDID             Module
     C                     MOVEL'FX0920'  PGMN             Programme Name
     C                     MOVE SWSID     CMTWS            Workstation Id
     C                     MOVE SUSER     CMTUSR           User Id
     C                     TIME           CMTTIM           Time
     C           CMTTXT    COMIT                           Commit updates
     C                     END
     C                     END
      *
     C                     END
     C                     END
     C                     END
     C                     ENDSR
      *
      *****************************************************************
      *
      * Enquire on the netting details
      *
     C           ENQIRE    BEGSR
      *                                                                   127084
      * Display Command line informing that F15 is available              127084
     C                     MOVE *ON       *IN68                           127084
      *
     C                     MOVEA'11'      *IN,78
     C                     MOVE 'E'       DDACTN
      * Determine whether group or customer.
     C           GRPREF    IFEQ '##'
     C                     MOVE *ON       *IN81
     C                     MOVELWFGRP#    GRPCDE
     C                     ELSE
     C                     MOVE *OFF      *IN81
     C                     MOVELWFCUSN    CUSTOM
     C                     ENDIF
      *
      *  RUN FMTNET FOR DETAILS IN HEADER
     C                     EXSR FMTNET
      * SET STATUS FIELD
     C           AMRECI    IFEQ 'M'
     C           AMRECI    OREQ 'N'
     C                     MOVE *ON       *IN69
     C                     MOVE 'MATURED' DDSTS
     C                     ENDIF
     C           AMRECI    IFEQ 'R'
     C                     MOVE *ON       *IN69
     C                     MOVE 'DELETED' DDSTS
     C                     ENDIF
     C                     WRITE#MSGCTL
      *
     C           CDL025    IFEQ 'Y'                                       CDL025
      ** CHECK FOR EXISTING SPLIT SETTLEMENT                              CDL025
     C           AMNETR    SETLLFXNETSD0                                  CDL025
     C           AMNETR    READEFXNETSD0            N    26               CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C                     MOVE 'Y'       REDSP   1
      ** Check whether to redisplay enquiry screen
     C           REDSP     DOWEQ'Y'
     C                     EXFMTFX0920C3
      ** Clear screen message queue.
     C                     CALL 'ZA0250'
      *
     C***If*F14*call*Extended*Settlements.*****************************   127084
     C** If 'Enter' display Extended Settlements                          127084
     C           *INKC     IFNE *ON
     C           *INKL     ANDNE*ON
     C           *INKP     ANDNE*ON                                       127084
     C           *INKR     ANDNE*ON                                                         MD024498
     C                     MOVEL'E'       ACTION  1
      *
     C           CDL025    IFEQ 'N'                                       CDL025
     C                     EXSR EXTSET
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C           CDL025    IFEQ 'Y'                                       CDL025
     C           *IN26     IFEQ *ON                                       CDL025
     C                     EXSR EXTSET                                    CDL025
     C                     ELSE                                           CDL025
     C                     EXSR SPLIT                                     CDL025
     C                     ENDIF                                          CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C                     ELSE
     C           *INKP     IFEQ *ON                                       127084
     C                     MOVE DDNETR    SNETR                           127084
     C                     MOVE *OFF      *INKP                           127084
     C                     EXSR VIEW                                      127084
     C                     MOVE 'Y'       REDSP                           127084
     C                     ELSE                                           127084
     C                     MOVE 'N'       REDSP
     C                     ENDIF                                          127084
      *                                                                                     MD024498
     C           CDL025    IFEQ 'Y'                                                         MD024498
     C           *INKR     ANDEQ*ON                                                         MD024498
     C                     MOVE DDNETR    SNETR                                             MD024498
     C                     MOVE *OFF      *INKR                                             MD024498
     C                     MOVE 'E'       ACTION                                            MD024498
     C                     EXSR SPLIT                                                       MD024498
     C                     ENDIF                                                            MD024498
      *                                                                                     MD024498
     C                     ENDIF
     C                     ENDDO
      *                                                                   127084
      * Remove Command line informing that F15 is available               127084
     C                     MOVE *OFF      *IN68                           127084
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *
     C           VIEW      BEGSR
      *  Call search program with either group or customer.
     C                     MOVE DDVALD    SVALD
     C                     MOVE DDCCY     SCCY
     C                     MOVELDCCYS1    SCCYP
     C                     MOVE DCCYS2    SCCYP
     C                     MOVE *BLANKS   SGRPC
     C                     MOVE *BLANKS   SCUS#
     C           GRPREF    IFEQ '##'
     C                     MOVELWFGRP#    SGRPC
     C                     ELSE
     C                     MOVELWFCUSN    SCUS#
     C                     ENDIF
      *
     C           *INKP     IFEQ *OFF
     C                     MOVELDDNETR    SNETR
     C                     ELSE
     C                     MOVE *BLANKS   SNETR
     C                     ENDIF
      *
     C                     CALL 'FX0940'               89
     C                     PARM           SCUS#   6
     C                     PARM           SVALD   6
     C                     PARM           SCCY    3
     C                     PARM           SCCYP   6
     C                     PARM           SGRPC   4
     C                     PARM           SNETR  19
     C                     PARM 'M'       SELEC   1
     C/COPY WNCPYSRC,FXH00203
      *
      * Check for Error on Call
     C           *IN89     IFEQ '1'
     C                     MOVEL'FXM5009' @MSGID
     C                     CALL 'ZA0240'
     C                     PARM           @MSGID
     C                     END
     C*  IF F3 PRESSED THEN EXIT PROGRAM AND RETURN
     C           SELEC     IFEQ 'E'
     C                     MOVEL'1'       *INKC
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *
      *  SETUP AMENDABLE SCREEN FIELDS USING FILE FIELDS
      *
     C           EXTSET    BEGSR
      *
     C   20                GOTO SETERR                                    200138
      *                                                                   200138
      ** Do not clear settlement details if they were properly inserted                     AR646775
      ** by input but F6 was not taken yet.                                                 AR646775
      ** I mean:"1st call for insert" = "N"                                                 AR646775
      **        "Settlement details valid" = "Y"                                            AR646775
      **        "Command key entered" = "12" - F12 was taken from                           AR646775
      **                                     settlement screen, because                     AR646775
      **                                     the details are valid.                         AR646775
      *                                                                                     AR646775
     C           PMFRST    IFEQ 'N'                                                         AR646775
     C           PMSDTV    ANDEQ'Y'                                                         AR646775
     C           PMCMDP    ANDEQ'12'                                                        AR646775
     C           ACTION    ANDEQ'I'                                                         AR646775
     C           PMFRST    OREQ 'Y'                                                         AR646775
     C           PMSDTV    ANDEQ'Y'                                                         AR646775
     C           PMCMDP    ANDEQ'12'                                                        AR646775
     C           ACTION    ANDEQ'A'                                                         AR646775
     C                     GOTO SETERR                                                      AR646775
     C                     ENDIF                                                            AR646775
      *                                                                                     AR646775
     C           ACTION    IFNE 'A'                                                         MD024498
     C           ACTION    OREQ 'A'                                                         MD024498
     C           INITZD    ANDEQ' '                                                         MD024498
      *                                                                                     MD024498
     C                     MOVE 'Y'       INITZD  1                                         MD024498
     C                     CLEAR@PARM2
     C                     CLEAR@PARM3
     C                     CLEAR@PARM4                                    200138
      *
     C                     Z-ADDBJRDNB    PMRUND
     C                     Z-ADDBJBVPD    PMBVPD
     C                     MOVE BGRTBN    PMRETP
     C                     MOVE BGCHIP    PMCHIM
     C                     MOVE BMRANR    PMRETS
     C                     MOVE BMACCD    PMPCYA
      *  SET DAYDATE IN YYYYMMDD FORMAT FOR CHANGE DATE
     C                     MOVELRUNYRS    WFDLDC
     C                     MOVE RUNDAY    WFDLDC
     C           RUNMON    LOKUPTABMTH    TABCOD         74
     C                     MOVE TABCOD    WFDLMC
     C           WFVALY    IFGE 72
     C                     MOVEL'19'      WFVAL8
     C                     ELSE
     C                     MOVEL'20'      WFVAL8
     C                     END
     C                     MOVE WFVAL8    CHGDAT
      *
      *  Treat Receive Instructions
     C           AMBSIN    IFEQ 'B'
     C                     MOVE 'N'       PMPRCV
     C                     MOVE 'Y'       PMPPAY
     C                     MOVELAMSETM    PMRSTM
      *  Setup our Nostro field
     C/COPY WNCPYSRC,FX0920C007
     C           PMRSTM    IFEQ 05
     C           BGMBIN    ANDEQ'Y'
     C/COPY WNCPYSRC,FX0920C008
     C                     MOVELAMONOB    PMROBR
     C                     END
     C                     MOVELAMOURN    PMRONS
      *  Receive Ordering Bank
     C                     MOVELAMOBNK    PMROBN
     C                     MOVELAMOBNK    PAROBN
      *  Receive Ordering Customer
     C                     MOVELAMORDC    PMROCN
     C                     MOVELAMORDC    PAROCN
      *
     C                     MOVELAMIBNK    PMRIBN
     C                     MOVELAMIBNK    PARIBN
     C                     MOVELAMIBNA    PMRIBA
     C/COPY WNCPYSRC,FX0920C009
      *                                                                N.
      *  Treat Pay instructions
     C                     ELSE
     C                     MOVE 'Y'       PMPRCV
     C                     MOVE 'N'       PMPPAY
     C                     MOVELAMSETM    PMPSTM
      *  Setup our Nostro field
     C/COPY WNCPYSRC,FX0920C010
     C           PMPSTM    IFEQ 05
     C           BGMBIN    ANDEQ'Y'
     C/COPY WNCPYSRC,FX0920C011
     C                     MOVELAMONOB    PMPOBR
     C                     END
     C                     MOVELAMOURN    PMPONS
      *  Pay Ordering Bank
     C                     MOVELAMOBNK    PMPOBN
     C                     MOVELAMOBNK    PAPOBN
      *  Pay Ordering Customer
     C                     MOVELAMORDC    PMPOCN
     C                     MOVELAMORDC    PAPOCN
      *
     C                     MOVELAMIBNK    PMPIBN
     C                     MOVELAMIBNK    PAPIBN
     C                     MOVELAMIBNA    PMPIBA
      *
     C                     MOVELAMRCRN    PMRCRN
     C                     MOVELAMRCRA    PMRCRA
      *
     C                     MOVELAMRVNO    PMRVNO
     C                     MOVELAMRVNO    PARVNO
      *  Account With Bank
     C                     MOVELAMAWBN    PMAWBN
     C                     MOVELAMAWBN    PAAWBN
     C                     MOVELAMAWBA    PMAWBA
      *  Beneficiary
     C                     MOVELAMBENN    PMBENN
     C                     MOVELAMBENN    PABENN
     C                     MOVELAMBENA    PMBENA
      *
     C                     MOVELAMDTP1    PMDTP1
     C                     MOVELAMDTP2    PMDTP2
     C                     MOVELAMDTP3    PMDTP3
     C                     MOVELAMDTP4    PMDTP4
      *
     C                     MOVELAMDCHG    PMDCHG
      *
     C                     MOVELAMBTB1    PMBTB1
     C                     MOVELAMBTB2    PMBTB2
     C                     MOVELAMBTB3    PMBTB3
     C                     MOVELAMBTB4    PMBTB4
     C                     MOVELAMBTB5    PMBTB5
     C                     MOVELAMBTB6    PMBTB6
      *
     C                     ENDIF
      *
     C                     Z-ADDAMVALD    PMDTRC
     C                     Z-ADDAMVALD    PMDTPY
     C                     MOVE AMCCYD    PMRCCY
     C                     MOVE AMCCYD    PMPCCY
     C                     MOVE 'N'       PMFFND
     C                     MOVE AMBRCA    PMBRCA
     C                     MOVE ACTION    PMACTC
      *
     C           ACTION    IFEQ 'E'
     C                     MOVE 'Y'       PMPPAY
     C                     MOVE 'Y'       PMPRCV
     C                     ENDIF
      *
     C                     MOVELWFCCY     @DLNO   6
     C                     MOVE WFSEQN    @DLNO
     C                     MOVELAMCVMR    PMCVMR
     C                     MOVEL'FXFX'    PMCPGM
     C                     MOVEL'FX'      PMTTYP
     C                     MOVELBBCSSN    PMCSNM
     C**********           MOVE *BLANKS   PMCMDP                          200138
     C                     MOVE 'N'       PMVALO
     C                     MOVE 'N'       PMSDTV
     C                     MOVE 'Y'       PMFRST
      *                                                                                     MD024498
     C                     ENDIF                                                            MD024498
      *                                                                                     MD024497
     C           *INKF     IFEQ *OFF                                                        MD024497
      *                                                                   200138
     C           SETERR    TAG                                            200138
      *                                                                   200138
     C                     MOVE *BLANKS   PMCMDP                          200138
     C                     MOVE *BLANKS   PMTERM
      *
     C                     CALL 'SD2400'
     C                     PARM           @PARM1  7
     C                     PARM           @PARM2
     C                     PARM           @PARM3
     C                     PARM           @DLNO
     C                     PARM           @PARM4                          200138
      *
      ** Terminate program if database error returned
     C           PMDBSE    IFNE *ZERO
      ** Data base error in file (SD2400).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD14        DBASE            ***************
     C                     MOVELPMDBFL    DBFILE           *DB ERROR 14  *
     C                     MOVELPMDBKY    DBKEY            ***************
     C                     MOVEL'PREVSR ' PREVSR  8
     C                     MOVE PMACTC    PREVSR
     C                     MOVE PREVSR    DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   200138
     C                     MOVEL*OFF      *IN20                           200138
     C           PMERCD    IFNE *BLANKS                                   200138
     C                     MOVEL'FXM1041' @MSGID                          200138
     C                     MOVEL*ON       *IN20                           200138
     C                     CALL 'ZA0240'                                  200138
     C                     PARM           @MSGID                          200138
     C                     ENDIF                                          200138
      *
      ** Check whether F12 has been used to redisplay the enquiry.
     C           PMCMDP    IFEQ '12'
     C                     MOVE 'Y'       REDSP
     C                     ELSE
     C                     MOVE 'N'       REDSP
     C                     ENDIF
      *                                                                                     MD044592
      ** Exit program when F3 is pressed from SD24000.                                      MD044592
      *                                                                                     MD044592
     C           PMCMDP    IFEQ '03'                                                        MD044592
     C                     MOVEL'1'       *INKC                                             MD044592
     C                     ENDIF                                                            MD044592
      *                                                                                     MD044592
     C                     ENDIF                                                            MD024497
     C*
     C/COPY WNCPYSRC,FX0920C012
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *                                                                   CDL025
     C           SPLIT     BEGSR                                          CDL025
      *                                                                   CDL025
      ** SETUP PARAMETERS FOR SPLITTING SETTLEMENT                        CDL025
     C                     MOVE ACTION    PACTN                           CDL025
     C                     MOVE DDNETR    PNETR                           CDL025
     C                     MOVE DDVDAT    P5VDAT                          CDL025
     C                     MOVE BGRTBN    PRTBN                           CDL025
     C                     MOVE DDCUST    P5CUST                          CDL025
     C                     MOVE BGCHIP    PCHIP                           CDL025
     C                     MOVE BMRANR    PRANR                           CDL025
     C                     MOVE BMACCD    PACCD                           CDL025
     C                     MOVE BBCSSN    PCSSN                           CDL025
     C                     MOVE BGMBIN    PMBIN                           CDL025
     C                     Z-ADDA6NBDP    PNBDP                           CDL025
     C                     Z-ADDAMDBUY    PDBUY                           CDL025
      *  SET DAYDATE IN YYYYMMDD FORMAT FOR CHANGE DATE                   CDL025
     C                     MOVELRUNYRS    WFDLDC                          CDL025
     C                     MOVE RUNDAY    WFDLDC                          CDL025
     C           RUNMON    LOKUPTABMTH    TABCOD         74               CDL025
     C                     MOVE TABCOD    WFDLMC                          CDL025
     C           WFVALY    IFGE 72                                        CDL025
     C                     MOVEL'19'      WFVAL8                          CDL025
     C                     ELSE                                           CDL025
     C                     MOVEL'20'      WFVAL8                          CDL025
     C                     END                                            CDL025
     C                     MOVE WFVAL8    CHGDAT                          CDL025
      *                                                                   CDL025
     C                     CALL 'FX0925'                                  CDL025
     C                     PARM           @PARM1  7                       CDL025
     C                     PARM           @PARM5                          CDL025
     C                     PARM           CHGDAT                          CDL025
      *                                                                   CDL025
      ** Check whether F12 has been used to redisplay the enquiry.        CDL025
     C********** @PARM1    IFEQ '03     '                                            CDL025 MD024498
     C           @PARM1    IFNE '03     '                                                   MD024498
     C           @PARM1    OREQ '06     '                                 CDL025
     C                     MOVE 'Y'       REDSP                           CDL025
     C                     MOVE '1'       *INKL                           CDL025
     C                     ELSE                                           CDL025
     C                     MOVE 'N'       REDSP                           CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C                     ENDSR                                          CDL025
      *                                                                   CDL025
      *****************************************************************   CDL025
      /EJECT                                                              CDL025
      *
     C           PROCSF    BEGSR
      *  Read selected records
     C                     MOVE '0'       *IN70
     C                     MOVE *OFF      *IN38
     C                     READCFX0920S1                 70
      ***Loop*until*all*selections*processed*or*F12*pressed************   126785
      *  Loop until all selections processed or F3 pressed                126785
     C           *IN70     DOWEQ'0'
     C           *INKC     ANDEQ'0'
     C************INKL     ANDEQ'0'                                       126785
      *
      *  Bypass if option is blank
     C           DDSEL     IFNE ' '
     C                     CALL 'ZA0250'
     C                     WRITE#MSGCTL
     C           DDSEL     SCAN 'EDVPA'   FOUND   10
     C           FOUND     IFEQ 0
     C                     MOVEL'FXM5047' @MSGID
     C                     MOVELSFOPT     @DATA
     C                     CALL 'ZA0440'
     C                     PARM           @MSGID 10
     C                     PARM           @DATA  45
     C                     WRITE#MSGCTL
     C                     Z-ADDS1RRN     ##SFRC
     C                     UPDATFX0920S1
     C                     LEAVE
     C                     ENDIF
      *  Validate action codes - Multiple and Single branch.
     C           BGMBIN    IFEQ 'Y'
     C                     CALL 'ZVACTBU'
     C                     PARM DDSEL     @ZACTN  1
     C                     PARM USRBCH    @ZBR    3
     C                     PARM           @ERR    10
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM DDSEL     @ZACTN
     C                     PARM           @ERR    10
     C                     ENDIF
      *
      * Action code invalid for user/branch combination
     C           @ERR      IFEQ 2
     C                     CALL 'ZA0240'
     C                     PARM 'FXM0291' @MSGID 10
     C                     ENDIF
      *
      * Action code invalid for user
     C           @ERR      IFEQ 1
     C                     CALL 'ZA0240'
     C                     PARM 'FXM0292' @MSGID
     C                     ENDIF
      *
     C           @ERR      IFEQ 0
     C                     CALL 'ZA0250'
      *  Clear message queue.
     C           DDSEL     CASEQ'P'       PRTDET
     C           DDSEL     CASEQ'E'       ENQIRE
     C           DDSEL     CASEQ'D'       DELETE
     C           DDSEL     CASEQ'A'       AMEND
     C           *INKN     CASEQ*ON       AMEND
     C                     ENDCS
     C           DDSEL     IFEQ 'V'
     C                     MOVE DDNETR    SNETR
     C                     EXSR VIEW
     C                     ENDIF
      *  End of selection
     C                     ENDIF
     C                     ENDIF
      ***Clear*Selection*field*if*F12*not*pressed**********************   126785
     C************INKL     IFEQ '0'                                       126785
      * CHECK FOR ERROR
     C************IN83     IFNE '1'                                       126785
     C***********@ERR      ANDEQ0                                         126785
     C                     MOVE ' '       DDSEL
     C***********          ELSE                                           126785
     C***********          WRITE#MSGCTL                                   126785
     C***********          ENDIF                                          126785
      **Ensure*Recall*if*F12*pressed***********************************   126785
     C***********          ELSE                                           126785
     C***********          MOVE '1'       *IN36                           126785
     C***********          ENDIF                                          126785
      *  Update S/File record if not F3
     C           *INKC     IFEQ '0'
      * PRESERVE DDSTUS
     C           DDSTUS    IFEQ *BLANKS
     C                     MOVE '1'       *IN65
     C                     ELSE
     C                     MOVE '0'       *IN65
     C                     ENDIF
     C                     Z-ADDS1RRN     ##SFRC
     C                     UPDATFX0920S1
     C                     MOVE '0'       *IN36
     C                     ENDIF
      *  Get next selection
     C                     READCFX0920S1                 70
     C                     MOVE *OFF      *INKL                           126785
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *  TERMINATE CONFIRMATION REQUEST
      *
     C           CNFTRM    BEGSR
      * DELETE IN PROGRESS RECORDS AND SET NET REFERENCE
      * TO CANCELLED STATUS
     C           AMNETR    CHAINFXNETMPD             84
     C           *IN84     IFEQ '1'
     C*
     C*     Set up Error Condition Fields
     C                     MOVEL##PGM     DBPGM
     C                     MOVELAMNETR    DBKEY
     C                     MOVE 'FXNETML1'DBFILE           * DB ERROR 01 *
     C                     Z-ADD1         DBASE
     C                     EXSR DBERR
     C*
     C                     END
     C                     MOVE 'E'       AMRECI
     C                     UPDATFXNETMD0               84
     C           *IN84     IFEQ '1'
     C*
     C*     Set up Error Condition Fields
     C                     MOVEL##PGM     DBPGM
     C                     MOVELAMNETR    DBKEY
     C                     MOVE 'FXNETML1'DBFILE           * DB ERROR 07 *
     C                     Z-ADD7         DBASE
     C*
     C                     EXSR DBERR
     C                     END
     C           AMNETR    SETLLFXNTIPL0
     C           AMNETR    READEFXNTIPL0                 82
     C           *IN82     DOWEQ'0'
     C                     DELETFXNTIPV0               84
     C           *IN84     IFEQ '1'
     C*
     C*     Set up Error Condition Fields
     C                     MOVEL##PGM     DBPGM
     C                     MOVELAMNETR    DBKEY
     C                     MOVE 'FXNTIPR 'DBFILE           * DB ERROR 08 *
     C                     Z-ADD8         DBASE
     C                     EXSR DBERR
     C*
     C                     END
     C           AMNETR    READEFXNTIPL0                 82
     C                     END
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *
     C           CNFUPD    BEGSR
      *
      *  PROCESS UPDATES FOR CONFIRMATION REQUEST
      *
     C           AMNETR    CHAINFXNETMPD             84
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD9         DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 09  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      * FIRST SET RECI TO 'F' TO FACILITATE RECOVERY IF FAILURE
     C                     MOVE 'F'       AMRECI
     C                     UPDATFXNETMD0               84
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETMPD).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD10        DBASE            ***************
     C                     MOVEL'FXNETMPD'DBFILE           *DB ERROR 10  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C*
      * USE NET IN PROGRESS FILE TO LOCATE DEAL RECORDS
     C           AMNETR    SETLLFXNTIPV0
     C           AMNETR    READEFXNTIPV0                 82
     C           *IN82     DOWEQ'0'
     C           ANDNUM    CHAINCAMIDNLL             84
     C           *IN84     IFEQ '1'
      ** Data base error in file (CAMIDNLL).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD12        DBASE            ***************
     C                     MOVEL'CAMIDNLL'DBFILE           *DB ERROR 12  *
     C                     MOVELANDNUM    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      ** Update DEALSDB.
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE 'A'       CHTP
     C           ANBSIN    IFEQ 'B'
     C                     MOVE AMNETR    NETBR
     C                     ELSE
     C                     MOVE AMNETR    NETSR
     C                     ENDIF
     C                     UPDATDEALSDBF
      *
     C           ANDNUM    CHAINFXDEALLL             84
     C           *IN84     IFEQ '1'
      ** Data base error in file (FXDEALLL).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD12        DBASE            ***************
     C                     MOVEL'FXDEALLL'DBFILE           *DB ERROR 12  *
     C                     MOVELANDNUM    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      ** Update FXDEALPP.
     C                     Z-ADDRUNDAY    FHDLUP
     C                     MOVE RUNMON    FHMLUP
     C                     Z-ADDRUNYRS    FHYLUP
     C                     MOVE 'A'       FHCHTP
     C                     TIME           FHTLUP
     C                     Z-ADDBJRDNB    FHLCD
     C                     MOVE SUSER     FHLUID
     C           ANBSIN    IFEQ 'B'
     C                     MOVE AMNETR    FHNBRF
     C                     ELSE
     C                     MOVE AMNETR    FHNSRF
     C                     ENDIF
     C                     UPDATFXDEALL0
      *                                                                                     MD021333
      ** Update RSACMTPD (Reverse individual projections)                                   MD021333
      *                                                                                     MD021333
     C                     EXSR RSCREV                                                      MD021333
      *                                                                         CDE003
      ** Data export for CCRM - Limits                                          CDE003
     C           CDE003    IFEQ 'Y'                                             CDE003
     C                     MOVELANDNUM    T#TREF                                CDE003
     C                     CALL DEWRT                                           CDE003
     C                     PARM           T#TREF 20                             CDE003
     C                     PARM 'FXDL'    T#TCAT  4                             CDE003
     C                     ENDIF                                                CDE003
      *
      * HAVING PROCESSED NET IN PROGRESS DELETE RECORD
     C                     DELETFXNTIPV0
     C           AMNETR    READEFXNTIPL0                 82
     C                     ENDDO
      *
      *  REACCESS FILE
     C           AMNETR    CHAINFXNETMPD             84
     C*
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETML1).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD11        DBASE            ***************
     C                     MOVEL'FXNETML1'DBFILE           *DB ERROR 11  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     EXSR UPDFLD
      *                                                                                     MD025229
     C           AMONOB    IFEQ '   '                                                       MD025229
     C           AMOURN    ANDNE*BLANKS                                                     MD025229
     C                     MOVE AMBRCA    AMONOB                                            MD025229
     C                     ENDIF                                                            MD025229
      *                                                                                     MD025229
      * SET RECI TO 'C' TO INDICATE SUCCESSFUL CONFIRMATION
     C                     MOVE 'C'       AMRECI
     C                     UPDATFXNETMD0               84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXNETML1).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD13        DBASE            ***************
     C                     MOVEL'FXNETML1'DBFILE           *DB ERROR 13  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C                     END
      *                                                                                     MD021333
      ** Check if Split of Net exists.  If there is, create projected                       MD021333
      ** movement for each split of the net (FXNETSPD).  Otherwise,                         MD021333
      ** create projected movement based from FXNETMPD details.                             MD021333
      *                                                                                     MD021333
     C           CDL025    IFEQ 'Y'                                                         MD021333
     C           AMNETR    SETLLFXNETSD0                                                    MD021333
     C           AMNETR    READEFXNETSD0            N    13                                 MD021333
     C                     ELSE                                                             MD021333
     C                     SETON                     13                                     MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C           *IN13     IFEQ *ON                                                         MD021333
     C                     EXSR RSCNET                                                      MD021333
     C                     ELSE                                                             MD021333
      *                                                                                     MD021333
     C           AMNETR    SETLLFXNETSD0                                                    MD021333
     C           AMNETR    READEFXNETSD0            N    14                                 MD021333
      *                                                                                     MD021333
     C           *IN14     DOWEQ'0'                                                         MD021333
     C                     EXSR RSPLIT                                                      MD021333
     C           AMNETR    READEFXNETSD0            N    14                                 MD021333
     C                     ENDDO                                                            MD021333
      *                                                                                     MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     MOVEL'CONFIRM 'PLRTRN
      *  Comit File Updates
     C                     MOVE 'FX'      MDID             Module
     C                     MOVEL'FX0920'  PGMN             Programme Name
     C                     MOVE SWSID     CMTWS            Workstation Id
     C                     MOVE SUSER     CMTUSR           User Id
     C                     TIME           CMTTIM           Time
     C           CMTTXT    COMIT                           Commit updates
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *
     C           UPDFLD    BEGSR
      *  MOVE SCREEN FIELDS TO FILE FIELDS FOR UPDATE
      *
      *  Treat Receive Instructions
     C           AMBSIN    IFEQ 'B'
     C                     MOVELPMRSTM    AMSETM
      *  Setup our Nostro field
     C           BGMBIN    IFEQ 'Y'
     C                     MOVELPMROBR    AMONOB
     C                     ENDIF
     C                     MOVELPMRONS    AMOURN
      *  Receive Ordering Bank
     C                     MOVELPAROBN    AMOBNK
      *  Receive Ordering Customer
     C                     MOVELPAROCN    AMORDC
      *
     C                     MOVELPARIBN    AMIBNK
     C                     MOVELPMRIBA    AMIBNA
     C                     MOVEL*BLANKS   AMCVMR
     C/COPY WNCPYSRC,FX0920C013
      *
      *  Treat Pay instructions
     C                     ELSE
     C                     MOVELPMPSTM    AMSETM
      *  Setup our Nostro field
     C           BGMBIN    IFEQ 'Y'
     C                     MOVELPMPOBR    AMONOB
     C                     ENDIF
     C                     MOVELPMPONS    AMOURN
      *  Pay Ordering Bank
     C                     MOVELPAPOBN    AMOBNK
      *  Pay Ordering Customer
     C                     MOVELPAPOCN    AMORDC
      *
     C                     MOVELPAPIBN    AMIBNK
     C                     MOVELPMPIBA    AMIBNA
      *
     C                     MOVELPARCRN    AMRCRN
     C                     MOVELPMRCRA    AMRCRA
      *
     C                     MOVELPARVNO    AMRVNO
     C                     MOVE PMCVMR    AMCVMR                          E22405
      *  Account With Bank
     C                     MOVELPAAWBN    AMAWBN
     C                     MOVELPMAWBA    AMAWBA
      *  Beneficiary
     C                     MOVELPABENN    AMBENN
     C                     MOVELPMBENA    AMBENA
      *
     C                     MOVELPMDTP1    AMDTP1
     C                     MOVELPMDTP2    AMDTP2
     C                     MOVELPMDTP3    AMDTP3
     C                     MOVELPMDTP4    AMDTP4
      *
     C                     MOVELPMDCHG    AMDCHG
      *
     C                     MOVELPMBTB1    AMBTB1
     C                     MOVELPMBTB2    AMBTB2
     C                     MOVELPMBTB3    AMBTB3
     C                     MOVELPMBTB4    AMBTB4
     C                     MOVELPMBTB5    AMBTB5
     C                     MOVELPMBTB6    AMBTB6
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      **************************************************************************
      /EJECT
      **************************************************************************
      *
     C           UPDLFX    BEGSR
      *
      ** If deal is live - update DEALSDB and FXDEALLL.
     C           RECI      IFEQ 'D'
     C                     MOVELBJRDNB    LCD
     C                     MOVE 'A'       CHTP
      *
     C                     SELEC
     C           BSNREF    WHEQ 'B'
     C                     MOVE *BLANKS   NETBR
     C                     UPDATDLBUYNRF               84
     C           BSNREF    WHEQ 'S'
     C                     MOVE *BLANKS   NETSR
     C                     UPDATDLSELNRF               84
     C                     ENDSL
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (DEALSDB).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD27        DBASE            ***************
     C                     MOVEL'FXNETML1'DBFILE           *DB ERROR 27  *
     C                     MOVELAMNETR    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           DLNO      CHAINFXDEALLL             84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXDEALLL).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD28        DBASE            ***************
     C                     MOVEL'FXDEALLL'DBFILE           *DB ERROR 28  *
     C                     MOVELDLNO      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     SELEC
     C           BSNREF    WHEQ 'B'
     C                     MOVE *BLANKS   FHNBRF
     C           BSNREF    WHEQ 'S'
     C                     MOVE *BLANKS   FHNSRF
     C                     ENDSL
      *
     C                     Z-ADDRUNDAY    FHDLUP
     C                     MOVELRUNMON    FHMLUP
     C                     Z-ADDRUNYRS    FHYLUP
     C                     MOVE 'A'       FHCHTP
     C                     TIME           FHTLUP
     C                     Z-ADDBJRDNB    FHLCD
     C                     MOVELSUSER     FHLUID
      *
     C                     UPDATFXDEALL0               84
      *
     C           *IN84     IFEQ *ON
      ** Data base error in file (FXDEALLL).
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD29        DBASE            ***************
     C                     MOVEL'FXDEALLL'DBFILE           *DB ERROR 29  *
     C                     MOVELDLNO      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWTCH - Initiates the Midas Compliance Engine.               *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details Parameter                                         CSD015
      ** ============================================                                         CSD015
      *                                                                                       CSD015
     C                     CLEARSDWLTO                                                        CSD015
      *                                                                                       CSD015
      ** Item Type, Identifier, and Branch information.                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'FXNET'   W4ITEM                                              CSD015
     C                     MOVELAMNETR    W4IDEN                                              CSD015
     C                     MOVELAMBRCA    W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** Select the System Prefix.                                                            CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'FXNETMPD'W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Get the Counterparty Detail.                                                         CSD015
      *                                                                                       CSD015
     C                     EXSR SRGTCD                                                        CSD015
     C                     MOVELAMCNUM    W4CNUM                                              CSD015
     C                     MOVELWCTYP     W4CTYP                                              CSD015
     C                     MOVELWCRPT     W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Get the Value Date.                                                                  CSD015
      *                                                                                       CSD015
     C                     Z-ADDAMVALD    W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Currency and Amount information.                                                     CSD015
      *                                                                                       CSD015
     C                     MOVELAMCCYD    W4DEN1                                              CSD015
     C                     Z-ADDAMDBUY    W4AMT1                                              CSD015
      *                                                                                       CSD015
      ** Build the Free Format String                                                         CSD015
      ** ============================                                                         CSD015
      *                                                                                       CSD015
      ** Initialise additional standing data.                                                 CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WSD                                                 CSD015
     C                     MOVELAMIBNA    WSD,2                                               CSD015
     C                     MOVELAMRCRA    WSD,5                                               CSD015
     C                     MOVELAMAWBA    WSD,7                                               CSD015
     C                     MOVELAMBENA    WSD,8                                               CSD015
      *                                                                                       CSD015
      ** Begin string and packet assembly.                                                    CSD015
      *                                                                                       CSD015
     C                     Z-ADD1         N       20                                          CSD015
     C                     MOVE *BLANKS   PFFS                                                CSD015
     C                     MOVE *BLANKS   WXPCKT                                              CSD015
     C                     MOVE *BLANKS   WDATA                                               CSD015
      *                                                                                       CSD015
     C           N         DOUEQARRMAX                                                        CSD015
      *                                                                                       CSD015
     C           WLF,N     IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** Set the currency for the nostro field.                                               CSD015
      *                                                                                       CSD015
     C           N         IFEQ 1                                                             CSD015
     C                     MOVE AMCCYD    WCCY                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Call the detail retriever program.                                                   CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM           WLF,N                                               CSD015
     C                     PARM *BLANKS   PINPA  35                                           CSD015
     C                     PARM *BLANKS   PINPB  35                                           CSD015
     C                     PARM *BLANKS   PINPC  35                                           CSD015
     C                     PARM *BLANKS   PINPD  35                                           CSD015
     C                     PARM *BLANKS   PINPE  35                                           CSD015
     C                     PARM           WCCY    3                                           CSD015
     C                     PARM           WDATA 216                                           CSD015
     C                     PARM           POUTA   6                                           CSD015
      *                                                                                       CSD015
     C           '0 '      CHECKWDATA     WPOS    40                                          CSD015
      *                                                                                       CSD015
     C           WDATA     IFNE *BLANKS                                                       CSD015
     C           WRTCD     ANDEQ*BLANKS                                                       CSD015
     C           WPOS      ANDNE0                                                             CSD015
     C                     CAT  XOT,N:0   WXPCKT                                              CSD015
     C                     CAT  WDATA:0   WXPCKT                                              CSD015
     C                     CAT  WSD,N:1   WXPCKT                                              CSD015
     C                     CAT  XCT,N:0   WXPCKT                                              CSD015
     C                     CAT  WXPCKT:0  PFFS                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WXPCKT                                              CSD015
     C                     MOVE *BLANKS   WDATA                                               CSD015
     C                     MOVE *BLANKS   WCCY                                                CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         N                                                   CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           AMDTP1    IFNE *BLANKS                                                       CSD015
     C           AMDTP2    ORNE *BLANKS                                                       CSD015
     C           AMDTP3    ORNE *BLANKS                                                       CSD015
     C           AMDTP4    ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     CAT  XOT,N:0   WXPCKT                                              CSD015
     C                     CAT  AMDTP1:0  WXPCKT                                              CSD015
     C                     CAT  AMDTP2:1  WXPCKT                                              CSD015
     C                     CAT  AMDTP3:1  WXPCKT                                              CSD015
     C                     CAT  AMDTP4:1  WXPCKT                                              CSD015
     C                     CAT  XCT,N:0   WXPCKT                                              CSD015
     C                     CAT  WXPCKT:0  PFFS                                                CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check for compliance.                                                                CSD015
      *                                                                                       CSD015
     C           PFFS      IFNE *BLANKS                                                       CSD015
     C                     CALL CEPGM                                                         CSD015
     C                     PARM           SDWLTO                                              CSD015
     C                     PARM           PFFS                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRCMPC - Handles the entire compliance checking activities.   *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRCMPC    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
      ** Execute a direct compliance check on insert operations.                              CSD015
      *                                                                                       CSD015
     C           WCMPM     WHEQ ONINS                                                         CSD015
      *                                                                                       CSD015
     C                     MOVE ALL       WMOVM   1                                           CSD015
     C                     EXSR SRDB2W                                                        CSD015
     C                     EXSR SRWLFC                                                        CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If the action associated with the current record is Amend,                           CSD015
      ** check first if this record has been analysed by the CE.                              CSD015
      *                                                                                       CSD015
     C           WCMPM     WHEQ ONAMD                                                         CSD015
      *                                                                                       CSD015
     C                     EXSR SRRETC                                                        CSD015
      *                                                                                       CSD015
     C           WRFLG     IFEQ 'Y'                                                           CSD015
     C                     MOVE ALL       WMOVM                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE CHANGD    WMOVM                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     EXSR SRDB2W                                                        CSD015
     C                     EXSR SRWLFC                                                        CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'Y'                                                           CSD015
     C           WCHFLG    ANDEQ'Y'                                                           CSD015
     C           WRFLG     OREQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRDB2W - Moves relevant database fields to their respective   *                       CSD015
      *          Watch List Fields.                                   *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRDB2W    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Watch List Fields array to blanks.                                    CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF                                                 CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
      ** Execute an unconditional move if necessary.                                          CSD015
      *                                                                                       CSD015
     C           WMOVM     WHEQ ALL                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELAMOURN    WLF,1                                               CSD015
     C                     MOVELAMIBNK    WLF,2                                               CSD015
     C                     MOVELAMOBNK    WLF,3                                               CSD015
     C                     MOVELAMORDC    WLF,4                                               CSD015
     C                     MOVELAMRCRN    WLF,5                                               CSD015
     C                     MOVELAMRVNO    WLF,6                                               CSD015
     C                     MOVELAMAWBN    WLF,7                                               CSD015
     C                     MOVELAMBENN    WLF,8                                               CSD015
      *                                                                                       CSD015
     C           WMOVM     WHEQ CHANGD                                                        CSD015
      *                                                                                       CSD015
      ** Move only the fields that have changed since the last save.                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WCHFLG  1                                           CSD015
      *                                                                                       CSD015
     C           AMOURN    IFNE BCOURN                                                        CSD015
     C                     MOVELAMOURN    WLF,1                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMIBNK    IFNE BCIBNK                                                        CSD015
     C                     MOVELAMIBNK    WLF,2                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMOBNK    IFNE BCOBNK                                                        CSD015
     C                     MOVELAMOBNK    WLF,3                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMORDC    IFNE BCORDC                                                        CSD015
     C                     MOVELAMORDC    WLF,4                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMRCRN    IFNE BCRCRN                                                        CSD015
     C                     MOVELAMRCRN    WLF,5                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMRVNO    IFNE BCRVNO                                                        CSD015
     C                     MOVELAMRVNO    WLF,6                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMAWBN    IFNE BCAWBN                                                        CSD015
     C                     MOVELAMAWBN    WLF,7                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMBENN    IFNE BCBENN                                                        CSD015
     C                     MOVELAMBENN    WLF,8                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           AMDTP1    IFNE BCDTP1                                                        CSD015
     C           AMDTP2    ORNE BCDTP2                                                        CSD015
     C           AMDTP3    ORNE BCDTP3                                                        CSD015
     C           AMDTP4    ORNE BCDTP4                                                        CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWLFC - Checks if there is something useful to return to     *                       CSD015
      *          to the Compliance Engine.                            *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWLFC    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check the Watch List Fields array.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WOKFLG  1                                           CSD015
     C                     Z-ADD1         N                                                   CSD015
      *                                                                                       CSD015
     C           N         DOUEQARRMAX                                                        CSD015
     C           WLF,N     IFNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WOKFLG                                              CSD015
     C                     LEAVE                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ADD  1         N                                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Check the Payment Details.                                                           CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'N'                                                           CSD015
     C           AMDTP1    IFNE *BLANKS                                                       CSD015
     C           AMDTP2    ORNE *BLANKS                                                       CSD015
     C           AMDTP3    ORNE *BLANKS                                                       CSD015
     C           AMDTP4    ORNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WOKFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRRETC - Checks if the current record is unconfirmed by the   *                       CSD015
      *          the Compliance Engine.                               *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRRETC    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WRFLG   1                                           CSD015
     C                     MOVE *IN60     WINDF   1                                           CSD015
     C                     MOVE *BLANKS   KFUNT                                               CSD015
     C                     MOVE *BLANKS   KIDEN                                               CSD015
     C                     MOVE *BLANKS   KBRCH                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'FXNETMPD'KFUNT                                               CSD015
     C                     MOVELAMNETR    KIDEN                                               CSD015
     C                     MOVELAMBRCA    KBRCH                                               CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             60                                       CSD015
      *                                                                                       CSD015
     C           *IN60     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C                     MOVE 'Y'       WRFLG                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE WINDF     *IN60                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRGTCD - Gets the Counterparty Details given a Customer       *                       CSD015
      *          Number.                                              *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRGTCD    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the relevant variables.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PCUST  10                                           CSD015
     C                     MOVE *BLANKS   WCRPT  30                                           CSD015
     C                     MOVE *BLANKS   WCTYP   1                                           CSD015
     C                     MOVELAMCNUM    PCUST                                               CSD015
      *                                                                                       CSD015
      ** Get the Customer Detail.                                                             CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*KEY   ' WOPTN                                               CSD015
     C                     PARM           PCUST                                               CSD015
     C                     PARM *BLANKS   PERROR  7                                           CSD015
     C           SDCUST    PARM SDCUST    SDSSDY                                              CSD015
      *                                                                                       CSD015
     C           WRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** Assemble the Counterparty Report information.                                        CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    WCRPT                                               CSD015
      *                                                                                       CSD015
      ** Determine the Counterparty Type.                                                     CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Handle Database Errors if any occur.                                                 CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE '*NRF'                                                        CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVELWOPTN     DBKEY                                               CSD015
     C                     MOVEL'SDCUSTPD'DBFILE                                              CSD015
     C                     Z-ADD36        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C           RSCREV    BEGSR                                                            MD021333
      *****************************************************************                     MD021333
      *                                                                                     MD021333
     C                     MOVELDLNO      @TNMR                                             MD021333
     C                     MOVELAMCCYD    @CCYD                                             MD021333
      *                                                                                     MD021333
     C********** RSACKY    CHAINRSACMTLF             11                            MD021333 MD036826
      *                                                                                     MD036826
      ** Read through RSACMTPD file until correct projection for the                        MD036826
      ** deal is determined.                                                                MD036826
      *                                                                                     MD036826
     C                     MOVE 'N'       EXTFLG  1                                         MD036826
     C           RSACKY    SETLLRSACMTLF                                                    MD036826
     C           RSACKY    READERSACMTLF                 11                                 MD036826
      *                                                                                     MD021333
     C********** *IN11     IFEQ *OFF                                               MD021333 MD036826
     C           *IN11     DOWEQ*OFF                                                        MD036826
     C           EXTFLG    ANDEQ'N'                                                         MD036826
      *                                                                                     MD036826
     C           DTYP      IFEQ TRYP                                                        MD036826
      *                                                                                     MD021333
      ** Reverse the Debit/Credit Indicator                                                 MD021333
      *                                                                                     MD021333
     C           DORC      IFEQ 1                                                           MD021333
     C                     Z-ADD0         DORC                                              MD021333
     C                     ELSE                                                             MD021333
     C                     Z-ADD1         DORC                                              MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
      ** Make Posting Date = Rundate                                                        MD021333
      *                                                                                     MD021333
     C                     Z-ADDBJRDNB    PTDT                                              MD021333
      *                                                                                     MD021333
      ** Put Net Reference in Other Reference field (OTR1)                                  MD021333
      *                                                                                     MD021333
     C                     MOVELAMNETR    OTR1                                              MD021333
      *                                                                                     MD021333
      ** Write RSACMTPD reversal record.                                                    MD021333
      *                                                                                     MD021333
     C                     WRITEQACMTLF                                                     MD021333
      *                                                                                     MD021333
      ** Update MEMOS, PRONO, OLPOS                                                         MD041420
      *                                                                                     MD041420
     C                     EXSR UPDMEM                                                      MD041420
     C                     EXSR UPDPRN                                                      MD041420
     C                     EXSR UPDOLP                                                      MD041420
      ** Move 'Y' to exit flag variable.                                                    MD036826
      *                                                                                     MD036826
     C                     MOVE 'Y'       EXTFLG                                            MD036826
      *                                                                                     MD036826
     C                     ENDIF                                                            MD021333
      *                                                                                     MD036826
      ** Read next available record.                                                        MD036826
      *                                                                                     MD036826
     C           RSACKY    READERSACMTLF                 11                                 MD036826
     C                     ENDDO                                                            MD036826
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      *****************************************************************                     MD021333
     C           RSCNET    BEGSR                                                            MD021333
      *****************************************************************                     MD021333
      *                                                                                     MD021333
     C                     MOVEL'NT'      TRYP                                              MD021333
     C                     MOVELAMNETR    NRTD                                              MD021333
     C                     MOVEL'000000'  TNMR                                              MD021333
     C                     Z-ADDAMDBUY    MVAM                                              MD021333
     C                     MOVELAMNETR    OTR1                                              MD021333
     C                     Z-ADDBJRDNB    PTDT                                              MD021333
     C                     Z-ADDAMVALD    VUDT                                              MD021333
      *                                                                                     MD021333
     C                     MOVELAMCCYD    ##CCY   3                                         MD021333
      *                                                                                     MD021333
      ** Use settlement details from FXNETMPD.  If blank, use                               MD021333
      ** FX Netting Account Code and default sequence number in                             MD021333
      ** combination with the customer, currency and branch.                                MD021333
      *                                                                                     MD021333
     C                     MOVELAMSETM    ##RECM                                            MD021333
     C                     MOVELAMOURN    ##RECA                                            MD021333
     C                     MOVELAMONOB    ##RECB                                            MD021333
     C                     MOVEL##RECD    ##SETD                                            MD021333
      *                                                                                     MD021333
     C           AMBSIN    IFEQ 'B'                                                         MD021333
     C                     Z-ADD0         DORC                                              MD021333
     C                     ELSE                                                             MD021333
     C                     Z-ADD1         DORC                                              MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     MOVEL'N'       SPLTST  1                                         MD021333
      *                                                                                     MD021333
     C                     EXSR SRSETD                                                      MD021333
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      *****************************************************************                     MD021333
     C           RSPLIT    BEGSR                                                            MD021333
      *****************************************************************                     MD021333
      *                                                                                     MD021333
     C                     MOVEL'NT'      TRYP                                              MD021333
     C                     MOVELASNETR    NRTD                                              MD021333
     C                     MOVEL'000000'  TNMR                                              MD021333
     C                     Z-ADDASDBUY    MVAM                                              MD021333
     C                     MOVELASNETR    OTR1                                              MD021333
     C                     Z-ADDBJRDNB    PTDT                                              MD021333
     C                     Z-ADDASVALD    VUDT                                              MD021333
      *                                                                                     MD021333
     C                     MOVELASCCYD    ##CCY                                             MD021333
      *                                                                                     MD021333
      ** Move fields Currency, Customer and Sequence # to retrieve                          MD021333
      ** settlement details.                                                                MD021333
      *                                                                                     MD021333
     C                     MOVELASCCYD    @FCCY                                             MD021333
     C                     MOVELASCNUM    @FCST                                             MD021333
     C                     MOVE ASSQNO    @FSQN                                             MD021333
      *                                                                                     MD021333
     C           RSFNMS    CHAINSDFNMSL0             15                                     MD021333
      *                                                                                     MD021333
     C           *IN15     IFEQ *OFF                                                        MD021333
      *                                                                                     MD021333
     C                     MOVELLRSTY     ##RECM                                            MD021333
     C                     MOVELLRONO     ##RECA                                            MD021333
     C                     MOVELLORBR     ##RECB                                            MD021333
      *                                                                                     MD021333
     C                     MOVELLPSTY     ##PAYM                                            MD021333
     C                     MOVELLPONO     ##PAYA                                            MD021333
     C                     MOVELLOPBR     ##PAYB                                            MD021333
      *                                                                                     MD021333
      ** If Buy, use Receive Settlement Details                                             MD021333
      ** Else (if Sell) use Pay Settlement Details                                          MD021333
      *                                                                                     MD021333
     C           ASBSIN    IFEQ 'B'                                                         MD021333
     C                     Z-ADD0         DORC                                              MD021333
     C                     MOVEL##RECD    ##SETD                                            MD021333
     C                     MOVEL'D'       C#RTYP                                            MD021333
     C                     ELSE                                                             MD021333
     C                     Z-ADD1         DORC                                              MD021333
     C                     MOVEL##PAYD    ##SETD                                            MD021333
     C                     MOVEL'C'       C#RTYP                                            MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     MOVEL'Y'       SPLTST                                            MD021333
      *                                                                                     MD021333
     C                     EXSR SRSETD                                                      MD021333
      *                                                                                     MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     MOVEL'N'       SPLTST  1                                         MD021333
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      /EJECT                                                                                MD021333
      *****************************************************************                     MD021333
     C           RSCDEL    BEGSR                                                            MD021333
      *****************************************************************                     MD021333
      *                                                                                     MD021333
      *                                                                                     MD021333
     C                     MOVELAMNETR    AMNET  20                                         MD021333
      *                                                                                     MD021333
     C           AMNET     SETLLRSACMTLG                                                    MD021333
     C           AMNET     READERSACMTLG            N    12                                 MD021333
     C           *IN12     DOWEQ'0'                                                         MD021333
      *                                                                                     MD021333
      ** Reverse the Debit/Credit Indicator                                                 MD021333
      *                                                                                     MD021333
     C           DORC      IFEQ 1                                                           MD021333
     C                     Z-ADD0         DORC                                              MD021333
     C                     ELSE                                                             MD021333
     C                     Z-ADD1         DORC                                              MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
      ** Make Posting Date = Rundate                                                        MD021333
      *                                                                                     MD021333
     C                     Z-ADDBJRDNB    PTDT                                              MD021333
      *                                                                                     MD021333
      ** Put Net reference in Other Reference field (OTR1)                                  MD021333
      ** Append 'R' and '*' to signify reversal.                                            MD021333
      *                                                                                     MD021333
     C           TNMR      IFEQ '000000'                                                    MD021333
     C                     MOVELAMNETR    OTR1                                              MD021333
     C                     MOVE 'R'       OTR1                                              MD021333
     C                     MOVE '*'       NRTD                                              MD021333
     C                     ELSE                                                             MD021333
     C                     MOVE *BLANKS   OTR1                                              MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     WRITEQACMTLG                                                     MD021333
      *                                                                                     MD041420
      ** Update MEMOS, PRONO, OLPOS                                                         MD041420
      *                                                                                     MD041420
     C                     EXSR UPDMEM                                                      MD041420
     C                     EXSR UPDPRN                                                      MD041420
     C                     EXSR UPDOLP                                                      MD041420
      *                                                                                     MD021333
     C           AMNET     READERSACMTLG            N    12                                 MD021333
      *                                                                                     MD021333
     C                     ENDDO                                                            MD021333
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      *****************************************************************                     MD021333
      /EJECT                                                                                MD021333
      *****************************************************************                     MD021333
     C           SRSETD    BEGSR                                                            MD021333
      *****************************************************************                     MD021333
      *                                                                                     MD021333
     C           ##SETM    IFEQ '01'                                                        MD021333
     C           ##SETM    OREQ '02'                                                        MD021333
     C           ##SETM    OREQ '07'                                                        MD021333
     C           ##SETM    OREQ '08'                                                        MD021333
     C           ##SETM    OREQ '12'                                                        MD021333
     C                     MOVEL'N'       C#ATYP                                            MD021333
     C                     MOVEL##NOSN    C#NOSN                                            MD021333
     C                     ELSE                                                             MD021333
     C           ##SETM    IFEQ '14'                                                        MD021333
     C                     MOVEL'R'       C#ATYP                                            MD021333
     C                     MOVEL##ACNO    C#ACNO                                            MD021333
     C                     ELSE                                                             MD021333
     C           ##SETM    IFEQ '04'                                                        MD021333
     C           ##SETM    OREQ '05'                                                        MD021333
     C                     MOVEL'P'       C#ATYP                                            MD021333
     C                     MOVEL##CNUM    C#CNUM                                            MD021333
     C                     MOVEL##ACOD    C#ACOD                                            MD021333
     C                     MOVEL##ACSQ    C#ACSQ                                            MD021333
     C                     MOVEL##BRCA    C#BRCA                                            MD021333
     C                     ENDIF                                                            MD021333
     C                     ENDIF                                                            MD021333
     C                     ENDIF                                                            MD021333
      * Currency of transaction                                                             MD021333
     C                     MOVEL##CCY     C#CCY   3                                         MD021333
     C                     MOVE 'Y'       C#RSAC                                            MD021333
      *                                                                                     MD021333
     C           C#ATYP    IFEQ *BLANK                                                      MD021333
      *                                                                                     MD021333
      ** Set account type indicator to signify no settlement                                MD021333
      *                                                                                     MD021333
     C                     MOVEL'X'       C#ATYP                                            MD021333
      *                                                                                     MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
      ** Check if account is open.                                                          MD021333
      *                                                                                     MD021333
     C           C#ATYP    IFNE 'X'                                                         MD021333
     C                     EXSR CHKACT                                                      MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
      ** If account posting and account is open.                                            MD021333
      *                                                                                     MD021333
     C           C#ATYP    IFNE 'X'                                                         MD021333
     C           NRECI     ANDEQ'D'                                                         MD021333
      *                                                                                     MD021333
     C                     MOVELCNUM      CUSN                                              MD021333
     C                     MOVELNCCY      CCYD                                              MD021333
     C                     MOVELACSQ      ASNC                                              MD021333
     C                     MOVELNBRCA     BRCA                                              MD021333
     C                     MOVELACOD      ACDE                                              MD021333
      *                                                                                     MD021333
     C                     WRITEQACMTLF                                                     MD021333
     C                     EXSR UPDMEM                                                     MD041420A
     C                     EXSR UPDPRN                                                     MD041420A
     C                     EXSR UPDOLP                                                     MD041420A
      *                                                                                    MD023887A
      ** Get Branch Internal Customer                                                      MD023887A
      *                                                                                    MD023887A
     C                     CALL 'AOBRCHR1'                                                 MD023887A
     C                     PARM *BLANKS   @RTCD                                            MD023887A
     C                     PARM '*KEY   ' @OPTN                                            MD023887A
     C                     PARM AMBRCA    @BRCA   3                                        MD023887A
     C           SDBRCH    PARM SDBRCH    SDSSDY                                           MD023887A
      *                                                                                    MD023887A
     C           @RTCD     IFNE *BLANK                                                     MD023887A
     C                     Z-ADD5         DBASE            ***************                 MD023887A
     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 05 *                 MD023887A
     C                     MOVELNBRCA     DBKEY            ***************                 MD023887A
     C                     OUT  LDA                                                        MD023887A
     C                     EXSR *PSSR                                                      MD023887A
     C                     ELSE                                                            MD023887A
      *                                                                                    MD023887A
      ** Write to Netting Account                                                          MD023887A
      *                                                                                    MD023887A
     C                     MOVELA8BICN    CUSN                                             MD023887A
     C                     MOVELAMCCYD    CCYD                                             MD023887A
     C                     MOVEL'01'      ASNC                                             MD023887A
     C                     MOVELAMBRCA    BRCA                                             MD023887A
     C                     MOVELBNNEAC    ACDE                                             MD023887A
      *                                                                                    MD023887A
     C                     WRITEQACMTLF                                                    MD023887A
     C                     EXSR UPDMEM                                                     MD041420A
     C                     EXSR UPDPRN                                                     MD041420A
     C                     EXSR UPDOLP                                                     MD041420A
      *                                                                                    MD023887A
     C                     ENDIF                                                           MD023887A
      *                                                                                     MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      *****************************************************************                     MD021333
      * Subroutine  :  CHKACT                                         *                     MD021333
      * Function    :  To check for live account before calling       *                     MD021333
      *                AOSPOSU0                                       *                     MD021333
      *                                                               *                     MD021333
      * Called by   :  Various subroutines                            *                     MD021333
      * Calls       :  None                                           *                     MD021333
      *****************************************************************                     MD021333
     C           CHKACT    BEGSR                                                            MD021333
     C           C#ATYP    IFEQ 'N'                                                         MD021333
     C           C#ATYP    OREQ 'F'                                                         MD021333
     C                     CALL 'AONOSTR0'                                                  MD021333
     C                     PARM '*DBERR  '@RTCD   7                                         MD021333
     C                     PARM '*KEY    '@OPTN   7                                         MD021333
     C                     PARM *BLANKS   @KEYA   6                                         MD021333
     C                     PARM C#CCY     @KEYB   3                                         MD021333
     C                     PARM *BLANKS   @KEYC  10                                         MD021333
     C                     PARM *BLANKS   @KEYD   2                                         MD021333
     C                     PARM ##NOSN    @KEYE   2                                         MD021333
     C                     PARM *BLANKS   @KEYF   3                                         MD021333
     C                     PARM *BLANKS   @KEYG  10                                         MD021333
     C                     PARM *BLANKS   @KEYH   1                                         MD021333
     C           SDNOST    PARM SDNOST    DSFDY                                             MD021333
      *                                                                                     MD021333
      ** Move account details                                                               MD021333
      *                                                                                     MD021333
     C                     MOVE A7CYCD    D#CCY   3                                         MD021333
     C                     MOVE A7ACCD    D#ACOD 10                                         MD021333
     C                     MOVE A7CUST    D#CNUM  6                                         MD021333
     C                     MOVE A7ACSN    D#ACSQ                                            MD021333
     C                     MOVE A7BRCD    D#BRCA  3                                         MD021333
     C                     MOVE A7CYCD    NCCY                                              MD023887
     C                     MOVE A7ACCD    ACOD                                              MD023887
     C                     MOVE A7CUST    CNUM                                              MD023887
     C                     MOVE A7ACSN    ACSQ                                              MD023887
     C                     MOVE A7BRCD    NBRCA                                             MD023887
      *                                                                                     MD023887
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C           C#ATYP    IFEQ 'R'                                                         MD021333
     C                     MOVE C#ACNO    D#RTL  10                                         MD021333
     C                     MOVE *BLANKS   D#CCY                                             MD021333
     C                     MOVE *BLANKS   D#ACOD                                            MD021333
     C                     MOVE *BLANKS   D#CNUM                                            MD021333
     C                     MOVE *BLANKS   D#ACSQ                                            MD021333
     C                     MOVE *BLANKS   D#BRCA                                            MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
     C           C#ATYP    IFNE 'N'                                                         MD021333
     C           C#ATYP    ANDNE'F'                                                         MD021333
     C           C#ATYP    ANDNE'R'                                                         MD021333
     C                     MOVE *BLANKS   D#RTL                                             MD021333
     C                     MOVE C#CCY     D#CCY                                             MD021333
     C                     MOVE ##ACOD    D#ACOD                                            MD021333
     C                     MOVE ##CNUM    D#CNUM                                            MD021333
     C                     MOVE ##ACSQ    D#ACSQ                                            MD021333
     C                     MOVE ##BRCA    D#BRCA                                            MD021333
     C                     ENDIF                                                            MD021333
      *                                                                                     MD021333
      ** Calls AOACCTR0 to check for live account                                           MD021333
      *                                                                                     MD021333
     C                     MOVE *BLANKS   NRECI                                             MD021333
     C                     CALL 'AOACCTR0'                                                  MD021333
     C                     PARM *BLANKS   @RTCD   7                                         MD021333
     C                     PARM '*KEY   ' @OPTN   7                                         MD021333
     C                     PARM D#RTL     @RETL  10                                         MD021333
     C                     PARM D#CNUM    @CNUM   6                                         MD021333
     C                     PARM D#CCY     @CYCD   3                                         MD021333
     C                     PARM D#ACOD    @ACCD  10                                         MD021333
     C                     PARM D#ACSQ    @ACSN   2                                         MD021333
     C                     PARM D#BRCA    @DSNB   3                                         MD021333
     C           SDACNT    PARM SDACNT    SDSSDY                                            MD021333
      *                                                                                     MD021333
     C                     ENDSR                                                            MD021333
      *                                                                                     MD021333
      /EJECT                                                                                MD041420
      *****************************************************************                     MD041420
      * Subroutine  :  UPDMEM                                         *                     MD041420
      * Function    :  Update MEMOS                                   *                     MD041420
      *                                                               *                     MD041420
      * Called by   :                                                 *                     MD041420
      * Calls       :  None                                           *                     MD041420
      *****************************************************************                     MD041420
     C           UPDMEM    BEGSR                                                            MD041420
     C           VUDT      IFLT BJDNWD                                                      MD041420
     C           C#ATYP    ANDEQ'R'                                                         MD041420
      * Access shadow balance                                                               MD041420
     C           RSACNT    CHAINMEMOSL1              81                                     MD041420
     C           *IN81     IFEQ *OFF                                                        MD041420
     C           DORC      IFEQ 0                                                           MD041420
     C                     ADD  MVAM      LDBLN                                             MD041420
     C                     ADD  MVAM      CLBLN                                             MD041420
     C                     ELSE                                                             MD041420
     C                     SUB  MVAM      LDBLN                                             MD041420
     C                     SUB  MVAM      CLBLN                                             MD041420
     C                     ENDIF                                                            MD041420
      *                                                                                     MD041420
     C                     UPDATMEMOSMDF               82                                   MD041420
     C           *IN82     IFEQ *ON                                                         MD041420
     C                     MOVE 'FX0920'  DBKEY                                             MD041420
     C                     MOVEL'MEMOS'   DBFILE                                            MD041420
     C                     Z-ADD41        DBASE                                             MD041420
     C                     EXSR *PSSR                                                       MD041420
     C                     ENDIF                                                            MD041420
      *                                                                                     MD041420
     C                     ENDIF                                                            MD041420
     C                     ENDIF                                                            MD041420
      *                                                                                     MD041420
     C                     ENDSR                                                            MD041420
      /EJECT                                                                                MD041420
      *****************************************************************                     MD041420
      * Subroutine  :  UPDPRN                                         *                     MD041420
      * Function    :  Update PRONO                                   *                     MD041420
      *                                                               *                     MD041420
      * Called by   :                                                 *                     MD041420
      * Calls       :  None                                           *                     MD041420
      *****************************************************************                     MD041420
     C           UPDPRN    BEGSR                                                            MD041420
      *                                                                                     MD041420
     C                     MOVELACDE      ACDEC                                             MD041420
     C           RSNOST    CHAINSDNOSTL4             81                                     MD041420
      * If account is a nostro                                                              MD041420
     C           *IN81     IFEQ *OFF                                                        MD041420
     C                     MOVELA7CYCD    W0KEY#                                            MD041420
     C                     MOVE A7NONB    W0KEY#                                            MD041420
     C                     Z-ADDVUDT      W0VDAT                                            MD041420
     C           DORC      IFEQ 0                                                           MD041420
     C                     Z-ADDMVAM      W0AMT                                             MD041420
     C                     ELSE                                                             MD041420
     C                     Z-SUBMVAM      W0AMT                                             MD041420
     C                     ENDIF                                                            MD041420
      * Update projected nostro balances                                                    MD041420
     C                     CALL 'AOPRONU0'                                                  MD041420
     C                     PARM *BLANK    WRTCD   7                                         MD041420
     C                     PARM           W0KEY#  5                                         MD041420
     C                     PARM           W0VDAT  50                                        MD041420
     C                     PARM           W0AMT  150                                        MD041420
      *                                                                                     MD041420
     C           WRTCD     IFEQ '*NRF'                                                      MD041420
     C                     MOVE 'FX0920'  DBKEY                                             MD041420
     C                     MOVEL'PRONO'   DBFILE                                            MD041420
     C                     Z-ADD42        DBASE                                             MD041420
     C                     EXSR *PSSR                                                       MD041420
     C                     ENDIF                                                            MD041420
     C                     ENDIF                                                            MD041420
     C                     ENDSR                                                            MD041420
      /EJECT                                                                                MD041420
      *****************************************************************                     MD041420
      * Subroutine  :  UPDOLP                                         *                     MD041420
      * Function    :  Update OLPOS                                   *                     MD041420
      *                                                               *                     MD041420
      * Called by   :                                                 *                     MD041420
      * Calls       :  None                                           *                     MD041420
      *****************************************************************                     MD041420
     C           UPDOLP    BEGSR                                                            MD041420
      *                                                                                     MD041420
     C                     MOVEL*BLANKS   WRK8    8                                         MD041420
     C                     MOVEL*BLANKS   WRK6    6                                         MD041420
     C                     MOVELBRCA      WRK6                                              MD041420
     C                     MOVE CCYD      WRK6                                              MD041420
     C                     MOVELWRK6      WRK8                                              MD041420
     C                     MOVE '01'      WRK8                                              MD041420
      *                                                                                     MD041420
     C                     MOVEL*BLANKS   WRK1    1                                         MD041420
     C           DORC      IFEQ 1                                                           MD041420
     C                     MOVEL'I'       WRK1                                              MD041420
     C                     ELSE                                                             MD041420
     C                     MOVEL'O'       WRK1                                              MD041420
     C                     ENDIF                                                            MD041420
      *                                                                                     MD041420
     C                     CALL 'AOOLPSU0'                                                  MD041420
     C                     PARM *BLANKS   O#RTN   7                                         MD041420
     C                     PARM WRK8      O#KOLP  8                                         MD041420
     C                     PARM VUDT      O#VDAT  50                                        MD041420
     C                     PARM MVAM      O#AMT  150                                        MD041420
     C                     PARM WRK1      O#IO    1                                         MD041420
      *                                                                                     MD041420
     C           O#RTN     IFEQ '*NRF'                                                      MD041420
     C                     MOVE 'FX0920'  DBKEY                                             MD041420
     C                     MOVEL'OLPOS'   DBFILE                                            MD041420
     C                     Z-ADD43        DBASE                                             MD041420
     C                     EXSR *PSSR                                                       MD041420
     C                     ENDIF                                                            MD041420
     C                     ENDSR                                                            MD041420
      *****************************************************************                     MD045437
      * Subroutine  :  RSCRV2                                         *                     MD045437
      * Function    :  Reverse projections during amend               *                     MD045437
      *                                                               *                     MD045437
      * Called by   :                                                 *                     MD045437
      * Calls       :  None                                           *                     MD045437
      *****************************************************************                     MD045437
     C           RSCRV2    BEGSR                                                            MD045437
      *                                                                                     MD045437
      ** Verify first old settlement account                                                MD045437
      *                                                                                     MD045437
     C           AMSETM    IFEQ 1                                                           MD045437
     C           AMSETM    OREQ 2                                                           MD045437
     C           AMSETM    OREQ 7                                                           MD045437
     C           AMSETM    OREQ 8                                                           MD045437
     C           AMSETM    OREQ 12                                                          MD045437
     C                     MOVEL'N'       C#ATYP                                            MD045437
     C                     ELSE                                                             MD045437
     C           AMSETM    IFEQ 14                                                          MD045437
     C                     MOVEL'R'       C#ATYP                                            MD045437
     C                     MOVELAMOURN    C#ACNO                                            MD045437
     C                     ELSE                                                             MD045437
     C           AMSETM    IFEQ 4                                                           MD045437
     C           AMSETM    OREQ 5                                                           MD045437
     C                     MOVEL'P'       C#ATYP                                            MD045437
     C                     MOVELAMOURN    ##SETA                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     MOVE AMCCYD    C#CCY                                             MD045437
     C                     MOVELAMOURN    ##SETA                                            MD045437
     C                     EXSR CHKACT                                                      MD045437
      *                                                                                     MD045437
     C           NRECI     IFEQ 'D'                                                         MD045437
     C                     MOVELAMNETR    AMNET  20                                         MD045437
     C                     MOVE 'N'       EXTFLG                                            MD045437
     C           AMNET     SETLLRSACMTLG                                                    MD045437
     C           AMNET     READERSACMTLG            N    12                                 MD045437
     C           *IN12     DOWEQ'0'                                                         MD045437
     C           EXTFLG    ANDEQ'N'                                                         MD045437
      *                                                                                     MD045437
     C           TNMR      IFEQ '000000'                                                    MD045437
     C           TRYP      ANDEQ'NT'                                                        MD045437
     C           CUSN      ANDEQCNUM                                                        MD045437
     C           CCYD      ANDEQNCCY                                                        MD045437
     C           ACDE      ANDEQACOD                                                        MD045437
     C           ASNC      ANDEQACSQ                                                        MD045437
     C           BRCA      ANDEQNBRCA                                                       MD045437
      *                                                                                     MD045437
      ** Reverse the Debit/Credit Indicator                                                 MD045437
      *                                                                                     MD045437
     C           DORC      IFEQ 1                                                           MD045437
     C                     Z-ADD0         DORC                                              MD045437
     C                     ELSE                                                             MD045437
     C                     Z-ADD1         DORC                                              MD045437
     C                     ENDIF                                                            MD045437
      *                                                                                     MD045437
     C                     Z-ADDBJRDNB    PTDT                                              MD045437
     C                     MOVELAMNETR    OTR1                                              MD045437
      *                                                                                     MD045437
     C                     WRITEQACMTLG                                                     MD045437
      *                                                                                     MD045437
      ** Update MEMOS, PRONO, OLPOS                                                         MD045437
      *                                                                                     MD045437
     C                     EXSR UPDMEM                                                      MD045437
     C                     EXSR UPDPRN                                                      MD045437
     C                     EXSR UPDOLP                                                      MD045437
      *                                                                                     MD045437
     C                     MOVE 'Y'       EXTFLG                                            MD045437
     C                     ENDIF                                                            MD045437
      *                                                                                     MD045437
     C           AMNET     READERSACMTLG            N    12                                 MD045437
      *                                                                                     MD045437
     C                     ENDDO                                                            MD045437
     C                     ENDIF                                                            MD045437
      *                                                                                     MD045437
     C                     ENDSR                                                            MD045437
      *****************************************************************                     MD045437
      /EJECT                                                                                MD045437
      *****************************************************************                     MD045437
      * Subroutine  :  RSCNT2                                         *                     MD045437
      * Function    :  Generate projections during amend              *                     MD045437
      *                                                               *                     MD045437
      * Called by   :                                                 *                     MD045437
      * Calls       :                                                 *                     MD045437
      *****************************************************************                     MD045437
     C           RSCNT2    BEGSR                                                            MD045437
      *                                                                                     MD045437
     C                     MOVEL'NT'      TRYP                                              MD045437
     C                     MOVELAMNETR    NRTD                                              MD045437
     C                     MOVEL'000000'  TNMR                                              MD045437
     C                     Z-ADDAMDBUY    MVAM                                              MD045437
     C                     MOVELAMNETR    OTR1                                              MD045437
     C                     Z-ADDBJRDNB    PTDT                                              MD045437
     C                     Z-ADDAMVALD    VUDT                                              MD045437
     C                     MOVELAMCCYD    ##CCY                                             MD045437
     C           AMBSIN    IFEQ 'B'                                                         MD045437
     C                     Z-ADD0         DORC                                              MD045437
     C                     ELSE                                                             MD045437
     C                     Z-ADD1         DORC                                              MD045437
     C                     ENDIF                                                            MD045437
      *                                                                                     MD045437
     C           AMSETM    IFEQ 1                                                           MD045437
     C           AMSETM    OREQ 2                                                           MD045437
     C           AMSETM    OREQ 7                                                           MD045437
     C           AMSETM    OREQ 8                                                           MD045437
     C           AMSETM    OREQ 12                                                          MD045437
     C                     MOVEL'N'       C#ATYP                                            MD045437
     C                     ELSE                                                             MD045437
     C           AMSETM    IFEQ 14                                                          MD045437
     C                     MOVEL'R'       C#ATYP                                            MD045437
     C                     ELSE                                                             MD045437
     C           AMSETM    IFEQ 4                                                           MD045437
     C           AMSETM    OREQ 5                                                           MD045437
     C                     MOVEL'P'       C#ATYP                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     MOVELAMCCYD    C#CCY                                             MD045437
     C                     MOVELAMOURN    ##SETA                                            MD045437
     C                     EXSR CHKACT                                                      MD045437
      *                                                                                     MD045437
     C           NRECI     IFEQ 'D'                                                         MD045437
     C                     MOVELCNUM      CUSN                                              MD045437
     C                     MOVELNCCY      CCYD                                              MD045437
     C                     MOVELACSQ      ASNC                                              MD045437
     C                     MOVELNBRCA     BRCA                                              MD045437
     C                     MOVELACOD      ACDE                                              MD045437
      *                                                                                     MD045437
     C                     WRITEQACMTLF                                                     MD045437
     C                     EXSR UPDMEM                                                      MD045437
     C                     EXSR UPDPRN                                                      MD045437
     C                     EXSR UPDOLP                                                      MD045437
     C                     ENDIF                                                            MD045437
      *                                                                                     MD045437
      ** If settlement method is 00, use netting account.                                   MD045437
      *                                                                                     MD045437
     C           AMSETM    IFEQ 0                                                           MD045437
     C                     CALL 'AOBRCHR1'                                                  MD045437
     C                     PARM *BLANKS   @RTCD                                             MD045437
     C                     PARM '*KEY   ' @OPTN                                             MD045437
     C                     PARM AMBRCA    @BRCA                                             MD045437
     C           SDBRCH    PARM SDBRCH    SDSSDY                                            MD045437
      *                                                                                     MD045437
     C           @RTCD     IFNE *BLANK                                                      MD045437
     C                     Z-ADD5         DBASE                                             MD045437
     C                     MOVEL'SDBRCHPD'DBFILE                                            MD045437
     C                     MOVELNBRCA     DBKEY                                             MD045437
     C                     OUT  LDA                                                         MD045437
     C                     EXSR *PSSR                                                       MD045437
     C                     ELSE                                                             MD045437
     C                     MOVELA8BICN    CUSN                                              MD045437
     C                     MOVELAMCCYD    CCYD                                              MD045437
     C                     MOVEL'01'      ASNC                                              MD045437
     C                     MOVELAMBRCA    BRCA                                              MD045437
     C                     MOVELBNNEAC    ACDE                                              MD045437
     C                     WRITEQACMTLF                                                     MD045437
     C                     EXSR UPDMEM                                                      MD045437
     C                     EXSR UPDPRN                                                      MD045437
     C                     EXSR UPDOLP                                                      MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDIF                                                            MD045437
     C                     ENDSR                                                            MD045437
      *****************************************************************                     MD045437
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
     C           *INZSR    BEGSR
      *=========================================================================
      * Initialization routine
      *=========================================================================
      *
      ** Set up copyright parameter
     C                     MOVEACPY@      CPY2@  80
      *
      ** Key for accessing Customer Groups.
     C           CGPKEY    KLIST
     C                     KFLD           KSET    1
     C                     KFLD           KGRP    4
      *
      ** Parameter list for calling FX0921.
     C           PL0921    PLIST
     C                     PARM           PLCSSN 10        Select Customer No.
     C                     PARM           PLVALD  6        Select Value Date
     C                     PARM           PLCCY   3        Select CCY (F4)
     C                     PARM           PLCCY1  3        Select CCY PAIR 1
     C                     PARM           PLCCY2  3        Select CCY PAIR 1
     C                     PARM           PLCPGM 10        Calling Pgm
     C                     PARM           NETA   150       NET AMOUNT
     C                     PARM *ZERO     NETAC  150       NET AMOUNT CALCULATED
     C                     PARM *ZERO     PLSEQN  30       SEQUENCE ASSIGNED
     C                     PARM *BLANKS   PLNETR 19        NET REF  ASSIGNED
     C                     PARM           PLBRCA  3        BRANCH CODE
     C                     PARM           BJRDNB  50       RUN DATE
     C                     PARM           CHGDAT  80
     C                     PARM           CCRTRN  8
     C/COPY WNCPYSRC,FXH00162
      *  KEY FOR ACCESSING NET MASTER FILE
     C           NETMKY    KLIST
     C                     KFLD           PDCSSN
     C                     KFLD           PDCCY
     C                     KFLD           PDCCY1
     C                     KFLD           PDCCY2
     C                     KFLD           PDVALD
     C                     KFLD           KYSEQN
      *                                                                                       CSD015
      ** Compliance Watch Hit List Key                                                        CSD015
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *                                                                                     MD021333
     C           RSACKY    KLIST                                                            MD021333
     C                     KFLD           @TNMR   6                                         MD021333
     C                     KFLD           @CCYD   3                                         MD021333
      *                                                                                     MD021333
     C           RSFNMS    KLIST                                                            MD021333
     C                     KFLD           @FCCY   3                                         MD021333
     C                     KFLD           @FCST   6                                         MD021333
     C                     KFLD           @FSQN   40                                        MD021333
      *                                                                                     MD041420
     C           RSACNT    KLIST                                                            MD041420
     C                     KFLD           CUSN                                              MD041420
     C                     KFLD           CCYD                                              MD041420
     C                     KFLD           ACDE                                              MD041420
     C                     KFLD           ASNC                                              MD041420
     C                     KFLD           BRCA                                              MD041420
      *                                                                                     MD041420
     C           RSNOST    KLIST                                                            MD041420
     C                     KFLD           CUSN                                              MD041420
     C                     KFLD           CCYD                                              MD041420
     C                     KFLD           ACDEC  10                                         MD041420
     C                     KFLD           ASNC                                              MD041420
     C                     KFLD           BRCA                                              MD041420
      *
      ** Entry Parameter List
     C           *ENTRY    PLIST
     C                     PARM           CNFDSP  7        CONFIRM/DISPLAY
     C                     PARM           PLCSSN 10        Select Customer No.
     C                     PARM           PLVALD  6        Select Value Date
     C                     PARM           PLCCY   3        Select CCY (F15)
     C                     PARM           PLCCY1  3        Select CCY PAIR 1
     C                     PARM           PLCCY2  3        Select CCY PAIR 1
     C                     PARM           NETA   150       NET AMOUNT
     C                     PARM           PLCPGM 10        Calling Pgm
     C                     PARM           PLBRCA  3        BRANCH CODE
     C                     PARM           PLRTRN  8
     C/COPY WNCPYSRC,FXH00163
      *
     C           *LIKE     DEFN AMSEQN    KYSEQN
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
      *
      ** Access Bank details.
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR'  WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    SDSSDY
     C                     MOVELBJMRDT    SRUNA
      *
      ** Set up DDDMMYY DS or MMMDDYY.
     C           BJDFIN    IFEQ 'D'
     C                     MOVELBJMRDT    D#DATE
     C                     Z-ADDD#DAY     RUNDAY  20
     C                     MOVELD#MON     RUNMON  3
     C                     Z-ADDD#YRS     RUNYRS  20
     C                     ELSE
     C                     MOVELBJMRDT    M#DATE
     C                     Z-ADDM#DAY     RUNDAY
     C                     MOVELM#MON     RUNMON
     C                     Z-ADDM#YRS     RUNYRS
     C                     ENDIF
      *
      ** Access Midas Module Details.
     C                     CALL 'AOMMODR0'
     C                     PARM '*DBERR'  WRTCD
     C                     PARM '*FIRST ' WOPTN
     C           SDMMOD    PARM SDMMOD    SDSSDY
      *
      ** Access Retail Details - if Retail or Interest on A/C installed.
     C           BGRTBN    IFEQ 'Y'
     C           BGIOAC    OREQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM '*DBERR'  WRTCD
     C                     PARM '*FIRST ' WOPTN
     C           SDRETL    PARM SDRETL    SDSSDY
     C                     ENDIF
      *
      ** Access Dealing ICD details.
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR'  WRTCD
     C                     PARM '*FIRST ' WOPTN
     C           SDDEAL    PARM SDDEAL    SDSSDY
      *                                                                   CDE003
      ** Check if CDE003 is switched *ON.                                 CDE003
      *                                                                   CDE003
     C                     CALL 'AOSARDR0'                                CDE003
     C                     PARM *BLANKS   WRTCD                           CDE003
     C                     PARM '*VERIFY' WOPTN                           CDE003
     C                     PARM 'CDE003'  @SARD   6                       CDE003
     C           SCSARD    PARM SCSARD    DSFDY                           CDE003
      *                                                                   CDE003
     C           WRTCD     IFNE *BLANKS                                   CDE003
     C                     MOVE 'N'       CDE003  1                       CDE003
     C                     ELSE                                           CDE003
      *                                                                   CDE003
     C                     MOVE 'Y'       CDE003                          CDE003
     C                     ENDIF                                          CDE003
      *
      ** Check if CDL025 is switched *ON.                                 CDL025
      *                                                                   CDL025
     C                     CALL 'AOSARDR0'                                CDL025
     C                     PARM *BLANKS   WRTCD                           CDL025
     C                     PARM '*VERIFY' WOPTN                           CDL025
     C                     PARM 'CDL025'  @SARD   6                       CDL025
     C           SCSARD    PARM SCSARD    DSFDY                           CDL025
      *                                                                   CDL025
     C           WRTCD     IFNE *BLANKS                                   CDL025
     C                     MOVE 'N'       CDL025  1                       CDL025
     C                     ELSE                                           CDL025
     C                     MOVE 'Y'       CDL025                          CDL025
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
      **  Get ZMUSER to access default branch.
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     UNLCKZMUSER
      *
      ** Dummy write.
     C   84N84             WRITEFXNETMD0
      *
     C*
     C** LOAD CURRENCY AND DECIMAL PLACES ARRAYS
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*FIRST ' WOPTN
     C                     PARM *BLANKS   @KEYCY  3
     C           CYDDS     PARM CYDDS     SDSSDY
     C*
     C           WRTCD     IFNE *BLANKS
     C                     MOVE '*FIRST ' DBKEY            ***************
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 030 *
     C                     Z-ADD30        DBASE            ***************
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADD0         X       30
     C*
     C           WRTCD     DOWEQ*BLANKS
     C           X         OREQ 200
     C*
     C                     ADD  1         X
     C                     MOVELA6CYCD    CY,X
     C                     Z-ADDA6NBDP    CDP,X
     C                     MOVELA6CYNM    CYNM,X
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*NEXT  ' WOPTN
     C                     PARM *BLANKS   @KEYCY
     C           CYDDS     PARM CYDDS     SDSSDY
     C                     ENDDO
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CSD015 is switched on.                                  CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*VERIFY' WOPTN                                               CSD015
     C                     PARM 'CSD015'  WSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C           WRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE '*NRF'                                                        CSD015
     C                     MOVE 'CSD015'  DBKEY            **************                     CSD015
     C                     MOVEL'SCSARDPD'DBFILE           * DBError 31 *                     CSD015
     C                     Z-ADD31        DBASE            **************                     CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if transactions are being monitored by Compliance Watch.                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*KEY   ' WOPTN                                               CSD015
     C                     PARM 'DEALING 'WFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE *BLANKS                                                       CSD015
     C           WRTCD     ANDNE'*NRF'                                                        CSD015
     C                     MOVE 'DEALING' DBKEY            **************                     CSD015
     C                     MOVEL'SDWLCCPD'DBFILE           * DBError 32 *                     CSD015
     C                     Z-ADD32        DBASE            **************                     CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CSC011 is switched on.                                  CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*VERIFY' WOPTN                                               CSD015
     C                     PARM 'CSC011'  WSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
     C           WRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE '*NRF'                                                        CSD015
     C                     MOVEL'CSC011'  DBKEY            **************                     CSD015
     C                     MOVEL'SCSARDPD'DBFILE           * DBError 33 *                     CSD015
     C                     Z-ADD33        DBASE            **************                     CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CCF001 is switched on.                                  CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*VERIFY' WOPTN                                               CSD015
     C                     PARM 'CCF001'  WSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
     C           WRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE '*NRF'                                                        CSD015
     C                     MOVE 'CCF001'  DBKEY            **************                     CSD015
     C                     MOVEL'SCSARDPD'DBFILE           * DBError 34 *                     CSD015
     C                     Z-ADD34        DBASE            **************                     CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Access Compliance Watch Configuration Data if necessary.                            CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   WRTCD                                               CSD015
     C                     PARM '*FIRST ' WOPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    SDSSDY                                              CSD015
      *                                                                                       CSD015
     C           WRTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVELWOPTN     DBKEY                                               CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD35        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C/COPY WNCPYSRC,FXH00164
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SDTERM
      *****************************************************************
      *                                                               *
      *  SDTERM - End processing on SD2400                            *
      *                                                               *
      *  Called By: CONFRM, DBERR, *PSSR                              *
      *  Calls:                                                       *
      *  SD2400 - Midas SD Extended Settlements                       *
      *                                                               *
      *****************************************************************
     C           SDTERM    BEGSR
     C*
     C                     MOVE 'T'       PMTERM
     C                     CALL 'SD2400'
     C                     PARM           @PARM1
     C                     PARM           @PARM2
     C                     PARM           @PARM3
     C                     PARM           @DLNO
     C*
     C                     ENDSR
      *.........................................................................
      /EJECT
     C           DBERR     BEGSR
      *=========================================================================
      * Exception/error handler
      *=========================================================================
      *
     C*
      *  Rollback previous Updates
     C                     ROLBK
     C*     Dump and exit program
     C                     MOVE 'Y2U0004 'PLRTRN
     C                     DUMP
     C                     EXSR SDTERM
     C                     SETON                         LR
     C                     CALL 'DBERRCTL'             82
     C                     RETRN
     C                     ENDSR
      *.........................................................................
      /EJECT
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      ************ CALL DBERRCTL IF INTERACTIVE PROGRAM ***************
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     ROLBK
     C                     DUMP
      *
     C                     CALL 'DBERRCTL'
     C                     EXSR SDTERM
      *
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *=========================================================================
      * Compile time array data
      *=========================================================================
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** TABMTH/TABCOD - MONTHS TABLES
JAN01
FEB02
MAR03
APR04
MAY05
JUN06
JUL07
AUG08
SEP09
OCT10
NOV11
DEC12
** XOT - XML Opening Tags for the Compliance Engine.                                          CSD015
<Our Nostro>                                                                                  CSD015
<Intermediary Bank>                                                                           CSD015
<Ordering Bank>                                                                               CSD015
<Ordering Customer>                                                                           CSD015
<Receiver Correspondent>                                                                      CSD015
<Receiver Number>                                                                             CSD015
<Account with Bank>                                                                           CSD015
<Beneficiary>                                                                                 CSD015
<Details of Payment>                                                                          CSD015
** XCT - XML Closing Tags for the Compliance Engine.                                          CSD015
</Our Nostro>                                                                                 CSD015
</Intermediary Bank>                                                                          CSD015
</Ordering Bank>                                                                              CSD015
</Ordering Customer>                                                                          CSD015
</Receiver Correspondent>                                                                     CSD015
</Receiver Number>                                                                            CSD015
</Account with Bank>                                                                          CSD015
</Beneficiary>                                                                                CSD015
</Details of Payment>                                                                         CSD015
