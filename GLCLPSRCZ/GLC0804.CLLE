/*********************************************************************/
/*STD    CLPBASEBND                                                     */
/*EXI    TEXT('Midas Events by Currency with Running Totals Rpt')    */
/*********************************************************************/
/*                                                                   */
/*       Midas - General Ledger Module                               */
/*                                                                   */
/*       GLC0804 - Events by Currency with Running Totals Report     */
/*                                                                   */
/*       (c) Finastra International Limited 2021                     */
/*                                                                   */
/*       Last Amend No. CGL091 *Create     Date 02Nov21              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       CGL091 - Events by Currency with Running Totals Report      */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&TYPE &PARM &RSEQ &RLEV &RENT &RPARM)
/**/
             DCL        VAR(&CPYFLD) TYPE(*CHAR) LEN(64) VALUE('(c) Finastra Inernational +
                          Limited 2021')
             DCL        VAR(&SWS) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PARM) TYPE(*CHAR) LEN(1)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(2)
             DCL        VAR(&RPARM) TYPE(*CHAR) LEN(100)
             DCL        VAR(&DAYS) TYPE(*CHAR) LEN(3)
             DCL        VAR(&RSEQ) TYPE(*CHAR) LEN(5) /* RCF sequence number */
             DCL        VAR(&RLEV) TYPE(*CHAR) LEN(1) /* RCF level flag (S/C/B)*/
             DCL        VAR(&RENT) TYPE(*CHAR) LEN(3) /* RCF entity code (all/comp/bch)*/
             DCL        VAR(&MMOD) TYPE(*CHAR) LEN(256)

             RTVDTAARA  DTAARA(MMOD) RTNVAR(&MMOD)

/**/
             CHGJOB     SWS(00000000)
             SNDMSG     MSG('EVENTS BY CURRENCY REPORT')  TOMSGQ(MRUNQ)

/* Get number of days forward on from the prompt screen */
             CHGVAR     VAR(&DAYS) VALUE(%SST(&RPARM 1 3))
             IF         COND((&DAYS *EQ '   ') *OR (&DAYS *EQ '0  ') +
                          *OR (&DAYS *EQ '  0') *OR (&DAYS *EQ '00 +
                          ') *OR (&DAYS *EQ ' 00')) THEN(DO)
             CHGVAR     VAR(&DAYS) VALUE('000')
             ENDDO

/*/COPY WNCPYSRC,GLC0804B05                                          */
/**/
             IF         COND(&PARM = '1') THEN(DO)

                IF      COND(%SST(&MMOD 21 1) *NE 'Y') THEN(DO)
                        OVRDBF FILE(EVNTM) TOFILE(STEVE)
                        CHGJOB SWS(XXXX1XXX)
                ENDDO
                IF      COND(%SST(&MMOD 21 1) *EQ 'Y') +
                        THEN(OVRDBF FILE(EVNTM) TOFILE(DLMEV))
                CHGJOB  SWS(XXX1XXXX)
             ENDDO

/*/COPY WNCPYSRC,GLC0804B01                                          */


/* REPORT BY SYSTEM   */
/*/COPY WNCPYSRC,GLC0804B06                                          */
             IF         COND((&RLEV *EQ 'S') *OR (&RLEV *EQ ' ')) +
                          THEN(CALL PGM(GL0557) PARM(&TYPE &RSEQ &DAYS))
/*/COPY WNCPYSRC,GLC0804B07                                          */

/* REPORT BY BRANCH   */
/*/COPY WNCPYSRC,GLC0804B08                                          */
                IF   COND(&RLEV *EQ 'B') THEN(CALL PGM(GL0558) +
                                  PARM(&TYPE &RSEQ &RENT &DAYS))
/*/COPY WNCPYSRC,GLC0804B09                                          */

/* REPORT BY COMPANY  */
/*/COPY WNCPYSRC,GLC0804B10                                          */
                IF   COND(&RLEV *EQ 'C') THEN(CALL PGM(GL0559) +
                                  PARM(&TYPE &RSEQ &RENT &DAYS))
/*/COPY WNCPYSRC,GLC0804B11                                          */
/**/
             IF         COND(&PARM = '1') THEN(DLTOVR FILE(EVNTM))
             RTVJOBA    SWS(&SWS)
/**/
             IF         COND(%SUBSTRING(&SWS 7 2) = '11') THEN(SNDMSG +
                        MSG('Job terminated - database in error') +
                        TOMSGQ(MOPERQ))
/**/
             IF         COND(%SUBSTRING(&SWS 7 2) = '01') THEN(SNDMSG +
                        MSG('File controls out of balance') +
                        TOMSGQ(MOPERQ))
/*/COPY WNCPYSRC,GLC0804B03                                          */
/**/
             CHGVAR     VAR(&CPYFLD) VALUE('(c) Finastra International Limited 2021 ')
 ENDPGM:     ENDPGM
