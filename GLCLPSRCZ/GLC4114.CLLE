/*********************************************************************/
/*S*D****CLPBASE******************************************************/                   /*CGL120*/
/*STD    CLPBASEBND                                                  */                   /*CGL120*/
/*EXI    DFTACTGRP(*NO) ACTGRP(GLC4114)                              */                   /*CGL120*/
/*EXI    TEXT('Midas GL Daily Journal Summary Report')               */
/*********************************************************************/
/*                                                                   */
/*       Midas General Ledger Module                             */
/*                                                                   */
/*       GLC4114 - Daily Journal Summary Report                      */
/*                                                                   */
/*       (c) Finastra International Limited 2001                     */
/*                                                                   */
/*       Last Amend No. MD046248           Date 27Oct17              */
/*       Prev Amend No. MD021155           Date 09Jul13              */
/*                      CGL127AQ           Date 06Aug12              */
/*                      CGL120             Date 06Aug12              */
/*                      BUG27417A          Date 19May10              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/*                      CAP204             Date 03Mar10              */
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/* Midas Release 4 --------------- Base -----------------------------*/
/* Midas DBA 3.00 ---------------- Base -----------------------------*/
/*                      CRT001  *CREATE    Date 28Feb95              */
/*                                                                   */
/*-------------------------------------------------------------------*/
/*                                                                   */
/*       MD046248 - Finastra Rebranding                              */
/*       MD021155 - COB Restructure Phase 1 remnants                 */
/*                - Still checks for CRT001                          */
/*                - Not conditioned on CRT001                        */
/*       CGL127AQ - General Ledger Module optimisation - Phase 1     */
/*       CGL120 - GL COB Components Task Split                       */
/*       BUG27417A - Initialise merged posting files before merging. */
/*       CAP204 - Retail Account Transfer                            */
/*       CRT001 - Retail Teller System                               */
/*                                                                   */
/*********************************************************************/
             PGM
/**/
             DCL        VAR(&CPYFLD) TYPE(*CHAR) LEN(64) VALUE('(c) +
                          Finastra International Limited +
                          2001')
             DCL        VAR(&MEM) TYPE(*CHAR) LEN(44)
             DCL        VAR(&MSG) TYPE(*CHAR) LEN(50)
             DCL        VAR(&LDA) TYPE(*CHAR) LEN(256)
             DCL        VAR(&FT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&RSEQ) TYPE(*CHAR) LEN(5)
             DCL        VAR(&RLEV) TYPE(*CHAR) LEN(1)
             DCL        VAR(&RENT) TYPE(*CHAR) LEN(3)
/**********  DCL        VAR(&RTCD) TYPE(*CHAR) LEN(7)                         */ /*CGL120 MD021155*/
/**********  DCL        VAR(&OPTN) TYPE(*CHAR) LEN(7)                         */ /*CGL120 MD021155*/
/**********  DCL        VAR(&SAR) TYPE(*CHAR) LEN(6)                          */ /*CGL120 MD021155*/
/**********  DCL        VAR(&SCSARD) TYPE(*CHAR) LEN(200)                     */ /*CGL120 MD021155*/
/**********  DCL        VAR(&CRT001) TYPE(*CHAR) LEN(1) VALUE('N')            */ /*CGL120 MD021155*/
/**/
/*    Global monitor message                                         */
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
/*******************************************************************          */ /*CGL120 MD021155*/
/**Determine*if*Retail*Teller*System*is*switched*on*****************/ /*      */ /*CGL120 MD021155*/
/*******************************************************************          */ /*CGL120 MD021155*/
/**********  CHGVAR     VAR(&RTCD) VALUE('       ')                           */ /*CGL120 MD021155*/
/**********  CHGVAR     VAR(&OPTN) VALUE('*VERIFY')                           */ /*CGL120 MD021155*/
/**********  CHGVAR     VAR(&SAR) VALUE('CRT001')                             */ /*CGL120 MD021155*/
/**********  CALL       PGM(AOSARDR0) PARM(&RTCD &OPTN &SAR &SCSARD)          */ /*CGL120 MD021155*/
/*******************************************************************          */ /*CGL120 MD021155*/
/**If*Retail*Teller*System*is*NOT*switched*on:*End******************          */ /*CGL120 MD021155*/
/*******************************************************************          */ /*CGL120 MD021155*/
/**********  IF         COND(&RTCD *NE '      ') THEN(GOTO +                         */ /*MD021155*/
/**********               CMDLBL(END))                                        */ /*CGL120 MD021155*/
/**/
             CHGJOB     SWS(00000000)
             SNDPGMMSG  MSG('DAILY JOURNAL SUMMARY EXTRACT') +
                        TOMSGQ(MRUNQ) MSGTYPE(*INFO)
             CLRPFM     FILE(ACJXH)
             CLRPFM     FILE(ACJXD)
             CLRPFM     FILE(ACJXT)
/**/
             RTVDTAARA  DTAARA(MMOD (57 1)) RTNVAR(&FT)
             IF         COND(&FT = 'Y') THEN(CHGJOB SWS(1XXXXXXX))
                                                                                          /*CAP204*/
/***Merge*all*postings*from*ACPO1*and*GLACPOL0*to*single*file*GLACPML0**/        /*CAP204 CGL127AQ*/
                                                                                          /*CAP204*/
/**********  CLRPFM     FILE(GLACPMPD)                                     */ /*BUG27417A CGL127AQ*/
/**********  CLRPFM     FILE(GLACRMPD)                                     */ /*BUG27417A CGL127AQ*/
/**********  CPYF       FROMFILE(ACPO1) TOFILE(GLACPMPD) +
                          MBROPT(*REPLACE) RCDFMT(APOSTPDF)                   */ /*CAP204 CGL127AQ*/
/**********  MONMSG    (CPF2817) CMPDTA(CPF2869)                              */ /*CAP204 CGL127AQ*/
                                                                                          /*CAP204*/
/**********  CPYF       FROMFILE(GLACPOL0) TOFILE(GLACPMPD) +
                          MBROPT(*ADD) RCDFMT(APOSTPDF)                       */ /*CAP204 CGL127AQ*/
/**********  MONMSG    (CPF2817) CMPDTA(CPF2869)                              */ /*CAP204 CGL127AQ*/
                                                                                          /*CAP204*/
/**********  CPYF       FROMFILE(ACPO1) TOFILE(GLACRMPD) +
                          MBROPT(*REPLACE) RCDFMT(APOSTRAF)                   */ /*CAP204 CGL127AQ*/
/**********  MONMSG    (CPF2817) CMPDTA(CPF2869)                              */ /*CAP204 CGL127AQ*/
/**/
             CALL       PGM(GL4114)
/**/
             CHGJOB     SWS(0XXXXXXX)
/**/
             DLTOVR     FILE(*ALL)
/*   GOTO ERROR MSG IS U7 & U8 NOT OFF.                         */
             IF         COND(%SWITCH(XXXXXXX1)) THEN(DO)
                        GOTO ERROR
                        ENDDO
/**/
/**********  CALL       PGM(GL4116)                                                  */ /*CGL127AQ*/
/**/
/*/COPY WNCPYSRC,GLC4114001                                          */
/****CLRPFM*IF*NO*ERROR.*****                                                        */ /*CGL127AQ*/
/**********  IF         COND(%SWITCH(XXXXXX00)) THEN(DO)                             */ /*CGL127AQ*/
/**********  CLRPFM     FILE(ACJXH)                                                  */ /*CGL127AQ*/
/**********  CLRPFM     FILE(ACJXD)                                                  */ /*CGL127AQ*/
/**********  CLRPFM     FILE(ACJXT)                                                  */ /*CGL127AQ*/
/**********             ENDDO                                                        */ /*CGL127AQ*/
/*/COPY WNCPYSRC,GLC4114002                                          */
/*   ERROR MESSAGES                                             */
 ERROR:      IF         COND(%SWITCH(XXXXXX11)) THEN(DO)
                RTVDTAARA  DTAARA(LDA) RTNVAR(&LDA)
                CHGVAR     VAR(&MEM) VALUE(%SUBSTRING(&LDA 134 44))
                SNDPGMMSG  MSGID(MEM0001) MSGF(MIDAS) MSGDTA(&MEM) +
                             TOMSGQ(MOPERQ MRUNQ)
             ENDDO
/**/
             IF         COND(%SWITCH(XXXXXX10)) THEN(DO)
                CHGVAR     VAR(&MSG) VALUE('FILE CONTROLS OUT OF +
                                            BALANCE')
                SNDPGMMSG  MSGID(MEM0002) MSGF(MIDAS) MSGDTA(&MEM) +
                             TOMSGQ(MOPERQ MRUNQ)
             ENDDO
 
             GOTO       CMDLBL(END)
 
ABNOR:
             CHGJOB     SWS(XXXXXX11)
             MONMSG     MSGID(CPF0000 MCH0000)
             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
                          GLC4114 ended abnormally - see job log') +
                          TOMSGQ(MOPERQ MRUNQ)
             MONMSG     MSGID(CPF0000 MCH0000)
/**/
/*  ENDPGM:      ENDPGM                                           */
/**/
END:         CHGVAR     VAR(&CPYFLD) VALUE('(c) +
                          Finastra International Limited')
             ENDPGM
