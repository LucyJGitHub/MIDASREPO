     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Full Currency Branch Report')                 *
     H/TITLE Midas GL Full Currency Branch Report
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Print report of file contents.
     H* Generated by  : Synon/2  Version:  8646
     H* Function type : Print file  Version:   0.1
      *
     H*  Company :
     H* System     : General Ledger Synon Model
     H* User name  : F7387SY
     H* Date       : 15/10/90 time: 16:24:48
      *  (c) Misys International Banking Systems Ltd. 2001            *
     H*
      *================================================================
     M* Maintenance   :
      *================================================================
     F********************************************************************
     F*                                                                  *
      *  Last Amend No. AR1065437          Date 23Jan13               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CGL008             Date 08Mar99               *
      *                 E38270             Date 06Jul92               *
      *                 E36338             DATE 26Feb92               *
     F*          AMEND NO. S01340            DATE 23SEP91                *
     F*          Amend No. S01333            DATE 04APR91                *
     F*          Amend No. LN0958            Date 03JAN91                *
     F*          AMEND NO. LN0955            DATE 03JAN91                *
     F*          AMEND NO. BHF851            DATE 31OCT90                *
     F*          AMEND NO. LN0882            DATE 19OCT90                *
     F*          AMEND NO. LN0837            DATE 04OCT90                *
     F*          AMEND NO. BHF666            DATE 20SEP90                *
     F*          AMEND NO. LN0714            DATE 17SEP90                *
     F*          AMEND NO. S01212            DATE 17SEP90                *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
      *  AR1065437 - Extra fields on PEA Audit Report                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL008 - Security on Journal Entry                           *
     F*     E38270 - NO BRANCH SHOULD BE SHOWN WHEN SINGLE BRANCHING
     F*     E36338 - Add AU Printer file                                 *
     F*     S01340 - MIS Release 10 Changes                              *
     F*     S01333 - MIS Release 10 - Spread Journal Changes             *
     F*     LN0958 - ENSURE THAT THE BRANCH CODE PASSED TO ZSFILE AS     *
     F*              ENTITY                                              *
     F*     LN0955 - PREVENT REPORT FROM BEING PRODUCED WHEN THERE ARE   *
     F*              NO DETAILS                                          *
     F*     BHF851 - CHANGE DESCRIPTION ON REPORT                        *
     F*     LN0882 - STANDARDISE REPORT TITLES                           *
     F*     LN0837 - CHANGE FROM SYSTEM LEVEL REPORT TO BRANCH           *
     F*              SPECIFIC                                            *
     F*     BHF666 - TOTALS INCORRECT                                    *
     F*     LN0714 - ADD RCF                                             *
     F*     S01212 - /Copy and Window Processing                         *
     F*                                                                  *
     F********************************************************************
     F*00/Copy Member GL0110P   Initialise Program F-Spec
     F/COPY WNCPYSRC,GL0110PFPG
     FGLJENSL4IF  E           K        DISK
      * RSQ: Journal Entry Summary     Branch/Batch/Currency
      *
     FGLJENHL1IF  E           K        DISK
      * RTV: Midas GL Journal Entry Header LF Rtv
      *
     FGLJENQL0IF  E           K        DISK                                                AR1065437
      ** RTV: Journal Entry Detail Extension File                                          AR1065437
      *                                                                                    AR1065437
     F*GL0110PMO   E             97     PRINTER                           LN0955
     FGL0110PMO   E             97     PRINTER                        UC  LN0955
     F                                              KINFDS INFDS$
     FGL0110AUO   E                    PRINTER                        UC  E36338
     F                                              KINFDS INFDSA         E36338
      * PRT: Midas GL Full Currency Branch Report
      *
     E                    CPY@    1   1 80               Copyright     array
     E                    UHDR    1   2 53
     E*00/Copy Member GL0110P   Initialise Program E-Spec
     E/COPY WNCPYSRC,GL0110PEPG
     E                    @CN     1   6 25               Long constants.
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*00/Copy Member GL0110P   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0110PIPG
     I*00/Copy Members GL0110P  Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0110PIPG
      /EJECT
      * Data structures:-
     IPGMDS     ESDSY2PGDSP
      * Program data structure.
     IJBDTTM      DS
      * Job date/time.
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS$    E DSY2I$DSP
      * Printer file information data structure.
      *
     IINFDSA      DS                                                      E36338
     I                                       83  92 SFILEU                E36338
     I                                    B 123 1240SFNUMU                E36338
     I** AU printer file information data structure                       E36338
     I*                                                                   E36338
     I            DS
     I                                        1   30ULVAL2
     I                                        1   99ULVALD
      * Set up parameters :
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@DEPT    E DSSDDEPTPD
     I*
     I*  Department Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
      /EJECT
      * Parameter declarations.
     IP1PARM      DS
      * I:    RCF Sequence Number
     I                                        1   5 P1RSQN
     IP2PARM      DS
      * I:    Level
     I                                        1   1 P2LEVL
     IP3PARM      DS
      * I:    Entity
     I                                        1   3 P3ENTY
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Batch in use message 1'
      * Message data for 'Batch in use message 2'
      * Message data for 'Batch in use message 3'
      * Message data for 'Batch in use message 4'
      * Message data for 'Batch in use message 5'
      /EJECT
      *****************************************************************
     C           *ENTRY    PLIST                           Entry parameter
     C                     PARM           P0RTN   7        Return code
     C           P1RSQN    PARM           WP0001  5        RCF Sequence Nu
     C           P2LEVL    PARM           WP0002  1        Level
     C           P3ENTY    PARM           WP0003  3        Entity
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
      * Clear overflow indicator.
     C                     SETOF                     97
      * Establish starting position.
     C           *LOVAL    SETLL@JENSCM                    *
      * Read first record with user selection.
     C                     EXSR GARDRC
      * Print null report headings.
     C           W0EOF     IFEQ '1'
     C** OPEN THE PRINTER FILE                                            E36338
     C*                                                                   E36338
     C                     OPEN GL0110AU                                  E36338
      * ZSFILE - Log Spool File                                           E36338
     C*                                                                   E36338
     C* Set up spool file number                                          E36338
     C                     Z-ADDSFNUMU    WUSFNB                          E36338
     C                     MOVE *BLANKS   UUSRSQ  5                       E36338
     C*                                                                   E36338
     C* ZSFILE - write report rqs                                         E36338
     C                     CALL 'ZSFILE'               90                 E36338
     C           UUSRSQ    PARM P1RSQN    UURSQN  5                       E36338
     C                     PARM *BLANKS   UUENTY  3                       E36338
     C                     PARM SFILEU    UUSFNM 10                       E36338
     C                     PARM WUSFNB    UUSFNB  60                      E36338
     C           WUZSER    PARM *BLANK    UUZSER  1                       E36338
     C*                                                                   E36338
     C           *IN90     IFEQ '1'                                       E36338
     C* Call to program ended in error.                                   E36338
     C                     MOVEL'Y2U0021' W0RTN   7                       E36338
     C                     END                                            E36338
     C*                                                                   E36338
     C* CASE: WRK.ZSFILE is error occurred                                E36338
     C*                                                                   E36338
     C           WUZSER    IFEQ 'Y'                                       E36338
     C                     MOVEL'Y2U0004' P0RTN                           E36338
     C                     EXSR ZYEXPG                                    E36338
     C                     END                                            E36338
     C*                                                                   E36338
     C                     WRITEZZPAGHDA                                  E36338
     C                     SETON                     78                   E36338
     C                     WRITEZZENDRPT                                  E36338
     C******                                                        LN0955E36338
     C***IF*THERE ARE NO DETAILS THEN END THE PROGRAM               LN0955E36338
     C******                                                        LN0955E36338
     C******               EXSR ZXEXPG                              LN0955E36338
     C*********************WRITEZZPAGHDR                                  LN0955
      **USER:*Null*report*processing***********************************   LN0955
      *CASE:*****WRK.S01212*is*Fix*Installed***************************   LN0955
     C********** WUFKST****IFEQ @CN,01                     *IF            LN0955
      **00/Copy*Member*GL0110PNRP*-*Journal*Entry*Summary**************   LN0955
     C*00/Copy*Member*GL0110P***Null*Report*Processing*****************   LN0955
     C*/COPY*WNCPYSRC,GL0110PNRP***************************************   LN0955
     C*00/Copy*Members*GL0110P**Null*Report*Processing*****************   LN0955
     C*/COPY*WNCPYSRC,GL0110PNRP***************************************   LN0955
     C*********************END                             *FI            LN0955
     C*********************WRITEZZENDRPT                                  LN0955
     C                     ELSE
     C* OPEN THE PRINTER FILE                                             LN0955
     C                     OPEN GL0110PM                                  LN0955
      * ZSFile - Log Spool File - Standard functions  *                   LN0955
     C*                                                                   LN0955
     C* Set up spool file number - Standard Functions  *                  LN0955
     C                     Z-ADD@$FNB     WUSFNB                          LN0955
     C                     MOVE *BLANKS   UUSRSQ  5                       LN0955
      *                                                                   CGL008
      ** Adjust page length and overflow as necessary                     CGL008
      *                                                                   CGL008
     C           @$PGL     SUB  2         W0PGL   40                      CGL008
     C           @$OFL     IFGE W0PGL                                     CGL008
     C           W0PGL     SUB  2         W0OFL   40                      CGL008
     C                     ELSE                                           CGL008
     C                     Z-ADD@$OFL     W0OFL                           CGL008
     C                     ENDIF                                          CGL008
     C*                                                                   LN0955
     C* ZSFILE - write report rqs - Standard Functions  *                 LN0955
     C                     CALL 'ZSFILE'               90  ZSFILE - write LN0955
     C           UUSRSQ    PARM P1RSQN    UURSQN  5        RCF sequence nuLN0955
     C                     PARM BSBRCD    UUENTY  3        Entity         LN0958
     C                     PARM @$FVN     UUSFNM 10        Spool file nameLN0955
     C                     PARM WUSFNB    UUSFNB  60       Spool file numbLN0955
     C           WUZSER    PARM *BLANK    UUZSER  1        ZSFILE error   LN0955
     C*                                                                   LN0955
     C           *IN90     IFEQ '1'                                       LN0955
     C* Call to program ended in error.                                   LN0955
     C                     MOVEL'Y2U0021' W0RTN   7                       LN0955
     C                     END                                            LN0955
     C*                                                                   LN0955
     C* CASE: WRK.ZSFILE is error occurred                                LN0955
     C*                                                                   LN0955
     C           WUZSER    IFEQ 'Y'                                       LN0955
     C                     MOVEL'Y2U0004' P0RTN                           LN0955
     C                     EXSR ZYEXPG                                    LN0955
     C                     END                                            LN0955
      * Request all headings.
     C                     MOVEL'Y'       L0      1        Page headings
     C                     MOVEL'Y'       L1      1        Branch code
     C                     MOVEL'Y'       L2      1        Batch number
     C                     MOVEL'Y'       L3      1        Currency code
      * Initialise final totals.
     C                     MOVEL*BLANK    ZTCON            *CON (Screen co
      * Print report body.
     C           W0EOF     DOWEQ'0'
      * Print headings.
     C                     EXSR BAPRHD
      * Print report detail line.
     C                     EXSR CAPRDT
      * Hold current values.
     C           *LIKE     DEFN BSBRCD    WZBRCD           Branch code
     C                     MOVELBSBRCD    WZBRCD
     C           *LIKE     DEFN BSBTNB    WZBTNB           Batch number
     C                     MOVELBSBTNB    WZBTNB
     C           *LIKE     DEFN BSCYCD    WZCYCD           Currency code
     C                     MOVELBSCYCD    WZCYCD
      * Read next record with user selection.
     C                     EXSR GARDRC
      * Determine level changes.
     C                     EXSR DALVCH
      * Print totals.
     C                     EXSR EAPRTT
      * Process necessary heading requests
     C                     EXSR FASGHD
     C                     END
     C**********           WRITEZZENDRPT                                  E36338
     C                     END
      * Exit program.
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *****************************************************************
      /EJECT
     CSR         BAPRHD    BEGSR
      *================================================================
      * Print report Headers.
      *================================================================
     C           L0        IFEQ 'Y'
     C                     WRITEZZPAGHDR
     C                     END
      *
     C                     MOVEL'0'       *IN79                           E38270
     C           WUMBIN    IFEQ @CN,04                     *IF            E38270
     C                     MOVEL'1'       *IN79                           E38270
     C                     END                             *FI            E38270
      *                                                                   E38270
     C           L1        IFEQ 'Y'
      * Load format.
     C                     MOVELBSBRCD    Z1BRCD           Branch code
     C                     MOVEL*BLANK    Z1BNMD           Branch name (di
      * Load related total format.
     C                     MOVELBSBRCD    Z6BRCD           Branch code
     C                     END
      *
     C           L1        IFNE *BLANK
     C                     MOVEL'Y'       W0PFM
      * User: Process Branch code headings.
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLH0 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Heading 0
     C/COPY WNCPYSRC,GL0110PLH0
     C*00/Copy Members GL0110P  Print Level Heading 0
     C/COPY WNCPYSRC,GL0110PLH0
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * Print format.
     C**********           WRITEZ1KEYHDR                                  E38270
     C                     END
     C                     END
      *
     C           L2        IFEQ 'Y'
      * Load format.
     C                     MOVELBSBRCD    Z2BRCD           Branch code
     C                     MOVEL*BLANK    Z2BCDP           Branch Code (Pr
     C                     MOVEL*BLANK    Z2BNMD           Branch name (di
     C                     MOVELBSBTNB    Z2BTNB           Batch number
     C                     MOVEL*BLANK    Z2BSTS           Batch status
     C                     MOVEL*BLANK    Z2BUM1           Batch in use ms
     C                     MOVEL*BLANK    Z2FMA2           Formatted amoun
     C                     MOVEL*BLANK    Z2DCDP           Department Code
     C                     MOVEL*BLANK    Z2DNDS           Department name
     C                     MOVEL*BLANK    Z2BUM2           Batch in use ms
     C                     MOVEL*BLANK    Z2FMAM           Formatted amoun
     C                     MOVEL*BLANK    Z2MBIP           Multiple Branch
     C                     MOVEL*BLANK    Z2BUM3           Batch in use ms
     C                     Z-ADD*ZERO     Z2IINP           Items Input (Pr
     C                     MOVEL*BLANK    Z2TIDP           Terminal I.D. (
     C                     MOVEL*BLANK    Z2BUM4           Batch in use ms
     C                     Z-ADD*ZERO     Z2ICLP           Items Calculate
     C                     MOVEL*BLANK    Z2BUM5           Batch in use ms
     C                     MOVEL*BLANK    Z2BSTD           Batch Status (DS01333
     C                     MOVEL*BLANK    Z2BDSC           batch descriptiS01333
     C*********************MOVEL*BLANK    Z2REVI           Rev/voidS01333 S01340
     C                     END
      *
     C           L2        IFNE *BLANK
     C                     MOVEL'Y'       W0PFM
      * User: Process Batch number headings.
      * Retrieve Header fields - Journal Entry Header  *
     C                     EXSR SARVGN
      *                                                                                    AR1065437
      ** Retrieve and format CGL125/CSC054 introduced fields                               AR1065437
      *                                                                                    AR1065437
     C           CGL125    IFEQ 'Y'                                                        AR1065437
     C           *IN90     ANDEQ*OFF                                                       AR1065437
     C                     EXSR SRCBIF                                                     AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
      * Start of Fix BHF666
      * condition batch in use messages on the batch in use flag
      *CASE:     WRK.Batch in use flag is Batch in use
     C           WUBIUF    IFEQ @CN,01                     *IF
     C                     MOVELWUBUM1    Z2BUM1           Batch in use ms
     C                     MOVELWUBUM2    Z2BUM2           Batch in use ms
     C                     MOVELWUBUM3    Z2BUM3           Batch in use ms
     C                     MOVELWUBUM4    Z2BUM4           Batch in use ms
     C                     MOVELWUBUM5    Z2BUM5           Batch in use ms
     C                     ELSE
      *CASE:     *OTHERWISE
     C                     MOVEL*BLANK    Z2BUM1           Batch in use ms
     C                     MOVEL*BLANK    Z2BUM2           Batch in use ms
     C                     MOVEL*BLANK    Z2BUM3           Batch in use ms
     C                     MOVEL*BLANK    Z2BUM4           Batch in use ms
     C                     MOVEL*BLANK    Z2BUM5           Batch in use ms
     C                     END                             *FI
      * End of Fix BHF666
      * Hash numeric to character - Standard functions  *
     C                     Z-ADDWUHIIN    ULVALI           Integer portion
     C                     Z-ADD*ZERO     ULVALD           Set Decimal
     C                     Z-ADDWUHDIN    ULVAL2           Decimal portion
      *
     C                     CALL 'GL0138U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALI 150       I:Integer
     C                     PARM ULVALD    ULVAL3  99       I:Decimal
     C                     PARM 3         ULDECP  10       I:Decimal place
     C                     PARM @CN,02    ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLT 32        O:Formatted
      *
     C                     MOVE ULRSLT    Z2FMA2           Formatted data
      *
      * Hash numeric to character - Standard functions  *
     C                     Z-ADDWUHICC    ULVALI           Integer portion
     C                     Z-ADD*ZERO     ULVALD           Set Decimal
     C                     Z-ADDWUHDCC    ULVAL2           Decimal portion
     C                     CALL 'GL0138U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALI 150       I:Integer
     C                     PARM ULVALD    ULVAL3  99       I:Decimal
     C                     PARM 3         ULDECP  10       I:Decimal place
     C                     PARM @CN,02    ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLT 32        O:Formatted
     C                     MOVE ULRSLT    Z2FMAM           Formatted data
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELWUBCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM @CN,03    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    Z2BCDP           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    Z2BNMD           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Access Department. - Department Codes  *
     C*
     C*  Access Department codes file for the following field:
     C*  Department Name
     C*
     C                     MOVELWUDPCD    UUDPCD
     C                     CALL 'AODEPTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM @CN,03    UUAPOP  7        I:Option
     C                     PARM           UUDPCD  3        I:Department Code
     C           D@DEPT    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELAEDPCD    Z2DCDP           Department Code
     C                     MOVELAEDPNM    Z2DNDS           Department Name
     C*
     C                     MOVELWUMBRB    Z2MBIP           Multiple Branch
      * CUR.Batch status (Display) = Condition name of WRK.Batch statusflag
     C                     CALL 'MIRVCNR'              90  *
     C                     PARM           W0RTN   7        Return code
     C                     PARM 1100442   Y2LSNO  70       List number
     C                     PARM WUBTSF    W0INVL 20        Batch status fl
     C                     PARM 'N'       W0VLMP  1        Value mapped?
     C           Z2BSTD    PARM           W0CNNM 25        Batch status
      *
     C                     MOVELWUBDES    Z2BDSC           batch descripti
     C*********************MOVELWURVVD    Z2REVI           Reversal/void  S01340
     C                     MOVELWUBTNB    Z2BTNB           Batch number
     C                     MOVELWUWSID    Z2TIDP           Terminal I.D. (
     C                     Z-ADDWUHINI    Z2IINP           Items Input (Pr
     C                     Z-ADDWUHINC    Z2ICLP           Items Calculate
      *                                                                   CGL008
      ** If feature CGL008 is ON, retrieve the Last Insert & Amend User   CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
     C                     MOVELWUUSRI    Z2USRI                          CGL008
     C                     MOVELWUUSRA    Z2USRA                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C/COPY WNCPYSRC,GL0110PC01
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLH1 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Heading 1
     C/COPY WNCPYSRC,GL0110PLH1
     C*00/Copy Members GL0110P  Print Level Heading 1
     C/COPY WNCPYSRC,GL0110PLH1
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * Print format.
      * Convert fields to external form.
     C**********           MOVEL'0'       *IN79                           E38270
     C********** WUMBIN    IFEQ @CN,04                     *IF            E38270
     C**********           MOVEL'1'       *IN79                           E38270
     C**********           END                             *FI            E38270
     C  N79                WRITEZ1KEYHDR                                  E38270
     C                     WRITEZ2KEYHDR
     C                     END
     C                     END
      *
     C           L3        IFNE *BLANK
      * User: Process Currency code headings.
      * Start of Fix BHF666
      * retrieve the number of decimal places for the current currency
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVELBSCYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM @CN,03    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * End of Fix BHF666
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLH2 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Heading 2
     C/COPY WNCPYSRC,GL0110PLH2
     C*00/Copy Members GL0110P  Print Level Heading 2
     C/COPY WNCPYSRC,GL0110PLH2
     C                     END                             *FI
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         CAPRDT    BEGSR
      *================================================================
      * Print report detail line.
      *================================================================
      * Load detail line.
     C                     MOVELBSBTNB    XRBTNB           Batch number
     C                     Z-ADDBSDBTT    XRDBTT           Debit total
     C                     Z-ADDBSCRTT    XRCRTT           Credit total
     C                     MOVELBSCYCD    XRCYCD           Currency code
     C                     MOVELBSBRCD    XRBRCD           Branch code
     C                     MOVEL*BLANK    XRFMDR           Formatted Debit
     C                     MOVEL*BLANK    XRFMCR           Formatted Credi
     C                     MOVEL*BLANK    XRFMDF           Formatted Diffe
     C                     MOVEL*BLANK    XRWNFF           Window Function
     C                     MOVEL*BLANK    XRWNF1           Window Function
     C                     MOVEL*BLANK    XRWNF2           Window Function
     C                     MOVEL'Y'       W0PFM
      * USER: Process detail record
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM XRDBTT    WQ0001 150       Value
     C                     PARM WUNBDP    WQ0002  10       Decimal places
     C                     PARM @CN,02    WQ0003  1        Edit code
     C                     PARM *BLANK    WQ0004  1        Cheque protect
     C           XRFMDR    PARM *BLANK    WQ0005 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error.
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM XRCRTT    WQ0006 150       Value
     C                     PARM WUNBDP    WQ0007  10       Decimal places
     C                     PARM @CN,02    WQ0008  1        Edit code
     C                     PARM *BLANK    WQ0009  1        Cheque protect
     C           XRFMCR    PARM *BLANK    WQ0010 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error.
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C           XRDBTT    SUB  XRCRTT    WUCDTN           Currency Diff T
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM WUCDTN    WQ0011 150       Value
     C                     PARM WUNBDP    WQ0012  10       Decimal places
     C                     PARM @CN,02    WQ0013  1        Edit code
     C                     PARM *BLANK    WQ0014  1        Cheque protect
     C           XRFMDF    PARM *BLANK    WQ0015 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error.
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PPDR - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Process Detail Record
     C/COPY WNCPYSRC,GL0110PPDR
     C*00/Copy Members GL0110P  Process Detail Record
     C/COPY WNCPYSRC,GL0110PPDR
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
     C                     MOVEL'0'       *IN78
     C           XRWNFF    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           XRWNF1    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C           XRWNF2    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
      * Print detail line.
     C                     WRITEZZDTLRCD
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DALVCH    BEGSR
      *================================================================
      * Detect level changes.
      *================================================================
      * Clear all level breaks.
     C                     MOVEL*BLANK    L0               Page headings
     C                     MOVEL*BLANK    L1               Branch code
     C                     MOVEL*BLANK    L2               Batch number
     C                     MOVEL*BLANK    L3               Currency code
      * Clear heading length to print.
     C                     Z-ADD*ZERO     @$HDL
      *
      * End of file - Signal all level breaks.
     C           W0EOF     IFEQ '1'
     C                     MOVEL'Y'       L1
     C                     MOVEL'Y'       L2
     C                     MOVEL'Y'       L3
     C                     ELSE
     C           BSBRCD    IFNE WZBRCD                     Branch code
      * Set on level break indicator.
     C                     MOVEL'Y'       L1
     C                     ADD  2         @$HDL
     C                     END
     C           BSBTNB    IFNE WZBTNB                     Batch number
     C           L1        OREQ 'Y'
      * Set on level break indicator.
     C                     MOVEL'Y'       L2
     C                     ADD  8         @$HDL
     C                     END
     C           BSCYCD    IFNE WZCYCD                     Currency code
     C           L2        OREQ 'Y'
      * Set on level break indicator.
     C                     MOVEL'Y'       L3
     C                     END
     C                     END
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         EAPRTT    BEGSR
      *================================================================
      * Print report Totals.
      *================================================================
      * Print level break totals as required
     C           L3        IFEQ 'Y'
      * User: Process Currency code totals.
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLT0 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Total 0
     C/COPY WNCPYSRC,GL0110PLT0
     C*00/Copy Members GL0110P  Print Level Total 0
     C/COPY WNCPYSRC,GL0110PLT0
     C                     END                             *FI
     C                     END
      *
     C           L2        IFEQ 'Y'
      * User: Process Batch number totals.
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLT1 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Total 1
     C/COPY WNCPYSRC,GL0110PLT1
     C*00/Copy Members GL0110P  Print Level Total 1
     C/COPY WNCPYSRC,GL0110PLT1
     C                     END                             *FI
     C                     END
      *
     C           L1        IFEQ 'Y'
     C                     MOVEL'Y'       W0PFM
      * User: Process Branch code totals.
      * ZSFILE Close/Open GL0110P - Journal Entry Summary  *
     C*
     C**  PRINT OUT THE HEADER AND THE BRANCH TOTAL AS REQUIRED
     C*
      * If there is not enough space on the
      * physical page for this format:-
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 2
      * Signal artificial overflow.
     C                     SETON                     97
      * Print page headers.
     C                     WRITEZZPAGHDR
     C                     END
      * Print format.
     C***********          WRITEZ6KEYTTL                                  E38270
     C  N79                WRITEZ6KEYTTL                                  E38270
     C   79                WRITEZ7KEYTTL                                  E38270
     C*
     C** BLANK OUT THE PRINT FORMAT INDICATOR SO THAT THE NORMAL
     C** SYNON CODE WILL NOT DUPLICATE THE ABOVE WRITES
     C*
     C                     MOVE *BLANK    W0PFM
     C**  IF IT IS NOT THE END OF FILE OPEN/CLOSE
     C           W0EOF     IFEQ '0'
     C**
     C**  Save Indicator 66
     C                     MOVE *IN66     UUIN66  1
     C**
     C                     CLOSEGL0110PM               66
     C                     OPEN GL0110PM
     C*
     C           *IN66     IFEQ '1'
     C                     MOVE '**ERR**' W0RTN
     C                     ELSE                                           LN0837
     C*                                                                   LN0837
     C* Set up spool file number - Standard Functions  *                  LN0837
     C                     Z-ADD@$FNB     WUSFNB                          LN0837
     C*                                                                   LN0837
     C* ZSFILE - write report rqs - Standard Functions  *                 LN0837
     C                     CALL 'ZSFILE'               90  ZSFILE - write LN0837
     C                     PARM UUSRSQ    UURSQN  5        RCF sequence nuLN0837
     C*********************PARM P3ENTY    UUENTY  3        Entity         LN0958
     C                     PARM BSBRCD    UUENTY  3        Entity         LN0958
     C                     PARM @$FVN     UUSFNM 10        Spool file nameLN0837
     C                     PARM WUSFNB    UUSFNB  60       Spool file numbLN0837
     C           UUZSER    PARM *BLANK    UUZSER  1        ZSFILE error   LN0837
     C*                                                                   LN0837
     C           *IN90     IFEQ '1'                                       LN0837
     C* Call to program ended in error.                                   LN0837
     C                     MOVEL'Y2U0021' W0RTN   7                       LN0837
     C                     END                                            LN0837
     C*                                                                   LN0837
     C* CASE: WRK.ZSFILE is error occurred                                LN0837
     C*                                                                   LN0837
     C*          UUZSER    IFEQ 'Y'                                       LN0837
     C*                    MOVEL'Y2U0004' P0RTN                           LN0837
     C*                    EXSR ZYEXPG                                    LN0837
     C*                    END                                            LN0837
     C                     END
     C                     WRITEZZPAGHDR
     C* Restore Indicator 66
     C                     MOVE UUIN66    *IN66
     C                     END
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PLT2 - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Print Level Total 2
     C/COPY WNCPYSRC,GL0110PLT2
     C*00/Copy Members GL0110P  Print Level Total 2
     C/COPY WNCPYSRC,GL0110PLT2
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * If there is not enough space on the
      * physical page for this format:-
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 2
      * Signal artificial overflow.
     C                     SETON                     97
      * Print page headers.
     C                     WRITEZZPAGHDR
     C                     END
      * Print format.
     C                     WRITEZ6KEYTTL
     C                     END
     C                     END
      *
      * End of file - Print final totals.
     C           W0EOF     IFEQ '1'
     C                     MOVEL'Y'       W0PFM
      * USER: Process End of Report
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PPER - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Process End Of Report
     C/COPY WNCPYSRC,GL0110PPER
     C*00/Copy Members GL0110P  Process End Of Report
     C/COPY WNCPYSRC,GL0110PPER
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * If there is not enough space on the
      * physical page for this format:-
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 0
      * Signal artificial overflow.
     C                     SETON                     97
      * Print page headers.
     C                     WRITEZZPAGHDR
     C                     END
      * Print format.
     C                     WRITEZZFINTTL
     C                     END
     C                     END
      *
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         FASGHD    BEGSR
      *================================================================
      * Signal required header formats.
      *================================================================
      * Cascade skip to new page requests upwards.
      *
      ** Add one by line to print to counter of line.                                      AR1065437
      *                                                                                    AR1065437
     C           CGL125    IFEQ 'Y'                                                        AR1065437
     C           HQJETP    ANDEQ'C'                                                        AR1065437
     C           HQBDTE    IFNE 0                                                          AR1065437
     C           HQPTRS    ORNE *BLANKS                                                    AR1065437
     C                     ADD  1         @$HDL                                            AR1065437
     C                     ENDIF                                                           AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C           *IN97     IFNE '1'
     C           L0        ANDNE'Y'
      * Signal overflow if requested headings would cause
      * detail format to start past the overflow line.
     C           W0OFL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE @$HDL
     C                     SETON                     97
     C                     ELSE
      * Signal overflow if requested headings would cause
      * detail format to be printed past end of page
     C                     ADD  4         @$HDL
     C           W0PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE @$HDL
     C                     SETON                     97
     C                     END
     C                     END
     C                     END
      * Overflow detected.
     C           *IN97     IFEQ '1'
      * Request page headings.
     C                     MOVEL'Y'       L0
      * Request all formats which print on overflow.
     C                     SETOF                     97
     C                     END
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         GARDRC    BEGSR
      *================================================================
      * Read next record with user selection.
      *================================================================
     C           W0RSL     DOUEQ'Y'
     C                     READ @JENSCM                  90*
     C                     MOVEL*IN90     W0EOF   1
      * Quit if no record read.
     C           W0EOF     CABEQ'1'       GAEXIT
      * Select record unless user action states otherwise.
     C                     MOVEL'Y'       W0RSL   1
      * USER: Record selection processing
      * Start of Fix LN0837
      * If the level is for branch and the entity is not all then
      * check that the record to be printed is the same branch as
      * that requested
      *CASE:     PAR.Level is Branch
     C           P2LEVL    IFEQ @CN,05                     *IF
      *CASE:     PAR.Entity is Not All
     C           P3ENTY    IFNE @CN,06                     *IF
      *CASE:     PAR.Entity NE DB1.Branch code
     C           P3ENTY    IFNE BSBRCD                     *IF
     C                     MOVEL@CN,04    W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0837
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PRSP - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Record Selection Proc.
     C/COPY WNCPYSRC,GL0110PRSP
     C*00/Copy Members GL0110P  Record Selection Proc.
     C/COPY WNCPYSRC,GL0110PRSP
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Retrieve Header fields - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define Keylist.
     C           KRSSA     KLIST
     C                     KFLD           BRBTNB           Batch number
      * Move fields to key list.
     C                     MOVELBSBTNB    BRBTNB           Batch number
     C           KRSSA     CHAIN@BRREAH              90    *
      * DBF Record not found.
     C   90                MOVEL'GLX0172' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBRBTNB    WUBTNB           Batch number
     C                     MOVELBRBCDA    WUBCDA           Branch Code - A
     C                     MOVELBRDPCD    WUDPCD           Dept Code
     C                     MOVELBRWSID    WUWSID           Workstation id.
     C                     Z-ADDBRHICC    WUHICC           Hash integer ca
     C                     Z-ADDBRHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDBRHINC    WUHINC           Hash item no.ca
     C                     Z-ADDBRHIIN    WUHIIN           Hash integer in
     C                     Z-ADDBRHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDBRHINI    WUHINI           Hash item no.in
     C                     MOVELBRBTSF    WUBTSF           Batch status fl
     C                     MOVELBRBIUF    WUBIUF           Batch in use fl
     C                     MOVELBRSHPI    WUSHPI           Shadow post ind
     C                     MOVELBRRAPI    WURAPI           Retail advice p
     C                     MOVELBRMBRB    WUMBRB           Multiple Branch
     C                     MOVELBRRVVD    WURVVD           Reversal / Void
     C                     MOVELBRBDES    WUBDES           Batch Descripti
     C                     Z-ADDBRSPTT    WUSPTT           Spread Total   S01333
     C                     Z-ADDBRNIST    WUNIST           No.Items to SprS01340
     C                     MOVELBRSPRF    WUSPRF           Spread Profile S01333
     C                     MOVELBRDCIN    WUDCIN           Debit/credit inS01333
     C                     MOVELBRIBCF    WUIBCF           Input Branch CdS01333
     C                     MOVELBRCUSF    WUCUSF           Customer NumberS01333
     C                     MOVELBRCYCF    WUCYCF           Currency Code  S01333
     C                     MOVELBRACCF    WUACCF           Account Code   S01333
     C                     MOVELBRACSF    WUACSF           Account Seq No.S01333
     C                     MOVELBRNNBF    WUNNBF           Nostro No. (IteS01333
     C                     Z-ADDBRRACF    WURACF           Retail A/c No. S01333
     C                     MOVELBRPRCF    WUPRCF           Profit Centre  S01333
     C                     Z-ADDBRAMTF    WUAMTF           Amount Alloc FmS01340
     C                     MOVELBRIBCT    WUIBCT           Input Branch CdS01333
     C                     MOVELBRCNAT    WUCNAT           Customer NumberS01333
     C                     MOVELBRCYCT    WUCYCT           Currency Code  S01333
     C                     MOVELBRACCT    WUACCT           Account Code   S01333
     C                     MOVELBRASNT    WUASNT           Account Seq No.S01333
     C                     MOVELBRNNBT    WUNNBT           Nostro No. (IteS01333
     C                     Z-ADDBRRACT    WURACT           Retail A/c No. S01333
     C                     MOVELBRTOJE    WUTOJE           Type of JournalS01340
     C                     MOVELBRUSRI    WUUSRI                          CGL008
     C                     MOVELBRUSRA    WUUSRA                          CGL008
     C                     GOTO SAEXIT                     *QUIT
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct.
      *================================================================
      * Terminate program.
     C                     SETON                     LR
      *
      * Exit program.
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
      *****************************************************************                    AR1065437
      *                                                               *                    AR1065437
      * SRCBIF - Subroutine to process additional fields introduced   *                    AR1065437
      *          by CGL125 and CSC054 if CGL125 is ON.                *                    AR1065437
      *                                                               *                    AR1065437
      * Called by: BAPRHD                                             *                    AR1065437
      *                                                               *                    AR1065437
      * Calls: None                                                   *                    AR1065437
      *                                                               *                    AR1065437
      *****************************************************************                    AR1065437
      *                                                                                    AR1065437
     C           SRCBIF    BEGSR                                                           AR1065437
      *                                                                                    AR1065437
     C                     MOVE *ON       *IN98                                            AR1065437
      *                                                                                    AR1065437
     C           BSBTNB    CHAINGLJEHQD0             96                                    AR1065437
      *                                                                                    AR1065437
     C           *IN96     IFEQ *OFF                                                       AR1065437
     C           HQJETP    ANDEQ'C'                                                        AR1065437
     C                     MOVE 'Y'       WCBIM   1                                        AR1065437
      *                                                                                    AR1065437
     C           HQBDTE    IFNE *ZERO                                                      AR1065437
     C                     CALL 'ZDATE2'               90                                  AR1065437
     C                     PARM HQBDTE    WQBDTE  50                                       AR1065437
     C                     PARM WUDTFF    WQDTFF  1                                        AR1065437
     C                     PARM *ZERO     WUDTNF  60                                       AR1065437
     C                     PARM *BLANK    WUDDCD  7                                        AR1065437
     C           *IN90     IFEQ '1'                                                        AR1065437
     C                     MOVEL'Y2U0021' W0RTN   7                                        AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE WUDDCD    ZQBDTE                                           AR1065437
     C                     ENDIF                                                           AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C                     MOVE HQPTRS    ZQPTRS                                           AR1065437
     C                     MOVE HQJETP    ZQJETP                                           AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE 'N'       WCBIM                                            AR1065437
     C                     MOVE *OFF      *IN98                                            AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C                     ENDSR                                                           AR1065437
      *                                                                                    AR1065437
      *****************************************************************                    AR1065437
      /EJECT                                                                               AR1065437
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation.
      *================================================================
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
      * Setup job date/time.
     C                     Z-ADDUDATE     ##JDT            Job date.
     C                     TIME           ##JTM            Job time.
     C                     TIME           ##TME   60       Screen time.
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Batch number
     C                     MOVEL*BLANK    WUBTNB  3
      * Define work field Reversal / Void Indicator
     C                     MOVEL*BLANK    WURVVD  1
      * Define work field Batch Description
     C                     MOVEL*BLANK    WUBDES 30
      * Define work field Spread Total                                    S01333
     C                     Z-ADD*ZERO     WUSPTT 100                      S01333
      * Define work field No. of Items to Spread to                       S01340
     C                     Z-ADD*ZERO     WUNIST  30                      S01340
      * Define work field Spread Profile Code                             S01333
     C                     MOVEL*BLANK    WUSPRF  4                       S01333
      * Define work field Debit/credit indicator                          S01333
     C                     MOVEL*BLANK    WUDCIN  1                       S01333
      * Define work field Input Branch Cd  Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUIBCF  3                       S01333
      * Define work field Customer Number  Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUCUSF  6                       S01333
      * Define work field Currency Code    Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUCYCF  3                       S01333
      * Define work field Account Code     Alloc Fm                       S01333
     C**********           MOVEL*BLANK    WUACCF  4                                    S01333 CGL029
     C                     MOVEL*BLANK    WUACCF 10                                           CGL029
      * Define work field Account Seq No.  Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUACSF  2                       S01333
      * Define work field Nostro No. (Item)Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUNNBF  2                       S01333
      * Define work field Retail A/c No.   Alloc Fm                       S01333
     C                     Z-ADD*ZERO     WURACF 100                      S01333
      * Define work field Profit Centre    Alloc Fm                       S01333
     C                     MOVEL*BLANK    WUPRCF  4                       S01333
      * Define work field Amount           Alloc Fm                       S01340
     C                     Z-ADD*ZERO     WUAMTF 130                      S01340
      * Define work field Input Branch Cd  Alloc To                       S01333
     C                     MOVEL*BLANK    WUIBCT  3                       S01333
      * Define work field Customer Number  Alloc To                       S01333
     C                     MOVEL*BLANK    WUCNAT  6                       S01333
      * Define work field Currency Code    Alloc To                       S01333
     C                     MOVEL*BLANK    WUCYCT  3                       S01333
      * Define work field Account Code     Alloc To                       S01333
     C**********           MOVEL*BLANK    WUACCT  4                                    S01333 CGL029
     C                     MOVEL*BLANK    WUACCT 10                                           CGL029
      * Define work field Account Seq No.  Alloc To                       S01333
     C                     MOVEL*BLANK    WUASNT  2                       S01333
      * Define work field Nostro No. (Item)Alloc To                       S01333
     C                     MOVEL*BLANK    WUNNBT  2                       S01333
      * Define work field Retail A/c No.   Alloc To                       S01333
     C                     Z-ADD*ZERO     WURACT 100                      S01333
      * Define work field Type of Journal Entry                           S01340
     C                     MOVEL*BLANK    WUTOJE  1                       S01340
      * Define work field Branch Code - Alpha
     C                     MOVEL*BLANK    WUBCDA  3
      * Define work field Dept Code
     C                     MOVEL*BLANK    WUDPCD  3
      * Define work field Workstation id.
     C                     MOVEL*BLANK    WUWSID 10
      * Define work field Hash integer calculated
     C                     Z-ADD*ZERO     WUHICC 150
      * Define work field Hash decimal calculated
     C                     Z-ADD*ZERO     WUHDCC  30
      * Define work field Hash item no.calculated
     C                     Z-ADD*ZERO     WUHINC  30
      * Define work field Hash integer input
     C                     Z-ADD*ZERO     WUHIIN 150
      * Define work field Hash decimal input
     C                     Z-ADD*ZERO     WUHDIN  30
      * Define work field Hash item no.input
     C                     Z-ADD*ZERO     WUHINI  30
      * Define work field Batch status flag
     C                     MOVEL*BLANK    WUBTSF  1
      * Define work field Batch in use flag
     C                     MOVEL*BLANK    WUBIUF  1
      * Define work field Shadow post indicator
     C                     MOVEL*BLANK    WUSHPI  1
      * Define work field Retail advice print ind.
     C                     MOVEL*BLANK    WURAPI  1
      * Define work field Multiple Branch Batch
     C                     MOVEL*BLANK    WUMBRB  1
      * Define work field Batch in use msg. 1
     C                     MOVEL*BLANK    WUBUM1 25
      * Define work field Batch in use msg. 2
     C                     MOVEL*BLANK    WUBUM2 25
      * Define work field Batch in use msg. 3
     C                     MOVEL*BLANK    WUBUM3 25
      * Define work field Batch in use msg. 4
     C                     MOVEL*BLANK    WUBUM4 25
      * Define work field Batch in use msg. 5
     C                     MOVEL*BLANK    WUBUM5 25
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Currency Diff Total (GL)
     C                     Z-ADD*ZERO     WUCDTN 150
      * Define work field Spool File Name
     C                     MOVEL*BLANK    WUSFNM 10
      * Define work field Spool File Number
     C                     Z-ADD*ZERO     WUSFNB  60
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      *                                                                   CGL008
      ** Define work fields for Last Insert User and Last Amend User      CGL008
      *                                                                   CGL008
     C                     MOVE *BLANKS   WUUSRI 10                       CGL008
     C                     MOVE *BLANKS   WUUSRA 10                       CGL008
      * Obtain default message file.
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field ZSFile Error
     C                     MOVEL*BLANK    WUZSER  1
     C                     MOVEL*BLANK    W0PFM   1
     C                     Z-ADD*ZERO     @$WRK   40
     C                     Z-ADD*ZERO     @$HDL   40
      **Adjust*page*length*and*overflow*as*necessary*******************   CGL008
     C***********@$PGL     SUB  2         W0PGL   40                      CGL008
     C***********@$OFL     IFGE W0PGL                                     CGL008
     C***********W0PGL     SUB  2         W0OFL   40                      CGL008
     C***********          ELSE                                           CGL008
     C***********          Z-ADD@$OFL     W0OFL                           CGL008
     C***********          END                                            CGL008
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box GL0110P - Journal Entry Summary  *
      * Copyright notice - Standard functions  *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * access bank title - Standard functions  *
      *                                                                   S01117
      *****P@BJRF    E DSSDBANKPD                                         S01117
      * @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C                     MOVELBJURPT    ##URPT
      *                                                                   CGL008
      **  Access SAR details file to see if CGL008 SAR is installed       CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     MOVE *ON       *IN22                           CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
      ** Access SAR details file to see if CGL125 is installed.                            AR1065437
      *                                                                                    AR1065437
     C                     MOVE *OFF      *IN98                                            AR1065437
      *                                                                                    AR1065437
     C                     CALL 'AOSARDR0'                                                 AR1065437
     C                     PARM *BLANKS   @RTCD                                            AR1065437
     C                     PARM '*VERIFY' @OPTN                                            AR1065437
     C                     PARM 'CGL125'  @SARD                                            AR1065437
      *                                                                                    AR1065437
     C           @RTCD     IFEQ *BLANK                                                     AR1065437
     C                     MOVE 'Y'       CGL125  1                                        AR1065437
     C                     MOVE *ON       *IN98                                            AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE 'N'       CGL125                                           AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C/COPY WNCPYSRC,GL0110PC02
      * Setup message data for message.
      * Retrieve message 'Batch in use message 1'
     C                     MOVELZADFMF    ZAMSGF           Default message
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code.
     C                     PARM 'GLX0093' ZAMSID  7        Message id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C           WUBUM1    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Setup message data for message.
      * Retrieve message 'Batch in use message 2'
     C                     MOVELZADFMF    ZAMSGF           Default message
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code.
     C                     PARM 'GLX0094' ZAMSID  7        Message id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C           WUBUM2    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Setup message data for message.
      * Retrieve message 'Batch in use message 3'
     C                     MOVELZADFMF    ZAMSGF           Default message
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code.
     C                     PARM 'GLX0095' ZAMSID  7        Message id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C           WUBUM3    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Setup message data for message.
      * Retrieve message 'Batch in use message 4'
     C                     MOVELZADFMF    ZAMSGF           Default message
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code.
     C                     PARM 'GLX0096' ZAMSID  7        Message id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C           WUBUM4    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Setup message data for message.
      * Retrieve message 'Batch in use message 5'
     C                     MOVELZADFMF    ZAMSGF           Default message
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code.
     C                     PARM 'GLX0097' ZAMSID  7        Message id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C           WUBUM5    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Define 200 Byte Dummy DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Department Codes DS - Department Codes  *
      * Start of Fix BHF666
      * Define 800 Byte Dummy DS - Standard functions  *
      * Currency Codes DS - Currency Codes  *
      * End of Fix BHF666
      * Declare Bank File DS - Standard functions  *
      * Start of Fix LN0714
      * Set up Title - Journal Entry Summary  *
     C                     MOVEAUHDR,1    ##REPT
     C                     MOVEAUHDR,2    ##UNDL
      **ZSFile*-*Log*Spool*File*-*Standard*functions**********************LN0955
     C********************************************************************LN0955
     C**Set*up*spool*file*number*-*Standard*Functions*********************LN0955
     C*********************Z-ADD@$FNB     WUSFNB                          LN0955
     C*********************MOVE *BLANKS   UUSRSQ  5                       LN0955
     C********************************************************************LN0955
     C**ZSFILE*-*write*report*rqs*-*Standard*Functions********************LN0955
     C*********************CALL 'ZSFILE'               90  ZSFILE - write LN0955
     C*********************PARM #IRSQN    UURSQN  5        RCF sequence nuLN0837
     C***********UUSRSQ****PARM P1RSQN    UURSQN  5        RCF sequence nuLN0955
     C*********************PARM P3ENTY    UUENTY  3        Entity         LN0955
     C*********************PARM @$FVN     UUSFNM 10        Spool file nameLN0955
     C*********************PARM WUSFNB    UUSFNB  60       Spool file numbLN0955
     C***********WUZSER****PARM *BLANK    UUZSER  1        ZSFILE error   LN0955
     C********************************************************************LN0955
     C************IN90*****IFEQ '1'                                       LN0955
     C**Call*to*program*ended*in*error.***********************************LN0955
     C*********************MOVEL'Y2U0021' W0RTN   7                       LN0955
     C*********************END                                            LN0955
     C********************************************************************LN0955
     C**CASE:*WRK.ZSFILE*is*error*occurred********************************LN0955
     C********************************************************************LN0955
     C***********#OZSER****IFEQ 'Y'                                       LN0955
     C*********************MOVEL'Y2U0004' P0RTN                           LN0955
     C*********************EXSR ZYEXPG                                    LN0955
     C*********************END                                            LN0955
      * End of Fix LN0714
     C                     MOVEL@CN,01    WUFKST           S01212
      *CASE:     WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ @CN,01                     *IF
      * 00/Copy Member GL0110PIPG - Journal Entry Summary  *
     C*00/Copy Member GL0110P   Initialise Program C-Spec
     C/COPY WNCPYSRC,GL0110PCPG
     C                     END                             *FI
      *================================================================
     CSR         ZZEXIT    ENDSR
     O*00/Copy Member GL0110P   Initialise Program O-Spec
     O/COPY WNCPYSRC,GL0110POPG
** CPY@
(c) Misys International Banking Systems Ltd. 2001
** UHDR
   JOURNAL ENTRIES:- BATCH/CURRENCY - ALL BATCHES
   ----------------------------------------------
** @CN Long constants used in program.
Y
1
*KEY
N
B
ALL
