     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL JEs rpt: batch/ccy-one branch')               *
     H/TITLE Midas GL Currency Branch Report
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Print report of file contents
      *
     H* Generated by  : SYNON/2  Version:  9054
     H* Function type : Print file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : F7867PC
     H* Date          : 15/02/92  Time  : 00:03:30
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F********************************************************************
     F*                                                                  *
      *  Last Amend No. CGL182             Date 11May17               *
      *  Prev Amend No. AR1065437          Date 23Jan13               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CGL008             Date 08Mar99               *
      *                 E38270             Date 06Jul92               *
      *                 LN0882             DATE 10Oct90               *
     F*          AMEND NO. BHF667            DATE 20SEP90                *
     F*          AMEND NO. LN0714            DATE 17SEP90                *
     F*          AMEND NO. S01212            DATE 17SEP90                *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
      *  CGL182 - Journal Entry via the Interface File - Java Version *
      *           (Recompile)                                         *
      *  AR1065437 - Extra fields on PEA Audit Report                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL008 - Security on Journal Entry                           *
     F*     E38270 - RECOMPILE FOR CHANGES TO PRINTER FILE
     F*     LN0882 - STANDARDISE REPORT TITLES                           *
     F*     BHF667 - FORMAT TOTALS CORRECTLY                             *
     F*     LN0714 - ADD RCF                                             *
     F*     S01212 - /Copy and Window Processing                         *
     F*                                                                  *
     F********************************************************************
     F*00/Copy Member GL0111P   Initialise Program F-Spec
     F/COPY WNCPYSRC,GL0111PFPG
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENSL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Summary Rtv
      *
     FGLJENQL0IF  E           K        DISK                                                AR1065437
      ** RTV: Journal Entry Detail Extension File                                          AR1065437
      *                                                                                    AR1065437
     FGL0111PMO   E             97     PRINTER
     F                                              KINFDS INFDS$
      * PRT: Midas GL Currency Branch Report
      *
     E                    CPY@    1   1 80               Copyright     array
     E                    UHDR    1   2 53
     E*00/Copy Member GL0111P   Initialise Program E-Spec
     E/COPY WNCPYSRC,GL0111PEPG
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*00/Copy Member GL0111P   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0111PIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@DEPT    E DSSDDEPTPD
     I*
     I*  Department Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IINFDS$    E DSY2I$DSP
      * Printer file information data structure
      *
     I            DS
     I                                        1   30ULVAL2
     I                                        1   99ULVALD
      * Set up parameters :
      /EJECT
      * Parameter declarations
     IP1PARM      DS                              5
      * KEY: Midas GL Journal Entry Posting Rtv
      * I : RST Batch number
     I                                        1   3 P1BTNB
     IP2PARM      DS
      * I :  RCF Sequence Number
     I                                        1   5 P2RSQN
     IP3PARM      DS
      * I :  Level
     I                                        1   1 P3LEVL
     IP4PARM      DS
      * I :  Entity
     I                                        1   3 P4ENTY
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Journal En
     C           P2RSQN    PARM           WP0001  5        RCF Sequence Nu
     C           P3LEVL    PARM           WP0002  1        Level
     C           P4ENTY    PARM           WP0003  3        Entity
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
      * Currency Branch Report: Mainline
     C                     EXSR A0MAIN
      * Print headers then End of report format
     C                     EXSR Q0PRNT
     C                     WRITE$JENDRPT
      * Exit program
     C                     EXSR ZXEXPG
      * ------------------------------------------------------
      /EJECT
     CSR         A0MAIN    BEGSR
      *================================================================
      * Currency Branch Report: Mainline
      *================================================================
      * Declare restrictor key work fields
     C           *LIKE     DEFN BSBTNB    WQKA01           Batch number
      * Define keylist
     C           KRSA      KLIST
     C                     KFLD           WQKA01           Batch number
      * Move fields to key list
     C                     MOVELP1BTNB    WQKA01           Batch number
      * Establish starting position
     C           KRSA      SETLL@BSREAJ                    *
      * Read first record with user selection
     C                     EXSR A3READ
     C           W0EOFA    IFNE '0'                        IF
      * USER: Null report processing
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PNRP - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Null Report Processing
     C/COPY WNCPYSRC,GL0111PNRP
     C                     END                             *FI
     C                     ELSE
      * Request all headings
     C                     MOVEL'Y'       W0AL1P  1        First page
     C                     MOVEL'Y'       W0AL00  1        Batch number
     C                     MOVEL'Y'       W0AL01  1        Currency code
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
      * Print report body
     C           W0EOFA    DOWEQ'0'                        DOW
      * Prepare heading formats for printing
     C                     EXSR A1PHDR
      * Print report detail line
     C                     EXSR A2PDTL
      * Read next record with user selection
     C                     EXSR A3READ
      * Print totals
     C                     EXSR A4PTOT
     C                     END                             WOD
     C                     END                             FI
      *================================================================
     CSR         A0EXIT    ENDSR
      /EJECT
     CSR         A1PHDR    BEGSR
      *================================================================
      * Prepare heading formats for printing
      *================================================================
     C           W0AL1P    IFEQ 'Y'
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP1P  1
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
      * Load key header format
     C                     MOVELBSBTNB    $DBTNB           Batch number
     C                     MOVEL*BLANK    $DBSTS           Batch status
     C                     MOVEL*BLANK    $DBSTD           Batch Status (D
     C                     MOVEL*BLANK    $DBDSC           batch descripti
     C                     MOVEL*BLANK    $DBCDP           Branch Code (Pr
     C                     MOVEL*BLANK    $DBNMD           Branch name (di
     C                     MOVEL*BLANK    $DFMA2           Formatted amoun
     C                     MOVEL*BLANK    $DDCDP           Department Code
     C                     MOVEL*BLANK    $DDNDS           Department name
     C                     MOVEL*BLANK    $DFMAM           Formatted amoun
     C                     MOVEL*BLANK    $DMBIP           Multiple Branch
     C                     Z-ADD*ZERO     $DIINP           Items Input (Pr
     C                     MOVEL*BLANK    $DREVI           Reversal/void i
     C                     MOVEL*BLANK    $DTIDP           Terminal I.D. (
     C                     Z-ADD*ZERO     $DICLP           Items Calculate
      * Load related totals format
     C                     MOVELBSBTNB    $HBTNB           Batch number
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP00  1
     C                     END
      *
     C           W0AL01    IFEQ 'Y'
      * Load key header format
     C                     MOVELBSBTNB    $EBTNB           Batch number
     C                     MOVELBSCYCD    $ECYCD           Currency code
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0AP01  1
     C                     END
      *
      *================================================================
     CSR         A1EXIT    ENDSR
      /EJECT
     CSR         A2PDTL    BEGSR
      *================================================================
      * Process detail record
      *================================================================
      * Load details format
     C                     MOVELBSCYCD    $FCYCD           Currency code
     C                     MOVELBSBRCD    $FBRCD           Branch code
     C                     MOVEL*BLANK    $FFMDR           Formatted Debit
     C                     MOVEL*BLANK    $FFMCR           Formatted Credi
     C                     MOVEL*BLANK    $FFMDF           Formatted Diffe
     C                     MOVEL*BLANK    $FWNFF           Window Function
     C                     MOVEL*BLANK    $FWNF1           Window Function
     C                     MOVEL*BLANK    $FWNF2           Window Function
     C                     MOVELBSBTNB    $FBTNB           Batch number
     C                     Z-ADDBSDBTT    $FDBTT           Debit total
     C                     Z-ADDBSCRTT    $FCRTT           Credit total
      * Signal that format is now ready to print
     C                     MOVE 'Y'       W0APDT  1
      * Call print routine
     C                     EXSR Q0PRNT
      *
      *================================================================
     CSR         A2EXIT    ENDSR
      /EJECT
     CSR         A3READ    BEGSR
      *================================================================
      * Read next record
      *================================================================
      * Hold current values
     C           *LIKE     DEFN BSBTNB    WZA001           Batch number
     C                     MOVELBSBTNB    WZA001
     C           *LIKE     DEFN BSCYCD    WZA002           Currency code
     C                     MOVELBSCYCD    WZA002
      * Read next record
     C           W0RSL     DOUEQ'Y'                        DOU
     C           W0EOFA    OREQ '1'
     C           KRSA      READE@BSREAJ                  90*
      * Transfer error indicator to EOF flag
     C                     MOVEL*IN90     W0EOFA  1
      * Quit if no record read
     C           W0EOFA    IFNE '1'                        IF
      * Select record unless user action states otherwise
     C                     MOVEL'Y'       W0RSL   1
      * USER: Record selection processing
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PRSP - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Record Selection Proc.
     C/COPY WNCPYSRC,GL0111PRSP
     C                     END                             *FI
     C                     END                             FI
     C                     END                             UOD
      *
      * Reset key level breaks
     C                     MOVEL*BLANK    W0AL00  1        Batch number
     C                     MOVEL*BLANK    W0AL01  1        Currency code
     C           W0EOFA    IFEQ '1'
      * End of file - Signal all level breaks
     C                     MOVEL'Y'       W0AL00  1        Batch number
     C                     MOVEL'Y'       W0AL01  1        Currency code
     C                     ELSE
      * Next record - Detect level breaks
     C           BSBTNB    IFNE WZA001                     Batch number
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL00
     C                     END
     C           BSCYCD    IFNE WZA002                     Currency code
     C           W0AL00    OREQ 'Y'
      * Set on level break indicator
     C                     MOVEL'Y'       W0AL01
     C                     END
     C                     END
      *================================================================
     CSR         A3EXIT    ENDSR
      /EJECT
     CSR         A4PTOT    BEGSR
      *================================================================
      * Print report Totals
      *================================================================
      * Print level break totals as required
     C           W0AL01    IFEQ 'Y'
      * USER: On print of Currency code format
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PLT1 - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Print Level Total 1
     C/COPY WNCPYSRC,GL0111PLT1
     C                     END                             *FI
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP01
     C                     END
      *
     C           W0AL00    IFEQ 'Y'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of Batch number format
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PLT0 - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Print Level Total 0
     C/COPY WNCPYSRC,GL0111PLT0
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * If there is not enough space on the
      * physical page for this format:
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 1
      * Signal new page required
     C                     MOVE 'Y'       W0NEWP
      * Start new page
     C                     EXSR Q0PRNT
     C                     END
      * Print format
     C                     WRITE$HKEYTTL
     C                     END
      * Signal header format is no longer ready
     C                     MOVEL*BLANK    W0AP00
     C                     END
      *
     C           W0EOFA    IFEQ '1'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of final totals format
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PPER - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Process End Of Report
     C/COPY WNCPYSRC,GL0111PPER
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * If there is not enough space on the
      * physical page for this format:
     C           @$PGL     SUB  @$CLN     @$WRK
     C           @$WRK     IFLE 2
      * Signal new page required
     C                     MOVE 'Y'       W0NEWP
      * Start new page
     C                     EXSR Q0PRNT
     C                     END
      * Print format
     C                     WRITE$IFINTTL
     C                     END
     C                     END
      *
      *================================================================
     CSR         A4EXIT    ENDSR
      /EJECT
     CSR         Q0PRNT    BEGSR
      *================================================================
      * Print report formats
      *================================================================
      * Select formats to print
     C                     EXSR Q1FSEL
      * Calculate length of formats selected for printing
     C                     EXSR Q2PLEN
      * Add column heading length to print length
     C                     ADD  W0COLN    W0FSUM
     C           W0NEWP    IFNE 'Y'
      * Signal overflow if requested headings would cause
      * detail format to start past the overflow line
     C           W0FSUM    IFGT W0OFL
     C                     MOVE 'Y'       W0NEWP
     C                     ELSE
      * Signal overflow if requested headings would cause
      * Detail format to be printed past end of page
     C                     ADD  W0DTLN    W0FSUM
     C           W0FSUM    IFGT W0PGL
     C                     MOVE 'Y'       W0NEWP
     C                     END
     C                     END
     C                     END
      * Set new page flag if external overflow occured
     C           *IN97     IFEQ '1'
     C                     MOVE 'Y'       W0NEWP
     C                     END
      * Print Standard report header of Currency Branch Report
      * If it is ready to print, then do so,
     C           W0NEWP    IFEQ 'Y'                        IF
     C                     EXSR Q3PTNP
     C                     END                             FI
      *
      * Print First Page Format of Currency Branch Report
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP1P    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP1P    ANDEQ'P'
      * Reset format print flag
     C                     MOVE *BLANK    W0AP1P
      * Clear first page flag.
     C                     MOVE *BLANK    W0AL1P
     C                     END                             FI
      * Print Batch number of Currency Branch Report
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP00    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP00    ANDEQ'P'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of Batch number format
      * Hash numeric to character - Standard functions  *
     C                     Z-ADDWUHIIN    ULVALI           Integer portion
     C                     Z-ADD*ZERO     ULVALD           Set Decimal
     C                     Z-ADDWUHDIN    ULVAL2           Decimal portion
      *
     C                     CALL 'GL0138U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALI 150       I:Integer
     C                     PARM ULVALD    ULVAL3  99       I:Decimal
     C                     PARM 3         ULDECP  10       I:Decimal place
     C                     PARM '1'       ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLT 32        O:Formatted
      *
     C                     MOVE ULRSLT    $DFMA2           Formatted data
      *
      * Start of Fix BHF667
      * Hash numeric to character - Standard functions  *
     C                     Z-ADDWUHICC    ULVALI           Integer portion
     C                     Z-ADD*ZERO     ULVALD           Set Decimal
     C                     Z-ADDWUHDCC    ULVAL2           Decimal portion
     C                     CALL 'GL0138U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALI 150       I:Integer
     C                     PARM ULVALD    ULVAL3  99       I:Decimal
     C                     PARM 3         ULDECP  10       I:Decimal place
     C                     PARM '1'       ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLT 32        O:Formatted
     C                     MOVE ULRSLT    $DFMAM           Formatted data
      * End of Fix BHF667
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELWUBCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    $DBCDP           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    $DBNMD           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Access Department. - Department Codes  *
     C*
     C*  Access Department codes file for the following field:
     C*  Department Name
     C*
     C                     MOVELWUDPCD    UUDPCD
     C                     CALL 'AODEPTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUDPCD  3        I:Department Code
     C           D@DEPT    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELAEDPCD    $DDCDP           Department Code
     C                     MOVELAEDPNM    $DDNDS           Department Name
     C*
     C                     MOVELWUMBRB    $DMBIP           Multiple Branch
      * CUR.Batch Status (Display) = Condition name of WRK.Batch status flag
     C                     CALL 'MIRVCNR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1100442   Y2LSNO  70       List number
     C                     PARM WUBTSF    W0INVL 20        Batch status fl
     C                     PARM 'N'       W0VLMP  1        Value mapped
     C           $DBSTD    PARM           W0CNNM 25        Batch Status (D
      *
     C                     MOVELWUBDES    $DBDSC           batch descripti
     C                     MOVELWUBTNB    $DBTNB           Batch number
     C                     MOVELWUWSID    $DTIDP           Terminal I.D. (
     C                     Z-ADDWUHINI    $DIINP           Items Input (Pr
     C                     Z-ADDWUHINC    $DICLP           Items Calculate
      *                                                                   CGL008
      ** If feature CGL008 is ON, retrieve the last Insert & Amend User   CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
     C                     MOVELWUUSRI    $DUSRI                          CGL008
     C                     MOVELWUUSRA    $DUSRA                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C/COPY WNCPYSRC,GL0111PC01
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PLH0 - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Print Level Heading 0
     C/COPY WNCPYSRC,GL0111PLH0
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * Convert fields to external form
     C**********           MOVEL'0'       *IN79                           E38270
     C                     MOVEL'0'       *IN80                           E38270
     C           WUMBIN    IFEQ 'N'                        *IF
     C**********           MOVEL'1'       *IN79                           E38270
     C                     MOVEL'1'       *IN80                           E38270
     C                     END                             *FI
      * Print format
     C                     WRITE$DKEYHDR
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
     C                     END                             FI
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0AP00
     C                     END                             FI
      * Print Currency code of Currency Branch Report
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0AP01    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0AP01    ANDEQ'P'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of Currency code format
      * Start of Fix BHF667
      * retrieve number of decimal places of the current currency
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVELBSCYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * End of Fix BHF667
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PLH1 - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Print Level Heading 1
     C/COPY WNCPYSRC,GL0111PLH1
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
      * Print format
     C                     WRITE$EKEYHDR
      * Set column headings flag
     C                     MOVE 'Y'       W0ACDT
     C                     END                             FI
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0AP01
     C                     END                             FI
      * Print Detail line. of Currency Branch Report
      * If new page then set column headings active
     C           W0NEWP    IFEQ 'Y'
     C                     MOVE 'Y'       W0ACDT  1
     C                     END
      * If it is ready to print, then do so,
      * or if new page & print on new page selected &
      * active then set print format flag
     C           W0APDT    IFEQ 'Y'                        IF
     C           W0NEWP    OREQ 'Y'
     C           W0APDT    ANDEQ'P'
     C                     MOVEL'Y'       W0PFM
      * USER: On print of detail format
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM $FDBTT    WQ0001 150       Value
     C                     PARM WUNBDP    WQ0002  10       Decimal places
     C                     PARM '1'       WQ0003  1        Edit code
     C                     PARM *BLANK    WQ0004  1        Cheque protect
     C           $FFMDR    PARM *BLANK    WQ0005 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM $FCRTT    WQ0006 150       Value
     C                     PARM WUNBDP    WQ0007  10       Decimal places
     C                     PARM '1'       WQ0008  1        Edit code
     C                     PARM *BLANK    WQ0009  1        Cheque protect
     C           $FFMCR    PARM *BLANK    WQ0010 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C           $FDBTT    SUB  $FCRTT    WUCDTN           Currency Diff T
      * Format Amount - Standard functions  *
     C                     CALL 'GL0135U'              90  Format Amount
     C                     PARM WUCDTN    WQ0011 150       Value
     C                     PARM WUNBDP    WQ0012  10       Decimal places
     C                     PARM '1'       WQ0013  1        Edit code
     C                     PARM *BLANK    WQ0014  1        Cheque protect
     C           $FFMDF    PARM *BLANK    WQ0015 23        Formatted amoun
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PPDR - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Process Detail Record
     C/COPY WNCPYSRC,GL0111PPDR
     C                     END                             *FI
     C           W0PFM     IFEQ 'Y'
     C                     MOVEL'0'       *IN79
     C           $FWNFF    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN78
     C           $FWNF1    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           $FWNF2    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
      * Print column headings if required
     C           W0ACDT    IFEQ 'Y'
     C                     WRITE$FCOLHDG
      * Clear column headings control flag
     C                     MOVE *BLANK    W0ACDT
     C                     END                             FI
      * Print format
     C                     WRITE$FDTLRCD
     C                     END                             FI
      *
      * Reset format print flag
     C                     MOVE *BLANK    W0APDT
     C                     END                             FI
      * Clear new page flag
     C                     MOVE *BLANK    W0NEWP
      *================================================================
     CSR         Q0EXIT    ENDSR
      /EJECT
     CSR         Q1FSEL    BEGSR
      *================================================================
      * Format select
      *================================================================
      *================================================================
     CSR         Q1EXIT    ENDSR
      /EJECT
     CSR         Q2PLEN    BEGSR
      *================================================================
      * Evaluate print length
      *================================================================
     C                     Z-ADD@$CLN     W0FSUM  30
     C                     Z-ADD*ZERO     W0DTLN  30
     C                     Z-ADD*ZERO     W0COLN  30
      * * First Page Format of Currency Branch Report
     C           W0AP1P    IFEQ 'Y'
     C                     ADD  0         W0FSUM
     C                     END                             FI
      *
      * * Batch number of Currency Branch Report
     C           W0AP00    IFEQ 'Y'
     C                     ADD  6         W0FSUM
     C                     END                             FI
      *
      * * Currency code of Currency Branch Report
     C           W0AP01    IFEQ 'Y'
     C                     ADD  3         W0FSUM
     C                     END                             FI
      *
      * * Detail line. of Currency Branch Report
     C           W0APDT    IFEQ 'Y'
     C                     Z-ADD4         W0DTLN
     C           W0ACDT    IFEQ 'Y'
     C                     Z-ADD0         W0COLN
     C                     END                             FI
     C                     END                             FI
      *
      *================================================================
     CSR         Q2EXIT    ENDSR
      /EJECT
     CSR         Q3PTNP    BEGSR
      *================================================================
      * Format select
      *================================================================
     C                     WRITE$APAGHDR
      * Clear page overflow indicator
     C                     SETOF                     97    *
      *================================================================
     CSR         Q3EXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Retrieve Header fields - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           BRBTNB           Batch number
      * Move fields to key list
     C                     MOVELP1BTNB    BRBTNB           Batch number
     C           KRSSA     CHAIN@BRREAH              90    *
      * DBF record not found
     C   90                MOVEL'GLX0172' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBRBTNB    WUBTNB           Batch number
     C                     MOVELBRBCDA    WUBCDA           Branch Code - A
     C                     MOVELBRDPCD    WUDPCD           Dept Code
     C                     MOVELBRWSID    WUWSID           Workstation id.
     C                     Z-ADDBRHICC    WUHICC           Hash integer ca
     C                     Z-ADDBRHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDBRHINC    WUHINC           Hash item no.ca
     C                     Z-ADDBRHIIN    WUHIIN           Hash integer in
     C                     Z-ADDBRHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDBRHINI    WUHINI           Hash item no.in
     C                     MOVELBRBTSF    WUBTSF           Batch status fl
     C                     MOVELBRBIUF    WUBIUF           Batch in use fl
     C                     MOVELBRSHPI    WUSHPI           Shadow post ind
     C                     MOVELBRRAPI    WURAPI           Retail advice p
     C                     MOVELBRMBRB    WUMBRB           Multiple Branch
     C                     MOVELBRRVVD    WURVVD           Reversal / Void
     C                     MOVELBRBDES    WUBDES           Batch Descripti
     C                     Z-ADDBRSPTT    WUSPTT           Spread Total
     C                     Z-ADDBRNIST    WUNIST           No. of Items to
     C                     MOVELBRSPRF    WUSPRF           Spread Profile
     C                     MOVELBRDCIN    WUDCIN           Debit/credit in
     C                     MOVELBRIBCF    WUIBCF           Input Branch Cd
     C                     MOVELBRCUSF    WUCUSF           Customer Number
     C                     MOVELBRCYCF    WUCYCF           Currency Code
     C                     MOVELBRACCF    WUACCF           Account Code
     C                     MOVELBRACSF    WUACSF           Account Seq No.
     C                     MOVELBRNNBF    WUNNBF           Nostro No. (Ite
     C                     Z-ADDBRRACF    WURACF           Retail A/c No.
     C                     MOVELBRPRCF    WUPRCF           Profit Centre
     C                     Z-ADDBRAMTF    WUAMTF           Amount
     C                     MOVELBRIBCT    WUIBCT           Input Branch Cd
     C                     MOVELBRCYCT    WUCYCT           Currency Code
     C                     MOVELBRCNAT    WUCNAT           Customer Number
     C                     MOVELBRACCT    WUACCT           Account Code
     C                     MOVELBRASNT    WUASNT           Account Seq No.
     C                     MOVELBRNNBT    WUNNBT           Nostro No. (Ite
     C                     Z-ADDBRRACT    WURACT           Retail A/c No.
     C                     MOVELBRTOJE    WUTOJE           Type of Journal
     C                     MOVELBRUSRI    WUUSRI                          CGL008
     C                     MOVELBRUSRA    WUUSRA                          CGL008
     C                     GOTO SAEXIT                     *QUIT
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
      *****************************************************************                    AR1065437
      *                                                               *                    AR1065437
      * SRCBIF - Subroutine to process additional fields introduced   *                    AR1065437
      *          by CGL125 and CSC054 if CGL125 is ON.                *                    AR1065437
      *                                                               *                    AR1065437
      * Called by: ZZINIT                                             *                    AR1065437
      *                                                               *                    AR1065437
      * Calls: None                                                   *                    AR1065437
      *                                                               *                    AR1065437
      *****************************************************************                    AR1065437
      *                                                                                    AR1065437
     C           SRCBIF    BEGSR                                                           AR1065437
      *                                                                                    AR1065437
     C                     MOVE *ON       *IN98                                            AR1065437
      *                                                                                    AR1065437
     C           BRBTNB    CHAINGLJEHQD0             96                                    AR1065437
      *                                                                                    AR1065437
     C           *IN96     IFEQ *OFF                                                       AR1065437
     C           HQJETP    ANDEQ'C'                                                        AR1065437
     C                     MOVE 'Y'       WCBIM   1                                        AR1065437
      *                                                                                    AR1065437
     C           HQBDTE    IFNE *ZERO                                                      AR1065437
     C                     CALL 'ZDATE2'               90                                  AR1065437
     C                     PARM HQBDTE    WQBDTE  50                                       AR1065437
     C                     PARM WUDTFF    WQDTFF  1                                        AR1065437
     C                     PARM *ZERO     WUDTNF  60                                       AR1065437
     C                     PARM *BLANK    WUDDCD  7                                        AR1065437
     C           *IN90     IFEQ '1'                                                        AR1065437
     C                     MOVEL'Y2U0021' W0RTN   7                                        AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE WUDDCD    ZQBDTE                                           AR1065437
     C                     ENDIF                                                           AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C                     MOVE HQPTRS    ZQPTRS                                           AR1065437
     C                     MOVE HQJETP    ZQJETP                                           AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE 'N'       WCBIM                                            AR1065437
     C                     MOVE *OFF      *IN98                                            AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C                     ENDSR                                                           AR1065437
      *                                                                                    AR1065437
      *****************************************************************                    AR1065437
      /EJECT                                                                               AR1065437
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      *                                                                   CGL008
      ** Define work fields for Last Insert User and Last Amend User      CGL008
      *                                                                   CGL008
     C                     MOVE *BLANKS   WUUSRI 10                       CGL008
     C                     MOVE *BLANKS   WUUSRA 10                       CGL008
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Spool File Name
     C                     MOVEL*BLANK    WUSFNM 10
      * Define work field Spool File Number
     C                     Z-ADD*ZERO     WUSFNB  60
      * Define work field ZSFile Error
     C                     MOVEL*BLANK    WUZSER  1
      * Define work field Batch number
     C                     MOVEL*BLANK    WUBTNB  3
      * Define work field Branch Code - Alpha
     C                     MOVEL*BLANK    WUBCDA  3
      * Define work field Dept Code
     C                     MOVEL*BLANK    WUDPCD  3
      * Define work field Workstation id.
     C                     MOVEL*BLANK    WUWSID 10
      * Define work field Hash integer calculated
     C                     Z-ADD*ZERO     WUHICC 150
      * Define work field Hash decimal calculated
     C                     Z-ADD*ZERO     WUHDCC  30
      * Define work field Hash item no.calculated
     C                     Z-ADD*ZERO     WUHINC  30
      * Define work field Hash integer input
     C                     Z-ADD*ZERO     WUHIIN 150
      * Define work field Hash decimal input
     C                     Z-ADD*ZERO     WUHDIN  30
      * Define work field Hash item no.input
     C                     Z-ADD*ZERO     WUHINI  30
      * Define work field Batch status flag
     C                     MOVEL*BLANK    WUBTSF  1
      * Define work field Batch in use flag
     C                     MOVEL*BLANK    WUBIUF  1
      * Define work field Shadow post indicator
     C                     MOVEL*BLANK    WUSHPI  1
      * Define work field Retail advice print ind.
     C                     MOVEL*BLANK    WURAPI  1
      * Define work field Multiple Branch Batch
     C                     MOVEL*BLANK    WUMBRB  1
      * Define work field Reversal / Void Indicator
     C                     MOVEL*BLANK    WURVVD  1
      * Define work field Batch Description
     C                     MOVEL*BLANK    WUBDES 30
      * Define work field Spread Total
     C                     Z-ADD*ZERO     WUSPTT 100
      * Define work field No. of Items to Spread to
     C                     Z-ADD*ZERO     WUNIST  30
      * Define work field Spread Profile Code
     C                     MOVEL*BLANK    WUSPRF  4
      * Define work field Debit/credit indicator
     C                     MOVEL*BLANK    WUDCIN  1
      * Define work field Input Branch Cd  Alloc Fm
     C                     MOVEL*BLANK    WUIBCF  3
      * Define work field Customer Number  Alloc Fm
     C                     MOVEL*BLANK    WUCUSF  6
      * Define work field Currency Code    Alloc Fm
     C                     MOVEL*BLANK    WUCYCF  3
      * Define work field Account Code     Alloc Fm
     C**********           MOVEL*BLANK    WUACCF  4                                           CGL029
     C                     MOVEL*BLANK    WUACCF 10                                           CGL029
      * Define work field Account Seq No.  Alloc Fm
     C                     MOVEL*BLANK    WUACSF  2
      * Define work field Nostro No. (Item)Alloc Fm
     C                     MOVEL*BLANK    WUNNBF  2
      * Define work field Retail A/c No.   Alloc Fm
     C                     Z-ADD*ZERO     WURACF 100
      * Define work field Profit Centre    Alloc Fm
     C                     MOVEL*BLANK    WUPRCF  4
      * Define work field Amount           Alloc Fm
     C                     Z-ADD*ZERO     WUAMTF 130
      * Define work field Input Branch Cd  Alloc To
     C                     MOVEL*BLANK    WUIBCT  3
      * Define work field Currency Code    Alloc To
     C                     MOVEL*BLANK    WUCYCT  3
      * Define work field Customer Number  Alloc To
     C                     MOVEL*BLANK    WUCNAT  6
      * Define work field Account Code     Alloc To
     C**********           MOVEL*BLANK    WUACCT  4                                           CGL029
     C                     MOVEL*BLANK    WUACCT 10                                           CGL029
      * Define work field Account Seq No.  Alloc To
     C                     MOVEL*BLANK    WUASNT  2
      * Define work field Nostro No. (Item)Alloc To
     C                     MOVEL*BLANK    WUNNBT  2
      * Define work field Retail A/c No.   Alloc To
     C                     Z-ADD*ZERO     WURACT 100
      * Define work field Type of Journal Entry
     C                     MOVEL*BLANK    WUTOJE  1
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Currency Diff Total (GL)
     C                     Z-ADD*ZERO     WUCDTN 150
     C                     MOVEL##PGM     $APGM
     C                     MOVEL*BLANK    W0PFM   1
     C                     Z-ADD*ZERO     @$WRK   40
     C                     Z-ADD*ZERO     @$HDL   40
      * Adjust page length and overflow as necessary
     C           @$PGL     SUB  2         W0PGL   40
     C           @$OFL     IFGE W0PGL
     C           W0PGL     SUB  2         W0OFL   40
     C                     ELSE
     C                     Z-ADD@$OFL     W0OFL
     C                     END
      * Clear overflow indicator
     C                     SETOF                     97
      * Request new page
     C                     MOVEL'Y'       W0NEWP  1
      * USER: Initialise program
      * Last Amend Box - GL0111P - Journal Entry Summary  *
      * Standard RPG Creation Par - Standard functions  *
      * Copyright notice - Standard functions  *
      * Access Midas Rundate PRTF - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      $AMRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Access Bank Title  PRTFIL - Standard functions  *
      *                                                                   S01117
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTCD  7        B:Return code
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C                     MOVELBJURPT    $AURPT
      *                                                                   CGL008
      **  Access SAR details file to see if CGL008 SAR is installed       CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     MOVE *ON       *IN22                           CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
      ** Access SAR details file to see if CGL125 is installed.                            AR1065437
      *                                                                                    AR1065437
     C                     MOVE *OFF      *IN98                                            AR1065437
      *                                                                                    AR1065437
     C                     CALL 'AOSARDR0'                                                 AR1065437
     C                     PARM *BLANKS   @RTCD                                            AR1065437
     C                     PARM '*VERIFY' @OPTN                                            AR1065437
     C                     PARM 'CGL125'  @SARD                                            AR1065437
      *                                                                                    AR1065437
     C           @RTCD     IFEQ *BLANK                                                     AR1065437
     C                     MOVE 'Y'       CGL125  1                                        AR1065437
     C                     MOVE *ON       *IN98                                            AR1065437
     C                     ELSE                                                            AR1065437
     C                     MOVE 'N'       CGL125                                           AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
     C/COPY WNCPYSRC,GL0111PC02
      * Define 200 Byte Dummy DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Department Codes DS - Department Codes  *
      * Declare Bank File DS - Standard functions  *
      * Start of Fix BHF667
      * Define 800 Byte Dummy DS - Standard functions  *
      * Currency Codes DS - Currency Codes  *
      * End of Fix BHF667
      * Start of Fix LN0714
      * ZSFile - Log Spool File - Standard functions  *
     C*
     C* Set up spool file number - Standard Functions  *
     C                     Z-ADD@$FNB     WUSFNB
     C                     MOVE *BLANKS   UUSRSQ  5
     C*
     C* ZSFILE - write report rqs - Standard Functions  *
     C                     CALL 'ZSFILE'               90  ZSFILE - write
     C*********************PARM #IRSQN    UURSQN  5        RCF sequence nuLN0837
     C           UUSRSQ    PARM P2RSQN    UURSQN  5        RCF sequence nuLN0837
     C                     PARM P4ENTY    UUENTY  3        Entity
     C                     PARM @$FVN     UUSFNM 10        Spool file name
     C                     PARM WUSFNB    UUSFNB  60       Spool file numb
     C           WUZSER    PARM *BLANK    UUZSER  1        ZSFILE error
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error.
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
     C*
     C* CASE: WRK.ZSFILE is error occurred
     C*
     C*          #OZSER    IFEQ 'Y'
     C*                    MOVEL'Y2U0004' P0RTN
     C*                    EXSR ZYEXPG
     C*                    END
      * Retrieve Header fields - Journal Entry Header  *
     C                     EXSR SARVGN
      *                                                                                    AR1065437
      ** Retrieve and format CGL125/CSC054 introduced fields                               AR1065437
      *                                                                                    AR1065437
     C           CGL125    IFEQ 'Y'                                                        AR1065437
     C           *IN90     ANDEQ*OFF                                                       AR1065437
     C                     EXSR SRCBIF                                                     AR1065437
     C                     ENDIF                                                           AR1065437
      *                                                                                    AR1065437
      * Set up Title for GL0111P - Journal Entry Summary  *
     C                     MOVEAUHDR,1    $AREPT
     C                     MOVEAUHDR,2    $AUNDL
      * End of Fix LN0714
     C                     MOVEL'Y'       WUFKST           S01212
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0111PIPG - Journal Entry Summary  *
     C*00/Copy Member GL0111P   Initialise Program C-Spec
     C/COPY WNCPYSRC,GL0111PCPG
     C                     END                             *FI
      *================================================================
     CSR         ZZEXIT    ENDSR
     O*00/Copy Member GL0111P   Initialise Program O-Spec
     O/COPY WNCPYSRC,GL0111POPG
** CPY@
(c) Misys International Banking Systems Ltd. 2001
** UHDR REPORT TITLE AND UNDERLINE
    JOURNAL ENTRIES:- BATCH/CURRENCY - ONE BATCH
    --------------------------------------------
