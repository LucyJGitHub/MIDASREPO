     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Complete batch details')                      *
     H/TITLE Midas GL Delete Batch Details
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H*  Perform user function
     H*  As defined by action diagram
      *
     H* Generated by  : SYNON/2  Version:  9054
     H* Function type : Execute external function
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : F7867PC
     H* Date          : 15/02/92  Time  : 00:05:31
      *  (c) Finastra International Limited 2001                      *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F*                                                               *
     F*  Midas General Ledger   GL0111X
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  Last Amend No. MD058181           Date 28May21               *
      *  Prev Amend No. MD057614           Date 28May21               *
      *                 MD046248           Date 27Oct17               *
      *                 MD027587           Date 19Jun14               *
      *                 AR1093096          Date 30Sep13               *
      *                 CRE041             Date 28Sep12               *
      *                 AR792734A          Date 20Sep11               *
      *                 CAP207             Date 10Feb11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26093           Date 22Sep09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CER001             Date 25Apr05               *
      *                 CSC024             Date 07Feb05               *
      *                 BUG2488            Date 31May04               *
      *                 BUG2304            Date 30Apr04               *
      *                 CRE019             Date 12Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL013             Date 29Mar02               *
      *                 CGL016             Date 01Aug02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206564             Date 10Sep02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSC011             Date 18Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01408             Date 13Aug96               *
      *                 S01408             Date 06Feb96               *
     F*                 S01408              DATE 05SEP95              *
     F*                 S01408              DATE 10MAR95              *
     F*                 S01408              DATE 12JAN95              *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD058181 - Additional codes to delete GLJENPQD when batch    *
      *             entry has been deleted.                           *
      *  MD057614 - Not possible to add a retail account to template  *
      *             Standing journal. Add delete to T_GZBITHEX,       *
      *             T_GZBITPEX and GLEJHQD when Batch is deleted.     *
      *             Applied for MD-58181.                             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR1093096 - ABC - Reservations not removed for JRNE.         *
      *              (Child: AR1093097) (Recompile)                   *
      *  CRE041 - Enhancements to Customer Exchanges (Recompile)      *
      *  AR792734A - Projected Account movement show incorrect        *
      *              Available Balance when posting Cash Deposit.     *
      *              Used CGL016 codes to insert shadow postings      *
      *              when CRE023 is turned on (Child: AR792735A)      *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26093 - Extended Narratives are not refreshed with reused *
      *             batch numbers.                                    *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CSC024 - Open Month End (Recompile)                          *
      *  BUG2488- Logical file REDDSSRCDV/TTRANL6 is based over  a    *
      *           phsical which is set to members = *nomax.  Amend    *
      *           TTRANL6 and create a  new logical file TTRANL7.     *
      *  BUG2304 - Various file layout changes. Recompile.            *
      *  CRE019 - Cheque Processing and Maintenance                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL013 - MT94x Messages Generation                           *
      *  CGL016 - Projected Movements Update Prior to Authorisation   *
      *  206564 - Added deletion processing for the batch for file    *
      *           LF/GLBTNOL0. Applied 206736.                        *
      *  CSC011 - 24x7 Midas Availability                             *
      *  CSC011 - 24x7 Midas Availability                             *
     F*  S01408 - Addition of Core Hooks  GL0111XCP3                  *
     F*  S01408 - Addition of Core Hooks  GL0111XFP1                  *
     F*  S01408 - Addition of Core Hooks  GL0111XCP2                  *
     F*  S01408 - Addition of Core Hooks  GL0111XIPG                  *
     F*                                   GL0111XCP1                  *
     F*                                   GL0111XDAU                  *
     F*  S01408 - ADDITION OF CORE HOOK GL0111XFPG                    *
     F*           ADDITION OF CORE HOOK GL0111XDBU                    *
     F*           ADDITION OF CORE HOOK GL0111XCPG                    *
     F*                                                               *
     F*****************************************************************
     FGLJENPL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENSL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Summary Rtv
      *
     FGLJENPL0UF  E           K        DISK
     F                                              KCOMIT                CGL016
      * UPD : Midas GL Journal Entry Posting Update
     FAPVLOGL0UF  E           K        DISK                           UC                      CSC011
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL0111XFPG                                           S01408
     FGLJPX1L0UF  E           K        DISK                           UC                      CER001
      *                                                                                       CER001
      ** IBLC 2002 Journal Entries Ext details                                                CER001
      *                                                                                       CER001
     F*                                                                   S01408
      *
     FGLJENHL0UF  E           K        DISK
     F                                              KCOMIT                CGL016
      * UPD : Midas GL Journal Entry Header Update
      *
     FGLJENSL0UF  E           K        DISK
     F                                              KCOMIT                CGL016
      * UPD : Midas GL Journal Entry Summary Update
      *
     FGLJENXL3UF  E           K        DISK         KINFSR *PSSR                              CGL013
      ** UPD: Midas GL Journal Entry File - Additional Information                            CGL013
      *                                                                                     BUG26093
     FGLMNARL6UF  E           K        DISK         KINFSR *PSSR                            BUG26093
      ** UPD: Midas GL Multicash Narratives File - by batch no and item no                  BUG26093
      *                                                                                       CGL013
     FGLBTNOL0UF  E           K        DISK                                                   206564
      *                                                                                       CRE019
     FCHQBKL1 UF  E           K        DISK         KINFSR *PSSR                              CRE019
      ** Midas RE Cheque Book file - 1                                                        CRE019
      *                                                                                       CRE019
     FTTRANL6 IF  E           K        DISK                                                   CRE019
      ** Midas RE Cheques Presented with Warning Messages                                     CRE019
      *                                                                                      BUG2488
     FTTRANL7 IF  E           K        DISK         KINFSR *PSSR      UC                     BUG2488
      ** Teller Trans. logical file of all presented cheques                                 BUG2488
      *                                                                                      BUG2488
     FSDTELDL1IF  E           K        DISK         KINFSR *PSSR                             BUG2488
      ** Teller Identification file                                                          BUG2488
     FTGZBTHX1UF  E           K        DISK         KINFSR *PSSR                            MD057614
     F            T_GZBITHEX                        KRENAMETGZBTHD0                         MD057614
     FTGZBTPX1UF  E           K        DISK         KINFSR *PSSR                            MD057614
     F            T_GZBITPEX                        KRENAMETGZBTPD0                         MD057614
      ** UDF Table for Journal Entry                                                        MD057614
     FGLJENQL0UF  E           K        DISK         KINFSR *PSSR                            MD057614
      ** Journal Entry Header Extension File - QD                                           MD057614
     FGLJEPQL0UF  E           K        DISK         KINFSR *PSSR                            MD058181
      ** Midas GL Journal Entry Detail Extension File - QD                                  MD058181
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL0111XFP1                                           S01408
     F*                                                                   S01408
     E                    CPY@    1   1 80               Copyright     array
      *                                                                                      BUG2488
     E                    @TXT    1   2 80                                                   BUG2488
      **  Array containing Text Strings for Override of Files                                BUG2488
      *                                                                                       CRE019
      ** Work array for CQPS                                                                  CRE019
      *                                                                                       CRE019
     E                    WAR        20  1                                                    CRE019
      *                                                                                       CRE019
      ***Rename*fields*in*TTRANL6*for*record*format*TTRAND0************               CRE019 BUG2488
     I***TTRAND0                                                                      CRE019 BUG2488
     I**********    ACNO                            TAACNO                            CRE019 BUG2488
     I**********    CQNF                            TACQNF                            CRE019 BUG2488
     I**********    HCAC                            TAHCAC                            CRE019 BUG2488
     I**********    TBID                            TATBID                            CRE019 BUG2488
     I**********    TBTN                            TATBTN                            CRE019 BUG2488
      *                                                                                       CRE019
      ** Rename fields in TTRANL6 for record format @BTREMG                                   CRE019
      *                                                                                       CRE019
     I@BTREMG                                                                                 CRE019
     I              BTCQNB                          TRCQNB                                    CRE019
     I              BTBTNB                          TRBTNB                                    CRE019
     I              BTBINB                          TRBINB                                    CRE019
     I              BTIBCA                          TRIBCA                                    CRE019
     I              BTCUST                          TRCUST                                    CRE019
     I              BTCYCD                          TRCYCD                                    CRE019
     I              BTACCD                          TRACCD                                    CRE019
     I              BTACSN                          TRACSN                                    CRE019
     I              BTRACN                          TRACNO                                    CRE019
      *                                                                                       CRE019
      ** Rename fields in TTRANL6 for record format CUSEXCEF                                  CRE019
      *                                                                                       CRE019
     ICUSEXCEF                                                                                CRE019
     I              DRBR                            TDRBR                                     CRE019
     I              DCUS                            TDCUS                                     CRE019
     I              DRCY                            TDRCY                                     CRE019
     I              DCOD                            TDACOD                                    CRE019
     I              DACS                            TDACS                                     CRE019
     I              DRAN                            TDACNO                                    CRE019
      *                                                                                       CRE019
      /EJECT
      * Data structures:
     I@1DBRC    E DSGLJENPL0                                                                  CSC011
     IPGMDS     ESDSY2PGDSP
      * Program data structure
      *                                                                                       CSC011
     ITRNDTL      DS                           5800                                           CSC011
      *                                                                                       CSC011
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I :  Batch number
     I                                        1   3 P1BTNB
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL0111XIPG                                           S01408
     I*                                                                   S01408
      *                                                                                       CSC011
     ISDSTAT      DS                            256                                           CSC011
     I                                        6   7 LIBR                                      CSC011
      *                                                                                       CSC011
     ISC24X7      DS                            256                                           CSC011
     I                                        3   4 S1SUPP                                    CSC011
      *                                                                                       CSC011
     I              'GLBITPLOG'           C         WPGM                                      CSC011
      *                                                                                       CSC011
      ** Data structure to update last transaction number                                     CRE019
      *                                                                                       CRE019
     IDNATN       DS                              5                                           CRE019
     I                                        1   50FNATN                                     CRE019
      *                                                                                       CRE019
     I            DS                                                                         BUG2488
      ** Data structure to hold string constants for QCMDEXC                                 BUG2488
     I                                        1  80 @CMD                                     BUG2488
     I                                       30  30 @BRI                                     BUG2488
     I                                       31  33 @BID                                     BUG2488
     IUUFDY     E DSDSFDY                                                 CGL016
     I*                                                                   CGL016
     I* 200 Byte Data Structure for Incoming Data from Access Program     CGL016
     I*                                                                   CGL016
     IUUSDY     E DSDSSDY                                                                   MD057614
     I*                                                                                     MD057614
     I* 800 Byte Data Structure for Incoming Data from Access Program                       MD057614
     ID@SARD    E DSSCSARDPD                                              CGL016
     I*                                                                   CGL016
     I*  Switchable Features DS                                           CGL016
     I              LCD                             LCDX                  CGL016
     I*                                                                   CGL016
     ISDBANK    E DSSDBANKPD                                                                  CRE019
      ** External  data structure for bank details                                            CRE019
      *                                                                                       CRE019
     ILDA       E DSLDA                         256                                           CGL013
      ** Local Data Area for Database Error Details                                           CGL013
      *                                                                                       CGL013
     ISDBRCH    E DSSDBRCHPD                                                                MD057614
      ** External DS for Branch details                                                     MD057614
      *                                                                                     MD057614
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
      *****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XCP1                                           S01408
     C*                                                                   S01408
      * Initialise
     C                     EXSR ZZINIT
      *
      * Delete Batch Details
      * Standard RPG Creation Par - Standard functions  *
      * Copyright notice - Standard functions  *
      * Last Amend Box - GL0111X - Journal Entry Summary  *
      * Retrieve for Delete-Item - Journal Entry Posting  *
     C                     EXSR SARVGN
      * Delete GL Batch header - Journal Entry Header  *
     C                     EXSR SCDLRC
      *                                                                                       206564
      ** Delete GL Batch Number in PF/GLBTNOPD.                                               206564
      *                                                                                       206564
     C                     EXSR WGLBT                                                         206564
      * Retrieve for Sum Delete - Journal Entry Summary  *
     C                     EXSR SDRVGN
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Retrieve for Delete-Item - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN BTBTNB    WQSA01           Batch number
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Batch number
      * Move fields to key list
     C                     MOVELP1BTNB    WQSA01           Batch number
     C           KRSSA     SETLL@BTREAL                    *
     C/COPY WNCPYSRC,GL0111XC06
     C           KRSSA     READE@BTREAL                  90*
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process DBF record
      * Delete Batch Posting - Journal Entry Posting  *
     C                     EXSR SBDLRC
     C           KRSSA     READE@BTREAL                  90*
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * Delete Batch Posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BTREAK
     C                     MOVELP1BTNB    BTBTNB           Batch number
     C/COPY WNCPYSRC,GL0111XC02
      *
     C           KLDLSB    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLDLSB    CHAIN@BTREAK              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SBEXIT
     C                     END
      *
      *................................................................
      *                                                                                       CRE019
      ** Remove cheque from presented list when removing a batch if no                        CRE019
      ** other transaction is using the specific cheque                                       CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           BTCQNB    ANDNE*BLANKS                                                       CRE019
     C                     MOVE 'Y'       WOKDEL  1                                           CRE019
      *                                                                                       CRE019
      ** Access TTRANL6 to check if other transaction uses the cheque                         CRE019
      *                                                                                       CRE019
     C           BTCQNB    SETLLTTRANL6                                                       CRE019
     C           BTCQNB    READETTRANL6                  83                                   CRE019
      *                                                                                       CRE019
     C           *IN83     DOWNE*ON                                                           CRE019
      *                                                                                       CRE019
     C                     SELEC                                                              CRE019
     C********** TAHCAC    WHNE *BLANKS                                               CRE019 BUG2488
     C********** TAACNO    ORNE *ZERO                                                 CRE019 BUG2488
     C**********           MOVE 'N'       WOKDEL                                      CRE019 BUG2488
     C**********           MOVE *ON       *IN83                                       CRE019 BUG2488
      *                                                                                       CRE019
     C           TDACNO    WHNE *ZEROS                                                        CRE019
     C           TDACNO    OREQ *ZEROS                                                        CRE019
     C           TDRBR     ANDNE*BLANKS                                                       CRE019
     C********** TDCUS     ANDNE*ZEROS                                                 CRE019 CSD027
     C           TDCUS     ANDNE*BLANKS                                                       CSD027
     C           TDACOD    ANDNE*ZEROS                                                        CRE019
     C           TDACS     ANDNE*ZEROS                                                        CRE019
     C           TDRCY     ANDNE*BLANKS                                                       CRE019
     C                     MOVE 'N'       WOKDEL                                              CRE019
     C                     MOVE *ON       *IN83                                               CRE019
      *                                                                                       CRE019
     C                     OTHER                                                              CRE019
     C           TRBTNB    IFNE BTBTNB                                                        CRE019
     C           TRACNO    ANDEQBTRACN                                                        CRE019
     C           TRBINB    ORNE BTBINB                                                        CRE019
     C           TRACNO    ANDEQBTRACN                                                        CRE019
     C                     MOVE 'N'       WOKDEL                                              CRE019
     C                     MOVE *ON       *IN83                                               CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE *BLANKS   TRBTNB                                              CRE019
     C                     MOVE *BLANKS   TRBINB                                              CRE019
     C           BTCQNB    READETTRANL6                  83                                   CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSL                                                              CRE019
      *                                                                                       CRE019
     C                     ENDDO                                                              CRE019
      *                                                                                      BUG2488
      ** Check if cheque exist in telelr transactions                                        BUG2488
      *                                                                                      BUG2488
     C           WOKDEL    IFEQ 'Y'                                                          BUG2488
     C                     MOVE *OFF      *IN83                                              BUG2488
     C           *LOVAL    SETLLSDTELDL1                                                     BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
     C           *IN83     DOWEQ*OFF                                                         BUG2488
      *                                                                                      BUG2488
      ** If not the first time, delete previous overrides                                    BUG2488
      *                                                                                      BUG2488
     C           @CMD      IFNE *BLANKS                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,1    @CMD                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN   155                                         BUG2488
     C                     CLOSETTRANL7                                                      BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
      ** Perform override to LF/TTRANL7                                                      BUG2488
      *                                                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,2    @CMD                                               BUG2488
     C                     MOVEL'T'       @BRI                                               BUG2488
     C                     MOVELFRTLID    @BID                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
      *                                                                                      BUG2488
     C                     OPEN TTRANL7                                                      BUG2488
     C           *LOVAL    SETLLTTRANL7                                                      BUG2488
     C           BTCQNB    CHAINTTRANL7              84                                      BUG2488
     C           *IN84     IFEQ *OFF                                                         BUG2488
     C                     MOVE 'N'       WOKDEL                                             BUG2488
     C                     LEAVE                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
      *                                                                                      BUG2488
     C                     ENDDO                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                       CRE019
      ** Allow delete if current transaction is the only transaction                          CRE019
      ** using the cheque                                                                     CRE019
      *                                                                                       CRE019
     C           WOKDEL    IFEQ 'Y'                                                           CRE019
     C                     EXSR SRDCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XDBU                                           S01408
     C*                                                                   S01408
     C                     DELET@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XDAU                                           S01408
     C*                                                                   S01408
     C                     ELSE                                                               CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
      *                                                                                       CSC011
     C                     CALL WPGM                                                          CSC011
     C                     PARM *BLANKS   PPRTCD 10                                           CSC011
     C                     PARM           @1DBRC                                              CSC011
     C                     PARM           TRNDTL                                              CSC011
      *                                                                                       CSC011
     C                     OPEN APVLOGL0                                                      CSC011
     C                     MOVEL'GLBITP'  WTYPE                                               CSC011
     C                     MOVELBTFRNT    WFRNT                                               CSC011
     C           KVLOG     CHAINAPVLOGL0             01                                       CSC011
      *                                                                                       CSC011
     C           *IN01     DOWEQ'0'                                                           CSC011
     C           TRNDTL    IFEQ GLTRDL                                                        CSC011
     C                     DELETAPVLOGP0                                                      CSC011
     C                     MOVE '1'       *IN01                                               CSC011
     C                     ELSE                                                               CSC011
     C           KVLOG     READEAPVLOGL0                 01                                   CSC011
     C                     ENDIF                                                              CSC011
     C                     ENDDO                                                              CSC011
     C                     CLOSEAPVLOGL0                                                      CSC011
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
B3   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X3   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC  7                       CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B3   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE UUAPRC    W0RTN                           CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     END
      *                                                                                       CGL013
      ** If CGL013 is installed, delete Additional Information if                             CGL013
      ** present in PF/GLJENXPD.                                                              CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           KLDLSB    SETLLGLJENXL3                                                      CGL013
      *                                                                                       CGL013
     C           BTBTNB    READEGLJENXL3                 30                                   CGL013
     C           *IN30     DOWEQ*OFF                                                          CGL013
     C                     DELETGLJENXD0                                                      CGL013
     C           BTBTNB    READEGLJENXL3                 30                                   CGL013
     C                     ENDDO                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XCP2                                           S01408
      *                                                                                       CER001
      ** Drop details when no more usable                                                     CER001
      *                                                                                       CER001
     C           ULX043    IFEQ 'Y'                        When open                          CER001
      *                                                                                       CER001
     C           KLDLSB    CHAINGLJENPDL             90    *                                  CER001
      *                                                                                       CER001
      ** If record exists, remove it                                                          CER001
      *                                                                                       CER001
     C           *IN90     IFEQ *OFF                                                          CER001
     C                     DELETGLJENPDL               91                                     CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                     MD057614
      ** Delete extension tables                                                            MD057614
      *                                                                                     MD057614
     C                     CALL 'AOBRCHR1'                                                  MD057614
     C                     PARM *BLANKS   PRTCD                                             MD057614
     C                     PARM '*KEY   ' POPTN                                             MD057614
     C                     PARM BTIBCA    PKIBCA  3                                         MD057614
     C           SDBRCH    PARM SDBRCH    UUSDY                                             MD057614
      *                                                                                     MD057614
     C           KTBTNB    KLIST                                                            MD057614
     C                     KFLD           BTBTNB                                            MD057614
     C                     KFLD           BJRDNB                                            MD057614
     C                     KFLD           A8ZONE                                            MD057614
      *                                                                                     MD057614
     C           KTBTNB    SETLLTGZBTHX1                                                    MD057614
      *                                                                                     MD057614
     C           KTBTNB    READETGZBTHX1                 30                                 MD057614
     C           *IN30     DOWEQ*OFF                                                        MD057614
     C                     DELETTGZBTHD0                                                    MD057614
     C           KTBTNB    READETGZBTHX1                 30                                 MD057614
     C                     ENDDO                                                            MD057614
      *                                                                                     MD057614
     C           KTBTNB    SETLLTGZBTPX1                                                    MD057614
      *                                                                                     MD057614
     C           KTBTNB    READETGZBTPX1                 30                                 MD057614
     C           *IN30     DOWEQ*OFF                                                        MD057614
     C                     DELETTGZBTPD0                                                    MD057614
     C           KTBTNB    READETGZBTPX1                 30                                 MD057614
     C                     ENDDO                                                            MD057614
      *                                                                                     MD057614
     C           KHBTNB    KLIST                                                            MD057614
     C                     KFLD           BTBTNB                                            MD057614
      *                                                                                     MD057614
     C           KHBTNB    SETLLGLJENQL0                                                    MD057614
      *                                                                                     MD057614
     C           KHBTNB    READEGLJENQL0                 30                                 MD057614
     C           *IN30     DOWEQ*OFF                                                        MD057614
     C                     DELETGLJEHQD0                                                    MD057614
     C           KHBTNB    READEGLJENQL0                 30                                 MD057614
     C                     ENDDO                                                            MD057614
      *                                                                                     MD057614
     C           KHBTNB    SETLLGLJEPQL0                                                    MD058181
      *                                                                                     MD058181
     C           KHBTNB    READEGLJEPQL0                 30                                 MD058181
     C           *IN30     DOWEQ*OFF                                                        MD058181
     C                     DELETGLJEPQD0                                                    MD058181
     C           KHBTNB    READEGLJEPQL0                 30                                 MD058181
     C                     ENDDO                                                            MD058181
      *                                                                                     BUG26093
      ** If CER030 is installed, delete Multicash Narratives if                             BUG26093
      ** present in PF/GLMNARPD.                                                            BUG26093
      *                                                                                     BUG26093
     C           CER030    IFEQ 'Y'                                                         BUG26093
     C           KLDLSB    SETLLGLMNARL6                                                    BUG26093
      *                                                                                     BUG26093
     C           BTBTNB    READEGLMNARL6                 30                                 BUG26093
     C           *IN30     DOWEQ*OFF                                                        BUG26093
     C                     DELETGLMNARD0                                                    BUG26093
     C           BTBTNB    READEGLMNARL6                 30                                 BUG26093
     C                     ENDDO                                                            BUG26093
      *                                                                                     BUG26093
     C                     ENDIF                                                            BUG26093
      *                                                                                       CER001
     C*                                                                   S01408
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     C/COPY WNCPYSRC,GL0111XC05
     CSR         SCDLRC    BEGSR
      *================================================================
      * Delete GL Batch header - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BRREAG
     C                     MOVELP1BTNB    BRBTNB           Batch number
      *
     C           KLDLSC    KLIST
     C                     KFLD           BRBTNB           Batch number
     C           KLDLSC    CHAIN@BRREAG              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SCEXIT
     C                     END
      *
      *................................................................
     C                     DELET@BRREAG                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XCP3                                           S01408
     C*                                                                   S01408
     C                     ELSE                                                               CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
      *                                                                                       CSC011
     C                     OPEN APVLOGL0                                                      CSC011
     C                     MOVEL'GLBITH'  WTYPE                                               CSC011
     C                     MOVELBRFRNT    WFRNT                                               CSC011
     C           KVLOG     CHAINAPVLOGL0             01                                       CSC011
      *                                                                                       CSC011
     C           *IN01     IFEQ '0'                                                           CSC011
     C                     DELETAPVLOGP0                                                      CSC011
     C                     MOVE '1'       *IN01                                               CSC011
     C                     ENDIF                                                              CSC011
     C                     CLOSEAPVLOGL0                                                      CSC011
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
     C                     END
     C/COPY WNCPYSRC,GL0111XC04
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Retrieve for Sum Delete - Journal Entry Summary  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN BSBTNB    WQSD01           Batch number
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WQSD01           Batch number
     C                     KFLD           BSCYCD           Currency code
     C                     KFLD           BSBRCD           Branch code
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Batch number
      * Move fields to key list
     C                     MOVELP1BTNB    WQSD01           Batch number
     C                     MOVEL*BLANK    BSCYCD           Currency code
     C                     MOVEL*BLANK    BSBRCD           Branch code
     C           KPSSD     SETLL@BSREAJ                    *
     C           KRSSD     READE@BSREAJ                  90*
      * DBF record not found
     C   90                MOVEL'GLX0174' W0RTN   7
     C           *IN90     DOWEQ'0'
      * USER: Process DBF record
      * Delete Summary Record - Journal Entry Summary  *
     C                     EXSR SEDLRC
     C           KRSSD     READE@BSREAJ                  90*
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SEDLRC    BEGSR
      *================================================================
      * Delete Summary Record - Journal Entry Summary  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BSREAI
     C                     MOVELP1BTNB    BSBTNB           Batch number
      *
     C           KLDLSE    KLIST
     C                     KFLD           BSBTNB           Batch number
     C                     KFLD           BSCYCD           Currency code
     C                     KFLD           BSBRCD           Branch code
     C           KLDLSE    CHAIN@BSREAI              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      *................................................................
     C                     DELET@BSREAI                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGM
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
     C/COPY WNCPYSRC,GL0111XC03
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0111XCPG                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      *                                                                                       CRE019
      ** Access Bank details file                                                             CRE019
      *                                                                                       CRE019
     C                     CALL 'AOBANKR0'                                                    CRE019
     C                     PARM *BLANKS   PRTCD                                               CRE019
     C                     PARM '*FIRST ' POPTN                                               CRE019
     C           SDBANK    PARM SDBANK    UUFDY                                               CRE019
      *                                                                                       CRE019
     C           PRTCD     IFNE *BLANKS                                                       CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVE 'SDBANKPD'DBFILE                                              CRE019
     C                     Z-ADD2         DBASE                                               CRE019
     C                     MOVELPOPTN     DBKEY                                               CRE019
     C                     OUT  LDA                                                           CRE019
     C                     EXSR *PSSR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C/COPY WNCPYSRC,GL0111XC01
      *                                                                                       CER001
      ** Access SAR details file to see if ULX043 Feature is installed                        CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX043  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD                                               CER001
     C                     PARM '*VERIFY' POPTN                                               CER001
     C                     PARM 'ULX043'  PSARD                                               CER001
      *                                                                                       CER001
     C           PRTCD     IFEQ *BLANK                                                        CER001
     C                     MOVE 'Y'       ULX043                                              CER001
     C                     OPEN GLJPX1L0                                                      CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CSC011
      ** Access SAR details file to see if CSC011 is installed                                CSC011
      *                                                                                       CSC011
     C                     CALL 'AOSARDR0'                                                    CSC011
     C                     PARM *BLANKS   PRTCD   7                                           CSC011
     C                     PARM '*VERIFY' POPTN   7                                           CSC011
     C                     PARM 'CSC011'  PSARD   6                                           CSC011
      *                                                                                       CSC011
     C           PRTCD     IFEQ *BLANKS                                                       CSC011
     C                     MOVE 'Y'       CSC011  1                                           CSC011
     C           *NAMVAR   DEFN           SDSTAT                                              CSC011
     C                     IN   SDSTAT                                                        CSC011
     C           *NAMVAR   DEFN           SC24X7                                              CSC011
     C                     IN   SC24X7                                                        CSC011
     C                     ELSE                                                               CSC011
     C                     MOVE 'N'       CSC011                                              CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CSC011
     C           KVLOG     KLIST                                                              CSC011
     C                     KFLD           WTYPE  32                                           CSC011
     C                     KFLD           WFRNT  20                                           CSC011
      *                                                                                       CSC011
      * Access account info                                               CGL016
     C           KACCT     KLIST                                          CGL016
     C                     KFLD           W0CNUM  6                       CGL016
     C                     KFLD           W0CCY   3                       CGL016
     C**********           KFLD           W0ACOD  40                                   CGL016 CGL029
     C                     KFLD           W0ACOD 100                                          CGL029
     C                     KFLD           W0ACSQ  20                      CGL016
     C                     KFLD           W0BRCA  3                       CGL016
      *                                                                   CGL016
      ** Access SAR details for Projected Movements Update Prior to Auth. CGL016
      *                                                                   CGL016
     C                     MOVEL'N'       CGL016  1                       CGL016
     C                     CALL 'AOSARDR0'                                CGL016
     C                     PARM *BLANKS   PRTCD                           CGL016
     C                     PARM '*VERIFY' POPTN                           CGL016
     C                     PARM 'CGL016'  PSARD                           CGL016
     C           D@SARD    PARM D@SARD    UUFDY                           CGL016
      *                                                                   CGL016
     C           PRTCD     IFEQ *BLANK                                    CGL016
     C                     MOVEL'Y'       CGL016                          CGL016
     C                     ENDIF                                          CGL016
      *                                                                   CGL016
      ** Access SAR details for Two O'clock Feature                                        AR792734A
      *                                                                                    AR792734A
     C                     MOVEL'N'       CRE023  1                                        AR792734A
     C                     CALL 'AOSARDR0'                                                 AR792734A
     C                     PARM *BLANKS   PRTCD                                            AR792734A
     C                     PARM '*VERIFY' POPTN                                            AR792734A
     C                     PARM 'CRE023'  PSARD                                            AR792734A
     C           D@SARD    PARM D@SARD    UUFDY                                            AR792734A
      *                                                                                    AR792734A
     C           PRTCD     IFEQ *BLANK                                                     AR792734A
     C                     MOVEL'Y'       CRE023                                           AR792734A
     C                     ENDIF                                                           AR792734A
      *                                                                                    AR792734A
      *                                                                                       CGL013
      ** Access SAR details file to see if CGL013 is installed.                               CGL013
      *                                                                                       CGL013
     C           *NAMVAR   DEFN           LDA                                                 CGL013
     C                     CALL 'AOSARDR0'                                                    CGL013
     C                     PARM *BLANKS   PRTCD   7                                           CGL013
     C                     PARM '*VERIFY' POPTN   7                                           CGL013
     C                     PARM 'CGL013'  PSARD   6                                           CGL013
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL013
      *                                                                                       CGL013
     C           PRTCD     IFNE *BLANKS                                                       CGL013
     C           PRTCD     ANDNE'*NRF    '                                                    CGL013
     C           *LOCK     IN   LDA                                                           CGL013
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL013
     C                     MOVEL'001'     DBASE                                               CGL013
     C                     MOVEL'CGL013'  DBKEY                                               CGL013
     C                     OUT  LDA                                                           CGL013
     C                     EXSR *PSSR                                                         CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     MOVE 'N'       CGL013                                              CGL013
     C           PRTCD     IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       CGL013  1                                           CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      ** Access SAR details file to see if CRE019 is installed.                               CRE019
      *                                                                                       CRE019
     C                     CALL 'AOSARDR0'                                                    CRE019
     C                     PARM *BLANKS   PRTCD                                               CRE019
     C                     PARM '*VERIFY' POPTN                                               CRE019
     C                     PARM 'CRE019'  PSARD                                               CRE019
     C           D@SARD    PARM D@SARD    UUFDY                                               CRE019
      *                                                                                       CRE019
     C           PRTCD     IFNE *BLANKS                                                       CRE019
     C           PRTCD     ANDNE'*NRF    '                                                    CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVE 'SCSARDPD'DBFILE                                              CRE019
     C                     Z-ADD3         DBASE                                               CRE019
     C                     MOVEL'CRE019'  DBKEY                                               CRE019
     C                     OUT  LDA                                                           CRE019
     C                     EXSR *PSSR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           PRTCD     IFEQ *BLANK                                                        CRE019
     C                     MOVE 'Y'       CRE019  1                                           CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE 'N'       CRE019                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG26093
      ** Access SAR details file to see if CER030 is installed.                             BUG26093
      *                                                                                     BUG26093
     C                     CALL 'AOSARDR0'                                                  BUG26093
     C                     PARM *BLANKS   PRTCD                                             BUG26093
     C                     PARM '*VERIFY' POPTN                                             BUG26093
     C                     PARM 'CER030'  PSARD                                             BUG26093
     C           D@SARD    PARM D@SARD    UUFDY                                             BUG26093
      *                                                                                     BUG26093
     C           PRTCD     IFNE *BLANKS                                                     BUG26093
     C           PRTCD     ANDNE'*NRF    '                                                  BUG26093
     C           *LOCK     IN   LDA                                                         BUG26093
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG26093
     C                     Z-ADD5         DBASE                                             BUG26093
     C                     MOVEL'CER030'  DBKEY                                             BUG26093
     C                     OUT  LDA                                                         BUG26093
     C                     EXSR *PSSR                                                       BUG26093
     C                     ENDIF                                                            BUG26093
      *                                                                                     BUG26093
     C           PRTCD     IFEQ *BLANK                                                      BUG26093
     C                     MOVE 'Y'       CER030  1                                         BUG26093
     C                     ELSE                                                             BUG26093
     C                     MOVE 'N'       CER030                                            BUG26093
     C                     ENDIF                                                            BUG26093
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    KLIST                                                              CRE019
     C                     KFLD           KACNO  100                                          CRE019
     C                     KFLD           KGCIN   10                                          CRE019
     C                     KFLD           KSCQN   80                                          CRE019
      *                                                                                       CRE019
     C           KCHQB2    KLIST                                                              CRE019
     C                     KFLD           KACNO  100                                          CRE019
     C                     KFLD           KGCIN   10                                          CRE019
      *                                                                                       CRE019
      ** Key list for CHQBPT                                                                  CRE019
      *                                                                                       CRE019
     C           KCHQTR    KLIST                                                              CRE019
     C                     KFLD           KACNTR 100                                          CRE019
     C                     KFLD           KGCITR  10                                          CRE019
     C                     KFLD           KSQNTR  80                                          CRE019
      *                                                                                       CRE019
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT                                                                                  206564
      ****************************************************************                        206564
      *                                                              *                        206564
      *  WGLBT - Subroutine to delete the batch record in            *                        206564
      *          PF/GLBTNOPD.                                        *                        206564
      *                                                              *                        206564
      *  Called by: Main                                             *                        206564
      *                                                              *                        206564
      ****************************************************************                        206564
     CSR         WGLBT     BEGSR                                                              206564
      *                                                                                       206564
     C           P1BTNB    CHAINGLBTNOL0             1011                                     206564
      *                                                                                       206564
      ** Record already deleted.                                                              206564
      *                                                                                       206564
     C           *IN10     IFEQ '1'                                                           206564
     C                     MOVEL'Y2U0009' W0RTN                                               206564
      *                                                                                       206564
      ** Send message 'Record no longer on file'.                                             206564
      *                                                                                       206564
     C                     MOVEL'Y2U0009' ZAMSID                                              206564
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              206564
     C                     EXSR ZASNMS                                                        206564
     C                     GOTO BTEXIT                                                        206564
     C                     ELSE                                                               206564
      *                                                                                       206564
      ** Record locked.                                                                       206564
      *                                                                                       206564
     C           *IN11     IFEQ '1'                                                           206564
     C                     MOVEL'Y2U0004' W0RTN                                               206564
     C                     GOTO BTEXIT                                                        206564
     C                     ELSE                                                               206564
     C                     DELETGLBTNOD0               11                                     206564
      *                                                                                       206564
      ** Delete error detected.                                                               206564
      *                                                                                       206564
     C           *IN91     IFEQ '1'                                                           206564
     C                     MOVEL'Y2U0004' W0RTN                                               206564
     C                     ENDIF                                                              206564
     C                     ENDIF                                                              206564
     C                     ENDIF                                                              206564
      *                                                                                       206564
     CSR         BTEXIT    ENDSR                                                              206564
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
      *                                                               *                       CGL013
      * *PSSR  - Program exception error routine                      *                       CGL013
      *          Called automatically if a program error occurs,      *                       CGL013
      *          or directly by the program code using EXSR.          *                       CGL013
      *          This subroutine DUMPs the program just once.         *                       CGL013
      *                                                               *                       CGL013
      * Called by: ZZINIT                                             *                       CGL013
      *                                                               *                       CGL013
      * Calls: None                                                   *                       CGL013
      *                                                               *                       CGL013
      *****************************************************************                       CGL013
      *                                                                                       CGL013
     C           *PSSR     BEGSR                                                              CGL013
      *                                                                                       CGL013
     C           @RUN      IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       @RUN    1                                           CGL013
     C                     DUMP                                                               CGL013
     C                     CALL 'DBERRCTL'                                                    CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     MOVE *ON       *INU7                                               CGL013
     C                     MOVE *ON       *INU8                                               CGL013
     C                     MOVE *ON       *INLR                                               CGL013
     C                     RETRN                                                              CGL013
      *                                                                                       CGL013
     C                     ENDSR                                                              CGL013
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
      *                                                                                       206564
      * SRDCHQ - Remove cheque number from the list of presented      *                       CRE019
      *          Cheques                                              *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SRDCHQ    BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** Generate Next Transaction number                                                     CRE019
      *                                                                                       CRE019
     C                     EXSR SRTNLU                                                        CRE019
     C                     Z-ADDWNATN     TNLU                                                CRE019
      *                                                                                       CRE019
     C                     MOVE BJRDNB    LCD                                                 CRE019
     C                     MOVE 'N'       WDEL                                                CRE019
      *                                                                                       CRE019
     C                     MOVE BTRACN    KACNO                                               CRE019
     C                     Z-ADD0         KGCIN                                               CRE019
     C                     MOVE BTCQNB    KSCQN                                               CRE019
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    SETGTCHQBKPDF                                                      CRE019
     C           KCHQB2    REDPECHQBKPDF                 82                                   CRE019
      *                                                                                       CRE019
      ** If out of range flag is 'Y', record can be deleted                                   CRE019
      *                                                                                       CRE019
     C           OUTR      IFEQ 'Y'                                                           CRE019
     C                     MOVE 'Y'       WDEL                                                CRE019
     C                     DELETCHQBKPDF                                                      CRE019
     C                     EXSR SRUTRL                                                        CRE019
      *                                                                                       CRE019
      ** Else, ammend such that the cheque is not yet presented                               CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Set on bits  of CQPS to specify cheque presented                                     CRE019
      *                                                                                       CRE019
     C                     Z-ADDKSCQN     WSCQN   80                                          CRE019
     C           WSCQN     SUB  SCQN      WOFSET  80                                          CRE019
     C           WOFSET    DIV  8         WI      20                                          CRE019
     C                     MVR            WBITN   10                                          CRE019
     C                     ADD  1         WI                                                  CRE019
      *                                                                                       CRE019
     C                     MOVEACQPS      WAR                                                 CRE019
     C           WBITN     IFEQ 0                                                             CRE019
     C                     BITOF'0'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 1                                                             CRE019
     C                     BITOF'1'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 2                                                             CRE019
     C                     BITOF'2'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 3                                                             CRE019
     C                     BITOF'3'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 4                                                             CRE019
     C                     BITOF'4'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 5                                                             CRE019
     C                     BITOF'5'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 6                                                             CRE019
     C                     BITOF'6'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 7                                                             CRE019
     C                     BITOF'7'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEAWAR       CQPS                                                CRE019
      *                                                                                       CRE019
     C                     MOVE 'A'       CHTP                                                CRE019
     C                     UPDATCHQBKPDF                                                      CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *                                                                                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRUTRL - Update Control Trailer Record                        *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SRUTRL    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE *OFF      *IN81                                               CRE019
      *                                                                                       CRE019
     C                     MOVE *ALL'9'   KACNTR                                              CRE019
     C                     MOVE '9'       KGCITR                                              CRE019
     C                     MOVE *ALL'9'   KSQNTR                                              CRE019
     C           KCHQTR    CHAINCHQBKPTF             81                                       CRE019
      *                                                                                       CRE019
      **  DB Error if Trailer file is empty                                                   CRE019
      *                                                                                       CRE019
     C           *IN81     IFEQ *ON                                                           CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVEL'CHQBKPTF'DBFILE                                              CRE019
     C                     Z-ADD4         DBASE                                               CRE019
     C                     MOVE *ALL'9'   DBKEY                                               CRE019
     C                     OUT  LDA                                                           CRE019
     C                     EXSR *PSSR                                                         CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Increase No. of records if action is insert                                          CRE019
      *                                                                                       CRE019
     C           WINS      IFEQ 'Y'                                                           CRE019
     C                     ADD  1         NORE                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Decrease No. of records if action is delete                                          CRE019
      *                                                                                       CRE019
     C           WDEL      IFEQ 'Y'                                                           CRE019
     C                     SUB  1         NORE                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       WINS    1                                           CRE019
     C                     MOVE 'N'       WDEL    1                                           CRE019
      *                                                                                       CRE019
     C                     MOVE BJRDNB    LCD                                                 CRE019
     C                     MOVEL'A'       CHTP                                                CRE019
     C                     Z-ADDWNATN     TNLU                                                CRE019
     C                     UPDATCHQBKPTF                                                      CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRTNLU - Subroutine to get the next transaction number        *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SRTNLU    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C           *NAMVAR   DEFN MNATN     DNATN                                               CRE019
     C           *LOCK     IN   DNATN                                                         CRE019
     C                     MOVE FNATN     WNATN   50                                          CRE019
     C                     MOVE FNATN     WWRK5   50                                          CRE019
     C                     ADD  1         WWRK5                                               CRE019
     C                     MOVE WWRK5     FNATN                                               CRE019
     C                     OUT  DNATN                                                         CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *                                                                                       CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
** CPY@
(c) Finastra International Limited 2001
**   @TXT - TEXT STRINGS FOR OVERRIDE
DLTOVR     FILE(TTRANL7)
OVRDBF     FILE(TTRANL7) MBR(XXXX) SECURE(*YES) SHARE(*NO)  SEQONLY(*NO)
